<canvas style=margin:auto;display:block></canvas><script>kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){let e,i,r,s,n=(t=t||{}).fps||60,a=0,o=1e3/n,h=1/n,c=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function p(){if(i=requestAnimationFrame(p),r=performance.now(),s=r-e,e=r,!(s>1e3)){for(kontra._tick(),a+=s;a>=o;)l.update(h),a-=o;c(),l.render()}}let l={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(p)},stop(){this.isStopped=!0,cancelAnimationFrame(i)}};return l},function(){let t={},e={},r={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;t<26;t++)r[65+t]=(10+t).toString(36);for(i=0;i<10;i++)r[48+i]=""+i;addEventListener("keydown",(function(i){let s=r[i.which];e[s]=!0,t[s]&&t[s](i)})),addEventListener("keyup",(function(t){e[r[t.which]]=!1})),addEventListener("blur",(function(t){e={}})),kontra.keys={bind(e,i){[].concat(e).map((function(e){t[e]=i}))},unbind(e,i){[].concat(e).map((function(e){t[e]=i}))},pressed:t=>!!e[t]}}(),function(){class t{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,r){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=r}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=(e,i)=>new t(e,i),kontra.vector.prototype=t.prototype;class e{init(t,e,i,r){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),r=r||i[e];this._ca=r,this.width=r.width,this.height=r.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=t=>(new e).init(t),kontra.sprite.prototype=e.prototype}(),function(){class t{constructor(t,e){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=void 0===t.loop||t.loop,e=t.spriteSheet.frame,this.width=e.width,this.height=e.height,this.margin=e.margin||0,this._f=0,this._a=0}clone(){return kontra.animation(this)}reset(){this._f=0,this._a=0}update(t){if(this.loop||this._f!=this.frames.length-1)for(t=t||1/60,this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render(t){t=t||{};let e=this.frames[this._f]/this.spriteSheet._f|0,i=this.frames[this._f]%this.spriteSheet._f|0;(t.context||kontra.context).drawImage(this.spriteSheet.image,i*this.width+(2*i+1)*this.margin,e*this.height+(2*e+1)*this.margin,this.width,this.height,t.x,t.y,this.width,this.height)}}kontra.animation=function(e){return new t(e)},kontra.animation.prototype=t.prototype;class e{constructor(t){t=t||{},this.animations={},this.image=t.image,this.frame={width:t.frameWidth,height:t.frameHeight,margin:t.frameMargin},this._f=t.image.width/t.frameWidth|0,this.createAnimations(t.animations)}createAnimations(t){let e,i,r,s;for(s in t)i=(e=t[s]).frames,r=[],[].concat(i).map((function(t){r=r.concat(this._p(t))}),this),this.animations[s]=kontra.animation({spriteSheet:this,frames:r,frameRate:e.frameRate,loop:e.loop})}_p(t,e){if(+t===t)return t;let i=[],r=t.split(".."),s=e=+r[0],n=+r[1];if(s<n)for(;e<=n;e++)i.push(e);else for(;e>=n;e--)i.push(e);return i}}kontra.spriteSheet=function(t){return new e(t)},kontra.spriteSheet.prototype=e.prototype}();var WIDTH=500,HEIGHT=700,CARWIDTH=60,CARHEIGHT=80,DISTANCEFROMBOTTOM=50,A=0,B=WIDTH/4,C=WIDTH/2,D=3*WIDTH/4,SPRITEWIDTH=30,SPRITEHEIGHT=30,MAXOBSTACLEDISTANCE=2e3,MINOBSTACLEDISTANCE=500,XSPEED=10,YSPEED=9,SPRITESPAWNPROBABILITY=.02,SPRITETYPEPROBABILITY=.5,ROTATERATE=30;let limage=new Image;limage.src="red.png";let rimage=new Image;rimage.src="blue.png";let gold=new Image;gold.src="gold.png";let silver=new Image;silver.src="silver.png";var left_sprite,right_sprite,loop,dividers=[],sprites=[],score=0,isGameOver=!1;function restart(){dividers=[],sprites=[],score=0,isGameOver=!1,initLevel()}function initLevel(){dividers.push(kontra.sprite({x:WIDTH/2,y:0,width:3,height:HEIGHT,color:"black",type:"divider"})),dividers.push(kontra.sprite({x:WIDTH/4,y:0,width:2,height:HEIGHT,color:"black",type:"divider"})),dividers.push(kontra.sprite({x:3*WIDTH/4,y:0,width:2,height:HEIGHT,color:"black",type:"divider"})),left_sprite=kontra.sprite({x:(WIDTH/4-CARWIDTH)/2,y:HEIGHT-DISTANCEFROMBOTTOM-CARHEIGHT,dx:0,image:limage}),right_sprite=kontra.sprite({x:3*WIDTH/4+(WIDTH/4-CARWIDTH)/2,y:HEIGHT-DISTANCEFROMBOTTOM-CARHEIGHT,width:CARWIDTH,height:CARHEIGHT,dx:0,image:rimage});var t=Math.random();spawn(t<.5?A:B),spawn(t<.5?C:D),(loop=kontra.gameLoop({update:function(){if(!isGameOver){levelGen(),updatePlayer();var t=[];for(i in sprites){var e=sprites[i];e.update(),e.y>HEIGHT&&("collectible"==e.type&&gameOver(),t.push(i))}for(i in t)sprites.splice(t[i],1);check()}},render:function(){if(isGameOver)kontra.context.fillStyle="rgba(0,0,0,0.9)",kontra.context.fillRect(0,0,WIDTH,HEIGHT),kontra.context.fillStyle="rgb(255,255,255)",kontra.context.font="40px Arial",kontra.context.fillText("Score: "+score,160,HEIGHT/2),kontra.context.font="20px Arial",kontra.context.fillText("Press space to restart",140,3*HEIGHT/4);else{for(i in dividers){dividers[i].render()}for(i in sprites){sprites[i].render()}renderPlayer()}}})).start()}function spawn(t){Math.random()<SPRITESPAWNPROBABILITY&&(Math.random()<SPRITETYPEPROBABILITY?sprites.push(getCollectible(t)):sprites.push(getObstacle(t)))}function getObstacle(t){return kontra.sprite({x:t+(WIDTH/4-SPRITEWIDTH)/2,y:-SPRITEHEIGHT,width:SPRITEWIDTH,height:SPRITEHEIGHT,dy:YSPEED,color:"blue",type:"obstacle",image:silver})}function getCollectible(t){return kontra.sprite({x:t+(WIDTH/4-SPRITEWIDTH)/2,y:-SPRITEHEIGHT,width:SPRITEWIDTH,height:SPRITEHEIGHT,dy:YSPEED,color:"red",type:"collectible",image:gold})}function levelGen(){var t=HEIGHT,e=HEIGHT,r=HEIGHT,s=HEIGHT;for(i in sprites){var n=sprites[i];n.x==A+(WIDTH/4-SPRITEWIDTH)/2?n.y<t&&(t=n.y):n.x==B+(WIDTH/4-SPRITEWIDTH)/2?n.y<e&&(e=n.y):n.x==C+(WIDTH/4-SPRITEWIDTH)/2?n.y<r&&(r=n.y):n.x==D+(WIDTH/4-SPRITEWIDTH)/2&&n.y<s&&(s=n.y)}t>MINOBSTACLEDISTANCE&&t<MAXOBSTACLEDISTANCE&&spawn(A),e>MINOBSTACLEDISTANCE&&e<MAXOBSTACLEDISTANCE&&spawn(B),r>MINOBSTACLEDISTANCE&&r<MAXOBSTACLEDISTANCE&&spawn(C),s>MINOBSTACLEDISTANCE&&s<MAXOBSTACLEDISTANCE&&spawn(D)}function updatePlayer(){left_sprite.update(),left_sprite.x+CARWIDTH>C-(WIDTH/4-CARWIDTH)/2?(left_sprite.dx=0,left_sprite.x=C-(WIDTH/4-CARWIDTH)/2-CARWIDTH):left_sprite.x<A+(WIDTH/4-CARWIDTH)/2&&(left_sprite.dx=0,left_sprite.x=A+(WIDTH/4-CARWIDTH)/2),right_sprite.update(),right_sprite.x+CARWIDTH>WIDTH-(WIDTH/4-CARWIDTH)/2?(right_sprite.dx=0,right_sprite.x=WIDTH-(WIDTH/4-CARWIDTH)/2-CARWIDTH):right_sprite.x<C+(WIDTH/4-CARWIDTH)/2&&(right_sprite.dx=0,right_sprite.x=C+(WIDTH/4-CARWIDTH)/2)}function renderPlayer(){left_sprite.render(),right_sprite.render()}function check(){var t=[];for(i in sprites){var e=sprites[i];"obstacle"==e.type&&(e.collidesWith(left_sprite)||e.collidesWith(right_sprite))?gameOver():"collectible"==e.type&&(e.collidesWith(left_sprite)||e.collidesWith(right_sprite))&&(score+=1,t.push(i))}for(i in t)sprites.splice(i,1)}function gameOver(){loop.stop(),isGameOver=!0,kontra.context.fillStyle="rgba(0,0,0,0.9)",kontra.context.fillRect(0,0,WIDTH,HEIGHT),kontra.context.fillStyle="rgb(255,255,255)",kontra.context.font="40px Arial",kontra.context.fillText("Score: "+score,160,HEIGHT/2),kontra.context.font="20px Arial",kontra.context.fillText("Press space to restart",140,3*HEIGHT/4)}kontra.init(),kontra.canvas.width=WIDTH,kontra.canvas.height=HEIGHT,initLevel(),kontra.keys.bind("left",(function(){0==left_sprite.dx?left_sprite.x<B?left_sprite.dx=XSPEED:left_sprite.dx=-XSPEED:left_sprite.dx=-left_sprite.dx})),kontra.keys.bind("space",(function(){loop.stop(),restart()})),kontra.keys.bind("right",(function(){0==right_sprite.dx?right_sprite.x<D?right_sprite.dx=XSPEED:right_sprite.dx=-XSPEED:right_sprite.dx=-right_sprite.dx}))</script>