<title>SQUAD 13 - js13kGames 2024</title><meta name=viewport content="width=device-width,maximum-scale=1.01"><style>*{margin:0;width:100%;height:100%;position:relative;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none}body{background:#000}#t{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}#g{display:block;cursor:none}</style><div id=t><canvas id=g></canvas></div><script>let i,s,e,h=0,l=window,n=CanvasRenderingContext2D.prototype,r=1600,a=900;function o(t){for(let i of t)return i;return 0}function f(t,i){let[s,e,h]=function(t){let i=function(t){let i=t.slice(1);return 3===i.length&&(i=`${i.charAt(0)}0${i.charAt(1)}0${i.charAt(2)}0`),parseInt(i,16)}(t);return[(i>>16)%256,(i>>8)%256,(0|i)%256]}(t);return function(t,i,s){return"#"+(t<<16|i<<8|s).toString(16).padStart(6,"0")}(s*i,e*i,h*i)}_R=navigator.userAgent.match(/andro|ipho|ipa|ipo/i)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?1:0,fT=["January","March","April","May","June","August","September","October"],fS=["Warkistan","Murdavia","Kingdom of Zarathar","Khaldonia","Republic of Eldrania","Wabanka","Simian Islands","Serkhan Territories","Vashir Confederacy","Drazara Islands"],onresize=()=>{let s,e,h=innerWidth,l=innerHeight,n=h/l,o=r/a,f=t.style;r=1600,a=900;let u=r*a;if(1===_R){if(h>l){let t=r;r=a,a=t}for(r/a<n?a=r/n:r=a*n;r*a/u<.5;)r*=2,a*=2}else n<=o?(s=h,e=s/o):(e=l,s=e*o);i.width=r,i.height=a,f.width=s+"px",f.height=e+"px"},_k=(t,i,s)=>i<t?t:i>s?s:i,_v=(t,i,s)=>t<=i&&i<=s||t>=i&&i>=s,F=(t,i)=>random()*(i-t)+t,dU=(t,i,s,e)=>hypot(t-s,i-e),_n=(t,i)=>dU(t.x,t.y,i.x,i.y),au=t=>ir(t,PI),cr=(t,i)=>atan2(i.y-t.y,i.x-t.x),kb=(t,i)=>round(t/i)*i,cq=t=>t[~~(random()*t.length)],iq=t=>t,ka=t=>1-pow(1-t,5),k_=t=>1+2.70158*pow(t-1,3)+1.70158*pow(t-1,2),_i=(t,i,s,e=iq)=>e(_k(0,s,1))*(i-t)+t,ir=(t,i)=>((t%=2*i)>i&&(t-=2*i),t<-i&&(t+=2*i),t),Object.getOwnPropertyNames(Math).forEach(t=>l[t]=l[t]||Math[t]),k$=2*PI,jZ=(t,i,s,e,h,l,n,r)=>{var a,o,f;return 0==(a=(s-t)*(r-l)-(n-h)*(e-i))?0:(o=((i-e)*(n-t)+(s-t)*(r-i))/a,0<(f=((r-l)*(n-t)+(h-n)*(r-i))/a)&&f<1&&0<o&&o<1)},fO=t=>(t<10?"0":"")+~~t,cn=t=>fO(~~(t/60))+":"+fO(~~t%60)+"."+fO(t%1*100);class u{constructor(){this.t=0,this.cm=[]}next(t=0,i=1){return this.t>=this.cm.length&&this.cm.push(random()),this.cm[this.t++%this.cm.length]*(i-t)+t}reset(){this.t=0}}function c(t,i,s,e){_e(...[,,74,.06,.29,.54,4,3.1,,-8,,,,1.3,,.2,,.4,.24]);for(let e=0;e<10;e++)t.add(new A(i.x+F(5*-s/8,5*s/8),i.y+F(5*-s/8,5*s/8),-F(PI/4,3*PI/4),F(300,600)));for(let e=0;e<30;e++){let e=i.x+F(5*-s/8,5*s/8),h=i.y+F(5*-s/8,5*s/8);t.add(new v(cq(["#000","#ff0","#f80"]),[F(25,30),0],[e,e+F(-100,100)],[h,h-F(50,150)],F(1.2,3)))}for(let h of x(t,e))h!==e&&(_n(h,i)>s||(h.push?h.push():h.i()));for(let s of t.h("u")){let e=1-_n(s,i)/(r/2);e<=0||o(t.h("m")).o(e)}}function*x(t,i){for(let s of t.h("human"))s!==i&&(yield s);for(let s of t.h("_w"))s!==i&&(yield s)}class d{constructor(){this.x=this.y=this.l=this.u=0,this._=[]}m(t){this.l+=t}p(t){}I(){}S(t){let i=this.l+t;return this.T.P(()=>this.l>i)}M(){return this.T.P(()=>!this.T.R(this))}}class y{constructor(){this.j=new Set,this._=new Map,this.add(new k)}h(t){return this._.has(t)||this._.set(t,new Set),this._.get(t)}R(t){return this.j.has(t)}I(){for(let t of this.j)t.I()}add(...t){for(let i of t){if(this.R(i))return;this.j.add(i);for(let t of i._)this.h(t).add(i);i.T=this}}F(t){this.j.delete(t);for(let i of t._)this.h(i).delete(t)}m(t){for(let i of this.j)i.m(t)}p(){let t=o(this.h("m"));s.save(),s.translate(r/2,a/2),s.scale(t.O,t.O),s.translate(-~~t.x,-~~t.y);for(let i of this.j)s.v(()=>i.p(t));s.restore()}P(t){let i=new J(t);return this.add(i),i.U()}}class p{constructor(t,i,s){this.x=t,this.y=i,this.D=s,this.C=0,this.k=0,this.L=0}}class g extends d{constructor(t=1){super(),this._.push("_w"),this.A={N:0,left:0,right:0,K:0,q:0},this.D=35,this.H=0,this.Y=1,this.$=0,this.B=t,this.W=0,this.G=[new p(-10,18,5),new p(10,18,5),new p(20,-15,20),new p(-20,-15,20),new p(15,0,10),new p(-55,-10,10)];for(let t of this.G)t.x*=this.B;for(let t of[this.G[0],this.G[1]])t.C=1;for(let t of this.G)t.L=!t.C;this.V=[],this.X=0,this.J={x:0,y:0,u:0},this.Z=0,this.tt=0,this.st=0,this.it=0,this.ht=0,this.et=1,this.rt=0,this.nt=0,this.ot=0,this.lt=PI/8,this.ft=PI/4,this.ut=0,this.ct=1}_t(){for(let t=0;t<this.G.length;t++){this.V[t]||(this.V[t]=new p(0,0,0));let i=this.G[t],s=atan2(i.y,i.x),e=dU(0,0,i.x,i.y);this.V[t].x=this.x+cos(this.u+s)*e,this.V[t].y=this.y+sin(this.u+s)*e,this.V[t].D=i.D,this.V[t].C=i.C,this.V[t].L=i.L,this.V[t].k=0}}get wt(){let t=0,i=0;for(let s of this.V)t+=s.x,i+=s.y;return{x:t/this.G.length,y:i/this.G.length}}get dt(){return this.l<this.ht?0:this.l-this.H>this.Y}It(){if(!this.dt)return 0;let t,{u:i}=this;this.B<0&&(i=atan2(sin(i),-cos(i)));let s=this.lt;for(let e of x(this.T,this)){if(_n(e,this)>600)continue;if(e instanceof H)continue;if(e instanceof N&&!this._.includes("u"))continue;let h=au(cr(this,e)),l=abs(au(h-au(i)));if(e===this.rt&&l<this.ft)return e;l<s&&(t=e,s=l)}return t}m(t){super.m(t),this.$+=_i(3,5,this.X)*PI*t;for(let t of this.T.h("_w"))t!==this&&(_n(t,this)>this.D||(this.push(),t.push(),this.l-this.ut>.2&&(this.ut=this.l,_e(...[,,63,.05,.2,.3,4,,,6,,,.15,1.3,,.1,,.32,.15,.01]))));let i=this.It();if(i!==this.rt&&(this.rt=i,this.nt=0),this.rt&&(this.nt=min(1,this.nt+t/this.et)),this.nt>=1?this.ot+=t:this.ot=0,this.dt&&this.A.K){let t=new L(this);this.T.add(t),this.rt&&this.nt>=1&&(t.u=cr(this,this.rt),this._.includes("u")&&(t.St=this.rt)),this.H=this.l}this._t();let{wt:s}=this;for(let t of this.T.h("K"))if(_v(t.Pt-100,this.x,t.xt+100))for(let i of this.V)i.k=i.k||t.Tt(i);let e=!this.V.some(t=>t.C&&!t.k),h=this.V.some(t=>(t.L||this.ht>this.l)&&t.k);for(let t of this.T.h("_C"))if(this.y>=t.y){h=1;for(let t=0;t<20;t++)this.T.add(new A(this.x+F(-20,20),this.y+F(-20,20),-F(PI/4,3*PI/4),F(400,600),["#27c6dc"]))}if(h)return void this.i();let l=this.wt,n=l.x-s.x,r=l.y-s.y;(n||r)&&(this.x+=n,this.y+=r);let a=0,f=PI/6;if(e||(this.A.left&&(a=-PI/4),this.A.right&&(a=PI/4),(this.A.left||this.A.right)&&(f=PI/1.5)),this.l>=this.ht){let i=0,s=0;this.A.left&&(i-=1),this.A.right&&(i+=1),this.A.N&&(s-=1),this.A.q&&(s+=1);let e=this.A.N?1:0;this.X+=_k(4*-t,e-this.X,4*t),this.u+=_k(-t*f,a-this.u,t*f)}else{let t=this.x+F(-20,20),i=this.y+F(-20,20),s=new v(cq(["#000","#ff0","#f80","#f00"]),[F(10,20),0],[t,t+F(-100,100)],[i,i-F(50,150)],F(1.2,3));this.T.add(s)}this.J.u=0,this.W?(this.J.x+=cos(a-PI/2)*t*400*1.5,this.J.y-=this.X*t*400):(this.J.x+=_i(.5,1.5,this.X)*cos(this.u-PI/2)*t*400,this.J.y+=this.X*sin(this.u-PI/2)*t*400);let u=sign(sin(this.u))!==sign(this.J.x)||this.W?200:50;this.J.x+=_k(-t*u,-this.J.x,t*u);let c=this.W?this.A.left||this.A.right?20:200:400,x=this.W?200:this.A.q?300:150;this.J.y+=_k(-t*(this.W?150:200),c-this.J.y,t*x),this.W&&(this.J.x=_k(-300,this.J.x,300),this.J.y=_k(-300,this.J.y,200)),e&&!this.X&&(this.J.y=0),this.x+=this.J.x*t,this.y+=this.J.y*t,this.u+=this.J.u*t;let d=o(this.T.h("m"));this.u=_k(-PI/4,this.u,PI/4);let y=this.Z,{st:p}=this;if(this.Z=e,this.Z?(this.st=this.l,this.tt+=t):this.tt=0,this.Z&&!y&&this.l-p>.5){let[t,i]=this.V.filter(t=>t.C);for(let s=0;s<10;s++){let s=F(-.5,1.5),e=t.x+s*(i.x-t.x),h=t.y+s*(i.y-t.y),l=new v("#fff",[F(10,15),0],[e,e+F(-30,30)],[h,h+F(-20,-10)],F(.8,1.5));this.T.add(l)}_e(...[.5,,400,.02,.08,.09,4,2.5,-1,9,,,,.3,,.1,.14,.63,.02,,-2063])}_v(d.Pt,this.x,d.xt)||(this.J.x=0,this.x=_k(d.Pt,this.x,d.xt)),_v(d.gt,this.y,d.Mt)||(this.J.y=0,this.y=_k(d.gt,this.y,d.Mt))}push(t=1){let i=F(PI/4,3*PI/4);this.J.x=300*cos(i),this.J.y=300*sin(i),this.it=this.l,this.ht=this.l+this.ct}i(){this.T.F(this),this.I(),c(this.T,this,80,this)}p(){s.v(()=>{if(s.translate(this.x,this.y),s.rotate(this.u),s.scale(this.B,1),this.l<this.ht){let t=(this.l-this.it)/(this.ht-this.it);s.scale(cos(t*PI*2),1)}s.fillStyle="#000",s.fillRect(-20,-15,40,30),s.fillRect(0,-10,-50,5),s.fillRect(-60,-20,10,15),s.fillRect(-20,20,40,2),s.fillRect(-10,15,2,5),s.fillRect(10,15,2,5),s.fillRect(-2,0,4,-22),s.v(()=>{s.translate(0,-22),s.scale(1,.45),this.Rt(100,6)}),s.v(()=>{s.translate(-55,-15),this.Rt(24,4)})})}yt(){return this.T.P(()=>{if(!this.T.R(this))throw new Error})}jt(){return{x:this.x+1*this.J.x,y:this.y+1*this.J.y}}Rt(t,i){s.rotate(this.$),s.fillRect(-t/2,-i/2,t,i);let e=_i(PI/8,PI/3,this.X);s.globalAlpha=.2,s.beginPath(),s.moveTo(0,0),s.arc(0,0,t/2,0,-e,1),s.rotate(PI),s.moveTo(0,0),s.arc(0,0,t/2,0,-e,1),s.fill()}}class _ extends g{constructor(){super(),this._.push("u"),this.Ft=0,this.Ot=0,this.vt=0,this.Ut=0}I(){this.Et&&(this.Et.stop(),this.Et=0)}m(t){let{nt:i}=this;!this.Et&&this.l>.5&&(this.Et=new lt(nt(...[,,317,,20,0,,3.2,-12,16,,,.07,.1,,,,.59,.18,.12])),this.Et.Dt.loop=1,this.Et.start()),super.m(t);let s,{A:e}=this;e.left=Tt[37]||Tt[65]||Tt[81],e.right=Tt[39]||Tt[68],e.N=Tt[38]||Tt[87]||Tt[90],e.q=Tt[40]||Tt[83],e.K=Tt[32];for(let t of wt){let i=t.x/r;e.left=e.left||_v(0,i,.25),e.right=e.right||_v(.25,i,.5),e.K=e.K||_v(.5,i,.75),e.N=e.N||_v(.75,i,1)}for(let t of this.T.h("R"))_n(t,this)<150&&(s=t);let h=s&&!this.Ot?100:0;h&&!this.Ft&&_e(...[,,100,.01,.08,.14,1,.8,10,,,,,,,,,.55,.02]),this.Ft+=_k(100*-t,h-this.Ft,100*t),this.Et&&(this.Et.Ct(_i(.5,1,this.X)),this.Et.bt(_i(.5,1,this.X))),this.l<this.ht&&this.l-this.Ut>.25&&(this.Ut=this.l,_e(...[.4,,434,,.03,.01,3,2,,5,,,,,168,,,.76,.03,,520])),0===i&&this.nt>0&&_e(...[,,354,.02,.28,.32,,.9,5,160,491,.07,.09,,,,,.66,.17,.39]),i<1&&this.nt>=1&&_e(...[2,,12,.01,.04,.006,,2.8,,,-436,.01,.02,,,,.14,.61,.02])}p(t){s.v(()=>{if(!this.rt)return;if(this.nt>=1&&this.ot<1&&this.ot/.2%1<.5)return;s.strokeStyle=s.fillStyle=this.nt>=1?"#f00":"#ff0",s.globalAlpha=_i(0,.2,this.nt),s.beginPath(),s.lineWidth=_i(40,4,this.nt),s.moveTo(this.x,this.y),s.lineTo(this.rt.x,this.rt.y),s.stroke(),s.translate(this.rt.x,this.rt.y),s.globalAlpha=this.nt,s.shadowColor="#000",s.shadowOffsetY=2;let t=_i(2,1,this.nt);s.scale(t,t),s.rotate(this.l*PI);let i=max(this.rt.D,20);s.lineWidth=2,s.beginPath(),s.arc(0,0,i,0,2*PI),s.stroke();for(let t=0;t<4;t++)s.rotate(PI/2),s.fillRect(i-5,0,10,2)}),s.v(()=>{s.translate(this.x,this.y),s.fillStyle="#000",s.fillRect(-5,0,2,this.Ft),s.fillRect(5,0,-2,this.Ft);for(let t=this.Ft;t>=0;t-=10)s.fillRect(-5,t,10,2)}),super.p(t)}}class w extends g{constructor(){super(-1),this._.push("enemy-_w"),this.kt=0,this.Lt=[],this.At=0,this.ft=PI}Nt(t){return this.Lt=t,this}p(t){s.v(()=>{if(this.nt<=0)return;s.translate(this.x,this.y);let t=this.nt%.25/.25;s.fillStyle="#f00",s.globalAlpha=_i(1,0,t);let i=_i(0,1,t);s.scale(i,i),s.beginPath(),s.arc(0,0,150,0,2*PI),s.fill()}),super.p(t)}m(t){super.m(t),this.A.N=0,this.A.left=0,this.A.right=0;let i=this.Lt[0];if(i){if(_n(i,this)>10){let t=this.jt();this.A.right=t.x<i.x-10,this.A.left=t.x>i.x+10,this.A.N=t.y>i.y}else this.Lt.push(this.Lt.shift());this.A.K=this.nt>=1,this.nt>0&&this.l-this.At>.2&&(this.At=this.l,_e(...[.4,,434,,.03,.01,3,2,,5,,,,,168,,,.76,.03,,520]))}}}class m extends d{constructor(){super(),this.Kt=dB(500,400,(t,i)=>{t.shadowColor="#fff",t.shadowBlur=50,t.fillStyle="#fff",t.beginPath(),t.moveTo(50,i.height/2),t.arc(i.width-200-50,i.height/2,i.height/2,PI/3,-PI/3,1),t.fill()})}p(t){let i=o(this.T.h("u"));i&&(s.translate(i.x,i.y),s.rotate(i.u),s.translate(-20,0),s.rotate(PI/16),s.globalAlpha=.05,s.drawImage(this.Kt,0,-this.Kt.height/2))}}class P extends d{constructor(){super(),this._=["K"],this.points=[],this.qt=1}get Pt(){return this.points[0].x}get xt(){return this.points[this.points.length-1].x}Ht(t){let i=0;for(;this.points[i]&&this.points[i].x<t.x;)i++;let s=this.points[i-1],e=this.points[i];if(!s||!e)return;let h=(t.x-s.x)/(e.x-s.x),l=_i(s.y,e.y,h)-this.qt*t.D;return _v(l,t.y,l+100*this.qt)?(t.y=l,1):void 0}R(t,i){let s=this.Yt(t);return 0===s?0:sign(s-i)!==this.qt}Yt(t){let i=0;for(;this.points[i]&&this.points[i].x<t;)i++;let s=this.points[i-1],e=this.points[i];if(!s||!e)return 0;let h=(t-s.x)/(e.x-s.x);return _i(s.y,e.y,h)}Tt(t){let i=0;for(;this.points[i]&&this.points[i].x<t.x;)i++;let s=this.points[i-1],e=this.points[i];if(!s||!e)return;let h=_n(s,e),l=au(atan2(e.y-s.y,e.x-s.x)),n=au(au(atan2(t.y-s.y,t.x-s.x))-l),r=cos(n)*_n(s,t)/h;if(abs(sin(n)*_n(s,t))>t.D)return;if(!_v(0,r,1)&&_n(s,t)>t.D&&_n(e,t)>t.D)return;let a=s.x+r*(e.x-s.x),o=s.y+r*(e.y-s.y);return t.x=a-this.qt*cos(l+PI/2)*t.D,t.y=o-this.qt*sin(l+PI/2)*t.D,1}p(t){t.x+r/2<this.Pt||t.x-r/2>this.xt||s.v(()=>{s.fillStyle="#000",s.beginPath();let i=this.points[0].y,e=i;for(let t of this.points)s.lineTo(t.x,t.y),i=max(i,t.y+100),e=min(e,t.y-100);this.qt>0?(s.lineTo(this.points[this.points.length-1].x,t.Mt),s.lineTo(this.points[0].x,t.Mt)):(s.lineTo(this.points[this.points.length-1].x,t.gt),s.lineTo(this.points[0].x,t.gt)),s.fill()})}}class S extends d{constructor(){super(),this._.push("landing-area")}p(){let t=o(this.T.h("u"));s.v(()=>{s.translate(this.x,this.y),s.globalAlpha=.2,s.fillStyle="#0f0",s.fillRect(-100,0,200,50),s.fillRect(-100,0,_i(0,200,this.$t(t)),50),s.globalAlpha=1,s.fillStyle="#000",s.textAlign="center",s.textBaseline="middle",s.font="bold 24pt Impact",s.fillText("FINISH",0,25)})}Z(t){return this.T.P(()=>this.$t(t)>=1)}$t(t){return t&&_v(this.x-100,t.x,this.x+100)&&_v(this.y-100,t.y,this.y+100)?t.tt/1:0}m(t){super.m(t);let i=o(this.T.h("u"));this.$t(i)>0?this.Bt||(this.Bt=it(...[,,379,.02,.28,.31,,3.2,,-19,259,.06,.06,,,,,.56,.23]),this.Bt.start()):this.Bt&&(this.Bt.stop(),this.Bt=0)}}class I extends d{constructor(t){super(),this._.push("_C"),this.y=t,this.Wt=[.8,1].map(t=>{let i=f("#27c6dc",t),s=fe(100,20,t=>{t.fillStyle=i,t.beginPath(),t.moveTo(0,20);for(let i=0;i<=100;i+=2)t.lineTo(i,10+10*abs(sin(i/100*PI*2)));t.lineTo(100,20),t.fill()});return s.Gt=i,s.Vt=t,s})}p(t){if(t.y+a/2<this.y)return;s.translate(~~t.x-r/2,this.y);let i=0,e=50;for(let h of this.Wt)s.v(()=>{let l=this.l*e-t.x;s.translate(l,i),s.fillStyle=h,s.fillRect(-l,0,r,100),s.fillStyle=h.Gt,s.fillRect(-l,h.height,r,1e3)}),i+=20,e*=1.1}}class v extends d{constructor(t,i,s,e,h){super(),this.Gt=t,this.Xt=i,this.zt=s,this.Jt=e,this.Zt=h}m(t){super.m(t),this.l>this.Zt&&this.T.F(this)}Qt(t){let i=this.l/this.Zt;return t[0]+i*(t[1]-t[0])}p(){let t=this.Qt(this.Xt);s.translate(this.Qt(this.zt),this.Qt(this.Jt)),s.rotate(PI/4),s.fillStyle=this.Gt,s.globalAlpha=this.Qt([1,0]),s.fillRect(-t/2,-t/2,t,t)}}class A extends d{constructor(t,i,s,e,h=["#ff0","#f80","#000"]){super(),this.x=t,this.y=i,this.u=s,this.ts=e,this.ss=h,this.hs=0}m(t){if(super.m(t),this.l>1)return void this.T.F(this);let i=sin(this.u);i+=_k(2*-t,1-sin(this.u),2*t),this.u=atan2(i,cos(this.u)),this.x+=cos(this.u)*t*this.ts,this.y+=sin(this.u)*t*this.ts,(this.hs-=t)<=0&&(this.hs=1/60,this.T.add(new v(cq(this.ss),[F(5,10),0],[this.x,this.x+F(-5,5)],[this.y,this.y-F(20,30)],F(1.2,3))))}}class C extends d{constructor(t,i){super();let s=document.createElement("canvas").getContext("2d");this.es=s.createLinearGradient(0,0,0,a),this.es.addColorStop(0,t),this.es.addColorStop(1,i)}p(t){s.translate(t.x-r/2,t.y-a/2),s.fillStyle=this.es,s.fillRect(0,0,r,a)}}class D extends d{constructor(t){super(),this.Gt=t,this.D=200}p(t){s.translate(.9*t.x+r/4,.1*t.y),s.fillStyle=this.Gt,s.beginPath(),s.arc(0,0,200,0,2*PI),s.fill()}}class b extends d{constructor(){super(),this.rs=new u}p(t){s.translate(~~t.x-r/2,~~t.y-a/2),s.fillStyle="white",this.rs.reset();for(let t=0;t<100;t++)s.fillRect(this.rs.next(0,r),this.rs.next(0,a),1,1)}}class E extends d{constructor(t){super(),this.ns=[.8,.6,.4].map(i=>{let s=f(t,i),e=fe(400,100,t=>{t.fillStyle=s;let i=800*random(),e=800*random();t.beginPath(),t.moveTo(0,400);for(let s=0;s<=800;s+=100)t.lineTo(s,50+25*sin((s+i)/400*PI*2)+12*sin((s+e)/200*PI*2));t.lineTo(800,400),t.fill()});return e.Gt=s,e.Vt=i,e})}p(t){let i=0;for(let e=0;e<this.ns.length;e++){let h=this.ns[e],l=e/(this.ns.length-1),n=_i(.3,.8,l),o=_i(.1,.1,l);s.v(()=>{let e=~~(t.y*o+i);s.translate(t.x-r/2,e),s.v(()=>{let i=t.x*n;s.translate(-i,0),s.fillStyle=h,s.fillRect(i,0,r,h.height)}),s.fillStyle=h.Gt,s.fillRect(0,h.height,r,t.y+a-e-200)}),i+=50}}}class O extends d{constructor(){super(),this.rs=new u}p(t){s.translate(~~t.x-r/2,~~t.y-a/2),s.fillStyle="#fff",this.l%4<.4&&s.v(()=>{s.globalAlpha=.1*sin(this.l*PI*10)+.1,s.fillRect(0,0,r,a)}),this.rs.reset();for(let t=0;t<200;t++){let t=this.rs.next(0,r),i=t+this.rs.next(20,50),e=this.rs.next(.5,1.5),h=this.rs.next(0,e),l=(this.l+h)%e/e;s.fillRect(_i(t,i,l),_i(0,a,l),1,10)}}}class k extends d{constructor(){super(),this._=["m"],this.Pt=this.gt=this.xt=this.Mt=0,this.os=0,this.ls=0,this.fs=1}o(t){this.fs=t,this.os=this.l+.4}m(t){super.m(t);let i=max(this.xt-this.Pt,r)/2,s=max(this.Mt-this.gt,a)/2,e=(this.xt+this.Pt)/2,h=(this.Mt+this.gt)/2;this.Pt=e-i,this.xt=e+i,this.gt=h-s,this.Mt=h+s;let l=o(this.T.h("u"));if(!l)return;this.ls-=t,this.l<this.os&&this.ls<=0&&(this.ls=1/60,this.x+=20*F(-this.fs,this.fs),this.y+=20*F(-this.fs,this.fs));let n=_k(this.Pt+r/2,l.x+r/4,this.xt-r/2),f=_k(this.gt+a/2,l.y,this.Mt-a/2),u=abs(n-this.x)/.5,c=abs(f-this.y)/.5;this.x+=_k(-t*u,n-this.x,t*u),this.y+=_k(-t*c,f-this.y,t*c),this.x=_k(this.Pt+r/2,this.x,this.xt-r/2),this.y=_k(this.gt+a/2,this.y,this.Mt-a/2)}}class L extends d{constructor(t){super(),this.x=t.x+20*cos(t.u),this.y=t.y+20*sin(t.u),this.u=t.u,this.us=t,this.ts=500,this.D=10,this.hs=0,_e(...[2.1,,51,.01,.12,.15,2,2.7,17,-19,,,,,,.2,.29,.93,.16])}i(){this.T.F(this),_e(...[,,74,.06,.29,.54,4,3.1,,-8,,,,1.3,,.2,,.4,.24]),c(this.T,this,80,this.us)}m(t){if(super.m(t),this.l>2)this.i();else{for(let t of this.T.h("K")){if(!_v(t.Pt,this.x,t.xt))continue;let i=t.Yt(this.x);sign(i-this.y)!==t.qt&&this.i()}for(let t of x(this.T,this.us))_n(t,this)>t.D||this.i();if(this.St){let i=au(cr(this,this.St));this.u+=_k(-t*PI*2,au(i-au(this.u)),t*PI*2)}else{let i=sin(this.u);i+=_k(.2*-t,1-sin(this.u),.2*t),this.u=atan2(i,cos(this.u))}this.x+=cos(this.u)*t*this.ts,this.y+=sin(this.u)*t*this.ts,(this.hs-=t)<=0&&(this.hs=1/60,this.T.add(new v("#fff",[F(5,10),F(10,20)],[this.x,this.x+F(-10,10)],[this.y,this.y+F(-10,10)],F(1.2,3))))}}}let z=160;class q extends d{constructor(t,i){super(),this.cs=t,this._s=i}m(t){super.m(t),this.l>.3&&this.ws<0&&this.T.F(this)}p(t){s.translate(~~t.x-r/2,~~t.y-a/2),s.translate(_i(this.cs,this._s,this.l/.3),0),s.fillStyle="#000",s.beginPath(),s.moveTo(0,0),s.lineTo(r+z,0),s.lineTo(r,a),s.lineTo(-z,a),s.fill()}}class G extends q{constructor(){super(0,r+z)}}class B extends q{constructor(){super(-r-z,0)}}class J extends d{constructor(t){super(),this.ds=t}U(){return new Promise((t,i)=>{this.ps=t,this.Is=i})}m(t){super.m(t);try{if(!this.ds())return;this.ps()}catch(t){this.Is(t)}this.T.F(this)}}class Y extends d{constructor(){super(),this._.push("human"),this.D=10}i(){this.T.F(this);for(let t=0;t<10;t++)this.T.add(new A(this.x+F(-20,20),this.y+F(-20,20),-F(PI/4,3*PI/4),F(100,150),["#f00","#900"]));for(let t=0;t<50;t++){let t=this.x+F(-20,20),i=this.y+F(-20,20),s=F(0,2*PI),e=F(30,80);this.T.add(new v(cq(["#f00","#900"]),[F(10,20),0],[t,t+cos(s)*e],[i,i+sin(s)*e],F(2,4)))}}}class N extends Y{constructor(){super(),this._.push("T"),this.H=0,this.Y=6,this.Ss=0}m(t){super.m(t),this.u=PI;let i=o(this.T.h("u"));if(i&&_n(i,this)<500){this.u=cr(this,i);let s=this.x+30*cos(this.u),e=this.y+30*sin(this.u),h=0;for(let t of this.T.h("K"))t.qt<0||_v(t.Pt,this.x,t.xt)&&(h=t);if(h&&h.R(s,e))return void(this.Ss=0);if(this.l-this.H>this.Y&&(0===this.Ss&&_e(...[1.7,,391,.01,.12,.08,,3.4,18,-9,,,.02,.7,,,.13,.71,.1,.02]),this.Ss+=2*t),this.Ss>=1){let t=new L(this);t.ts*=.5,this.T.add(t),this.H=this.l,this.Ss=0}}else this.Ss=0}p(){s.translate(this.x,this.y),s.v(()=>{if(this.Ss<=0)return;s.fillStyle="#ff0",s.globalAlpha=_i(0,.5,this.Ss);let t=_i(1,0,this.Ss);s.scale(t,t),s.beginPath(),s.arc(0,0,40,0,2*PI),s.fill()}),s.fillStyle=s.strokeStyle="#000",s.scale(.8,.8),s.beginPath(),s.arc(0,-12,4,0,2*PI),s.fill(),s.lineJoin="round",s.lineCap="round",s.lineWidth=3,s.beginPath(),s.v(()=>{s.translate(0,-4),s.rotate(this.u),s.moveTo(-8,2)}),s.lineTo(-5,-5),s.lineTo(5,-5),s.v(()=>{s.translate(0,-4),s.rotate(this.u),s.lineTo(8,2)}),s.stroke(),s.lineWidth=4,s.beginPath(),s.moveTo(-3,0),s.lineTo(-3,16),s.moveTo(3,0),s.lineTo(3,16),s.stroke(),s.fillRect(-5,-8,10,16),s.v(()=>{s.translate(0,-4),s.rotate(this.u),s.fillStyle="#f00",s.fillRect(-10,-2.5,24,5)})}}class H extends Y{constructor(){super(),this._.push("R"),this.Ps=0}i(){super.i();let t=o(this.T.h("u"));t.Ot===this&&(t.Ot=0)}m(t){super.m(t),this.xs=0;let i=o(this.T.h("u"));if(i){if(_n(i,this)<200){let s=0;for(let t of this.T.h("K"))t.qt<0||_v(t.Pt,this.x,t.xt)&&(s=t);if(!s)return;this.x+=_k(10*-t,i.x-this.x,10*t),this.x=_k(s.Pt,this.x,s.xt),this.y=s.Yt(this.x)-this.D,this.xs=1}!i.Ot&&abs(i.x-this.x)<20&&_v(i.y,this.y,i.y+i.Ft)?(this.Ps+=4*t,this.Ps>1&&(this.Ts=1,i.Ot=this,i.Ft=this.y-i.y,_e(...[.6,,370,.01,.01,.13,,.9,40,76,,,,,,,,.91,.03,,925]))):this.Ps=0,i.Ot===this&&(this.x=i.x,this.y=i.y+i.Ft,_n(i,this)<20&&(i.Ot=0,i.vt++,this.T.F(this),_e(...[1.2,,529,.06,.19,.12,,.4,,,361,.06,.08,,,,.05,.52,.27,.18,140])))}}p(){s.translate(this.x,this.y),s.fillStyle="#0c0",s.scale(.8,.8),s.beginPath(),s.arc(0,-12,4,0,2*PI),s.fill(),s.strokeStyle="#0c0",s.lineJoin="round",s.lineCap="round",s.lineWidth=3,s.beginPath(),this.Ts?s.moveTo(-8,-15):s.moveTo(3*sin(this.l*PI*2)-8,-14),s.lineTo(-5,-5),s.lineTo(5,-5),this.Ts?s.lineTo(8,-14):s.lineTo(8,4),s.stroke(),s.lineWidth=4,s.beginPath(),s.moveTo(-3,0),s.lineTo(-3,16+2*sin(this.l*PI*4)*this.xs),s.moveTo(3,0),s.lineTo(3,16-2*sin(this.l*PI*4)*this.xs),s.stroke(),s.fillRect(-5,-8,10,16)}}class W extends d{constructor(t){super(),this.gs=t,this.Ms=0}p(t){s.translate(this.x,this.y),s.fillStyle="#000",s.textAlign="center",s.textBaseline="middle",s.font="bold 48pt Impact",this.Ms!==this.gs&&(this.l=0,this.Ms=this.gs),s.globalAlpha=_i(0,.3,this.l/.5),s.translate(0,_i(-25,0,this.l/.5)),s.fillText(this.gs,0,25)}}class K extends d{constructor(t,i="rgba(0,0,0,0)",s="#000"){super(),this._.push("title"),this.Rs=i,this.canvas=dB(r,a,i=>{i.fillStyle=s,i.fillRect(0,0,r,a),i.globalCompositeOperation="destination-out",i.textAlign="center",i.textBaseline="middle",i.font="bold 148pt Impact";let e=a/2-100;for(let s of t.split("\n"))i.fillText(s,r/2,e),e+=200}),this.ys=0,this.js=1,this.Fs=1,this.Os=1}vs(t,i,s){return this.ys=this.l,this.js=this.ys+s,this.Fs=t,this.Os=i,this.S(s)}get Us(){return _i(this.Fs,this.Os,(this.l-this.ys)/(this.js-this.ys))}p(t){this.Us<=0||(s.globalAlpha=this.Us,s.translate(~~t.x-r/2,~~t.y-a/2),s.fillStyle=this.Rs,s.fillRect(0,0,r,a),s.drawImage(this.canvas,0,0))}}class V extends d{constructor(t,i,s){super(),this.Es=t,this.Ds=i,this.Cs=s,this.bs=0,this._.push("start-prompt")}p(t){this.l/2%1<.2||(s.font="18pt Courier",s.textAlign="center",s.textBaseline="middle",s.fillStyle="#fff",s.fillText(this.Es,0,0))}m(t){super.m(t);let i=1;for(let t of this.Ds){let s=Tt[t];32===t&&(s=s||wt.length>0),i=i&&!s,s&&this.bs&&(_e(...[2,,409,,.02,.02,1,.5,-2,,-316,.05,,,137,,.43,.82,.02]),this.bs=0,this.Cs())}this.bs=i}}class $ extends d{constructor(t){super(),this.ks=t.filter(t=>t)}m(t){super.m(t);for(let i of this.ks)i.m(t)}p(t){s.translate(t.x,t.y+100),1===_R&&s.scale(2,2);for(let i of this.ks)i.p(t),s.translate(0,50)}}class j extends d{constructor(t,i){super(),this._.push("_c"),this.Ls=t,this.Es=this.Ls.join("\n"),this.As=this.Ls.reduce((t,i)=>t+i.length,0),this.Ns=i,this.Ks=0}get qs(){return this.Es.charAt(this.Hs-1)}get Hs(){return min(this.As,~~(15*this.l))}complete(){return this.T.P(()=>this.Hs>=this.As)}m(t){let{Hs:i}=this;this.Ns&&(Tt[32]||wt.length)&&(t*=8),super.m(t),i<this.Hs&&" "!==this.qs&&"\n"!==this.qs&&(this.Ys&&this.Ys.stop(),this.Ys=it(...[.2,,634,,.01,.02,3,3.3,,,,,,.1,278,,,.95,.03,,518]),this.Ys.start())}$s(t){let i=[];s.font="18pt Courier";for(let e of this.Ls){let h="",l=0,n=0;for(;n<e.length;){let r=n;for(;r<e.length&&" "!==e.charAt(r);)r++;let a=e.slice(n,r+1),o=s.measureText(a).width;r>n?o+l<t?(h+=a,l+=o):(i.push(h),h=a,l=o):(h+=a,l+=o),n=r+1}h.length&&i.push(h)}return i}p(t){s.translate(~~t.x-r/2,~~t.y-a/2),s.fillStyle="#fff",s.shadowColor="#000",s.shadowOffsetY=2,s.font="18pt Courier",s.textAlign="left",s.textBaseline="middle",this.Ks!==r&&(this.Ks=r,this.Bs=this.$s(r-100));let i=a/2-25*this.Bs.length/2,e=0;for(let t of this.Bs)e=max(s.measureText(t).width,e);let h=0;for(let t of this.Bs)s.fillText(t.slice(0,max(0,this.Hs-h)),(r-e)/2,i),i+=25,h+=t.length;this.Ns&&(s.textAlign="right",s.fillText(0===_R?"Hold [SPACE] to fast forward":"Hold to fast forward",r-50,a-50))}}class X extends d{constructor(t,i){super(),this.Ws=t,this.value=i}p(t){s.textBaseline="middle",s.fillStyle="#fff",s.font="18pt Courier",s.textAlign="right",s.fillText(this.Ws,-20,0),s.textAlign="left",s.fillText(this.value,20,0)}}class Q extends d{constructor(t){super(),this.labels=t}p(t){s.translate(~~t.x+r/2-50,~~t.y-a/2+50),s.textAlign="right",s.textBaseline="top",s.shadowColor="#000",s.shadowOffsetY=2,s.fillStyle="#fff",1===_R&&s.scale(1.5,1.5);let i=0;for(let[t,e]of this.labels())s.font="14pt Courier",s.fillText(t,0,i),i+=20,s.fillText(e,0,i),i+=30}}a_=()=>max(.1*a,150),cV=()=>{s.beginPath(),s.moveTo(a_()/4,0),s.lineTo(-a_()/4,-a_()/4),s.lineTo(-a_()/4,a_()/4),s.fill()};let Z=[[t=>t.A.left,()=>{s.rotate(PI),cV()}],[t=>t.A.right,()=>{cV()}],[t=>t.A.K,()=>{s.rotate(-PI/2),s.beginPath(),s.arc(0,0,a_()/4,0,2*PI),s.fill()}],[t=>t.A.N,()=>{s.rotate(-PI/2),cV()}]];class tt extends d{p(t){let i=o(this.T.h("u"));if(!i)return;s.translate(~~t.x-r/2,~~t.y+a/2-a_()),s.fillStyle="rgba(0,0,0,0.5)",s.fillRect(0,0,r,a_());let e=r/Z.length;for(let t=0;t<Z.length;t++){let[h,l]=Z[t];s.v(()=>{s.translate(t*e,0),h(i)&&(s.fillStyle="rgba(255,255,255,0.5)",s.fillRect(0,0,e,a_())),s.fillStyle=h(i)?"#000":"#fff",s.translate(e/2,a_()/2),l()})}}}n.v=function(t){let{Gs:i}=this;this.save(),t(),this.restore(),this.Gs=i||(t=>t)},dB=(t,i,s)=>{let e=document.createElement("canvas");return e.width=t,e.height=i,s(e.getContext("2d"),e)||e},n.slice=(t,i,e)=>{s.beginPath(),i?(s.moveTo(-t,-t),s.lineTo(t,-t)):(s.lineTo(-t,t),s.lineTo(t,t)),s.lineTo(t,-t*e),s.lineTo(-t,t*e),s.clip()},fe=(t,i,s)=>{let e=dB(t,i,s),h=e.getContext("2d").createPattern(e,"repeat");return h.width=t,h.height=i,h};let it=(...t)=>ht(nt(...t)),st=44100,et=new AudioContext,ht=(...t)=>{let i=et.createBuffer(t.length,t[0].length,st),s=et.createBufferSource();return t.map((t,s)=>i.getChannelData(s).set(t)),s.buffer=i,s.connect(et.destination),s};class lt{constructor(...t){this.Vs=t;let i=et.createBuffer(t.length,t[0].length,st);this.Dt=et.createBufferSource(),t.map((t,s)=>i.getChannelData(s).set(t)),this.Dt.buffer=i,this.Xs=et.createGain(),this.Xs.connect(et.destination),this.Dt.connect(this.Xs)}bt(t){this.Dt.playbackRate.value=t}Ct(t){this.Xs.gain.value=t}start(){this.Dt.start()}stop(){this.Dt.stop()}}let nt=(t=1,i=.05,s=220,e=0,h=0,l=.1,n=0,r=1,a=0,o=0,f=0,u=0,c=0,x=0,d=0,y=0,p=0,T=1,g=0,_=0)=>{let w,m,P=2*PI,S=a*=500*P/st/st,R=s*=(1+2*i*random()-i)*P/st,I=[],v=0,F=0,M=0,A=1,C=0,D=0,b=0;for(o*=500*P/st**3,d*=P/st,f*=P/st,u*=st,c=c*st|0,m=(e=e*st+9)+(g*=st)+(h*=st)+(l*=st)+(p*=st)|0;M<m;I[M++]=b)++D%(100*y|0)||(b=n?n>1?n>2?n>3?sin((v%P)**3):max(min(tan(v),1),-1):1-(2*v/P%2+2)%2:1-4*abs(round(v/P)-v/P):sin(v),b=(c?1-_+_*sin(P*M/c):1)*(b>0?1:-1)*abs(b)**r*t*.3*(M<e?M/e:M<e+g?1-(M-e)/g*(1-T):M<e+g+h?T:M<m-p?(m-M-p)/l*T:0),b=p?b/2+(p>M?0:(M<m-p?1:(m-M)/p)*I[M-p|0]/2):b),w=(s+=a+=o)*cos(d*F++),v+=w-w*x*(1-1e9*(sin(M)+1)%2),A&&++A>u&&(s+=f,R+=f,A=0),!c||++C%c||(s=R,a=S,A=A||1);return I};_e=(...t)=>new lt(nt(...t)).start();let rt,at=44100;function ot(t){return sin(6.283184*t)}let ft=[ot,function(t){return ot(t)<0?-1:1},function(t){return t%1-.5},function(t){let i=t%1*4;return i<2?i-1:3-i}];function ut(t){return.00390625*pow(1.059463094,t-128)}function ct(t,i){setTimeout(()=>{var s=new Uint8Array(2*t*2),e=s.length-2,h=()=>{for(var t=new Date,l=0;e>=0;)if(s[e]=0,s[e+1]=128,e-=2,(l+=1)%1e3==0&&new Date-t>33)return void setTimeout(h,0);setTimeout(()=>i(s),0)};setTimeout(h,0)},0)}function xt(t,i,s,e,h){let l=s.zs*e>>1,n=s.Js/255,r=0,a=()=>{let s=new Date,e=0;for(;r<i-l;){var o=4*r,f=4*(r+l),u=t[f]+(t[f+1]<<8)+(t[o+2]+(t[o+3]<<8)-32768)*n;if(t[f]=255&u,t[f+1]=u>>8&255,u=t[f+2]+(t[f+3]<<8)+(t[o]+(t[o+1]<<8)-32768)*n,t[f+2]=255&u,t[f+3]=u>>8&255,++r,e+=1,e%1e3==0&&new Date-s>33)return void setTimeout(a,0)}setTimeout(h,0)};setTimeout(a,0)}class dt{constructor(t){this.Zs=t,this.Qs=t.length/2/2}ti(){let t,i,s,e,h,l,n,r=this.Zs,a=2*this.Qs*2;for(h=a-8,l=h-36,e=String.fromCharCode(82,73,70,70,255&h,h>>8&255,h>>16&255,h>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&l,l>>8&255,l>>16&255,l>>24&255),t=0;t<a;){for(s="",i=0;i<256&&t<a;++i,t+=2)n=4*(r[t]+(r[t+1]<<8)-32768),n=n<-32768?-32768:n>32767?32767:n,s+=String.fromCharCode(255&n,n>>8&255);e+=s}return e}si(t){rt||(rt=new AudioContext);let i=this.Zs,s=this.Qs,e=rt.createBuffer(2,this.Qs,at),h=e.getChannelData(0),l=e.getChannelData(1),n=0,r=()=>{for(var a=new Date,o=0;n<s;){var f=4*(i[4*n]+(i[4*n+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,h[n]=f/32768,f=(f=4*(i[4*n+2]+(i[4*n+3]<<8)-32768))<-32768?-32768:f>32767?32767:f,l[n]=f/32768,n+=1,(o+=1)%1e3==0&&new Date-a>33)return void setTimeout(r,0)}setTimeout(()=>t(e),0)};setTimeout(r,0)}}class yt{constructor(t,i){this.ii=t,this.hi=i||5605,this.ei=ft[t.ri],this.ni=ft[t.oi],this.ai=ft[t.li],this.fi=t.ui,this.ci=t._i,this.release=t.wi,this.di=pow(2,t.mi-8)/this.hi,this.pi=pow(2,t.Ii-8)/this.hi}Si(t,i,s){for(var e=0,h=0,l=ut(t+12*(this.ii.Pi-8)+this.ii.xi)*(1+8e-4*this.ii.Ti),n=ut(t+12*(this.ii.gi-8)+this.ii.Mi)*(1+8e-4*this.ii.Ri),r=this.ii.yi/255,a=0,o=0,f=this.fi+this.ci+this.release-1;f>=0;--f){let t=f+s,p=this.ei(t*this.pi)*this.ii.ji/512+.5,T=1;f<this.fi?T=f/this.fi:f>=this.fi+this.ci&&(T-=(f-this.fi-this.ci)/this.release);var u=l;this.ii.Fi&&(u+=p),this.ii.Oi&&(u*=T*T),e+=u;var c=this.ni(e)*this.ii.Ui;u=n,this.ii.Ei&&(u*=T*T),h+=u,c+=this.ai(h)*this.ii.Di,this.ii.Ci&&(c+=(2*random()-1)*this.ii.Ci*T),c*=T/255;var x=this.ii.bi;this.ii.ki&&(x*=p);var d=r*(c-o)-(a+=(x=1.5*sin(3.141592*x/at))*o);switch(o+=x*d,this.ii.Li){case 1:c=d;break;case 2:c=a;break;case 3:c=o;break;case 4:c=a+d}if(u=ot(t*this.di)*this.ii.Ai/512+.5,c*=39*this.ii.Ni,t*=4,t+3<i.length){var y=i[t]+(i[t+1]<<8)+c*(1-u);i[t]=255&y,i[t+1]=y>>8&255,y=i[t+2]+(i[t+3]<<8)+c*u,i[t+2]=255&y,i[t+3]=y>>8&255}}}Ki(t,i){this.qi(t,t=>{t.si(i)})}qi(t,i){var s=this.fi+this.ci+this.release-1+32*this.hi,e=this;ct(s,h=>{e.Si(t,h,0),xt(h,s,e.ii,e.hi,function(){i(new dt(h))})})}}class pt{constructor(t){this.Hi=t,this.Qs=at*t.Yi}$i(t,i,s){ct(this.Qs,e=>{var h=this.Qs,l=2*this.Qs*2,n=this.Hi.hi,r=this.Hi.ex,a=new yt(t,n);let o=0,f=0,u=0,c=()=>{for(var i=new Date;;)if(32!==u){if(f===r-1)return void setTimeout(x,0);var s=t.Bi[f];if(s){var h=t.c[s-1].n[u];h&&a.Si(h,e,o)}if(o+=n,u+=1,new Date-i>33)return void setTimeout(c,0)}else u=0,f+=1},x=()=>xt(e,h,t,n,y);var d=0;let y=()=>{let t=new Date,h=0;for(;d<l;){var n=i[d]+(i[d+1]<<8)+e[d]+(e[d+1]<<8)-32768;if(i[d]=255&n,i[d+1]=n>>8&255,d+=2,h+=1,h%1e3==0&&new Date-t>33)return void setTimeout(y,0)}setTimeout(s,0)};setTimeout(c,0)})}qi(t){ct(this.Qs,i=>{let s=0,e=()=>{s<this.Hi.Wi.length?(s+=1,this.$i(this.Hi.Wi[s-1],i,e)):t(new dt(i))};e()})}Ki(t){this.qi(i=>i.si(t))}}gE={hi:7350,ex:11,Wi:[{Pi:4,xi:0,Ti:0,Oi:0,Ui:192,oi:3,gi:4,Mi:0,Ri:7,Ei:0,Di:201,li:3,Ci:0,ui:789,_i:1234,wi:13636,Ni:191,Li:2,bi:5839,yi:254,zs:6,Js:121,mi:6,Ai:147,Fi:0,ki:1,Ii:6,ji:195,ri:0,Bi:[2,3,2,2,2,3,2,3,4,5],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[161,0,0,0,161,0,0,0,164,0,0,0,163,0,0,0,161,0,0,0,168,0,0,0,166,0,0,0,164,0,0,0]},{n:[168,0,0,0,166,0,0,0,164,0,0,0,163,0,0,0,161,0,0,0,161,0,0,0,163,0,0,0,164,0,0,0]},{n:[164,0,0,0,163,0,0,0,161,0,0,0,161,0,0,0,166,0,0,0,164,0,0,0,163,0,0,0,163,0,0,0]},{n:[168,0,0,0,166,0,0,0,164,0,0,0,164,0,0,0,163,0,0,0,163,0,0,0,168,0,0,0,166,0,0,0]}]},{Pi:7,xi:0,Ti:0,Oi:1,Ui:128,oi:0,gi:7,Mi:0,Ri:0,Ei:1,Di:128,li:0,Ci:255,ui:100,_i:0,wi:3636,Ni:59,Li:2,bi:500,yi:254,zs:0,Js:27,mi:0,Ai:0,Fi:0,ki:0,Ii:0,ji:0,ri:0,Bi:[2,2,2,2,2,2,2,2,2,2],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[137,0,0,0,137,0,0,0,135,0,0,0,135,0,0,0,134,0,0,0,132,0,0,0,132,0,0,0,132,0,0,0]}]},{Pi:8,xi:0,Ti:0,Oi:0,Ui:0,oi:0,gi:8,Mi:0,Ri:0,Ei:0,Di:0,li:0,Ci:60,ui:50,_i:419,wi:4607,Ni:130,Li:1,bi:10332,yi:120,zs:4,Js:16,mi:5,Ai:108,Fi:0,ki:0,Ii:5,ji:187,ri:0,Bi:[0,0,2,2,0,0,2,2,2,2],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[111,0,0,0,120,0,0,0,111,0,0,0,120,0,0,0,111,0,0,0,120,0,0,0,111,0,0,0,120,0,0,0]}]}],Yi:50},es=()=>new pt(gE).Ki(t=>{let i=rt.createBufferSource();i.buffer=t,i.loop=1;let s=rt.createGain();s.gain.value=bM,s.connect(rt.destination),i.connect(s),i.start(),es=()=>0,er=t=>{bM=t,s.gain.value=t}}),bM=.5,er=t=>bM=t;let Tt={};onkeydown=t=>Tt[t.keyCode]=1,onkeyup=t=>Tt[t.keyCode]=0,onblur=onfocus=()=>{Tt={},iD=iC=0};let _t={x:0,y:0,q:0};onmousemove=t=>{eq(t,i,_t)},onmousedown=t=>{_t.q=1},onmouseup=t=>{_t.q=0},oncontextmenu=t=>t.preventDefault(),eq=(t,i,s)=>{if(!i)return;let e=i.getBoundingClientRect();s.x=(t.pageX-e.left)/e.width*i.width,s.y=(t.pageY-e.top)/e.height*i.height};let wt=[];cG=t=>{_R=1,wt=[],t.preventDefault(),t.stopPropagation();for(let s of t.touches)wt.push({}),eq(s,i,wt[wt.length-1])},ontouchstart=cG,ontouchmove=cG,ontouchend=cG,ay=[eo=["EASY",1,.5,.5,.5,6,6],en=["NORMAL",0,1,1,1,4,3],iB=["HARD",0,3,999,1,4,3]],em=(t,[i,s,e,h,l,n,r])=>{let a=o(t.h("u"));a&&(a.W=s,a.ct=e,a.Y=h,a.et=l);for(let i of t.h("T"))i.Y=n;for(let i of t.h("enemy-_w"))i.Y=r};class mt{constructor(){this.T=new y,this.l=0;let t=parseInt(localStorage.df);this.Gi=t>=0?ay[t]:1==_R?eo:en,(async()=>{for(;;)await this.Vi()})()}Xi(){let t=ay.indexOf(this.Gi);t=(t-1+ay.length)%ay.length,this.Gi=ay[t],localStorage.df=t;for(let t of this.T.h("_c"))t.T.F(t);this.zi||(async()=>{let t=new j(["DIFFICULTY: "+this.Gi[0]]);this.T.add(t),await t.complete(),await t.S(2),t.T.F(t)})()}Ji(t){let i=()=>t?"DIFFICULTY: "+this.Gi[0]+" - PRESS [K] TO CHANGE":"",s=new V(i(),[75],()=>{this.Xi(),this.T&&em(this.T,this.Gi),s.Es=i()});return s}async Zi(){this.zi=new y;let t=new B;this.zi.add(t),await t.S(.3),this.paused=1,this.T.I();let i=new K("MISSION\nFAILED","#f00");this.zi.add(i),i.vs(0,1,.2),await i.S(1);let s=new B;this.zi.add(s),await s.S(.3),this.paused=0,this.zi=0}async Qi(){this.zi=new y;let t=new B;this.zi.add(t),await t.S(.3),this.paused=1,this.T.I();let i=new K("MISSION\nSUCCESS","#fff");this.zi.add(i),i.vs(0,1,.2),await i.S(1);let s=new B;this.zi.add(s),await s.S(.3),this.paused=0,this.zi=0}async th(){this.paused=1,this.zi=new y;let t=new K("SQUAD 13"),i=new $([new V(1===_R?"TAP TO DEPLOY":"PRESS [SPACE] TO DEPLOY",[32],()=>{i.T.F(i)}),1!=_R?this.Ji(1):0,1!=_R?this.sh(1):0]);this.zi.add(t,i,new G),await i.M(),this.paused=0,await t.vs(1,0,1,.3),this.zi=0}sh(t){let i=()=>t?"MUSIC: "+(bM>0?"ON":"OFF")+" - PRESS [M] TO "+(bM>0?"MUTE":"UNMUTE"):"",s=new V(i(),[77],()=>{er(bM>0?0:.5),s.Es=i()});return s}pause(){if(this.zi)return;this.T.I(),this.paused=1,this.zi=new y;let t=new K("PAUSED","rgba(0,0,0,0)","rgba(0,0,0,0.95)"),i=new $([new V("PRESS [SPACE] TO RESUME",[32,27,80],()=>{i.T.F(i)}),this.Ji(1),this.sh(1)]);this.zi.add(t,i),(async()=>{await i.M(),this.zi=0,this.paused=0,Tt={}})()}async Vi(){let t=[gx,gw,gv,gu,gt,gs,gr,gq,gp,gn,gm,gl,gk],i=0,s=0,e=this.l,h=this.l,l=0,n=9,r=0,a=0,f=t.reduce((t,i)=>{let s=new y;return i(s),t+Array.from(s.h("R")).length},0),u=0;for(;i<t.length;){this.T&&this.T.I(),this.T=new y,this.T.add(this.Ji(0)),this.T.add(this.sh(0));let f=9,c=t[i];try{let l=[gh,gg,gf],r=l[~~(i/2)%l.length];this.T.add(...r());let x=c(this.T);em(this.T,this.Gi);let d=o(this.T.h("m"));d.m(2);let y=Array.from(this.T.h("R")).length;0==s++?(await this.th(),e=this.l,e=this.l,es()):this.T.add(new G),0===a&&(h=this.l,i>0&&(async()=>{await d.S(1);let t=new j([fS[i%fS.length],fT[i%fT.length]+" "+(1+7*i%27)+", "+(2017+~~(i/2))]);this.T.add(t),await t.complete(),await t.S(2),t.T.F(t)})()),this.T.add(new V("",[27,80],()=>{this.pause()})),this.T.add(new Q(()=>{let s=o(this.T.h("u"));return[["MISSION",`${i+1}/${t.length}`],["PRISONERS",(s?s.vt:0)+"/"+y],["TIME",cn(this.l-h)],["OVERALL",cn(this.l-e)],["DIFFICULTY [K]",this.Gi[0]]]})),this.T.P(()=>{f=min(f,ay.indexOf(this.Gi))}),1===_R&&this.T.add(new tt),await x,a=0,n=min(n,f);let p=o(this.T.h("u"));p&&(u+=p.vt),0===i?await this.ih():await this.Qi(),i++}catch(t){l++,a++,console.log(t),await new Promise(t=>setTimeout(t,250)),await this.Zi(),a%5!=0||this.Gi!==en||r||(r=1,confirm("Enable easy mode? (simplified physics, less aggressive enemies)")&&(this.Gi=eo))}}this.T.I(),await this.hh([["TOTAL TIME",cn(this.l-e)],["DIFFICULTY",ay[n][0]],["RESCUED PRISONERS",`${u}/${f}`],["CRASHES",`${l}`],["",""]],["I finished SQUAD 13 in ",cn(this.l-e)," after crashing ",l," times and rescued ",u,"/",f," prisoners! (",ay[n][0]," mode)"].join(""))}async ih(){this.zi=new y;let t=new B;this.zi.add(t),await t.S(.3),this.paused=1,this.T.I();{this.zi=new y;let t=new j(["When all hope is lost, the World Police Organization sends SQUAD 13."," ".repeat(10),"They are tasked with the most dangerous missions."],1);this.zi.add(new C("#000","#000"),t),await t.complete(),await t.S(1)}{this.zi=new y;let t=new j(["SQUAD 13 is feared even by the most wicked evil terrorists."," ".repeat(10),"This is their story."],1);this.zi.add(new C("#000","#000"),t),await t.complete(),await t.S(1)}this.paused=0,this.zi=0}async hh(t,i){this.zi=new y,this.paused=1;let s=new q(1);this.zi.add(s),await s.S(.3);let e=new K("THX FOR PLAYING","#fff"),h=new $([...t.map(([t,i])=>new X(t,i)),new V(1===_R?"TAP TO REDEPLOY":"PRESS [SPACE] TO REDEPLOY",[32],()=>h.T.F(h)),1!=_R?new V("PRESS [T] TO TWEET YOUR SCORE",[84],()=>fZ(i)):0]);this.zi.add(e,h),await h.M(),this.paused=0,this.zi=0}m(t){performance.now(),this.l+=t,this.zi&&this.paused||this.T.m(min(t,1/30)),this.T.p(),this.zi&&(this.zi.m(t),this.zi.p()),performance.now()}}gh=()=>[new C("#f22f00","#fa7f02"),new D("#faf857"),new E("#fa7f02")],gg=()=>[new C("#51ccfc","#c2e9fc"),new D("#faf857"),new E("#c2e9fc")],gf=()=>[new C("#092644","#01010a"),new b,new D("#fff"),new E("#092644"),new O,new m],_M=(t,i,s=100)=>{eb(t,i,s,200);let e=new _;e.x=i,e.y=s-20,t.add(e);let h=o(t.h("m"));return h.Pt=min(h.Pt,i-300),e},_L=(t,i,s=100)=>{eb(t,i,s,200);let e=new S;return e.x=i,e.y=100,t.add(e),o(t.h("m")).xt=i+500,e},_D=t=>{let i=o(t.h("u")),s=o(t.h("landing-area"));return Promise.race([i.yt(),s.Z(i)])},T=(t,i)=>{let s=new N;s.x=i,t.add(s);for(let i of t.h("K")){if(i.qt<0)continue;if(!_v(i.Pt,s.x,i.xt))continue;let t=i.Yt(s.x);s.y=t-s.D}},_F=(t,i)=>{let s=new w;s.x=i[0].x,s.y=i[0].y,s.Nt(i),t.add(s)},R=(t,i)=>{let s=new H;s.x=i,t.add(s);for(let i of t.h("K"))if(!(i.qt<0)&&_v(i.Pt,s.x,i.xt)){if(0===i.Yt(s.x))throw new Error("aa is 0");s.y=i.Yt(s.x)-s.D}},_C=(t,i)=>{let s=o(t.h("m"));t.add(new I(i)),s.Mt=max(s.Mt,i+300)},eb=(t,i,s,e=100)=>{let h=new P;h.points=[{x:i-e,y:s+2e3},{x:i-e/2-50,y:s-10},{x:i-e/2,y:s},{x:i+e/2,y:s},{x:i+e/2+50,y:s-10},{x:i+e,y:s+2e3}],t.add(h);let l=o(t.h("m"));l.gt=min(l.gt,s-a/2-200)},ea=(t,i,s,e,h,l,n)=>{let r=e-s,a=l-h;for(let t=s;t<=e;t+=100)i.push({x:t,y:h+a/2+sin(t/r*PI*2*n)*a/2+sin(t/r*PI*2*n*4)*a/4});let f=o(t.h("m"));f.gt=min(f.gt,h-200,l-200),f.Mt=max(f.Mt,h+300,l+300)},M=(t,i,s,e,h,l=1)=>{let n=new P;n.points.push({x:i-100,y:h+2e3}),ea(t,n.points,i,s,e,h,l),n.points.push({x:s+100,y:h+2e3}),t.add(n)},U=(t,i,s,e,h,l=1)=>{let n=new P;n.qt=-1,n.points.push({x:i-100,y:h-2e3}),ea(t,n.points,i,s,e,h,l),n.points.push({x:s+100,y:h-2e3}),t.add(n)},gx=t=>{let i=_M(t,0);_L(t,1e3),_C(t,400);let s=new W("");s.y=-200,t.add(s);let e=new W("");e.x=500,e.y=-200,t.add(e);let h=new W("");return h.x=1e3,h.y=-200,t.add(h),t.P(()=>{let t=abs(i.x-1e3)<200,l=!t&&dU(i.x,i.y,0,100)>200,n=!t&&!l;s.gs=n?"HOLD [UP] TO FLY":"",e.gs=l?"HOLD [LEFT/RIGHT] TO TILT":"",h.gs=t&&!i.W?"HOLD [DOWN] TO DESCEND FASTER":""}),_D(t)},gw=t=>(_M(t,0),M(t,500,2500,-200,200,1),U(t,2700,3500,-400,-300,2),_L(t,3e3),_C(t,400),_D(t)),gv=t=>{_M(t,0),M(t,500,2500,-200,200,1),U(t,3e3,5500,-200,100,1),M(t,4e3,5e3,100,300,.5),M(t,5700,6e3,200,300,.5),_L(t,6500),_C(t,400);let i=new W("PRISONERS CAN BE RESCUED");return i.x=500,i.y=-200,t.add(i),R(t,1e3),R(t,2400),R(t,4500),_D(t)},gu=t=>{let i=_M(t,0);M(t,500,2500,-150,100,1.5),M(t,2700,3e3,0,200,2),U(t,2e3,3e3,-500,-350,2),M(t,3700,3950,400,300,.5),_L(t,3500),_C(t,400);for(let i of[800,850,1500,2300])T(t,i);R(t,2e3),R(t,3800);let s=new W(1===_R?"TAP CIRCLE TO SHOOT":"PRESS [SPACE] TO SHOOT");return s.x=500,s.y=-200,t.add(s),t.P(()=>{s.gs=i.Y<9?"PRESS [SPACE] TO SHOOT":"NO MISSILES ON HARD MODE"}),_D(t)},gt=t=>{_M(t,0),M(t,500,2e3,-200,200,.5),U(t,400,1500,-500,-200,.5),U(t,2500,3500,-600,0,1),M(t,2300,2700,200,300,.5),U(t,3700,4200,-300,-450,2),_L(t,4e3),_C(t,400);for(let i of[650,1200,1750,1850,2650])T(t,i);return R(t,950),R(t,1350),R(t,2350),_D(t)},gs=t=>{_M(t,0),U(t,500,1500,-200,100,.5),M(t,900,1500,300,400,1),M(t,1800,2200,50,150,1),M(t,2300,2800,300,350,2),U(t,2500,4e3,-200,100,1),M(t,3800,4200,250,350,3),_L(t,4500),_C(t,400);for(let i of[1450,2050,2650,4050])T(t,i);return R(t,1050),R(t,2450),R(t,4150),_F(t,[{x:1800,y:-300},{x:2200,y:-200}]),_D(t)},gq=t=>{_M(t,0),U(t,-200,600,-300,-400,2.2),M(t,500,4500,-200,200,2),U(t,800,1100,-300,-400,4),U(t,2500,3500,-600,-200,.5),M(t,4700,5200,200,400,1),U(t,4e3,4300,-600,-200,.5),U(t,5500,6e3,-400,0,.5),_L(t,5500),_C(t,400);for(let i of[1e3,1900,2050,2500,3e3,3500,4400,4200])T(t,i);return R(t,1150),R(t,4750),_D(t)},gm=t=>{_M(t,0),M(t,500,1e3,0,200,2),U(t,900,1500,-400,-500,2),M(t,1500,2e3,-200,0,1.5),U(t,1800,2600,-400,-500,2.5),M(t,2500,3500,-200,200,3),M(t,2050,2350,250,350,1.2),U(t,3e3,4e3,-400,-550,4),U(t,3800,4500,-300,-450,4),_L(t,4e3),_C(t,400);for(let i of[850,1600,1850,2580,2880,3350,3450])T(t,i);return _F(t,[{x:950,y:-150},{x:1250,y:-50}]),R(t,650),R(t,2150),_D(t)},gl=t=>(_M(t,0,0),M(t,500,2500,-300,0,1),U(t,2700,3800,-400,0,2),M(t,2900,3450,400,300,1),M(t,3800,4500,-200,200,1),U(t,4500,5500,-600,-200,2),_L(t,5e3),_C(t,400),_F(t,[{x:2e3,y:-500},{x:1200,y:-600}]),T(t,4050),T(t,4150),T(t,4250),R(t,1750),R(t,3250),_D(t)),gk=t=>{_M(t,0),M(t,500,1e3,0,200,2),U(t,900,1500,-500,-300,2),M(t,1400,2500,-150,200,2),U(t,2400,3500,-400,-200,2),M(t,2800,4e3,-50,200,1.5),_L(t,4500),_C(t,400);for(let i of[850,1600,1850,2600,2900,3350,3450,3900])T(t,i);return R(t,1950),R(t,3550),_D(t)},gr=t=>(_M(t,0),M(t,500,1e3,-400,200,1),U(t,2e3,3400,-200,150,1),M(t,2400,2700,280,350,.5),M(t,1200,1500,200,250,.5),M(t,3750,4100,300,350,.5),U(t,4300,4600,-300,-550,1),_L(t,4500),R(t,1450),R(t,3800),T(t,750),T(t,2450),_F(t,[{x:1700,y:-200},{x:1500,y:100}]),_F(t,[{x:3800,y:-200},{x:4200,y:200}]),_C(t,400),_D(t)),gp=t=>(_M(t,0),U(t,500,1e3,0,150,1),M(t,550,1200,400,550,1),U(t,1200,1700,-400,-500,.7),M(t,1500,2300,0,250,.5),U(t,2e3,2450,-300,-200,1),U(t,2700,3150,-50,50,1),M(t,2900,3400,600,550,1.2),M(t,3500,4e3,-200,-300,1.2),U(t,3750,4e3,-500,-600,.8),_L(t,4500),T(t,950),T(t,1550),T(t,2250),T(t,2200),T(t,3e3),T(t,3850),R(t,1850),R(t,3250),_F(t,[{x:2900,y:150},{x:2600,y:250}]),_F(t,[{x:4650,y:-350},{x:4400,y:-150}]),_C(t,600),_D(t)),gn=t=>(_M(t,0),M(t,500,1500,-200,0,1),U(t,450,1500,-600,-400,1),_F(t,[{x:1800,y:-300},{x:1800,y:200}]),_F(t,[{x:5150,y:-250},{x:5500,y:-350}]),M(t,1750,2150,400,300,1),U(t,2650,3400,300,200,1),U(t,1750,2800,-750,-450,4),M(t,2250,2500,500,450,.5),M(t,3100,3250,550,560,1),M(t,3550,4150,500,0,1),U(t,3600,4200,-300,-500,.8),U(t,4400,5e3,-400,-600,.8),M(t,4400,4950,-200,-100,.7),M(t,5600,5900,500,550,.7),_L(t,5500),R(t,3150),R(t,4100),R(t,5800),T(t,710),T(t,1150),T(t,1800),T(t,2430),T(t,3700),T(t,3900),T(t,4550),T(t,4900),_C(t,600),_D(t)),fZ=t=>{open("//twitter.com/intent/tweet?hashtags=js13k&url="+location+"&text="+encodeURIComponent(t))},onload=()=>{i=document.querySelector("canvas"),i.width=r,i.height=a,s=i.getContext("2d"),onresize(),e=new mt,e$()},e$=()=>{let t=performance.now(),i=(t-h)/1e3;h=t,e.m(i),requestAnimationFrame(e$)}</script>