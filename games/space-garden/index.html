<title>Space Garden - js13kGames 2021</title><style>section{width:100%;height:100%;border:1px solid #2d2d2d;display:flex;justify-content:center;align-items:center}canvas{display:inline-block;height:100%;width:100%;image-rendering:pixelated;image-rendering:crisp-edges;background-color:#000}</style><section id=game></section><script>!function(){var e=function(t,e,i,s){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=s,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=23,this.cursorColor2=25,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.brightness=[];for(let t=0;6>t;t++)for(let e=0;64>e;e++)this.brightness[64*t+e]=this.colors.indexOf(this.atlas[64*t+e]);return this.clear=function(t,e){this.ram.fill(t,e,e+this.PAGESIZE)},this};e.prototype.setPen=function(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i},e.prototype.pset=function(t,e,i,s=64){t|=0,e|=0,i=this.stencil?this.pget(t,e,this.stencilSource)+this.stencilOffset:(0|i)%64;let a=this.pat&Math.pow(2,e%4*4+t%4)?i:s;64!=a&&(0>t|t>this.WIDTH-1||0>e|e>this.HEIGHT-1||(this.ram[this.renderTarget+e*this.WIDTH+t]=a))},e.prototype.pget=function(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]},e.prototype.line=function(t,e,i,s,a){var r,h,n=(s|=0)-(e|=0),o=(i|=0)-(t|=0);if(0>n?(n=-n,h=-1):h=1,0>o?(o=-o,r=-1):r=1,n<<=1,o<<=1,this.pset(t,e,a),o>n)for(var l=n-(o>>1);t!=i;)0>l||(e+=h,l-=o),l+=n,this.pset(t+=r,e,a);else for(l=o-(n>>1);e!=s;)0>l||(t+=r,l-=n),l+=o,this.pset(t,e+=h,a)},e.prototype.tline=function(t,e,i,s,a=0,r=0,h=0){var n,o,l=(s|=0)-(e|=0),d=(i|=0)-(t|=0);0>l?(l=-l,o=-1):o=1,0>d?(d=-d,n=-1):n=1;for(var p=t,u=e,c=(l<<=1)-((d<<=1)>>1);p!=i;)0>c||(u+=o,c-=d),c+=l,this.pset(p+=n,u,this.pget(p-a,u-r,this.renderSource)+h)},e.prototype.circle=function(t,e,i,s){t|=0,e|=0,s|=0;var a=-(i|=0),r=0,h=2-2*i;do{this.pset(t-a,e+r,s),this.pset(t-r,e-a,s),this.pset(t+a,e-r,s),this.pset(t+r,e+a,s),(i=h)>r||(h+=2*++r+1),(i>a||h>r)&&(h+=2*++a+1)}while(0>a)},e.prototype.fillCircle=function(t,e,i,s){if(t|=0,e|=0,s|=0,(i|=0)>=0){t|=0,e|=0;var a=-(i|=0),r=0,h=2-2*i;do{this.line(t-a,e-r,t+a,e-r,s),this.line(t-a,e+r,t+a,e+r,s),(i=h)>r||(h+=2*++r+1),(i>a||h>r)&&(h+=2*++a+1)}while(0>a)}},e.prototype.tfillCircle=function(t,e,i,s=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var a=-(i|=0),r=0,h=2-2*i;do{this.tline(t-a,e-r,t+a,e-r,offX,offY,s),this.tline(t-a,e+r,t+a,e+r,offX,offY,s),(i=h)>r||(h+=2*++r+1),(i>a||h>r)&&(h+=2*++a+1)}while(0>a)}},e.prototype.rect=function(t,e,i,s,a){let r=0|t,h=0|e,n=t+i|0,o=e+s|0;this.line(r,h,n,h,a|=this.cursorColor),this.line(n,h,n,o,a),this.line(r,o,n,o,a),this.line(r,h,r,o,a)},e.prototype.fillRect=function(t,e,i,s,a){let r=0|t,h=0|e,n=(t+i|0)-1,o=(e+s|0)-1;var l=Math.abs(o-h);if(this.line(r,h,n,h,a),l>0)for(;--l;)this.line(r,h+l,n,h+l,a);this.line(r,o,n,o,a)},e.prototype.sspr=function(t=0,e=0,i=16,s=16,a=0,r=0,h=32,n=32,o=!1,l=!1){var d=i/h,p=s/n;this.pat=this.dither[0];for(var u=0;n>u;u++)for(var c=0;h>c;c++)px=c*d|0,py=u*p|0,e=l?s-py-u:e,t=o?i-px-c:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(a+c,r+u,source)},e.prototype.outline=function(t,e,i,s,a,r){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let h=t-1+e*this.WIDTH,n=t+1+e*this.WIDTH,o=t+(e+1)*this.WIDTH,l=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=i),64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=a),64==this.ram[this.renderSource+l]&&(this.ram[this.renderTarget+l]=s),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=r))}},e.prototype.triangle=function(t,e,i,s){this.line(t.x,t.y,e.x,e.y,s),this.line(e.x,e.y,i.x,i.y,s),this.line(i.x,i.y,t.x,t.y,s)},e.prototype.fillTriangle=function(t,e,i,s){let a=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),r=a[0],h=a[1],n=a[2],o=0,l=0,d=0,p={},u={};if(h.y-r.y>0&&(o=(h.x-r.x)/(h.y-r.y)),n.y-r.y>0&&(l=(n.x-r.x)/(n.y-r.y)),n.y-h.y>0&&(d=(n.x-h.x)/(n.y-h.y)),Object.assign(p,r),Object.assign(u,r),o>l){for(;h.y>=p.y;p.y++,u.y++,p.x+=l,u.x+=o)this.line(p.x,p.y,u.x,p.y,s);for(u=h;n.y>=p.y;p.y++,u.y++,p.x+=l,u.x+=d)this.line(p.x,p.y,u.x,p.y,s)}else{for(;h.y>=p.y;p.y++,u.y++,p.x+=o,u.x+=l)this.line(p.x,p.y,u.x,p.y,s);for(p=h;n.y>=p.y;p.y++,u.y++,p.x+=d,u.x+=l)this.line(p.x,p.y,u.x,p.y,s)}},e.prototype.imageToRam=(t,e)=>{let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let s=i.getContext("2d");s.drawImage(t,0,0);var a=s.getImageData(0,0,WIDTH,HEIGHT);let r=new Uint32Array(a.data.buffer);for(var h=0;r.length>h;h++)ram[e+h]=colors.indexOf(r[h])},e.prototype.render=function(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)},e.prototype.textLine=function(t){for(var e=t[0].length,i=0;e>i;i++){var s;s=this.getCharacter(t[0].charAt(i));for(var a=0;5>a;a++)for(var r=0;5>r;r++)1==s[5*a+r]&&(1==t[4]?this.pset(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[5]):this.fillRect(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[4],t[4],t[5]))}},e.prototype.text=function(t){var e=5*t[7],i=t[0].split("\n"),s=i.slice(0),a=i.length,r=s.sort((t,e)=>e.length-t.length)[0],h=r.length*e+(r.length-1)*t[3],n=a*e+(a-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var o=t[1],l=t[2],d=t[1]+h,p=t[2]+n;"center"==t[5]?(o=t[1]-h/2,d=t[1]+h/2):"right"==t[5]&&(o=t[1]-h,d=t[1]),"center"==t[6]?(l=t[2]-n/2,p=t[2]+n/2):"bottom"==t[6]&&(l=t[2]-n,p=t[2]);for(var u=o+h/2,c=l+n/2,y=0;a>y;y++){var f=i[y],x=f.length*e+(f.length-1)*t[3],m=t[1],g=t[2]+(e+t[4])*y;"center"==t[5]?m=t[1]-x/2:"right"==t[5]&&(m=t[1]-x),"center"==t[6]?g-=n/2:"bottom"==t[6]&&(g-=n),this.textLine([f,m,g,t[3],t[7],t[8]])}return{sx:o,sy:l,cx:u,cy:c,ex:d,ey:p,width:h,height:n}},e.prototype.getCharacter=function(t){return index=this.fontString.indexOf(t),this.fontBitmap.substring(25*index,25*index+25).split("")};var i=function(){var t,e,i,s,a,r=t=>Math.sin(6.283184*t),h=t=>.003959503758*2**((t-128)/12),n=(t,e,i)=>{var s,a,r,n,l,d,p=o[t.i[0]],u=t.i[1],c=t.i[3]/32,y=o[t.i[4]],f=t.i[5],x=t.i[8]/32,m=t.i[9],g=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,M=1/v,E=-t.i[13]/16,T=t.i[14],A=i*2**(2-t.i[15]),b=new Int32Array(g+w+v),S=0,P=0;for(s=0,a=0;g+w+v>s;s++,a++)0>a||(a-=A,l=h(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),d=h(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,g>s?r=s/g:g+w>s||(r=(1-(r=(s-g-w)*M))*3**(E*r)),n=p(S+=l*r**c)*u,n+=y(P+=d*r**x)*f,m&&(n+=(2*Math.random()-1)*m),b[s]=80*n*r|0;return b},o=[r,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=r=>{t=r,i=0,s=r.rowLen*r.patternLen*((e=r.endPattern)+1)*2,a=new Int32Array(s)},this.generate=()=>{var h,l,d,p,u,c,y,f,x,m,g,w,v,M,E=new Int32Array(s),T=t.songData[i],A=t.rowLen,b=t.patternLen,S=0,P=0,C=!1,I=[];for(d=0;e>=d;++d)for(y=T.p[d],p=0;b>p;++p){var R=y?T.c[y-1].f[p]:0;R&&(T.i[R-1]=T.c[y-1].f[p+b]||0,17>R&&(I=[]));var D=o[T.i[16]],G=T.i[17]/512,V=2**(T.i[18]-9)/A,L=T.i[19],H=T.i[20],N=135.82764118168*T.i[21]/44100,W=1-T.i[22]/255,O=1e-5*T.i[23],k=T.i[24]/32,F=T.i[25]/512,Y=6.283184*2**(T.i[26]-9)/A,U=T.i[27]/255,j=T.i[28]*A&-2;for(g=(d*b+p)*A,u=0;4>u;++u)if(c=y?T.c[y-1].n[p+u*b]:0){I[c]||(I[c]=n(T,c,A));var X=I[c];for(l=0,h=2*g;X.length>l;l++,h+=2)E[h]+=X[l]}for(l=0;A>l;l++)(m=E[f=2*(g+l)])||C?(w=N,L&&(w*=D(V*f)*G+.5),P+=(w=1.5*Math.sin(w))*(v=W*(m-P)-(S+=w*P)),m=3==H?P:1==H?v:S,O&&(m=1>(m*=O)?m>-1?r(.25*m):-1:1,m/=O),C=(m*=k)*m>1e-5,M=m*(1-(x=Math.sin(Y*f)*F+.5)),m*=x):M=0,j>f||(M+=E[f-j+1]*U,m+=E[f-j]*U),E[f]=0|M,E[f+1]=0|m,a[f]+=0|M,a[f+1]+=0|m}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,s/2,44100),i=0;2>i;i++)for(var r=e.getChannelData(i),h=i;s>h;h+=2)r[h>>1]=a[h]/65536;return e},this.createWave=()=>{var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,h=44;s>r;++r){var n=a[r];i[h++]=255&(n=-32767>n?-32767:n>32767?32767:n),i[h++]=n>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),s=Array(e),r=0;2*e>r;r+=1){var h=i+r;s[r]=t>0&&a.length>h?a[h]/32768:0}return s}},s={songData:[{i:[0,192,128,0,0,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,0,16,0,16,170,6,25,6],p:[1,2,1,2,1,2,1,2,1,1],c:[{n:[123,,,,,,135,,,,,,,,133,,,,133,,,,133,,,,130,,133,,135],f:[]},{n:[123,,,,,,135,,,,,,,,133],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,1,,1,1,1,1,1,1],c:[{n:[135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[]}]},{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[,,,,1,2,1,2,3,4],c:[{n:[,,,,130,,,,,,130,,,,,,,,128,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,133],f:[]},{n:[,,,,123,,,,,,123,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,123,,,,,,130,,,,,,,,123,,,,,,,,,,,,,,,,,,127,,,,,,127,,,,,,,,128],f:[]},{n:[,,,,130,,,,,,130,,,,,,,,130,,,,,,,,,,,,,,,,,,135,,,,,,135,,,,,,,,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:3},a={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},n={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1},o={songData:[{i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,0,0,0,2,14,47,0,32,4,5,24,2],p:[1],c:[{n:[135,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,147,149,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152,151,152],f:[]}]}],rowLen:2756,patternLen:32,endPattern:0,numChannels:1},l={songData:[{i:[0,255,116,64,0,255,108,2,64,182,4,6,154,0,0,0,0,0,0,0,2,14,33,10,68,0,0,0,0],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},d={songData:[{i:[0,0,140,0,0,0,140,0,0,255,0,255,255,19,0,0,0,0,0,0,3,3,57,20,59,0,0,157,2],p:[1],c:[{n:[123,,,,,111,,,,111,,,,,,,135,,,,,,,,,111,,,,123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139,,,,,,,,137,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,140,,,,,,111,,,,,,,,,,139,,,,111,,,,,,111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142,,,,,,,111,,,,140,,,,,,,,,,,,,111,,,139],f:[]}]}],rowLen:5513,patternLen:64,endPattern:0,numChannels:1},u={songData:[{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[1],c:[{n:[163,159,161,166],f:[]}]}],rowLen:5011,patternLen:12,endPattern:0,numChannels:1},c={songData:[{i:[0,255,116,60,0,255,116,0,104,0,0,6,125,52,0,0,0,0,0,0,2,48,0,0,35,0,0,57,2],p:[1],c:[{n:[159],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},f={songData:[{i:[0,255,116,9,0,255,116,0,5,0,4,6,68,52,0,0,0,0,0,0,2,14,0,0,32,0,0,52,2],p:[1],c:[{n:[171,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,175],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},m={songData:[{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,43,4],p:[1],c:[{n:[159,156],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},g={songData:[{i:[3,146,140,0,1,224,128,3,0,0,92,0,44,0,0,0,3,179,5,1,2,124,135,11,32,150,3,125,6],p:[1],c:[{n:[99,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,100],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},v={songData:[{i:[3,146,140,0,1,224,128,3,0,0,60,0,49,0,0,0,3,179,5,1,2,124,135,11,32,150,3,125,3],p:[1],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,121],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};function M(t){return t[(e=t.length-1,Math.floor(Math.random()*(e+1-0)+0))];var e}function E(t,e,i){return t+(e-t)*i}function T(t,e){for(var i=0;i<planets.length;i++){var s=planets[i],a=t.x-s.x,r=t.y-s.y;if(t.field+s.field+e>=Math.sqrt(a*a+r*r))return!0}return!(t.x+t.field<Ww&&t.x-t.field>0&&t.y+t.field<Wh&&t.y-t.field>0)}function A(t,e=0){return t.x-view.x+e>0&&t.y-view.y+e>0&&t.x-view.x-e<w&&t.y-view.y-e<h}function b(t,e=1,i=0,s=.5,a=!1){var r=window.audioCtx.createBufferSource(),h=window.audioCtx.createGain(),n=window.audioCtx.createStereoPanner();return r.buffer=t,r.connect(n),n.connect(h),h.connect(audioMaster),r.playbackRate.value=e,r.loop=a,h.gain.value=s,n.pan.value=i,r.start(),{volume:h,sound:r}}const S={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};function P(t,e,i,s){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=s}P.prototype.draw=function(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]},P.prototype.update=function(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)},Player={x:0,y:0,radius:10,color:4,colliding:!1,withinPlanetGravity:!1,hitPlanet:!1,inAir:!1,chargingJump:!1,canJump:!1,canDoubleJump:!1,planet:null,py:0,px:0,angle:0,bodyAngle:0,armThrust:0,legThrust:0,planetAngle:0,runSpeed:2.1,turnSpeed:.15,baseJumpSpeed:2.7,jumpSpeed:2.7,jumpSpeedIncrement:.4,thrust:.1,yVel:0,xVel:0,maxXVel:3.5,maxYVel:3.5,fuel:150,maxFuel:300,fuelDecay:.025,draining:!1,div12:Math.PI/6,forwardX:0,forwardy:0,forwardXend:0,forwardyend:0,headx:0,heady:0,neckx:0,necky:0,foot1x:0,foot1y:0,foot2x:0,foot2y:0,arm1x:0,arm1y:0,arm2x:0,arm2y:0,jetnoise:{},babies:0,init:!1,absorbing:!1,enemiesInView:[],draw(){r.pat=r.dither[0];let t=this.x-view.x,e=this.y-view.y,i=this.div12,s=t+Math.cos(this.bodyAngle)*this.radius,a=e+Math.sin(this.bodyAngle)*this.radius,h=t+Math.cos(this.bodyAngle)*(this.radius/2),n=e+Math.sin(this.bodyAngle)*(this.radius/2);if(this.arm1x=arm1x=h+Math.cos(this.bodyAngle+3.5*i+this.armThrust)*this.radius,this.arm1y=arm1y=n+Math.sin(this.bodyAngle+3.5*i+this.armThrust)*this.radius,this.arm2x=arm2x=h+Math.cos(this.bodyAngle-3.5*i-this.armThrust)*this.radius,this.arm2y=arm2y=n+Math.sin(this.bodyAngle-3.5*i-this.armThrust)*this.radius,this.foot1x=foot1x=t+Math.cos(this.bodyAngle+5*i+this.legThrust)*this.radius,this.foot1y=foot1y=e+Math.sin(this.bodyAngle+5*i+this.legThrust)*this.radius,this.foot2x=foot2x=t+Math.cos(this.bodyAngle-5*i-this.legThrust)*this.radius,this.foot2y=foot2y=e+Math.sin(this.bodyAngle-5*i-this.legThrust)*this.radius,r.fillCircle(s,a,2,22),r.circle(foot1x,foot1y,1,22),r.circle(foot2x,foot2y,1,22),r.line(t,e,s,a,22),r.line(t,e,foot1x,foot1y,22),r.line(t,e,foot2x,foot2y,22),r.line(t,e,foot1x,foot1y,22),r.line(t,e,foot2x,foot2y,22),r.line(h,n,arm1x,arm1y,22),r.line(h,n,arm2x,arm2y,22),this.draining)for(let i=0;100>i;i++){let i=2*Math.random()*Math.PI;r.pset(t+Math.cos(i)*(this.radius+5+5*Math.random()),e+Math.sin(i)*(this.radius+5+5*Math.random()),M([3,4]))}},update(){if(this.fuel-=this.fuelDecay,this.init?this.jetnoise.volume.gain.value=0:(this.jetnoise=b(sounds.jet,.6,0,.1,!0),this.jetnoise.volume.gain.value=0,this.init=!0),this.yVel=this.yVel>this.maxYVel?this.maxYVel:this.yVel,this.xVel=this.xVel>this.maxXVel?this.maxXVel:this.xVel,this.yVel=-this.maxYVel>this.yVel?-this.maxYVel:this.yVel,this.xVel=-this.maxXVel>this.xVel?-this.maxXVel:this.xVel,this.y+=this.yVel,this.x+=this.xVel,this.x>Ww?this.x=0:0>this.x&&(this.x=Ww),this.y>Wh?this.y=0:0>this.y&&(this.y=Wh),this.bodyAngle=this.angle,this.colliding||(this.armThrust=this.legThrust=Math.cos(this.bodyAngle-Math.atan2(this.yVel,this.xVel))),this.withinPlanetGravity&&(this.angle=this.planetAngle,this.legThrust=Math.cos(t/10)),this.fuel>0||(this.fuel=0),this.fuel>this.maxFuel&&(this.fuel=this.maxFuel),this.planet){let t=this.planet.x-p.x,e=this.planet.y-p.y,i=Math.sqrt(t*t+e*e);this.planet.radius+this.radius>i||(this.colliding=!1),this.planet.field+this.radius>i||(this.withinPlanetGravity=!1),i>this.planet.radius||(this.colliding=!0),this.withinPlanetGravity&&(this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.planetAngle=Math.atan2(this.py,this.px),this.bodyAngle=this.planetAngle,this.xVel-=Math.cos(this.planetAngle)*this.planet.gravity,this.yVel-=Math.sin(this.planetAngle)*this.planet.gravity)}this.colliding&&(this.yVel=0,this.xVel=0),S.isDown(S.LEFT)||S.isDown(S.q)||S.isDown(S.a)?this.moveLeft():(S.isDown(S.RIGHT)||S.isDown(S.d))&&this.moveRight(),S.isDown(S.UP)||S.isDown(S.z)||S.isDown(S.w)?this.moveUp():(S.isDown(S.DOWN)||S.isDown(S.w))&&this.moveDown()},moveLeft(){this.colliding?(this.xVel-=Math.cos(this.planetAngle+Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle+Math.PI/2)*this.runSpeed):(this.angle-=this.turnSpeed,this.angle=this.angle%(2*Math.PI),this.withinPlanetGravity||(splodes.push(new P(this.arm1x+view.x,this.arm1y+view.y,5,M([19,20,22]))),this.jetnoise.volume.gain.value=.03))},moveRight(){this.colliding?(this.xVel-=Math.cos(this.planetAngle-Math.PI/2)*this.runSpeed,this.yVel-=Math.sin(this.planetAngle-Math.PI/2)*this.runSpeed):(this.angle+=this.turnSpeed,this.angle=this.angle%(2*Math.PI),this.withinPlanetGravity||(splodes.push(new P(this.arm2x+view.x,this.arm2y+view.y,5,M([19,20,22]))),this.jetnoise.volume.gain.value=.03))},moveUp(){this.colliding?(this.xVel+=Math.cos(this.planetAngle)*this.jumpSpeed,this.yVel+=Math.sin(this.planetAngle)*this.jumpSpeed):(this.xVel+=Math.cos(this.angle)*this.thrust,this.yVel+=Math.sin(this.angle)*this.thrust,this.withinPlanetGravity||(splodes.push(new P(this.foot1x+view.x,this.foot1y+view.y,5,M([7,8,22]))),splodes.push(new P(this.foot2x+view.x,this.foot2y+view.y,5,M([7,8,22]))),this.jetnoise.volume.gain.value=.03))},moveDown(){this.colliding||(this.xVel-=Math.cos(this.angle)*this.thrust,this.yVel-=Math.sin(this.angle)*this.thrust,this.withinPlanetGravity||(splodes.push(new P(this.arm1x+view.x,this.arm1y+view.y,5,M([19,20,22]))),splodes.push(new P(this.arm2x+view.x,this.arm2y+view.y,5,M([19,20,22]))),this.jetnoise.volume.gain.value=.03))},onPlanet(t){this.planet=t,this.py=this.y-this.planet.y,this.px=this.x-this.planet.x,this.angle=Math.atan2(this.py,this.px),this.withinPlanetGravity=!0},reset(){this.fuel=100,this.xVel=this.yVel=0,p.x=Ww/2,p.y=Wh/2,babies=[]}};const C=Player;function I(t,e,i){return this.x=t,this.y=e,this.radius=.1,this.maxRadius=15,this.alive=!0,this.reaching=!1,this.angle=0,this.planet=i,this.complete=!1,this}function R(t,e,i){return this.x=t,this.y=e,this.radius=i,this.alive=!0,this.reaching=!1,this.targetX=0,this.targetY=0,this}function D(t,e){return this.x=0,this.y=0,this.radius=10,this.hit=!1,this.hitCount=0,this.alive=!0,this.health=100,this.reaching=!1,this.angle=t,this.planet=e,this.attacked=!1,this}function G(t,e){return this.state=0,this.previousState=0,this.angle=0,this.targetAngle=0,this.x=t,this.y=e,this.targetX=0,this.targetY=0,this.alive=!0,this.updateOrbits(),this}function V(){return this.x=0,this.y=0,this.radius=25,this.field=this.radius+30,this.color=22,this.haloColor=19,this.palette=[0,1,2,3,4,5,6],this.gravity=.15,this.sectors=1,this.harvesters=0,this.sectorsRemaining=this.sectors,this.completeFlag=!1,this.populated=!1,this.drawColor=37,this.disease=[],this}function L(t,e){return this.x=0,this.y=0,this.targetX=0,this.targetY=0,this.radius=8,this.hit=!1,this.hitCount=0,this.alive=!0,this.health=600,this.reaching=!1,this.angle=t,this.planet=e,this.harvesters=3,this.apex={x:0,y:0},this.browL={x:0,y:0},this.browR={x:0,y:0},this.armSpeedFactor=60,this.armSpeedTarget=0,this.underAttack=!1,this}function H(){let t=new V;t.x=p.x-100,t.y=p.y-100,t.radius=25,t.harvesters=0,planets.push(t),t=new V,t.x=p.x+200,t.y=p.y-100,t.radius=25,t.color=4,t.harvesters=0,planets.push(t),t=new V,t.x=p.x,t.y=p.y+100,t.radius=25,t.color=22,t.harvesters=0,planets.push(t),t=new R(p.x+150,p.y,20),Fuelrocks.push(t);for(let t=0;1e3>t;t++){let t=new V;t.x=Math.floor(Math.random()*(Ww-2*w)+h),t.y=Math.floor(Math.random()*(Wh-2*h)+h);let e=Math.max(Math.floor(Math.random()*h*.45),10);t.radius=e,t.field=e+45,t.harvesters=Math.floor(t.radius/20)+Math.floor(5*Math.random());let i=Math.floor(55*Math.random());t.color=i,collides=!0,T(t,100)||planets.push(t)}for(let t=0;100>t;t++){let t=new V;t.x=Math.floor(Math.random()*(Ww-2*w)+h),t.y=Math.floor(Math.random()*(Wh-2*h)+h),t.radius=15,t.field=t.radius+45,t.harvesters=Math.round(Math.random());let e=Math.floor(55*Math.random());t.color=e,collides=!0,T(t,100)||planets.push(t)}for(let t=0;200>t;t++){let t=planets[5+Math.floor(Math.random()*(planets.length-5))],e=new R(0,0,1);e.x=t.x,e.y=t.y,e.radius=10+10*Math.random(),planets.splice(planets.indexOf(t),1),Fuelrocks.push(e)}for(let t=0;125>t;t++){let t=planets[5+Math.floor(Math.random()*(planets.length-5))],e=new L;e.x=t.x,e.y=t.y,e.radius=Math.max(30*Math.random(),10),planets.splice(planets.indexOf(t),1),drones.push(e)}for(let t=0;5e3>t;t++){let t=[],e=Math.floor(Math.random()*Ww),i=Math.floor(Math.random()*Wh);for(let s=0;10>s;s++){let s=e+100*(Math.random()-.5),a=i+100*(Math.random()-.5);t.push({x:s,y:a,c:Math.floor(5*Math.random())+18})}stars.push({x:e,y:i,star:t})}for(let t=0;3e4>t;t++){let t=[],e=Math.floor(Math.random()*Ww),i=Math.floor(Math.random()*Wh);for(let s=0;10>s;s++){let s=e+100*(Math.random()-.5),a=i+100*(Math.random()-.5);t.push({x:s,y:a,c:M([30,31,43,1])})}stars.push({x:e,y:i,star:t})}Fuelrocks.forEach(t=>{let e=[];for(let i=0;300>i;i++){let i=t.x+Math.cos(Math.random()*Math.PI*2)*Math.random()*100,s=t.y+Math.sin(Math.random()*Math.PI*2)*Math.random()*100;e.push({x:i,y:s,c:M([14,15,16])})}stars.push({x:t.x,y:t.y,star:e})}),drones.forEach(t=>{let e=[];for(let i=0;300>i;i++){let i=t.x+Math.cos(Math.random()*Math.PI*2)*Math.random()*150,s=t.y+Math.sin(Math.random()*Math.PI*2)*Math.random()*150;e.push({x:i,y:s,c:M([3,4,5])})}stars.push({x:t.x,y:t.y,star:e})}),r.renderTarget=r.PAGE_2,r.pal=r.palDefault,r.fillRect(0,0,w,h,1);for(let t=0;5e3>t;t++)r.pat=r.dither[Math.floor(15*Math.random())],r.fillCircle(Math.random()*w,Math.random()*h,4*Math.random(),Math.floor(5*Math.random()));for(let t=0;500>t;t++)r.pat=r.dither[Math.floor(15*Math.random())],r.fillCircle(Math.random()*w,Math.random()*h,20*Math.random(),Math.floor(7*Math.random()));let e=5e4;for(r.pat=r.dither[0];e--;){r.renderTarget=r.PAGE_2;let t=Math.random()*w,e=Math.random()*h,i=r.pget(t,e,r.PAGE_2);r.line(t,e,t+10*Math.random(),e+4,i)}r.pat=r.dither[0],r.renderTarget=r.SCREEN}function N(){audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-60,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"song",data:s},{name:"cellComplete",data:a},{name:"tada",data:n},{name:"boom1",data:l},{name:"jet",data:d},{name:"absorbray",data:o},{name:"sectorget",data:u},{name:"bump",data:c},{name:"dronemoan",data:g},{name:"harvestermoan",data:v},{name:"babyaction",data:f},{name:"babyaction2",data:m}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{var e=new i;e.init(t.data);var s=!1;setInterval(()=>{if(!s&&(s=1==e.generate(),soundsReady+=s,s)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)})}function W(t){for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)}function O(){switch(gamestate){case 0:r.clear(64,r.PAGE_1),r.renderTarget=r.PAGE_1,soundsReady==totalSounds&&(view.x+=1,stars.forEach(t=>{A(t,100)&&t.star.forEach(t=>{r.pset(t.x-view.x,t.y-view.y,t.c)})})),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),(S.justReleased(S.UP)||S.justReleased(S.w)||S.justReleased(S.z))&&(0!=soundsReady||started?(gameMusicSound&&gameMusicSound.sound.stop(),gameMusicSound=b(sounds.song,1,0,.3,!0),absorbSound=b(sounds.absorbray,1,0,.1,!0),absorbSound.volume.gain.value=0,harverterSuckSound=b(sounds.absorbray,.5,0,.1,!0),harverterSuckSound.volume.gain.value=0,sectorFillSound=b(sounds.absorbray,1.5,0,.1,!0),sectorFillSound.volume.gain.value=0,gamestate=2):(H(),N(),started=!0)),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nPRESS UP/W/Z TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",r.renderSource=r.PAGE_1,r.renderTarget=r.SCREEN,r.sspr(0,0,w,h,0,0,w,h,!1,!1),r.render();break;case 1:(function(){t+=1;try{absorbSound.volume.gain.value=0,harverterSuckSound.volume.gain.value=0,sectorFillSound.volume.gain.value=0}catch{}view.x=p.x-mw,view.y=p.y-mh,Fuelrocks.forEach(t=>t.update()),splodes.forEach(t=>t.update()),planets.forEach(t=>t.update()),artifacts.forEach(t=>t.update()),planetSectors.forEach(t=>t.update()),harvesters.forEach(t=>t.update()),babies.forEach(t=>t.update()),drones.forEach(t=>t.update()),p.update(),W(splodes),W(artifacts),W(Fuelrocks),W(planetSectors),W(harvesters),W(babies),W(drones),(t=>{for(let e=0;t.length>e;e++)A(t[e])||t.splice(e,1)})(p.enemiesInView),W(p.enemiesInView),S.justReleased(S.m)&&(minimapToggle=!minimapToggle,mapTriggered=!0),S.justReleased(S.h)&&(helpToggle=!helpToggle),S.justReleased(S.r)&&function(){window.t=1,splodes=[],planets=[],sndData=[],Fuelrocks=[],planetSectors=[],harvesters=[],stars=[],collected=[],artifacts=[],babies=[],drones=[],r.pat=r.dither[0],H(),p.reset(),this.triggered=!1,this.titleInit=!1,gameState=2}()})(),r.pal=r.brightness,r.clear(64,r.PAGE_1),r.renderTarget=r.PAGE_1,stars.forEach(t=>{A(t,100)&&t.star.forEach(t=>{r.pset(t.x-view.x,t.y-view.y,t.c)})}),Fuelrocks.forEach(t=>t.draw()),planetSectors.forEach(t=>t.draw()),planets.forEach(t=>t.draw()),artifacts.forEach(t=>t.draw()),harvesters.forEach(t=>t.draw()),drones.forEach(t=>t.draw()),splodes.forEach(t=>t.draw()),babies.forEach(t=>t.draw()),p.draw(),collected.forEach((t,e)=>{r.rect(5+20*e,h-20,10,10,22),r.fillRect(5+20*e,h-20,10,10,t.color)}),fuelBarWidth=p.fuel/p.maxFuel*(w/2),r.fillRect(w/4,10,w/2,3,2),r.fillRect(w/4,10,fuelBarWidth,3,12),helpToggle&&(playerHelpText="W/Z/UP TO THRUST\nAD/QD TO TURN",150>t%300&&5>p.fuel&&(playerHelpText="FIND ENERGY MASS TO ABSORB\nOR TRAVEL NEAR COMPLETE PLANETS\nTO RECHARGE"),p.withinPlanetGravity&&(p.planet.sectorsRemaining>0?p.planet.harvesters>0?playerHelpText="THE RED CAN ONLY\nBE KILLED BY PLANET SPRITES":150>t%300?playerHelpText="CHARGE UP PLANET NODES\nTO COMPLETE PLANETS":playerHelpText="COMPLETING A PLANET GIVES\nYOU A PLANET SPRITE":(playerHelpText="COMPLETED PLANETS RECHARGE\nYOUR ENERGY WHEN CLOSE",150>t%300&&(playerHelpText="PLANET SPRITES FOLLOW YOU\nFOREVER AND ATTACK THE RED"))),p.draining&&(playerHelpText="THE RED DRAIN YOUR ENERGIES\nKEEP YOUR DISTANCE"),r.text([playerHelpText,p.x-view.x,p.y-view.y+20,1,3,"center","top",1,7]),r.text(["ENERGY REMAINING",w/2,15,1,3,"center","top",1,7]),r.pat=r.dither[12],r.circle(mw,mh,mh-10,7),r.pat=r.dither[0],r.text(["HUD INDICATES\nNEARBY PLANETS",mw+mh,mh+mh/2,1,3,"right","top",1,7])),r.text(["M MAP/STATS  H TOGGLE HELP",w-8,h-8,1,3,"right","top",1,19]),r.renderSource=r.PAGE_1,r.renderTarget=r.SCREEN,r.sspr(0,0,w,h,0,0,w,h,!1,!1),minimapToggle&&(()=>{mapTriggered&&(scale=40,mapTriggered=!1),scaleTarget=3,scale=E(scale,3,.5),r.pal=r.palDefault,r.fillRect(0,0,w,h,0);let e=40/scale,i=40/scale;view.x=p.x-mw*e,view.y=p.y-mh*i;let s=view.x/e,a=view.y/i;r.pat=r.dither[8],stars.forEach((t,h)=>{h%2==0&&A(t,e*Ww)&&h%5==0&&t.star.forEach(t=>{r.pset(t.x/e-s,t.y/i-a,1)})}),r.pat=r.dither[0],planets.forEach(t=>{r.fillCircle(t.x/e-s,t.y/i-a,Math.max(t.radius/e,2),0==t.sectorsRemaining?t.color:2),0==t.sectorsRemaining&&r.circle(t.x/e-s,t.y/i-a,Math.max(t.radius/e,2),19)}),Fuelrocks.forEach(t=>{r.pset(t.x/e-s,t.y/i-a,10),r.pset(t.x/e-s+1,t.y/i-a,10),r.pset(t.x/e-s-1,t.y/i-a,10),r.pset(t.x/e-s,t.y/i+1-a,10),r.pset(t.x/e-s,t.y/i-1-a,10)}),harvesters.forEach(t=>{r.pset(t.x/e-s,t.y/i-a,4)}),drones.forEach(t=>{r.fillCircle(t.x/e-s,t.y/i-a,1,4)}),t%2==0&&(r.pset(p.x/e,p.y/i,9),r.pset(p.x/e+1-s,p.y/i+1-a,22),r.pset(p.x/e-1-s,p.y/i-1-a,22),r.pset(p.x/e-1-s,p.y/i+1-a,22),r.pset(p.x/e+1-s,p.y/i-1-a,22),r.pset(p.x/e+2-s,p.y/i+2-a,22),r.pset(p.x/e-2-s,p.y/i-2-a,22),r.pset(p.x/e-2-s,p.y/i+2-a,22),r.pset(p.x/e+2-s,p.y/i-2-a,22)),r.text([`${planetsDiscovered}/${planets.length} PLANETS DISCOVERED  ${planetsComplete} PLANETS COMPLETE`,w/2,15,1,3,"center","top",1,7])})(),r.render();break;case 2:!function(){if(view.x=0,view.y=0,!this.titleInit){p.x=w/2-135,p.y=70,p.bodyAngle=-Math.PI/3;for(let t=0;5>t;t++)babies.push(new G(p.x,p.y));this.titleInit=!0}if(r.renderTarget=r.PAGE_3,r.fillRect(0,0,w,h,14),r.pat=r.dither[8],r.fillRect(0,60,w,80,15),r.pat=r.dither[4],r.fillRect(0,65,w,70,15),r.pat=r.dither[2],r.fillRect(0,75,w,50,15),r.pat=r.dither[8],r.fillRect(0,80,w,40,16),r.pat=r.dither[4],r.fillRect(0,85,w,30,16),!this.triggered){let t=20;for(;t--;){let t=Math.random()*w,e=Math.random()*h;splodes.push(new P(t,e,20,11))}splodes.forEach(t=>t.draw()),splodes.forEach(t=>t.update())}r.clear(64,r.PAGE_1),r.renderTarget=r.PAGE_1,stars.forEach(t=>{A(t,1e3)&&t.star.forEach(t=>{r.pset((t.x-view.x)/2,(t.y-view.y)/2,t.c)})}),r.stencil=!0,r.stencilSource=r.PAGE_2,r.stencilOffset=27,r.fillRect(0,h-h/10,w,h/10,0),r.stencil=!1,r.line(0,h-h/10,w,h-h/10,20),p.draw(),babies.forEach(t=>t.draw()),babies.forEach(t=>t.update()),r.text([" SPACE\nGARDEN",w/2-1,50,8,10,"center","top",9,12]),r.text([" SPACE\nGARDEN",w/2-3,50,8,10,"center","top",9,12]),r.text([" SPACE\nGARDEN",w/2-2,51,8,10,"center","top",9,15]),r.text([" SPACE\nGARDEN",w/2-2,49,8,10,"center","top",9,11]),r.stencil=!0,r.stencilSource=r.PAGE_3,r.stencilOffset=0,r.text([" SPACE\nGARDEN",w/2-2,50,8,10,"center","top",9,19]),r.stencil=!1,r.text(["PRESS UP / W / Z TO PLAY",w/2-2,170,1,1,"center","top",1,22]),W(splodes),(S.justReleased(S.UP)||S.justReleased(S.w)||S.justReleased(S.z))&&(p.reset(),gamestate=1),r.renderSource=r.PAGE_1,r.renderTarget=r.SCREEN,r.sspr(0,0,w,h,0,0,w,h,!1,!1),r.render()}()}S.update(),requestAnimationFrame(O)}I.prototype.draw=function(){if(A(this,10))if(r.pat=r.dither[-.5>Math.random()?8:9],this.complete)r.circle(this.x-view.x,this.y-view.y,this.radius+5,19);else if(r.fillCircle(this.x-view.x,this.y-view.y,this.radius+5,14),r.pat=r.dither[0],r.fillCircle(this.x-view.x,this.y-view.y,this.radius,11),this.reaching){let t=10;for(;t--;)r.pat=r.dither[t],r.line(this.x-view.x+(Math.random()-.5)*this.radius*2,this.y-view.y+(Math.random()-.5)*this.radius*2,p.x-view.x,p.y-view.y,10+5*Math.random())}},I.prototype.update=function(){if(A(this,10)){let t=this.x-p.x,e=this.y-p.y;Math.sqrt(t*t+e*e)<=this.radius+p.radius+40&&p.fuel>0&&this.maxRadius>this.radius?(this.radius+=.3,p.fuel-=.6,this.planet.disease.splice(0,1),this.reaching=!0,sectorFillSound.volume.gain.value=.1):this.reaching=!1,this.radius>this.maxRadius&&(this.radius=this.maxRadius,this.complete||(this.complete=!0,b(sounds.sectorget),this.reaching=!1,this.planet.sectorsRemaining--,splodes.push(new P(this.x+10*Math.random(),this.y+10*Math.random(),30,14)),splodes.push(new P(this.x+10*Math.random(),this.y+10*Math.random(),40,15)),splodes.push(new P(this.x+10*Math.random(),this.y+10*Math.random(),50,16)))),0==this.planet.sectorsRemaining&&(this.alive=!1)}},R.prototype.draw=function(){if(A(this,10)&&(r.pat=r.dither[-.5>Math.random()?8:9],r.fillCircle(this.x-view.x,this.y-view.y,this.radius+5,14),r.pat=r.dither[0],r.fillCircle(this.x-view.x,this.y-view.y,this.radius,11),this.reaching)){let t=10;for(;t--;)r.pat=r.dither[t],r.line(this.x-view.x+(Math.random()-.5)*this.radius*2,this.y-view.y+(Math.random()-.5)*this.radius*2,p.x-view.x,p.y-view.y,10+5*Math.random())}},R.prototype.update=function(){if(A(this,10)){this.targetX>0&&(this.x=E(this.x,this.targetX,.2),this.y=E(this.y,this.targetY,.2));let t=this.x-p.x,e=this.y-p.y;this.dist=Math.sqrt(t*t+e*e),this.dist>this.radius+p.radius+40?this.reaching=!1:(p.absorbing=!1,p.fuel<p.maxFuel?(this.radius-=.1,p.fuel+=1,p.absorbing=!0,this.reaching=!0,absorbSound.volume.gain.value=.1):p.fuel==p.maxFuel&&(absorbSound.volume.gain.value=0,p.absorbing=!1))}this.radius>0||(b(sounds.sectorComplete),splodes.push(new P(this.x,this.y,120,9)),this.alive=!1)},D.prototype.draw=function(){if(A(this,10)&&(r.fillCircle(this.x-view.x,this.y-view.y,this.radius,4),this.reaching)){let t=10;for(;t--;)r.pat=r.dither[t],r.line(this.x-view.x+(Math.random()-.5)*this.radius*2,this.y-view.y+(Math.random()-.5)*this.radius*2,p.x-view.x,p.y-view.y,3+5*Math.random())}},D.prototype.update=function(){if(this.x=this.planet.x+Math.cos(this.angle)*(this.planet.radius+5*Math.sin(t/5)),this.y=this.planet.y+Math.sin(this.angle)*(this.planet.radius+5*Math.sin(t/5)),this.angle+=.01,A(this,-20)&&p.enemiesInView.push(this),A(this,10)){let t=this.x-p.x,e=this.y-p.y,i=Math.sqrt(t*t+e*e);if(i>this.radius+p.radius+20?(this.reaching=!1,p.draining=!1):(p.fuel-=.6,p.draining=!0,this.reaching=!0,harverterSuckSound.volume.gain.value=.1,i>this.radius+p.radius||2>Math.abs(p.xVel+p.yVel)/2&&(splodes.push(new P(this.x,this.y,20,22)),p.xVel=4*Math.cos(p.angle),p.yVel=4*Math.sin(p.angle),b(sounds.bump,1,0,.4,!1))),100>this.health&&!this.attacked&&(b(sounds.harvestermoan,2,0,.2,!1),this.attacked=!0),0>=this.health){this.alive=!1,p.draining=!1,this.planet.harvesters--,harvesters.splice(harvesters.indexOf(this),1),splodes.push(new P(this.x,this.y,50,6)),splodes.push(new P(this.x+5*Math.random(),this.y+5*Math.random(),60,7)),splodes.push(new P(this.x+5*Math.random(),this.y+5*Math.random(),70,5)),b(sounds.boom1,1,0,.1,!1);for(let t=0;2>t;t++){let t=new R(this.x,this.y,2);t.targetX=this.x+90*Math.random(),t.targetY=this.y+90*Math.random(),Fuelrocks.push(t)}}}},G.prototype.draw=function(){if(A(this,10))switch(this.state){case 0:case 3:r.fillCircle(this.x-view.x,this.y-view.y,2,0),r.circle(this.x-view.x,this.y-view.y,2,M([19,20,22])),splodes.push(new P(this.x,this.y,5,M([19,20,22])));break;case 2:r.fillCircle(this.x-view.x,this.y-view.y,2,0),r.circle(this.x-view.x,this.y-view.y,2,M([5,6,7])),splodes.push(new P(this.x,this.y,5,M([5,6,7]))),splodes.push(new P(this.enemyTarget.x+(2*Math.random()-1)*this.enemyTarget.radius,this.enemyTarget.y+(2*Math.random()-1)*this.enemyTarget.radius,5,M([5,6,7])))}},G.prototype.update=function(){switch(this.state!=this.previousState&&(this.previousState=this.state),A(this,20)||(this.state=0),this.targetAngle+=.015,p.enemiesInView.length>0&&2!=this.state?(this.enemyTarget=M(p.enemiesInView),this.state=2):0==p.enemiesInView.length&&(this.state=0,p.withinPlanetGravity&&(this.state=3)),this.state){case 0:this.targetX=p.x+Math.cos(this.angle)*(p.radius+babies.length-2*p.xVel)+20*Math.cos(7*this.angle),this.targetY=p.y+Math.sin(this.angle)*(p.radius+babies.length-2*p.yVel)+20*Math.sin(7.1*this.angle),this.enemyTarget&&(this.enemyTarget.attacked=!1);break;case 3:this.targetX=p.planet.x+Math.cos(this.angle)*(p.planet.radius+7+babies.length-2*p.xVel),this.targetY=p.planet.y+Math.sin(this.angle)*(p.planet.radius+7+babies.length-2*p.yVel);break;case 2:this.targetX=this.enemyTarget.x+Math.cos(this.angle)*(this.enemyTarget.radius+5),this.targetY=this.enemyTarget.y+Math.sin(this.angle)*(this.enemyTarget.radius+5),this.enemyTarget.health-=.2,this.enemyTarget.alive||(this.enemyTarget=M(p.enemiesInView))}this.x=E(this.x,this.targetX,.15),this.y=E(this.y,this.targetY,.15),this.angle=E(this.angle,this.targetAngle,.15),A(this,10)},G.prototype.updateOrbits=()=>{babies.forEach((t,e,i)=>{t.targetAngle=2*Math.PI/(i.length+1)*(e+1)})},V.prototype.draw=function(){if(r.renderSource=r.PAGE_2,A(this,2500)&&!A(this,50)){let t=this.x-p.x,e=this.y-p.y,i=Math.atan2(e,t),s=p.x-view.x+Math.cos(i)*(h/2-20);drawY=p.y-view.y+Math.sin(i)*(h/2-20);let a=Math.sqrt(t*t+e*e);12>a/100&&(r.pat=r.dither[8],r.circle(s,drawY,12-Math.min(12,Math.floor(a/100)),this.completeFlag?19:7),r.pat=r.dither[0])}if(A(this,200)){if(0==this.sectorsRemaining&&(r.pat=r.dither[15],r.fillCircle(this.x-view.x,this.y-view.y,this.radius+30,this.haloColor),r.pat=r.dither[13],r.fillCircle(this.x-view.x,this.y-view.y,this.radius+20,this.haloColor),r.pat=r.dither[11],r.fillCircle(this.x-view.x,this.y-view.y,this.radius+8,this.haloColor),r.pat=r.dither[8],r.fillCircle(this.x-view.x,this.y-view.y,this.radius+3,this.haloColor),r.fillCircle(this.x-view.x,this.y-view.y,this.radius+2,this.haloColor+1),this.reaching)){r.pat=r.dither[12];let t=10;for(;t--;)r.line(this.x-view.x+(Math.random()-.5)*this.radius*2,this.y-view.y+(Math.random()-.5)*this.radius*2,p.x-view.x+(Math.random()-.5)*p.radius,p.y-view.y+(Math.random()-.5)*p.radius,18+4*Math.random());r.pat=r.dither[0]}r.pat=r.dither[0],r.tfillCircle(this.x-view.x,this.y-view.y,this.radius,this.drawColor),r.pat=r.dither[8],this.disease.forEach(t=>{r.pat=r.dither[t.dither],r.fillCircle(t.x-view.x,t.y-view.y,t.radius,42)}),r.circle(this.x-view.x,this.y-view.y,this.radius,0==this.sectorsRemaining?19:4),r.circle(this.x-view.x,this.y-view.y,this.field,1)}},V.prototype.update=function(){if(A(this,200)){if(this.reaching=!1,!this.populated){planetsDiscovered++,this.field=this.radius+45,this.haloColor=M([18,15,29]),this.sectors=Math.round(this.radius/10),this.sectorsRemaining=this.sectors;for(let t=0;this.sectors>t;t++)planetSectors.push(new I(this.x+this.radius*Math.cos(2*t*Math.PI/this.sectors),this.y+this.radius*Math.sin(2*t*Math.PI/this.sectors),this));for(let t=0;this.harvesters>t;t++)harvesters.push(new D(2*Math.PI/this.harvesters*t,this));for(let t=0;300>t;t++)this.disease.push({x:this.x+Math.cos(6.28318*Math.random())*Math.random()*this.radius,y:this.y+Math.sin(6.28318*Math.random())*Math.random()*this.radius,radius:12*Math.random(),dither:Math.floor(8+4*Math.random())});this.populated=!0}if(0==this.sectorsRemaining&&(this.drawColor=this.color,!this.completeFlag)){this.completeFlag=!0,planetsComplete++,b(sounds.tada),this.disease=[];let t=80;for(;t--;){let t=6.28318*Math.random(),e=Math.random()*this.radius;splodes.push(new P(this.x+e*Math.cos(t),this.y+e*Math.sin(t),20+50*Math.random(),M([20,21,22])))}babies.push(new G(this.x,this.y))}let t=this.x-p.x,e=this.y-p.y,i=Math.sqrt(t*t+e*e);i>this.field+p.radius+100||(this.reaching=!0),this.completeFlag&&this.reaching&&(p.fuel+=.12),i>this.field+p.radius||p.withinPlanetGravity||p.onPlanet(this)}},L.prototype.draw=function(){if(A(this,10)){r.pat=r.dither[0];for(let e=0;2*Math.PI>e;e+=.7)for(let i=this.radius;this.radius+30>i;i+=4){let s=e+.4*Math.sin(8*e-i/20+t/this.armSpeedTarget);r.fillCircle(this.x-view.x+i*Math.cos(s),this.y-view.y+i*Math.sin(s),this.radius/3-i/11|0,3),r.circle(this.x-view.x+i*Math.cos(s),this.y-view.y+i*Math.sin(s),this.radius/3-i/11|0,4)}if(r.fillCircle(this.x-view.x,this.y-view.y,this.radius,3),r.fillCircle(this.x-view.x,this.y-view.y,15,22),r.fillCircle(this.x-view.x+7*Math.cos(this.angle+Math.PI),this.y-view.y+7*Math.sin(this.angle+Math.PI),3,1),r.circle(this.x-view.x,this.y-view.y,this.radius,4),this.reaching){this.armSpeedTarget=10;let t=10;for(;t--;)r.pat=r.dither[t],r.line(this.x-view.x+(Math.random()-.5)*this.radius*2,this.y-view.y+(Math.random()-.5)*this.radius*2,p.x-view.x,p.y-view.y,3+5*Math.random())}else this.armSpeedTarget=60}},L.prototype.update=function(){if(A(this,-20)&&p.enemiesInView.push(this),A(this,60)){this.targetX=p.x,this.targetY=p.y,this.x=E(this.x,this.targetX,.005),this.y=E(this.y,this.targetY,.005),this.armSpeedFactor=E(this.armSpeedFactor,this.armSpeedTarget,.2),this.apex.x=this.x-view.x,this.apex.y=this.y-view.y-3,this.browL.x=this.x-view.x-24,this.browL.y=this.y-view.y-18,this.browR.x=this.x-view.x+24,this.browR.y=this.y-view.y-18;let t=this.x-p.x,e=this.y-p.y;this.angle=Math.atan2(e,t);let i=Math.sqrt(t*t+e*e);if(i>this.radius+p.radius+100?(this.reaching=!1,p.draining=!1):(p.fuel-=.6,this.reaching=!0,p.draining=!0,harverterSuckSound.volume.gain.value=.1,i>this.radius+p.radius||(p.fuel-=150,2>Math.abs(p.xVel+p.yVel)/2&&(p.fuel>100?(p.score+=1,this.hit=!0,this.hitCount+=1,splodes.push(new P(this.x,this.y,40,5)),b(sounds.boom1,3,0,.05,!1),p.xVel=3*Math.cos(p.angle),p.yVel=3*Math.sin(p.angle)):(splodes.push(new P(this.x,this.y,20,22)),p.xVel=5*Math.cos(p.angle),p.yVel=5*Math.sin(p.angle),b(sounds.bump,1,0,.4,!1))))),0>=this.health){this.alive=!1,p.draining=!1,drones.splice(drones.indexOf(this),1),splodes.push(new P(this.x,this.y,50,6)),splodes.push(new P(this.x+5*Math.random(),this.y+5*Math.random(),60,7)),splodes.push(new P(this.x+5*Math.random(),this.y+5*Math.random(),70,5));for(let t=0;5>t;t++){let t=new R(this.x,this.y,2);t.targetX=this.x+150*(Math.random()-.5),t.targetY=this.y+150*(Math.random()-.5),Fuelrocks.push(t)}b(sounds.boom1,1,0,.1,!1)}}},window.baby=G,document.body.style="margin:0; background-color:black; overflow:hidden",800>innerWidth?(w=innerWidth,h=innerHeight):1300>innerWidth?(w=Math.floor(innerWidth/2),h=Math.floor(innerHeight/2)):(w=Math.floor(innerWidth/3.5),h=Math.floor(innerHeight/3.5)),wwFactor=40,hhFactor=40,Ww=40*w,Wh=40*h,view={x:0,y:0},mw=w/2,mh=h/2,gamestate=0,paused=!1,started=!1,p=C,p.x=Ww/2,p.y=Wh/2,atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=b,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),O()},window.t=1,splodes=[],planets=[],sndData=[],Fuelrocks=[],planetSectors=[],harvesters=[],stars=[],collected=[],babies=[],drones=[],artifacts=[],sounds={},soundsReady=0,totalSounds=8,audioTxt="",debugText="",darkness=0,planetsComplete=0,planetsDiscovered=0,absorbSound={},harverterSuckSound={},sectorFillSound={},gameMusicSound=0,minimapToggle=!1,procGenStart=5,helpToggle=!1,window.addEventListener("keyup",t=>{S.onKeyup(t)},!1),window.addEventListener("keydown",t=>{S.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),onclick=t=>{0===(x=t.pageX,y=t.pageY,paused=!1,gamestate)&&(0!=soundsReady||started||(H(),N(),started=!0))}}()</script>