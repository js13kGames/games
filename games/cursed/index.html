<!doctype html><title>Cursed</title><meta content="width=device-width" name=viewport><style>*{padding:0;margin:0;box-sizing:content-box;font-family:Courier New,Courier,monospace;font-weight:200;letter-spacing:-.01em;word-spacing:-.2em;cursor:crosshair}body{overflow:hidden;background:#222;height:100vh!important}h3{margin-bottom:.6rem}h5{color:#555}label{border:1px solid #eee;height:80px}label:hover{background:rgba(0,0,0,.05)}label img{width:30%}.dialog{opacity:0;pointer-events:none;transition:opacity 333ms ease-in;background:#fffdfd;border-radius:2px;padding:7px 10px;min-width:200px;min-height:100px;border:1px solid rgba(0,0,0,.3);box-shadow:1px 1px 2px 2px rgba(0,0,0,.1);overflow:hidden}.dialog,.dialog .active{position:absolute}.dialog .visible{opacity:1}.d-head{width:calc(100% + 20px);margin:0 -10px;padding:0 10px;height:15px;display:flex;border-bottom:1px solid rgba(0,0,0,.3);color:#999;font-weight:100}.dot{width:6px;height:6px;border-radius:50%;background:#333;border:none;margin-right:5px;line-height:15px}.back-text{pointer-events:none;color:#444;z-index:-1}.big{width:800px;height:500px}.med{min-width:450px;min-height:200px}.small{min-width:200px;min-height:100px}.wide{width:400px}.tiny{width:100px;height:50px}.half{width:50%}.top-center{position:absolute;top:0;left:50%;transform:translateX(-50%)}.z-top{z-index:1000}.abs{position:absolute}.t-left{text-align:left}.rel{position:relative}.abs-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.visible{opacity:1;pointer-events:all}.simple .d-head{display:none}.simple{padding:50px}.flex-center{display:flex;justify-content:center;align-items:center;text-align:center}.col{flex-direction:column}.full{width:100%;height:100%}#main-block{background:#fbfff1;border-radius:10px;box-shadow:8px 10px 0 0 rgba(0,0,0,.2);z-index:0}#head{position:absolute;z-index:-10;width:100%;height:50px;background:#f3f3f3}h1,h2,h3,h4,h5{z-index:-5}#_canvas{z-index:100}.no-upgrades #upgrade-text,.no-upgrades label{display:none}#health{bottom:20px;left:20px;color:#707070}#health,#url{position:absolute}#url{pointer-events:none;color:#111;opacity:.8;top:19px;left:110px;z-index:-5}#main-text{position:absolute;top:70px;left:20px;color:#5a5a5a;font-weight:100}#score{position:absolute;bottom:20px;right:20px;color:#aaa}</style><body class="flex-center full"><div class="big rel" id=main-block><div class=dialog id=base-dialog><div class=d-head><em class=dot></em></div><br><h3 id=ui1></h3><h5 id=ui2></h5></div><h6 id=url>www.js13k.com/home/cursed~~?666*!@*#&@</h6><h4 id=main-text></h4><h4 id=score></h4><h4 id=health></h4><div id=head></div><div class="dialog abs-center col med" id=dialog><div class=d-head><em class=dot></em></div><br><h3>YOU HAVE DIED</h3><h5>You have made it back home.<br>You have mastered time and shape.<br>You have overcome the curse.</h5></div><div class="dialog abs-center col med simple" id=win-dialog><div class=d-head><em class=dot></em></div><h1 class=final-score></h1><br><h3>YOU WIN</h3><h5>You have made it back home.<br>You have mastered time and shape.<br>You have overcome the curse.</h5><br><br><label class="flex-center b-restart tiny"><h5>play again?</h5></label></div><div class="dialog abs-center col" id=upgrade-dialog><div class=d-head><em class=dot></em></div><br><h5>Congratulations shapeshifter, you have made it back one step closer to your home.</h5><h5 id=upgrade-text>choose your next form</h5><br><br><div class=flex-center><label class="flex-center half" id=upgrade-1><img id=choice1></label> <label class="flex-center half" id=upgrade-2><img id=choice2></label></div></div><div class="dialog abs-center col med simple" id=death-dialog><div class=d-head><em class=dot></em></div><h1 class=final-score></h1><br><h3>YOU HAVE DIED</h3><h5>(lower scores are better...)</h5><br><br><label class="flex-center b-restart tiny"><h5>try again?</h5></label></div><canvas class=full id=_canvas></canvas></div><script>!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t,e){t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAATCAYAAAB2pebxAAABkklEQVQ4jaWSQUsCURDH53nLZNerqAh6EuwqhAc1ECswvHXrEh76AHaTrh2DPoNnBfGyhw5+ASFBAimWFTrowT1VuxL/mGcrvmqj1oE/7735w+/NMEMArmnbwCqutsIwYjKZ8HG5FSQej8M0Tb5eBIbwkclkMJ1O+XkWGMLKZrOYzWbvAE4DQ1i5XA62bbsATv7KEAwRQijJfD5PhmG4uq4fEdFTIAhHqVSifr//Gg6Hd2zb9gVEo9Hv7WyqUqnAcRxf31uzXyGsWq32P0g6nZZntVrFYrFYi3O8R5s5L69A+MfRaCTvoVAIlmWxdej5mqZB13VFCoQBjuO8AHgoFovSbLVabN16kMFggOFwqEiBfAIOAJy3221pxmIxLJdL24Mkk0mkUilFHoRH/EZEx0KIOwC7rus+JxIJbT6fU6fToXq9TrwCvV6PIpGIMt5yucwUiVI2k1toNpvyl0ajsSqXCIVCAdzqptaVfF0eAHuWZd2Px2PiKQkhRLfb9V02WelPBgCDiB6J6IaI9n0JHET0AYEAicLgOa1RAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAVCAYAAAB2Wd+JAAABs0lEQVQ4jZXTsUsCURwH8K9pnRbVIYKgIFIG3narg4O5B/4RCQ1C/0BNDdHQGE4NColbGDg6JA6OKkhgODgIIqKhvhs8ffF7qJyW1j14/Ib3Pu/77nd3ALAzmUweqMLksHPO+Wg0ejSLjwjWajXTWCbocrl4tVo1hQUEYBovIU23280bjca/8Aqk6fV6F/h+G/4BjXg4HN5uwr/C/+CN8C+8FW7DK9Dn84nq8Xh4t9vl/X5fTE3TaNsS24zRoVAI2WwWwWAQ7XYbxWIRgUDgOZlMvtpstqksy5qiKINFqkiMRCJ8PB5PB4PBRzweF6nRaJSSmg6HwwvABcAJ4ACA1TKHfcaYXigUbnq93peqqk+qqopb1Ot1WCyWC0VR8vPHwaLKs9lsksvlrgH47Xb7CWOsGQ6HRWoikaAP4Q3A7vrrOCyVSpcA6Dr7dFClUrnLZDIC+v1+ruu6ns/nTwHQDZdjj34tAI75ghSLxRTGGEulUqKbmqZ9lsvl8/X3SJuthtNo0dlqtV46nc57Op2+kiTpDMCxEa5EGwalUwclABqA8bzqi8ZsgnQyNYMqbV4CMQB8A69RODSxqxIyAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAiCAYAAACwaJKDAAADTklEQVRIia3VXUhTURwA8P/ZvXfqNjfR+QFqUb1IfqFRL+1ByGImoRAUaeBbQUEfog4qrF4j7EHyQamX9lIWQZFNSnpMVlCtssYQJcvEr+nd1X3c7Z74r93L9XNz24HD5Zx7z+/+/+eecy4AgEYUxTt4hTSWTEopFQShJ52wEVGXy5VWOAdRs9mcVjiKAoAC+3y+m6nCCroO7k4FXoPKsNvtTgnegGItLi6mHo8naXhTVA3zPN++U3hLVA0vLy9fThQmMdRLCFE6LRYLMAyjtEtKSmBgYABEUbxiMpl6AUBKOFJCCO3r66OBQGCO53mPugqC4A4Gg9+mp6etsWDioxqNhtrtdkzze11dnQUAygFgv6qWAUApABgSmYYoKoNWq/UgABTg9gWAbKx51ScLSq3dpVWdvcUVV+8Z40WqzKnX6/3c0tJyzuFwjAOAr7rjYyGny+0gDHcaCCnCh4uO5P8fRemMFA49Di0t3H3TvOdP7KOuQU08zw/X19efdzqdUwAg1F7/2cZo9T1AiEH9sILKhVIh7BfaXx81P1B/PJwbsbW19YzT6fyF4IEb7i4mw9C/Htw8T2Jgddn9DW8XrqnnGSPFtcPim2psX5pZfd6TrYwNkapKaGnu1HBjyVOMH/UI9u1quKVnsnJ640a3ReGMub1VXfeNoAqZ5FY2tRINU5gsimOLLCfOoimjLKPVNSULyoXR6dFgZZQjbOahlNGMLDQ4Vm6zOpallK5uN4hGInFYwkYtuZV/2KyPF8nMyFwiARNlbUliaCaREdsVGhGjhoxS0bc0mioa9kcNKqNh3+SPl6mi/jkPGmEZFZ2dzY6wXxhLFpRCK2Mee5sDLSXSSGDV93vIbqOSFNyxSKXg/KdBmyT6fWgx6luz7x2L2XvLJwy7y44RQtj1Y4WJTVYclYKLY0OXJp63j+AjuO3XoPiWv++eTbE6wwfjvooaDZeRtx0aCQqe2dGHFyZf2BBcwtSxf/0Jju0MPPXZLIO59vajRlNZ7XGtMbdSw2nzcJ3SiLgQXvV+XZl2DY0PXnwlhVbmAYAHAJy26GG92W8B+zD1rNj/CDcFvkjOCrcVAiuxdP2Yofr03+5fI+Nc7Cp/VDzhEcFU12DRAgD/ABHBuAS52zBHAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAwElEQVQ4jZ2TQQrDMAwEVyXFPdTQQx/RQx7Q/7+nhx4LKaRYkYstLMuJQCQI72TZyHBqWqXSu3fYKoYQEfd6EDaJsOq9sCYktwWjBmSpDtB2ZNNX8zOAb9eJPJ+lMz3TzqiALK2ve7PSGTsJIZi5WJ002dkJwGX0L3SKGVcAD51HsYjdWdIKgwO7A5gPhD2L9h96BfMcWZAmzFlIEzIEG4WYsBjjboiZmQfRd03DbiJO9QLwtu5XD5RheWE/FgQAfgc2DTfM2mt4AAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFIGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDktMTBUMjE6NDU6MjctMDc6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA5LTEzVDAxOjA1OjMzLTA3OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA5LTEzVDAxOjA1OjMzLTA3OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjE4ZDdlYzdmLTY0ZjQtNDA1Ni1iZWMwLTAwNjFjOGQ4ZWRlYSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxOGQ3ZWM3Zi02NGY0LTQwNTYtYmVjMC0wMDYxYzhkOGVkZWEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxOGQ3ZWM3Zi02NGY0LTQwNTYtYmVjMC0wMDYxYzhkOGVkZWEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE4ZDdlYzdmLTY0ZjQtNDA1Ni1iZWMwLTAwNjFjOGQ4ZWRlYSIgc3RFdnQ6d2hlbj0iMjAxOS0wOS0xMFQyMTo0NToyNy0wNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+t6IYNwAAAStJREFUOMuV1D+Kg0AUBnCnSqGFXaoEgunSLOQMC3sAm9jlAnsHT2LnhTyB2CYxyxb+QZ28J/PcF3HG2YEPRD9+mMkbHSmlY1ie/FsOzzAMY4HfczSYj5mUsfYO/gsjhIeDttj0RmEYasE1zKOfV1XVM4qiEQuCYEQIbprmgdoa5qZp+tl13QOxOI4vRVFMGFz3dV3/IoY9wG46TCAG2UC2kP0SlmXZNz5HTPWF7s2Ewgg+zLGyLK+s59r8AYTtNRjvWY2GFoO8FbVYnuer2KynxYQlJmwwF0pn2rMkSb4M2Nm0Z7Tpu77v723b3hGbDy3c/8FniKk5E6YTsIOcoCjpBNAxomtapqHlX4sT5GPpoKv4Kp7VQUdsDrLPkW81GiZwCbLFOHhkkBF7AeIQTlHPj/xWAAAAAElFTkSuQmCC"},function(t,e,s){},function(t,e,s){"use strict";s.r(e);let i=window;i.entities=[],i.tick=0,i.queueOnLoad=[],i.addEventListener("DOMContentLoaded",(t=>{i.queueOnLoad.map((t=>{t()}))})),i._b={},i._b.getCenter=t=>{},i._b.ranPos=t=>{},i._b.spawnPoints=[],i.circ=(t,e,s,i)=>{i.beginPath(),i.arc(t,e,s,0,2*Math.PI),i.fill(),i.stroke()},i.dToRad=t=>t*Math.PI/180,i.sq=t=>Math.pow(t,2),i.sqDist=(t,e)=>i.sq(t.x-e.x)+i.sq(t.y-e.y),i.hyp=(t,e)=>Math.sqrt(t*t+e*e),i.ran=(t=1)=>Math.random()*t,i.ranRad=t=>Math.PI/30*Math.random(),i.ranNorm=(t=1)=>(Math.random()-.5)*t,i.ranInt=t=>Math.round(Math.random()*t),i.oneIn=t=>Math.round(Math.random()*t)===t,i.ranSeq=t=>{let e=Math.sin(1e5*t);return e-Math.floor(e)},i.next=(t,e)=>{let s=t.indexOf(e);if(-1!==s)return s+1<t.length?t[s+1]:t[0]};var a=i;a.keyMap=0,a.keys={87:1,65:2,83:4,68:8,32:16},document.onkeydown=function(t){var e=t.keyCode||t.key;keys[e]&&(keyMap|=keys[e],t.preventDefault())},document.onkeyup=function(t){var e=t.keyCode||t.key;keyMap&keys[e]&&(keyMap^=keys[e],t.preventDefault())};var h=[{hasUpgrades:!1,enemies:{floater:5,sniper:0,seeker:0,launcher:0,bomber:0,boss:0}},{hasUpgrades:!1,enemies:{floater:0,sniper:3,seeker:0,launcher:0,bomber:0,boss:0}},{hasUpgrades:!1,enemies:{floater:3,sniper:0,seeker:12,launcher:0,bomber:0}},{hasUpgrades:!1,enemies:{floater:5,sniper:3,seeker:1,launcher:0,bomber:0}},{hasUpgrades:!0,up1:"cRapid",up2:"cDiagonal",enemies:{floater:4,sniper:2,seeker:2,launcher:1,bomber:1}},{hasUpgrades:!1,enemies:{floater:5,sniper:0,seeker:2,launcher:2,bomber:3}},{hasUpgrades:!0,up1:"cCross",up2:"cBomb",enemies:{floater:5,sniper:1,seeker:10,launcher:0,bomber:5}},{hasUpgrades:!1,enemies:{floater:25,sniper:1,seeker:5,launcher:1,bomber:0}},{hasUpgrades:!1,enemies:{floater:0,sniper:4,seeker:25,launcher:0,bomber:0}},{hasUpgrades:!1,enemies:{floater:0,sniper:1,seeker:20,launcher:0,bomber:5,boss:1}},{hasUpgrades:!1,enemies:{floater:0,sniper:0,seeker:5,launcher:0,bomber:0,boss:2}}];function r(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}var _=class{constructor(t={}){let e=this;e._parent=t.parent||"game",e._type=t.type||"entity",e._speed=t.speed||1,e._health=t.health||1,e._damage=t.damage||1,e._p=t.pos?{...t.pos}:{x:a._b.width/2,y:a._b.height/2,angle:0},e._v=t.vel?{...t.vel}:{x:0,y:0},e._constAngle=t.constAngle,e._collides=t.collides||!0,e._buildIn=t.buildIn||!1,e._buildSpeed=t.buildSpeed||1,e._hitrad=e._buildIn?1:t.hitrad||5,e._maxrad=t.maxrad||e._hitrad,e.isDead=!1}takeDamage(t){this._health-=t,this._health<=0&&this._die()}moveTo(t){this._p.x=t.x,this._p.y=t.y}_cCol(){let t=a.entities.filter((t=>a.sqDist(this._p,t._p)<a.sq(.6*this._hitrad)+a.sq(.6*t._hitrad)&&t._collides));this._handleCollisions(t)}_handleCollisions(t){}collides(t,e){return a.sqDist(this._p,t)<a.sq(.6*this._hitrad)+a.sq(.6*e)}_checkBounds(){return this._p.x-this._hitrad<2?1:this._p.x+this._hitrad>a._b.width?2:this._p.y-this._hitrad<2?3:this._p.y+this._hitrad>a._b.height?4:void 0}_die(){this.isDead=!0}_build(){this._hitrad<this._maxrad&&(this._hitrad+=this._buildSpeed)}_bounce(){switch(this._checkBounds()){case 1:return this._v.x=Math.abs(this._v.x),!0;case 2:return this._v.x=-Math.abs(this._v.x),!0;case 3:return this._v.y=-Math.abs(this._v.y),!0;case 4:return this._v.y=Math.abs(this._v.y),!0}}_updatePos(){this._p.x+=this._v.x*this._speed,this._p.y-=this._v.y*this._speed,this._p.angle=this._constAngle||r(this._p,this._target)}_updateVel(){this._v.x*=this._v.x>.1||this._v.x<.1?.95:0,this._v.y*=this._v.y>.1||this._v.y<.1?.95:0}update(t){this._buildIn&&this._build(),this.health<=0&&this._die(),this.collides&&this._cCol(),this._updatePos(),this._updateVel(),this._checkBounds(),this._render(t)}_draw(t){t.fillRect(this._p.x,this._p.y,20*this._hitrad/this._maxrad,20*this._hitrad/this._maxrad)}_render(t){t.save(),t.translate(this._p.x,this._p.y),t.rotate(this._p.angle),this._draw(t),t.restore()}},l=class extends _{constructor(t){super(t);let e=this;e._maxrad=t.maxrad||30,e._collides=!1,e._type="explosion",e._fill=t.fill}update(t){this._build(),this._hitrad>=this._maxrad?this._die():this._render(t)}_draw(t){let e=this._hitrad;t.strokeStyle=`rgba(0, 100, 0, ${.6-e/this._maxrad})`,t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.stroke(),this._fill&&(t.fillStyle=this.fill,t.fill())}},n=class extends _{constructor(t){super(t);let e=this;e._speed=t.speed||4,e._hitrad=8,e._collides=!0,e._type=1,e._damage=1,e._initiator=t.initiator,e._fillColor=t.fillColor,e._strokeColor,e._subTypes=["bullet","ripple","bomb","seeker","orbiter"],e._subType=t.subType||"bullet",e._initProjectileType()}static getTypes(){return["bullet","ripple","bomb","seeker","orbiter"]}_initProjectileType(){switch("function"==typeof this._subType?this._subType():this._subType){case"bullet":this._draw=t=>{let e=this._hitrad;t.fillStyle="rgba(2, 100, 2, 0.1)",t.fillRect(-e,-e/2,-e/2,e/2),t.fillStyle="rgba(2, 100, 2, 0.1)",t.fillRect(-e/2,-e/2,-e/2,e/2),t.fillStyle=this._fillColor||"rgba(0, 20, 100, 0.8)",t.fillRect(0,-e/2,-e/2,e/2)};break;case"bomb":this._v={x:0,y:0};let t=20;this._draw=e=>{let s,i;e.save(),2===this._parent?(s="#d31d1d",i="#870000"):(s="#4dc5f9",i="#3582e4"),e.beginPath(),e.fillStyle=s,e.arc(0,0,.6*t,0,2*Math.PI),e.fill();let a=(e,s)=>{e.rotate(Math.PI/2),e.beginPath(),e.fillStyle=s,e.moveTo(0,0),e.arc(0,0,.6*t,0,Math.PI/2),e.moveTo(0,0),e.fill()};a(e,i),a(e,s),a(e,i),e.restore()};break;case"seeker":this._health=5,this._hitrad=30,this._draw=t=>{let e=this._hitrad;t.beginPath(),t.arc(0,0,.6*e,0,2*Math.PI),t.fill(),t.stroke()};break;case"orbiter":this._hitrad=30,this._speed=.6,this._p={x:this._initiator._p.x+100,y:this._initiator._p.y},this._draw=t=>{a.circ(0,0,.6*this._hitrad,t)}}}_die(){let t=new l({pos:this._p});a.entities.push(t),this.isDead=!0}_handleCollisions(t){t.map((t=>{switch(t._type){case this._type:t._parent!=this._parent&&(t.takeDamage(this._damage),this.takeDamage(1));break;case this._parent:break;default:t.takeDamage(this._damage),this._die()}}))}update(t){switch(this._cCol(),this._subType){case"seeker":a.oneIn(5)&&(this._p.angle=r(this._p,a.player._p)),this._v.x+=Math.cos(this._p.angle)/10,this._v.y+=-Math.sin(this._p.angle)/10,this._p.x+=this._v.x*this._speed,this._p.y-=this._v.y*this._speed,this._updateVel();break;case"orbiter":this._p.angle=r(this._p,this._initiator._p),this._v.x+=Math.cos(this._p.angle)/10,this._v.y+=-Math.sin(this._p.angle)/10,this._p.x+=this._v.x*this._speed,this._p.y-=this._v.y*this._speed;break;default:this._checkBounds()&&this._die(),this._p.x+=this._v.x*this._speed,this._p.y-=this._v.y*this._speed,this._p.angle=this._constAngle}t.fillStyle="white",this._render(t)}},o=class extends _{constructor(t={}){super(t);let e=this;switch(e._spawn=t.spawn,e._subType=t.subType||"floater",e._speed=.5,e._type=2,e._projType=n.getTypes()[0],e._shots=1,e._firerate=14,e._projColor="#d31d1d",e._starttick=0,e._subType){case"floater":e._speed=.8,e._maxrad=30,e._hitrad=1,e._health=1,e._damage=1;break;case"sniper":e._health=2,e._maxrad=15,e._hitrad=1;break;case"seeker":e._speed=1.5,e._maxrad=20,e._hitrad=1,e._health=1,e._firerate=0;break;case"launcher":e._p.x=a._b.spawnPoints[e._spawn].x,e._p.y=a._b.spawnPoints[e._spawn].y,e._p.angle=r(e._p,a.player._p),e._speed=.1,e._maxrad=120,e._hitrad=120,e._health=20,e._buildIn=!1,e._shots=2,e._firerate=75,e._projType=n.getTypes()[3],e._projSpeed=1.5;break;case"bomber":e._p.x=a._b.spawnPoints[e._spawn].x,e._p.y=a._b.spawnPoints[e._spawn].y,e._p.angle=r(e._p,a.player._p),e._v={x:0,y:0},e._speed=.2,e._maxrad=100,e._hitrad=80,e._health=20,e._shots=1,e._firerate=150,e._projType=n.getTypes()[2];break;case"boss":e._p.x=a._b.spawnPoints[e._spawn].x,e._p.y=a._b.spawnPoints[e._spawn].y,e._p.angle=r(e._p,a.player._p),e._v={x:0,y:0},e._speed=.1,e._maxrad=100,e._hitrad=80,e._health=25,e._starttick=399}}_die(){a.entities.push(new l({pos:this._p})),this.isDead=!0}_shoot(){if(this._starttick%this._firerate==0&&this._starttick>100)for(let t=0;t<this._shots;t++){let e=this._p.angle+(a.ran()-.5)/10+2*Math.PI/this._shots*t;this._proj=new n({parent:2,initiator:this,subType:this._projType,pos:this._p,vel:{x:Math.cos(e),y:-Math.sin(e)},speed:this._projSpeed,constAngle:e,fillColor:this._projColor}),a.entities.push(this._proj)}}_changeTarget(){this._p.angle=r(this._p,a.player._p)}update(t){if(this.isDead)return;this._buildIn&&this._build(),0===this._health&&this._die(),this._cCol();let e=t=>{t._v.x+=Math.cos(t._p.angle)/10,t._v.y+=-Math.sin(t._p.angle)/10,t._p.x+=t._v.x*t._speed,t._p.y-=t._v.y*t._speed};switch(this._subType){case"floater":a.oneIn(100)&&(this._p.angle=r(this._p,a._b.ranPos())+a.ranRad()),e(this),this._bounce()&&(this._p.angle=r(this._p,a._b.ranPos()));break;case"sniper":this._v.x=0,this._v.y=0,a.oneIn(5)&&(this._p.angle=r(this._p,a.player._p)),this._shoot();break;case"seeker":this._starttick>100&&(a.oneIn(5)&&(this._p.angle=r(this._p,a.player._p)),e(this));break;case"launcher":this._p.angle=r(this._p,a.player._p),e(this),this._shoot();break;case"bomber":a.oneIn(80)&&(this._p.angle=r(this._p,a._b.ranPos())+a.ranRad()),e(this),this._bounce()&&(this._p.angle=r(this._p,a._b.ranPos())),this._shoot();break;case"boss":a.oneIn(1)&&(this._p.angle=r(this._p,a.player._p)),e(this),this._shots=4,this._firerate=10,this._projType=n.getTypes()[0],this._shoot(),this._shots=6,this._firerate=400,this._projType=n.getTypes()[4],this._shoot()}this._starttick++,this._updateVel(),this._render(t)}_draw(t){t.strokeWidth=10;let e=this._hitrad;switch(t.beginPath(),t.fillStyle="white",this._subType){case"floater":t.rotate(Math.PI/4),t.fillRect(-e/2,-e/2,e,e),t.strokeRect(-e/2,-e/2,e,e);break;case"sniper":t.fillRect(-e/2,-e/2,e,e),t.strokeRect(-e/2,-e/2,e,e);break;case"seeker":a.circ(.3*-e,0,.4*e,t),a.circ(1*e-.6*e,0,.4*e,t);break;case"launcher":a.circ(0,0,.6*e,t),a.circ(0,e/2,.2*e,t),a.circ(0,-e/2,.2*e,t);break;case"boss":a.circ(0,0,.6*e,t),a.circ(0,e/2,.2*e,t),a.circ(0,-e/2,.2*e,t),a.circ(e/2,0,.2*e,t),a.circ(-e/2,0,.2*e,t),t.beginPath();break;default:a.circ(0,0,.6*e,t)}}},p=s(0),c=s.n(p),d=s(1),u=s.n(d),b=s(2),y=s.n(b),g=s(3),A=s.n(g),m=s(4),w=s.n(m),k={cPointer:u.a,cRapid:c.a,cDiagonal:w.a,cCross:A.a,cBomb:y.a},T=class extends _{constructor(t){super(t);let e=this;e.subTypes=Object.keys(k),e._type=3,e._subType=e.subTypes[0],e._projType=n.getTypes()[0],e._health=3,e._speed=.5,e._shots=1,e._firerate=14,e._imgLoaded=!1,e._cursorImg=new Image,e.isDisabled=!1,e._cursorImg.onload=t=>{e._imgLoaded=!0},e._initPlayerType()}_initPlayerType(){let t=this;switch(t._cursorImg.src=k[t._subType],t._imgLoaded=!1,t._subType){case"cPointer":t._shots=1,t._firerate=14,t._projType=n.getTypes()[0];break;case"cRapid":t._shots=1,t._firerate=9;break;case"cDiagonal":t._shots=2,t._firerate=11;break;case"cCross":t._shots=4,t._firerate=11;break;case"cBomb":t._shots=1,t._firerate=30,t._projType=n.getTypes()[2]}}reset(){let t=this;t._subType=t.subTypes[0],t._cursorImg.src=k[t._subType],t._initPlayerType(),t._health=3,t.isDisabled=!1,t.isDead=!1,t._p.x=a._b.getCenter().x,t._p.y=a._b.getCenter().y,t._v.x=0,t._v.y=0}nextType(){this._subType=a.next(this.subTypes,this._subType),this._initPlayerType()}setType(t){this._subType=t,this._initPlayerType()}_handleCollisions(t){t.map((t=>{2===t._type&&(t.takeDamage(1),this.takeDamage(1))}))}_die(){a.entities.push(new l({pos:this._p})),this.isDead=!0}_shoot(){if(a.tick%this._firerate==0)for(let t=0;t<this._shots;t++){let e=this._p.angle+(a.ran()-.5)/10+2*Math.PI/this._shots*t;this._proj=new n({parent:3,subType:this._projType,pos:this._p,vel:{x:Math.cos(e),y:-Math.sin(e)},constAngle:e}),a.entities.push(this._proj)}}update(t){let e=this;e.isDead||(e._health<=0?e._die():(e._buildIn&&e._build(),e._cCol(),e._updatePos(),player.isDisabled||(a.keyMap&a.keys[87]&&(e._v.y+=e._speed),a.keyMap&a.keys[65]&&(e._v.x-=e._speed),a.keyMap&a.keys[83]&&(e._v.y-=e._speed),a.keyMap&a.keys[68]&&(e._v.x+=e._speed),a.keyMap&a.keys[32]&&e._shoot()),e._updateVel(),e._bounce(),e._render(t)))}_render(t){t.save(),t.translate(this._p.x,this._p.y),t.rotate(this._p.angle+Math.PI/2);let e=this,s=this._hitrad;if(this._imgLoaded){let i=1.5*e._cursorImg.width*s/e._maxrad,a=1.5*e._cursorImg.height*s/e._maxrad;t.drawImage(e._cursorImg,-i/2,-a/2,i,a)}else t.fillStyle="black",t.beginPath(),t.moveTo(-s,0),t.lineTo(0,-s),t.lineTo(s,0),t.strokeRect(-s/2,-s/2,s,s),t.stroke();t.restore()}},v=new class{constructor(t={}){a.queueOnLoad.push((t=>{let e=document,s=this;s._texts=[],s._numTexts=100,s._main=e.getElementById("main-block"),s._dialog=e.getElementById("base-dialog"),s._url=e.getElementById("url"),s._health=e.getElementById("health"),s._mainText=e.getElementById("main-text"),s._score=e.getElementById("score"),s._finalScoreBs=e.getElementsByClassName("final-score"),s._dDialog=e.getElementById("death-dialog"),s._uDialog=e.getElementById("upgrade-dialog"),s._wDialog=e.getElementById("win-dialog"),s._choice1=e.getElementById("choice1"),s._upgrade1=e.getElementById("upgrade-1"),s._choice2=e.getElementById("choice2"),s._upgrade2=e.getElementById("upgrade-2"),s._typeOuts=[];for(let t=0;t<s._numTexts;t++){let t=document.createElement("div");t.classList.add("back-text","abs"),t.style=`top: ${a.ranInt(100)}vh; left:${a.ranInt(100)}vw;`,t.textContent="/",s._texts.push(t),document.body.appendChild(t)}setInterval((t=>{let e=this._texts[a.ranInt(this._numTexts)-1];e&&(e.textContent=String.fromCharCode(a.ranInt(42)+48).toLowerCase())}),10)}))}setHealth(t){this._health.textContent="";for(let e=0;e<t;e++)this._health.textContent+="* "}setState(t){this._prevState=this._state,this._state=t,this._stateLoop()}typeOut(t,e){if(t&&t.id){this._typeOuts[t.id]?this._typeOuts[t.id].map((t=>clearTimeout(t))):this._typeOuts[t.id]=[],t.textContent="";for(let s=0;s<e.length;s++)this._typeOuts[t.id].push(setTimeout((i=>t.textContent+=e[s]),65*s))}}_stateLoop(){switch(this._state){case"WAIT_CHOOSE_BACK":this._prevState!==this._state&&this.typeOut(this._mainText,"^^^^ Level complete: travel back");break;case"START_LEVEL":this.clearDialogs(),setTimeout((t=>{this.typeOut(this._url,"____cursed____/?level="+(a._levels.length-a._level))}),333);break;case"START_WIN":this.clearDialogs(),this._wDialog.classList.add("visible","flex-center");break;case"PLAYING":this._prevState!==this._state&&this.typeOut(this._mainText,"W, A, S, D, SPACE to shoot");break;case"DEAD":this._prevState!==this._state&&(this.typeOut(this._mainText,"~~ sorry, you died :/ ~~"),this._dDialog.classList.add("visible","flex-center"))}}setScore(t){this._score.textContent=t}setFinalScore(t){for(let e=0;e<this._finalScoreBs.length;e++)this._finalScoreBs[e].textContent=t}showUpgrades(t={}){if(t.hasUpgrades){let{level:e,click1:s,click2:i}=t;this._uDialog.classList.remove("no-upgrades"),this._uDialog.classList.add("visible"),this._choice1.src=k[e.up1],this._choice2.src=k[e.up2],this._upgrade1.onclick=s,this._upgrade2.onclick=i}else this._uDialog.classList.add("visible","no-upgrades")}clearDialogs(){let t=document.getElementsByClassName("dialog");for(let e=0;e<t.length;e++)t[e].classList.contains("visible")&&t[e].classList.remove("visible")}createDialog(t={}){let{num:e,main:s="Contratulations!",sub:i="You have died",button:h=!1,classes:r=[],ran:_=!1,typeout:l=!1,pos:n=[]}=t,o=this._dialog.cloneNode(!0);if(o)return o.id=o.id+"-"+e,o.querySelector("#ui1")&&(o.querySelector("#ui1").textContent=s,o.querySelector("#ui1").id="main-"+e),o.querySelector("#ui2")&&(o.querySelector("#ui2").textContent=i),o.classList.add(...r,"active"),setTimeout((t=>{o.classList.add("visible")}),1),_&&(o.style=`top: ${20+a.ranInt(60)}vh; left:${20+a.ranInt(60)}vw; `),n&&(o.style=`top: ${n[1]}px; left:${n[0]}px; `),this._main.append(o),e}setUrl(t){this.typeOut(this._url,t)}},x=new class{constructor(){a.queueOnLoad.push((t=>{this.canvas=document.getElementById("_canvas"),this.cursor={x:0,y:0},this._scale(),this._listen()}))}_scale(){var t=window.devicePixelRatio||1;this._bounds=this.canvas.getBoundingClientRect(),this.canvas.width=this._bounds.width*t,this.canvas.height=this._bounds.height*t,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(t,t),this.ctx.imageSmoothingEnabled=!1,a._b={top:0,left:0,width:this._bounds.width,height:this._bounds.height},a._b.getCenter=t=>({x:a._b.width/2,y:a._b.height/2}),a._b.ranPos=t=>({x:50+a.ran(a._b.width-100),y:50+a.ran(a._b.height-100),angle:0}),a._b.spawnPoints=[{x:a._b.width/6,y:a._b.height/4},{x:a._b.width/6,y:a._b.height/4*3},{x:a._b.width/6*5,y:a._b.height/4},{x:a._b.width/6*5,y:a._b.height/4*3}]}_resize(){this._bounds=this.canvas.getBoundingClientRect(),this.canvas.width=this._bounds.width*dpr,this.canvas.height=this._bounds.height*dpr,a._b={top:0,left:0,width:this._bounds.width,height:this._bounds.height},a._b.getCenter=t=>({x:a._b.width/2,y:a._b.height/2}),a._b.ranPos=t=>({x:50+a.ran(a._b.width-100),y:50+a.ran(a._b.height-100),angle:0}),a._b.spawnPoints=[]}_listen(){document.addEventListener("mousemove",(t=>{this.cursor={x:t.clientX-this._bounds.left,y:t.clientY-this._bounds.top}})),this.cursor={x:this.canvas.width/2,y:this.canvas.height/2}}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawDeathScreen(){}drawBackground(){this.ctx.fillStyle="#DDD",this.ctx.fillRect(0,0,100,50),this.ctx.fillRect(this._bounds.width-50,0,this._bounds.width,50),this.ctx.fillRect(100,0,this._bounds.width-150,15),this.ctx.fillRect(100,35,this._bounds.width-150,15),this.ctx.fillStyle="#EEE"}drawBackButton(t=.2,e=1){this.ctx.globalAlpha=t,this.ctx.fillStyle="#FFF",this.ctx.fillRect(20,15,40,20),this.ctx.strokeStyle=e?`hsl(${e%255}, 100%, 40%)`:"#888",this.ctx.strokeRect(20,15,40,20),this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(40,20),this.ctx.lineTo(35,25),this.ctx.lineTo(40,30),this.ctx.stroke(),this.ctx.globalAlpha=1}drawReticule(){}drawFlash(){}drawLoader(){this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}_getBounds(){this._bounds=this.canvas.getBoundingClientRect()}};new class{constructor(){a.queueOnLoad.push((t=>{this._cc=x,this._canvas=this._cc.canvas,this._ctx=this._cc.ctx,this._ui=v,this._restartBs=document.getElementsByClassName("b-restart");for(let t=0;t<this._restartBs.length;t++)this._restartBs[t].addEventListener("click",(t=>this._restart()));this._score=0,this._backAlpha=.2,this.activeSequences=[],this._introSeq=!1,this._state="INTRODUCTION",this._level=0,this._levels=h,a._level=this._level,a._levels=h,a.player=new T({buildIn:!0,hitrad:15,maxrad:15}),a.entities.push(a.player),this._backPos={x:25,y:20},this._remaining=a.entities,this._prevtime=Date.now(),this._framerate=10,this.stateLoop()}))}_restart(){this._level=0,this._state="START_LEVEL",a._entities=[],a.player.reset(),this.stateLoop()}_startLevel(t){a.entities=[],a._level=t;let e=this._levels[t];a.player.moveTo(a._b.getCenter()),a.player.isDisabled=!1,a.entities.push(player),this._spawned=0,this._tospawn=0;let s=0;Object.keys(e.enemies).map((t=>{let i=a.ranInt(4),h=e.enemies[t];s++;for(let e=0;e<h;e++)this._tospawn++,setTimeout((s=>{let h=a._b.ranPos(),r=0;for(;a.sqDist(a._b.getCenter(),h)<a.sq(200)&&r<20;)h={x:a.ran(a._b.width),y:a.ran(a._b.height),angle:0},r++;let _=new o({pos:h,spawn:(e+i)%4,subType:t,buildIn:!0});for(;a.sqDist(a._b.getCenter(),a._b.spawnPoints[(e+i)%4])<a.sq(200)&&r<20;)_._pos={x:a.ran(a._b.width),y:a.ran(a._b.height),angle:0},r++;a.entities.push(_),this._spawned++}),700*e+Math.abs(1500*(5-s)))}))}stateLoop(){if(Date.now()-this._prevtime>this._framerate){switch(this._prevtime=Date.now(),this._ui.setState(this._state),this._state){case"INTRODUCTION":this._hasIntrod||(this._hasIntrod=!0,this._startIntroTick=a.tick,this._introState=0,a.player.moveTo(a._b.getCenter()),a.player.isDisabled=!0,a.entities.push(a.player));let t=a.tick-this._startIntroTick;t%15==0&&a.player.nextType(),t>0&&0==this._introState&&(this._introState++,this._ui.createDialog({num:1,main:"",sub:"",classes:["top-center","small","wide","t-left"],pos:[400,10]}),this._ui.typeOut(document.getElementById("main-1"),"You were a shapeshifter...")),t>100&&1==this._introState&&(this._introState++,this._ui.createDialog({num:2,main:"",sub:"",classes:["top-center","small","wide","t-left"],pos:[500,100]}),this._ui.typeOut(document.getElementById("main-2"),"But you were CURSED, forced to occupy a single form.")),t>350&&2==this._introState&&(this._introState++,this._ui.createDialog({num:3,main:"",sub:"",classes:["top-center","small","wide","t-left"],pos:[150,350]}),this._ui.typeOut(document.getElementById("main-3"),"You were cast forward into the depths of the browser.")),t>600&&3==this._introState&&(this._introState++,this._ui.createDialog({num:4,main:"",sub:"",classes:["top-center","small","wide","t-left"],pos:[200,280]}),this._ui.typeOut(document.getElementById("main-4"),"Fight your way back . . . . .")),t>900&&(a.player.setType("cPointer"),this._state="START_LEVEL"),this._play();break;case"START_CHOOSE_UPGRADES":let e=a._levels[a._level];this._ui.showUpgrades({levelNum:a._level,level:e,hasUpgrades:e.hasUpgrades,click1:t=>{a.player.setType(e.up1),this._state="START_LEVEL"},click2:t=>{a.player.setType(e.up2),this._state="START_LEVEL"}}),a._levels[a._level].hasUpgrades||setTimeout((t=>{this._ui.clearDialogs(),this._state="START_LEVEL"}),5e3),this._state="WAIT_CHOOSE_UPGRADES";break;case"WAIT_CHOOSE_UPGRADES":case"WAIT_WIN":default:this._play();break;case"START_LEVEL":this._backAlpha=.2,this._startLevel(this._level),this._state="PLAYING";break;case"LEVEL_CLEAR":this._level+1<this._levels.length?(this._level++,a._level=this._level,a.player._health=3,this._ui.setHealth(3),this._state="WAIT_CHOOSE_BACK",a.entities.push(new l({pos:this._backPos})),a.entities.map((t=>{1===t._type&&t._die()}))):this._state="START_WIN";break;case"WAIT_CHOOSE_BACK":a.player.collides(this._backPos,50)&&(a.entities.push(new l({pos:this._backPos,fill:"#111",maxrad:1e5,buildSpeed:5})),this._state="START_CHOOSE_UPGRADES"),this._play(),this._cc.drawBackButton(1,a.tick);break;case"START_WIN":this._ui.setFinalScore(this._score),this._state="WAIT_WIN";break;case"DEAD":this._ui.setFinalScore(this._score),this._play();break;case"PLAYING":if(this._score++,a.player.isDead){this._state="DEAD";break}if(this._tospawn===this._spawned&&0===a.entities.filter((t=>2===t._type)).length){this._state="LEVEL_CLEAR";break}this._play()}a.tick++,this._ui.setScore(this._score)}requestAnimationFrame((t=>this.stateLoop()))}_play(){this._cc.ctx.beginPath(),this._cc.clear(),this._cc.drawBackground(),a.player._target=this._cc.cursor,this._ui.setHealth(a.player._health),a.entities=a.entities.sort(((t,e)=>t._type-e._type)),this._remaining=[];for(let t=0;t<a.entities.length;t++){let e=a.entities[t];e.isDead||(e.update(this._ctx),this._remaining.push(e))}a.entities=this._remaining}},s(5)}])</script>