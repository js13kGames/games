<!doctype html><title>Teleport</title><script src=/2021/webxr/aframe.js></script><script>var g_scene=null,g_vrMode=-1,energyDiv=null,ENERGY_MAX=8,mouseDownCount=0;AFRAME.registerComponent("game",{init:function(){g_scene=document.querySelector("a-scene"),(energyDiv=document.createElement("div")).setAttribute("id","infoPanel"),energyDiv.setAttribute("style","position: absolute; top: 0; left: 0; right: 0; height: 50px; display: flex; flex-direction: column; align-items: center; justify-content: center;  color: white; font-family: arial, helvetica, sans-serif");var e="";e+='<div style="display: flex; margin-bottom: 6px">',e+='<div style="margin-right: 6px; display: flex; align-items: center">Energy</div>',e+='<div style="display: flex; align-items: center">';for(var t=0;t<8;t++)e+='<div id="energy_'+t+'" style="width: 16px; height: 16px; background-color: #0f0; margin-right: 4px"></div>';e+="</div>",e+='<div id="restart-button" style="display: flex; align-items: center; margin-left: 8px; cursor: pointer; height: 20px; color: #eee; background-color: #333; padding: 6px">Restart Level</div>',e+="</div>",e+='<div style="display: flex" id="instructions"></div>',energyDiv.innerHTML=e,document.body.appendChild(energyDiv),document.getElementById("restart-button").addEventListener("click",(function(e){g_playfield.restartLevel()})),(g_playfield=new Playfield).init(),g_sound=new Sound,document.addEventListener("mousedown",(function(e){g_sound.init(),g_vrMode||0==mouseDownCount&&(mouseDownCount++,g_playfield.buttonDown(e))})),document.addEventListener("mouseup",(function(e){g_vrMode||(mouseDownCount>0&&mouseDownCount--,g_playfield.buttonUp(e))}))},tick:function(e,t){for(g_scene.is("vr-mode")?!1!==g_vrMode&&-1!==g_vrMode||(g_vrMode=!0,energyDiv.style.display="none",g_playfield.modeChange()):!0!==g_vrMode&&-1!==g_vrMode||(g_vrMode=!1,energyDiv.style.display="flex",g_playfield.modeChange());t>0;){var n=40;n>t&&(n=t),t-=n,g_playfield.tick(e,n)}}});var g_startLevel=0,g_playfield=null,g_playfieldScale=1,g_raycaster=null,g_leftButtonDownCount=0,g_rightButtonDownCount=0,g_rightController=!1,g_leftController=!1,STATE_LEVEL_PREVIEW=0,STATE_PLAYING=1,STATE_IN_TELEPORT=2,STATE_LEVEL_FINISHED=3,STATE_TELEPORT_NEXT=4,STATE_GAME_OVER=5;AFRAME.registerComponent("controller-connected",{init:function(){var e=this.el;e.addEventListener("controllerconnected",(function(e){"right"==e.detail.component.data.hand&&(g_rightController=!0),"left"==e.detail.component.data.hand&&(g_leftController=!0)})),e.addEventListener("controllerdisconnected",(function(e){"right"==e.detail.component.data.hand&&(g_rightController=!1),"left"==e.detail.component.data.hand&&(g_leftController=!1)}))}});var Playfield=function(){var e=0,t=!1,n=!0,o=!1,i=!1,r=!1,a=!1,s=!1,l=this,c=null,u=STATE_LEVEL_PREVIEW,d=new THREE.Vector3,E=new THREE.Vector3,g=0,f=0,p=0,b=0,A=null,T=null,m=!1,y=!1,_=null,v=null,h=null,D=null,R=null,P=null,w=[],S=[],L=null,O=null,I=null,x=new THREE.Vector3,V=new THREE.Vector3,N=null,M=null,H=null,B=null,G=null,C=null,k=null,j=[],z=!1,U=!1,Y=g_scene.object3D,W=[],K=new THREE.Vector3,q=new THREE.Vector3,X=!1,F=new THREE.Vector3,Z=new THREE.Vector3(0,0,0),J=0;l.setEnergyFromTo=function(e,t){K.set(e.x,e.y+.3,e.z),q.set(t.x,t.y,t.z)},l.setEnergyTransferring=function(e){X=e},l.updateEnergyBlocks=function(e,t){for(var n=0;n<W.length;n++)if(W[n].mesh.visible){var o=W[n].mesh;F.set(q.x-o.position.x,q.y-o.position.y,q.z-o.position.z);var i=Z.distanceTo(F);F.normalize();var r=.008*t;r>i&&(r=i),r<.001?o.visible=!1:o.position.set(o.position.x+r*F.x,o.position.y+r*F.y,o.position.z+r*F.z)}if(X&&e-J>50){for(n=0;n<W.length;n++)if(0==W[n].mesh.visible){W[n].mesh.visible=!0,g_sound.playSound(SOUND_ENERGY),W[n].mesh.position.set(K.x+.4*Math.random()-.2,K.y+.4*Math.random()-.2,K.z+.4*Math.random()-.2);break}J=e}};var Q=[],$=new THREE.Vector3,ee=new THREE.Vector3,te=!1,ne=new THREE.Vector3,oe=0;function ie(){(L=document.createElement("a-entity")).setAttribute("class","non-removable");var e=new THREE.ConeGeometry(.4,1.8,3),t=new THREE.MeshStandardMaterial({color:16776960,transparent:!0});t.flatShading=!0;var n=new THREE.Mesh(e,t);n.position.set(0,.9,0),L.setObject3D("mesh",n);var o=new THREE.IcosahedronGeometry(.4,1),i=new THREE.Mesh(o,t);i.position.set(0,.7,0),n.add(i);var r=document.createElement("a-triangle");r.setAttribute("color","#eee"),r.setAttribute("rotation","0 270 90"),r.setAttribute("side","double"),r.setAttribute("scale","0.2 0.26 0.2"),r.setAttribute("position","0 1.65 -0.7"),L.append(r);var a=document.createElement("a-text");a.setAttribute("value","Start Position"),a.setAttribute("scale","3 3 3"),a.setAttribute("side","double"),a.setAttribute("color","#bbb"),a.setAttribute("position","0 3 2"),a.setAttribute("rotation","0 90 0"),L.append(a),I=document.getElementById("player-collision-box"),C.append(L)}l.setEnergyDrainFromTo=function(e,t){$.set(e.x,e.y,e.z),ee.set(t.x,t.y+1.5,t.z)},l.setEnergyDrainTransferring=function(e){te=e},l.updateEnergyDrainBlocks=function(e,t){for(var n=0;n<Q.length;n++)if(Q[n].mesh.visible){var o=Q[n].mesh;ne.set(ee.x-o.position.x,ee.y-o.position.y,ee.z-o.position.z);var i=Z.distanceTo(ne);ne.normalize();var r=.008*t;r>i&&(r=i),r<.001?o.visible=!1:o.position.set(o.position.x+r*ne.x,o.position.y+r*ne.y,o.position.z+r*ne.z)}if(te&&e-oe>40){for(n=0;n<Q.length;n++)if(0==Q[n].mesh.visible){Q[n].mesh.visible=!0,g_sound.playSound(SOUND_ENERGY2),Q[n].mesh.position.set($.x+.4*Math.random()-.2,$.y+.4*Math.random()-.2,$.z+.4*Math.random()-.2);break}oe=e}},l.showEnergy=function(){for(var e=c.getEnergy(),t=0;t<ENERGY_MAX;t++){document.getElementById("energy_"+t).style.backgroundColor=t<e?"#0f0":"#111"}for(t=0;t<j.length;t++)j[t].setEnergy(e)},l.buildCollisionObjectList=function(){S=[];for(var e=0;e<w.length;e++)if(w[e].getIsSolid()){var t=w[e].getObject();S.push(t)}u==STATE_PLAYING&&(I.object3D.isPlayer=!0,I.object3D.children.length>0&&(I.object3D.children[0].isPlayer=!0,S.push(I.object3D.children[0])),S.push(I.object3D))},l.getCollisionObjects=function(){return S};var re=[],ae=[],se=new THREE.Vector3,le=new THREE.Vector3;function ce(e,t){se.copy(e.ray.origin),le.copy(e.ray.origin),le.addScaledVector(e.ray.direction,40),e.near=0,e.far=40;var n=e.intersectObjects(re,!0);if(n.length>0){var o=n[0].object;if(le.copy(n[0].point),void 0!==o.userData.padIndex){var i=w[o.userData.padIndex];ae.push(i.getPadIndex()),i.highlight()}}if(t){var r=t.geometry.attributes.position.array,a=0;r[a++]=se.x,r[a++]=se.y,r[a++]=se.z,r[a++]=le.x,r[a++]=le.y,r[a++]=le.z,t.geometry.attributes.position.needsUpdate=!0,t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere()}}function ue(){g_vrMode?(C.setAttribute("position",new THREE.Vector3(-g*g_playfieldScale,1,f*g_playfieldScale)),k.setAttribute("position","0 1 -0"),G.setYPosition(1.8)):(C.setAttribute("position",new THREE.Vector3(-g*g_playfieldScale,1.4,f*g_playfieldScale)),k.setAttribute("position","0 0.1 0"),G.setYPosition(.86))}function de(){m=-A.object3D.position.x,y=-A.object3D.position.z,T.object3D.position.setX(m),T.object3D.position.setZ(y)}function Ee(){for(var e=0;e<w.length;e++)w[e].unhighlight()}l.init=function(){c=new Player(this),O=document.getElementById("player-shadow"),C=document.getElementById("playfield"),document.getElementById("playfield-holder"),B=document.getElementById("level-text"),A=document.getElementById("camera"),T=document.getElementById("camera-offset"),k=document.getElementById("level-info"),(g_raycaster=new THREE.Raycaster).near=0,g_raycaster.far=1e4;var e=new THREE.LineBasicMaterial({color:16777215});D=document.getElementById("laser-left");var t=[];t.push(new THREE.Vector3(0,0,0)),t.push(new THREE.Vector3(0,10,0));var n=(new THREE.BufferGeometry).setFromPoints(t);R=new THREE.Line(n,e),Y.add(R),h=new InfoPanel(document.getElementById("left-info")),j.push(h);var o=new THREE.MeshStandardMaterial({color:6711039,transparent:!0,opacity:1,emissive:4474026}),i=new THREE.MeshStandardMaterial({color:16777215,transparent:!0,opacity:1,emissive:16777215});o.flatShading=!0;for(var r=new THREE.BoxGeometry(.05,.05,.05),s=0;s<30;s++){var d=!1;if(Math.random()>.7){d=new THREE.Mesh(r,o);var E=.5+.5*Math.random();d.scale.set(E,E,E)}else d=new THREE.Mesh(r,i),E=.3*Math.random(),d.scale.set(E,E,E);W.push({mesh:d}),Y.add(d)}for(s=0;s<30;s++)d=!1,Math.random()>.7?(d=new THREE.Mesh(r,o),E=.5+.5*Math.random(),d.scale.set(E,E,E)):(d=new THREE.Mesh(r,i),E=.4*Math.random(),d.scale.set(E,E,E)),Q.push({mesh:d}),Y.add(d);D.addEventListener("buttondown",(function(e){g_sound.init(),z=p,h.setButtonDown(!0),0==g_leftButtonDownCount&&(g_leftButtonDownCount++,l.buttonDown(e)),u===STATE_LEVEL_PREVIEW&&l.startLevel()})),D.addEventListener("buttonup",(function(e){g_leftButtonDownCount>0&&g_leftButtonDownCount--,h.setButtonDown(!1),z=!1,!1===U&&(a=!1),l.buttonUp(e)})),(t=[]).push(new THREE.Vector3(0,0,0)),t.push(new THREE.Vector3(0,10,0)),n=(new THREE.BufferGeometry).setFromPoints(t),v=new THREE.Line(n,e),Y.add(v),_=document.getElementById("laser-right"),P=new InfoPanel(document.getElementById("right-info")),j.push(P),_.addEventListener("buttondown",(function(e){g_sound.init(),U=p,P.setButtonDown(!0),u===STATE_LEVEL_PREVIEW&&l.startLevel(),0==g_rightButtonDownCount&&(g_rightButtonDownCount++,l.buttonDown(e))})),_.addEventListener("buttonup",(function(e){g_rightButtonDownCount>0&&g_rightButtonDownCount--,P.setButtonDown(!1),U=!1,!1===z&&(a=!1),l.buttonUp(e)})),G=new StartButton(this),l.gotoLevel(g_startLevel)},l.buttonDown=function(e){for(var t=0;t<w.length;t++)w[t].buttonDown(e)},l.buttonUp=function(e){for(var t=0;t<w.length;t++)w[t].buttonUp(e)},l.clearLevel=function(){for(var e=0;e<w.length;e++)w[e].cleanup();for(w=[];C.children.length>0;){var t=!1;for(e=0;e<C.children.length;e++)if("non-removable"!==C.children[e].getAttribute("class")){t=e;break}if(!1===t)break;C.removeChild(C.children[t])}},l.setControllerInfoVisible=function(e){document.getElementById("left-info").object3D.visible=e,document.getElementById("right-info").object3D.visible=e},l.modeChange=function(){g_vrMode?(l.setControllerInfoVisible(!0),O.object3D.visible=!1,D&&g_leftController&&(R.visible=!0),_&&g_rightController&&(v.visible=!0)):(l.setControllerInfoVisible(!1),O.object3D.visible=!0,R.visible=!1,v.visible=!1),u==STATE_LEVEL_PREVIEW&&ue()},l.restartLevel=function(){l.gotoLevel(e)},l.gotoLevel=function(t){document.getElementById("instructions").innerHTML="",null!=h&&h.setRestartText(""),null!=P&&P.setRestartText(""),l.clearLevel(),e=t,u=STATE_LEVEL_PREVIEW;for(var n=0;n<4;n++)null!=h&&h.setText(n,""),null!=P&&P.setText(n,"");var o=t+1;B.setAttribute("value","Level "+o),l.build(),f=(E.z+d.z)/2,g=(E.x+d.x)/2,g_playfieldScale=.08,ue(),C.setAttribute("scale",new THREE.Vector3(g_playfieldScale,g_playfieldScale,g_playfieldScale)),C.setAttribute("rotation","0 180 0"),c.setPosition(-1.2,0,0,0,-90,0),de(),g_vrMode&&-1!==g_vrMode||(A.setAttribute("look-controls",!1),A.setAttribute("wasd-controls",!1),A.object3D.rotation.set(0,0,0),A.setAttribute("rotation","0 0 0"),A.setAttribute("look-controls",!0),A.setAttribute("wasd-controls",!0),A.components["look-controls"].pitchObject.rotation.x=0,A.components["look-controls"].yawObject.rotation.y=0),G.show(),L.object3D.visible=!0,B.object3D.visible=!0,M.object3D.visible=!0},l.getGameState=function(){return u},l.startLevel=function(){if(u!=STATE_PLAYING){g_sound.playSound(SOUND_CLICK);for(var t=0;t<w.length;t++)w[t].setClickable(!0);Ee(),c.startTeleport(V.x,V.y,V.z,0,0,0,(function(t,n){L.object3D.visible=!1,M.object3D.visible=!1,de(),c.setPosition(V.x,V.y,V.z,0,0,0),"arrived"==t&&(Ee(),C.setAttribute("position",new THREE.Vector3(0,0,0)),C.setAttribute("rotation","0 0 0"),g_playfieldScale=1,C.setAttribute("scale","1 1 1"),B.object3D.visible=!1,G.hide(),function(){for(var t="",n=0;n<4;n++){var o="";n<g_levels[e].text.length&&(o=g_levels[e].text[n]),t+=" "+o,h.setText(n,o),P.setText(n,o)}document.getElementById("instructions").innerHTML=t,speak(t)}())})),u=STATE_PLAYING,n=!0}},l.build=function(){d.x=1e4,d.y=1e4,d.z=1e4,E.x=-1e4,E.y=-1e4,E.z=-1e4;var n=g_levels[e].data,o=g_levels[e].startRotation;rotationSpeed=70,void 0!==g_levels[e].robotSpeed&&(rotationSpeed=g_levels[e].robotSpeed);for(var i=0;i<n.length;i++){var r=n[i][0],a=w.length,s=new Pad(l,C,a,r);C.append(s.getEntity()),d.x=Math.min(d.x,n[i][1]),d.y=Math.min(d.y,n[i][2]),d.z=Math.min(d.z,n[i][3]),E.x=Math.max(E.x,n[i][1]),E.y=Math.max(E.y,n[i][2]),E.z=Math.max(E.z,n[i][3]),s.setPosition(n[i][1],n[i][2],n[i][3]),s.setRotation(n[i][4],n[i][5],n[i][6]),s.setClickable(!1),w.push(s),c.setEnergy(g_levels[e].energy),r==START_PAD&&(null==L&&ie(),L.setAttribute("position",new THREE.Vector3(n[i][1],n[i][2],n[i][3])),L.setAttribute("rotation",new THREE.Vector3(0,o,0)),V.set(n[i][1],n[i][2],n[i][3]),t=a),2==r&&(null==N&&((N=document.createElement("a-entity")).setAttribute("class","non-removable"),H=new Exit(N),(M=document.createElement("a-text")).setAttribute("value","Exit"),M.setAttribute("scale","3 3 3"),M.setAttribute("side","double"),M.setAttribute("color","#bbb"),M.setAttribute("position","0 3 0.6"),M.setAttribute("rotation","0 90 0"),N.append(M),C.append(N)),N.setAttribute("position",new THREE.Vector3(n[i][1],n[i][2],n[i][3])))}S=[]},l.getCurrentPadIndex=function(){return t},l.getOnPad=function(){return n},l.noEnergy=function(){null!=h&&(h.setText(0,"No Energy"),h.setText(1,"Hold button for 1 second"),h.setText(2,"to restart level"),h.setText(3,"")),null!=P&&(P.setText(0,"No Energy"),P.setText(1,"Hold button for 1 second"),P.setText(2,"to restart level"),P.setText(3,""))},l.hasEnergy=function(){for(var t=0;t<4;t++){var n="";t<g_levels[e].text.length&&(n=g_levels[e].text[t]),null!=h&&h.setText(t,n),null!=P&&P.setText(t,n)}},l.teleportPlayer=function(e,n,o,i,r,a,s,l){if(0==c.getEnergy())return speak(g_vrMode?"No energy to teleport, hold the button for one second to restart":"No energy to teleport"),void g_sound.playSound(SOUND_DIE);2==s?g_sound.playSound(SOUND_DONE):g_sound.playSound(SOUND_TELEPORT),u=STATE_IN_TELEPORT,c.startTeleport(e,n,o,i,r,s,(function(e,n){t=a,de();for(var o=0;o<w.length;o++)w[o].playerTeleported(a,n);void 0!==l&&l(),"finished"==e&&(u=STATE_PLAYING,2==n&&(u=STATE_LEVEL_FINISHED,b=p,speak("Level Complete. Well done")))})),c.decreaseEnergy(s!==EXIT_PAD)},l.getPlayerPosition=function(){return I.object3D.getWorldPosition(x),x},l.getPlayer=function(){return c},l.increasePlayerEnergy=function(){c.increaseEnergy(),g_sound.playSound(SOUND_ADD_ENERGY)},l.decreasePlayerEnergy=function(){c.decreaseEnergy()},l.gameOver=function(){u!==STATE_GAME_OVER&&(g_sound.playSound(SOUND_GAME_OVER),speak("Energy Drained. Game Over"),l.setEnergyTransferring(!1),l.setEnergyDrainTransferring(!1),u=STATE_GAME_OVER,b=p)},l.tick=function(t,d){u==STATE_LEVEL_FINISHED&&t-b>3200&&(u=STATE_TELEPORT_NEXT,b=t),u==STATE_GAME_OVER&&t-b>3600&&l.gotoLevel(e),u==STATE_TELEPORT_NEXT&&function(t,n){t-b>2&&(++e>=g_levels.length&&(e=0,speak("Congratulations, you have finished all of the levels")),l.gotoLevel(e))}(t),l.buildCollisionObjectList();for(var E=0;E<w.length;E++)w[E].tick(t,d);var g=A.object3D.position;if(O.object3D.position.setX(g.x+m),O.object3D.position.setZ(g.z+y),I.object3D.position.setX(g.x+m),I.object3D.position.setZ(g.z+y),I.object3D.position.setY(g.y-.24),u==STATE_PLAYING){var f=Math.sqrt((g.x+m)*(g.x+m)+(g.z+y)*(g.z+y));if(!1!==z||!1!==U){var T=!1;for(E=0;E<w.length;E++)if(w[E].getInAbsorb()){T=!0;break}T&&(!1!==z&&(z=t),!1!==U&&(U=t))}!1!==z&&t-z>1200||!1!==U&&t-U>2e3?T||(a||(speak("Button held for one second, the level will restart in three"),null!=h&&h.setRestartText("Restarting Level..."),null!=P&&P.setRestartText("Restarting Level..."),a=!0,s=t,r=3),3==r&&t-s>4600&&(g_hasSpeech||l.gotoLevel(e),speak("two"),r--),2==r&&t-s>5400&&(speak("one"),r--),1==r&&t-s>6200&&(speak("level restart"),l.gotoLevel(e))):(a&&(null!=h&&h.setRestartText(""),null!=P&&P.setRestartText("")),a=!1),f>1.5?(n&&(n=!1,o=t,i=!1,r=3),t-o>400&&!i&&(speak("You are not on your pad, the level will restart in three"),i=!0,r=3,o=t+3e3),i&&(3==r&&t-o>1e3&&(speak("two"),r--,o=t),2==r&&t-o>1e3&&(speak("one"),r--,o=t),1==r&&t-o>1600&&(speak("level restart"),l.gotoLevel(e)))):(!1===n&&speak("You are back on your pad"),n=!0,i=!1)}p=t,function(){if(g_vrMode){if(function(){re=[];for(var e=0;e<w.length;e++)if(w[e].getIsSolid()){var t=w[e].getPadObject3D();t&&re.push(t);var n=w[e].getBoxObject3D();n&&re.push(n)}}(),ae=[],g_leftController){if(D&&void 0!==D.components.raycaster&&void 0!==D.components.raycaster.raycaster){ce(D.components.raycaster.raycaster,R);for(var e=0;e<D.object3D.children.length;e++)"Line"==D.object3D.children[e].type&&(D.object3D.children[e].visible=!1)}R.visible=!0,document.getElementById("left-info").object3D.visible=!0}else R.visible=!1,document.getElementById("left-info").object3D.visible=!1;if(g_rightController){if(_&&void 0!==_.components.raycaster&&void 0!==_.components.raycaster.raycaster)for(ce(_.components.raycaster.raycaster,v),e=0;e<_.object3D.children.length;e++)"Line"==_.object3D.children[e].type&&(_.object3D.children[e].visible=!1);v.visible=!0,document.getElementById("right-info").object3D.visible=!0}else v.visible=!1,document.getElementById("right-info").object3D.visible=!1;for(e=0;e<w.length;e++)w[e].getPadHighlighted()&&-1==ae.indexOf(w[e].getPadIndex())&&w[e].unhighlight()}}(),c.tick(t,d),H.tick(t,d),l.updateEnergyBlocks(t,d),l.updateEnergyDrainBlocks(t,d)}},Player=function(e){var t=this,n=document.getElementById("player"),o=document.getElementById("camera"),i=[],r=new THREE.Vector3,a=new THREE.Vector3,s=!1,l=!1,c=!1,u=0,d=!1,E=0,g=8;t.getPosition=function(){return n.getAttribute("position")},t.getEnergy=function(){return g},t.increaseEnergy=function(){g<ENERGY_MAX&&(0==g&&e.hasEnergy(),g++,e.showEnergy())},t.decreaseEnergy=function(t){g>0?(g--,e.showEnergy(),0==g&&(void 0!==t&&!0!==t||speak("Warning, zero energy"),e.noEnergy())):e.gameOver()},t.setEnergy=function(t){g=t,e.showEnergy()},t.startTeleport=function(e,t,n,o,i,u,f){g<=0||(r.set(e,t,n),a.set(o,E,i),l=0,c=1,d=u,s=f)},t.updateTeleport=function(){if(1===c){for(var e=0;e<i[l].length;e++)i[l][e].object3D.visible=!0,i[l][e].setAttribute("color","#ffffff");if(l>0)for(e=0;e<i[l-1].length;e++)i[l-1][e].setAttribute("color","#cccccc");if(l>1)for(e=0;e<i[l-1].length;e++)i[l-1][e].setAttribute("color","#aaaaaa");++l>=i.length&&(l=0,c=-1,t.moveToTeleport())}else if(-1===c){for(e=0;e<i[l].length;e++)i[l][e].object3D.visible=!1,i[l][e].setAttribute("color","#ffffff");++l>=i.length&&(c=!1,void 0!==s&&s("finished",d))}},t.setPosition=function(e,t,o,i,r,a){E=r,n.setAttribute("position",new THREE.Vector3(e,t,o)),n.setAttribute("rotation",new THREE.Vector3(i,r,a))},t.moveToTeleport=function(){var e=0,t=0,o=0;switch(a.z){case 90:o=-1;break;case 180:e=-1;break;case 270:o=1}switch(a.x){case 90:t=1;break;case 180:e=-1;break;case 270:t=-1}0==a.x&&0==a.z&&(e=1),e=0,t=0,o=0,n.setAttribute("position",new THREE.Vector3(r.x+o,r.y+e,r.z+t)),n.setAttribute("rotation",new THREE.Vector3(a.x,E,a.z)),void 0!==s&&s("arrived",d)},t.tick=function(e,n){e-u>30&&(!1!==c&&t.updateTeleport(),u=e)},function(){for(var e,t,n,r=2*Math.PI*1/40+.1,a=0,s=0,l=0,c=0,u=0;u<40;u++){s=u*Math.PI*2/40,l=1*Math.cos(s),c=1*Math.sin(s),e=l,t=2*Math.PI*e,n=Math.round(t/r+.5);for(var d=[],E=0;E<=n;E++){a=E*Math.PI*2/n;var g=e*Math.cos(a),f=e*Math.sin(a),p=document.createElement("a-plane"),b=r-.04+.15,A=r-.1+.16;p.setAttribute("scale",new THREE.Vector3(b,A,.007)),p.setAttribute("color","#333333"),p.setAttribute("material","side: double;shader: flat;"),p.setAttribute("position",new THREE.Vector3(g,c+1,f)),p.setAttribute("rotation",new THREE.Vector3(-360*u/40,90-360*E/n,0)),p.yPosition=c,p.object3D.visible=!1,o.append(p),d.push(p)}d.length>0&&i.push(d)}i.sort((function(e,t){return e[0].yPosition-t[0].yPosition}))}()},Exit=function(e){var t=0,n=document.createElement("a-cylinder");n.setAttribute("color","#0044ff"),n.setAttribute("opacity","0.6"),n.setAttribute("scale","0.44 0.02 0.44"),n.setAttribute("position","0 0.02 0"),e.append(n);for(var o=[],i=new THREE.BoxGeometry(.1,30,.1),r=0;r<30;r++){var a=new THREE.MeshStandardMaterial({color:1118719,transparent:!0,opacity:.8,emissive:4474111}),s=new THREE.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.8,emissive:16777215});a.flatShading=!0;var l=!1;if(Math.random()>.7){l=new THREE.Mesh(i,a);var c=.5+.5*Math.random();l.scale.set(c,c,c)}else l=new THREE.Mesh(i,s),c=.3*Math.random(),l.scale.set(c,c,c);o.push({mesh:l}),n.object3D.add(l)}this.tick=function(e,n){for(var i=0;i<o.length;i++)o[i].mesh.visible&&(distance=o[i].mesh.position.y+.06*n,o[i].mesh.material.opacity=(120-distance)/120,distance>120&&(o[i].mesh.visible=!1),o[i].mesh.position.setY(distance));if(e-t>50){for(i=0;i<o.length;i++)if(0==o[i].mesh.visible){o[i].mesh.visible=!0,o[i].mesh.material.opacity=.6,o[i].mesh.position.set(1.5*Math.random()-.7,12,1.5*Math.random()-.7);break}t=e}}},rotationSpeed=70,Pad=function(e,t,n,o){var i=this,r=!1,a=!1,s=!1,l=!1,c=new THREE.Vector3(0,1,0),u=o,d=!0,E=n,g=!1,f=!1,p=!1,b=[],A=!1,T=0,m=null,y=!1,_=!1,v=new THREE.Vector3,h=new THREE.Vector3(0,0,-1),D=!1,R=g_scene.object3D,P=!1,w=!1,S=0,L=0,O=0,I=0,x=0,V=!1,N=!1;i.setClickable=function(e){a&&(e?a.setAttribute("class","clickable"):a.setAttribute("class",""))},i.getObject=function(){return r.object3D},i.getInAbsorb=function(){return!1!==w};var M=function(){if(P){P=!1,w=!1,e.setEnergyTransferring(!1),r.removeChild(f),f=null,e.increasePlayerEnergy(),N&&(N=!1,e.setEnergyDrainTransferring(!1));for(var t=0;t<b.length;t++)R.remove(b[t].mesh),b[t].geometry.dispose();b=[]}};i.cleanup=function(){M()};var H=function(){if(E===e.getCurrentPadIndex())return!1;if(!e.getOnPad())return!1;var t=e.getPlayer().getPosition();return new THREE.Vector3(t.x-S,t.y-L,t.z-O).dot(c)>=0};i.highlight=function(){if(e.getGameState()==STATE_PLAYING&&H())switch(D||g_sound.playSound(SOUND_CLICK),u){case GREEN_PAD:a.setAttribute("color","#8f8");break;case RED_PAD:a.setAttribute("color","#f88");break;default:a.setAttribute("color","#ffd")}D=!0},i.unhighlight=function(){if(D=!1,a)switch(u){case GREEN_PAD:a.setAttribute("color","#0a0");break;case RED_PAD:a.setAttribute("color","#a00");break;default:a.setAttribute("color","#aaa")}};var B=function(e){i.highlight()},G=function(e){i.unhighlight()},C=function(e){};i.buttonDown=function(t){if(D){if(e.getGameState()==STATE_PLAYING){var n=!1;t.detail&&t.detail.cursorEl&&(n=t.detail.cursorEl),g_scene==n&&(n=null),n&&(_=n),P&&(w=g,e.setEnergyTransferring(!0))}e.getGameState()==STATE_PLAYING&&H()&&!P&&e.teleportPlayer(S,L,O,I,x,E,u,(function(){i.unhighlight()}))}},i.buttonUp=function(t){!1!==w&&(w=!1,e.setEnergyTransferring(!1),p&&(p.opacity=1,m.opacity=1))},i.playerTeleported=function(t,n){u!=BLOCKING_PAD&&(u===n&&E!==t&&u!==NORMAL_PAD&&u!=PAD_WITH_ROBOT?(a.setAttribute("wireframe",!0),l.setAttribute("wireframe",!0),l.setAttribute("opacity",.4),l.setAttribute("class",""),a.setAttribute("class",""),d=!1):(a&&(a.setAttribute("wireframe",!1),a.setAttribute("class","clickable")),l.setAttribute("wireframe",!1),l.setAttribute("opacity",1),l.setAttribute("class","clickable"),d=!0),N=!1,e.setEnergyDrainTransferring(!1),i.unhighlight())},i.getIsSolid=function(){return d},i.getPadHighlighted=function(){return D},i.getPadIndex=function(){return E},i.getPadObject3D=function(){return a&&void 0!==a.object3D?(a.object3D.userData.padIndex=E,a.object3D.children.length&&(a.object3D.children[0].userData.padIndex=E),a.object3D):null},i.getBoxObject3D=function(){return l&&void 0!==l.object3D?l.object3D:null},i.getIndex=function(){return E},i.getEntity=function(){return r},i.setPosition=function(e,t,n){S=e,L=t,O=n,r.setAttribute("position",new THREE.Vector3(e,t,n))},i.setRotation=function(e,t,n){I=e,x=n,r.setAttribute("rotation",new THREE.Vector3(e,t,n));var o=0,i=0,a=0;switch(n){case 90:o=-1;break;case 180:i=-1;break;case 270:o=1}switch(e){case 90:a=1;break;case 180:i=-1;break;case 270:a=-1}c.set(o,i,a)},i.getPosition=function(){return r.getAttribute("position")},i.tick=function(t,n){if(P){if(!1!==w){var o=t-w;if(!1===s&&(s=new THREE.Vector3(0,0,0),a.object3D.getWorldPosition(s)),v.set(0,0,0),_)_.object3D.getWorldPosition(v);else{var i=e.getPlayerPosition();v.set(i.x,i.y-.05,i.z)}e.setEnergyFromTo(s,v),o>2e3?M():(p.opacity=(1800-o)/1800,m.opacity=(1800-o)/1800)}if(N){i=e.getPlayerPosition();var r=A.worldToLocal(i);r.setY(0);var l=h.angleTo(r);l=180*l/Math.PI,r.x<0?T+=l:T-=l,!1===s&&(s=new THREE.Vector3(0,0,0),a.object3D.getWorldPosition(s)),v.set(0,0,0),i=e.getPlayerPosition(),v.set(i.x,i.y-.05,i.z),e.setEnergyDrainFromTo(v,s),t-y>2e3&&(e.decreasePlayerEnergy(),g_sound.playSound(SOUND_REMOVE),y=t)}else V||(T=(T+n/rotationSpeed)%360);!function(){if(P&&null!=f){var t=g_playfieldScale,n=new THREE.Vector3;f.setAttribute("rotation","0 "+T+" 0"),A.getWorldPosition(n),n.setY(n.y+1*t);var o=new THREE.Vector3,i=e.getCollisionObjects(),r=6*t,a=(T+90)*Math.PI/180;e.getGameState()==STATE_LEVEL_PREVIEW&&(a=(T-90)*Math.PI/180),V=!1;for(var s=0;s<b.length;s++){var l=5*-s*Math.PI/180,c=b[s].geometry.attributes.position.array,u=0;c[u++]=n.x,c[u++]=n.y,c[u++]=n.z;var d=n.x+r*Math.cos(l),E=n.y+r*Math.sin(l),p=n.z,m=d-n.x;d=n.x+m*Math.cos(-a),p=n.z+m*Math.sin(-a),o.setX(d-n.x),o.setY(E-n.y),o.setZ(p-n.z),o.normalize(),g_raycaster.set(n,o),g_raycaster.near=0,g_raycaster.far=r;var _=g_raycaster.intersectObjects(i,!0);_.length>0&&(d=_[0].point.x,E=_[0].point.y,p=_[0].point.z,void 0!==_[0].object.isPlayer&&(V=!0,N||(N=!0,e.setEnergyDrainTransferring(!0),e.decreasePlayerEnergy(),g_sound.playSound(SOUND_ENERGY),y=g))),c[u++]=d,c[u++]=E,c[u++]=p,b[s].geometry.attributes.position.needsUpdate=!0,b[s].geometry.computeBoundingBox(),b[s].geometry.computeBoundingSphere()}}}()}g=t},function(){if(!1===r&&(r=document.createElement("a-entity")),u!==BLOCKING_PAD){switch(a=document.createElement("a-box"),u){case GREEN_PAD:a.setAttribute("color","#00aa00");break;case RED_PAD:a.setAttribute("color","#aa0000");break;default:a.setAttribute("color","#aaaaaa")}a.setAttribute("transparent",!0),a.setAttribute("opacity","1"),a.setAttribute("scale","1.06 0.02 1.06"),a.setAttribute("position",new THREE.Vector3(0,-.01,0)),a.addEventListener("mouseenter",B),a.addEventListener("mouseleave",G),a.addEventListener("mousedown",(function(e){})),a.addEventListener("mouseup",(function(e){})),a.addEventListener("click",C),d=!0,r.append(a)}switch(l=document.createElement("a-box"),u){case GREEN_PAD:l.setAttribute("color","#00ee00");break;case RED_PAD:l.setAttribute("color","#ee0000");break;default:l.setAttribute("color","#eeeeee")}if(l.setAttribute("transparent",!0),l.setAttribute("opacity","1"),l.setAttribute("scale","1.6 0.2 1.6"),l.setAttribute("position",new THREE.Vector3(0,-.12,0)),l.setAttribute("class","clickable"),r.append(l),u===PAD_WITH_ROBOT){f=document.createElement("a-entity");var e=new THREE.ConeGeometry(.4,1.8,4);(p=new THREE.MeshStandardMaterial({color:3684424,transparent:!0})).flatShading=!0,(A=new THREE.Mesh(e,p)).position.set(0,.9,0),f.setObject3D("mesh",A);var t=new THREE.ConeGeometry(.3,.6,3),n=new THREE.Mesh(t,p);n.rotateX(-Math.PI/1.6),n.position.set(0,.8,-.2),A.add(n),m=new THREE.LineBasicMaterial({color:16711680,transparent:!0}),r.append(f);for(var o=0;o<12;o++){var i=[];i.push(new THREE.Vector3(0,0,0)),i.push(new THREE.Vector3(0,10,0)),e=(new THREE.BufferGeometry).setFromPoints(i);var s=new THREE.Line(e,m);b.push({mesh:s,geometry:e}),R.add(s)}P=!0}}()};g_sound=null;var SOUND_CLICK=1,SOUND_TELEPORT=2,SOUND_DIE=3,SOUND_FALL=5,SOUND_REMOVE=8,SOUND_PLACE=9,SOUND_LEVEL_END=10,SOUND_ENERGY=11,SOUND_ENERGY2=12,SOUND_DONE=13,SOUND_GAME_OVER=14,SOUND_ADD_ENERGY=15,Sound=function(){var e=null;this.init=function(){null==e&&(e=new AudioContext)};var t=function(e){return 440*Math.pow(2,(e-69)/12)};this.playSound=function(n){if(null!=e){var o=e.currentTime,i=1/16,r=i,a=e.createGain(),s=null;switch((s=e.createOscillator()).type="square",s.connect(a),a.connect(e.destination),n){case SOUND_REMOVE:case SOUND_ENERGY:i=1/32,s.type="triangle",s.frequency.setValueAtTime(t(45),o),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.3,e.currentTime+1/16),a.gain.linearRampToValueAtTime(0,e.currentTime+3*i),r=3*i;break;case SOUND_ENERGY2:i=1/32,s.type="sawtooth",s.frequency.setValueAtTime(t(33),o),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.2,e.currentTime+1/16),a.gain.linearRampToValueAtTime(0,e.currentTime+3*i),r=3*i;break;case SOUND_PLACE:case SOUND_CLICK:i=1/32,s.type="triangle",s.frequency.setValueAtTime(t(60),o),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.3,e.currentTime+1/128),a.gain.linearRampToValueAtTime(0,e.currentTime+3*i),r=3*i;break;case SOUND_FALL:i=1/4,s.type="triangle",s.frequency.setValueAtTime(t(62),o),s.frequency.linearRampToValueAtTime(t(55),o+4*i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.3,e.currentTime+1/128),a.gain.linearRampToValueAtTime(0,e.currentTime+3*i),r=4*i;break;case SOUND_DIE:i=1/12,s.type="sawtooth",s.frequency.setValueAtTime(t(56),o),s.frequency.linearRampToValueAtTime(t(49),o+i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.2,e.currentTime+i),a.gain.linearRampToValueAtTime(0,e.currentTime+2*i),r=2*i;break;case SOUND_ADD_ENERGY:i=1/12,s.type="triangle",s.frequency.setValueAtTime(t(55),o),s.frequency.setValueAtTime(t(62),o+i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.2,e.currentTime+1/64),a.gain.linearRampToValueAtTime(0,e.currentTime+2*i),r=2*i;break;case SOUND_TELEPORT:i=1/12,s.type="triangle",s.frequency.setValueAtTime(t(55),o),s.frequency.setValueAtTime(t(62),o+i),s.frequency.setValueAtTime(t(67),o+2*i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.3,e.currentTime+1/64),a.gain.linearRampToValueAtTime(0,e.currentTime+6*i),r=6*i;break;case SOUND_DONE:i=1/12,s.type="sawtooth",s.frequency.setValueAtTime(t(43),o),s.frequency.setValueAtTime(t(50),o+4*i),s.frequency.setValueAtTime(t(48),o+8*i),s.frequency.setValueAtTime(t(41),o+12*i),s.frequency.setValueAtTime(t(43),o+16*i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.18,e.currentTime+1/32),a.gain.linearRampToValueAtTime(0,e.currentTime+26*i),r=26*i;break;case SOUND_GAME_OVER:i=1/12,s.type="sawtooth",s.frequency.setValueAtTime(t(50),o),s.frequency.setValueAtTime(t(41),o+4*i),s.frequency.setValueAtTime(t(43),o+8*i),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.2,e.currentTime+1/64),a.gain.linearRampToValueAtTime(0,e.currentTime+14*i),r=14*i}s.start(e.currentTime),s.stop(e.currentTime+r)}}},StartButton=function(e){var t=this,n=document.getElementById("playfield-holder"),o=document.getElementById("level-text"),i=document.getElementById("start-button"),r=document.createElement("a-box");r.setAttribute("color","#00f"),r.setAttribute("scale","0.05 0.25 1"),r.setAttribute("position","0 0.1 0.5"),r.setAttribute("class","clickable"),r.setAttribute("visible",!1),i.append(r),n.append(i),r.addEventListener("click",(function(){e.startLevel()})),r.addEventListener("mouseenter",(function(){o.setAttribute("color","#fff"),g_sound.playSound(SOUND_CLICK)})),r.addEventListener("mouseleave",(function(){o.setAttribute("color","#aaa")})),t.hide=function(){r.setAttribute("class",""),i.object3D.visible=!1},t.show=function(){r.setAttribute("class","clickable"),i.object3D.visible=!0},t.setYPosition=function(e){i.object3D.position.setY(e)}},START_PAD=1,EXIT_PAD=2,NORMAL_PAD=3,PAD_WITH_ROBOT=4,GREEN_PAD=5,RED_PAD=6,BLOCKING_PAD=7,g_levels=[{text:["Level 1.","Select a pad to teleport to.","Each teleport will use one","unit of energy."],startRotation:0,energy:8,data:[[START_PAD,0,0,0,0,0,0],[NORMAL_PAD,0,.4,-6,0,0,0],[NORMAL_PAD,-2,1.1,-12,0,0,0],[NORMAL_PAD,2,1.1,-12,0,0,0],[EXIT_PAD,0,2,-18,0,0,0]]},{text:["Level 2.","If a robot sees you","it will drain your energy.",""],energy:8,robotSpeed:60,data:[[START_PAD,0,0,0,0,0,0],[PAD_WITH_ROBOT,-2.5,2.9,-7,0,0,0],[NORMAL_PAD,0,.5,-7,0,0,0],[NORMAL_PAD,0,1.5,-12,0,0,0],[PAD_WITH_ROBOT,2,2.9,-12,0,0,0],[EXIT_PAD,0,2.3,-20,0,0,0]]},{text:["Level 3.","You can absorb a robot's"," energy by selecting it's pad.",""],startRotation:0,energy:2,data:[[START_PAD,0,0,0,0,0,0],[NORMAL_PAD,2.5,-.5,-8,0,0,0],[PAD_WITH_ROBOT,-2.5,-.5,-8,0,0,0],[NORMAL_PAD,.5,4,-19,0,0,270],[EXIT_PAD,4,3.5,-17,0,0,0]]},{text:["Level 4.","When on a green pad,","other green pads will","disappear",""],energy:4,robotSpeed:30,data:[[START_PAD,0,0,3,0,0,0],[GREEN_PAD,0,0,-3,0,0,0],[GREEN_PAD,0,2.4,-10,0,0,0],[PAD_WITH_ROBOT,-3.5,2.5,-10,0,0,0],[PAD_WITH_ROBOT,3.5,2.5,-10,0,0,0],[GREEN_PAD,2,3.6,-10,0,0,90],[BLOCKING_PAD,2.4,3.6,-9,90,0,0],[GREEN_PAD,-2,3.6,-10,0,0,270],[BLOCKING_PAD,-2.4,3.6,-9,90,0,0],[NORMAL_PAD,0,7,-8,0,0,180],[BLOCKING_PAD,0,6,-6,90,0,0],[BLOCKING_PAD,0,3.5,-19,270,0,0],[EXIT_PAD,0,3.5,-20,0,0,0],[NORMAL_PAD,5.5,6.5,-22,0,0,90],[GREEN_PAD,5.5,6.5,-21,270,0,0],[NORMAL_PAD,-5.5,6.5,-22,0,0,270],[GREEN_PAD,-5.5,6.5,-21,270,0,0]]},{text:["Level 5.","When on a red pad,","other red pads will","disappear",""],energy:2,robotSpeed:40,data:[[START_PAD,0,0,3,0,0,0],[RED_PAD,0,0,-5,0,0,0],[PAD_WITH_ROBOT,4,0,-5,0,0,0],[RED_PAD,3.5,0,-3.5,90,0,0],[BLOCKING_PAD,3.5,.2,-6,90,0,0],[RED_PAD,3,2,-5,0,0,90],[PAD_WITH_ROBOT,-4,0,-5,0,0,0],[RED_PAD,-3.5,0,-3.5,90,0,0],[BLOCKING_PAD,-3.5,.2,-6,90,0,0],[RED_PAD,-3,2,-5,0,0,270],[RED_PAD,0,5,-12,270,0,0],[GREEN_PAD,0,6.5,-19,90,0,0],[NORMAL_PAD,0,12.5,-16.5,0,0,180],[GREEN_PAD,0,12.4,-16.5,0,0,0],[EXIT_PAD,0,6,-21,0,0,0]]},{text:["Level 6.","","","",""],energy:5,robotSpeed:40,data:[[START_PAD,0,2,3,0,0,0],[RED_PAD,2.5,0,-6,0,0,0],[BLOCKING_PAD,-.1,2,-6,0,0,90],[BLOCKING_PAD,-.1,.6,-6,0,0,90],[GREEN_PAD,-2.5,0,-6,0,0,0],[RED_PAD,-5.5,13.9,-12,0,0,0],[GREEN_PAD,-5.5,14,-12,0,0,180],[RED_PAD,5.5,10,-16,90,0,0],[GREEN_PAD,5.5,10,-15.7,90,0,0],[BLOCKING_PAD,3.2,7.5,-8,90,0,0],[BLOCKING_PAD,0,9.7,-20,90,0,0],[EXIT_PAD,0,9,-21,0,0,0],[BLOCKING_PAD,-.9,9.7,-21,0,0,90],[BLOCKING_PAD,.7,9.7,-21,0,0,90],[BLOCKING_PAD,-2.8,11.6,-20,90,0,0],[BLOCKING_PAD,-1.4,5,-14,90,0,0],[RED_PAD,2,4.9,-18,0,0,0],[BLOCKING_PAD,-.1,6.9,-18,0,0,90],[BLOCKING_PAD,-.1,5.5,-18,0,0,90],[GREEN_PAD,-2,4.9,-18,0,0,0],[RED_PAD,0,11,-28,90,0,0],[GREEN_PAD,0,11,-27.9,270,0,0]]},{text:["Level 7.","","","",""],energy:3,robotSpeed:30,data:[[START_PAD,0,3,4,0,0,0],[PAD_WITH_ROBOT,2,0,-5,0,0,0],[NORMAL_PAD,-2,0,-5,0,0,0],[GREEN_PAD,-4,6.5,-6.3,270,0,0],[RED_PAD,-7,8,-15,0,0,270],[PAD_WITH_ROBOT,-3.5,7.5,-15,0,0,0],[GREEN_PAD,4,12,-24,270,0,0],[RED_PAD,4,12,-24,90,0,0],[EXIT_PAD,0,9,-21,0,0,0]]},{text:["Level 8.","","","",""],energy:3,robotSpeed:30,data:[[START_PAD,0,0,4,0,0,0],[PAD_WITH_ROBOT,0,6,-6,0,0,0],[RED_PAD,0,5.4,-6,180,0,0],[NORMAL_PAD,0,7.5,-12.2,90,0,0],[RED_PAD,0,7.5,-12,270,0,0],[RED_PAD,0,11,-1.5,270,0,0],[EXIT_PAD,0,7.5,-21,0,0,0]]}],english_voice="",available_voices=null,g_hasSpeech=!1;void 0!==window.speechSynthesis&&(available_voices=window.speechSynthesis.getVoices());var utterance=!1;function speak(e){if(void 0!==window.speechSynthesis){if(g_hasSpeech=!0,available_voices&&0!=available_voices.length||(available_voices=window.speechSynthesis.getVoices()),""==english_voice){for(var t=0;t<available_voices.length;t++)if("en-GB"===available_voices[t].lang){english_voice=available_voices[t];break}""===english_voice&&available_voices.length>0&&(english_voice=available_voices[0])}utterance&&window.speechSynthesis.cancel(utterance),(utterance=new SpeechSynthesisUtterance).text=e,""!=english_voice&&(utterance.voice=english_voice),window.speechSynthesis.speak(utterance)}}var InfoPanel=function(e){var t=this,n=[],o=document.createElement("a-entity"),i=document.createElement("a-plane");i.setAttribute("scale","1.2 1.8 1"),i.setAttribute("color","#222"),o.append(i);var r=document.createElement("a-text");r.setAttribute("value","Energy"),r.setAttribute("position","-0.55 0.7 0"),o.append(r);for(var a=[],s=0;s<4;s++)a[s]=document.createElement("a-text"),a[s].setAttribute("value","Info line 1 "),a[s].setAttribute("position",new THREE.Vector3(-.54,.15-.15*s,0)),a[s].setAttribute("scale","0.4 0.4 0.4"),a[s].setAttribute("anchor","left"),o.append(a[s]);var l=document.createElement("a-text");for(l.setAttribute("value",""),l.setAttribute("position",new THREE.Vector3(-.38,-.76,0)),l.setAttribute("scale","0.3 0.3 0.3"),l.setAttribute("anchor","left"),o.append(l),s=0;s<8;s++){var c=document.createElement("a-plane");c.setAttribute("color","#0f0"),c.setAttribute("scale","0.1 0.1 0.1"),c.setAttribute("position",new THREE.Vector3(.12*s-.46,.43,.02)),n.push(c),o.append(c)}var u=document.createElement("a-plane");u.setAttribute("scale","0.1 0.1 0.1"),u.setAttribute("position",new THREE.Vector3(-.46,-.76,.02)),u.setAttribute("color","#111"),o.append(u),e.append(o),t.setEnergy=function(e){e>=n.length&&(e=n.length);var t=0;for(t=0;t<e;t++)n[t].setAttribute("color","#0f0");for(t=e;t<n.length;t++)n[t].setAttribute("color","#111")},t.setRestartText=function(e){l.setAttribute("value",e)},t.setButtonDown=function(e){e?u.setAttribute("color","#f90"):u.setAttribute("color","#111")},t.setText=function(e,t){a[e].setAttribute("value",t)}}</script><body><a-scene game background="color: #090909" shadow="type: basic" cursor="rayOrigin: mouse; fuse: false" raycaster="objects: .clickable"><a-light type=ambient color=#555577></a-light><a-entity light="type: directional; color: #EEE; intensity: 0.8" position="-1 1 0"></a-entity><a-entity id=player rotation="0 0 0" position="0 0 0"><a-circle id=player-shadow color=#CCC radius=0.2 rotation="-90 0 0" position="0 0.005 0" opacity=0.4></a-circle><a-box id=player-collision-box color=#fff position="0 0.5 0" scale="0.3 0.7 0.3" visible=false wireframe=true></a-box><a-entity id=camera-offset position="0 0 0"><a-camera id=camera look-controls="reverseMouseDrag: true"></a-camera><a-entity id=laser-right controller-connected laser-controls="hand: right" raycaster="objects: .vr-clickable"><a-entity id=right-info rotation="-100 0 0" scale="0.1 0.1 0.1" position="-0.13 0 0"></a-entity></a-entity><a-entity id=laser-left controller-connected laser-controls="hand: left" raycaster="objects: .vr-clickable"><a-entity id=left-info rotation="-100 0 0" scale="0.1 0.1 0.1" position="0.13 0 0"></a-entity></a-entity></a-entity></a-entity><a-entity id=playfield-holder rotation="0 0 0" scale="1.0 1.0 1.0" position="0 0 0"><a-entity id=level-info><a-text id=level-text position="0 0.9 -0.27" value="The Level" color=#bbb align=left scale="1 1 1" rotation="0 -90 0" side=double></a-text><a-entity id=start-button position="0 0.89 -0.47"></a-entity></a-entity><a-entity id=playfield></a-entity></a-entity></a-scene>