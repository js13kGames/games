<!doctype html><title>Merlin vs Alfonso - js13kGames 2023</title><meta name=viewport content="width=device-width"><body><style>*{color:#fff;box-sizing:border-box;font-family:sans-serif;user-select:none;-webkit-tap-highlight-color:transparent}body,html{background:#000;cursor:pointer;margin:0;overflow:hidden;padding:0;overscroll-behavior-y:none}pre{border:1px solid #aaa;display:inline-block;font-family:monospace;letter-spacing:6px;margin:20px 0 0 0;padding:10px}.f,.level div,svg{display:block;height:100%;width:100%}.a,.level div{left:0;position:absolute;top:0}.p{height:calc(100 * var(--vh))}.p,.q{align-items:center;display:flex;flex-direction:column;justify-content:center}path{opacity:0}.tiles path{transition:opacity .2s,fill .2s}.q.f.a{background:rgba(0,0,0,.7);transition:opacity 1s}.m{background:#000;border:1px solid #aaa;max-width:calc(100% - 32px);padding:40px;text-align:center}.q.f.a button{background:#000;border:1px solid #aaa;border-radius:0;margin-top:10px;padding:18px}.i{opacity:.3}.h{opacity:0;pointer-events:none}.c{transition:opacity 1s}.l{opacity:.8!important;fill:#c25!important;filter:blur(5px)}.r{aspect-ratio:1920/1108;max-height:calc(100 * var(--vh));max-width:100vw;position:relative}.n{transform:translate(0,-100%)}</style><div class=p><div class=r><canvas width=1920 height=1108 class="f c h"></canvas><div class="level f a"></div><div class="tiles f a"></div><div class="f c n"></div></div></div><div class="q f a h"><div class=m></div><button>Continue</button></div><script>var t,e,d,n,r,f,a,c,o=["000","b80","eb0","000","224","1fd","aad","922","e25","f89","b24","bcd","eff","8ab","234","0d6","fff","085","096","abe","734","eee","ffc","60f","e79","02d","88d","67b","39b","46c","54c","53b","54c","306","none","ccf","99d","1fd","1be","3bd","57e","adf","860","750","fc3","78c","449","feb","ffd","846","d78","a68","fff","db2","fe7","fc2","a81","9dc","fed","eba","cb9","885","a96","220","457","235","345","344","8ae","bdf"],s=[[26,27],[28,29],[31,32],[35,36],[38,39],[40,3],[30,3],[45,3],[46,3],[47,48],[50,51],[53,63],[64,3],[65,3],[3,66],[67,3],[68,3],[69,3]],l={bridge:[["l2"],["m"],["b3d",0,0],["l1"],["wiu",0,0],["wid",0,0],["w"],["hj"],["ar"]],courtyard:[["g2"],["pl"],["g1"],["wiu",0,0],["wid",0,0]],cellar:[["ce1"],["ce2"],["wlk3d",0,0],["wid",0,0],["wiu",0,0]],hall:[["roo"],["hpl"],["roc"],["wiu",0,0],["wid",0,0]],garrison:[["gg"],["gboard"],["wiu",0,0],["wid",0,0]],throne:[["trbg"],["trpl2"],["trfl2"],["trpl1"],["trf1"],["wiu",0,0],["wid",0,0]],chapel:[["cabg"],["cs1"],["wiu",0,0],["wid",0,0]]},u={b3d:[{s:0,f:1,d:[[0,0,0],[3,0,0],[3,0,4],[0,0,4]]},{s:0,f:1,d:[[0,-.13,0],[3,-.13,0],[3,-.13,4],[0,-.13,4]]},{s:0,f:2,d:[[3,-.13,0],[3,-.13,4],[3,0,4],[3,0,0]]},{s:0,f:2,d:[[3,0,4],[3,-.13,4],[0,-.13,4],[0,0,4]]}],wlk3d:[{s:0,f:2,d:[[.5,3.5,2],[.5,1.5,2],[-1.5,1.5,2],[-1.5,.5,2],[-3.5,.5,2],[-3.5,1.5,2],[-2.5,1.5,2],[-2.5,2.5,2],[-.5,2.5,2],[-.5,3.5,2]]},{s:0,f:2,d:[[-3.5,-.5,2],[-3.5,-1.5,2],[-.5,-1.5,2],[-.5,-.5,2],[1.5,-.5,2],[1.5,-3.5,2],[2.5,-3.5,2],[2.5,.5,2],[-1.5,.5,2],[-1.5,-.5,2],[-3.5,-.5,2]]}],ch13d:[],ch23d:[],b:[{d:[[0,.5],[0,0],[.5,.5],[.5,1]]}],bc:[{d:[[.5,0],[-.5,1],[.5,2],[1.5,1]],f:4}],bu:[{d:[[-1,.2],[-1.3,0,-1.1,-1.1,-.7,-1],[-.8,-1.2,-.5,-1.5,-.5,-1.2],[-.5,-2.4,.2,-2.5,.3,-2],[.7,-2.4,1,-1.8,1,-1.2],[1.1,-2.1,1.6,-1.4,1.4,-.5],[1.6,-.8,1.8,-.3,1.6,0],[1.9,.1,1.7,.8,1.4,.7],[1.8,1.5,1.1,2.1,.8,1.7],[.6,2.3,0,2.4,-.3,1.8],[-.4,2,-1.1,2,-1,1.2],[-1.3,1.1,-1.4,.6,-1,.2]],f:5}],c1:[{d:[[0,0],[0,.3]],z:0}],c2:[{d:[[0,0],[0,.6]],z:0},{d:[[0,.8],[0,.9]],z:0}],c3:[{d:[[0,0],[0,1]],f:6,z:0},{d:[[0,1.2],[0,1.4]],f:6,z:0}],elp:[{d:[[.77,1.76],[1,1.4],[1,.86,1.06,.1,.6,0],[.2,0,.25,.5,.2,1]],f:7},{d:[[.2,.5],[.1,1],[.1,1.4,.5,1.7,.76,1.6],[.7,1],[.47,1,.26,1,.2,.5]],f:8},{d:[[.34,.3],[0,.64],[.4,.54]],f:7,z:0},{d:[[.2,.53],[.2,.85,.4,1,.7,1],[.7,.8,.65,.5,.55,.3],[.4,0,.25,.14,.2,.53]],f:9},{d:[[.1,1],[0,1.2,.23,1.7,.77,1.76],[.8,1.7,.77,1.6,.73,1.6],[.54,1.6,.2,1.5,.1,1]],f:10},{d:[[.7,.7],[.36,1],[.7,.9]],f:7,z:0}],en:[{d:[[3.55,5.6],[4.55,4.6],[5.55,5.6],[4.55,6.6]],f:15},{d:[[3.83,5.6],[4.55,4.86],[5.27,5.6],[4.55,6.3]],f:16},{d:[[4.13,5.6],[4.55,5.16],[5,5.6],[4.55,6]],f:15},{d:[[3.55,5.8],[4.55,6.8],[4.55,6.6],[3.55,5.6]],f:17},{d:[[5.55,5.8],[4.55,6.8],[4.55,6.6],[5.55,5.6]],f:18}],rk:[{d:[[1.1,.36],[.85,.06],[.7,-.06,.56,.16,.5,.53],[.77,.85],[.85,.47,1,.3,1.1,.36]],f:9},{d:[[.4,2.35],[.16,2],[.2,1.17],[1,.7]],f:7},{d:[[1,1],[1,.65,1.1,.57,1.2,.5],[1.1,.2,.84,.3,.8,.85],[1,1.1,.56,1.45,.74,.9],[.7,.47,.4,.86,.3,1.4],[.4,1.2,.5,1.1,.53,1.5],[.6,1.6,1,1.47,1,1]],f:8},{d:[[1,1.1],[1.1,1.6],[1.1,2,.7,2.3,.44,2.2],[.5,1.6],[.74,1.6,.94,1.53,1,1.1]],f:8},{d:[[.7,.73],[.4,.4],[.2,.4,.1,.77,0,1.1],[.3,1.4],[.4,1,.5,.7,.7,.73]],f:9},{d:[[1,1],[1,1,1,1.1,1,1.1],[1,1.45,.75,1.6,.5,1.6],[.5,1.64,.5,1.5,.5,1.5],[.74,1.5,1,1.4,1,1]],f:10},{d:[[1.1,1.56],[1.1,1.56,1.1,1.6,1.1,1.67],[1.1,2,.8,2.3,.44,2.35],[.4,2.35,.4,2.24,.44,2.2],[.73,2.17,1,2.05,1.1,1.56]],f:10}],ro:[{d:[[.24,.2],[.16,.2,.1,.24,0,.16],[0,.16,.05,0,.13,0],[.2,0,.24,.2,.24,.2]],f:19}],rwi:[{d:[[4.5,7.5],[4.4,7.4],[4.9,.3],[4.9,.3,5.4,-.5,5.5,.5],[5.5,6.5]],f:20},{d:[[4.4,7.4],[4.4,1.4],[4.4,.4,5.4,-.6,5.4,.4],[5.4,6.4]],f:21},{d:[[4.9,.2],[4.9,6.9]],f:22,z:0},{d:[[4.4,3.4],[5.4,2.4]],f:22,z:0},{d:[[4.4,1.4],[4.9,.9],[5.4,.4]],f:22,z:0},{d:[[4.4,5.4],[5.4,4.4]],f:22,z:0}],pw:[{d:[[0,1.36],[0,1.3,0,1.2,0,1.2],[0,1.2,.44,1.24,.57,1.25],[.6,1.3,.6,1.34,.57,1.4],[.4,1.6,.14,1.6,0,1.36]],f:10},{d:[[0,1.2],[.2,.8,.2,.6,.3,.2],[.44,.8,.5,1,.57,1.26],[.4,1.5,.13,1.5,0,1.2]],f:8},{d:[[.3,.6],[.1,.56,.1,.05,.3,0],[.5,0,.5,.6,.3,.6]],f:9}],tu:[{d:[[0,.34],[0,.34,0,.3,0,.25],[.05,.2,.1,.3,.1,.3],[.1,.3,.06,0,.16,0],[.2,0,.2,.25,.2,.25],[.2,.25,.2,.13,.25,.14],[.3,.14,.3,.3,.3,.3],[.3,.3,.3,.2,.34,.24],[.36,.3,.36,.3,.36,.3]],z:0}],wiu:[{d:[[1.3,1.8],[1.3,1.8,1.6,2.1,1.65,2.76],[1.66,2.9,1.6,2.9,1.6,3],[1.7,3.1,1.7,3.46,1.6,3.56],[1.2,4.1,.66,3.9,.5,3.54],[.4,3.4,.4,3,.5,2.9],[.4,2.8,.5,2.7,.5,2.5],[.75,1.5,1.3,1.8,1.3,1.8]],f:23},{d:[[1.6,3],[1.36,3.3,.8,3.5,.5,2.9]],z:0},{d:[[.6,3.06],[.55,3.3,.6,3.3,.65,3.24],[.6,3.34,.7,3.4,.74,3.26],[.75,3.4,.86,3.3,.8,3.1]],f:24},{d:[[.7,2.6],[.6,2.76,.6,2.9,.6,3.06],[.65,3.1,.74,3.2,.8,3.1],[.86,3,.9,2.8,.9,2.7]],f:23,z:0},{d:[[.8,1.2],[1.1,1.7],[.8,1.74]],f:24},{d:[[1,1.6],[.9,1.7,.9,1.7,.8,1.6],[.7,1.7,.7,1.94,.7,2],[1.2,1.7,.9,2.6,1.2,2.45],[1.2,2.6,1.3,2.7,1.35,2.6],[1.34,2.8,1.5,2.8,1.5,2.6],[1.6,2.7,1.7,2.5,1.6,2.44],[1.6,2.44,1.75,2.4,1.6,2.1],[1.45,1.9,1.46,1.6,1.46,1.6]],f:16},{d:[[1.3,.8],[1.7,1.2,1.8,2,1.5,2],[1.15,2,.86,1.4,.6,1.35],[.35,1.3,.85,.3,1.3,.8]],f:23},{d:[[1.2,1.24],[1.2,1.26,1.4,1.3,1.4,1.2],[1.4,1.2,1.3,.74,1.46,.3],[1.5,.26,1.6,.44,1.6,.4],[1.7,.3,1.5,.06,1.4,0],[1.3,0,1.24,.3,1,.44],[1,.5,.9,1,.9,1],[.9,1,.9,1,.9,1.05]],f:23,z:0},{d:[[1.1,1.16],[1.1,1.16,1.1,1.2,1.1,1.2]],f:25,z:0},{d:[[.2,2.9],[.6,3.2]],z:0}],wid:[{d:[[1.3,1.65],[1.3,1.65,.65,2.2,.5,2.7],[.4,2.8,.4,3,.5,3],[.4,3.1,.4,3.46,.5,3.6],[.86,4.1,1.4,3.9,1.6,3.54],[1.7,3.4,1.7,3,1.6,2.9],[1.64,2.7,1.6,2.6,1.5,2.3],[1.4,2.06,1.3,1.65,1.3,1.65]],f:23},{d:[[.5,3],[.7,3.3,1.26,3.5,1.6,2.9]],z:0},{d:[[1.4,3],[1.54,3.2,1.46,3.3,1.4,3.2],[1.5,3.35,1.4,3.4,1.35,3.3],[1.35,3.4,1.24,3.4,1.3,3.2]],f:24},{d:[[1.4,2.6],[1.45,2.8,1.5,2.94,1.5,3.06],[1.4,3.1,1.3,3.2,1.25,3.1],[1.2,3,1.2,2.8,1.2,2.7]],f:23,z:0},{d:[[.64,1.45],[.7,2.1],[1.1,1.9],[1.26,1.4]],f:24},{d:[[.8,1.7],[.76,1.8]],f:16,z:0},{d:[[1,1.44],[1.3,1.4],[1.4,1.6,1.5,1.8,1.4,2],[1.4,2,1.4,2,1.3,2],[1,1.9,1.2,2.4,.9,2.45],[.65,2.5,.76,3,.76,3],[.76,3,.3,2.65,.56,2.2],[.6,2.05,.5,2,.65,1.8],[.7,2,.75,1.9,.75,1.9],[.75,1.9,1,2.15,1,1.44]],f:16},{d:[[1,.8],[.7,.64,.2,1.4,.4,1.7],[.6,2.05,.8,1.6,1.3,1.76],[1.54,1.85,1.7,1.9,1.6,1.55],[1.5,1,1.34,.9,1,.8]],f:23},{d:[[1.2,1.25],[1.2,1.3,1.2,1.25,1.24,1.2],[1.24,1.2,1.16,.74,1.3,.3],[1.35,.26,1.45,.44,1.5,.4],[1.5,.3,1.35,.06,1.3,0],[1.2,0,1.1,.3,.9,.44],[.8,.5,.75,1,.75,1]],f:23,z:0},{d:[[1.26,3.3],[.9,3.6]],z:0}],l2:[{d:[[7,12],[10,9],[10,3],[7,0]],g:[0,8,6,10,6]},{d:[[-1,6],[-1,2],[8,11],[10,9],[10,3],[11,4],[11,14],[18,21],[14,21]],g:[1,9,14,11,10]},{d:[[13,18],[16,21],[14,21],[-1,6],[-1,4],[4,9]],f:30,z:0},{d:[[-4,-1],[7,10],[8,-1]],g:[2,4,1,6,9]},{d:[[8,11],[7.8,11.3],[7.8,-4.8],[8,-5],[8,3]],f:26,z:0},{d:[[6.8,10.3],[6.8,-5.8],[7.8,-4.8],[7.8,11.3]],f:30},["b",-3,-3.5],["b",-3.25,-3.25],{d:[[4.5,9.5],[12.8,17.8]],z:0},["c2",-13,-18],["c1",-2.5,-7.5],["c1",-11.8,-16.8],["en",-5.45,-6.17]],m:[{d:[[-1,5],[15,21],[6,21],[-1,14]],f:33}],l1:[{d:[[-1,10],[-1,21],[10,21]],g:[1,4,17,0,20]},["tu",-1,-18],["tu",-1.4,-14.16],["tu",-12.87,-16.66]],w:[{d:[[21,10],[10,-1],[21,-1]],g:[1,19,0,17,6],s:34},{d:[[13,2],[14,1],[20,7],[20,9]],g:[3,16,3,15,5]},{d:[[8,3],[11,6],[11,14],[21,24],[21,10],[19,8],[19,7],[18,6],[18,7],[17,6],[17,5],[16,4],[16,5],[15,4],[15,3],[14,2],[14,3],[13,2],[13,1],[8,-5]],g:[2,19,6,13,16]},{d:[[20,6],[20,7],[19,8],[19,7]],f:26},{d:[[18,6],[19,5],[20,6],[19,7]],f:35},{d:[[18,4],[18,5],[17,6],[17,5]],f:26},{d:[[16,4],[17,3],[18,4],[17,5]],f:35},{d:[[16,2],[16,3],[15,4],[15,3]],f:26},{d:[[14,2],[15,1],[16,2],[15,3]],f:35},{d:[[14,0],[14,1],[13,2],[13,1]],f:26},{d:[[12,0],[13,-1],[14,0],[13,1]],f:35},["b",-13.5,-10],["b",-18,-16.5],["b",-19,-10],["b",-14,-14.5],["b",-14.25,-14.25]],hj:[{d:[[11.7,15.3],[11.7,-.7],[12,-1],[12,15]],f:26},{d:[[10.7,14.3],[10.7,-1.8],[11.7,-.7],[11.7,15.3]],f:30}],ar:[{d:[[7.4,3.9],[7.4,3.9,7.1,3.9,6.6,4.5],[6,5.2,6,6.1,6,6.1],[5.8,5.5]],s:37,w:"10",z:0},{d:[[6,6.1],[6.5,5.7]],s:37,w:"10",z:0}],g2:[{d:[[-1,-2],[-1,18],[19,-2]],g:[4,17,2,0,19]},["bu",-3.3,-10.6],{d:[[12,7],[12,22],[10,22],[10,9]],g:[5,10,9,13,18]},{d:[[8,7],[8,21],[10,21],[10,9]],g:[6,10,9,6,19]},{d:[[21,4],[21,22],[15,22],[15,10]],g:[5,17,8,20,17]},{d:[[12,7],[12,22],[15,22],[15,10]],g:[6,15,10,12,19]},{d:[[9,10],[9,22],[7,22],[7,12]],g:[5,17,8,20,17]},{d:[[8,7],[10,9],[12,7],[15,10],[21,4],[21,-2],[17,-2]],f:41}],pl:[{d:[[15,10],[15,16],[12,19],[12,13]],f:42},{d:[[9,10],[9,16],[12,19],[12,13]],f:43},{d:[[12,13],[9,10],[12,7],[15,10]],f:44},{d:[[9.7,10.1],[9.6,10.1],[12,7.7],[14.4,10.1],[14.3,10.1]],f:42},{d:[[12,12.5],[9.7,10.1],[12,7.8],[14.3,10.1]],f:44}],g1:[{d:[[-1,16],[-1,22],[3,22],[10,15],[7,12],[9,10],[7,8]],f:41},["tu",-8.84,-1.76],["tu",-3,-1.8],["tu",-.8,-5.66],{d:[[10,15],[10,22],[3,22]],g:[5,9,16,11,26]},["bu",-6,-2.5],["c1",-8,-17],["c1",-18,-7],["c2",-17,-8],["c3",-17,-12],["c3",-9,-16],["en",-10.45,.8]],ce1:[{d:[[-1,-2],[-1,22],[21,22],[21,-2]],f:3},{d:[[12,9],[12,5],[13,6],[13,10]],g:[7,13,6,12,9]},{d:[[15,8],[15,4],[13,6],[13,10]],g:[8,14,5,15,8]},{d:[[12,5],[14,3],[15,4],[13,6]],f:19},{d:[[14,7],[15,6],[18,9],[17,10]],f:19},{d:[[5,8],[5,4],[6,5],[6,9]],g:[7,6,5,5,8]},{d:[[6,7],[5,6],[6,5],[5,4],[6,3],[8,5]],f:19},{d:[[5,10],[5,6],[6,7],[6,11]],g:[7,6,7,5,10]},{d:[[8,9],[8,5],[6,7],[6,11]],g:[8,6,7,7,10]},{d:[[14,11],[14,7],[17,10],[17,14]],g:[7,16,9,15,12]},["c2",-16,-9],["c1",-5.8,-6.8],["c1",-14.3,-4.7]],ce2:[{d:[[15,14],[12,17],[11,16],[14,13]],f:19},{d:[[11,20],[11,16],[12,17],[12,21]],g:[7,14,7,13,10]},{d:[[15,18],[15,14],[12,17],[12,21]],g:[8,16,13,17,16]},{d:[[11,20],[11,16],[12,17],[12,21]],g:[7,12,17,11,20]},{d:[[18,13],[18,9],[17,10],[17,14]],g:[8,17,10,18,13]},{d:[[6,17],[6,13],[5,14],[5,18]],g:[8,7,16,8,19]},{d:[[2,17],[2,13],[3,14],[3,18]],g:[7,6,17,5,20]},{d:[[5,20],[5,16],[6,17],[6,21]],g:[7,6,17,5,20]},{d:[[4,17],[4,13],[5,14],[5,18]],g:[7,5,14,4,17]},{d:[[8,19],[8,15],[6,17],[6,21]],g:[8,7,16,8,19]},{d:[[4,17],[4,13],[3,14],[3,18]],g:[8,3,14,4,17]},{d:[[6,17],[5,16],[7,14],[8,15]],f:19},{d:[[3,14],[2,13],[4,11],[6,13],[5,14],[4,13]],f:19},["c2",-14.6,-14.4],["c3",-7,-16],["c3",-5.2,-6.2],["c1",-6.7,-16.3],["ro",-5.3,-3.95],["ro",-2.43,-12.7],["ro",-13.9,-13.4],["en",-9.45,1.8]],roo:[{d:[[-1,-2],[-1,22],[21,22],[21,-2]],g:[9,11,22,2,-5]},{d:[[4,11],[4,15],[5,16],[5,12]],f:49},{d:[[14,7],[14,25],[17,22],[17,4]],g:[10,15,6,17,13]},{d:[[4,11],[5,12],[12,5],[11,4]],f:52},{d:[[5,12],[5,24],[12,17],[12,5]],g:[10,10,10,12,18]},["bc",-5.5,-9],["bc",-7.5,-7],["bc",-9.5,-5],["rk",-6.35,-7.1],["rk",-9.4,-4.14]],hpl:[{d:[[7,9.7],[7,17.7],[8,18.7],[8,10.7]],f:53},{d:[[7,9.7],[8,10.7],[15,3.7],[14,2.7]],f:54},{d:[[9,7.7],[8,8.7],[9,9.7],[10,8.7]],f:55},{d:[[11,5.7],[10,6.7],[11,7.7],[12,6.7]],f:55},{d:[[13,3.7],[12,4.7],[13,5.7],[14,4.7]],f:55},{d:[[15,3.7],[15,4],[8,11],[8,10.7]],f:56},["pw",-8.74,-7.4],["pw",-12.7,-3.44]],roc:[{d:[[16,9],[9,16],[7,14],[4,17],[3,16],[16,3],[17,4],[14,7]],f:52},{d:[[9,16],[9,28],[16,21],[16,9]],g:[10,12,13,14,20]},{d:[[7,14],[7,26],[9,28],[9,16]],f:49},["rwi",-5.6,-15.6],["rwi",-7.6,-13.6],["rwi",-9.6,-11.6],["bc",-3.5,-15],["bc",-5.5,-13],["bc",-7.5,-13],["bc",-9.5,-13],["bc",-9.5,-11],["bc",-7.5,-11],["bc",-9.5,-9],["bc",-11.5,-9],["bc",-11.5,-11],["bc",-11.5,-7],["bc",-13.5,-7],["bc",-13.5,-9],["bc",-13.5,-5],["en",-11.45,1.8],{d:[[7,24],[7,14],[4,17],[3,20]],g:[10,5,16,7,23]},{d:[[4,17],[4,21],[3,20],[3,16]],f:49}],gg:[{d:[[-1,-2],[-1,22],[21,22],[21,-2]],f:57},{d:[[-1,12],[13,-2],[-1,-2]],f:58},{d:[[-1,12],[-.5,12.5],[-.5,-1.5],[-1,-2]],f:59},{d:[[.5,11.5],[-.5,12.5],[-.5,-1.5],[.5,-2.5]],f:58},{d:[[2,9],[2.5,9.5],[2.5,-4.5],[2,-5]],f:59},{d:[[3.5,8.5],[2.5,9.5],[2.5,-4.5],[3.5,-5.5]],f:58},{d:[[5,6],[5.5,6.5],[5.5,-7.5],[5,-8]],f:59},{d:[[6.5,5.5],[5.5,6.5],[5.5,-7.5],[6.5,-8.5]],f:58},{d:[[8,3],[8.5,3.5],[8.5,-10.5],[8,-11]],f:59},{d:[[9.5,2.5],[8.5,3.5],[8.5,-10.5],[9.5,-11.5]],f:58},["tu",-13,-2.66],["tu",-3.66,-12.9],["tu",-17.8,-17.66],["bu",-17.3,-11.8],["bu",-14.2,-18.6]],gboard:[{d:[[14,7],[14,7.5],[17,4.5],[17,4]],f:60},{d:[[6,17],[6,17.5],[11,12.5],[11,12]],f:60},{d:[[12,11],[12,11.5],[17,6.5],[17,6]],f:60},{d:[[5,12],[5,12.5],[6,13.5],[6,13]],f:61},{d:[[5,16],[5,16.5],[6,17.5],[6,17]],f:61},{d:[[11,6],[11,6.5],[12,7.5],[12,7]],f:61},{d:[[3,16],[3,16.5],[4,17.5],[4,17]],f:62},{d:[[4,17.5],[5,16.5],[5,16],[4,17]],f:60},{d:[[11,10],[11,10.5],[12,11.5],[12,11]],f:62},{d:[[10,11.5],[11,10.5],[11,10],[10,11]],f:60},{d:[[12,5],[11,6],[12,7],[7,12],[6,11],[5,12],[6,13],[3,16],[4,17],[5,16],[6,17],[11,12],[10,11],[11,10],[12,11],[17,6],[16,5],[17,4],[16,3],[13,6]],f:52},["bc",-3.5,-15],["bc",-5.5,-13],["bc",-11.5,-5],["bc",-15.5,-5],["bc",-11.5,-7],["bc",-11.5,-9],["bc",-5.5,-11],["bc",-9.5,-9],["bc",-9.5,-11],["bc",-5.5,-15],["bc",-7.5,-11],["bc",-7.5,-13],["bc",-13.5,-5],["bc",-13.5,-7],["en",-11.45,1.8],["pw",-11.7,-4.64],["pw",-5.67,-10.64]],trbg:[{d:[[-1,0],[-1,22],[21,22],[21,0]],f:3}],trpl2:[{d:[[5,9.8],[5,13.8],[6,14.8],[6,10.8]],g:[11,6,11,5,14]},{d:[[13,1.8],[5,9.8],[6,10.8],[14,2.8]],f:54},{d:[[7,7.8],[6,8.8],[7,9.8],[8,8.8]],f:55},{d:[[9,5.8],[8,6.8],[9,7.8],[10,6.8]],f:55},{d:[[11,3.8],[10,4.8],[11,5.8],[12,4.8]],f:55},{d:[[13,1.8],[12,2.8],[13,3.8],[14,2.8]],f:55},{d:[[6,10.8],[6,14.8],[14,6.8],[14,2.8]],f:53},["rk",-11.4,-1.94],["rk",-8.4,-4.94],["rk",-6.4,-7]],trfl2:[{d:[[4,13],[5,14],[13,6],[12,5]],f:16},{d:[[4,13],[5,14],[5,18],[4,17]],g:[12,3,12,2,15]},["bc",-5.5,-11],["bc",-7.5,-9],["bc",-9.5,-7],["bc",-11.5,-5],{d:[[5,14],[5,18],[13,10],[13,6]],g:[13,10,17,11,20]}],trpl1:[{d:[[8,12.8],[16,4.8],[15,3.8],[7,11.8]],f:54},{d:[[7,11.8],[7,15.8],[8,16.8],[8,12.8]],g:[11,10,10,9,13]},{d:[[15,3.8],[14,4.8],[15,5.8],[16,4.8]],f:55},{d:[[13,5.8],[12,6.8],[13,7.8],[14,6.8]],f:55},{d:[[11,7.8],[10,8.8],[11,9.8],[12,8.8]],f:55},{d:[[9,9.8],[8,10.8],[9,11.8],[10,10.8]],f:55},{d:[[8,12.8],[8,16.8],[16,8.8],[16,4.8]],f:53},["pw",-10.7,-7.44]],trf1:[{d:[[9,18],[9,22],[17,14],[17,10]],g:[13,10,17,11,20]},{d:[[7,16],[9,18],[9,22],[7,20]],g:[12,7,16,6,19]},{d:[[4,17],[4,21],[5,22],[5,18]],g:[12,3,16,2,19]},{d:[[5,22],[7,20],[7,16],[5,18]],g:[13,6,17,7,20]},{d:[[15,12],[17,10],[17,6],[15,8]],g:[13,16,7,17,10]},{d:[[6,15],[4,17],[5,18],[7,16],[9,18],[17,10],[15,8],[17,6],[16,5]],f:16},{d:[[13,14],[13,18],[14,19],[14,15]],g:[12,14,15,13,18]},{d:[[14,19],[15,18],[15,14],[14,15]],g:[13,14,15,15,18]},["bc",-7.5,-15],["bc",-5.5,-15],["bc",-13.5,-7],["bc",-7.5,-13],["bc",-9.5,-15],["bc",-9.5,-13],["bc",-9.5,-11],["bc",-11.5,-13],["bc",-11.5,-9],["bc",-13.5,-11],["bc",-13.5,-13],{d:[[15,12],[15,16],[16,17],[16,13]],g:[12,16,13,15,16]},{d:[[16,17],[17,16],[17,12],[16,13]],g:[13,14,15,15,18]},["bc",-15.5,-11],["bc",-11.5,-11],["bc",-13.5,-9],["bc",-15.5,-9],["en",-11.45,-.17],["elp",-15.4,-10.74],["pw",-13.7,-12.77]],cwi:[{d:[[3,9.9],[3,5.6],[3.5,3.9],[4.1,4.5],[4.1,8.8]],f:11},{d:[[3,9.6],[3,5.6],[3.5,4.1],[4,4.6],[4,8.6]],f:12},{d:[[3,9.6],[3.1,9.8],[4.1,8.8],[4,8.6]],f:13},{d:[[3.1,9.8],[3,9.9],[3,9.6]],f:14},{d:[[3.5,4.1],[3.5,9.1]],f:14,z:0},{d:[[3,5.6],[4,4.6]],f:14,z:0},{d:[[3,7.6],[4,6.6]],f:14,z:0},{d:[[3,8.6],[4,7.6]],f:14,z:0},{d:[[3,6.6],[4,5.6]],f:14,z:0}],cabg:[{d:[[-1,0],[-1,22],[21,22],[21,8],[21,0]],g:[14,5,12,1,0]},{d:[[3.5,4],[8,9],[8,15],[3,10],[3,6]],g:[15,3,6,7,10],w:"0"},{d:[[6.5,1],[11,6],[11,12],[6,7],[6,3]],g:[15,6,3,10,7],w:"0"},{d:[[9.5,-2],[14,3],[14,9],[9,4],[9,0]],g:[15,9,0,13,4],w:"0"},["cwi"],["cwi",-3,3],["cwi",-6,6]],cs1:[{d:[[19,4],[19,10],[18,11],[18,5]],g:[16,18,5,19,10]},{d:[[9,10],[9,16],[10,17],[10,11]],g:[17,5,20,4,25]},{d:[[11,6],[11,12],[12,13],[12,7]],g:[17,12,7,11,12]},{d:[[19,6],[19,12],[6,25],[6,19]],g:[16,6,19,8,24]},{d:[[18,11],[18,17],[17,18],[17,12]],g:[16,17,12,18,17]},{d:[[17,12],[16,11],[17,10],[18,11]],f:12},{d:[[16,11],[16,17],[17,18],[17,12]],g:[17,17,12,16,17]},{d:[[14,13],[14,19],[13,20],[13,14]],g:[16,13,14,14,19]},{d:[[5,12],[5,18],[6,19],[6,13]],g:[17,6,13,5,18]},{d:[[3,16],[3,22],[6,25],[6,19]],g:[17,6,19,5,24]},{d:[[3,18],[3,24],[4,25],[4,19]],g:[17,4,19,3,24]},{d:[[5,18],[5,24],[4,25],[4,19]],g:[16,4,19,5,24]},{d:[[4,19],[3,18],[4,17],[3,16],[6,13],[5,12],[6,11],[8,13],[10,11],[9,10],[12,7],[11,6],[12,5],[13,6],[16,3],[19,6],[13,12],[14,13],[13,14],[12,13],[6,19],[5,18]],f:12},["bc",-10.5,-12],["bc",-12.5,-12],["bc",-10.5,-10],["bc",-6.5,-14],["bc",-6.5,-12],["bc",-8.5,-14],["bc",-8.5,-12],["bc",-14.5,-8],["bc",-12.5,-10],["bc",-12.5,-8],["bc",-10.5,-8],["bc",-12.5,-6],["bc",-16.5,-10],["bc",-14.5,-6],["bc",-4.5,-14],["bc",-6.5,-16],["bc",-16.5,-6],["bc",-14.5,-4],{d:[[12,13],[12,19],[13,20],[13,14]],g:[17,13,14,11,19]},["en",-13.45,1.8],["elp",-16.43,-9.74],["elp",-11.4,-4.74],["elp",-12.4,-11.74],["elp",-5.4,-10.74]]},g=Math,b=g.sin,p=g.cos,h=t=>JSON.parse(JSON.stringify(t)),m=t=>document.querySelector(t),v=m("body"),w=(m(".container"),m(".level")),y=m(".tiles"),z=m(".c"),L=m(".m"),M=L.parentNode,E=m(".h button"),k=z.getContext("2d"),F=g.sqrt(3)/3,X=96,$=X*F,O=g.PI,P=g.sqrt(2),q=(t,e,d)=>`<svg ${d?'style="transform: scaleX(-1);"':""} width="1920" height="1108" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1108"><defs>${t}</defs>${e}</svg>`,I=(t,e,d,i,n,r,f)=>`<path style="${t?"fill:"+t:""};stroke:${e||"#000"};stroke-width:${d||"3"};stroke-linecap:round;stroke-linejoin:round;" d="M ${i} ${r?"Z":""}" data-index="${n}" ${f?'class="is-tile"':""} />`,A={p:"Peons can capture 1 square diagonally.<br><pre>X X<br/> P <br>X X</pre>",r:"Roques capture vertically and horizontally, but can be blocked.<br/><pre>  X  <br>  X  <br>XXRXX<br>  X  <br>  X  </pre>",b:"Alfils capture by jumping 2 squares diagonally only.<br/><pre>X   X<br>     <br>  A  <br>     <br>X   X</pre>"},T=t=>[].concat.apply([],t),S={bridge:{wiu:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},wid:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},tm:[{s:T([(m=(t,e,d,n)=>{var r=[];for(i=t;i<=d;i++)for(j=e;j<=n;j++)r.push(i),r.push(j);return r})(3,6,3,12),2,7,1,8,2,8,0,9,1,9,2,9,1,10,2,10,2,11]),i:[],d:[]},{s:[],i:[]},{s:T([m(4,9,8,11)]),i:["e",8,10],d:[]}],b3d:{x:8,y:11,i:"b3d",r:["x",[0,O/2],90],s:[0,89],stm:[1,2]},tx:"Move golden objects by dragging them."},courtyard:{wiu:{cx:0,cy:0,tx:2,ty:9,canFlip:!0},wid:{cx:0,cy:0,tx:2,ty:9,canFlip:!0},tm:[{s:T([m(2,7,6,11),m(12,7,16,11),7,7,8,7,10,7,11,7,1,8,7,8,8,8,10,8,11,8,0,9,1,9,1,10]),i:["e",14,9],d:[]},{s:T([m(9,9,11,11)]),i:[],d:[]},{s:T([m(8,9,10,11)]),i:[],d:[]},{s:T([m(7,9,9,11)]),i:[],d:[]}],pl:{i:"pl",m:["y",[0,2],20],s:[0,9,19],stm:[1,2,3]},tx:"You cannot move objects while on them."},cellar:{wiu:{cx:0,cy:0,tx:4,ty:10,canFlip:!0},wid:{cx:0,cy:0,tx:4,ty:10,canFlip:!0},tm:[{s:[10,4,9,5,10,5,4,7,5,7,5,8,13,8,14,8,4,10,5,10,13,10,13,11,13,12,7,13,8,13,9,13],i:["e",14,8]},{s:T([8,6,10,6,7,7,8,7,10,7,7,8,9,8,10,8,6,9,7,9,9,9,9,10,m(9,11,12,11)]),i:[]},{s:[9,6,9,7,10,7,11,7,11,8,12,8,7,9,8,9,9,9,10,9,7,10,10,10,11,10,12,10,7,11,7,12],i:[]},{s:[6,7,7,7,8,7,9,7,9,8,9,9,11,9,12,9,8,10,9,10,11,10,8,11,10,11,11,11,8,12,10,12],i:[]},{s:[11,6,11,7,6,8,7,8,8,8,11,8,8,9,9,9,10,9,11,9,6,10,7,10,7,11,8,11,9,11,9,12],i:[]}],wlk3d:{x:10,y:14,i:"wlk3d",r:["z",[0,2*O],360],s:[0,89,179,269,359],stm:[1,2,3,4,1],ds:!0}},garrison:{wiu:{cx:0,cy:0,tx:3,ty:9,canFlip:!0},wid:{cx:0,cy:0,tx:3,ty:9,canFlip:!0},tm:[{s:T([m(3,9,15,9),m(4,10,8,10),m(10,10,14,10)]),i:["e",15,9,"p",6,8,"p",12,8]}],tx:A.p},hall:{wiu:{cx:0,cy:0,tx:3,ty:9,canFlip:!0},wid:{cx:0,cy:0,tx:3,ty:9,canFlip:!0},tm:[{s:T([m(3,9,15,9),m(6,10,12,11)]),i:["e",15,9,"r",8,7,"r",11,7]},{s:[],i:["p",9,8,"p",13,8,"x",15,8]},{s:[],i:["p",8,8,"p",12,8,"x",14,8]},{s:[],i:["p",7,8,"p",11,8,"x",13,8]},{s:[],i:["p",6,8,"p",10,8,"x",12,8]},{s:[],i:["p",5,8,"p",9,8,"x",11,8]}],hpl:{i:"hpl",m:["y",[0,4],40],s:[0,10,20,30,39],stm:[1,2,3,4,5],defaultF:20},tx:A.r},chapel:{wiu:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},wid:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},tm:[{s:T([3,9,4,9,5,9,6,9,m(9,9,15,9),m(2,10,16,10),m(3,11,15,11)]),i:["e",16,10,"b",6,8,"b",9,12,"b",12,8,"b",12,13]}],tx:A.b},throne:{wiu:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},wid:{cx:0,cy:0,tx:3,ty:10,canFlip:!0},tm:[{s:T([m(5,10,12,12),3,10,4,10,13,10,14,10]),i:["e",14,10,"b",11,13,"p",9,13,"x",4,8,"x",13,8]},{s:[],i:["r",8,7,"r",10,7,"r",13,7]},{s:[],i:["r",7,7,"r",9,7,"r",12,7]},{s:[],i:["r",6,7,"r",8,7,"r",11,7]},{s:[],i:["r",5,7,"r",7,7,"r",10,7]},{s:[],i:["r",4,7,"r",6,7,"r",9,7]},{s:[],i:["p",10,9,"x",15,9,"x",16,9]},{s:[],i:["p",9,9,"x",14,9,"x",15,9]},{s:[],i:["p",8,9,"x",13,9,"x",14,9]},{s:[],i:["p",7,9,"x",12,9,"x",13,9]},{s:[],i:["p",6,9,"x",11,9,"x",12,9]}],trpl1:{i:"trpl1",m:["y",[0,4],40],s:[0,10,20,30,39],stm:[6,7,8,9,10],defaultF:20},trpl2:{i:"trpl2",m:["y",[0,4],40],s:[0,10,20,30,39],stm:[1,2,3,4,5],defaultF:20}}};function R(t){return 18*t[0]+t[1]}function C(t,e,d,i){return t.map(t=>{var n=t[1]*p(e)+t[2]*b(e),r=t[2]*p(e)-t[1]*b(e),f=t[0]*p(d)+r*b(d);return[f*p(i)-n*b(i),f*b(i)+n*p(i),-t[0]*b(d)+r*p(d)]})}function U(t){return(t%=2*O)<0?t+2*O:t}function B(t,e){return t=(t=U(t))-(e=U(e)),O<t?t-=2*O:t<-O&&(t+=2*O),t}function G(t,e,d){return g.max(d,g.min(e,t))}function H(t,e){return g.sqrt(g.pow(t[0]-e[0],2)+g.pow(t[1]-e[1],2))}var N,Y=!1;function D(t,e){L.innerHTML=t,M.classList.remove("h"),N=e,Y||(Y=!0,E.addEventListener("click",()=>{M.classList.add("h"),N()}))}function J(){var t=z.getBoundingClientRect();n=t.left,r=t.top,f=t.width,a=t.height,document.documentElement.style.setProperty("--vh",.01*window.innerHeight+"px")}function W(t){return[(t[0]-n)/f*1920,(t[1]-r)/a*1108]}function K(t){c=t.timeStamp,J();var e,d=!1;V(t,(t,i)=>{"path"!==t.tagName||d||t.classList.contains("is-tile")||(e=new CustomEvent("md",{detail:{el:t,pageX:i[0],pageY:i[1]}}),d=!0,window.dispatchEvent(e))})}function V(t,e){for(var d=Z(t),i=document.elementsFromPoint(d[0],d[1]),n=0;n<i.length;n++)e(i[n],d)}function Z(t){var e=t.changedTouches;return e&&e[0]?[e[0].pageX,e[0].pageY]:[t.pageX,t.pageY]}window.addEventListener("resize",J),window.addEventListener("mousedown",K),window.addEventListener("touchstart",K);var Q,_=!1,tt=0,et=["bridge","courtyard","cellar","garrison","hall","chapel","throne"],dt=0;function it(){dt<et.length?function n(r,f){function a(t,e){if(T&&M.tick(t),T||e)for(const e in j)Object.hasOwn(j,e)&&(j[e].render(t),N)&&(j[e]=null)}function p(){L.initMap(),M.checkLose()}function m(t){for(const n in j){var e,d;Object.hasOwn(j,n)&&(e=j[n]).entityMeta&&e.entityMeta.i&&e.entityMeta.stm&&(d=!1,e.entityMeta.stm.forEach(e=>{var n=S[J].tm[e];for(i=0;i<n.s.length;i+=2)t[0]===n.s[i]&&t[1]===n.s[i+1]&&(d=!0)}),e.entityMeta.pr=!!d)}}var L,M,E,j,T,N,Y,J=r,K=f;w.innerHTML="",E=S[J],N=T=!(j={}),Y=[],h(r=l[J]).forEach(t=>{j[t[0]]=function t(e,d,i,n,r,f,a){var c,l,b,p,m,x,y,z,L,M,E,j,A=R(e),T=[],S={f:f.defaultF||0,rf:f.defaultF||0};if(d)return A;if(f.i&&(c=R(u[f.i]),l=document.createElement("div"),w.append(l),window.addEventListener("md",H),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("mousemove",N),window.addEventListener("mouseup",Y),window.addEventListener("touchend",Y)),f.r&&r)for(L=0;L<f.r[2];L++)M=(f.r[1][1]-f.r[1][0])/(f.r[2]-1)*L,D(["x"===f.r[0]?M:0,"y"===f.r[0]?M:0,"z"===f.r[0]?M:0]);else if(f.m)for(E=0;E<f.m[2];E++)j=(f.m[1][1]-f.m[1][0])/(f.m[2]-1)*E,D(null,["x"===f.m[0]?j:0,"y"===f.m[0]?j:0,"z"===f.m[0]?j:0]);else D();function R(e){var r=[];return h(e).forEach(e=>{Array.isArray(e)?t(u[e[0]],!0,e[1],e[2],!1,{}).forEach(t=>r.push(t)):(d&&(e.d=e.d.map(t=>t.map((t,e)=>e%2==0?t-(i||0):t-(n||0)))),r.push(e))}),r}function H(t){var e,d,i,n;"path"===t.detail.el.tagName&&l.contains(t.detail.el)&&!f.pr&&(p=W([t.detail.pageX,t.detail.pageY]),y=S.f,v.classList.add("dragging"),r)&&(t=T[S.f].iPaths[t.detail.el.getAttribute("data-index")],e=p,d=(t=t.dt)[0],i=[(i=t[1])[0]-d[0],i[1]-d[1],i[2]-d[2]],n=[(n=t[2])[0]-d[0],n[1]-d[1],n[2]-d[2]],d=(e[0]-(f.x||0)*X)/(P*X),t=((i=[i[1]*n[2]-i[2]*n[1],i[2]*n[0]-i[0]*n[2],i[0]*n[1]-i[1]*n[0]])[0]*t[0][0]+i[1]*t[0][1]+i[2]*t[0][2]-i[1]*(e=(e[1]-(f.y||0)*$)/(P*X))-i[0]*d)/i[2],b=C([[d,e,t]],g.acos(F),0,0),b=C(b,0,0,-O/4)[0])}function N(t){var e,d,i,n,a,c;t.preventDefault(),p&&(t=W(Z(t)),S.f=r?(e=[(e=t)[0]-p[0],e[1]-p[1]],a=f.r[1][0],c=f.r[1][1],"x"===f.r[0]?(d=[b[0],b[1]-e[0]/X,b[2]-e[1]/$/2-e[0]/X/2],n=U(g.atan2(b[1],b[2])),i=U(g.atan2(d[1],d[2]))):"y"===f.r[0]?(d=[b[0]+e[0]/X,b[1],b[2]-e[1]/$/2+e[0]/X/2],n=U(g.atan2(b[0],b[2])),i=U(g.atan2(d[0],d[2]))):"z"===f.r[0]&&(d=[b[0]+e[0]/X/2+e[1]/$/2,b[1]-e[0]/X/2+e[1]/$/2,b[2]],n=U(g.atan2(b[1],b[0])),i=U(g.atan2(d[1],d[0]))),((e=U(B(i,n)+y*(O/180)))>c||e<a)&&(e=g.abs(B(e,c))<g.abs(B(e,a))?c:a),G(g.floor(e*(180/O)),f.r[2]-1,0)):(d=g.floor((p[0]-t[0])/10),t=g.floor((p[1]-t[1])/10),"x"===f.m[0]?G(y-g.round(d/2+t/2),f.m[2]-1,0):"y"===f.m[0]?G(y-g.round(-d/2+t/2),f.m[2]-1,0):"z"===f.m[0]?G(y-t,f.m[2]-1,0):void 0))}function Y(t){p=b=null,v.classList.remove("dragging")}function D(t,e){var d=J(t,e);f.i&&(d.iPaths=K(c,t,e),d.iSvg=V(d.iPaths)),f.canFlip&&(d.ff=J(t,e,!0)),T.push(d)}function J(t,e,d){var i={img:new Image,paths:K(A,t,e)};return i.svg=V(i.paths,d),i.pr=new Promise(t=>i.img.onload=t),i.img.src=URL.createObjectURL(new Blob([i.svg],{type:"image/svg+xml;charset=utf-8"})),i}function K(t,e,d){return(t=h(t)).forEach(t=>{t.df=t.d.map(t=>t.map((t,e)=>(d&&(e%2==0&&(t=(t+=d[0])-d[1]),e%2==1)&&(t=(t=(t+=d[0])+d[1])+2*d[2]),e%2==0?t*X:t*$))),r&&(e&&(t.d=C(t.d,e[0],e[1],e[2])),t.dt=C(t.d,0,0,O/4),t.dt=C(t.dt,-g.acos(F),0,0),t.z=t.dt.reduce((t,e)=>t+e[2],0)/t.dt.length,t.df=t.dt.map(t=>t.map(t=>t*P*X).filter((t,e)=>e%3!=2)))}),r&&!f.ds&&t.sort((t,e)=>t.z-e.z),t}function V(t,e){var d="",i="";return t.forEach((t,e)=>{var n,r,a,c,l=void 0===t.f?"none":"#"+o[t.f],u=void 0===t.s||"none"===o[t.s]?void 0:"#"+o[t.s],g=t.df.map((t,e)=>(6===t.length?"C ":0!==e?"L ":"")+t.map((t,e)=>e%2==0?t+(f.x||0)*X+",":t+(f.y||0)*$+" ").join("")).join(" ");t.g&&(n=`g-${t.g[0]}-`+tt++,d+=(r=t.g[1]*X,a=t.g[2]*$,c=o[s[t.g[0]][0]],`<linearGradient gradientUnits="userSpaceOnUse" id="${n}" x1="${r}" y1="${a}" x2="${t.g[3]*X}" y2="${t.g[4]*$}"><stop offset="0" stop-color="#${c}" /><stop offset="1" stop-color="#${o[s[t.g[0]][1]]}" /></linearGradient>`),l=`url('#${n}')`),i+=I(l,u,t.w,g,e,0!==t.z)}),q(d,i,e)}return{fs:T,entityMeta:f,state:S,render:function(t){var e,d,i,n,r,c,o=z?t-z:0;f.h||(f.f?k.drawImage(T[S.f].ff.img,(f.cx||0)-1920+200,f.cy||0):k.drawImage(T[S.f].img,f.cx||0,f.cy||0),f.i&&(null===p&&f.s&&(e=S.f,i=1e5,n=(d=f).s[0],r=(d.m||d.r)[2]-1,c=0,d.s.forEach(t=>{var d=t-e,f=t-(e+r);g.abs(f)<g.abs(d)&&(d=f),g.abs(d)<g.abs(i)&&(i=d,n=t)}),0<i?(c=g.round(g.ceil(i*o/100)),i<c&&(c=i)):(c=g.round(g.floor(i*o/100)))<i&&(c=i),d={upd:G(g.round(e+c),r,0),val:n},-1===f.s.indexOf(S.f)?S.f=d.upd:S.rf=d.val),x!==S.rf&&f.s&&-1!==f.s.indexOf(S.rf)&&(x=S.rf,a)&&a(),m!==S.f)&&(m=S.f,l.innerHTML=T[S.f].iSvg)),z=t},removeInteractivity:function(){window.removeEventListener("md",H),window.removeEventListener("mousemove",N),window.removeEventListener("touchmove",N),window.removeEventListener("mouseup",Y),window.removeEventListener("touchend",Y)}}}(u[t[0]],!1,t[1],t[2],-1!==t[0].indexOf("3d"),E[t[0]]?h(E[t[0]]):{},p),Y=Y.concat(j[t[0]].fs.map(t=>t.pr))}),Promise.all(Y).then(()=>{var i,n,r,f,o,s,l,u,p,h,w,k,F=0;function O(){var i;t=Y(),e=Y(),d=Y(!0),P(),P(!0),i="",t.forEach((e,d)=>{t[d].forEach((t,e)=>{var n,r,f,a,c,o,s;1===t&&(a=e-(t=d),c=e-(n=d+1),o=e+1-(r=d+1),s=e+1-(f=d),i+=I("#000","none",0,(t+=e+1)*X-960+`,${a*$+554} L ${(n+=e+1)*X-960},${c*$+554} ${(r+=e+1+1)*X-960},${o*$+554} ${(f+=e+1+1)*X-960},${s*$+554} `,18*d+e,1,!0))})}),y.innerHTML=q("",i),N(),v.addEventListener("click",B)}function P(t){(t?C:A)(0);for(const d in r){var e;Object.hasOwn(r,d)&&(e=r[d]).entityMeta&&e.entityMeta.s&&e.entityMeta.stm&&e.state&&void 0!==e.state.rf&&(t?C:A)(e.entityMeta.stm[e.entityMeta.s.indexOf(e.state.rf)])}}function A(n){for(var r=i[n],f=0;f<r.s.length;f+=2)t[r.s[f]][r.s[f+1]]=1;for(f=0;f<r.i.length;f+=3){var a=r.i[f+1],c=r.i[f+2];e[a][c]={i:r.i[f]};for(var o=-1;o<=1;o+=2)for(var s,l=-1;l<=1;l+=2)"p"===r.i[f]&&void 0!==(s=U(a+o,c+l,d))&&void 0!==s.push&&s.push(r.i[f]),"b"===r.i[f]&&void 0!==(s=U(a+2*o,c+2*l,d))&&void 0!==s.push&&s.push(r.i[f])}}function C(t){for(var n=i[t],r=0;r<n.i.length;r+=3){var f=n.i[r+1],a=n.i[r+2];if("r"===n.i[r])for(var c=!1,o=!1,s=!1,l=!1,u=1;u<=20;u+=1){var g=U(f-u,a,d),b=U(f+u,a,d),p=U(f,a-u,d),h=U(f,a+u,d),m=U(f-u,a,e),v=U(f+u,a,e),w=U(f,a-u,e),x=U(f,a+u,e);void 0!==b&&0!==v&&(o=!0),void 0!==p&&0!==w&&(s=!0),void 0!==h&&0!==x&&(l=!0),(c=void 0!==g&&0!==m||c)||void 0===g||g.push(n.i[r]),o||void 0===b||b.push(n.i[r]),s||void 0===p||p.push(n.i[r]),l||void 0===h||h.push(n.i[r])}}}function U(t,e,d){return void 0!==d[t]&&void 0!==d[t][e]?d[t][e]:void 0}function B(t){f&&(t.timeStamp||0)-(c||0)<200&&V(t,t=>{(t=G(t))&&n(t[0],t[1])})}function G(t){if(null!==(t=t.getAttribute("data-index")))return t=parseInt(t),[x=g.floor(t/18),t%18]}function N(){v.removeEventListener("click",B)}function Y(t){for(var e=[],d=0;d<19;d++){e[d]=[];for(var i=0;i<19;i++)e[d][i]=t?[]:0}return e}function W(t,e,d,i,n){var r,f=t*(1-n)+d*n,a=e*(1-n)+i*n;k.cx=(f+a+1)*X-960-4,k.cy=(a-f)*$+554-190-3*b(n*g.PI*2),s&&((r=s.entityMeta).cx=(f+a+1)*X-960-4,r.cy=(a-f)*$+554-190-3*b(n*g.PI*2),k.h=!0,r.h=!0,k.f=!1,r.f=!1,0<t-d?(r.h=!1,r.f=!1):0<e-i?(k.h=!1,k.f=!1):e-i<0?(r.h=!1,r.f=!0):(k.h=!1,k.f=!0))}function Z(e){return 1===t[e[0]][e[1]]}function _(){d[k.tx]&&d[k.tx][k.ty]&&d[k.tx][k.ty].length&&Q.endLevel([k.tx,k.ty,d[k.tx][k.ty]])}z.classList.remove("i"),o=j.wiu,s=j.wid,l=m,w=h=null,W((k=o.entityMeta).tx,k.ty,k.tx,k.ty,1),M={walkPath:function(e,d){1<(e=function(e,d){var i,n,r,f,a=[e],c=[],o=[],s=[];for(o[R(e)]=0,s[R(e)]=H(e,d);0!==a.length;){if((i=a.sort((t,e)=>s[R(t)]-s[R(e)])[0])[0]===d[0]&&i[1]===d[1]){for(n=[i];void 0!==c[R(i)];)i=c[R(i)],n.unshift(i);return n}a.splice(a.indexOf(i),1),f=[],t[(r=i)[0]-1]&&1===t[r[0]-1][r[1]]&&f.push([r[0]-1,r[1]]),t[r[0]+1]&&1===t[r[0]+1][r[1]]&&f.push([r[0]+1,r[1]]),1===t[r[0]][r[1]-1]&&f.push([r[0],r[1]-1]),1===t[r[0]][r[1]+1]&&f.push([r[0],r[1]+1]),f.forEach(t=>{var e=(void 0===o[R(i)]?1e5:o[R(i)])+1;e<(void 0===o[R(t)]?1e5:o[R(t)])&&(c[R(t)]=i,o[R(t)]=e,s[R(t)]=e+H(t,d),-1===a.indexOf(t))&&a.push(t)})}return[]}([k.tx,k.ty],[e,d])).length&&(w=e)},tick:function(t){var d,i,n;null!==h&&p&&(d=g.min((t-p)/300,1),i=h[u],n=h[u+1],W(i[0],i[1],n[0],n[1],d),1<=d)&&(p=t,e[k.tx]&&e[k.tx][k.ty]&&"e"===e[k.tx][k.ty].i&&Q.endLevel(),_(),null===w&&void 0!==h[u+2]&&Z(h[u+2])?(u++,k.tx=h[u+1][0],k.ty=h[u+1][1],l([k.tx,k.ty])):h=null),null===h&&null!==w&&(p=t,h=w,w=null,void(u=0)!==h[u+1])&&Z(h[u+1])&&(k.tx=h[u+1][0],k.ty=h[u+1][1],l([k.tx,k.ty]))},checkLose:_},i=S[J].tm,n=M.walkPath,r=j,f=!1,O(),L={initMap:O,ri:N,hl:function(){for(var t=y.querySelectorAll("path"),e=0;e<t.length;e++){var i=G(t[e]);d[i[0]][i[1]].length&&t[e].classList.add("l")}},st:()=>f=!0},E.tx&&!K?(F=1500,a(0,!0),D(E.tx,()=>{T=!0,setTimeout(L.st,600)})):(T=!0,setTimeout(L.st,600)),setTimeout(()=>z.classList.remove("h"),F)}),Q={tick:a,endLevel:function(t){N=!(T=!1);for(const t in j)Object.hasOwn(j,t)&&j[t].removeInteractivity();L.ri(),t?(z.classList.add("i"),L.hl(),setTimeout(()=>{z.classList.add("h"),setTimeout(()=>D(A[t[2][0]],()=>n(et[dt-1],t)),1e3)},1e3)):(z.classList.add("h"),setTimeout(it,1e3))},levelIsRunning:()=>T}}(et[dt++]):D("Well played, Wise One.",()=>window.location.reload())}J(),requestAnimationFrame(function t(e){Q&&Q.tick(e),requestAnimationFrame(t)}),D('Merlin, your legend has reached Castile. Let us play: "Ajedrez".<br/><br/>King Alfonso X',()=>{var t=1500;v.requestFullscreen?v.requestFullscreen({navigationUI:"hide"}):v.mozRequestFullScreen?v.mozRequestFullScreen({navigationUI:"hide"}):v.webkitRequestFullscreen&&v.webkitRequestFullscreen({navigationUI:"hide"}),_||(setTimeout(()=>{_=!0;try{zzfxV=.3,zzfxR=44100,zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),d=zzfxX.createBuffer(t.length,t[0].length,44100);return t.map((t,e)=>d.getChannelData(e).set(t)),e.buffer=d,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,d=220,i=0,n=0,r=.1,f=0,a=1,c=0,o=0,s=0,l=0,u=0,g=0,b=0,p=0,h=0,m=1,v=0,w=0)=>{let x,y,z=2*Math.PI,L=c*=500*z/194481e4,M=(0<b?1:-1)*z/4,E=d*=(1+2*e*Math.random()-e)*z/44100,k=[],F=0,X=0,$=0,O=1,P=0,j=0,q=0;for(o*=500*z/44100**3,b*=z/44100,s*=z/44100,l*=44100,u=44100*u|0,y=(i=99+44100*i)+(v*=44100)+(n*=44100)+(r*=44100)+(h*=44100)|0;$<y;k[$++]=q)++j%(100*p|0)||(q=f?1<f?2<f?3<f?Math.sin((F%z)**3):Math.max(Math.min(Math.tan(F),1),-1):1-(2*F/z%2+2)%2:1-4*Math.abs(Math.round(F/z)-F/z):Math.sin(F),q=(u?1-w+w*Math.sin(2*Math.PI*$/u):1)*(0<q?1:-1)*Math.abs(q)**a*t*.3*($<i?$/i:$<i+v?1-($-i)/v*(1-m):$<i+v+n?m:$<y-h?(y-$-h)/r*m:0),q=h?q/2+(h>$?0:($<y-h?1:(y-$)/h)*k[$-h|0]/2):q),x=(d+=c+=o)*Math.sin(X*b-M),F+=x-x*g*(1-1e9*(Math.sin($)+1)%2),X+=x-x*g*(1-1e9*(Math.sin($)**2+1)%2),O&&++O>l&&(d+=s,E+=s,O=0),!u||++P%u||(d=E,c=L,O=O||1);return k},zzfxX=new(window.AudioContext||webkitAudioContext);var t=(zzfxM=(t,e,d,i=125)=>{let n,r,f,a,c,o,s,l,u,g,b,p,h,m,v=0,w=[],x=[],y=[],z=0,L=0,M=1,E={},k=44100/i*60>>2;for(;M;z++)w=[M=l=p=0],d.map((i,F)=>{for(s=e[i][z]||[0,0,0],M|=!!e[i][z],m=p+(e[i][0].length-2-!l)*k,h=F==d.length-1,r=2,a=p;r<s.length+h;l=++r){for(c=s[r],u=r==s.length+h-1&&h||g!=(s[0]||0)|c|0,f=0;f<k&&l;f++>k-99&&u&&(b+=(b<1)/99))o=(1-b)*w[v++]/2||0,x[a]=(x[a]||0)-o*L+o,y[a]=(y[a++]||0)+o*L+o;c&&(b=c%1,L=s[1]||0,c|=0)&&(w=E[[g=s[v=0]||0,c]]=E[[g,c]]||((n=[...t[g]])[2]*=2**((c-12)/12),0<c?zzfxG(...n):[]))}p=m});return[x,y]})([[.7,0,49,,.07,.07,2,0,,,.5,.01],[.5,0,196,,.08,.5,3],[,0,84,,,,,.7,,,,.5,,6.7,1,.05],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[,0,196,,,.48,2,,,,,,,,,.02,.01]],[[[,,15,,,15,15,,13,,15,,,,13,10,,6,6,,,6,6,,10,,8,,,,8,6,8,,],[1,,10,,,,,,,,13,,,,13,,10,,,,,,8,,10,,13,,,,15,,,,],[2,,15,,,,,,15,,15,,,,,,,,15,,,,,,15,,15,,,,,,15,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,]],[[,,15,,,15,15,,13,,15,,,,13,10,,6,6,,,6,6,,10,,8,,,,8,6,8,,],[1,,10,,,,,,,,13,,,,15,,,,8,,,,,,,,8,,,,,,,,],[2,,15,,,,,,15,,15,,,,,,,,15,,,,,,15,,15,,,,,,15,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,]],[[,,15,,,,15,,13,,15,,8,,13,10,3,,6,,,,6,,10,,8,,,,8,6,8,,],[2,,15,,,,,,15,,15,,,,,,,,15,,,,,,,,15,,,,,,15,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,],[5,,10,15,18,15,10,15,18,15,13,17,20,17,13,17,20,17,8,12,15,12,8,12,15,12,13,17,20,17,13,17,20,17]],[[,,15,,,,15,,13,,15,,8,,13,10,3,,20,,,,18,,,,15,,,,13,,,,],[2,,15,,,,,,15,,15,,,,,,15,,15,,,,,,,,15,,,,15,,,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,15,,15,,15],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,15,,],[5,,10,15,18,15,10,15,18,15,13,17,20,17,13,17,20,17,20,,,,18,,,,15,,,,13,,,,],[1,,,,,,,,,,,,,,,,,,20,,,,18,,,,15,,,,13,,,,],[5,,,,,,,,,,,,,,,,,,8,,,,10,,,,6,,,,6,,,,]],[[,,15,,,,15,,,,13,,,,10,,6,,13,,,,13,,13,,,,15,,15,,,,20,,,,20,,,,18,,,,13,,15,,15,,,,,,,,15,,,,15,,,,],[1,,15,,,,,,,,13,,,,,,,,13,,,,18,,17,,,,15,,13,,8,12,20,,,,20,,,,18,,17,,,,15,,,,,,,,,,,,,,,,,,],[5,,3,6,10,13,3,6,10,13,3,6,10,13,3,6,10,13,3,6,10,13,15,13,10,6,3,6,10,13,15,13,10,6,8,12,15,18,8,12,15,18,8,12,15,18,8,12,15,18,8,12,15,18,15,12,8,6,8,12,15,18,15,12,8,6],[2,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,]],[[,,15,,,,15,,,,13,,,,10,,6,,13,,,,13,,13,,,,15,,15,,13,18,20,,,,20,,,,18,,17,,,,15,,,,,,13,,15,,,,,,,,,,],[1,,15,,,,,,,,13,,,,,,,,8,,,,,,,,13,,,,,,,,8,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,3,6,10,13,3,6,10,13,3,6,10,13,3,6,10,13,3,6,10,13,15,13,10,6,3,6,10,13,15,13,10,6,8,12,15,18,8,12,15,18,8,12,15,18,8,12,15,18,8,12,15,18,15,12,8,6,8,12,15,18,15,12,8,6],[2,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,],[1,,,,,,,,,,,,,,,,,,3,,,,,,,,10,,,,,,,,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[5,,10,13,17,22,17,13,10,8,10,13,17,22,17,13,10,8,6,10,13,17,13,10,6,5,6,10,13,17,13,10,6,5,8,12,15,17,15,12,8,6,8,12,15,18,15,12,8,6,8,12,15,18,20,24,27,30,32,30,27,24,20,12,8,6],[,,22,,,,22,25,,,22,,18,,22,,20,24,18,,18,,18,,,,18,,17,,18,,17,,20,,18,,20,,,,20,,20,,18,,20,,20,,20,,20,,32,,20,,32,,20,,32,,],[2,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,],[3,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,,,,,15,,,,],[4,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,15,,,,,,]]],[0,1,2,2,0,1,2,3,4,5,6,6],120);(node=zzfxP(...t)).loop=!0}catch(t){}},1500),t=3e3),setTimeout(()=>it(),t)})</script>