<!doctype html><meta name=viewport content="width=device-width,user-scalable=no"><meta name=theme-color content=#21272a><title>King Thirteen - js13kGames 2024</title><style>*{cursor:default;touch-action:manipulation;-webkit-user-drag:none}body,html{overscroll-behavior:none;-webkit-user-select:none;user-select:none}body{display:flex;flex-wrap:wrap;align-content:center;justify-content:center;margin:0;min-height:100vh;background:#313638;font-family:-apple-system,'Segoe UI','DejaVu Sans',system-ui,sans-serif}.b{display:flex;flex-wrap:wrap;align-content:space-between;justify-content:space-between;width:90vmin;height:90vmin}.c{display:flex;flex-wrap:wrap;align-content:center;justify-content:center;width:24.75%;height:24.75%}.c{background:#d49577;box-shadow:0 1vmin #845750,0 1vmin 0 .3333vmin #00000040;border-radius:8.3333%;position:relative;transition:transform 50ms}.c:active{transform:translateY(.5vmin)}.c:nth-child(8n+2),.c:nth-child(8n+4),.c:nth-child(8n+5),.c:nth-child(8n+7){background:#9f705a;box-shadow:0 1vmin #633b3f,0 1vmin 0 .3333vmin #00000040}.a::after{content:'';position:absolute;top:1.5vmin;right:1.5vmin;height:3vmin;width:3vmin;background:#f4f4f4;border-radius:100%}.p{display:flex;flex-wrap:wrap;align-content:end;justify-content:center;width:19vmin;height:19vmin;z-index:1}.p.an{z-index:3}svg{position:absolute;width:19vmin;height:19vmin}.n{-webkit-backdrop-filter:blur(0.5vmin);backdrop-filter:blur(0.5vmin);border-radius:1.6vmin;padding:0 1.4vmin;font-size:5vmin;z-index:2}.p.an .n{-webkit-backdrop-filter:none;backdrop-filter:none;z-index:4}.p.ps5{align-content:center}.p.ps5 .n{-webkit-backdrop-filter:none;backdrop-filter:none;font-family:Georgia,'Noto Serif',serif;font-size:4vmin;letter-spacing:-.1vmin;position:relative;top:1.6vmin}.st{fill:none;stroke:none}.s .p .st{stroke:#f4f4f4}.s .p:not(.an) svg{animation:1.6s cubic-bezier(.45,0,.55,1) infinite alternate se}.s .p.ps5{animation:.5s ease-in-out no}.s .p.ps5 .st{stroke:none}.s .p.ps5 svg{animation:none}@keyframes sp{0%{transform:scale(.1)}100%{transform:scale(1)}}@keyframes se{0%{transform:translateY(.5vmin)}100%{transform:translateY(-.5vmin)}}@keyframes no{0%{transform:translateX(0)}20%{transform:translateX(-1.2vmin)}40%{transform:translateX(1.2vmin)}60%{transform:translateX(-1vmin)}80%{transform:translateX(1vmin)}100%{transform:translateX(0)}}.sh{animation:.2s ease-in-out .1s sha}@keyframes sha{0%{transform:translate(0,0)}20%{transform:translate(1.2vmin,-.4vmin)}40%{transform:translate(-.9vmin,.3vmin)}60%{transform:translate(.6vmin,-.2vmin)}80%{transform:translate(-.3vmin,.1vmin)}100%{transform:translate(0,0)}}.u{display:flex;flex-direction:column;flex-wrap:wrap;align-content:space-around;justify-content:center;align-self:center;position:absolute;width:100vw;height:100vh;z-index:10;transition:opacity .25s cubic-bezier(.5, 1, .89, 1),transform .25s cubic-bezier(.5, 1, .89, 1)}.h{opacity:0;pointer-events:none;transform:translateY(-100vh);transition:opacity .25s cubic-bezier(.11, 0, .5, 0),transform .25s cubic-bezier(.11, 0, .5, 0)}@media (orientation:portrait){.h{transform:translateX(-100vw)}}.ti{display:flex;flex-wrap:wrap;align-content:center;justify-content:center;height:22vmin;min-width:64vmin;font-size:9vmin;font-weight:300;-webkit-backdrop-filter:blur(0.5vmin);backdrop-filter:blur(0.5vmin);background:#17001de0;border-radius:1.86vmin 1.86vmin 0 0;color:#ef0c45}.sc{height:16vmin;font-size:7vmin;border-radius:0;user-select:text}.bu{display:flex;flex-wrap:wrap;align-content:center;justify-content:center;height:16vmin;min-width:64vmin;font-size:7vmin;font-weight:300;-webkit-backdrop-filter:blur(0.5vmin);backdrop-filter:blur(0.5vmin);background:#17001dc0;color:#fec070}.an .bu,.an .ti{-webkit-backdrop-filter:none;backdrop-filter:none}.bu:not(:last-child){border-bottom:.5vmin solid #17001de0}.bu:last-child{border-radius:0 0 1.86vmin 1.86vmin}.bu:hover{background:#270022c0}.to{display:flex;gap:1vmin;padding:.5vmin;position:fixed;top:0;right:0;z-index:20}@media (orientation:portrait){.to{flex-direction:row-reverse}}@media (orientation:landscape){.to{flex-direction:column}}.tb{width:6vmin;height:6vmin;padding:.5vmin;border-radius:8.3333%;position:relative}.tb:hover{background:#00000020}.tb svg{width:6vmin;height:6vmin;color:#dbcfb1}.of svg{opacity:.4}.of::after{content:'';position:absolute;top:2.5vmin;left:.5vmin;height:.4vmin;width:6vmin;background:#dbcfb1;border-radius:.5vmin;opacity:.4}</style><div class=b><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div><div class=c></div></div><div class="u h"><div class=ti>King Thirteen</div><div class=bu>CONTINUE</div><div class=bu>NEW GAME</div><div class=bu>MUSIC: ON</div></div><div class="u h"><div class=ti>DEFEAT</div><div class="ti sc">Score: 0</div><div class=bu>SHARE ON X</div><div class=bu>NEW GAME</div></div><div class=to><div class=tb></div><div class=tb></div><div class=tb></div></div><script>const e=e=>440*2**((e-69)/12),t=4294967295;class n{state;constructor(e){this.state=0|e}randomUint32(){var e=this.state=this.state+1831565813|0,e=Math.imul(e^e>>>15,1|e);return((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0}random(){return this.randomUint32()/4294967296}}const l=(e,n)=>{for(var l=t-t%n;;){const t=e.randomUint32();if(t<l)return t%n}},a=e=>(2*e.randomUint32()-t)/t;class s{channels;sampleRate;prng;constructor(e,t,n){this.channels=e,this.sampleRate=t,this.prng=n}generateReverb(t,e,n,l,s=0,r=-60){var i,c=Math.round(l*this.sampleRate),o=Math.round(s*this.sampleRate),d=(10**(.1*r))**(1/(c-1)),u=1/(o-1);for(const t of(t=>{var n=[];for(let e=0;e<t.numberOfChannels;++e)n[e]=t.getChannelData(e);return n})(s=new AudioBuffer({length:c,numberOfChannels:this.channels,sampleRate:this.sampleRate}))){for(let e=0;e<c;++e)t[e]=a(this.prng)*d**e;for(let e=0;e<o;++e)t[e]*=u*e}i=t,r=s,t=e,s=n,e=l,n=new OfflineAudioContext(r.numberOfChannels,r.length,r.sampleRate),(t=new BiquadFilterNode(n,{type:"lowpass",Q:1e-4,frequency:t})).connect(n.destination),t.frequency.exponentialRampToValueAtTime(s,e),(s=new AudioBufferSourceNode(n,{buffer:r})).connect(t),s.start(),n.oncomplete=e=>{i(e.renderedBuffer)},n.startRendering()}}const r=[[64,0,.5,40,0,.25,67,.04,.5,71,.08,.5,76,.12,.5,47,.25,.5,71,.5,1.25,52,.5,.75,55,.75,1],[59,0,.25,76,.25,.5,55,.25,.5,78,.5,.75,52,.5,.75,79,.75,1,47,.75,1],[69,0,.5,45,0,.25,72,.04,.5,76,.08,.5,81,.12,.5,52,.25,.5,76,.5,1.25,57,.5,.75,60,.75,1],[64,0,.25,81,.25,.5,60,.25,.5,83,.5,.75,57,.5,.75,86,.75,1,52,.75,1],[69,0,.75,50,0,.25,74,.04,.75,78,.08,.75,81,.12,.75,57,.25,.5,62,.5,.75,79,.75,1,66,.75,1],[78,0,.25,69,0,.25,79,.25,.375,66,.25,.5,78,.375,.625,62,.5,.75,74,.625,1,57,.75,1],[59,0,1,35,0,.25,63,.04,1,66,.08,1,71,.12,1,42,.25,.5,47,.5,.75,51,.75,1],[63,0,1,54,0,.25,66,.04,1,71,.08,1,75,.12,1,51,.25,.5,47,.5,.75,42,.75,1],0,1,2,3,4,5,[64,0,2,40,0,.25,67,.04,2,71,.08,2,76,.12,2,47,.25,.5,52,.5,.75,55,.75,1],[64,0,.25,59,.25,.5,55,.5,.75,52,.75,1],[64,0,.125,40,0,.25,71,.125,.25,69,.25,.375,47,.25,.5,71,.375,.5,74,.5,.625,52,.5,.75,71,.625,.75,69,.75,.875,55,.75,1,71,.875,1],[64,0,.125,59,0,.25,71,.125,.25,69,.25,.375,55,.25,.5,71,.375,.5,74,.5,.625,52,.5,.75,71,.625,.75,69,.75,.875,47,.75,1,71,.875,1],[66,0,.125,36,0,.25,67,.125,.25,66,.25,.375,43,.25,.5,67,.375,.5,71,.5,.625,48,.5,.75,67,.625,.75,66,.75,.875,52,.75,1,67,.875,1],[66,0,.125,55,0,.25,67,.125,.25,66,.25,.375,52,.25,.5,67,.375,.5,71,.5,.625,48,.5,.75,67,.625,.75,66,.75,.875,43,.75,1,67,.875,1],[62,0,.125,38,0,.25,69,.125,.25,67,.25,.375,45,.25,.5,69,.375,.5,74,.5,.625,50,.5,.75,69,.625,.75,67,.75,.875,54,.75,1,69,.875,1],[62,0,.125,57,0,.25,69,.125,.25,67,.25,.375,54,.25,.5,69,.375,.5,74,.5,.625,50,.5,.75,69,.625,.75,67,.75,.875,45,.75,1,69,.875,1],[63,0,.125,35,0,.25,71,.125,.25,69,.25,.375,42,.25,.5,71,.375,.5,75,.5,.625,47,.5,.75,71,.625,.75,69,.75,.875,51,.75,1,71,.875,1],[63,0,.125,54,0,.25,71,.125,.25,69,.25,.375,51,.25,.5,71,.375,.5,75,.5,.625,47,.5,.75,71,.625,.75,69,.75,.875,42,.75,1,71,.875,1],16,17,18,19,20,21,22,[63,0,.125,47,0,.25,71,.125,.25,69,.25,.375,51,.25,.5,71,.375,.5,75,.5,.625,54,.5,.75,71,.625,.75,75,.75,.875,59,.75,1,78,.875,1],[64,0,.5,40,0,.125,67,.04,.5,71,.08,.5,76,.12,.5,47,.125,.25,52,.25,.375,55,.375,.5,71,.5,1.25,67,.5,1.25,59,.5,.625,55,.625,.75,52,.75,.875,47,.875,1],[40,0,.125,52,.125,.25,76,.25,.5,71,.25,.5,55,.25,.375,59,.375,.5,78,.5,.75,71,.5,.75,64,.5,.625,59,.625,.75,79,.75,1,71,.75,1,55,.75,.875,52,.875,1],[69,0,.5,45,0,.125,72,.04,.5,76,.08,.5,81,.12,.5,52,.125,.25,57,.25,.375,60,.375,.5,76,.5,1.25,72,.5,1.25,64,.5,.625,60,.625,.75,57,.75,.875,52,.875,1],[45,0,.125,57,.125,.25,81,.25,.5,76,.25,.5,60,.25,.375,64,.375,.5,83,.5,.75,76,.5,.75,69,.5,.625,64,.625,.75,86,.75,1,78,.75,1,60,.75,.875,57,.875,1],[69,0,.75,50,0,.125,74,.04,.75,78,.08,.75,81,.12,.75,54,.125,.25,57,.25,.375,62,.375,.5,66,.5,.625,62,.625,.75,79,.75,1,57,.75,.875,50,.875,1],[78,0,.25,74,0,.25,38,0,.125,45,.125,.25,79,.25,.375,50,.25,.375,78,.375,.625,54,.375,.5,57,.5,.625,74,.625,1,54,.625,.75,50,.75,.875,45,.875,1],[59,0,1,35,0,.125,63,.04,1,66,.08,1,71,.12,1,42,.125,.25,47,.25,.375,51,.375,.5,54,.5,.625,51,.625,.75,47,.75,.875,42,.875,1],[63,0,1,47,0,.125,66,.04,1,71,.08,1,75,.12,1,51,.125,.25,54,.25,.375,59,.375,.5,63,.5,.625,59,.625,.75,54,.75,.875,51,.875,1],32,33,34,35,36,37,[64,0,2,40,0,.125,67,.04,2,71,.08,2,76,.12,2,47,.125,.25,52,.25,.375,55,.375,.5,59,.5,.625,55,.625,.75,52,.75,.875,47,.875,1],[40,0,.125,52,.125,.25,55,.25,.375,59,.375,.5,64,.5,.625,67,.625,.75,71,.75,.875,76,.875,1],[79,0,1,76,0,1,64,0,.125,67,.125,.25,71,.25,.375,67,.375,.5,71,.5,1],[78,0,.5,74,0,.5,62,0,.25,69,.25,.5,81,.5,.75,74,.5,1,86,.75,1],[88,0,2,84,0,2,67,0,1.5,60,0,1.5],[60,.5,.75,67,.75,1],[91,0,1,88,0,1,83,0,1,79,0,.25,76,.25,.5,71,.5,.75,67,.75,1],[81,0,.3125,62,0,1,86,.04,.3125,90,.08,.3125,86,.3125,.625,81,.625,.9375,86,.9375,1.25],[64,.25,2,71,.29,2,76,.33,2,79,.37,2,83,.41,2,88,.45,2]];function i(t,e){if(!(54<e)){var n=r[e].push?r[e]:r[r[e]];for(let e=0;e<n.length;e+=3)t(n[e],n[e+1],n[e+2])}}const c=120/70,o=new class{con;initialized;async initialize(e){if(!this.initialized){if(this.con??=new AudioContext,"running"!==this.con.state){try{await this.con.resume()}catch(e){return}if(this.initialized)return}e?.(this.con),this.initialized=1}}},d=new n(9);let u,m,h;const f=t=>{var e="1"===localStorage.getItem("king13.mute");u=new GainNode(t,{gain:e?0:.3333}),m=new GainNode(t,{gain:.3333});const n=new ConvolverNode(t),l=new GainNode(t,{gain:.5}),a=new GainNode(t,{gain:.3333});u.connect(n),u.connect(l),m.connect(n),m.connect(l),n.connect(a),l.connect(t.destination),a.connect(t.destination),new s(2,t.sampleRate,d).generateReverb(e=>{n.buffer=e,h=t.currentTime+.05,p(),setInterval(p,999)},16e3,1e3,2*c,1e-5,-90)};function v(t,n,l){n*=c,l*=c;var a,s=t=new OscillatorNode(o.con,{type:"square",frequency:e(t)}),r=n;(a=new GainNode(o.con,{gain:.5})).gain.setValueAtTime(.5,h+r),a.gain.exponentialRampToValueAtTime(1e-5,h+r+2*c),s.connect(a),a.connect(u),t.start(h+n),t.stop(h+l)}let g=-1;function p(){let l=o.con.currentTime-h+4,e=(g+1)*c;if(!(e>l))for(l+=4;e<l;){const l=++g;i((e,t,n)=>v(e,t+l,n+l),l%57),e+=c}}function y(e){if(m)switch(e){case 0:x(91,0,.04);break;case 1:x(76,0,.05),x(79,.05,.05),x(83,.1,.1);break;case 2:x(83,0,.05),x(79,.05,.05),x(76,.1,.1);break;case 3:x(74,0,.05),x(76,.05,.05),x(79,.1,.05),x(83,.15,.05),x(86,.2,.05),x(88,.25,.1)}}function x(t,n,l){n+=o.con.currentTime,(t=new OscillatorNode(o.con,{type:"square",frequency:e(t)})).connect(m),t.start(n),t.stop(n+l)}const w=[35,36,38,39,40,42,43,45];function k(){var t,n,a,s;m&&(t=(s=o.con).currentTime,n=e(w[l(d,w.length)]),a=new OscillatorNode(s,{type:"square",frequency:n}),s=new GainNode(s),a.connect(s),s.connect(m),a.frequency.setValueAtTime(n,t),s.gain.setValueAtTime(1,t),a.frequency.exponentialRampToValueAtTime(.5*n,t+.2),s.gain.exponentialRampToValueAtTime(1e-5,t+.2),a.start(t),a.stop(t+.2))}const b=e=>{var t;if(e)return{species:e,value:t}=e,{species:e,value:t}},z=e=>[Array.from(e[0],b),Array.from(e[1],b),Array.from(e[2],b),Array.from(e[3],b)];let $,L,C,A,S,E,T,q,M,N,I,R,O;const B=e=>{$=[[,,,,],[,,,,],[,,,,],[,,,,]],L=null,C=null,A=null,S=null,E=null,T=null,q=1,M=1,N=0,I=0,R=0,O=new n(e??Date.now())},U=()=>[z($),C?.x??9,C?.y??9,A?.x??9,A?.y??9,S?.x??9,S?.y??9,E?.x??9,E?.y??9,T?.x??9,T?.y??9,q,M,N,O.state];let H=[];const V=()=>{var e,t,n,l,a,s,r,i,c,o,d,u,m,h,f=H.at(-1);f&&([f,e,t,n,l,a,s,r,i,c,o,d,u,m,h]=f,B(h),$=z(f),C=9===e?null:{x:e,y:t},A=9===n?null:{x:n,y:l},S=9===a?null:{x:a,y:s},E=9===r?null:{x:r,y:i},T=9===c?null:{x:c,y:o},q=d,M=u,N=m)},F=e=>{switch(e.length){case 0:return;case 1:return e[0]}return e[l(O,e.length)]},j=()=>{var n=[];for(let t=0;t<4;++t)for(let e=0;e<4;++e)if(!$[t][e]){if(E&&E.x===e&&E.y===t)continue;n.push({x:e,y:t})}if(n.length){let e=1;switch(l(O,9)){case 0:case 1:case 2:4<=q&&(e=2);break;case 3:case 4:6<=q&&(e=3);break;case 5:8<=q&&(e=4)}8<=q&&M<4?e=4:6<=q&&M<3?e=3:4<=q&&M<2&&(e=2),e>M&&(M=e);let t=1;switch(l(O,9)){case 0:case 1:4<=q&&(t=2);break;case 2:6<=q&&(t=3)}var a,s,{x:r,y:i}=F(n);S=C&&C.x===r&&C.y===i?({x:a,y:s}=F(n),$[s][a]={species:e,value:t},{x:a,y:s}):($[i][r]={species:e,value:t},{x:r,y:i})}else I=1},G=(e,t)=>{S={x:e,y:t}},D=(l,a)=>{const s=[],e=(e,t)=>{let n;if(t=a+t,0<=(e=l+e)&&e<4&&0<=t&&t<4&&((n=!$[t][e])||$[t][e].value===$[a][l]?.value))return s.push({x:e,y:t}),n},t=$[a][l];if(t)switch(t.species){case 1:e(-2,-1),e(-2,1),e(-1,-2),e(-1,2),e(1,-2),e(1,2),e(2,-1),e(2,1);break;case 2:e(-1,-1)&&e(-2,-2)&&e(-3,-3),e(-1,1)&&e(-2,2)&&e(-3,3),e(1,-1)&&e(2,-2)&&e(3,-3),e(1,1)&&e(2,2)&&e(3,3);break;case 3:e(-1,0)&&e(-2,0)&&e(-3,0),e(0,-1)&&e(0,-2)&&e(0,-3),e(1,0)&&e(2,0)&&e(3,0),e(0,1)&&e(0,2)&&e(0,3);break;case 4:e(-1,-1)&&e(-2,-2)&&e(-3,-3),e(-1,1)&&e(-2,2)&&e(-3,3),e(1,-1)&&e(2,-2)&&e(3,-3),e(1,1)&&e(2,2)&&e(3,3),e(-1,0)&&e(-2,0)&&e(-3,0),e(0,-1)&&e(0,-2)&&e(0,-3),e(1,0)&&e(2,0)&&e(3,0),e(0,1)&&e(0,2)&&e(0,3)}return s},J=(e,t)=>{const n=[[,,,,],[,,,,],[,,,,],[,,,,]];return D(e,t).forEach(({x:e,y:t})=>{n[t][e]=1}),n},K=e=>e.species+e.value,Q=()=>{let l=9,a=9,s=0;for(let t=0;t<4;++t)for(let e=0;e<4;++e){var n=$[t][e];n?5===n.species&&(l=e,a=t):++s}if(9===l||0===s||1===s)E=null,T=null;else{const s=[];let n=[];const r=(e,t)=>{if(t=a+t,0<=(e=l+e)&&e<4&&0<=t&&t<4){const l=$[t][e];l?A&&A.x===e&&A.y===t||n.push({x:e,y:t,worth:K(l)}):s.push({x:e,y:t})}},i=(r(-1,-1),r(-1,0),r(-1,1),r(0,-1),r(0,1),r(1,-1),r(1,0),r(1,1),n.sort((e,t)=>t.worth-e.worth),n[0]?.worth??0);var e,t;n=n.filter(({worth:e})=>e===i),i&&!s.length?({x:e,y:t}=F(n),L&&L.x===e&&L.y===t&&(L=null),N-=2**$[t][e].value,$[t][e]=$[a][l],$[a][l]=null,E={x:l,y:a},T={x:e,y:t},R=1):s.length&&({x:e,y:t}=F(s),$[t][e]=$[a][l],$[a][l]=null,E={x:l,y:a},T={x:e,y:t},R=0)}},W=()=>{let n=N;for(let t=0;t<4;++t)for(let e=0;e<4;++e){var l=$[t][e];!l||5===l.species||10<l.value||(n-=2**(l.value-1))}return n},X=["#1a1c2c","#34223f","#4c2550","#63285d","#782d5d","#8c325c","#9e3859","#b03e54","#bd4854","#c95154","#d55c53","#df6755","#e87356","#ef7e57","#f48c5c","#f79a60","#faa765","#fcb36a","#fec070","#ffcd75"],_=["#17001d","#300123","#450428","#58092d","#690f31","#7b1235","#8d1539","#9e173b","#af173d","#bf1640","#d01441","#df1143","#ef0c45"],P=e=>{let t=X;return 10===e&&(t=_,e=1),[t.at(-e-3),t.at(0),t.at(-e),t.at(-e-6),t.at(-e-8)]},Y=document.querySelector(".b"),Z=(e,t,a)=>{e.addEventListener("click",()=>{var e=((e,t)=>{let n;if(L)if(L.x===e&&L.y===t)L=null;else if($[t][e])if($[t][e].value===$[L.y][L.x]?.value)if(J(L.x,L.y)[t][e]){$[t][e]=$[L.y][L.x],N+=2**$[t][e].value;const l=++$[t][e].value;$[L.y][L.x]=null,C=L,A={x:e,y:t},L=null,l>q&&(q=l),10<l?I=1:D(e,t).some(e=>$[e.y][e.x]?.value===l)?L={x:e,y:t}:(Q(),j()),n=1,I||y(R?2:1)}else L={x:e,y:t};else $[t][e]&&(L={x:e,y:t});else J(L.x,L.y)[t][e]?($[t][e]=$[L.y][L.x],$[L.y][L.x]=null,C=L,A={x:e,y:t},L=null,Q(),j(),n=1,R?y(2):k()):L=null;else $[t][e]&&(L={x:e,y:t});return n})(t,a),n=[];for(let t=0;t<4;++t)for(let e=0;e<4;++e){var l=$[t][e];l&&5!==l.species&&D(e,t).length&&n.push({x:e,y:t})}(I=n.length?I:1)?ue():e&&(H.push(U()),4<H.length&&H.shift(),localStorage.setItem("king13.stack",JSON.stringify(H))),Y.classList.remove("sh"),ce()})},ee=(()=>{var n=[],l=document.querySelectorAll(".c");for(let t=0;t<4;++t){n[t]=[];for(let e=0;e<4;++e)Z(n[t][e]=l[4*t+e],e,t)}return n})(),te={1:(e,t,n,l,a)=>`<svg clip-rule="evenodd" fill-rule="evenodd" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill-rule="evenodd"><path d="m22.803 5.768-2.495.468-.995 3.425-2.169-1.423-1.427.424.76 4.951-9.702 14.98c-.358 5.956 1.871 6.017 6.143 7.647 4.973-7.019 10.689-5.016 15.371-10.323.563 6.622-15.845 9.2-13.646 18.275l27.09.058c3.811-16.778 1.02-27.75-14.607-33.796z" fill="${e}" stroke="${t}" stroke-linejoin="round" stroke-width="1.3"/><path d="m21.619 17.718c-.45-.01-.835.285-1.09.609-.414.533-.63 1.178-.748 1.82-.044.278-.094.558-.077.838.026.098.144.063.217.044.632-.118 1.29-.128 1.907-.316.447-.14.801-.464 1.034-.84.233-.36.333-.773.471-1.168.061-.138.045-.315-.096-.407-.232-.16-.513-.242-.772-.356-.254-.097-.505-.23-.788-.224h-.059z" fill="${a}" style="mix-blend-mode:darken"/><path d="m22.803 5.768-1.247.234 3.807 5.702c19.045 8.125 18.868 24.79 6.86 32.524l9.51.021c3.81-16.778 1.023-27.75-14.604-33.796z" fill="${l}" style="mix-blend-mode:darken"/><path d="m16.586 9.211c.146 1.706.874 4.43.571 4.836l-9.61 14.73c-.323 3.61 1.066 4.888 1.342 4.832-.087.01-1.418-2.128-.53-4.647l9.67-14.883-1.432-4.858c-.14-.132.159.072-.01-.01z" fill="${n}" style="mix-blend-mode:lighten"/><path d="m27.442 25.617s2.02-2.624 1.99-3.823 1.065 5.553-1.303 6.363c-.098-.413.272-1.709.198-1.993-.32-1.224-.884-.417-.885-.547z" fill="${l}" stroke="${l}" style="mix-blend-mode:darken" stroke-width=".26458"/></g><path d="m28.727 28.005c-2.834 6.232-14.734 8.14-13.325 15.542-1.072-6.537 13.176-8.88 13.325-15.542z" fill="${n}" style="mix-blend-mode:lighten"/><path d="m10.763 28.109s-.047 2.386-1.561 2.185c0 0-1.834-1.016 1.561-2.185z" fill="${a}" style="mix-blend-mode:darken"/></svg>`,2:(e,t,n,l,a)=>`<svg clip-rule="evenodd" fill-rule="evenodd" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><g><path d="m25 5.75c-1.683 0-3.047 1.099-3.047 2.453 0 .503.194.993.554 1.405-2.54 3.306-8.781 9.8-8.985 16.336-.087 3.375 3.933 8.723 4.107 9.26.174.535 1.333.933 3.268 1.176-1.33 4.59-10.097-1.079-14.147 3.37l1.842 4.5c5.573-3.122 9.967 3.15 16.408-3.422v.001c6.44 6.57 10.835.299 16.407 3.421l1.842-4.5c-4.05-4.448-12.817 1.22-14.148-3.37 1.936-.243 3.095-.64 3.269-1.177.174-.536 4.194-5.884 4.107-9.26-.205-6.535-6.445-13.028-8.986-16.335.36-.412.554-.902.554-1.405 0-1.354-1.363-2.452-3.046-2.453z" fill="${e}" stroke="${t}" stroke-linejoin="round" stroke-width="1.3"/><path d="m25 21.106c-.699 0-1.02.342-1.02 1.025v2.453h-2.388c-.64 0-.96.31-.96.931 0 .622.32.932.96.932h2.389v2.453c0 .683.35 1.025 1.019 1.025.67 0 1.02-.342 1.02-1.025v-2.453h2.475c.612 0 .932-.31.932-.932 0-.62-.32-.931-.932-.931h-2.476v-2.454c0-.683-.35-1.025-1.019-1.025z" fill="${a}" style="mix-blend-mode:darken"/><path d="m25 5.75c-.827 0-1.62.27-2.194.75 3.937.194 4.045 2.262 3.072 3.475 1.102 2.394 2.82 4.2 4.161 6.431 0 0 11.604 21.888-13.358 17.253 0 0 .63 1.553 2.03 2.28.7.364 1.164.396 2.185.441 1.323.08 5.334.537 6.306.69 1.937 7.056 13.332.012 15.127 4.93l.921-2.249c-3.726-4.452-9.996 1.063-14.057-3.31 1.38-.214 2.392-.603 2.954-.898 0-.143 4.422-6.065 4.331-9.6-.204-6.534-6.443-13.026-8.984-16.334.359-.412.553-.904.553-1.407 0-1.354-1.364-2.452-3.047-2.452z" fill="${l}" style="mix-blend-mode:darken"/><path d="m23.793 6.898c-.714.32-1.265.95-1.002 1.779.085.32.315.507.466.79a.91.91 0 0 1 -.143.73c-1.576 1.946-5.566 6.411-7.414 10.599-.704 1.735-1.565 3.746-1.396 5.648.475 3.413 3.388 7.392 3.388 7.392s-2.053-4.357-2.246-7.021c-.032-7.08 5.8-12.424 8.301-17.1-.379-1.577-1.172-1.464.046-2.817zm-14.786 36.293c0-.058-1.345-3.262-1.345-3.262 2.92-2.56 8.369-.3 11.229-.952-4.286.847-7.639-.51-10.07 1.09z" fill="${n}" style="mix-blend-mode:lighten"/></g></svg>`,3:(e,t,n,l,a)=>`<svg clip-rule="evenodd" fill-rule="evenodd" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><g stroke-width="1.079"><path d="m3329.1-2128.5-.643 2.608-3.389.194-.589-2.593-4.87 1.003v7.87c.846 2.112 1.968 2.466 3.027 3.027h2.162l-3.148 17.25c-4.314 2.456-5.284 3.57-5.284 8.502h31.034c0-4.933-.97-6.046-5.283-8.502l-3.148-17.25h2.161c1.06-.56 2.182-.915 3.027-3.027v-7.87l-4.87-1.003-.589 2.592-3.388-.194-.643-2.608h-2.784z" fill="${e}" stroke="${t}" stroke-width="1.4027" transform="matrix(.91877 0 0 .93482 -3036.3 1998.5)"/><path d="m3341.8-2127.8c4.172 12.439-14.069 10.218-21.331 9.793 0 0 .085 1.6 2.246 1.604h2.197-.036l-.092.503c13.852-1.045 11.329 3.048 13.773 15.557l-16.717.578-.111.613-1.051.613c5.434.595 23.899-3.102 22.257 7.89h4.543c.262-5.094-1.767-6.688-5.284-8.503l-2.962-17.53c.3-.194.96 0 1.922-.161 1.28-.213 2.624-1.483 3.08-2.748v-7.554z" fill="${l}" style="mix-blend-mode:darken" transform="matrix(.91877 0 0 .93482 -3036.3 1998.5)"/><path d="m14.384 10.418 2.172-.444c-1.21.475-1.62 3.045-2.105 6.36-.145.994-.068-5.916-.068-5.916zm8.544-.935-.572 2.4 1.947-2.407zm9.372.281-.5 2.303 1.411-2.109zm-13.23 10.844-2.738 15.027 3.487-14.935zm-7.626 22.622c-.013-.043-.031-1.011.152-1.914.209-1.022.696-2.007 1.488-2.64 1.462-1.168 2.688-1.829 2.826-1.833-2.104 1.629-4.051 3.62-4.466 6.387z" fill="${n}" style="mix-blend-mode:lighten"/></g></svg>`,4:(e,t,n,l,a)=>`<svg clip-rule="evenodd" fill-rule="evenodd" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(.98734 0 0 .96296 -3412.8 2056)"><path d="m3475.9-2129.1a4.37 4.37 0 0 0 -4.373 4.367c0 1.98 1.34 3.71 3.258 4.216v11.158l-5.362-7.492c.485-.72.746-1.568.746-2.435a4.37 4.37 0 0 0 -4.375-4.367 4.37 4.37 0 0 0 -4.373 4.367c.065 2.14 1.935 3.816 4.328 4.365l.88 4.236 1.76 8.474 2.765 5.191 1.12 6.47c0 .801 4.318 1.45 9.647 1.45s9.648-.649 9.648-1.45l1.12-6.47 2.765-5.19 1.76-8.475.879-4.236c2.393-.55 4.264-2.225 4.328-4.365a4.37 4.37 0 0 0 -4.373-4.367 4.37 4.37 0 0 0 -4.374 4.367c0 .867.26 1.715.745 2.435l-5.361 7.493v-11.16a4.368 4.368 0 0 0 3.257-4.215 4.37 4.37 0 0 0 -4.373-4.367 4.37 4.37 0 0 0 -4.374 4.367c0 1.425.702 2.759 1.873 3.573l-3.52 10.364-3.52-10.364a4.358 4.358 0 0 0 1.874-3.573 4.37 4.37 0 0 0 -4.374-4.367z" fill="${e}" stroke="${t}" stroke-width="1.3331"/><path d="m3498.4-2124c.95.986 3.299 5.321-2.077 8.733l-5.191 13.456c-6.962 1.255-14.694 1.553-20.32-.42l1.905 3.125c6.593 2.295 17.806.487 17.806.487-1.074 3.57-2.579 6.848-5.665 9.425 0 0 4.52.12 6.612-1.376l1.57-6.797 2.765-5.19 1.76-8.474.879-4.236c2.393-.55 4.264-2.225 4.328-4.365a4.37 4.37 0 0 0 -4.372-4.368z" fill="${l}" style="mix-blend-mode:darken"/><path d="m3475.9-2129.1c-.265 0-.524.028-.776.073 3.03 1.854 2.41 6 1.605 7.374l5.192 8.659-.776-1.801-2.744-6.364a4.357 4.357 0 0 0 1.874-3.574 4.37 4.37 0 0 0 -4.375-4.367zm12 0c-.265 0-.524.028-.776.073 4.562 1.318 1.776 6.566.654 6.989l1.238 10.482v-8.961a4.368 4.368 0 0 0 3.257-4.216 4.37 4.37 0 0 0 -4.373-4.367zm-22.2 5.4c-.266 0-.524.027-.776.073 3.285 1.245 3.06 4.466 2.378 6.646l7.388 7.575-5.361-7.492c.485-.72.745-1.568.745-2.435a4.37 4.37 0 0 0 -4.374-4.367z" fill="${l}" style="mix-blend-mode:darken"/></g><path d="m6.852 12.406s-3.273 2.607.121 5.31c-.219-.55-.906-3.764-.12-5.31zm10.466-5.489c-.359-.155-3.303 2.198-1.152 5.149.099-.478-.836-3.765 1.152-5.149zm12.144-.096c-.359-.155-3.504 2.177-1.307 5.201-.168-.554-.719-4.233 1.307-5.2zm-19.747 12.037 2.653 12.572 2.754 5.045 1.088 6.177.702.226-1.085-6.452-2.805-4.972zm29.719-6.741c-.359-.155-3.473 2.267-1.292 5.246-.21-.984-1.032-4.354 1.292-5.246z" fill="${n}" style="mix-blend-mode:lighten"/></svg>`,5:(e,t,n,l,a)=>`<svg clip-rule="evenodd" fill-rule="evenodd" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><g stroke-width="1.04" transform="matrix(.96234 0 0 .9617 -3133.3 2054.9)"><path d="m3281.9-2090.7c6.361 0 11.51-.56 11.51-1.249l1.342-6.525c11.336-7.821 6.689-19.658-3.35-19.615-2.083.01-4.893.53-6.264 1.338l-.876-4.1h3.895c1.17.13 1.77-1.6 1.77-2.668 0-1.067-.592-2.667-1.77-2.667h-3.388v-3.092c0-.97-1.804-1.455-2.89-1.455s-2.892.485-2.892 1.455v3.092h-3.388c-1.18 0-1.77 1.6-1.77 2.667 0 1.068.6 2.799 1.77 2.668h3.895l-.876 4.1c-1.37-.807-4.18-1.328-6.264-1.338-10.038-.043-14.685 11.794-3.35 19.615l1.342 6.525c0 .689 5.15 1.246 11.51 1.249h.023z" fill="${e}" stroke="${t}" stroke-width="1.3513"/><path d="m3287.7-2126.4c-.55-.01-.968.097-.986.185.738.752 3.757 4.344-3.738 3.792-.902.506.15 7.329.891 9.249 0 0 1.22-.547 2.05-.977 14.764-4.253 12.707 12.372 3.903 15.299-5.255.795-13.114 1.12-18.294.35l.413 2.538c6.744.603 6.596.464 15.112.59 4.2 2.842-11.95 3.965-16.7 3.396.092.263 23.03 1.225 23.058.036l1.342-6.56c11.335-7.821 6.69-19.657-3.348-19.615-.876 0-1.877.103-2.849.271l-3.411 1.065-.876-4.099h3.894c1.027.294 1.743-1.58 1.77-2.668.151-2.251-1.43-2.704-2.228-2.852z" fill="${l}" style="mix-blend-mode:darken"/><path d="m3282.9-2129.8c-.942-.253-2.572-.194-3.17.55-.044.056-.034.215-.033.296l.028 3.576h-3.453c-.296 0-.787-.016-.97.088-.37.206-.717.94-.75 1.79-.027.689.5 1.896.877 1.93.237.02.576-.029 1.182-.01-1.884-.7-1.398-3.503-.2-3.451l3.63-.028-.046-3.143c-.014-.97.65-1.471 1.737-1.471.427 0 1.428.04 1.924.191-.519-.301-.757-.316-.757-.316zm-3 10.6-.77 3.661c-1.37-.807-4.11-1.766-6.193-1.775-9.415-.753-14.415 10.655-3.24 18.389l1.349 6.62.108.015-.452-6.716c-10.51-7.743-6.864-17.498 3.174-17.455 2.084.01 4.254.978 5.625 1.785l.908-6.87z" fill="${n}" style="mix-blend-mode:lighten"/></g></svg>`};let ne=0;const le=(e,t)=>`<pattern id="pa${++ne}" patternTransform="scale(3.4)" patternUnits="userSpaceOnUse" width="4" height="4"><rect width="4" height="4" fill="${e}"/><path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="${t}" stroke-width="1.5"/></pattern>`;let ae,se,re;const ie=(e,t,n,l)=>{const a=document.createElement("div"),s=(a.className="p ps"+n,(l-1)%10+1),r=P(s);let i;if(10===l||l%2)i=te[n](...r);else{const e=P(1+s),t=P(s-1),l=le(e[0],t[0]),a=(e[0]=`url(#pa${ne})`,le(e[2],t[2])),r=(e[2]=`url(#pa${ne})`,le(e[3],t[3]));e[3]=`url(#pa${ne})`,i=te[n](...e).replace("</svg>","<defs>"+l+a+r+"</defs></svg>")}a.innerHTML=i,C&&C!==ae&&A?.x===e&&A?.y===t?(a.style.animation=".2s cubic-bezier(.5,1,.89,1) t"+C.x+C.y+e+t,ae=C):S&&S!==se&&S?.x===e&&S?.y===t&&(a.style.animation=".2s cubic-bezier(.5,1,.89,1) sp",se=S),E&&E!==re&&T?.x===e&&T?.y===t&&(a.style.animation=".2s cubic-bezier(.5,1,.89,1) t"+E.x+E.y+e+t,re=E,R)&&Y.classList.add("sh");var c=(t=(e=a.firstChild.firstChild).firstChild).cloneNode(),o=+c.getAttribute("stroke-width");return c.setAttribute("stroke-width",""+4*o),c.setAttribute("stroke-linejoin","round"),c.classList.add("st"),e.insertBefore(c,t),(o=document.createElement("div")).className="n",5===n?(o.textContent="XIII",o.style.color=r[4]):(o.textContent=""+2**l,o.style.backgroundColor=r[1]+"90",o.style.color=r[2]),a.append(o),a},ce=i=>{let c;L&&$[L.y][L.x]&&(c=J(L.x,L.y));for(let r=0;r<4;++r)for(let s=0;s<4;++s){let e=ee[r][s],t=(L?.x===s&&L?.y===r?e.classList.add("s"):e.classList.remove("s"),c?.[r][s]?e.classList.add("a"):e.classList.remove("a"),e.firstChild),n=1,l=0,a=$[r][s];a&&(n=a.species,l=a.value),t&&!l?e.removeChild(t):!t&&l?(i&&G(s,r),e.append(ie(s,r,n,l))):t&&l&&t.replaceWith(ie(s,r,n,l))}},oe=()=>{B(),$[3][0]={species:5,value:10},j(),j(),H=[U()],localStorage.removeItem("king13.stack"),ce(1)};let de=!0;const ue=()=>{var e=document.querySelectorAll(".u")[1];e.querySelector(".ti").textContent=10<q?"SUCCESS":"DEFEAT",e.querySelector(".sc").textContent="Score: "+W(),e.classList.remove("h"),y(10<q?3:2)};document.addEventListener("contextmenu",e=>{e.preventDefault()}),document.addEventListener("mousedown",()=>{o.initialized||o.initialize(f)},{once:!0}),document.addEventListener("touchend",()=>{o.initialized||o.initialize(f)},{once:!0}),(()=>{var a,s,r=[];for(let l=0;l<4;++l)for(let n=0;n<4;++n)for(let t=0;t<4;++t)for(let e=0;e<4;++e)n===e&&l===t||(a=22.275*(n-e),s=22.275*(l-t),r.push(`@keyframes t${n}${l}${e}${t}{0%{transform:translate(${a}vmin,${s}vmin)}100%{transform:translate(0,0)}}`));var e=document.createElement("style");e.textContent=r.join(""),document.head.append(e),document.addEventListener("animationstart",e=>{e.target?.classList.add("an")}),document.addEventListener("animationend",e=>{e.target?.classList.remove("an")})})(),(()=>{const e=document.querySelectorAll(".tb"),t=e[0],n=e[1],l=e[2],a=(t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path fill="currentColor" d="M224 128a8 8 0 0 1-8 8H40a8 8 0 0 1 0-16h176a8 8 0 0 1 8 8M40 72h176a8 8 0 0 0 0-16H40a8 8 0 0 0 0 16m176 112H40a8 8 0 0 0 0 16h176a8 8 0 0 0 0-16"/></svg>',n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path fill="currentColor" d="M212.92 17.69a8 8 0 0 0-6.86-1.45l-128 32A8 8 0 0 0 72 56v110.08A36 36 0 1 0 88 196V62.25l112-28v99.83A36 36 0 1 0 216 164V24a8 8 0 0 0-3.08-6.31M52 216a20 20 0 1 1 20-20a20 20 0 0 1-20 20m128-32a20 20 0 1 1 20-20a20 20 0 0 1-20 20"/></svg>',l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path fill="currentColor" d="M232 144a64.07 64.07 0 0 1-64 64H80a8 8 0 0 1 0-16h88a48 48 0 0 0 0-96H51.31l34.35 34.34a8 8 0 0 1-11.32 11.32l-48-48a8 8 0 0 1 0-11.32l48-48a8 8 0 0 1 11.32 11.32L51.31 80H168a64.07 64.07 0 0 1 64 64"/></svg>',document.querySelectorAll(".u")),s=a[0],r=a[1],i=s.querySelectorAll(".bu"),c=i[0],o=i[1],d=i[2],m=r.querySelectorAll(".bu"),h=m[0],f=m[1];"1"===localStorage.getItem("king13.mute")&&(de=!1,n.classList.add("of"),d.textContent="MUSIC: OFF"),t.addEventListener("click",()=>{I||(s.classList.toggle("h"),k())}),c.addEventListener("click",()=>{s.classList.add("h"),k()}),o.addEventListener("click",()=>{s.classList.add("h"),oe(),y(0)}),f.addEventListener("click",()=>{r.classList.add("h"),oe(),y(0)});var v=()=>{var e=!(de=!de);u&&(u.gain.value=e?0:.3333),n.classList.toggle("of",!de),d.textContent=de?"MUSIC: ON":"MUSIC: OFF",localStorage.setItem("king13.mute",de?"0":"1")};n.addEventListener("click",v),d.addEventListener("click",v),l.addEventListener("click",()=>{I||(()=>{if(!(H.length<2))return H.pop(),V(),1})()&&(ae=C,re=E,ce(1),localStorage.setItem("king13.stack",JSON.stringify(H)),y(0))}),h.addEventListener("click",()=>{var e=10<q?"SUCCESS":"DEFEAT",t=W(),e=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e+`! I scored ${t} in King Thirteen!`)}&url=${encodeURIComponent("https://js13kgames.com/2024/games/king-thirteen")}&hashtags=KingThirteen,js13k&via=mvasilkov`;window.open(e,"_blank"),k()})})(),(()=>{let e;B();var t=localStorage.getItem("king13.stack");if(t)try{var n=JSON.parse(t);Array.isArray(n)&&(H=n,e=1)}catch(e){}e?(V(),ae=C,re=E,ce(1)):oe()})()</script>