<title>UXU - js13kGames 2012</title><style>body{margin:0;padding:0;text-align:center}canvas{outline:0;border:1px solid #000;margin-left:auto;margin-right:auto}</style><script></script><div id=gameArea><canvas id=gameCanvas class="gradient ffffff 000000 horizontal"></canvas></div><script>var e=window.innerWidth,t=window.innerHeight,a=document.getElementById("gameCanvas"),n=a.getContext("2d"),r=(a.width,a.height,e=600,t=720,margin=1,a.width=600,a.height=720,camX=0,camY=0,(mountainImage=new Image).src="mount.png",(cloudImage=new Image).src="cloud.png",mouseX=0,mouseY=0,keysDown=new Array,arrow={left:37,up:38,right:39,down:40,space:32},phaseState={startScreen:0,setup:1,run:2,succeed:4,fail:5},currentPhaseState=phaseState.startScreen,startingLevel=1,currentLevel=1,levelDuration=13e3,currentTimeLeft=13e3,lifeLeft=13,heightMax=0,helpTime=0,bonusJumpCount=1,new Date,n.createLinearGradient(0,0,0,t));function i(e){var t=e.x;return e=e.y,Math.sqrt(t*t+e*e)}function l(e){var t=i(e={x:e.x,y:e.y});return 1e-4<t?(e.x=e.x/t,e.y=e.y/t):(e.x=1,e.y=0),e}function o(e,t){return(e={x:e.x,y:e.y}).x*=t,e.y*=t,e}function s(e){var t=e=8253729*e+2396403,a=1231121986^t;return{next:function(e,n){t=(t<<16)+(t>>16),a+=t+=a;var r=t%65535/65535.1;return Math.abs(r)}}}r.addColorStop(0,"#C0C2F5"),r.addColorStop(.5,"#FA90BE"),r.addColorStop(1,"#FEDCD3"),document.getElementById("mouse");var f=s(12375);function u(){var e=this;e.image=new Image,e.image.src="charac2.png",e.width=45,e.height=45,e.X=0,e.Y=0,e.interval=0,e.time=0,e.speed={x:0,y:0},e.gravity=7,e.controlSpeedX=2,e.alive=!1,e.bonusJumpUsed=!1,e.setPosition=function(t,a){e.X=t,e.Y=a,e.speed.x=0,e.speed.y=-5},e.spawn=function(t,a){e.X=t,e.Y=a,e.speed.x=0,e.speed.y=-7,e.alive=!0,e.time=0,e.bonusJumpUsed=!1},e.update=function(t){currentPhaseState==phaseState.run&&e.alive&&(e.time+=t,t/=1e3,e.time,keysDown[arrow.left]&&(e.speed.x=-e.controlSpeedX),keysDown[arrow.right]&&(e.speed.x=e.controlSpeedX),0<bonusJumpCount&&(keysDown[arrow.space]&&0==e.bonusJumpUsed&&(e.bonusJumpUsed=!0,e.speed.y=-10,bonusJumpCount--,F(e.X,e.Y)),0==keysDown[arrow.space])&&(e.bonusJumpUsed=!1),e.speed.y+=e.gravity*t,e.Y>360&&(e.speed.y=-7,currentTimeLeft=13e3),e.Y,e.X>300&&(e.speed.x=-e.speed.x),e.X<-300&&(e.speed.x=-e.speed.x),e.X+=e.speed.x,e.Y+=e.speed.y)},e.draw=function(){if(currentPhaseState==phaseState.run&&e.alive)try{var t=Math.round(e.X-camX-e.width/2),a=Math.round(e.Y-camY-e.height/2);n.drawImage(e.image,t,a,e.width,e.height)}catch(t){}}}for(var c=new Array,h=0;h<30;h++)c[h]=new u;function p(){var e=this;e.image=new Image,e.image.src="bomb.png",e.width=64,e.height=64,e.X=0,e.Y=0,e.interval=0,e.time=0,e.speed={x:0,y:0},e.gravity=9,e.angle=1,e.alive=!1,e.duration=3e3,e.spawn=function(t,a){e.X=t,e.Y=a,e.alive=!0,e.time=0},e.findNearestPlayer=function(){for(var t,a,n=0,r=Number.MAX_VALUE,l=0;l<c.length;l++)1==c[l].alive&&(a=i({x:(t=c[l]).X-e.X,y:t.Y-e.Y}))<r&&(n=t,r=a);return n},e.update=function(t){if(e.alive&&currentPhaseState==phaseState.run){e.time+=t;var a=e.findNearestPlayer();e.Y+360<a.Y&&(e.alive=!1,F(e.X,e.Y),--lifeLeft<=0)&&(lifeLeft=0,currentPhaseState=phaseState.fail),t/=1e3,e.time,e.angle+=t,t=o(l({x:a.X-e.X,y:a.Y-e.Y}),1),e.speed.x=.7*e.speed.x+.3*t.x,e.speed.y=.7*e.speed.y+.3*t.y,e.speed=o(l(e.speed),1),e.speed.y=-(2+currentLevel/6),e.X+=e.speed.x,e.Y+=e.speed.y;for(var n,r=0;r<c.length;r++)1==c[r].alive&&i(n={x:(a=c[r]).X-e.X,y:a.Y-e.Y})<50&&(a.speed.x=n.x<0?-2:2,a.speed.y=-(5+currentLevel/6),e.alive=!1,F(e.X,e.Y))}},e.draw=function(){if(e.alive&&currentPhaseState==phaseState.run)try{var t=Math.round(e.X-camX-e.width/2),a=Math.round(e.Y-camY-e.height/2);n.drawImage(e.image,t,a,e.width,e.height)}catch(t){}}}var d=new Array;for(h=0;h<30;h++)d[h]=new p;function m(e){var t=this;t.image=new Image,t.image.src="tower.png",t.width=64,t.height=64,t.X=0,t.Y=0,t.interval=0,t.time=0,t.spawnTimeLeft=0,t.speed={x:0,y:0},t.gravity=9,t.angle=1,t.alive=!1,t.period=1e3,t.offsetMax=2e3,t.offset=f.next()*t.offsetMax%t.offsetMax,t.rocket=0,t.restart=function(){t.time=0,t.spawnTimeLeft=t.offset,t.rocket=0},t.restart=function(){t.time=0,t.spawnTimeLeft=t.offset,t.rocket=0},t.spawn=function(e,a){t.X=e,t.Y=a,t.alive=!0},t.spawnRocket=function(){return!(!t.alive||0!=t.rocket&&0!=t.rocket.alive||(t.rocket=function(e,t){for(var a=0;a<d.length;a++)if(0==d[a].alive)return d[a].spawn(e,t),d[a];return 0}(t.X,t.Y),0))},t.update=function(e){t.alive&&currentPhaseState==phaseState.run&&(t.time+=e,t.spawnTimeLeft-=e,t.spawnTimeLeft<0&&(t.spawnRocket()?t.spawnTimeLeft+=t.period:t.spawnTimeLeft+=100),t.time)},t.draw=function(){if(t.alive)try{var e=Math.round(t.X-camX-t.width/2),a=Math.round(t.Y-camY-t.height/2);n.drawImage(t.image,e,a,t.width,t.height)}catch(e){}}}var g=new Array;for(h=0;h<30;h++)g[h]=new m;function v(){var e=this;e.images=new Array;for(var t=0;t<5;t++)e.images[t]=new Image,e.images[t].src="explo"+t+".png";e.width=64,e.height=64,e.X=0,e.Y=0,e.time=0,e.alive=!1,e.frame=0,e.fps=15,e.reset=function(){e.time=0,e.alive=!1},e.spawn=function(t,a){e.X=t,e.Y=a,e.alive=!0},e.update=function(t){e.alive&&currentPhaseState==phaseState.run&&(e.time+=t,t=e.time/1e3,e.frame=Math.round(t*e.fps),e.frame>=e.images.length)&&e.reset()},e.draw=function(){if(e.alive&&currentPhaseState==phaseState.run)try{var t=e.images[e.frame],a=Math.round(e.X-camX-e.width/2),r=Math.round(e.Y-camY-e.height/2);n.drawImage(t,a,r,e.width,e.height)}catch(t){}}}var x=new Array;for(h=0;h<30;h++)x[h]=new v;function w(){for(var e=0;e<g.length;e++)g[e].alive=!1}function y(){for(var e=0;e<c.length;e++)c[e].alive=!1;for(var t=0;t<d.length;t++)d[t].alive=!1;for(e=0;e<g.length;e++)g[e].restart();var a=480/(currentLevel+1);for(e=0;e<currentLevel;e++)!function(e){for(var t=0;t<g.length;t++)if(0==g[t].alive)return g[t].spawn(e,360)}((e+.5-currentLevel/2)*a);(function(){for(var e=0;e<c.length;e++)if(0==c[e].alive)return c[e].spawn(0,100),c[e]})(),currentTimeLeft=13e3}function F(e,t){for(var a=0;a<x.length;a++)if(0==x[a].alive)return x[a].spawn(e,t)}function S(){if(currentPhaseState!=phaseState.run)switch(currentPhaseState){case phaseState.startScreen:bonusJumpCount=1,currentLevel=1,lifeLeft=13,w(),y(),currentPhaseState=phaseState.run,helpTime=2e3;break;case phaseState.setup:case phaseState.run:break;case phaseState.fail:currentPhaseState=phaseState.startScreen;break;case phaseState.succeed:bonusJumpCount++,currentLevel++,y(),w(),y(),currentPhaseState=phaseState.run}}addEventListener("keydown",function(e){e=e.keyCode,keysDown[e]=!0,e!=arrow.left&&e!=arrow.right||(helpTime=0)},!1),addEventListener("keyup",function(e){e=e.keyCode,keysDown[e]=!1,32==e&&S()},!1),a.addEventListener("mousemove",function(e){var t=function(e){var t=0,a=0;if(e.offsetParent){for(;t+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent;);return{x:t,y:a}}}(this),a=e.pageX-t.x;mouseX=a,mouseY=e.pageY-t.y},!1),a.addEventListener("mousedown",function(e){},!1),a.addEventListener("mouseup",function(e){S()},!1);var b=new Image;function X(e,t,a,r){n.fillStyle="rgba(0,0,0,0.5)",n.fillText(e,t+3,a+3),n.fillStyle=r,n.fillText(e,t,a)}function L(a){switch(n.textBaseline="top",a){case 0:var r=10,i=360+(s=10)-(o=400)/2;n.fillStyle="rgba(0,0,0,0.5)",n.fillRect(s,i,e-2*s,o),i+=r,n.textAlign="center",n.font="bold 60px Helvetica",n.fillStyle="#FFFFFF",X("UXU",300,i,"#FFFFFF"),i+=60,n.font="italic 30px Helvetica",n.fillText("protect cuteness !",300,i),n.font="bold 30px Helvetica",i+=80,l=r+s,n.textAlign="left",n.fillText(". Jump on rockets",l,i),n.fillText(". Do not let any rocket reach the sky",l,i+=40),i+=80,n.textAlign="center",n.fillText("Press Space to continue...",300,i);break;case 2:var l;helpTime<=0||(i=t-(o=120)-(s=r=10),n.fillStyle="rgba(0,0,0,0.5)",n.fillRect(s,i,e-2*s,o),i+=r,l=s+r,n.textAlign="left",n.font="bold 30px Helvetica",n.fillStyle="#FFFFFF",n.fillText(" to move",l+150,i),i+=5,n.textAlign="center",n.drawImage(b,l,i,32,32),n.font="bold 30px Helvetica",n.fillStyle="rgba(0,0,0,0.5)",n.fillText("<",l+15,i-1),n.drawImage(b,l+=40,i,32,32),n.font="bold 30px Helvetica",n.fillStyle="rgba(0,0,0,0.5)",n.fillText(">",l+19,i-1),n.textAlign="left",i+=50,n.fillStyle="#FFFFFF",n.fillText("[Space]",l=s+r,i),n.fillText(" to use bonus jump",l+150,i));break;case 4:i=360+(s=r=10)-(o=300)/2,n.fillStyle="rgba(0,0,0,0.5)",n.fillRect(s,i,e-2*s,o),i=i+r+10,n.textAlign="center",n.font="bold 60px Helvetica",n.fillStyle="#FFFFFF",n.fillText("Great !",300,i),i+=80,n.font="bold 30px Helvetica",n.fillText("Next level : "+(currentLevel+1),300,i),n.fillText("press space to continue...",300,i+=120);break;case 5:var o,s;r=10,i=360+(s=10)-(o=350)/2,n.fillStyle="rgba(0,0,0,0.5)",n.fillRect(s,i,e-2*s,o),i=i+r+10,n.textAlign="center",n.font="bold 60px Helvetica",n.fillStyle="#FFFFFF",n.fillText("Oooops !",300,i),i+=100,n.font="bold 30px Helvetica",n.fillText("Level : "+(currentLevel+1),300,i),i+=30,n.fillText("Highest Jump : "+heightMax.toFixed(0),300,i),n.fillText("press space to continue...",300,i+=120)}}b.src="key.png",function a(){new Date;for(var i=0;i<c.length;i++)c[i].update(10);for(i=0;i<d.length;i++)d[i].update(10);for(i=0;i<g.length;i++)g[i].update(10);for(i=0;i<g.length;i++)x[i].update(10);T=(P=c[0]).Y+150,camX=-300,camY=T-360,n.fillStyle="#FFFFFF",n.clearRect(0,0,1e3,920),n.beginPath(),n.rect(0,0,e,t),n.closePath(),n.fill(),n.fillStyle=r,n.clearRect(0,0,e,t),n.beginPath(),n.rect(0,0,e,t),n.closePath(),n.fill();for(var l=T,o=150*Math.round(0),f=200*Math.round(l/200),u=4,h=-Math.round(u/2);h<=Math.round(u/2);h++)for(Y=-Math.round(1.8);Y<=Math.round(1.8);Y++){for(var p=f+200*Y,m=s((I=o+150*h)+p*e),v=0;v<3;v++){var w=2*m.next(),y=100*m.next(),F=100*m.next(),S=+(I+y)+300,b=p+F-l+360;n.fillStyle="#FFFFFF",n.beginPath(),n.arc(S,b,w,0,2*Math.PI,!0),n.closePath(),n.fill()}.85<m.next()&&(k=22,C=(M=52)*(A=+m.next()+1),J=k*A,n.drawImage(cloudImage,+(I+y)+300-C/2,p+F-l+360,C,J))}o=200*Math.round(0),u=3;var Y,T,P,M=414,k=814;for(h=-Math.round(u/2);h<=Math.round(u/2);h++){var I,A,C=M*(A=+(m=s(I=o+200*h)).next()+.5),J=k*A;n.drawImage(mountainImage,+I+300-C/2,400-l+100*m.next(),C,J)}for(n.fillStyle="#A4E2B2",n.beginPath(),n.rect(0,t-l,e,800),n.closePath(),n.fill(),(P=360-P.Y)>heightMax&&(heightMax=P),i=0;i<c.length;i++)c[i].draw();for(i=0;i<d.length;i++)d[i].draw();for(i=0;i<g.length;i++)g[i].draw();for(i=0;i<g.length;i++)x[i].draw();currentPhaseState==phaseState.run&&((currentTimeLeft-=10)<0&&(currentPhaseState=phaseState.succeed,currentTimeLeft=13e3),T=currentTimeLeft,n.font="bold 80px Helvetica",n.textAlign="left",n.textBaseline="top",X((T/1e3).toFixed(2)+"'",10,10,"#FFFFFF"),n.font="bold 30px Helvetica",n.textAlign="right",n.textBaseline="top",T=lifeLeft+" life",X(1<lifeLeft?lifeLeft+" lifes":T,590,10,"#FFFFFF"),T=bonusJumpCount+" jump",X(1<bonusJumpCount?bonusJumpCount+" jumps":T,590,40,"#FFFFFF"),X(heightMax.toFixed(0)+" m",590,70,"#FFFFFF")),currentPhaseState==phaseState.startScreen&&L(0),currentPhaseState==phaseState.succeed&&L(4),currentPhaseState==phaseState.fail&&L(5),currentPhaseState==phaseState.run&&L(2),setTimeout(a,2.5)}()</script>