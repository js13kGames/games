<!doctype html><meta name=viewport content="width=800,user-scalable=0,user-scalable=no"><title>Lucky Streak - js13kGames</title><style>*{margin:0;padding:0;font-family:Quantico,sans-serif}body{background:#555;overflow:hidden}canvas{margin:0 auto;display:block;background:#111}#gameWindow{margin:0 auto;position:relative;width:800px;height:600px}.hud{position:absolute;font-size:12px;color:#000;opacity:1;background:#fff;padding:5px;border:1px solid #2c3e50;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #34495e,0 2px 0 #34495e,0 2px 3px #333;-moz-box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #34495e,0 2px 0 #34495e,0 2px 3px #333;box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #34495e,0 2px 0 #34495e,0 2px 3px #333}.hud:hover{opacity:.8}#title{position:absolute;width:600px;left:50%;font-size:75px;color:#2ecc71;font-weight:700;text-shadow:1px 1px #fff}#instructions{color:#fff;position:absolute;width:500px;left:50%;top:15%}#instructions ul{text-align:center;list-style:none;margin-top:15px}.key{display:inline-block;color:#333;font:bold 9pt Helvetica;text-decoration:none;text-align:center;width:44px;height:44px;margin:5px;background:#ecf0f1;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;border-top:1px solid #f5f5f5;-webkit-box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #7f8c8d,0 2px 0 #c9c9c9,0 2px 3px #333;-moz-box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #7f8c8d,0 2px 0 #c9c9c9,0 2px 3px #333;box-shadow:inset 0 0 25px #e8e8e8,0 1px 0 #7f8c8d,0 2px 0 #c9c9c9,0 2px 3px #333}.key span{display:inline-block;margin:13px 0 0;text-transform:uppercase;font-size:18px}.key.space{width:85px}#restart,#resume,#start{width:250px;bottom:10%;left:50%;text-align:center;padding:5px;cursor:pointer;font-size:32px;font-weight:700}#restart,#resume{display:none}#scorecard{width:300px;top:35%;left:50%;text-align:center;font-size:30px;font-weight:700;background:#222;outline:0;border:none;color:#ecf0f1;opacity:1;display:none;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none}#highscore{font-style:italic;font-weight:400;color:#e74c3c;display:none}.button{width:125px;height:125px;position:absolute;display:none;font-size:56px}.button span{font-size:56px}#btnLeft{bottom:15px;left:15px}#btnRight{bottom:15px;right:15px}#btnJump{bottom:15px;right:155px}.center{-webkit-transform:translate(-50%,0);-moz-transform:translate(-50%,0);transform:translate(-50%,0)}</style><div id=gameWindow><div class="menu center" id=title>LUCKY STREAK</div><div class="menu center" id=instructions><div>You're a block. You're naked (don't worry, it's censored). You're out for a jog. Run and jump as far as you can. Avoid stepping on cracks in the sidewalk or your luck may run out as the earth opens up to swallow you whole. Good luck!</div><ul><li>Move Left:<div class=key><span>a</span></div>or<div class=key><span>←</span></div><li>Move Right:<div class=key><span>d</span></div>or<div class=key><span>→</span></div><li>Jump:<div class=key><span>w</span></div>,<div class="key space"><span>Space</span></div>or<div class=key><span>↑</span></div><li>Toggle Pause:<div class=key><span>p</span></div><li>Toggle Fullscreen:<div class=key><span>f</span></div><li>Mobile Controls: Buttons appear on screen!</ul></div><div class="menu center hud" id=start>Start Game</div><div class="hud center" id=resume>Resume Game</div><div class="hud center" id=restart>Go Again</div><div class="hud center" id=scorecard>Score: <span id=score></span><div id=highscore>New High Score!</div></div><div id=btnLeft class="key button"><span>←</span></div><div id=btnJump class="key button"><span>↑</span></div><div id=btnRight class="key button"><span>→</span></div><canvas id=c></canvas></div><script>var game,keyW=keyA=keyD=keySpace=keyUp=keyLeft=keyRight=!1,canvas=document.getElementById("c"),width=canvas.width=800,height=canvas.height=600,ctx=canvas.getContext("2d"),dt=0,colors=["#2c3e50","#8e44ad","#7f8c8d","#c0392b","#16a085"],ortho=45*Math.PI/180,ROWS={1:[["TTT",50],["CCC",1],["TTC",5],["TCT",5],["CTT",5],["CCT",2],["TCC",2],["CTC",2]],2:[["_TT",10],["T_T",10],["TT_",10],["__T",2],["_T_",2],["T__",2],["___",1],["__C",3],["_C_",3],["C__",3],["CC_",6],["_CC",6]]};function Game(){this.speed=250,this.speedLimit=800,this.gravSpeed=4e3,this.player,this.luck=100,this.distance=0,this.currentTime=(new Date).getTime(),this.animationFrame,this.over=this.paused=!1,this.storage,this.init=function(){this.storage=window.localStorage,ctx.font="bold 18px sans-serif",this.initObjects();var t=this;window.onblur=function(e){t.over||t.pause()},document.getElementById("resume").addEventListener("click",(function(e){t.resume()})),document.getElementById("restart").addEventListener("click",(function(e){t.restart()})),this.isMobile&&(window.navigator.msPointerEnabled&&(document.getElementById("btnLeft").addEventListener("MSPointerDown",(function(t){keyA=!0})),document.getElementById("btnRight").addEventListener("MSPointerDown",(function(t){keyD=!0})),document.getElementById("btnJump").addEventListener("MSPointerDown",(function(t){keySpace=!0}))),document.getElementById("btnLeft").addEventListener("touchstart",(function(t){keyA=!0})),document.getElementById("btnRight").addEventListener("touchstart",(function(t){keyD=!0})),document.getElementById("btnJump").addEventListener("touchstart",(function(t){keySpace=!0}))),this.isMobile&&this.toggleMobileControls(!0),this.started=!0,this.enable()},this.initObjects=function(){this.rows=[],this.buildings=[],this.colliders=[];for(var t=0;60>t;t++)this.rows.push(new Row(50*t-2e3,0,-100));for(t=0;10>t;t++)this.buildings.push(new Building(100*t-3e3,0,10,100,100,300,colors[Math.floor(Math.random()*colors.length)]));this.player=new Player},this.enable=function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame,this.currentTime=(new Date).getTime(),this.animate((new Date).getTime())},this.disable=function(){window.cancelAnimationFrame(this.animationFrame)},this.animate=function(t){var e=this;this.animationFrame=requestAnimFrame((function(){e.animate((new Date).getTime())})),this.update(t)},this.update=function(t){dt=t-this.currentTime,this.currentTime=t,this.speed+=.08,this.speed=this.speed>this.speedLimit?this.speedLimit:this.speed,ds=this.speed*(dt/1e3),this.distance+=ds,this.player.update(),this.player.fall&&this.gameOver(),t=0;for(var e=this.rows.length;t<e;t++)this.updateEndlessPosition(t,this.rows,-1700,ds);for(t=0,e=this.buildings.length;t<e;t++)this.updateEndlessPosition(t,this.buildings,-2e3,ds);for(t=0,e=this.colliders.length;t<e;t++)this.colliders[t].kill&&(this.colliders.splice(t,1),e=this.colliders.length),150>Math.abs(this.player.x-this.colliders[t].x)&&(cubeCollision(this.player,this.colliders[t])?(this.colliders[t].colliding=!0,!this.colliders[t].hit&&this.colliders[t].cracked&&(this.colliders[t].hit=!0,this.luck-=10),this.player.onTile=!0):this.colliders[t].colliding=!1);this.luck+=.05,this.luck=100<this.luck?100:this.luck,this.luck=0>this.luck?0:this.luck,this.draw()},this.draw=function(){ctx.clearRect(0,0,width,height),ctx.fillStyle="#222",ctx.save(),ctx.scale(1,.5),boxFilled(-2700,0,0,4700,0,1500,"#333","#333",!0),this.player.fall&&this.player.draw(),this.rows.sort(xSort);for(var t=this.rows.length;t--;)this.rows[t].draw();for(this.buildings.sort(xSort),t=this.buildings.length;t--;)this.buildings[t].draw();this.player.fall||this.player.draw(),boxFilled(-2700,0,-1500,4700,0,1350,"#333","#333",!0),ctx.restore(),this.over||(ctx.fillRect(0,5,55,35),ctx.fillRect(width-65,5,65,35),ctx.fillRect(0,45,204,30),ctx.fillRect(width-141,45,141,30),ctx.fillStyle="#fff",ctx.fillText("Luck",5,28),ctx.fillText("Score",width-58,28),ctx.fillText(pad(Math.round(this.distance),12),width-125,65),ctx.fillStyle="#c0392b",t=100-this.luck,ctx.fillRect(2,47,2*t,26),ctx.fillStyle="#27ae60",ctx.fillRect(2*t+2,47,2*this.luck,26))},this.pause=function(){document.getElementById("resume").style.display="block",this.paused=!0,this.disable()},this.resume=function(){document.getElementById("resume").style.display="none",this.paused=!1,this.currentTime=(new Date).getTime(),this.enable()},this.togglePause=function(){this.started&&!this.over&&(this.paused?this.resume():this.pause())},this.gameOver=function(){if(!this.over&&(this.isMobile&&this.toggleMobileControls(!1),this.score=Math.round(this.distance),this.over=!0,document.getElementById("restart").style.display="block",document.getElementById("scorecard").style.display="block",document.getElementById("score").innerHTML=this.score,this.storage)){var t=this.storage.getItem("highscore"),e=document.getElementById("highscore");this.score>t?(this.storage.setItem("highscore",this.score),e.style.display="block"):e.style.display="none"}},this.restart=function(){document.getElementById("restart").style.display="none",document.getElementById("scorecard").style.display="none",this.isMobile&&this.toggleMobileControls(!0),this.disable(),this.speed=250,this.over=!1,this.luck=100,this.distance=0,this.initObjects(),this.player=new Player,this.enable()},this.updateEndlessPosition=function(t,e,i,s){newx=0<t?e[t-1].x+e[t-1].w:e[e.length-1].x+e[e.length-1].w-s,e[t].x<i?e[t].update(newx,!0):e[t].update(e[t].x-s)},this.getRandomRow=function(t){t=ROWS[t];var e,i=0,s=0;for(e=0;e<t.length;e++)i+=t[e][1];for(i=Math.floor(Math.random()*i),e=0;e<t.length;e++)if(i<(s+=t[e][1]))return t[e]},this.toggleFullscreen=function(){function t(t){e.fitToWindow()}var e=this;if(this.fullscreen){window.removeEventListener("resize",t,!1);var i=document.getElementById("gameWindow");canvas.width=width=800,canvas.height=height=600,i.style.width=width+"px",i.style.height=height+"px",ctx.font="bold 18px sans-serif"}else this.fitToWindow(),window.addEventListener("resize",t,!1);this.fullscreen=!this.fullscreen},this.fitToWindow=function(){var t=document.getElementById("gameWindow");canvas.width=width=window.innerWidth,canvas.height=height=window.innerHeight,t.style.width=width+"px",t.style.height=height+"px",ctx.font="bold 18px sans-serif"},this.toggleMobileControls=function(t){for(var e=document.getElementsByClassName("button"),i=0;i<e.length;i++)e[i].style.display=t?"block":"none"},isMobile()&&(this.toggleFullscreen(),this.isMobile=!0)}function Player(){this.x=-200,this.y=1,this.z=-87.5,this.w=25,this.h=120,this.d=25,this.jumping=!1,this.yV=0,this.onTile=!0,this.update=function(){!this.onTile&&0>=this.y&&(this.fall=!0),this.fall?(this.y-=game.gravSpeed/4*(dt/1e3),this.x-=game.speed*(dt/1e3)):((keyA||keyLeft)&&(this.z+=50,keyA=keyLeft=!1),(keyD||keyRight)&&(this.z-=50,keyD=keyRight=!1),-137.5>this.z&&(this.z=-137.5),-37.5<this.z&&(this.z=-37.5),(keySpace||keyUp||keyW)&!this.jumping&&(this.jumping=!0,this.yV=1200,keySpace=keyUp=keyW=!1),this.y+=this.yV*(dt/1e3),0>=this.y?(this.y=0,this.jumping=!1,this.yV=0):this.yV-=game.gravSpeed*(dt/1e3),this.onTile=!1)},this.draw=function(){boxFilled(this.x,this.y,this.z,this.w,this.h,this.d,"#333","#f1c40f"),ctx.save();var t=xFla(this.x,this.y,this.z),e=yFla(this.x,this.y,this.z);ctx.fillStyle="#eee";for(var i=0;3>i;i++)for(var s=0;5>s;s++)ctx.globalAlpha=Math.random(),ctx.fillRect(t-25+10*s,e-75+20*i,10,20);ctx.restore()}}function Row(t,e,i){this.w=50,this.x=t,this.y=e,this.z=i,this.tiles=[],this.tiles.push(new Tile(t,e,i-50)),this.tiles.push(new Tile(t,e,i)),this.tiles.push(new Tile(t,e,i+50)),this.update=function(t,e){this.x=t;for(var i=this.tiles.length-1;0<=i;i--)e?this.tiles[i].kill=!0:this.tiles[i].x=t;e&&this.randomObstacle()},this.draw=function(){for(var t=this.tiles.length;t--;)this.tiles[t].draw()},this.randomObstacle=function(){for(var t=(randomBetween(0,100)>game.luck?game.getRandomRow("2"):game.getRandomRow("1"))[0],e=[-50,0,50],i=this.tiles.length=0;i<t.length;i++)switch(t.charAt(i)){case"T":this.tiles.push(new Tile(this.x,this.y,this.z+e[i]));break;case"C":var s=new Tile(this.x,this.y,this.z+e[i]);s.cracked=!0,this.tiles.push(s);break;case"J":this.tiles.push(new Block(this.x,this.y,this.z+e[i]))}}}function Tile(t,e,i,s){this.x=t,this.y=e,this.z=i,this.w=50,this.h=0,this.d=50,this.startX=t,this.layer=s,this.type="Tile",this.cracked=!1,this.cracks=6,this.cLength=25,this.kill=this.hit=!1,game.colliders.push(this),this.draw=function(){if(boxFilled(this.x,this.y,this.z,this.w,this.h,this.d,"#333","#ccc"),this.cracked){ctx.save(),plot(this.x,this.y,this.z),ctx.strokeStyle=this.colliding?"red":"black",ctx.lineWidth=2,ctx.beginPath();for(var t=this.cracks,e=0;e<t;e++)drawIso((0==e%2?this.x+this.cLength:this.x)+15,0,this.z+this.d+this.d/t/2-(e+1)*(this.d/t));ctx.stroke(),ctx.closePath(),ctx.restore()}}}function Building(t,e,i,s,n,h,o){this.x=t,this.y=e,this.z=i,this.w=s,this.h=n,this.d=h,this.startX=t,this.color=o,this.update=function(t,e){this.x=t,e&&(this.x+=randomBetween(0,100),this.x=Math.max(this.x,600),this.w=randomBetween(200,700),this.h=randomBetween(200,1300),this.d=randomBetween(300,800),this.color=colors[Math.floor(Math.random()*colors.length)])},this.draw=function(){boxFilled(this.x,this.y,this.z,this.w,this.h,this.d,"#000",this.color)}}window.onload=function(){game=new Game,window.addEventListener("keydown",onKeyDown,!1),window.addEventListener("keyup",onKeyUp,!1),document.getElementById("start").addEventListener("click",(function(t){game.init(),t=document.getElementsByClassName("menu");for(var e=0;e<t.length;e++)t[e].style.display="none"}),!1)},xSort=function(t,e){return t.x>e.x?1:t.x<e.x?-1:0},randomPosNeg=function(){return 2*Math.random()-1},randomBetween=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},isMobile=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},pad=function(t,e){for(var i=""+t;i.length<e;)i="0"+i;return i},onKeyDown=function(t){switch(t.keyCode){case 68:keyD=!0;break;case 65:keyA=!0;break;case 87:keyW=!0;break;case 32:keySpace=!0;break;case 37:keyLeft=!0;break;case 38:keyUp=!0;break;case 39:keyRight=!0;break;case 80:game.togglePause();break;case 70:game.toggleFullscreen()}},onKeyUp=function(t){switch(t.keyCode){case 68:keyD=!1;break;case 65:keyA=!1;break;case 87:keyW=!1;break;case 32:keySpace=!1;break;case 37:keyLeft=!1;break;case 38:keyUp=!1;break;case 39:keyRight=!1}},cubeCollision=function(t,e){return t.x+t.w>=e.x&&t.x<=e.x+e.w&&t.y+t.h>=e.y&&t.y<=e.y+e.h&&t.z+t.d>=e.z&&t.z<=e.z+e.d},xFla=function(t,e,i){return xCart=(t-i)*ortho,xI=xCart+width/2},yFla=function(t,e,i){return yCart=e+(t+i)*ortho,yI=-yCart+height-height/10},plot=function(t,e,i){move(xFla(t,e,i),yFla(t,e,i))},drawIso=function(t,e,i){line(xFla(t,e,i),yFla(t,e,i))},move=function(t,e){ctx.moveTo(t,e)},line=function(t,e){ctx.lineTo(t,e)},boxFilled=function(t,e,i,s,n,h,o,a,l){ctx.strokeStyle=o,ctx.fillStyle=a,ctx.beginPath(),plot(t,e+n,i),drawIso(t+s,e+n,i),drawIso(t+s,e+n,i+h),drawIso(t,e+n,i+h),drawIso(t,e+n,i),ctx.closePath(),ctx.stroke(),ctx.fill(),0!=n&&(ctx.beginPath(),plot(t,e,i),drawIso(t+s,e,i),drawIso(t+s,e+n,i),drawIso(t,e+n,i),drawIso(t,e,i),ctx.closePath(),ctx.stroke(),ctx.fill(),0!=h&&(ctx.beginPath(),plot(t,e,i),drawIso(t,e+n,i),drawIso(t,e+n,i+h),drawIso(t,e,i+h),drawIso(t,e,i),ctx.closePath(),ctx.stroke(),ctx.fill()))}</script>