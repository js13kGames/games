var Ä‰uprotokoli = false;
var helponivelo = 0;
var frazoj = [
    [
        [
            "ğŸ‘¾ğŸ¤Œ"
        ],
        [
            "|=0",
            "hGhÂ‚",
            "]|ÂE_",
            "yRÂ€Ub^b"
        ],
        [
            "Â€X\u001d",
            "{gÂ’ÂŒ",
            "OT{XÂ‡O}^"
        ]
    ],
    [
        [
            "ğŸ‘½ğŸ’¤"
        ],
        [
            "|=0",
            "]LWuawÂˆ",
            "I_Â€RÂ‡",
            "Hpbuu"
        ]
    ],
    [
        [
            "ğŸ‘¾ğŸ‘°"
        ],
        [
            "|=",
            "aSRhÂ‚",
            "YvzW",
            "Xm",
            "SyDp^"
        ],
        [
            "mu6",
            "NfrÂ’ÂŒ",
            "C`pX",
            "Â™J}Y",
            "=]ÂˆkW"
        ]
    ],
    [
        [
            "ğŸ‘¾ğŸ‘£ğŸ™"
        ],
        [
            "HR1",
            "T_Â…g",
            "tzN",
            "Xm0",
            "ÂŠKsYoÂƒ",
            "]CxrÂÂ"
        ]
    ],
    [
        [
            "ğŸ‘¼ğŸ½"
        ],
        [
            "|=",
            "\\`?XÂ‚",
            "c~Â‹E_"
        ]
    ],
    [
        [
            "ğŸ‘¿ğŸ‘‹"
        ],
        [
            "|=0",
            [
                "hGh|fx",
                "Â‹IÄ‰u_Âƒ"
            ],
            "Rpbuuj",
            "IwmÂÂŒP"
        ]
    ],
    [
        [
            "ğŸ™ğŸš¥ğŸ®"
        ],
        [
            "HR1",
            "IWÂ‡g",
            "w~",
            "QMzÄuU",
            "mQ@",
            "Â„XLtl"
        ],
        [
            "ÂŒ~!",
            "^pYÂ•",
            "OÂ",
            "X<fÅƒ]\\",
            [
                "ÂJ|LÃ¾<M",
                "]|Â‹sÄ‚Â„Â"
            ],
            "gYK~"
        ]
    ],
    [
        [
            "ğŸ¯ğŸ¥º"
        ],
        [
            "|=0",
            "bMbÂƒg",
            "vzRÄ‰md",
            "Â€C@",
            "[suYMs"
        ]
    ],
    [
        [
            "ğŸ‘½ğŸ‘‘"
        ],
        [
            "|=0",
            "]LWuawÂˆ",
            "T[~euU",
            "c\\vue\u001d",
            "wmÂ‚ÂŒP"
        ]
    ],
    [
        [
            "ğŸ‘¼ğŸ‘"
        ],
        [
            "|=0",
            "]LWug",
            "yÂˆV`md",
            [
                "h\u000fÄŠUn}qMs",
                "Ä‡Â…ÂŠKm~S"
            ]
        ]
    ],
    [
        [
            "ğŸ¸ğŸ"
        ],
        [
            "|=0",
            "fCiÂ‡mmÂˆ",
            "QMzÄuU",
            "mQ@",
            "zi?lmÂ"
        ]
    ],
    [
        [
            "ğŸ¾ğŸš¥ğŸª"
        ],
        [
            "HR1",
            "Ietdx",
            "Â‡I",
            "Ym_Ä±Ct",
            "\\bS",
            "iGmÂ"
        ]
    ],
    [
        [
            "ğŸ‘‘ğŸ´"
        ],
        [
            "|=0",
            "gPiÂ‚",
            "l{Â‚RWmd",
            "Â€C@",
            "RjyiMs"
        ]
    ],
    [
        [
            "ğŸŒ´ğŸŒ•"
        ],
        [
            "|=",
            "dgLe",
            "~Ys",
            "Â…E",
            "XÂ_Âƒ"
        ],
        [
            "Uv^p",
            "XH",
            "qsÂÂŒ"
        ]
    ],
    [
        [
            "ğŸğŸˆ"
        ],
        [
            "|=0",
            "]Sd|cuÂˆ",
            "QMzÄuU",
            "mQ@",
            "Â„fKtl"
        ]
    ],
    [
        [
            "ğŸšğŸš¥ğŸ†"
        ],
        [
            "HR1",
            [
                "@eÂ‰g",
                "kÂˆZUz`"
            ],
            "Â‚G",
            "nQoÄ±XQ",
            "q__",
            "ÂˆCcÂ‚NÂ‘FÂZI"
        ],
        [
            "dÂ‡;",
            [
                "KÂŠ_y",
                "EPQCeÂŠ"
            ],
            "Â‡o",
            "Rv|Ä”YP",
            "zÂ„wÂ‰xZfÂ‘wÂ‰Â‚"
        ],
        [
            [
                "cÂ‘Â†R}",
                "taÂ‘GÂÂÂ€"
            ],
            "hu",
            "IR`Ã»WÂ†",
            "cjÂ‰WUwVÂˆQk^"
        ]
    ],
    [
        [
            "ğŸ¦ğŸ‘™"
        ],
        [
            "|=0",
            "]?fÂ…g",
            "vzRÄ‰md",
            "Â€C@",
            "ÅvÂƒe"
        ],
        [
            "Jf=",
            "Â‹~Re~",
            "RÂ‡OÄ¹LN",
            "Å•Â›kSÂ‰"
        ]
    ],
    [
        [
            "ğŸ‘’ğŸš¥ğŸ¶"
        ],
        [
            "HR1",
            "NWÂ\\x",
            "Â‡I",
            "Ym_Ä±Ct",
            "\\bS",
            "^JfaÂ‰~Ä—b}"
        ],
        [
            "UÂ‡OÂ€ZE",
            "fÂ‹",
            "iJÂ‰Ä†kV",
            "HG;ZÂ„zÄ¿TÂƒ"
        ]
    ],
    [
        [
            "ğŸ‘¾ğŸ"
        ],
        [
            "|=0",
            "hGhÂ‚",
            "cjÂ‡XM",
            "ayT",
            "nYlÂ†fDtlÂ"
        ],
        [
            "Â‰C2",
            "Â…NÂ˜P",
            "Â‡LIlÂ‡o",
            "NÂ‰",
            "VsNSJ@fÂ‰Âˆx"
        ],
        [
            "QvM",
            "maO~",
            "ÂhÂ„ÂƒPt"
        ]
    ],
    [
        [
            "ğŸŒ½"
        ],
        [
            "j|QgSQ"
        ],
        [
            "bt7",
            "yÂ…Yb{",
            "WuNbc"
        ],
        [
            "mu6",
            "NqsÂ–ÂŒ",
            "HT{FÂ™",
            "EÂ",
            "W<7",
            [
                "Â”qKÂŠ",
                "Ã²sHMJ"
            ]
        ]
    ],
    [
        [
            "ğŸ³ğŸŒ¶"
        ],
        [
            "|=0",
            "S@[g",
            "Å¦zXM",
            "]u!",
            "g\\pÂ†fL"
        ],
        [
            "f`Â…Â‰Q]",
            "Å¬FÂšBÂ",
            "QGgÂ˜kSÂ‰"
        ],
        [
            "Uk\"",
            "B=?cÂŠ",
            "Â|NÂƒyXk",
            "At",
            "ÂhU",
            "u[pÂw"
        ],
        [
            "Â€vfÂM",
            "Â‡Â„[Â‰IÂÂ’",
            "z_",
            "vH`dM`"
        ]
    ],
    [
        [
            "ğŸ¦˜ğŸ–"
        ],
        [
            "|=0",
            "eIeÂ…hrÂˆ",
            "OMv",
            "]u!",
            "g_sÂ`It",
            "`ÂÂ‘C_pX"
        ],
        [
            "ÂˆBÂLGYÂ™",
            "hJZ",
            "\\uRSKCf",
            "Â†zt",
            "QvM",
            "]gO|ÂŒrÂ…"
        ]
    ],
    [
        [
            "ğŸ’˜ğŸª"
        ],
        [
            "|=0",
            "Y?hwa|ÂS",
            "XmSÂƒTbc",
            "ÄŠy",
            "c?D",
            "iÂÂVX{T"
        ],
        [
            "Â’B[",
            "R<jÂŠe\\ÂX",
            "qDS?;j",
            "Â‡zI",
            "PvÂk]I~Â‘"
        ]
    ],
    [
        [
            "ğŸ‘¼ğŸ€"
        ],
        [
            "|=0",
            "]LWug",
            [
                "pzNZud",
                "{Ck^bÂ‡"
            ],
            "c?D",
            "nÂÂˆC_~S"
        ]
    ],
    [
        [
            "ğŸ‘¾ââ˜¾"
        ],
        [
            "HR1",
            "T_Â…g",
            "jÂ†E_",
            "|RwQo"
        ]
    ],
    [
        [
            "ğŸ‘½ğŸ™‰â›º"
        ],
        [
            "HR1",
            "IdtZrÂ‡S",
            "\\~VÄ±Ct",
            "Uo",
            "Â€X\u001d",
            [
                "upÂ…ÄºG]~",
                "PÂSÂ‡Z"
            ]
        ]
    ],
    [
        [
            "ğŸ‘¿ğŸŒ·ğŸ¨"
        ],
        [
            "HR1",
            "T_Â…awÂˆ",
            "H[zRÂ‡",
            "ObY{Âƒe",
            "?q",
            "jÂ\\",
            "G_tKÂ‡OÂZ"
        ],
        [
            "GYe",
            "rRÂRxR",
            "N<HÄ”Â„Â€kX",
            "Âo6",
            "]ItÂ‰hÂ„Âƒ^o",
            "ÂmÂ‘",
            "ÂbÂ‹ÂŠR"
        ],
        [
            "s1",
            "Â‘GÂ’ÂˆÂ„i",
            "}=_ÄG]tk",
            "vzMf{_",
            "uN",
            "mQ@",
            "ycCk_ÂÂ‘Q"
        ]
    ],
    [
        [
            "ğŸ›¿ğŸ™»"
        ],
        [
            "qRZSB_g",
            "tzN",
            "Tq]}Mp`uyiM",
            "kjÂ•Â„CfN"
        ],
        [
            "JÂ™U}^",
            "<nÂ]MÂ„Uy",
            "NBE",
            "B\\Â‡Â‚uTÂ…Â‚\\jL"
        ],
        [
            "tÂ–{wÂ‚",
            "[b",
            "~~ÂˆueÂ‹|R",
            "~s\\",
            "Â‡?",
            "ÂˆÂ„Â‚c{KafChÂ‚"
        ],
        [
            "dj",
            "zZUmU}Np",
            "[b~",
            "c?",
            "mcÂŒÂ†MbYÂ‹SÂ‹",
            "QGmÂ]\\"
        ],
        [
            "|_sDEDFfÂ…",
            "Â„kO",
            "}scaH~Â“{{Â^k",
            "ÂƒtÂ”{bÂ•"
        ]
    ],
    [
        [
            "ğŸ‘‹ğŸ’£"
        ],
        [
            "|=0",
            "eGc|g",
            "Ä¾~XM",
            "WyMbÄ¥pÂ‚"
        ],
        [
            "c?D",
            "qÂ‰ÂŠKb",
            "uJÂ‘BÂ"
        ]
    ],
    [
        [
            "ğŸƒğŸšœ"
        ],
        [
            "|=0",
            "X?XÂ…atÂˆ",
            "T^{UÂ‰MuQt",
            [
                "Å±`NthÂ",
                "QTÂƒTÂO"
            ]
        ],
        [
            "ÂˆL\u001a",
            "^Â‡^[Â„Ty",
            "SSJ>lÂ†ÂsX",
            [
                "Å²wggK",
                "qÂ’hÂŠ~]"
            ]
        ],
        [
            "g~jÂ‘}lÂ‘",
            "tH",
            [
                "Å°{bÂŠH",
                "Â‚ÂwnF"
            ]
        ]
    ],
    [
        [
            "ğŸŸğŸ”Ÿ"
        ],
        [
            "|=0",
            "VPW~g",
            [
                "nÂ…W\\ucuU",
                "lbbÄXQ"
            ],
            "k_ÂŠÂQa"
        ],
        [
            "sWÂ‡LÂ‹U",
            [
                "@dÂ™lRÂJ}",
                "NS<Ã£XÂ"
            ],
            "kOÂ‡}e"
        ]
    ]
];

var Ä‰ifrilo = [
    22, -6, 16, -36, -15, -14, -34, -10, 19, -8,
    9, 25, -28, -20, 12, -15, 20, -30, 1, -16,
    1, 20, -9, -34, 5, -2, 32, 29, -30, -13,
    15, -27, 38, -31, 28, -21, -37, -8, 38, -4,
    -23, 27, -23, 10, -29, -31, -37, -38, -9, 27,
    25, 10, -27, 21, 14, -9, -8, -35, 15, 35,
    7, 22, 15, -17, 1, 29, 8, 31, 20, 1,
    34, 16, -29, 19, 18, -14, 27, -34, 32, 31
];
var Ä‰ifriloPozicio = 0;

function transformi(objekto, Ä‰ifri)
{
    var anstataÅ­o;
    if (objekto instanceof Array) {
        anstataÅ­o = [];
        for (var i in objekto) {
            anstataÅ­o[i] = transformi(objekto[i], Ä‰ifri);
        }
        return anstataÅ­o;
    }

    var punkto, deÅovo;
    anstataÅ­o = '';
    protokoli(objekto, 'Transformata');
    for (var i = 0; i < objekto.length; ++i) {
        punkto = objekto.codePointAt(i);
        deÅovo = Ä‰ifrilo[Ä‰ifriloPozicio];
        Ä‰ifriloPozicio = (Ä‰ifriloPozicio + 1) % Ä‰ifrilo.length;

        if (punkto > 65535) {
            i += 1;
        }

        if (!Ä‰ifri) {
            deÅovo = -deÅovo;
        }

        protokoli([punkto, deÅovo], String.fromCodePoint(punkto));

        anstataÅ­o += String.fromCodePoint(punkto + deÅovo);
    }
    return anstataÅ­o;
}

function encrypt(objekto)
{
    Ä‰ifriloPozicio = 0;
    return transformi(objekto, true);
}

function malÄ‰ifri(objekto)
{
    Ä‰ifriloPozicio = 0;
    return transformi(objekto, false);
}

var elekteblajFrazoj = [];
var indekso = -1;
var frazo;
var lastaKlavo = '';
var lastaLoko = -1;

function hazardigi(aro)
{
    var j, x, i;
    for (i = aro.length - 1; i > 0; --i) {
        j = Math.floor(Math.random() * (i + 1));
        x = aro[i];
        aro[i] = aro[j];
        aro[j] = x;
    }
    return aro;
}

function xSistemigi(elemento, okazo)
{
    const Ä‰apelebloj = 'CcGgHhJjSs';

    var komenco = elemento.selectionStart;
    var fino = elemento.selectionEnd;

    var klavo = okazo.key;

    if (klavo == 'Enter') {
        kontroliRespondon();
        return false;
    }

    if ((klavo != 'x' && klavo != 'X') || komenco != fino || Ä‰apelebloj.indexOf(lastaKlavo) == -1) {
        lastaKlavo = klavo;
        lastaLoko = fino;
        return;
    }

    var antaÅ­a = elemento.value.substring(0, komenco);
    var posta = elemento.value.substring(fino);
    var mappings = {
        'c': 'Ä‰',
        'C': 'Äˆ',
        'g': 'Ä',
        'G': 'Äœ',
        'h': 'Ä¥',
        'H': 'Ä¤',
        'j': 'Äµ',
        'J': 'Ä´',
        's': 'Å',
        'S': 'Åœ',
    };

    if (typeof mappings[lastaKlavo] != 'undefined') {
        var nova = mappings[lastaKlavo];
        elemento.value = antaÅ­a.substr(0, antaÅ­a.length - 1) + nova + posta;
    }

    lastaKlavo = klavo;
    lastaLoko = elemento.selectionEnd;

    return false;
}

function komenci()
{
    elekteblajFrazoj = [];
    for (var i in frazoj) {
        elekteblajFrazoj.push(Number(i));
    }
    akiriBildon();
    nevidebligi($('finita'));
    videbligi($('ludo'));
    videbligi($('teksto-respondo'));
}

function protokoli(mesaÄo, speco)
{
    if (!Ä‰uprotokoli) {
        return;
    }
    if (speco) {
        console.log(mesaÄo, speco);
    } else {
        console.log(mesaÄo);
    }
}

function $(id)
{
    return document.getElementById(id);
}

function nova(nomo)
{
    return document.createElement(nomo);
}

function videbligi(nodo)
{
    nodo.className = nodo.className.replace(/\s*nevidebla\s*/, ' ').trim();
}

function nevidebligi(nodo)
{
    if (nodo.className.indexOf('nevidebla') == -1) {
        nodo.className += ' nevidebla';
    }
}

function akiriBildon()
{
    indekso = elekteblajFrazoj[Math.floor(Math.random() * elekteblajFrazoj.length)];
    frazo = malÄ‰ifri(frazoj[indekso]);

    protokoli(frazo[1], 'Elektita frazo');
    protokoli(indekso, 'Elektita indekso');

    $('bildo').textContent = frazo[0];
    $('poentaro').textContent = (frazoj.length - elekteblajFrazoj.length) + '/' +  frazoj.length;
}

function kontroliKongruon(vorto1, vorto2)
{
    if (dezirata_vorto instanceof Array) {
        for (var i in vorto2) {
            if (vorto1.localeCompare(vorto2[i], 'eo', {'sensitivity': 'accent'}) == 0) {
                return true;
            }
        }
        return false;
    }
    return (vorto1.localeCompare(vorto2, 'eo', {'sensitivity': 'accent'}) == 0);
}

function kontroliRespondon()
{
    var enmeto = $('teksto-respondo-enmetejo').value.trim();
    var vortoj = enmeto.split(/\s+/);
    var frazopcio, dezirataj, atingitaj, i, j, deva, egalaj, estasSignoÄ‰eno;
    var kontroliBlatojn = true;

    nevidebligi($('superteksto-jes'));
    nevidebligi($('superteksto-ne'));

    for (var i = 1; i < frazo.length; ++i) {
        dezirataj = frazo[i].length;
        atingitaj = 0;
        protokoli(frazo[i].join(' '));

        frazopcio = frazo[i];
        pozicio = 0;
        for (j in frazopcio) {
            dezirata_vorto = frazopcio[j];

            protokoli(j + ', ' + pozicio + ': ' + dezirata_vorto, "Vorto");

            deva = true;
            estasSignoÄ‰eno = (typeof dezirata_vorto === 'string');
            if (estasSignoÄ‰eno && dezirata_vorto.charAt(dezirata_vorto.length - 1) == '?') {
                deva = false;
                dezirata_vorto = dezirata_vorto.substring(0, dezirata_vorto.length - 1);
            }
            protokoli(deva, 'deva');
            protokoli(estasSignoÄ‰eno, 'estas signoÄ‰eno');
            if (estasSignoÄ‰eno) {
                protokoli(dezirata_vorto.charAt(dezirata_vorto.length - 1), 'lastChar');
            }

            if (typeof vortoj[pozicio] === 'undefined') {
                protokoli("Enmetita frazo jam finiÄis");
                if (!deva) {
                    protokoli(!deva, 'nedeva');
                    dezirataj--;
                }
                break;
            }

            egalaj = kontroliKongruon(vortoj[pozicio], dezirata_vorto);
            protokoli([dezirata_vorto, vortoj[pozicio]], 'komparas')

            if (egalaj) {
                protokoli(egalaj, 'egalaj');
                ++atingitaj;
                ++pozicio;
            } else if (!deva) {
                protokoli(!deva, 'nedeva');
                dezirataj--;
            } else {
                protokoli(dezirata_vorto + ' kaj ' + vortoj[pozicio], 'ne egalaj');
                break;
            }
        }
        protokoli([dezirataj, atingitaj], 'dezirataj k atingitaj');
        protokoli([pozicio, vortoj.length], 'pozicio k longeco');
        if (dezirataj == atingitaj && pozicio == vortoj.length) {
            montriSupertekston('jes');
            return;
        }
    }
    protokoli('ne taÅ­gas');
    montriSupertekston('ne');
}

function montriSupertekston(speco)
{
    var ejo = $('superteksto-' + speco);
    videbligi(ejo);
    if (speco == 'jes') {
        $('bing').play();
    } else {
        $('barp').play();
    }
    window.setTimeout(function() {
        nevidebligi(ejo);
        if (speco == 'jes') {
            $('teksto-respondo-enmetejo').value = '';
            sekve();
        }
    }, 750);
}

function sekve()
{
    // Forigu la bildon de la listo, kaj elektu novan bildon.
    // Se ne plu ekzistas bildoj, la ludo finiÄas
    if (indekso > -1) {
        protokoli(indekso, 'Forigi elementon');

        helponivelo = 0;
        forviÅiElektojn();

        var forigenda = elekteblajFrazoj.indexOf(indekso);
        if (forigenda > -1) {
            elekteblajFrazoj.splice(forigenda, 1);
            if (elekteblajFrazoj.length == 0) {
                $('hooray').play();
                protokoli('FINITE');
                nevidebligi($('ludo'));
                videbligi($('finita'));
                return;
            }
        } else {
            protokoli('Ne trovis forigendan indekson' + indekso, 'Eraro');
        }

        protokoli(frazoj, 'Frazoj restantaj');

        akiriBildon();
        videbligi($('teksto-respondo'));
        videbligi($('helpi'));
    }
}

function helpi()
{
    switch (helponivelo) {
    case 0:
        ++helponivelo;
        montriElektojn();
        break;
    case 1:
        ++helponivelo;
        kaÅiElektojn();
        nevidebligi($('helpi'));
        break;
    }
}


/**
 * AranÄi la unuan elekton, por komparo
 */
function unuaElekto()
{
    var elektoj = [], elekto;
    for (i in frazo[1]) {
        if (typeof frazo[1][i] == 'string') {
            elekto = frazo[1][i];
        } else {
            elekto = frazo[1][i][0];
        }
        elekto = elekto.replace('?', '');
        elektoj.push(elekto);
    }
    return elektoj;
}

function montriElektojn()
{
    // elektu la Äustajn vortojn, plus aliajn vortojn
    var kvantoDeVortoj = frazo[1].length * 3;
    var i, elekto, partoj, afiksoj, fino;
    var elektoj = unuaElekto();
    var kopioDeVortaro = vortaro.slice();

    while (elektoj.length < kvantoDeVortoj) {
        i = Math.floor(Math.random() * kopioDeVortaro.length);
        elekto = kopioDeVortaro[i];

        partoj = elekto.split(':');
        elekto = partoj[0];

        // hazarde aldonu afikson
        if (partoj.length == 1) {
            fino = elekto.charAt(elekto.length - 1);
            afiksoj = [];
            if (fino == 'i') {
                afiksoj = ['i', 'is', 'is', 'as', 'as', 'os', 'os', 'us', 'u'];
                elekto = elekto.substring(0, elekto.length - 1);
            } else if (fino == 'a' || fino == 'o') {
                afiksoj = ['', '', 'j', 'n', 'jn'];
            }

            if (afiksoj.length > 0) {
                elekto += afiksoj[Math.floor(Math.random() * afiksoj.length)];
            }
        } else if (partoj[1] == 'p') {
            afiksoj = ['', 'n'];
            elekto += afiksoj[Math.floor(Math.random() * afiksoj.length)];
        }
        elektoj.push(elekto);

        kopioDeVortaro.slice(i, 1);
    }

    elektoj = hazardigi(elektoj);

    var elektujo = $('elektoj');
    for (i in elektoj) {
        elekto = kreiElekton(elektoj[i]);
        elektujo.appendChild(elekto);
    }
    nevidebligi($('teksto-respondo'));
    videbligi(elektujo);
}

function kreiElekton(vorto)
{
    var elekto = nova('span');
    elekto.className = 'elekto';
    elekto.textContent = vorto;
    elekto.setAttribute('onclick', 'alklakiVorton(this)');
    return elekto;
}

function kaÅiElektojn()
{
    var elektoj = unuaElekto();
    var kvantoDeVortoj = Math.floor(elektoj.length * 1.75);
    var elektujo = $('elektoj');
    var vortoj = elektujo.getElementsByTagName('span');
    var i, vortoNodo, vorto, malsukcesoj = 0;
    while (vortoj.length > kvantoDeVortoj) {
        i = Math.floor(Math.random() * vortoj.length);
        vortoNodo = vortoj.item(i);
        vorto = vortoNodo.textContent;
        if (elektoj.indexOf(vorto) != -1) {
            if (++malsukcesoj >= 5) {
                break;
            }
            continue;
        }
        malsukcesoj = 0;
        elektujo.removeChild(vortoNodo);
    }
}

function forviÅiElektojn()
{
    var elektujo = $('elektoj');
    var vortoj = elektujo.getElementsByTagName('span');
    var vorto;
    while (vortoj.length > 0) {
        elektujo.removeChild(vortoj.item(0));
    }
    nevidebligi(elektujo);

    elektujo = $('respondejo');
    vortoj = elektujo.getElementsByTagName('span');
    while (vortoj.length > 0) {
        vorto = vortoj.item(0);
        vorto.parentNode.removeChild(vorto);
    }
    nevidebligi(elektujo);
}

function alklakiVorton(nodo)
{
    protokoli(nodo.textContent, 'alklaki');
    nodo.removeAttribute('onclick');
    nodo.onclick = null;
    nodo.className = 'alklakita';
    window.setTimeout(function() {
        var novaNodo;
        protokoli(nodo, 'forviÅiNodon');
        nodo.className = '';
        if (nodo.parentNode.getAttribute('id') == 'elektitaj') {
            novaNodo = $('elektoj').appendChild(nodo);
        } else {
            var butono = $('kontroli-elektitajn');
            novaNodo = butono.parentNode.insertBefore(nodo, butono);
        }
        novaNodo.setAttribute('onclick', 'alklakiVorton(this)');
        videbligi($('respondejo'));

        var teksto = '';
        var vortoj = $('elektitaj').getElementsByTagName('span');
        for (var i = 0; i < vortoj.length; ++i) {
            teksto += ' ' + vortoj.item(i).textContent;
        }
        protokoli(teksto, 'teksto de span-oj');
        $('teksto-respondo-enmetejo').value = teksto;
    }, 200);
}
