<html><head><title>Human Not Found</title><script src=/2020/webxr/aframe.js></script><script>(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)})([function(a,b,c){function d(a){teleporterPosition=document.querySelector("#game").components.game.data.teleporterPosition.split(" "),a.x<=teleporterPosition[0]+.6&&a.x>=teleporterPosition[0]-.6&&a.z<=teleporterPosition[2]+.6&&a.z>=teleporterPosition[2]-.6&&win()}function e(a){var b="line"===a.type?2:a.curveNumberPoints;return new j(b,a.curveLineWidth)}function f(a){var b,c,d;return c=document.createElement("a-entity"),c.className="hitEntity",d=document.createElement("a-entity"),d.setAttribute("geometry",{primitive:"torus",radius:a.hitCylinderRadius,radiusTubular:.01}),d.setAttribute("rotation",{x:90,y:0,z:0}),d.setAttribute("material",{shader:"flat",color:a.hitCylinderColor,side:"double",depthTest:!1}),c.appendChild(d),b=document.createElement("a-entity"),b.setAttribute("position",{x:0,y:a.hitCylinderHeight/2,z:0}),b.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,radius:a.hitCylinderRadius,height:a.hitCylinderHeight,openEnded:!0}),b.setAttribute("material",{shader:"flat",color:a.hitCylinderColor,side:"double",src:h,transparent:!0,depthTest:!1}),c.appendChild(b),c}function g(){var a,b;return a=new THREE.PlaneBufferGeometry(100,100),a.rotateX(-Math.PI/2),b=new THREE.MeshBasicMaterial({color:16776960}),new THREE.Mesh(a,b)}var h=c(1),i=c(2),j=c(3);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(a){for(var b=(this.document||this.ownerDocument).querySelectorAll(a),c=b.length;0<=--c&&b.item(c)!==this;);return-1<c}),AFRAME.registerComponent("teleport-controls",{schema:{type:{default:"line",oneOf:["parabolic","line"]},button:{default:"xbutton",oneOf:["xbutton","trigger"]},startEvents:{type:"array"},endEvents:{type:"array"},collisionEntities:{default:".collidable"},hitEntity:{type:"selector"},cameraRig:{type:"selector"},teleportOrigin:{type:"selector"},hitCylinderColor:{type:"color",default:"#99ff99"},hitCylinderRadius:{default:.25,min:0},hitCylinderHeight:{default:.1,min:0},interval:{default:0},maxLength:{default:3,min:0,if:{type:["line"]}},curveNumberPoints:{default:30,min:2,if:{type:["parabolic"]}},curveLineWidth:{default:.025},curveHitColor:{type:"color",default:"#99ff99"},curveMissColor:{type:"color",default:"#ff0000"},curveShootingSpeed:{default:5,min:0,if:{type:["parabolic"]}},defaultPlaneSize:{default:100},landingNormal:{type:"vec3",default:"0 1 0"},landingMaxAngle:{default:"45",min:0,max:360},drawIncrementally:{default:!1},incrementalDrawMs:{default:700},missOpacity:{default:1},hitOpacity:{default:1},game:{type:"selector"}},init:function(){var a,b,c=this.data,d=this.el;if(this.active=!1,this.obj=d.object3D,this.hitPoint=new THREE.Vector3,this.rigWorldPosition=new THREE.Vector3,this.newRigWorldPosition=new THREE.Vector3,this.teleportEventDetail={oldPosition:this.rigWorldPosition,newPosition:this.newRigWorldPosition,hitPoint:this.hitPoint},this.data.game=document.querySelector("#game"),this.hit=!1,this.prevCheckTime=void 0,this.prevHitHeight=0,this.referenceNormal=new THREE.Vector3,this.curveMissColor=new THREE.Color,this.curveHitColor=new THREE.Color,this.raycaster=new THREE.Raycaster,this.defaultPlane=g(this.data.defaultPlaneSize),this.defaultCollisionMeshes=[this.defaultPlane],a=this.teleportEntity=document.createElement("a-entity"),a.classList.add("teleportRay"),a.setAttribute("visible",!1),d.sceneEl.appendChild(this.teleportEntity),this.onButtonDown=this.onButtonDown.bind(this),this.onButtonUp=this.onButtonUp.bind(this),this.data.startEvents.length&&this.data.endEvents.length){for(b=0;b<this.data.startEvents.length;b++)d.addEventListener(this.data.startEvents[b],this.onButtonDown);for(b=0;b<this.data.endEvents.length;b++)d.addEventListener(this.data.endEvents[b],this.onButtonUp)}else d.addEventListener(c.button+"down",this.onButtonDown),d.addEventListener(c.button+"up",this.onButtonUp);this.queryCollisionEntities()},update:function(a){var b=this.data,c=AFRAME.utils.diff(b,a);this.referenceNormal.copy(b.landingNormal),this.curveMissColor.set(b.curveMissColor),this.curveHitColor.set(b.curveHitColor),(!this.line||"curveLineWidth"in c||"curveNumberPoints"in c||"type"in c)&&(this.line=e(b),this.line.material.opacity=this.data.hitOpacity,this.line.material.transparent=1>this.data.hitOpacity,this.numActivePoints=b.curveNumberPoints,this.teleportEntity.setObject3D("mesh",this.line.mesh)),b.hitEntity?this.hitEntity=b.hitEntity:(!this.hitEntity||"hitCylinderColor"in c||"hitCylinderHeight"in c||"hitCylinderRadius"in c)&&(this.hitEntity&&this.hitEntity.parentNode.removeChild(this.hitEntity),this.hitEntity=f(b),this.el.sceneEl.appendChild(this.hitEntity)),this.hitEntity.setAttribute("visible",!1),"collisionEntities"in c&&this.queryCollisionEntities()},remove:function(){var a=this.el,b=this.hitEntity,c=this.teleportEntity;b&&b.parentNode.removeChild(b),c&&c.parentNode.removeChild(c),a.sceneEl.removeEventListener("child-attached",this.childAttachHandler),a.sceneEl.removeEventListener("child-detached",this.childDetachHandler)},tick:function(){var b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3(0,-9.8,0),a=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Quaternion,g=new THREE.Vector3,h=new THREE.Vector3,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3,l=0;return function(c,d){if((this.data.maxLength=this.data.game.components.game.data.battery/10,!!this.active)&&(this.data.drawIncrementally&&this.redrawLine&&(this.redrawLine=!1,l=0),l+=d,this.numActivePoints=this.data.curveNumberPoints*l/this.data.incrementalDrawMs,this.numActivePoints>this.data.curveNumberPoints&&(this.numActivePoints=this.data.curveNumberPoints),!(this.prevCheckTime&&c-this.prevCheckTime<this.data.interval))){this.prevCheckTime=c;var j=this.obj.matrixWorld;j.decompose(g,f,h);var m=i.set(0,0,-1).applyQuaternion(f).normalize();this.line.setDirection(k.copy(m)),this.obj.getWorldPosition(b),e.copy(b),this.teleportEntity.setAttribute("visible",!0),this.line.material.color.set(this.curveMissColor),this.line.material.opacity=this.data.missOpacity,this.line.material.transparent=1>this.data.missOpacity,this.hitEntity.setAttribute("visible",!1),this.hit=!1,a.copy(e).add(k.copy(m).multiplyScalar(this.data.maxLength)),this.raycaster.far=this.data.maxLength,this.raycaster.set(b,m),this.line.setPoint(0,b),this.checkMeshCollisions(1,a)}}}(),queryCollisionEntities:function(){var a,b=this.data,c=this.el;return b.collisionEntities?void(console.log(c.sceneEl.querySelectorAll(b.collisionEntities)),a=[].slice.call(c.sceneEl.querySelectorAll(b.collisionEntities)),this.collisionEntities=a,this.childAttachHandler=function(c){c.detail.el.matches(b.collisionEntities)&&a.push(c.detail.el)},c.sceneEl.addEventListener("child-attached",this.childAttachHandler),this.childDetachHandler=function(c){var d;c.detail.el.matches(b.collisionEntities)&&(d=a.indexOf(c.detail.el),-1===d||a.splice(d,1))},c.sceneEl.addEventListener("child-detached",this.childDetachHandler)):void(this.collisionEntities=[])},onButtonDown:function(){this.active=!0,this.redrawLine=!0},onButtonUp:function(){const a=new THREE.Vector3,b=new THREE.Vector3,c=[new THREE.Vector3,new THREE.Vector3],e=new THREE.Vector3;return function(){if(this.active&&(this.active=!1,this.hitEntity.setAttribute("visible",!1),this.teleportEntity.setAttribute("visible",!1),!!this.hit)){const e=document.querySelector("#rig")||this.data.cameraRig||this.el.sceneEl.camera.el;e.object3D.getWorldPosition(this.rigWorldPosition),this.newRigWorldPosition.copy(this.hitPoint);const f=this.data.teleportOrigin;f&&(f.object3D.getWorldPosition(a),this.newRigWorldPosition.sub(a).add(this.rigWorldPosition)),this.newRigWorldPosition.y=this.rigWorldPosition.y+this.hitPoint.y-this.prevHitHeight,this.prevHitHeight=this.hitPoint.y;var c=this.rigWorldPosition.distanceTo(this.newRigWorldPosition);b.copy(this.newRigWorldPosition),e.object3D.parent&&e.object3D.parent.worldToLocal(b),e.setAttribute("position",b),d(this.newRigWorldPosition),this.data.game.components.game.data.battery-=10*c,0>this.data.game.components.game.data.battery&&(this.data.game.components.game.data.battery=0),this.el.emit("teleported",this.teleportEventDetail)}}}(),checkMeshCollisions:function(a,b){var c;this.data.collisionEntities?(c=this.collisionEntities.map(function(a){return a.getObject3D("mesh")}).filter(function(a){return a}),c=c.length?c:this.defaultCollisionMeshes):c=this.defaultCollisionMeshes;var d=this.raycaster.intersectObjects(c,!0);if(0<d.length&&!this.hit&&this.isValidNormalsAngle(d[0].face.normal)){var e=d[0].point;this.line.material.color.set(this.curveHitColor),this.line.material.opacity=this.data.hitOpacity,this.line.material.transparent=1>this.data.hitOpacity,this.hitEntity.setAttribute("position",e),this.hitEntity.setAttribute("visible",!0),this.hit=!0,this.hitPoint.copy(d[0].point);for(var f=a;f<this.line.numPoints;f++)this.line.setPoint(f,this.hitPoint);return!0}return this.line.setPoint(a,b),!1},isValidNormalsAngle:function(a){var b=this.referenceNormal.angleTo(a);return THREE.Math.RAD2DEG*b<=this.data.landingMaxAngle}})},function(a){a.exports=""},function(a){a.exports=""},function(a){var b=function(a,b){this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(2*(3*a)),this.uvs=new Float32Array(2*(2*a)),this.width=b,this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:16711680}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.vertices=this.vertices,this.direction=new THREE.Vector3,this.numPoints=a};b.prototype={setDirection:function(a){var b=new THREE.Vector3(0,1,0);this.direction.copy(a).cross(b).normalize().multiplyScalar(this.width/2)},setWidth:function(a){this.width=a},setPoint:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.copy(d).add(this.direction),b.copy(d).sub(this.direction);var e=6*c;this.vertices[e++]=a.x,this.vertices[e++]=a.y,this.vertices[e++]=a.z,this.vertices[e++]=b.x,this.vertices[e++]=b.y,this.vertices[e++]=b.z,this.geometry.attributes.position.needsUpdate=!0}}()},a.exports=b}]);</script><script>/*MIT License - Copyright 2019 Frank Force*/'use strict';let zzfx,zzfxV,zzfxX;zzfxV=.3;zzfx=(t=1,a=.05,e=220,n=0,f=0,z=.1,r=0,h=1,s=0,M=0,o=0,x=0,i=0,u=0,c=0,d=0,X=0,b=1,l=0,m=44100,B=[],C=zzfxX.createBufferSource(),P)=>{n=99+n*m,f*=m,z*=m,l*=m,X*=m;for(let C=2*Math.PI,P=t=>1+2*t*Math.random()-t,V=t=>0<t?1:-1,g=n+l+f+z+X,w=s*=500*C/m**2,A=e*=P(a)*C/m,D=V(c)*C/4,I=0,S=0,j=0,k=1,p=0,q=0,v=0;j<g;B[j++]=v)++q>100*d&&(q=0,v=I*e*Math.sin(S*c*C/m-D),v=V(v=r?1<r?2<r?3<r?Math.sin((v%C)**3):Math.max(Math.min(Math.tan(v),1),-1):1-(2*v/C%2+2)%2:1-4*Math.abs(Math.round(v/C)-v/C):Math.sin(v))*Math.abs(v)**h,v*=t*zzfxV*(j<n?j/n:j<n+l?1-(j-n)/l*(1-b):j<n+l+f?b:j<g-X?(g-j-X)/z*b:0),v=X?v/2+(X>j?0:(j<g-X?1:(j-g)/X)*B[j-X|0]/2):v),I+=P(u),S+=P(u),e+=s+=500*M*C/m**3,k&&++k>x*m&&(e+=o*C/m,A+=o*C/m,k=0),i&&++p>i*m&&(e=A,s=w,p=1,k=k||1);return(P=zzfxX.createBuffer(1,n+l+f+z+X,m)).getChannelData(0).set(B),C.buffer=P,C.connect(zzfxX.destination),C.start(),C},zzfxX=new AudioContext</script>	<script>function shiphum(){zzfx(...[.5,.5,847,.02,.3,.9,1,1.67,,,-294,.04,.13,,,,.1])}var junk="";function shuffle(a){for(let b=a.length-1;0<b;b--){const c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a}var talking=!1,playerTargeted=!1;function ss(a,b){var c=2*getVol(b),d=[[c,,239,,.43,.2,,1.7,,,729,.02,.06,,,.1,,.88,.06],[c,,39,.17,.28,.25,,1.11,,,750,.09,.02,,,.1,,,.05],[c,,584,.21,.36,.86,,1.77,,,-157,.02,.1,.1,,,,.82,.08],[c,,948,.37,.38,.24,,1.52,4.9,,270,.07,.27,,-.2,,,.85,.02],[c,,727,,.09,.19,,1.55,,,-100,.1,,,,.1,,,.03]];talking!=a&&(talking=a,zzfx(...d[a]),document.querySelector("#log").setAttribute("text","value:"+["I found you.","Target found.","Returning patient to medbay.","Targeting...","Teleporting."][a]),setTimeout(function(){document.querySelector("#log").setAttribute("text","value:")},1500))}var holoImage,gameMap,gameMap2,gameMap3,floorMat,batteryImage,level,startX,startZ,rotY,currenttarget,height=4,width=4,map1a="146,,26,,;130,,8,,,;128,5,,,;130,,8,,;194,,74,,",map1b="27,,24,,;24,,56,152,;24,24,25,24,24;24,,24,88,;24,,24,,",map1c="4,,,,;,,,,;,,,,;,,,,;,,,,",map2a=",,16,,,;,,14,,,;128,7,,13,,,;,,11,,,;,,64,,,",map2b=",88,24,152,,,;88,88,25,152,152,;24,27,,57,24,;152,152,25,88,88,;,152,24,88,,",map2c=",,,,,,;,,1,,,,;,8,,2,,,;,,4,,,,;,,,,,,",map3a=",,,,24,;,,26,,10,;133,5,,5,,37;,,74,,10;,,,,74,",map3b=",,,64,24,;,,24,,24,;29,24,24,24,25,24;,,24,,24,;,,,128,24,",map3c=",,,,,;,,,,,;2,,,,,;,,32,,,;,,,,,",map4a=",,,16,16,,;,,8,,,2,;133,5,4,5,5,4,5",map4b=",,88,25,24,152,;,,24,24,152,24,;29,24,24,24,24,24,25",map4c=",,,,,,;,,,,,,;2,,64,,,,",map5a=",,,16,16,16;133,1,,,4,6;,12,4,66,,,",map5b=",,88,24,24,24;29,24,24,25,24,24;,24,24,24,,",map5c=",,,,,;2,,,,,;,,,32,,",nextMove=[,,,],nextTurn=[,,,],fireListener=[,,,],firing=!1,loaded=!1,done=!1,levels=[[map1a,map1b,map1c,"0,0,90","4,2"],[map2a,map2b,map2c,"1,2,180","5,2"],[map3a,map3b,map3c,"0,2,90","5,0"],[map4a,map4b,map4c,"0,2,180","7,2"],[map5a,map5b,map5c,"0,1,0","6,0"]],botPaths=[[[{x:6,z:12},{rot:180},{x:6,z:0},{rot:0}]],[[{x:0,z:4.5},{rot:360},{x:0,z:7.5},{rot:45},{x:4.5,z:12},{rot:90},{x:7.5,z:12},{rot:135},{x:12,z:7.5},{rot:180},{x:12,z:4.5},{rot:225},{x:7.5,z:0},{rot:270},{x:4.5,z:0},{rot:315}],[{x:12,z:7.5},{rot:180},{x:12,z:4.5},{rot:225},{x:7.5,z:0},{rot:270},{x:4.5,z:0},{rot:315},{x:0,z:4.5},{rot:360},{x:0,z:7.5},{rot:45},{x:4.5,z:12},{rot:90},{x:7.5,z:12},{rot:135}]],[[{x:6,z:3},{rot:0},{x:6,z:9},{rot:180}],[{x:12,z:0},{rot:0},{x:12,z:12},{rot:180}]],[[{x:6,z:6},{rot:90},{x:18,z:6},{rot:-90}],[{x:6,z:4.5},{rot:135},{x:11.5,z:0},{rot:45},{x:15,z:4.5},{rot:225},{x:11.5,z:0},{rot:315}]],[[{x:9,z:2},{rot:0},{x:9,z:4},{rot:180}]]],attnames=["probability","id","position","rotation","scale","class","color","width","height","opacity","src","repeat","animation","font","value","baseline","align","intensity","distance","depth","radius","open-ended","side","segments-height","segments-radial","theta-length","segments","segments-width","segments-tubular","radius-tubular","arc","gaze","raycaster","line","material","transparent"];function insideellipse(a,b,c,d,e,f){return!!(1>(a-e)*(a-e)/(c*c)+(b-f)*(b-f)/(d*d))}function nebulainside(c,d,e,f,h,j,k,l,m,n,o,p){var q=Math.round(1e3*Math.random()),s=Math.round(1e3*Math.random());if(insideellipse(q,s,k,l,f,h)){var t=Math.round(Math.random()*n),u=Math.round(Math.random()*c)+j,r=Math.round(Math.random()*d)+j,g=Math.round(Math.random()*e)+j;if(!p)var p=Math.random()/m;o.fillStyle="rgba("+u+","+r+","+g+","+p+")",o.beginPath(),o.arc(q,s,t,0,2*Math.PI,!1),o.fill()}}function nebula(b,d,e,f,g,h,j){var a=document.getElementById("nebula"),c=a.getContext("2d");for(i=0;1e3>i;i++)nebulainside(b,d,e,f,g,h,200,200,10,6,c,j);for(i=0;2e3>i;i++)nebulainside(b,d,e,f,g,h,150,150,5,3,c,j);for(i=0;2e3>i;i++)nebulainside(b,d,e,f,g,h,100,100,5,3,c,j);for(i=0;100>i;i++)nebulainside(b,d,e,f,g,h,50,50,10,50,c,j);for(i=0;100>i;i++)nebulainside(b,d,e,f,g,h,50,50,10,50,c,j)}function noise(c,d,e,f,h,j,k,l,m,n,o){for(i=0;i<=c;i++){var p=Math.round(Math.random()*d),q=Math.round(Math.random()*e),s=Math.round(2*Math.random()),t=Math.round(Math.random()*f)+k,r=Math.round(Math.random()*h)+l,g=Math.round(Math.random()*j)+m;o||(o=1),n.fillStyle="rgba("+t+","+r+","+g+","+o+")",n.beginPath(),n.arc(p,q,s,0,2*Math.PI,!1),n.fill()}}function buildStars(){var a=document.getElementById("stars"),c=a.getContext("2d");c.fillStyle="rgba(0,0,0,255)",c.fillRect(0,0,1024,1024),noise(1e4,1024,1024,15,15,35,0,0,0,c);for(var d=document.getElementById("nebula"),e=d.getContext("2d"),f=0;10>f;f++){e.clearRect(0,0,1024,1024);for(var h=startY=512,k=1,l=Math.round(155*Math.random()),m=Math.round(155*Math.random()),g=Math.round(155*Math.random()),b=0;10>b;b++)nebula(l,m,g,h,startY,100,!1),k=Math.round(150*Math.random())-75,h+=k*(2*Math.random()-1),startY+=k*(2*Math.random()-1),950<h&&(h-=500),50>h&&(h=500),950<startY&&(startY=500),50>startY&&(startY=500);var n=Math.round(524*Math.random())-250,o=Math.round(524*Math.random())-250;c.drawImage(d,n,o)}noise(1e4,4096,4096,55,55,55,200,200,200,c)}function paintEarth(){var a=document.getElementById("nebula"),b=document.getElementById("stars"),c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,1e3);d.addColorStop(0,"#fff"),d.addColorStop(.2,"#fff"),d.addColorStop(.3,"#233c75"),d.addColorStop(.8,"#233c75"),d.addColorStop(.9,"#fff"),c.fillStyle=d,c.fillRect(0,0,1024,1024);var d=c.createLinearGradient(0,0,0,1e3);d.addColorStop(0,"#fff"),d.addColorStop(.25,"#fff"),d.addColorStop(.3,"#41561e"),d.addColorStop(.5,"#33441e"),d.addColorStop(.8,"#41561e"),d.addColorStop(1,"#fff"),c.fillStyle=d,c.font="1000px serif",c.textAlign="center",c.fillText("\uD83D\uDDFA",512,800),noise(1e4,1024,1024,255,255,255,0,0,0,c,.02),document.querySelector("#winplanet").setAttribute("src",b.toDataURL("image/png"))}function asteroids(){for(var a=-1;1>=a;a+=2)for(var b=1;5>=b;b++){var c=0>a?-2*b-5:2*b+20,d=10*Math.random()-5,e=35*Math.random()+10-2*b,f=Math.random()+.5,g=Math.random()+.5,h=Math.random()+.5;buildEntity({type:"a-sphere",attributes:",asteroid"+b+"_"+a+","+c+" "+d+" "+e+",,"+f+" "+g+" "+h+",,#111,,,,,,,,,,,,,,,,,4,,,,4"},document.querySelector("#a-scene")),document.querySelector("#asteroid"+b+"_"+a).setAttribute("animation","property:rotation;to:360 0 0;loop:true;dur:"+3e3*b+";easing:linear"),document.querySelector("#asteroid"+b+"_"+a).setAttribute("animation__2","property:position;from:"+c+" "+d+" "+e+";to:"+c+" "+d+" -50;loop:true;dur:"+1e4*b+";easing:linear")}}function buildFloor(){var a=document.getElementById("c128"),b=a.getContext("2d");for(b.fillStyle="rgba(157,157,157,1)",b.fillRect(0,0,128,128),noise(1e3,128,128,25,25,25,150,150,150,b),i=0;128>i;i+=64)b.strokeStyle="rgba(90,90,90,1)",b.beginPath(),b.moveTo(0,i),b.lineTo(i,0),b.stroke(),b.beginPath(),b.moveTo(128,i),b.lineTo(i,128),b.stroke(),b.strokeStyle="rgba(200,200,200,1)",b.beginPath(),b.moveTo(i,0),b.lineTo(128,128-i),b.stroke(),b.strokeStyle="rgba(50,50,50,1)",b.beginPath(),b.moveTo(i+2,0),b.lineTo(128,128-(i+2)),b.stroke(),b.strokeStyle="rgba(200,200,200,1)",b.beginPath(),b.moveTo(i,128),b.lineTo(0,128-i),b.stroke(),b.strokeStyle="rgba(50,50,50,1)",b.beginPath(),b.moveTo(i+2,128),b.lineTo(0,128-(i+2)),b.stroke();floorMat=a.toDataURL("image/png")}function buildHoloButton(a,b,c,d){buildEntity({type:"a-entity",attributes:",holobuttonparent,"+a+" "+b+" "+c+",0 "+d+" 0",children:[{type:"a-cylinder",attributes:",holobutton,,0 0 90,,button,#009,,.12,,,,,,,,,,,,.15",children:[{type:"a-text",attributes:",,0 .08 0,-90 270 0,.3 .3 .3,,,,,,,,,exo2semibold,HOLO\nBUDDY,,center"}]}]},document.querySelector("#ship"))}function holo(){document.querySelector("#holo")?document.querySelector("#holobuttonparent").removeChild(document.querySelector("#holo")):(zzfx(...[,.1,75,.03,.08,.17,1,1.88,7.83,,,,,.4]),buildEntity({type:"a-image",attributes:",holo,-1 .1 0,,,collidable,,1,2,.7,"+holoImage+",,property:rotation;from:0 0 -5;to:0 0 5;loop:true;dur:300;easing:linear;dir:alternate"},document.querySelector("#holobuttonparent")))}function buildMap(){var a=levels[level][0];start=levels[level][3].split(","),startX=parseInt(start[0]),startZ=parseInt(start[1]),rotY=parseInt(start[2]);var b=a.split(";");for(var c in gameMap=Array(b.length),gameMap2=Array(b.length),gameMap3=Array(b.length),b)cols=b[c].split(","),gameMap[c]=cols;for(var c in b=levels[level][1].split(";"),b)cols=b[c].split(","),gameMap2[c]=cols;for(var c in b=levels[level][2].split(";"),b)cols=b[c].split(","),gameMap3[c]=cols}function buildShip(){for(var a in gameMap)for(var b in gameMap[a])walls=gameMap[a][b],walls2=gameMap2[a][b],walls3=gameMap3[a][b],1&walls&&wall(3*b,1,-1.45+3*a,270,"wn"+a+"_"+b),2&walls&&wall(1.45+3*b,1,3*a,180,"we"+a+"_"+b),4&walls&&wall(3*b,1,1.45+3*a,90,"ws"+a+"_"+b),8&walls&&wall(-1.45+3*b,1,3*a,0,"ww"+a+"_"+b),16&walls&&windo(3*b,1,-1.45+3*a,90,"win"+a+"_"+b),32&walls&&windo(1.45+3*b,1,3*a,0,"win"+a+"_"+b),64&walls&&windo(3*b,1,1.45+3*a,270,"win"+a+"_"+b),128&walls&&windo(-1.45+3*b,1,3*a,180,"win"+a+"_"+b),1&walls2&&light(3*b,3*a),2&walls2&&cryo(1+3*b,.5,3*a,90),4&walls2&&cryo(3*b,.5,1+3*a,0),8&walls2&&layFloor(b,a),16&walls2&&buildEntity({type:"a-plane",attributes:",,"+3*b+" 2 "+3*a+",-270 0 0,,ceiling,#ccc,3,3"},document.querySelector("#ship")),32&walls2&&battery(1.1+3*b,.8,3*a),64&walls2&&dwall(3*b,1,3*a,-45),128&walls2&&dwall(3*b,1,3*a,45),1&walls3&&doorway(3*b,1,3*a-1.5,0),2&walls3&&doorway(3*b+1.5,1,3*a,90),4&walls3&&doorway(3*b,1,3*a+1.5,180),8&walls3&&doorway(3*b-1.5,1,3*a,270),16&walls3&&buildHoloButton(3*b,.7,3*a-1.4,90),32&walls3&&buildHoloButton(3*b+1.4,.7,3*a,0),64&walls3&&buildHoloButton(3*b,.7,3*a+1.4,-90),128&walls3&&buildHoloButton(3*b-1.4,.7,3*a,180);document.querySelector("#log").setAttribute("text","value:Time to wake up...")}function buildButtons(){var a=document.querySelectorAll(".button");for(b=0;b<a.length;b++)document.querySelector("#camera").removeChild(a[b]);var b=x=y=0;for(var c in levels)0==b%3&&(x=-.35,y-=.2),buildEntity({type:"a-plane",attributes:",level"+parseInt(c)+","+(-.35+.55*x)+" "+(y-.2)+" -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,LEVEL "+(parseInt(c)+1)+",,center"}]},document.querySelector("#camera")),b++,x++}function layFloor(a,b){buildEntity({type:"a-box",attributes:",floor"+a+"_"+b+","+3*a+" 0 "+3*b+",0 0 0,,collidable,#666,3,.01,,,,,,,,,,,3"},document.querySelector("#ship")),document.querySelector("#floor"+a+"_"+b).setAttribute("src",floorMat),document.querySelector("#floor"+a+"_"+b).setAttribute("repeat","10 10")}function dwall(a,b,c,d){var e=document.createElement("a-entity");document.querySelector("#ship").appendChild(e),wall(0,0,0,0,"",e),e.setAttribute("scale","1 1 1.45"),e.setAttribute("position",a+" "+b+" "+c),e.setAttribute("rotation","0 "+d+" 0")}function cryo(a,b,c,d){buildEntity({type:"a-cylinder",attributes:",,"+a+" "+b+" "+c+",90 "+(d-90)+" 0,,,#77f,,2,.3,,,,,,,,,,,.5,false,double,,,220,,,,,180"},document.querySelector("#ship")),buildEntity({type:"a-box",attributes:",,"+a+" "+(b-.25)+" "+c+",0 "+(d+90)+" 0,,,#aaa,1.1,.5,,,,,,,,,,,2.1",children:[{type:"a-box",attributes:",,,,,,#eee,.9,.55,,,,,,,,,,,1.8,,,,,,,,,,,,,,,shader:flat"},{type:"a-text",attributes:",,.55 0 .4,0 90 0,,,,,,,,,,exo2semibold,CRYOPOD 003"}]},document.querySelector("#ship"))}function battery(a,b,c){buildEntity({type:"a-cylinder",attributes:",battery,"+a+" "+b+" "+c+",30 0 0,2 2 2,button,#33f,,.2,,"+batteryImage+",2 1,property:rotation;to:30 360 0;loop:true;dur:3000;easing:linear,,,,,,,,.05,false,,,12,,,,,,,,,,shader:flat",children:[{type:"a-cylinder",attributes:",batteryInner,0 .06 0,,,,#eee,,.1,,,,,,,,,,,,.03,false,,,12,,,,,,,,,,shader:flat"}]},document.querySelector("#ship"))}function doorway(a,b,c,d){buildEntity({type:"a-entity",attributes:",,"+a+" "+b+" "+c+",0 "+d+" 0",children:[{type:"a-box",attributes:",,1 0 0,,,collidable,,1,2,,,,,,,,,,,.15"},{type:"a-box",attributes:",,-1 0 0,,,collidable,,1,2,,,,,,,,,,,.15"},{type:"a-box",attributes:",,1 0 0,,,,#444,.8,1.6,,,,,,,,,,,.17"},{type:"a-box",attributes:",,-1 0 0,,,,#444,.8,1.6,,,,,,,,,,,.17"}]},document.querySelector("#ship"))}function light(a,b){var c=document.createElement("a-box");c.setAttribute("position",a+" 2 "+b),c.setAttribute("width",1),c.setAttribute("height",.05),c.setAttribute("depth",1),c.setAttribute("color","#fff"),c.setAttribute("material","shader:flat"),document.querySelector("#ship").appendChild(c);var d=document.createElement("a-light");d.setAttribute("type","point"),d.setAttribute("color","#fff"),d.setAttribute("intensity",1),d.setAttribute("distance",2.5),c.appendChild(d)}function escape(a,b,c){layFloor(a/3,c/3),buildEntity({type:"a-plane",attributes:",,"+a+" 2 "+c+",-270 0 0,,ceiling,#ccc,3,3"},document.querySelector("#ship")),wall(a,1,-1.45+c,270,"escaperoomn"),wall(a,1,1.45+c,90,"escaperooms"),windo(a+1.45,1,c,180,"escaperoomw"),light(a,c),transporter(a,0,c),document.querySelector("#game").components.game.data.teleporterPosition=a+" 0 "+c}function newgame(){document.querySelector("#title1").setAttribute("text","value:"),document.querySelector("#title2").setAttribute("text","value:"),document.querySelector("#title3").setAttribute("text","value:"),document.querySelector("#titles2").setAttribute("text","value:"),buildEntity({type:"a-text",attributes:",instructions,0 1 -10,0 0 0,,,#ffff82,,,,,,,exo2semibold,An emergency alert wakes you up from hibernation~ leaving you still partially paralyzed. Apparently~ the ship is going to explode any minute.\n\nGreat.\n\nEven better~ the malfunctioning NurseBots insist you stay in the medbay.\n\nSince you can't walk~ use your handy personal teleporter (HOLD AND RELEASE LEFT TRIGGER) to evade the bots~ and your kinetic beam (RIGHT TRIGGER) to interact~ and get to the evacuation transporter to get to the nearest safe location.,,center"},document.querySelector("#camera")),buildButtons()}function endGame(){done=!0,loaded=!1,zzfx(...[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6]),document.querySelector("#a-scene").removeChild(document.querySelector("#ship")),document.querySelector("#camera").removeChild(document.querySelector("#timerUI")),document.querySelector("#camera").removeChild(document.querySelector("#batteryParentUI")),document.querySelector("#rig").setAttribute("position","0 0 0"),document.querySelector("#title1").setAttribute("text","value:YOU DIED."),document.querySelector("#titles2").setAttribute("text","value:Your constituent particles have been converted directly to energy, in a very violent fashion."),done=!1,buildEntity({type:"a-plane",attributes:",level"+level+",0 -.25 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,TRY AGAIN,,center"}]},document.querySelector("#camera")),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera"))}function win(){done=!0,loaded=!1,zzfx(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07]),document.querySelector("#a-scene").removeChild(document.querySelector("#ship")),document.querySelector("#camera").removeChild(document.querySelector("#timerUI")),document.querySelector("#camera").removeChild(document.querySelector("#batteryParentUI")),document.querySelector("#rig").setAttribute("position","0 50 0"),4==level?(document.querySelector("#title1").setAttribute("text","value:HOME SWEET HOME!"),document.querySelector("#titles2").setAttribute("text","value:Well, somebody's home, at least. Hope this planet is friendly."),buildEntity({type:"a-sphere",attributes:",winplanet,1000 50 0,,50 50 50,,,,,,,,property:rotation;from:0 180 0;to:0 540 0;loop:true;dur:180000;easing:linear"},document.querySelector("#a-scene")),paintEarth(),document.querySelector("#winplanet").setAttribute("animation__2","property:position;to:120 50 0;dur:1000;"),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera"))):(document.querySelector("#title1").setAttribute("text","value:SAFE! ...right?"),document.querySelector("#titles2").setAttribute("text","value:You have 'ported to another ship. Hope there are no NurseBots..."),buildEntity({type:"a-plane",attributes:",level"+(level+1)+",0 -.25 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,NEXT,,center"}]},document.querySelector("#camera")),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera")))}function openDoor(){document.querySelector("#innerdoor").setAttribute("animation","property:position;to:0 3 0;loop:false;dur:1000;easing:linear")}function buildEntity(a,b){var c=document.createElement(a.type);"a-light"==a.type&&c.setAttribute("type","point");var d=a.attributes.split(",");if(!d[0]||shouldAddEntity(d[0])){for(i=1;i<d.length;i++)d[i]&&(c.setAttribute(attnames[i],d[i].replace(/~/g,",")),"class"==attnames[i]&&c.setAttribute(d[i],""));for(child in b.appendChild(c),a.children)buildEntity(a.children[child],c)}}function transporter(a,b,d){buildEntity({type:"a-torus",attributes:",transporterBase,"+a+" "+b+" "+d+",90 0 0,,,,,,,,,,,,,,,,,.6,,,,,,,,,.01"},document.querySelector("#ship"));var e=document.getElementById("gradient"),c=e.getContext("2d"),f=c.createLinearGradient(0,0,0,1024);f.addColorStop(.1,"rgba(22,22,255,1)"),f.addColorStop(.8,"rgba(255,255,255,0"),c.fillStyle=f,c.fillRect(0,0,1024,1024);var g=e.toDataURL("image/png");buildEntity({type:"a-cylinder",attributes:",transporter,"+a+" "+(b+1)+" "+d+",180 0 0,,,,,2,,,,,,,,,,,,.6,true,double,,,,,,,,,,,,shader:flat,true"},document.querySelector("#ship")),document.querySelector("#transporter").setAttribute("src",g)}function buildBot(a,b,c){buildEntity({type:"a-entity",attributes:",robot"+a+","+b+" 0 "+c+",0 180 0,,robot",children:[{type:"a-entity",attributes:",robotrot"+a+",0 .6 0",children:[{type:"a-cylinder",attributes:",,0 0 0,,,,#fff,,1,,,,,,,,,,,,.3,,,12"},{type:"a-cylinder",attributes:",,0 .5 0,,,,#000,,.02,,,,,,,,,,,,.31,true,double"},{type:"a-cylinder",attributes:",,0 -.5 0,,,,#000,,.02,,,,,,,,,,,,.31,true,double"},{type:"a-box",attributes:",,0 .65 0,,.1 .3 .1,,#00f"},{type:"a-box",attributes:",,0 .25 -.22,,.3 .45 .3,,#00f"},{type:"a-box",attributes:",,0 .25 .25,,.1 .3 .1,,#f00"},{type:"a-box",attributes:",,0 .25 .25,,.3 .1 .1,,#f00"}]}]},document.querySelector("#ship")),buildEntity({type:"a-entity",attributes:",headrobot"+a+",0 .8 0,,,,,,,,,,property:rotation;from:0 -15 0;to:0 15 0;loop:true;dur:1000;easing:linear;dir:alternate;pauseEvents:foundPlayer;resumeEvents:fired",children:[{type:"a-sphere",attributes:",eyerobot"+a+",0 .03 .22,,,,#fff,,,,,,,,,,,,,,.07,,8,,,,8,,,,,,,,shader:flat",children:[{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:0 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:.3 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:-.3 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:.7 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:-.7 0 1,opacity:.0"}]},{type:"a-cylinder",attributes:",,0 0 0,0 45 0,,,#fff,,.3,,,,,,,,,,,,.25,,double,,12"},{type:"a-cylinder",attributes:",,0 0 0,0 45 0,,,#f00,,.2,,,,,,,,,,,,.26,true,double,,12"},{type:"a-cylinder",attributes:",,0 .15 0,0 45 0,,,#000,,.02,,,,,,,,,,,,.26,true,double,,12"},{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,#000,,.02,,,,,,,,,,,,.26,true,double,,12"}]},document.querySelector("#robotrot"+a)),buildEntity({type:"a-sphere",attributes:",leftarm,.35 .4 0,-30 0 0,,,#000,,,,,,property:rotation;from:0 0 0;to:30 0 0;loop:true;dur:1000;easing:linear;dir:alternate,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.06,,,,6"},{type:"a-sphere",attributes:",,0 -.3 0,-30 0 0,,,#000,,,,,,,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.04,,,,6",children:[{type:"a-cylinder",attributes:",,0 -.16 0,90 -45 -45,1.6 1 1.5,,#fff,,.08,,,,,,,,,,,,.04,,double,,5,300"}]}]}]},document.querySelector("#robotrot"+a)),buildEntity({type:"a-sphere",attributes:",rightarm,-.35 .4 0,-30 0 0,,,#000,,,,,,property:rotation;from:30 0 0;to:0 0 0;loop:true;dur:1000;easing:linear;dir:alternate,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.06,,,,6"},{type:"a-sphere",attributes:",,0 -.3 0,-30 0 0,,,#000,,,,,,,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.04,,,,6",children:[{type:"a-cylinder",attributes:",,0 -.16 0,90 45 -45,1.6 1 1.5,,#fff,,.08,,,,,,,,,,,,.04,,double,,5,300"}]}]}]},document.querySelector("#robotrot"+a));var d=document.createElement("a-light");document.querySelector("#eyerobot"+a).appendChild(d),d.setAttribute("id","botlightrobot"+a),d.setAttribute("position","0 -.2 1"),d.setAttribute("intensity",.5),d.setAttribute("type","point"),d.setAttribute("color","#fff"),d.setAttribute("distance",2)}function draw(){var a=document.getElementById("holocanvas"),b=a.getContext("2d");b.font="300px serif",b.textAlign="center",b.fillText("\uD83D\uDE4B\uD83C\uDFFD\u200D\u2640\uFE0F",300,400),holoImage=a.toDataURL("image/png").replace(/,/g,"~"),b.fillStyle="#33f",b.fillRect(0,0,600,1200),b.fillText("\u26A1",300,600),batteryImage=a.toDataURL("image/png").replace(/,/g,"~")}function bits(){for(var a in botPaths[level])buildBot(a,botPaths[level][a][0].x,botPaths[level][a][0].z);startPos=levels[level][3].split(","),exitPos=levels[level][4].split(","),doorX=3*exitPos[0],doorZ=3*exitPos[1],door(doorX-1.5,1,doorZ,0),escape(doorX,0,doorZ)}function door(a,b,c,d){buildEntity({type:"a-entity",attributes:",door,"+a+" "+b+" "+c+",0 "+d+" 0",children:[{type:"a-box",attributes:",,0 0 1.2,,,collidable,#fff,.2,2,,,,,,,,,,,.6"},{type:"a-box",attributes:",,0 0 -1.2,,,collidable,#fff,.2,2,,,,,,,,,,,.6"}]},document.querySelector("#ship")),buildEntity({type:"a-entity",attributes:",innerdoor,,,,door",children:[{type:"a-cylinder",attributes:",hitbox,-.01 0 .75,0 0 90,,button,#900,,.12,,,,,,,,,,,,.15",children:[{type:"a-text",attributes:",,.02 .07 -.12,-90 270 0,.4 .4 .4,,,,,,,,,exo2semibold,OPEN"}]},{type:"a-box",attributes:",,0 0 .8,,,,#999,.08,2,,,,,,,,,,,.5"},{type:"a-box",attributes:",,0 0 -.8,,,,#999,.08,2,,,,,,,,,,,.5"},{type:"a-box",attributes:",,0 .9 0,,,,#999,.08,.2,,,,,,,,,,,1.4"},{type:"a-box",attributes:",,0 -.8 0,,,,#999,.08,.5,,,,,,,,,,,1.4"},{type:"a-plane",attributes:",,0 .2 0,180 90 0,,collidable,#00f,1.4,1.5,.8,,,,,,,,,,,,,double,,,,,,,,,,,,,true"},{type:"a-text",attributes:",,-.01 .5 0,0 270 0,2 2.5 2,,#fff,3,,,,,,exo2semibold,EXIT,top,center"}]},document.querySelector("#door"))}function windo(a,b,c,d,e){buildEntity({type:"a-entity",attributes:","+e+","+a+" "+b+" "+c+",0 "+d+" 0",children:[{type:"a-plane",attributes:",,,0 90 0,,collidable,,3,2,.1,,,,,,,,,,,,,double"},{type:"a-box",attributes:",,0 .9 0,,,,#fff,.2,.2,,,,,,,,,,,3"},{type:"a-cylinder",attributes:".5,,0 .68 .75,22.5 0 90,,,#999,,.22,,,,,,,,,,,,.1,,,,8"},{type:"a-box",attributes:",,0 -1 0,,,,#fff,.2,1,,,,,,,,,,,3"},{type:"a-box",attributes:",,0 0 1.2,,,,#fff,.2,2,,,,,,,,,,,.7"},{type:"a-box",attributes:",,0 0 -1.2,,,,#fff,.2,2,,,,,,,,,,,.7"},{type:"a-box",attributes:",,0 .8 .65,45 0 0,,,#fff,.2,.3,,,,,,,,,,,2"},{type:"a-box",attributes:",,0 -.7 -.5,45 0 0,,,#fff,.2,.3,,,,,,,,,,,2"},{type:"a-torus",attributes:",,0 .1 0,0 90 0,,,#999,,,,,,,,,,,,,,.5,,,,4,,,,6,.01,360"},{type:"a-cylinder",attributes:",,0 .1 .7,0 90 90,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 .1 -.7,0 90 90,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 .74 0,0 90 0,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 -.54 0,0 90 0,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-plane",attributes:".5,,-.102 0 -1.05,0 270 0,,,#999,.1,1.55"},{type:"a-plane",attributes:",,-.102 -.725 -.12,0 270 0,,,#999,1.95,.1"}]},document.querySelector("#ship"))}function shouldAddEntity(a){return Math.random()>=a}function wall(a,b,c,d,e,f){f||(f=document.querySelector("#ship")),buildEntity({type:"a-box",attributes:","+e+","+a+" "+b+" "+c+",0 "+d+" 0,,collidable,,.1,2,,,,,,,,,,,3",children:[{type:"a-plane",attributes:".5,,.055 0 .3,0 90 0,,,#444,.3,2"},{type:"a-plane",attributes:".5,,.055 0 .6,0 90 0,,,#444,.1,2"},{type:"a-plane",attributes:".5,,.055 0 .9,0 90 0,,,#444,.3,2"},{type:"a-cylinder",attributes:".5,,0 .83 0,0 90 90,,,#005,,3.01,,,,,,,,,,,,.065,,,,8",children:[{type:"a-cylinder",attributes:",,0 -1.2 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"},{type:"a-cylinder",attributes:",,0 1.3 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"},{type:"a-cylinder",attributes:",,0 1.1 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"}]},{type:"a-cylinder",attributes:".5,,0 -.75 0,0 90 90,,,#66F,,3.01,,,,,,,,,,,,.12,,,,8",children:[{type:"a-cylinder",attributes:",,0 -1 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"},{type:"a-cylinder",attributes:",,0 0 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"},{type:"a-cylinder",attributes:",,0 1.1 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"}]},{type:"a-box",attributes:".5,,0 -.25 -.5,,,,#C99,.12,.2,,,,,,,,,,,.8"},{type:"a-box",attributes:".5,,0 -.45 -.5,,,,#9c9,.12,.2,,,,,,,,,,,.8"},{type:"a-box",attributes:".5,,0 .27 0,,,,#000,.15,.7,,,,,,,,,,,2.5",children:[{type:"a-text",attributes:",,.08 0 1.2,0 90 0,,wallscreen,#f00,3,,,,,,exo2semibold,,top"}]}]},f)}function getVol(a){var b=document.querySelector("#eye"+a),c=new THREE.Vector3;b.object3D.getWorldPosition(c);var d=document.querySelector("#camera");return dx=c.x-d.object3D.position.x,dz=c.z-d.object3D.position.z,dh=Math.sqrt(dx*dx+dz*dz),1/dh}function teleport(){if("player"==currenttarget){var a=document.querySelector("#"+currenttarget).parentEl.parentEl;document.querySelector("#transporter").setAttribute("position",a.object3D.position.x+" 1 "+a.object3D.position.z),setTimeout(finishTeleport,150)}else if("holo"==currenttarget){var a=document.querySelector("#"+currenttarget),b=new THREE.Vector3;a.object3D.getWorldPosition(b),document.querySelector("#transporter").setAttribute("position",b.x+" 1 "+b.z),setTimeout(finishTeleport,150)}}function finishTeleport(){"player"==currenttarget&&document.querySelector("#rig").setAttribute("position",3*startX+" 0 "+3*startZ);var a=document.querySelector("#transporterBase");document.querySelector("#transporter").setAttribute("position",a.object3D.position.x+" 1 "+a.object3D.position.z)}function fireSound(a){zzfx(...[getVol(a),0,214,.01,.01,.5,4,.6,-.1,1,,,.05,.1,3,,.13,1.28,.05]),setTimeout(teleport,100)}function laser(a){var b=document.querySelector("#eye"+a);b.setAttribute("color","#99F"),document.querySelector("#botlight"+a).setAttribute("color","#99F");var c=new THREE.Vector3;b.object3D.getWorldPosition(c);var d=document.querySelector("#"+currenttarget),e=new THREE.Vector3;d.object3D.getWorldPosition(e);var f=document.createElement("a-entity");f.setAttribute("line",{start:c.x+" "+c.y+" "+c.z,end:e.x+" 1 "+e.z,color:"blue"}),f.setAttribute("id","laser"+a),document.querySelector("#a-scene").appendChild(f),setTimeout(function(){endLaser(a)},100)}function endLaser(a){if(el=document.querySelector("#laser"+a),el){var b=document.querySelector("#eye"+a);b.setAttribute("color","white"),document.querySelector("#botlight"+a).setAttribute("color","#fff"),el.parentNode.removeChild(el)}}function fire(a){fireSound(a),laser(a);var b=document.querySelector("#"+a);b.emit("fired",{},!0);var c=document.querySelector("#head"+a);c.emit("fired",{},!1),c.removeAttribute("animation__vibrate"),b.removeEventListener("animationcomplete__vibrate",fireListener[a]),firing=!1}function warmUp(a){if(!firing){firing=!0,zzfx(...[getVol(a),0,24,1,.27,.05,2,,,8.2,20,.08,.12,,.05,,,.97,.05]);var b=document.querySelector("#head"+a);elPos=b.object3D.position,b.setAttribute("animation__vibrate",{property:"position",from:elPos.x+" .78 "+elPos.z,to:elPos.x+" .8 "+elPos.z,loop:17,dur:100}),b.addEventListener("animationcomplete__vibrate",fireListener[a]=function(){fire(a)})}}function getJunk(){if(""==junk)for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\t\t\t ",b=0;18>=b;b++){for(var c=0;c<400*Math.random()+10;c++)junk+=a.charAt(Math.floor(Math.random()*a.length));junk+="\n"}return junk}function distance(a,b){var c=a.x-b.x,d=a.z-b.z,e=Math.round(100*Math.sqrt(c*c+d*d))/100;return e-.25}function hitPlayer(a,b){var c=document.querySelector("#rig");return distance(c.object3D.position,a)<=Math.round(100*b.z)/100}function loadLevel(a){if(!loaded){var b=document.querySelectorAll(".button");for(i=0;i<b.length;i++)document.querySelector("#camera").removeChild(b[i]);loaded=!0;var c=document.createElement("a-entity");c.setAttribute("id","ship"),document.querySelector("#a-scene").appendChild(c),document.querySelector("#log").setAttribute("text","value:LOADING..."),level=a,buildMap(),buildShip(),bits(),document.querySelector("#leftController").setAttribute("teleport-controls","button:trigger;objects:.collidable,.floor;cameraRig:#rig"),document.querySelector("#title1").setAttribute("text","value:"),document.querySelector("#title2").setAttribute("text","value:"),document.querySelector("#title3").setAttribute("text","value:"),document.querySelector("#titles2").setAttribute("text","value:"),document.querySelector("#rig").setAttribute("position",3*startX+" 0 "+3*startZ),document.querySelector("#rig").setAttribute("rotation","0 "+rotY+" 0"),buildEntity({type:"a-text",attributes:",batteryParentUI,-.3 .15 -.6,,.2 .2 .2,,,,,.7,,,,exo2semibold,BATTERY",children:[{type:"a-plane",attributes:",,1.5 -.04 -.01,,,,#fff,1,.15,.4,,,,,,,,,,,,,,,,,,,,,,,,,shader:flat"},{type:"a-plane",attributes:",batteryUI,1.5 -.04 0,,,,#ff0,1,.15,.8,,,,,,,,,,,,,,,,,,,,,,,,,shader:flat"}]},document.querySelector("#camera")),buildEntity({type:"a-text",attributes:",timerUI,.2 .15 -.6,,.2 .2 .2,timer,,,,.7,,,,exo2semibold,1:30"},document.querySelector("#camera")),document.querySelector("#game").components.game.data.battery=100,document.querySelector("#game").components.game.data.batteryUI=document.querySelector("#batteryUI"),document.querySelector("#game").components.game.data.batteryParentUI=document.querySelector("#batteryParentUI"),document.querySelector("#log").setAttribute("text","value:"),shiphum()}}AFRAME.registerComponent("timer",{schema:{lastTime:{type:"float"},timeLeft:{type:"int",default:90},ui:{type:"selector"}},init:function(){var a=this.el;this.data.ui=a,this.data.lastTime=Math.floor(Date.now()/1e3)},tick:function(){var a=Math.floor(Date.now()/1e3);if(a>this.data.lastTime){var b=this.data.timeLeft-(a-this.data.lastTime);10>=b&&this.data.ui.setAttribute("color","#f00"),this.data.timeLeft=b,0>b&&!done&&endGame(),this.data.lastTime=a;var c=Math.floor(b/60),d=b%60;10>d&&(d="0"+d),document.querySelector("#game").components.game.data.battery+=5,this.data.ui.setAttribute("value",c+":"+d)}}}),AFRAME.registerComponent("button",{schema:{id:{type:"string"},level:{type:"int"}},init:function(){var a=this.el;"newgame"==a.getAttribute("id")?a.addEventListener("click",function(){document.querySelector("#camera").removeChild(document.querySelector("#newgame")),newgame()}):"holobutton"==a.getAttribute("id")?a.addEventListener("click",function(){holo()}):"hitbox"==a.getAttribute("id")?a.addEventListener("click",function(){openDoor()}):"home"==a.getAttribute("id")?a.addEventListener("click",function(){newgame()}):"battery"==a.getAttribute("id")?a.addEventListener("click",function(){document.querySelector("#game").components.game.data.battery=100,document.querySelector("#ship").removeChild(document.querySelector("#battery"))}):(this.data.level=parseInt(a.getAttribute("id").replace(/level/,"")),a.addEventListener("click",function(){document.querySelector("#instructions")&&document.querySelector("#camera").removeChild(document.querySelector("#instructions")),loadLevel(a.components.button.data.level)}))}}),AFRAME.registerComponent("game",{schema:{timer:{type:"int",default:0},battery:{default:100},batteryUI:{type:"selector"},batteryParentUI:{type:"selector"},teleporterPosition:{type:"vec3"}},init:function(){draw(),buildStars(),asteroids(),buildFloor(),buildEntity({type:"a-plane",attributes:",newgame,0 -.3 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,NEW GAME,,center"}]},document.querySelector("#camera")),this.data.battery=100;var a=document.getElementById("stars"),b=a.getContext("2d"),c=a.toDataURL("image/png");document.querySelector("#image-360").setAttribute("src",c),document.querySelector("#image-360").setAttribute("repeat","4 4")},tick:function(){100<this.data.battery&&(this.data.battery=100),null!=this.data.batteryUI&&(this.data.batteryUI.setAttribute("scale",this.data.battery/100+" 1 1"),this.data.batteryUI.setAttribute("position",1+this.data.battery/100/2+" "+this.data.batteryUI.object3D.position.y+" "+this.data.batteryUI.object3D.position.z))}}),AFRAME.registerComponent("robot",{schema:{posX:{type:"number",default:0},posZ:{type:"number",default:1},dead:{type:"bool",default:!1},path:{type:"array"},step:{type:"int",default:-1},speed:{type:"int",default:1e3},timer:{type:"int",default:0}},init:function(){var a=this.el;this.data.path=botPaths[level][a.id.replace(/robot/,"")],this.step=-1,this.takeNextStep(a)},tick:function(){this.data.timer++,100<=this.data.timer&&this.el.setAttribute("visible",!1),80<=this.data.timer&&(this.el.setAttribute("visible",!0),this.data.timer=0)},takeNextStep:function(a){a.components.robot.data.step++,a.components.robot.data.step>=a.components.robot.data.path.length&&(a.components.robot.data.step=0);var b=a.components.robot.data.path[a.components.robot.data.step];null==b.rot?a.components.robot.moveTo(b.x,b.z,a):a.components.robot.turnTo(b.rot,a)},turnTo:function(a,b){b.components.robot.data.dead||(robotX=parseInt(Math.round(b.getAttribute("position").x/3)),robotZ=parseInt(Math.round(b.getAttribute("position").z/3)),b.removeAttribute("animation__moveTo"),b.removeEventListener("animationcomplete__moveTo",nextMove[b.id]),b.setAttribute("animation__turnTo",{pauseEvents:"foundPlayer",resumeEvents:"fired",property:"rotation",to:"0 "+a+" 0",loop:!1,dur:b.components.robot.data.speed,easing:"linear"}),b.addEventListener("animationcomplete__turnTo",nextTurn[b.id]=function(){360==Math.round(180*b.object3D.rotation.y/Math.PI)&&(b.object3D.rotation.y=0),-360==Math.round(180*b.object3D.rotation.y/Math.PI)&&(b.object3D.rotation.y=0),b.components.robot.takeNextStep(b)}))},moveTo:function(a,b,c){if(!c.components.robot.data.dead){var d=Math.abs(a-c.getAttribute("position").x),e=Math.abs(b-c.getAttribute("position").z),f=Math.max(d,e);c.removeAttribute("animation__turnTo"),c.removeEventListener("animationcomplete__turnTo",nextTurn[c.id]),c.setAttribute("animation__moveTo",{pauseEvents:"foundPlayer",resumeEvents:"fired",property:"position",to:a+" 0 "+b,loop:!1,dur:f*c.components.robot.data.speed,easing:"linear"}),c.addEventListener("animationcomplete__moveTo",nextMove[c.id]=function(){c.components.robot.takeNextStep(c)})}}}),AFRAME.registerComponent("wallscreen",{schema:{timer:{type:"int",default:0},flash:{type:"bool",default:!0}},init:function(){var a=this.el;0==Math.round(2*Math.random())%2?(a.setAttribute("position",".08 .1 1.2"),a.setAttribute("value","EMERGENCY ALERT"),a.setAttribute("color","red"),a.setAttribute("scale","2 2 2")):(this.data.flash=!1,a.setAttribute("position",".08 .33 1.2"),a.setAttribute("value",getJunk()),a.setAttribute("color","white"),a.setAttribute("scale","2 2 2"),a.setAttribute("wrap-count",400))},tick:function(){var a=this.el;this.data.timer++,this.data.flash&&(50<=this.data.timer&&a.setAttribute("visible",!1),80<=this.data.timer&&(a.setAttribute("visible",!0),this.data.timer=0))}}),AFRAME.registerComponent("gaze",{dependencies:["raycaster"],schema:{robot:{type:"selector"},so:{type:"selector"}},init:function(){this.data.robot=this.el.parentEl.parentEl.parentEl.parentEl,this.el.addEventListener("raycaster-intersection",function(a){var b=a.srcElement.parentEl.parentEl.parentEl.parentEl;if(("player"==a.detail.intersections[0].object.el.id||"holo"==a.detail.intersections[0].object.el.id)&&!firing&&!b.components.robot.data.dead&&hitPlayer(b.object3D.position,a.composedPath()[0].components.line.attrValue.end)){this.so=a.detail.intersections[0].object.el.id,currenttarget=this.so,ss(Math.floor(5*Math.random()),b.id),warmUp(b.id),b.emit("foundPlayer",{},!0);var c=document.querySelector("#head"+b.id);c.emit("foundPlayer",{},!1)}}),this.el.addEventListener("raycaster-intersection-cleared",function(){this.so&&(this.so=null)})}});</script></head><body bgcolor="#000" id="body"><canvas id="stars" style="display:none" height=1024 width=1024></canvas><canvas id="nebula" style="display:none" height=1024 width=1024></canvas><canvas id="gradient" style="display:none" height=1024 width=1024></canvas><canvas id="holocanvas" style="display:none" width=600 height=1200></canvas><canvas id="c128" style="display:none" width=128 height=128></canvas><a-scene id='a-scene' background="color:#000" antialias='true'><a-entity id=game game></a-entity><a-entity id="ambient" light="type:ambient;color:#fff;intensity:.2"></a-entity><a-entity light="type:directional;color:#fff;intensity:.5" rotation="-90 10 0"></a-entity><a-sky id="image-360" radius="360" phi-start="140" segments-width=32 segments-height=10></a-sky><a-entity id="rig" cameraRig position="0 0 0" rotation="0 90 0"><a-entity camera id="camera" wasd-controls="acceleration:150" look-controls="reverseMouseDrag: false" position="0 1.4 0"><a-cylinder class="collidable" height=2 visible=true position="0 1 0" id="player" radius=".15"></a-cylinder><a-plane position="0 0 -20" rotation="0 0 0" width="100" height="100" opacity="0"></a-plane><a-entity position="0 .3 -100" id="title1" color="#ffff82" text="font:exo2semibold;align:center;value:HUMAN" scale="3 3 3" animation="property:position;to:0 .3 -2;dur:2000"></a-entity><a-entity position="0 .19 -100" id="title2" color="#ffff82" text="font:exo2semibold;align:center;value:NOT" scale="2 2 2" animation="property:position;to:0 .19 -2;dur:2000"></a-entity><a-entity position="0 .1 -100" id="title3" color="#ffff82" text="font:exo2semibold;align:center;value:FOUND" scale="3 3 3" animation="property:position;to:0 .1 -2;dur:2000"></a-entity><a-entity position="0 -.09 -100" id="titles2" color="#ffff82" text="wrap-count:60;font:exo2semibold;align:center;value:An exploding ship. Crazy NurseBots. And to top it off, you're paralyzed.\n\nWell, great." scale="2 2 2" animation="property:position;to:0 -.09 -2;dur:2500"></a-entity><a-entity position="0 -.2 -.6" id="log" text="font:exo2semibold;value:;align:center"></a-entity></a-entity><a-entity id="leftController" static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: left" vive-controls="hand: left" tracked-controls=""></a-entity><a-entity id="rightController" static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: right" vive-controls="hand: right" tracked-controls="button:trigger;objects:.button;" laser-controls="objects:.button" raycaster="far:23"></a-entity></a-entity></a-scene></body></html>