<title>Human Not Found</title><script src=/2020/webxr/aframe.js></script><script>!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(1),s=(i(2),i(3));if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),i=e.length;0<=--i&&e.item(i)!==this;);return-1<i}),AFRAME.registerComponent("teleport-controls",{schema:{type:{default:"line",oneOf:["parabolic","line"]},button:{default:"xbutton",oneOf:["xbutton","trigger"]},startEvents:{type:"array"},endEvents:{type:"array"},collisionEntities:{default:".collidable"},hitEntity:{type:"selector"},cameraRig:{type:"selector"},teleportOrigin:{type:"selector"},hitCylinderColor:{type:"color",default:"#99ff99"},hitCylinderRadius:{default:.25,min:0},hitCylinderHeight:{default:.1,min:0},interval:{default:0},maxLength:{default:3,min:0,if:{type:["line"]}},curveNumberPoints:{default:30,min:2,if:{type:["parabolic"]}},curveLineWidth:{default:.025},curveHitColor:{type:"color",default:"#99ff99"},curveMissColor:{type:"color",default:"#ff0000"},curveShootingSpeed:{default:5,min:0,if:{type:["parabolic"]}},defaultPlaneSize:{default:100},landingNormal:{type:"vec3",default:"0 1 0"},landingMaxAngle:{default:"45",min:0,max:360},drawIncrementally:{default:!1},incrementalDrawMs:{default:700},missOpacity:{default:1},hitOpacity:{default:1},game:{type:"selector"}},init:function(){var t,e,i=this.data,n=this.el;if(this.active=!1,this.obj=n.object3D,this.hitPoint=new THREE.Vector3,this.rigWorldPosition=new THREE.Vector3,this.newRigWorldPosition=new THREE.Vector3,this.teleportEventDetail={oldPosition:this.rigWorldPosition,newPosition:this.newRigWorldPosition,hitPoint:this.hitPoint},this.data.game=document.querySelector("#game"),this.hit=!1,this.prevCheckTime=void 0,this.prevHitHeight=0,this.referenceNormal=new THREE.Vector3,this.curveMissColor=new THREE.Color,this.curveHitColor=new THREE.Color,this.raycaster=new THREE.Raycaster,this.defaultPlane=function(){var t,e;return(t=new THREE.PlaneBufferGeometry(100,100)).rotateX(-Math.PI/2),e=new THREE.MeshBasicMaterial({color:16776960}),new THREE.Mesh(t,e)}(this.data.defaultPlaneSize),this.defaultCollisionMeshes=[this.defaultPlane],(t=this.teleportEntity=document.createElement("a-entity")).classList.add("teleportRay"),t.setAttribute("visible",!1),n.sceneEl.appendChild(this.teleportEntity),this.onButtonDown=this.onButtonDown.bind(this),this.onButtonUp=this.onButtonUp.bind(this),this.data.startEvents.length&&this.data.endEvents.length){for(e=0;e<this.data.startEvents.length;e++)n.addEventListener(this.data.startEvents[e],this.onButtonDown);for(e=0;e<this.data.endEvents.length;e++)n.addEventListener(this.data.endEvents[e],this.onButtonUp)}else n.addEventListener(i.button+"down",this.onButtonDown),n.addEventListener(i.button+"up",this.onButtonUp);this.queryCollisionEntities()},update:function(t){var e=this.data,i=AFRAME.utils.diff(e,t);this.referenceNormal.copy(e.landingNormal),this.curveMissColor.set(e.curveMissColor),this.curveHitColor.set(e.curveHitColor),(!this.line||"curveLineWidth"in i||"curveNumberPoints"in i||"type"in i)&&(this.line=function(t){var e="line"===t.type?2:t.curveNumberPoints;return new s(e,t.curveLineWidth)}(e),this.line.material.opacity=this.data.hitOpacity,this.line.material.transparent=1>this.data.hitOpacity,this.numActivePoints=e.curveNumberPoints,this.teleportEntity.setObject3D("mesh",this.line.mesh)),e.hitEntity?this.hitEntity=e.hitEntity:(!this.hitEntity||"hitCylinderColor"in i||"hitCylinderHeight"in i||"hitCylinderRadius"in i)&&(this.hitEntity&&this.hitEntity.parentNode.removeChild(this.hitEntity),this.hitEntity=function(t){var e,i,s;return(i=document.createElement("a-entity")).className="hitEntity",(s=document.createElement("a-entity")).setAttribute("geometry",{primitive:"torus",radius:t.hitCylinderRadius,radiusTubular:.01}),s.setAttribute("rotation",{x:90,y:0,z:0}),s.setAttribute("material",{shader:"flat",color:t.hitCylinderColor,side:"double",depthTest:!1}),i.appendChild(s),(e=document.createElement("a-entity")).setAttribute("position",{x:0,y:t.hitCylinderHeight/2,z:0}),e.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,radius:t.hitCylinderRadius,height:t.hitCylinderHeight,openEnded:!0}),e.setAttribute("material",{shader:"flat",color:t.hitCylinderColor,side:"double",src:n,transparent:!0,depthTest:!1}),i.appendChild(e),i}(e),this.el.sceneEl.appendChild(this.hitEntity)),this.hitEntity.setAttribute("visible",!1),"collisionEntities"in i&&this.queryCollisionEntities()},remove:function(){var t=this.el,e=this.hitEntity,i=this.teleportEntity;e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i),t.sceneEl.removeEventListener("child-attached",this.childAttachHandler),t.sceneEl.removeEventListener("child-detached",this.childDetachHandler)},tick:function(){var t=new THREE.Vector3,e=(new THREE.Vector3,new THREE.Vector3(0,-9.8,0),new THREE.Vector3),i=new THREE.Vector3,n=new THREE.Quaternion,s=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Vector3,a=(new THREE.Vector3,new THREE.Vector3),l=0;return function(h,c){if(this.data.maxLength=this.data.game.components.game.data.battery/10,this.active&&(this.data.drawIncrementally&&this.redrawLine&&(this.redrawLine=!1,l=0),l+=c,this.numActivePoints=this.data.curveNumberPoints*l/this.data.incrementalDrawMs,this.numActivePoints>this.data.curveNumberPoints&&(this.numActivePoints=this.data.curveNumberPoints),!(this.prevCheckTime&&h-this.prevCheckTime<this.data.interval))){this.prevCheckTime=h,this.obj.matrixWorld.decompose(s,n,o);var d=r.set(0,0,-1).applyQuaternion(n).normalize();this.line.setDirection(a.copy(d)),this.obj.getWorldPosition(t),i.copy(t),this.teleportEntity.setAttribute("visible",!0),this.line.material.color.set(this.curveMissColor),this.line.material.opacity=this.data.missOpacity,this.line.material.transparent=1>this.data.missOpacity,this.hitEntity.setAttribute("visible",!1),this.hit=!1,e.copy(i).add(a.copy(d).multiplyScalar(this.data.maxLength)),this.raycaster.far=this.data.maxLength,this.raycaster.set(t,d),this.line.setPoint(0,t),this.checkMeshCollisions(1,e)}}}(),queryCollisionEntities:function(){var t,e=this.data,i=this.el;return e.collisionEntities?(console.log(i.sceneEl.querySelectorAll(e.collisionEntities)),t=[].slice.call(i.sceneEl.querySelectorAll(e.collisionEntities)),this.collisionEntities=t,this.childAttachHandler=function(i){i.detail.el.matches(e.collisionEntities)&&t.push(i.detail.el)},i.sceneEl.addEventListener("child-attached",this.childAttachHandler),this.childDetachHandler=function(i){var n;i.detail.el.matches(e.collisionEntities)&&(-1===(n=t.indexOf(i.detail.el))||t.splice(n,1))},void i.sceneEl.addEventListener("child-detached",this.childDetachHandler)):void(this.collisionEntities=[])},onButtonDown:function(){this.active=!0,this.redrawLine=!0},onButtonUp:function(){const t=new THREE.Vector3,e=new THREE.Vector3;new THREE.Vector3,new THREE.Vector3,new THREE.Vector3;return function(){if(this.active&&(this.active=!1,this.hitEntity.setAttribute("visible",!1),this.teleportEntity.setAttribute("visible",!1),this.hit)){const n=document.querySelector("#rig")||this.data.cameraRig||this.el.sceneEl.camera.el;n.object3D.getWorldPosition(this.rigWorldPosition),this.newRigWorldPosition.copy(this.hitPoint);const s=this.data.teleportOrigin;s&&(s.object3D.getWorldPosition(t),this.newRigWorldPosition.sub(t).add(this.rigWorldPosition)),this.newRigWorldPosition.y=this.rigWorldPosition.y+this.hitPoint.y-this.prevHitHeight,this.prevHitHeight=this.hitPoint.y;var i=this.rigWorldPosition.distanceTo(this.newRigWorldPosition);e.copy(this.newRigWorldPosition),n.object3D.parent&&n.object3D.parent.worldToLocal(e),n.setAttribute("position",e),function(t){teleporterPosition=document.querySelector("#game").components.game.data.teleporterPosition.split(" "),t.x<=teleporterPosition[0]+.6&&t.x>=teleporterPosition[0]-.6&&t.z<=teleporterPosition[2]+.6&&t.z>=teleporterPosition[2]-.6&&win()}(this.newRigWorldPosition),this.data.game.components.game.data.battery-=10*i,0>this.data.game.components.game.data.battery&&(this.data.game.components.game.data.battery=0),this.el.emit("teleported",this.teleportEventDetail)}}}(),checkMeshCollisions:function(t,e){var i;this.data.collisionEntities?(i=this.collisionEntities.map((function(t){return t.getObject3D("mesh")})).filter((function(t){return t})),i=i.length?i:this.defaultCollisionMeshes):i=this.defaultCollisionMeshes;var n=this.raycaster.intersectObjects(i,!0);if(0<n.length&&!this.hit&&this.isValidNormalsAngle(n[0].face.normal)){var s=n[0].point;this.line.material.color.set(this.curveHitColor),this.line.material.opacity=this.data.hitOpacity,this.line.material.transparent=1>this.data.hitOpacity,this.hitEntity.setAttribute("position",s),this.hitEntity.setAttribute("visible",!0),this.hit=!0,this.hitPoint.copy(n[0].point);for(var o=t;o<this.line.numPoints;o++)this.line.setPoint(o,this.hitPoint);return!0}return this.line.setPoint(t,e),!1},isValidNormalsAngle:function(t){var e=this.referenceNormal.angleTo(t);return THREE.Math.RAD2DEG*e<=this.data.landingMaxAngle}})},function(t){t.exports=""},function(t){t.exports=""},function(t){var e=function(t,e){this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*t*2),this.uvs=new Float32Array(2*t*2),this.width=e,this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:16711680}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.vertices=this.vertices,this.direction=new THREE.Vector3,this.numPoints=t};e.prototype={setDirection:function(t){var e=new THREE.Vector3(0,1,0);this.direction.copy(t).cross(e).normalize().multiplyScalar(this.width/2)},setWidth:function(t){this.width=t},setPoint:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(i,n){t.copy(n).add(this.direction),e.copy(n).sub(this.direction);var s=6*i;this.vertices[s++]=t.x,this.vertices[s++]=t.y,this.vertices[s++]=t.z,this.vertices[s++]=e.x,this.vertices[s++]=e.y,this.vertices[s++]=e.z,this.geometry.attributes.position.needsUpdate=!0}}()},t.exports=e}])</script><script>"use strict";let zzfx,zzfxV,zzfxX;zzfxV=.3,zzfx=(t=1,a=.05,z=220,e=0,f=0,n=.1,r=0,h=1,x=0,M=0,s=0,i=0,o=0,u=0,c=0,X=0,d=0,b=1,l=0,m=44100,V=[],B=zzfxX.createBufferSource(),C)=>{e=99+e*m,f*=m,n*=m,l*=m,d*=m;for(let B=2*Math.PI,C=t=>1+2*t*Math.random()-t,g=t=>0<t?1:-1,w=e+l+f+n+d,A=x*=500*B/m**2,D=z*=C(a)*B/m,I=g(c)*B/4,P=0,S=0,j=0,k=1,p=0,q=0,v=0;j<w;V[j++]=v)++q>100*X&&(q=0,v=P*z*Math.sin(S*c*B/m-I),v=g(v=r?1<r?2<r?3<r?Math.sin((v%B)**3):Math.max(Math.min(Math.tan(v),1),-1):1-(2*v/B%2+2)%2:1-4*Math.abs(Math.round(v/B)-v/B):Math.sin(v))*Math.abs(v)**h,v*=t*zzfxV*(j<e?j/e:j<e+l?1-(j-e)/l*(1-b):j<e+l+f?b:j<w-d?(w-j-d)/n*b:0),v=d?v/2+(d>j?0:(j<w-d?1:(j-w)/d)*V[j-d|0]/2):v),P+=C(u),S+=C(u),z+=x+=500*M*B/m**3,k&&++k>i*m&&(z+=s*B/m,D+=s*B/m,k=0),o&&++p>o*m&&(z=D,x=A,p=1,k=k||1);return(C=zzfxX.createBuffer(1,e+l+f+n+d,m)).getChannelData(0).set(V),B.buffer=C,B.connect(zzfxX.destination),B.start(),B},zzfxX=new AudioContext</script><script>function shiphum(){zzfx(...[.5,.5,847,.02,.3,.9,1,1.67,,,-294,.04,.13,,,,.1])}var junk="";function shuffle(t){for(let e=t.length-1;0<e;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}var talking=!1,playerTargeted=!1;function ss(t,e){var r=2*getVol(e);talking!=t&&(talking=t,zzfx(...[[r,,239,,.43,.2,,1.7,,,729,.02,.06,,,.1,,.88,.06],[r,,39,.17,.28,.25,,1.11,,,750,.09,.02,,,.1,,,.05],[r,,584,.21,.36,.86,,1.77,,,-157,.02,.1,.1,,,,.82,.08],[r,,948,.37,.38,.24,,1.52,4.9,,270,.07,.27,,-.2,,,.85,.02],[r,,727,,.09,.19,,1.55,,,-100,.1,,,,.1,,,.03]][t]),document.querySelector("#log").setAttribute("text","value:"+["I found you.","Target found.","Returning patient to medbay.","Targeting...","Teleporting."][t]),setTimeout((function(){document.querySelector("#log").setAttribute("text","value:")}),1500))}var holoImage,gameMap,gameMap2,gameMap3,floorMat,batteryImage,level,startX,startZ,rotY,currenttarget,height=4,width=4,map1a="146,,26,,;130,,8,,,;128,5,,,;130,,8,,;194,,74,,",map1b="27,,24,,;24,,56,152,;24,24,25,24,24;24,,24,88,;24,,24,,",map1c="4,,,,;,,,,;,,,,;,,,,;,,,,",map2a=",,16,,,;,,14,,,;128,7,,13,,,;,,11,,,;,,64,,,",map2b=",88,24,152,,,;88,88,25,152,152,;24,27,,57,24,;152,152,25,88,88,;,152,24,88,,",map2c=",,,,,,;,,1,,,,;,8,,2,,,;,,4,,,,;,,,,,,",map3a=",,,,24,;,,26,,10,;133,5,,5,,37;,,74,,10;,,,,74,",map3b=",,,64,24,;,,24,,24,;29,24,24,24,25,24;,,24,,24,;,,,128,24,",map3c=",,,,,;,,,,,;2,,,,,;,,32,,,;,,,,,",map4a=",,,16,16,,;,,8,,,2,;133,5,4,5,5,4,5",map4b=",,88,25,24,152,;,,24,24,152,24,;29,24,24,24,24,24,25",map4c=",,,,,,;,,,,,,;2,,64,,,,",map5a=",,,16,16,16;133,1,,,4,6;,12,4,66,,,",map5b=",,88,24,24,24;29,24,24,25,24,24;,24,24,24,,",map5c=",,,,,;2,,,,,;,,,32,,",nextMove=[,,,],nextTurn=[,,,],fireListener=[,,,],firing=!1,loaded=!1,done=!1,levels=[[map1a,map1b,map1c,"0,0,90","4,2"],[map2a,map2b,map2c,"1,2,180","5,2"],[map3a,map3b,map3c,"0,2,90","5,0"],[map4a,map4b,map4c,"0,2,180","7,2"],[map5a,map5b,map5c,"0,1,0","6,0"]],botPaths=[[[{x:6,z:12},{rot:180},{x:6,z:0},{rot:0}]],[[{x:0,z:4.5},{rot:360},{x:0,z:7.5},{rot:45},{x:4.5,z:12},{rot:90},{x:7.5,z:12},{rot:135},{x:12,z:7.5},{rot:180},{x:12,z:4.5},{rot:225},{x:7.5,z:0},{rot:270},{x:4.5,z:0},{rot:315}],[{x:12,z:7.5},{rot:180},{x:12,z:4.5},{rot:225},{x:7.5,z:0},{rot:270},{x:4.5,z:0},{rot:315},{x:0,z:4.5},{rot:360},{x:0,z:7.5},{rot:45},{x:4.5,z:12},{rot:90},{x:7.5,z:12},{rot:135}]],[[{x:6,z:3},{rot:0},{x:6,z:9},{rot:180}],[{x:12,z:0},{rot:0},{x:12,z:12},{rot:180}]],[[{x:6,z:6},{rot:90},{x:18,z:6},{rot:-90}],[{x:6,z:4.5},{rot:135},{x:11.5,z:0},{rot:45},{x:15,z:4.5},{rot:225},{x:11.5,z:0},{rot:315}]],[[{x:9,z:2},{rot:0},{x:9,z:4},{rot:180}]]],attnames=["probability","id","position","rotation","scale","class","color","width","height","opacity","src","repeat","animation","font","value","baseline","align","intensity","distance","depth","radius","open-ended","side","segments-height","segments-radial","theta-length","segments","segments-width","segments-tubular","radius-tubular","arc","gaze","raycaster","line","material","transparent"];function insideellipse(t,e,r,o,a,i){return!!(1>(t-a)*(t-a)/(r*r)+(e-i)*(e-i)/(o*o))}function nebulainside(t,e,r,o,a,i,n,l,u,s,d,c){var b=Math.round(1e3*Math.random()),p=Math.round(1e3*Math.random());if(insideellipse(b,p,n,l,o,a)){var y=Math.round(Math.random()*s),m=Math.round(Math.random()*t)+i,f=Math.round(Math.random()*e)+i,h=Math.round(Math.random()*r)+i;if(!c)c=Math.random()/u;d.fillStyle="rgba("+m+","+f+","+h+","+c+")",d.beginPath(),d.arc(b,p,y,0,2*Math.PI,!1),d.fill()}}function nebula(t,e,r,o,a,n,l){var u=document.getElementById("nebula").getContext("2d");for(i=0;1e3>i;i++)nebulainside(t,e,r,o,a,n,200,200,10,6,u,l);for(i=0;2e3>i;i++)nebulainside(t,e,r,o,a,n,150,150,5,3,u,l);for(i=0;2e3>i;i++)nebulainside(t,e,r,o,a,n,100,100,5,3,u,l);for(i=0;100>i;i++)nebulainside(t,e,r,o,a,n,50,50,10,50,u,l);for(i=0;100>i;i++)nebulainside(t,e,r,o,a,n,50,50,10,50,u,l)}function noise(t,e,r,o,a,n,l,u,s,d,c){for(i=0;i<=t;i++){var b=Math.round(Math.random()*e),p=Math.round(Math.random()*r),y=Math.round(2*Math.random()),m=Math.round(Math.random()*o)+l,f=Math.round(Math.random()*a)+u,h=Math.round(Math.random()*n)+s;c||(c=1),d.fillStyle="rgba("+m+","+f+","+h+","+c+")",d.beginPath(),d.arc(b,p,y,0,2*Math.PI,!1),d.fill()}}function buildStars(){var t=document.getElementById("stars").getContext("2d");t.fillStyle="rgba(0,0,0,255)",t.fillRect(0,0,1024,1024),noise(1e4,1024,1024,15,15,35,0,0,0,t);for(var e=document.getElementById("nebula"),r=e.getContext("2d"),o=0;10>o;o++){r.clearRect(0,0,1024,1024);for(var a=startY=512,i=1,n=Math.round(155*Math.random()),l=Math.round(155*Math.random()),u=Math.round(155*Math.random()),s=0;10>s;s++)nebula(n,l,u,a,startY,100,!1),a+=(i=Math.round(150*Math.random())-75)*(2*Math.random()-1),startY+=i*(2*Math.random()-1),950<a&&(a-=500),50>a&&(a=500),950<startY&&(startY=500),50>startY&&(startY=500);var d=Math.round(524*Math.random())-250,c=Math.round(524*Math.random())-250;t.drawImage(e,d,c)}noise(1e4,4096,4096,55,55,55,200,200,200,t)}function paintEarth(){document.getElementById("nebula");var t,e=document.getElementById("stars"),r=e.getContext("2d");(t=r.createLinearGradient(0,0,0,1e3)).addColorStop(0,"#fff"),t.addColorStop(.2,"#fff"),t.addColorStop(.3,"#233c75"),t.addColorStop(.8,"#233c75"),t.addColorStop(.9,"#fff"),r.fillStyle=t,r.fillRect(0,0,1024,1024),(t=r.createLinearGradient(0,0,0,1e3)).addColorStop(0,"#fff"),t.addColorStop(.25,"#fff"),t.addColorStop(.3,"#41561e"),t.addColorStop(.5,"#33441e"),t.addColorStop(.8,"#41561e"),t.addColorStop(1,"#fff"),r.fillStyle=t,r.font="1000px serif",r.textAlign="center",r.fillText("🗺",512,800),noise(1e4,1024,1024,255,255,255,0,0,0,r,.02),document.querySelector("#winplanet").setAttribute("src",e.toDataURL("image/png"))}function asteroids(){for(var t=-1;1>=t;t+=2)for(var e=1;5>=e;e++){var r=0>t?-2*e-5:2*e+20,o=10*Math.random()-5,a=35*Math.random()+10-2*e;buildEntity({type:"a-sphere",attributes:",asteroid"+e+"_"+t+","+r+" "+o+" "+a+",,"+(Math.random()+.5)+" "+(Math.random()+.5)+" "+(Math.random()+.5)+",,#111,,,,,,,,,,,,,,,,,4,,,,4"},document.querySelector("#a-scene")),document.querySelector("#asteroid"+e+"_"+t).setAttribute("animation","property:rotation;to:360 0 0;loop:true;dur:"+3e3*e+";easing:linear"),document.querySelector("#asteroid"+e+"_"+t).setAttribute("animation__2","property:position;from:"+r+" "+o+" "+a+";to:"+r+" "+o+" -50;loop:true;dur:"+1e4*e+";easing:linear")}}function buildFloor(){var t=document.getElementById("c128"),e=t.getContext("2d");for(e.fillStyle="rgba(157,157,157,1)",e.fillRect(0,0,128,128),noise(1e3,128,128,25,25,25,150,150,150,e),i=0;128>i;i+=64)e.strokeStyle="rgba(90,90,90,1)",e.beginPath(),e.moveTo(0,i),e.lineTo(i,0),e.stroke(),e.beginPath(),e.moveTo(128,i),e.lineTo(i,128),e.stroke(),e.strokeStyle="rgba(200,200,200,1)",e.beginPath(),e.moveTo(i,0),e.lineTo(128,128-i),e.stroke(),e.strokeStyle="rgba(50,50,50,1)",e.beginPath(),e.moveTo(i+2,0),e.lineTo(128,128-(i+2)),e.stroke(),e.strokeStyle="rgba(200,200,200,1)",e.beginPath(),e.moveTo(i,128),e.lineTo(0,128-i),e.stroke(),e.strokeStyle="rgba(50,50,50,1)",e.beginPath(),e.moveTo(i+2,128),e.lineTo(0,128-(i+2)),e.stroke();floorMat=t.toDataURL("image/png")}function buildHoloButton(t,e,r,o){buildEntity({type:"a-entity",attributes:",holobuttonparent,"+t+" "+e+" "+r+",0 "+o+" 0",children:[{type:"a-cylinder",attributes:",holobutton,,0 0 90,,button,#009,,.12,,,,,,,,,,,,.15",children:[{type:"a-text",attributes:",,0 .08 0,-90 270 0,.3 .3 .3,,,,,,,,,exo2semibold,HOLO\nBUDDY,,center"}]}]},document.querySelector("#ship"))}function holo(){document.querySelector("#holo")?document.querySelector("#holobuttonparent").removeChild(document.querySelector("#holo")):(zzfx(...[,.1,75,.03,.08,.17,1,1.88,7.83,,,,,.4]),buildEntity({type:"a-image",attributes:",holo,-1 .1 0,,,collidable,,1,2,.7,"+holoImage+",,property:rotation;from:0 0 -5;to:0 0 5;loop:true;dur:300;easing:linear;dir:alternate"},document.querySelector("#holobuttonparent")))}function buildMap(){var t=levels[level][0];start=levels[level][3].split(","),startX=parseInt(start[0]),startZ=parseInt(start[1]),rotY=parseInt(start[2]);var e=t.split(";");for(var r in gameMap=Array(e.length),gameMap2=Array(e.length),gameMap3=Array(e.length),e)cols=e[r].split(","),gameMap[r]=cols;for(var r in e=levels[level][1].split(";"))cols=e[r].split(","),gameMap2[r]=cols;for(var r in e=levels[level][2].split(";"))cols=e[r].split(","),gameMap3[r]=cols}function buildShip(){for(var t in gameMap)for(var e in gameMap[t])walls=gameMap[t][e],walls2=gameMap2[t][e],walls3=gameMap3[t][e],1&walls&&wall(3*e,1,3*t-1.45,270,"wn"+t+"_"+e),2&walls&&wall(1.45+3*e,1,3*t,180,"we"+t+"_"+e),4&walls&&wall(3*e,1,1.45+3*t,90,"ws"+t+"_"+e),8&walls&&wall(3*e-1.45,1,3*t,0,"ww"+t+"_"+e),16&walls&&windo(3*e,1,3*t-1.45,90,"win"+t+"_"+e),32&walls&&windo(1.45+3*e,1,3*t,0,"win"+t+"_"+e),64&walls&&windo(3*e,1,1.45+3*t,270,"win"+t+"_"+e),128&walls&&windo(3*e-1.45,1,3*t,180,"win"+t+"_"+e),1&walls2&&light(3*e,3*t),2&walls2&&cryo(1+3*e,.5,3*t,90),4&walls2&&cryo(3*e,.5,1+3*t,0),8&walls2&&layFloor(e,t),16&walls2&&buildEntity({type:"a-plane",attributes:",,"+3*e+" 2 "+3*t+",-270 0 0,,ceiling,#ccc,3,3"},document.querySelector("#ship")),32&walls2&&battery(1.1+3*e,.8,3*t),64&walls2&&dwall(3*e,1,3*t,-45),128&walls2&&dwall(3*e,1,3*t,45),1&walls3&&doorway(3*e,1,3*t-1.5,0),2&walls3&&doorway(3*e+1.5,1,3*t,90),4&walls3&&doorway(3*e,1,3*t+1.5,180),8&walls3&&doorway(3*e-1.5,1,3*t,270),16&walls3&&buildHoloButton(3*e,.7,3*t-1.4,90),32&walls3&&buildHoloButton(3*e+1.4,.7,3*t,0),64&walls3&&buildHoloButton(3*e,.7,3*t+1.4,-90),128&walls3&&buildHoloButton(3*e-1.4,.7,3*t,180);document.querySelector("#log").setAttribute("text","value:Time to wake up...")}function buildButtons(){var t=document.querySelectorAll(".button");for(e=0;e<t.length;e++)document.querySelector("#camera").removeChild(t[e]);var e=x=y=0;for(var r in levels)0==e%3&&(x=-.35,y-=.2),buildEntity({type:"a-plane",attributes:",level"+parseInt(r)+","+(.55*x-.35)+" "+(y-.2)+" -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,LEVEL "+(parseInt(r)+1)+",,center"}]},document.querySelector("#camera")),e++,x++}function layFloor(t,e){buildEntity({type:"a-box",attributes:",floor"+t+"_"+e+","+3*t+" 0 "+3*e+",0 0 0,,collidable,#666,3,.01,,,,,,,,,,,3"},document.querySelector("#ship")),document.querySelector("#floor"+t+"_"+e).setAttribute("src",floorMat),document.querySelector("#floor"+t+"_"+e).setAttribute("repeat","10 10")}function dwall(t,e,r,o){var a=document.createElement("a-entity");document.querySelector("#ship").appendChild(a),wall(0,0,0,0,"",a),a.setAttribute("scale","1 1 1.45"),a.setAttribute("position",t+" "+e+" "+r),a.setAttribute("rotation","0 "+o+" 0")}function cryo(t,e,r,o){buildEntity({type:"a-cylinder",attributes:",,"+t+" "+e+" "+r+",90 "+(o-90)+" 0,,,#77f,,2,.3,,,,,,,,,,,.5,false,double,,,220,,,,,180"},document.querySelector("#ship")),buildEntity({type:"a-box",attributes:",,"+t+" "+(e-.25)+" "+r+",0 "+(o+90)+" 0,,,#aaa,1.1,.5,,,,,,,,,,,2.1",children:[{type:"a-box",attributes:",,,,,,#eee,.9,.55,,,,,,,,,,,1.8,,,,,,,,,,,,,,,shader:flat"},{type:"a-text",attributes:",,.55 0 .4,0 90 0,,,,,,,,,,exo2semibold,CRYOPOD 003"}]},document.querySelector("#ship"))}function battery(t,e,r){buildEntity({type:"a-cylinder",attributes:",battery,"+t+" "+e+" "+r+",30 0 0,2 2 2,button,#33f,,.2,,"+batteryImage+",2 1,property:rotation;to:30 360 0;loop:true;dur:3000;easing:linear,,,,,,,,.05,false,,,12,,,,,,,,,,shader:flat",children:[{type:"a-cylinder",attributes:",batteryInner,0 .06 0,,,,#eee,,.1,,,,,,,,,,,,.03,false,,,12,,,,,,,,,,shader:flat"}]},document.querySelector("#ship"))}function doorway(t,e,r,o){buildEntity({type:"a-entity",attributes:",,"+t+" "+e+" "+r+",0 "+o+" 0",children:[{type:"a-box",attributes:",,1 0 0,,,collidable,,1,2,,,,,,,,,,,.15"},{type:"a-box",attributes:",,-1 0 0,,,collidable,,1,2,,,,,,,,,,,.15"},{type:"a-box",attributes:",,1 0 0,,,,#444,.8,1.6,,,,,,,,,,,.17"},{type:"a-box",attributes:",,-1 0 0,,,,#444,.8,1.6,,,,,,,,,,,.17"}]},document.querySelector("#ship"))}function light(t,e){var r=document.createElement("a-box");r.setAttribute("position",t+" 2 "+e),r.setAttribute("width",1),r.setAttribute("height",.05),r.setAttribute("depth",1),r.setAttribute("color","#fff"),r.setAttribute("material","shader:flat"),document.querySelector("#ship").appendChild(r);var o=document.createElement("a-light");o.setAttribute("type","point"),o.setAttribute("color","#fff"),o.setAttribute("intensity",1),o.setAttribute("distance",2.5),r.appendChild(o)}function escape(t,e,r){layFloor(t/3,r/3),buildEntity({type:"a-plane",attributes:",,"+t+" 2 "+r+",-270 0 0,,ceiling,#ccc,3,3"},document.querySelector("#ship")),wall(t,1,-1.45+r,270,"escaperoomn"),wall(t,1,1.45+r,90,"escaperooms"),windo(t+1.45,1,r,180,"escaperoomw"),light(t,r),transporter(t,0,r),document.querySelector("#game").components.game.data.teleporterPosition=t+" 0 "+r}function newgame(){document.querySelector("#title1").setAttribute("text","value:"),document.querySelector("#title2").setAttribute("text","value:"),document.querySelector("#title3").setAttribute("text","value:"),document.querySelector("#titles2").setAttribute("text","value:"),buildEntity({type:"a-text",attributes:",instructions,0 1 -10,0 0 0,,,#ffff82,,,,,,,exo2semibold,An emergency alert wakes you up from hibernation~ leaving you still partially paralyzed. Apparently~ the ship is going to explode any minute.\n\nGreat.\n\nEven better~ the malfunctioning NurseBots insist you stay in the medbay.\n\nSince you can't walk~ use your handy personal teleporter (HOLD AND RELEASE LEFT TRIGGER) to evade the bots~ and your kinetic beam (RIGHT TRIGGER) to interact~ and get to the evacuation transporter to get to the nearest safe location.,,center"},document.querySelector("#camera")),buildButtons()}function endGame(){done=!0,loaded=!1,zzfx(...[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6]),document.querySelector("#a-scene").removeChild(document.querySelector("#ship")),document.querySelector("#camera").removeChild(document.querySelector("#timerUI")),document.querySelector("#camera").removeChild(document.querySelector("#batteryParentUI")),document.querySelector("#rig").setAttribute("position","0 0 0"),document.querySelector("#title1").setAttribute("text","value:YOU DIED."),document.querySelector("#titles2").setAttribute("text","value:Your constituent particles have been converted directly to energy, in a very violent fashion."),done=!1,buildEntity({type:"a-plane",attributes:",level"+level+",0 -.25 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,TRY AGAIN,,center"}]},document.querySelector("#camera")),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera"))}function win(){done=!0,loaded=!1,zzfx(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07]),document.querySelector("#a-scene").removeChild(document.querySelector("#ship")),document.querySelector("#camera").removeChild(document.querySelector("#timerUI")),document.querySelector("#camera").removeChild(document.querySelector("#batteryParentUI")),document.querySelector("#rig").setAttribute("position","0 50 0"),4==level?(document.querySelector("#title1").setAttribute("text","value:HOME SWEET HOME!"),document.querySelector("#titles2").setAttribute("text","value:Well, somebody's home, at least. Hope this planet is friendly."),buildEntity({type:"a-sphere",attributes:",winplanet,1000 50 0,,50 50 50,,,,,,,,property:rotation;from:0 180 0;to:0 540 0;loop:true;dur:180000;easing:linear"},document.querySelector("#a-scene")),paintEarth(),document.querySelector("#winplanet").setAttribute("animation__2","property:position;to:120 50 0;dur:1000;"),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera"))):(document.querySelector("#title1").setAttribute("text","value:SAFE! ...right?"),document.querySelector("#titles2").setAttribute("text","value:You have 'ported to another ship. Hope there are no NurseBots..."),buildEntity({type:"a-plane",attributes:",level"+(level+1)+",0 -.25 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,NEXT,,center"}]},document.querySelector("#camera")),buildEntity({type:"a-plane",attributes:",home,0 -.4 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,HOME,,center"}]},document.querySelector("#camera")))}function openDoor(){document.querySelector("#innerdoor").setAttribute("animation","property:position;to:0 3 0;loop:false;dur:1000;easing:linear")}function buildEntity(t,e){var r=document.createElement(t.type);"a-light"==t.type&&r.setAttribute("type","point");var o=t.attributes.split(",");if(!o[0]||shouldAddEntity(o[0])){for(i=1;i<o.length;i++)o[i]&&(r.setAttribute(attnames[i],o[i].replace(/~/g,",")),"class"==attnames[i]&&r.setAttribute(o[i],""));for(child in e.appendChild(r),t.children)buildEntity(t.children[child],r)}}function transporter(t,e,r){buildEntity({type:"a-torus",attributes:",transporterBase,"+t+" "+e+" "+r+",90 0 0,,,,,,,,,,,,,,,,,.6,,,,,,,,,.01"},document.querySelector("#ship"));var o=document.getElementById("gradient"),a=o.getContext("2d"),i=a.createLinearGradient(0,0,0,1024);i.addColorStop(.1,"rgba(22,22,255,1)"),i.addColorStop(.8,"rgba(255,255,255,0"),a.fillStyle=i,a.fillRect(0,0,1024,1024);var n=o.toDataURL("image/png");buildEntity({type:"a-cylinder",attributes:",transporter,"+t+" "+(e+1)+" "+r+",180 0 0,,,,,2,,,,,,,,,,,,.6,true,double,,,,,,,,,,,,shader:flat,true"},document.querySelector("#ship")),document.querySelector("#transporter").setAttribute("src",n)}function buildBot(t,e,r){buildEntity({type:"a-entity",attributes:",robot"+t+","+e+" 0 "+r+",0 180 0,,robot",children:[{type:"a-entity",attributes:",robotrot"+t+",0 .6 0",children:[{type:"a-cylinder",attributes:",,0 0 0,,,,#fff,,1,,,,,,,,,,,,.3,,,12"},{type:"a-cylinder",attributes:",,0 .5 0,,,,#000,,.02,,,,,,,,,,,,.31,true,double"},{type:"a-cylinder",attributes:",,0 -.5 0,,,,#000,,.02,,,,,,,,,,,,.31,true,double"},{type:"a-box",attributes:",,0 .65 0,,.1 .3 .1,,#00f"},{type:"a-box",attributes:",,0 .25 -.22,,.3 .45 .3,,#00f"},{type:"a-box",attributes:",,0 .25 .25,,.1 .3 .1,,#f00"},{type:"a-box",attributes:",,0 .25 .25,,.3 .1 .1,,#f00"}]}]},document.querySelector("#ship")),buildEntity({type:"a-entity",attributes:",headrobot"+t+",0 .8 0,,,,,,,,,,property:rotation;from:0 -15 0;to:0 15 0;loop:true;dur:1000;easing:linear;dir:alternate;pauseEvents:foundPlayer;resumeEvents:fired",children:[{type:"a-sphere",attributes:",eyerobot"+t+",0 .03 .22,,,,#fff,,,,,,,,,,,,,,.07,,8,,,,8,,,,,,,,shader:flat",children:[{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:0 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:.3 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:-.3 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:.7 0 1,opacity:.0"},{type:"a-entity",attributes:",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,event:foundPlayer~fired,objects:.collidable;showLine:true;direction:-.7 0 1,opacity:.0"}]},{type:"a-cylinder",attributes:",,0 0 0,0 45 0,,,#fff,,.3,,,,,,,,,,,,.25,,double,,12"},{type:"a-cylinder",attributes:",,0 0 0,0 45 0,,,#f00,,.2,,,,,,,,,,,,.26,true,double,,12"},{type:"a-cylinder",attributes:",,0 .15 0,0 45 0,,,#000,,.02,,,,,,,,,,,,.26,true,double,,12"},{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,#000,,.02,,,,,,,,,,,,.26,true,double,,12"}]},document.querySelector("#robotrot"+t)),buildEntity({type:"a-sphere",attributes:",leftarm,.35 .4 0,-30 0 0,,,#000,,,,,,property:rotation;from:0 0 0;to:30 0 0;loop:true;dur:1000;easing:linear;dir:alternate,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.06,,,,6"},{type:"a-sphere",attributes:",,0 -.3 0,-30 0 0,,,#000,,,,,,,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.04,,,,6",children:[{type:"a-cylinder",attributes:",,0 -.16 0,90 -45 -45,1.6 1 1.5,,#fff,,.08,,,,,,,,,,,,.04,,double,,5,300"}]}]}]},document.querySelector("#robotrot"+t)),buildEntity({type:"a-sphere",attributes:",rightarm,-.35 .4 0,-30 0 0,,,#000,,,,,,property:rotation;from:30 0 0;to:0 0 0;loop:true;dur:1000;easing:linear;dir:alternate,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.06,,,,6"},{type:"a-sphere",attributes:",,0 -.3 0,-30 0 0,,,#000,,,,,,,,,,,,,,.07,,,8,,,,8",children:[{type:"a-cylinder",attributes:",,0 -.15 0,0 45 0,,,,,.3,,,,,,,,,,,,.04,,,,6",children:[{type:"a-cylinder",attributes:",,0 -.16 0,90 45 -45,1.6 1 1.5,,#fff,,.08,,,,,,,,,,,,.04,,double,,5,300"}]}]}]},document.querySelector("#robotrot"+t));var o=document.createElement("a-light");document.querySelector("#eyerobot"+t).appendChild(o),o.setAttribute("id","botlightrobot"+t),o.setAttribute("position","0 -.2 1"),o.setAttribute("intensity",.5),o.setAttribute("type","point"),o.setAttribute("color","#fff"),o.setAttribute("distance",2)}function draw(){var t=document.getElementById("holocanvas"),e=t.getContext("2d");e.font="300px serif",e.textAlign="center",e.fillText("🙋🏽‍♀️",300,400),holoImage=t.toDataURL("image/png").replace(/,/g,"~"),e.fillStyle="#33f",e.fillRect(0,0,600,1200),e.fillText("⚡",300,600),batteryImage=t.toDataURL("image/png").replace(/,/g,"~")}function bits(){for(var t in botPaths[level])buildBot(t,botPaths[level][t][0].x,botPaths[level][t][0].z);startPos=levels[level][3].split(","),exitPos=levels[level][4].split(","),doorX=3*exitPos[0],doorZ=3*exitPos[1],door(doorX-1.5,1,doorZ,0),escape(doorX,0,doorZ)}function door(t,e,r,o){buildEntity({type:"a-entity",attributes:",door,"+t+" "+e+" "+r+",0 "+o+" 0",children:[{type:"a-box",attributes:",,0 0 1.2,,,collidable,#fff,.2,2,,,,,,,,,,,.6"},{type:"a-box",attributes:",,0 0 -1.2,,,collidable,#fff,.2,2,,,,,,,,,,,.6"}]},document.querySelector("#ship")),buildEntity({type:"a-entity",attributes:",innerdoor,,,,door",children:[{type:"a-cylinder",attributes:",hitbox,-.01 0 .75,0 0 90,,button,#900,,.12,,,,,,,,,,,,.15",children:[{type:"a-text",attributes:",,.02 .07 -.12,-90 270 0,.4 .4 .4,,,,,,,,,exo2semibold,OPEN"}]},{type:"a-box",attributes:",,0 0 .8,,,,#999,.08,2,,,,,,,,,,,.5"},{type:"a-box",attributes:",,0 0 -.8,,,,#999,.08,2,,,,,,,,,,,.5"},{type:"a-box",attributes:",,0 .9 0,,,,#999,.08,.2,,,,,,,,,,,1.4"},{type:"a-box",attributes:",,0 -.8 0,,,,#999,.08,.5,,,,,,,,,,,1.4"},{type:"a-plane",attributes:",,0 .2 0,180 90 0,,collidable,#00f,1.4,1.5,.8,,,,,,,,,,,,,double,,,,,,,,,,,,,true"},{type:"a-text",attributes:",,-.01 .5 0,0 270 0,2 2.5 2,,#fff,3,,,,,,exo2semibold,EXIT,top,center"}]},document.querySelector("#door"))}function windo(t,e,r,o,a){buildEntity({type:"a-entity",attributes:","+a+","+t+" "+e+" "+r+",0 "+o+" 0",children:[{type:"a-plane",attributes:",,,0 90 0,,collidable,,3,2,.1,,,,,,,,,,,,,double"},{type:"a-box",attributes:",,0 .9 0,,,,#fff,.2,.2,,,,,,,,,,,3"},{type:"a-cylinder",attributes:".5,,0 .68 .75,22.5 0 90,,,#999,,.22,,,,,,,,,,,,.1,,,,8"},{type:"a-box",attributes:",,0 -1 0,,,,#fff,.2,1,,,,,,,,,,,3"},{type:"a-box",attributes:",,0 0 1.2,,,,#fff,.2,2,,,,,,,,,,,.7"},{type:"a-box",attributes:",,0 0 -1.2,,,,#fff,.2,2,,,,,,,,,,,.7"},{type:"a-box",attributes:",,0 .8 .65,45 0 0,,,#fff,.2,.3,,,,,,,,,,,2"},{type:"a-box",attributes:",,0 -.7 -.5,45 0 0,,,#fff,.2,.3,,,,,,,,,,,2"},{type:"a-torus",attributes:",,0 .1 0,0 90 0,,,#999,,,,,,,,,,,,,,.5,,,,4,,,,6,.01,360"},{type:"a-cylinder",attributes:",,0 .1 .7,0 90 90,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 .1 -.7,0 90 90,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 .74 0,0 90 0,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-cylinder",attributes:",,0 -.54 0,0 90 0,,,#999,,.4,,,,,,,,,,,,.015,,,,6"},{type:"a-plane",attributes:".5,,-.102 0 -1.05,0 270 0,,,#999,.1,1.55"},{type:"a-plane",attributes:",,-.102 -.725 -.12,0 270 0,,,#999,1.95,.1"}]},document.querySelector("#ship"))}function shouldAddEntity(t){return Math.random()>=t}function wall(t,e,r,o,a,i){i||(i=document.querySelector("#ship")),buildEntity({type:"a-box",attributes:","+a+","+t+" "+e+" "+r+",0 "+o+" 0,,collidable,,.1,2,,,,,,,,,,,3",children:[{type:"a-plane",attributes:".5,,.055 0 .3,0 90 0,,,#444,.3,2"},{type:"a-plane",attributes:".5,,.055 0 .6,0 90 0,,,#444,.1,2"},{type:"a-plane",attributes:".5,,.055 0 .9,0 90 0,,,#444,.3,2"},{type:"a-cylinder",attributes:".5,,0 .83 0,0 90 90,,,#005,,3.01,,,,,,,,,,,,.065,,,,8",children:[{type:"a-cylinder",attributes:",,0 -1.2 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"},{type:"a-cylinder",attributes:",,0 1.3 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"},{type:"a-cylinder",attributes:",,0 1.1 0,,,,#222,,.1,,,,,,,,,,,,.07,,,,8"}]},{type:"a-cylinder",attributes:".5,,0 -.75 0,0 90 90,,,#66F,,3.01,,,,,,,,,,,,.12,,,,8",children:[{type:"a-cylinder",attributes:",,0 -1 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"},{type:"a-cylinder",attributes:",,0 0 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"},{type:"a-cylinder",attributes:",,0 1.1 0,,,,#222,,.1,,,,,,,,,,,,.13,,,,8"}]},{type:"a-box",attributes:".5,,0 -.25 -.5,,,,#C99,.12,.2,,,,,,,,,,,.8"},{type:"a-box",attributes:".5,,0 -.45 -.5,,,,#9c9,.12,.2,,,,,,,,,,,.8"},{type:"a-box",attributes:".5,,0 .27 0,,,,#000,.15,.7,,,,,,,,,,,2.5",children:[{type:"a-text",attributes:",,.08 0 1.2,0 90 0,,wallscreen,#f00,3,,,,,,exo2semibold,,top"}]}]},i)}function getVol(t){var e=document.querySelector("#eye"+t),r=new THREE.Vector3;e.object3D.getWorldPosition(r);var o=document.querySelector("#camera");return dx=r.x-o.object3D.position.x,dz=r.z-o.object3D.position.z,dh=Math.sqrt(dx*dx+dz*dz),1/dh}function teleport(){if("player"==currenttarget){var t=document.querySelector("#"+currenttarget).parentEl.parentEl;document.querySelector("#transporter").setAttribute("position",t.object3D.position.x+" 1 "+t.object3D.position.z),setTimeout(finishTeleport,150)}else if("holo"==currenttarget){t=document.querySelector("#"+currenttarget);var e=new THREE.Vector3;t.object3D.getWorldPosition(e),document.querySelector("#transporter").setAttribute("position",e.x+" 1 "+e.z),setTimeout(finishTeleport,150)}}function finishTeleport(){"player"==currenttarget&&document.querySelector("#rig").setAttribute("position",3*startX+" 0 "+3*startZ);var t=document.querySelector("#transporterBase");document.querySelector("#transporter").setAttribute("position",t.object3D.position.x+" 1 "+t.object3D.position.z)}function fireSound(t){zzfx(...[getVol(t),0,214,.01,.01,.5,4,.6,-.1,1,,,.05,.1,3,,.13,1.28,.05]),setTimeout(teleport,100)}function laser(t){var e=document.querySelector("#eye"+t);e.setAttribute("color","#99F"),document.querySelector("#botlight"+t).setAttribute("color","#99F");var r=new THREE.Vector3;e.object3D.getWorldPosition(r);var o=document.querySelector("#"+currenttarget),a=new THREE.Vector3;o.object3D.getWorldPosition(a);var i=document.createElement("a-entity");i.setAttribute("line",{start:r.x+" "+r.y+" "+r.z,end:a.x+" 1 "+a.z,color:"blue"}),i.setAttribute("id","laser"+t),document.querySelector("#a-scene").appendChild(i),setTimeout((function(){endLaser(t)}),100)}function endLaser(t){(el=document.querySelector("#laser"+t),el)&&(document.querySelector("#eye"+t).setAttribute("color","white"),document.querySelector("#botlight"+t).setAttribute("color","#fff"),el.parentNode.removeChild(el))}function fire(t){fireSound(t),laser(t);var e=document.querySelector("#"+t);e.emit("fired",{},!0);var r=document.querySelector("#head"+t);r.emit("fired",{},!1),r.removeAttribute("animation__vibrate"),e.removeEventListener("animationcomplete__vibrate",fireListener[t]),firing=!1}function warmUp(t){if(!firing){firing=!0,zzfx(...[getVol(t),0,24,1,.27,.05,2,,,8.2,20,.08,.12,,.05,,,.97,.05]);var e=document.querySelector("#head"+t);elPos=e.object3D.position,e.setAttribute("animation__vibrate",{property:"position",from:elPos.x+" .78 "+elPos.z,to:elPos.x+" .8 "+elPos.z,loop:17,dur:100}),e.addEventListener("animationcomplete__vibrate",fireListener[t]=function(){fire(t)})}}function getJunk(){if(""==junk)for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\t\t\t ",e=0;18>=e;e++){for(var r=0;r<400*Math.random()+10;r++)junk+=t.charAt(Math.floor(66*Math.random()));junk+="\n"}return junk}function distance(t,e){var r=t.x-e.x,o=t.z-e.z;return Math.round(100*Math.sqrt(r*r+o*o))/100-.25}function hitPlayer(t,e){return distance(document.querySelector("#rig").object3D.position,t)<=Math.round(100*e.z)/100}function loadLevel(t){if(!loaded){var e=document.querySelectorAll(".button");for(i=0;i<e.length;i++)document.querySelector("#camera").removeChild(e[i]);loaded=!0;var r=document.createElement("a-entity");r.setAttribute("id","ship"),document.querySelector("#a-scene").appendChild(r),document.querySelector("#log").setAttribute("text","value:LOADING..."),level=t,buildMap(),buildShip(),bits(),document.querySelector("#leftController").setAttribute("teleport-controls","button:trigger;objects:.collidable,.floor;cameraRig:#rig"),document.querySelector("#title1").setAttribute("text","value:"),document.querySelector("#title2").setAttribute("text","value:"),document.querySelector("#title3").setAttribute("text","value:"),document.querySelector("#titles2").setAttribute("text","value:"),document.querySelector("#rig").setAttribute("position",3*startX+" 0 "+3*startZ),document.querySelector("#rig").setAttribute("rotation","0 "+rotY+" 0"),buildEntity({type:"a-text",attributes:",batteryParentUI,-.3 .15 -.6,,.2 .2 .2,,,,,.7,,,,exo2semibold,BATTERY",children:[{type:"a-plane",attributes:",,1.5 -.04 -.01,,,,#fff,1,.15,.4,,,,,,,,,,,,,,,,,,,,,,,,,shader:flat"},{type:"a-plane",attributes:",batteryUI,1.5 -.04 0,,,,#ff0,1,.15,.8,,,,,,,,,,,,,,,,,,,,,,,,,shader:flat"}]},document.querySelector("#camera")),buildEntity({type:"a-text",attributes:",timerUI,.2 .15 -.6,,.2 .2 .2,timer,,,,.7,,,,exo2semibold,1:30"},document.querySelector("#camera")),document.querySelector("#game").components.game.data.battery=100,document.querySelector("#game").components.game.data.batteryUI=document.querySelector("#batteryUI"),document.querySelector("#game").components.game.data.batteryParentUI=document.querySelector("#batteryParentUI"),document.querySelector("#log").setAttribute("text","value:"),shiphum()}}AFRAME.registerComponent("timer",{schema:{lastTime:{type:"float"},timeLeft:{type:"int",default:90},ui:{type:"selector"}},init:function(){var t=this.el;this.data.ui=t,this.data.lastTime=Math.floor(Date.now()/1e3)},tick:function(){var t=Math.floor(Date.now()/1e3);if(t>this.data.lastTime){var e=this.data.timeLeft-(t-this.data.lastTime);10>=e&&this.data.ui.setAttribute("color","#f00"),this.data.timeLeft=e,0>e&&!done&&endGame(),this.data.lastTime=t;var r=Math.floor(e/60),o=e%60;10>o&&(o="0"+o),document.querySelector("#game").components.game.data.battery+=5,this.data.ui.setAttribute("value",r+":"+o)}}}),AFRAME.registerComponent("button",{schema:{id:{type:"string"},level:{type:"int"}},init:function(){var t=this.el;"newgame"==t.getAttribute("id")?t.addEventListener("click",(function(){document.querySelector("#camera").removeChild(document.querySelector("#newgame")),newgame()})):"holobutton"==t.getAttribute("id")?t.addEventListener("click",(function(){holo()})):"hitbox"==t.getAttribute("id")?t.addEventListener("click",(function(){openDoor()})):"home"==t.getAttribute("id")?t.addEventListener("click",(function(){newgame()})):"battery"==t.getAttribute("id")?t.addEventListener("click",(function(){document.querySelector("#game").components.game.data.battery=100,document.querySelector("#ship").removeChild(document.querySelector("#battery"))})):(this.data.level=parseInt(t.getAttribute("id").replace(/level/,"")),t.addEventListener("click",(function(){document.querySelector("#instructions")&&document.querySelector("#camera").removeChild(document.querySelector("#instructions")),loadLevel(t.components.button.data.level)})))}}),AFRAME.registerComponent("game",{schema:{timer:{type:"int",default:0},battery:{default:100},batteryUI:{type:"selector"},batteryParentUI:{type:"selector"},teleporterPosition:{type:"vec3"}},init:function(){draw(),buildStars(),asteroids(),buildFloor(),buildEntity({type:"a-plane",attributes:",newgame,0 -.3 -2,,,button,#ff2,.5,.1,.5",children:[{type:"a-text",attributes:",,0 .015 .02,,.3 .3 .3,,,,,,,,,exo2semibold,NEW GAME,,center"}]},document.querySelector("#camera")),this.data.battery=100;var t=document.getElementById("stars"),e=(t.getContext("2d"),t.toDataURL("image/png"));document.querySelector("#image-360").setAttribute("src",e),document.querySelector("#image-360").setAttribute("repeat","4 4")},tick:function(){100<this.data.battery&&(this.data.battery=100),null!=this.data.batteryUI&&(this.data.batteryUI.setAttribute("scale",this.data.battery/100+" 1 1"),this.data.batteryUI.setAttribute("position",1+this.data.battery/100/2+" "+this.data.batteryUI.object3D.position.y+" "+this.data.batteryUI.object3D.position.z))}}),AFRAME.registerComponent("robot",{schema:{posX:{type:"number",default:0},posZ:{type:"number",default:1},dead:{type:"bool",default:!1},path:{type:"array"},step:{type:"int",default:-1},speed:{type:"int",default:1e3},timer:{type:"int",default:0}},init:function(){var t=this.el;this.data.path=botPaths[level][t.id.replace(/robot/,"")],this.step=-1,this.takeNextStep(t)},tick:function(){this.data.timer++,100<=this.data.timer&&this.el.setAttribute("visible",!1),80<=this.data.timer&&(this.el.setAttribute("visible",!0),this.data.timer=0)},takeNextStep:function(t){t.components.robot.data.step++,t.components.robot.data.step>=t.components.robot.data.path.length&&(t.components.robot.data.step=0);var e=t.components.robot.data.path[t.components.robot.data.step];null==e.rot?t.components.robot.moveTo(e.x,e.z,t):t.components.robot.turnTo(e.rot,t)},turnTo:function(t,e){e.components.robot.data.dead||(robotX=parseInt(Math.round(e.getAttribute("position").x/3)),robotZ=parseInt(Math.round(e.getAttribute("position").z/3)),e.removeAttribute("animation__moveTo"),e.removeEventListener("animationcomplete__moveTo",nextMove[e.id]),e.setAttribute("animation__turnTo",{pauseEvents:"foundPlayer",resumeEvents:"fired",property:"rotation",to:"0 "+t+" 0",loop:!1,dur:e.components.robot.data.speed,easing:"linear"}),e.addEventListener("animationcomplete__turnTo",nextTurn[e.id]=function(){360==Math.round(180*e.object3D.rotation.y/Math.PI)&&(e.object3D.rotation.y=0),-360==Math.round(180*e.object3D.rotation.y/Math.PI)&&(e.object3D.rotation.y=0),e.components.robot.takeNextStep(e)}))},moveTo:function(t,e,r){if(!r.components.robot.data.dead){var o=Math.abs(t-r.getAttribute("position").x),a=Math.abs(e-r.getAttribute("position").z),i=Math.max(o,a);r.removeAttribute("animation__turnTo"),r.removeEventListener("animationcomplete__turnTo",nextTurn[r.id]),r.setAttribute("animation__moveTo",{pauseEvents:"foundPlayer",resumeEvents:"fired",property:"position",to:t+" 0 "+e,loop:!1,dur:i*r.components.robot.data.speed,easing:"linear"}),r.addEventListener("animationcomplete__moveTo",nextMove[r.id]=function(){r.components.robot.takeNextStep(r)})}}}),AFRAME.registerComponent("wallscreen",{schema:{timer:{type:"int",default:0},flash:{type:"bool",default:!0}},init:function(){var t=this.el;0==Math.round(2*Math.random())%2?(t.setAttribute("position",".08 .1 1.2"),t.setAttribute("value","EMERGENCY ALERT"),t.setAttribute("color","red"),t.setAttribute("scale","2 2 2")):(this.data.flash=!1,t.setAttribute("position",".08 .33 1.2"),t.setAttribute("value",getJunk()),t.setAttribute("color","white"),t.setAttribute("scale","2 2 2"),t.setAttribute("wrap-count",400))},tick:function(){var t=this.el;this.data.timer++,this.data.flash&&(50<=this.data.timer&&t.setAttribute("visible",!1),80<=this.data.timer&&(t.setAttribute("visible",!0),this.data.timer=0))}}),AFRAME.registerComponent("gaze",{dependencies:["raycaster"],schema:{robot:{type:"selector"},so:{type:"selector"}},init:function(){this.data.robot=this.el.parentEl.parentEl.parentEl.parentEl,this.el.addEventListener("raycaster-intersection",(function(t){var e=t.srcElement.parentEl.parentEl.parentEl.parentEl;"player"!=t.detail.intersections[0].object.el.id&&"holo"!=t.detail.intersections[0].object.el.id||firing||e.components.robot.data.dead||!hitPlayer(e.object3D.position,t.composedPath()[0].components.line.attrValue.end)||(this.so=t.detail.intersections[0].object.el.id,currenttarget=this.so,ss(Math.floor(5*Math.random()),e.id),warmUp(e.id),e.emit("foundPlayer",{},!0),document.querySelector("#head"+e.id).emit("foundPlayer",{},!1))})),this.el.addEventListener("raycaster-intersection-cleared",(function(){this.so&&(this.so=null)}))}})</script><body bgcolor=#000 id=body><canvas id=stars style=display:none height=1024 width=1024></canvas><canvas id=nebula style=display:none height=1024 width=1024></canvas><canvas id=gradient style=display:none height=1024 width=1024></canvas><canvas id=holocanvas style=display:none width=600 height=1200></canvas><canvas id=c128 style=display:none width=128 height=128></canvas><a-scene id=a-scene background=color:#000 antialias=true><a-entity id=game game></a-entity><a-entity id=ambient light=type:ambient;color:#fff;intensity:.2></a-entity><a-entity light=type:directional;color:#fff;intensity:.5 rotation="-90 10 0"></a-entity><a-sky id=image-360 radius=360 phi-start=140 segments-width=32 segments-height=10></a-sky><a-entity id=rig camerarig position="0 0 0" rotation="0 90 0"><a-entity camera id=camera wasd-controls=acceleration:150 look-controls="reverseMouseDrag: false" position="0 1.4 0"><a-cylinder class=collidable height=2 visible=true position="0 1 0" id=player radius=.15></a-cylinder><a-plane position="0 0 -20" rotation="0 0 0" width=100 height=100 opacity=0></a-plane><a-entity position="0 .3 -100" id=title1 color=#ffff82 text=font:exo2semibold;align:center;value:HUMAN scale="3 3 3" animation="property:position;to:0 .3 -2;dur:2000"></a-entity><a-entity position="0 .19 -100" id=title2 color=#ffff82 text=font:exo2semibold;align:center;value:NOT scale="2 2 2" animation="property:position;to:0 .19 -2;dur:2000"></a-entity><a-entity position="0 .1 -100" id=title3 color=#ffff82 text=font:exo2semibold;align:center;value:FOUND scale="3 3 3" animation="property:position;to:0 .1 -2;dur:2000"></a-entity><a-entity position="0 -.09 -100" id=titles2 color=#ffff82 text="wrap-count:60;font:exo2semibold;align:center;value:An exploding ship. Crazy NurseBots. And to top it off, you're paralyzed.\n\nWell, great." scale="2 2 2" animation="property:position;to:0 -.09 -2;dur:2500"></a-entity><a-entity position="0 -.2 -.6" id=log text=font:exo2semibold;value:;align:center></a-entity></a-entity><a-entity id=leftController static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: left" vive-controls="hand: left" tracked-controls=""></a-entity><a-entity id=rightController static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: right" vive-controls="hand: right" tracked-controls=button:trigger;objects:.button; laser-controls=objects:.button raycaster=far:23></a-entity></a-entity></a-scene>