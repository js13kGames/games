<!doctype html><title>13th oF fAmE - js13kGames 2012</title><style>*{margin:0;padding:0;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}body,html{width:100%;background:#000;overflow:hidden}.arcadeText{position:absolute;z-index:10;font-family:courier,sans-serif;color:#fff;font-size:24px;top:16px;font-weight:700}#msg-text{background-color:#42362a;text-align:center;font-size:22px}.lnk-txt{display:block;cursor:pointer}.lnk-txt:hover{color:#00f}#jail{right:32px}#ship{right:162px}#container{height:272px;width:384px;position:relative;margin:50px auto;margin-bottom:0}#container div{position:absolute}#game{background-color:#e4b34d;height:272px;width:384px;overflow:hidden}#knight_sprite{position:absolute;overflow:hidden}.mapsprite{position:absolute;overflow:hidden}.stripe{overflow:hidden;width:100%;height:2%;position:absolute}</style><div id=colors></div><div id=container><div id=game></div></div><script>function n(){x={pal:["","000","FFF","9f9f9f","31302f","f00","42362a","9d986e","645c51","271d13","E4B34D","A8751A","D4A03B","A1F8F6","0078F8","CBCBCB"],tiles:[[[3,1,0,0],"17002103f0107f010bf010ff0171011f002134021b40213c021bc02178021f802"],[[6,7,8,0],s="100f02010e153a0254012351023609"],[[6,7,8,0],s,!0],[[6,7,8,9],s="2000f2300933a1025a0135ca031fe0"],[[6,7,8,9],s,!0],[[6,7,8,0],"100f0103f0"],[[6,7,8,9],"30ff030cf0"],[[7,6,4,0],"1000f1300f1600f1900f1c00f1f00f2111121d112d711"],[[10,14,13,0],"130cb2101123211214132381123a3126a1128c112aa312dc21"],[[10,14,13,0],"100fb20c1122a312681128a1106a112ac312ea11"],[[10,14,13,0],"130cf21e1123a132581123611038112121323011"],[[10,2,11,16],"2422023310273302241029430215102b510216042c711"],[[10,14,13,0],"100ff"],[[10,11,12,0],"13100142001b40023600276002d600259001990013a0027b001cc0015d002cd10"],[[0,1,0,0],"100ff"],[[7,6,4,0],"1000f1300f1600f1900f1c00f1f00f"],[[0,2,3,4],"2685514077362513841130568268711e8112e01736a113aa1135e113ae11"],[[0,5,3,4],"25045241032a1033534037401356402476425c4135e1138e113370634c013ac013b8053c90416820179001590216a201990217b0016c20"],[[14,7,6,2],"110e1122d0143b01649018573198631ac501bd411cf30210e0243602b4402c5002d601298302e8002d9202ce202ff00"],[[14,7,6,2],"100ff20050270812d2002e3002f40020420235b02092023a3027b802cc002dd002ee0120f20"],[[14,7,6,2],"100ff200a22b14120500216e020bf0"],[[14,7,6,2],"100ff210e0201f0202b02e2002f301235c0206202270023800249002f90020af02fe0029f50"],[[14,7,6,2],"100f5106e1108d0109c110bb010ca010d9010e7010f60200f0201902f300224d0205102e60129840209802c90120b002bb0021c102ac0023d6020e3027e0026f00"],[[14,7,6,2],"200e0101c02d1001024025200203302041020500"],[[14,7,6,2],"21be011ce011d0222d0216d0227d021cd022dd02"],[[14,7,6,2],"20b7010c6011d0222d0216d0227c033b0443c5331c8201f900"],[[14,7,6,2],"3007938207396033a8023ba001094015a401ab101c02f1bd022f0061f709"],[[14,7,6,2],"340b0351a2344b1336c033780328703296031a0033a3031b102070410c0311c1021d0213b4018a401d920"],[[14,7,6,2],"3004635105363033750134730187102a7001384010920"],[[14,7,6,2],"3fa053eb043dd023cf00"],[[14,7,6,2],"1c1072d10715730196601c9162e9063972035850309a030a9130c8130e713e7103f800"],[[14,7,6,2],"11540106003166030790308b0309d032ad033bc234eb1"],[[14,7,6,2],"30b0431c1333d0234f00"],[[0,13,2,1],s="239c6157a0138c01293012a1011b2011c133fb0438b14"],[[0,13,2,1],s,!0],[[0,13,2,1],s="230c611013114201251012630137c0158a03f0013f3013801138311"],[[0,13,2,1],s,!0]],scene:[[["2666666666666666666666634777777777777777777777751000ee00000000e0bdddddd110e00e000e000e00bduvwxd11000c000000e0c0ebpqrstd11000e0000e000000bjkgmno110e00000000000009aagaaa1100000c0cccc0e0000000e0110000cc0000c000e0e0000011c0000c0cccc000c000e000110e000c0000c0000e00c00e1100000c0cccc0000000e0001100e0000e000e000e0000001100000e0000000c00011811110e0000000e00e00001ffff11000e000000c000e001ffff1111111111111111111111111"]]],strings:{splash:"The myth tells us that on Friday, 13 October 1307, the Knights Templar were arrested, charged with heresy, immorality and abuses. The fear of Friday the 13th was born.<br/><br/>Save 13 knights from jail, and help them to board the ship to a new world.<span id='btn-play' class='lnk-txt' style='margin-top:"+64*p.pixelSize+"px;' title='Press me to play!'>load\"*\",8,1</span>",over:"You loose!<br/><br/>Oh, forever unlucky Friday the 13th!<span id='btn-play' class='lnk-txt' style='margin-top:"+128*p.pixelSize+"px;'>Play again</span>",win:"You win!<br/><br/>You saved the World from Friday the 13th curse!<span id='btn-play' class='lnk-txt' style='margin-top:"+80*p.pixelSize+"px;'>Play again</span>"},spriteHTML:[],curScene:-1,coins:0,mapHTML:"",keys:[],interval:x&&x.interval||0,size:16*p.pixelSize,knights:[],enemies:[],numEnemies:x&&x.numEnemies||5,kJailed:0,kShipped:0,activeScene:"SPLASH"};for(var e=0;e<x.tiles.length;e++)for(var t=0,i=x.tiles[e][1]+"";t<i.split("").length;)x.spriteHTML[e]=(x.spriteHTML[e]||"<div style='width:"+x.size+"px; height:"+x.size+"px;"+(""!==x.pal[x.tiles[e][0][0]]?"background-color:#"+x.pal[x.tiles[e][0][0]]:"")+"' >")+(""!==x.tiles[e][0][parseInt(i[t],16)]?"<div style='left:"+(x.tiles[e][2]?16-parseInt(i[t+1],16)-(parseInt(i[t+3],16)+1):parseInt(i[t+1],16))*p.pixelSize+"px;top:"+parseInt(i[t+2],16)*p.pixelSize+"px;width:"+(parseInt(i[t+3],16)+1)*p.pixelSize+"px;height:"+(parseInt(i[t+4],16)+1)*p.pixelSize+"px;background-color:#"+x.pal[x.tiles[e][0][parseInt(i[t],16)]]+";overflow:hidden;'></div>":"")+((t+=5)>=i.length?"</div>":"");return x}function t(e,t){for(var i,s=0;s<x.map.length;s++)if("0"!==(i=x.map[s].split(""))[24*Math.floor(t/x.size)+Math.floor(e/x.size)]&&parseInt(i[24*Math.floor(t/x.size)+Math.floor(e/x.size)],16)<13)return 1}function h(e,t){return(t=t||document).querySelector(e)}function a(e){return this.id=e.id,this.enemy=e.enemy||!1,this.start=e.start,this.mov=e.enemy?{x:1,y:1}:{x:0,y:0},this.oldPos={x:0,y:0},this.newPos={x:0,y:0},this.dirX=1,this.html=e.html,this.state=e.state||"A",this.element=null,this.draw=function(){return x.dom.game.innerHTML+="<div id='"+(e.enemy?"enemy_":"")+"mSprite_"+e.id+"' class='"+(e.enemy?"enemy":"knight")+"' style='left:"+this.start.x*x.size+"px;top:"+this.start.y*x.size+"px;width:"+x.size+"px;height:"+x.size+"px;'>"+this.html+"</div>",this},this.getSprite=function(){return h("#"+(e.enemy?"enemy_":"")+"mSprite_"+this.id)},this.setNewPos=function(){this.newPos={x:Math.min(24*x.size-x.size,Math.max(0,(this.oldPos.x=parseInt(this.getSprite().style.left||0,10))+(this.mov.x=this.enemy?x.activeKnight.newPos.x<=this.oldPos.x?Math.max(-1.5+Math.random(),--this.mov.x+Math.random()):x.activeKnight.newPos.x>=this.oldPos.x?Math.min(1.5+Math.random(),++this.mov.x+Math.random()):Math.abs(this.mov.x)>.7*p.pixelSize?this.mov.x<0?this.mov.x+.7*p.pixelSize:this.mov.x-.7*p.pixelSize:0:"J"===this.state||"S"===this.state?this.oldPos.x>=21*x.size-x.size?--this.mov.x+Math.random():++this.mov.x+Math.random():x.keys[37]?Math.max(-4,--this.mov.x):x.keys[39]?Math.min(4,++this.mov.x):Math.abs(this.mov.x)>.7*p.pixelSize?this.mov.x<0?this.mov.x+.7*p.pixelSize:this.mov.x-.7*p.pixelSize:0))),y:Math.min(24*x.size-x.size,Math.max(0,(this.oldPos.y=parseInt(this.getSprite().style.top||0,10))+(this.mov.y=this.enemy?x.activeKnight.newPos.y<=this.oldPos.y?Math.max(-1.5+Math.random(),--this.mov.y+Math.random()):x.activeKnight.newPos.y>=this.oldPos.y?Math.min(1.5+Math.random(),++this.mov.y+Math.random()):Math.abs(this.mov.y)>.7*p.pixelSize?this.mov.y<0?this.mov.y+.7*p.pixelSize:this.mov.y-.7*p.pixelSize:0:"J"===this.state||"S"===this.state?0:x.keys[38]?Math.max(-4,--this.mov.y):x.keys[40]?Math.min(4,++this.mov.y):Math.abs(this.mov.y)>.7*p.pixelSize?this.mov.y<0?this.mov.y+.7*p.pixelSize:this.mov.y-.7*p.pixelSize:0)))}},this.setLeft=function(){this.getSprite().style.left=(this.newPos.x=Math.round(this.mov.x?this.mov.x<0?t(this.newPos.x,this.oldPos.y)||t(this.newPos.x,this.oldPos.y+15*p.pixelSize)?Math.floor(this.oldPos.x/x.size)*x.size:this.newPos.x:t(this.newPos.x+x.size,this.oldPos.y)||t(this.newPos.x+x.size,this.oldPos.y+15*p.pixelSize)?Math.ceil(this.oldPos.x/x.size)*x.size:this.newPos.x:this.oldPos.x))+"px"},this.setTop=function(){this.getSprite().style.top=(this.newPos.y=Math.round(this.mov.y?this.mov.y<0?t(this.oldPos.x,this.newPos.y)||t(this.oldPos.x,this.newPos.y+15*p.pixelSize)?Math.floor(this.oldPos.y/x.size)*x.size:this.newPos.y:t(this.oldPos.x,this.newPos.y+x.size)||t(this.oldPos.x+x.size,this.newPos.y+15*x.pixelSie)?Math.ceil(this.oldPos.y/x.size)*x.size:this.newPos.y:this.oldPos.y))+"px"},this.move=function(){"C"!==this.state&&(this.setNewPos(),this.setLeft(),this.setTop())},this.toJail=function(){x.kJailed++,this.state="J"},this.toShip=function(){x.kShipped++,this.state="S"},this.imprecate=function(){x.dom.game.innerHTML+="<div id='cloud' style='position: absolute;left:"+(this.newPos.x+x.size/2)+"px;top:"+(this.newPos.y-x.size)+"px;width:64px;height:128px;'><div style='left: 0; top: 0;'>"+x.spriteHTML[33]+"</div><div style='left: 32px; top: 0;'>"+x.spriteHTML[34]+"</div><div style='left: 0px; top: 32px;'>"+x.spriteHTML[35]+"</div><div style='left: 32px; top: 32px;'>"+x.spriteHTML[36]+"</div></div>"},e.collection&&e.collection.push(this),this}function l(e){c();var t=e.height||14*x.size,i=e.width||22*x.size,s=e.left||+x.size,n=e.top||2*x.size;x.dom.game.innerHTML+="<p id='msg-text' class='arcadeText' style='padding:"+ +x.size+"px; line-height:"+ +x.size+"px; width:"+i+"px; height:"+t+"px; left:"+s+"px; top:"+n+"px;'>"+(e.string||"")+"</p>"}function c(){h("#msg-text")&&x.dom.game.removeChild(h("#msg-text"))}function r(){for(var e="#",t=0;t<3;t++)e+="0123456789ABCDEF".substr(16*Math.random(),1);return e}function d(){cancelAnimationFrame(x.interval),x.interval=requestAnimationFrame(d,h("#colors"));for(var e="",t=0;t<50;t++)e+="<div class='stripe' style='top:"+2*t+"%; background:"+r()+";'></div>";h("#colors").innerHTML=e}for(var s,m,p={resolution:{width:384,height:272},pixelSize:2},x=n(),o=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),s=Math.max(0,16-(i-o)),n=window.setTimeout(function(){e(i+s)},s);return o=i+s,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),document.onkeydown=document.onkeyup=function(e){x.keys[(e||window.event).keyCode]="keydown"===(e||window.event).type},window.onload=m=function(){var e;(x={pal:x.pal,tiles:x.tiles,strings:x.strings,spriteHTML:x.spriteHTML,mapHTML:"",curScene:x.curScene+1,scene:x.scene,map:x.scene[(x.curScene+1)%x.scene.length][0],coins:0,keys:[],interval:x.interval,size:x.size,knights:x.knights,enemies:[],numEnemies:x.numEnemies,activeKnight:x.activeKnight,kJailed:x.kJailed,kShipped:x.kShipped,breakScene:!1,bridge:null,callbackTime:null,activeScene:x.activeScene,dom:{container:h("#container"),game:h("#game")}}).dom.container.style.width=x.dom.game.style.width=p.resolution.width*p.pixelSize+"px",x.dom.container.style.height=x.dom.game.style.height=p.resolution.height*p.pixelSize+"px";for(var t=0;t<x.map.length;t++)for(var i=x.map[t].split(""),s=0;s<i.length;s++)e="","0"!==i[s]&&(e="<div id='map_sprite_"+t+"_"+s+"' class='mapsprite' style='width:"+x.size+"px; height:"+x.size+"px; left:"+s%24*16*p.pixelSize+"px; top:"+16*Math.floor(s/24)*p.pixelSize+"px;'><div style='height:"+x.size+"px; width:"+48*p.pixelSize+"px;'>"+x.spriteHTML[parseInt(i[s],36)-1]+"</div></div>"),x.mapHTML+=e;x.dom.game.innerHTML=x.mapHTML+("GAME"===x.activeScene?"<p id='title' class='arcadeText' style='line-height:"+x.size+"px; left:"+x.size+"px;'>13th oF fAmE</p><p id='jail' class='arcadeText' style='"+x.size+"px;line-height:"+ +x.size+"px;'>jail:<span id='jail-txt'>"+x.kJailed+"</span></p><p id='ship' class='arcadeText' style='"+x.size+"px;line-height:"+ +x.size+"px;'>ship:<span id='ship-txt'>"+x.kShipped+"</span></p>":"<p id='title' class='arcadeText' style='line-height:"+x.size+"px; left:"+x.size+"px;'>13th oF fAmE</p>"),function o(e){switch(e){case"SPLASH":l({string:x.strings.splash}),h("#btn-play").addEventListener("click",function(){x.activeScene="GAME",m()},!1),d();break;case"GAME":c();for(var t=0;t<x.knights.length;t++){var i=x.knights[t];switch(i.state){case"J":i.start=i.newPos={x:20+Math.random(),y:15},i.draw();break;case"S":i.start=i.newPos={x:20+Math.random(),y:4},i.draw()}}x.activeKnight=new a({id:x.knights.length,start:{x:1,y:15},html:"<div style='left:0px;'>"+x.spriteHTML[17]+"</div>",collection:x.knights}).draw();for(var s=0;s<x.numEnemies;s++)new a({id:s,start:{x:Math.floor(19*Math.random())+3,y:Math.floor(14*Math.random())+2},html:"<div style='left:0px;'>"+x.spriteHTML[16]+"</div>",collection:x.enemies,enemy:!0}).draw();!function e(){cancelAnimationFrame(x.interval),x.interval=requestAnimationFrame(e,x.dom.game),h("#title").style.color=r();for(var t=0;t<x.knights.length;t++)x.knights[t].move(),!x.breakScene&&x.activeKnight.newPos.x>=18*x.size&&x.activeKnight.newPos.x<=19*x.size+x.size&&x.activeKnight.newPos.y<=5*x.size&&(x.breakScene=!0,x.activeKnight.state="S",x.activeScene="SHIP",x.callbackTime={time:(new Date).getTime(),delay:100});for(var i,s,n,a=0;a<x.enemies.length;a++)x.enemies[a].move(),!x.breakScene&&(i=x.activeKnight,s=x.enemies[a],n=p.pixelSize/2*16,i.newPos.y>=s.newPos.y&&i.newPos.y<=s.newPos.y+n&&(i.newPos.x<=s.newPos.x&&i.newPos.x+n>=s.newPos.x||i.newPos.x>=s.newPos.x&&i.newPos.x<=s.newPos.x+n)||i.newPos.y<=s.newPos.y&&i.newPos.y+n>=s.newPos.y&&(i.newPos.x<=s.newPos.x&&i.newPos.x+n>=s.newPos.x||i.newPos.x>=s.newPos.x&&i.newPos.x<=s.newPos.x+n))&&(x.activeKnight.imprecate(),x.breakScene=!0,x.activeKnight.state="C",x.activeScene="JAIL",x.callbackTime={time:(new Date).getTime(),delay:3e3});x.callbackTime&&(new Date).getTime()-x.callbackTime.time>=x.callbackTime.delay&&o(x.activeScene)}();break;case"JAIL":x.activeKnight.toJail(),13===x.kJailed?x.activeScene="OVER":(5<x.numEnemies&&x.numEnemies--,x.activeScene="GAME"),m();break;case"SHIP":x.activeKnight.toShip(),13===x.kShipped?x.activeScene="WIN":(x.numEnemies++,x.activeScene="GAME"),m();break;case"WIN":l({string:x.strings.win}),h("#btn-play").addEventListener("click",function(){(x=n()).activeScene="GAME",m()},!1),function e(){cancelAnimationFrame(x.interval),x.interval=requestAnimationFrame(e,h("#btn-play")),h("#btn-play").style.color=r()}();break;case"OVER":l({string:x.strings.over}),h("#btn-play").addEventListener("click",function(){(x=n()).activeScene="GAME",m()},!1),d()}x.callbackTime=null}(x.activeScene)}</script>