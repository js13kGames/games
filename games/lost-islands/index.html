<!DOCTYPE html><html><head><title>Lost Islands - js13kGames</title><style>.btn,.character,.obj,.option{cursor:pointer}.dialog,.stage div,div{position:absolute}.chat,.map-node,div,input{box-sizing:border-box}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}.map-node,.ui.option{display:inline-block}body{line-height:1;background:#fff;color:#080;font-size:10px}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}.character.atk{animation:atk .5s linear}.character.rev.atk{animation:atkrev .5s linear}.upAndDown{animation:kfUpAndDown 2s linear infinite alternate}.popup{animation:popup .5s}.fadeInOut{animation:fadeInOut 1s}@keyframes atk{0%,100%{transform:translate(0,0)}50%{transform:translate(5em,0)}}@keyframes atkrev{0%,100%{transform:scaleX(-1) translate(0,0)}50%{transform:scaleX(-1) translate(5em,0)}}@keyframes kfUpAndDown{from{transform:translate(0,0)}to{transform:translate(0,1em)}}@keyframes fadeInOut{0%,100%{opacity:0}40%,60%{opacity:1}}@keyframes popup{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}60%{transform:scale(1.05)}70%{transform:scale(1.1)}}body,html{width:100%;height:100%}.game{left:50%;top:50%;overflow:hidden}.character{z-index:50;transform:translateZ(3000px)}.character.rev,.character.rev .text{transform:scaleX(-1) translateZ(3000px)}.obj{z-index:10;transform:translateZ(2000px)}.character,.obj,.stage{transform-style:preserve-3d}.stage{width:100em;height:75em;transform:rotateX(22deg) rotateY(180deg) perspective(120em);left:0;top:5em;z-index:5}.stage div{width:100%;height:100%}.env-name{font-size:2em}.env-overlay{width:100%;height:100%;left:0;top:0;z-index:200;transform:translateZ(3000px);background:#000}.env-overlay.hp{background:rgba(255,0,0,.3)}.shadow{width:100%;height:1em;bottom:-.5em;background:rgba(0,0,0,.25);border-radius:50%}.back{transform:translateZ(-63em) rotateY(180deg)}.bottom{transform:rotateX(90deg) translateY(10em);transform-origin:bottom center}.pix{height:1em;width:1em}.ui{z-index:100;transform:translateZ(5000px);transform-style:preserve-3d}.ui.dialog{z-index:1000}.dialog{border:.2em solid #5e1f27;border-radius:2em;background:linear-gradient(135deg,#e6e4e5 0,#b1b1b1 99%);padding:1.2em;top:50%;left:50%;transform:translate(-50%,-50%) translateZ(5000px)}.controls div,.map,.map div,.map-node,.map-row,.text{position:relative}.dialog-content,.dialog-inner{position:relative;padding:1em}.dialog-content{max-height:38em;overflow:auto;min-width:15em}.dialog-inner{content:'';background:linear-gradient(to bottom,#e8d1ad 0,#c8a678 99%);border-radius:2em;border:.3em solid #5e1f27;padding:2em;box-shadow:inset 0 0 3px 4px #b98d68}.map{height:100%;width:100%;font-size:5px}.map-node.active{border:2px solid red}.map-text{margin-bottom:2em}.map-node:hover{border:1px solid #fff}.text{margin:auto;font-size:.2em}.text .pix{position:absolute}.btn,.chat,.ui.option .opt-item{position:relative}.input{margin:2em;padding:1em}.btn{border-radius:2em;padding:1em 2em;text-decoration:none;border:2px solid #aad2f1}.btn:active{transform:translate(0,.5em);-webkit-transform:translate(0,.5em);box-shadow:0 .5em 0 0 transparent}.blue{background-color:#55acee;box-shadow:0 .5em 0 0 #3c93d5}.ui.option{margin:.2em}.ui.option.items{display:block;text-align:center}.action-box,.action-box .btn,.chat-box,.chat-btn,.chat-input,.status-box{display:inline-block}.ui.option .opt-color{width:3em;height:3em;position:relative}.ui.option .opt-item{width:100%;height:2em;text-transform:capitalize;line-height:2em;font-size:1.5em;color:#fff}.action-box,.status-box{width:32em;height:100%;border-right:1px solid #e0e0e0}.chat-box{width:35em;border-right:1px solid #e0e0e0}.chat{width:35em;height:12em;overflow-y:auto;color:#000;line-height:1.5em;padding:1em}.chat-btn{border:1px solid #fff;background:#ccc;padding:.6em}.chat-input{width:27em;height:3em;float:left;font-size:10px}.chat::-webkit-scrollbar-track,.dialog-content::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#f5f5f5}.chat::-webkit-scrollbar,.dialog-content::-webkit-scrollbar{width:12px;background-color:#f5f5f5}.chat::-webkit-scrollbar-thumb,.dialog-content::-webkit-scrollbar-thumb{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#bababa}.controls{left:0;width:100em;height:15em;border-radius:1em;bottom:0;background:rgba(255,255,255,.32);z-index:300;opacity:.5}.controls:hover{opacity:1}.action-box,.chat-box,.status-box{float:left}.action-box,.status-box{padding:1em}.action-box .btn{width:17em;margin:1em;font-size:.5em}.status-box .attrs>.text{display:inline-block;margin:5em}.attrs{text-align:center;margin-top:1em}.progress{background:#ccc;border:1px solid #ccc;padding:1px}.center,.progress .text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) translateZ(5000px)}.centerX{position:absolute;left:50%;transform:translate(-50%,0) translateZ(5000px)}.progress-bar{width:100%;height:100%;border-radius:5px}</style></head><body><script src="/socket.io.js"></script><script src="shared.js"></script><script>!function(){"use strict";function e(e,t){var s=parseInt(e.slice(1),16),i=t<0?0:255,a=t<0?-1*t:t,r=s>>16,n=s>>8&255,o=255&s;return"#"+(16777216+65536*(Math.round((i-r)*a)+r)+256*(Math.round((i-n)*a)+n)+(Math.round((i-o)*a)+o)).toString(16).slice(1)}function t(e,t,s){["","-webkit-","-moz-","-ms-","-o-"].forEach(i=>e.style[t]=i+s)}function s(e){return e&&"function"==typeof e.then}function i(e){return e=Array.prototype.slice.call(e),!Array.isArray(e)||"function"!=typeof e.reduce||e.length<1?Promise.reject("err"):1==e.length?"function"!=typeof e[0]?Promise.reject("err "):Promise.resolve(e[0]()):e.reduce(function(t,i){if(t==e[0]){if("function"!=typeof t)return Promise.reject("err");var a=t();return s(a)?a.then(i):Promise.reject("err")}if(s(t))return t.then(i);Promise.reject("err")})}const a=(e,t=document.body)=>Array.isArray(e)?e.forEach(e=>a(e,t)):t.appendChild(e),r=(e,t={},...s)=>{const i=document.createElement(e),r=(e,t)=>{if(e instanceof Element)a(e,t);else{if(!e)return;let s=document.createTextNode(e);a(s,t)}};if("string"==typeof t)i.className=t;else{const{className:e,bs:s,top:a,left:r,width:n,height:o,background:c}=t;i.className=e||"pix",i.style.background=c||"",i.style.top=a||"",i.style.left=r||"",i.style.width=n||"",i.style.height=o||"",i.style.boxShadow=s||""}return s.length&&(Array.isArray(s[0])&&(s=s[0]),s.forEach(e=>{Array.isArray(e)?e.forEach(e=>r(e,i)):r(e,i)})),i.prependChild=(e=>i.insertBefore(e,i.firstChild)),i.$m=(e=>a(e,i)),i.hide=(()=>i.style.display="none"),i.show=((e="inherit")=>i.style.display=e),i.html=(e=>i.innerHTML=e),i.empty=(()=>i.html("")),i.on=((e,t)=>i.addEventListener(e,t)),i.click=(e=>{if(e)i.on("click",e);else{const e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}),i.change=(e=>i.on("change",e)),i},n=(t,s="#080",i=0,a=0,n=8,o=!1,c=-.05)=>{try{let l=e=>e%n<e/n-1,h=t.split("").reduce((e,t)=>e+("000"+parseInt(t,16).toString(2)).substr(-4,4),"").split("").reduce((t,i,a)=>t+(parseInt(i)?`${a%n}em ${a/n|0}em ${o&&l(a)?e(s,c):s},`:""),"").slice(0,-1);return r("div",{bs:h,className:"pix",left:i+"em",top:a+"em"})}catch(e){return}},o="3f7fffdfdfdfdfdfdfdfdfdfdf",c="1c1c1c1c1c1c1c1c1c1c1c7c7c",l="1c1c1c1c1c1c1c1c1c1c1c1f1f";var h=Object.freeze({a:"183c66667e7e6642",armor:"0044eceefefefefe7ceeee",axe:"0416173f3f171614101010",b:"7c66667e6466667c",bodyleft:o,bodyright:"fcfefffbfbfbfbfbfbfbfbfbfb",c:"3c6260606060623c",colon:"0000006060006060",comma:"0000000000303060",d:"7c6666666666667c",dot:"0000000000006060",e:"7e60607c7c60607e",exc:"1818181818001818",f:"7e60607c7c606060",g:"7e6260606e66667e",h:"6666667e7e666666",hair1:"7f7fc0c0",hair2:"3c7effe3c1c0",head:"7efefefefee0",heart:"48fcfc7830",hemlet:"003e7efee0f2f2f2",i:"7e7e181818187e7e",j:"0606060666667e7e",k:"66666c78786c6666",l:"6060606060607e7e",legleft:c,legright:l,longhat:"787878fcfc",m:"4163777f7f6b6363",n:"63737b7f7f6f6763",n0:"3c6262626262623c",n1:"387818181818187e",n2:"3c7e660c1830627e",n3:"3c66460c0c46663c",n4:"2c6c6c6c7f0c0c0c",n5:"7e6060607e06467e",n6:"7e6060607e62627e",n7:"7e6606060c0c1818",n8:"3c66663c6666663c",n9:"3c4646463e06463c",o:"3c6666666666663c",p:"3c666666667c6060",q:"3c424242424a463d",qes:"3c66460e1c180018",r:"7c62627c786c6663",rect:"70707070",s:"3c626230184e463c",shorthat:"3cffff",slash:"0c0c181830306060",sword:"10101010101010387c1010",t:"7e7e181818181818",triangle:"183c7eff",u:"6666666666667e3c",v:"4266666666663c18",w:"6363636b7f7f7763",x:"6363363e1c367763",y:"6666667e3c181818",z:"7e7e0e1c38707e7e"});const m=(e,t,s,i="px")=>{e.style.left="50%",e.style.top="50%",e.style.marginLeft=`-${t/2+i}`,e.style.marginTop=`-${s/2+i}`},p=(e,t=1,s=1,i=0,a=0,r=0)=>e.style.transform=`rotate(${r}deg) scale(${t}, ${s}) translate(${i}em, ${a}em) translateZ(1000px)`,d=e=>()=>new Promise(t=>e(t)),{data:f}=DATA.OBJS;const u={get:(e,t=!1)=>{let s=f[e],i=s[2].reverse().map(e=>{let t=Array.isArray(e[1])?random(e[1]):e[1],s=n(h[e[0]],t,e[2],e[3],8,!0);return p(s,e[4],e[5],e[6],e[7]),s}),a=r("div",{className:"pix obj",height:s[0]+"em",width:s[1]+"em"},i);return t&&a.prependChild(r("div","shadow")),p(a,s[3],s[4],s[5],s[6],s[7]),{el:a,size:[s[1],s[0]]}},text:(e,t="#fff",s={})=>(e=e.toLowerCase(),r("div",Object.assign({},{className:"pix text",height:"8em",width:8*e.length+"em"},s),e.split("").map((e,s)=>{let i={".":"dot",",":"comma","!":"exc","?":"qes",":":"colon","/":"slash"};return e in i&&(e=i[e]),/^\d+$/.test(e)&&(e="n"+e)," "==e?r("div",{width:"1em"}):n(h[e],t,8*s)})))},g=(e,t)=>r("div",`dialog-inner ${t}`,e||null),y=(e,t)=>{let s=r("div","ui dialog");return s.$innerBox=g(e,t||"popup"),a(s.$innerBox,s),s},b=(e,t,s,i=[],n="ok",o=!1)=>{let c=y([u.text(e)],o);return i.length>0||(i=v(n)).click(()=>{s(),c.hide()}),a([r("div","dialog-content",t),i],c.$innerBox),c},v=(e,t)=>r("div",t||"btn blue",u.text(e));var k={button:v,dialog:y,progress:(e="",t=1,s=10,i=70,a=100,n="red")=>{let o=a;const c=r("div",{className:"progress-bar",background:n}),l=u.text(`${e}:${i}/${a}`,"#fff"),h=r("div",{className:"progress",width:s+"em",height:t+"em"},c,l),m=e=>{c.style.width=e/o*100+"%"};return m(i),{el:h,setVal:m,setMax:e=>o=e}},ask:(e,t)=>{let s="",i=r("input","input");return i.type="text",i.change(e=>s=e.target.value),b(e,i,()=>t(s))},pick:(e,t,s,i,a="",n=!1)=>{let o=0,c=t.map((e,t)=>{let i=r("span",`ui option ${a}`,e);return i.click(()=>{s(o=t),c.forEach((e,t)=>e.style.border=o===t?"1px solid #fff":"none")}),i});return b(e,c,()=>i(o),[],"ok",n)},alert:(e,t,s)=>b(e,[],s,[],t),controls:e=>{const t=r("div","chat"),s=r("input","chat-input");s.type="text";const i=v("send","chat-btn");i.on("click",()=>{e(s.value),s.value=""});const n=r("div","chat-box",t,s,i);let o=!1;t.on("scroll",()=>o=!0),setInterval(()=>{o?t.scrollHeight-t.scrollTop===t.clientHeight&&(o=!1):t.scrollTop=t.scrollHeight},100);const c=r("div","status-box"),l=r("div","action-box");return{el:r("div","controls",n,c,l),logs:e=>{t.empty(),a(e.map(e=>r("p","",e)),t)},submitEl:i,actionBox:l,statusBox:c}},text:u.text,map:(e,t,s)=>{const{areas:i}=DATA.MAPS,a=[];let n=t,o=r("div","map-text"),c=r("div","map-detail"),l=r("div","map",o,c);e.forEach((e,t)=>{let s=r("div",{className:"map-row",width:e.length+"em",height:"1em"});a[t]=[],e.forEach((e,n)=>{let c=r("div",{className:`map-node`,width:"1em",height:"1em",background:i[e][4]});a[t][n]=c,c.on("mouseover",()=>{o.empty(),o.$m(u.text(`${i[e][1]} x:${n} y:${t}`)),o.show()}),s.$m(c)}),c.$m(s)}),a[s.x][s.y].className="map-node active",c.on("mouseout",()=>o.hide());let h=b("map",l,()=>h.hide());return{el:h,update:e=>{n.y>-1&&(a[n.x][n.y].className="map-node"),a[e.x][e.y].className="map-node active",n=e}}},removeAll:e=>Array.prototype.forEach.call(document.getElementsByClassName(e),e=>e.parentNode.removeChild(e))};const{skins:x,hairs:w}=DATA.COLORS,E=(e,t,s=[])=>{const i=r("div","pix upAndDown",n(o,x[e],0,5.5,8,!0),n("fcfefffbfbfbfbfbfbfbfbfbfb",x[e],5,5.5),s.filter(e=>2===e.pos||3===e.pos).map(e=>e.el)),a=r("div",{},n(c,x[e],0,18,8,!0),n(l,x[e],4,18));return[r("div","pix upAndDown",n("7efefefefee0",x[e],4),n("3c7effe3c1c0",w[t],4,-3,8),s.filter(e=>1===e.pos).map(e=>e.el)),a,i]},$=(e,t=[],s=!1)=>{const i=r("div",{className:"",top:"-7em"},k.text(e.name)),n=t.map(e=>"string"==typeof e?r("div"):e.eq?{el:u.get(e.obj).el,pos:e.pos}:r("div"));let o=E(e.skin,e.hair,n);const c=r("div",{className:`character ${s?"rev":""}`,height:"31em",width:"13em"},i,r("div","shadow"),o);return{el:c,info:e,width:13,height:31,updateInfo:(t,s=[])=>{t.name!=e.name&&(i.html(""),e.name=t.name,a(k.text(e.name),i)),t.skin==e.skin&&t.hair==e.hair||(e.skin=t.skin,e.hair=t.hair,o.forEach(e=>c.removeChild(e)),o=E(e.skin,e.hair),a(o,c))},scale:e=>c.style.fontSize=e/100+"em",changePos:e=>{c.style.left=e[0]+"em",c.style.top=e[1]+"em"},atk:e=>{c.className=`character ${e?"rev":""} atk`,setTimeout(()=>c.className=`character ${e?"rev":""}`,500)}}},A={t:42,l:15},N={b:[1,2,3,4,5].map(e=>[e*A.l+(e-1)*(1==e?0:5),A.t]),m:[1,2,3,4,5,6].map(e=>[10*e+(e-1)*(1==e?0:10),50]),f:[1,2,3,4,5,6].map(e=>[10*e+(e-1)*(1==e?0:10),70])},{grounds:O,sky:C}=DATA.COLORS,I=[(e=45)=>`linear-gradient(${e}deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent)`,()=>""],S=[{size:"50px 50px",color:O[3],pattern:0},{size:"6px 102px",color:O[4],pattern:0},{size:"",color:C[0],pattern:1},{size:"",color:O[5],pattern:0},{size:"",color:"blue",pattern:0,opt:0}],z=(e,s="bottom")=>{let i=r("div",{className:s});return i.style.backgroundColor=e.color,t(i,"backgroundImage",I[e.pattern](e.opt)),i.style.backgroundSize=e.size,i},P=(e,t,s,i="")=>{function n(e,s=!1){e.forEach((e,t)=>{let i=$(e.info,e.status.items,s);i.scale(80),i.changePos(N.m[t+(s?3:0)]),i.__id=e.id,s?h.push(i):l.push(i)}),s?a(h.map(e=>e.el),t):a(l.map(e=>e.el),t)}let o=e.env,c={x:e.x,y:e.y},l=[],h=[],m=e=>e.backEls.map((t,s)=>{if(t<0)return r("div");let i=N.b[s],a=u.get(e.backEls[t],!0),n=r("div",{className:"pix obj popup",left:i[0]+"em",top:i[1]-a.size[1]+"em"},a.el);return n.style.animationDelay=.1*s+"s",n});const p=e=>[z(S[e.back],"back"),z(S[e.bottom])];let d=r("div",{className:"stage"},p(o)),f=m(o);a(f,t),n(s);let g=r("div","env-name centerX",u.text(i));a(g,t);let y=r("div","env-overlay fadeInOut");y.hide();let b=r("div","env-overlay hp fadeInOut");return b.hide(),a([y,b],t),{el:d,changePlayers:function(e){l.forEach((e,s)=>{t.removeChild(e.el)}),l=[],n(e)},changeStage:function(e,s){s.status.place.x===c.x&&s.status.place.y===c.y||(y.show(),setTimeout(()=>y.hide(),1e3),c=Object.assign({},{x:s.status.place.x,y:s.status.place.y}),d.empty(),d.$m(p(s.status.place.env)),g.empty(),g.$m(u.text(s.status.place.name)),f.forEach(e=>t.removeChild(e)),f=m(s.status.place.env),a(f,t)),h.forEach((e,s)=>{t.removeChild(e.el)}),h=[],n(s.status.place.monsters,!0)},hurt:()=>{b.show(),setTimeout(()=>b.hide(),1e3)},atk:function(e){l.forEach((t,s)=>{t.__id===e&&t.atk()}),h.forEach((t,s)=>{t.__id===e&&t.atk(!0)})}}};class T{constructor(e){this.socket=e,this.init=!1,this.info={},this.game=null,this.width=1024,this.height=768,this.scale=10,this.character=null,this.stage=null,this.controls=null,this.statusui={},this.container=r("div",{className:"game",width:this.width+"px",height:this.height+"px"}),this.itemOpen=!1,this.targetOpen=!1,this.initComm(e),this.resize(),this.err=!1}bindKeys(){document.onkeydown=(e=>{switch((e=e||window.event).which||e.keyCode){case 13:this.controls.submitEl.click()}})}home(){this.character=$(this.info),a(this.character.el,this.container),m(this.character.el,this.character.width,this.character.height,"em"),this.character.el.style.left="20%",a(this.container);const{skins:e,hairs:t}=DATA.COLORS,{stories:s}=DATA;i([d(e=>a(k.ask("your name",t=>this.emit("updateInfo",{name:t},()=>e())),this.container)),d(t=>a(k.pick("skin",e.map(e=>r("div",{className:"opt-color",background:e})),e=>this.emit("updateInfo",{skin:e}),e=>this.emit("updateInfo",{skin:e},()=>t())),this.container)),d(e=>a(k.pick("hair",t.map(e=>r("div",{className:"opt-color",background:e})),e=>this.emit("updateInfo",{hair:e}),t=>this.emit("updateInfo",{hair:t},()=>e())),this.container)),d(e=>a(k.alert(s[0],"start game",()=>this.emit("queueGame",{},()=>e()))))])}initGame(){this.player=this.game.players.find(e=>e.id==this.info.id),this.character.el.hide(),this.stage=P(this.game.lobby,this.container,this.game.players,this.game.lobby.name),this.controls=k.controls(e=>this.emit("gamemsg",e)),this.socket.on("gamemsg",e=>{this.controls.logs(this.game.logs=e)}),this.socket.on("changeStage",e=>{this.player.status.loc=e.loc,this.player.status.place=e.place,this.stage.changeStage(this.game,this.player),this.stage.changePlayers(this.game.players),this.map.update(e.loc)}),this.socket.on("changePlayers",e=>{this.game.players=e,this.stage.changePlayers(this.game.players)}),this.socket.on("gameinfo",e=>Object.assign(this.game,e)),this.bindKeys(),a(this.controls.el,this.container),a(this.stage.el,this.container),this.renderStatus(),this.renderActions()}renderStatus(){const e=()=>{let e=r("div","attrs");for(let t in this.player.status.attrs)"hp"===t?(this.statusui.hp=k.progress("hp",3,30,this.player.status.attrs[t]),a(this.statusui.hp.el,this.controls.statusBox)):a(k.text(`${t}: ${this.player.status.attrs[t]}`),e);return e};this.socket.on("changeAttr",t=>{let s=t.by?t.attrs:t;t.by&&this.stage.atk(t.by),this.controls.statusBox.empty(),s.hp<this.player.status.attrs.hp&&this.stage.hurt(),this.player.status.attrs=s,a(e(),this.controls.statusBox)})}renderActions(){this.controls.actionBox.empty(),k.removeAll("ui dialog");let e=k.button("map");this.map=k.map(this.game.map,this.player.status.loc,this.game.boss),a(this.map.el),this.map.el.hide(),e.click(()=>this.map.el.show());let t=k.button("item");t.click(()=>{this.itemOpen=!0,this.itemEl.show()}),this.socket.on("changeItems",e=>{this.player.status.items=e;let t=k.pick("Items",this.player.status.items.map(e=>{let t="string"==typeof e?e:`${e.name}${e.grade>0?"+"+e.grade:""} ${e.eq?"[Equiped]":""}`,s=r("div",{className:"opt-item"},t);return s.style.color=grades[e.grade],s}),e=>this.emit("useitem",e),()=>this.itemOpen=!1,"items",!!this.itemOpen&&" ");a(t),this.itemEl?(this.itemEl.parentNode.removeChild(this.itemEl),this.itemEl=t):this.itemEl=t,this.itemOpen||this.itemEl.hide()});const s=()=>{if(!this.player.status.place)return;this.targetable=this.player.status.place.monsters;let e=k.pick("Chose Target",this.targetable.map(e=>{let t=`${e.info.name}: ${e.status.attrs.hp}/100`;return r("div",{className:"opt-item"},t)}),e=>this.emit("gameaction",{id:"atk",loc:this.player.status.loc,mid:e}),()=>this.targetOpen=!1,"items",!!this.targetOpen&&" ");a(e),this.targetEl?(this.targetEl.parentNode.removeChild(this.targetEl),this.targetEl=e):this.targetEl=e,this.targetOpen||this.targetEl.hide()};let i=k.button("attack");i.click(()=>{this.targetOpen=!0,this.targetEl.show()}),this.socket.on("updatePlace",e=>{this.player.status.place=e,s(),this.stage.changeStage(this.game,this.player)});this.socket.on("changeActions",(r=[])=>{this.controls.actionBox.empty();const n={map:e,atk:()=>(s(),i)};a(r.map(e=>{if(e in n)return"function"==typeof n[e]?n[e]():n[e];{let t=k.button(e);return t.click(()=>this.emit("gameaction",e)),t}}).concat(t),this.controls.actionBox)})}emit(e,t,s){this.socket.emit(e,t,s)}initComm(e){e.on("initGame",e=>{this.game=e,this.initGame()}),e.on("updateInfo",e=>{this.info=e,this.init||(this.init=!0,this.home()),this.character.updateInfo(this.info)}),e.on("connect",e=>{}),e.on("disconnect",this.onErr),e.on("connect_error",this.onErr),e.on("error",this.onErr),e.on("gg",e=>this.onErr(e))}onErr(e){this.err||a(k.alert(e||"You are disconnected","ok",()=>window.location.reload(!0)))}resize(){m(this.container,this.width,this.height),this.container.style.fontSize=`${this.scale}px`}}t(document.body,"background","radial-gradient(ellipse at center, #b5bdc8 0%,#828c95 36%,#28343b 100%)");new T(io({path:location.pathname+'io',upgrade:!1,transports:["websocket"]}))}();</script></body></html>