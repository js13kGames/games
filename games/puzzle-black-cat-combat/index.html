<!doctype html><meta name=viewport content="width=device-width"><title>Puzzle Black Cat Combat - js13kGames 2025</title><style>*{-webkit-tap-highlight-color:transparent}body{margin:0}#app{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;background-color:#222;background-image:linear-gradient(135deg,#202b29,#243032,#27262d,#201b1f,#27262d,#243032,#202b29);background-size:400% 400%;animation:10s linear 1s infinite gradient-move}@keyframes gradient-move{0%{background-position:0 0}to{background-position:100% 100%}}#can-con{width:100%;height:100%;background-color:#000}#canvas{display:block}</style><div id=app><div id=can-con><canvas id=canvas></canvas></div></div><script>!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),t.credentials="use-credentials"===e.crossOrigin?"include":"anonymous"===e.crossOrigin?"omit":"same-origin",t}(e);fetch(e.href,t)}}();const e=(e,t=0)=>Math.floor(crypto.getRandomValues(new Uint32Array(1))[0]/4294967296*(e-t+1)+t),t=(e,t,i)=>e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height,i=e=>JSON.parse(JSON.stringify(e)),l=(e,t,i,l,o,n)=>{e.beginPath(),e.moveTo(t+n,i),e.arcTo(t+l,i,t+l,i+o,n),e.arcTo(t+l,i+o,t,i+o,n),e.arcTo(t,i+o,t,i,n),e.arcTo(t,i,t+l,i,n),e.closePath()};let o=i({cs:"H",c:!1,s:1,baseW:400,gridX:10,gridY:8,pieceSize:40,playerHP:100,bossHP:100,hCId:-1,sCId:1,hNName:"",hNBtn:-1,hTBtn:-1,hTPBtn:-1,hHBtn:-1,hVBtn:-1,hOBtn:-1,hCBtn:-1,hSBtn:-1,iT:"",cIId:-1,cTId:-1,acs:[1,2],acw:[]});const n=["red","yellow","blue","green","white","black"];function s(e){return 100*e}let a={grid:[],selectedPiece:null,score:0,playerHP:100,bossHP:100,playerLevel:1,bossLevel:1,isAnimating:!1,animationType:null,animationProgress:0,activeCombos:[],activeHPChanges:[]};function c(){const e=s(1);for(a={grid:r(),selectedPiece:null,score:0,playerHP:e,bossHP:e,playerLevel:1,bossLevel:1,isAnimating:!1,animationType:null,animationProgress:0,activeCombos:[],activeHPChanges:[],comboChainCount:0,showLevelUp:!1,gameResult:null};f().length>0;)a.grid=r()}function r(){const t=[];for(let i=0;i<o.gridY;i++){const l=[];for(let t=0;t<o.gridX;t++)l.push({color:n[e(n.length-1)],x:t,y:i,isEmpty:!1});t.push(l)}return t}function f(){const e=[];for(let t=0;t<o.gridY;t++)for(let i=0;i<o.gridX-2;i++){const l=a.grid[t][i].color;if(!a.grid[t][i].isEmpty&&a.grid[t][i+1].color===l&&a.grid[t][i+2].color===l){let n=i+2;for(;n<o.gridX-1&&a.grid[t][n+1].color===l;)n++;for(let o=i;o<=n;o++)e.push({x:o,y:t,color:l});i=n}}for(let t=0;t<o.gridX;t++)for(let i=0;i<o.gridY-2;i++){const l=a.grid[i][t].color;if(!a.grid[i][t].isEmpty&&a.grid[i+1][t].color===l&&a.grid[i+2][t].color===l){let n=i+2;for(;n<o.gridY-1&&a.grid[n+1][t].color===l;)n++;for(let o=i;o<=n;o++)e.push({x:t,y:o,color:l});i=n}}return e}function d(e){if(0===e.length)return;e.forEach(e=>{a.grid[e.y][e.x].isEmpty=!0});const t=e.reduce((e,t)=>(e[t.color]=(e[t.color]||0)+1,e),{});let i=0,l=0;a.comboChainCount=(a.comboChainCount||0)+1;const n={},c={};e.forEach(e=>{n[e.y]||(n[e.y]=[]),c[e.x]||(c[e.x]=[]);let t=n[e.y].find(t=>t.color===e.color);t||(t={color:e.color,count:0},n[e.y].push(t)),t.count++;let i=c[e.x].find(t=>t.color===e.color);i||(i={color:e.color,count:0},c[e.x].push(i)),i.count++});let r=0;Object.values(n).forEach(e=>{e.forEach(e=>{4===e.count?r+=5:e.count>=5&&(r+=10)})});const f=Object.keys(n).filter(e=>n[Number(e)].length>0).length,d=Object.keys(c).filter(e=>c[Number(e)].length>0).length,g=Math.max(f,d);g>1&&(r+=5*g),Object.entries(t).forEach(([e,t])=>{const n=Math.floor(2*t),c=Math.floor(10*t),r=Math.max(1,a.comboChainCount||1);if(i+=n*r,l+=c*r,"white"===e){const e=2*t,i=s(a.playerLevel),l=a.playerHP;a.playerHP=Math.min(i,a.playerHP+e);const o=a.playerHP-l;o>0&&h(o,110,32.5,!0)}else if("black"===e){const e=1*t,i=s(a.bossLevel),l=a.bossHP;a.bossHP=Math.min(i,a.bossHP+e);const o=a.bossHP-l;o>0&&h(o,290,32.5,!0)}t>=3&&function(e,t,i){a.activeCombos||(a.activeCombos=[]);const l=i.charAt(0).toUpperCase()+i.slice(1),n={Red:"#FF0000",Yellow:"#FFFF00",Blue:"#00BFFF",Green:"#00FF00",White:"#FFFFFF",Black:"#000000"}[l]||"#FFFFFF",s=o.gridX*o.pieceSize/2,c=o.gridY*o.pieceSize/4,r=a.activeCombos.length*Math.PI*2/5,f=30*Math.sin(r);a.activeCombos.push({count:e,multiplier:t,x:s,y:c+f,color:l,displayColor:n,progress:0})}(t,r,e)}),i+=r;const p=a.bossHP;a.bossHP=Math.max(0,a.bossHP-i);const y=p-a.bossHP;y>0&&h(y,290,32.5,!1),a.score+=l,function(){a.isAnimating=!0,a.animationType="fall",a.animationProgress=0,a.fallingPieces=[];for(let e=0;e<o.gridX;e++){a.fallingPieces[e]=[];let t=0;for(let i=o.gridY-1;i>=0;i--)a.grid[i][e].isEmpty?t++:t>0&&(a.fallingPieces[e][i]=t)}}()}function h(e,t,i,l=!1){a.activeHPChanges||(a.activeHPChanges=[]),a.activeHPChanges.push({value:e,x:t,y:i,isHeal:l,progress:0})}function g(e){a.activeHPChanges&&0!==a.activeHPChanges.length&&(a.activeHPChanges.forEach(t=>{t.progress+=1.2*e}),a.activeHPChanges=a.activeHPChanges.filter(e=>e.progress<1))}function p(e){a.activeCombos&&0!==a.activeCombos.length&&(a.activeCombos.forEach(t=>{t.progress+=1.2*e}),a.activeCombos=a.activeCombos.filter(e=>e.progress<1),0===a.activeCombos.length&&(a.comboChainCount=0))}function y(t){a.isAnimating&&"fall"===a.animationType&&(a.animationProgress+=2*t,a.animationProgress>=1&&(function(){for(let t=0;t<o.gridX;t++){let l=0;for(let e=o.gridY-1;e>=0;e--)a.grid[e][t].isEmpty?l++:l>0&&(a.grid[e+l][t]=i(a.grid[e][t]),a.grid[e+l][t].y=e+l,a.grid[e][t].isEmpty=!0);for(let i=0;i<l;i++)a.grid[i][t]={color:n[e(n.length-1)],x:t,y:i,isEmpty:!1}}}(),a.isAnimating=!1,a.animationType=null,a.isAnimating=!0,a.animationType="delay",a.animationProgress=0))}function u(e){if(a.isAnimating&&"delay"===a.animationType&&(a.animationProgress+=1.5*e,g(e),a.animationProgress>=1)){a.isAnimating=!1,a.animationType=null,a.activeCombos&&0!==a.activeCombos.length||(a.comboChainCount=0);const e=f();e.length>0&&d(e)}}function m(e,t,i,l){return!a.isAnimating&&!a.showLevelUp&&(1===Math.abs(e-i)&&t===l||1===Math.abs(t-l)&&e===i)&&(function(e,t,i,l){a.isAnimating=!0,a.animationType="swap",a.animationProgress=0,a.swappingPieces={x1:e,y1:t,x2:i,y2:l}}(e,t,i,l),!0)}function v(){return a.bossHP<=0?a.playerLevel>=13?(a.gameResult="win",!0):(a.isAnimating||a.activeCombos&&0!==a.activeCombos.length||function(){a.playerLevel++,a.bossLevel++;const e=s(a.playerLevel);a.playerHP=e,a.bossHP=e,a.showLevelUp=!0}(),!1):a.playerHP<=0&&(a.gameResult="lose",!0)}const P=e=>`${e}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,b=e=>`bold ${e}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,S=(e,t,i,l="white",n=!0,s=!0)=>{const a=o.s,c=40*a,r=t,f=i;s&&(e.fillStyle="#555",e.fillRect(r,f,c,c)),n&&(e.strokeStyle="#777",e.lineWidth=2*a,e.strokeRect(r,f,c,c)),e.fillStyle={red:"#ff6b6b",yellow:"#ffd93d",blue:"#2e8bdd",green:"#6bcb77",white:"#f8f9fa",black:"#000000"}[l],e.save(),e.translate(r+c/2,f+c/2);const d=.8*c/Math.max(1024,1024);e.scale(d,d),e.translate(-512,-512),e.beginPath(),e.moveTo(697.2,329.1),e.lineTo(328.8,329.1),e.lineTo(98.5,98.8),e.lineTo(98.5,927.8),e.lineTo(927.5,927.8),e.lineTo(927.5,98.8),e.lineTo(697.2,329.1),e.fill(),e.closePath(),e.fillStyle="#444",e.beginPath(),e.moveTo(397.9,743.6),e.lineTo(397.9-69.1,743.6),e.lineTo(397.9-69.1,559.4),e.lineTo(397.9,559.4),e.lineTo(397.9,743.6),e.moveTo(697.2,743.6),e.lineTo(628.1,743.6),e.lineTo(628.1,559.4),e.lineTo(697.2,559.4),e.lineTo(697.2,743.6),e.closePath(),e.fill(),e.restore()},T=(e,i)=>{e.clearRect(0,0,i.width,i.height);const l=o.s,n=30*Math.PI/180,s=i.width*Math.cos(n),a=i.width*Math.sin(n),c=e.createLinearGradient(0,0,s,a);c.addColorStop(0,"#05051A"),c.addColorStop(.2,"#08082B"),c.addColorStop(.4,"#001233"),c.addColorStop(.6,"#002000"),c.addColorStop(.8,"#001400"),c.addColorStop(1,"#000A00"),e.fillStyle=c,e.fillRect(0,0,i.width,i.height),e.save(),e.scale(8,8),e.globalAlpha=.4,S(e,5.05*l,-5*l,"black",!1,!1),e.restore(),(e=>{const t=o.s;e.font=P(24*t),e.fillStyle="#fff",e.textAlign="center",e.fillText("Puzzle black cat combat",200*t,80*t),e.font=P(20*t),e.fillStyle="#ccc",e.fillText("Slay the Black Cat",200*t,110*t);const i=24*t;e.font=P(12*t),e.fillStyle="#ccf",["Click or drag adjacent cats to match 3+ of","the same color horizontally or vertically. ","Defeat the Black Cat at Level 13!"].forEach((l,o)=>{e.fillText(l,200*t,160*t+o*i)})})(e),e.save(),e.scale(.7,.7),["red","yellow","blue","green","white"].forEach((t,i)=>{S(e,(170+48*i)*l,331*l,t,!1,!1)}),e.restore();const r=((e,t,i,l,n=!1)=>{const s=o.s,a=110*s,c=250*s,r=180*s,f=60*s;e.fillStyle=n?"#666":"#404",e.fillRect(a,c,r,f),e.strokeStyle=n?"#fff":"#ccc",e.lineWidth=n?2*s:1*s,e.strokeRect(a,c,r,f),e.fillStyle=n?"#ff0":"#fff",e.font=b(28*s),e.textAlign="center";const d=e.measureText(l);return e.fillText(l,a+r/2,c+f/2+(d.actualBoundingBoxAscent-d.actualBoundingBoxDescent)/2),{x:a-5*s,y:c-5*s,width:r+10*s,height:f+10*s}})(e,0,0,"Play",2===o.hNBtn);return(e,i)=>t(e,i,r)?2:0},x=(e,t)=>{2===e&&(o.cs="M",t(.016))},C=(e,i,n=.016)=>{e.clearRect(0,0,i.width,i.height);const s=o.s,r=80*s,f=30*Math.PI/180,d=i.width*Math.cos(f),h=i.width*Math.sin(f),T=e.createLinearGradient(0,0,d,h);T.addColorStop(0,"#05051A"),T.addColorStop(.2,"#08082B"),T.addColorStop(.4,"#661288"),T.addColorStop(.6,"#cc20cc"),T.addColorStop(.8,"#cc14ff"),T.addColorStop(1,"#cc00aa"),e.fillStyle=T,e.fillRect(0,0,400*s,r);const x=80*s,C=6*s,H=70*s,M=51*s,w=250*s,L=51*s;e.save(),e.scale(1.3,1.3),S(e,9*s,11*s,"white",!1,!1),e.restore(),e.save(),e.scale(1.8,1.8),S(e,180.8*s,0*s,"black",!1,!1),e.restore();const A=100*a.playerLevel,E=100*a.bossLevel;e.fillStyle="#666",e.fillRect(H,M,x,C);const z=a.playerHP/A*x;e.fillStyle="#0f0",e.fillRect(H,M,z,C),e.fillStyle="#0f0",e.font=b(12*s),e.textAlign="left",e.fillText(`HP: ${a.playerHP}/${A}`,H,M-5*s),e.fillStyle="#666",e.fillRect(w,L,x,C);const R=a.bossHP/E*x;e.fillStyle="#0f0",e.fillRect(w+(E-a.bossHP)/E*x,L,R,C),e.fillStyle="#0f0",e.textAlign="right",e.fillText(`HP: ${a.bossHP}/${E}`,w+x,L-5*s),e.fillStyle="#f39c12",e.font=P(12*s),e.textAlign="center",e.fillText("Score",200*s,45*s),e.font=b(12*s),e.fillText(`${a.score}`,200*s,58*s),e.fillStyle="#bbb",e.font=b(10*s),e.fillText("Player",37.5*s,70*s),e.fillText("Black Cat",361.5*s,70*s),e.font=P(9*s),e.fillStyle="#ccf",e.fillText(`Lv${a.playerLevel}`,37.5*s,20*s),e.fillText(`Lv${a.bossLevel}`,361.5*s,20*s),e.textAlign="left";const B=o.gridX*o.pieceSize*s,k=o.gridY*o.pieceSize*s,F=80*s,Y=((e,t,i,l=1)=>{const n=o.s;return e.strokeStyle="#ffc",e.lineWidth=1*n,e.beginPath(),e.moveTo(t,i+6*n),e.lineTo(t+8*n,i),e.lineTo(t+16*n,i+6*n),e.lineTo(t+16*n,i+16*n),e.lineTo(t+10.5*n,i+16*n),e.lineTo(t+10.5*n,i+10*n),e.lineTo(t+5.5*n,i+10*n),e.lineTo(t+5.5*n,i+16*n),e.lineTo(t,i+16*n),e.lineTo(t,i+6*n),e.closePath(),e.stroke(),{x:(t-2*n)*l,y:(i-2*n)*l,width:20*n*l,height:20*n*l}})(e,192*s,12*s);e.fillStyle="#34495e",e.fillRect(0,F,B,k),e.strokeStyle="#2c3e50",e.lineWidth=1*s;for(let t=0;t<=o.gridX;t++){const i=0+t*o.pieceSize*s;e.beginPath(),e.moveTo(i,F),e.lineTo(i,F+k),e.stroke()}for(let t=0;t<=o.gridY;t++){const i=F+t*o.pieceSize*s;e.beginPath(),e.moveTo(0,i),e.lineTo(0+B,i),e.stroke()}0===a.grid.length&&c(),a.isAnimating&&("fall"===a.animationType?y(n):"delay"===a.animationType&&u(n)),p(n),g(n);for(let t=0;t<o.gridY;t++)for(let i=0;i<o.gridX;i++){const l=a.grid[t][i];if(!l.isEmpty){let n=0+i*o.pieceSize*s,c=F+t*o.pieceSize*s;if(a.isAnimating&&"fall"===a.animationType&&a.fallingPieces&&a.fallingPieces[i]&&void 0!==a.fallingPieces[i][t]&&(c+=a.fallingPieces[i][t]*a.animationProgress*o.pieceSize*s),a.isAnimating&&"swap"===a.animationType&&a.swappingPieces){const{x1:e,y1:l,x2:r,y2:f}=a.swappingPieces;if(i===e&&t===l||i===r&&t===f){const d=a.animationProgress;n+=((i===e?r:e)-i)*o.pieceSize*s*d,c+=((t===l?f:l)-t)*o.pieceSize*s*d}}if(e.fillStyle="#2c3e50",e.fillRect(n,c,o.pieceSize*s,o.pieceSize*s),S(e,n,c,l.color),a.selectedPiece&&a.selectedPiece.x===i&&a.selectedPiece.y===t){e.strokeStyle="#f39c12",e.lineWidth=3*s;const t=e.lineWidth/2;e.strokeRect(n+t,c+t,o.pieceSize*s-e.lineWidth,o.pieceSize*s-e.lineWidth)}}}if(a.activeCombos&&a.activeCombos.length>0&&a.activeCombos.forEach(t=>{const i=t.x*s,l=t.y*s,o=1-t.progress;e.save(),e.globalAlpha=o,e.font=b(28*s),e.textAlign="center",e.textBaseline="middle";let n=`${t.color} x ${t.count}`;t.multiplier>1&&(n+=` x${t.multiplier}`),e.fillStyle="#000000"===t.displayColor?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",e.fillText(n,i+1*s,l+1*s),e.fillStyle=t.displayColor,e.fillText(n,i,l),e.restore()}),a.activeHPChanges&&a.activeHPChanges.length>0&&a.activeHPChanges.forEach(t=>{const i=t.x*s,l=t.isHeal?-15*s:15*s,o=t.y*s-8*s-30*t.progress*s,n=1-t.progress;e.save(),e.globalAlpha=n,e.font=b(20*s),e.textAlign="center",e.textBaseline="middle";const a=t.isHeal?`+${t.value}`:`-${t.value}`;e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillText(a,i+l+2*s,o+2*s),e.fillStyle=t.isHeal?"#00FF00":"#FF0000",e.fillText(a,i+l,o),e.restore()}),a.showLevelUp){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,i.width,i.height),e.fillStyle="#f1c40f",e.font=P(28*s),e.textAlign="center",e.fillText("LEVEL UP!",200*s,150*s),e.fillStyle="#ffffff",e.font=P(18*s),e.fillText(`Level ${a.playerLevel-1} → Level ${a.playerLevel}`,200*s,190*s),e.fillText("HP Max: "+100*a.playerLevel,200*s,220*s);const o=120*s,n=40*s,c=140*s,r=260*s;return l(e,c,r,o,n,8*s),e.fillStyle="#3498db",e.fill(),e.fillStyle="#ffffff",e.font=P(14*s),e.fillText("CONTINUE",c+o/2,r+n/2+5*s),(e,i)=>t(e,i,{x:c,y:r,width:o,height:n})?(a.showLevelUp=!1,500):0}if(v()&&a.gameResult){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,i.width,i.height),e.fillStyle="#ffffff",e.font=P(24*s),e.textAlign="center","win"===a.gameResult?(e.fillStyle="#f1c40f",e.fillText("VICTORY!",200*s,150*s),e.fillStyle="#ffffff",e.font=P(16*s),e.fillText("You defeated the Black Cat at Level 13!",200*s,190*s)):(e.fillStyle="#e74c3c",e.fillText("GAME OVER",200*s,150*s),e.fillStyle="#ffffff",e.font=P(16*s),e.fillText(`The Black Cat defeated you at Level ${a.playerLevel}!`,200*s,190*s)),e.fillText(`Final Score: ${a.score}`,200*s,230*s);const o=120*s,n=40*s,r=140*s,f=260*s;return l(e,r,f,o,n,8*s),e.fillStyle="#27ae60",e.fill(),e.fillStyle="#ffffff",e.font=P(14*s),e.fillText("RESTART",r+o/2,f+n/2+5*s),(e,i)=>t(e,i,{x:r,y:f,width:o,height:n})?(c(),1e3):0}return(e,i)=>{if(a.isAnimating&&"fall"!==a.animationType)return 0;if(a.showLevelUp)return 0;if(t(e,i,Y))return 2e3;if(e>=0&&e<=0+B&&i>=F&&i<=F+k){const t=Math.floor((e-0)/(o.pieceSize*s)),l=Math.floor((i-F)/(o.pieceSize*s));if(t>=0&&t<o.gridX&&l>=0&&l<o.gridY){if(a.selectedPiece){const e=m(a.selectedPiece.x,a.selectedPiece.y,t,l);return a.selectedPiece=null,e?200:201}return a.selectedPiece={x:t,y:l},100+10*t+l}}return a.selectedPiece=null,0}},H=(e,t)=>{1e3===e?(c(),t(.016)):500===e?t(.016):2e3===e?(o.cs="H",t(.016)):(e>=100&&e<200||e>=200)&&t(.016)},M=function(){const e=document.querySelector("#canvas");if(!e)return{canvas:null,ctx:null,resize:()=>{},draw:()=>{}};const t=e.getContext("2d");if(!t)return{canvas:e,ctx:null,resize:()=>{},draw:()=>{}};t.textBaseline="alphabetic",t.imageSmoothingEnabled=!1;const i=(i=.016)=>{switch(t.clearRect(0,0,e.width,e.height),o.cs){case"H":T(t,e);break;case"M":C(t,e,i)}},{handleMouseMove:l,handleClick:n,handleTouchStart:s,handleTouchMove:a,handleTouchEnd:c}=((e,t)=>{let i=!1,l=0,n=0,s=-1,a=-1,c=!1;return e.addEventListener("mousedown",t=>{i=!0;const c=e.getBoundingClientRect();if(l=t.clientX-c.left,n=t.clientY-c.top,"M"===o.cs){const e=0,t=80*o.s;l>=e&&l<=e+o.gridX*o.pieceSize*o.s&&n>=t&&n<=t+o.gridY*o.pieceSize*o.s&&(s=Math.floor((l-e)/(o.pieceSize*o.s)),a=Math.floor((n-t)/(o.pieceSize*o.s)))}}),e.addEventListener("mouseup",()=>{i=!1,c=!1,s=-1,a=-1}),{handleMouseMove:(e,r,f)=>{const d=f.getBoundingClientRect(),h=e.clientX-d.left,g=e.clientY-d.top;if("M"===o.cs){const e=0,r=80*o.s,d=192*o.s,p=12*o.s;if(h>=e&&h<=e+o.gridX*o.pieceSize*o.s&&g>=r&&g<=r+o.gridY*o.pieceSize*o.s||h>=d&&h<=d+20*o.s&&g>=p&&g<=p+20*o.s){if(f.style.cursor="pointer",i&&!c&&s>=0&&a>=0){const e=h-l,i=g-n,r=o.pieceSize*o.s*.75;if(Math.abs(e)>r||Math.abs(i)>r){c=!0;let l=s,n=a;if(Math.abs(e)>Math.abs(i)?e>0&&s<o.gridX-1?l=s+1:e<0&&s>0&&(l=s-1):i>0&&a<o.gridY-1?n=a+1:i<0&&a>0&&(n=a-1),l!==s||n!==a){const e=m(s,a,l,n);c=!1,s=-1,a=-1,e&&t(.016)}}}}else f.style.cursor="default"}else if("H"===o.cs){const e=T(r,f)(h,g);e?(f.style.cursor="pointer",o.hHBtn=e):(f.style.cursor="default",o.hHBtn=0)}},handleClick:(e,i,l)=>{const n=l.getBoundingClientRect(),s=e.clientX-n.left,a=e.clientY-n.top;if("M"===o.cs){const e=C(i,l)(s,a);e>0&&H(e,t)}else if("H"===o.cs){const e=T(i,l)(s,a);e>0&&x(e,t)}t(.016)},handleTouchStart:(e,t,i)=>{if(e.preventDefault(),e.touches.length>0){const t=i.getBoundingClientRect(),c=e.touches[0],r=c.clientX-t.left,f=c.clientY-t.top;if(l=r,n=f,"M"===o.cs){const e=0,t=80*o.s;r>=e&&r<=e+o.gridX*o.pieceSize*o.s&&f>=t&&f<=t+o.gridY*o.pieceSize*o.s&&(s=Math.floor((r-e)/(o.pieceSize*o.s)),a=Math.floor((f-t)/(o.pieceSize*o.s)))}}},handleTouchMove:(e,i,r)=>{if(e.preventDefault(),e.touches.length>0&&"M"===o.cs&&!c&&s>=0&&a>=0){const i=r.getBoundingClientRect(),f=e.touches[0],d=f.clientX-i.left-l,h=f.clientY-i.top-n,g=o.pieceSize*o.s*.75;if(Math.abs(d)>g||Math.abs(h)>g){c=!0;let e=s,i=a;if(Math.abs(d)>Math.abs(h)?d>0&&s<o.gridX-1?e=s+1:d<0&&s>0&&(e=s-1):h>0&&a<o.gridY-1?i=a+1:h<0&&a>0&&(i=a-1),e!==s||i!==a){const l=m(s,a,e,i);c=!1,s=-1,a=-1,l&&t(.016)}}}},handleTouchEnd:(e,i,l)=>{if(e.preventDefault(),!c){const n=l.getBoundingClientRect(),s=e.changedTouches[0],a=s.clientX-n.left,c=s.clientY-n.top;if("M"===o.cs){const e=C(i,l)(a,c);e>0&&H(e,t)}else if("H"===o.cs){const e=T(i,l)(a,c);e>0&&x(e,t)}t(.016)}c=!1,s=-1,a=-1}}})(e,i);e.addEventListener("mousemove",i=>l(i,t,e)),e.addEventListener("click",i=>n(i,t,e)),e.addEventListener("touchstart",i=>s(i,t,e)),e.addEventListener("touchmove",i=>a(i,t,e)),e.addEventListener("touchend",i=>c(i,t,e)),e.addEventListener("touchstart",e=>e.preventDefault(),{passive:!1}),e.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1});const r=()=>{const l=e.parentElement;if(!l)return;const o=window.devicePixelRatio||1;e.width=l.clientWidth*o,e.height=l.clientHeight*o,e.style.width=l.clientWidth+"px",e.style.height=l.clientHeight+"px",t.scale(o,o),i(.016)};return r(),{canvas:e,ctx:t,resize:r,draw:i}}();if(!M)throw new Error("Canvas setup failed");const{canvas:w,draw:L,resize:A}=M,E=()=>{const e=document.querySelector("#can-con"),t=document.querySelector("#app");if(!e||!t)return;const i=Math.min(t.offsetWidth,t.offsetHeight);e.style.width=`${i}px`,e.style.height=`${i}px`,o.s=i/o.baseW,w&&A()};(()=>{E();let e=performance.now();const t=()=>{const i=performance.now(),l=(i-e)/1e3;if(e=i,p(l),v()&&a.gameResult)return L(l),void requestAnimationFrame(t);!(a.bossHP<=0)||a.isAnimating||a.activeCombos&&0!==a.activeCombos.length||v(),a.isAnimating&&("fall"===a.animationType?y(l):"swap"===a.animationType?function(e){if(a.isAnimating&&"swap"===a.animationType&&a.swappingPieces&&(a.animationProgress+=4*e,a.animationProgress>=1)){const{x1:e,y1:t,x2:i,y2:l}=a.swappingPieces,o=a.grid[t][e];a.grid[t][e]=a.grid[l][i],a.grid[l][i]=o,a.grid[t][e].x=e,a.grid[t][e].y=t,a.grid[l][i].x=i,a.grid[l][i].y=l;const n=f();if(n.length>0){const e=Math.floor(5*Math.random())+2,t=Math.floor(4*Math.random())+2,i=a.playerHP;a.playerHP=Math.max(0,a.playerHP-(e+(a.playerLevel-1)*t));const l=i-a.playerHP;l>0&&h(l,110,32.5,!1),d(n)}else{const e=Math.floor(4*Math.random())+2,t=Math.floor(3*Math.random())+2,i=a.playerHP;a.playerHP=Math.max(0,a.playerHP-(e+(a.playerLevel-1)*t));const l=i-a.playerHP;l>0&&h(l,110,32.5,!1),a.animationType="delay",a.animationProgress=0,a.swappingPieces=void 0}}}(l):"delay"===a.animationType&&u(l)),(a.isAnimating||a.showLevelUp)&&L(l),requestAnimationFrame(t)};t()})(),window.addEventListener("resize",()=>{E()})</script>