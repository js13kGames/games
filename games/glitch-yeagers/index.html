<!doctype html><meta name=viewport content="width=device-width"><title>Glitch Yeagers - js13kGames 2016</title><style>body,html{margin:0;padding:0;overflow:hidden}canvas{position:fixed;width:100%;height:100%}</style><canvas id=Canvas>Sorry, this browser cannot render this content.</canvas><script id=VertexShader type=x-shader/x-vertex>attribute vec3 vertex;
attribute vec3 normal;
uniform mat4 mvp;
uniform mat4 mm;
uniform vec3 light;
varying mediump float intensity;
varying mediump float z;
void main() {
gl_Position = mvp * vec4(vertex, 1.0);
z = gl_Position.z;
intensity = max(.0, dot(
normalize(mat3(
mm[0][0], mm[0][1], mm[0][2],
mm[1][0], mm[1][1], mm[1][2],
mm[2][0], mm[2][1], mm[2][2]) * normal),
normalize(light)));
}</script><script id=FragmentShader type=x-shader/x-fragment>#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform float brightness;
uniform float far;
uniform vec4 sky;
uniform vec4 color;
varying mediump float intensity;
varying mediump float z;
void main() {
float f = z / far;
gl_FragColor =
(1.0 - f) * color * (.3 + intensity * .7) * brightness +
f * sky;
}</script><script>var gl,pm,program,models,bulletsStart,bulletsLength,debrisStart,debrisLength,jetsStart,jetsLength,player,width,height,now,factor,last,pointersLength,M=Math,D=document,W=window,FA=Float32Array,im=new FA([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),vm=new FA(im),cm=new FA(16),sm=new FA(16),m=new FA(16),far=1e3,sky=[.2,.5,.8,1],light=[.5,.5,1],brightness=1,objectsLength=0,objects=[],pointersX=[],pointersY=[],keysDown=[],colorWhite=[1,1,1,1],colorRed=[1,0,0,1],colorGreen=[0,1,0,1],colorBlue=[0,0,1,1],colorYellow=[1,1,0,1],invertedSky=[.8,.5,.2,1];function invert(e,t){var r=t[0],o=t[1],n=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],u=t[8],m=t[9],g=t[10],f=t[11],h=t[12],p=t[13],d=t[14],v=t[15],y=r*i-o*l,b=r*s-n*l,w=r*c-a*l,M=o*s-n*i,A=o*c-a*i,D=n*c-a*s,S=u*p-m*h,F=u*d-g*h,R=u*v-f*h,L=m*d-g*p,E=m*v-f*p,x=g*v-f*d,k=y*x-b*E+w*L+M*R-A*F+D*S;if(!k)return null;k=1/k,e[0]=(i*x-s*E+c*L)*k,e[1]=(n*E-o*x-a*L)*k,e[2]=(p*D-d*A+v*M)*k,e[3]=(g*A-m*D-f*M)*k,e[4]=(s*R-l*x-c*F)*k,e[5]=(r*x-n*R+a*F)*k,e[6]=(d*w-h*D-v*b)*k,e[7]=(u*D-g*w+f*b)*k,e[8]=(l*E-i*R+c*S)*k,e[9]=(o*R-r*E-a*S)*k,e[10]=(h*A-p*w+v*y)*k,e[11]=(m*w-u*A-f*y)*k,e[12]=(i*F-l*L-s*S)*k,e[13]=(r*L-o*F+n*S)*k,e[14]=(p*b-h*M-d*y)*k,e[15]=(u*M-m*b+g*y)*k}function multiply(e,t,r){var o=t[0],n=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],m=t[8],g=t[9],f=t[10],h=t[11],p=t[12],d=t[13],v=t[14];t=t[15];var y=r[0],b=r[1],w=r[2],M=r[3];e[0]=y*o+b*i+w*m+M*p,e[1]=y*n+b*s+w*g+M*d,e[2]=y*a+b*c+w*f+M*v,e[3]=y*l+b*u+w*h+M*t,y=r[4],b=r[5],w=r[6],M=r[7],e[4]=y*o+b*i+w*m+M*p,e[5]=y*n+b*s+w*g+M*d,e[6]=y*a+b*c+w*f+M*v,e[7]=y*l+b*u+w*h+M*t,y=r[8],b=r[9],w=r[10],M=r[11],e[8]=y*o+b*i+w*m+M*p,e[9]=y*n+b*s+w*g+M*d,e[10]=y*a+b*c+w*f+M*v,e[11]=y*l+b*u+w*h+M*t,y=r[12],b=r[13],w=r[14],M=r[15],e[12]=y*o+b*i+w*m+M*p,e[13]=y*n+b*s+w*g+M*d,e[14]=y*a+b*c+w*f+M*v,e[15]=y*l+b*u+w*h+M*t}function rotate(e,t,r,o,n,a){var l,i,s,c,u,m,g,f,h,p,d,v,y,b,w,A,D,S,F,R,L=M.sqrt(o*o+n*n+a*a);1e-6>M.abs(L)||(o*=L=1/L,n*=L,a*=L,l=M.sin(r),s=1-(i=M.cos(r)),r=t[0],L=t[1],c=t[2],u=t[3],m=t[4],g=t[5],f=t[6],h=t[7],p=t[8],d=t[9],v=t[10],y=t[11],b=o*o*s+i,w=n*o*s+a*l,A=a*o*s-n*l,D=o*n*s-a*l,S=n*n*s+i,F=a*n*s+o*l,R=o*a*s+n*l,o=n*a*s-o*l,a=a*a*s+i,e[0]=r*b+m*w+p*A,e[1]=L*b+g*w+d*A,e[2]=c*b+f*w+v*A,e[3]=u*b+h*w+y*A,e[4]=r*D+m*S+p*F,e[5]=L*D+g*S+d*F,e[6]=c*D+f*S+v*F,e[7]=u*D+h*S+y*F,e[8]=r*R+m*o+p*a,e[9]=L*R+g*o+d*a,e[10]=c*R+f*o+v*a,e[11]=u*R+h*o+y*a,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}function scale(e,t,r,o,n){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}function translate(e,t,r,o,n){var a,l,i,s,c,u,m,g,f,h,p,d;t===e?(e[12]=t[0]*r+t[4]*o+t[8]*n+t[12],e[13]=t[1]*r+t[5]*o+t[9]*n+t[13],e[14]=t[2]*r+t[6]*o+t[10]*n+t[14],e[15]=t[3]*r+t[7]*o+t[11]*n+t[15]):(a=t[0],l=t[1],i=t[2],s=t[3],c=t[4],u=t[5],m=t[6],g=t[7],f=t[8],h=t[9],p=t[10],d=t[11],e[0]=a,e[1]=l,e[2]=i,e[3]=s,e[4]=c,e[5]=u,e[6]=m,e[7]=g,e[8]=f,e[9]=h,e[10]=p,e[11]=d,e[12]=a*r+c*o+f*n+t[12],e[13]=l*r+u*o+h*n+t[13],e[14]=i*r+m*o+p*n+t[14],e[15]=s*r+g*o+d*n+t[15])}function drawModel(e,t,r,o){multiply(m,vm,e),multiply(m,pm,m),gl.uniformMatrix4fv(r.mvp,gl.FALSE,m),gl.uniformMatrix4fv(r.mm,gl.FALSE,e),gl.uniform4fv(r.color,o),gl.drawElements(gl.TRIANGLES,t.numberOfVertices,gl.UNSIGNED_SHORT,0)}function bindModel(e,t){gl.bindBuffer(gl.ARRAY_BUFFER,t.vertices),gl.vertexAttribPointer(e.vertex,3,gl.FLOAT,gl.FALSE,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t.normals),gl.vertexAttribPointer(e.normal,3,gl.FLOAT,gl.FALSE,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,t.indicies)}function destruct(e){if(e.show){e.show=!1;for(var t=6,r=debrisLength+debrisStart;r-- >debrisStart;){var o=objects[r];if(!o.show){var n=e.matrix,a=o.matrix,l=.1+.2*M.random();if(translate(a,im,n[12],n[13],n[14]),o.rot.x=M.random(),o.rot.y=M.random(),o.rot.z=M.random(),rotate(a,a,M.random()*M.TAU,o.rot.x,o.rot.y,o.rot.z),scale(a,a,l,l,l),o.vel.x=.1*(M.random()-.5),o.vel.y=.1*(M.random()-.8),o.vel.z=-.1*M.random(),o.rot.a=.001*M.random(),o.show=!0,o.hideAt=now+2e3,1>--t)break}}}}function sqDist(e,t){var r=e[12]-t[12],o=e[13]-t[13],n=e[14]-t[14];return r*r+o*o+n*n}function flyTo(e,t,r,o,n,a){invert(m,t),t=m[0]*r+m[4]*o+m[8]*n+m[12]*a;var l=m[1]*r+m[5]*o+m[9]*n+m[13]*a;return o=m[2]*r+m[6]*o+m[10]*n+m[14]*a,r=M.PI2-M.atan2(l,t),t=M.atan2(M.sqrt(t*t+l*l),-o),rotate(e,e,-.01*r*factor,0,0,1),rotate(e,e,.01*t*factor,1,0,0),t}function fire(e){if(!(e.reloadingUntil>now))for(var t=bulletsLength+bulletsStart;t-- >bulletsStart;){var r=objects[t];if(!r.show){translate(r.matrix,e.matrix,0,0,-3.5),r.vel.x=0,r.vel.y=0,r.vel.z=-1.5,r.show=!0,r.hideAt=now+2e3,e.reloadingUntil=now+100;break}}}function plot(e,t,r,o,n,a){var l=e.matrix,i=e.vel,s=e.rot;if(e.attack&&player.show){var c=l[13];if(5>c)return void destruct(e);20>c?flyTo(l,l,0,100,0,1):(r=flyTo(l,l,r,o,n,a),1e4>sqDist(l,t)&&.25>r&&fire(e))}translate(l,l,i.x*factor,i.y*factor,i.z*factor),s&&rotate(l,l,s.a,s.x,s.y,s.z)}function draw(){var e,t,r=player.matrix,o=r[12],n=r[13],a=r[14],l=r[15];0<n?(e=sky,t=colorGreen):(e=invertedSky,t=colorRed),gl.clearColor(e[0],e[1],e[2],e[3]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.useProgram(program);var i,s=program.uniforms,c=program.attribs;for(gl.uniform3fv(s.light,light),gl.uniform4fv(s.sky,e),gl.uniform1f(s.brightness,brightness),gl.uniform1f(s.far,far),e=objectsLength;e--;){var u=objects[e];if(u.show){i!=u.model&&bindModel(c,i=u.model),drawModel(u.matrix,i,s,0==e?t:u.color);var m=u.hideAt;0<m&&m<now?u.show=!1:u!==player&&u.vel&&plot(u,r,o,n,a,l)}}}function checkHits(){for(var e=bulletsLength+bulletsStart;e-- >bulletsStart;){var t=objects[e];if(t.show)for(var r=(n=t.matrix)[12],o=n[13],n=n[14],a=jetsLength+jetsStart;a-- >jetsStart;){var l=objects[a];if(l.show){var i=l.matrix,s=i[13],c=i[14];1>M.abs(r-i[12])&&1>M.abs(o-s)&&1>M.abs(n-c)&&(destruct(t),destruct(l))}}}}function updatePose(){var e=player.matrix,t=player.pitch-player.pitchValue,r=player.yaw-player.yawValue,o=player.roll-player.rollValue;translate(e,cm,0,0,-4),1e-4<M.abs(o)&&(player.rollValue+=.1*o*factor,rotate(e,e,player.rollValue,0,0,1)),1e-4<M.abs(r)&&(player.yawValue+=.1*vd*factor,rotate(e,e,player.yawValue,0,1,0)),1e-4<M.abs(t)&&(player.pitchValue+=.1*t*factor,rotate(e,e,player.pitchValue,1,0,0))}function turn(e,t,r,o){rotate(m,im,e,t,r,o),multiply(vm,m,vm),0!==t&&(player.pitch=-20*e),0!==r&&(player.yaw=-20*e),0!==o&&(player.roll=-20*e)}function input(){if(player.show){var e=.05*factor;keysDown[87]?player.speed=M.min(player.speed+e,.6):keysDown[83]&&(player.speed=M.max(player.speed-e,.2)),translate(m,im,0,0,player.speed),multiply(vm,m,vm),e=(.025-.0375*(player.speed-.2))*factor,player.pitch=player.yaw=player.roll=0,0<pointersLength?(-.5>pointersX[0]?turn(-e,0,0,1):.5<pointersX[0]&&turn(e,0,0,1),-.5>pointersY[0]?turn(-e,1,0,0):.5<pointersY[0]&&turn(e/4,1,0,0)):(keysDown[37]?turn(-e,0,0,1):keysDown[39]&&turn(e,0,0,1),keysDown[38]?turn(e/4,1,0,0):keysDown[40]&&turn(-e,1,0,0)),invert(cm,vm),updatePose(),checkHits(),e=player.matrix[13],keysDown[32]||1<pointersLength?5<e&&fire(player):5>e&&destruct(player)}}function run(){requestAnimationFrame(run),now=Date.now(),factor=(now-last)/16,last=now,input(),draw()}function setPointer(e,t){if(t)if(e.touches)for(var r=e.touches,o=pointersLength=r.length;o--;){var n=r[o];pointersX[o]=n.pageX,pointersY[o]=n.pageY}else pointersLength=1,pointersX[0]=e.pageX,pointersY[0]=e.pageY;else pointersLength=e.touches?e.touches.length:0;for(r=2/width,n=2/height,o=pointersLength;o--;)pointersX[o]=pointersX[o]*r-1,pointersY[o]=-(pointersY[o]*n-1);e.preventDefault()}function pointerUp(e){setPointer(e,!1)}function pointerMove(e){setPointer(e,pointersLength)}function pointerDown(e){setPointer(e,!0)}function setKey(e,t){keysDown[e.keyCode]=t,e.preventDefault()}function keyUp(e){setKey(e,!1)}function keyDown(e){setKey(e,!0)}function resize(){width=gl.canvas.clientWidth,height=gl.canvas.clientHeight,gl.canvas.width=width,gl.canvas.height=height,gl.viewport(0,0,width,height);var e=width/height,t=.1-far,r=1/M.tan(.125*M.PI);pm=new FA([r/e,0,0,0,0,r,0,0,0,0,(far+.1)/t,-1,0,0,.2*far/t,0]),invert(cm,vm)}function cacheUniformLocations(e,t){void 0===e.uniforms&&(e.uniforms={});for(var r=0,o=t.length;r<o;++r){var n=t[r];e.uniforms[n]=gl.getUniformLocation(e,n)}}function cacheAttribLocations(e,t){void 0===e.attribs&&(e.attribs={});for(var r=0,o=t.length;r<o;++r){var n=t[r];e.attribs[n]=gl.getAttribLocation(e,n),gl.enableVertexAttribArray(e.attribs[n])}}function compileShader(e,t){var r=gl.createShader(t);return gl.shaderSource(r,e),gl.compileShader(r),gl.getShaderParameter(r,gl.COMPILE_STATUS)?r:null}function linkProgram(e,t){var r;return(r=gl.createProgram())&&(gl.attachShader(r,e),gl.attachShader(r,t),gl.linkProgram(r),gl.getProgramParameter(r,gl.LINK_STATUS)||(gl.deleteProgram(r),r=null)),r}function buildProgram(e,t){var r,o,n;return(o=compileShader(e,gl.VERTEX_SHADER))&&((n=compileShader(t,gl.FRAGMENT_SHADER))&&(r=linkProgram(o,n),gl.deleteShader(n)),gl.deleteShader(o)),r}function calculateNormals(e,t){for(var r=[],o=0,n=t.length;o<n;){var a=3*t[o++],l=3*t[o++],i=3*t[o++],s=e[a],c=e[a+1],u=e[a+2],m=e[l]-s,g=e[l+1]-c,f=e[l+2]-u,h=(s=e[i]-s,c=e[i+1]-c,e[i+2]-u);u=g*h-f*c,f=f*s-m*h,m=m*c-g*s;r[a]=u,r[a+1]=f,r[a+2]=m,r[l]=u,r[l+1]=f,r[l+2]=m,r[i]=u,r[i+1]=f,r[i+2]=m}return r}function createModel(e,t){var r={numberOfVertices:t.length};return r.vertices=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r.vertices),gl.bufferData(gl.ARRAY_BUFFER,new FA(e),gl.STATIC_DRAW),r.normals=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r.normals),gl.bufferData(gl.ARRAY_BUFFER,new FA(calculateNormals(e,t)),gl.STATIC_DRAW),r.indicies=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,r.indicies),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),gl.STATIC_DRAW),r}function createTriangle(){return createModel([0,1,0,-1,-1,0,1,-1,0],[0,1,2])}function createPlane(){return createModel([-1,1,0,-1,-1,0,1,1,0,1,-1,0],[0,2,1,2,3,1])}function createBullet(){return createModel([0,.05,0,.05,0,0,0,-.05,0,-.05,0,0,0,0,.7],[0,1,2,2,3,0,0,4,1,1,4,2,2,4,3,3,4,0])}function createJet(){for(var e=[.160713,-.079566,.308486,.160713,-.03535,.308486,.141574,-.076788,-.428799,.141574,-.038128,-.428799,.044415,-.064979,-1.002609,.044415,-.054442,-1.002609,.137133,-.071677,.561634,.137133,-.043239,.561634,.734764,-.066573,.27579,.734764,-.048343,.27579,.710531,-.065557,.126651,.710531,-.049359,.126651,.111385,-.068833,.814783,.111385,-.046083,.814783,.437837,-.065587,.793524,.437837,-.049329,.793524,.447748,-.063962,.866828,.447748,-.050954,.866828,.106927,.058309,.300239,.094546,.014669,-.585247,.031598,-.024898,-1.004654,.091673,.053199,.546369,.075369,.02249,.821219,.093902,-.173471,.293002,.082845,-.144193,-.525104,.027693,-.115441,-.981081,.016848,.075065,.336714,.08028,-.157591,.554191,.06438,-.134058,.818955,.030287,.072383,.652842,.026017,.056262,.851769,.003935,.431639,.625258,.00784,.428957,.776011,.00593,.412836,.826948,.060856,.023202,-.536708,.068396,.049776,-.193999,.029756,.084168,-.426948,.032827,.085887,-.321909,.039074,-.044549,-.145049,.039074,-.037679,-.145049,.028199,-.016973,-.143105,.02488,-.064244,-.143789,.013297,-.006776,-.133881,.044415,-.064979,-1.002609,.044415,-.054442,-1.002609,.031598,-.024898,-1.004654,.027693,-.115441,-.981081,.026041,-.064593,-.249896,.026041,-.058611,-.249896,.018764,-.041837,-.240374,.016547,-.093244,-.237674,0,-.144193,-.525104,0,.085887,-.321909,0,-.115441,-.981081,0,-.006776,-.133881,0,-.041837,-.240374,0,.058309,.300239,0,-.134058,.818955,0,.412836,.826948,0,.049776,-.193999,0,.056262,.851769,0,.084168,-.426948,0,-.024898,-1.004654,0,-.173471,.293002,0,.075065,.336714,0,.428957,.776011,0,-.064244,-.143789,0,.014669,-.585247,0,.023202,-.536708,0,-.157591,.554191,0,.431639,.625258,0,-.024898,-1.004654,0,-.093244,-.237674,0,-.115441,-.981081],t=[0,10,8,20,44,45,6,28,27,5,43,44,4,24,25,1,21,7,1,11,3,7,22,13,10,9,8,0,9,1,7,0,1,10,3,11,5,2,4,7,14,6,15,16,14,12,14,16,12,17,13,13,15,7,67,34,19,22,29,30,3,18,1,5,19,3,24,63,51,51,25,24,0,27,23,2,23,24,73,50,46,29,31,32,22,42,40,21,26,29,56,26,18,65,33,32,31,65,32,64,31,26,29,33,30,19,35,18,68,36,34,34,37,35,12,41,28,13,40,39,13,38,12,60,42,30,40,54,66,4,46,43,25,73,46,46,47,43,45,48,49,43,48,44,52,36,61,67,20,71,63,27,69,60,33,58,56,35,59,59,37,52,57,41,66,69,28,57,62,49,55,0,2,10,20,5,44,6,12,28,5,4,43,4,2,24,1,18,21,1,9,11,7,21,22,10,11,9,0,8,9,7,6,0,10,2,3,5,3,2,7,15,14,15,17,16,12,6,14,12,16,17,13,17,15,67,68,34,22,21,29,3,19,18,5,20,19,24,23,63,51,53,25,0,6,27,2,0,23,73,72,50,29,26,31,22,30,42,21,18,26,56,64,26,65,58,33,31,70,65,64,70,31,29,32,33,19,34,35,68,61,36,34,36,37,12,38,41,13,22,40,13,39,38,60,54,42,41,38,39,39,40,66,42,54,40,66,41,39,4,25,46,25,53,73,46,50,47,45,44,48,43,47,48,52,37,36,67,19,20,63,23,27,60,30,33,56,18,35,59,35,37,57,28,41,69,27,28,62,45,49],r=e.length/3,o=0,n=e.length;o<n;)e.push(-e[o++]),e.push(e[o++]),e.push(e[o++]);for(o=0,n=t.length;o<n;o+=3)t.push(r+t[o+2]),t.push(r+t[o+1]),t.push(r+t[o]);return createModel(e,t)}function createGround(){for(var e=[],t=[],r=-50;50>r;++r)for(var o=-50;50>o;++o)e.push(o+.5*(M.random()-.5)),e.push(0+10*(M.random()-.5)),e.push(r+.5*(M.random()-.5));for(var n=[],a=0,l=(r=-50,[0,1,100,1,101,100]);49>r;++r){for(o=-50;49>o;++o){for(var i=0;6>i;++i){var s=3*(l[i]+a);n.push(e[s]),n.push(e[s+1]),n.push(e[s+2])}++a}++a}for(a=0,e=n.length/3;a<e;++a)t.push(a);return createModel(n,t)}function createObjects(){var e=createGround(),t=createJet(),r=createBullet();createPlane();var o=createTriangle();for(scale(m,im,30,1,30),objects.push({show:!0,model:e,matrix:new FA(m),color:colorGreen}),bulletsStart=objects.length,bulletsLength=10,rotate(m,im,M.PI2,1,0,0),scale(m,m,.1,.1,.2),e=bulletsLength;e--;)objects.push({show:!1,model:r,matrix:new FA(m),color:colorRed,vel:{}});for(debrisStart=objects.length,e=debrisLength=100;e--;)objects.push({show:!1,model:o,matrix:new FA(im),color:colorWhite,vel:{},rot:{}});for(jetsStart=objects.length,e=10;e--;)r=20*M.random()-10,o=10*M.random()-5+100,translate(m,im,r=0>r?r-5:r+5,o=0>o?o-5:o+5,-10*(e+1)),rotate(m,m,M.random()*M.TAU,M.random(),M.random(),M.random()),objects.push({show:!0,attack:!0,model:t,matrix:new FA(m),color:colorRed,vel:{x:0,y:0,z:-.2-.2*M.random()}});translate(vm,vm,0,-100,0),objects.push(player={show:!0,model:t,matrix:new FA(m),color:colorWhite,speed:.2,pitchValue:0,yawValue:0,rollValue:0}),jetsLength=objects.length-jetsStart,objectsLength=objects.length}function getContext(){for(var e,t=D.getElementById("Canvas"),r=["webgl","experimental-webgl"],o=r.length,n=0;n<o;++n)if(e=t.getContext(r[n],{alpha:!1}))return e}function init(){(gl=getContext())&&(program=buildProgram(D.getElementById("VertexShader").textContent,D.getElementById("FragmentShader").textContent))?(createObjects(),cacheAttribLocations(program,["vertex","normal"]),cacheUniformLocations(program,"mvp mm light color sky brightness far".split(" ")),gl.enable(gl.DEPTH_TEST),gl.clearColor(sky[0],sky[1],sky[2],sky[3]),W.onresize=resize,resize(),D.onkeydown=keyDown,D.onkeyup=keyUp,D.onmousedown=pointerDown,D.onmousemove=pointerMove,D.onmouseup=pointerUp,D.onmouseout=pointerUp,"ontouchstart"in D&&(D.ontouchstart=pointerDown,D.ontouchmove=pointerMove,D.ontouchend=pointerUp,D.ontouchleave=pointerUp,D.ontouchcancel=pointerUp),last=Date.now()-16,run()):alert("WebGL not available")}M.PI2=M.PI2||M.PI/2,M.TAU=M.TAU||2*M.PI,W.onload=init</script>