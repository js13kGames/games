<!doctype html><meta content="width=device-width" name=viewport><title>Mold</title><div id=app></div><script>var _=Object.defineProperty,S=(e,t,i)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t,i)=>(S(e,"symbol"!=typeof t?t+"":t,i),i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class x{constructor(e,t){a(this,"id"),a(this,"tIndex"),this.tIndex=e,this.id=t}get index(){return this.tIndex}set index(e){this.tIndex=e,this.setHooks()}setHooks(){this.setStateAttr()}setStateAttr(){let e=document.querySelector("#"+this.id);switch(this.index){case 0:e.className="grid grid-active",e.style.opacity="1";break;case 1:e.className="grid grid-active mold";break;case 2:e.className+=" attractor";break;case 3:e.className+=" wall"}}}class u{constructor(e,t){a(this,"x"),a(this,"y"),this.x=e,this.y=t}add(e){return new u(this.x+e[0],this.y+e[1])}}class m{constructor(e,t){a(this,"id"),a(this,"_sIndex"),a(this,"coord"),a(this,"n_opacity"),this.id=e,this.coord=t,this._sIndex=new x(0,this.id),this.n_opacity=1}get opacity(){return this.n_opacity}set opacity(e){this.n_opacity=e;let t=document.getElementById(this.id);t&&(t.style.opacity=e.toString())}get state(){return this._sIndex.index}set state(e){0!=this.state&&0!=e||(this._sIndex.index=e,this.setHooks())}setHooks(){}surrounding(){let e=[];return[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]].forEach((t=>{let r=this.coord.add(t),n=w(`grid-${r.x}-${r.y}`);n>-1&&e.push(i.gridArr[n])})),e}distanceTo(e){return Math.sqrt(Math.pow(this.coord.x-e.coord.x,2)+Math.pow(this.coord.y-e.coord.y,2))}}function w(e){for(let t=0;t<i.gridArr.length;t++)if(i.gridArr[t].id==e)return t;return-1}function M(){document.querySelectorAll(".grid").forEach((e=>{e.addEventListener("click",b)}))}async function E(){document.querySelectorAll(".grid").forEach((e=>{e.removeEventListener("click",b)}))}function b(e){let t=w(e.target.id),r=i.gridArr[t];r.state=c.player,!(i.attractor.occupied.includes(r)||i.mold.occupied.includes(r)||i.walls.occupied.includes(r))&&i.attractor.occupied.push(r)}function k(){var e,t,r,n,o;if(0==i.attractor.occupied.length)return[null==(t=i.mold)?void 0:t.edges[Math.floor(Math.random()*(null==(e=i.mold)?void 0:e.edges.length))],0];let s=[];null==(r=i.mold)||r.edges.forEach((e=>{var t;null==(t=i.attractor)||t.occupied.forEach((t=>{let i=t.distanceTo(e)+(1-t.opacity)*e.opacity;s.push([e,i])}))}));let a=[void 0,1/0];return s.forEach((e=>{e[1]<a[1]&&(a=e)})),null==a[0]?[null==(o=i.mold)?void 0:o.edges[Math.floor(Math.random()*(null==(n=i.mold)?void 0:n.edges.length))],0]:a}class A{constructor(e){a(this,"source"),a(this,"occupied"),a(this,"p_edges"),this.occupied=[],this.source=e,this.source.forEach((e=>{this.occupied.push(e)})),this.p_edges=this.occupied}calcEdges(){let e=[];return this.occupied.forEach((t=>{let r=!0;"strict"==i.prefs.wall_barrier_type&&t.surrounding().forEach((e=>{3==e.state&&(r=!1)})),r&&t.surrounding().forEach((i=>{0==i.state&&!e.includes(t)&&e.push(t)}))})),this.edges=e,e}get edges(){return this.p_edges=this.calcEdges(),this.p_edges}set edges(e){this.p_edges=e}grow(){let e=k()[0];e instanceof m&&e.surrounding().forEach((e=>{0==e.state&&(this.occupied.push(e),e.state=1)}))}fade(e){this.occupied.forEach((t=>{if(t.opacity-=e,t.opacity<=0){t.opacity=0;let e=this.occupied.indexOf(t);e>-1&&this.occupied.splice(e,1),e=this.p_edges.indexOf(t),e>-1&&this.p_edges.splice(e,1),t.state=0,t.opacity=1}}))}}class L{constructor(){a(this,"occupied"),this.occupied=[]}fade(e){this.occupied.forEach((t=>{if(t.opacity-=e,t.opacity<=0){t.opacity=0;let e=this.occupied.indexOf(t);e>-1&&this.occupied.splice(e,1),t.state=0,t.opacity=1}}))}}async function q(){i.board.innerHTML="",i.gridArr=await I();let e=[];for(let t=0;t<10;t++)e.push(i.gridArr[Math.floor(Math.random()*i.gridArr.length)]);i.mold=new A(e),i.attractor=new L}async function I(){let e=[];for(let t=0;t<i.globaly;t++){i.board.innerHTML+=`<div class='row' id='row-${t}'><div>`;let r=document.querySelector(`#row-${t}`);r.style.height=i.board.clientHeight/i.globaly+"px";for(let n=0;n<i.globalx;n++){const i=`grid-${n}-${t}`;r.innerHTML+=`<div class='grid grid-dead' id='${i}'><div>`;let o=new m(i,new u(n,t));e.push(o)}}return e}function N(e){if(!0===e.state)h("grid-dead","grid-active");else h("grid-active","grid-dead")}function h(e,t){let i=document.getElementsByClassName(e);Array.from(i).forEach((function(i){i.className=i.className.replace(e,t)}))}async function H(e){if(!0===e.state)i.board.style.cursor="url('/cursor.png'), auto",await M();else i.board.style.cursor="auto",await E()}async function B(e=1e3){let t=0,r=setInterval((()=>{var e,n,o,s;if(c.running){t>5&&(null==(e=i.mold)||e.fade(.1),null==(n=i.mold)||n.edges,t=0),null==(o=i.attractor)||o.fade(.002);try{null==(s=i.mold)||s.grow()}catch{}t+=1}else clearInterval(r)}),e)}class P{constructor(){a(this,"occupied"),this.occupied=[]}}function G(e=i.prefs.num_walls,t=[i.prefs.wall_size]){i.walls=new P;for(let r=0;r<e;r++){let e=i.gridArr[Math.floor(Math.random()*i.gridArr.length)],n=t[r%t.length];e.state=3;for(let t=0;t<n;t++){let t=e.surrounding(),r=e;r="lines"==i.prefs.wall_generation_mode?t[Math.floor(Math.random()*t.length)%3]:t[Math.floor(Math.random()*t.length)],r.state=3,e=r,i.walls.occupied.push(r)}}}let c={state:!1,player:2,get running(){return this.state},set running(e){this.state=e,this.setHooks()},setHooks(){H(this).then(),N(this),this.running&&(G(),B(1).then()),this.running||i.gridArr.forEach((e=>{e.opacity=1}))}};function T(){let e=document.querySelector("#start"),t=document.querySelector("#stop");t.style.display="none",e.addEventListener("click",(async()=>{t.style.display="inline",e.style.display="none",await q(),c.running=!0})),t.addEventListener("click",(async()=>{t.style.display="none",e.style.display="inline",c.running=!1}))}class z{constructor(e,t,i,r){a(this,"wall_generation_mode"),a(this,"num_walls"),a(this,"wall_size"),a(this,"wall_barrier_type"),this.wall_generation_mode=e,this.num_walls=t,this.wall_size=i,this.wall_barrier_type=r}}async function W(){await $(),await y(),await g();const e=document.querySelector("#show-prefs"),t=document.querySelector("#prefs-set");e.addEventListener("click",(async()=>{await y()})),t.addEventListener("click",(async()=>{await g()}))}async function y(){const e=document.querySelector("#prefs");"none"===e.style.display?e.style.display="block":e.style.display="none",window.scrollTo(0,document.body.scrollHeight)}async function $(){document.querySelector("#prefs").innerHTML='\n<div id="prefs-content">\n    <h2>Preferences</h2>\n    <div id="prefs-wall-generation-mode" >\n        <label for="wall-generation-mode">Wall Generation Mode</label>\n        <select name="Wall Generation Mode" id="wall-generation-mode">\n            <option value="mass">Mass</option>\n            <option value="lines">Lines</option>\n        </select>\n    </div>\n    <div id="prefs-num-walls" >\n        <label for="num-walls">Number of Walls</label>\n        <input id="num-walls" type="number" value="2">\n    </div>\n    <div id="prefs-wall-size" >\n        <label for="wall-size">Wall Size</label>\n        <input id="wall-size" type="number" value="60">\n    </div>\n    <div id="prefs-wall-barrier-type">\n        <label for="wall-barrier-type">Wall Barrier Type</label>\n        <select name="Wall Barrier Type" id="wall-barrier-type">\n            <option value="strict">Strict</option>\n            <option value="lenient">Lenient</option>\n        </select>\n    </div>\n    <button id="prefs-set">Set</button>\n</div>\n  '}async function g(){let e=document.querySelector("#wall-generation-mode").value,t=document.querySelector("#num-walls").value,r=document.querySelector("#wall-barrier-type").value,n=document.querySelector("#wall-size").value;i.prefs=new z(e,Number(t),Number(n),r)}document.querySelector("#app").innerHTML='\n<div id="sub-app">\n  <div id="board-holder">\n    <div id="board"></div>\n  </div>\n</div>\n  <button class="board-interface" id="start">Start</button>\n  <button class="board-interface" id="stop">Stop</button>\n  <button id="show-prefs">Preferences</button>\n  <div id="prefs" ></div>\n';let i={globalx:50,globaly:50,board:document.querySelector("#board"),gridArr:void 0,mold:void 0,attractor:void 0,walls:void 0,prefs:void 0};W().then(),T()</script><style>#board-holder{display:flex;align-items:center;justify-content:center}#board{width:88vmin;height:88vmin;display:flex;flex-direction:column;border:1px solid #000}.row{display:flex;width:100%}.board-interface{width:90px;height:30px;margin:20px;border-radius:8px;border:none;background-color:#ffb5b3;transition:.2s}.board-interface:hover{box-shadow:0 0 0 2px #989bff}.board-interface:active{background-color:#de9794;box-shadow:0 0 0 1px #989bff}#app{text-align:center}#sub-app{display:flex;justify-content:center}.grid{width:100%;background-color:transparent;border:.5px solid transparent}.grid-active:hover{border:.5px solid #000;box-shadow:inset 0 0 10px 2px #cecece80}.grid-dead{border:.5px solid rgba(0,0,0,.1)}.mold{background-color:#8cffb3}.attractor{background-color:#5ac7ff}.wall{background-color:#000}#prefs{display:none}#show-prefs{width:90px;height:30px;margin:20px;border-radius:8px;border:none;background-color:#ffb5b3;transition:.2s}#show-prefs:hover{box-shadow:0 0 0 2px #989bff}#show-prefs:active{background-color:#de9794;box-shadow:0 0 0 1px #989bff}</style>