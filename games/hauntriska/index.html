<title>Hauntriska - js13kGames 2024</title><style>html{font-family:bahnschrift,sans-serif;font-stretch:semi-condensed;font-size:2.5vh;user-select:none}body{background:#291414;color:#ccc;overflow:hidden}*{image-rendering:pixelated;cursor:default}b{color:#fff}#d{transform-origin:0px 0px 0px}#d,#d *{transform-style:preserve-3d;position:absolute}#b{width:400px;height:800px;transform:translateY(0) rotateX(90deg) translateX(-200px) translateY(0)}#g *{width:40px;height:40px;position:absolute}#f1,#f2,#f3,#f4{width:400px;height:200px;background:#29141488;transform:translateX(-200px) translateY(200px) translateZ(-100px)}#f2{transform:translateX(-200px) translateY(200px) translateZ(-150px)}#f3{transform:translateX(-200px) translateY(200px) translateZ(-200px)}#f4{transform:translateX(-200px) translateY(200px) translateZ(-250px)}#s{position:fixed;top:.3rem;left:0;right:0;text-align:center}#s *{padding:.2rem .5rem;transition:all .33s}#m{position:fixed;top:2rem;left:2rem;right:2rem;background:#0008;padding:1rem;text-align:center;transition:all .15s;opacity:0}#mb{position:fixed;top:6rem;right:2rem;width:10rem;background:#000c;text-align:center;padding:.5rem;transition:all .15s;opacity:0}#w{position:fixed;top:0;left:0;height:1.75rem;width:0%;background:#f008;animation:w .3s infinite}@keyframes w{0%{background:#f008}50%{background:#ff0a}100%{background:#f008}}#o,#r{position:fixed;top:0;right:0;bottom:0;left:0;background:#fff6;opacity:0}@keyframes o{0%{opacity:1}100%{opacity:0}}#r{opacity:1;transition:all 1s;animation:r 30s linear infinite}@keyframes r{0%{background-position:0 0}100%{background-position:300% -100%}}#q{position:fixed;top:0;right:0;left:0;padding:30%;text-align:center}</style><script>"use strict";let zzfx,zzfxV,zzfxX;zzfxV=.3,zzfx=(e=1,t=.05,_=220,o=0,n=0,a=.1,E=0,I=1,i=0,A=0,c=0,s=0,O=0,r=0,l=0,D=0,T=0,u=1,d=0,m=0)=>{let X,S,f=Math,P=44100,g=2*f.PI,N=i*=500*g/P/P,h=_*=(1-t+2*t*f.random(t=[]))*g/P,p=0,B=0,C=0,v=1,M=0,b=0,L=0;for(A*=500*g/P**3,l*=g/P,c*=g/P,s*=P,O=P*O|0,S=(o=P*o+9)+(d*=P)+(n*=P)+(a*=P)+(T*=P)|0;C<S;t[C++]=L)++b%(100*D|0)||(L=E?1<E?2<E?3<E?f.sin((p%g)**3):f.max(f.min(f.tan(p),1),-1):1-(2*p/g%2+2)%2:1-4*f.abs(f.round(p/g)-p/g):f.sin(p),L=(O?1-m+m*f.sin(g*C/O):1)*(0<L?1:-1)*f.abs(L)**I*e*zzfxV*(C<o?C/o:C<o+d?1-(C-o)/d*(1-u):C<o+d+n?u:C<S-T?(S-C-T)/a*u:0),L=T?L/2+(T>C?0:(C<S-T?1:(S-C)/T)*t[C-T|0]/2):L),X=(_+=i+=A)*f.cos(l*B++),p+=X-X*r*(1-1e9*(f.sin(C)+1)%2),v&&++v>s&&(_+=c,h+=c,v=0),!O||++M%O||(_=h,i=N,v=v||1);return(e=zzfxX.createBuffer(1,S,P)).getChannelData(0).set(t),(_=zzfxX.createBufferSource()).buffer=e,_.connect(zzfxX.destination),_.start(),_},zzfxX=new window.AudioContext;const GFX_SPRITES="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAAAICAYAAAAx3fd+AAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kTtIw0Acxr8+pD4qDhYRcchQneyiIrqVKhbBQmkrtOpgcukLmjQkKS6OgmvBwcdi1cHFWVcHV0EQfIA4OzgpukiJ/0sKLWI8OO7Hd/d93H0HeBsVphj+KKCopp6Kx4RsblUIvKIHfRjCHPwiM7REejED1/F1Dw9f7yI8y/3cn6NfzhsM8AjEUabpJvEG8cymqXHeJw6xkigTnxNP6HRB4keuSw6/cS7a7OWZIT2TmicOEQvFDpY6mJV0hXiaOCwrKuV7sw7LnLc4K5Uaa92TvzCYV1fSXKc5ijiWkEASAiTUUEYFJiK0qqQYSNF+zMU/YvuT5JLIVQYjxwKqUCDafvA/+N2tUZiadJKCMaDrxbI+xoDALtCsW9b3sWU1TwDfM3Cltv3VBjD7SXq9rYWPgIFt4OK6rUl7wOUOMPykibpoSz6a3kIBeD+jb8oBg7dA75rTW2sfpw9AhrpavgEODoHxImWvu7y7u7O3f8+0+vsBv1tyxbOW4jcAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfoCQ0FAwmdg6BvAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAMpJREFUWMPtVkEOwzAIK9Mezs/ZoYvUWcahazRpG740QW2T2IZg2w8hImKMzcy2xhSGxL1L4AryI8Kf37tah/1/doY2B8edEceIzghUgkAcRXUmftVkLG5mNtbN3m284sYyAudIpsq2JLtcxVB8Mo/jmjMj4LOwv/82wFWBjwKhWEvuKVHyUeSBT+7v6w2gyFOEq4yalP8sVjKB2mfjZHKpbBgkn2mwLjSRDt97pQGcZTM7Q5uncG+yOzerAitLbKUZzAyAY3WGxo4HNjsIueWCRoYAAAAASUVORK5CYII=",GFX_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kTtIw0Acxr8+pD4qDhYRcchQneyiIrqVKhbBQmkrtOpgcukLmjQkKS6OgmvBwcdi1cHFWVcHV0EQfIA4OzgpukiJ/0sKLWI8OO7Hd/d93H0HeBsVphj+KKCopp6Kx4RsblUIvKIHfRjCHPwiM7REejED1/F1Dw9f7yI8y/3cn6NfzhsM8AjEUabpJvEG8cymqXHeJw6xkigTnxNP6HRB4keuSw6/cS7a7OWZIT2TmicOEQvFDpY6mJV0hXiaOCwrKuV7sw7LnLc4K5Uaa92TvzCYV1fSXKc5ijiWkEASAiTUUEYFJiK0qqQYSNF+zMU/YvuT5JLIVQYjxwKqUCDafvA/+N2tUZiadJKCMaDrxbI+xoDALtCsW9b3sWU1TwDfM3Cltv3VBjD7SXq9rYWPgIFt4OK6rUl7wOUOMPykibpoSz6a3kIBeD+jb8oBg7dA75rTW2sfpw9AhrpavgEODoHxImWvu7y7u7O3f8+0+vsBv1tyxbOW4jcAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfoCQ0BARNV3pNLAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAK1JREFUSMfVVkkOgCAQ04bMhRfwD///Ky+cPGgiEbfB1ihnaDstM9APKXXOFc3GnG9uRidekMp3E3jR3QRe9JUgmkUzRQahrXBhyJ8kGHMWBbBWMHMoaFBewUuaBgWobzrXMRw1VAPH7hEQ58SuLLBmzkt9UBcBlj+OCp77UxbBHxUbcZDKX8b1wyelhi5BAustm9HrbdC5zyQ4SQ6UJMmd/POf3c+/jg1dIrdoAuHzV8NhhRBIAAAAAElFTkSuQmCC",GFX_COVER="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kTtIw0Acxr8+pD4qDhYRcchQneyiIrqVKhbBQmkrtOpgcukLmjQkKS6OgmvBwcdi1cHFWVcHV0EQfIA4OzgpukiJ/0sKLWI8OO7Hd/d93H0HeBsVphj+KKCopp6Kx4RsblUIvKIHfRjCHPwiM7REejED1/F1Dw9f7yI8y/3cn6NfzhsM8AjEUabpJvEG8cymqXHeJw6xkigTnxNP6HRB4keuSw6/cS7a7OWZIT2TmicOEQvFDpY6mJV0hXiaOCwrKuV7sw7LnLc4K5Uaa92TvzCYV1fSXKc5ijiWkEASAiTUUEYFJiK0qqQYSNF+zMU/YvuT5JLIVQYjxwKqUCDafvA/+N2tUZiadJKCMaDrxbI+xoDALtCsW9b3sWU1TwDfM3Cltv3VBjD7SXq9rYWPgIFt4OK6rUl7wOUOMPykibpoSz6a3kIBeD+jb8oBg7dA75rTW2sfpw9AhrpavgEODoHxImWvu7y7u7O3f8+0+vsBv1tyxbOW4jcAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfoCQ0FKRyfNYisAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAKxJREFUeNrt2kEOQDAQBdBqbOwkTuD+h3IFN2BVIbGmyX+zUit94yMxwzJNRwmuWsJrbAfrPF8nt33PugPum39bR0SgdT2p+w+A1vWk7nsIikApg+8AEQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhNTYy4X8NZ9Qe9v82zoiAn/9nK29ReDr+QRvgfQImA8QAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkFMnt9Qh7nxcaRYAAAAASUVORK5CYII=",SOUNDS=[[.6,0,226,.01,.5,.5,1,1.1,-4,,,,.13,,,,.11,.5,.01,,-1268],[1.1,.3,31,.06,.1,.2,1,1.6,-7,2,,,.14,1.2,,.1,,.31,.1,.2],[.8,0,387,.02,,.25,,2.7,16.8,6,,,.02,.3,,.1,,.6,.1,.06],[1.8,0,336,.03,.1,.27,2,1.7,12,20,,,,,,.3,.25,.97,.1],[.8,0,523.2511,.02,,.2,1,3,,,400,.1,,,,,,.7]],LEVELS=[[20,40,40,80,961,["Oh no, someone left the portal open. Quick, help me!","First, catch three ghosts!"],["Nice job!"],[1,0,0,0,0,0],[3,0,0,0,0,0],[1,0,0,0],1.2,0],[12,25,40,80,432,["Let's catch some more! But uh-oh...","It looks like your storage unit is a bit funky.","It can't hold exactly 13 ghosts, so...","Good luck!"],["Phew, great job! I knew you could do it!"],[1,0,0,0,0,0],[15,0,0,0,0,0],[4,1,0,0],1,0],[9,20,60,100,123,["Oh and beware of the multiplies of 13, too...","Catch them!"],["Great!"],[5,3,0,0,0,0],[18,12,0,0,0,0],[3,1,0,0],1,0],[6,25,60,100,112,["You know the drill."],["Amazing!"],[20,15,5,2,0,0],[25,20,2,1,0,0],[10,2,1,0],.9,0],[8,25,70,110,493,["Some of your colleagues are on the field.","Please avoid them if you can."],["Well done!"],[25,21,0,1,0,0],[9,14,0,1,0,0],[8,2,1,0],.9,.07],[6,20,70,110,371,["Oh no! The beam is getting weaker..."],["Great job!","Well, I think you caught enough of them.","And this was all I got for the jam :)","Thank you very much for playing!"],[25,20,0,1,1,0],[10,10,0,3,1,0],[7,2,1,0],.55,.042]];function _z(e){return e}function _zz(e){return e}let _spriteCache=[];function clamp(e,t,_){return e<t?t:e>_?_:e}function getSprite(e,t,_,o,n){let a=[e,t,_,o,n].join(",");if(!_spriteCache[a]){let E=document.createElement("canvas");E.width=_z(_),E.height=_z(o);let I=E.getContext("2d");I.imageSmoothingEnabled=!1,I.drawImage(_sprites,e,t,_,o,0,0,_z(_),_z(o)),I.globalCompositeOperation="source-atop",I.fillStyle=n,I.fillRect(0,0,8,8),_spriteCache[a]=E.toDataURL()}return _spriteCache[a]}function createDomElement(e,t){var _=document.createElement("img");return _.src=getSprite(8*e,0,8,8,t),_root.appendChild(_),_}function updatePositionRotation(e,t,_,o,n){e.style.transform="translateX("+_zz(t-20)+"px) translateY("+(360+_zz(o))+"px) translateZ("+_zz(3*_)+"px) rotate("+n+"deg) rotateX(0deg)"}function dist(e,t){return Math.abs(e[IDX_POSITION_X]+e[IDX_POSITION_WOBBLE_X]-(t[IDX_POSITION_X]+t[IDX_POSITION_WOBBLE_X]))+Math.abs(e[IDX_POSITION_Y]-t[IDX_POSITION_Y])}function arrayPick(e){return e[Math.floor(Math.random()*e.length)]}let _randomSeed=0;function getRandomFloat(){return _randomSeed=(26031*_randomSeed+35803270)%5886503,_randomSeed%73727/73727}function getRandomInt(e,t){return getRandomFloat()*(t-e)+e|0}function getRandomPick(e){return e[getRandomInt(0,e.length)]}function getRandomIndexWeighted(e){var t=0;for(var _ of e)t+=_;for(var o=getRandomInt(0,t),n=0;n<e.length;n++)if((o-=e[n])<0)return n}function soundLoopWarning(){_oofActive&&zzfx(...SOUNDS[2])}function soundLoopBeam(){_state!=STATE_RUNNING||_dialogOpen||zzfx(...SOUNDS[0])}function soundManagerInit(){window.setInterval(soundLoopWarning,600),window.setInterval(soundLoopBeam,500)}const ENEMY_DEFINITIONS=[[1,"#faa032",0,0],[1,"#c40c2e",50,0],[0,"#d94c8e",80,20],[0,"#55b33b",70,20],[6,"#1793e6",100,100],[0,"#b58c7f",100,100]],STATE_INIT=0,STATE_RUNNING=2,STATE_WON=3,EIDX_SPRITE_INDEX=0,EIDX_COLOR=1,EIDX_WOBBLE_X=2,EIDX_SPEED_Y=3,IDX_DOM_OBJECT=0,IDX_POSITION_X=1,IDX_POSITION_Y=2,IDX_SPRITE_INDEX=3,IDX_OBJECT_TYPE=4,IDX_PHASE=5,IDX_TIME_LEFT=6,IDX_SPEED_X=7,IDX_SPEED_Y=8,IDX_WOBBLE_X=9,IDX_POSITION_WOBBLE_X=10,IDX_ENEMY_DEFINITION_INDEX=11,IDX_ENEMY_GROUP_LEADER=12,IDX_ENEMY_GROUP_SHIFT_X=13,IDX_POSITION_Z=14,IDX_SPEED_Z=15,OBJECT_TYPE_PLAYER=1,OBJECT_TYPE_ENEMY=2,OBJECT_TYPE_BEAM=3,OBJECT_TYPE_PARTICLE=4,OBJECT_TYPE_HUMAN=5,PLAYER_MAX_SPEED=75,MAX_OBJECT_Y_COORD=150,BEAM_SPEED=60,BEAM_CATCH_DISTANCE=5,BEAM_INTERVAL_SEC=.0166,HUMAN_COLOR="#9df",LEVEL_STEP_INTERVAL_SEC=.1,OOF_TIME_MAX=2.5;let _scale,a,b,c,d,e,_enemiesCaught,_oofTimeLeft,_state=STATE_INIT,_dialogOpen=!1,_oofActive=!1,_scrollSpeed=80,_width=800,_mousePosition=0,_t=0,objects=[];function createGameObject(e,t,_,o,n){return[createDomElement(t,_),o,n,t,e,0,0,0,0,0,0,0,null,0,0,0]}function deleteGameObject(e){e[IDX_DOM_OBJECT].parentNode.removeChild(e[IDX_DOM_OBJECT])}function cleanupObjects(){for(var e=objects.length-1;e>=0;e--){var t=objects[e];(t[IDX_POSITION_Y]>MAX_OBJECT_Y_COORD||(t[IDX_OBJECT_TYPE]==OBJECT_TYPE_BEAM||t[IDX_OBJECT_TYPE]==OBJECT_TYPE_PARTICLE)&&t[IDX_TIME_LEFT]<0)&&(deleteGameObject(t),objects.splice(e,1))}}function updateGameObject(e,t){var _=0;e[IDX_OBJECT_TYPE]==OBJECT_TYPE_BEAM&&(_=360*e[IDX_PHASE]*2,e[IDX_DOM_OBJECT].style.opacity=e[IDX_TIME_LEFT]),e[IDX_OBJECT_TYPE]==OBJECT_TYPE_PARTICLE&&(_=360*e[IDX_PHASE]*-.5,e[IDX_DOM_OBJECT].style.opacity=e[IDX_TIME_LEFT]),updatePositionRotation(e[IDX_DOM_OBJECT],e[IDX_POSITION_X]+e[IDX_POSITION_WOBBLE_X],e[IDX_POSITION_Y],e[IDX_POSITION_Z],_)}function stepPlayerObject(e,t){var _=1.098*clamp(_mousePosition,-.9,.9)*200,o=_>e[IDX_POSITION_X]?1:-1,n=Math.min(Math.abs(_-e[IDX_POSITION_X]),PLAYER_MAX_SPEED);e[IDX_POSITION_X]=e[IDX_POSITION_X]+n*o*8*t}function enemyCaught(e){var t=createGameObject(OBJECT_TYPE_PARTICLE,5,"#fff",e[IDX_POSITION_X],e[IDX_POSITION_Y]);t[IDX_PHASE]=Math.random(),t[IDX_TIME_LEFT]=.4,t[IDX_SPEED_Y]=1.75*_scrollSpeed,objects.push(t),e[IDX_POSITION_Y]=MAX_OBJECT_Y_COORD,_enemiesCaught[e[IDX_ENEMY_DEFINITION_INDEX]]+=1,updateScores()}function enemyGroupCaught(e){var t=e[IDX_ENEMY_GROUP_LEADER];if(zzfx(...SOUNDS[1]),t)enemyGroupCaught(t);else for(var _ of(enemyCaught(e),objects))_[IDX_ENEMY_GROUP_LEADER]&&e==_[IDX_ENEMY_GROUP_LEADER]&&enemyCaught(_)}function humanCaught(e){e[IDX_POSITION_Y]=MAX_OBJECT_Y_COORD,oofExecute(),throwHumanAsParticle()}function stepEnemyObject(e,t){if(e[IDX_ENEMY_GROUP_LEADER]){var _=e[IDX_ENEMY_GROUP_LEADER];e[IDX_POSITION_X]=_[IDX_POSITION_X]+e[IDX_ENEMY_GROUP_SHIFT_X],e[IDX_POSITION_Y]=_[IDX_POSITION_Y],e[IDX_POSITION_WOBBLE_X]=_[IDX_POSITION_WOBBLE_X],e[IDX_PHASE]=_[IDX_PHASE]}else e[IDX_POSITION_Y]+=_scrollSpeed*t,e[IDX_POSITION_Y]+=e[IDX_SPEED_Y]*t,e[IDX_PHASE]+=t,e[IDX_POSITION_WOBBLE_X]=e[IDX_WOBBLE_X]*Math.sin(e[IDX_PHASE]);for(var o of objects)o[IDX_OBJECT_TYPE]==OBJECT_TYPE_BEAM&&o[IDX_TIME_LEFT]>.2&&dist(e,o)<BEAM_CATCH_DISTANCE&&enemyGroupCaught(e)}var _nextBeamObjectTime=0;function createBeamObjects(){for(;_nextBeamObjectTime<_t;){var e=createGameObject(OBJECT_TYPE_BEAM,4,arrayPick(["#07f","#4af","#09f","#a3f"]),objects[0][IDX_POSITION_X],objects[0][IDX_POSITION_Y]-1);e[IDX_PHASE]=Math.random(),e[IDX_TIME_LEFT]=_levelData[10],e[IDX_SPEED_X]=150*Math.random()-75,objects.push(e),_nextBeamObjectTime+=BEAM_INTERVAL_SEC}}function stepBeamObject(e,t){e[IDX_TIME_LEFT]-=t,e[IDX_PHASE]+=t,e[IDX_POSITION_Y]-=BEAM_SPEED*t,e[IDX_POSITION_X]+=e[IDX_SPEED_X]*t}function stepParticleObject(e,t){e[IDX_POSITION_X]+=e[IDX_SPEED_X]*t,e[IDX_POSITION_Y]+=e[IDX_SPEED_Y]*t,e[IDX_POSITION_Z]+=e[IDX_SPEED_Z]*t,e[IDX_PHASE]+=t,e[IDX_TIME_LEFT]-=t}function stepHumanObject(e,t){for(var _ of(e[IDX_POSITION_Y]+=_scrollSpeed*t,e[IDX_POSITION_Y]+=e[IDX_SPEED_Y]*t,e[IDX_PHASE]+=t,e[IDX_POSITION_WOBBLE_X]=e[IDX_WOBBLE_X]*Math.sin(e[IDX_PHASE]),objects))_[IDX_OBJECT_TYPE]==OBJECT_TYPE_BEAM&&_[IDX_TIME_LEFT]>.2&&dist(e,_)<BEAM_CATCH_DISTANCE&&humanCaught(e)}let _levelData,_currentLevelIndex=-1,_levelStepCount=0,_nextLevelStepTime=0,_levelStepSkip=0;function levelStep(){function e(){var e=getRandomIndexWeighted(_levelData[7]),t=ENEMY_DEFINITIONS[e],_=createGameObject(OBJECT_TYPE_ENEMY,t[EIDX_SPRITE_INDEX],t[EIDX_COLOR],getRandomInt(-100,100),-130);return _[IDX_WOBBLE_X]=t[EIDX_WOBBLE_X],_[IDX_SPEED_Y]=t[EIDX_SPEED_Y],_[IDX_ENEMY_DEFINITION_INDEX]=e,objects.push(_),_}for(;_nextLevelStepTime<_t;){if(_levelStepCount+=1,_scrollSpeed=_levelData[2]+clamp(_t,0,60)/60*(_levelData[3]-_levelData[2]),_levelStepSkip<=0){if(getRandomFloat()<_levelData[11]){var t=createGameObject(OBJECT_TYPE_HUMAN,7,HUMAN_COLOR,getRandomInt(-110,110),-110);t[IDX_WOBBLE_X]=90,t[IDX_SPEED_Y]=0,objects.push(t)}for(var _=e(),o=getRandomIndexWeighted(_levelData[9]);o>0;){var n=e();n[IDX_ENEMY_GROUP_LEADER]=_,n[IDX_ENEMY_GROUP_SHIFT_X]=40*o,o-=1}_levelStepSkip=getRandomInt(_levelData[0],_levelData[1])}_nextLevelStepTime+=LEVEL_STEP_INTERVAL_SEC,_levelStepSkip-=1}}function levelInit(e){_t=0,_nextBeamObjectTime=0,_nextLevelStepTime=0,_levelData=LEVELS[e],_scrollSpeed=_levelData[2],_randomSeed=_levelData[4],_enemiesCaught=[0,0,0,0,0,0],_root.innerHTML="",objects=[],objects.push(createGameObject(OBJECT_TYPE_PLAYER,2,HUMAN_COLOR,0,120)),_state=STATE_RUNNING,_dialogOpen=!0,window.setTimeout(levelStartMessages,1500)}function levelStartMessages(){popUpMessages(_levelData[5])}function loadNextLevel(){_currentLevelIndex+=1,_currentLevelIndex>=LEVELS.length&&(_currentLevelIndex=0),levelInit(_currentLevelIndex),updateScores(),setCover(!1)}function gameInit(){loadNextLevel(),setCover(!1),window.setInterval(step,1e3/60),window.addEventListener("mousemove",onMouseMove),window.addEventListener("touchstart",onMouseMove),window.addEventListener("touchend",onMouseMove),window.addEventListener("touchcancel",onMouseMove),window.addEventListener("touchmove",onMouseMove),_mb.addEventListener("click",dismissDialog)}function onMouseMove(e){let t;if(t=e.touches&&e.touches.length>0?e.touches[0]:e,void 0===t.clientX)return;let _=t.clientX-document.body.clientWidth/2;_/=_scale,_/=_width/2,void 0===_||isNaN(_)||(_mousePosition=_)}function throwEnemyAsParticle(e){var t=createGameObject(OBJECT_TYPE_PARTICLE,ENEMY_DEFINITIONS[e][EIDX_SPRITE_INDEX],ENEMY_DEFINITIONS[e][EIDX_COLOR],objects[0][IDX_POSITION_X],objects[0][IDX_POSITION_Y]-1);t[IDX_PHASE]=Math.random(),t[IDX_TIME_LEFT]=1,t[IDX_SPEED_X]=600*Math.random()-300,t[IDX_SPEED_Z]=-300*Math.random(),objects.push(t)}function throwHumanAsParticle(){var e=createGameObject(OBJECT_TYPE_PARTICLE,7,HUMAN_COLOR,objects[0][IDX_POSITION_X],objects[0][IDX_POSITION_Y]-1);e[IDX_PHASE]=Math.random(),e[IDX_TIME_LEFT]=1,e[IDX_SPEED_X]=600*Math.random()-300,e[IDX_SPEED_Z]=-300*Math.random(),objects.push(e)}function oofExecute(){for(var e=0,t=0;t<ENEMY_DEFINITIONS.length;t++)e+=_enemiesCaught[t];for(var _=Math.floor(Math.max(5,.3*e));_>0&&e>0;)a=Math.floor(Math.random()*ENEMY_DEFINITIONS.length),0!=_enemiesCaught[a]&&(throwEnemyAsParticle(a),_enemiesCaught[a]-=1,_-=1,e-=1,_enemiesCaught[a]>0&&_enemiesCaught[a]%13==0&&(throwEnemyAsParticle(a),_enemiesCaught[a]-=1,_-=1,e-=1));_o.style.animation="o 0.33s forwards",_time_scale=0,zzfx(...SOUNDS[3]),updateScores()}function oofStart(){_oofActive||(_oofActive=!0,_oofTimeLeft=OOF_TIME_MAX)}function oofStop(){_oofActive=!1}function oofStep(e){_oofActive?(_oofTimeLeft=clamp(_oofTimeLeft-e,0,OOF_TIME_MAX),_w.style.width=100*(1-_oofTimeLeft/OOF_TIME_MAX)+"%",0==_oofTimeLeft&&(oofExecute(),_oofActive=!1)):_w.style.width=0}function updateScores(){for(var e=0,t=0,_=!1,o=0;o<ENEMY_DEFINITIONS.length;o++){(n=document.getElementById("s"+o)).style.display=0==_levelData[8][o]?"none":"",n.style.color=ENEMY_DEFINITIONS[o][EIDX_COLOR],n.innerHTML=_enemiesCaught[o]+" / "+_levelData[8][o],e+=_enemiesCaught[o],t+=_levelData[8][o],n.style.background="",_enemiesCaught[o]>0&&(_enemiesCaught[o]%13==12?n.style.background="#ea08":_enemiesCaught[o]%13==0?(n.style.background="#f008",_=!0):_enemiesCaught[o]>=_levelData[8][o]&&(n.style.background="#0f05"))}var n;(n=document.getElementById("st")).innerHTML="Total: "+e+" / "+t,n.style.background="",e>0&&(e%13==12?n.style.background="#ea08":e%13==0&&(n.style.background="#f008",_=!0)),_?oofStart():oofStop()}function checkWinCondition(){for(var e=0;e<ENEMY_DEFINITIONS.length;e++)if(_enemiesCaught[e]<_levelData[8][e])return!1;return!0}function queueLoadNextLevel(){setCover(!0),window.setTimeout(loadNextLevel,2e3)}var _messages=[];function popupNextMessage(){0!=_messages.length?(zzfx(...SOUNDS[4]),_dialogOpen=!0,_m.innerHTML=_messages.shift(),_m.style.opacity=1,_mb.style.opacity=1):_dialogOpen=!1}function popUpMessages(e){_messages=e,popupNextMessage()}function dismissDialog(){_m.style.opacity=0,_mb.style.opacity=0,0==_messages.length?(_dialogOpen=!1,_state!=STATE_INIT&&_state!=STATE_WON||queueLoadNextLevel()):window.setTimeout(popupNextMessage,200)}function setCover(e){_r.style.bottom=e?"0vh":"100vh",_r.style.top=e?"0vh":"-100vh"}function timescaleStep(){var e=.1;_dialogOpen?e=0:_state==STATE_RUNNING&&(e=1),_time_scale+=.03*(e-_time_scale)}var _bgPositionY=0;function step(){var e=1/60*_time_scale;_t+=e,timescaleStep(),levelStep(),createBeamObjects();for(var t=0;t<objects.length;t++){var _=objects[t];_[IDX_OBJECT_TYPE]==OBJECT_TYPE_PLAYER?stepPlayerObject(_,e):_[IDX_OBJECT_TYPE]==OBJECT_TYPE_ENEMY?stepEnemyObject(_,e):_[IDX_OBJECT_TYPE]==OBJECT_TYPE_BEAM?stepBeamObject(_,e):_[IDX_OBJECT_TYPE]==OBJECT_TYPE_PARTICLE?stepParticleObject(_,e):_[IDX_OBJECT_TYPE]==OBJECT_TYPE_HUMAN&&stepHumanObject(_,e),updateGameObject(_,e)}cleanupObjects(),oofStep(e),_state==STATE_RUNNING&&checkWinCondition()&&(_state=STATE_WON,popUpMessages(_levelData[6])),_bgPositionY+=_scrollSpeed*e,_bg.style.backgroundPosition="0px "+3*_bgPositionY+"px",_scale=Math.min(document.body.clientHeight/_width,document.body.clientWidth/_width),_d.style.transform="scale("+_scale+") perspective(800px)",_d.style.left=document.body.clientWidth/2+"px"}let _d,_root,_bg,_m,_mb,_w,_o,_q,_r,_sprites,_time_scale=0;function init(){_sprites=new Image,_sprites.addEventListener("load",init2),_sprites.src=GFX_SPRITES}function init2(){_d=document.getElementById("d"),_root=document.getElementById("g"),_bg=document.getElementById("b"),_m=document.getElementById("m"),_mb=document.getElementById("mb"),_w=document.getElementById("w"),_o=document.getElementById("o"),_q=document.getElementById("q"),_r=document.getElementById("r"),_o.addEventListener("animationend",(function(){this.style.animation="none"})),_bg.style.background="url("+GFX_BACKGROUND+")",_bg.style.backgroundSize="30%",_r.style.background="url("+GFX_COVER+")",_r.style.backgroundSize="30%",_q.innerHTML="Click to start",_q.addEventListener("click",init3)}function init3(){_q.parentNode.removeChild(_q),gameInit(),soundManagerInit()}window.addEventListener("load",init)</script><div id=d><div id=b></div><div id=g></div><div id=f1></div><div id=f2></div><div id=f3></div><div id=f4></div></div><div id=o></div><div id=w></div><div id=s><span id=s0></span><span id=s1></span><span id=s2></span><span id=s3></span><span id=s4></span><span id=s5></span><span id=st></span></div><div id=r></div><div id=m></div><div id=mb>Continue</div><div id=q></div>