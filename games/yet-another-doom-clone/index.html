<!doctype html><title>Yet Another Doom Clone - js13kGames 2019</title><style>body{margin:0;background:#000}#qQ{position:absolute;left:35vw;top:4em;font-size:2em;font-variant:small-caps;color:#aaa;animation:z 9s}#cQ{height:100%;width:100%}#hQ{top:0;width:10vw;height:2vh;border:3px solid #008;border-radius:3px;display:none}#fps{display:none}#hW{height:2vh;background:#00a}@keyframes q{50%{opacity:0}}.b{animation:q 1s linear infinite}@keyframes z{from{opacity:0}to{opacity:1}}</style><canvas id=cQ></canvas><div id=qQ><div id=hE>Yet Another Doom Clone<br><br><div class=b>Loading... <span id=jQ></span></div><br><br>Move: WASD<br>Aim/Shoot: Mouse/Click<br><br><br><br>By Nicholas Carlini</div><div id=hQ><div id=hW></div></div></div><script>class e{constructor(){var K,R,D,F,L,X,V,H,N,Z;this.t={},this.i=()=>{var t=this.t;R=100/(t.f**2+.001),D=100/(t.g**2+.001),F=1-t.h**3*.01,L=1e-6*-(t.i**3),3==t.a&&(N=.5-t.n/2,Z=5e-5*-t.o),X=1+t.l**2*(0<t.l?-.9:10),V=0,H=1==t.m?0:(1-t.m)**2*2e4+32},this.h=()=>{this.i();var t=this.t;return K=[t.b**2*1e5,t.c**2*1e5,t.e**2*1e5,1],P(K)},this._=(t,i)=>{var s,e,h,n,r=this.t,a=1!=r.s||r.v,l=r.v**2*.1,o=1+3e-4*r.w,u=r.s**3*.1,p=r.x**2,c=r.q||r.r,m=r.q**2*(r.q<0?-1020:1020),f=r.p?32+((1-r.p)**2*2e4|0):0,y=r.j/2,v=r.a,d=K[0],w=1-S(5/(1+r.u**2*20)*(.01+u),0,.8),g=!1,x=0,A=0,z=0,j=0,C=0,M=0,k=0,T=0,B=0,b=0,Q=new Array(1024),E=J(32).map(t=>O());Q.fill(0);for(var q=0;q<i;q++){if(g)return q;f&&++T>=f&&(T=0,this.i()),H&&++V>=H&&(H=0,R*=X),D<(R*=F+=L)&&(R=D,g=0<r.g),e=R,0<y&&(b+=r.k**2*.01,e*=1+Y(b)*y),e=0|S(e,8,1e9),3==v&&(N=S(N+Z,0,.5)),++A>d&&(A=0,d=K[++x]);var G=[G=A/K[x],1+2*(1-G)*r.d,1-G,0][x];g|=3==x,c&&(m+=r.r**3*.2,(h=0|m)<0?h=-h:1023<h&&(h=1023)),a&&o&&(l=S(l*o,1e-5,.1)),t[q]=P(J(8).map(t=>(e<=++M&&(M%=e,v<=1)&&J(E.length).map(t=>{1==v?(E[t]=B=(B+.02*O())/1.02,E[t]*=3.5):E[t]=O()}),n=[E[W(32*M/e|0)],E[W(32*M/e|0)],NaN,M/e<N?.5:-.5,n=1-M/e*2][v],a&&(s=C,u=S(u*(1+1e-4*r.t),0,.1),j=1!=r.s?(j+(n-C)*u)*w:(C=n,0),n=z=(z+((C+=j)-s))*(1-l)),c&&(Q[k%1024]=n,n+=Q[(k-h+1024)%1024],k++),n)))*G*p*(.5+1.5*(1==v))}return i}}}var _={};function u(i){var t,s,h,n;return _[i]||(t=new e,s=t.t,J(24).map(t=>s[String.fromCharCode(97+t)]=i[t]||0),s.c=Gi(s.c,.01),h=t.h(),n=J(0|h),t._(n,h),_[i]=n)}var d,v={},o=new AudioContext,w=(t,i)=>{var s=o.createBuffer(1,t.length,48e3),e=(s.copyToChannel(new Float32Array(t),0,0),t=o.createBufferSource(),o.createStereoPanner());return t.buffer=s,t.connect(e),e.pan.value=i?K(I(i,j.l)+j.u+k/2):0,e.connect(o.destination),t.start(),t},h=[];function D(){h.length<2&&!ji&&wi&&d.map((t,s)=>t.map(i=>h.push(setTimeout(t=>{h.shift(),w(i,p(20,-40,0)),1==h.length&&D()},200*s+400))))}var t,c=t=>i(t).map(P);function r(){var t=[null,19,17,19,15,19,14,19,12,19,11,19,12,19,14,19,15,19,7,19,9,19,11,19,12,19,11,19,12,19,14,19],l=[[0,1,1,t],[5,1,2,t,[15,16,17,10,8,7,8,10,12,4,5,7,8,7,8,4]],[0,2,1,[20,24,20,24,25,17,25,17,22,19,22,19,24,15,24,15,20,17,20,17,23,14,23,14,19,15,19,15,17,11,17,11,15,12,15,12,14,8,14,8],[5,17,5,17,12,17,12,17,10,13,10,13,10,13,10,13,10,15,10,15,10,15,10,15,8,12,8,12,8,12,8,12,8,14,8,14,8,14,8,14,7,11,7,11,7,11,7,11,3,12,3,12,3,12,3,12,2,8,2,8,2,8,2,8,0,19,0,19,0,19,0,19,2,5,2,5,2,5,2,5]],[12,1,2,t,[3,2,0,5,3,2,3,-1,0,-1,0,2,3,2,3,-1]],[12,1,4,[15,19,14,19,12,19,10,19,8,19,10,19,12,17,20,17,14,17,12,17,10,17,20,17,7,17,8,17,10,15,7,15,12,15,10,15,8,15,7,15,5,15,19,15,8,14,5,14,11,14,8,14,7,14,5,14,3,14,5,14],[7,12,12,null,10,10,10,null,9,9,9,null,7,7,7],[0,3,5,null,-2,2,3,null,-4,0,2,null,-5,-1,12]],[0,1,2,[19,24,15,24,14,26,14,26,15,24,15,24,20,23,20,23,19,24,15,24,14,26,14,26,15,24,15,24],[null,12,11,11,12,12,14,null,null,12,11,11,12,12,14],[null,3,8,8,7,7,17,null,null,7,8,8,7,7,6]]],o=(d=J(300).map(t=>[]),0),s=t=>{var[n,r,a,...i]=l.shift();i.map((t,h)=>t.map((t,i)=>{var s,e=!h&&l.length<5;i*=h?a:r,null!=(t=null==t?null:t+n*!h)&&(s=.11*(h?a:r)+.13,d[i+o].push(c([t/12,t/12-1].map(t=>(t=2**(t/2)*.25,u(e?[3,.1,s,.1,.3,t,,,,,,,,.5,,,-1,,.2,,,,,.1]:[3,.1,.07+s,.3,.5,t,,,,,,,,,,,,,.15,,,,,.1]))))))})),o+=r*i[0].length,jQ.innerHTML=6-l.length+"/6",setTimeout(l.length?s:fi,1)};setTimeout(s,1)}var m,g,H=(s,e)=>s.slice(0,-1).map((t,i)=>e(t,s[i+1],i)),i=s=>s[0].map((t,i)=>s.map(t=>t[i])),J=(t,s)=>Array(t).fill().map((t,i)=>i+(s||0)),a=(i,s)=>J(i.length/s).map(t=>i.slice(t*s,(t+1)*s)),O=t=>2*Vi()-1,F=t=>p(O(),O(),O()),Z=(t,s,e)=>[].concat(...t.map(i=>s.map(t=>e(i,t)))),N=(t,i,s)=>t.g(i).m(s.g(i)).v(),p=(t,i,s)=>new st(t,i,s),X=t=>p(...t),s=t=>t.reduce((t,i)=>t.p(i)),L=t=>s(t).A(1/t.length),I=(t,i)=>Math.atan2(t.g(i).x,t.g(i).y),$=(t,i)=>(t.push(i),t),S=(t,i,s)=>Math.min(Gi(i,t),s),P=t=>t.reduce((t,i)=>t+i),f=t=>[1,0,0,0,0,K(t),-Y(t),0,0,Y(t),K(t),0,0,0,0,1],U=t=>[K(t),0,-Y(t),0,0,1,0,0,Y(t),0,K(t),0,0,0,0,1],x=t=>[K(t),-Y(t),0,0,Y(t),K(t),0,0,0,0,1,0,0,0,0,1],tt=t=>[1,0,0,t[0],0,1,0,t[1],0,0,1,t[2],0,0,0,1],it=tt([0,0,0]);class st{constructor(t,i,s){this.x=+t||0,this.y=+i||0,this.z=+s||0}p(t){return p(this.x+t.x,this.y+t.y,this.z+t.z)}g(t){return this.p(t.j())}j(){return this.A(-1)}A(t){return p(this.x*t,this.y*t,this.z*t)}M(t){return p(this.x*t.x,this.y*t.y,this.z*t.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}C(){return[this.x,this.y,this.z]}B(){return $(this.C(),0)}T(t,i){return this.A(1-i).p(t.A(i))}m(t){return p(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}R(){return X(this.C())}V(){return this.dot(this)}G(){return this.V()**.5}K(t){return this.g(t).G()}noz(){return p(this.x,this.y,0)}v(){return this.A(1/(this.G()+1e-30))}id(){return""+this.C().map(t=>t.toFixed(4))}}function ht(t,i,s,e){t=t.g(s);var h=e.g(s);if(i=p(-i.y,i.x,0),s=(h.x*t.y-h.y*t.x)/h.dot(i),e=t.dot(i)/h.dot(i),0<=s&&0<=e&&e<=1)return[s,e]}var z=new st(0,0,0),ot=p(1,0,0),et=p(0,1,0),b=p(0,0,1);function _t(t){var s=[],e=[],h=[];return t.map(i=>{s.push(a(Array.from(i.k),3).map(t=>g(i.D,X(t)).p(i.l).C())),e.push(a(Array.from(i.H),3).map(t=>g(i.D,X(t)).v().C())),h.push(Array.from(i.F))}),new l([s.flat(2),e.flat(2)],z,it,!1,h.flat())}class l{constructor(t,i,s,e,h,n){this.k=new Float32Array(t[0]),this.H=new Float32Array(t[1]),this.Z=new Float32Array(t[0].map(t=>k/2)),this.l=i,this.N=[y.createBuffer(),y.createBuffer(),y.createBuffer(),y.createBuffer()],this.D=s||it,this.X=e,h=h||[1,1,1],this.F=new Float32Array(h.length==t[0].length?h:Array(t[0].length/3).fill(h).flat()),[this.J,this.O]=n||[0,0],this.S()}S(){[this.k,this.H,this.F,this.Z].map((t,i)=>{y.ned(y.YEA,this.N[i]),y.ftf(y.YEA,t,35048)})}Y(){this.X&&M==di||(y.uniform4fv(M.f,this.l.j().B()),y.uniformMatrix4fv(M.e,!1,this.D),[M.y,M.J,M.P,M.L].map((t,i)=>{void 0!==t&&-1!==t&&(y.rab(t),y.ned(y.YEA,this.N[i]),y.bet(t,3,5126,!1,0,0))}),y.uniform1i(M.h,this.O),y.uniform1i(M.t,this.J-20),y.uniform1i(M.l,this.X),y.ayw(y.REA,0,this.k.length/3))}}var rt=()=>{var t=i=>`(a,b)=>[${a(J(16),4).map(h=>i[0].map((t,e)=>i.reduce((t,i,s)=>`${t}+b[${i[e]}]*a[${h[s]}]`,0))).flat()}]`,s=(m=eval(t(a(J(16),4))),eval(t(a(J(4),1))));g=(t,i)=>X(s(t,i.B()))};function n(t,s,i,e,h){var n=z,r=(t=a(t,2).map(t=>n=p(0,...t).p(n)),J(s).map(i=>t.map(t=>g(x(2*k/s*i),t))).flat()),l=t.length,o=Z(J(l-1),J(s),(t,i)=>[0+t+i*l,1+t+i*l,l+1+t+i*l,l+t+i*l]);return e&&(o.push(J(s).map(t=>t*l)),o.push(J(s).reverse().map(t=>t*l+l-1))),r=r.map(h||(t=>t)),nt(o=o.map(t=>t.map(t=>r[t%r.length])))}function nt(t){var s=[],e=[],h={};return t.map(s=>H(s,(t,i)=>[s[0],t,i]).slice(1)).flat(1).map(t=>{var i=N(...t);t.map((t,i)=>h[t.id()]=$(h[t.id()]||[],e.length+i)),s.push(...t),e.push(i,i,i)}),s.map(t=>{var i=(t=h[t.id()]).map(t=>e[t]),s=L(i);i.every(t=>.8<s.dot(t))&&t.map(t=>e[t]=s)}),[s.map(t=>t.C()).flat(),e.map(t=>t.C()).flat()]}var at=`#version 300 es\nprecision mediump float;in vec4 I,m,O,N,b[5];uniform bool l,d[5];uniform int a,t,h;uniform vec4 s,g[5];uniform float k,c[5];uniform sampler2D E[9];out vec4 A;vec4 v(int i,vec2 R){switch(i){${J(9).map(t=>"case "+t+":return texture(E["+t+"],R)").join`;`};}}`;function lt(t,i,s){return i=t.createShader(i),t.ecd(i,s),t.lep(i),i}function ut(s,t){var e=s.createProgram(),i="#version 300 es\nprecision mediump float;in vec4 y,J,P,L;out vec4 I,m,O,N;out vec4 b[5];uniform vec4 f,g[5];uniform mat4 e,p[5];void main(){m=y*e-f;I=J*e;for(int i=0;i<5;i++){gl_Position=b[i]=p[i]*m;}O=P;N=L;}",h=(s.attachShader(e,lt(s,s.XET,i)),s.attachShader(e,lt(s,s.TEG,t)),s.kak(e),{}),n=!0;return(at+i).match(/[a-zA-Z_]+(\[[0-9]\])?/g).map(i=>{var t=[i];0<i.indexOf`[`&&(t=J(32).map(t=>i.replace(/[0-9]/,t))),"in"==i&&(n=!0),"uniform"==i&&(n=!1),t.map(t=>h[t]=h[t]||(n?s.LoA(e,t):s.LoU(e,t)))}),[e,h]}class ct{constructor(t,i,s,e,h,n,r){this.l=t,this.W=i,this.u=n||0,this.L=r||0,this.I=0,this.$=1028,this.P=e,this.fov=s,this.U=i[0]/i[1],(this.it=this).tt=h,[this.J,this.st]=pt(h,e,...i)}ht(){y.med(y.MEM,this.st),zt.map((t,i)=>{y.eri(y.E1T+i),y.drd(y.X2T,t),y.uniform1i(M[`E[${i+4}]`],i+19)}),$(B.slice(0,4),this).map((t,i)=>{var s,e,h,n;y.uniform4fv(M[`g[${i}]`],t.l.B()),y.uniformMatrix4fv(M[`p[${i}]`],!0,(s=t.it.fov,e=t.it.U,h=[U(t.it.I),f(t.it.L),x(t.it.u)].reduce(m),n=t.it.l,[[(s=Math.tan(k/2-s/2))/e,0,0,0,0,0,s,0,0,1,0,0,0,1,0,1],h,tt(n.j().C())].reduce(m))),4!=i&&(this.P||(y.eri(33984+t.id),y.drd(y.X2T,t.filter.J),y.uniform1i(M[`E[${i}]`],t.id)),y.uniform1i(M[`d[${i}]`],t.ot),y.uniform1f(M[`c[${i}]`],t.et))}),!ji||dt++%200<10?(y.uniform1f(M.k,.05),B[0].et=1.2,B[1].et=1.2,B[2].et=1.5,B[3].et=4):(y.uniform1f(M.k,1e-4),B[0].et=7,B[1].et=0,B[2].et=8,B[3].et=30),y._aa(y.FIO|y.FIT),y._lb(y.PST),this.$&&(y._lb(y.UCL),y.ccl(this.$)),y.vrw(0,0,this.W[0],this.W[1]),C.map(t=>{this.P&&t.gc||t.Y()}),y.med(y.MEM,null)}}var dt=0;function vt(t,s,e,i,h){var r=new l(n([5,0],4,0,1),z,null,!1),[a,o]=ut(y,at+`vec4 K(int i,vec2 S){return v(i,(m.xy*.5+.5)+S/vec2(${0|s}.,${0|e}.));}vec4 K(){return K(0,vec2(0));}void main(void){${t}}`);[this.J,this.st]=pt(31,i==y.RG,s,e),this._t=(t,i)=>(y.med(y.MEM,this.st),y.eaP(a),y.uniform4fv(o.s,G),[[t,"E[0]",30],[i,"E[1]",29]].map(t=>{t[0]&&(y.eri(33984+t[2]),y.drd(y.X2T,t[0]),y.uniform1i(o[t[1]],t[2]))}),y.uniform4fv(o.f,[0,0,0,0]),y.uniformMatrix4fv(o.e,!1,it),y.uniformMatrix4fv(o["p[4]"],!1,it),y._aa(y.FIO|y.FIT),y.vrw(0,0,s,e),M=o,r.Y(),this.J)}var wt="vec4 M;for(float i=-6.;i<7.;i++){for(float j=-6.;j<7.;j++){M+=exp(-i*i/9.-j*j/9.)*K(0,vec2(j,i));}}A=M/28.17;";function mt(){var t=y._av.width,i=y._av.height,e=[new vt("A=dot(K(),vec4(21,72,7,0))>100.?K():vec4(0,0,0,1);",t,i,6408),new vt("A=K();",t/4,i/4,6408),new vt(wt,t/4,i/4,6408),new vt("A=K();",t,i),new vt("A=vec4(s.rgb+s.w*(K(1,vec2(0))+K()).rgb,1.);",t,i,6408),new vt("A=K();",t,i,6408)];return e[5].st=null,3<bi?(j.st=null,J):s=>e.reduce((t,i)=>i._t(t,s),s)}function gt(t,i,s,e,h){var n=y.era();return y.eri(33984+t),y.drd(y.X2T,n),y.x2I(y.X2T,0,i?33328:34836,s,e,0,i?y.RG:6408,5126,h),n}function pt(t,i,s,e){t=gt(t,i,s,e),y.texParameteri(y.X2T,y.NET,y.LINEAR),y.texParameteri(y.X2T,10242,y._GM),y.texParameteri(y.X2T,10243,y._GM),i=y.createFramebuffer(),y.med(y.MEM,i),y.e2m(y.MEM,36064,y.X2T,t,0);var h=y.createRenderbuffer();return y.eed(y.EED,h),y.rgd(y.EED,y.P1T,s,e),y.eem(y.MEM,36096,y.EED,h),[t,i]}var ft=0;class xt{constructor(t,i,s,e){var h=1024>>bi;this.l=t,this.it=new ct(t,[h,h],ft?2.5:1,!0,this.id=ft++,i,s),this.ot=e,this.J=this.it.J,this.et=2,this.filter=new vt(wt,h/2,h/2,y.RG)}rt(){this.it.l=this.l,y.eaP(ui),M=di,y.eri(33984+this.id),y.drd(y.X2T,this.J),y.uniform1i(M.a,this.id),this.it.ht(),y.med(y.MEM,null),this.filter._t(this.J)}}var zt=[];function bt(t){zt.push(gt(10,0,256,256,new Float32Array(t))),y.generateMipmap(y.X2T),y.texParameteri(y.X2T,y.NET,y.PAE)}class yt{constructor(t,i,s,e,h){this.nt=t,this.lt=!0,this.l=t.l,this.u=i,this.ut=s,this.ct=e,this.dt=p(-Y(this.u)*this.ut,K(this.u)*this.ut,0),this.offset=h||0}vt(){this.l=this.nt.l.p(b.A(this.offset)),this.wt=this.nt.wt}Y(){}gt(t){return this.nt.gt(t)}}class At extends yt{constructor(t,i,s,e){e<0&&(t.z-=e=-e),super({l:t,gt:t=>{}},i,s,e)}}class Qt extends At{constructor(i,s){super(i,s,32,30),this.uid=s,this.ft=s==k/2?new l(oi(p(1,64,40)),this.l,x(s),null,[1,1,1],[21,2]):_t(J(20).map(t=>new l(si(p(1,1,40)),i.p(g(x(s),p(0,4*t-40,0))),U(k/2),1,Nt[8*s/k])))}Y(){this.ft.Y()}}class jt{constructor(t,i,s,e){this.ft=t,this.l=i,this.xt=s,this.zt=e,this.dz=.003,this.yt=.999,this.At={}}vt(t){if(this.bt)return!0;this.xt.z-=this.dz*t,this.xt=this.xt.A(this.yt**t),this.l=this.l.p(this.xt.A(t/16)),t=A.Qt(this.l,this.At)+.5,this.zt?this.l.z<t&&(this.die&&this.die(),this.wt=!0):(this.l.z<t&&(this.bt=this.xt.G()<.1,this.l.z=t,this.xt.z=-this.xt.z,this.xt=this.xt.A(.8)),Et(this.l,this.l.p(this.xt.A(2))).map(t=>{this.gt&&this.gt(t[1]),t[1].gt&&t[1].gt(this);var i=t[0].g(this.l);this.xt.y*=.1<W(i.y)?-1:1,this.xt.x*=.1<W(i.x)?-1:1,this.l=this.l.T(t[0],1.3)}))}Y(){this.ft.l=this.l,this.ft.Y()}}class Mt extends jt{constructor(t,i,s){super(t,i,s),this.jt=F()}vt(t){super.vt(t)||(t=t*this.xt.G()*.005,this.ft.D=m(this.ft.D,[x(this.jt.x*t),f(this.jt.y*t),U(this.jt.z*t)].reduce(m)))}}class Ct extends jt{constructor(t,i){t=t.p(i),super(new l(ti,t,x(Math.atan2(i.y,i.x)),1,[5,0,0],[22,1]),t,i),this.dz=0,this.yt=1,this.start=q}vt(t){super.vt(t),this.l.K(j.l)<5&&(Yt(this.l),this.wt=!0),this.wt|=1e4<q-this.start}gt(){J(30).map(t=>C.push(new kt(this.l,2))),this.wt=!0}}var Bt=0;class Tt{constructor(t,i,s,e){this.l=t.p(b.A(5)),this.u=i||0,this.At={},this.Mt=0,this.Ct=0,this.ct=s,C.push(new yt(this,0,e,2*e,-s)),C.push(new yt(this,k/2,e,2*e,-s)),this.Tt=t,this.Rt=0,this.qt=100*O(),this.Et=.1,this.Vt=50,this.Gt=0}Kt(){C.map(t=>{t instanceof Tt&&t.l.K(this.l)<100&&!Et(t.l,this.l,!1,!0).length&&(t.Rt=t.Mt=1)})}gt(t){t||(this.wt=!0,Bt++%(5+2*R)==0&&C.push(new Ft(this.l.noz().p(b.A(A.Qt(this.l,this.At))))),J(30).map(t=>C.push(new kt(this.l,4))),this.Kt(),w(v.kt),this.Dt.map(t=>{C.push(new Mt(t,this.l.p(t.l),g(x(-j.u),p(O(),3+O(),1+Vi()))))}))}vt(t){this.Bt=this.Bt||[Et(this.l,this.l.p(g(x(this.u),p(1e5,0,0))),0,1)[0][0].g(g(x(this.u),p(5,0,0))),this.l];var i=-I(this.l,j.l);if(Vi()<1/t&&!this.Rt&&(W(i-this.u-k/2)<k/3||W(i-this.u-k/2)>2*k-k/3)&&!Et(j.l,this.l,!1,!0).length&&(this.Kt(),this.Rt=this.Mt=1),0==this.Mt){if(i=this.l.p(p(K(this.u)*t/this.Vt,Y(this.u)*t/this.Vt,0)),t=A.Qt(i,this.At),(s=j.l.g(this.l).G()<10&&i.K(j.l)<this.l.K(j.l))&&Yt(this.l),0<Et(this.l,this.Tt,!1,!0).length||s||W(t-this.l.z+this.ct)>5+this.Gt)return this.Tt=this.l.p(F().A(20).noz()),this.u=k*O(),void(this.Mt+=Vi()<.1);for(var s=this.Tt.g(this.l).noz(),e=Math.atan2(s.y,s.x);e-this.u>k;)this.u+=2*k;for(;this.u-e>k;)this.u-=2*k;this.u+=(e-this.u)*this.Et,this.l=i,this.l.z=t*(this.Gt<10)+this.ct,s.G()<30/this.Et/this.Vt&&(this.Rt?this.Mt=1:this.Bt.unshift(this.Tt=this.Bt.pop()))}1==this.Mt&&(s=j.l.g(this.l).v(),this.Tt=this.l.p(s.A(10)),Vi()<.1&&!this.Gt?C.push(new Ct(this.l.p(b.A(5)),j.l.g(this.l.p(b.A(8))).v().A(2+R))):this.Mt=0)}Y(s,e,h,n){this.Ht.map((t,i)=>t.D=m(x(this.u+k/2),n(Y(s[i]*this.qt)/e[i]))),this.Ht.map((t,i)=>t.l=this.l.p(b.A(K(2*this.qt)/3+5*(h<i)))),this.Ht.map(t=>t.Y())}}class Rt extends Tt{constructor(t,i){super(t,i,5,6),this.Dt=[[[2,3,5],[1.5,0,-5]],[[2,3,5],[-1.5,0,-5]],[[1.5,2,5],[-3.25,0,-5]],[[1.5,2,5],[3.25,0,-5]],[[5,2,5],[0,-.5,0],[.8,.8,.8]],[[4,5,4],[0,0,5],[.8,0,0]],[[.5,1.25,.5],[1,-2,7],[5,0,0]],[[.5,1.25,.5],[-1,-2,7],[5,0,0]],[[5,1,5],[0,1,0],[.4,.4,.4]]].map(t=>new l(oi(X(t[0])),X(t[1]),null,!1,t[2])),this.Ht=[_t(this.Dt.slice(4)),...this.Dt.slice(0,4).map(t=>_t([t]))]}vt(t){super.vt(t),this.qt<100&&R&&(this.qt+=100,C.push(new qt(this.l,this.u))),this.qt+=t/160}Y(){super.Y([0,1,-1,1,-1],[1,1,1,2,2],2,f)}}class qt extends Tt{constructor(t,i){super(t.R(),i,8,6),this.Dt=this.Ht=[new l(hi(t=>t.M(p(3,3*(.7-t.x),.1)).g(ot.A(1.5))),z,0,0,[.3,.3,.3]),new l(hi(t=>g(x(k),t.M(p(3,3*(.7-t.x),.1)).g(ot.A(1.5)))),z,0,0,[.3,.3,.3]),new l(oi(p(.8,3,.4)),z,0,0,[.3,.3,.3]),new l(hi(t=>t.M(p(.2,3.3,.2)).p(p(0,0,.1))),z,0,1,[8,0,0])],this.Ft=5*O(),this.Et=.1,this.Vt=20,this.Gt=50}vt(t){super.vt(t),this.At.o&&(this.ct+=.1*((this.At.o.Zt+this.At.o.Nt)/2+this.Ft-this.ct));var i=2*Y(this.qt/5)+Y(this.qt);this.qt+=t*(2+Y(this.qt))/200,t=2*Y(this.qt/5)+Y(this.qt),this.l.z+=t-i,t=1-1.01**-j.l.g(this.l).noz().V(),this.l.z=this.l.z*t+(j.l.z-10)*(1-t)}Y(){super.Y([1,-1,0,0],[1,1,1,1],9,U)}}function Et(s,e,h,n){var r=e.g(s).noz(),a=r.G();return C.map(t=>{var i;return t.lt&&(!n||t instanceof At)&&!(a+2*t.ut<((t.l.x-s.x)**2+(t.l.y-s.y)**2)**.5)&&(i=ht(s,r,t.l.p(t.dt),t.l.g(t.dt)))&&i[0]<=1&&t.l.z<s.T(e,i[0]).z&&s.T(e,i[0]).z<t.l.z+t.ct&&(!h||!(t instanceof Qt)||t.uid==k/2||i[1]%.05<.02)?[s.T(e,i[0]),t]:void 0}).concat(A.Xt.map(t=>{var i;if(h)return e.z<t.Nt&&(i=s.T(e,(t.Zt-s.z)/(e.z-s.z))),(i=t.Nt<e.z?s.T(e,(t.Nt-s.z)/(e.z-s.z)):i)&&A.Jt(i)==t?[i,{}]:void 0})).filter(t=>t).sort((t,i)=>t[0].K(s)-i[0].K(s))}class Vt{constructor(t,i,s){this.ft=new l(Pt(5),t.p(p(0,0,-1.5)).p(i.A(2)),0,1,[10,10,10]),this.c=0}Y(){this.ft.Y(),this.wt=2<this.c++}}class Gt{constructor(t,i){this.c=i,B[3].l=t.R()}Y(){this.c--||(B[3].l.z=1e9,this.wt=!0)}}var Kt=[];class kt extends jt{constructor(t,i){var s=.8*Vi();super(Kt.pop()||new l($t,t.p(F().A(i)),0,1,[10*K(s),10*Y(s),0]),t,new st(O()/2,O()/2,1.5+O()),!0),this.dz=.01}die(){this.ft.l.z=1e5,Kt.push(this.ft)}}class Dt extends Mt{constructor(t,i){super(new l(Ut,t,m(Q.D,U(k/2)),0,[.4,.4,.4]),t,p(O(),O(),3.5+O()/2).g(i).A(.2))}}class Ht{constructor(t,i){this.ft=i,this.ft.l=(this.l=t.p(b.A(2))).R(),this.qt=0,this.Ot=10}St(){w(v.St),setTimeout(()=>w(v.Yt),150)}vt(t){this.l.noz().K(j.l.noz())<this.Ot*(1+ji/2)&&(this.St(),this.wt=!0)}Y(){this.ft.Y()}}class Ft extends Ht{constructor(t){var i=n([.5,-.5,.6,.5,.3,.5,.3,.8,0,.5,-.2,.3,-.3,.3,-.4,.3,-.3,.3,-.1,.3,0,.5,-.2,.8],16,0,!0);super(t,new l(i,null,it,!1,[.1,.1,1]))}St(){super.St(),St(1),Lt([0,0,1,.5])}}class Zt extends Ht{constructor(t,i){t=t.p(p(4,0,0));var s=n([.9,0,.1,.1,0,4,.5,1,0,1,-.1,0,-.4,-1],32,0,!0),e=m(x(-i),f(-1.4));super(t,[new l(s,null,e,!1,[.4,.4,.4]),new l(Pt(2),null,0,1,[5,5,5])]),this.Ot=15,this.ft[1].l=(this.ft[0].l=this.l).p(g(e,b.A(5.8))),B[0].l=t.p(g(e,b.A(8))),B[0].it.u=i}St(){super.St(),Lt([.4,.4,.4,1]),Bi=!0}Y(){this.ft.map(t=>t.Y())}}var Nt=[[.47,.74,.6],[.12,.4,.6],[.95,.85,.35],[.95,.33,.22],[0,1,0]];class Xt extends Ht{constructor(t,i){var s=Nt[8*i/k],e=i==k/2?new l(n([0,0,2,2,0,.1,-1,.6],8,0,!0),t,it,!0,s):_t([new l(n([1.3,0,.8,0,0,.8,-.8,0,0,-.8],16,0,!1),p(-3,0,0),f(k/2),!0,s),new l(si(p(.6,.6,9)),p(-1,0,0),null,!1,s),new l(oi(p(2,1,1.5)),p(6,0,-1.5),null,!1,s),new l(oi(p(.6,1,.5)),p(5.25,0,-2),null,!1,s),new l(oi(p(.6,1,.5)),p(6.75,0,-2),null,!1,s)]);e.D=x(i),t.z+=6*(1==A.Wt.length&&!s[4]),super(t,e),this.Ot=15,this.uid=i}vt(t){super.vt(t),this.ft.D=m(x(t/400),this.ft.D),this.ft.l.z=this.l.z+4*Y(this.qt+=t/300)+4}St(){var t=C.filter(t=>t instanceof Qt&&this.uid==t.uid);t[0].nt.wt=!0,this.uid==k/2?(w(v.Lt),Lt([1,1,1,1]),C.push(new Jt(t[0].l.g(p(0,40,-10)))),A.It(A.$t.filter(t=>Tt.isPrototypeOf(t[1])||t[1]==It),C),C.map(t=>t.Rt=1),ji=!0,h.map(clearTimeout),h=[]):(super.St(),Lt([0,.5,0,.5]))}}class Jt extends Ht{constructor(t){super(t.g(b.A(20)),new l(oi(p(1,40,40)),t,x(k/2),1,[10,10,10])),B[2].l=t.p(p(0,-20,0)),B[2].it.u=0,B[2].ot=!0,this.Pt=0}vt(t){super.vt(t),200<(this.Pt+=t)&&!this.w&&(this.w=1,C=(t=C).filter(t=>t.q),B[2].rt(),C=t)}St(){Lt([1,1,1,1]),1<A.Wt.length?(T={},setTimeout(t=>{Ri(-1),xi(),A.Wt.shift(),A.Ut()},200)):(hQ.style.display="none",qQ.style.top="40vh",setTimeout(t=>{gi=!0,document.exitPointerLock(),G=[1,1,1,0],cancelAnimationFrame(zi),hE.innerHTML=`You got back in ${q/6e4|0}m ${q/1e3%60|0}s.<br><br>`,R?(setTimeout(t=>hE.innerHTML+="Congratulations.<br><br>Developer Par:9m 00s<br><br>Reload to play again.",2e3),R=1):(setTimeout(t=>hE.innerHTML+="Get ready for hard difficulty.",2e3),R=1,setTimeout(t=>{gi=!(G=[0,0,0,1]),Qi=5,xi(),A.Wt=[...A.ti],A.Ut(),requestAnimationFrame(Ti)},5e3))},200))}}var Ot=0;function St(t){hW.style.width=(Qi=Math.min(Qi+t,9))+1+"vw",hW.className="b"[2<Qi|0]}function Yt(i){450-200*R<q-Ot&&(w(v.hit),Ot=q,C.push(new Gt(i)),J(15).map(t=>C.push(new kt(i,4))),vi++,Lt([.3,0,0,.7]),St(-1))}var Wt=[];function Lt(s){G=s.map(t=>t),Wt.map(clearTimeout),Wt=J(20).map(t=>{return i=t/20,setTimeout(t=>G=[s[0]*i,s[1]*i,s[2]*i,s[3]*i+(1-i)],400*(1-i)+200);var i})}function It(i,t){return J(5*R+5+t*k|0).map(t=>C.push(new[Rt,qt][t%2](i.p(F().noz().A(20)),10*O()))),{Y:J,wt:1}}var $t,Pt,Ut,ti,ii,si=i=>n([1,0,0,.001,0,1,0,.001],32,0,!0,t=>g(U(-k/2),t.M(i))),hi=i=>n([.71,0,0,1],4,0,!0,t=>i(g(x(-k/4),t))),oi=i=>hi(t=>t.M(i)),ei=[null,null,Rt,qt,Ft,Xt,Qt,Zt,null,It];class _i{constructor(){this.Wt=["rgt413aHp9UFRwdXm2S6cGajdGc0csIDhMeKwQUngnOne8qtCa19bVwnkHBQZ2LYdcSzFERiVTdZmLd7N3NWfFtGTMrYttSyYil4xasKMDBwscKcTWx9vGJ5cMQDUslqsQiEm3iHe2d4RwnLt8RGZ3YXeGfCjgNz13uQB3OHdqd+RnbPkq0DeDd2ZZ10246xA7d7Nw==","ISyRA4qoQGbRdGKrcGV7co0JrseGo4VBdwd3rAOEx4rBBSeCg4eLzAVL26uTRWYjcmQ2cGR6cMGMsgmu445716NQFAfEkQNKKJNiO37CCKSqvG45FHKzwqoC2ihlhnRpknDIjbQIGyc2Y7LEjIzEkQVUVVyquGdDdMONA7CMS2PScJEEo4mXPMEEV6PjTAWMjJNzYMcES2Vikw==","IcCVBWJhZ21sZqd0ZTRxZzpykbMVemdseVdemunnhCVUpppIyYWBcTYzZNxwzK4DB3nnYlF0Ytd8Yt1wkQMHeedmbXFjnnCRAwd555EDB3nnkbQIiIe16RsYJUPEkQcFYZJ2o56NYyV0wgM1bZdldXRkRHDBgIuqA4FHbcGnA6ehF2KJcGKWcJGwBWJAxa6ewpAEKRJT52J9cMGRsQWbKnw2cGK2cMGRA7iOJpG1BzyNq5B1l4LBlgNXeZdjfXBiKHBkTXAh7iGHA6ZUSA==","Ia2OA7S3KmIKcAMsxsBk23DCjQPCRxtm63JlbXJifXCRBdO0KCpJjQdzoZS7uigqwpEFt1RDB7tmc3TBkKwDhMeKjLIGyLleC8BUwpGqECira1tLGorks6q6pEYThIDEkA1K59bJdCUYZkGzRyrOYppwwrQFMcHZfTtpUXDCAlU3ZalxZLpwy7EGoOXcPgklwZED5ZkKwQShkkk+aUJ1wQOlEklkenDCkasF2p44UzVmpXFlx3Bm6HPCA7aKJ2WWdNuLsQatKwcywOZnWXVmp3BpPnDCmAO8OjRip3BipXBl1HPThqwFJ4KDh4vQrQdsm6eVVlaD","IQQhZ5MCkqlmfXFlWnJm2HRnV3JkPHCLqwWZbFojhMKzC325p6aUclB3B3dsYo5wwawDhMeKwQUngoOHi8yasQNamIRlenRiVnhirHBiqHBjm3CMsAVqjOdgNmLbcGXtcQ64tMyOXhwbqdPhgHBABM2SrQOOh2CMsQTZfThlwQVLN5zTocK0CgcoNidxx6WnqchiSXjCqgNHdadjZnxiLXBjTXCNA0d1p40DR3WnjQNHdafPlQYbToy3YcNmHnLCBDeb5XO0CHvL6eWQRSQXaepw"],this.ti=[...this.Wt]}It(t,r){t.map(([t,i,s,e,h,n])=>{(r||t).push(new i(s.p(p(0,0,this.Qt(s.p(p(2,2,0))))),e,h,n))})}Ut(){ft=0,C=[],(B=J(4).map(t=>new xt(p(0,0,1e3),0,0)))[0].ot=B[0].ii=!0,[this.Xt,this.$t]=ni((t=this.Wt[0],atob(t).split``.map(t=>t.charCodeAt(0)))),A.It(this.$t);var t,r,s=J(32).map(t=>[[],[]]),a={},o=(t,i)=>{s[t][0].push(J(6*(i.length-2)).map(t=>[r,0,0])),s[t][1].push(i,[...i].reverse())};this.Xt.map(i=>{i.si.map(t=>{t=t.map(t=>[t.x,t.y]).sort(),a[t]=$(a[t]||[],[i.Zt,i.Nt])}),o(i.Zt<0?20:22,i.hi.map(t=>p(t.x,t.y,i.Zt))),o(21,i.hi.map(t=>p(t.x,t.y,i.Nt)))}),Object.keys(a).map(t=>{var[s,e,h,n]=t.split`,`.map(Number);i(a[t]).map(t=>{var i=(t=[p(s,e,t[0]),p(h,n,t[0]),p(h,n,t[1]||0),p(s,e,t[1]||0)])[0].T(t[1],.5);r=-I(t[0],i),C.push(new At(i,r,t[0].K(i),t[2].z-t[0].z)),o(21,t)})}),s.map(([t,i],s)=>{t.length&&(C.unshift(new l(nt(i),z,null,null,[1,1,1],[s,1+(21==s)])),C[0].q=!0,C[0].Z=new Float32Array(t.flat(2)),C[0].S())}),C.push(Q),C.push(ii=_t(new Rt(p(-1e6,0,0)).Ht.map((t,i)=>(t.l=t.l.p(b.A(5*(3==i||4==i))),t)))),B.map(t=>t.ot&&t.rt()),h.map(clearTimeout),h=[],D()}Qt(t,i){return(i=i||{}).o&&this.oi(i.o,t)||(i.o=this.Jt(t),i.o)?i.o.Zt:-100}oi(t,i){return i=i.p(F().A(.01)),t.si.filter(t=>ht(i,ot,...t)).length%2==1}Jt(t){for(var i in this.Xt)if(this.oi(this.Xt[i],t))return this.Xt[i]}}class ri{constructor(t,i,s){this.hi=t,this.Zt=i,this.Nt=s,this.si=H([...t,t[0]],(t,i)=>[t,i])}}function ni(i){for(var t=[],s=[z],e=4,h=40,n=[],r=0;r<i.length;){var[a,l]=[31&(a=i[r++]),a>>5];l<=1&&(t.push(new ri([s[0],...J(a).map(t=>(s.unshift(s[0].p(p(8*((i[r]>>4)-7),8*(i[r++]%16-7),0))),s[0]))],e,h)),1==l)&&t.pop(),3==l&&n.push([C,ei[a],s[0].p(p(8*((i[r]>>4)-7),8*(i[r++]%16-7),2*((i[r]>>4)-7))),i[r++]%16/8*k,0,!0]),e+=2*(a-15)*(4==l),h+=4*(a-15)*(5==l),s.splice(0,a*(6==l))}return[t,n]}var y,A,Q=[],j,ai,li,ui,M,ci,di,C=[],B=[],vi=0,T={},wi=!1,mi=!0,gi=!1;function pi(){var i,o,s,e;rt(),y.xoE`EXT_color_buffer_float`,y.xoE`OES_texture_float_linear`,[li,ci]=ut(y,at+Ei),[ui,di]=ut(y,at+"void main(){A.r=distance(g[a],m);A.g=A.r*A.r;}"),i=(t,i,s)=>t*(1-(s=s*s*(3-2*s)))+i*s,o=J(16).map(t=>J(16).map(t=>p(O(),O(),0).v())),bt((s=Z(J(256),J(256),(s,e)=>{var h=p(0|(e/=16),0|(s/=16),0),t=Z(J(2),J(2),(t,i)=>o[s+t&15][e+i&15].dot(h.p(p(i-e,t-s,0))));return 2*i(i(t[0],t[1],e-h.x),i(t[2],t[3],e-h.x),s-h.y)+.2})).map(t=>[t,t,t,1]).flat()),bt(s.map(t=>[t,0,0,1]).flat()),bt(Z(J(256),J(256),(t,i)=>t%64<=2||W(i-(t/64|0)%2*128)<=2?[0,0,0,1]:[i=.9-s[256*i+t]/20,i,i,1]).flat()),e=Z(J(16),J(8),(t,i)=>[32*t,64*(i+t%2/2),1+t%2]),bt(Z(J(256),J(256),(i,s)=>{var t=e.map(t=>[t[2]*(W(t[0]-s)+W(t[1]-i)),t[2]]).sort((t,i)=>t[0]-i[0]);return W(t[0][0]-t[1][0])<4?[1,1,1,1]:[.1,.1,.1,1]}).flat()),bt(s.map(t=>[t,0,0,1]).flat()),$t=(Pt=i=>n([0,-.5,.35,.15,.15,.35,-.15,.35,-.35,.15].map(t=>t*i),8,0,!1))(1),Ut=n([.5,0,0,.05,-.1,0,0,.01,0,1.5,0,.01,-.05,0,0,-1.4],8,0,!0),ti=n([.2,0,.2,2,.4,1,.4,.4,0,.6,-.4,.4,-.4,.2],32,0,!0,t=>g(U(-k/2),t)),[2,5,6].map(t=>Q.push(new l(si(p(1.8,1.8,.5)),p(t,0,0),null,!1,[.7,.7,.7]))),J(8).map(t=>{Q.push(new l(si(p(.5,.5,8.5)),g(f(t*k/4),et),null,!1))}),(Q=_t(Q)).ei=z,r(),t=a((t=[100,7,55,25,35,20,,15,,,4,,,,2,33,-8,-23,20,,23,4,-48,30,100,,5,100,55,20,,,-10,,,,,,,,-40,-5,15,,,,,30,,,5,100,55,20,,,-10,,,,,,,,-40,-5,15,,,,,30,300,10,25,5,20,25,10,,,50,,,,50,,,,,10,,50,50,,60,300,5,15,5,20,25,10,,,50,,,,50,,,,,10,,50,50,,60,300,45,55,,55,15,,-10,,,,,,,,,,,25,,,,,30,0,5,5,,45,5,,-10,,,,,,,,,-25,,5,,,,,300]).map(t=>t/100),24),v.kt=c([u(t[0])]),v.gun=c([u(t[1]),u(t[2])]),v.St=c([u(t[3])]),v.Yt=c([u(t[4])]),v.Lt=c([u(t[5]),u(t[5]).slice(2e3)]),v.hit=c([u(t[6]),u(t[1])])}function fi(){window.onkeydown=t=>{T[t.key]=!0},window.onkeyup=t=>{delete T[t.key]},y._av.onclick=t=>{y._av.ncu()},document.onpointerlockchange=t=>{wi=!0,D(),y._av.onmousemove=document.pointerLockElement==y.canvas&&(t=>{Ai||(j.u+=t.movementX/200,j.L=S(j.L+t.movementY/200,-1.3,1.3))}),y._av.onmousedown=t=>{T._i=!0},y._av.onmouseup=t=>{delete T._i}},xi(),(A=new _i).Ut(),Lt([0,0,0,0]),Ti(1)}function xi(){hQ.style.display="block",qQ.style.top="5vh",qQ.style.left="45vw",hE.innerHTML="",j=new ct(p(24,-16,10+10*(A&&3==A.Wt.length)),[y._av.width,y._av.height],1.22,!1,28),G=[0,0,0,1],B=[],C=[],R||(Qi=5),St(ji=Bi=Ai=0),ai=new mt}var zi,R=0,bi=0,q=0,E=0,yi=0,V=0,G=[0,0,0,1],Ai=!1,Qi=5,ji=!1,Mi=0,Ci=0,Bi=!1;function Ti(t){if(!gi){zi=requestAnimationFrame(Ti);var e=j.l;if(Ai)a=((t-Ai)**.8-(q-Ai)**.8)/400,G[3]-=.01*(0<G[3]),j.u+=a,j.I+=a,j.L-=a/3,y.eaP(li),M=ci,j.ht(),ai(j.J),q=t;else{var i,s=Math.min(t-q,50),h=[];for(i in T){var n="sawd".indexOf(i);-1!=n&&(V+=.1*(V<1),h.push(g(x(-j.u-k/2*n),et.A(-s/12))))}var r,a=m(x(-j.u),f(-j.L)),l=g(a,ot.A(-3)),o=g(a,et),u=p(.2+.2*Y(E),1,-.3-W(E%k-k/2)/20),c=(T._i&&(vi+=.15*(vi<1.5),100<t-yi&&(yi=t,w(v.gun),c=100,0<(r=Et(j.l,j.l.p(o.A(1e4)).p(F().A(320*vi)),!0)).length&&(c=(r=r[0])[0].K(Q.l),C.push(new Gt(r[0].T(j.l,.2),3)),J(30).map(t=>C.push(new kt(r[0],2))),r[1].gt)&&r[1].gt(),C.push(new Vt(Q.l,o,c)),C.push(new Dt(Q.l,l)),Q.ei=p(0,-.2,0)),j.l=j.l.g(o.A(.1)),V*=.8),h.length?(j.l=j.l.p(L(h).A(V)),E+=s/180):(V=(V-=(0<V)*s/160)*(0<V),E-=(E%k-k*(k/2<E%k))*s/160),j.l.z<10&&A.Qt(j.l)<0&&500<q-Ot&&Yt(p(0,0,-1e9)),J(8).map(t=>{Et(j.l.g(b.A(5)),j.l.p(p(6*Y(t/4*k),6*K(t/4*k),-5))).filter(t=>t[1]instanceof At).map(t=>{var i=g(x(t[1].u),ot),s=g(x(t[1].u),et),s=t[1].l.p(s.A(s.dot(j.l.g(t[1].l))));j.l=s.p(i.A(6*(s.p(i).K(e)<s.K(e)?1:-1))),j.l.z=e.z})}),A.Qt(j.l)+10-j.l.z),[o,c,l,d]=(j.l.z+=S(c*s/30,-2,3),vi=S(vi-.15*c*(c<0)-.1,0,4),Bi&&(B[0].l=B[0].l.T(j.l.g(l),.2),B[0].it.u+=(j.u-B[0].it.u)/2,B[0].it.L+=(j.L-B[0].it.L)/2),[j.u,j.L,j.l.z,B[0].l.z]),D=(j.l.z+=2*K(2*E)+4*(V-1),B[0].l.z+=Bi&&2*K(2*E)+4*(V-1),j.I=Y(E)/50,T._i?f(t/100):it);Q.l=j.l.p(g(a,u.p(Q.ei)).A(8)),Q.ei=Q.ei.T(z,.1),Q.D=m(m(a,x(-k/2)),D),ii.l=j.l.g(g(ii.D=x(-j.u),p(0,4+10*Bi,5))),u=Math.min(vi,2)**2/200,j.u+=O()*u,j.L+=O()*u,j.I+=O()*u,B.map(t=>t.ii&&t.rt()),y.eaP(li),M=ci,j.ht(),ai(j.J),q=Qi<0&&!Ai?(setTimeout(t=>{Ri(-1),Qi=5,xi(),R&&(A.Wt=[...A.ti]),A.Ut()},3e3),Ai=t):([j.u,j.L,j.l.z,B[0].l.z]=[o,c,l,d],C.map(t=>t.vt&&t.vt(s)),30<(a=C.filter(t=>t.bt)).length&&(C=C.filter(t=>!t.bt||t.gc),(a=_t(a.map(t=>t.ft).filter(t=>t))).bt=a.gc=!0,C.push(a)),Ci=.99*Ci+(30<s)+5*(100<s),8<(Mi=.9*Mi+(30<s))&&(C=C.filter(t=>!t.gc)),30<Ci*mi&&bi<2&&(Ci=0,Ri(1),[D={it:j},...B].map((t,i)=>{(0==i&&400<j.W[0]||0<i&&100<j.W[0])&&(t.it=new ct(t.it.l,t.it.W.map(t=>t/2),t.it.fov,t.it.P,t.it.tt,t.it.u,t.it.L),t.J=t.it.J)}),j=D.it,ai=new mt),C=C.filter(t=>!t.wt),t)}}}function Ri(t){cQ.height=(cQ.width=1600>>(bi=S(bi+t,0,2)))/window.nte*window.innerHeight}function qi(){[y=cQ.getContext`webgl2`,y.canvas,window,document,document.body].map(t=>{for(var i in t)try{t[(i[i.length-8]||"_")+i[i.length-2]+i[3]]=t[i]}catch(t){}}),Ri(1),G=[0,0,0,0],pi()}window.onload=t=>setTimeout(qi,1);let Ei="float T(int r,vec2 R){vec4 o=v(r,R);float z=o.x,H=max(o.y-z*z,.1),n=distance(g[r],m);return clamp(max(clamp((H/(H+(n-z)*(n-z))-.2)/.8,0.,1.),smoothstep(n-.02,n,z)),0.,1.);}void main(){if(l){A=O;return;}vec3 C=normalize(I.xyz);float B;B+=clamp(dot(vec3(0,0,-1),C),0.,1.),B+=clamp(dot(vec3(1,0,.5),C),0.,1.),B+=clamp(dot(vec3(-.5,-.86,.5),C),0.,1.),B+=clamp(dot(vec3(-.5,.86,.5),C),0.,1.),B*=k*(1.-smoothstep(0.,1.,clamp(length(g[4]-m)/150.-.3,0.,.9)));if(!d[0]||b[0].z>0.){vec2 Q=b[0].xy/b[0].w;float u=d[0]?T(0,Q*.5+.5):1.;if(u>0.){vec4 w=g[0]-m;float F=d[0]?clamp(.9-dot(Q,Q),0.,.095)*10./.95:1.,D=dot(C,normalize(w.xyz))+1.;vec4 x=normalize(normalize(w)+normalize(w));float G=pow(abs(dot(C,x.xyz)),100.)*.1;D+=G;float q=distance(g[0],m); D*=c[0]*F*F*u/(d[0]?1.:sqrt(q)),B+=k*pow(D,3.);}}if(!d[1]||b[1].z>0.){ vec2 Q=b[1].xy/b[1].w; float u=d[1]?T(1,Q*.5+.5):1.; if(u>0.){ vec4 w=g[1]-m; float F=d[1]?clamp(.9-dot(Q,Q),0.,.095)*10./.95:1.,D=dot(C,normalize(w.xyz))+1.; vec4 x=normalize(normalize(w)+normalize(w)); float G=pow(abs(dot(C,x.xyz)),100.)*.1; D+=G; float q=distance(g[1],m); D*=c[1]*F*F*u/(d[1]?1.:sqrt(q)),B+=k*pow(D,3.);}} if(!d[2]||b[2].z>0.){ vec2 Q=b[2].xy/b[2].w; float u=d[2]?T(2,Q*.5+.5):1.; if(u>0.){ vec4 w=g[2]-m; float F=d[2]?clamp(.9-dot(Q,Q),0.,.095)*10./.95:1.,D=dot(C,normalize(w.xyz))+1.; vec4 x=normalize(normalize(w)+normalize(w)); float G=pow(abs(dot(C,x.xyz)),100.)*.1; D+=G; float q=distance(g[2],m); D*=c[2]*F*F*u/(d[2]?1.:sqrt(q)),B+=k*pow(D,3.);}}if(!d[3]||b[3].z>0.){ vec2 Q=b[3].xy/b[3].w; float u=d[3]?T(3,Q*.5+.5):1.; if(u>0.){ vec4 w=g[3]-m; float F=d[3]?clamp(.9-dot(Q,Q),0.,.095)*10./.95:1.,D=dot(C,normalize(w.xyz))+1.; vec4 x=normalize(normalize(w)+normalize(w)); float G=pow(abs(dot(C,x.xyz)),100.)*.1; D+=G; float q=distance(g[3],m); D*=c[3]*F*F*u/(d[3]?1.:sqrt(q)),B+=k*pow(D,3.);}} A.rgb+=pow(B,.33),A*=O; if(h>0) A*=v(t+5,h==1?m.xy/32.:vec2(dot(m.xy,vec2(sin(N.x),-cos(N.x))),m.z)/16.); A.w=1.;}";var Y=Math.sin,K=Math.cos,k=Math.PI,Vi=Math.random,W=Math.abs,Gi=Math.max</script>