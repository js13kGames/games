<!doctype html><title>Air Fury - js13kGames 2014</title><style>*{margin:0;padding:0;overflow:hidden;font-family:Impact,Charcoal,sans-serif;letter-spacing:2px}body{background:#d3edff}canvas{width:800px;height:500px;position:absolute}a{text-decoration:none;color:#43677f}div{z-index:2;position:relative}#w,#w1{width:800px;height:500px;margin:0 auto}#w{color:#fff;text-shadow:2px 2px #000;box-shadow:0 0 5px #222}#g{z-index:0}#h2o{z-index:1}#gmo,#hud,#pz,#ss{position:absolute;width:100%;height:100%}#gmo,#hud,#pz{display:none}#hud{top:0;width:100px}#gmo,#ldng,#pz,#ss{text-align:center}#pz>div{font-size:36px;background:#333;padding:30px;margin-top:190px}#score{padding:2px}#hp{height:8px;margin:2px;background:#ffa2a0}#power{height:8px;margin:2px;background:#585fcc}#ss>div{background:#333;padding:10px;width:100%;position:absolute}#title{font-size:114px;top:0;height:140px}#instr{font-size:32px;bottom:0;height:50px}.cred{font-size:12px}#ldng{background:#333;height:100%}#gmo>div{font-size:36px;background:#333;padding:30px;margin-top:90px}#fscore{color:#87ceff}#hscore{color:#ffa2a0}</style><div id=w><div id=ldng>LOADING</div><div id=ss><div id=title>AIR FURY</div><div id=instr>PRESS W or UP TO START</div></div><div id=pz><div>||</div></div><div id=gmo><div><div style=font-size:72px>GAME OVER</div><div id=fscore></div><div id=hscore>Highscore!</div><br><div>PRESS W or UP TO REPLAY</div></div></div><div id=hud><div id=score></div><div id=hp></div><div id=power></div></div><canvas id=g></canvas><canvas id=h2o></canvas></div><div id=w1 style=height:auto><div style=font-family:Helvetica><h2>CONTROLS:</h2>W or Up to move forward. A or Left and D or Right to turn. Space to shoot. Shift to use Focus, your slow-motion power. Stop shooting to repair. Press P to toggle pause.</div><br><div style=text-align:center;font-size:12px;font-family:Helvetica>CREATED BY <a href=http://goo.gl/DHiQ0h>@FERRONSAYS</a>. INSPIRED BY <a href=http://goo.gl/IuybCe>@VLAMBEER</a>'S LUFTRAUSERS</div></div><script>!function(){function t(){this.B=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;.01>this.c&&(this.c=.01),.18>(t=this.b+this.c+this.e)&&(t=.18/t,this.b*=t,this.c*=t,this.e*=t)}}(function(){return this}()).AF={};var e=new function(){var e,n,i,a,s,o,r,c,h,l,d,u;this.A=new t,this.reset=function(){var t=this.A;a=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),o=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,u=5e-5*-t.o),c=1+t.l*t.l*(0<t.l?-.9:10),h=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.D=function(){this.reset();var t=this.A;return e=t.b*t.b*1e5,n=t.c*t.c*1e5,i=t.e*t.e*1e5+12,3*((e+n+i)/3|0)},this.C=function(t,p){var f=1!=(X=this.A).s||X.v,v=X.v*X.v*.1,w=1+3e-4*X.w,m=X.s*X.s*X.s*.1,g=1+1e-4*X.t,y=1!=X.s,x=X.x*X.x,P=X.g,S=X.q||X.r,b=X.r*X.r*X.r*.2,Z=X.q*X.q*(0>X.q?-1020:1020),D=X.p?32+((1-X.p)*(1-X.p)*2e4|0):0,C=X.d,k=X.j/2,G=X.k*X.k*.01,V=X.a,N=e,R=1/e,T=1/n,A=1/i;(X=5/(1+X.u*X.u*20)*(.01+m))>.8&&(X=.8);for(var z,I,F,_,B,X=1-X,O=!1,$=0,j=0,E=0,M=0,W=0,U=0,L=0,Y=0,q=0,H=0,J=Array(1024),K=Array(32),Q=J.length;Q--;)J[Q]=0;for(Q=K.length;Q--;)K[Q]=2*Math.random()-1;for(Q=0;p>Q;Q++){if(O)return Q;if(D&&++q>=D&&(q=0,this.reset()),l&&++h>=l&&(l=0,a*=c),(a*=o+=r)>s&&(a=s,P>0&&(O=!0)),I=a,k>0&&(H+=G,I*=1+Math.sin(H)*k),8>(I|=0)&&(I=8),V||(0>(d+=u)?d=0:d>.5&&(d=.5)),++j>N)switch(j=0,++$){case 1:N=n;break;case 2:N=i}switch($){case 0:E=j*R;break;case 1:E=1+2*(1-j*T)*C;break;case 2:E=1-j*A;break;case 3:E=0,O=!0}S&&(0>(F=0|(Z+=b))?F=-F:F>1023&&(F=1023)),f&&w&&(1e-5>(v*=w)?v=1e-5:v>.1&&(v=.1)),B=0;for(var tt=8;tt--;){if(++L>=I&&(L%=I,3==V))for(z=K.length;z--;)K[z]=2*Math.random()-1;switch(V){case 0:_=d>L/I?.5:-.5;break;case 1:_=1-L/I*2;break;case 2:_=.225*((0>(_=1.27323954*(_=6.28318531*((_=L/I)>.5?_-1:_))+.405284735*_*_*(0>_?1:-1))?-1:1)*_*_-_)+_;break;case 3:_=K[Math.abs(32*L/I|0)]}f&&(z=U,0>(m*=g)?m=0:m>.1&&(m=.1),y?(W+=(_-U)*m,W*=X):(U=_,W=0),M+=(U+=W)-z,_=M*=1-v),S&&(J[Y%1024]=_,_+=J[(Y-F+1024)%1024],Y++),B+=_}B=.125*B*E*x,t[Q]=B>=1?32767:-1>=B?-32768:32767*B|0}return p}};window.jsfxr=function(t){e.A.B(t);var n=e.D();t=new Uint8Array(4*((n+1)/2|0)+44),n=2*e.C(new Uint16Array(t.buffer,44),n),(i=new Uint32Array(t.buffer,0,44))[0]=1179011410,i[1]=n+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=n,n+=44;for(var i=0,a="data:audio/wav;base64,";n>i;i+=3){var s=t[i]<<16|t[i+1]<<8|t[i+2];a+=z[s>>18]+z[s>>12&63]+z[s>>6&63]+z[63&s]}return a},function(){var t=!1,e=/xyz/.test((function(){}))?/\b_SP\b/:/.*/;this.Class=function(){},Class.extend=function(n){function i(){!t&&this.init&&this.init.apply(this,arguments)}var a=this.prototype;t=!0;var s=new this;for(var o in t=!1,n)s[o]="function"==typeof n[o]&&"function"==typeof a[o]&&e.test(n[o])?function(t,e){return function(){var n=this._SP;this._SP=a[t];var i=e.apply(this,arguments);return this._SP=n,i}}(o,n[o]):n[o];return i.prototype=s,i.prototype.constructor=i,i.extend=arguments.callee,i}}();var n=function(){function t(t,e){this.x=t||0,this.y=e||0}return t.prototype={copy:function(){return new t(this.x,this.y)},length:function(){return T.sqrt(this.x*this.x+this.y*this.y)},norm:function(){var t=this.length();return t>0&&this.divide(t),this},limit:function(t){return this.length()>t?(this.norm(),this.mult(t)):this},heading:function(){return-1*T.atan2(-1*this.y,this.x)},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mult:function(t){return this.x=this.x*t,this.y=this.y*t,this},divide:function(t){return this.x=this.x/t,this.y=this.y/t,this},toInt:function(){return this.x=T.round(this.x),this.y=T.round(this.y),this}},t}(),i=Class.extend({init:function(t){var e=this;e.dist=200,e.T1G1Distance=1600,e.lookat=new n,e.c=t.c,e.fov=T.PI/4,e.vp={l:0,r:0,t:0,b:0,w:0,h:0,scale:new n(1,1)},e.BNZ=t.BNZ,e.lerp=!0,e.lerpD=.04,e.shake=0,e.stepVp(0)},begin:function(){this.c.save(),this.scale(),this.translate()},end:function(){this.c.restore()},scale:function(){this.c.scale(this.vp.scale.x,this.vp.scale.y)},translate:function(){this.c.translate(-this.vp.l,-this.vp.t)},step:function(t){var e=this;e.shake=T.max(e.shake-t,0),e.zoomTo(e.dist+.05*(e.T1G1Distance-e.dist))},stepVp:function(){var t=this;t.aspectRatio=t.c.canvas.width/t.c.canvas.height,t.vp.w=t.dist*T.tan(t.fov),t.vp.h=t.vp.w/t.aspectRatio,t.vp.l=t.lookat.x-t.vp.w/2,t.vp.t=t.lookat.y-t.vp.h/2,t.vp.scale.x=800/t.vp.w,t.vp.scale.y=500/t.vp.h,t.lockBounds(),t.shake>0&&(t.vp.l+=4*R.randPN(),t.vp.t+=4*R.randPN()),t.vp.r=t.vp.l+t.vp.w,t.vp.b=t.vp.t+t.vp.h},zoomTo:function(t){this.dist=t,this.stepVp()},moveTo:function(t,e){var n=this;n.lerp?(n.lookat.x-=(n.lookat.x-t)*n.lerpD,n.lookat.y-=(n.lookat.y-e)*n.lerpD):(n.lookat.x=t,n.lookat.y=e),n.stepVp()},lockBounds:function(){var t=this;t.vp.l=R.clamp(t.vp.l,t.BNZ.l,t.BNZ.r-t.vp.w),t.vp.t=R.clamp(t.vp.t,t.BNZ.t,t.BNZ.b-t.vp.h)},screenToWorld:function(t,e,n){return(n=n||{}).x=t/this.vp.scale.x+this.vp.l,n.y=e/this.vp.scale.y+this.vp.t,n},worldToScreen:function(t,e,n){return(n=n||{}).x=(t-this.vp.l)*this.vp.scale.x,n.y=(e-this.vp.t)*this.vp.scale.y,n}}),a=Class.extend({init:function(t){this.NDZ=[],this.p=new n,this.r=0,R.extend(this,t)},step:function(t){for(var e=this.NDZ.length;e--;){var n=this.NDZ[e];n.step(t),n.alive||this.NDZ.splice(e,1)}},draw:function(t){var e=this.NDZ.length;if(0!==e){for(t.save(),t.translate(this.p.x,this.p.y),t.rotate(this.r);e--;)this.NDZ[e].draw(t);t.restore()}},A3C4:function(t){this.NDZ.push(t)}}),s=Class.extend({init:function(){this.SDZ={}},add:function(t,e,n){this.SDZ[t]=[];for(var i=0;i<n.length;i++){var a=n[i];this.SDZ[t].push({tick:0,count:e,pool:[]});for(var s=0;e>s;s++){var o=new Audio;o.src=jsfxr(a),this.SDZ[t][i].pool.push(o)}}},play:function(t){if(A.chrome){var e=this.SDZ[t],n=e.length>1?e[T.floor(T.random()*e.length)]:e[0];n.pool[n.tick].play(),n.tick<n.count-1?n.tick++:n.tick=0}}}),o=Class.extend({init:function(){this.bind()},bind:function(){var t=this,e=A.addEventListener;e("keydown",(function(e){switch(e.keyCode){case 68:t.D=!0;break;case 65:t.A=!0;break;case 87:t.W=!0;break;case 32:t.Space=!0;break;case 37:t.L=!0;break;case 38:t.U=!0;break;case 39:t.R=!0;break;case 16:t.Shift=!0}})),e("keyup",(function(e){switch(e.keyCode){case 68:t.D=!1;break;case 65:t.A=!1;break;case 87:t.W=!1;break;case 32:t.Space=!1;break;case 37:t.L=!1;break;case 38:t.U=!1;break;case 39:t.R=!1;break;case 16:t.Shift=!1}}))}}),r=a.extend({init:function(t){var e=this;e._SP(t),e.alive=!0,e.max=1,e.sTime=0,e.aDelay=0,e.aCounter=0,e.aIncDelay=0,e.aIncCounter=0,e.aIncFactor=1,R.extend(e,t)},step:function(t){var e=this;e._SP(t),G1.tTime<e.sTime||(e.aCounter>=e.aDelay&&(e.aCounter=0,e.NDZ.length<e.max&&e.spawnEntity()),e.aIncCounter>=e.aIncDelay&&(e.aIncCounter=0,e.aDelay*=e.aIncFactor),e.aCounter+=t,e.aIncCounter+=t)},spawnEntity:function(){},randOBSpawn:function(){var t,e,i=G1.BNZ;return e=R.randRange(i.t,i.b-100),t=T.random()>.5?i.l-100:i.r+100,new n(t,e)},randWaterSpawn:function(){var t=G1.BNZ;return new n(R.randRange(t.l,t.r),0)}}),c=r.extend({init:function(){var t=this;t._SP(),t.max=115,t.sTime=1e3,t.aDelay=1100,t.aCounter=1200,t.aIncDelay=6e4,t.aIncCounter=0,t.aIncFactor=.85},spawnEntity:function(){this.NDZ.push(new k({s:.75,p:this.randOBSpawn(),T1G1:G1.ace,g:!1}))}}),h=r.extend({init:function(){var t=this;t._SP(),t.max=8,t.sTime=1e3,t.aDelay=5e3,t.aCounter=5e3,t.aIncDelay=6e4,t.aIncCounter=0,t.aIncFactor=.85},spawnEntity:function(){this.NDZ.push(new N({p:this.getSpawnPoint(),T1G1:G1.ace}))},getSpawnPoint:function(){var t=!1,e=null,n=0;t:for(;!t;)if(e=this.randWaterSpawn(),!R.inViewport({p:e,R1Z:62})){if((n+=1)>10)break t;var i=this.NDZ.length;if(0===i){t=!0;break t}for(var a=0;i>a;a++){var s=this.NDZ[a];if(e.copy().sub(s.p).length()<175)continue t}t=!0}return e}}),l=a.extend({init:function(t){this._SP(),this.debugDraw=!1,R.extend(this,t)},step:function(t){var e=this;e._SP(t);for(var n=e.NDZ.length,i=0;n>i;i++)for(var a=0;n>a;a++){var s=e.NDZ[i],o=e.NDZ[a];e.check(s,o)}},hit:function(t,e){t.obj.collide(e.obj),e.obj.collide(t.obj)},check:function(t,e){if(t.id!==e.id&&t.obj.id!==e.obj.id&&t.obj.alive&&e.obj.alive&&!this.grouped(t,e)){var n=e.p.x-t.p.x,i=e.p.y-t.p.y;T.sqrt(n*n+i*i)<e.R1Z+t.R1Z&&this.hit(t,e)}},grouped:function(t,e){for(var n=[v,k],i=0;i<n.length;i++)if(t instanceof n[i]&&e instanceof n[i])return!0;return!1}}),d=Class.extend({init:function(t){var e=this;e.p=new n,e.type="circle",e.R1Z=0,e.obj=null,e.pOF2Z=new n,e.alive=!0,R.extend(e,t),e.id=R.randRange(0,1e5)},step:function(){this.p=this.obj.p.copy().add(this.pOF2Z)},draw:function(t){"circle"===this.type&&(t.beginPath(),t.arc(this.p.x,this.p.y,this.R1Z,0,2*T.PI,!1),t.lineWidth=1,t.strokeStyle="#f00",t.stroke())}}),u=Class.extend({init:function(t,e){var i=this;i.count=2,i.NDZ=[],i.counts=[125,75],i.sizes=[30,50],i.pOF2Zs=[.5,.2],i.hOF2Zs=[2e3,500];var a=document.createElement("canvas"),s=a.getContext("2d");a.width=t,a.height=e;for(var o=0;o<i.count;o++){i.NDZ.push(new Image);for(var r=0;r<i.counts[o];r++){var c=new n(R.randRange(0,t),R.randRange(0,e));s.fillStyle="#D3EDFF";for(var h=R.randRange(5,50),l=0;h>l;l++)s.beginPath(),s.arc(c.x+R.randRange(0,8*i.sizes[o]),c.y+R.randRange(30,125),i.sizes[o],0,2*T.PI,!0),s.fill()}i.NDZ[o].src=a.toDataURL(),s.clearRect(0,0,t,e)}},draw:function(t){for(var e=this,n=0;n<e.count;n++)t.save(),t.globalAlpha=0===n?.5:1,t.translate(G1.cam.vp.l*e.pOF2Zs[n],G1.cam.vp.t*e.pOF2Zs[n]),t.drawImage(e.NDZ[n],-e.NDZ[n].width/2,-e.NDZ[n].height+e.hOF2Zs[n]),t.restore()}}),p=a.extend({init:function(t){var e=this;e._SP(t),e.v=new n,e.a=new n,e.M9P2=0,e.av=0,e.ts=0,e.alive=!0,e.hp=8,e.static=!1,e.g=!0,e.fr=100,e.fc=0,e.T1G1=null,e.tDist=null,e.tAngle=null,e.behavior=null,e.va=180,e.range=500,e.ammo=null,e.s=1,e.age=0,e.lifeSpan=-1,e.bodies=[],e.R1Z=10,e.breakable=!1,e.points=0,e.SDZ=null,R.extend(this,t),e.id=R.randRange(0,1e5)},addBodies:function(t){for(var e=0;e<t.length;e++){var i=new d({pOF2Z:t[e].pOF2Z||new n,R1Z:t[e].R1Z,obj:this});this.bodies.push(i),G1.addCollider(i)}},step:function(t){var e=this;e.age+=t/G1.slomo;var i=!1;if(-1!==e.lifeSpan&&e.age>e.lifeSpan&&(e.kill(),i=!0),e.alive||(i=!0),e.hp<=0&&(e.kill(),i=!0),e.static&&(i=!0),e.p.y>G1.h/2&&(e.kill(),i=!0),i)e._SP(t);else{var a=t/(1e3*G1.slomo);e.behavior&&e.behavior.run();var s=new n;if(s.add(e.a),e.g&&s.add(G1.gravity),e.v.add(s).limit(e.M9P2*a),e.p.add(e.v),e.r=R.wrapAngle(e.r+e.av),e.fc+=t,e.T1G1){var o=e.T1G1.p.copy().sub(e.p);e.tDist=o.length();var r=T.atan2(o.y,o.x),c=R.wrapAngle(r-e.r);T.abs(c)<=R.D2R(e.va/2)&&e.tDist<=e.range&&e.fc>e.fr*G1.slomo&&(e.fc=0,e.fire())}e._SP(t)}},fire:function(){if((t=this).ammo){var t,e=(t=this).r+R.D2R(R.randRange(-6,6)),i=new n(T.cos(t.r)*t.img.w,T.sin(t.r)*t.img.w),a=new t.ammo({p:t.p.copy().add(i),v:new n(T.cos(e),T.sin(e)).mult(500)});G1.A3C4(a),G1.sfx.play(t.SDZ.gun)}},collide:function(){},kill:function(){var t=this;t.alive=!1;for(var e=0;e<t.bodies.length;e++)t.bodies[e].alive=!1;G1.score+=t.points,t.SDZ&&G1.sfx.play(t.SDZ.die)},I1P2W3:function(){return this.is(w)},isNPCWeapon:function(){return this.is(m)},isNPC:function(){return!this.is(v)&&!this.is(G)},is:function(t){return this instanceof t}}),f=p.extend({init:function(t){this._SP(t),R.extend(this,t),this.cfg={p1:{oX:0,oY:0,w:34,h:10,dO:0},p2:{oX:0,oY:11,w:34,h:16,dO:0},p3:{oX:0,oY:28,w:34,h:24,dO:0},p4:{oX:0,oY:53,w:34,h:32,dO:0},p5:{oX:0,oY:86,w:34,h:36,dO:0},s1:{oX:35,oY:0,w:43,h:122,dO:-1.57},b:{oX:79,oY:52,w:20,h:20,dO:0},b2:{oX:79,oY:72,w:20,h:20,dO:0},b3:{oX:79,oY:92,w:20,h:30,dO:-1.57}},this.img=null},draw:function(t){var e=this,n=e.img;if(R.inViewport(e)){t.save(),e.p.toInt(),t.translate(e.p.x,e.p.y);var i=e.r+n.dO;0!==i&&t.rotate(i),t.drawImage(G1.img,n.oX,n.oY,n.w,n.h,-n.w*e.s/2,-n.h*e.s/2,n.w*e.s,n.h*e.s),t.restore(),e._SP(t)}}}),v=f.extend({init:function(t){var e=this;e._SP(t),e.g=!1,e.lifeSpan=5e3,e.damage=4,e.R1Z=10,e.M9P2=500,R.extend(e,t),this.img=this.cfg.b;var i=[{pOF2Z:new n(0,0),R1Z:e.R1Z}];this.addBodies(i)},step:function(t){var e=this,n=t/1e3;e.v=e.v.norm().mult(e.M9P2*n),e.p.y>=0&&e.kill(!0),e._SP(t)},collide:function(t){t instanceof G&&this.kill()},kill:function(t){this._SP(),R.inViewport(this)&&G1.A3C4(new D(t?{position:this.p.copy(),dir:-T.PI/2,D7V9V:0,size:10,sizeVariance:4,ss1:100,life:400,l4V7:200,color:[255,255,255,1],constColor:!0,mXP4:6,duration:0,g:!0}:{position:this.p.copy(),D7V9V:360,size:6,sizeVariance:2,ss1:100,life:200,l4V7:25,color:[255,255,255,1],constColor:!0,mXP4:6,duration:0}))}}),w=v.extend({init:function(t){this._SP(t),this.M9P2=2e3},collide:function(t){t.isNPC()&&this.kill()}}),m=v.extend({init:function(t){this._SP(t),this.img=this.cfg.b2}}),g=m.extend({init:function(t){this._SP(t),this.img=this.cfg.b3}}),y=p.extend({init:function(t){var e=this;e._SP(t),e.width=G1.w,e.height=1e3,R.extend(e,t),e.canvas=document.getElementById(t.cid),e.c=e.canvas.getContext("2d"),e.w=e.canvas.width=e.canvas.clientWidth,e.h=e.canvas.height=e.canvas.clientHeight,e.c.strokeStyle="#fff",e.c.lineWidth=2},draw:function(t){var e=this;e.c.clearRect(0,0,e.w,e.h);var n=G1.cam.worldToScreen(0,0);n.y<e.canvas.height&&(e.c.save(),e.c.translate(0,n.y),e.c.scale(1,-1),e.c.drawImage(t.canvas,0,0,t.canvas.width,n.y,0,-n.y,t.canvas.width,n.y),e.c.fillStyle="rgba(67,103,127,0.50)",e.c.beginPath(),e.c.rect(-2,-n.y-1e3,t.canvas.width+4,n.y+1e3),e.c.fill(),e.c.stroke(),e.c.restore())}}),x=Class.extend({init:function(t,e){this.actor=t,this.T1G1=e},run:function(){},turnToFace:function(t){var e=this.getAngleToPoint(t),n=R.wrapAngle(e-this.actor.r);n=R.clamp(n,-this.actor.ts,this.actor.ts),this.actor.r=R.wrapAngle(this.actor.r+n)},turnAwayFrom:function(t){var e=this.getAngleToPoint(t);e-=T.PI;var n=R.wrapAngle(e-this.actor.r);n=R.clamp(n,-this.actor.ts,this.actor.ts),this.actor.r=R.wrapAngle(this.actor.r+n/G1.slomo)},getAngleToPoint:function(t){var e=t.x-this.actor.p.x,n=t.y-this.actor.p.y;return T.atan2(n,e)},moveForward:function(){var t=T.cos(this.actor.r),e=T.sin(this.actor.r);this.actor.v.add(new n(t,e).mult(.2))}}),P=x.extend({run:function(){this.turnToFace(this.T1G1.p),this.moveForward()}}),S=x.extend({run:function(){this.turnAwayFrom(this.T1G1.p),this.moveForward()}}),b=x.extend({run:function(){this.actor.r+=.15/G1.slomo}}),Z=p.extend({init:function(t){var e=this;e._SP(t),e.size=null,e.deltaSize=null,e.colorArray=null,e.deltaColor=null,e.g=!1,e.age=1,e.drawColor=null,e.constColor=!1,R.extend(e,t),e.calcColor(0)},step:function(t){var e=this;e._SP(t);var n=t/G1.slomo;e.size+=e.deltaSize*n,e.drawColor&&e.constColor||e.calcColor(n)},calcColor:function(t){var e=this,n=e.colorArray[0]+=e.deltaColor[0]*t,i=e.colorArray[1]+=e.deltaColor[1]*t,a=e.colorArray[2]+=e.deltaColor[2]*t,s=e.colorArray[3]+=e.deltaColor[3]*t;n=n>255?255:0>n?0:~~n,i=i>255?255:0>i?0:~~i,a=a>255?255:0>a?0:~~a,s=s>1?1:0>s?0:s.toFixed(2),e.drawColor="rgba("+n+","+i+","+a+","+s+")"},draw:function(t){var e=this;e.alive&&(e.p.toInt(),t.save(),t.fillStyle=e.drawColor,t.beginPath(),t.arc(e.p.x,e.p.y,e.size,0,2*T.PI,!1),t.fill(),t.closePath(),t.restore())}}),D=p.extend({init:function(t){var e=this;if(e._SP(t),e.mXP4=0,e.position=new n,e.PZT2V=new n,e.dir=0,e.D7V9V=0,e.ss1=0,e.ss1Variance=0,e.size=0,e.sizeVariance=0,e.endSize=0,e.endSizeVariance=0,e.life=0,e.l4V7=0,e.color=[0,0,0,0],e.colorVariance=[0,0,0,0],e.constColor=!1,e.endColor=[0,0,0,0],e.endColorVariance=[0,0,0,0],e.emitCounter=0,e.elapsedTime=0,e.duration=-1,e.on=!0,e.static=!0,R.extend(e,t),0===e.duration)for(;e.NDZ.length<e.mXP4;)e.emit()},step:function(t){var e=this;if(e._SP(t),0===e.duration)e.NDZ.length<=0&&e.kill();else if(e.emissionRate=e.mXP4/e.life,e.alive&&e.emissionRate>0){var n=1/e.emissionRate;for(e.emitCounter+=t;e.NDZ.length<e.mXP4&&e.emitCounter>n&&e.on;)e.emit(),e.emitCounter-=n;e.elapsedTime+=t,-1!==e.duration&&e.duration<e.elapsedTime&&e.kill()}},emit:function(){var t=this,e=t.position.copy();e.x=e.x+t.PZT2V.x*R.randPN(),e.y=e.y+t.PZT2V.y*R.randPN();var i=t.dir+R.D2R(t.D7V9V*R.randPN()),a=t.ss1+t.ss1Variance*R.randPN(),s=new n(T.cos(i),T.sin(i)).mult(a),o=t.size+t.sizeVariance*R.randPN();o=0>o?0:~~o;var r=t.endSize+t.endSizeVariance*R.randPN();r=0>r?0:~~r;for(var c=t.life+t.l4V7*R.randPN(),h=(r-o)/c,l=[],d=[],u=[],p=0;4>p;p++)d.push(t.color[p]+t.colorVariance[p]*R.randPN()),l.push(t.endColor[p]+t.endColorVariance[p]*R.randPN()),u.push((l[p]-d[p])/c);var f=new Z({p:e,v:s,size:o,deltaSize:h,lifeSpan:c,colorArray:d,constColor:t.constColor,deltaColor:u,g:t.g,M9P2:a});t.NDZ.push(f)}}),C=f.extend({init:function(t){var e=this;e._SP(t),e.r=-1.57,e.ts=.034,e.M9P2=350,e.va=45,e.fr=1250,R.extend(this,t),e.ammo=m,e.breakable=!0,e.points=25,e.R1Z=20*e.s,e.img=e.cfg.p5;var n=[{R1Z:e.R1Z}];this.addBodies(n),e.SDZ={gun:"egun",die:"edie",hit:"ehit"}},step:function(t){var e=this;if(e._SP(t),e.breakable&&void 0===e.broken&&e.hp<6&&(e.broken=T.random()>.5,e.broken&&(e.g=!0,e.behavior=new b(e),e.T1G1=null)),R.inViewport(e)){var n,i=R.wrapAngle(e.r-T.PI),a=T.abs(R.radToDeg(i));n=108>=a&&a>=72?"p5":126>=a&&a>=54?"p4":144>=a&&a>=38?"p3":162>=a&&a>=18?"p2":"p1",e.img=e.cfg[n]}},collide:function(t){t.I1P2W3()&&(this.hp-=t.damage,G1.ace.powerUp(2),G1.sfx.play(this.SDZ.hit))},kill:function(){this._SP(),G1.cam.shake=50,G1.A3C4(new D({position:this.p.copy(),PZT2V:new n(25,25),D7V9V:360,size:20,sizeVariance:5,endSize:20,endSizeVariance:5,life:300,l4V7:200,color:[106,119,127,1],constColor:!0,mXP4:6,duration:0}))}}),k=C.extend({step:function(t){var e=this;if(!e.broken){var i=e.p.copy().add(e.v.copy().norm().mult(e.range));e.behavior=e.p.y+i.y>=0&&e.p.y<0?new P(e,{p:new n(e.p.x+20*e.v.x,e.p.y-230)}):e.tDist<300?new S(e,e.T1G1):new P(e,e.T1G1)}e._SP(t)}}),G=C.extend({init:function(t){var e=this;e._SP(t),e.r=-1.57,e.ts=R.D2R(7),e.M9P2=500,e.fr=30,e.hp=100,e.power=100,e.canPower=!0,e.isPower=!1,e.points=0,e.SFXC4=0,e.soundRate=200,R.extend(this,t),e.ammo=w,e.breakable=!1,e.jet=new D({p:new n(-e.img.w/2,0),dir:-T.PI,D7V9V:15,ss1:100,ss1Variance:50,size:4,sizeVariance:2,life:200,l4V7:50,color:[255,255,255,1],constColor:!0,mXP4:20,duration:-1,on:!1,g:!1}),e.A3C4(e.jet),e.gun=new D({p:new n(e.img.w/2,0),D7V9V:90,ss1:100,ss1Variance:50,size:10,sizeVariance:4,life:200,l4V7:100,color:[255,255,255,1],constColor:!0,mXP4:8,duration:-1,on:!1,g:!1}),e.A3C4(e.gun),e.smoke=new D({position:e.p.copy(),dir:T.PI/2,D7V9V:90,ss1:175,ss1Variance:50,size:6,sizeVariance:2,endSize:16,endSizeVariance:2,life:750,l4V7:500,color:[106,119,127,1],constColor:!0,mXP4:10,duration:-1,on:!1}),G1.A3C4(e.smoke),e.SDZ={gun:"gun",die:"die",hit:"hit"}},step:function(t){var e=this;e.a=new n,e.handleInput(t),e.smoke.position=e.p.copy(),(!R.inBounds(e)||e.p.y>0)&&e.heal(-.3),e.hp<50?(e.smoke.on=!0,G1.sfx.play("smoke")):e.smoke.on=!1,e._SP(t)},handleInput:function(t){var e=0,i=0,a=G1,s=this,o=a.inputCtrl;(o.A||o.L)&&(s.r-=s.ts),(o.D||o.R)&&(s.r+=s.ts),o.W||o.U?(e=T.cos(s.r),i=T.sin(s.r),s.a=s.a.add(new n(e,i).mult(.5)),s.jet.on=!0,s.g=!1,s.SFXC4+=t,s.SFXC4>s.soundRate&&(a.sfx.play("jet"),s.SFXC4=0)):(s.jet.on=!1,s.g=!0,s.SFXC4=s.soundRate),o.Space?s.fc>s.fr?(s.fc=0,s.fire(),s.gun.on=!0,a.cam.shake=50):s.gun.on=!1:(s.gun.on=!1,s.heal(.1)),o.Shift?(s.canPower?(s.setSlomo(3,1200),s.powerUp(-30*t/1e3),s.isPower||a.sfx.play("pwr"),s.isPower=!0):s.deactivateSlomo(t),0===s.power&&(s.canPower=!1)):(s.deactivateSlomo(t),s.canPower=!0,s.isPower=!1)},setSlomo:function(t,e){G1.cam.T1G1Distance=e,G1.slomo=t},deactivateSlomo:function(t){this.setSlomo(1,1600),this.powerUp(10*t/1e3)},heal:function(t){this.hp=R.clamp(this.hp+t,0,100)},powerUp:function(t){this.power=R.clamp(this.power+t,0,100)},collide:function(t){t.isNPCWeapon()&&(this.heal(-t.damage),G1.sfx.play(this.SDZ.hit))},kill:function(){this._SP(),this.jet.alive=!1,this.smoke.alive=!1}}),V=p.extend({init:function(t){var e=this;e._SP(t),e.w=15,e.h=5,e.g=!1,e.fr=1500,e.points=15,R.extend(e,t),e.ammo=g;var n=[{R1Z:e.w/2}];e.addBodies(n),e.SDZ={gun:"sgun",die:"die",hit:"hit"}},step:function(t){var e=this;e._SP(t),e.r=e.T1G1.p.copy().sub(e.p).norm().heading()},draw:function(t){var e=this;e.alive&&(t.save(),t.translate(e.p.x,e.p.y),t.rotate(e.r),t.fillStyle="#000",t.fillRect(0,-e.h/2,e.w,e.h),t.restore())},fire:function(){var t=this,e=t.r+R.D2R(R.randRange(-8,8)),i=new n(T.cos(t.r)*t.w,T.sin(t.r)*t.w),a=new t.ammo({p:t.p.copy().add(i),v:new n(T.cos(e),T.sin(e)).mult(500),r:e,damage:8,M9P2:1e3});G1.A3C4(a),G1.sfx.play(t.SDZ.gun)},collide:function(t){t.I1P2W3()&&(this.hp-=t.damage,G1.ace.powerUp(.5),G1.sfx.play(this.SDZ.hit))},kill:function(){this._SP(),G1.A3C4(new D({position:this.p.copy(),PZT2V:new n(10,10),D7V9V:360,size:10,sizeVariance:3,endSize:10,endSizeVariance:3,life:300,l4V7:200,color:[106,119,127,1],constColor:!0,mXP4:6,duration:0}))}}),N=f.extend({init:function(t){var e=this;e._SP(t),e.turrets=[],e.hp=50,e.R1Z=60,R.extend(e,t),e.points=75;var i=[[-17,0],[50,5]];this.img=this.cfg.s1,this.p.y-=this.img.w/2;for(var a=0;a<i.length;a++){var s=new V({p:e.p.copy().add(new n(i[a][0],i[a][1])),T1G1:e.T1G1,range:1200});e.turrets.push(s),G1.NDZ.push(s)}e.T1G1=null;var o=[{pOF2Z:new n(15,5),R1Z:20},{pOF2Z:new n(-45,15),R1Z:18},{pOF2Z:new n(50,12),R1Z:8}];this.addBodies(o),e.SDZ={die:"sdie",hit:"shit"}},collide:function(t){t.I1P2W3()&&(this.hp-=t.damage,G1.ace.powerUp(2),G1.sfx.play(this.SDZ.hit))},kill:function(){this._SP();for(var t=0;t<this.turrets.length;t++)this.turrets[t].kill();G1.A3C4(new D({position:new n(this.p.x,this.p.y-30),PZT2V:new n(45,25),dir:-T.PI/2,D7V9V:30,ss1:150,ss1Variance:25,size:25,sizeVariance:10,endSize:25,endSizeVariance:10,life:800,l4V7:300,color:[106,119,127,1],constColor:!0,mXP4:15,duration:0}))}}),R=function(){var t=function(){this.init()};return t.extend=function(t,e,n){for(var i in e)(n||t.hasOwnProperty(i))&&(t[i]=e[i]);return t},t.randPN=function(){return 2*T.random()-1},t.D2R=function(t){return t*T.PI/180},t.radToDeg=function(t){return 180*t/T.PI},t.wrapAngle=function(t){for(;t<-T.PI;)t+=2*T.PI;for(;t>T.PI;)t-=2*T.PI;return t},t.randRange=function(t,e){return T.floor(T.random()*(e-t+1)+t)},t.clamp=function(t,e,n){return e>t?e:n>t?t:n},t.inRange=function(t,e,n){return t>=e&&n>=t},t.inViewport=function(e){return t.inRange(e.p.x,G1.cam.vp.l-e.R1Z,G1.cam.vp.r+e.R1Z)&&t.inRange(e.p.y,G1.cam.vp.t-e.R1Z,G1.cam.vp.b+e.R1Z)},t.inBounds=function(e){return t.inRange(e.p.x,G1.BNZ.l,G1.BNZ.r)&&t.inRange(e.p.y,G1.BNZ.t,G1.BNZ.b)},t.pad=function(t,e){for(var n=""+t;n.length<e;)n="0"+n;return n},t.prototype={init:function(){var t=this;t.w=4500,t.h=1500,t.BNZ={l:-t.w/2,r:t.w/2,t:-t.h,b:400},t.dt=0,t.currentTime=(new Date).getTime(),t.gravity=new n(0,.05),t.slomo=1,t.img=new Image,t.img.onload=function(){G1.initGame(),t.$ldng.style.display="none",t.draw()},t.img.src="sprite.png",t.bg=new u(6e3,3e3),t.NDZ=[],t.cvs=document.getElementById("g"),t.resetDimensions(800,500),t.c=t.cvs.getContext("2d"),this.storage=window.localStorage,t.cam=new i(t),t.inputCtrl=new o,t.started=!1,t.sfx=new s,A.chrome&&(t.sfx.add("gun",6,[[2,,.299,.0289,.391,.8259,.0381,-.5939,,,,,,.2965,.0699,,.1943,-.0108,1,,,.109,,.3]]),t.sfx.add("hit",4,[[3,.0072,.6334,.5806,.8231,.6134,,.3234,.0409,3e-4,.3446,-.154,-.4408,.2995,-.4789,,2e-4,.9689,.9331,-.5453,,.0041,.009,.3]]),t.sfx.add("die",1,[[3,,.3858,.6116,.4334,.0786,,.0482,,,,.6687,.6914,,,,-.2659,-.2109,1,,,,,.3]]),t.sfx.add("egun",10,[[2,,.1356,,.3599,.599,.2,-.2762,,,,,,.1688,.1182,,,,1,,,.0376,,.3],[2,,.2608,.0037,.1332,.821,.2811,-.3038,,,,,,.3193,.1014,,,,1,,,.0663,,.3]]),t.sfx.add("ehit",6,[[0,,.0889,,.1981,.4033,,-.3139,,,,,,.2536,,,,,1,,,,,.3]]),t.sfx.add("edie",6,[[3,,.104,.492,.4726,.1641,,,.009,,.0056,-.3286,.7063,,-.0332,,-.1521,-.1666,1,-.0473,,.0172,-.0041,.3],[3,,.1161,.5124,.4854,.1889,,,,,,-.3396,.7434,,,,-.1828,-.1666,1,,,,,.3]]),t.sfx.add("sgun",6,[[3,,.3123,.7895,.4729,.1296,,-.2453,,,,,,,,,-.2225,-.0724,1,,,,,.3],[3,,.14,.3018,.4,.1876,,-.2173,,,,,,,,,.1772,-.1164,1,,,,,.3]]),t.sfx.add("shit",12,[[3,,.2495,.5831,.3162,.2813,,-.3806,,,,,,,,.4055,-.2867,-.1401,1,,,,,.3],[3,,.1346,.3738,.3166,.2031,,-.3183,,,,,,,,.5275,,,1,,,,,.3]]),t.sfx.add("sdie",3,[[3,,.2562,.5918,.52,.174,,-.2348,,,,,,,,,-.1262,-.0519,1,,,,,.3],[3,,.3008,.5579,.52,.1982,,-.1875,,,.0422,.0439,.0349,,-.0319,,-.1262,-.053,1,,,,,.3]]),t.sfx.add("jet",10,[[3,,.42,,.19,.0359,,.1088,,,,,,,,.7225,.3642,-.1748,1,,,,,.3]]),t.sfx.add("pwr",3,[[3,.5809,.2183,.029,.3452,.53,,-.0035,,-.4453,.9188,.8925,-.2872,-.372,-.0262,.6806,2e-4,.1227,.2517,-.1135,.6981,.2448,-.011,.4]]),t.sfx.add("smoke",2,[[3,,.1853,.7711,.32,.055,,-.0568,,,,,,,,.5535,,,1,,,,,.3],[3,,.1853,.7711,.22,.055,,-.0568,,,,,,,,.5535,,,1,,,,,.3]])),t.listen()},listen:function(){var t=this,e=document.getElementById.bind(document);A.onblur=function(){t.started&&t.pause()},t.$hp=e("hp"),t.$score=e("score"),t.$fscore=e("fscore"),t.$power=e("power"),t.$hud=e("hud"),t.$gmo=e("gmo"),t.$ss=e("ss"),t.$pz=e("pz"),t.$ldng=e("ldng"),t.$hscore=e("hscore");var n="keydown",i=function(e){(87===e.keyCode||38===e.keyCode)&&(t.enable(),A.removeEventListener(n,i),t.toggleScreens(t.$hud,t.$ss))};A.addEventListener(n,i),A.addEventListener(n,(function(e){80===e.keyCode&&(t.pzd?t.resume():t.pause())}))},initGame:function(){var t=this;t.tTime=0,t.score=0,t.phys=new l({debugDraw:!0}),t.A3C4(new y({cid:"h2o"})),t.ace=new G({p:new n(0,-500)}),t.cam.lookat=t.ace.p.copy(),t.A3C4(t.ace),t.A3C4(new c),t.A3C4(new h)},enable:function(){this.started=!0,this.animate((new Date).getTime())},animate:function(t){var e=this;e.animationFrame=requestAnimationFrame((function(){e.animate((new Date).getTime())}));var n=t-e.currentTime;e.currentTime=t,e.step(n)},disable:function(){cancelAnimationFrame(this.animationFrame)},toggleScreens:function(t,e){t.style.display="block",e.style.display="none"},pause:function(){var t=this;t.disable(),t.pzd=!0,t.toggleScreens(t.$pz,t.$hud)},resume:function(){var t=this;t.pzd&&(t.currentTime=(new Date).getTime(),t.enable(),t.pzd=!1,t.toggleScreens(t.$hud,t.$pz))},over:function(){var t=this;t.started=!1,t.disable();var e=this.storage.getItem("score");this.score>e?(this.storage.setItem("score",t.score),t.$hscore.style.display="block"):t.$hscore.style.display="none",t.toggleScreens(t.$gmo,t.$hud);var n="keydown",i=function(e){(87===e.keyCode||38===e.keyCode)&&(A.removeEventListener(n,i),t.restart(),t.toggleScreens(t.$hud,t.$gmo))};A.setTimeout((function(){A.addEventListener(n,i)}),1e3)},restart:function(){var t=this;for(t.started=!1,t.disable();t.NDZ.length;)t.NDZ.pop();t.ace=null,t.phys=null,t.initGame(),t.enable()},resetDimensions:function(t,e){this.w=this.cvs.width=t,this.h=this.cvs.height=e},A3C4:function(t){this.NDZ.push(t)},addCollider:function(t){this.phys.A3C4(t)},step:function(e){if(e){for(var n=this,i=n.NDZ.length;i--;){var a=n.NDZ[i];a.step(e),a.alive||n.NDZ.splice(i,1)}n.cam.step(e),n.phys.step(e),n.draw(),n.$hp.style.width=n.ace.hp+"%",n.$score.innerHTML=n.$fscore.innerHTML=t.pad(n.score,9),n.$power.style.width=n.ace.power+"%",n.tTime+=e,n.ace.alive||(G1.slomo+=.1,G1.slomo>=10&&n.over())}},draw:function(){var t=this;if(t.c.fillStyle="#87CEFF",t.c.fillRect(0,0,t.w,t.h),t.ace){var e=25*t.ace.v.length(),i=new n(T.cos(t.ace.r-T.PI)*e,T.sin(t.ace.r-T.PI)*e),a=t.ace.p.copy().sub(i);t.cam.moveTo(a.x,a.y)}t.cam.begin(),t.bg.draw(t.c);for(var s=t.NDZ.length;s--;)t.NDZ[s].draw(t.c);t.cam.end()}},t}(),T=Math,A=window,z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";A.onload=function(){G1=new R}}()</script>