<!doctype html><title>CatSlap</title><style>body,html{overflow:hidden;width:100%;height:100%;margin:0;padding:0}#renderCanvas{width:100%;height:100%;touch-action:none}</style><script src=/2025/webxr/babylon.js></script><audio id=meow src=meow.mp3></audio><audio id=block src=block.wav></audio><audio id=hitHurt src=hit.wav></audio><canvas id=renderCanvas></canvas><script>class Cage{static #a=2;static #b=3;static #c=.1;static #d=3e3;static #e=2e3;static #f=24;static #g=[[10,[1800,2800]],[20,[1500,2200]],[30,[1200,1900]],[40,[800,1400]],[50,[800,1e3]],].reverse();soundsManager;mesh;player;spawning;difficulty=1;spawnedCount=0;nextSpawnInterval=Cage.#d;catHead;constructor(e,t,i){this.catHead=new CatHead(e),this.catHead.setPosition(new BABYLON.Vector3(0,-10,0)),this.player=i,this.material=new BABYLON.StandardMaterial("cageMat",e),this.material.diffuseColor=new BABYLON.Color3(.7,.7,.7);let s=BABYLON.MeshBuilder.CreateDisc("cageBottom",{radius:Cage.#b/2},e);s.rotation.x=Math.PI/2,s.material=this.material;let a=s.clone("cageTop");a.rotation.x=-Math.PI/2,a.position.y=Cage.#a,a.material=this.material;let r=BABYLON.MeshBuilder.CreateCylinder("bar0",{height:2,diameter:Cage.#c},e);r.material=this.material;let o=Cage.#b/2-Cage.#c/2;r.position.y=1,r.position.z=o;for(let n=1;n<Cage.#f;n++){let h=r.clone("bar"+n);h.position.z=o*Math.cos(2*n*Math.PI/Cage.#f),h.position.x=o*Math.sin(2*n*Math.PI/Cage.#f)}this.soundsManager=t}beginArmSpawning(e,t){let i=performance.now();this.spawning=e.onBeforeRenderObservable.add(()=>{if(performance.now()-i>=this.nextSpawnInterval){let s=this.randomWallPoint();this.catHead.setPosition(this.catHeadPosFromWallPoint(s)),this.catHead.lookAt(t.headCamera.position),this.spawnArm(e,s,t.bodyPosition),this.spawnedCount++,this.setDifficulty(),this.nextSpawnInterval=Math.random()*(Cage.#d-Cage.#e)+Cage.#e,this.soundsManager.playMeow(s),i=performance.now()}})}stopSpawning(e){e.onBeforeRenderObservable.remove(this.spawning),this.catHead.destroy()}randomWallPoint(){let e=2*Math.random()*Math.PI,t=Math.random()*Cage.#a;return new BABYLON.Vector3(Math.cos(e)*Cage.#b/2,t,Math.sin(e)*Cage.#b/2)}catHeadPosFromWallPoint(e){let t=e.clone();return t.y=1.3,t.multiplyByFloats(1.4,1,1.4)}spawnArm(e,t,i,s,a,r){return new ExtendingArm(e,this.player,this.soundsManager,this.difficulty).spawnAndPoint(t,i)}setDifficulty(){for(let e of Cage.#g)if(this.spawnedCount>=e[0]){Cage.#e=e[1][0],Cage.#d=e[1][1];break}}}class CatHead{static headRadius=.45;static earRadius=.1;static earHeight=.25;static eyeRadius=.1;static pupilRadius=.01;static pupilHeight=this.eyeRadius;static noseRadius=.02;static jowlHeight=.04;static jowlDiameter=.008;static jowlNoseOffset=.05;static whiskerLen=.15;static whiskerDiameter=.002;headMesh;constructor(e){let t=new BABYLON.StandardMaterial("catHeadMat",e);t.diffuseColor=new BABYLON.Color3(.1,.1,.1),this.headMesh=BABYLON.MeshBuilder.CreateSphere("catHead",{diameter:2*CatHead.headRadius,segments:16},e),this.headMesh.material=t,this.rightEarMesh=BABYLON.MeshBuilder.CreateCylinder("rightEar",{height:CatHead.earHeight,diameterTop:0,diameterBottom:2*CatHead.earRadius,tessellation:64},e),this.rightEarMesh.material=t,this.rightEarMesh.position.y=CatHead.headRadius+CatHead.earHeight/3,this.rightEarMesh.parent=this.headMesh,this.leftEarMesh=this.rightEarMesh.clone("leftEar"),this.leftEarMesh.position.y=CatHead.headRadius+CatHead.earHeight/3,this.leftEarMesh.parent=this.headMesh,this.rightEarMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Right(),Math.PI/12),this.rightEarMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Forward(),-Math.PI/5),this.leftEarMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Right(),Math.PI/12),this.leftEarMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Forward(),Math.PI/5);let i=new BABYLON.StandardMaterial("catEyeMat",e);i.emissiveColor=new BABYLON.Color3(.9,1,.2),this.rightEyeMesh=BABYLON.MeshBuilder.CreateSphere("rightEye",{diameter:2*CatHead.eyeRadius,segments:16},e),this.rightEyeMesh.material=i,this.rightEyeMesh.position.y=CatHead.headRadius,this.rightEyeMesh.parent=this.headMesh,this.leftEyeMesh=this.rightEyeMesh.clone("leftEye"),this.leftEyeMesh.position.y=CatHead.headRadius,this.leftEyeMesh.parent=this.headMesh,this.rightEyeMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Right(),Math.PI/2.7),this.rightEyeMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Forward(),-Math.PI/3.5),this.leftEyeMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Right(),Math.PI/2.7),this.leftEyeMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Forward(),Math.PI/3.5),this.rightPupilMesh=BABYLON.MeshBuilder.CreateCapsule("rightPupil",{radius:CatHead.pupilRadius,height:CatHead.pupilHeight,capSubdivisions:1},e),this.rightPupilMesh.material=t,this.rightPupilMesh.position.copyFrom(this.rightEyeMesh.absolutePosition),this.rightPupilMesh.position.z+=CatHead.eyeRadius,this.rightPupilMesh.parent=this.headMesh,this.leftPupilMesh=this.rightPupilMesh.clone("leftPupil"),this.leftPupilMesh.position.copyFrom(this.leftEyeMesh.absolutePosition),this.leftPupilMesh.position.z+=CatHead.eyeRadius;let s=new BABYLON.StandardMaterial("noseMat",e);s.diffuseColor=new BABYLON.Color3(1,.7,.75),this.noseMesh=BABYLON.MeshBuilder.CreateSphere("nose",{diameter:2*CatHead.noseRadius,segments:8},e),this.noseMesh.material=s,this.noseMesh.position.z=CatHead.headRadius,this.noseMesh.parent=this.headMesh,this.noseMesh.rotateAround(BABYLON.Vector3.Zero(),BABYLON.Vector3.Right(),Math.PI/20);let a=new BABYLON.StandardMaterial("mouthMat",e);a.diffuseColor=new BABYLON.Color3(1,1,1),this.rightJowl=BABYLON.MeshBuilder.CreateCylinder("rightJowl",{height:CatHead.jowlHeight,diameter:CatHead.jowlDiameter},e),this.rightJowl.material=a,this.rightJowl.position.copyFrom(this.noseMesh.absolutePosition),this.rightJowl.position.y-=CatHead.jowlHeight/2-.003,this.leftJowl=this.rightJowl.clone("leftJowl"),this.leftJowl.material=a,this.rightJowl.rotateAround(this.noseMesh.absolutePosition,BABYLON.Vector3.Forward(),Math.PI/4),this.leftJowl.rotateAround(this.noseMesh.absolutePosition,BABYLON.Vector3.Forward(),-Math.PI/4),this.rightJowl.position.y-=CatHead.jowlNoseOffset,this.leftJowl.position.y-=CatHead.jowlNoseOffset,this.rightJowl.parent=this.headMesh,this.leftJowl.parent=this.headMesh,this.whisker0=BABYLON.MeshBuilder.CreateCylinder("whisker0",{height:CatHead.whiskerLen,diameter:CatHead.whiskerDiameter},e),this.whisker0.material=a,this.whisker0.position.copyFrom(this.noseMesh.absolutePosition),this.whisker1=this.whisker0.clone("whisker1"),this.whisker2=this.whisker0.clone("whisker2"),this.whisker0.rotation.z=Math.PI/2,this.whisker1.rotation.z=Math.PI/6+Math.PI/2,this.whisker2.rotation.z=-Math.PI/6+Math.PI/2,this.whisker0.parent=this.headMesh,this.whisker1.parent=this.headMesh,this.whisker2.parent=this.headMesh}setPosition(e){this.headMesh.position.copyFrom(e)}getPosition(){return this.headMesh.position}setRotation(e){this.headMesh.position.copyFrom(e)}setVisible(e){this.headMesh.isVisible=e}destroy(){this.headMesh.dispose()}lookAt(e){this.headMesh.lookAt(e)}}class ExtendingArm{scene;node;arm;player;#h;updater;soundsManager;speedMultiplier;constructor(e,t,i,s){this.speedMultiplier=s,this.soundsManager=i,this.scene=e,this.player=t,this.node=new BABYLON.TransformNode("extendingArm",e);this.arm=BABYLON.MeshBuilder.CreateCylinder("arm",{diameter:.16,height:.1},e),this.arm.setPivotPoint(new BABYLON.Vector3(0,-.05,0)),this.arm.position.y=.05,this.arm.setParent(this.node);let a=new BABYLON.StandardMaterial("pawMat",e);a.diffuseColor=new BABYLON.Color3(.1,.1,.1),this.arm.material=a;let r=new BABYLON.TransformNode("pawPosNode",e);r.position.y=.1,r.setParent(this.node),this.#h=new Paw(e),this.updater=e.onBeforeRenderObservable.add(()=>{if(this.#h.mesh.position=r.absolutePosition,this.node.scaling.y+=.1*s,this.#h.mesh.intersectsMesh(this.player.bodyMesh,!1))this.destroy(),this.player.registerHit(this.#h.mesh.position);else for(let e of t.hands)if(e.blocks(this.#h)){this.soundsManager.playBlock(e.mesh.position),this.destroy();break}})}spawnAndPoint(e,t){return this.node.position=e,this.node.lookAt(t,0,Math.PI/2),this}destroy(){this.#h.destroy(),this.arm.dispose(),this.scene.onBeforeRenderObservable.remove(this.updater)}}class Paw{static radius=.1;mesh;constructor(e){let t=new BABYLON.StandardMaterial("pawMat",e);t.diffuseColor=new BABYLON.Color3(.1,.1,.1),this.mesh=BABYLON.MeshBuilder.CreateSphere("paw",{diameter:2*Paw.radius,segments:8},e),this.mesh.material=t}destroy(){this.mesh.dispose()}position(){return this.mesh.position}}class Hand{static radius=.05;#i;mesh;constructor(e,t,i){this.#i=e,this.mesh=BABYLON.MeshBuilder.CreateSphere("hand",{diameter:2*Hand.radius,segments:8},t),this.mesh.setParent(e.grip),this.mesh.material=i}blocks(e){return BABYLON.Vector3.Distance(this.#i.grip.position,e.position())<Hand.radius+Paw.radius}}class Player{static diedEventId="player_died";static #j=new BABYLON.Vector3(0,.45,.075);static materialColor=new BABYLON.Color3(1,1,1);headCamera;bodyMaterial;bodyMesh;hands=[];lives=3;xr;soundsManager;#k=null;constructor(e,t,i){this.soundsManager=i,this.xr=t,this.headCamera=t.baseExperience.camera,this.bodyMaterial=new BABYLON.StandardMaterial("bodyMat",e),this.bodyMaterial.diffuseColor=Player.materialColor,this.bodyMesh=BABYLON.MeshBuilder.CreateCapsule("playerBody",{height:.6,radius:.2},e),this.bodyMesh.material=this.bodyMaterial,e.onBeforeRenderObservable.add(()=>{let e=this.headCamera.rotationQuaternion.toEulerAngles().y,t=Player.#j.applyRotationQuaternion(BABYLON.Quaternion.FromEulerAngles(0,e,0));this.bodyMesh.position=this.headCamera.position.subtract(t)}),t.input.onControllerAddedObservable.add(t=>{this.hands.push(new Hand(t,e,this.bodyMaterial))})}registerHit(e){this.soundsManager.playHitHurt(e),this.lives--,this.lives<=0&&(dispatchEvent(new Event(Player.diedEventId)),this.xr.baseExperience.exitXRAsync()),this.#l()}#l(){null!=this.#k&&(clearInterval(this.#k),this.bodyMaterial.diffuseColor=Player.materialColor);let e=0;this.#k=setInterval(()=>{this.bodyMaterial.diffuseColor.equals(Player.materialColor)?this.bodyMaterial.diffuseColor=new BABYLON.Color3(1,.2,.2):(this.bodyMaterial.diffuseColor=Player.materialColor,e++),e>=3&&(clearInterval(this.#k),this.#k=null)},167)}get headPosition(){return this.headCamera.position}get bodyPosition(){return this.bodyMesh.position}}class GameSoundsManager{constructor(){this.context=new AudioContext,this.panner=new PannerNode(this.context,{panningModel:"HRTF",positionX:1,orientationX:-1});let e=document.getElementById("meow");this.context.createMediaElementSource(e).connect(this.panner).connect(this.context.destination),this.meow=e,this.block=document.getElementById("block"),this.context.createMediaElementSource(this.block).connect(this.panner).connect(this.context.destination),this.hitHurt=document.getElementById("hitHurt"),this.context.createMediaElementSource(this.hitHurt).connect(this.panner).connect(this.context.destination)}updateListener(e){let t=e.position;this.context.listener.positionX.value=t.x,this.context.listener.positionY.value=t.y,this.context.listener.positionZ.value=-t.z;let i=BABYLON.Vector3.TransformNormal(BABYLON.Vector3.Forward(),e.getWorldMatrix());this.context.listener.forwardX.value=i.x,this.context.listener.forwardY.value=i.y,this.context.listener.forwardZ.value=-i.z;let s=BABYLON.Vector3.TransformNormal(BABYLON.Vector3.Up(),e.getWorldMatrix());this.context.listener.upX.value=s.x,this.context.listener.upY.value=s.y,this.context.listener.upZ.value=-s.z}playMeow(e){"suspended"==this.context.state&&this.context.resume(),this.panner.positionX.value=e.x,this.panner.positionY.value=e.y,this.panner.positionZ.value=-e.z,this.meow.play()}playBlock(e){this.panner.positionX.value=e.x,this.panner.positionY.value=e.y,this.panner.positionZ.value=-e.z,this.block.play()}playHitHurt(e){this.panner.positionX.value=e.x,this.panner.positionY.value=e.y,this.panner.positionZ.value=-e.z,this.hitHurt.play()}}const setUpXR=async e=>{let t=await e.createDefaultXRExperienceAsync({disablePointerSelection:!0,inputOptions:{doNotLoadControllerMeshes:!0}});return t.baseExperience.featuresManager.enableFeature(BABYLON.WebXRFeatureName.HAND_TRACKING,"latest",{xrInput:t.input,jointMeshes:{disableDefaultHandMesh:!0,invisible:!0}}),t},canvas=document.getElementById("renderCanvas"),engine=new BABYLON.Engine(canvas,!0),scene=new BABYLON.Scene(engine),soundsManager=new GameSoundsManager,createScene=async function(){scene.clearColor=new BABYLON.Color3(0,0,0),scene.fogMode=BABYLON.Scene.FOGMODE_EXP,scene.fogColor=new BABYLON.Color3(.11,.11,.11);let e=BABYLON.MeshBuilder.CreateBox("skyBox",{size:100,sideOrientation:BABYLON.Mesh.BACKSIDE},scene),t=new BABYLON.StandardMaterial("skyMat",scene);t.diffuseColor=new BABYLON.Color3(.1,.1,.1),e.material=t;let i=new BABYLON.FreeCamera("initialCam",new BABYLON.Vector3(0,-1,0),scene);i.attachControl(canvas,!0);let s=new CatHead(scene);s.setPosition(new BABYLON.Vector3(0,-1,-2)),i.setTarget(s.getPosition());let a=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),scene);a.intensity=.1;let r=new BABYLON.PointLight("light",new BABYLON.Vector3(0,1.7,0),scene);r.intensity=.5;let o=BABYLON.MeshBuilder.CreateGround("ground",{width:100,height:100},scene),n=new BABYLON.StandardMaterial("groundMat",scene);n.diffuseColor=new BABYLON.Color3(.651,.482,.357),o.material=n,o.position.y=-.0001;let h=await setUpXR(scene),l=new Player(scene,h,soundsManager),d=new Cage(scene,soundsManager,l),c=new BABYLON.MeshBuilder.CreatePlane("endScreen",{width:.7,height:.1},scene);return c.rotation.y=Math.PI,c.position.y=.9,c.position.z-=1.2,c.isVisible=!1,h.baseExperience.sessionManager.onXRFrameObservable.add(()=>{soundsManager.updateListener(h.baseExperience.camera)}),h.baseExperience.onStateChangedObservable.add(async e=>{e===BABYLON.WebXRState.IN_XR&&(i.position.copyFrom(new BABYLON.Vector3(0,0,0)),h.baseExperience.camera.setTransformationFromNonVRCamera(i),d.beginArmSpawning(scene,l))}),addEventListener("player_died",()=>{d.stopSpawning(scene),scene.activeCamera=i,s.setPosition(i.position.add(new BABYLON.Vector3(0,1.3,-2))),i.setTarget(i.position.add(new BABYLON.Vector3(0,0,-10)));let e=new BABYLON.DynamicTexture("endTexture",{width:700,height:100},scene);e.drawText(`You survived ${d.spawnedCount-1} paws`,100,60,"bold 44px monospace","white","black",!0,!0);let t=new BABYLON.StandardMaterial("endMat",scene);t.diffuseTexture=e,c.material=t,c.isVisible=!0}),scene};createScene().then(e=>{engine.runRenderLoop(()=>e.render())}),window.addEventListener("resize",function(){engine.resize()});</script>