<!doctype html><div style="width:640px;height:480px;margin:0 auto"><canvas height=480 style=background:#28292b width=640></canvas></div><script src=kontra.js></script><script>function GR(s,t){return Math.floor(Math.random()*(t-s+1))+s}var K=Q;K.init();for(var I=[0,0,0,0,0,0],i=0;i<I.length;i++)I[i]=new Image,(1==i||3==i||4==i)&&(I[i].src="s/tile"+i.toString()+".png");var si=[new Image,new Image,new Image];si[0].src="s/s.png",si[1].src="s/f.png",si[2].src="s/m.png";var ss=K.sprite({x:160,y:220,image:si[0]}),fs=K.sprite({x:160,y:220,image:si[1]}),ms=K.sprite({x:180,y:220,image:si[2]}),gS=0,L={l:[[1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,3,3,3,3,3,1,1,1,1,1,1,5,5,5,5,5,5,5,5,3,3,0,1,1,3,1,1,1,1,1,1,1,5,5,5,5,5,0,3,3,1,1,1,1,3,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,4,1,1,1,4,0,1,5,5,5,5,5,1,1,1,1,1,1,1,1,4,1,1,1,4,0,5,5,5,5,5,5,5,1,1,1,1,1,1,1,4,4,1,4,4,5,5,5,5,5,5,5,5,5,5,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,1,4,4,1,1,1,5,5,5,5,5,5,5,1,1,0,4,0,1,1,4,4,4,1,1,5,5,5,5,5,5,5,5,1,1,4,4,4,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,0,1,1,4,1,1,4,4,1,1,5,5,5,5,5,5,5,1,0,4,0,1,1,4,4,4,4,4,0,0,1,5,5,5,5,5,5,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,1,1,5,5,5,1,1,1,1,1,0,4,4,1,1,4,4,0,1,1,5,5,5,5,5,5,1,1,1,1,0,4,1,1,1,1,4,0,1,1,1,5,5,5,5,5,5,1,1,1,0,4,1,1,1,1,4,4,1,1,1,1,5,5,5,5,1,1,1,1,0,4,1,1,1,1,4,0,1,1,1,5,5,5,1,1,1,1,1,1,0,4,4,1,1,4,4,0,1,1,1,1,1,5,1,1,3,0,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,1,1,1,1,3,3,3,3,3,3,3,3,4,1,0,3,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4,4,1,1,0,1,1,1,1,1,4,4,1,1,1,0,3,0,1,1,4,4,0,3,0,3,1,1,1,0,4,4,0,1,1,3,4,3,1,1,4,4,1,1,0,1,1,1,4,4,1,1,4,4,1,0,3,0,1,1,4,4,1,0,3,1,1,1,4,4,1,1,4,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4],[1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,4,1,1,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,4,1,1,4,4,4,4,4,4,1,1,1,1,0,3,0,1,1,1,0,4,5,5,4,0,1,1,0,0,1,1,1,1,3,3,3,1,1,1,0,4,5,5,4,1,1,1,0,1,1,1,1,1,0,3,0,1,1,1,0,4,5,4,4,1,1,1,3,3,3,1,1,1,1,1,1,1,1,4,4,4,5,4,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,1,5,5,4,0,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,1,5,5,4,4,1,1,1,3,1,1,4,4,4,1,1,1,1,4,4,1,5,5,5,4,0,1,1,3,1,1,0,4,0,1,1,1,1,4,4,1,5,5,5,4,4,1,1,3,1,1,1,1,1,1,1,1,1,4,1,1,5,5,5,5,4,0,1,3,1,0,4,4,0,1,1,4,4,4,1,1,5,5,5,5,4,4,0,1,1,4,4,4,4,1,0,4,1,1,1,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,1,1,1,5,5]],ap:[[32,384],[320,384],[480,320]],aI:new Image,a:null,f:0,rs:0,c:0,nv:0,lN:function(s,t){L.c<=L.l.length-1?(bd.splice(0,bd.length),T.t.splice(0,T.t.length),T.d.splice(0,T.d.length),T.v.splice(0,T.v.length),t||L.c++,T.f(),s.cId=0,P.s.x=0,P.s.y=0,L.f=0):0==L.nv&&(L.nv=setTimeout((function(){ad(0),gS=4}),1e3))}};bu=function(s,t,e,i){this.sp=K.sprite({x:t,y:e,dx:0,width:GR(6,14),height:GR(6,14),color:bc[s]}),s=1,1==GR(0,2)&&(s=-1),this.tx=t+s*GR(32,48),1==GR(0,2)&&(s=1),this.ty=e+s*GR(32,48),this.u=function(){this.sp.x<this.tx&&(this.sp.x+=8),this.sp.y<this.ty&&(this.sp.y+=8)}};var bd=[];function Abd(s,t,e){bd.push(new bu(GR(0,2),s,t,e))}bc=["#b7122b","#5b0613","#ea0211"];var T={t:[],v:[],d:[],cl:["#202e44","#8ea79f","#2d3a37","#265934"],f:function(){L.aI.src="s/an.png",L.a=K.sprite({x:L.ap[L.c][0],y:L.ap[L.c][1],dx:0,image:L.aI});for(var s=0,t=0,e=0,i=0;15>e;e++,t+=32){for(var n=0;20>n;n++,i++,s+=32)this.v.push(0),T.d[i]=L.l[L.c][i],T.t[i]=0!=T.d[i]&&5!=T.d[i]?K.sprite({x:s,y:t,dx:0,image:I[L.l[L.c][i]]}):0==T.d[i]?K.sprite({x:s,y:t,dx:0,width:32,height:32,color:"#212121"}):K.sprite({x:s,y:t,dx:0,width:32,height:32,color:"#41959a"}),T.t[i].x==L.a.x&&T.t[i].y==L.a.y&&(this.v[i]=1);s=0}for(s=P.rd.x,t=P.rd.y,e=0;16>e;e++)for(P.rd.x=GR(0,600),P.rd.y=GR(0,400),i=0;i<T.t.length;i++)T.t[i].collidesWith(P.rd)&&(T.v[i]=1);P.rd.x=s,P.rd.y=t,E.add()},R:function(){for(var s=0;s<T.t.length;s++)this.v[s]&&T.t[s].render()}},P={imgs:[],v:0,s:0,cf:0,cId:0,kf:0,flp:0,tps:{x:0,y:0},animIntv:0,cs:1,kn:K.sprite({x:0,y:0,width:96,height:96,color:"pink"}),rd:K.sprite({x:0,y:0,width:160,height:160,color:"#41959a"}),rev:function(){P.rd.x=P.s.x-64,P.rd.y=P.s.y-64;for(var s=0;s<T.t.length;s++)T.v[s]||P.rd.collidesWith(T.t[s])&&(T.v[s]=1)},init:function(){for(var s=0;4>s;s++)P.imgs[s]=new Image,P.imgs[s].src="s/pl"+s.toString()+".png";P.s=K.sprite({x:0,y:0,image:P.imgs[0]}),P.rev()},smoothM:function(){P.s.x<P.tps.x&&(P.s.x+=1),P.s.x>P.tps.x&&--P.s.x,P.s.y<P.tps.y&&(P.s.y+=1),P.s.y>P.tps.y&&--P.s.y,P.s.image=P.imgs[P.cf],P.rev(),P.kn.x=P.s.x-32,P.kn.y=P.s.y-32},M:function(s){P.kf||("l"==s?(0<P.cId&&3>T.d[P.cId-1]&&0<P.s.x&&P.cId--,P.cf=1):"r"==s&&(P.cId<T.d.length-1&&3>T.d[P.cId+1]&&608>P.s.x&&P.cId++,P.cf=0),"u"==s&&(0<=P.cId-20&&3>T.d[P.cId-20]&&(P.cId-=20),P.cf=2),"d"==s&&(P.cId+20<T.d.length-1&&3>T.d[P.cId+20]&&(P.cId+=20),P.cf=3),P.v=0==T.d[P.cId]?0:1,P.tps.x=T.t[P.cId].x,P.tps.y=T.t[P.cId].y,P.animIntv=setInterval(P.smoothM,10),P.kf=1,setTimeout((function(){P.kf=0,clearInterval(P.animIntv)}),320),E.M())},at:function(){for(var s=0;s<E.m.length;s++){var t=E.m[s].id;if(E.m[s].ak&&(P.s.x==E.m[s].sp.x&&32==Math.abs(P.s.y-E.m[s].sp.y)||P.s.y==E.m[s].sp.y&&32==Math.abs(P.s.x-E.m[s].sp.x))){E.m[s].r.width=0;for(var e=GR(4,24),i=0;i<e;i++)Abd(E.m[s].sp.x,E.m[s].sp.y,E.m[s].cf);for(E.m.splice(s,1),e=0;e<bd.length;e++)bd[e].sp.id==t&&bd[e].sp.id--}}},cl:function(){for(var s=0;s<bd.length;s++)bd[s].sp.collidesWith(P.kn)&&bd.splice(s,1)}};function e(){var s=this;s.imgs=[],s.vsb=0,s.w=null,s.init=function(){for(var t=0;4>t;t++)s.imgs[t]=new Image,s.imgs[t].src="s/en"+t.toString()+".png";s.imgs.push(new Image),s.imgs[s.imgs.length-1].src="s/w.png",s.w=K.sprite({x:-400,y:-400,image:s.imgs[4],v:0})},s.init(),s.sp=K.sprite({x:-32,y:-32,image:s.imgs[0]}),s.cf=0,s.cId=0,s.kf=0,s.id=0,s.flp=0,s.tps={x:0,y:0},s.animIntv=0,s.p=[],s.cpi=0,s.invm=0,s.mIv=0,s.ak=0,s.r=K.sprite({x:-480,y:-480,width:160,height:160,color:"blue"}),s.cs=1,s.smoothM=function(){s.sp.x<s.tps.x&&(s.sp.x+=1,s.cf=0),s.sp.x>s.tps.x&&(--s.sp.x,s.cf=1),s.sp.y<s.tps.y&&(s.sp.y+=1,s.cf=3),s.sp.y>s.tps.y&&(--s.sp.y,s.cf=2),s.w.x=s.sp.x+8,s.w.y=s.sp.y-24,s.sp.image=s.imgs[s.cf],0==s.cf&&(s.r.x=s.sp.x,s.r.y=s.sp.y-64),1==s.cf&&(s.r.x=s.sp.x-128,s.r.y=s.sp.y-64),2==s.cf&&(s.r.x=s.sp.x-64,s.r.y=s.sp.y-128),3==s.cf&&(s.r.x=s.sp.x-64,s.r.y=s.sp.y);for(var t=0;t<bd.length;t++)s.r.collidesWith(bd[t].sp)&&0==s.w.v&&(s.w.v=1,s.vsb=1,setTimeout((function(){gS=1,L.lN(P,1),L.rs=0}),4e3),setTimeout((function(){ad(1),gS=2}),1500))},s.M=function(){var t=s.cpi;s.invm||(s.cpi<s.p.length-1?s.cpi++:s.invm=1),s.invm&&(0<s.cpi?s.cpi--:s.invm=0),s.vsb=T.v[s.p[s.cpi]]?1:0,s.w.v&&(s.vsb=1),s.tps.x=T.t[s.p[s.cpi]].x,s.tps.y=T.t[s.p[s.cpi]].y,s.mIv=setInterval((function(){return s.smoothM()}),10);var e=s.mIv;setTimeout((function(){clearInterval(e)}),320),T.t[s.p[t]].x<T.t[s.p[s.cpi]].x?s.flp=0:T.t[s.p[t]].x>T.t[s.p[s.cpi]].x&&(s.flp=2)}}var enm=new e,E={m:[],id:0,setups:[[[288,96,69,69,69,69,68,67,66,65,64,63,62,61,81,101,102,122,122,122],[352,96,71,70,70,70,71,72,92,93,94,95,115,135,136,137,138,118,98,78,77,76,56],[416,384,253,254,274,294,295,296,297,298,278,258,238,218,198,197,196,176,176,196,195,194,214,234],[160,320,205,205,205,205,204,203,223,243,244,245,246,247,248,249,249,249,250,250,250]],[[544,32,37,37,37,37,36,35,55,75,76,96,97,97,97,96,116,136,137,138,138,138],[128,128,84,104,104,104,84,64,64],[256,96,68,69,70,71,91,111,110,130,150,150,150,149,129,109,108,88,68],[416,288,193,194,195,196,197,198,218,238,258,278,277,276,275,274,273,253,233,213,193],[32,320,201,221,241,261,281,282,283,284,285,286,287,288,288,288,287,286,266,246,226,225,205,204,203,202,201]],[[320,32,30,31,32,33,34,35,35,35,55,54,53,52,51,50,50],[288,192,129,130,131,111,91,71,70,69,89,109,129,129,129,129],[480,224,155,154,153,152,151,150,149,148,147,146,146,146],[128,128,84,85,105,125,145,165,185,184,183,163,143,123,124,104,103],[224,288,187,207,227,247,267,266,265,245,225,205,185,165,166,167,167],[384,352,232,232,232,231,230,230,230,229,228,228,228]]],add:function(){for(var s=0;s<E.setups[L.c].length;s++){E.id=s,E.m[E.id]=new e,E.m[E.id].init(),E.m[E.id].sp.x=E.setups[L.c][E.id][0],E.m[E.id].sp.y=E.setups[L.c][E.id][1];for(var t=2;t<E.setups[L.c][E.id].length;t++)E.m[E.id].p[t-2]=E.setups[L.c][E.id][t]}},M:function(){for(var s=0;s<E.m.length;s++)E.m[s].M()},render:function(){for(var s=0;s<E.m.length;s++)E.m[s].vsb&&(E.m[s].sp.render(),E.m[s].w.v&&E.m[s].w.render(),E.m[s].r.collidesWith(P.s)&&P.v&&(E.m[s].w.v=1,L.rs||(L.rs=1,setTimeout((function(){gS=1,L.lN(P,1),L.rs=0}),4e3),setTimeout((function(){gS=2,ad(1)}),1e3))))}},loop=K.gameLoop({update:function(){if(1==gS){K.keys.pressed("a")&&!K.keys.pressed("p")?P.M("l"):K.keys.pressed("d")&&!K.keys.pressed("p")?P.M("r"):K.keys.pressed("w")&&!K.keys.pressed("p")?P.M("u"):K.keys.pressed("s")&&!K.keys.pressed("p")?P.M("d"):K.keys.pressed("p")&&P.cs?(P.cl(),E.M(),P.cs=0,setTimeout((function(){P.cs=1}),500)):K.keys.pressed("l")&&P.cs&&(P.at(),P.cs=0,setTimeout((function(){P.cs=1}),500));for(var s=0;s<E.m.length;s++)E.m[s].sp.collidesWith(P.kn)?E.m[s].ak=1:E.m[s].ak=0;P.s.x==L.a.x&&P.s.y==L.a.y&&1>L.f&&(L.c<L.l.length-1?(L.f=1,L.nv=setTimeout((function(){L.lN(P,0),L.f=0}),2e3)):(L.f=2,L.nv=setTimeout((function(){gS=4,ad(0)}),2e3)))}0==gS&&K.keys.pressed("space")&&(gS=1)},render:function(){if(1==gS){T.R();for(var s=0;s<bd.length;s++)bd[s].sp.render(),bd[s].u();P.s.render(),E.render(),L.a.render()}else 0==gS?ss.render():2==gS?fs.render():4==gS&&ms.render()}});T.f(),P.init(),loop.start();var cp=0;function ad(n){if(cp||0==n)with(D=[[13,,8,10,,13,,13,15,,,,13,,10,8,,13,,13,15,,15,,13,,10,8,10,13,,13,10,,,10,8,,13,10,8,10,8,,8,10,13,15,,15,,13],[25,,21,,20,19]],new AudioContext)with(G=createGain())for(i in D[n])with(createOscillator())D[n][i]&&(connect(G),G.connect(destination),start(.2*i),frequency.setValueAtTime(90*1.06**(13-D[n][i]),.2*i),type="square",gain.setValueAtTime(.35,.2*i),gain.setTargetAtTime(1e-4,.2*i+.18,.005),stop(.2*i+.19))}ad(0),setTimeout((function(){cp=1}),15e3)</script>