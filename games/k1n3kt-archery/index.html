<!doctype html><title>K1n3kt Archery</title><style>#cvCanvas{height:97vh;image-rendering:pixelated;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scaleX(-1)}#cameraSelectContainer{font-size:2em;position:absolute;top:50%;left:30%;transform:translate(-20%,-50%);background:#deb887;padding:30px}body{font-family:"Open Sans",sans-serif;text-align:justify;text-justify:inter-word}button,select{height:42px;font-size:20px}button{letter-spacing:2px;text-decoration:none;text-transform:uppercase;color:#000;cursor:pointer;border:3px solid;padding:.25em .5em;box-shadow:1px 1px 0 0,2px 2px 0 0,3px 3px 0 0,4px 4px 0 0,5px 5px 0 0;position:relative;user-select:none;-webkit-user-select:none;touch-action:manipulation}button:active{box-shadow:0 0;top:5px;left:5px}@media (min-width:768px){button{padding:.25em .75em}}body{background:repeating-linear-gradient(45deg,#004a00,#004a00 5%,#004f00 5%,#004f00 10%);background-size:100px 100px}</style><script>function matrixMultiply(t,r){for(var e=transposeMatrix(r),n=[],a=0;a<t.length;a++){for(var o=[],w=0;w<e.length;w++){var l=internalProduct(t[a],e[w]);o.push(l)}n.push(o)}return n}function matrixScalarMultiply(t,r){for(var e=[],n=0;n<t.length;n++){for(var a=[],o=0;o<t[0].length;o++)a.push(r*t[n][o]);e.push(a)}return e}function internalProduct(t,r){if(t.length!=r.length)throw"SizesDoNotMatch";for(var e=0,n=0;n<t.length;n++)e+=t[n]*r[n];return e}function transposeMatrix(t){for(var r=[],e=0;e<t[0].length;e++){for(var n=[],a=0;a<t.length;a++)n.push(t[a][e]);r.push(n)}return r}function minorMatrix(t,r,e){for(var n=[],a=0;a<t.length;a++)if(a!=r){for(var o=[],w=0;w<t.length;w++)w!=e&&o.push(t[a][w]);n.push(o)}return n}function determinant(t){var r=t.length;if(1==r)return t[0][0];if(2==r)return t[0][0]*t[1][1]-t[0][1]*t[1][0];for(var e=0,n=0;n<r;n++){var a=minorMatrix(t,0,n);e+=(n%2>0?-1:1)*t[0][n]*determinant(a)}return e}function cofactor(t,r,e){return minor=minorMatrix(t,r,e),determinant(minor)}function cofactorMatrix(t){for(var r=[],e=0;e<t.length;e++){for(var n=[],a=0;a<t.length;a++){var o=cofactor(t,e,a)*Math.pow(-1,e+a);n.push(o)}r.push(n)}return r}function inverseMatrix(t){var r=determinant(t);if(0==r)throw"SingularMatrix";var e=1/r;return matrixScalarMultiply(transposeMatrix(cofactorMatrix(t)),e)}function dotOp(t,r,e){for(var n=[],a=0;a<r.length;a++){for(var o=[],w=0;w<r[0].length;w++)o.push(t(r[a][w],e[a][w]));n.push(o)}return n}function generateMatrix(t,r,e){for(var n=[],a=0;a<t;a++){for(var o=[],w=0;w<r;w++)o.push(e(a,w));n.push(o)}return n}function zeros(t,r){return generateMatrix(t,r,(function(t,r){return 0}))}function ones(t,r){return generateMatrix(t,r,(function(t,r){return 1}))}function identity(t){return generateMatrix(t,t,(function(t,r){return t===r?1:0}))}let zzfx,zzfxV,zzfxX;zzfxV=.3,zzfx=(t=1,r=.05,e=220,n=0,a=0,o=.1,w=0,l=1,s=0,i=0,h=0,f=0,u=0,x=0,c=0,p=0,m=0,g=1,M=0,y=0,d=Math,v=44100,z=2*d.PI,S=(s*=500*z/v/v),b=(e*=(1-r+2*r*d.random(r=[]))*z/v),A=0,F=0,E=0,P=1,I=0,R=0,X=0,C,D)=>{for(i*=500*z/v**3,c*=z/v,h*=z/v,f*=v,u=v*u|0,D=(n=v*n+9)+(M*=v)+(a*=v)+(o*=v)+(m*=v)|0;E<D;r[E++]=X)++R%(100*p|0)||(X=w?1<w?2<w?3<w?d.sin((A%z)**3):d.max(d.min(d.tan(A),1),-1):1-(2*A/z%2+2)%2:1-4*d.abs(d.round(A/z)-A/z):d.sin(A),X=(u?1-y+y*d.sin(z*E/u):1)*(0<X?1:-1)*d.abs(X)**l*zzfxV*t*(E<n?E/n:E<n+M?1-(E-n)/M*(1-g):E<n+M+a?g:E<D-m?(D-E-m)/o*g:0),X=m?X/2+(m>E?0:(E<D-m?1:(D-E)/m)*r[E-m|0]/2):X),A+=(C=(e+=s+=i)*d.cos(c*F++))-C*x*(1-1e9*(d.sin(E)+1)%2),P&&++P>f&&(e+=h,b+=h,P=0),!u||++I%u||(e=b,s=S,P||=1);return(t=zzfxX.createBuffer(1,D,v)).getChannelData(0).set(r),(e=zzfxX.createBufferSource()).buffer=t,e.connect(zzfxX.destination),e.start(),e},zzfxX=new AudioContext;let seedRand=(t,r,e,n)=>function(){var a=((t|=0)+(r|=0)|0)+(n|=0)|0;return n=n+1|0,t=r^r>>>9,r=(e|=0)+(e<<3)|0,e=(e=e<<21|e>>>11)+a|0,(a>>>0)/4294967296};function intersection(t,r,e,n,a,o,w,l){return[((t*n-r*e)*(a-w)-(t-e)*(a*l-o*w))/((t-e)*(o-l)-(r-n)*(a-w)),((t*n-r*e)*(o-l)-(r-n)*(a*l-o*w))/((t-e)*(o-l)-(r-n)*(a-w))]}function randomInteger(t,r){return Math.floor(Math.random()*(r-t+1))+t}function rotateMat(t,r){let e=Math.floor(t[0].length/2),n=Math.floor(t.length/2),a=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]];return t.map(((r,o)=>r.map(((r,w)=>{let l=matrixMultiply([[w-e,o-n]],a),s=Math.ceil(l[0][0]+e),i=Math.ceil(l[0][1]+n);return s=Math.max(0,s),s=Math.min(t[0].length-1,s),i=Math.max(0,i),i=Math.min(t.length-1,i),t[i][s]}))))}let getFlatlc=(t,r,e,n)=>t[r*n+e],setFlatlc=(t,r,e,n,a)=>t[r*n+e]=a,setFlatlcRgba=(t,r,e,n,a,o,w,l)=>{e=Math.ceil(e),r=Math.ceil(r),0!==l&&(t[r*n+e+0]=a,t[r*n+e+1]=o,t[r*n+e+2]=w,t[r*n+e+3]=l)},colorPallete={" ":[0,0,0,0],0:[0,0,0,0],1:[0,0,0,255],r:[255,0,0,255],y:[255,204,0,255],o:[255,170,86,255],b:[0,0,0,255],w:[255,255,255,255],g:[0,255,0,255],s:[219,206,213,255],m:[114,77,36,255],q:[114,77,36,255],x:[20,20,20,10],d:[105,105,105,255]},monstersSprites=["     r       ","     rr      ","  wwwwr      ","  bwbwr      "," oowww      w","  rrwwwwwwww ","   wwwwwwwwww","   wwwwwwwww ","    wwwwwww  ","    xwwwww   ","   xxyxxyx   ","  xxyyxyyxx  ","   xxxxxxx   "].map((t=>t.split(""))),monstersSpritesRev=monstersSprites.map((t=>[...t].reverse())),monstersSprites2=["     r       ","     rr      ","  wwwwr      ","  bwbwr      "," oowww      w","  rrwwwwwwww ","   wwwwwwwwww","   wwwwwwwww ","    wwwwwww  ","    xwwwww   ","   xyyxxyx   ","  xxxxxyyxx  ","   xxxxxxx   "].map((t=>t.split(""))),monstersSprites2Rev=monstersSprites2.map((t=>[...t].reverse())),monstersSprites3=["     r       ","     rr      ","  wwwwr      ","  bwbwr      "," oowww      w","  rrwwwwwwww ","   wwwwwwwwww","   wwwwwwwww ","    wwwwwww  ","    xwwwww   ","   xxyxyyx   ","  xxyyxxxxx  ","   xxxxxxx   "].map((t=>t.split(""))),monstersSprites3Rev=monstersSprites3.map((t=>[...t].reverse())),arrowsSprite=["      r r       ","       rrr      ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","       m        ","      ss        ","       s        "].map((t=>t.split(""))),monsters=new Array(10).fill().map((t=>({type:"monster",sprite:monstersSprites,life:0,x:0,y:0,t:0,theta:0,speed:0}))),arrows=new Array(1e3).fill().map((t=>({type:"arrow",x:0,y:0,speed:1,theta:0,life:0,sprite:arrowsSprite})));function nms(t){let r,e,n,a,o=Math.floor(1.5),w=t.constructor===ImageData;w?(a=t.data,r=t.width,e=t.height-3,n=t.width-3):(a=t,r=1,e=a.length-3,n=a[0].length-3);for(let t=0;t<=e;t++)for(let e=0;e<=n;e++){let n=0;for(let o=2;o>=0;o--)for(let l=2;l>=0;l--){let s=w?getFlatlc(a,t+o,4*(e+l),4*r):a[t+o][e+l];s=s||0,s>n&&(n=s)}(w?getFlatlc(a,t+o,4*(e+o),4*r):a[t+o][e+o])!==n&&(w?(setFlatlc(a,t+o,4*(e+o),4*r,0),setFlatlc(a,t+o,4*(e+o)+1,4*r,0),setFlatlc(a,t+o,4*(e+o)+2,4*r,0)):a[t+o][e+o]=0)}}function houghLines(t){const r=t.data,e=t.width,n=t.height;let a=[];for(let t=0;t<n;t++){const n=[];for(let a=0;a<e;a++){const o=r[4*(t*e+a)]?1:0;n.push(o)}a.push(n)}let o=a.length,w=a[0].length,l=2*Math.ceil(Math.sqrt(a.length*a.length+a[0].length*a[0].length)),s=Math.ceil(l/2),i=new Array(l).fill(0).map((t=>new Array(45).fill(0)));a.forEach(((t,r)=>{t.forEach(((t,e)=>{t&&i[0].forEach(((t,n)=>{let a=Math.PI/i[0].length*n,o=Math.round(e*Math.cos(a)+r*Math.sin(a))+s;i[o][n]+=1}))}))})),nms(i);let h=[];for(let t=0;t<i.length;t++)for(let r=0;r<i[0].length;r++)if(i[t][r]){let e=Math.PI/i[0].length*r;h.push({x:r,y:t,theta:e,p:t-s,score:i[t][r]})}h=h.sort(((t,r)=>r.score-t.score));new Array(o).fill(0).map((t=>new Array(w).fill(0)));return h}function applyGaussianBlur(t){const r=t.data,e=t.width,n=t.height,a=new Uint8ClampedArray(r.length);for(let t=0;t<n;t++)for(let n=0;n<e;n++){let o=0,w=0,l=0,s=0;for(let a=-1;a<=1;a++)for(let i=-1;i<=1;i++){const h=4*((t+a)*e+(n+i)),f=1/9;o+=r[h]*f,w+=r[h+1]*f,l+=r[h+2]*f,s+=r[h+3]*f}const i=4*(t*e+n);a[i]=o,a[i+1]=w,a[i+2]=l,a[i+3]=s}for(let t=0;t<r.length;t++)r[t]=a[t]}function applyOtsuThreshold(t){const r=t.data,e=otsuThreshold(r);for(let t=0;t<r.length;t+=4){const n=(r[t]+r[t+1]+r[t+2])/3>e?255:0;r[t]=n,r[t+1]=n,r[t+2]=n}}function otsuThreshold(t){const r=Array.from({length:256},(()=>0));for(let e=0;e<t.length;e+=4){const n=(t[e]+t[e+1]+t[e+2])/3;r[Math.floor(n)]++}let e=0;for(let t=1;t<256;t++)e+=t*r[t];let n,a,o=0,w=0,l=0,s=0,i=0;for(let h=0;h<256;h++)if(w+=r[h],0!==w){if(l=t.length/4-w,0===l)break;o+=h*r[h],n=o/w,a=(e-o)/l,between=w*l*Math.pow(n-a,2),between>=s&&(s=between,i=h)}return i}function applyEdgeDetection(t){const r=t.data,e=t.width,n=t.height,a=[-1,0,1,-2,0,2,-1,0,1],o=[-1,-2,-1,0,0,0,1,2,1],w=new Uint8ClampedArray(r.length);for(let t=1;t<n-1;t++)for(let n=1;n<e-1;n++){let l=0,s=0;for(let w=-1;w<=1;w++)for(let i=-1;i<=1;i++){const h=4*((t+w)*e+(n+i)),f=a[3*(w+1)+(i+1)],u=o[3*(w+1)+(i+1)];l+=r[h]*f,s+=r[h]*u}const i=4*(t*e+n),h=Math.sqrt(l*l+s*s);w[i]=h,w[i+1]=h,w[i+2]=h,w[i+3]=255}for(let t=0;t<r.length;t++)r[t]=w[t]}var letters={A:[[0,1,0],[1,0,1],[1,0,1],[1,1,1],[1,0,1]],B:[[1,1,0],[1,0,1],[1,1,1],[1,0,1],[1,1]],C:[[1,1,1],[1,0,0],[1,0,0],[1,0,0],[1,1,1]],D:[[1,1,0],[1,0,1],[1,0,1],[1,0,1],[1,1,0]],E:[[1,1,1],[1,0,0],[1,1,1],[1,0,0],[1,1,1]],F:[[1,1,1],[1,0,0],[1,1,0],[1,0,0],[1,0,0]],G:[[0,1,1,0],[1,0,0,0],[1,0,1,1],[1,0,0,1],[0,1,1,0]],H:[[1,0,1],[1,0,1],[1,1,1],[1,0,1],[1,0,1]],I:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[1,1,1]],J:[[1,1,1],[0,0,1],[0,0,1],[1,0,1],[1,1,1]],K:[[1,0,0,1],[1,0,1,0],[1,1,0,0],[1,0,1,0],[1,0,0,1]],L:[[1,0,0],[1,0,0],[1,0,0],[1,0,0],[1,1,1]],M:[[1,1,1,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1]],"/":[[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0]],N:[[1,0,0,1],[1,1,0,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],O:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],P:[[1,1,1],[1,0,1],[1,1,1],[1,0,0],[1,0,0]],Q:[[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,1,1],[1,1,1,1]],R:[[1,1,0],[1,0,1],[1,0,1],[1,1,0],[1,0,1]],S:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],T:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],U:[[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],V:[[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0]],W:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,1,1,1,1]],X:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]],Y:[[1,0,1],[1,0,1],[0,1,0],[0,1,0],[0,1,0]],Z:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]],0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[0,1],[0,1],[0,1],[0,1],[0,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]],"!":[[0,1,0],[0,1,0],[0,1,0],[0,0,0],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],":":[[0,0,0],[0,1,0],[0,0,0],[0,1,0],[0,0,0]]};Object.keys(letters).forEach((t=>letters[t].forEach((t=>t.reverse()))))</script><div style=z-index:2 id=cameraSelectContainer><p>k<b>1</b>n<b>3k</b>t archery 🏹<p><b>This archery simulator game uses the webcam 📷 to detect lines on image and create a medieval virtual bow.</b><p><b>How to play:</b><p>1. Hold a pen or something similar close to camera and rotate it to aim your virtual bow 🖊️🤏<p>2. Hold and release spacebar to shoot a arrow and scare the chicken 🐔 and avoid it cross the road<p>3. If it doesn't work well, try playing in a brighter environment with fewer objects that can trick the game.</p><label for=cameraSelect>SELECT CAMERA:</label> <select id=cameraSelect></select><button id=startButton>Start game</button></div><canvas id=cvCanvas width=150 height=150></canvas><div class=bg-grass style=z-index:1></div><script>let bowAngle,stream,entities=arrows.concat(monsters),gs={pts:0,time:0,time0:0,showHighScore:!1,maxTime:60},newGame=()=>{msgsTxt.splice(0),gs.pts=0,gs.time0=Math.floor(performance.now()/1e3),gs.showHighScore=!1},msgsTxt=[],buildTxtEntities=(e,t,a)=>{let s=0;return a.split("").reverse().map((a=>{let i=letters[a.toUpperCase()],l={sprite:i,life:1,x:e+s,y:t,speed:0,theta:0};return s+=i[0].length+1,l}))};async function getCameraStream(e){try{return stream=await navigator.mediaDevices.getUserMedia(e),stream}catch(e){console.error("Error accessing webcam: ",e)}}async function populateCameraList(){const e=document.getElementById("cameraSelect"),t=await navigator.mediaDevices.enumerateDevices();for(const a of t)if("videoinput"===a.kind){const t=document.createElement("option");t.value=a.deviceId,t.text=a.label||`Camera ${e.length+1}`,e.appendChild(t)}}function startWebcam(){newGame();const e={video:{deviceId:{exact:document.getElementById("cameraSelect").value}}},t=document.getElementById("cvCanvas"),a=t.getContext("2d",{willReadFrequently:!0});getCameraStream(e).then((()=>{document.getElementById("cameraSelectContainer").remove();let e={space:null},s=0,i=0,l=0;window.addEventListener("keypress",(t=>{"Enter"===t.code?newGame():"Space"===t.code?e.space=!0:t.preventDefault()})),window.addEventListener("keyup",(t=>{if("Space"===t.code){if(e.space&&s>10){let e=arrows.filter((e=>!e.life))[0];if(e&&void 0!==bowAngle){let t=arrowsSprite[0].length*Math.cos(bowAngle+Math.PI);e.x=i-arrowsSprite[0].length/2+t,e.y=l-arrowsSprite.length-3,e.theta=bowAngle,e.sprite=rotateMat(arrowsSprite,bowAngle+Math.PI/2),e.life=1,e.speed=s*s/40}e.speed>15?(monsters.filter((e=>e.life>0)).forEach((e=>e.speed+=randomInteger(0,1))),zzfx(...[1.9,,178,.02,.14,.16,,.8,-6.7,-.2,,,,,,,.22,.74,.05,.38])):zzfx(...[2.07,,97,.02,.08,.09,,.92,-6.7,.2,,,,,,,.22,.74,.04,.38])}e.space=!1}else t.preventDefault()}));const n=document.createElement("video");n.srcObject=stream,n.play(),gs.time0=Math.floor(performance.now()/1e3),function r(){gs.time=Math.floor(performance.now()/1e3)-gs.time0,gs.time>gs.maxTime&&!gs.showHighScore&&(gs.showHighScore=!0,msgsTxt.splice(0),msgsTxt.splice(msgsTxt.length,0,...buildTxtEntities(40,40,"time out !")),window.setTimeout((()=>{let e=window.localStorage.getItem("highscore");!e||gs.pts>parseFloat(e)?(window.localStorage.setItem("highscore",gs.pts),msgsTxt.splice(msgsTxt.length,0,...buildTxtEntities(40,50,"new high score!"))):msgsTxt.splice(msgsTxt.length,0,...buildTxtEntities(40,50,`actual high score: ${e}`)),msgsTxt.splice(msgsTxt.length,0,...buildTxtEntities(40,60,"press enter to play again"))}),1500)),a.drawImage(n,0,0,t.width,t.height);let o,h,c,g,d=a.getImageData(0,0,t.width,t.height);applyGaussianBlur(d),applyEdgeDetection(d),nms(d),applyOtsuThreshold(d);for(let e=0;e<d.height;e++)for(let t=0;t<d.width;t++){getFlatlc(d.data,e,4*t,4*d.width)&&setFlatlc(d.data,e,4*t+3,4*d.width,60),(e<8||t<8||e>d.height-8||t>d.width-8)&&(setFlatlc(d.data,e,4*t,4*d.width,0),setFlatlc(d.data,e,4*t+1,4*d.width,0),setFlatlc(d.data,e,4*t+2,4*d.width,0))}e.space?(s=Math.min(s+1,25),5===s&&zzfx(...[.25,,138,.05,.17,.14,1,.5,,.3,100,,,,,,,.8,.1,.27])):s=Math.max(s-10,0);let m=houghLines(d),p=seedRand(123);for(let e=d.height-1;e>=0;e--)for(let t=d.width-1;t>=0;t--){let a=Math.floor(-9*p())+90;t<2||t>d.width-3?setFlatlcRgba(d.data,Math.ceil(e),4*Math.ceil(t)+0,4*d.width,a,a/2,a/3,255):getFlatlc(d.data,e,4*t,4*d.width)||setFlatlcRgba(d.data,Math.ceil(e),4*Math.ceil(t)+0,4*d.width,0,a,0,255)}m.length&&m.filter((e=>e.theta>.4&&e.theta<2.6)).slice(0,2).sort(((e,t)=>t.p-e.p)).slice(0,1).forEach((e=>{bowAngle=e.theta;for(let t=0;t<d.width-1;t+=.02){let a=bowAngle;0===a&&(a+=.01);let s=e.p,i=t,l=Math.ceil((s-t*Math.cos(a))/Math.sin(a));void 0!==getFlatlc(d.data,l,4*Math.ceil(i),4*d.width)&&setFlatlcRgba(d.data,l,4*Math.ceil(i)+0,4*d.width,0,255,0,40)}let a=e.p+s,i=bowAngle,l=Math.ceil((a-0*Math.cos(i))/Math.sin(i)),n=t.width,r=Math.ceil((a-n*Math.cos(i))/Math.sin(i));c=l,g=r;let m=t.width/2,p=t.height-10,w=m-10*Math.cos(bowAngle),M=p-10*Math.sin(bowAngle);[o,h]=intersection(0,l,n,r,m,p,w,M)})),monsters.filter((e=>0===e.life&&!gs.showHighScore)).slice(0,2).forEach((e=>{randomInteger(0,80)||(zzfx(...[2,,464,,.15,.13,,2.81,-15,,,,,,,,.14,.09,.08]),e.life=1,e.x=randomInteger(0,t.width-e.sprite[0].length),e.y=0,e.t=0,e.theta=-Math.PI/2+randomInteger(-Math.PI/4*100,Math.PI/4*100)/100,e.speed=randomInteger(1,2)/2)}));let w=0,M=`${gs.pts} pts`.split("").reverse().map((e=>{let t=letters[e.toUpperCase()],a={sprite:t,life:1,x:20+w,y:10};return w+=t[0].length+1,a})),f=M.map((e=>Object.assign({},e,{sprite:e.sprite.map((e=>e.map((e=>e?"d":e)))),y:e.y-1})));w=0;let u=`${Math.min(gs.maxTime,gs.time)}`.split("").reverse().map((e=>{let t=letters[e.toUpperCase()],a={sprite:t,life:1,x:20+w,y:20};return w+=t[0].length+1,a}));entities.concat(f,M,u,msgsTxt).filter((e=>0!==e.life)).forEach((e=>{e.t+=1;let a=e.sprite;if("monster"===e.type){e.life>0&&!randomInteger(0,40)&&(e.theta=-Math.PI/2+randomInteger(-Math.PI/3*100,Math.PI/3*100)/100);let s=e.theta>-Math.PI/2;e.t<1/e.speed*4*3?a=s?monstersSprites2:monstersSprites2Rev:e.t<1/e.speed*8*3?a=s?monstersSprites3:monstersSprites3Rev:(e.t=0,a=s?monstersSprites:monstersSpritesRev),e.x<0&&(e.theta-=Math.PI/3),e.x+a[0].length>t.width&&(e.theta+=Math.PI/3)}a.forEach(((a,s)=>{a.forEach(((a,i)=>{let l=e.x,n=e.y,r=colorPallete[a],o=Math.ceil(l+i),h=Math.ceil(n+s);if(o<t.width&&h<t.height&&o>=0&&h>=0&&setFlatlcRgba(d.data,h,4*o,4*d.width,...r),"monster"===e.type){let t=getFlatlc(d.data,h,4*o,4*d.width);t!==colorPallete.s[0]&&t!==colorPallete.m[0]||(e.theta=Math.abs(e.theta),e.speed=10,e.life=-1,zzfx(...[.4,,e.y,,.02,.02,1,1.32,-49,,,,,.1,5.3,,,.86,.01]),gs.showHighScore||(gs.pts+=5))}}))})),"monster"===e.type&&((e.y>t.height||e.y+a.length-1<-2)&&(e.life=0),-1===e.life&&(e.theta=Math.abs(e.theta))),e.x-=e.speed*Math.cos(e.theta),e.y-=e.speed*Math.sin(e.theta)}));let b=10+s,x=40-s;i=o+s*Math.cos(bowAngle),l=h+s*Math.sin(bowAngle);let I=t.width/2,y=t.height-10;for(let e=0;e<500&&(I-=4*Math.cos(bowAngle),y-=4*Math.sin(bowAngle),I<t.width-1&&y<t.height-1&&I>=0&&y>=0);e++)setFlatlcRgba(d.data,Math.ceil(y),4*Math.ceil(I)+0,4*d.width,254,0,0,255);a.putImageData(d,0,0),["#c6a141","#7f6116"].forEach(((e,t)=>{a.strokeStyle=e,a.lineWidth=2,a.beginPath(),a.ellipse(o+t,h+t,b,x,bowAngle,Math.PI/2,-Math.PI/2),a.stroke()})),a.strokeStyle="white",[Math.PI/2,-Math.PI/2].forEach((e=>{let t=b*Math.cos(e),s=x*Math.sin(e),n=t*Math.cos(bowAngle)-s*Math.sin(bowAngle),r=t*Math.sin(bowAngle)+s*Math.cos(bowAngle);a.lineWidth=1,a.beginPath(),a.moveTo(n+o,r+h),a.lineTo(i,l),a.stroke()})),requestAnimationFrame(r)}()}))}document.getElementById("cameraSelect").addEventListener("change",(()=>{document.getElementById("startButton").disabled=!1})),document.getElementById("startButton").addEventListener("click",(()=>{document.getElementById("startButton").disabled=!0,startWebcam()})),populateCameraList()</script>