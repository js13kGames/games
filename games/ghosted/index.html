<!doctype html><title>Ghosted - js13kGames 2024</title><body style=overflow:hidden;background-color:#000><script>const m=(t,i)=>{var h=document.createElement("canvas");return h.width=t,h.height=i,h},aa=(h,s,t,e,a,r,o)=>{for(let i=t;i<t+8;++i)for(let t=s;t<s+8;++t){const s=i*e+t,n=o[r[a[h.data[4*s]/85|0]??0]??0]??[];for(let t=0;t<4;++t)h.data[4*s+t]=n[t]??255}},q=(h,s,e)=>{var a=ba;if(void 0!==h){var t=m(h.width,h.height),i=t.getContext("2d"),r=(i.drawImage(h,0,0),i.getImageData(0,0,h.width,h.height)),o=t.width/8|0,n=t.height/8|0,g=0;for(let i=0;i<n;++i)for(let t=0;t<o;++t)if(!(g>=s.length)){const o=(s[g]??"0000").split("").map(t=>parseInt(t,32));aa(r,8*t,8*i,h.width,o,a,e),++g}return i.putImageData(r,0,0),t}},r=(t,i,h,s,e,a,r)=>{var o=m(h,s),n=o.getContext("2d");for(n.font=i,n.textAlign="center",t=t.split("\n"),--a;0<=a;--a)for(var g of(n.fillStyle=0==a?"#ffffff":"#000000",i=0,t))n.fillText(g,h/2,a+(i+1)*e),++i;for(e=n.getImageData(0,0,h,s),g=0;g<h*s;++g)if(e.data[4*g+3]<127)e.data[4*g+3]=0;else{for(a=128<e.data[4*g]?0:1,t=0;t<3;++t)e.data[4*g+t]=r[a][t];e.data[4*g+3]=255}return n.putImageData(e,0,0),o},t=(t,i,h)=>{var s=m(t,i);return h(s.getContext("2d"),t,i),s},ba=[4,0,511,146,292,438,232,376,208,200,272,344,490,366,400,221,507,480,239,339,485,502,93,383],ca="1042 1043 1452 1452 1452 1453 10BC 10BC 1042 1043 1452 1453 1452 1453 10A9 10A9 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1067 1000 1000 1000 1000 10BC 10B9 1080 1080 1000 1000 10EG 000A 10BC 10B9 1080 1080 10D2 10D2 100B 1067 10D2 10DF 108A 108A 10D2 10D2 1000 1000 10DF 10DF 10DF 10DF 10HG 10HG 10HG 0007 000H 000I 10EH 10EH 10HG 10HG 10HG 4052 4052 4052 10EH 10EH 10LK 10LK 10KJ 10KJ 10KL 10KJ J000 J000 10JK 10JK 100J 100J 10KL 10KJ J000 J000 10IN 10IN 10IN 10MN 100M 100M 0000 0000 10MI 10MI 10IN 10MN 100M 100M 0000 0000".split(" "),da=(i,h)=>{const s=q(h.J(1),ca,i);u(h,2,t(s.width,s.height,t=>{t.fillStyle="rgba(0,0,0,0.25)",t.fillRect(15,15,1,1),t.fillStyle="#dbdbdb",t.fillRect(2,2,12,12),t.fillStyle="#924900",t.fillRect(37,38,6,9),t.fillStyle="#ffb6db",t.fillRect(35,83,11,11),t.drawImage(s,0,0)}))},ea=(i,h)=>{const s=h.J(0),o=q(s,Array(64).fill("0002"),i),n=q(s,Array(64).fill("0001"),i);u(h,3,o),u(h,4,q(s,Array(64).fill("000G"),i)),u(h,5,n),u(h,6,t(256,64,e=>{for(let s=0;s<4;++s)for(let h=0;h<16;++h){var a=16*h+4,r=16*s+6;for(let i=-1;i<=1;++i)for(let t=-1;t<=1;++t)e.drawImage(n,8*h,8*s,8,8,a+i,r+t,8,8);e.drawImage(o,8*h,8*s,8,8,a,r,8,8)}}))},v=(i,h,s,e,a)=>{for(let t=2;0<=t;--t)i.fillRect(h-t,s-t,e+2*t,a+2*t,["#000000","#929292","#ffffff"][t])};class w{constructor(t=0,i=0){this.clone=()=>new w(this.x,this.y),this.x=t,this.y=i}get length(){return Math.hypot(this.x,this.y)}}const x=(t,i)=>((0|t)%(i|=0)+i)%i;function ia(t,i,h,s=!0){let e;s&&((e=document.createElement("div")).id="d",e.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;")),t.g=document.createElement("canvas"),t.g.setAttribute("style","position: absolute;z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;"),t.g.width=i,t.g.height=h,s&&void 0!==e&&(e.appendChild(t.g),document.body.appendChild(e)),t.D=t.g.getContext("2d"),t.D.imageSmoothingEnabled=!1,t.D.globalAlpha=1}function y(t){var i=window.innerWidth,h=window.innerHeight,s=i/h;let e,a;a=s>=t.j/t.i?(e=Math.round(s*t.i),s=t.i,h/t.i):(e=t.j,s=Math.round(t.j/s),i/t.j),e=0|Math.min(e,t.m),s=0|Math.min(s,t.l),t.g.width=e,t.g.height=s,t.g.style.width=String(e*a|0)+"px",t.g.style.height=String(s*a|0)+"px",t.g.style.left=String(i/2-a*e/2|0)+"px",t.g.style.top=String(h/2-a*s/2|0)+"px"}function z(t,i=1){t.D.globalAlpha=Math.max(0,Math.min(i,1))}function A(i,h,s,e,a){if(!((e|=0)>=(a|=0))){h=h+i.h.x|0,s=s+i.h.y|0;for(let t=-a;t<=a;++t){var r,o=t/a;(o=Math.round(Math.sqrt(1-o*o)*a))<=0||(r=0,Math.abs(t)<e&&(r=t/e,r=Math.round(Math.sqrt(1-r*r)*e)),r<=0?i.D.fillRect(h-o,s+t,2*o,1):(i.D.fillRect(h-o,s+t,o-r,1),i.D.fillRect(h+r,s+t,o-r,1)))}}}function C(t,i,h=0,s=0,e=0,a=0,r=0,o,n,g,l,c){var f;void 0!==(i=t.J?.(i))&&(o=o??i?.width??0,n=n??i?.height??0,g=g??o/2,l=l??n/2,s=s+t.h.x|0,e=e+t.h.y|0,a|=0,r|=0,o|=0,n|=0,s|=0,e|=0,t=t.D,(f=0!=h||void 0!==c)&&t.save(),0!=(1&h)&&(t.translate(o,0),t.scale(-1,1),s*=-1),0!=(2&h)&&(t.translate(0,n),t.scale(1,-1),e*=-1),void 0!==c&&(t.translate(g+s|0,l+e|0),t.rotate(-c),s=-g,e=-l),t.drawImage(i,a,r,o,n,s,e,o,n),f)&&t.restore()}function D(t,i,h,s,e,a=0,r=0,o=0){if(void 0!==(i=t.J?.(i))){var n=i.width/16|0,g=(s=s+t.h.x|0,e=e+t.h.y|0,(h.length+1)*(n+a));for(1==o?s-=g/2|0:2==o&&(s-=0|g),o=s,g=0;g<h.length;++g){var l=h.charCodeAt(g);10==l?(o=s,e+=n+r):(t.D.drawImage(i,l%16*n,((l/16|0)-2)*n,n,n,o,e,n,n),o+=n+a)}}}class ja{get width(){return this.g.width}get height(){return this.g.height}constructor(t,i=t?.width??0,h=t?.height??0,s=i,e=h,a=()=>{},r=!1){this.h=new w,this.J=()=>{},this.j=i,this.m=s,this.i=h,this.l=e,this.J=a,null!==t?(this.g=t,this.D=t.getContext("2d")):(ia(this,i,h,r),r&&(y(this),window.addEventListener("resize",()=>y(this))))}clear(t){var i=this.D;i.fillStyle=t,i.fillRect(0,0,this.width,this.height)}setColor(t="#ffffff"){this.D.fillStyle=t}fillRect(t=0,i=0,h=this.width,s=this.height,e){void 0!==e&&this.setColor(e),t=t+this.h.x|0,i=i+this.h.y|0,this.D.fillRect(t,i,0|h,0|s)}move(t,i=0){this.h.x+=t,this.h.y+=i}moveTo(t=0,i=0){this.h.x=t,this.h.y=i}}class ka{constructor(){this.h=!1,this.g=1;var t="    CONTROLS:;;ARROWS:       MOVE;ESC/ENTER:    PAUSE;R:            RESTART;BACKSPACE/Z:  UNDO".split(";");this.width=Math.max(...t.map(t=>t.length)),this.height=t.length}N(){this.h&&(this.g=0)}update(t){this.h&&this.g<=0?E(t,"ls",t):0<this.g?(this.g-=1/30*t.B)<=0&&(this.h?E(t,"ls",t):this.g=0):t.ba&&(F(t,11),this.h=!0,this.g=1)}X(t){if(t.clear("#000000"),t.moveTo(),!(this.h&&this.g<=0)){var i=0,h=0,s=7*this.width+8,e=12*this.height+8;if(0<this.g){const s=this.h?-(1-this.g):this.g;t.width>=t.height?h=t.height*s:i=t.width*s}i=t.width/2-s/2+i,h=t.height/2-e/2+h,v(t,i,h,s,e),D(t,3,"    CONTROLS:\n\nARROWS:       MOVE\nESC/ENTER:    PAUSE\nR:            RESTART\nBACKSPACE/Z:  UNDO",i+4,h+4,-1,4)}}}const G=(t,i,h)=>{i<=0||(t.setColor("rgba(0,0,0,"+String((7*(h?1-i:i)|0)/7)+")"),t.fillRect(),t.setColor())};class la{constructor(){this.g=0,this.h=!1}N(){this.h=!1,this.g=1}update(t){0<this.g?(this.g-=.05*t.B)<0&&(this.h&&E(t,"t",t),this.g=0):t.ba&&(this.g=1,this.h=!0,F(t,11))}X(t){t.clear("#000000"),D(t,3,"THANK YOU FOR PLAYING!",t.width/2,t.height/2-4,-1,0,1),G(t,this.g,this.h)}}const ma=["square","triangle","sawtooth","sine"];class na{constructor(t,i,h,s,e){this.i=0,this.j=void 0,this.h=t,this.g=Array.from(i),this.l=h,this.type=s,this.m=e,this.i=.4}play(i){const h=this.h.currentTime,s=this.h.createOscillator(),e=this.h.createGain(),a=["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime"][this.m];s.type=ma[this.type]??"square",i*=this.l;let r=this.g[2]*i,o=(s.frequency.setValueAtTime(this.g[0],h),e.gain.setValueAtTime(this.i*r,h),0);for(let t=0;t<this.g.length;t+=3){var n=this.g[t],g=this.g[t+1];r=Math.max(1e-4,Math.min(this.g[t+2]*i,1)),s.frequency[a](n,h+o),e.gain[a](r,h+o),o+=1/60*g}e.gain.exponentialRampToValueAtTime(.5*r,h+o),s.connect(e).connect(this.h.destination),s.start(h),s.stop(h+o),s.onended=()=>s.disconnect(),this.j?.disconnect(),this.j=s}}class oa{constructor(t,i){this.keys=Array.from(t),this.L=Array.from(i)}}function u(t,i,h){t.m.set(i,h)}function H(t,i,h,s=1,e=0,a=2){t.F.set(i,new na(t.l,h,s,e,a))}function E(t,i,h){(i=t.H.get(i))?.N?.(t.g?.ca?.(),h),t.g=i??t.g}function F(t,i,h=.6){if(t.j)try{t.F.get(i)?.play(.6*h)}catch(t){}}function I(t,i,h){t.keys.get(i)!==h-2&&(t.keys.set(i,h),t.h||(t.h=!!(1&h)))}function K(t,i,h){t.L.get(i)!==h-2&&(t.L.set(i,h),t.h||(t.h=!!(1&h)))}function L(t){for(var i of t.keys.keys()){var h=t.keys.get(i)??0;1<h&&t.keys.set(i,h-2)}for(const s of t.L.keys())1<(i=t.L.get(s)??0)&&t.L.set(s,i-2);t.h=!1}function M(t,i,h,s=[]){t.actions.set(i,new oa(h,s)),t.A.push(...h),t.C.push(...s)}function N(t,i){if(void 0!==(i=t.actions.get(i))){for(var h of i.keys){const i=t.keys.get(h)??0;if(0!=i)return i}for(const s of i.L)if(0!=(h=t.L.get(s)??0))return h}return 0}function O(t,i,h){++t.i;const s=new Image;s.onload=()=>{++t.u,t.m.set(i,s)},s.src=h}function pa(t){t.l=new AudioContext;try{t.l.resume()}catch(t){}}function P(t,i,h,s=!1){t.H.set(i,h),void 0!==t.g&&!s||(t.g=h)}class qa{get ba(){return this.h}constructor(){this.B=1,this.h=!1,this.i=this.u=0,this.g=this.l=void 0,this.loaded=()=>this.u>=this.i,this.K=()=>0==this.i?1:this.u/this.i,this.ia=()=>{this.j=!this.j},this.Y=()=>"AUDIO: "+(this.j?"ON ":"OFF"),this.keys=new Map,this.A=[],this.L=new Map,this.C=[],this.actions=new Map,window.addEventListener("keydown",t=>{(this.A.includes(t.code)||this.C.includes(t.key))&&t.preventDefault(),I(this,t.code,3),K(this,t.key,3)}),window.addEventListener("keyup",t=>{(this.A.includes(t.code)||this.C.includes(t.key))&&t.preventDefault(),I(this,t.code,2),K(this,t.key,2)}),window.addEventListener("mousedown",()=>{window.focus()}),window.addEventListener("mousemove",()=>{window.focus()}),window.addEventListener("contextmenu",t=>t.preventDefault()),this.m=new Map,this.F=new Map,this.j=!0,this.H=new Map}J(t){return this.m.get(t)}}function Q(t,i){for(const h in t=Array.from(t.g))i.includes(t[h])||(t[h]=0);return t}class ra{constructor(h){this.width=parseInt(h[0])+2,this.height=parseInt(h[1])+2,h=h.substring(2).split("").map(t=>parseInt(t,32)),this.g=Array(this.width*this.height).fill(1);let s=0;for(let i=1;i<this.height-1;++i)for(let t=1;t<this.width-1;++t)this.g[i*this.width+t]=h[s++]}G(t,i,h=0){return t<0||i<0||t>=this.width||i>=this.height?h:this.g[i*this.width+t]}aa(h){for(let i=0;i<this.height;++i)for(let t=0;t<this.width;++t){var s=i*this.width+t;h(this.g[s],t,i,s)}}}const sa="65700107400300240131011107030040 56700001030200107551113040000107 65012617706600045010664636701007 65200167113036700604061101060608 66783417411030630415406016361615700320 567430701B3B0161200000B09107B067 6571CB7C40C02013C0900560BB70C4B7 750007008BB6BBBB03C1090CC0051195002C7 660DDD57E1BB35E17B39E11G11CFFF6720DD06 667001B7CCC55B0303010F11081001117D2D49 667BDD0HBBFF5D00E01110E0F50660F5267619 76H18005H00F5FF0011EGBB5100FB7E1011117324DD9 86BHB8B8195B50BB16158EGGGG0E11020361C3D037917C3D60".split(" "),ta=(h,s,e,a,t)=>{h.setColor("#dbdbdb");for(let i=0;i<2*t;++i)for(let t=0;t<2*a;++t){var r,o=e[i*a*2+t]-1;0<=o&&(r=o%4,o=o/4|0,z(h,.25),C(h,2,0,8*t,8*i,8*r,32+8*o,8,8),z(h)),-2!=(r=s[i*a*2+t]-1)&&(-1==r?h.fillRect(8*t,8*i,8,8):C(h,2,0,8*t,8*i,r%6*8,8*(r/6|0),8,8))}},ua=[1,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],va=[2,3],wa=[1,11],xa=[6,9,17];function R(t,i,h,s,e,a=0){i<0||i>=t.v.length||h<0||s<0||h>=t.width||s>=t.height||(t.v[i][s*t.width+h]=31&e|a<<5)}function S(i,h,s){for(let t=0;t<i.v[0].length;++t){var e;0==i.v[1][t]&&((e=i.v[0][t])==h?i.v[0][t]=s:e==s&&(i.v[0][t]=h))}}class T{constructor(t,i){this.s=13,this.v=Array(2),void 0!==t?(this.s=t.s,this.width=t.width,this.height=t.height,this.v[0]=Array.from(t.v[0]),this.v[1]=Array.from(t.v[1])):(this.width=i.width,this.height=i.height,this.v[0]=Q(i,ua),this.v[1]=Q(i,va))}G(t,i,h){return t<0||t>=this.v.length||i<0||h<0||i>=this.width||h>=this.height?0:31&this.v[t][h*this.width+i]}aa(h){for(let i=0;i<this.height;++i)for(let t=0;t<this.width;++t)h(this.v[0][i*this.width+t],this.v[1][i*this.width+t],t,i)}}const ya=[6,9,17];class za{constructor(){this.g=new w,this.O=0}update(t){this.O=Math.max(0,this.O-=1/24*t.B)}M(t){this.O<=0||C(t,2,0,this.g.x-4,this.g.y-4,24+8*(3*(1-this.O)|0),72,8,8)}}const U=t=>new w([0,1,0,-1,0][t]??0,[0,0,-1,0,1][t]??0);function Aa(t){t.j=0,t.I=!1,t.h=0,t.target=t.g.clone(),t.o.x=16*t.g.x,t.o.y=16*t.g.y,t.active=!1}class V{constructor(t,i,h,s){this.h=0,this.direction=4,this.active=!0,this.u=this.j=this.l=0,this.i=this.m=this.I=!1,this.g=new w(i,h),this.target=this.g.clone(),this.o=new w(16*i,16*h),this.type=t,this.C=Array(8).fill(void 0).map(()=>new za),this.A=s}moveTo(t,i,h,s){var e=3==this.type||t.s<=0||this.i&&4!=t.G(0,i,h),a=t.G(0,i,h);return!(0!=t.G(1,i,h)||!e&&4==a||e&&xa.includes(a)||wa.includes(a)||(R(t,1,this.g.x,this.g.y,0),this.active&&2==this.type&&(e=t.s<=0,a=t.G(0,this.g.x,this.g.y),e||5!=a||(R(t,0,this.g.x,this.g.y,4),this.A(1,this.g.x,this.g.y),F(s,3)),e)&&0==a&&(R(t,0,this.g.x,this.g.y,6),this.A(3,this.g.x,this.g.y),F(s,4)),this.h=0,this.I=!0,this.target=new w(i,h),this.m=!1,2==this.type&&ya.includes(t.G(0,i,h))&&(this.m=!0,F(s,6)),3==this.type&&F(s,0),0))}move(t,i,h){this.I&&(1<=(this.h+=i*h.B)&&(this.h=0,this.I=!1,this.g=this.target.clone(),R(t,1,this.g.x,this.g.y,this.type,this.direction)),this.o.x=16*((1-this.h)*this.g.x+this.h*this.target.x),this.o.y=16*((1-this.h)*this.g.y+this.h*this.target.y))}control(t,i,h=!1){if(!this.active||this.I)return!1;var s,e=3==this.type;if(2!=this.type&&!e)return!1;if(s=!h&&!(2==this.type&&t.s<=0)&&13<=(s=t.G(0,this.g.x,this.g.y))&&s<=16?s-13+1:0,this.i=0!=s,!this.i)for(var a=0;a<4;++a)if(0!=(1&N(i,a))){s=a+1;break}return a=U(s),!(!this.i&&e&&(t.s<=0||2!=t.G(1,this.g.x-a.x,this.g.y-a.y)))&&0!=s&&(this.direction=s,(e=this.moveTo(t,this.g.x+a.x,this.g.y+a.y,i))||!this.i||h?e:this.control(t,i,!0))}update(t,i,h){if(this.active){if(!(2!=this.type||t.s<=0)){for(var s of this.C)s.update(h);if(!this.i&&!this.m&&this.I&&8<=(this.u+=h.B))for(var e of(this.u-=8,this.C))if(e.O<=0){s=U(this.direction),e.g=new w(this.o.x+8-6*s.x,this.o.y+8-4*s.y),e.O=1;break}}this.move(t,i,h),this.l=(this.l+.016666666666666666*h.B)%1}else 0<this.j&&(this.j-=h.B)}F(t,i){if(!(2!=this.type||i.s<=0))for(var h of this.C)h.M(t)}M(t,i){if(this.active)switch(this.type){case 2:var h,s,e,a;i.s<=0?(i=[6,0,-4,0],h=[0,0,0,1],s=this.o.y-7+Math.round(Math.sin(this.l*Math.PI*2)),C(t,2,0,this.o.x,s,0,48,16,16),2!=this.direction&&C(t,2,0,this.o.x+4+i[this.direction-1],s+h[this.direction-1]+5,16+(3==this.direction?2:0),40,4==this.direction?8:6,8)):(i=this.o.y-6,h=(2*this.h|0)+2*Number(this.g.x%2==this.g.y%2),this.i?h=0:this.I&&this.m&&(i-=4*Math.sin(this.h*Math.PI),h=3),0==this.direction%2?(s=Number(3==h),a=1-(this.direction/3|0),C(t,2,s,this.o.x,i+(e=h%2),0,16+8*a,16,8),C(t,2,s,this.o.x,i+8,32+h%2*16,16,16,8),t.fillRect(this.o.x+6,i+9+e-2*a,4,1,"#000000")):(C(t,2,s=Number(3==this.direction),this.o.x,i+h%2,16,16,16,8),C(t,2,s,this.o.x,i+8,16+16*[0,1,0,2][h],24,16,8)));break;case 3:C(t,2,0,this.o.x,this.o.y-1,32,32,16,16);break;case 7:s=[12,8,4,8][h=(8*this.l|0)%4],e=this.o.x+8-s/2,0<i.s&&z(t,.33),C(t,2,Number(3==h),e,this.o.y-3+Math.round(Math.sin(this.l*Math.PI*2+Number(this.g.x%2==this.g.y%2)*Math.PI)),[0,12,20,12][h],64,s,12),z(t);break;case 8:0<i.s&&z(t,.33),i=this.o.y-5+Math.round(Math.sin(this.l*Math.PI*2+Number(this.g.x%2==this.g.y%2)*Math.PI)),C(t,2,0,this.o.x,i,48,64,16,16),C(t,2,0,this.o.x,i,16,48,16,8),z(t)}else 0<this.j&&7==this.type&&(i=1-this.j/12,t.setColor("#ff9200"),A(t,this.o.x+8,this.o.y+9,9*i,2+10*i),t.setColor("#ffff49"),A(t,this.o.x+7,this.o.y+8,10*i,2+10*i))}setPosition(t,i,h=4){this.g=new w(t,i),this.target=this.g.clone(),this.direction=0==h?4:h,this.o.x=16*this.g.x,this.o.y=16*this.g.y,this.active=!0}W(t,i){var h;return!!this.active&&(h=t.G(0,this.g.x,this.g.y),3==this.type&&4==h&&(this.active=!1,R(t,0,this.g.x,this.g.y,0),R(t,1,this.g.x,this.g.y,0),this.A(2,this.g.x,this.g.y),F(i,1,.6)),2==this.type&&0<t.s&&(6==h||9==h||17==h)&&(R(t,0,this.g.x,this.g.y,6==h?0:h+1),6==h?this.A(4,this.g.x,this.g.y):9==h?S(t,11,12):17==h&&(S(t,13,15),S(t,14,16)),F(i,2)),2==this.type&&t.s<=0&&7==h?(R(t,0,this.g.x,this.g.y,0),F(i,5),!0):(7!=this.type&&8!=this.type||h==this.type||(--this.o.y,this.active=!1,this.j=12),2==this.type&&t.s<=0&&8==h&&(R(t,0,this.g.x,this.g.y,0),F(i,5),t.s=14,!0)))}}class W{constructor(t,i){this.evaluate=t=>this.g(t,this),this.text=t,this.g=i}clone(){return new W(this.text,this.g)}}function X(t,i=t.g){t.g=x(i,t.buttons.length),t.active=!0}class Y{constructor(h,t=!1){this.g=0,this.active=!1,this.buttons=h.map((t,i)=>h[i].clone()),this.active=t,this.width=Math.max(...this.buttons.map(t=>t.text.length+2)),this.height=this.buttons.length}update(t,i=!1){this.active&&(i&&3==N(t,8)?(F(t,12),this.active=!1):(i=this.g,3==N(t,1)?--this.g:3==N(t,3)&&++this.g,i!=this.g&&(this.g=x(this.g,this.buttons.length),F(t,8)),3==N(t,4)&&(this.buttons[this.g].evaluate(t)&&(this.active=!1),F(t,11))))}M(t,i=0,h=0,s=!1){if(this.active)for(s&&(t.setColor("rgba(0,0,0,0.5)"),t.fillRect()),i=t.width/2-4*this.width+i,h=t.height/2-12*this.height/2+h,v(t,i,h,8*this.width,12*this.height),s=0;s<this.buttons.length;++s)D(t,3+Number(s==this.g),(s==this.g?"$%":"")+this.buttons[s].text,i+2,h+2+12*s,-1)}}const Ba=()=>{var i=Array(12).fill(!1);try{var h=(window.localStorage.getItem("jn2024_2")??"").split("").map(t=>1==Number(t));for(let t=0;t<h.length;++t)i[t]=h[t]}catch(i){}return i},Z=t=>{try{var i=t.map(t=>String(Number(t))).join("");window.localStorage.setItem("jn2024_2",i)}catch(t){}},Ca=[7,8],Da=[2,3];function Ea(t){if(t.H&&t.i.push(new T(t.i[t.i.length-1])),!(t.i.length<2)){var i=t.i[t.i.length-2],h=t.g;for(let t=0;t<i.width*i.height;++t)h.v[0][t]=i.v[0][t],h.v[1][t]=i.v[1][t];h.s=i.s,t.i.pop(),Fa(t)}}function Ga(t){t.g=new T(void 0,t.C),13==t.m&&(t.g.s=0),Fa(t),t.i.push(new T(t.g))}function Ha(e){e.g.aa((t,i,h,s)=>{Ca.includes(t)&&e.h.push(new V(t,h,s,e.fa)),Da.includes(i)&&(2==(t=new V(i,h,s,e.fa)).type&&(e.u=t),e.h.push(t))})}function Fa(a){a.H=!1,a.l=0,a.j=0,a.j=0;for(var t of a.h)Aa(t);const r=Array(a.h.length).fill(!1),o=Array(a.h.length).fill(!1);a.g.aa((t,i,h,s)=>{for(var e=0;e<a.h.length;++e){const r=a.h[e];if(!o[e]&&(31&t)==r.type){o[e]=!0,r.setPosition(h,s,t>>5);break}}for(t=0;t<a.h.length;++t)if(e=a.h[t],!r[t]&&(31&i)==e.type){r[t]=!0,e.setPosition(h,s,i>>5);break}})}function Ia(h,s){var e=13==h.m,a=(s.clear(e?"#b6b6b6":"#4992db"),s.setColor(e?"#929292":"#246db6"),e=1+((s.width/32+1)/2|0),1+((s.height/32+1)/2|0));for(let i=-a-1;i<=a;++i)for(let t=-e-1;t<=e;++t)(i+2*a)%2!=(t+2*e)%2&&s.fillRect(s.width/2-32*t-h.T,s.height/2-32*i+h.T,32,32)}function Ja(i,h){z(h,.25),h.setColor("#000000"),h.fillRect(-2,4,16*i.width+13,16*i.height+12),C(h,2,0,16*i.width+7,-1,16,32,5,5),C(h,2,0,-7,16*i.height+12,24,32,5,5),z(h),h.fillRect(-2,-2,16*i.width+4,16*i.height+4,"#924900");for(var s=-1;s<2*i.width+1;++s){var e=-1==s||s==2*i.width;for(let t=0;t<2;++t)C(h,2,Number(s==2*i.width)|Number(2*t),8*s+Number(s<0),t*(16*i.height+6)-7,e?49:56,0,8-Number(e),8);C(h,2,Number(s==2*i.width),8*s,16*i.height+6,e?48:56,8,8,8)}for(s=0;s<2*i.height;++s)for(e=0;e<2;++e)C(h,2,e,e*(16*i.width+6)-7,8*s,56,0,8,8,4,4,Math.PI/2)}function Ka(h,s){s.fillRect(8,8,16*(h.width-1),16*(h.height-1),"#000000");for(let i=1;i<h.height-1;++i)for(let t=1;t<h.width-1;++t){var e=h.g.G(0,t,i),a=16*t,r=16*i;if(s.fillRect(16*t,16*i,16,16,t%2==i%2?"#ffdb92":"#dbb66d"),!(0<h.l&&t==h.P.x&&i==h.P.y))switch(e){case 4:C(s,2,0,a,r,48,32,16,16);break;case 5:C(s,2,0,4+a,4+r,24,40,8,8);break;case 6:C(s,2,0,a,r,32,48,16,16);break;case 9:case 10:C(s,2,0,a,r,16*(e-9),80,16,16);break;case 11:case 12:C(s,2,0,a,r,32+16*(e-11),80,16,16);break;case 13:case 14:case 15:case 16:var o=e%2,n=(e-10)*Math.PI/2,g=(h.$/.5|0)%2;for(let t=0;t<2;++t)C(s,2,2*Number(15==e)+Number(16==e),a+o*(8*t-4),r+(1-o)*t*8+4*o,0,96+(t+g)%2*8,16,8,8,4,n);break;case 17:case 18:C(s,2,0,a,r,16+16*(e-17),96,16,16)}}}function La(t,i){var h=[24,48,56,48],s=[40,48,48,32];if(!(t.l<=0)){var e=16*t.P.x,a=16*t.P.y,r=1-t.l;switch(t.ea){case 1:C(i,2,0,4+e,4+a,h[t=Math.min(2,3*r|0)],s[t],8,8);break;case 2:C(i,2,0,e+(16-(r=3==(t=Math.max(1,Math.ceil(3*t.l)))?16:8))/2,a+(16-r)/2,h[t],s[t],r,r);break;case 3:0!=(h=Math.min(2,3*(1-t.l)|0))&&C(i,2,0,4+e,4+a,48+8*(h-1),56,8,8);break;case 4:.5<r||(i.setColor("#6d6db6"),A(i,8+e,8+a,16*r,2+16*r))}}}function Ma(t,i){var h,s;D(i,6,13==t.m?"NIGHTMARE":"STAGE "+String(t.m),i.width/2,i.height-19,-8,0,1),0==(t.j/4|0)%2&&(h=i.width/2+4,t.g.s<=0?D(i,6,"SPOOKY!",h,2,-8,0,1):(D(i,6,"#",h-22,2),t.A<=0||!t.u.I||t.u.i?D(i,6,String(t.g.s),h,2,-8,0,1):(s=1-t.A,z(i,t.A),D(i,6,String(t.g.s),h,2+8*s,-8,0,1),z(i,s),D(i,6,String(t.g.s-1),h,2-8*t.A,-8,0,1),z(i))))}function Na(i,h){if(!(i.j<=0)){var s=32*(1-i.j/24),e=(i.j/2|0)%3,a=i.u.o.x+8,r=(i=i.u.o.y+8,2*Math.PI/6);for(let t=0;t<6;++t){var o=r*(t+.5);C(h,2,0,a+Math.cos(o)*s-4,i+Math.sin(o)*s-4,24+8*e,64,8,8)}}}function Oa(i,h){h.fillRect(0,0,h.width,h.height,"rgba(0,0,0,0.50)");var s=h.J(7),e=h.width/2-s.width/2,s=h.height/2-s.height/2;if(30<=i.K)C(h,7,0,e,s);else{i=1-i.K/30;var a=h.J(7);if(void 0!==a){var r=1+4*i;for(let t=0;t<a.height;++t)h.D.drawImage(a,0,t,a.width,1,Math.round(e+32*Math.sin(8*Math.PI/a.height*t+4*i*Math.PI)*i),Math.round(s+t*r-4*a.height*i/2),a.width,1)}}}class Pa{constructor(t){this.g=this.ga=this.ha=this.C=void 0,this.height=this.width=0,this.u=void 0,this.H=!1,this.l=this.ea=0,this.P=new w(0,0),this.da=!0,this.F=this.V=this.T=this.$=this.A=this.j=0,this.S=!1,this.m=0,this.R=!1,this.K=0,this.fa=(t,i,h)=>{this.P.x=i,this.P.y=h,this.ea=t,this.l=1,this.da=4!=t},this.Z=t,this.i=[],this.h=[],this.U=new Y([new W("RESUME",()=>!0),new W("UNDO",()=>(Ea(this),!0)),new W("RESTART",()=>(Ga(this),!0)),new W("AUDIO: ON",(t,i)=>(t.ia(),i.text=t.Y(),!1)),new W("QUIT",()=>(this.F=1,this.S=!0))],!1)}W(t){let i=!1;for(var h of this.h)i=h.W(this.g,t)||i;if(i)for(var s of this.h)s.W(this.g,t)}N(t){this.m=t??1;var h=this.C=new ra(sa[this.m-1]),s=Array(h.width*h.height*4).fill(-1),e=Array(h.width*h.height*4).fill(0);for(let i=0;i<h.height;++i)for(let t=0;t<h.width;++t){var a=t,r=i,o=h,n=Array(9);for(let i=-1;i<=1;++i)for(let t=-1;t<=1;++t)n[3*(i+1)+(t+1)]=1==o.G(a+t,r+i,1);r=n,1!=h.G(t,i)?(a=e,n=i*(o=h).width*4+2*t,r[0]?(a[n]=2,r[1]&&r[3]?a[n]=1:r[1]||r[3]?r[1]||(a[n]=5):a[n]=6):r[1]&&r[3]?a[n]=1:!r[1]&&r[3]?a[n]=3:!r[3]&&r[1]&&(a[n]=4),r[1]&&(a[n+1]=2),r[3]&&(a[n+2*o.width]=5)):((a=s)[n=i*(o=h).width*4+2*t]=0,r[1]&&r[3]?r[0]||(a[n]=5):r[a[n]=1]?a[n]=4:r[3]&&(a[n]=3),a[++n]=0,r[1]&&r[5]?r[2]||(a[n]=6):(a[n]=2,r[1]?a[n]=10:r[5]&&(a[n]=3)),a[n+=2*o.width-1]=0,r[7]&&r[3]?r[6]||(a[n]=11):r[a[n]=7]?a[n]=4:r[3]&&(a[n]=9),a[++n]=0,r[7]&&r[5]?r[8]||(a[n]=12):(a[n]=8,r[7]?a[n]=10:r[5]&&(a[n]=9)))}[this.ha,this.ga]=[s,e],this.width=this.C.width,this.height=this.C.height,this.i.length=0,this.h.length=0,this.i.push(new T(void 0,this.C)),13==this.m&&(this.i[0].s=0),this.g=new T(this.i[0]),this.h.length=0,Ha(this),this.H=!1,this.V=this.T=this.A=this.l=this.j=0,13===t&&(this.V=30),this.F=1,this.R=this.S=!1,this.K=0}update(t){var i=1/60;if(0<this.F)(this.F-=.05*t.B)<0&&(this.S&&E(t,13==this.m&&this.R?"e":"ls",t),this.F=0);else if(this.R){for(var h of this.h)h.update(this.g,.0625,t);if(this.K+=t.B,90<=this.K){if(i=13!=this.m)t:{for(i=0;i<12;++i)if(!this.Z[i]){i=!1;break t}i=!0}i?(F(t,14),this.N(13,t)):(this.S=!0,this.F=1)}}else if(this.U.active)this.U.update(t,!0);else if(3==N(t,5))F(t,12),this.U.buttons[3].text=t.Y(),X(this.U,0);else if(3==N(t,7))F(t,8),Ea(this);else{3==N(t,6)&&(F(t,9),Ga(this));var s,e=!1,h=this.u.I;if(this.j<=0&&(this.l<=0||!this.da))do{var a,r=!1;for(a of this.h){const i=a.control(this.g,t);r=i||r,i&&2!=a.type&&(e=!0)}}while(r&&(this.A=1),r);for(s of(!h&&this.u.I&&!this.u.m&&!e&&0<this.g.s&&F(t,10),a=this.H,this.H=!1,this.h))s.update(this.g,.0625,t),this.H=s.I||this.H;if(a&&!this.H){this.A=0,this.W(t),s=this.g.s,h&&!this.u.i&&(this.g.s=Math.max(0,this.g.s-1)),1==s&&0==this.g.s&&(this.j=24,F(t,7)),0<s&&0==this.g.s&&this.W(t),this.u.i||(this.i.push(new T(this.g)),64<=this.i.length&&this.i.shift()),13==this.g.s&&(this.j=24,F(t,7));t:{for(o of this.g.v[0])if(7==o){var o=!1;break t}o=!0}(this.R=o)&&(F(t,13),this.Z[this.m-1]=!0,Z(this.Z))}0<this.l&&(this.l-=.0625*t.B),0<this.j&&(this.j-=t.B),0<this.A&&(this.A-=.0625*t.B),this.$=(this.$+i*t.B)%1,13==this.m&&(this.T=(this.T+.5*t.B)%32),this.V=Math.max(0,this.V-t.B)}}X(t){Ia(this,t),t.moveTo(t.width/2-8*this.C.width,t.height/2-8*this.C.height),0<this.V&&t.move((5*Math.random()|0)-2,(5*Math.random()|0)-2),Ja(this,t),Ka(this,t),ta(t,this.ha,this.ga,this.C.width,this.C.height),La(this,t),this.h.sort((t,i)=>t.o.y-i.o.y),z(t,.25);for(var i of this.h)if(i.active)switch(i.type){case 2:case 7:case 8:C(t,2,0,i.o.x,i.o.y+6,16,56,16,8)}z(t),this.u?.F(t,this.g);for(var h of this.h)h.M(t,this.g);Na(this,t),t.moveTo(),Ma(this,t),this.U.M(t,0,0,!0),this.R&&Oa(this,t),G(t,this.F,this.S)}ca(){return Number(this.R)}}const Qa=["#000000","#924900","#ffb66d","#db6d00"],Ra=["#000000","#db9200","#ffffdb","#ffdb6d"],Sa=[0,0,1,2],Ta=[0,0,-1,-1];class Ua{constructor(t){this.h=new w,this.l=1,this.g=0,this.i=!1,this.j=0,this.m=!1,this.u=t}N(t){this.i=this.m=!1,this.g=1,this.j=0,1===t&&(this.u[this.l-1]=!0)}update(t){var i,h=1/120;0<this.g?(this.g-=.05*t.B)<0&&(this.i&&E(t,this.m?"t":"g",t),this.g=0):3==N(t,8)?(F(t,11),this.g=1,this.m=this.i=!0):(this.j=(this.j+h*t.B)%1,this.l=1+4*this.h.y+this.h.x,3==N(t,4)?(F(t,11),this.g=1,this.i=!0):(3==N(t,i=h=0)?h=1:3==N(t,2)&&(h=-1),3==N(t,3)?i=1:3==N(t,1)&&(i=-1),0==h&&0==i||(F(t,8),this.h.x=x(this.h.x+h,4),this.h.y=x(this.h.y+i,3))))}X(h){h.moveTo(),h.clear("#246db6");const s=h.width/2-82,e=h.height/2-48;for(let i=0;i<3;++i)for(let t=0;t<4;++t){var a=h,r=1+4*i+t,o=s+44*t,n=e+36*i,g=this.l==r,l=!0===this.u[r-1]?Ra:Qa;a.fillRect(o+(g?1:3),n+(g?6:8),32,23,"rgba(0,0,0,0.25)"),g||(z(a,.25),C(a,2,0,o+32,n+3,16,32,5,5),C(a,2,0,o-1,n+24+4,24,32,4,5),z(a));for(let h=0;h<4;++h){const s=o+h+Ta[h],e=32-2*h+Sa[h];let t=n+h+Ta[h]+4,i=24-2*h+Sa[h];g||(t-=4,h<2&&(i+=4)),a.fillRect(s,t,e,i,l[h])}D(a,6,String(r),o+16-1,n+12-10+(g?4:0),-9,0,1),g&&(r=o+16-8,o=n+12-12-Math.abs(6*Math.sin(6*this.j*Math.PI)),z(a,.25),C(a,2,0,r,n+12,16,56,16,8),z(a),C(a,2,0,r,o,0,16,16,8),C(a,2,0,r,o+8,32,16,16,8),a.fillRect(6+r,o+9,4,1,"#000000"))}D(h,6,"SELECT LEVEL",h.width/2,2,-8,0,1),G(h,this.g,this.i)}ca(){return this.l}}function Va(t,i){i.clear("#000000"),t=t.g.K();var h=i.width/2-40,s=i.height/2-6;i.fillRect(h,s,80,12,"#ffffff"),i.fillRect(1+h,1+s,78,10,"#000000"),i.fillRect(2+h,2+s,76*t,8,"#ffffff")}function Wa(i,t,h,s){var e=1e3/60,a=i.g.loaded();for(i.h=Math.min(i.h+(t-i.l),5*e),i.l=t,t=!0;i.h>=e;i.h-=e){if(i.i&&i.g.g?.update(i.g),a&&!i.i&&i.g.ba){i.i=!0,pa(i.g),s(i.g),i.g.g?.N?.(void 0,i.g),L(i.g);break}t&&(L(i.g),t=!1)}a?i.i?i.g.g?.X(i.j):h(i.j):Va(i,i.j),window.requestAnimationFrame(t=>Wa(i,t,h,s))}class Xa{constructor(){this.l=this.h=0,this.i=!1,this.j=new ja(null,192,192,576,576,t=>this.g.J(t),!0),this.g=new qa}}class Ya{constructor(t){this.g=0,this.j=!1,this.i=1,this.h=0,this.l=1,this.A=t,this.u=new Y([new W("START GAME",()=>(this.j=!0,!(this.g=1))),new W("AUDIO: ON ",(t,i)=>(t.ia(),i.text=t.Y(),!1)),new W("DELETE DATA",()=>(X(this.m,1),!1))],!0),this.m=new Y([new W("YES",()=>(this.A.fill(!1),Z(this.A),!0)),new W("NO",()=>!0)])}N(t,i){this.g=1,this.j=!1,this.u.buttons[1].text=i.Y()}update(t){if(1<this.h&&(this.i=(this.i+1/60*t.B)%1,0<this.l))this.g=Math.max(0,this.g-.016666666666666666*t.B),this.l-=.011111111111111112*t.B;else if(0<this.g){if((this.g-=.03333333333333333*t.B)<0){if(this.j){if(this.h<2)return 2==++this.h&&F(t,15),this.j=!1,void(this.g=1);E(t,"c",t)}this.g=0}}else this.h<2&&45<=(this.i+=t.B)?(this.i=0,this.g=1,this.j=!0):2==this.h&&3==N(t,4)?(this.h=3,F(t,12)):3==this.h&&(this.m.active?this.m.update(t):this.u.update(t,!1))}X(i){if(i.moveTo(),i.clear("#000000"),this.h<2)D(i,3,0==this.h?"A GAME BY":"MADE FOR",i.width/2,i.height/2-10,-1,0,1),D(i,3,0==this.h?"JANI NYK@NEN":"JS13K 2024",i.width/2,i.height/2+2,-1,0,1);else{var h=i.J(8),s=i.width/2-h.width/2;for(let t=0;t<h.height;++t){var e=(e=(t-14-h.height/2)/(h.height/2))*e*Math.sign(e);C(i,8,0,s+Math.sin((t/24+this.i)*Math.PI*2)*(2+1024*this.l*e),16+t+1024*this.l*e,0,t,h.width,1)}0<this.l||(3==this.h?this.m.active?(D(i,3,"CLEAR PROGRESS?",i.width/2,i.height/2+8,-1,0,1),this.m.M(i,0,40)):this.u.M(i,0,32,!1):this.i<.5&&D(i,4,"PRESS ENTER OR SPACE",i.width/2,i.height/2+32,-1,0,1),D(i,3,"*2024 JANI NYK@NEN",i.width/2,i.height-12,-1,0,1))}G(i,this.g,this.j)}ca(){}}const Za=t=>{t.clear("#000000"),D(t,0,"PRESS ANY KEY",t.width/2,t.height/2-4,-1,0,1)},$a=t=>{M(t,2,["ArrowLeft"]),M(t,0,["ArrowRight"]),M(t,1,["ArrowUp"]),M(t,3,["ArrowDown"]),M(t,4,["Space","Enter"]),M(t,5,["Escape","Enter"]),M(t,6,[],["r","R"]),M(t,7,["Backspace"],["z","Z"]),M(t,8,["Escape"]);var i=255/7,h=[];for(let t=0;t<512;++t)h[t]=[(t>>6&7)*i|0,(t>>3&7)*i|0,(7&t)*i|0,4==t?0:255];for(da(h,t),ea(h,t),u(t,7,r("STAGE\nCLEAR!","bold 22px Arial",96,48,20,3,[[182,255,0],[73,182,0]])),u(t,8,r("GHOSTED","bold 32px Arial",192,64,56,6,[[255,182,0],[219,109,0]])),H(t,0,[96,6,1,80,4,.2],.6,2,2),H(t,1,[256,4,1,192,6,.7,160,12,.2],1.15,1,2),H(t,2,[96,3,.6,128,5,1,160,12,.2],.4,0,2),H(t,3,[160,12,1,192,6,.7,256,4,.2],1.15,1,2),H(t,4,[224,2,.7,160,3,1,144,6,.2],1.25,1,2),H(t,5,[160,4,.6,100,2,.8,256,8,1],.35,0,0),H(t,6,[64,4,.2,160,3,.8,256,2,.5],.8,2,2),H(t,7,[96,3,.5,128,4,.75,192,6,1,256,8,.6],.4,0,2),H(t,8,[128,5,1,96,3,.5],.4,2,0),H(t,9,[160,8,1,128,6,.3],.4,0,0),H(t,10,[160,2,1,96,1,.5],.6,2,2),i=0;i<2;++i)H(t,11+i,[128-8*i,8+2*i,1,96-8*i,4,.2],.3-.05*i,0,0);H(t,14,[112,4,.5,160,4,1,112,5,1,160,5,1,112,6,1,112,8,.8,160,8,.8,192,32,.5],.35,0,2),H(t,13,[130.81,15,.5,164.81,7.5,.7,146.83,7.5,1,174.61,7.5,1,164.81,7.5,1,196,15,1,220,30,.8],.35,0,0),H(t,15,[130.81,7.5,.2,146.83,7.5,.5,164.81,7.5,.7,146.83,7.5,1,130.81,7.5,1,146.83,7.5,1,164.81,7.5,1,174.61,30,.5],1.25,1,2),F(t,11)};var a=new Xa,b=a.g;const c=Ba();O(b,0,"f.png"),O(b,1,"g.png"),P(b,"t",new Ya(c),!0),P(b,"c",new ka),P(b,"ls",new Ua(c)),P(b,"g",new Pa(c)),P(b,"e",new la),Wa(a,0,Za,$a)</script>