<!doctype html><title>Mini Merchant - js13kGames 2023</title><style>#c2d{width:min(100vw,calc(100vh * 16/9));position:absolute}body,html{cursor:none;margin:0;background-color:#232b2b;display:flex;justify-content:center;align-items:center;height:100%}</style><canvas height=720 id=c2d width=1280></canvas><script>let N=(t,e)=>[32*t,32*e],r=(t,e)=>[Math.floor(t/32),Math.floor(e/32)],h=[480,128],R={x:h[0],y:h[1],w:384,l:288},G={"14,5":1,"14,10":1,"19,3":-1,"20,3":-1,"27,11":2},J=[0,120,240,300].map(t=>1e3*t),H=[40,35,30,30].map(t=>1e3*t),W=[23,18,15,10].map(t=>1e3*t),Y=t=>t<0?-Math.exp(.5*Math.log(-1*t)):Math.exp(.5*Math.log(t));class u{constructor(t,e){this.x=t,this.y=e,this.l=this.V=0,this.parent=null}get f(){return this.V+this.l}}let c=(t,e)=>Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1]),K=()=>{var t=window.localStorage.getItem("rndd_mm_gameData");return t?JSON.parse(t):null};class t{}class e{}class ${constructor(){this.map=new Map}add(t){this.map.set(t.constructor,t)}get(t){return this.map.get(t)}has(t){return this.map.has(t)}la(t){for(var e of t)if(!this.map.has(e))return!1;return!0}delete(t){this.map.delete(t)}}function o(t,e,s){for(var h of(t.h.get(e).add(s),t.i.keys()))U(t,e,h)}function f(t,e){return t.h.get(e)}function U(t,e,s){var h=t.h.get(e),i=s.v;h?.la(i)?(t.i.get(s).add(e),s.C&&s.C(e,h)):(t.i.get(s).delete(e),s.J&&s.J(e))}function s(t,e){if(0!==e.v.size)for(var s of((e.g=t).i.set(e,new Set),t.h.keys()))U(t,s,e)}class X{constructor(){this.h=new Map,this.i=new Map,this.u=0,this.m=[],this.D=0,this.j=(()=>{let s={};return{B:(t,e)=>{s[t]||(s[t]=[]),s[t].push(e)},qa:(t,e)=>{s[t]&&(s[t]=s[t].filter(t=>t!==e))},o:(t,...e)=>{s[t]&&s[t].forEach(t=>t(...e))}}})()}C(){var t=this.u;return this.u++,this.h.set(t,new $),t}J(t){this.m.push(t)}update(){for(var[t,e]of this.i.entries())t.update(e);for(;0<this.m.length;){var s,h=this.m.pop();for(s of(this.h.delete(h),this.i.values()))s.delete(h)}}}let V=(t,{x:e,y:s,w:h,l:i})=>t.x>e&&t.x<e+h&&s<t.y&&t.y<s+i;class a extends t{constructor(t){super(),this.H=t,this.T=42e4,this.level=0}}class w extends t{constructor(t,e){super(),this.x=t,this.y=e}}class y extends t{constructor(t=0,e=0){super(),this.dx=t,this.dy=e}}class l extends t{constructor(t,e,s=!0,h=null){super(),this.P=t,this.aa=e,this.visible=s,this.$=h}}class n extends t{constructor(t){super(),this.data=t}}class x extends t{constructor(t,e=!1){super(),this.K=t,this.fa=e}}class g extends t{}class m extends t{constructor(t,e=!1,s=!1){super(),this.s=e,this.L=s}}class Z extends t{constructor(t,e=-1){super(),this.type=t,this.S=e}}class d extends t{constructor(t,e=-1){super(),this.type=t,this.oa=e}}class v extends t{constructor(t,e,s,h){super(),this.ba=t,this.size=e,this.color=s,this.P=h}}class p extends t{constructor(t={},e,s,h=-1,i=0,r=!1){super(),this.X=t,this.time=e,this.A=s,this.ka=h,this.state=i,this.ga=r}}class M extends t{constructor(t,e){super(),this.type=t,this.da=e,this.N=null}}class b extends t{constructor(t,e,s=0,h=0){super(),this.type=t,this.interval=s,this.M=h}}class S extends t{constructor(t,e=!1,s,h){super(),this.icon=t,this.Z=e,this.text=s,this.type=h,this.L=!1,this.enabled=!0}}class j extends t{constructor(){super(),this.state=0,this.I=this.A=null,this.ca=!1}}let z=(t,e)=>({x:t.x+(32-e.w)/2,y:t.y+(32-e.l)/2});class _ extends e{constructor(){super(...arguments),this.v=new Set([w,x])}update(t){for(var e of t){var s=f(this.g,e),h=s.get(y),i=s.get(x);if(h){var r,a,n,o,l,g,u,c,d=s.get(x).K,d=z(s.get(w),d);for(r of t)r!==e&&(n=(a=f(this.g,r)).get(x),o=z(a.get(w),n.K),u=i.K,l=n.K,g=d.x+u.w,u=d.y+u.l,c=o.y+l.l,l=d.x<o.x+l.w&&o.x<g&&d.y<c&&o.y<u)&&(u=a.get(y),s.get(m)?.s&&this.g.j.o(1,e,r),l=d,g=i,a=h)&&(0<a.dx&&l.x<o.x&&(a.dx*=-1,u)&&(u.dx=.5*-a.dx),a.dx<0&&l.x+g.K.w>o.x+n.K.w&&(a.dx*=-1,u)&&(u.dx=.5*-a.dx),0<a.dy&&l.y<o.y&&(a.dy*=-1,u)&&(u.dy=.5*-a.dy),a.dy<0)&&l.y+g.K.l>o.y+n.K.l&&(a.dy*=-1,u)&&(u.dy=.5*-a.dy)}}}}let q={0:[[1,8,0],[3,10,0],[4,11,0],[5,12,0],[1,13,0],[15,19,0],[15,20,0],[1,8,1],[1,9,1],[12,10,1],[13,11,1],[14,12,1],[1,13,1],[15,19,1],[15,20,1],[1,0,2],[1,1,2],[1,10,2],[1,11,2],[1,13,2],[15,19,2],[15,20,2],[15,21,2],[15,22,2],[15,23,2],[15,24,2],[15,25,2],[15,26,2],[15,27,2],[15,28,2],[15,29,2],[15,30,2],[1,0,3],[1,1,3],[1,2,3],[15,19,3],[15,20,3],[15,30,3],[1,0,4],[1,1,4],[1,2,4],[3,15,4],[4,16,4],[4,17,4],[4,18,4],[4,19,4],[4,20,4],[4,21,4],[4,22,4],[4,23,4],[5,24,4],[15,30,4],[1,0,5],[1,1,5],[15,5,5],[15,6,5],[15,7,5],[15,8,5],[15,9,5],[15,10,5],[15,11,5],[15,12,5],[15,13,5],[15,14,5],[8,15,5],[9,16,5],[9,17,5],[9,18,5],[9,19,5],[9,20,5],[9,21,5],[9,22,5],[9,23,5],[10,24,5],[3,25,5],[5,26,5],[15,30,5],[15,31,5],[3,0,6],[4,1,6],[4,2,6],[5,3,6],[15,5,6],[8,15,6],[9,16,6],[9,17,6],[9,18,6],[9,19,6],[9,20,6],[9,21,6],[9,22,6],[9,23,6],[9,24,6],[9,25,6],[10,26,6],[15,31,6],[15,32,6],[15,33,6],[15,34,6],[15,35,6],[8,0,7],[9,1,7],[9,2,7],[10,3,7],[15,5,7],[1,13,7],[8,15,7],[9,16,7],[9,17,7],[9,18,7],[9,19,7],[9,20,7],[9,21,7],[9,22,7],[9,23,7],[9,24,7],[9,25,7],[10,26,7],[15,35,7],[12,0,8],[13,1,8],[13,2,8],[14,3,8],[15,4,8],[15,5,8],[8,15,8],[9,16,8],[9,17,8],[9,18,8],[9,19,8],[9,20,8],[9,21,8],[9,22,8],[9,23,8],[9,24,8],[9,25,8],[10,26,8],[1,27,8],[1,30,8],[15,35,8],[15,5,9],[8,15,9],[9,16,9],[9,17,9],[9,18,9],[9,19,9],[9,20,9],[9,21,9],[9,22,9],[9,23,9],[9,24,9],[9,25,9],[14,26,9],[1,27,9],[1,28,9],[1,29,9],[1,30,9],[1,31,9],[15,35,9],[15,5,10],[15,6,10],[15,7,10],[15,8,10],[15,9,10],[15,10,10],[15,11,10],[15,12,10],[15,13,10],[15,14,10],[8,15,10],[9,16,10],[9,17,10],[9,18,10],[9,19,10],[9,20,10],[9,21,10],[9,22,10],[9,23,10],[9,24,10],[10,25,10],[1,27,10],[1,28,10],[1,29,10],[15,35,10],[15,6,11],[1,10,11],[12,15,11],[13,16,11],[9,17,11],[9,18,11],[9,19,11],[9,20,11],[9,21,11],[9,22,11],[9,23,11],[9,24,11],[14,25,11],[1,29,11],[15,35,11],[15,6,12],[1,10,12],[12,17,12],[9,18,12],[9,19,12],[9,20,12],[9,21,12],[9,22,12],[9,23,12],[10,24,12],[15,35,12],[15,36,12],[15,37,12],[15,38,12],[15,6,13],[1,9,13],[1,10,13],[1,11,13],[12,18,13],[9,19,13],[9,20,13],[9,21,13],[13,22,13],[13,23,13],[14,24,13],[15,35,13],[15,36,13],[15,37,13],[15,38,13],[15,6,14],[1,9,14],[1,10,14],[1,11,14],[12,19,14],[13,20,14],[14,21,14],[15,22,14],[15,23,14],[15,24,14],[15,35,14],[15,36,14],[15,37,14],[15,38,14],[15,1,15],[15,2,15],[15,3,15],[15,6,15],[1,9,15],[1,10,15],[15,21,15],[1,22,15],[1,23,15],[15,24,15],[3,26,15],[4,27,15],[4,28,15],[5,29,15],[15,1,16],[15,2,16],[15,3,16],[15,4,16],[15,6,16],[1,8,16],[1,9,16],[1,10,16],[15,21,16],[1,23,16],[15,24,16],[8,26,16],[9,27,16],[9,28,16],[10,29,16],[15,1,17],[15,2,17],[15,3,17],[15,4,17],[15,6,17],[1,8,17],[1,9,17],[1,10,17],[1,11,17],[1,12,17],[15,21,17],[1,22,17],[1,23,17],[15,24,17],[8,26,17],[9,27,17],[9,28,17],[10,29,17],[15,4,18],[15,5,18],[15,6,18],[1,7,18],[1,8,18],[1,9,18],[1,10,18],[1,11,18],[1,12,18],[1,13,18],[15,21,18],[15,24,18],[12,26,18],[13,27,18],[13,28,18],[14,29,18],[1,8,19],[1,9,19],[1,10,19],[1,11,19],[1,12,19],[15,21,19],[15,24,19],[1,26,19],[1,27,19],[1,28,19],[1,29,19],[1,34,19],[1,35,19],[1,36,19],[1,37,19],[1,0,20],[1,1,20],[1,9,20],[1,10,20],[1,11,20],[15,21,20],[15,24,20],[1,25,20],[1,26,20],[1,27,20],[1,28,20],[1,35,20],[1,36,20],[1,37,20],[1,38,20],[1,0,21],[1,1,21],[1,2,21],[1,10,21],[1,11,21],[15,21,21],[15,24,21],[1,26,21],[1,27,21],[1,28,21],[1,29,21],[1,30,21],[1,37,21],[1,38,21],[1,10,22],[15,21,22],[15,24,22],[1,37,22],[1,38,22],[1,39,22]],3:[[26,28,0],[27,29,0],[29,30,0],[28,31,0],[33,28,1],[40,29,1],[35,31,1],[36,15,4],[37,16,4],[37,17,4],[38,18,4],[36,21,4],[37,22,4],[17,23,4],[37,24,4],[37,25,4],[18,26,4],[25,26,5],[16,0,6],[17,1,6],[17,2,6],[18,3,6],[59,15,6],[25,26,6],[23,0,7],[61,3,7],[60,15,7],[25,26,7],[61,0,8],[60,15,8],[25,26,8],[61,15,9],[25,26,9],[19,36,9],[20,37,9],[20,38,9],[21,39,9],[61,26,10],[26,36,10],[29,37,10],[29,38,10],[28,39,10],[59,15,11],[33,36,11],[40,37,11],[40,38,11],[35,39,11],[22,15,12],[21,16,12],[37,17,12],[38,18,12],[36,21,12],[37,22,12],[17,23,12],[37,24,12],[37,25,12],[38,26,12],[59,39,12],[26,0,13],[27,1,13],[27,2,13],[27,3,13],[28,4,13],[26,14,13],[29,15,13],[28,16,13],[54,20,13],[25,39,13],[33,0,14],[40,1,14],[34,2,14],[40,3,14],[35,4,14],[59,5,14],[33,14,14],[35,16,14],[50,20,14],[25,39,14],[59,0,15],[60,5,15],[36,26,15],[17,27,15],[17,28,15],[18,29,15],[36,38,15],[32,39,15],[23,0,16],[61,5,16],[25,29,16],[23,0,17],[25,29,17],[30,0,18],[37,1,18],[38,2,18],[61,29,18]],4:[[19,0,12],[20,1,12],[20,2,12],[20,3,12],[21,4,12],[19,14,12]]},Q=[53,55,57,54],k={0:45,2:49,1:[46,7],4:52,3:58},I=(()=>{let s=new Map;return(...t)=>{var e=JSON.stringify(t);return s.has(e)?s.get(e):(t=((t,e,s,h,i)=>{var r=document.createElement("canvas"),a=r.getContext("2d");if(a)return a.imageSmoothingEnabled=!1,r.width=16,r.height=16,a.clearRect(0,0,16,16),a.drawImage(t,16*e,16*s,16,16,0,0,16,16),void 0!==h&&void 0!==i&&a.drawImage(t,16*h,16*i,16,16,4,0,8,8),a.canvas;throw Error("Could not get context from canvas")})(...t),s.set(e,t),t)}})(),A=t=>Array.isArray(t)?t.reduce((t,e)=>t.concat([e%8,Math.floor(e/8)]),[]):[t%8,Math.floor(t/8)];function D(t,e,s,h,i,r="#fff",a="center"){(t=t.h).font=s+"px monospace",t.textAlign=a,t.strokeStyle="#000",t.lineWidth=1,t.strokeText(e,h,i),t.fillStyle=r,t.fillText(e,h,i)}function tt(){var s=C;for(let e=0;e<s.W;e++)for(let t=0;t<s.u;t++){var h=[32*e,32*t];s.h.drawImage(I(s.i,...A(0)),0,0,16,16,h[0],h[1],32,32)}}function E(t,e){var s=C;e=A(e),s.h.drawImage(I(s.i,...e),0,0,16,16,Math.round(t.x),Math.round(t.y),32,32)}function et(t,e){var s=C;e=A(e),s.h.drawImage(I(s.i,...e),0,0,16,16,Math.round(t.x),Math.round(t.y)+8,16,16)}function st(t,e,s,h,i){h=A(h),t.h.drawImage(I(t.i,...h),0,0,16,16,Math.round(e),Math.round(s),Math.round(32/(i?1:1.4)),Math.round(32/(i?1:1.4)))}function T(t,e,s,h,i,r=!0){t.h.fillStyle=r?"rgba(0, 0, 0, 0.4)":"rgba(0, 0, 0, 0.8)",t.h.fillRect(e,s,h,i)}function ht(t){var e=C;T(e,0,0,10*(t=t.toString()).length+32,23),D(e,t,24,2,19,"gold","left"),st(e,16+10*t.length,-5,43,!0)}function it(h,t,e){let{x:i,y:r}=t;r+=30,t=e.filter(([,t])=>0<t),T(h,Math.round(i),Math.round(r),32,16*t.length+6),t.forEach(([t,e],s)=>{t=A(t),h.h.drawImage(I(h.i,...t),0,0,16,16,Math.round(i)+3,Math.round(r)+3+16*s,16,16),D(h,e.toString(),10,Math.round(i)+25,Math.round(r)+3+16*s+12,"white","left")})}function rt(t){var s=C;T(s,s.w/2-410,s.l-65,820,65),t.split("\n").forEach((t,e)=>{D(s,t,16,s.w/2,s.l-45+20*e,"white","center")})}function at({x:t,y:e},{ma:s,na:h}){var i=C;s+=32/3,h+=32/3,i.h.strokeStyle="#8b4513",i.h.lineWidth=2,i.h.setLineDash([]),i.h.beginPath(),i.h.moveTo(Math.round(t)+16,Math.round(e)+16),i.h.lineTo(Math.round(s),Math.round(h)),i.h.stroke(),i.h.closePath(),i.h.strokeStyle="rgba(0, 0, 0, 0.8)",i.h.lineWidth=2,i.h.beginPath(),i.h.setLineDash([3,4]),i.h.moveTo(Math.round(t)+16,Math.round(e)+16),i.h.lineTo(Math.round(s),Math.round(h)),i.h.stroke(),i.h.closePath()}function nt(t,{w:e,l:s}){var h=C;h.h.strokeStyle="rgba(0,0,0,0.8)",h.h.lineWidth=2,h.h.beginPath(),h.h.setLineDash([4,4]),h.h.rect(Math.round(t.x)-2,Math.round(t.y)-2,e+4,s+4),h.h.stroke(),h.h.closePath()}function ot(t,e,s){var h=C;e=1-e/s,s=Math.round(t.x)+2,t=Math.round(t.y)+24,h.h.fillStyle="#000",h.h.fillRect(s,t,28,4),h.h.fillStyle="#fff",h.h.fillRect(s,t,28*e,4)}function lt(t,e,s=1,h){var i=C;void 0!==h?(e=A(h),i.h.drawImage(I(i.i,...e),0,0,16,16,Math.round(t.x),Math.round(t.y),16,16)):(i.h.fillStyle=e,i.h.fillRect(Math.round(t.x),Math.round(t.y),s,s))}function gt(t){var e=C;T(e,e.w-220,0,225,25),t=Math.floor(t/1e3),D(e,`Time left ${Math.floor(t/60).toString().padStart(1)}:`+(t%60).toString().padStart(2,"0"),24,e.w-5,19,"white","right")}let C=new class{constructor(){this.i=new Image,this.m=!1,this.h=c2d.getContext("2d"),this.h.imageSmoothingEnabled=!1,this.i.src="s.png",this.i.onload=()=>{this.m=!0}}get W(){return this.w/32}get u(){return this.l/32}get w(){return this.h.canvas.width}get l(){return this.h.canvas.height}},P=new class{constructor(){this.i=!1,this.h={x:0,y:0};let s=C.h.canvas;document.addEventListener("mousedown",()=>this.i=!0),document.addEventListener("mouseup",()=>this.i=!1),s.addEventListener("mousemove",t=>{var e=s.getBoundingClientRect();this.h={x:s.width/e.width*(t.clientX-e.left),y:s.height/e.height*(t.clientY-e.top)}})}};function ut(t){var e=ct;e.h.ra?.(),e.h=t,e.h.ia?.()}let ct,dt={0:{G:50,F:.94},1:{G:40,F:.96},4:{G:150,F:.94},2:{G:200,F:.94},3:{G:35,F:.96}},ft={0:{G:400,F:.7},1:{G:400,F:.9}},wt={0:3,1:1,4:11,2:6,3:2},yt={0:{resources:[1,3,0],Y:[.5,.3,.2],max:2},1:{resources:[1,3,0,2],Y:[.3,.3,.3,.1],max:3},2:{resources:[1,3,0,2,4],Y:[.2,.1,.2,.2,.3],max:4},3:{resources:[4,2],Y:[.6,.4],max:2}},xt="Welcome to Mini Merchant(js13k games 2023 entry)!;You are a merchant who has to sell goods to the people of the village.;Use your mouse to interact with the world. Drag&Drop items near the stole to sell them.;Read more about possible interactions by clicking on ;You have a short life, so you have to sell as much as possible in 7 min.;TIP: Prepare more goods in your yard in advance. ;".split(";").map(t=>t.trim()),i=([t,e],s,h)=>[new w(t,e),new l(s,3),new x({w:30,l:30},!0),new y,new n(ft[h]),new m,new S(64),new g],B=([t,e],s)=>[new w(t,e),new l(39,3),new x({w:32,l:32},!0),new g,new S(64,!1,s,2)],O=([t,e],s)=>{var h=wt[s],i=dt[s];return[new w(t,e),new l(k[s],3),new x({w:24,l:24}),new m,new S(64),new y,new n({G:i?.G,F:i?.F}),new d(s,h),new g]},F=([t,e])=>[new w(t,e),new l(6,3),new x({w:32,l:32},!0),new b(0,{},1e4),new S(k[0],!0),new g],L=([t,e])=>[new w(t,e),new l(7,3),new x({w:32,l:32},!0),new b(1,{},25e3),new S(k[1]),new g],mt=([t,e])=>[new w(t,e),new l(47,1),new Z(90),new d(90)],vt=([t,e],s,h)=>[new w(t,e),new l(48,1),new Z(91),new M(s,h),new d(91)],pt=s=>Object.keys(s).reduce((t,e)=>(t.push([k[e],s[e]]),t),[]);class Mt extends e{constructor(){super(...arguments),this.v=new Set([l]),this.i=new Map,this.u=[],this.h=[],this.m=null}C(t,e){e=e.get(l),this.i.has(e.aa)||this.i.set(e.aa,new Set),this.i.get(e.aa)?.add(t)}J(t){for(var e of this.i.values())e.delete(t)}update(){for(var t of(this.u=[],this.m=[P.h.x,P.h.y,62],tt(),[0,1,2,3,4,5])){if(5===t){for(;this.h.length;)this.h.pop()();st(C,...this.m)}if("string"!=typeof t&&this.i.has(t)){if(4===t)for(var e of this.u)E({x:e.x,y:e.y},e.P);for(var i of this.i.get(t))if(i=f(this.g,i)){var r=i.get(l);if(r.visible){let s=i.get(w),t=i.get(m),h=i.get(S),e=i.get(p);if(t)t.s&&(at(s,{ma:this.m[0],na:this.m[1]}),this.m=[P.h.x,P.h.y,63]),h?.L&&!t.s&&this.h.push(()=>nt(s,{w:32,l:32}));else if(h?.L){let t=h.Z?64:32,e=h.Z?s.y-32:s.y;this.h.push(()=>nt({x:s.x,y:e},{w:32,l:t}))}if(h?.L&&(h.text&&this.h.push(()=>{rt(h.text)}),h.enabled)&&(this.m=[P.h.x,P.h.y,h.icon]),!(t=i.get(b))||0!==t.type&&3!==t.type||this.u.push({x:s.x,y:s.y-32,P:3===t.type?42:2}),void 0!==r.P){E(s,r.P),1===e?.state&&this.h.push(()=>it(C,s,pt(e.X)));let t=i.get(M);t&&this.h.push(()=>it(C,{x:s.x,y:s.y-96},pt(t.N||t.da))),null!==r.$&&et(s,r.$)}else(r=i.get(v))&&lt(s,r.color,r.size,r.P),(i=i.get(a))&&(ht(i.H),gt(i.T));0<t?.M&&ot(s,t.M,t.interval)}}}}}}let bt,St=new AudioContext;window.h=.3,bt=(t=1,e=.05,s=220,h=0,i=0,r=.1,a=0,n=1,o=0,l=0,g=0,u=0,c=0,d=0,f=0,w=0,y=0,x=1,m=0,v=0,p=Math,M=44100,b=2*p.PI,S=o*=500*b/M/M,j=s*=(1-e+2*e*p.random(e=[]))*b/M,k=0,I=0,A=0,D=1,E=0,T=0,C=0,P,B)=>{for(l*=500*b/M**3,f*=b/M,g*=b/M,u*=M,c=M*c|0,B=(h=M*h+9)+(m*=M)+(i*=M)+(r*=M)+(y*=M)|0;A<B;e[A++]=C)++T%(100*w|0)||(C=a?1<a?2<a?3<a?p.sin((k%b)**3):p.max(p.min(p.tan(k),1),-1):1-(2*k/b%2+2)%2:1-4*p.abs(p.round(k/b)-k/b):p.sin(k),C=(c?1-v+v*p.sin(b*A/c):1)*(0<C?1:-1)*p.abs(C)**n*window.h*t*(A<h?A/h:A<h+m?1-(A-h)/m*(1-x):A<h+m+i?x:A<B-y?(B-A-y)/r*x:0),C=y?C/2+(A<y?0:(A<B-y?1:(B-A)/y)*e[A-y|0]/2):C),k+=(P=(s+=o+=l)*p.cos(f*I++))-P*d*(1-1e9*(p.sin(A)+1)%2),D&&++D>u&&(s+=g,j+=g,D=0),!c||++E%c||(s=j,o=S,D=D||1);(t=St.createBuffer(1,B,M)).getChannelData(0).set(e),(s=St.createBufferSource()).buffer=t,s.connect(St.destination),s.start()};class jt extends e{constructor(){super(...arguments),this.i=!1,this.state={O:{},muted:!1,volume:.03},this.h={0:[2.24,,53,,,.07,3,.57,,,,,,1.2,,.3,,.46,,.01],1:[[1.31,,200,,.02,.01,2,2.1,,,,,,,-242,,,.53],500],2:[1.1,,332,,.06,.14,1,.31,,8,,,,,,.1,,.49,.01,.03],3:[[1.32,,164,,.24,.08,4,1.14,,,,,,.1,72,,.27,,.18,.43],2e3],4:[,,684,.05,.23,.2,1,1.09,3.9,-.8,-9,.05,,,,,,.49,.18,.13],12:[1.02,,319,.08,.12,.26,1,.43,3.5,,,,.19,,,.1,,.47,.16],5:[,,435,.02,.07,.06,1,1.6,-12,,,,,,,,,.91,.01]},this.v=new Set([a])}update(){if(!this.i){var h=this;h.g.j.B(8,()=>{h.state.muted=!h.state.muted});for(let s in h.h)h.state.O[s]=0,h.g.j.B(s,()=>{let t=h.h[s],e=300;2===h.h[s].length&&(e=t[1],t=t[0]),h.state.O[s]<=0&&(bt(...t),h.state.O[s]=e)});this.i=!0}for(var t in window.h=this.state.volume,this.state.O)0<this.state.O[t]&&(this.state.O[t]-=this.g.D)}}function kt(t,e,s,h,i,r,a=500){var n=t.g.C();h=Math.min(h,5),o(t.g,n,new w(e.x+16+h,e.y+32-2)),o(t.g,n,new y((Math.random()-.5)/2+(s?.dx||0),(Math.random()-.5)/2+(s?.dy||0))),o(t.g,n,new v(a,3,i,r)),o(t.g,n,new l(void 0,2))}class It extends e{constructor(){super(...arguments),this.i=!1,this.h=0,this.m=200,this.v=new Set([w,y])}update(t){if(this.i||((r=this).g.j.B(1,(e,s)=>{e=f(r.g,e).get(w),s=f(r.g,s).get(w),s={x:(e.x+s.x)/2,y:(e.y+s.y)/2-16},e=Math.floor(3*Math.random())+3;for(let t=0;t<e;t++)kt(r,s,void 0,t,"white")}),r.g.j.B(4,(e,s)=>{e=f(r.g,e).get(w);for(let t=0;t<s;t++)kt(r,e,{dx:0,dy:-5},t,"gold",43,2500)}),this.i=!0),this.h-=this.g.D,this.h<=0){for(var e of t){var s=f(this.g,e),h=s.get(y);if(!s.get(v)&&(.2<Math.abs(h.dx)||.2<Math.abs(h.dy))){var i=Math.floor(10*Math.random())+7;for(let t=0;t<i;t++)kt(this,s.get(w),{dx:0<h.dx?-Math.min(h.dx,.5):-Math.max(h.dx,-.5),dy:0<h.dy?-Math.min(h.dy,.5):-Math.max(h.dy,-.5)},t,"rgba(145, 79, 25, 0.2)")}}this.h=this.m}var r,a;for(a of t)(t=f(this.g,a).get(v))&&(t.ba-=this.g.D,t.ba<=0)&&this.g.J(a)}}class At extends e{constructor(){super(...arguments),this.v=new Set([d])}update(t){for(var e of t){var s,h,i=f(this.g,e),r=i.get(Z);if(r){for(var a of(r.S=-1,t))a!==e&&90!==f(this.g,a).get(d).type&&(s=i.get(w),h=f(this.g,a).get(w),V({x:s.x+16,y:s.y+16},{x:h.x,y:h.y,w:32,l:32}))&&(r.S=a);-1!==r.S&&(90===r.type&&this.g.j.o(7,r.S),91===r.type)&&this.g.j.o(13,e,r.S)}}}}class Dt extends e{constructor(){super(...arguments),this.v=new Set([y,n])}update(t){for(var e of t)t=(e=f(this.g,e)).get(y),e=e.get(n),t.dx*=e.data.F||.95,t.dy*=e.data.F||.95}}class Et extends e{constructor(){super(...arguments),this.v=new Set([y,w])}update(t){for(var e of t)t=(e=f(this.g,e)).get(y),(e=e.get(w)).x+=t.dx,e.y+=t.dy,Math.abs(t.dx)<.01&&(t.dx=0),Math.abs(t.dy)<.01&&(t.dy=0)}}class Tt extends e{constructor(){super(...arguments),this.v=new Set([y,w,m,S]),this.s=-1,this.h=2,this.i=!1}update(t){var e;this.i||((e=this).g.j.B(11,()=>{e.h-=.45,e.g.j.o(0)}),e.i=!0);var s,h=P.h;for(s of(-1===this.s||f(this.g,this.s)||(this.s=-1),t)){var i,r=f(this.g,s),a=(t=r.get(w),r.get(m));r.get(S).L&&!a.s&&-1===this.s&&P.i&&(a.s=!0,this.g.j.o(5,s),this.s=s),!P.i&&a.s&&(a.s=!1,this.g.j.o(2,s),this.s=-1),a.s&&(a=r.get(y),r=(r.get(n).data.G||50)*this.h,i=Y(h.y-t.y),a.dx+=Y(h.x-t.x)/r,a.dy+=i/r)}}}function Ct(s,t){var h=(e=f(s.g,t)).get(b),i=e.get(w),e=e.get(S);if(h?.M<=0){let e=s.g.C();O([i.x,i.y+32],h.type).forEach(t=>{o(s.g,e,t)}),(i=f(s.g,e).get(y)).dx=0,i.dy=1.5,s.g.j.o(0,t),h.M=h.interval}0===e.type&&s.g.j.o(9,t),1===e.type&&s.g.j.o(10,t)}class Pt extends e{constructor(){super(...arguments),this.v=new Set([S,w]),this.i=!1,this.h=0,this.m=500}update(t){var e,s=P.h;for(e of t){var h=(t=f(this.g,e)).get(w),i=t.get(S);i.L=V(s,{x:h.x,y:i.Z?h.y-32:h.y,w:32,l:i.Z?64:32}),i.L&&this.i!==P.i&&this.h<=0&&i.enabled&&(Ct(this,e),this.h=this.m),0<(t=t.get(b))?.M&&(t.M-=this.g.D)}0<this.h&&(this.h-=this.g.D),this.i=P.i}}let Bt=[24,22],Ot=[21,22],Ft=[24,14],Lt=[21,14];function Nt(t,e){var s=(e=f(t.g,e)).get(p);s.state=3,s.A=Ot,t.h.shift(),s.ga&&(e.get(l).$=46)}function Rt(e){let s=e.g.C(),t=(e=>{var{resources:s,Y:h,max:t}=yt[e],i=(e=Math.floor(Math.random()*t)+1,{});for(let t=0;t<e;t++){var r=s[(e=>{var s=e.reduce((t,e)=>t+e,0),s=Math.random()*s;let h=0;for(let t=0;t<e.length;t++)if(s<(h+=e[t]))return t;return 0})(h)];i[r]=(i[r]||0)+1}return i})(e.level);((t,e)=>{var[s,h]=[32*Bt[0],32*Bt[1]];return[new w(s,h),new l(Q[Math.floor(Math.random()*Q.length)],3),new p(t,e,Ft)]})(t,H[e.level]).forEach(t=>o(e.g,s,t))}function Gt(t,e){let s;t.h.includes(e)?s=t.h.indexOf(e):(s=t.h.length,t.h.push(e));var h=f(t.g,e),i=h.get(p),r=(i.ka!==s&&(i.ka=s,i.state=0,i.A=[Lt[0]+s,Lt[1]]),h=h.get(w),N(...i.A));h.x===r[0]&&h.y===r[1]&&(0===s?(i.state=1,t.g.j.o(12,e)):i.state=2)}class Jt extends e{constructor(){super(...arguments),this.u=!1,this.h=[],this.level=this.m=this.i=0,this.v=new Set([p,w])}update(t){if(this.u||((o=this).g.j.B(14,t=>{o.level=t}),o.g.j.B(7,t=>{var e,s,h=f(o.g,t).get(d);h&&o.h.length&&(e=o.h[0],1===(s=f(o.g,e).get(p)).state)&&(0<(s.X[h.type]||0)?(o.g.j.o(4,t,h.oa),--s.X[h.type],s.ga=!0,Object.values(s.X).every(t=>0===t)&&(o.g.j.o(4,t,Math.floor(2*Math.random())+1),Nt(o,e)),o.g.J(t)):o.g.j.o(3,t))}),this.u=!0),this.i-=this.g.D,this.i<=0&&(this.i=W[this.level],t.size<4)&&Rt(this),this.m-=this.g.D,this.m<=0)for(var e of(this.m=30,t)){var s,h,i,r,a,n=f(this.g,e).get(p);0!==n.state&&3!==n.state||(s=e,h=(i=f(this.g,s)).get(p),i=i.get(w),[r,a]=h.A,[r,a]=[32*r,32*a],i.x===r&&i.y===a?(0===h.state&&Gt(this,s),3===h.state&&this.g.J(s)):(i.x<r&&(i.x+=2),r<i.x&&(i.x-=2),i.y<a&&(i.y+=2),a<i.y&&(i.y-=2))),2===n.state&&Gt(this,e)}var o,l;for(l of t)1===(t=f(this.g,l).get(p)).state&&(t.time-=this.g.D,t.time<=0)&&Nt(this,l)}}class Ht extends e{constructor(){super(...arguments),this.v=new Set([a]),this.m=!1,this.e=-1,this.h=this.i=0}update(t){for(var e of(this.m||((h=this).e=h.g.C(),o(h.g,h.e,new a(10)),o(h.g,h.e,new l(void 0,5)),h.g.j.B(4,(t,e)=>{f(h.g,h.e).get(a).H+=e}),h.g.j.B(9,t=>{var s=f(h.g,h.e).get(a);if(h.i<4&&10<=s.H){let e=h.g.C();(()=>{var[t,e]=[480,480];return[new w(t,e),new l(56,3),new j(!0),new g]})().forEach(t=>o(h.g,e,t)),s.H-=10,h.i+=1,h.g.j.o(0,t),4===h.i&&(f(h.g,t).get(S).enabled=!1)}else h.g.j.o(3,t)}),h.g.j.B(10,t=>{var e=f(h.g,h.e).get(a);4<=e.H&&h.h<3?(e.H-=4,h.h+=1,3===h.h&&(f(h.g,t).get(S).enabled=!1),h.g.j.o(11,t)):h.g.j.o(3,t)}),h.m=!0),t))(t=f(this.g,e).get(a)).T-=this.g.D,t.T<=0&&this.g.j.o(6,t.H),t.level+1<J.length-1&&J[t.level+1]<42e4-t.T&&(t.level++,this.g.j.o(14,t.level));var h}}function Wt(t){let e=r(t.x,t.y),s=null;return Object.keys(G).forEach(t=>{t=t.split(",").map(t=>parseInt(t,10)),(null===s||c(e,t)<c(e,s))&&(s=t)}),s}function Yt(t,e,s){if(Array.isArray(s)||(s=f(t.g,s).get(w),s=r(s.x,s.y)),e=f(t.g,e).get(w),t=((t,s,e)=>{var h=e.length,i=e[0].length,r=[],a=[];for(s=new u(s[0],s[1]),r.push(new u(t[0],t[1]));0<r.length;){t=r[0];for(var n,o=1;o<r.length;o++)(r[o].f<t.f||r[o].f===t.f&&r[o].l<t.l)&&(t=r[o]);if(r.splice(r.indexOf(t),1),a.push(t),t.x===s.x&&t.y===s.y){for(e=[],h=t;null!==h;)e.unshift([h.x,h.y]),h=h.parent;return e}for(n of(o=[],[[0,-1],[0,1],[-1,0],[1,0]])){var l=t.x+n[0],g=t.y+n[1];0<=l&&l<h&&0<=g&&g<i&&0===e[l][g]&&o.push(new u(l,g))}for(let e of o)!a.some(t=>t.x===e.x&&t.y===e.y)&&(o=t.V+1,!r.some(t=>t.x===e.x&&t.y===e.y)||o<e.V)&&(e.V=o,e.l=c([e.x,e.y],[s.x,s.y]),e.parent=t,r.some(t=>t.x===e.x&&t.y===e.y)||r.push(e))}return null})(r(e.x,e.y),s,t.u))return t.length<2||N(...t[1])}function Kt(t,e){e=f(t.g,e).get(j),delete t.h[e.I],e.A=null,e.I=null,e.ca=!1,e.state=0}function $t(t,e,s){var h=f(t.g,e),i=h.get(j);1===i.state?(h=Wt(h.get(w)),(e=Yt(t,e,r(...h)))&&!0!==e&&(i.state=2,i.A=e,i.ca=!0,t.g.j.o(5,s))):2===i.state&&(Kt(t,e),i=h.get(w),i=G[r(i.x,i.y).join(",")],e=(h=f(t.g,s)).get(y),h=h.get(w),1===i&&(e.dx=1.5,h.x+=32),-1===i&&(e.dy=1.5,h.y+=32),2===i&&(e.dx-=1.5,h.x-=32),t.g.j.o(2,s))}function Ut(t,e){var s=f(t.g,e).get(w),h=f(t.g,e).get(j),i=f(t.g,h.I);if(!i||i.get(m).s)Kt(t,e);else{var{x:r,y:a}=s,[n,o]=h.A;if(r===n&&a===o){if(i=Wt(s),!(i=Yt(t,e,1===h.state?h.I:i)))return Kt(t,e);!0===i?$t(t,e,h.I):h.A=i}h.A&&(s.x<n&&(s.x+=2),s.x>n&&(s.x-=2),s.y<o&&(s.y+=2),s.y>o)&&(s.y-=2),h.ca&&((t=f(t.g,h.I).get(w)).x=s.x,t.y=s.y)}}function Xt(t,e,s){var h,i=f(t.g,e).get(j);for(h of s)if(!t.h[h]&&(s=f(t.g,h),!s.get(m)?.s)&&(s=s.get(w),!V(s,R))&&(s=Yt(t,e,h))){i.I=h,t.h[h]=e,i.state=1,!0===s?$t(t,e,h):i.A=s;break}}class Vt extends e{constructor(){super(...arguments),this.v=new Set([g]),this.W=!1;var s=[];for(let e=0;e<40;e++){s[e]=[];for(let t=0;t<23;t++)s[e][t]=0}this.u=s,this.h={},this.m=[],this.i=0}C(t,e){var s,h;e.get(x)?.fa&&(s=e.get(w),[s,h]=r(s.x,s.y),this.u[s][h]=1),e.get(j)&&this.m.push(t)}J(e){var t,s=f(this.g,e),h=s.get(x);h&&h.fa&&(h=s.get(w),[h,t]=r(h.x,h.y),this.u[h][t]=0),s.get(j)&&(this.m=this.m.filter(t=>t!==e)),this.h[e]&&(s=this.h[e],delete this.h[e],f(this.g,s).get(j).A=null,f(this.g,s).get(j).I=null)}update(t){this.W||(this.W=!0);var e,s=[...t];if(t=s.filter(t=>!!f(this.g,t).get(j)),this.i<=0)for(var h of(s=s.filter(t=>!!f(this.g,t).get(d)),t))f(this.g,h).get(j).I||Xt(this,h,s);for(e of t)f(this.g,e).get(j).A&&Ut(this,e);this.i<=0&&(this.i=500),this.i-=this.g.D}}class Zt extends e{constructor(){super(...arguments),this.v=new Set([M]),this.h=!1}update(){var r;this.h||((r=this).g.j.B(13,(t,s)=>{var e=f(r.g,t).get(M),h=(e.N||(e.N={...e.da}),f(r.g,s).get(d));if(0<e.N[h.type]?(--e.N[h.type],r.g.J(s)):r.g.j.o(3,s),Object.values(e.N).every(t=>0===t)){var i=r,h=t;h=(s=f(i.g,h)).get(M),s=s.get(w);let e=i.g.C();O([s.x,s.y+32],h.type).forEach(t=>{o(i.g,e,t)}),h.N={...h.da}}}),r.h=!0)}}function zt(t,...e){for(var s of e)for(var h of(e=t.g.C(),s))o(t.g,e,h)}class _t{constructor(){this.h=!1,this.g=new X,s(this.g,new Pt),s(this.g,new Tt),s(this.g,new Vt),s(this.g,new _),s(this.g,new Dt),s(this.g,new It),s(this.g,new Et),s(this.g,new At),s(this.g,new Zt),s(this.g,new Jt),s(this.g,new Mt),s(this.g,new jt),s(this.g,new Ht),this.g.j.B(6,t=>{this.h=!0;let e=K(),s="";void 0!==(e=e||{R:0,ha:0})?.R&&e?.R<t&&(s=" New high score!",e.R=t),alert(`Game over! Your score is ${t}.${s} Share it on twitter with #js13k!`),e.ha+=1,window.localStorage.setItem("rndd_mm_gameData",JSON.stringify(e)),ut(qt)})}ia(){var[t,e]=[480,448],t=[new w(t,e),new l(41,3),new x({w:32,l:32},!0),new g,new S(43,!1,"Hire cyclops - 10 coins",0)],[e,s]=[960,32],e=[new w(e,s),new l(41,3),new x({w:32,l:32},!0),new g,new S(43,!1,"Train in gym - 4 coins",1)],[s,h]=[896,256];zt(this,O([800,288],0),O([800,256],0),O([672,96],4),O([448,192],2),O([800,160],1),O([800,192],1),O([704,160],3),O([704,192],3),mt([640,384]),mt([608,384]),F([288,480]),F([1120,160]),F([576,32]),F([672,32]),[new w(s,h),new l(44,3),new x({w:32,l:32},!0),new b(3,{},3e3),new S(k[3],!0),new g],L([32,224]),L([64,224]),L([864,512]),L([896,512]),L([352,0]),vt([1216,384],4,{0:1,3:1,1:1}),vt([64,480],2,{0:1,1:1}),i([640,288],24,1),i([544,160],24,1),i([768,352],51,0),i([608,416],51,0),i([896,96],51,0),B([672,416],"This is your counter, customers come here and show their shopping list\nPlace products from the list on the white marked area\nIf you provide everything on time, you will receive a tip"),B([448,480],"As everyone knows the 13th century was full of cyclops\nYou can hire them to carry things to your yard by clicking on the door of this house\nThe maximum number to hire is 4"),B([992,64],"This is a gym, here you can pump up your arm strength by clicking on the door\nThis will help you to move things faster and remove unnecessary things from the yard\nMax strength is 3"),B([1152,384],"This is a brewery, here you can make beer barrels\nDrop wood, food and water on the white marked area"),B([128,480],"This is a factory, here you can make food boxes\nDrop wood and food on the white marked area\nPeople from 13th century love food boxes, so price is high"),B([736,512],"All resources around your yard are yours\nChop wood, collect food and water, make boxes and beer"),t,e),zt(this,...(()=>{let n=[],t={0:q[0],3:q[3],4:q[4]};for(let a in t)t[a].forEach(([t,e,s])=>{if(e=[32*(e+0),32*(s+0)],s=[],-1!==t){switch(Number(a)){case 0:s.push(...([[h,i],r]=[e,t],[new w(h,i),new l(r,0)]));break;case 3:s.push(...([[h,i],r]=[e,t],[new w(h,i),new l(r,3),new x({w:28,l:28},!0),new g]));break;case 4:s.push(...([[h,i],r]=[e,t],[new w(h,i),new l(r,4)]))}n.push(s)}var h,i,r});return n})())}ja(t){this.h||(this.g.D=t,this.g.update())}}let qt=new class{constructor(){this.selected=0,this.h=Array(200).fill({}).map(()=>{var t=[43,43,k[0],46];return{x:Math.random()*C.w,y:-200*Math.random()-10,ea:2*Math.random()-1,U:5*Math.random()-1,pa:t[Math.floor(Math.random()*t.length)]}})}ja(){let t,e,s=C.w/2;C.m?(this.h.forEach(t=>{t.x+=t.ea,t.y+=t.U,t.U+=.1,(t.x<0||t.x>C.w)&&(t.ea*=-1),t.y>C.l&&(t.y=0,t.U=Math.min(t.U,8))}),tt(),this.h.forEach(t=>{E({x:t.x,y:t.y},t.pa)}),T(C,0,0,C.w,C.l),D(C,"Mini merchant",80,2+s,90,"#000"),D(C,"Mini merchant",80,s,90,"gold"),T(C,0,150,C.w,210,!1),xt.forEach((t,e)=>D(C,t,22,s,180+32*e,"white")),E({x:350+s,y:250},39),void 0!==(e=K())?.R&&D(C,"High score: "+e.R,40,C.w/2,450,"gold"),D(C,"Start Game",60,s,600,1===this.selected?"gold":"#fff"),D(C,"Toggle Fullscreen",60,s,700,2===this.selected?"gold":"#fff"),st(C,P.h.x,P.h.y,62),t=P.h.y,this.selected=t<610&&550<t?1:660<t?2:0,P.i&&(1===this.selected?ut(new _t):2===this.selected&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen(),P.i=!1))):D(C,"Loading...",80,s,90)}},Qt=(ct=new class{constructor(...t){this.h=qt,this.h.ia?.(...t)}},0);!function t(e){var s=e-Qt;1e3/60<=s&&(Qt=e-s%(1e3/60),ct.h.ja(s)),requestAnimationFrame(t)}(0)</script>