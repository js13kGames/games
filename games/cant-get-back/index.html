<style>body,html{background-color:#020;margin:0}canvas{z-index:2;position:absolute;margin-left:30%;width:40%;border:3 px solid #020;-webkit-transform:perspective(600px) rotateX(30deg);transform:perspective(600px) rotateX(30deg);border:10px inset #00a808;border-radius:10px}</style><canvas id=c onload=playMusic width=600 height=600></canvas><script>zzfx_v=.5,zzfx_x=new AudioContext,zzfx=(e,t,s,o=1,i=.1,n=0,l=0,a=0,r=0)=>{let h=44100,c=Math.PI;s*=2*c/h,s*=1+t*(2*Math.random()-1),n*=1e3*c/h**2,i*=0|(o=0<o?h*(10<o?10:o)|0:1),a*=2*c/h,r*=c,t=[];for(var u=0,d=0,f=0;f<o;++f)t[f]=e*zzfx_v*Math.cos(u*s*Math.cos(d*a+r))*(f<i?f/i:1-(f-i)/(o-i)),u+=1+l*(2*Math.random()-1),d+=1+l*(2*Math.random()-1),s+=n;return e=zzfx_x.createBuffer(1,o,h),s=zzfx_x.createBufferSource(),e.getChannelData(0).set(t),s.buffer=e,s.connect(zzfx_x.destination),s.start(),s};let e=Math.random,t=0,s=t,n=0,l=0;c=document.getElementById("c"),x=null,window.onmousemove=e=>{s||(m(),s=1,console.log("loaded"),x=c.getContext("2d"),document.addEventListener("keydown",r,!0),document.addEventListener("keyup",h,!0),se())},document.body.onload=e=>{s||(m(),s=1,console.log("loaded"),x=c.getContext("2d"),document.addEventListener("keydown",r,!0),document.addEventListener("keyup",h,!0),se())};let o={};radarItems=[];let a=e=>"32.38.40.37.39.77.69.87.65.83.68".split(".").indexOf(e.toString())>-1;function r(e){o[e.keyCode]||(o[e.keyCode]=1,a(e.keyCode)&&zzfx(.2,.1,1319,.05,.34,.9,1,3.6,.47))}function h(e){o[e.keyCode]=0,a(e.keyCode)&&zzfx(.2,.1,219,.05,.9,.9,2,3.6,.47)}function d(e){if(n)x.fillStyle="#141",x.fillRect(0,0,600,600);else for(R=t/20,i=0;i<=30;i++)for(j=0;j<=30;j++)x.fillStyle=`hsl(${100+20*(S=Math.sin,S)(S(i+R)*X+S(j+R)*I+((i-14.5)**2+(j-14.5)**2)**.5-R)},99%,${e}%)`,x.fillRect(20*i,20*j,20,20)}let u={kick:function(){zzfx(.9,.1,257,.2,.08,0,2,.2,.3)},hat:function(){zzfx(.2,1,9999,.1,.1,0,4,0,0)},snareclap:function(){zzfx(.2,0,777,.3,0,0,4,0,0)},synth:function(e,t=1){zzfx(.2,.01,440*(2**(1/12))**e,t,.1,0,0,0,0)},sub:function(e){zzfx(1,.01,440*(2**(1/12))**e,1,.1,.2,.2,.2,.2)}};SoundPatterns={beat:(beat=[u.kick,null,u.hat,null,u.snareclap,null,u.hat,null]).concat(beat),melody:[0,8,7,3,0,8,7,1,0,12,11,7,8,7,1,0],melody2:[0,8,7,3,0,8,7,1,0,12,11,7,8,7,1,0].map(z=e=>e-7),sub:[-24,null,null,null,-27,null,null,null,-32,null,null,null,-31,null,null,null]};let f=250,y=0;function m(){for(soundID in SoundPatterns.beat)sound=SoundPatterns.beat[soundID],note=SoundPatterns.melody[soundID],null!==sound&&setTimeout(sound,soundID*f);for(noteID in SoundPatterns.melody)setTimeout((t=>{noteInfo=y%64<32?SoundPatterns.melody[y%16]:SoundPatterns.melody2[y%16],u.synth(noteInfo,.1+e()/3),y++}),noteID*f);for(subID in SoundPatterns.sub)setTimeout((e=>{subInfo=SoundPatterns.sub[y%16],null!=subInfo&&u.sub(subInfo-24)}),subID*f);y%256==0&&function(e){let t,s,o;for(o=e.length-1;o>0;o--)t=Math.floor(Math.random()*(o+1)),s=e[o],e[o]=e[t],e[t]=s}(SoundPatterns.melody2),O||setTimeout(m,16*f)}function k(e,s,o,i,n,l,a=0){for(charIndex in x.font=`${i}em monospace`,e){let r=e[charIndex];x.fillStyle="#000",x.fillText(r,s+charIndex*i*8+3*Math.cos(t/10+charIndex),o+Math.sin(t/20+charIndex/2)*n+3*Math.sin(t/10+charIndex)),x.fillStyle=l,a&&(Math.sin(12*charIndex+Math.cos(charIndex/5+t/30)+t/10)>.5&&(x.fillStyle="red"),x.strokeStyle="#aa0",x.strokeText(r,s+charIndex*i*8,o+Math.sin(t/20+charIndex/2)*n)),x.fillText(r,s+charIndex*i*8,o+Math.sin(t/20+charIndex/2)*n)}}let Y=1,b=0,X=0,I=0;function v(e,t,s,o,n=40){for(x.fillStyle=`hsl(${250+20*s},99%,50%)`,x.beginPath(),i=5;i--;)x.arc(e+Math.sin(z=Math.PI/2*i+s)*n,t+Math.cos(z)*n,0,0,0);for(x.fill(),x.strokeStyle=`hsl(${250+20*o},89%,20%)`,x.lineWidth=2,x.stroke(),x.fillStyle=`hsl(${250+20*o},89%,20%)`,x.beginPath(),i=5;i--;)x.arc(e+Math.sin(z=Math.PI/2*i+o)*n*3/4,t+Math.cos(z)*n*3/4,0,0,0);x.fill(),x.strokeStyle=`hsl(${250+20*s},99%,50%)`,x.lineWidth=2,x.stroke()}function P(s,o,n,l){for(x.fillStyle="#000",x.beginPath(),i=5;i--;)x.arc(s+20*Math.sin(z=Math.PI/2*i+n*l/49+Math.sin(t/15)),o+20*Math.cos(z),0,0,0);x.fill(),x.lineWidth=3,x.strokeStyle="red",x.stroke(),radarItems.push(["red",s,o]),e()<.001&&w.length<5&&B(s,o)}let w=[],M=!1;function B(t,s){zzfx(.3,.1,700,1,.5,0,0,0,0),w.push({X:t,Y:s,vX:0,vY:0,speed:.01+e()/3})}let $=()=>800*e()-100;aiBotOn=0;let O=0,T=[],E=[],D=[],C=[],_=0,H=[];for(i=999;i--;)T.push({x:$(),y:$(),color:`hsl(${100+10*e()|0},${90*e()|0}%,${30+10*e()|0}%)`,perspective:1+e()/10,height:-10-20*e()}),e()<.4&&E.push({x:$(),y:$(),size:[20*e(),20*e()],rot:e()*Math.PI,color:`hsla(${50*e()|0},${50+49*e()|0}%,${30*e()|0}%,0.3)`,perspective:1-e()/9});let L=0;function W(t,s){L<0&&(H.push({x:300,y:300,vX:t+(e()-.5)/2,vY:s+(e()-.5)/2}),zzfx(1,.1,32,.2,.54,3,4.2,0,.42),L=10)}function U(t,s){D.push({which:Math.floor(1+e()*Z),x:t,y:s,rotation:0}),zzfx(.3,.1,550,.9,.48,5.8,0,21.7,.79)}let q=3,F=showHelp=1;pickups=[];let G,J=function(t,s){this.X=t,this.Y=s,this.id=e(),this.delete=function(){for(pkupId in pickups)pickups[pkupId].id==this.id&&pickups.splice(pkupId,1)},this.draw=function(){x.fillStyle="white",x.fillRect(this.X-20,this.Y-20,40,40),k("+",this.X-15,this.Y+10,4,1,"red"),radarItems.push(["blue",this.X,this.Y]),this.X-=X,this.Y-=I,((this.X-300)**2+(this.Y-300)**2)**.5<30&&(q<ee?(k("Press E to heal",this.X-120,this.Y-30,2,3,"yellow"),o[69]&&(q=ee,G=ee,this.delete(),zzfx(1,.1,426,.5,.04,0,.4,50.7,.68))):k("Your health is full",this.X-150,this.Y-30,2,3,"yellow")),(this.X<-100||this.Y<-100||this.X>700||this.Y>700)&&this.delete()}},K=function(t,s){this.X=t,this.Y=s,this.id=e(),this.delete=function(){for(pkupId in pickups)pickups[pkupId].id==this.id&&pickups.splice(pkupId,1)},this.draw=function(){x.fillStyle="#110",x.fillRect(this.X-30,this.Y-30,60,60),x.fillRect(this.X-10,this.Y-50,20,20),x.fillRect(this.X-30,this.Y+30,20,50),x.fillRect(this.X+10,this.Y+30,20,50),x.strokeStyle="#221",x.strokeRect(this.X-30,this.Y-30,60,60),x.strokeRect(this.X-10,this.Y-50,20,20),x.strokeRect(this.X-30,this.Y+30,20,50),x.strokeRect(this.X+10,this.Y+30,20,50),radarItems.push(["blue",this.X,this.Y]),this.X-=X,this.Y-=I,((this.X-300)**2+(this.Y-300)**2)**.5<50&&(k(te?"You are already praying":"Press E to pray to totem",this.X-180,this.Y-70,2,3,"yellow"),o[69]&&!te&&(te=1,G=q,gs=`grayscale(${20*e()+80}%)`,c.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter+=gs,c.style.filter+=gs,prayHandle=setInterval((t=>{gs=`grayscale(${20*e()+80}%)`,c.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter+=gs,c.style.filter+=gs,q=G}),1e3),setTimeout((e=>{te=0,clearInterval(prayHandle),c.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter=`hue-rotate(${100*(Z-5)}deg)`,zzfx(1,.5,400,2,.5,.1,.9,.15,0)}),7777),this.delete(),zzfx(1,.5,400,2,.5,.1,.9,.15,0))),(this.X<-100||this.Y<-100||this.X>700||this.Y>700)&&this.delete()}},N=1.07,Q=function(s,i){this.X=s,this.Y=i,this.id=e(),this.delete=function(){for(pkupId in pickups)pickups[pkupId].id==this.id&&pickups.splice(pkupId,1)},this.draw=function(){x.fillStyle="blue",x.fillRect(this.X-20,this.Y-20,40,40),x.strokeStyle=`hsl(${t/2},99%,50%)`,x.strokeRect(this.X-24,this.Y-24,48,48),k("SPD",this.X-21,this.Y+10,2,1,"lime"),radarItems.push(["blue",this.X,this.Y]),this.X-=X,this.Y-=I,((this.X-300)**2+(this.Y-300)**2)**.5<30&&(k("Press E to use",this.X-110,this.Y-30,2,3,"yellow"),o[69]&&(N=.8,this.delete(),zzfx(1,.1,426,.5,.04,0,.4,50.7,.68),c.style.filter+="sepia(80%)",setTimeout((e=>{c.style.filter=c.style.filter.replace("sepia(80%)","")}),500))),(this.X<-100||this.Y<-100||this.X>700||this.Y>700)&&this.delete()}},V=function(t,s){this.X=t,this.Y=s,this.id=e(),this.delete=function(){for(pkupId in pickups)pickups[pkupId].id==this.id&&pickups.splice(pkupId,1)},this.draw=function(){k("+‚ù§",this.X-20,this.Y+5,3,1,"lime"),radarItems.push(["cyan",this.X,this.Y]),this.X-=X,this.Y-=I,((this.X-300)**2+(this.Y-300)**2)**.5<40&&(k("Press E to use",this.X-110,this.Y-30,2,3,"yellow"),o[69]&&(q++,this.delete(),zzfx(1,.1,426,.5,.04,0,.4,50.7,.68))),(this.X<-100||this.Y<-100||this.X>700||this.Y>700)&&this.delete()}},Z=5,ee=3,te=!1;function se(){if(l){for(pkup of(d(10),function(){for(bloodPart of E)x.fillStyle=bloodPart.color,x.beginPath(),x.ellipse(bloodPart.x,bloodPart.y,bloodPart.size[0],bloodPart.size[1],bloodPart.rot,0,7),x.fill(),bloodPart.x-=X*bloodPart.perspective,bloodPart.y-=I*bloodPart.perspective,bloodPart.x<-100&&(bloodPart.x=650,bloodPart.y=$()),bloodPart.y<-100&&(bloodPart.x=$(),bloodPart.y=650),bloodPart.x>650&&(bloodPart.x=-100,bloodPart.y=$()),bloodPart.y>650&&(bloodPart.x=$(),bloodPart.y=-100),(A=Math.abs)(z=bloodPart.x-300)<50&&A(z=bloodPart.y-300)<50&&(bloodPart.x+=z/10,bloodPart.y+=z/10)}(),function(){for(grassBlock of T)x.fillStyle=grassBlock.color,x.fillRect(grassBlock.x,grassBlock.y,2,grassBlock.height),grassBlock.x-=X*grassBlock.perspective,grassBlock.y-=I*grassBlock.perspective,grassBlock.x<-100&&(grassBlock.x=700,grassBlock.y=$()),grassBlock.y<-100&&(grassBlock.x=$(),grassBlock.y=700),grassBlock.x>700&&(grassBlock.x=-100,grassBlock.y=$()),grassBlock.y>700&&(grassBlock.x=$(),grassBlock.y=-100),(A=Math.abs)(z=grassBlock.x-300)<50&&A(z=grassBlock.y-300)<50&&(grassBlock.x+=z/20,grassBlock.y+=z/20),n||(grassBlock.x+=Math.sin(t/5*grassBlock.perspective)/10)}(),function(){for(genId in D){for(gen=D[genId],i=0;i<9+gen.which;i++){let e=Math.floor(128*Math.sin(i*i*gen.which)+128);x.fillStyle=`rgb(${e},${e},${e})`,x.fillRect(gen.x,gen.y,50*Math.sin(gen.which**2+i*gen.which+gen.rotation),50*Math.cos(gen.which**2*i+gen.rotation)),C.indexOf(gen.which)>-1&&(gen.rotation+=.002)}k(gen.which.toString(),gen.x-20,gen.y-5,3.5,2,C.indexOf(gen.which)<0?"red":"lime"),gen.x-=X,gen.y-=I,radarItems.push(["lime",gen.x,gen.y]),(gen.x<-100||gen.x>700||gen.y<-100||gen.y>700)&&(D.splice(genId,1),M=!1),((gen.x-300)**2+(gen.y-300)**2)**.5<100&&C.indexOf(gen.which)<0&&(_==gen.which-1?(k("Press E to activate generator",gen.x-220,gen.y-20,2,5,"#0ff"),o[69]&&(C.push(gen.which),_=gen.which,zzfx(1,.1,127,.2,.63,0,0,28.9,.77),q<ee&&q++)):(k("Can't activate",gen.x-100,gen.y-50,2,5,"red"),o[69]&&t%5==0&&zzfx(1,.1,464,.1,.3,.1,.5,3.6,.82)))}}(),pickups))pkup.draw();!function(){for(enemy of w)P(enemy.X,enemy.Y,enemy.vX,enemy.vY),enemy.X>300?enemy.vX>-12&&(enemy.vX-=enemy.speed):enemy.vX<12&&(enemy.vX+=enemy.speed),enemy.Y>300?enemy.vY>-12&&(enemy.vY-=enemy.speed):enemy.vY<12&&(enemy.vY+=enemy.speed),enemy.X+=enemy.vX/2,enemy.Y+=enemy.vY/2,enemy.X-=X,enemy.Y-=I,(A=Math.abs)(z=enemy.X-300)<35&&A(z=enemy.Y-300)<35&&(te?(enemy.vX*=-1.2,enemy.vY*=-1.2,enemy.X+=2*enemy.vX,enemy.Y+=2*enemy.vY,zzfx(1,.1,1309,.2,.59,.1,2.5,0,.43)):(X=5*enemy.vX,I=5*enemy.vY,enemy.vX*=-1,enemy.vY*=-1,zzfx(1,.1,160,.1,.45,5,4.1,8.6,.93),q--));for(i in w){let e=w[i];(e.X<-100||e.Y<-100||e.X>700||e.Y>700)&&(w.splice(i,1),zzfx(.5,.1,409,0,1,.37,0,0,.24))}}(),function(){for(bulletId in H){let e=H[bulletId];for(enemy of(x.beginPath(),x.fillStyle="#fff",x.ellipse(e.x,e.y,9,9,0,0,6.28),x.fill(),(e.x<-100||e.y<-100||e.x>700||e.y>700)&&H.splice(bulletId,1),e.x+=2*e.vX,e.y+=2*e.vY,e.x-=X,e.y-=I,w))enemy.X<e.x?e.vX-=.04:e.vX+=.04,enemy.Y<e.y?e.vY-=.04:e.vY+=.04,((enemy.X-e.x)**2+(enemy.Y-e.y)**2)**.5<30&&(enemy.vX=3*e.vX,enemy.vY=3*e.vY,H.splice(bulletId,1))}L--}(),v(300,300,X,I),te||function(){for(i=0;i<q;i++)x.fillStyle="red",k("‚ù§Ô∏é",10+25*i,590,2,2,"red")}(),k("Generators left: "+(Z-_).toString(),5,25,2,1,"#af2"),function(){for(itemOnRadar of(x.drawImage(c,505,505,70,70),x.fillStyle="#111a",x.strokeStyle="#222a",x.fillRect(500,500,80,80),x.strokeRect(500,500,80,80),radarItems))x.fillStyle=itemOnRadar[0],x.fillRect(itemOnRadar[1]/10+508,itemOnRadar[2]/10+508,4,4),x.beginPath(),x.moveTo(540,540),x.strokeStyle=itemOnRadar[0],x.lineTo(itemOnRadar[1]/10+510,itemOnRadar[2]/10+510),x.stroke(),x.closePath();radarItems=[]}(),function(){let s=0,i=0;e()<.007+(ee-3)/3e3&&(s=1),e()<.006-C.length/9e3&&(i=1),o[38]&&(I-=.5,s&&l&&B($(),-100),i&&!M&&(U($(),-100),M=!0),e()<.005&&pickups.push(new J($(),-100)),e()<.002&&!te&&pickups.push(new K($(),-100)),e()<.004&&pickups.push(new Q($(),-100)),e()<.001&&pickups.push(new V($(),-100))),o[40]&&(I+=.5,s&&l&&B($(),650),i&&!M&&(U($(),650),M=!0),e()<.003&&pickups.push(new J($(),-100)),e()<.002&&!te&&pickups.push(new K($(),-100)),e()<.004&&pickups.push(new Q($(),-100)),e()<.001&&pickups.push(new V($(),-100))),o[37]&&(X-=.5,s&&l&&B(-100,$()),i&&!M&&(U(-100,$()),M=!0),e()<.003&&pickups.push(new J($(),-100)),e()<.002&&!te&&pickups.push(new K($(),-100)),e()<.004&&pickups.push(new Q($(),-100)),e()<.001&&pickups.push(new V($(),-100))),o[39]&&(X+=.5,s&&l&&B(650,$()),i&&!M&&(U(650,$()),M=!0),e()<.003&&pickups.push(new J($(),-100)),e()<.002&&!te&&pickups.push(new K($(),-100)),e()<.004&&pickups.push(new Q($(),-100)),e()<.001&&pickups.push(new V($(),-100))),o[76]&&(T.length=500,E.length=200,n=1),o[87]&&W(0,-1*e()-5),o[65]&&W(-1*e()-5,0),o[83]&&W(0,1*e()+5),o[68]&&W(1*e()+5,0),1==o[192]&&(aiBotOn||(aiBotOn=1,aiHandle=setInterval((s=>{for(p of(o[69]=1,pickups))"pickupHealing"==p.constructor.name&&q>=ee||"pickupTotem"==p.constructor.name&&te||(o[39]=o[37]=0,p.X>300?o[39]=1:o[37]=1,o[38]=o[40]=0,p.Y>300?o[40]=1:o[38]=1);for(g of D){if(g.which-1!=_)break;o[39]=o[37]=0,g.x>300?o[39]=1:o[37]=1,o[38]=o[40]=0,g.y>300?o[40]=1:o[38]=1}if(0==w.length)t%100==0&&(o[[38,40,39,37][Math.floor(4*e())]]=1);else{let t=eY=0;for(Y of w)t+=Y.X,eY+=Y.Y;t/=w.length,eY/=w.length,o[39]=o[37]=0,t<300?(o[39]=1,e()<.5&&W(-5,2*(e()-.5))):(o[37]=1,e()<.5&&W(5,2*(e()-.5))),o[38]=o[40]=0,eY<300?(o[40]=1,e()<.5&&W(2*(e()-.5),-5)):(o[38]=1,e()<.5&&W(2*(e()-.5),5))}}),100)))}(),o[77]&&(O=1),X/=N,I/=N,N<1.07&&(N+=.01),q<1&&(l=!1,d(0),w=[],D=[],X=900*(e()-.5),I=900*(e()-.5)),C.length==Z&&(zzfx(.6,.1,1,.5,.93,.4,.9,50,0),C.length=[],_=0,Z++,q=++ee,c.style.filter=`hue-rotate(${100*(Z-5)}deg)`,document.body.style.filter=`hue-rotate(${100*(Z-5)}deg)`,I=X=2e3*(e()-.5),f-=10)}else q<1?(d(5),k("YOU DIED!",120,300,e()/4+5,9*e(),"red"),X=0,I=0,k("Press space to reset",30,400,3.27,3,"yellow"),C.length=[],_=0,M=!1,pickups.length=[],aiBotOn&&(o[32]=1),o[32]&&(q=ee),o[32]=0):(x.font="5em monospace",d(30*Y),k("PRESS SPACE TO START",60+(Y-1)*(e()-.5)*200,300-100*Y-2e3*(Y-1),3,10,"#a41"),k("you can't go",100+(Y-1)*(e()-.5),400*Y+(Y-1)*(e()-.5),2,5+t%5,"blue"),k("back",200+100*Y,400+200*(Y-1),2-5*(Y-1),20*e()/(1/Y),"red"),k("in a world that changes every step",100+(Y-1)*(e()-.5)*200,450-300*(Y-1),1.5,5*Math.sin(t/5+e()/4),"navy"),k("made by kipkat",20,600-20*Y,1.4,0,"#242"),o[32]&&!b&&(b=1,zzfx(1,.1,23,.7,.61,0,2.7,1.5,.38)),Y<-100&&(l=1,zzfx(1,.1,23,.7,.61,0,2.7,1.5,.38)),b&&(Y-=.01),F<1400&&b&&(k("You are trapped in a maze",20,700-F,2.8,5,"#ff0",0),k("To get back to your home",100,800-F,2,3,"#f00",0),k("you must turn on the generators",50,850-F,2,3,"#f00",0),k("in order. That will enable a bomb that",20,900-F,1.8,3,"#f00",0),k("will break this world.",110,950-F,2,3,"#f00",1),k("Everything disappears as you pass by it.",10,1e3-F,1.8,3,"#f00",1),k("Move with the arrow keys",800-F,1050-F,2,3.5,"#fff",1),k("Avoid the squares",850-F,1100-F,3,3,"#0f0",1),P(1340-F,1090-F,F/20,F/30),k("Use W, A, S, D to fire",900-F,1150-F,2.4,3,"#000",1),k("Use E to interact with objects",950-F,1200-F,2.4,3,"#0a0",1),v(300,1526-F,(1226-F)/70,(1226-F)/100),F+=1),F>1225&&(l=1),o[77]&&(O=1));requestAnimationFrame(se,t++)}</script>