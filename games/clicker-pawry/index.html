<!doctype html><meta content="width=device-width" name=viewport><title>Clicker Pawry - js13kGames 2025</title><meta content="A black cat clicker roguelite with parry timing mechanics." name=description><meta content=#111111 name=theme-color><style>@keyframes cd{0%{background-position:0 0,50px 50px}to{background-position:100px 100px,150px 150px}}:root{--bg:#050505;--p1:#4a5a8a;--p2:#3a4f7a;--accent:#39a8ff;--accent2:#e34a4a}body,html{height:100%}*,body{font-family:Arial,"Helvetica Neue",Helvetica,sans-serif}body{margin:0;color:#fff;background:repeating-conic-gradient(var(--p1) 0 25%,var(--p2) 25% 50%) 0 0/100px 100px,repeating-conic-gradient(var(--p2) 0 25%,var(--p1) 25% 50%) 50px 50px/100px 100px;animation:cd 25s linear infinite}#cv{display:block;max-width:100vw;max-height:100vh}.start-screen{position:fixed;inset:0;z-index:10;display:grid;place-items:center;color:#111;background:0 0}.start-card{background:rgba(17,17,17,.9);color:#fff;padding:24px 20px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.35);width:min(92vw,420px);text-align:center;border:1px solid rgba(255,255,255,.08)}.title{margin:0 0 6px;font-size:1.6rem;letter-spacing:.5px}.tagline{margin:0 0 16px;color:#cfd8e3;font-size:.95rem}.record-display{background:rgba(255,215,0,.1);border:1px solid gold;border-radius:8px;padding:8px 16px;margin-bottom:20px;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}.record-label,.record-value{color:gold;font-size:14px;font-weight:700}.record-value{color:#fff;font-size:16px}.btns{display:grid;gap:10px;margin-top:8px}button.btn{appearance:none;border:0;border-radius:10px;padding:12px 14px;font-size:1rem;font-weight:600;cursor:pointer;color:#dedede;background:var(--p1);transition:transform 60ms ease,box-shadow .2s ease,background .3s ease;box-shadow:0 2px 0 rgba(0,0,0,.4)}button.btn:hover{transform:translateY(-1px)}button.btn:active{transform:translateY(0);box-shadow:none}button.btn.alt{background:var(--p2)}button.btn.secondary{background:#555;color:#fff}button.btn.danger{background:var(--accent2);color:#fff}button.btn[disabled]{opacity:.5;cursor:not-allowed}.modal{position:fixed;inset:0;z-index:20;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)}.modal-content{background:rgba(17,17,17,.95);color:#fff;padding:0;border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.5);width:min(90vw,500px);max-height:80vh;overflow-y:auto;border:1px solid rgba(255,255,255,.1)}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px 16px;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header h2{margin:0;font-size:1.4rem;color:var(--accent)}.close-btn{background:0 0;border:0;color:#ccc;font-size:24px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background .2s ease}.close-btn:hover{background:rgba(255,255,255,.1);color:#fff}.modal-body{padding:20px 24px 24px}.howto-section{margin-bottom:20px}.howto-section:last-child{margin-bottom:0}.howto-section h3{margin:0 0 8px;font-size:1.1rem;color:var(--accent)}.howto-section p{margin:4px 0;line-height:1.4;color:#e0e0e0}.howto-section p strong{color:#fff}.game-container{width:100%;height:100vh;background:repeating-conic-gradient(var(--p1) 0 25%,var(--p2) 25% 50%) 0 0/100px 100px,repeating-conic-gradient(var(--p2) 0 25%,var(--p1) 25% 50%) 50px 50px/100px 100px;animation:cd 25s linear infinite;display:flex;justify-content:center;align-items:stretch;position:fixed;top:0;left:0;z-index:999;padding:0}.game-container canvas{width:100%;height:100%}</style><div class=start-screen id=start aria-labelledby=t aria-modal=true role=dialog><div class=start-card><h1 class=title id=t>Clicker Pawry</h1><p class=tagline>A Black Cat Clicker Roguelite with Parry Timing<div class=record-display id=record-display style=display:none><span class=record-label>Best Record:</span> <span class=record-value id=record-value>Floor 0</span></div><div class=btns><button class=btn id=btn-new>New Run</button> <button class="btn secondary" id=btn-howto>How To Play</button> <button class="btn danger" id=btn-clear>Clear Data</button></div></div></div><div class=modal id=howto-modal style=display:none><div class=modal-content><div class=modal-header><h2>How To Play</h2><button class=close-btn id=close-howto>√ó</button></div><div class=modal-body><div class=howto-section><h3>üéØ Controls</h3><p><strong>Tap/Click on ring:</strong> Parry incoming attacks<p><strong>Berserk Mode:</strong> Spam click the central button, you are immune to damage.</div><div class=howto-section><h3>‚öîÔ∏è Combat</h3><p><strong>White rings:</strong> Normal attacks - parry to avoid damage<p><strong>Red rings:</strong> Heavy attacks - damage x2<p><strong>Perfect Parry:</strong> Deal 2√ó damage and avoid damage<p><strong>Good Parry:</strong> Block the attack but deal normal damage</div><div class=howto-section><h3>üèÜ Goal</h3><p>Beat 12 floors of bosses to reach the endless mode. Spend gold on permanent upgrades to get stronger!</div></div></div></div><div class=game-container id=game-container style=display:none><canvas id=cv></canvas></div><noscript>Please enable JavaScript to play.</noscript><script>"undefined"!=typeof window&&(window.ClickerPawryConstants={FONT_SCALE:1.2,PLAYER_BASE_STATS:{MAX_HP:9,MAX_STAMINA:100,BASE_STAMINA_REGEN:10,BASE_DAMAGE:1},DRAFT_OPTIONS:{HEAL:{name:"Heal",description:"Restore 2 hearts",effect:"heal"},GOLD:{name:"Bonus Gold",description:"Gain 20 extra gold",effect:"gold"}},SAVE_KEYS:{PERSISTENT_DATA:"js13k25_clickerpawry",RUN_DATA:"js13k25_clickerpawry_run"},META_UPGRADES:{MAX_STAMINA:{name:"Max Stamina",description:"+20 max stamina per level",maxLevel:5,costs:[60,120,200,300,440],effect:t=>20*t},STAMINA_REGEN:{name:"Stamina Regen",description:"+2/s stamina regen per level",maxLevel:5,costs:[60,120,200,300,440],effect:t=>2*t},ATTACK_POWER:{name:"Attack Power",description:"+1 per level",maxLevel:5,costs:[80,140,220,320,460],effect:t=>1*t}},RING_TYPES:{WHITE:"W",BLUE:"B",RED:"R"},PARRY_WINDOWS:{PERFECT:80,GOOD:160},ENEMY_ARCHETYPES:{A:{name:"Mice",patterns:{white:.7,red:.3},interval:800,ringDurations:{white:950,red:1e3}},C:{name:"Dog",patterns:{white:.8,red:.2},interval:1e3,ringDurations:{white:850,red:800}}},RING_DAMAGE:{MINIBOSS:{W:1,B:0,R:1},MAJOR:{W:1,B:0,R:1}},ENEMY_BASE_HP:[0,12,14,25,18,20,40,26,28,60,34,36,85],GAME_STATES:{LOBBY:"lobby",DRAFT:"draft",FIGHT:"fight",VICTORY:"victory",DEFEAT:"defeat",ENDLESS:"endless"}}),function(){const t="js13k25_clickerpawry",s=document.getElementById("start"),i=document.getElementById("btn-new"),e=document.getElementById("btn-howto"),h=document.getElementById("btn-clear"),l=document.getElementById("howto-modal"),r=document.getElementById("close-howto"),n=document.getElementById("record-display"),a=document.getElementById("record-value");function o(){try{const s=localStorage.getItem(t);if(console.log("Loading record from localStorage:",t,s),s){const t=JSON.parse(s),i=t.highestFloor||0;console.log("Parsed data:",t,"highestFloor:",i),i>0?(a.textContent=`Floor ${i}`,n.style.display="flex",console.log("Record displayed:",i)):(n.style.display="none",console.log("No record to display"))}else n.style.display="none",console.log("No persistent data found")}catch(t){console.warn("Could not load record:",t),n.style.display="none"}}function c(t){t.style.display="none",t.setAttribute("aria-hidden","true")}o(),window.updateRecordDisplay=o,i.addEventListener("click",()=>function(){s.style.display="none";const t=document.getElementById("game-container");t&&(t.style.display="flex");const i=document.getElementById("cv");i&&i.focus&&i.focus()}()),e.addEventListener("click",()=>{return(t=l).style.display="flex",void t.setAttribute("aria-hidden","false");var t}),r.addEventListener("click",()=>c(l)),l.addEventListener("click",t=>{t.target===l&&c(l)}),h.addEventListener("click",()=>{confirm("‚ö†Ô∏è Are you sure you want to delete all your save data? This action is irreversible!")&&(Object.keys(localStorage).forEach(t=>{t.startsWith("js13k25_clickerpawry")&&localStorage.removeItem(t)}),alert("‚úÖ Data deleted successfully!"),window.location.reload())}),document.addEventListener("keydown",t=>{"Escape"===t.key&&"flex"===l.style.display&&c(l)})}();let t=null,s=null,i=null,e=0;const h={h:new Image,s:new Image,l:!1},l=window.ClickerPawryConstants;function r(){s=document.getElementById("cv"),i=s.getContext("2d"),n(),function(){let t=0;function s(){t++,2===t&&(h.l=!0)}h.h.onload=s,h.s.onload=s,h.h.src="catHappy.png",h.s.src="catHappy.png"}(),t=new g,t.sg(),requestAnimationFrame(m)}function n(){let t=Math.min(window.innerWidth,400),e=window.innerHeight-40;t>400&&(t=400),s.width=t,s.height=e,s.style.width=t+"px",s.style.height=e+"px",s.style.display="block",s.style.margin="20px auto 0",i.imageSmoothingEnabled=!1}function a(t,s="normal"){const i=Math.round(t*l.FONT_SCALE);return"bold"===s?`bold ${i}px Arial`:`${i}px Arial`}class o{constructor(){this.hp=l.PLAYER_BASE_STATS.MAX_HP,this.mh=l.PLAYER_BASE_STATS.MAX_HP,this.st=l.PLAYER_BASE_STATS.MAX_STAMINA,this.ms=l.PLAYER_BASE_STATS.MAX_STAMINA,this.sr=l.PLAYER_BASE_STATS.BASE_STAMINA_REGEN,this.bd=l.PLAYER_BASE_STATS.BASE_DAMAGE,this.g=0,this.hf=0,this.mu={MAX_STAMINA:0,STAMINA_REGEN:0,ATTACK_POWER:0},this.cf=1,this.sk=[],this.pp=0,this.ru=0,this.lsu=Date.now(),this.set=0,this.lfls()}snr(){this.ms=this.gms(),this.sr=this.gsr(),this.bd=this.gbd(),this.hp=this.mh,this.st=this.ms,this.cf=1,this.sk=[],this.pp=0,this.ru=0,this.lsu=Date.now(),this.set=0,this.srs()}amu(){this.ms=this.gms(),this.sr=this.gsr(),this.bd=this.gbd(),this.st>this.ms&&(this.st=this.ms)}u(t){const s=Date.now(),i=s-this.lsu;if(this.lsu=s,this.st<=0&&0===this.set&&(this.set=s),this.st<this.ms){const t=750;if(0===this.set||s-this.set>t){const t=this.sr*i/1e3;this.st=Math.min(this.ms,this.st+t),this.set>0&&(this.set=0)}}}ca(){return this.st>=1}a(){return this.ca()?(this.st=Math.max(0,this.st-1),this.bd):0}td(t,s=null){return this.hp=Math.max(0,this.hp-t),s&&t>0&&s.tde(),this.hp<=0}h(t){this.hp=Math.min(this.mh,this.hp+t)}ag(t){this.g+=t,this.stls()}gms(){return l.PLAYER_BASE_STATS.MAX_STAMINA+l.META_UPGRADES.MAX_STAMINA.effect(this.mu.MAX_STAMINA)}gsr(){return l.PLAYER_BASE_STATS.BASE_STAMINA_REGEN+l.META_UPGRADES.STAMINA_REGEN.effect(this.mu.STAMINA_REGEN)}gbd(){return l.PLAYER_BASE_STATS.BASE_DAMAGE+l.META_UPGRADES.ATTACK_POWER.effect(this.mu.ATTACK_POWER)}cau(t){const s=l.META_UPGRADES[t],i=this.mu[t];if(i>=s.maxLevel)return!1;const e=s.costs[i];return this.g>=e}bu(t){if(!this.cau(t))return!1;const s=l.META_UPGRADES[t],i=this.mu[t],e=s.costs[i];return this.g-=e,this.mu[t]++,this.ms=this.gms(),this.sr=this.gsr(),this.bd=this.gbd(),this.stls(),!0}stls(){try{const t={gold:this.g,metaUpgrades:this.mu,highestFloor:this.hf||0};localStorage.setItem(l.SAVE_KEYS.PERSISTENT_DATA,JSON.stringify(t))}catch(t){}}srs(){try{const t={currentFloor:this.cf,hp:this.hp,stamina:this.st,skills:this.sk,perfectParries:this.pp,rerollsUsed:this.ru};localStorage.setItem(l.SAVE_KEYS.RUN_DATA,JSON.stringify(t))}catch(t){}}lfls(){try{const t=localStorage.getItem(l.SAVE_KEYS.PERSISTENT_DATA);if(t){const s=JSON.parse(t);return this.g=s.gold||0,this.hf=s.highestFloor||0,this.mu={...this.mu,...s.metaUpgrades},this.amu(),!0}}catch(t){}return!1}lrs(){try{const t=localStorage.getItem(l.SAVE_KEYS.RUN_DATA);if(t){const s=JSON.parse(t);return this.cf=s.currentFloor||1,this.hp=s.hp||this.mh,this.st=s.stamina||this.ms,this.sk=s.skills||[],this.pp=s.perfectParries||0,this.ru=s.rerollsUsed||0,!0}}catch(t){}return!1}}class c{constructor(t,s){this.x=t,this.y=s,this.l=400,this.ml=400,this.s=0,this.ms=2}u(t){this.l-=t;const s=1-this.l/this.ml;if(s<.3)this.s=s/.3*this.ms;else{const t=(s-.3)/.7;this.s=this.ms*(1-t)}return this.l>0}d(t){if(this.s<=0)return;const s=Math.max(0,this.l/this.ml);t.save(),t.globalAlpha=s,t.translate(this.x,this.y),t.scale(this.s,this.s),this.dp(t),t.restore()}dp(t){t.fillStyle="#000",t.strokeStyle="#333",t.lineWidth=1,t.beginPath(),t.ellipse(0,0,12,8,0,0,2*Math.PI),t.fill(),t.stroke(),[{x:-8,y:-10},{x:-3,y:-12},{x:3,y:-12},{x:8,y:-10}].forEach(s=>{t.beginPath(),t.arc(s.x,s.y,3,0,2*Math.PI),t.fill(),t.stroke()})}}class f{constructor(t,s,i,e,h,l){this.x=t,this.y=s,this.c=i,this.v=e,this.s=h,this.l=l,this.ml=l,this.g=.1}u(t){return this.x+=this.v.x*t/16,this.y+=this.v.y*t/16,this.v.y+=this.g,this.l-=t,this.l/this.ml>0}d(t){const s=Math.max(0,this.l/this.ml);t.save(),t.globalAlpha=s,t.fillStyle=this.c,t.beginPath(),t.arc(this.x,this.y,this.s,0,2*Math.PI),t.fill(),t.restore()}}class d{constructor(t,s,i,e=60,h=30){this.t=t,this.st=s,this.d=i,this.sr=e,this.tr=h,this.ia=!0,this.hi=!1,this.x=0,this.y=0}gp(t){return Math.min(1,(t-this.st)/this.d)}gcr(t){const s=this.gp(t);return this.sr-(this.sr-this.tr)*s}hrt(t){return this.gp(t)>=1}gpt(t,s=1){const i=this.st+this.d-t,e=Math.abs(i),h=l.PARRY_WINDOWS.PERFECT*s,r=l.PARRY_WINDOWS.GOOD*s;return e<=h?"perfect":e<=r?"good":"miss"}ici(t,s,i){const e=this.gcr(i);return Math.sqrt((t-this.x)**2+(s-this.y)**2)<=e}}class p{constructor(){this.cs="lobby",this.p=null,this.ce=null,this.r=[],this.dc=[],this.lat=0,this.nrt=0,this.bm=!1,this.bd=0}tt(t){this.cs=t,"draft"===t?this.gdc():"fight"===t&&this.cef()}gdc(){this.dc=[],this.dc.push({option:l.DRAFT_OPTIONS.HEAL,type:"heal"}),this.dc.push({option:l.DRAFT_OPTIONS.GOLD,type:"gold"})}sdc(t){if(t>=0&&t<this.dc.length){switch(this.dc[t].type){case"heal":this.p.h(2);break;case"gold":this.p.ag(20)}this.eem?(this.cef(),this.tt("endless")):this.tt("fight")}}cef(){const t=this.p.cf;let s=20*Math.pow(1.15,t-1);const i=this.gaf(t);this.ce={hp:Math.floor(s),maxHp:Math.floor(s),archetype:i,archetypeData:l.ENEMY_ARCHETYPES[i],damageFlashUntil:0},this.r=[],this.lat=0,this.nrt=Date.now()+1e3}gaf(t){const s=Object.keys(l.ENEMY_ARCHETYPES);return s[Math.floor(Math.random()*s.length)]}hc(t,s,i){if(!this.ce||this.ce.hp<=0)return null;const e=this.ap(i,t,s);if(e){let t=this.p.bd;return"perfect"===e.timing&&(this.p.pp++,t=2*this.p.bd),t=Math.ceil(t),this.ce.hp=Math.max(0,this.ce.hp-t),this.ce.damageFlashUntil=i+200,this.ce.hp<=0&&this.hv(),{parry:e,damage:t}}}hv(){const t=this.cgr();this.lgr=t,this.p.ag(t),this.p.cf>this.p.hf&&(this.p.hf=this.p.cf,window.updateRecordDisplay&&window.updateRecordDisplay()),this.p.cf++,this.p.srs(),13===this.p.cf&&(this.eem=!0),this.tt("victory")}hd(){this.rf=this.p.cf,this.p.hp=this.p.mh,this.p.cf=1,this.p.pp=0,this.tt("defeat")}ap(t,s,i){let e=[];for(const l of this.r)if(l.ia&&l.ici(s,i,t)){const s=h.st+l.d-t,i=Math.abs(s);e.push({ring:l,absTime:i,spawnTime:h.st})}if(0===e.length)return null;e.sort((t,s)=>Math.abs(t.absTime-s.absTime)<100?t.spawnTime-s.spawnTime:t.absTime-s.absTime);const l=e[0].ring,r=l.gpt(t,1);return l.ia=!1,this.ge&&this.ge.crp(l.x,l.y,l.t,"miss"!==r),"miss"!==r?{ring:l,timing:r}:null}cbp(t){return!1}cgr(){let t=Math.floor(10+2*this.p.cf+5*Math.random())+Math.min(5,this.p.pp);if(this.p.cf>13){const s=this.p.cf-13;t=Math.floor(t*(1+.1*s))}return t}u(t){this.p&&this.p.u(t),("fight"===this.cs||"endless"===this.cs)&&this.ce&&this.ce.hp>0&&this.uc()}uc(){const t=Date.now();this.ubm(),this.ur(t),this.gr(t)}ubm(){if(this.bm){const t=.8;this.p.st=Math.max(0,this.p.st-t),this.p.st<=0&&(this.bm=!1)}}cub(){return!this.bm&&this.p.st>=this.p.ms}ab(){return!!this.cub()&&(this.bm=!0,!0)}ur(t){for(let s=this.r.length-1;s>=0;s--){const i=this.r[s];i.ia?(i.hrt(t)&&!i.hi&&(i.hi=!0,this.hri(i)),t-i.st>i.d+1e3&&this.r.splice(s,1)):this.r.splice(s,1)}}hri(t){if(this.ge&&this.ge.crp(t.x,t.y,t.t,!1),this.bm)return;let s=l.RING_DAMAGE.MAJOR[t.t];this.p.td(s,this.ge)&&this.hd()}gsp(t){const i=s.width||400,e=s.height||600;for(let s=0;s<50;s++){const s=40+Math.random()*(i-80),h=130+Math.random()*(e-90-80-80);let l=!1;for(const t of this.r)if(t.ia&&Math.sqrt((s-t.x)**2+(h-t.y)**2)<80){l=!0;break}if(!l)return t.x=s,void(t.y=h)}t.x=40+Math.random()*(i-80),t.y=130+Math.random()*(e-90-80-80)}gr(t){if(t<this.nrt)return;const s=this.ce.archetypeData;switch(this.ce.archetype){case"A":case"C":this.gcr(t,s)}}gcr(t,s){const i=this.srt(s.patterns),e=this.grd(i,s),h=new d(i,t,e);this.gsp(h),this.r.push(h);let l=s.interval;l*=Math.max(.5,1-.05*(this.p.cf-1)),this.nrt=t+l}srt(t){return Math.random()<t.white?l.RING_TYPES.WHITE:l.RING_TYPES.RED}grd(t,s){let i=s.ringDurations[t.toLowerCase()]||1300;return i*=Math.max(.6,1-.04*(this.p.cf-1)),i}}class g{constructor(){this.p=new o,this.gs=new p,this.gs.p=this.p,this.gs.ge=this,this.fm=[],this.ss={x:0,y:0,d:0},this.rf={a:0,d:0},this.cdt=0,this.pt=[],this.pe=[],this.ei={},this.lei(),this.sih(),this.sr={lobby:this.rl.bind(this),draft:this.rd.bind(this),fight:this.renderFight.bind(this),victory:this.rv.bind(this),defeat:this.rdf.bind(this),endless:this.renderFight.bind(this)}}lei(){Object.entries({A:"miceEnemy.png",C:"dogEnemy.png"}).forEach(([t,s])=>{const i=new Image;i.onload=()=>{this.ei[t]=i},i.src=s})}sg(){const t=this.p.lfls(),s=this.p.lrs();t||s||this.p.snr(),this.gs.tt("lobby")}sih(){s.addEventListener("pointerdown",t=>{t.preventDefault();const i=s.getBoundingClientRect(),e=t.clientX-i.left,h=t.clientY-i.top;this.hi(e,h)}),s.addEventListener("mousemove",t=>{const i=s.getBoundingClientRect(),e=t.clientX-i.left,h=t.clientY-i.top;this.hmm(e,h)}),window.addEventListener("keydown",t=>{this.hki(t.key)})}hi(t,s){const i=Date.now();switch(this.gs.cs){case"lobby":this.hli(t,s);break;case"draft":this.hdi(t,s);break;case"fight":case"endless":this.hfi(t,s,i);break;case"victory":this.gs.tt("draft");break;case"defeat":this.gs.tt("lobby")}}hki(t){switch(t){case"Escape":"fight"===this.gs.cs&&this.gs.tt("lobby");break;case"1":case"2":if("draft"===this.gs.cs){const s=parseInt(t)-1;this.gs.sdc(s)}}}hmm(t,s){}u(t){this.gs.u(t),this.ufm(t),this.ude(t),this.hr()}afm(t,s,i){this.fm.push({text:t,x:s,y:i,startTime:Date.now(),duration:1e3})}tde(){this.ss={x:8*(Math.random()-.5),y:8*(Math.random()-.5),duration:200},this.rf={a:.15,d:200},this.cdt=1e3}ufm(t){const s=Date.now();this.fm=this.fm.filter(t=>s-t.startTime<t.duration)}ude(t){this.ss.d>0&&(this.ss.d-=t,this.ss.d<=0&&(this.ss.x=0,this.ss.y=0)),this.rf.d>0&&(this.rf.d-=t,this.rf.a=Math.max(0,this.rf.d/200*.15)),this.cdt>0&&(this.cdt-=t),this.upt(t),this.upe(t)}upt(t){for(let s=this.pt.length-1;s>=0;s--)this.pt[s].u(t)||this.pt.splice(s,1)}crp(t,s,i,e){const h=e?12:8,l=this.grc(i),r=e?[`${l}`,"#fff","#ff0"]:["#f00","#f44","#a00"];for(let i=0;i<h;i++){const l=2*Math.PI*i/h+.3*Math.random(),n=e?3+2*Math.random():2+1.5*Math.random(),a={x:Math.cos(l)*n,y:Math.sin(l)*n-2*Math.random()},o=r[Math.floor(Math.random()*r.length)],c=e?2+2*Math.random():1.5+1.5*Math.random(),d=e?800+400*Math.random():600+300*Math.random();this.pt.push(new f(t,s,o,a,c,d))}}grc(t){switch(t){case l.RING_TYPES.WHITE:return"#fff";case l.RING_TYPES.RED:return"#e34a4a";default:return"#fff"}}upe(t){for(let s=this.pe.length-1;s>=0;s--)this.pe[s].u(t)||this.pe.splice(s,1)}cpe(t,s){this.pe.push(new c(t,s))}hr(){this.rt||(this.rt=setTimeout(()=>{n(),this.rt=null},100))}r(){i.clearRect(0,0,s.width,s.height),i.save(),this.ss.d>0&&i.translate(this.ss.x,this.ss.y);const t=this.sr[this.gs.cs];t&&t(),i.restore(),this.rf.a>0&&(i.fillStyle=`rgba(255,0,0,${this.rf.a})`,i.fillRect(0,0,s.width,s.height))}rl(){this.dt("LOBBY"),this.dps(),this.dmu(),this.dsb()}rd(){this.dt(`FLOOR ${this.p.cf}/12`),this.p.cf>=13&&(i.fillStyle="#FFD700",i.font=a(18,"bold"),i.textAlign="center",i.fillText("üéâEndless",s.width/2,70)),this.dps(),this.dsc()}renderFight(){this.dph(),this.de(),this.dr(),this.dpt(),this.dpe(),this.dbb(),this.dcab(),this.dfm()}rv(){this.dt("VICTORY!"),this.dvs(),this.dcp()}rdf(){this.dt("DEFEATED"),this.dds(),this.drtl()}dbg(){}dt(t){i.fillStyle="#fff",i.font=a(24,"bold"),i.textAlign="center",i.fillText(t,s.width/2,40)}dps(){const t=[`Gold: ${this.p.g}`,`Floor: ${this.p.cf}`,`HP: ${this.p.hp}/${this.p.mh}`];i.fillStyle="#ccc",i.font=a(16),i.textAlign="left",t.forEach((t,s)=>i.fillText(t,20,80+25*s))}dph(){const t=s.height-60;if(h.l){let s=this.cdt>0?h.s:this.p.hp>=5?h.h:h.s;i.drawImage(s,15,t,60,60)}const e=t+5;for(let t=0;t<this.p.mh;t++){const s=85+22*t,i=t<this.p.hp;this.dh(s,e,18,i)}i.fillStyle="#fff",i.font=a(12),i.textAlign="left",i.fillText(`${this.p.hp}/${this.p.mh}`,85,e+30);const l=t+45;i.fillStyle="#2a2a2a",i.fillRect(84,l-1,182,14),i.fillStyle="#1a1a1a",i.fillRect(85,l,180,12);const r=this.p.st/this.p.ms*180;if(r>0){const t=i.createLinearGradient(85,l,85,l+12);t.addColorStop(0,"#ff8c42"),t.addColorStop(1,"#ff6b1a"),i.fillStyle=t,i.fillRect(85,l,r,12)}i.fillStyle="#ff8c42",i.font=a(11,"bold"),i.textAlign="center",i.fillText(`${Math.floor(this.p.st)}/${this.p.ms}`,175,l-5)}dh(t,s,e,h){const l=e/2;i.save(),i.translate(t+l,s+l),i.beginPath(),i.moveTo(0,.3*l),i.bezierCurveTo(.8*-l,.3*-l,.8*-l,.3*l,0,.8*l),i.bezierCurveTo(.8*l,.3*l,.8*l,.3*-l,0,.3*l),i.closePath(),h&&(i.fillStyle="#ff5757",i.fill()),i.strokeStyle=h?"#cc3333":"#666",i.lineWidth=1.5,i.stroke(),h||(i.fillStyle="#222",i.fill()),i.restore()}de(){if(!this.gs.ce)return;const t=this.gs.ce,e=s.width/2,h=.4*s.height;this.des(t.archetype,e,h,60);const l=.6*s.width,r=(s.width-l)/2;i.fillStyle="#333",i.fillRect(r,50,l,8);const n=t.hp/t.maxHp;i.fillStyle="#ff5757",i.fillRect(r,50,l*n,8),i.fillStyle="#fff",i.font=a(12,"bold"),i.textAlign="center",i.fillText(`HP: ${Math.ceil(t.hp)}/${t.maxHp}`,s.width/2,73),i.fillStyle="#fff",i.font=a(18,"bold"),i.textAlign="center";const o=t.archetypeData?.name||"Unknown";i.fillText(o,s.width/2,35)}des(t,s,e,h){i.save();const l=e+3*Math.sin(.003*Date.now()),r=Date.now();this.ce&&r<this.ce.damageFlashUntil&&(i.fillStyle="rgba(255,0,0,0.3)",i.beginPath(),i.arc(s,l,1.2*h,0,2*Math.PI),i.fill());const n=1.2*h;if(this.ei[t]){const e=this.ei[t],h=2*n;i.drawImage(e,s-n,l-n,h,h)}else i.fillStyle="#2b2b2b",i.strokeStyle="#111",i.lineWidth=3,i.beginPath(),i.arc(s,l,n,0,2*Math.PI),i.fill(),i.stroke();i.restore()}dr(){const t=Date.now();this.gs.r.forEach(s=>{if(!s.ia)return;const e=s.gcr(t);if(e<s.tr)return;let h,r;switch(s.t){case l.RING_TYPES.WHITE:h="#fff",r="rgba(255,255,255,0.3)";break;case l.RING_TYPES.RED:h="#e34a4a",r="rgba(227,74,74,0.4)";break;default:h="#fff",r="rgba(255,255,255,0.3)"}i.strokeStyle=r,i.lineWidth=8,i.beginPath(),i.arc(s.x,s.y,e,0,2*Math.PI),i.stroke(),i.strokeStyle=h,i.lineWidth=3,i.beginPath(),i.arc(s.x,s.y,e,0,2*Math.PI),i.stroke(),i.strokeStyle="rgba(255,255,255,0.3)",i.lineWidth=1,i.beginPath(),i.arc(s.x,s.y,e-2,0,2*Math.PI),i.stroke(),i.strokeStyle="rgba(255,255,255,0.15)",i.lineWidth=2,i.beginPath(),i.arc(s.x,s.y,s.tr,0,2*Math.PI),i.stroke();const n=s.st+s.d-t;if(Math.abs(n)<=l.PARRY_WINDOWS.GOOD){let h;switch(s.gpt(t)){case"perfect":h="#0f0";break;case"good":h="#ff0";break;default:h="#f00"}i.fillStyle=h,i.globalAlpha=.6,i.beginPath(),i.arc(s.x,s.y-e-15,4,0,2*Math.PI),i.fill(),i.globalAlpha=1}})}dfm(){const t=Date.now();this.fm.forEach(s=>{const e=(t-s.startTime)/s.duration,h=Math.max(0,1-e),l=30*e;i.save(),i.globalAlpha=h,s.text.includes("PERFECT")?(i.fillStyle="#0f0",i.font=a(18,"bold")):s.text.includes("GOOD")?(i.fillStyle="#ff0",i.font=a(16,"bold")):s.text.includes("DMG")?(i.fillStyle="#ff8800",i.font=a(14,"bold")):(i.fillStyle="#fff",i.font=a(14)),i.textAlign="center",i.fillText(s.text,s.x,s.y-l),i.restore()})}dpt(){this.pt.forEach(t=>t.d(i))}dpe(){this.pe.forEach(t=>t.d(i))}dmu(){i.fillStyle="#fff",i.font=a(18),i.textAlign="left",i.fillText("Meta Upgrades:",20,160);let t=0;Object.entries(l.META_UPGRADES).forEach(([e,h])=>{const l=this.p.mu[e],r=l>=h.maxLevel,n=this.p.cau(e),o=r?0:h.costs[l],c=190+t;i.fillStyle=n&&!r?"rgba(57,168,255,0.1)":"rgba(100,100,100,0.05)",i.fillRect(15,c-15,s.width-30,40),i.fillStyle=r?"#FFD700":n?"#fff":"#888",i.font=a(14,"bold"),i.textAlign="left",i.fillText(`${h.name} (${l}/${h.maxLevel})`,25,c),i.fillStyle="#ccc",i.font=a(12),i.fillText(h.description,25,c+15),i.textAlign="right",r?(i.fillStyle="#FFD700",i.font=a(12,"bold"),i.fillText("MAX",s.width-25,c+8)):(i.fillStyle=n?"#39a8ff":"#888",i.font=a(14,"bold"),i.fillText(`${o}g`,s.width-25,c+8)),t+=45}),i.textAlign="left"}dsc(){if(0===this.gs.dc.length)return;const t=Math.max(120,(s.height-200)/2+40);i.fillStyle="#fff",i.font=a(20),i.textAlign="center",i.fillText("Choose an Option:",s.width/2,t-50),this.gs.dc.forEach((e,h)=>{const l=t+100*h,r=e.option;i.fillStyle="rgba(57,168,255,0.1)",i.fillRect(12,l-30,s.width-30+6,85),i.strokeStyle="rgba(57,168,255,0.3)",i.lineWidth=2,i.strokeRect(12,l-30,s.width-30+6,85),i.fillStyle="#fff",i.font=a(18,"bold"),i.textAlign="left",i.fillText(`${r.name}`,25,l-8),i.font=a(12),i.fillStyle="#ccc",i.fillText(r.description,25,l+15),i.fillStyle="#39a8ff",i.font=a(32,"bold"),i.textAlign="right",i.fillText((h+1).toString(),s.width-15-15,l+10),i.fillStyle="#888",i.font=a(10),i.textAlign="right",i.fillText(`Press ${h+1} or Click`,s.width-15-15,l+30)})}dsb(){const t=(s.width-200)/2,e=s.height-100;i.fillStyle="#39a8ff",i.fillRect(t,e,200,50),i.fillStyle="#fff",i.font="bold 18px Arial",i.textAlign="center",i.fillText("Start Run",s.width/2,e+32)}dvs(){i.fillStyle="#6ab8ff",i.font="18px Arial",i.textAlign="center",i.fillText("Floor Cleared!",s.width/2,120);const t=[`Perfect Parries: ${this.p.pp}`,`Total Gold: ${this.p.g}`];i.fillStyle="#ccc",i.font="14px Arial",t.forEach((t,e)=>{i.fillText(t,s.width/2,160+25*e)})}dema(){i.fillStyle="#FFD700",i.font=a(16,"bold"),i.textAlign="center",i.fillText("üéâ Congratulations! üéâ",s.width/2,120),i.fillStyle="#fff",i.font=a(14),i.fillText("You have completed the main game!",s.width/2,150),i.fillText("Endless mode is now unlocked!",s.width/2,175),i.fillStyle="#ff8800",i.font=a(12),i.fillText("The difficulty will now scale infinitely",s.width/2,200),i.fillText("How far can you go?",s.width/2,220);const t=[`Perfect Parries: ${this.p.pp}`,`Total Gold: ${this.p.g}`];i.fillStyle="#ccc",i.font=a(12),t.forEach((t,e)=>{i.fillText(t,s.width/2,250+20*e)})}dds(){i.fillStyle="#e34a4a",i.font="18px Arial",i.textAlign="center",i.fillText(`Reached Floor ${this.gs.rf||this.p.cf}`,s.width/2,120),i.fillStyle="#ccc",i.font="14px Arial",i.fillText(`Gold Earned: ${this.p.g}`,s.width/2,160),i.fillStyle="#FFD700",i.font="16px Arial",i.fillText(`Best Record: Floor ${this.p.hf}`,s.width/2,190)}dcp(){i.fillStyle="#fff",i.font="14px Arial",i.textAlign="center",i.fillText("Tap to continue...",s.width/2,s.height-50)}drtl(){i.fillStyle="#fff",i.font="14px Arial",i.textAlign="center",i.fillText("Tap to return to lobby...",s.width/2,s.height-50)}hli(t,i){let e=0;for(const[t,s]of Object.entries(l.META_UPGRADES)){const s=190+45*e;if(i>=s-15&&i<=s+45-20)return void(this.p.cau(t)&&this.p.bu(t));e++}const h=s.height-100;if(i>=h&&i<=h+50)return this.p.snr(),void this.gs.tt("fight")}hdi(t,i){const e=Math.max(120,(s.height-200)/2+40);this.gs.dc.forEach((t,s)=>{const h=e+100*s;i>=h-30&&i<=h+55&&this.gs.sdc(s)})}hfi(t,i,e){const h=s.width-60-20,l=s.height-60-20;if(t>=h&&t<=h+60&&i>=l&&i<=l+60)return void this.gs.ab();if(this.gs.bm){const e=s.width/2,h=s.height/2;if(Math.sqrt((t-e)**2+(i-h)**2)<=40){const t=Math.ceil(this.gs.p.bd);return this.gs.ce.hp=Math.max(0,this.gs.ce.hp-t),this.cpe(e,h),void(this.gs.ce.hp<=0&&(this.gs.bm=!1,this.gs.hv()))}}this.cpe(t,i);const r=this.gs.hc(t,i,e);if(r&&r.parry){const s=r.parry.timing.toUpperCase()+"!",e=r.damage?`${r.damage} DMG`:"";this.afm(s,t,i),e&&this.afm(e,t,i-20)}}dbb(){const t=60,e=s.width-t-20,h=s.height-t-20,l=this.gs.cub(),r=this.gs.bm;if(i.fillStyle=r?"rgba(255,87,87,0.8)":l?"rgba(57,168,255,0.7)":"rgba(100,100,100,0.5)",i.fillRect(e,h,t,t),i.strokeStyle=r?"#ff5757":l?"#39a8ff":"#666",i.lineWidth=3,i.strokeRect(e,h,t,t),i.fillStyle=r?"#FFD700":l?"#fff":"#999",i.font=a(24,"bold"),i.textAlign="center",i.fillText("‚ö°",e+30,h+30+8),r){const s=this.gs.p.st/this.gs.p.ms;i.fillStyle="rgba(106,184,255,0.8)",i.fillRect(e+5,h+t-8,50*s,3)}}dcab(){if(!this.gs.bm)return;const t=s.width/2,e=s.height/2,h=Date.now(),l=40*(.8+.2*Math.sin(h/100));i.fillStyle="rgba(255,87,87,0.8)",i.beginPath(),i.arc(t,e,l,0,2*Math.PI),i.fill(),i.strokeStyle="#ff5757",i.lineWidth=3,i.stroke(),i.fillStyle="#fff",i.font="bold 24px Arial",i.textAlign="center",i.fillText("!",t,e+8),i.fillStyle="#fff",i.font="12px Arial",i.fillText("SPAM!",t,e+l+20)}}function m(s){const i=s-e;e=s,t&&(t.u(i),t.r()),requestAnimationFrame(m)}window.addEventListener("resize",()=>{t&&t.hr()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()</script>