<!doctype html><meta name=viewport content="width=device-width"><title>Assault on City 13 - js13kGames 2025</title><style>*{-webkit-tap-highlight-color:transparent}body{margin:0}#app{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;background-color:#222}#can-con{width:100%;height:100%;background-color:#000}#canvas{display:block}</style><div id=app><div id=can-con><canvas id=canvas></canvas></div></div><script>!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const l of t)if("childList"===l.type)for(const t of l.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),e.credentials="use-credentials"===t.crossOrigin?"include":"anonymous"===t.crossOrigin?"omit":"same-origin",e}(t);fetch(t.href,e)}}();const t=[{x:10,y:220,w:50,h:60,id:1,nIds:[],isA:!0,go:[2,3]},{x:70,y:220,w:50,h:60,id:2,nIds:[],isA:!0,go:[1,5,6]},{x:130,y:220,w:50,h:60,id:6,nIds:[],isA:!1,go:[2,7,11]},{x:190,y:220,w:50,h:60,id:7,nIds:[],isA:!1,go:[6,12]},{x:10,y:10,w:50,h:60,id:8,nIds:[],isA:!1,go:[4,9]},{x:70,y:10,w:50,h:60,id:9,nIds:[],isA:!1,go:[8,10,13]},{x:130,y:10,w:110,h:130,id:13,nIds:[],isA:!1,go:[9,10,11,12]},{x:10,y:80,w:50,h:60,id:4,nIds:[],isA:!1,go:[3,8,10]},{x:70,y:80,w:50,h:60,id:10,nIds:[],isA:!1,go:[4,5,9,13]},{x:10,y:150,w:50,h:60,id:3,nIds:[],isA:!0,go:[1,4,5]},{x:70,y:150,w:50,h:60,id:5,nIds:[],isA:!1,go:[2,3,10,11]},{x:130,y:150,w:50,h:60,id:11,nIds:[],isA:!1,go:[5,6,12,13]},{x:190,y:150,w:50,h:60,id:12,nIds:[],isA:!1,go:[7,11,13]}],e=[{id:0,name:"S0",ln:"Ashsteel",type:1,atk:20,gd:50,ct:1},{id:1,name:"S1",ln:"Verdigris",type:1,atk:50,gd:100,ct:0},{id:2,name:"S2",ln:"Mossedge",type:1,atk:120,gd:300,ct:0},{id:3,name:"S3",ln:"Groveblade",type:1,atk:200,gd:700,ct:0},{id:4,name:"S4",ln:"Lakelure",type:1,atk:300,gd:1300,ct:0},{id:5,name:"S5",ln:"Seafoam",type:1,atk:400,gd:2100,ct:0},{id:6,name:"S6",ln:"Mistblade",type:1,atk:500,gd:3400,ct:0},{id:7,name:"S7",ln:"Abyssal",type:1,atk:600,gd:5500,ct:0},{id:8,name:"S8",ln:"Duskprism",type:1,atk:900,gd:8900,ct:0},{id:9,name:"S9",ln:"Magma Ash",type:1,atk:1200,gd:14400,ct:0},{id:10,name:"S10",ln:"Sunglow",type:1,atk:1600,gd:23300,ct:0},{id:11,name:"S11",ln:"Embercore",type:1,atk:2e3,gd:37700,ct:0},{id:12,name:"S12",ln:"Crimson Pyre",type:1,atk:3e3,gd:61e3,ct:0},{id:13,name:"S13",ln:"Bloodmoon",type:1,atk:4500,gd:1e5,ct:0},{id:30,name:"A0",ln:"Hideguard",type:2,def:2,gd:50,ct:1},{id:31,name:"A1",ln:"Bronzeweave",type:2,def:5,gd:100,ct:0},{id:32,name:"A2",ln:"Mossward",type:2,def:10,gd:300,ct:0},{id:33,name:"A3",ln:"Scalehide",type:2,def:20,gd:700,ct:0},{id:34,name:"A4",ln:"Chainfort",type:2,def:40,gd:1300,ct:0},{id:35,name:"A5",ln:"Ironbark",type:2,def:60,gd:2100,ct:0},{id:36,name:"A6",ln:"Frostplate",type:2,def:90,gd:3400,ct:0},{id:37,name:"A7",ln:"Embercoat",type:2,def:120,gd:5500,ct:0},{id:38,name:"A8",ln:"Soulbark",type:2,def:170,gd:8900,ct:0},{id:39,name:"A9",ln:"Abyssmail",type:2,def:250,gd:14400,ct:0},{id:40,name:"A10",ln:"Sunforge",type:2,def:350,gd:23300,ct:0},{id:41,name:"A11",ln:"Dragonhide",type:2,def:500,gd:37700,ct:0},{id:42,name:"A12",ln:"Phoenixmail",type:2,def:700,gd:61e3,ct:0},{id:43,name:"A13",ln:"Voidplate",type:2,def:1e3,gd:1e5,ct:0}],l=["#888888","#6E7C7C","#5C7E6D","#4A8C6D","#4A9A8C","#4A9AA8","#5A8CA8","#4A6C9A","#6C5A9A","#9A6C5A","#D19A5A","#D17D5A","#C75A5A","#A83C3C"],n={atk:[5,100],def:[2,50],hp:[10,100],gd:[.01,.2],exp:[.01,.2]},o=()=>crypto.getRandomValues(new Uint32Array(1))[0]/4294967296,i=()=>100*o(),s=(t,e=0)=>Math.floor(o()*(t-e+1)+e),c=t=>t>=1e12?`${(t/1e12).toFixed(1)}T`:t>=1e9?`${(t/1e9).toFixed(1)}B`:t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),r=(t,e,l)=>t>=l.x&&t<=l.x+l.width&&e>=l.y&&e<=l.y+l.height,f=t=>JSON.parse(JSON.stringify(t)),h=(t,e)=>{const l=[];return t.nIds.forEach(t=>{const n=e.find(e=>e.id===t);n&&l.push(n)}),l},a=t=>{let e="";if(t.atk>0){const l=`atk+${t.atk}`;e+=""===e?l:" "+l}if(t.def>0){const l=`def+${t.def}`;e+=""===e?l:", "+l}if(t.hp>0){const l=`hp+${t.hp}`;e+=""===e?l:", "+l}if(t.gd>0){const l=`gold+${Math.floor(1e3*t.gd)/10}%`;e+=""===e?l:", "+l}if(t.exp>0){const l=`exp+${Math.floor(1e3*t.exp)/10}%`;e+=""===e?l:", "+l}return e||"---"},d=(t,e,l,n,o,i)=>{t.beginPath(),t.moveTo(e+i,l),t.arcTo(e+n,l,e+n,l+o,i),t.arcTo(e+n,l+o,e,l+o,i),t.arcTo(e,l+o,e,l,i),t.arcTo(e,l,e+n,l,i),t.closePath()},p=t=>({id:t.id,name:`${t.ln}(${t.name})`,count:1,atk:t.atk||0,def:t.def||0}),T=(t,e)=>{const l=[],n=[...t];for(let t=0;t<e&&n.length>0;t++){const t=Math.floor(Math.random()*n.length);l.push(n[t]),n.splice(t,1)}return l},g={id:1,n:"Hero(0-0)",lv:1,yr:0,exp:0,mExp:100,hp:100,mHp:100,tps:800,atk:40,def:12,g:2e3,wp:0,ar:30,mbs:[],mm:0},m={p:"N",d:".",f:"#aaa",tt:{t1:"",t2:"",t3:"",t4:"",t5:"",t6:""},ft:{t1:"",t2:"",t3:"",t4:"",t5:"",t6:""}},u={t:"W",r:"Game over",h:f(g),acs:[1],acw:[0]},y={cs:"C",c:!1,nt:f(m),ot:f(u),s:1,mv:{evs:[]},baseW:400,hCId:-1,sCId:1,hNName:"",hNBtn:-1,hTBtn:-1,hTPBtn:-1,hHBtn:-1,hVBtn:-1,hOBtn:-1,hCBtn:-1,hSBtn:-1,cNpcs:[],cNId:-1,cts:f(t),nps:[],its:f(e),iT:"",cIId:-1,cTId:-1,acs:[1,2],acw:[],hero:f(g)};let x=f(y);const k=400,S=(t,e=1)=>{const l=x.its.find(e=>e.id===t.id);l&&(l.ct+=e)},v=t=>{x.hero.mbs.findIndex(e=>e.id===t.id)>-1||(x.hero.mbs.push({id:t.id,name:t.n,lv:t.lv,eft:t.eft}),b())},I=(t,e)=>{x.ot.t=t,x.ot.r=e,x.ot.h=f(x.hero),x.ot.acs=x.acs,x.ot.acw=x.acw,x.cs="O",b(!1)},$=()=>{x.nt=f(m),x.ot=f(u),x.hero=f(g),x.cts=f(t),x.its=f(e),x.acs=[1,2],x.acw=[0],x.sCId=1,x.hCId=-1,x.cIId=-1,x.cTId=-1,((t=!1)=>{t&&(x.nps=[],x.cts.sort((t,e)=>t.id-e.id),x.cts.forEach(t=>{t.nIds=[];const e=[7,13];for(;e.length<12;){const t=Math.floor(80*Math.random())+20;e.includes(t)||e.push(t)}e.sort((t,e)=>t-e);let l=t.id+1;l>13&&(l=13),e.forEach(e=>{const i=x.its.filter(t=>1===t.type&&t.id<=l||2===t.type&&t.id<=l+30),c=i.filter(t=>1===t.type),r=i.filter(t=>2===t.type),f=s(2,1),h=T(c,f);let a=s(2,0);2===f&&2===a&&(a=s(1,0));const d=[...h,...T(r,a)],g=T(i,1)[0],m=((t,e)=>{const l={atk:0,def:0,hp:0,gd:0,exp:0},[i,c]=(t=>t>=1&&t<=3?[1,2]:t>=4&&t<=6?[2,3]:t>=7&&t<=10?[2,4]:t>=11&&t<=13?[3,4]:[0,0])(t),r=s(c,i),f=Object.keys(l).sort(()=>o()-.5);for(let i=0;i<r;i++){const s=f[i],[c,r]=n[s],h=(t-1)/12*((100-e)/60);switch(s){case"gd":l.gd=(r-c)*h*o()+c;break;case"exp":l.exp=(r-c)*h*o()+c;break;default:l[s]=c+(r-c)*h*o()}}return l.atk=Math.floor(l.atk),l.def=Math.floor(l.def),l.hp=Math.floor(l.hp),l.gd=Math.floor(100*l.gd)/100,l.exp=Math.floor(100*l.exp)/100,l})(t.id,e);let u=1+t.id*(100-e)/10+50*(t.id-1);13===e&&(u*=1.5);let y={id:1e5+1e3*t.id+e,n:`${t.id}-${e}`,t:"N",lv:0,h:Math.floor(10*(5*o()+10)*u),tps:Math.floor(50*(5*o()+10)*u),ht:s(10,0),exp:Math.floor(2*u*o()+5*u),g:10*Math.floor(4*u*o()+8*u),atk:Math.floor(3*u*o()+6*u),def:Math.floor(2*u*o()+4*u),items:d.map(t=>p(t)),nItem:p(g),nGd:10*Math.floor(4*u*o()+8*u)+1e3,eft:m};13===e?y.t="B":7===e&&(y.t="S"),t.nIds.push(y.id),x.nps.push(y)})})),x.cNpcs=h(x.cts[0],x.nps)})(!0),x.cs="S"},w="js13k-numwar-bobgame",b=(t=!0)=>{x.c=t;const e={v:1,c:t,a:f(x)};localStorage.setItem(w,JSON.stringify(e))},A=t=>`${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,M=t=>`bold ${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`;CanvasRenderingContext2D.prototype.wrap=function(t){this.save(),t(),this.restore()};const P=(t,e,l)=>{const n=x.s,o=15*n,i=20*n,s=15*n,c=8*n,r=24*n;t.fillStyle=t.strokeStyle="#000",t.fillRect(-o,-i,2*o,2*i),e&&(t.fillRect(0,0,o+5*n,4*n),t.fillRect(0,12*n,o+5*n,4*n)),t.beginPath(),t.arc(0,-i-o,o,Math.PI,0,!0),t.lineTo(o,-i),t.lineTo(-o,-i),t.fill(),t.fillStyle=t.strokeStyle="#b12a34",t.fillRect(-o,-i,2*o,s),t.lineWidth=1*n,t.beginPath(),t.arc(0,7*n,4*n,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(-o,0),t.lineTo(0,5*n),t.lineTo(o,0),t.stroke(),t.fillStyle="#fff",t.textAlign="center",t.font=4*n+"pt Courier",t.fillText("13",0,8.8*n),t.lineWidth=1*n,t.strokeStyle="#000",[-1,1].forEach(e=>t.wrap(()=>{t.translate(0,-i+s),t.beginPath(),t.moveTo(0,0),t.lineTo(e*r,-2*n),t.moveTo(0,0),t.lineTo(e*r,2*n),t.stroke()})),t.fillStyle="#fff",[-c,c].forEach(e=>t.wrap(()=>{t.translate(e,s/2-i+2*n),Date.now()%5e3<100&&t.scale(1,.1),t.beginPath(),t.arc(0,0,s/2-2*n,0,2*Math.PI),t.fill(),t.fillStyle="#000",l?[Math.PI/4,-Math.PI/4].forEach(e=>t.wrap(()=>{t.fillStyle="#000",t.rotate(e),t.fillRect(-5*n,-1*n,10*n,2*n)})):(t.scale(.3,1),t.beginPath(),t.arc(0,0,s/2-2*n,0,2*Math.PI),t.fill())})),t.beginPath(),t.arc(0,-i+s,2*n,0,2*Math.PI,!0),t.fill();const f=3*Math.sin(Date.now()/1e3*Math.PI*2/2)*n;t.strokeStyle="#000",t.lineWidth=5*n,t.lineCap="round",t.beginPath(),t.moveTo(0,i-t.lineWidth),t.bezierCurveTo(-25*n,i+2*n,-25*n,i-10*n,-25*n+f,i-18*n),t.stroke()},B=(t,e,l,n,o=!1,i=!1)=>{const s=x.s,c=e*s,r=l*s,f=180*s,h=i?40*s:60*s;t.fillStyle=o?"#666":"#444",t.fillRect(c,r,f,h),t.strokeStyle=o?"#fff":"#ccc",t.lineWidth=o?2*s:1*s,t.strokeRect(c,r,f,h),t.fillStyle=o?"#ff0":"#fff",t.font=M((i?20:28)*s),t.textAlign="center";const a=t.measureText(n);return t.fillText(n,c+f/2,r+h/2+(a.actualBoundingBoxAscent-a.actualBoundingBoxDescent)/2),{x:c-5*s,y:r-5*s,width:f+10*s,height:h+10*s}},R=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#333",t.fillRect(0,0,e.width,e.height),(t=>{const e=x.s;t.font=A(28*e),t.fillStyle="#fff",t.textAlign="center",t.fillText("Assault on City 13",200*e,95*e),t.font=A(16*e),t.fillStyle="#ccc",t.fillText("Slay the Foe, Save the Black Cat",200*e,130*e)})(t);const l=B(t,110,x.c?170:210,"New Game",2===x.hNBtn),n=B(t,x.c?110:-400,260,"Continue",3===x.hNBtn);return t.wrap(()=>{t.translate(10*x.s,100*x.s),t.rotate(Math.PI/4),P(t,!0,!1)}),(t,e)=>r(t,e,l)?2:r(t,e,n)?3:0},C=(t,e,l,n,o=!1,i=!1,s=!1)=>{const c=x.s,r=e*c,f=l*c,h=140*c,a=i?40*c:60*c;t.fillStyle=s?"#222":o?"#666":"#444",t.fillRect(r,f,h,a),t.strokeStyle=s?"#999":o?"#fff":"#ccc",t.lineWidth=s?1*c:o?2*c:1*c,t.strokeRect(r,f,h,a),t.fillStyle=s?"#777":o?"#ff0":"#fff",t.font=M((i?20:28)*c),t.textAlign="center";const d=t.measureText(n);return t.fillText(n,r+h/2,f+a/2+(d.actualBoundingBoxAscent-d.actualBoundingBoxDescent)/2),{x:r-5*c,y:f-5*c,width:h+10*c,height:a+10*c}},N=(t,e=!1)=>{const l=x.s,n=20*l,o=360*l,i=20*l;return t.strokeStyle=e?"#ff0":"#fff",t.lineWidth=2*l,t.beginPath(),t.moveTo(o,i),t.lineTo(o+n,i+n),t.moveTo(o+n,i),t.lineTo(o,i+n),t.stroke(),{x:o-10*l,y:i-10*l,width:n+20*l,height:n+20*l}},E=(t,e,n,o,i)=>{const s=x.s,c=e*s,r=n*s;t.lineWidth=1*s,t.fillStyle=l[i],t.strokeStyle="#000",t.save(),t.beginPath(),t.moveTo(c+12.776*s,r+25.292*s),t.lineTo(c+19.919*s,r+31.9*s),t.lineTo(c+10.632*s,r+40.49*s),t.lineTo(c+3.489*s,r+33.882*s),t.lineTo(c+12.776*s,r+25.292*s),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.beginPath(),t.moveTo(c+35.635*s,r+4.147*s),t.lineTo(c+43.493*s,r+3.486*s),t.lineTo(c+42.779*s,r+10.755*s),t.lineTo(c+22.777*s,r+29.257*s),t.lineTo(c+15.633*s,r+22.649*s),t.lineTo(c+35.635*s,r+4.147*s),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.beginPath(),t.moveTo(c+11.347*s,r+17.363*s),t.lineTo(c+28.491*s,r+33.222*s),t.lineTo(c+24.205*s,r+37.186*s),t.lineTo(c+7.061*s,r+21.327*s),t.lineTo(c+11.347*s,r+17.363*s),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.translate(c+25.5*s,r+20.5*s),t.rotate(Math.PI/-4),t.fillStyle="#fff",t.font=A(6*s),t.textAlign="center",t.fillText(o,0,1.5*s),t.restore()},W=(t,e,n,o,i)=>{const s=x.s,c=e*s,r=n*s;t.lineWidth=1*s,t.fillStyle=l[i-30],t.strokeStyle="#000",t.save(),t.beginPath(),t.moveTo(c+3.5*s,r+3.5*s),t.lineTo(c+13.5*s,r+3.5*s),t.lineTo(c+20.5*s,r+10.5*s),t.lineTo(c+27.5*s,r+3.5*s),t.lineTo(c+37.5*s,r+3.5*s),t.lineTo(c+37.5*s,r+14.5*s),t.lineTo(c+31.5*s,r+14.5*s),t.lineTo(c+31.5*s,r+33.5*s),t.lineTo(c+9.5*s,r+33.5*s),t.lineTo(c+9.5*s,r+14.5*s),t.lineTo(c+3.5*s,r+14.5*s),t.lineTo(c+3.5*s,r+3.5*s),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.translate(c+21*s,r+22*s),t.fillStyle="#fff",t.font=A(6*s),t.textAlign="center",t.fillText(o,0,1.4*s),t.restore()},H=(t,e="",l=" ")=>{const n=x.s;t.fillStyle="#fff",t.textAlign="center",t.font=A(24*n),t.fillText(e,200*n,35*n),l&&(t.font=A(16*n),t.fillStyle="#ccc",t.fillText(l,200*n,55*n))},D=(t,e)=>{const l=e?1:-1;t.atk&&t.atk>0&&(x.hero.atk+=t.atk*l),t.def&&t.def>0&&(x.hero.def+=t.def*l),t.hp&&t.hp>0&&(x.hero.mHp+=t.hp*l,x.hero.hp>x.hero.mHp&&(x.hero.hp=x.hero.mHp))},L=(t,e)=>{t.clearRect(0,0,e.width,e.height);const l=N(t,!1);let n=!1,o=!1;if(x.inS){const t=x.its.find(t=>t.id===x.cIId);t&&(n=t.ct>=13,o=x.cIId===x.hero.wp||x.cIId===x.hero.ar?t.ct<=1:t.ct<=0)}else n=x.cIId===x.hero.wp||x.cIId===x.hero.ar,o=x.cIId!==x.hero.wp&&x.cIId!==x.hero.ar;const i=C(t,40,340,x.inS?"Buy":"Equip",2===x.hNBtn,!0,n),s=C(t,220,340,x.inS?"Sell":"Unequip",3===x.hNBtn,!0,o);(t=>{const e=x.s,l=18*e,n=64*e,o=364*e,i=260*e,s=52*e,c=.4*e;t.fillStyle="#555",t.fillRect(l,n,o,i),t.lineWidth=c,t.strokeStyle="#aaa",t.strokeRect(l,n+1*s,o,c),t.strokeRect(l,n+2*s,o,c),t.strokeRect(l,n+3*s,o,c),t.strokeRect(l,n+4*s,o,c),t.strokeRect(l+1*s,n+s,c,i-s),t.strokeRect(l+2*s,n+s,c,i-s),t.strokeRect(l+3*s,n+s,c,i-s),t.strokeRect(l+4*s,n+s,c,i-s),t.strokeRect(l+5*s,n+s,c,i-s),t.strokeRect(l+6*s,n+s,c,i-s),t.strokeStyle="#fff",t.lineWidth=2*e,t.strokeRect(l-1*e,n-1*e,o+2*e,i+2*e)})(t);const c=[];let h=f(x.its);return x.inS?(H(t,"Merchant‌",`(${x.sCId}-7)`),h=x.its.filter(t=>t.ct>0||1===t.type&&t.id<=x.sCId||2===t.type&&t.id<=x.sCId+30)):(H(t,"Bag"),h=x.its.filter(t=>t.ct>0)),-1===x.cIId&&h.length>0&&(x.cIId=h[0].id),h.forEach((e,l)=>{const n=18+l%7*52,o=64+52*Math.floor(l/7),i=((t,e,l,n,o=1,i=!1,s=!1)=>{let c=x.s;const r=e*c,f=l*c;c*=o;const h=52*c*o,a=h,d=h;return i?(t.fillStyle="#222",t.fillRect(r+1*c,f+1*c,a-2*c,d-2*c),t.lineWidth=2*c,t.strokeStyle=s?"#D19A5A":"#fff",t.strokeRect(r+1*c,f+1*c,a-2*c,d-2*c)):s&&(t.lineWidth=2*c,t.strokeStyle="#D19A5A",t.strokeRect(r+1*c,f+1*c,a-2*c,d-2*c)),1===n.type?E(t,e+3,l+6,n.name,n.id):2===n.type&&W(t,e+6,l+12,n.name,n.id),t.fillStyle="#fff",t.font=A(12*c),t.textAlign="left",t.fillText(n.ct.toString(),r+3*c,f+11*c),{x:r,y:f,width:a,height:d,item:n}})(t,n,o+52,e,1,x.cIId===e.id,e.id===x.hero.wp||e.id===x.hero.ar);c.push(i)}),(t=>{const e=x.s,l=x.its.find(t=>t.id===x.cIId);if(l){t.fillStyle="#fff",t.textAlign="left",t.font=A(18*e),t.fillText(`${l.ln} ×${l.ct}`,26*e,87*e);let n="";l.atk&&l.atk>0&&(n+=`Atk+${l.atk}`),l.def&&l.def>0&&(n+=`Def+${l.def}`),n+=` Buy: ${l.gd} Sell: ${Math.floor(l.gd/2)}`,t.textAlign="left",t.font=A(11*e),t.fillText(n,26*e,105*e),t.textAlign="right",t.fillStyle="#fff",t.fillText(`G: ${x.hero.g}`,374*e,105*e);const o=x.its.find(t=>t.id===x.hero.wp);let i=o?o.name:"---";const s=x.its.find(t=>t.id===x.hero.ar);t.fillText(`Weapon: ${i} Armor: ${s?s.name:"---"}`,374*e,86*e)}})(t),(t,e)=>{for(let l=0;l<c.length;l++)if(r(t,e,c[l]))return 100+c[l].item.id;return r(t,e,l)?1:r(t,e,i)&&!n?2:r(t,e,s)&&!o?3:0}},G=(t,e,l,n=1,o="#000")=>{const i=x.s*n,s=5.2*i/2;t.beginPath(),t.arc(e,l,s,0,2*Math.PI),t.strokeStyle=o,t.lineWidth=1*i,t.stroke(),t.closePath(),t.beginPath(),t.arc(e,l+10*i,2.1*s,1*Math.PI,2*Math.PI),t.stroke(),t.closePath()},F=t=>{let e={t:t,h:"",d:""};switch(t){case 1:e.h="^_^";const t=s(400,50);e.d=`Troops + ${t}`,x.hero.tps+=t;break;case 2:e.h="v_v";const l=s(300,50);e.d=`Troops - ${l}`,x.hero.tps-=l,x.hero.tps<=0&&(x.hero.tps=0,I("L","No Troops left after move"));break;case 3:e.h="^_^";const n=s(800,50);e.d=`Gold + ${n}`,x.hero.g+=n;break;case 4:e.h="v_v";const i=s(800,50);e.d=`Gold - ${i}`,x.hero.g-=i;break;case 5:e.h="^_^";const c=s(100,50);e.d=`Exp + ${c}`,x.hero.exp+=c;break;case 11:e.h="^_^";const r=s(10,5);e.d=`Atk + ${r}`,x.hero.atk+=r;break;case 12:e.h="v_v";const f=s(8,4);e.d=`Atk - ${f}`,x.hero.atk-=f;break;case 13:e.h="^_^";const h=s(10,5);e.d=`Def + ${h}`,x.hero.def+=h;break;case 14:e.h="v_v";const a=s(8,4);e.d=`Def - ${a}`,x.hero.def-=a;break;case 21:e.h="^_^";const d=o()>.4?s(2,0):s(0,2)+30,p=x.its.find(t=>t.id===d);if(!p)break;S(p),e.d=`Got item: ${p.name}`;break;case 31:e.h="^_^";const T=x.nps.filter(t=>t.id%100>80&&Math.floor((t.id-1e5)/1e3)<3),g=T[s(T.length-1,0)];if(!g)break;v(g),e.d=`Got member: ${g.n}`;break;default:e.t=0}return e},O=(t,e)=>{t.clearRect(0,0,e.width,e.height);const l=x.s;(t=>{const e=x.s,l=x.hero;G(t,135*e,20*e,2.2,"#77f"),t.font=A(13*e),t.fillStyle="#ccc",t.textAlign="left",t.fillText(`${l.n}`,155*e,25*e);const n=x.its.find(t=>t.id===l.wp);let o=n?n.name:"--";const i=x.its.find(t=>t.id===l.ar);let s=i?i.name:"--";t.font=A(9*e),t.fillText(`| Lv${l.lv} | ${Math.floor(l.yr)}y | G: ${c(l.g)}`,225*e,24*e),t.fillText(`Atk: ${c(l.atk)} [${o}] | Def: ${c(l.def)} [${s}]`,155*e,40*e),t.font=A(10*e);const r=125*e,f=250*e,h=65*e,a=85*e;t.fillText(`Exp: ${c(l.exp)}(${Math.floor(l.exp/l.mExp*1e3)/10}%)`,r,a),t.fillText(`Member: ${c(l.mbs.length)}`,f,h),t.fillStyle=l.hp>=40?"#ccc":"#f00",t.fillText(`Hp : ${c(l.hp)}/${c(l.mHp)}`,r,h),t.fillStyle=l.tps>=500?"#ccc":"#f00",t.fillText(`Troops: ${c(l.tps)}`,f,a)})(t),t.fillStyle="#555",t.fillRect(110*l,0,1,100*l),t.fillRect(0,99*l,400*l,1),t.fillRect(250*l,99*l,1,400*l),t.save();const n=.85;t.scale(n,n);const o=22*l,i=16*l,s=56*l,f=((t,e,l,n=1)=>{const o=x.s;return t.strokeStyle="#ccc",t.lineWidth=2*o,t.beginPath(),t.moveTo(e,l+12*o),t.lineTo(e+16*o,l),t.lineTo(e+32*o,l+12*o),t.lineTo(e+32*o,l+32*o),t.lineTo(e+21*o,l+32*o),t.lineTo(e+21*o,l+20*o),t.lineTo(e+11*o,l+20*o),t.lineTo(e+11*o,l+32*o),t.lineTo(e,l+32*o),t.lineTo(e,l+12*o),t.closePath(),t.stroke(),{x:(e-4*o)*n,y:(l-4*o)*n,width:40*o*n,height:40*o*n}})(t,o,i,n),h=((t,e,l,n=1)=>{const o=x.s;t.strokeStyle="#ccc",t.lineWidth=2*o;const i=32*o,s=32*o;return d(t,e,l,i,s,6*o),t.stroke(),t.beginPath(),t.arc(e+i/2,l+s/4,i/4,0,1*Math.PI,!1),t.stroke(),{x:(e-4*o)*n,y:(l-4*o)*n,width:(i+8*o)*n,height:(s+8*o)*n}})(t,o+s,i,n),a=((t,e,l,n=1)=>{const o=x.s;t.strokeStyle="#ccc",t.lineWidth=2*o,G(t,e+12*o,l+8*o,2.3,"#ccc");const i=2.3*o,s=5.2*i/2;return t.beginPath(),t.arc(e+20*o,l+8*o,s,1.6*Math.PI,2.4*Math.PI),t.strokeStyle="#ccc",t.lineWidth=1*i,t.stroke(),t.closePath(),t.beginPath(),t.arc(e+20*o,l+31*o,2.1*s,1.6*Math.PI,2*Math.PI),t.stroke(),t.closePath(),{x:(e-4*o)*n,y:(l-4*o)*n,width:40*o*n,height:40*o*n}})(t,o,i+s,n),p=((t,e,l,n=1)=>{const o=x.s;t.strokeStyle="#ccc",t.lineWidth=2*o;const i=32*o,s=32*o,c=4*o;return t.beginPath(),t.arc(e+4*o,l+4*o,c,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+2*o,l+31*o),t.lineTo(e+2*o,l+22*o),t.lineTo(e+0*o,l+22*o),t.lineTo(e+0*o,l+11*o),t.lineTo(e+6*o,l+11*o),t.stroke(),t.beginPath(),t.arc(e+16*o,l+1*o,c,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+12*o,l+32*o),t.lineTo(e+12*o,l+21*o),t.lineTo(e+10*o,l+21*o),t.lineTo(e+10*o,l+8*o),t.lineTo(e+22*o,l+8*o),t.lineTo(e+22*o,l+21*o),t.lineTo(e+20*o,l+21*o),t.lineTo(e+20*o,l+32*o),t.stroke(),t.beginPath(),t.arc(e+28*o,l+4*o,c,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+30*o,l+31*o),t.lineTo(e+30*o,l+22*o),t.lineTo(e+32*o,l+22*o),t.lineTo(e+32*o,l+11*o),t.lineTo(e+26*o,l+11*o),t.stroke(),{x:(e-4*o)*n,y:(l-4*o)*n,width:(i+8*o)*n,height:(s+8*o)*n}})(t,o+s,i+s,n);t.restore();const T=[];x.cts.forEach(e=>{const l=((t,e)=>{const l=x.s,n=e.id,o=x.sCId===e.id,i=x.hCId===e.id,s=e.isA;let c="#eee";x.acs.includes(n)?s?o?c="#ddf":i&&(c="#5722FF"):c="#aaa":c="#666",t.fillStyle=c;const r=e.x*l,f=(e.y+100)*l,h=e.w*l,a=e.h*l;t.fillRect(r,f,h,a);const d=.02*e.h*l;let p="#333";(o||i)&&(p="#00F");const T=r+13.7*d,g=f+30*d;t.strokeStyle=p,t.lineWidth=.6*d,t.strokeRect(T+2*d,g,10*d,4*d),t.strokeRect(T+5.5*d,g+2*d,3*d,2*d),t.strokeRect(T,g+4*d,14*d,6*d),t.beginPath(),t.arc(T+7*d,g+10*d,3.2*d,1*Math.PI,2*Math.PI),t.stroke(),t.closePath(),t.font=A(.4*a);let m="#000";return s?(o||i)&&(m="#00F"):m="#333",t.fillStyle=m,t.textAlign="center",t.fillText(n.toString(),r+h/2,f+a/2),{x:r,y:f,width:h,height:a,city:e}})(t,e);T.push(l)});const g=[];return x.cNpcs.filter(t=>-1===x.hero.mbs.findIndex(e=>e.id===t.id)).forEach((e,n)=>{const o=((t,e,l,n=1)=>{const o=(l%2==0?260:330)*n,i=(110+46.65*Math.floor(l/2))*n,s=60*n,c=36.65*n;let r="#fff";x.hNName===e.n?r="B"===e.t?"#FFbbbb":"S"===e.t?"#ccFFcc":"#ddd":"B"===e.t?r="#FFcccc":"S"===e.t&&(r="#ddFFdd"),t.fillStyle=r,t.fillRect(o,i,s,c),G(t,o+12*n,i+14*n,1,"#000"),t.font=A(13*n),"B"!==e.t&&"S"!==e.t||(t.font=M(14*n)),t.fillStyle="#000",t.textAlign="center";const f=t.measureText(e.n);return t.fillText(e.n,o+s/1.6,i+c/2+(f.actualBoundingBoxAscent-f.actualBoundingBoxDescent)/2),{x:o,y:i,width:s,height:c,npc:e}})(t,e,n,l);g.push(o)}),(t,e)=>{if(r(t,e,h))return 1;if(r(t,e,a))return 2;if(r(t,e,f))return 3;if(r(t,e,p))return 4;for(let l=0;l<T.length;l++)if(r(t,e,T[l])&&x.cts[l].isA&&x.cts[l].id!==x.sCId)return 100+T[l].city.id;for(let l=0;l<g.length;l++)if(r(t,e,g[l]))return g[l].npc.id;return 0}},V=[{s:0,e:.05,wc:0,w:{hp:20,tps:.08},l:{hp:40,tps:.2}},{s:.05,e:.15,wc:10,w:{hp:20,tps:.05},l:{hp:40,tps:.18}},{s:.15,e:.25,wc:20,w:{hp:20,tps:.05},l:{hp:40,tps:.15}},{s:.25,e:.35,wc:20,w:{hp:20,tps:.03},l:{hp:40,tps:.12}},{s:.35,e:.45,wc:40,w:{hp:20,tps:.01},l:{hp:40,tps:.1}},{s:.45,e:.55,wc:50,w:{hp:20,tps:0},l:{hp:40,tps:.1}},{s:.55,e:.65,wc:60,w:{hp:20,tps:0},l:{hp:40,tps:.11}},{s:.65,e:.75,wc:70,w:{hp:20,tps:0},l:{hp:40,tps:.12}},{s:.75,e:.85,wc:80,w:{hp:20,tps:0},l:{hp:40,tps:.13}},{s:.85,e:.9,wc:90,w:{hp:20,tps:0},l:{hp:40,tps:.15}},{s:.9,e:1.1,wc:100,w:{hp:20,tps:0},l:{hp:40,tps:.2}}],Y=(t,e)=>{let l=f(V[0]);if(e){const n=_(),o=t.tps<=5e4?.2*t.tps:1e4+50*Math.log(t.tps-5e4+1),i=8*(1.2*t.mHp+3*t.atk+2.4*t.def+1.2*n.hp*t.lv+2.2*n.atk*t.lv+1.8*n.def*t.lv+o),s=e.items.reduce((t,e)=>t+(e.atk||0),0)||0,c=e.items.reduce((t,e)=>t+(e.def||0),0)||0,r=e.tps<=5e4?.06*e.tps:3e3+30*Math.log(e.tps-5e4+1),h=.8*e.h+1.6*e.atk+1.2*e.def+1.2*s+.8*c+r,a=Math.tanh(.7*(i-h)/Math.min(i,h))/2+.5;for(const t of V)if(a>=t.s&&a<t.e){l=f(t);break}}return l},_=()=>{let t={atk:0,def:0,hp:0,gd:0,exp:0};return x.hero.mbs.forEach(e=>{t.atk+=e.eft.atk*(e.id===x.hero.mm?2:1),t.def+=e.eft.def*(e.id===x.hero.mm?2:1),t.hp+=e.eft.hp*(e.id===x.hero.mm?2:1),t.gd+=e.eft.gd*(e.id===x.hero.mm?2:1),t.exp+=e.eft.exp*(e.id===x.hero.mm?2:1)}),t},z=(t,e)=>{if(t.clearRect(0,0,e.width,e.height),(t=>{const e=x.s,l=x.nps.find(t=>t.id===x.cNId)||x.nps[0];if(["F2","F3"].includes(x.nt.p)||(t.font=A(28*e),t.textAlign="left","B"===l.t?(G(t,66*e,40*e,4,"#f00"),t.fillStyle="#f00",t.fillText(`${l.n}`,95*e,54*e),t.font=A(10*e),t.fillText("BOSS",55*e,78*e)):(G(t,66*e,40*e,4,"#fff"),t.fillStyle="#fff",t.fillText(`${l.n}`,95*e,54*e))),t.font=A(14*e),"N"===x.nt.p){t.fillText("B"===l.t?`Lv${l.lv}`:`Lv${l.lv} ❤${l.ht}`,100*e,78*e),t.font=A(16*e);const n=40*e,o=190*e,i=45*e,s=28*e;t.fillStyle="#fff",t.fillText(`Hp: ${c(l.h)}`,o,i),t.fillText(`Troops: ${c(l.tps)}`,o,i+1*s),t.fillText(`Exp: ${c(l.exp)}`,o,i+2*s),t.fillText(`Atk: ${c(l.atk)}`,o,i+3*s),t.fillText(`Def: ${c(l.def)}`,o,i+4*s),t.fillText(`G: ${c(l.g)}`,o,i+5*s),t.fillStyle="#bbb",t.font=A(13*e);const r=Y(x.hero,x.nps.find(t=>t.id===x.cNId));t.fillText(`Win chance: ${r.wc}%`,n,i+6*s);const f=x.its.find(t=>t.id===l.nItem.id);t.fillText(`Join need: 100❤ + ${f.name} + ${l.nGd}G`,n,i+6.8*s),t.fillText(`Team effect: ${a(l.eft)}`,n,i+7.6*s),t.fillStyle="#999",t.fillRect(n,195*e,320*e,1*e),t.fillStyle="#111",d(t,n,95*e,140*e,84*e,6*e),t.strokeStyle="#666",t.lineWidth=1*e,t.stroke(),t.fill(),t.fillStyle="#ddd",t.font=A(10*e),l.items.forEach((l,o)=>{const i=x.its.find(t=>t.id===l.id);t.fillText(l.name,n+30*e,118*e+23*o*e),t.save();const s=.3;t.scale(s,s),1===i.type?E(t,(n/e+10)/s,(108+23*o)/s,i.name,i.id):W(t,(n/e+10)/s,(108+23*o)/s,i.name,i.id),t.restore()})}else if("T"===x.nt.p)t.fillText(`Lv${l.lv}`,100*e,78*e),((t,e,l)=>{const n=3.5*x.s;t.save(),t.strokeStyle="rgb(0, 0, 0, 0)",t.fillStyle="rgb(195, 195, 195)",t.beginPath(),t.moveTo(23*n+e,3*n+l),t.bezierCurveTo(34*n+e,3*n+l,43*n+e,10.2*n+l,43*n+e,19*n+l),t.bezierCurveTo(43*n+e,27.8*n+l,34*n+e,35*n+l,23*n+e,35*n+l),t.bezierCurveTo(12*n+e,35*n+l,3*n+e,27.8*n+l,3*n+e,19*n+l),t.bezierCurveTo(3*n+e,10.2*n+l,12*n+e,3*n+l,23*n+e,3*n+l),t.closePath(),t.fill("evenodd"),t.beginPath(),t.moveTo(19.3*n+e,33.7*n+l),t.lineTo(10.3*n+e,38.7*n+l),t.lineTo(10.3*n+e,28.7*n+l),t.lineTo(19.3*n+e,33.7*n+l),t.closePath(),t.fill("evenodd"),t.restore()})(t,120*e,125*e),t.font=A(80*e),t.fillStyle="#000",t.textAlign="center",t.fillText(`${x.nt.d}`,200*e,200*e);else if("T2"===x.nt.p)t.fillRect(199.5*e,115*e,1*e,140*e),t.fillText(`Lv${l.lv}`,100*e,78*e),t.textAlign="center",t.fillStyle="#f00",t.font=A(60*e),t.fillText("❤",100*e,180*e),t.fillStyle="#fff",t.font=A(48*e),t.fillText("HP",300*e,180*e),t.font=A(30*e),t.fillText(`${x.nt.tt.t1} ➔ ${x.nt.tt.t2}`,100*e,230*e),t.fillText(`${x.nt.tt.t3} ➔ ${x.nt.tt.t4}`,300*e,230*e),l.ht>=100&&(t.font=A(10*e),t.fillText(`${x.nt.tt.t5}`,100*e,250*e),t.fillText(`${x.nt.tt.t6}`,300*e,250*e));else if("T3"===x.nt.p)t.fillText(`Lv${l.lv}`,100*e,78*e),t.font=A(16*e),t.fillStyle="#fff",t.textAlign="center",t.fillText(x.nt.tt.t1,200*e,120*e),t.fillText("❤ 100",200*e,150*e),t.fillText(x.nt.tt.t5,200*e,180*e),t.fillText(x.nt.tt.t6,200*e,210*e);else if("T4"===x.nt.p)t.fillText(`Lv${l.lv}`,100*e,78*e),t.font=A(16*e),t.fillStyle="#fff",t.textAlign="center",t.fillText(`${x.nt.tt.t1}`,200*e,200*e);else if("F"===x.nt.p)t.fillText(`Lv${l.lv}`,100*e,78*e),t.font=A(130*e),t.fillStyle=x.nt.f,t.textAlign="center",t.fillText("⚔",200*e,220*e);else if("F2"===x.nt.p){t.font=A(30*e),t.fillStyle="#0f0",t.textAlign="center",t.fillText("WIN",200*e,120*e),t.font=A(16*e),t.fillText(`${l.n} ❤-${x.nt.ft.t1}`,200*e,150*e);let n=`Hp-${x.nt.ft.t2}`;"0"!==x.nt.ft.t3&&(n+=`Troops-${x.nt.ft.t3}`),t.fillText(n,200*e,180*e),t.fillText(`G+${x.nt.ft.t4} Exp+${x.nt.ft.t5}`,200*e,210*e),t.fillText(`${x.nt.ft.t6}`,200*e,240*e)}else"F3"===x.nt.p&&(t.font=A(30*e),t.fillStyle="#0ff",t.textAlign="center",t.fillText("LOSE",200*e,120*e),t.font=A(16*e),t.fillText(`${l.n} ❤-${x.nt.ft.t1}`,200*e,150*e),t.fillText(`Hp-${x.nt.ft.t2}`,200*e,180*e),t.fillText(`Troops-${x.nt.ft.t3}`,200*e,210*e))})(t),"N"===x.nt.p){const e=N(t,1===x.hNBtn),l=C(t,40,310,"♡",2===x.hNBtn,!0),n=C(t,220,310,"⚔",3===x.hNBtn,!0);return(t,o)=>r(t,o,e)?1:r(t,o,l)?2:r(t,o,n)?3:0}if(["T2","T4","F2","F3"].includes(x.nt.p)){const e=C(t,130,300,"OK",2===x.hNBtn);return(t,l)=>r(t,l,e)?1:0}if(["T3"].includes(x.nt.p)){const e=C(t,40,300,"NO",2===x.hNBtn),l=C(t,220,300,"YES",2===x.hNBtn);return(t,n)=>r(t,n,e)?11:r(t,n,l)?12:0}return(t,e)=>0},X=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#111",t.fillRect(0,0,e.width,e.height);const l=C(t,40,340,"New",2===x.hOBtn,!0),n=C(t,220,340,"Home",3===x.hOBtn,!0);return(t=>{const e=x.s;t.textAlign="left",t.fillStyle="#333",t.fillRect(20*e,20*e,360*e,65*e);let l="W"===x.ot.t;t.fillStyle=l?"#0f0":"#f00",t.wrap(()=>{t.translate(64*x.s,58*x.s),l?P(t,!0,!1):P(t,!1,!0)});const n=l?"Congratulations!":"Game Over!",o=l?"You saved Black Cat!":"You didn't save Black Cat!";t.font=A(20*e),t.fillText(n,110*e,47*e),t.font=M(16*e),t.fillText(o,110*e,73*e),t.fillRect(20*e,85*e,360*e,1*e),t.fillStyle=l?"#ccc":"#aaa",t.font=A(12*e);const i=50*e,s=230*e,r=120*e,f=30*e;t.fillText(`Year : ${Math.floor(x.ot.h.yr)}`,i,r),t.fillText(`Lv : ${x.ot.h.lv}`,i,r+1*f),t.fillText(`Atk : ${x.ot.h.atk}`,i,r+2*f),t.fillText(`Def : ${x.ot.h.def}`,i,r+3*f),t.fillText(`Exp : ${x.ot.h.exp}`,i,r+4*f),t.fillText(`Gold : ${c(x.ot.h.g)}`,i,r+5*f),t.fillText(`Troops : ${c(x.ot.h.tps)}`,s,r),t.fillText(`City : ${Math.max(...x.ot.acs)}`,s,r+1*f),t.fillText(`Member : ${x.ot.h.mbs.length}`,s,r+2*f),t.fillText(`Win Boss : ${Math.max(...x.ot.acw)}`,s,r+3*f);const h=x.its.find(t=>t.id===x.ot.h.wp)?.name||"--";t.fillText(`Top Sword: ${h}`,s,r+4*f);const a=x.its.find(t=>t.id===x.ot.h.ar)?.name||"--";t.fillText(`Top Armor: ${a}`,s,r+5*f),t.fillStyle="#fff",t.fillText(`Reason: ${x.ot.r}`,i,r+6*f)})(t),(t,e)=>r(t,e,l)?2:r(t,e,n)?3:0},j=()=>{const t=x.s,e=364*t,l=260*t;return{x:18*t,y:64*t,w:e,h:l,iW:e/2,iH:l/5}},q=(t,e)=>{t.clearRect(0,0,e.width,e.height),H(t,"Team");const l=N(t,1===x.hTBtn);let n=x.cTId===x.hero.mm,o=x.cTId===x.hero.mm;const i=C(t,40,340,"Set main",2===x.hTBtn,!0,n),s=C(t,220,340,"Remove",3===x.hTBtn,!0,o);(t=>{const e=x.s,{x:l,y:n,w:o,h:i,iW:s,iH:c}=j(),r=.4*e;t.fillStyle="#333",t.fillRect(l,n,o,i),t.lineWidth=r,t.strokeStyle="#aaa",t.strokeRect(l,n+1*c,o,r),t.strokeRect(l,n+2*c,o,r),t.strokeRect(l,n+3*c,o,r),t.strokeRect(l,n+4*c,o,r),t.strokeRect(l+1*s,n+c,r,i-c),t.strokeStyle="#fff",t.lineWidth=2*e,t.strokeRect(l-1*e,n-1*e,o+2*e,i+2*e)})(t);const{x:c,y:h,iW:d,iH:p}=j(),T=c/x.s,g=h/x.s,m=d/x.s,u=p/x.s,y=[];let k=[];return k=f(x.hero.mbs),-1===x.cTId&&k.length>0&&(x.cTId=k[0].id),k.forEach((e,l)=>{const n=T+l%2*m,o=g+Math.floor(l/2)*u,i=((t,e,l,n,o=!1,i=!1)=>{const s=x.s,c=e*s,r=l*s,{iW:f,iH:h}=j();o?(t.fillStyle="#222",t.fillRect(c+1*s,r+1*s,f-2*s,h-2*s),t.lineWidth=2*s,t.strokeStyle=i?"#D19A5A":"#fff",t.strokeRect(c+1*s,r+1*s,f-2*s,h-2*s)):i&&(t.lineWidth=2*s,t.strokeStyle="#D19A5A",t.strokeRect(c+1*s,r+1*s,f-2*s,h-2*s)),G(t,c+15*s,r+10*s,1,"#ddd"),t.fillStyle="#fff",t.font=A(12*s),t.textAlign="left",t.fillText(`${n.name} Lv${n.lv}`,c+24*s,r+17*s);let a="";if(n.eft.atk>0){const t=`Atk+${n.eft.atk}`;a+=""===a?t:" "+t}if(n.eft.def>0){const t=`Def+${n.eft.def}`;a+=""===a?t:" "+t}if(n.eft.hp>0){const t=`HP+${n.eft.hp}`;a+=""===a?t:" "+t}""!==a&&(t.fillStyle="#ccc",t.font=A(10*s),t.textAlign="left",t.fillText(a,c+9*s,r+33*s));let d="";if(n.eft.gd>0){const t=`Gold+${Math.floor(1e3*n.eft.gd)/10}%`;d+=""===d?t:" "+t}if(n.eft.exp>0){t.fillStyle="#ccc",t.font=A(10*s);const e=`Exp+${Math.floor(1e3*n.eft.exp)/10}%`;d+=""===d?e:" "+e}return""!==d&&t.fillText(d,c+9*s,r+46*s),{x:c,y:r,width:f,height:h,member:n}})(t,n,o+u,e,x.cTId===e.id,e.id===x.hero.mm);y.push(i)}),(t=>{const e=x.s;if(x.nps.find(t=>t.id===x.cTId)){t.fillStyle="#fff",t.textAlign="left",t.font=A(15*e);const l=x.hero.mbs.find(t=>t.id===x.hero.mm);l?(t.fillText(`Main: ${l.name}`,26*e,87*e),t.font=A(11*e),t.fillText(`(${a(l.eft)}) × 2`,116*e,86*e)):t.fillText("Main: ---",26*e,87*e),t.font=A(11*e),t.fillStyle="#ddd",t.fillText(`Total: ${a(_())}`,26*e,105*e)}})(t),(t,e)=>{for(let l=0;l<y.length;l++)if(r(t,e,y[l]))return 100+y[l].member.id;return r(t,e,l)?1:r(t,e,i)&&!n?2:r(t,e,s)&&!o?3:0}},J=(t,e)=>{t.clearRect(0,0,e.width,e.height);const l=x.cts.find(t=>t.id===x.sCId);H(t,`Move to city ${l?.id}`);const n=N(t,1===x.hVBtn),o=x.s,i=200*o,s=80*o,c=66*o;x.mv.evs.forEach((e,l)=>{t.fillStyle="#ccc",t.textAlign="center",t.font=M(24*o),t.fillText(e.h,i,s+c*l),t.fillStyle="#fff",t.font=A(16*o),t.fillText(e.d,i,s+c*l+25*o)});const f=C(t,130,340,"Close",2===x.hVBtn,!0);return(t,e)=>r(t,e,n)?1:r(t,e,f)?2:0};let K=0,U=0,Q=10,Z=0,tt="",et=0;const lt=(t,e)=>{t.clearRect(0,0,e.width,e.height),H(t,"Get troops");const l=N(t,1===x.hTPBtn);(()=>{const t=x.hero.tps||0,e=x.hero.g||0;Q=t<5e3?10:t<7500?15:t<1e4?20:25,U=e>0?Math.floor(e/Q):0,K>U&&(K=U),Z=K*Q})();const n=x.s,o=x.hero.tps||0,i=x.hero.g||0,s=x.baseW*n/2;t.fillStyle="#fff",t.font=A(15*n),t.textAlign="center",t.fillText(`You have troops: ${o}, gold: ${i}`,s,80*n),t.fillStyle="#fff",t.font=A(20*n),t.textAlign="center",t.fillText(`Troops to recruit: ${K}`,s,130*n),t.fillText(`Total price: ${Z} G`,s,160*n);const{sliderX:c,sliderY:f,sliderWidth:h,sliderHeight:a}=((t,e)=>{const l=60*e,n=180*e,o=280*e,i=20*e;t.fillStyle="#444",t.fillRect(l,n,o,i);const s=U>0?K/U*o:0;t.fillStyle="#66f",t.fillRect(l,n,s,i);const c=Math.max(l,Math.min(l+o,l+s));return t.fillStyle="#fff",t.beginPath(),t.arc(c,n+i/2,15*e,0,2*Math.PI),t.fill(),{sliderX:l,sliderY:n,sliderWidth:o,sliderHeight:i}})(t,n);Date.now()-et<2e3&&(t.fillStyle="#ff0",t.font=A(15*n),t.textAlign="center",t.fillText(tt,s,230*n));const d=C(t,140,250,"Get troops",2===x.hTPBtn,!0),p=C(t,140,340,"Close",3===x.hTPBtn,!0),T={x:c-10*n,y:f-10*n,width:h+20*n,height:a+20*n};return(t,e,n=!1)=>{if(r(t,e,l))return 1;if(r(t,e,p))return 3;if(r(t,e,d))return 2;if(r(t,e,T)){if(!n){const e=Math.max(0,Math.min(1,(t-c)/h));return K=Math.round(e*U),Z=K*Q,5}return 6}return 0}},nt=(t,e)=>{t.clearRect(0,0,e.width,e.height),H(t,"Start Game");const l=x.s;t.fillStyle="#ccc",t.textAlign="center",t.font=A(14*l),["Number kingdom existed","King 13-13 and ruled 13 cities","Each city: boss 13","Beat boss to advance","13-13 took your cat","Go to City 13","13 years to save cat","Good luck!"].forEach((e,n)=>{t.fillText(e,200*l,(70+30*n)*l)});const n=C(t,130,330,"Start",2===x.hSBtn,!0);return(t,e)=>r(t,e,n)?2:0},ot=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#333",t.fillRect(0,0,e.width,e.height),H(t,"Start Game");const l=x.s;t.fillStyle="#fff",t.textAlign="center",t.fillText("Start new game?",200*l,100*l),t.fillText("Progress will be lost.",200*l,140*l),t.wrap(()=>{t.translate(200*x.s,330*x.s),P(t,!0,!1)});const n=C(t,130,240,"Back",2===x.hCBtn,!0),o=C(t,130,320,"Confirm",3===x.hCBtn,!0);return(t,e)=>r(t,e,n)?2:r(t,e,o)?3:0},it=function(){const t=document.querySelector("#canvas");if(!t)return;const e=t.getContext("2d");if(!e)return;e.textBaseline="alphabetic",e.imageSmoothingEnabled=!1,(()=>{const t=localStorage.getItem(w);if(t){const e=JSON.parse(t);e?.v&&1===e?.v&&(x=f(e.a),x.c=e.c,x.cs="H",x.nt=f(m),x.ot=f(u))}})();const l=()=>{switch(e.clearRect(0,0,t.width,t.height),x.cs){case"H":R(e,t);break;case"M":O(e,t);break;case"N":z(e,t);break;case"I":L(e,t);break;case"T":q(e,t);break;case"V":J(e,t);break;case"O":X(e,t);break;case"TP":lt(e,t);break;case"S":nt(e,t);break;case"C":ot(e,t)}},{handleMouseMove:n,handleClick:c,handleTouchStart:r,handleTouchMove:a,handleTouchEnd:d}=((t,e)=>{let l=!1;t.addEventListener("mousedown",()=>{l=!0}),t.addEventListener("mouseup",()=>{l=!1});const n=(t,n,o)=>{const i=o.getBoundingClientRect(),s=t.clientX-i.left,c=t.clientY-i.top;if("I"===x.cs){const t=L(n,o)(s,c);o.style.cursor=t?"pointer":"default"}else if("N"===x.cs){const t=z(n,o)(s,c);t?(o.style.cursor="pointer",x.hNBtn=t):(o.style.cursor="default",x.hNBtn=0)}else if("M"===x.cs){const t=O(n,o)(s,c);o.style.cursor=t?"pointer":"default"}else if("T"===x.cs){const t=q(n,o)(s,c);t?(o.style.cursor="pointer",x.hTBtn=t):(o.style.cursor="default",x.hTBtn=0)}else if("TP"===x.cs){const t=lt(n,o)(s,c,!l);5===t||6===t?(o.style.cursor="pointer",x.hTPBtn=t,e()):t?(o.style.cursor="pointer",x.hTPBtn=t):(o.style.cursor="default",x.hTPBtn=0)}else if("C"===x.cs){const t=ot(n,o)(s,c);t?(o.style.cursor="pointer",x.hCBtn=t):(o.style.cursor="default",x.hCBtn=0)}else if("S"===x.cs){const t=nt(n,o)(s,c);t?(o.style.cursor="pointer",x.hSBtn=t):(o.style.cursor="default",x.hSBtn=0)}else if("O"===x.cs){const t=X(n,o)(s,c);t?(o.style.cursor="pointer",x.hOBtn=t):(o.style.cursor="default",x.hOBtn=0)}else if("V"===x.cs){const t=J(n,o)(s,c);t?(o.style.cursor="pointer",x.hVBtn=t):(o.style.cursor="default",x.hVBtn=0)}else if("H"===x.cs){const t=R(n,o)(s,c);t?(o.style.cursor="pointer",x.hHBtn=t):(o.style.cursor="default",x.hHBtn=0)}},c=(t,l,n)=>{const c=n.getBoundingClientRect(),r=t.clientX-c.left,a=t.clientY-c.top;if("I"===x.cs){const t=L(l,n)(r,a);t&&(t=>{if(1===t)x.cs="M",x.inS=!1,x.cIId=0;else if(2===t){const t=x.its.find(t=>t.id===x.cIId);if(t)if(x.inS)x.hero.g>=t.gd&&t.ct<13&&(x.hero.g-=t.gd,t.ct+=1);else if(1===t.type){const e=x.its.find(t=>t.id===x.hero.wp);e&&D(e,!1),D(t,!0),x.hero.wp=t.id}else if(2===t.type){const e=x.its.find(t=>t.id===x.hero.ar);e&&D(e,!1),D(t,!0),x.hero.ar=t.id}b()}else if(3===t){const t=x.its.find(t=>t.id===x.cIId);t&&(x.inS?x.hero.wp===t.id||x.hero.ar===t.id?t.ct>1&&(x.hero.g+=Math.floor(t.gd/2),t.ct-=1):t.ct>0&&(x.hero.g+=Math.floor(t.gd/2),t.ct-=1):x.hero.wp!==t.id&&x.hero.ar!==t.id||(D(t,!1),1===t.type?x.hero.wp=-1:2===t.type&&(x.hero.ar=-1))),b()}else if(t>=100){const e=t-100,l=x.its.find(t=>t.id===e);l&&(x.cIId=l.id)}})(t)}else if("N"===x.cs){const t=z(l,n)(r,a);t&&((t,e)=>{switch(t){case 1:case 11:x.cs="M",x.nt=f(m);break;case 2:(t=>{x.nt.p="T",t(),setTimeout(()=>{x.nt.d="..",t(),setTimeout(()=>{x.nt.d="...",t(),setTimeout(()=>{const e=x.nps.find(t=>t.id===x.cNId);if(e){const{haveGold:t,haveItem:l}=((t,e)=>({haveGold:t.hero.g>=e.nGd,haveItem:t.its.find(t=>t.id===e.nItem.id&&t.ct>=e.nItem.count)}))(x,e);if(e.ht>=100&&t&&l){x.nt.tt.t1=`${e.n}: Can I join your team?`;const t=`Need item: ${e.nItem.name} - ✔`;x.nt.tt.t5=`Need gold: ${e.nGd} - ✔`,x.nt.tt.t6=t,x.nt.p="T3"}else{x.nt.tt.t1=e.ht+"";const n=Math.floor(e.id%1e3/4),o=5+s(Math.floor(1.6*n),Math.floor(n/1.3));if(e.ht+=o,e.ht>100&&(e.ht=100),x.nt.tt.t2=e.ht+"",x.nt.tt.t3=x.hero.hp+"",x.hero.hp-=10,x.nt.tt.t4=x.hero.hp+"",e.ht>=100){const n=`Need item: ${e.nItem.name} - ${l?"✔":"✖"}`;x.nt.tt.t5=`Need gold: ${e.nGd} - ${t?"✔":"✖"}`,x.nt.tt.t6=n}x.nt.p="T2",x.hero.hp<=0&&(x.hero.hp=0,x.nt=f(m),I("L","No HP left after conversation"))}}else x.nt.p="T2";x.c&&b(),t()},k)},k)},k)})(e);break;case 3:(t=>{const e=x.nps.find(t=>t.id===x.cNId)||x.nps[0];x.nt.p="F",t(),setTimeout(()=>{x.nt.f="#fff",t(),setTimeout(()=>{x.nt.f="#aaa",t(),setTimeout(()=>{const l=Y(x.hero,x.nps.find(t=>t.id===x.cNId));let n=!1;if(i()<l.wc){x.hero.g+=e.g,x.nt.ft.t4=e.g+"";const t=(t=>{let e=!1;for(x.hero.exp+=t;x.hero.exp>=x.hero.mExp;)x.hero.lv+=1,x.hero.exp-=x.hero.mExp,x.hero.mExp=1e3*x.hero.lv,x.hero.mHp+=10,x.hero.hp=x.hero.mHp,x.hero.atk+=20*x.hero.lv,x.hero.def+=10*x.hero.lv,e=!0;return e})(e.exp);x.nt.ft.t5=t?`${e.exp}, Lv ➔ ${x.hero.lv}`:e.exp+"",x.nt.ft.t6="";const l=e.items.filter(t=>t.id<30&&i()<40-t.id||t.id>=30&&i()<70-t.id);l.length>0&&l.forEach(t=>{x.nt.ft.t6+=""===x.nt.ft.t6?`+${t.name}`:`, +${t.name}`,S(x.its.find(e=>e.id===t.id))}),"B"!==e.t||x.acw.includes(x.sCId)||(x.acw.push(x.sCId),x.cts.find(t=>t.id===x.sCId).go.forEach(t=>{x.acs.includes(t)||(x.cts.find(e=>e.id===t).isA=!0,x.acs.push(t))}),x.nps.forEach(t=>{t.lv++,t.g=Math.floor(1.07*t.g),t.exp=Math.floor(1.07*t.exp),t.tps=Math.floor(1.07*t.tps),t.h=Math.floor(1.07*t.h),t.atk=Math.floor(1.07*t.atk),t.def=Math.floor(1.07*t.def)})),n=!0}const o=s(10,5);e.ht-=o,x.nt.ft.t1=o+"";const c=n?l.w:l.l;x.hero.hp-=c.hp,x.nt.ft.t2=c.hp+"";const r=Math.floor(c.tps*e.tps/10);x.hero.tps-=n?Math.floor(r/3):r,x.nt.ft.t3=r+"",x.nt.p=n?"F2":"F3",n&&"13-13"===e.n?I("W","Win 13-13"):x.hero.tps<=0?(x.hero.tps=0,x.nt=f(m),I("L","No Troops left after fight")):x.hero.hp<=0&&(x.hero.hp=0,x.nt=f(m),I("L","No HP left after fight")),x.c&&b(),t()},k)},k)},k)})(e);break;case 12:const t=x.cNpcs.find(t=>t.id===x.cNId);t&&(v(t),x.nt.tt.t1=`Welcome ${t.n} to join the team`,x.nt.p="T4")}})(t,e)}else if("M"===x.cs){const t=O(l,n)(r,a);t>0&&(t=>{if(1===t)x.cs="I";else if(2===t)x.cs="T";else if(3===t)x.cs="H";else if(4===t)x.cs="TP";else if(t>=1e5){const e=t,l=x.cNpcs.find(t=>t.id===e);l&&("N"===l.t||"B"===l.t?(x.cs="N",x.cNId=l.id):"S"===l.t&&(x.cs="I",x.inS=!0))}else if(t>=100){const e=t-100,l=x.cts.find(t=>t.id===x.sCId);l&&l.id!==e&&l.isA&&l.go.includes(e)&&(t=>{x.sCId=t,x.cts.forEach(t=>{t.isA=!1});const e=x.cts.find(e=>e.id===t);e&&(e.isA=!0,x.cNpcs=h(e,x.nps),e.go.forEach(t=>{const e=x.cts.find(e=>e.id===t);e&&x.acs.includes(e.id)&&(e.isA=!0)})),(()=>{if(x.mv.evs=[],o()<.25){const t=s(5,1);x.mv.evs.push(F(t))}if(o()>.84){const t=s(14,11);x.mv.evs.push(F(t))}o()<.03&&x.mv.evs.push(F(21)),o()>.97&&x.mv.evs.push(F(31)),x.mv.evs.length>0&&(x.cs="V")})(),x.hero.yr+=.1,x.hero.hp+=60,x.hero.hp>x.hero.mHp&&(x.hero.hp=x.hero.mHp),x.hero.yr>=13&&I("L","13 years failed"),x.c&&b()})(e)}})(t)}else if("T"===x.cs){const t=q(l,n)(r,a);t>0&&((t,e)=>{if(1===t)x.cs="M",x.cTId=-1;else if(2===t)x.hero.mm=x.hero.mbs.find(t=>t.id===x.cTId)?.id||0,b();else if(3===t)x.hero.mm!==x.cTId&&(x.hero.mbs=x.hero.mbs.filter(t=>t.id!==x.cTId),x.cTId=-1,b(),e());else if(t>=100){const e=t-100,l=x.hero.mbs.find(t=>t.id===e);l&&(x.cTId=l.id)}})(t,e)}else if("TP"===x.cs){const t=lt(l,n)(r,a);t>0&&((t,e)=>{if(1===t||3===t)x.cs="M";else if(2===t)if(K>0&&Z<=(x.hero.g||0)){x.hero.g=(x.hero.g||0)-Z,x.hero.tps=(x.hero.tps||0)+K;const t=K;K=0,tt="Successfully recruited "+t+" troops!",et=Date.now(),b()}else 0===K?(tt="Please select troops to recruit",et=Date.now()):(tt="Insufficient gold",et=Date.now());else 5!==t&&6!==t||e()})(t,e)}else if("S"===x.cs){const t=nt(l,n)(r,a);t>0&&(t=>{2===t&&(x.cs="M")})(t)}else if("C"===x.cs){const t=ot(l,n)(r,a);t>0&&(t=>{2===t&&(x.cs="H"),3===t&&($(),b())})(t)}else if("O"===x.cs){const t=X(l,n)(r,a);t>0&&(t=>{2===t?($(),x.cs="S"):3===t&&(x.cs="H")})(t)}else if("V"===x.cs){const t=J(l,n)(r,a);t>0&&(t=>{(1===t||2===t)&&(x.cs="M")})(t)}else if("H"===x.cs){const t=R(l,n)(r,a);t>0&&(t=>{2===t?x.cs="C":3===t&&(x.cs="M")})(t)}e()};return{handleMouseMove:n,handleClick:c,handleTouchStart:(t,e,l)=>{t.preventDefault();const o=t.touches[0];l.getBoundingClientRect(),n({clientX:o.clientX,clientY:o.clientY},e,l)},handleTouchMove:(t,l,n)=>{if("TP"===x.cs){t.preventDefault();const o=t.touches[0],i=n.getBoundingClientRect(),s=o.clientX-i.left,c=o.clientY-i.top,r=lt(l,n)(s,c,!1);5!==r&&6!==r||e()}},handleTouchEnd:(t,e,l)=>{t.preventDefault();const n=t.changedTouches[0];l.getBoundingClientRect(),c({clientX:n.clientX,clientY:n.clientY},e,l)}}})(t,l);t.addEventListener("mousemove",l=>n(l,e,t)),t.addEventListener("click",l=>c(l,e,t)),t.addEventListener("touchstart",l=>r(l,e,t)),t.addEventListener("touchmove",l=>a(l,e,t)),t.addEventListener("touchend",l=>d(l,e,t)),t.addEventListener("touchstart",t=>t.preventDefault(),{passive:!1}),t.addEventListener("touchmove",t=>t.preventDefault(),{passive:!1});const p=()=>{const n=t.parentElement;if(!n)return;const o=window.devicePixelRatio||1;t.width=n.clientWidth*o,t.height=n.clientHeight*o,t.style.width=n.clientWidth+"px",t.style.height=n.clientHeight+"px",e.scale(o,o),l()};return p(),{canvas:t,ctx:e,resize:p}}(),st=()=>{const t=document.querySelector("#can-con"),e=document.querySelector("#app");if(!t||!e)return;const l=Math.min(e.offsetWidth,e.offsetHeight);t.style.width=`${l}px`,t.style.height=`${l}px`,x.s=l/x.baseW,it&&it.resize()};st(),window.addEventListener("resize",()=>{st()})</script>