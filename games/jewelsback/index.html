<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Jewelsback</title><style>body,html{height:100%;overflow:hidden}body{position:relative;margin:0;padding:0;background:#000;font:400 1.15em/1.1 fantasy;display:flex;flex-flow:column;justify-content:center;align-items:center}@media (max-width:640px){body{font-size:1em}}#background{position:absolute;width:100%;height:100%;background:radial-gradient(ellipse at center,#0869ad 0,#0a3446 100%);overflow:hidden;z-index:1}#content{position:relative;z-index:2;display:flex;flex-flow:column;justify-content:center;align-items:center;width:100%}@media (orientation:landscape){#content{flex-flow:row}}header,main,section{display:flex;flex:2;justify-content:center;align-items:center;height:100vh}header,section{flex:1;flex-flow:column;color:#fff;font-size:2em}header h1,section h1{text-align:right;font:400 1.5em/.85 fantasy}header h1 span,section h1 span{display:block}@media (max-width:640px){header h1,section h1{margin:1.5rem 0 1rem}}header strong,section strong{font-size:2em}@media (max-width:640px){header strong,section strong{font-size:1.5em;margin-left:1rem}}@media (orientation:portrait){section{margin-top:1.25rem}}@media (max-width:640px){section{flex-flow:row}}#message{position:fixed;top:0;right:0;bottom:0;left:0;display:flex;flex-flow:column;justify-content:center;align-items:center;text-align:center;background:rgba(0,0,0,.267);backdrop-filter:sepia(.5) brightness(.65) blur(10px);padding:1.25rem;font-size:3.5em;z-index:3;opacity:0;pointer-events:none;visibility:hidden;transition:opacity 1s ease}#message p{font-size:.5em;color:rgba(204,238,255,.933)}@media (max-width:640px){#message{font-size:2.5em}}#start{font-size:.75em;margin:1.5rem;padding:.75rem 1.5rem;border:2px solid hsla(0,0%,100%,.267);color:#000;font-weight:600;text-shadow:0 0 10px hsla(0,0%,100%,.333),0 2px 3px rgba(28,251,169,.467),0 -2px 3px rgba(28,251,169,.467);box-shadow:0 2px 4px rgba(0,0,0,.333),0 0 30px rgba(0,0,0,.2);background:linear-gradient(45deg,hsla(0,0%,100%,0) 45%,rgba(175,255,225,.4) 50%,hsla(0,0%,100%,0) 55%,hsla(0,0%,100%,0)),radial-gradient(#1cfba9,#199e92);background-position:-200%,50% 50%;background-size:250%;outline:2px solid rgba(28,251,169,0);outline-offset:0;transition:all .25s ease-in}#start:focus,#start:hover{animation:background-shine 1.5s ease-in infinite both;outline-color:#1cfba9;outline-offset:4px}#start:active{transform:scale(.95)}[hidden]{display:none!important}.text-shine{background-color:#daefff;background-image:linear-gradient(30deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(150deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(30deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(150deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(60deg,hsla(0,0%,100%,.333) 25%,transparent 25.5%,transparent 75%,hsla(0,0%,100%,.333) 0,hsla(0,0%,100%,.333)),linear-gradient(60deg,hsla(0,0%,100%,.333) 25%,transparent 25.5%,transparent 75%,hsla(0,0%,100%,.333) 0,hsla(0,0%,100%,.333));background-position:0 0,0 0,10px 17.5px,10px 17.5px,0 0,10px 17.5px;background-size:10px 17.5px;position:relative;color:transparent;-webkit-background-clip:text;background-clip:text}.text-shine:before{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,hsla(0,0%,100%,0) 45%,hsla(0,0%,100%,.933) 50%,hsla(0,0%,100%,0) 55%,hsla(0,0%,100%,0));background-size:250%;color:transparent;content:attr(data-text);text-shadow:0 1px 2px rgba(0,0,0,.6),-2px 2px 20px rgba(0,0,0,.067),2px 2px 20px rgba(0,0,0,.067),0 15px 35px rgba(0,0,0,.2);animation:text-shine 3.5s ease-in 2s infinite both;-webkit-background-clip:text;mix-blend-mode:screen}@keyframes text-shine{0%{background-position:-200%}to{background-position:125%}}@-webkit-keyframes text-shine{0%{background-position:-200%}to{background-position:125%}}@keyframes background-shine{0%{background-position:-200%,50% 50%}to{background-position:125%,50% 50%}}@-webkit-keyframes background-shine{0%{background-position:-200%,50% 50%}to{background-position:125%,50% 50%}}@keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@-webkit-keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@-webkit-keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@keyframes jewel-exploding{0%{opacity:1;transform:scale(1)}75%{opacity:1;transform:scale(1.15)}to{opacity:0;transform:scale(.25) translate3d(0,5%,0)}}@-webkit-keyframes jewel-exploding{0%{opacity:1;transform:scale(1)}75%{opacity:1;transform:scale(1.15)}to{opacity:0;transform:scale(.25) translate3d(0,5%,0)}}@keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@-webkit-keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}@-webkit-keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}game-board{display:grid;overflow:hidden;box-sizing:border-box;width:calc(100vmin - 30px);height:calc(100vmin - 30px);border:5px solid rgba(51,51,51,.333);border-radius:10px;cursor:default;box-shadow:inset 0 5px 30px rgba(0,0,0,.467);backdrop-filter:blur(7px);transition:opacity .5s ease}game-board[grabbing]{cursor:grabbing!important}game-board:not([animating]) board-slot:not(:empty){cursor:pointer!important}game-board:empty{opacity:0}game-board:not([animating]) board-slot[selected]{background:rgba(51,102,153,.467);cursor:grabbing;animation:slot-selected .3s ease-in infinite alternate forwards}game-board:not([animating]) board-slot[selected] jewel-piece{z-index:2}board-slot{position:relative;box-sizing:border-box;outline:5px solid transparent;transition:all .5s ease}board-slot:nth-child(2n){background:rgba(17,17,17,.467)}board-slot:nth-child(odd){background:rgba(0,0,0,.467)}board-slot[locked]{border:3px solid rgba(51,51,51,.333);background:transparent;cursor:default}board-slot.exploding{animation:slot-exploding .3s ease both}board-slot.first-row.first-column{border-radius:4px 0 0 0}board-slot.first-row.last-column{border-radius:0 4px 0 0}board-slot.last-row.first-column{border-radius:0 0 0 4px}board-slot.last-row.last-column{border-radius:0 0 4px 0}jewel-piece{position:absolute;z-index:1;box-sizing:border-box;padding:7px;width:100%;height:100%;pointer-events:none;transform-style:preserve-3d}@media (max-width:640px){jewel-piece{width:110%;height:110%;top:-5%;left:-5%}}jewel-piece:not([hidden]){display:block}jewel-piece .border,jewel-piece .shape,jewel-piece .shape:after{box-sizing:border-box;width:100%;height:100%}jewel-piece .border{padding:2px}jewel-piece .shape{padding:15%}jewel-piece .shape:after{content:"";display:block}jewel-piece.arriving{animation:jewel-arriving .2s cubic-bezier(.25,.25,.5,1.1) forwards}jewel-piece.falling,jewel-piece.moving{transition:transform .1s cubic-bezier(.25,.25,.5,1.1)}jewel-piece.flipping{transition:transform .15s ease-in}jewel-piece.exploding{animation:jewel-exploding .35s ease-out forwards}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square]{padding:11px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{border-radius:10%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border{background:linear-gradient(130deg,#f88e86,#8d1108)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape{background:radial-gradient(#f99890,#d4190c);background:conic-gradient(from 45deg,#f55a4e,#f44336,#f33122,#f55246,#f44336,#f33628,#f55a4e,#f44336,#f33628,#f55044,#f44336,#f33122,#f65f54)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{background:linear-gradient(130deg,rgba(250,170,165,.3),rgba(250,170,165,.25))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border{background:linear-gradient(130deg,#ffe69c,#b78a00)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape{background:radial-gradient(#fd7,#c49300);background:conic-gradient(from 30deg,#ffc825,#ffc107,#f4b700,#ffc61b,#ffc107,#f9bb00,#ffc825,#ffc107,#f9bb00,#ffc518,#ffc107,#f4b700,#ffca2c)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{background:linear-gradient(130deg,rgba(255,236,181,.4),rgba(255,218,106,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle]{padding:10px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{border-radius:50%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border{background:linear-gradient(130deg,#f9ae80,#ba4c09)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape{background:radial-gradient(#f8a673,#ae4708);background:conic-gradient(from 45deg,#f4701f,#e85f0b,#d8580a,#f46914,#e85f0b,#dc5a0a,#f4701f,#e85f0b,#dc5a0a,#f46812,#e85f0b,#d8580a,#f57526)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{background:linear-gradient(130deg,rgba(248,157,102,.5),rgba(247,141,77,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{clip-path:polygon(50% 0,0 100%,100% 100%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border{background:linear-gradient(130deg,#fcecff,#9f04b9)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape{background:radial-gradient(#ee96fd,#c705e7);background:conic-gradient(from 120deg,#e457fb,#e040fb,#dc2afb,#e24ffb,#e040fb,#dd31fb,#e457fb,#e040fb,#dd31fb,#e24dfb,#e040fb,#dc2afb,#e55dfc);padding:22% 16% 11%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{background:linear-gradient(130deg,rgba(236,140,253,.5),rgba(236,140,253,.9))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border{background:linear-gradient(130deg,#f3f9ed,#547928)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape{background:radial-gradient(#bfde9b,#699832);background:conic-gradient(from 45deg,#99ca60,#8bc34a,#82bc3e,#94c858,#8bc34a,#85c040,#99ca60,#8bc34a,#85c040,#93c757,#8bc34a,#82bc3e,#9ccc65)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{background:linear-gradient(130deg,rgba(209,231,183,.4),rgba(185,219,146,.55))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{clip-path:polygon(30% 0,0 20%,0 55%,50% 100%,100% 55%,100% 20%,70% 0)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border{background:linear-gradient(130deg,#cde2fc,#09418a)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape{background:radial-gradient(#76aef6,#0b52ac);background:conic-gradient(from 45deg,#247ef1,#0f6de6,#0e65d6,#1a78f0,#0f6de6,#0e68db,#247ef1,#0f6de6,#0e68db,#1876f0,#0f6de6,#0e65d6,#2c82f1);padding:13% 15% 15%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{background:linear-gradient(130deg,rgba(155,196,249,.4),rgba(106,167,245,.55))}jewel-piece[promoted]:not(.arriving):not(.falling):not(.exploding) .shape{animation:jewel-brightening .5s ease .75s infinite alternate backwards}jewel-piece[promoted]:after{position:absolute;left:50%;z-index:2;width:175%;height:175%;background-position:50%;background-size:100% 100%;content:"";transform:translate3d(-50%,0,0);pointer-events:none}jewel-piece[promoted=smoke]{filter:drop-shadow(0 0 15px rgba(204,204,204,.333)) drop-shadow(0 4px 8px rgba(221,221,221,.667)) drop-shadow(0 2px 8px #555)}jewel-piece[promoted=smoke]:after{top:-12%;width:115%;height:115%;filter:brightness(5) contrast(1.2) opacity(.5)}jewel-piece[promoted=fire]{filter:drop-shadow(0 0 8px rgba(255,193,7,.333)) drop-shadow(0 4px 8px rgba(255,193,7,.667)) drop-shadow(0 2px 8px #f00)}jewel-piece[promoted=fire]:after{bottom:16%;left:52%;width:170%;height:140%;filter:saturate(2) brightness(1.2) contrast(1.25) opacity(1)}jewel-piece[promoted=fire][type=heptagon]:after{bottom:26%}jewel-piece[promoted=star]:after{animation:star-blinking .85s ease .75s infinite alternate both;width:110%;height:110%;top:-5%;clip-path:polygon(50% 0,55% 45%,100% 50%,55% 55%,50% 100%,45% 55%,0 50%,45% 45%);background-image:radial-gradient(circle,hsla(0,0%,100%,.733),hsla(0,0%,100%,.133));mix-blend-mode:lighten}jewel-piece[promoted=rainbow]{padding:8px}jewel-piece[promoted=rainbow] .border,jewel-piece[promoted=rainbow] .shape,jewel-piece[promoted=rainbow] .shape:after{border-radius:0;clip-path:polygon(30% 0,70% 0,100% 30%,100% 70%,70% 100%,30% 100%,0 70%,0 30%)}jewel-piece[promoted=rainbow] .border{background:linear-gradient(98deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 90deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape{background:linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 45deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape:after{background:linear-gradient(130deg,hsla(0,0%,100%,.133),hsla(0,0%,100%,.2));backdrop-filter:blur(4px)}jewel-piece[promoted=nebula] .border,jewel-piece[promoted=nebula] .shape{border-radius:50%;clip-path:none}jewel-piece[promoted=nebula] .border{filter:drop-shadow(0 0 3px #bbb lack);background:linear-gradient(130deg,#b8c7ce,#4c636e)}jewel-piece[promoted=nebula] .shape{background:linear-gradient(130deg,#455a64,#34444b)}jewel-piece[promoted=nebula] .shape:after{display:none}jewel-piece[promoted=nebula]:after{top:-36%;filter:brightness(0) contrast(2)}</style><link href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAKEAAAAAAAAAnAAAAFIAAABpAEdH/wCMjP8AsLD/AAAA4AD39/8A5ub/AAAAAAAAAAAAAAAAAAAAAAAAAAAAERREREREQRERQiIiIiIkERQyhmZmiDBBFCOFVVVTgkEUKDMzMzViQRQoNmd2NWJBFCg2l3c1YkEUKDaapzViQRQoNpqnNWJBFCg2l3c1YkEUKDZndjViQRQoMzMzNYJBFCOFVVVjgkEUMoaGZogyQRFCIiIiIiQRERREREREQRHgBwAAwAMAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADgBwAA" rel="icon" type="image/x-icon"></head><body><div id="background"></div><div id="content"><header><h1><span class="text-shine" data-text="Jewels">Jewels</span><span class="text-shine" data-text="back">back</span></h1><button id="start">Play now</button></header><main hidden></main><section hidden><label class="text-shine" data-text="Score:">Score:</label><strong class="text-shine" id="score" data-text="0">0</strong></section></div><aside id="message"><span class="text-shine" data-text=""></span><p id="finalScore" hidden>0</p></aside><script>parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"+sFh":[function(require,module,exports) {
const t=5e3;let e,i,n,o,r,d;function c(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width",window.innerWidth),e.setAttribute("height",window.innerHeight),document.querySelector("#background").appendChild(e);const c=(window.innerWidth+window.innerHeight)/20;i=Math.ceil(window.innerWidth/c)+1,n=Math.ceil(window.innerHeight/c)+1,o=Math.ceil(window.innerWidth/(i-1)),r=Math.ceil(window.innerHeight/(n-1)),d=[];for(let t=0;t<n;t++)for(let e=0;e<i;e++)d.push({x:o*e,y:r*t,originX:o*e,originY:r*t});s();for(let s=0;s<d.length;s++)if(d[s].originX!==o*(i-1)&&d[s].originY!==r*(n-1)){const n=d[s].x,o=d[s].y,r=d[s+1].x,c=d[s+1].y,u=d[s+i].x,l=d[s+i].y,g=d[s+i+1].x,a=d[s+i+1].y,p=Math.floor(2*Math.random());for(let d=0;d<2;d++){const h=document.createElementNS(e.namespaceURI,"polygon");0===p?0===d?(h.point1=s,h.point2=s+i,h.point3=s+i+1,h.setAttribute("points",`${n},${o} ${u},${l} ${g},${a}`)):1===d&&(h.point1=s,h.point2=s+1,h.point3=s+i+1,h.setAttribute("points",`${n},${o} ${r},${c} ${g},${a}`)):1===p&&(0===d?(h.point1=s,h.point2=s+i,h.point3=s+1,h.setAttribute("points",`${n},${o} ${u},${l} ${r},${c}`)):1===d&&(h.point1=s+i,h.point2=s+1,h.point3=s+i+1,h.setAttribute("points",`${u},${l} ${r},${c} ${g},${a}`))),h.setAttribute("fill",`rgba(0,0,0,${Math.random()/3})`);const $=document.createElementNS("http://www.w3.org/2000/svg","animate");$.setAttribute("fill","freeze"),$.setAttribute("attributeName","points"),$.setAttribute("dur",`${t}ms`),$.setAttribute("calcMode","linear"),h.appendChild($),e.appendChild(h)}}u()}function s(){for(let t=0;t<d.length;t++)0!==d[t].originX&&d[t].originX!==o*(i-1)&&(d[t].x=d[t].originX+Math.random()*o-o/2),0!==d[t].originY&&d[t].originY!==r*(n-1)&&(d[t].y=d[t].originY+Math.random()*r-r/2)}function u(){s();for(let t=0;t<document.querySelector("#background svg").childNodes.length;t++){const e=document.querySelector("#background svg").childNodes[t],i=e.childNodes[0];i.getAttribute("to")&&i.setAttribute("from",i.getAttribute("to")),i.setAttribute("to",`${d[e.point1].x},${d[e.point1].y} ${d[e.point2].x},${d[e.point2].y} ${d[e.point3].x},${d[e.point3].y}`),i.beginElement()}e=setTimeout(()=>{u()},t)}function l(){document.querySelector("#background svg").remove(),clearTimeout(e),c()}window.onload=c,window.onresize=l;
},{}],"o0GU":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,s){super(),t(this,"lastClick",null),this.x=e,this.y=s,this.addEventListener("mousedown",this.mousedown),this.addEventListener("touchstart",this.mousedown,!0),this.addEventListener("mouseup",this.mouseup),this.addEventListener("touchend",this.mouseup,!0),this.addEventListener("dragstart",t=>t.preventDefault())}connectedCallback(){0===this.y&&this.classList.add("first-row"),this.y===this.board.level.size-1&&this.classList.add("last-row"),0===this.x&&this.classList.add("first-column"),this.x===this.board.level.size-1&&this.classList.add("last-column")}get locked(){return""===this.getAttribute("locked")}set locked(t){t?this.setAttribute("locked",""):this.removeAttribute("locked")}get selected(){return""===this.getAttribute("selected")}set selected(t){t?this.setAttribute("selected",""):this.removeAttribute("selected"),this.jewel&&!t&&(this.jewel.matchable=!1)}get targetable(){return""===this.getAttribute("targetable")}set targetable(t){t?this.setAttribute("targetable",""):this.removeAttribute("targetable")}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get game(){return this.board.game}get board(){return this.parentElement}get jewel(){return this.firstElementChild}set jewel(t){t.x=this.x,t.y=this.y,t.classList.remove("moving"),t.style.transform=null,this.append(t)}mousedown(){if(!this.board.animating)return this.locked?this.board.unselectAll():void(null===this.board.findJewelSelected()&&(this.board.unselectAll(),this.board.updateTargetables(this),this.board.grabbing=!0,this.selected=!0,this.lastClick=Date.now()))}mouseup(t){if(this.board.animating)return;this.board.grabbing=!1,t.preventDefault(),t.stopPropagation();const e=t.changedTouches&&t.changedTouches.length>0?document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY):this;if(e){if(e.locked)return e.board.unselectAll();if(e.targetable){const t=e.board.findJewelSelected();return e.board.flipJewels(e.jewel,t)}(!e.lastClick||Date.now()-e.lastClick>250)&&e.board.unselectAll()}}}exports.default=e,customElements.define("board-slot",e);
},{}],"DQ1O":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,s){super(),t(this,"futureSlot",null),t(this,"futurePromotion",!1),this.type=s,this.checked=!1,this.x=e.x,this.y=e.y,this.setAttribute("hidden","");const r=document.createElement("div"),i=document.createElement("div");r.className="border",this.append(r),i.className="shape",r.append(i),e.append(this)}static get allTypes(){return Object.keys(e.types)}static get allSpecials(){return Object.keys(e.specials)}get type(){return this.getAttribute("type")}set type(t){this.setAttribute("type",t)}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get matchable(){return""===this.getAttribute("matchable")}set matchable(t){t?this.setAttribute("matchable",""):this.removeAttribute("matchable")}get promoted(){return this.getAttribute("promoted")}set promoted(t){t?this.setAttribute("promoted",t):this.removeAttribute("promoted")}get game(){return this.board.game}get board(){return this.slot.parentElement}get slot(){return this.parentElement}get above(){return this.parentElement}get canBePromoted(){return this.matchable&&!this.promoted}generateRandomPromotion(t,e){if(t){const s=[];if(t.smoke>e.filter(t=>"smoke"===t.promoted).length&&s.push("smoke"),t.fire>e.filter(t=>"fire"===t.promoted).length&&s.push("fire"),t.star>e.filter(t=>"star"===t.promoted).length&&s.push("star"),t.rainbow>e.filter(t=>"rainbow"===t.promoted).length&&s.push("rainbow"),t.nebula>e.filter(t=>"nebula"===t.promoted).length&&s.push("nebula"),s.length>0){const e=Object.values(t).reduce((t,e)=>t+e)+this.board.level.size*(this.board.level.size/2),r=Math.floor(Math.random()*e);r<s.length&&(this.promoted=Object.values(s)[r])}}}async move(t=!0){if(this.removeAttribute("hidden"),t)this.classList.add("arriving"),await this.game.delay(150),this.classList.remove("arriving");else{const t=this.slot.getBoundingClientRect().height*(this.y+1);this.style.transform=`translate3d(0, ${-t}px, 0)`,await this.game.delay(),this.classList.add("falling"),this.style.transform=null,await this.game.delay(150),this.classList.remove("falling")}}}exports.default=e,t(e,"types",{square:"square",heptagon:"heptagon",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",circle:"circle"}),t(e,"specials",{smoke:"smoke",fire:"fire",star:"star",rainbow:"rainbow",nebula:"nebula"}),t(e,"superSpecials",["rainbow","nebula"]),customElements.define("jewel-piece",e);
},{}],"a9lQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class o{constructor(i){this.board=i}generateUnmatchableShape(e,o,t){let s=this.board.level.types?this.board.level.types:i.default.allTypes;const n=(s=s.filter(i=>i!==t))[Math.random()*s.length<<0],h=this.board.findJewelByPosition(e-1,o),d=this.board.findJewelByPosition(e,o+1),a=this.board.findJewelByPosition(e-1,o+1);if(h&&d&&a&&d.type===n&&h.type===n&&a.type===n)return this.generateUnmatchableShape(e,o,n);const r=this.board.findJewelByPosition(e-2,o);if(h&&r&&h.type===n&&r.type===n)return this.generateUnmatchableShape(e,o,n);const l=this.board.findJewelByPosition(e,o+2);return d&&l&&d.type===n&&l.type===n?this.generateUnmatchableShape(e,o,n):n}checkMatchables(i,...e){for(let o of e)if(!o||i.type!==o.type)return[];return[i,...e]}findPossibleMatches(i){if(!i)return[];const e=[];let o=!1;e.push(...this.findMatchesForNebula(i,i.canBePromoted)),e.length>0&&(o=!0),e.push(...this.findMatchesForRainbow(i,!o&&i.canBePromoted)),e.length>0&&(o=!0),e.push(...this.findMatchesForStar(i,!o&&i.canBePromoted)),e.length>0&&(o=!0),e.push(...this.findMatchesForFire(i,!o&&i.canBePromoted)),e.length>0&&(o=!0),e.push(...this.findMatchesForSmoke(i,!o&&i.canBePromoted)),e.length>0&&(o=!0),e.push(...this.findMatchesOfThree(i)),e.push(...this.findMatchesForSpecials(e));for(let t of e)t.checked=!0;return e}findMatchesForSpecials(e){let o=[...e];if(e.length>0&&e.some(i=>i.promoted&&!i.futurePromotion)){const t=e.filter(i=>i.promoted&&!i.futurePromotion);for(let e of t){const{x:t,y:s}=e;if(e.promoted===i.default.specials.smoke)o.push(this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s+1),this.board.findJewelByPosition(t+1,s-1),this.board.findJewelByPosition(t-1,s+1),this.board.findJewelByPosition(t-1,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s-1));else if(e.promoted===i.default.specials.fire)o.push(this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s+1),this.board.findJewelByPosition(t+1,s-1),this.board.findJewelByPosition(t-1,s+1),this.board.findJewelByPosition(t-1,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t,s+2),this.board.findJewelByPosition(t,s-2));else if(e.promoted===i.default.specials.star){for(let i=0;i<this.board.level.size;i++)o.push(this.board.findJewelByPosition(i,s));for(let i=0;i<this.board.level.size;i++)o.push(this.board.findJewelByPosition(t,i))}}}return o.length>0&&(o=[...new Set(o.filter(i=>null!==i))]),o}findMatchesForNebula(e,o){const{x:t,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t-3,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+3,s),this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-3),this.board.findJewelByPosition(t,s-2),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-2),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2),this.board.findJewelByPosition(t,s+3))),this.promote(o,n,e,i.default.specials.nebula)}findMatchesForRainbow(e,o){const{x:t,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-2),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),this.promote(o,n,e,i.default.specials.rainbow)}findMatchesForStar(e,o){const{x:t,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t+2,s),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1))),this.promote(o,n,e,i.default.specials.star)}findMatchesForFire(e,o){const{x:t,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t+2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-2,s),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t+1,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-2),this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,s-1),this.board.findJewelByPosition(t,s+1),this.board.findJewelByPosition(t,s+2))),this.promote(o,n,e,i.default.specials.fire)}findMatchesForSmoke(e,o){const{x:t,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t-1,s+1),this.board.findJewelByPosition(t,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t+1,s+1),this.board.findJewelByPosition(t,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,s-1),this.board.findJewelByPosition(t-1,s),this.board.findJewelByPosition(t,s-1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(t+1,s-1),this.board.findJewelByPosition(t+1,s),this.board.findJewelByPosition(t,s-1))),this.promote(o,n,e,i.default.specials.smoke)}findMatchesOfThree(i){const{x:e,y:o}=i;let t=[];return t.push(...this.checkMatchables(i,this.board.findJewelByPosition(e-1,o),this.board.findJewelByPosition(e+1,o))),t.push(...this.checkMatchables(i,this.board.findJewelByPosition(e,o-1),this.board.findJewelByPosition(e,o+1))),t.filter(i=>null!==i)}promote(i,e,o,t){return e=e.filter(i=>null!==i),i&&e.length>0&&(o.futurePromotion=!0,o.promoted=t),e}}exports.default=o;
},{"./Jewel":"DQ1O"}],"1wX9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class s{constructor(i){this.board=i}findPossibleMoves(i){return i?[...this.findDirectMoves(i),...this.findIndirectMoves(i)]:[]}findDirectMoves(i){return i?[...this.findPossibleMovesTop(i),...this.findPossibleMovesRight(i),...this.findPossibleMovesBottom(i),...this.findPossibleMovesLeft(i)]:[]}findIndirectMoves(i){if(!i)return[];const e=[],{x:s,y:t}=i,o=this.board.findJewelByPosition(s,t-1),n=this.board.findJewelByPosition(s+1,t),h=this.board.findJewelByPosition(s,t+1),d=this.board.findJewelByPosition(s-1,t);return o&&e.push(...this.findPossibleMovesBottom(o,!0)),n&&e.push(...this.findPossibleMovesLeft(n,!0)),h&&e.push(...this.findPossibleMovesTop(h,!0)),d&&e.push(...this.findPossibleMovesRight(d,!0)),e}checkMatchable(e,s,t,...o){if(e.type===s.type)return null;for(let n of o)if(!n||e.type!==n.type&&e.promoted!==i.default.specials.nebula&&e.promoted!==i.default.specials.rainbow&&s.promoted!==i.default.specials.nebula&&s.promoted!==i.default.specials.rainbow)return null;return t?e:s}findPossibleMovesTop(e,s=!1){let t=[];const{x:o,y:n}=e,h=this.board.findJewelByPosition(o,n-1);return!h||h.locked?[]:(!s&&h&&(i.default.superSpecials.includes(e.promoted)||i.default.superSpecials.includes(h.promoted))&&t.push(h),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+2,n-1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-2,n-1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o+1,n-1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o,n-2),this.board.findJewelByPosition(o,n-3))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n-2),this.board.findJewelByPosition(o,n-2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n-2),this.board.findJewelByPosition(o,n-2))),(t=[...new Set(t.filter(i=>null!==i))]).length>0&&(e.matchable=!0),t)}findPossibleMovesRight(e,s=!1){let t=[];const{x:o,y:n}=e,h=this.board.findJewelByPosition(o+1,n);return!h||h.locked?[]:(!s&&h&&(i.default.superSpecials.includes(e.promoted)||i.default.superSpecials.includes(h.promoted))&&t.push(h),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+3,n))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+1,n+2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n-2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n+1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+2,n-1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+2,n+1))),(t=[...new Set(t.filter(i=>null!==i))]).length>0&&(e.matchable=!0),t)}findPossibleMovesBottom(e,s=!1){let t=[];const{x:o,y:n}=e,h=this.board.findJewelByPosition(o,n+1);return!h||h.locked?[]:(!s&&h&&(i.default.superSpecials.includes(e.promoted)||i.default.superSpecials.includes(h.promoted))&&t.push(h),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+2,n+1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-2,n+1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o+1,n+1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o,n+2),this.board.findJewelByPosition(o,n+3))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-1,n+2),this.board.findJewelByPosition(o,n+2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+1,n+2),this.board.findJewelByPosition(o,n+2))),(t=[...new Set(t.filter(i=>null!==i))]).length>0&&(e.matchable=!0),t)}findPossibleMovesLeft(e,s=!1){let t=[];const{x:o,y:n}=e,h=this.board.findJewelByPosition(o-1,n);return!h||h.locked?[]:(!s&&h&&(i.default.superSpecials.includes(e.promoted)||i.default.superSpecials.includes(h.promoted))&&t.push(h),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-3,n))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-1,n+2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n-2))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n+1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-2,n-1))),t.push(this.checkMatchable(e,h,s,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-2,n+1))),(t=[...new Set(t.filter(i=>null!==i))]).length>0&&(e.matchable=!0),t)}}exports.default=s;
},{"./Jewel":"DQ1O"}],"Wb9I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("./Slot")),t=l(require("./Jewel")),s=l(require("./MatchChecker")),i=l(require("./MoveChecker"));function l(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class o extends HTMLElement{constructor(e){super(),a(this,"slots",[]),a(this,"level",null),a(this,"height",null),a(this,"scoreMultiplier",0),this.game=e,this.matchChecker=new s.default(this),this.moveChecker=new i.default(this),document.addEventListener("click",e=>{const t=[document.documentElement,document.body];e.target&&!t.includes(e.target)||(e.stopPropagation(),this.unselectAll())})}connectedCallback(){this.height=this.offsetHeight}get grabbing(){return""===this.getAttribute("grabbing")}set grabbing(e){e?this.setAttribute("grabbing",""):this.removeAttribute("grabbing")}get animating(){return""===this.getAttribute("animating")}set animating(e){e?this.setAttribute("animating",""):this.removeAttribute("animating")}get jewels(){return this.occupiedSlots.map(e=>e.firstChild)}get unlockedSlots(){return this.slots.filter(e=>!e.locked)}get occupiedSlots(){return this.unlockedSlots.filter(e=>e.jewel&&!e.jewel.hasAttribute("hidden"))}get emptySlots(){return this.unlockedSlots.filter(e=>!e.jewel||e.jewel.hasAttribute("hidden")||e.jewel.classList.contains("moving"))}get emptySlotsGroupedByRow(){const e=this.emptySlots.sort((e,t)=>t.y-e.y||e.x-t.x),t=new Map;return e.forEach(e=>{const s=t.get(e.y);s?s.push(e):t.set(e.y,[e])}),t}findSlotByPosition(e,t){return this.querySelector(`board-slot[x="${e}"][y="${t}"]`)}findUnlockedSlotBelow(e){return this.unlockedSlots.filter(t=>t.x===e.x&&t.y>e.y).sort((e,t)=>e.y-t.y).shift()}findJewelByPosition(e,t){return this.querySelector(`jewel-piece[x="${e}"][y="${t}"]`)}findJewelSelected(){return this.querySelector("board-slot[selected] > jewel-piece")}findJewelsByType(e){return this.querySelectorAll(`jewel-piece[type="${e}"]`)}findJewelsBySpecial(e){return this.querySelectorAll(`jewel-piece[promoted="${e}"]`)}findJewelsPromoted(){return Array.from(this.querySelectorAll("jewel-piece[promoted]"))}async unselectAll(){for(let e of this.unlockedSlots)e.targetable=!1,e.selected=!1}updateTargetables(e){const t=this.moveChecker.findPossibleMoves(e.jewel);for(let s of t)s.slot.targetable=!0}async startLevel(t=o.startingLevel){if(this.game.levels.length-1<t)return this.showGameEnd("Congratulations!","You won!"),void this.explodeAll(!1);this.animating=!0,this.level=this.game.levels.filter(e=>e.index===t).shift(),this.slots.forEach(e=>e.remove()),this.slots=[],this.scoreMultiplier=0,this.level.index===o.startingLevel&&(this.style.opacity=0,await this.game.delay(500)),this.style.gridTemplateColumns=this.style.gridTemplateRows=`repeat(${this.level.size}, 1fr)`;for(let s=0;s<this.level.size;s++)for(let t=0;t<this.level.size;t++){const i=new e.default(t,s);i.locked=this.level.locks&&this.level.locks.some(e=>e.x===t&&e.y===s),this.append(i),this.slots.push(i)}if(this.level.name){if(this.game.message=this.level.name,await this.game.delay(2200),this.level.description){this.game.message=this.level.description;const e=250*this.level.description.split(" ").length;await this.game.delay(e)}}else this.game.message=`Level ${this.level.index}`,await this.game.delay(1500);return this.style.opacity=1,await this.game.delay(300),await this.fillEmptySlots(),this.level.index===o.startingLevel&&(this.game.message="Let's go!",await this.game.delay(600)),delete this.level.specials,this.game.message="",this.animating=!1,await this.hasPossibleMovesRemaining()?void 0:(this.animating=!0,await this.game.delay(300),this.showGameEnd("Out of luck...","Game Over!"))}async fillEmptySlots(e=!0){const s=this.emptySlotsGroupedByRow;for(let i of s.keys()){for(let l of s.get(i)){l.jewel&&l.jewel.remove();let s=null;try{s=this.matchChecker.generateUnmatchableShape(l.x,l.y)}catch{const e=t.default.allTypes;s=e[Math.random()*e.length<<0]}const i=new t.default(l,s);i.generateRandomPromotion(this.level.specials,this.findJewelsPromoted()),i.move(e)}await this.game.delay(e?200:100)}}async flipJewels(e,s){if(!e||!s)return;this.animating=!0,this.scoreMultiplier=0,e.classList.add("flipping"),s.classList.add("flipping");const i=e.getBoundingClientRect(),l=s.getBoundingClientRect();e.x>s.x?(e.style.transform=`translate3d(${-i.width}px, 0, 0)`,s.style.transform=`translate3d(${l.width}px, 0, 0)`):e.x<s.x?(e.style.transform=`translate3d(${i.width}px, 0, 0)`,s.style.transform=`translate3d(${-l.width}px, 0, 0)`):e.y>s.y?(e.style.transform=`translate3d(0, ${-i.height}px, 0)`,s.style.transform=`translate3d(0, ${l.height}px, 0)`):(e.style.transform=`translate3d(0, ${i.height}px, 0)`,s.style.transform=`translate3d(0, ${-l.height}px, 0)`),await this.game.delay(150),e.classList.remove("flipping"),s.classList.remove("flipping");const a=this.findSlotByPosition(s.x,s.y),o=this.findSlotByPosition(e.x,e.y);return a.jewel=e,o.jewel=s,e.promoted===t.default.specials.nebula&&s.promoted===t.default.specials.nebula?this.showGameEnd("Greed is ugly...","Game Over!"):(e.promoted===t.default.specials.rainbow&&s.promoted===t.default.specials.rainbow?await this.explodeAll():e.promoted===t.default.specials.nebula?await this.explodeNebula(e,s):s.promoted===t.default.specials.nebula?await this.explodeNebula(s,e):e.promoted===t.default.specials.rainbow?await this.explodeRainbow(e,s):s.promoted===t.default.specials.rainbow?await this.explodeRainbow(s,e):await this.explodeMatches(),await this.unselectAll(),await this.isLevelCompleted()?(setTimeout(()=>this.startLevel(this.level.index+1),150),!0):await this.hasPossibleMovesRemaining()?(this.animating=!1,!0):(this.showGameEnd("No more moves...","Game Over!"),!1))}async showGameEnd(e,t){if(e&&(this.animating=!0,this.game.message=e,await this.game.delay(1500)),this.game.message=t,this.game.score>0){const e=document.getElementById("finalScore");e.textContent="Final score: "+this.game.score,e.removeAttribute("hidden")}}async explodeAll(e=!0){await this.finishExplosion(this.jewels,e)}async explodeNebula(e,s){const i=[],l=[e];l.push(...this.findJewelsByType(s.type)),l.forEach(e=>{e.promoted&&!e.futurePromotion?l.push(e):i.push(e)}),i.length>0&&(this.scoreMultiplier++,i.forEach(e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")}),await this.game.delay(350),i.forEach(e=>{e.classList.remove("exploding"),e.promoted=t.default.specials.rainbow,e.futurePromotion=!0})),await this.finishExplosion(l)}async explodeRainbow(e,t){const s=[e];s.push(...this.findJewelsByType(t.type)),await this.finishExplosion(s)}async explodeMatches(){const e=[];for(let t=this.level.size-1;t>-1;t--)for(let s=0;s<this.level.size;s++){const i=this.findJewelByPosition(s,t);i&&e.push(...this.matchChecker.findPossibleMatches(i))}await this.finishExplosion(e)}async finishExplosion(e,t=!0){if(0===e.length)return;this.animating=!0,this.scoreMultiplier++;let s=[...new Set(e.filter(e=>null!==e))];t&&(s=s.filter(e=>!e.futurePromotion)),s.forEach(e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")}),await this.game.delay(350),s.forEach(e=>{e.setAttribute("hidden",""),e.classList.remove("exploding")}),t&&(await this.moveRows(),await this.fillEmptySlots(!1),await this.explodeMatches(),e.filter(e=>e.futurePromotion).forEach(e=>e.futurePromotion=!1)),this.animating=!1}async moveRows(){const e=[];for(let t=this.level.size-1;t>-1;t--){let s=!1;const i=this.emptySlots.filter(e=>e.y===t);for(let t of i){const i=this.occupiedSlots.filter(t=>-1===e.indexOf(t)).filter(e=>e.x===t.x&&e.y<t.y).sort((e,t)=>t.y-e.y).shift();if(e.push(i),!i||!i.jewel)continue;s=!0,t.classList.remove("exploding"),i.jewel.futureSlot=t,i.jewel.classList.add("moving");const l=i.getBoundingClientRect().height*(t.y-i.y);i.jewel.style.transform=`translate3d(0, ${l}px, 0)`}if(s){await this.game.delay(100);const e=this.jewels.filter(e=>e.classList.contains("moving")).sort((e,t)=>t.y-e.y);for(let t of e){const e=t.slot,s=t.futureSlot,i=s.jewel;e.jewel=i,s.jewel=t,delete t.futureSlot}}}}async isLevelCompleted(){return this.game.score>=this.level.milestone&&(this.level.index!==this.game.levels.length-1&&(this.game.message="Level completed!",this.scoreMultiplier=-1,await this.explodeAll(!1),await this.game.delay(1500)),!0)}async hasPossibleMovesRemaining(){const e=[];for(let t=this.level.size-1;t>-1;t--)for(let s=0;s<this.level.size;s++){const i=this.findJewelByPosition(s,t);i&&e.push(...this.moveChecker.findPossibleMoves(i))}return e.length>0}}exports.default=o,a(o,"startingLevel",0),customElements.define("game-board",o);
},{"./Slot":"o0GU","./Jewel":"DQ1O","./MatchChecker":"a9lQ","./MoveChecker":"1wX9"}],"6+xC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./Board")),s=t(require("./Jewel"));function t(e){return e&&e.__esModule?e:{default:e}}function l(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}class i{constructor(){l(this,"levels",[{index:0,name:"Tutorial",description:"Match three or more jewels of same shape, horizontally or vertically.",size:3,milestone:10,types:s.default.allTypes.slice(0,2)},{index:1,size:5,milestone:300,types:s.default.allTypes.slice(0,3),locks:[{x:2,y:2}]},{index:2,size:7,milestone:600,types:s.default.allTypes.slice(0,3),locks:i.locks[0]},{index:3,size:7,milestone:1200,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},types:s.default.allTypes.slice(0,4)},{index:4,size:7,milestone:1800,types:s.default.allTypes.slice(0,4),locks:i.locks[0]},{index:5,size:9,milestone:2500,types:s.default.allTypes.slice(0,5)},{index:6,size:9,milestone:3500,types:s.default.allTypes,specials:{smoke:0,fire:0,star:0,rainbow:1,nebula:0}},{index:7,size:9,milestone:5e3,types:s.default.allTypes,specials:{smoke:1,fire:2,star:2,rainbow:0,nebula:0},locks:i.locks[1]},{index:8,size:9,milestone:6e3,types:s.default.allTypes,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},locks:i.locks[1]},{index:9,size:9,milestone:7e3,types:s.default.allTypes,specials:{smoke:0,fire:1,star:0,rainbow:0,nebula:0},locks:i.locks[2]},{index:10,size:9,milestone:9e3,types:s.default.allTypes,specials:{smoke:0,fire:0,star:0,rainbow:0,nebula:1},locks:i.locks[2]},{index:11,size:9,milestone:1e4,types:s.default.allTypes,locks:i.locks[3]},{index:12,size:9,milestone:11500,types:s.default.allTypes,locks:i.locks[4]},{index:13,size:9,milestone:13e3,types:s.default.allTypes,locks:i.locks[5]}]),l(this,"_score",0),l(this,"_message",null),this.board=new e.default(this),document.querySelector("main").append(this.board)}start(){this.board&&this.board.startLevel()}delay(e=0,...s){return e?new Promise(t=>setTimeout(t,e,...s)):new Promise(e=>requestAnimationFrame(e))}get score(){return this._score}set score(e){this._score=e;const s=document.getElementById("score");s.textContent=e,s.setAttribute("data-text",e)}get message(){return this._message}set message(e){this._message=e;const s=document.getElementById("message"),t=s.querySelector("span");e?(t.textContent=e,t.setAttribute("data-text",e),s.style.transitionDuration="1s",s.style.opacity=1,s.style.visibility="visible",s.style.pointerEvents="all"):(t.textContent="",t.setAttribute("data-text",""),s.style.transitionDuration="1.5s",s.style.opacity=0,s.style.pointerEvents="none",this.delay(1e3).then(()=>s.style.visibility="hidden"))}}exports.default=i,l(i,"locks",[[{x:2,y:2},{x:4,y:4}],[{x:2,y:2},{x:6,y:6}],[{x:2,y:2},{x:3,y:3},{x:5,y:5},{x:6,y:6}],[{x:2,y:2},{x:2,y:3},{x:3,y:2},{x:3,y:3},{x:5,y:5},{x:5,y:6},{x:6,y:5},{x:6,y:6}],[{x:2,y:2},{x:2,y:3},{x:3,y:2},{x:3,y:3},{x:4,y:4},{x:5,y:5},{x:5,y:6},{x:6,y:5},{x:6,y:6}],[{x:1,y:1},{x:1,y:2},{x:2,y:1},{x:2,y:2},{x:1,y:6},{x:1,y:7},{x:2,y:6},{x:2,y:7},{x:4,y:4},{x:6,y:1},{x:7,y:1},{x:6,y:2},{x:7,y:2},{x:6,y:6},{x:6,y:7},{x:7,y:6},{x:7,y:7}]]);
},{"./Board":"Wb9I","./Jewel":"DQ1O"}],"QvaY":[function(require,module,exports) {
"use strict";require("./Background");var e=t(require("./Game"));function t(e){return e&&e.__esModule?e:{default:e}}document.getElementById("start").addEventListener("click",function(){document.querySelectorAll("main, section").forEach(e=>e.removeAttribute("hidden")),this.remove(),(new e.default).start()});
},{"./Background":"+sFh","./Game":"6+xC"}]},{},["QvaY"], null)</script></body></html>