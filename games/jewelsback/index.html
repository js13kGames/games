<!doctype html><meta name=viewport content="width=device-width"><title>Jewelsback</title><style>body,html{height:100%;overflow:hidden}body{position:relative;margin:0;padding:0;background:#000;font:400 1.15em/1.1 fantasy;display:flex;flex-flow:column;justify-content:center;align-items:center}@media (max-width:640px){body{font-size:1em}}#background{position:absolute;width:100%;height:100%;background:radial-gradient(ellipse at center,#0869ad 0,#0a3446 100%);overflow:hidden;z-index:1}#content{position:relative;z-index:2;display:flex;flex-flow:column;justify-content:center;align-items:center;width:100%}@media (orientation:landscape){#content{flex-flow:row}}header,main,section{display:flex;flex:2;justify-content:center;align-items:center;height:100vh}header,section{flex:1;flex-flow:column;color:#fff;font-size:2em}header h1,section h1{text-align:right;font:400 1.5em/.85 fantasy}header h1 span,section h1 span{display:block}@media (max-width:640px){header h1,section h1{margin:1.5rem 0 1rem}}header strong,section strong{font-size:2em}@media (max-width:640px){header strong,section strong{font-size:1.5em;margin-left:1rem}}@media (orientation:portrait){section{margin-top:1.25rem}}@media (max-width:640px){section{flex-flow:row}}#message{position:fixed;top:0;right:0;bottom:0;left:0;display:flex;flex-flow:column;justify-content:center;align-items:center;text-align:center;background:rgba(0,0,0,.267);backdrop-filter:sepia(.5) brightness(.65) blur(10px);padding:1.25rem;font-size:3.5em;z-index:3;opacity:0;pointer-events:none;visibility:hidden;transition:opacity 1s ease}#message p{font-size:.5em;color:rgba(204,238,255,.933)}@media (max-width:640px){#message{font-size:2.5em}}#start{font-size:.75em;margin:1.5rem;padding:.75rem 1.5rem;border:2px solid hsla(0,0%,100%,.267);color:#000;font-weight:600;text-shadow:0 0 10px hsla(0,0%,100%,.333),0 2px 3px rgba(28,251,169,.467),0 -2px 3px rgba(28,251,169,.467);box-shadow:0 2px 4px rgba(0,0,0,.333),0 0 30px rgba(0,0,0,.2);background:linear-gradient(45deg,hsla(0,0%,100%,0) 45%,rgba(175,255,225,.4) 50%,hsla(0,0%,100%,0) 55%,hsla(0,0%,100%,0)),radial-gradient(#1cfba9,#199e92);background-position:-200%,50% 50%;background-size:250%;outline:2px solid rgba(28,251,169,0);outline-offset:0;transition:all .25s ease-in}#start:focus,#start:hover{animation:background-shine 1.5s ease-in infinite both;outline-color:#1cfba9;outline-offset:4px}#start:active{transform:scale(.95)}[hidden]{display:none!important}.text-shine{background-color:#daefff;background-image:linear-gradient(30deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(150deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(30deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(150deg,rgba(187,221,221,.333) 12%,transparent 12.5%,transparent 87%,rgba(187,221,221,.333) 87.5%,rgba(187,221,221,.333)),linear-gradient(60deg,hsla(0,0%,100%,.333) 25%,transparent 25.5%,transparent 75%,hsla(0,0%,100%,.333) 0,hsla(0,0%,100%,.333)),linear-gradient(60deg,hsla(0,0%,100%,.333) 25%,transparent 25.5%,transparent 75%,hsla(0,0%,100%,.333) 0,hsla(0,0%,100%,.333));background-position:0 0,0 0,10px 17.5px,10px 17.5px,0 0,10px 17.5px;background-size:10px 17.5px;position:relative;color:transparent;-webkit-background-clip:text;background-clip:text}.text-shine:before{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,hsla(0,0%,100%,0) 45%,hsla(0,0%,100%,.933) 50%,hsla(0,0%,100%,0) 55%,hsla(0,0%,100%,0));background-size:250%;color:transparent;content:attr(data-text);text-shadow:0 1px 2px rgba(0,0,0,.6),-2px 2px 20px rgba(0,0,0,.067),2px 2px 20px rgba(0,0,0,.067),0 15px 35px rgba(0,0,0,.2);animation:text-shine 3.5s ease-in 2s infinite both;-webkit-background-clip:text;mix-blend-mode:screen}@keyframes text-shine{0%{background-position:-200%}to{background-position:125%}}@-webkit-keyframes text-shine{0%{background-position:-200%}to{background-position:125%}}@keyframes background-shine{0%{background-position:-200%,50% 50%}to{background-position:125%,50% 50%}}@-webkit-keyframes background-shine{0%{background-position:-200%,50% 50%}to{background-position:125%,50% 50%}}@keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@-webkit-keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@-webkit-keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@keyframes jewel-exploding{0%{opacity:1;transform:scale(1)}75%{opacity:1;transform:scale(1.15)}to{opacity:0;transform:scale(.25) translate3d(0,5%,0)}}@-webkit-keyframes jewel-exploding{0%{opacity:1;transform:scale(1)}75%{opacity:1;transform:scale(1.15)}to{opacity:0;transform:scale(.25) translate3d(0,5%,0)}}@keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@-webkit-keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}@-webkit-keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}game-board{display:grid;overflow:hidden;box-sizing:border-box;width:calc(100vmin - 30px);height:calc(100vmin - 30px);border:5px solid rgba(51,51,51,.333);border-radius:10px;cursor:default;box-shadow:inset 0 5px 30px rgba(0,0,0,.467);backdrop-filter:blur(7px);transition:opacity .5s ease}game-board[grabbing]{cursor:grabbing!important}game-board:not([animating]) board-slot:not(:empty){cursor:pointer!important}game-board:empty{opacity:0}game-board:not([animating]) board-slot[selected]{background:rgba(51,102,153,.467);cursor:grabbing;animation:slot-selected .3s ease-in infinite alternate forwards}game-board:not([animating]) board-slot[selected] jewel-piece{z-index:2}board-slot{position:relative;box-sizing:border-box;outline:5px solid transparent;transition:all .5s ease}board-slot:nth-child(2n){background:rgba(17,17,17,.467)}board-slot:nth-child(odd){background:rgba(0,0,0,.467)}board-slot[locked]{border:3px solid rgba(51,51,51,.333);background:0 0;cursor:default}board-slot.exploding{animation:slot-exploding .3s ease both}board-slot.first-row.first-column{border-radius:4px 0 0 0}board-slot.first-row.last-column{border-radius:0 4px 0 0}board-slot.last-row.first-column{border-radius:0 0 0 4px}board-slot.last-row.last-column{border-radius:0 0 4px 0}jewel-piece{position:absolute;z-index:1;box-sizing:border-box;padding:7px;width:100%;height:100%;pointer-events:none;transform-style:preserve-3d}@media (max-width:640px){jewel-piece{width:110%;height:110%;top:-5%;left:-5%}}jewel-piece:not([hidden]){display:block}jewel-piece .border,jewel-piece .shape,jewel-piece .shape:after{box-sizing:border-box;width:100%;height:100%}jewel-piece .border{padding:2px}jewel-piece .shape{padding:15%}jewel-piece .shape:after{content:"";display:block}jewel-piece.arriving{animation:jewel-arriving .2s cubic-bezier(.25,.25,.5,1.1) forwards}jewel-piece.falling,jewel-piece.moving{transition:transform .1s cubic-bezier(.25,.25,.5,1.1)}jewel-piece.flipping{transition:transform .15s ease-in}jewel-piece.exploding{animation:jewel-exploding .35s ease-out forwards}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square]{padding:11px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{border-radius:10%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border{background:linear-gradient(130deg,#f88e86,#8d1108)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape{background:radial-gradient(#f99890,#d4190c);background:conic-gradient(from 45deg,#f55a4e,#f44336,#f33122,#f55246,#f44336,#f33628,#f55a4e,#f44336,#f33628,#f55044,#f44336,#f33122,#f65f54)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{background:linear-gradient(130deg,rgba(250,170,165,.3),rgba(250,170,165,.25))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border{background:linear-gradient(130deg,#ffe69c,#b78a00)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape{background:radial-gradient(#fd7,#c49300);background:conic-gradient(from 30deg,#ffc825,#ffc107,#f4b700,#ffc61b,#ffc107,#f9bb00,#ffc825,#ffc107,#f9bb00,#ffc518,#ffc107,#f4b700,#ffca2c)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{background:linear-gradient(130deg,rgba(255,236,181,.4),rgba(255,218,106,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle]{padding:10px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{border-radius:50%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border{background:linear-gradient(130deg,#f9ae80,#ba4c09)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape{background:radial-gradient(#f8a673,#ae4708);background:conic-gradient(from 45deg,#f4701f,#e85f0b,#d8580a,#f46914,#e85f0b,#dc5a0a,#f4701f,#e85f0b,#dc5a0a,#f46812,#e85f0b,#d8580a,#f57526)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{background:linear-gradient(130deg,rgba(248,157,102,.5),rgba(247,141,77,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{clip-path:polygon(50% 0,0 100%,100% 100%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border{background:linear-gradient(130deg,#fcecff,#9f04b9)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape{background:radial-gradient(#ee96fd,#c705e7);background:conic-gradient(from 120deg,#e457fb,#e040fb,#dc2afb,#e24ffb,#e040fb,#dd31fb,#e457fb,#e040fb,#dd31fb,#e24dfb,#e040fb,#dc2afb,#e55dfc);padding:22% 16% 11%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{background:linear-gradient(130deg,rgba(236,140,253,.5),rgba(236,140,253,.9))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border{background:linear-gradient(130deg,#f3f9ed,#547928)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape{background:radial-gradient(#bfde9b,#699832);background:conic-gradient(from 45deg,#99ca60,#8bc34a,#82bc3e,#94c858,#8bc34a,#85c040,#99ca60,#8bc34a,#85c040,#93c757,#8bc34a,#82bc3e,#9ccc65)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{background:linear-gradient(130deg,rgba(209,231,183,.4),rgba(185,219,146,.55))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{clip-path:polygon(30% 0,0 20%,0 55%,50% 100%,100% 55%,100% 20%,70% 0)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border{background:linear-gradient(130deg,#cde2fc,#09418a)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape{background:radial-gradient(#76aef6,#0b52ac);background:conic-gradient(from 45deg,#247ef1,#0f6de6,#0e65d6,#1a78f0,#0f6de6,#0e68db,#247ef1,#0f6de6,#0e68db,#1876f0,#0f6de6,#0e65d6,#2c82f1);padding:13% 15% 15%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{background:linear-gradient(130deg,rgba(155,196,249,.4),rgba(106,167,245,.55))}jewel-piece[promoted]:not(.arriving):not(.falling):not(.exploding) .shape{animation:jewel-brightening .5s ease .75s infinite alternate backwards}jewel-piece[promoted]:after{position:absolute;left:50%;z-index:2;width:175%;height:175%;background-position:50%;background-size:100% 100%;content:"";transform:translate3d(-50%,0,0);pointer-events:none}jewel-piece[promoted=smoke]{filter:drop-shadow(0 0 15px rgba(204,204,204,.333)) drop-shadow(0 4px 8px rgba(221,221,221,.667)) drop-shadow(0 2px 8px #555)}jewel-piece[promoted=smoke]:after{top:-12%;width:115%;height:115%;filter:brightness(5) contrast(1.2) opacity(.5)}jewel-piece[promoted=fire]{filter:drop-shadow(0 0 8px rgba(255,193,7,.333)) drop-shadow(0 4px 8px rgba(255,193,7,.667)) drop-shadow(0 2px 8px #f00)}jewel-piece[promoted=fire]:after{bottom:16%;left:52%;width:170%;height:140%;filter:saturate(2) brightness(1.2) contrast(1.25) opacity(1)}jewel-piece[promoted=fire][type=heptagon]:after{bottom:26%}jewel-piece[promoted=star]:after{animation:star-blinking .85s ease .75s infinite alternate both;width:110%;height:110%;top:-5%;clip-path:polygon(50% 0,55% 45%,100% 50%,55% 55%,50% 100%,45% 55%,0 50%,45% 45%);background-image:radial-gradient(circle,hsla(0,0%,100%,.733),hsla(0,0%,100%,.133));mix-blend-mode:lighten}jewel-piece[promoted=rainbow]{padding:8px}jewel-piece[promoted=rainbow] .border,jewel-piece[promoted=rainbow] .shape,jewel-piece[promoted=rainbow] .shape:after{border-radius:0;clip-path:polygon(30% 0,70% 0,100% 30%,100% 70%,70% 100%,30% 100%,0 70%,0 30%)}jewel-piece[promoted=rainbow] .border{background:linear-gradient(98deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 90deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape{background:linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 45deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape:after{background:linear-gradient(130deg,hsla(0,0%,100%,.133),hsla(0,0%,100%,.2));backdrop-filter:blur(4px)}jewel-piece[promoted=nebula] .border,jewel-piece[promoted=nebula] .shape{border-radius:50%;clip-path:none}jewel-piece[promoted=nebula] .border{filter:drop-shadow(0 0 3px #bbb lack);background:linear-gradient(130deg,#b8c7ce,#4c636e)}jewel-piece[promoted=nebula] .shape{background:linear-gradient(130deg,#455a64,#34444b)}jewel-piece[promoted=nebula] .shape:after{display:none}jewel-piece[promoted=nebula]:after{top:-36%;filter:brightness(0) contrast(2)}</style><link href=data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAKEAAAAAAAAAnAAAAFIAAABpAEdH/wCMjP8AsLD/AAAA4AD39/8A5ub/AAAAAAAAAAAAAAAAAAAAAAAAAAAAERREREREQRERQiIiIiIkERQyhmZmiDBBFCOFVVVTgkEUKDMzMzViQRQoNmd2NWJBFCg2l3c1YkEUKDaapzViQRQoNpqnNWJBFCg2l3c1YkEUKDZndjViQRQoMzMzNYJBFCOFVVVjgkEUMoaGZogyQRFCIiIiIiQRERREREREQRHgBwAAwAMAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADgBwAA rel=icon type=image/x-icon><div id=background></div><div id=content><header><h1><span class=text-shine data-text=Jewels>Jewels</span><span class=text-shine data-text=back>back</span></h1><button id=start>Play now</button></header><main hidden></main><section hidden><label class=text-shine data-text=Score:>Score:</label><strong class=text-shine id=score data-text=0>0</strong></section></div><aside id=message><span class=text-shine data-text=""></span><p id=finalScore hidden>0</aside><script>parcelRequire=function(e,t,i,s){var o,n="function"==typeof parcelRequire&&parcelRequire,l="function"==typeof require&&require;function a(i,s){if(!t[i]){if(!e[i]){var o="function"==typeof parcelRequire&&parcelRequire;if(!s&&o)return o(i,!0);if(n)return n(i,!0);if(l&&"string"==typeof i)return l(i);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}d.resolve=function(t){return e[i][1][t]||t},d.cache={};var h=t[i]=new a.Module(i);e[i][0].call(h.exports,d,h,h.exports,this)}return t[i].exports;function d(e){return a(d.resolve(e))}}a.isParcelRequire=!0,a.Module=function(e){this.id=e,this.bundle=a,this.exports={}},a.modules=e,a.cache=t,a.parent=n,a.register=function(t,i){e[t]=[function(e,t){t.exports=i},{}]};for(var r=0;r<i.length;r++)try{a(i[r])}catch(e){o||(o=e)}if(i.length){var h=a(i[i.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof define&&define.amd&&define((function(){return h}))}if(parcelRequire=a,o)throw o;return a}({"+sFh":[function(e,t,i){const s=5e3;let o,n,l,a,r,h;function d(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width",window.innerWidth),e.setAttribute("height",window.innerHeight),document.querySelector("#background").appendChild(e);const t=(window.innerWidth+window.innerHeight)/20;n=Math.ceil(window.innerWidth/t)+1,l=Math.ceil(window.innerHeight/t)+1,a=Math.ceil(window.innerWidth/(n-1)),r=Math.ceil(window.innerHeight/(l-1)),h=[];for(let e=0;e<l;e++)for(let t=0;t<n;t++)h.push({x:a*t,y:r*e,originX:a*t,originY:r*e});c();for(let t=0;t<h.length;t++)if(h[t].originX!==a*(n-1)&&h[t].originY!==r*(l-1)){const i=h[t].x,o=h[t].y,l=h[t+1].x,a=h[t+1].y,r=h[t+n].x,d=h[t+n].y,c=h[t+n+1].x,u=h[t+n+1].y,f=Math.floor(2*Math.random());for(let h=0;h<2;h++){const b=document.createElementNS(e.namespaceURI,"polygon");0===f?0===h?(b.point1=t,b.point2=t+n,b.point3=t+n+1,b.setAttribute("points",`${i},${o} ${r},${d} ${c},${u}`)):1===h&&(b.point1=t,b.point2=t+1,b.point3=t+n+1,b.setAttribute("points",`${i},${o} ${l},${a} ${c},${u}`)):1===f&&(0===h?(b.point1=t,b.point2=t+n,b.point3=t+1,b.setAttribute("points",`${i},${o} ${r},${d} ${l},${a}`)):1===h&&(b.point1=t+n,b.point2=t+1,b.point3=t+n+1,b.setAttribute("points",`${r},${d} ${l},${a} ${c},${u}`))),b.setAttribute("fill",`rgba(0,0,0,${Math.random()/3})`);const y=document.createElementNS("http://www.w3.org/2000/svg","animate");y.setAttribute("fill","freeze"),y.setAttribute("attributeName","points"),y.setAttribute("dur",`${s}ms`),y.setAttribute("calcMode","linear"),b.appendChild(y),e.appendChild(b)}}u()}function c(){for(let e=0;e<h.length;e++)0!==h[e].originX&&h[e].originX!==a*(n-1)&&(h[e].x=h[e].originX+Math.random()*a-a/2),0!==h[e].originY&&h[e].originY!==r*(l-1)&&(h[e].y=h[e].originY+Math.random()*r-r/2)}function u(){c();for(let e=0;e<document.querySelector("#background svg").childNodes.length;e++){const t=document.querySelector("#background svg").childNodes[e],i=t.childNodes[0];i.getAttribute("to")&&i.setAttribute("from",i.getAttribute("to")),i.setAttribute("to",`${h[t.point1].x},${h[t.point1].y} ${h[t.point2].x},${h[t.point2].y} ${h[t.point3].x},${h[t.point3].y}`),i.beginElement()}o=setTimeout((()=>{u()}),s)}window.onload=d,window.onresize=function(){document.querySelector("#background svg").remove(),clearTimeout(o),d()}},{}],o0GU:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;class s extends HTMLElement{constructor(e,t){super(),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"lastClick",null),this.x=e,this.y=t,this.addEventListener("mousedown",this.mousedown),this.addEventListener("touchstart",this.mousedown,!0),this.addEventListener("mouseup",this.mouseup),this.addEventListener("touchend",this.mouseup,!0),this.addEventListener("dragstart",(e=>e.preventDefault()))}connectedCallback(){0===this.y&&this.classList.add("first-row"),this.y===this.board.level.size-1&&this.classList.add("last-row"),0===this.x&&this.classList.add("first-column"),this.x===this.board.level.size-1&&this.classList.add("last-column")}get locked(){return""===this.getAttribute("locked")}set locked(e){e?this.setAttribute("locked",""):this.removeAttribute("locked")}get selected(){return""===this.getAttribute("selected")}set selected(e){e?this.setAttribute("selected",""):this.removeAttribute("selected"),this.jewel&&!e&&(this.jewel.matchable=!1)}get targetable(){return""===this.getAttribute("targetable")}set targetable(e){e?this.setAttribute("targetable",""):this.removeAttribute("targetable")}get x(){return+this.getAttribute("x")}set x(e){this.setAttribute("x",e)}get y(){return+this.getAttribute("y")}set y(e){this.setAttribute("y",e)}get game(){return this.board.game}get board(){return this.parentElement}get jewel(){return this.firstElementChild}set jewel(e){e.x=this.x,e.y=this.y,e.classList.remove("moving"),e.style.transform=null,this.append(e)}mousedown(){if(!this.board.animating)return this.locked?this.board.unselectAll():void(null===this.board.findJewelSelected()&&(this.board.unselectAll(),this.board.updateTargetables(this),this.board.grabbing=!0,this.selected=!0,this.lastClick=Date.now()))}mouseup(e){if(this.board.animating)return;this.board.grabbing=!1,e.preventDefault(),e.stopPropagation();const t=e.changedTouches&&e.changedTouches.length>0?document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY):this;if(t){if(t.locked)return t.board.unselectAll();if(t.targetable){const e=t.board.findJewelSelected();return t.board.flipJewels(t.jewel,e)}(!t.lastClick||Date.now()-t.lastClick>250)&&t.board.unselectAll()}}}i.default=s,customElements.define("board-slot",s)},{}],DQ1O:[function(e,t,i){"use strict";function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;class o extends HTMLElement{constructor(e,t){super(),s(this,"futureSlot",null),s(this,"futurePromotion",!1),this.type=t,this.checked=!1,this.x=e.x,this.y=e.y,this.setAttribute("hidden","");const i=document.createElement("div"),o=document.createElement("div");i.className="border",this.append(i),o.className="shape",i.append(o),e.append(this)}static get allTypes(){return Object.keys(o.types)}static get allSpecials(){return Object.keys(o.specials)}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}get x(){return+this.getAttribute("x")}set x(e){this.setAttribute("x",e)}get y(){return+this.getAttribute("y")}set y(e){this.setAttribute("y",e)}get matchable(){return""===this.getAttribute("matchable")}set matchable(e){e?this.setAttribute("matchable",""):this.removeAttribute("matchable")}get promoted(){return this.getAttribute("promoted")}set promoted(e){e?this.setAttribute("promoted",e):this.removeAttribute("promoted")}get game(){return this.board.game}get board(){return this.slot.parentElement}get slot(){return this.parentElement}get above(){return this.parentElement}get canBePromoted(){return this.matchable&&!this.promoted}generateRandomPromotion(e,t){if(e){const i=[];if(e.smoke>t.filter((e=>"smoke"===e.promoted)).length&&i.push("smoke"),e.fire>t.filter((e=>"fire"===e.promoted)).length&&i.push("fire"),e.star>t.filter((e=>"star"===e.promoted)).length&&i.push("star"),e.rainbow>t.filter((e=>"rainbow"===e.promoted)).length&&i.push("rainbow"),e.nebula>t.filter((e=>"nebula"===e.promoted)).length&&i.push("nebula"),i.length>0){const t=Object.values(e).reduce(((e,t)=>e+t))+this.board.level.size*(this.board.level.size/2),s=Math.floor(Math.random()*t);s<i.length&&(this.promoted=Object.values(i)[s])}}}async move(e=!0){if(this.removeAttribute("hidden"),e)this.classList.add("arriving"),await this.game.delay(150),this.classList.remove("arriving");else{const e=this.slot.getBoundingClientRect().height*(this.y+1);this.style.transform=`translate3d(0, ${-e}px, 0)`,await this.game.delay(),this.classList.add("falling"),this.style.transform=null,await this.game.delay(150),this.classList.remove("falling")}}}i.default=o,s(o,"types",{square:"square",heptagon:"heptagon",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",circle:"circle"}),s(o,"specials",{smoke:"smoke",fire:"fire",star:"star",rainbow:"rainbow",nebula:"nebula"}),s(o,"superSpecials",["rainbow","nebula"]),customElements.define("jewel-piece",o)},{}],a9lQ:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=function(e){return e&&e.__esModule?e:{default:e}}(e("./Jewel"));i.default=class{constructor(e){this.board=e}generateUnmatchableShape(e,t,i){let o=this.board.level.types?this.board.level.types:s.default.allTypes;const n=(o=o.filter((e=>e!==i)))[Math.random()*o.length<<0],l=this.board.findJewelByPosition(e-1,t),a=this.board.findJewelByPosition(e,t+1),r=this.board.findJewelByPosition(e-1,t+1);if(l&&a&&r&&a.type===n&&l.type===n&&r.type===n)return this.generateUnmatchableShape(e,t,n);const h=this.board.findJewelByPosition(e-2,t);if(l&&h&&l.type===n&&h.type===n)return this.generateUnmatchableShape(e,t,n);const d=this.board.findJewelByPosition(e,t+2);return a&&d&&a.type===n&&d.type===n?this.generateUnmatchableShape(e,t,n):n}checkMatchables(e,...t){for(let i of t)if(!i||e.type!==i.type)return[];return[e,...t]}findPossibleMatches(e){if(!e)return[];const t=[];let i=!1;t.push(...this.findMatchesForNebula(e,e.canBePromoted)),t.length>0&&(i=!0),t.push(...this.findMatchesForRainbow(e,!i&&e.canBePromoted)),t.length>0&&(i=!0),t.push(...this.findMatchesForStar(e,!i&&e.canBePromoted)),t.length>0&&(i=!0),t.push(...this.findMatchesForFire(e,!i&&e.canBePromoted)),t.length>0&&(i=!0),t.push(...this.findMatchesForSmoke(e,!i&&e.canBePromoted)),t.length>0&&(i=!0),t.push(...this.findMatchesOfThree(e)),t.push(...this.findMatchesForSpecials(t));for(let e of t)e.checked=!0;return t}findMatchesForSpecials(e){let t=[...e];if(e.length>0&&e.some((e=>e.promoted&&!e.futurePromotion))){const i=e.filter((e=>e.promoted&&!e.futurePromotion));for(let e of i){const{x:i,y:o}=e;if(e.promoted===s.default.specials.smoke)t.push(this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o+1),this.board.findJewelByPosition(i+1,o-1),this.board.findJewelByPosition(i-1,o+1),this.board.findJewelByPosition(i-1,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o-1));else if(e.promoted===s.default.specials.fire)t.push(this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o+1),this.board.findJewelByPosition(i+1,o-1),this.board.findJewelByPosition(i-1,o+1),this.board.findJewelByPosition(i-1,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i,o+2),this.board.findJewelByPosition(i,o-2));else if(e.promoted===s.default.specials.star){for(let e=0;e<this.board.level.size;e++)t.push(this.board.findJewelByPosition(e,o));for(let e=0;e<this.board.level.size;e++)t.push(this.board.findJewelByPosition(i,e))}}}return t.length>0&&(t=[...new Set(t.filter((e=>null!==e)))]),t}findMatchesForNebula(e,t){const{x:i,y:o}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i-3,o))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+3,o),this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-3),this.board.findJewelByPosition(i,o-2),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-2),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2),this.board.findJewelByPosition(i,o+3))),this.promote(t,n,e,s.default.specials.nebula)}findMatchesForRainbow(e,t){const{x:i,y:o}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-2),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),this.promote(t,n,e,s.default.specials.rainbow)}findMatchesForStar(e,t){const{x:i,y:o}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i,o+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i,o+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i+2,o),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1))),this.promote(t,n,e,s.default.specials.star)}findMatchesForFire(e,t){const{x:i,y:o}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i+2,o))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-2,o),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i+1,o))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-2),this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i,o-1),this.board.findJewelByPosition(i,o+1),this.board.findJewelByPosition(i,o+2))),this.promote(t,n,e,s.default.specials.fire)}findMatchesForSmoke(e,t){const{x:i,y:o}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i-1,o+1),this.board.findJewelByPosition(i,o+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i+1,o+1),this.board.findJewelByPosition(i,o+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i-1,o-1),this.board.findJewelByPosition(i-1,o),this.board.findJewelByPosition(i,o-1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(i+1,o-1),this.board.findJewelByPosition(i+1,o),this.board.findJewelByPosition(i,o-1))),this.promote(t,n,e,s.default.specials.smoke)}findMatchesOfThree(e){const{x:t,y:i}=e;let s=[];return s.push(...this.checkMatchables(e,this.board.findJewelByPosition(t-1,i),this.board.findJewelByPosition(t+1,i))),s.push(...this.checkMatchables(e,this.board.findJewelByPosition(t,i-1),this.board.findJewelByPosition(t,i+1))),s.filter((e=>null!==e))}promote(e,t,i,s){return t=t.filter((e=>null!==e)),e&&t.length>0&&(i.futurePromotion=!0,i.promoted=s),t}}},{"./Jewel":"DQ1O"}],"1wX9":[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=function(e){return e&&e.__esModule?e:{default:e}}(e("./Jewel"));i.default=class{constructor(e){this.board=e}findPossibleMoves(e){return e?[...this.findDirectMoves(e),...this.findIndirectMoves(e)]:[]}findDirectMoves(e){return e?[...this.findPossibleMovesTop(e),...this.findPossibleMovesRight(e),...this.findPossibleMovesBottom(e),...this.findPossibleMovesLeft(e)]:[]}findIndirectMoves(e){if(!e)return[];const t=[],{x:i,y:s}=e,o=this.board.findJewelByPosition(i,s-1),n=this.board.findJewelByPosition(i+1,s),l=this.board.findJewelByPosition(i,s+1),a=this.board.findJewelByPosition(i-1,s);return o&&t.push(...this.findPossibleMovesBottom(o,!0)),n&&t.push(...this.findPossibleMovesLeft(n,!0)),l&&t.push(...this.findPossibleMovesTop(l,!0)),a&&t.push(...this.findPossibleMovesRight(a,!0)),t}checkMatchable(e,t,i,...o){if(e.type===t.type)return null;for(let i of o)if(!i||e.type!==i.type&&e.promoted!==s.default.specials.nebula&&e.promoted!==s.default.specials.rainbow&&t.promoted!==s.default.specials.nebula&&t.promoted!==s.default.specials.rainbow)return null;return i?e:t}findPossibleMovesTop(e,t=!1){let i=[];const{x:o,y:n}=e,l=this.board.findJewelByPosition(o,n-1);return!l||l.locked?[]:(!t&&l&&(s.default.superSpecials.includes(e.promoted)||s.default.superSpecials.includes(l.promoted))&&i.push(l),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+2,n-1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-2,n-1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o+1,n-1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o,n-2),this.board.findJewelByPosition(o,n-3))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n-2),this.board.findJewelByPosition(o,n-2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n-2),this.board.findJewelByPosition(o,n-2))),(i=[...new Set(i.filter((e=>null!==e)))]).length>0&&(e.matchable=!0),i)}findPossibleMovesRight(e,t=!1){let i=[];const{x:o,y:n}=e,l=this.board.findJewelByPosition(o+1,n);return!l||l.locked?[]:(!t&&l&&(s.default.superSpecials.includes(e.promoted)||s.default.superSpecials.includes(l.promoted))&&i.push(l),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+3,n))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+1,n+2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n-2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+1,n+1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+1,n-1),this.board.findJewelByPosition(o+2,n-1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+2,n),this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+2,n+1))),(i=[...new Set(i.filter((e=>null!==e)))]).length>0&&(e.matchable=!0),i)}findPossibleMovesBottom(e,t=!1){let i=[];const{x:o,y:n}=e,l=this.board.findJewelByPosition(o,n+1);return!l||l.locked?[]:(!t&&l&&(s.default.superSpecials.includes(e.promoted)||s.default.superSpecials.includes(l.promoted))&&i.push(l),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+2,n+1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-2,n+1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o+1,n+1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o,n+2),this.board.findJewelByPosition(o,n+3))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-1,n+2),this.board.findJewelByPosition(o,n+2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o+1,n+1),this.board.findJewelByPosition(o+1,n+2),this.board.findJewelByPosition(o,n+2))),(i=[...new Set(i.filter((e=>null!==e)))]).length>0&&(e.matchable=!0),i)}findPossibleMovesLeft(e,t=!1){let i=[];const{x:o,y:n}=e,l=this.board.findJewelByPosition(o-1,n);return!l||l.locked?[]:(!t&&l&&(s.default.superSpecials.includes(e.promoted)||s.default.superSpecials.includes(l.promoted))&&i.push(l),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-3,n))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-1,n+2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n-2))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-1,n+1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-1,n-1),this.board.findJewelByPosition(o-2,n-1))),i.push(this.checkMatchable(e,l,t,this.board.findJewelByPosition(o-2,n),this.board.findJewelByPosition(o-1,n+1),this.board.findJewelByPosition(o-2,n+1))),(i=[...new Set(i.filter((e=>null!==e)))]).length>0&&(e.matchable=!0),i)}}},{"./Jewel":"DQ1O"}],Wb9I:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=a(e("./Slot")),o=a(e("./Jewel")),n=a(e("./MatchChecker")),l=a(e("./MoveChecker"));function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class h extends HTMLElement{constructor(e){super(),r(this,"slots",[]),r(this,"level",null),r(this,"height",null),r(this,"scoreMultiplier",0),this.game=e,this.matchChecker=new n.default(this),this.moveChecker=new l.default(this),document.addEventListener("click",(e=>{const t=[document.documentElement,document.body];e.target&&!t.includes(e.target)||(e.stopPropagation(),this.unselectAll())}))}connectedCallback(){this.height=this.offsetHeight}get grabbing(){return""===this.getAttribute("grabbing")}set grabbing(e){e?this.setAttribute("grabbing",""):this.removeAttribute("grabbing")}get animating(){return""===this.getAttribute("animating")}set animating(e){e?this.setAttribute("animating",""):this.removeAttribute("animating")}get jewels(){return this.occupiedSlots.map((e=>e.firstChild))}get unlockedSlots(){return this.slots.filter((e=>!e.locked))}get occupiedSlots(){return this.unlockedSlots.filter((e=>e.jewel&&!e.jewel.hasAttribute("hidden")))}get emptySlots(){return this.unlockedSlots.filter((e=>!e.jewel||e.jewel.hasAttribute("hidden")||e.jewel.classList.contains("moving")))}get emptySlotsGroupedByRow(){const e=this.emptySlots.sort(((e,t)=>t.y-e.y||e.x-t.x)),t=new Map;return e.forEach((e=>{const i=t.get(e.y);i?i.push(e):t.set(e.y,[e])})),t}findSlotByPosition(e,t){return this.querySelector(`board-slot[x="${e}"][y="${t}"]`)}findUnlockedSlotBelow(e){return this.unlockedSlots.filter((t=>t.x===e.x&&t.y>e.y)).sort(((e,t)=>e.y-t.y)).shift()}findJewelByPosition(e,t){return this.querySelector(`jewel-piece[x="${e}"][y="${t}"]`)}findJewelSelected(){return this.querySelector("board-slot[selected] > jewel-piece")}findJewelsByType(e){return this.querySelectorAll(`jewel-piece[type="${e}"]`)}findJewelsBySpecial(e){return this.querySelectorAll(`jewel-piece[promoted="${e}"]`)}findJewelsPromoted(){return Array.from(this.querySelectorAll("jewel-piece[promoted]"))}async unselectAll(){for(let e of this.unlockedSlots)e.targetable=!1,e.selected=!1}updateTargetables(e){const t=this.moveChecker.findPossibleMoves(e.jewel);for(let e of t)e.slot.targetable=!0}async startLevel(e=h.startingLevel){if(this.game.levels.length-1<e)return this.showGameEnd("Congratulations!","You won!"),void this.explodeAll(!1);this.animating=!0,this.level=this.game.levels.filter((t=>t.index===e)).shift(),this.slots.forEach((e=>e.remove())),this.slots=[],this.scoreMultiplier=0,this.level.index===h.startingLevel&&(this.style.opacity=0,await this.game.delay(500)),this.style.gridTemplateColumns=this.style.gridTemplateRows=`repeat(${this.level.size}, 1fr)`;for(let e=0;e<this.level.size;e++)for(let t=0;t<this.level.size;t++){const i=new s.default(t,e);i.locked=this.level.locks&&this.level.locks.some((i=>i.x===t&&i.y===e)),this.append(i),this.slots.push(i)}if(this.level.name){if(this.game.message=this.level.name,await this.game.delay(2200),this.level.description){this.game.message=this.level.description;const e=250*this.level.description.split(" ").length;await this.game.delay(e)}}else this.game.message=`Level ${this.level.index}`,await this.game.delay(1500);return this.style.opacity=1,await this.game.delay(300),await this.fillEmptySlots(),this.level.index===h.startingLevel&&(this.game.message="Let's go!",await this.game.delay(600)),delete this.level.specials,this.game.message="",this.animating=!1,await this.hasPossibleMovesRemaining()?void 0:(this.animating=!0,await this.game.delay(300),this.showGameEnd("Out of luck...","Game Over!"))}async fillEmptySlots(e=!0){const t=this.emptySlotsGroupedByRow;for(let i of t.keys()){for(let s of t.get(i)){s.jewel&&s.jewel.remove();let t=null;try{t=this.matchChecker.generateUnmatchableShape(s.x,s.y)}catch{const e=o.default.allTypes;t=e[Math.random()*e.length<<0]}const i=new o.default(s,t);i.generateRandomPromotion(this.level.specials,this.findJewelsPromoted()),i.move(e)}await this.game.delay(e?200:100)}}async flipJewels(e,t){if(!e||!t)return;this.animating=!0,this.scoreMultiplier=0,e.classList.add("flipping"),t.classList.add("flipping");const i=e.getBoundingClientRect(),s=t.getBoundingClientRect();e.x>t.x?(e.style.transform=`translate3d(${-i.width}px, 0, 0)`,t.style.transform=`translate3d(${s.width}px, 0, 0)`):e.x<t.x?(e.style.transform=`translate3d(${i.width}px, 0, 0)`,t.style.transform=`translate3d(${-s.width}px, 0, 0)`):e.y>t.y?(e.style.transform=`translate3d(0, ${-i.height}px, 0)`,t.style.transform=`translate3d(0, ${s.height}px, 0)`):(e.style.transform=`translate3d(0, ${i.height}px, 0)`,t.style.transform=`translate3d(0, ${-s.height}px, 0)`),await this.game.delay(150),e.classList.remove("flipping"),t.classList.remove("flipping");const n=this.findSlotByPosition(t.x,t.y),l=this.findSlotByPosition(e.x,e.y);return n.jewel=e,l.jewel=t,e.promoted===o.default.specials.nebula&&t.promoted===o.default.specials.nebula?this.showGameEnd("Greed is ugly...","Game Over!"):(e.promoted===o.default.specials.rainbow&&t.promoted===o.default.specials.rainbow?await this.explodeAll():e.promoted===o.default.specials.nebula?await this.explodeNebula(e,t):t.promoted===o.default.specials.nebula?await this.explodeNebula(t,e):e.promoted===o.default.specials.rainbow?await this.explodeRainbow(e,t):t.promoted===o.default.specials.rainbow?await this.explodeRainbow(t,e):await this.explodeMatches(),await this.unselectAll(),await this.isLevelCompleted()?(setTimeout((()=>this.startLevel(this.level.index+1)),150),!0):await this.hasPossibleMovesRemaining()?(this.animating=!1,!0):(this.showGameEnd("No more moves...","Game Over!"),!1))}async showGameEnd(e,t){if(e&&(this.animating=!0,this.game.message=e,await this.game.delay(1500)),this.game.message=t,this.game.score>0){const e=document.getElementById("finalScore");e.textContent="Final score: "+this.game.score,e.removeAttribute("hidden")}}async explodeAll(e=!0){await this.finishExplosion(this.jewels,e)}async explodeNebula(e,t){const i=[],s=[e];s.push(...this.findJewelsByType(t.type)),s.forEach((e=>{e.promoted&&!e.futurePromotion?s.push(e):i.push(e)})),i.length>0&&(this.scoreMultiplier++,i.forEach((e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")})),await this.game.delay(350),i.forEach((e=>{e.classList.remove("exploding"),e.promoted=o.default.specials.rainbow,e.futurePromotion=!0}))),await this.finishExplosion(s)}async explodeRainbow(e,t){const i=[e];i.push(...this.findJewelsByType(t.type)),await this.finishExplosion(i)}async explodeMatches(){const e=[];for(let t=this.level.size-1;t>-1;t--)for(let i=0;i<this.level.size;i++){const s=this.findJewelByPosition(i,t);s&&e.push(...this.matchChecker.findPossibleMatches(s))}await this.finishExplosion(e)}async finishExplosion(e,t=!0){if(0===e.length)return;this.animating=!0,this.scoreMultiplier++;let i=[...new Set(e.filter((e=>null!==e)))];t&&(i=i.filter((e=>!e.futurePromotion))),i.forEach((e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")})),await this.game.delay(350),i.forEach((e=>{e.setAttribute("hidden",""),e.classList.remove("exploding")})),t&&(await this.moveRows(),await this.fillEmptySlots(!1),await this.explodeMatches(),e.filter((e=>e.futurePromotion)).forEach((e=>e.futurePromotion=!1))),this.animating=!1}async moveRows(){const e=[];for(let t=this.level.size-1;t>-1;t--){let i=!1;const s=this.emptySlots.filter((e=>e.y===t));for(let t of s){const s=this.occupiedSlots.filter((t=>-1===e.indexOf(t))).filter((e=>e.x===t.x&&e.y<t.y)).sort(((e,t)=>t.y-e.y)).shift();if(e.push(s),!s||!s.jewel)continue;i=!0,t.classList.remove("exploding"),s.jewel.futureSlot=t,s.jewel.classList.add("moving");const o=s.getBoundingClientRect().height*(t.y-s.y);s.jewel.style.transform=`translate3d(0, ${o}px, 0)`}if(i){await this.game.delay(100);const e=this.jewels.filter((e=>e.classList.contains("moving"))).sort(((e,t)=>t.y-e.y));for(let t of e){const e=t.slot,i=t.futureSlot,s=i.jewel;e.jewel=s,i.jewel=t,delete t.futureSlot}}}}async isLevelCompleted(){return this.game.score>=this.level.milestone&&(this.level.index!==this.game.levels.length-1&&(this.game.message="Level completed!",this.scoreMultiplier=-1,await this.explodeAll(!1),await this.game.delay(1500)),!0)}async hasPossibleMovesRemaining(){const e=[];for(let t=this.level.size-1;t>-1;t--)for(let i=0;i<this.level.size;i++){const s=this.findJewelByPosition(i,t);s&&e.push(...this.moveChecker.findPossibleMoves(s))}return e.length>0}}i.default=h,r(h,"startingLevel",0),customElements.define("game-board",h)},{"./Slot":"o0GU","./Jewel":"DQ1O","./MatchChecker":"a9lQ","./MoveChecker":"1wX9"}],"6+xC":[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=n(e("./Board")),o=n(e("./Jewel"));function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{constructor(){l(this,"levels",[{index:0,name:"Tutorial",description:"Match three or more jewels of same shape, horizontally or vertically.",size:3,milestone:10,types:o.default.allTypes.slice(0,2)},{index:1,size:5,milestone:300,types:o.default.allTypes.slice(0,3),locks:[{x:2,y:2}]},{index:2,size:7,milestone:600,types:o.default.allTypes.slice(0,3),locks:a.locks[0]},{index:3,size:7,milestone:1200,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},types:o.default.allTypes.slice(0,4)},{index:4,size:7,milestone:1800,types:o.default.allTypes.slice(0,4),locks:a.locks[0]},{index:5,size:9,milestone:2500,types:o.default.allTypes.slice(0,5)},{index:6,size:9,milestone:3500,types:o.default.allTypes,specials:{smoke:0,fire:0,star:0,rainbow:1,nebula:0}},{index:7,size:9,milestone:5e3,types:o.default.allTypes,specials:{smoke:1,fire:2,star:2,rainbow:0,nebula:0},locks:a.locks[1]},{index:8,size:9,milestone:6e3,types:o.default.allTypes,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},locks:a.locks[1]},{index:9,size:9,milestone:7e3,types:o.default.allTypes,specials:{smoke:0,fire:1,star:0,rainbow:0,nebula:0},locks:a.locks[2]},{index:10,size:9,milestone:9e3,types:o.default.allTypes,specials:{smoke:0,fire:0,star:0,rainbow:0,nebula:1},locks:a.locks[2]},{index:11,size:9,milestone:1e4,types:o.default.allTypes,locks:a.locks[3]},{index:12,size:9,milestone:11500,types:o.default.allTypes,locks:a.locks[4]},{index:13,size:9,milestone:13e3,types:o.default.allTypes,locks:a.locks[5]}]),l(this,"_score",0),l(this,"_message",null),this.board=new s.default(this),document.querySelector("main").append(this.board)}start(){this.board&&this.board.startLevel()}delay(e=0,...t){return new Promise(e?i=>setTimeout(i,e,...t):e=>requestAnimationFrame(e))}get score(){return this._score}set score(e){this._score=e;const t=document.getElementById("score");t.textContent=e,t.setAttribute("data-text",e)}get message(){return this._message}set message(e){this._message=e;const t=document.getElementById("message"),i=t.querySelector("span");e?(i.textContent=e,i.setAttribute("data-text",e),t.style.transitionDuration="1s",t.style.opacity=1,t.style.visibility="visible",t.style.pointerEvents="all"):(i.textContent="",i.setAttribute("data-text",""),t.style.transitionDuration="1.5s",t.style.opacity=0,t.style.pointerEvents="none",this.delay(1e3).then((()=>t.style.visibility="hidden")))}}i.default=a,l(a,"locks",[[{x:2,y:2},{x:4,y:4}],[{x:2,y:2},{x:6,y:6}],[{x:2,y:2},{x:3,y:3},{x:5,y:5},{x:6,y:6}],[{x:2,y:2},{x:2,y:3},{x:3,y:2},{x:3,y:3},{x:5,y:5},{x:5,y:6},{x:6,y:5},{x:6,y:6}],[{x:2,y:2},{x:2,y:3},{x:3,y:2},{x:3,y:3},{x:4,y:4},{x:5,y:5},{x:5,y:6},{x:6,y:5},{x:6,y:6}],[{x:1,y:1},{x:1,y:2},{x:2,y:1},{x:2,y:2},{x:1,y:6},{x:1,y:7},{x:2,y:6},{x:2,y:7},{x:4,y:4},{x:6,y:1},{x:7,y:1},{x:6,y:2},{x:7,y:2},{x:6,y:6},{x:6,y:7},{x:7,y:6},{x:7,y:7}]])},{"./Board":"Wb9I","./Jewel":"DQ1O"}],QvaY:[function(e,t,i){"use strict";e("./Background");var s=function(e){return e&&e.__esModule?e:{default:e}}(e("./Game"));document.getElementById("start").addEventListener("click",(function(){document.querySelectorAll("main, section").forEach((e=>e.removeAttribute("hidden"))),this.remove(),(new s.default).start()}))},{"./Background":"+sFh","./Game":"6+xC"}]},{},["QvaY"])</script>