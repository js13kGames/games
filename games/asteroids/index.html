<!doctype html><meta name=viewport content="width=device-width"><title>ASTEROIDS</title><body><style>body{font:normal 16px/16px Consolas,monospace;background:#000;color:#fff}.b-panel{padding:16px}.b-panel_right{float:right}#g-game{font:normal 16px/16px Consolas,monospace;position:absolute;top:48px;left:0;width:100%;height:calc(100% - 48px);min-width:320px;min-height:240px}.b-msgbox{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:16px;display:none}.b-scores{list-style:decimal outside;padding-left:32px}.b-scores__input{color:#fff;background:#000;font-family:inherit;font-size:inherit;padding:.3rem 3.4rem;border:3px solid #fff;margin-right:2.6rem;transition:all .2s}.b-button{color:#fff;background:#000;font-family:inherit;font-size:inherit;padding:.3rem 3.4rem;border:3px solid #fff;margin-right:2.6rem;transition:all .2s}.b-button:focus,.b-button:hover{box-shadow:.4rem .4rem 0 #fff;transform:translate(-.4rem,-.4rem)}.b-button:active{box-shadow:0 0 0 #000;transform:translate(0,0)}.title{font-size:50px}body div.intro{opacity:1;display:block}body.none div.intro{opacity:0}div.intro,e{color:#fff;background:#000;text-align:center;position:absolute;top:50%;left:50%;width:95%;max-width:450px;padding:1rem;box-sizing:border-box;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);border:1px solid}em{font-family:monospace}</style><div class=b-panel>Score: <span id=g-score>0</span><div class=b-panel_right>speed: <span id=level>0</span></div></div><canvas id=g-game></canvas><div class=intro><h1>Asteroids</h1><p>You are a spaceship<br>move with the <small><em>W A S D</em></small> keys to move and <small><em>SPACE</em></small> to fire bullets.<p>Avoid Asteroids<br>Click anywhere (everywhere) to Play<p>Play on a computer<br><em></em><br><em>A JS13K game<br>There is no sound in the vaccume of space.</em></div><div id=g-endgame class=b-msgbox><span class=title>GAME OVER</span><span> score:<span id=g-score>0</span></span><div id=g-leaderboard></div><button class=b-button onclick=SaveScore(game.score,this)>Save score</button> <button class=b-button onclick="window.location.href=window.location.pathname">New game</button></div><script>window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};var GameEngine=function(t,o){var i=document.querySelector(t)||document.querySelector("canvas"),e=i.getContext("2d"),s=document.querySelector(o);"undefined"!=typeof Storage&&(localStorage["board.0.name"]="BLASTER",localStorage["board.0.score"]=2600,localStorage["board.1.name"]="STAR DESTROYER",localStorage["board.1.score"]=1700);var a={canvas:i,context:e,score:0,level:1,objects:[],input:{mouse:{x:0,y:0},fire:!1,left:!1,right:!1,forward:!1,backward:!1}};document.addEventListener("mouseup",(function(t){game.Run(),document.body.className="none"})),document.addEventListener("keydown",(function(t){switch(t.keyCode){case 32:a.input.fire=!0;break;case 37:case 65:a.input.left=!0;break;case 39:case 68:a.input.right=!0;break;case 38:case 87:a.input.forward=!0}})),document.addEventListener("keyup",(function(t){switch(t.keyCode){case 32:a.input.fire=!1;break;case 37:case 65:a.input.left=!1;break;case 39:case 68:a.input.right=!1;break;case 38:case 87:a.input.forward=!1}})),a.eachByName=function(t,o){for(var i=t||"",e=o||function(){console.exception("Callback is undefined")},s=0;s<this.objects.length;s++)this.objects[s].name==i&&e(this.objects[s],s)};var n=function(){var t=a.score;document.getElementById("level").innerHTML=Math.floor(1e3*ship.speed),a.context.clearRect(0,0,a.canvas.width,a.canvas.height);for(var o=0;o<a.objects.length;o++)a.objects[o].delete&&a.objects.splice(o,1);for(var i=0;i<a.objects.length;i++)a.objects[i].Update(),a.objects[i].Draw(a.context);a.score>t&&(s.innerHTML=a.score),window.requestAnimFrame(n)};return a.Run=function(){!function(){a.canvas.width=Math.max(document.documentElement.clientWidth,window.innerWidth||320),a.canvas.height=Math.max(document.documentElement.clientHeight,window.innerHeight||240)-48;for(var t=0;t<a.objects.length;t++)a.objects[t].Start()}(),n()},a},Polygon=function(t){var o=t.name||"Polygon",i=t.color||"#0F0",e=t.points||[{x:0,y:0},{x:10,y:10},{x:10,y:0},{x:0,y:0},{x:0,y:10},{x:10,y:10}],s=t.position||{x:0,y:0},a=t.velocity||{x:0,y:0},n=t.size||{x:100,y:100},h={name:o,position:s,velocity:a,color:i,points:e,rotation:0,base:t.base||{x:50,y:50},size:n,newcnv:document.createElement("canvas"),delete:!1};return h.newctx=h.newcnv.getContext("2d"),h.newcnv.width=h.size.x,h.newcnv.height=h.size.y,h.constructor.prototype.Start=function(){},h.constructor.prototype.Update=function(){},h.Draw=function(t){this.newctx.clearRect(0,0,this.newcnv.width,this.newcnv.height),this.newctx.save(),this.newctx.translate(this.base.x,this.base.y),this.newctx.beginPath(),this.newctx.moveTo(this.points[0].x,this.points[0].y);for(var o=1;o<this.points.length;o++)this.newctx.lineTo(this.points[o].x,this.points[o].y);this.newctx.closePath(),this.newctx.shadowBlur=5,this.newctx.shadowColor=this.color,this.newctx.strokeStyle=this.color,this.newctx.stroke(),this.newctx.restore(),t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x-t.canvas.width,this.position.y),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x+t.canvas.width,this.position.y),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x,this.position.y-t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x,this.position.y+t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x-t.canvas.width,this.position.y-t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x+t.canvas.width,this.position.y-t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x-t.canvas.width,this.position.y+t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore(),t.save(),t.translate(this.position.x+t.canvas.width,this.position.y+t.canvas.height),t.rotate(this.rotation*Math.PI/180),t.drawImage(this.newcnv,-this.base.x,-this.base.y),t.restore()},h},Asteroid=function(t){var o=new Polygon({points:asteroidVertices(Math.max(Math.floor(t/5),3),t),color:"hsl("+Math.floor(360*Math.random())+",100%,50%)",name:"asteroid",size:{x:210,y:210},base:{x:105,y:105},velocity:{x:(2*Math.random()-1)*Math.random()*2,y:(2*Math.random()-1)*Math.random()*2},position:{x:500*Math.random(),y:1e3*Math.random()}});return o.Start=function(){this.rotationSpeed=(2*Math.random()-1)*Math.random()*2,this.radius=t,this.score=80/this.radius*5},o.Update=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.x>game.canvas.width&&(this.position.x-=game.canvas.width),this.position.x<0&&(this.position.x+=game.canvas.width),this.position.y>game.canvas.height&&(this.position.y-=game.canvas.height),this.position.y<0&&(this.position.y+=game.canvas.height),this.rotation+=this.rotationSpeed,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360)},o},Ufo=function(t){var o=new Polygon({points:asteroidVertices(Math.max(Math.floor(t/2),3),t),color:"white",name:"ufo",size:{x:210,y:210},base:{x:105,y:105},velocity:{x:(2*Math.random()-1)*Math.random()*2,y:(2*Math.random()-1)*Math.random()*2},position:{x:500*Math.random(),y:1e3*Math.random()}});return o.Start=function(){this.rotationSpeed=(2*Math.random()-1)*Math.random()*2,this.radius=t,this.score=1e3/this.radius*10},o.Update=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.x>game.canvas.width&&(this.position.x-=game.canvas.width),this.position.x<0&&(this.position.x+=game.canvas.width),this.position.y>game.canvas.height&&(this.position.y-=game.canvas.height),this.position.y<0&&(this.position.y+=game.canvas.height),this.rotation+=this.rotationSpeed,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360)},o},Bullet=function(){var t=new Polygon({points:[{x:0,y:0},{x:0,y:-5}],size:{x:10,y:15},base:{x:5,y:10},color:"hsl("+Math.floor(360*Math.random())+",100%,50%)",name:"bullet"});return t.Start=function(){var t=RotatePoint({x:0,y:-20},{x:0,y:0},ship.rotation*Math.PI/180);this.position={x:ship.position.x+t.x,y:ship.position.y+t.y},this.rotation=ship.rotation,this.velocity={x:t.x/2,y:t.y/2}},t.Update=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;var t=this.position,o=!1;game.eachByName("asteroid",(function(i,e){if(Math.sqrt((i.position.x-t.x)*(i.position.x-t.x)+(i.position.y-t.y)*(i.position.y-t.y))<i.radius){for(var s=[],a=0;a<i.points.length;a++){var n=RotatePoint(i.points[a],{x:0,y:0},i.rotation*Math.PI/180);s.push({x:n.x+i.position.x,y:n.y+i.position.y})}if(CheckPointInPoly(t,s)){if(o=!0,i.radius/2>5){var h=new Asteroid(i.radius/2),r=new Asteroid(i.radius/2);h.Start(),r.Start(),h.velocity=RotatePoint(i.velocity,{x:0,y:0},10*Math.PI/180),r.velocity=RotatePoint(i.velocity,{x:0,y:0},360-10*Math.PI/180),h.position={x:i.position.x+h.velocity.x,y:i.position.y+h.velocity.y},r.position={x:i.position.x+r.velocity.x,y:i.position.y+r.velocity.y},game.objects.push(h,r)}else{var c=new Burst({position:i.position,color:"hsl("+Math.floor(360*Math.random())+",100%,50%)"});game.objects.push(c)}i.delete=!0,game.score+=i.score}}})),o&&(this.delete=!0);t=this.position,o=!1;game.eachByName("ufo",(function(i,e){if(Math.sqrt((i.position.x-t.x)*(i.position.x-t.x)+(i.position.y-t.y)*(i.position.y-t.y))<i.radius){for(var s=[],a=0;a<i.points.length;a++){var n=RotatePoint(i.points[a],{x:0,y:0},i.rotation*Math.PI/180);s.push({x:n.x+i.position.x,y:n.y+i.position.y})}if(CheckPointInPoly(t,s)){if(o=!0,i.radius/2>5){var h=new Ufo(i.radius/2),r=new Ufo(i.radius/2);h.Start(),r.Start(),h.velocity=RotatePoint(i.velocity,{x:0,y:0},10*Math.PI/180),r.velocity=RotatePoint(i.velocity,{x:0,y:0},360-10*Math.PI/180),h.position={x:i.position.x+h.velocity.x,y:i.position.y+h.velocity.y},r.position={x:i.position.x+r.velocity.x,y:i.position.y+r.velocity.y},game.objects.push(h,r)}else{var c=new Burst({position:i.position,color:"white"});game.objects.push(c)}i.delete=!0,game.score+=i.score}}})),(this.position.x<0||this.position.y<0||this.position.x>game.canvas.width||this.position.y>game.canvas.height)&&(this.delete=!0)},t},Burst=function(t){var o=t.length||10,i=t.count||36,e=t.color||"#F00",s=t.name||"burst",a=t.position||{x:0,y:0},n=t.speed||10,h={delete:!1,radius:0,count:i,color:e,name:s,position:a,length:o,Start:function(){},Update:function(){this.radius+=n,(this.radius>game.canvas.width||this.radius>game.canvas.height)&&(this.delete=!0)},Draw:function(t){t.save(),t.translate(this.position.x,this.position.y),t.beginPath();for(var o=0;o<this.count;o++){var i=RotatePoint({x:0,y:this.radius},{x:0,y:0},2/this.count*o*Math.PI),e=RotatePoint({x:0,y:this.radius+this.length},{x:0,y:0},2/this.count*o*Math.PI);t.moveTo(i.x,i.y),t.lineTo(e.x,e.y)}t.closePath(),t.strokeStyle=this.color,t.shadowColor=this.color,t.shadowBlur=5,t.stroke(),t.restore()}};return h},CheckIntersection=function(t,o,i,e){var s,a,n,h;return s=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x),a=(e.x-i.x)*(o.y-i.y)-(e.y-i.y)*(o.x-i.x),n=(o.x-t.x)*(i.y-t.y)-(o.y-t.y)*(i.x-t.x),h=(o.x-t.x)*(e.y-t.y)-(o.y-t.y)*(e.x-t.x),s*a<0&&n*h<0},CheckPointInPoly=function(t,o){for(var i=0,e=o.length-1,s=!1;i<o.length;e=i++){var a={x:o[i].x,y:o[i].y},n={x:o[e].x,y:o[e].y};a.y>t.y!=n.y>t.y&&t.x<(n.x-a.x)*(t.y-a.y)/(n.y-a.y)+a.x&&(s=!s)}return s},RotatePoint=function(t,o,i){return{x:(t.x-o.x)*Math.cos(i)-(t.y-o.y)*Math.sin(i)+o.x,y:(t.x-o.x)*Math.sin(i)+(t.y-o.y)*Math.cos(i)+o.y}},asteroidVertices=function(t,o){for(var i=[],e=0;e<t;e++)i[e]={x:(-Math.sin(360/t*e*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*o,y:(-Math.cos(360/t*e*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*o};return i},EngGameMessage=function(t,o){var i=[];if("undefined"!=typeof Storage){for(var e=0;e<localStorage.length;e++)void 0!==localStorage["board."+e+".name"]&&i.push({name:localStorage["board."+e+".name"],score:localStorage["board."+e+".score"]});i.sort((function(t,o){return o.score-t.score}));for(var s='<ol class="b-scores">',a=0;a<i.length;a++)s+='<li class="b-scores__box">',o>i[a].score&&(s+="Your score: "+o+'. <input onchange="SaveName(this)" value="" autofocus="autofocus" type="text" placeholder="Enter your name" class="b-scores__input" /></li><li class="b-scores__box">',o=0),s+=i[a].score+": "+i[a].name+"</li>";0!==o&&(s+='<li class="b-scores__box">Your score: '+o+'. <input onchange="SaveName(this)" value="" autofocus="autofocus" type="text" placeholder="Enter your name" class="b-scores__input" /></li>'),s+="</ol>",document.querySelector(t).innerHTML=s}},SaveScore=function(t,o){if(o.style,display="block",t>0&&"undefined"!=typeof Storage){for(var i=0,e=0;e<localStorage.length;e++)void 0!==localStorage["board."+e+".name"]&&(i=e+1);localStorage["board."+i+".name"]=game.name,localStorage["board."+i+".score"]=t,o.style.display="none"}},SaveName=function(t){game.name=t.value},game=new GameEngine("#g-game","#g-score","#level"),ship=new Polygon({points:[{x:0,y:0},{x:10,y:10},{x:0,y:-20},{x:-10,y:10}],color:"hsl("+Math.floor(360*Math.random())+",100%,50%)",name:"ship",size:{x:30,y:45},base:{x:15,y:25}}),ufo=new Polygon({points:[{x:0,y:0},{x:10,y:10},{x:0,y:-20},{x:-10,y:10}],color:"white",name:"ufo",size:{x:30,y:45},base:{x:15,y:25}});ship.Start=function(){this.position={x:game.canvas.width/2,y:game.canvas.height/2},this.rotationSpeed=7,this.speed=0,this.inertia=0,this.inertiaMax=.99,this.shootDate=0},ship.Update=function(){if(game.input.left&&(this.rotation-=this.rotationSpeed),game.input.right&&(this.rotation+=this.rotationSpeed),this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360),game.input.forward?(this.speed+=.001,this.speed>.1&&(this.speed=.1),this.velocity.x-=Math.sin(-this.rotation*Math.PI/180)*this.speed*2,this.velocity.y-=Math.cos(-this.rotation*Math.PI/180)*this.speed*2,this.inertia=this.inertiaMax,this.points=[{x:0,y:0},{x:10,y:10},{x:0,y:-20},{x:-10,y:10},{x:0,y:0},{x:3,y:8},{x:0,y:15},{x:-3,y:8}]):(this.speed-=.001,this.speed<=0&&(this.speed=0),this.points=[{x:0,y:0},{x:10,y:10},{x:0,y:-20},{x:-10,y:10}]),game.input.fire&&Date.now()-this.shootDate>400){var t=new Bullet;t.Start(),game.objects.push(t),this.shootDate=Date.now()}this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.inertia,this.velocity.y*=this.inertia,this.position.x>game.canvas.width&&(this.position.x-=game.canvas.width),this.position.x<0&&(this.position.x+=game.canvas.width),this.position.y>game.canvas.height&&(this.position.y-=game.canvas.height),this.position.y<0&&(this.position.y+=game.canvas.height);var o=this.position,i=this.points,e=!1,s=!1,a=(this.base,this.rotation*Math.PI/180),n=0;if(game.eachByName("asteroid",(function(t,s){if(n++,Math.sqrt((t.position.x-o.x)*(t.position.x-o.x)+(t.position.y-o.y)*(t.position.y-o.y))<130)for(var h=0;h<i.length;h++)for(var r=h,c=h+1<i.length?h+1:0,y=RotatePoint({x:i[r].x,y:i[r].y},{x:0,y:0},a),x=RotatePoint({x:i[c].x,y:i[c].y},{x:0,y:0},a),p=0;p<t.points.length;p++){var l=p,d=p+1<t.points.length?p+1:0,u=RotatePoint({x:t.points[l].x,y:t.points[l].y},{x:0,y:0},t.rotation*Math.PI/180),v=RotatePoint({x:t.points[d].x,y:t.points[d].y},{x:0,y:0},t.rotation*Math.PI/180);CheckIntersection({x:y.x+o.x,y:y.y+o.y},{x:x.x+o.x,y:x.y+o.y},{x:u.x+t.position.x,y:u.y+t.position.y},{x:v.x+t.position.x,y:v.y+t.position.y})&&(e=!0)}})),game.eachByName("ufo",(function(t,e){if(x++,Math.sqrt((t.position.x-o.x)*(t.position.x-o.x)+(t.position.y-o.y)*(t.position.y-o.y))<130)for(var n=0;n<i.length;n++)for(var h=n,r=n+1<i.length?n+1:0,c=RotatePoint({x:i[h].x,y:i[h].y},{x:0,y:0},a),y=RotatePoint({x:i[r].x,y:i[r].y},{x:0,y:0},a),p=0;p<t.points.length;p++){var l=p,d=p+1<t.points.length?p+1:0,u=RotatePoint({x:t.points[l].x,y:t.points[l].y},{x:0,y:0},t.rotation*Math.PI/180),v=RotatePoint({x:t.points[d].x,y:t.points[d].y},{x:0,y:0},t.rotation*Math.PI/180);CheckIntersection({x:c.x+o.x,y:c.y+o.y},{x:y.x+o.x,y:y.y+o.y},{x:u.x+t.position.x,y:u.y+t.position.y},{x:v.x+t.position.x,y:v.y+t.position.y})&&(s=!0)}})),e){this.delete=!0;var h=new Burst({position:this.position,color:"hsl("+Math.floor(360*Math.random())+",100%,50%)"});game.objects.push(h),EngGameMessage("#g-leaderboard",game.score),document.querySelector("#g-endgame").style.display="block"}if(s){this.speed=.2,this.delete=!0;h=new Burst({position:this.position,color:"white"});game.objects.push(h),EngGameMessage("#g-leaderboard",game.score),document.querySelector("#g-endgame").style.display="block"}if(x<1)for(var r=0;r<4;r++){var c=new Ufo(80);c.Start(),game.objects.push(c)}if(n<1)for(r=0;r<4;r++){var y=new Asteroid(80);y.Start(),game.objects.push(y)}o=this.position,i=this.points,s=!1,this.base,a=this.rotation*Math.PI/180;var x=0;game.eachByName("ufo",(function(t,e){if(x++,Math.sqrt((t.position.x-o.x)*(t.position.x-o.x)+(t.position.y-o.y)*(t.position.y-o.y))<130)for(var n=0;n<i.length;n++)for(var h=n,r=n+1<i.length?n+1:0,c=RotatePoint({x:i[h].x,y:i[h].y},{x:0,y:0},a),y=RotatePoint({x:i[r].x,y:i[r].y},{x:0,y:0},a),p=0;p<t.points.length;p++){var l=p,d=p+1<t.points.length?p+1:0,u=RotatePoint({x:t.points[l].x,y:t.points[l].y},{x:0,y:0},t.rotation*Math.PI/180),v=RotatePoint({x:t.points[d].x,y:t.points[d].y},{x:0,y:0},t.rotation*Math.PI/180);CheckIntersection({x:c.x+o.x,y:c.y+o.y},{x:y.x+o.x,y:y.y+o.y},{x:u.x+t.position.x,y:u.y+t.position.y},{x:v.x+t.position.x,y:v.y+t.position.y})&&(s=!0)}})),s&&(ship.speed=1e3)},game.objects.push(ship);for(var i=0;i<4;i++){var rock=new Asteroid(10);rock.Start(),game.objects.push(rock)}for(i=0;i<4;i++){ufo=new Ufo(10);rock.Start(),game.objects.push(ufo)}</script>