<title>Bastet Night - js13kGames 2025</title><body><style>*{image-rendering:pixelated;margin:0;position:a;font-size:12px;box-sizing:border-box;user-select:none}#c{position:absolute;width:640px;height:360px;left:50%;transform-origin:top left}#a,#b,#o,#p,#s,#z{position:absolute;top:0;left:0;width:100%;height:100%}#p,#y{display:flex;align-items:center;justify-content:center;background-color:#000000aa;flex-direction:column;color:#fff}#p{display:none}#x{display:flex;align-items:center;justify-content:center}#y{height:162px;width:100px;margin:10px;background-color:#000;padding:10px}#y1,#y2,#y3{flex:1}#s{background:#888}img{position:absolute}#i1{width:250px;top:120px}#h{float:right;margin:50px;font-size:20px}#i2{right:0;bottom:0;width:450px}#l{position:absolute;right:170px;bottom:30px;color:#999;font-size:30px;cursor:pointer;transition:all .3s}#l:hover{transform:scale(1.1);color:#fff}#o{background-color:#999;display:none;flex-direction:column;align-items:center;justify-content:center}#o div{font-size:20px;margin:20px}</style><div id=c><canvas id=a width=640 height=360></canvas><canvas id=b width=640 height=360></canvas><div id=z><div id=d></div><div>Upgrade [F]</div><div id=p><div id=e></div><div id=x><div id=y><div id=y1></div>Press [1]</div><div id=y><div id=y2></div>Press [2]</div><div id=y><div id=y3></div>Press [3]</div></div><div>Press [ESC] to back</div></div></div><div id=s><img id=i1 src=logo.png><img id=i2 src=cat.png><div id=l>Start</div><div id=h></div></div><div id=o><div style=font-size:50px>Game Over!!</div><div id=o1></div><div id=o2></div><button onclick=location.reload()>Back to Menu</button></div></div><script>let zzfxV=.3,zzfxX=new AudioContext,zzfx=(e=1,t=.05,s=220,a=0,n=0,r=.1,i=0,o=1,c=0,p=0,l=0,h=0,u=0,m=0,d=0,g=0,y=0,x=1,f=0,k=0,b=0)=>{let I=Math,w=2*I.PI,z=44100,S=c*=500*w/z/z,M=s*=(1-t+2*t*I.random(t=[]))*w/z,R=0,v=0,H=0,P=1,G=0,T=0,C=0,A=b<0?-1:1,j=w*A*b*2/z,L=I.cos(j),O=I.sin,U=O(j)/4,E=1+U,D=-2*L/E,F=(1-U)/E,X=(1+A*L)/2/E,V=-(A+L)/E,q=X,B=0,$=0,W=0,J=0;for(p*=500*w/z**3,d*=w/z,l*=w/z,h*=z,u=z*u|0,e*=zzfxV,A=(a=z*a+9)+(f*=z)+(n*=z)+(r*=z)+(y*=z)|0;H<A;t[H++]=C*e)++T%(100*g|0)||(C=i?1<i?2<i?3<i?O(R**3):I.max(I.min(I.tan(R),1),-1):1-(2*R/w%2+2)%2:1-4*I.abs(I.round(R/w)-R/w):O(R),C=(u?1-k+k*O(w*H/u):1)*(C<0?-1:1)*I.abs(C)**o*(H<a?H/a:H<a+f?1-(H-a)/f*(1-x):H<a+f+n?x:H<A-y?(A-H-y)/r*x:0),C=y?C/2+(y>H?0:(H<A-y?1:(A-H)/y)*t[H-y|0]/2/e):C,b&&(C=J=q*B+V*(B=$)+X*($=C)-F*W-D*(W=J))),j=(s+=c+=p)*I.cos(d*v++),R+=j+j*m*O(H**5),P&&++P>h&&(s+=l,M+=l,P=0),!u||++G%u||(s=M,c=S,P=P||1);(e=zzfxX.createBuffer(1,A,z)).getChannelData(0).set(t),(s=zzfxX.createBufferSource()).buffer=e,s.connect(zzfxX.destination),s.start()};const ctx=Get("b").getContext("2d"),bgCtx=Get("a").getContext("2d");ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.msImageSmoothingEnabled=!1;var pause=!0,tPause=!1;const w=640,h=360,objects=[],monsters=[];let score=0,canSelect=!1,point=0,panel=Get("p"),upgrades={speed:0,atk:0,hp:0,hpReg:0,range:0};const up=[0,1,2,3,4].flatMap(e=>new Array(10).fill(e)),price=[1,2,3,5,8,13,21,34,55];function clamp(e,t,s){return Math.min(Math.max(e,t),s)}let chig=[0,0];function Get(e){return document.getElementById(e)}function Dis(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function IsCol(e,t,s=1){return!(e.x+e.size*s<t.x||e.x>t.x+t.size*s||e.y+e.size*s<t.y||e.y>t.y+t.size*s)}function RefreshUpgrade(){for(let e=1;e<4;e++){const t=Get("y"+e),s=Rand(up.length);switch(t.value=s,up[s]){case 0:t.innerHTML="Speed++<br><br><br>Point:"+10*price[upgrades.speed];break;case 1:t.innerHTML="Atk++<br><br><br>Point:"+10*price[upgrades.atk];break;case 2:t.innerHTML="HP++<br><br><br>Point:"+10*price[upgrades.hp];break;case 3:t.innerHTML="HP Regen++<br><br><br>Point:"+10*price[upgrades.hpReg];break;case 4:t.innerHTML="Range++<br><br><br>Point:"+10*price[upgrades.range]}}}Get("h").innerHTML="High score: "+(null==localStorage.getItem("score",0)?0:localStorage.getItem("score")),RefreshUpgrade();class Obj{x=0;y=0;anim=0;imgs=[];flip=!1;a=0;animTarget=1;animInterval=200;interval;size=32;hp=10;maxHp=10;constructor(e){e.map(e=>{const t=new Image;t.src=`./${e}.png`,this.imgs.push(t)})}Init(){this.interval=setInterval(()=>{pause||tPause||(this.a=(this.a+1)%this.animTarget)},this.animInterval),objects.push(this)}Render(){let e=this.size,t=e/2;ctx.save(),this.flip?(ctx.translate(this.x+t,this.y+t),ctx.scale(-1,1),ctx.drawImage(this.imgs[this.anim],-t,-t,e,e)):ctx.drawImage(this.imgs[this.anim],this.x,this.y,e,e),ctx.restore()}Update(){}Remove(){objects.splice(objects.indexOf(this),1),clearInterval(this.interval)}After(){ctx.fillStyle="red",ctx.fillRect(this.x,this.y-5,this.size,3),ctx.fillStyle="green",ctx.fillRect(this.x,this.y-5,this.size*(this.hp/this.maxHp),3)}}class Player extends Obj{animTarget=4;Update(){if(0==chig[0]&&0==chig[1])this.anim=0;else{let e=this.x,t=this.y;this.x=clamp(this.x+chig[0]*(2+.2*upgrades.speed),0,w-32),this.y=clamp(this.y+chig[1]*(2+.2*upgrades.speed),0,h-32),IsCol(this,house,.9)&&(this.x=e,this.y=t),0!=chig[0]&&(this.flip=chig[0]<0),this.anim=this.a}}}function Rand(e){return Math.round(Math.random()*e)}function Clear(){ctx.clearRect(0,0,w,h)}function SetHP(){let e=house.maxHp-house.hp;house.maxHp=100+10*upgrades.hp,house.hp=house.maxHp-e}function PlayerAtk(){const e=new Obj(["atk1","atk2","atk3","atk4","atk5"]);e.x=player.x+(player.flip?-1:1)*(Rand(20)+20+2*upgrades.range),e.y=player.y-2.5*upgrades.range,e.flip=player.flip,e.animInterval=50,e.animTarget=5,e.size=32+6*upgrades.range,zzfx(...[,,860,.03,.01,.31,4,1.7,,,,,,,,,,.77,,.02]),e.Update=()=>{e.anim=e.a,monsters.map(t=>{IsCol(e,t)&&(t.iFrame||(t.hp-=upgrades.atk+1,t.iFrame=!0,t.hp<=0&&(point+=t.num,monsters.splice(monsters.indexOf(t),1),t.Remove(),zzfx(...[1.8,,425,.02,.01,.16,3,.1,,,,,,1.4,,.2,.1,.67,.01,,381]),score++,score>localStorage.getItem("score")&&localStorage.setItem("score",score),10==score&&setInterval(()=>{pause||tPause||SpawnMonster(1,3,"monster1",1,.5)},5e3),20==score&&setInterval(()=>{pause||tPause||SpawnMonster(1,5,"monster2",1,1)},5e3),50==score&&setInterval(()=>{pause||tPause||SpawnMonster(2,7,"monster3",2,.5)},5e3),75==score&&setInterval(()=>{pause||tPause||SpawnMonster(2.5,3,"monster4",3,.5)},5e3),100==score&&setInterval(()=>{pause||tPause||SpawnMonster(1.5,20,"monster5",5,1)},5e3)),setTimeout(()=>{t.iFrame=!1},300)))})},e.After=()=>{},setTimeout(()=>{e.Remove()},250),e.Init()}function SpawnMonster(e,t,s,a,n){const r=new Obj([s]);Rand(2),1==Rand(2)?(r.x=Rand(w),r.y=0==Rand(2)?-32:h+32):(r.x=0==Rand(2)?-32:w+32,r.y=Rand(h)),r.num=a,r.rate=n,r.hp=t,r.maxHp=t,r.iFrame=!1,r.counter=0,r.Update=()=>{if(IsCol(r,house))r.counter+=1,r.counter>=60&&(house.hp--,zzfx(...[1.5,,494,,.02,.08,1,3.8,,-4,,,,1.3,,.4,,.62,.05,,1610]),house.hp<=0&&GameOver(),r.counter=0);else{r.counter=0;let t=(house.x-r.x)/Dis(r,house),s=(house.y-r.y)/Dis(r,house);r.x+=t*e,r.y+=s*e}},monsters.push(r),r.Init()}function GameOver(){pause=!0,zzfx(...[1.2,,489,,.04,.26,1,2.1,-4,,278,.09,.07,,,.1,,.66,.01]),Get("o").style.display="flex",Get("o1").innerHTML="current score: "+score,Get("o2").innerHTML="high score: "+localStorage.getItem("score")}function Resize(){let e,t=window.innerWidth,s=window.innerHeight,a=Get("c"),n=1;e=s/h*w,n=e<t?e/w:t/w,a.style.transform=" scale("+n+")  translateX(-50%)"}Get("l").addEventListener("click",()=>{pause=!1,Get("s").style.display="none",Music(),setInterval(Music,5440)});const player=new Player(["cat1","cat2","cat1","cat3"]);player.After=()=>{},player.Init(),player.x=200,player.y=150;const house=new Obj(["house"]);house.size=100,house.maxHp=100,house.hp=100,house.x=270,house.y=110,house.Init();const keys={};function Select(e){if(!canSelect)return;let t=Get("y"+e).value;const s=10*price[upgrades[Object.keys(upgrades)[up[t]]]];s>point||(canSelect=!1,point-=s,upgrades[Object.keys(upgrades)[up[t]]]+=1,up.splice(t,1),panel.style.display="none",pause=!1,RefreshUpgrade(),SetHP())}function Init(){RefreshUpgrade(),Resize(),setInterval(()=>{pause||tPause||SpawnMonster(1,3,"monster1",1,.5)},5e3),setInterval(()=>{pause||tPause||(house.hp+=upgrades.hpReg,house.hp>house.maxHp&&(house.hp=house.maxHp))},1e4),document.addEventListener("keydown",e=>{keys[e.key]||" "!=e.key||PlayerAtk(),keys[e.key]||"f"!=e.key||(panel.style.display="flex",pause=!0,canSelect=!0),keys[e.key]||"Escape"!=e.key||(panel.style.display="none",pause=!1,canSelect=!1),keys[e.key]||"1"!=e.key||Select(1),keys[e.key]||"2"!=e.key||Select(2),keys[e.key]||"3"!=e.key||Select(3),keys[e.key]=!0}),document.addEventListener("keyup",e=>{keys[e.key]=!1});for(let e=0;e<160;e++)for(let t=0;t<90;t++)bgCtx.fillStyle=`hsl(115, 100%, ${5*Math.random()+30}%)`,bgCtx.fillStyle=`hsl(51, 60%, ${5*Math.random()+30}%)`,bgCtx.fillRect(5*e,5*t,5,5)}function Input(){chig=[0,0],keys.w&&(chig[1]=-1),keys.a&&(chig[0]=-1),keys.s&&(chig[1]=1),keys.d&&(chig[0]=1)}function Render(){objects.map(e=>{e.Update(),e.Render()}),objects.map(e=>{e.After()})}function Update(){pause||tPause||(Clear(),Input(),Render(),Get("d").innerHTML="Score: "+score),Get("e").innerHTML="Point: "+point,requestAnimationFrame(Update)}function Music(){with(new AudioContext)with(G=createGain())for(i in D=[12,15,15,13,9,11,11,,7,11,11,9,4,7,7,,4,7,7,,9,11,11,,5,8,10,15,13,10,13,,13,10,13])with(createOscillator())D[i]&&(connect(G),G.connect(destination),start(.15*i),frequency.setValueAtTime(200*1.06**(13-D[i]),.15*i),type="triangle",gain.setValueAtTime(.5,.15*i),gain.setTargetAtTime(1e-4,.15*i+.13,.005),stop(.15*i+.14))}Init(),Update()</script>