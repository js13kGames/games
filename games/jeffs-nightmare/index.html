<script src=https://cdn.jsdelivr.net/npm/near-api-js@0.45.1/dist/near-api-js.min.js></script><style>canvas{background:linear-gradient(to bottom right,indigo,#000,#000,indigo)}img{margin:2%}</style><body style=margin:0;overflow:hidden><div class=container><div class=sign-in style=display:none><h1>Welcome!</h1><p>You'll have to sign in with NEAR for decentralized extras!</p><button class="btn btn-primary" style=background-color:#0072ce>Sign In</button> <img src=alternateSpaceCowboy.png><img src=weird.png></div><div class=without style=display:none><button class="btn btn-primary" style=background-color:#0072ce>Play Without Decentralized</button></div><div class=after-sign-in style=display:none><canvas id=canvas></canvas></div></div><script type=module>var CONTRACT_NAME="dev-1630695919182-94167023923152";async function connect(){let e=await nearApi.connect({nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",networkId:"testnet",keyStore:new window.nearApi.keyStores.BrowserLocalStorageKeyStore(window.localStorage,"crystal")});window.walletConnection=new nearApi.WalletConnection(e),window.walletConnection.isSignedIn()?walletConnection.account():new nearApi.Account(e.connection,CONTRACT_NAME)}document.querySelector(".sign-in .btn").addEventListener("click",(()=>{window.walletConnection.requestSignIn(CONTRACT_NAME,"Crystal testing")}));var withoutDecentralize=!1;function updateUI(){if(console.log("Update UI"),withoutDecentralize)Array.from(document.querySelectorAll(".after-sign-in")).map((e=>e.style="display: block;")),Array.from(document.querySelectorAll(".sign-in")).map((e=>e.style="display: none;")),Array.from(document.querySelectorAll(".without")).map((e=>e.style="display: none;")),ifLoggedIn();else if(window.walletConnection.getAccountId()){Array.from(document.querySelectorAll(".after-sign-in")).map((e=>e.style="display: block;"));var e=window.walletConnection.getAccountId();e=e.slice(0,e.lastIndexOf(".")),ifLoggedIn()}else Array.from(document.querySelectorAll(".sign-in")).map((e=>e.style="display: block;margin-left: 10%;margin-top: 10%;")),Array.from(document.querySelectorAll(".without")).map((e=>e.style="display: block;margin-left: 10%;margin-top: 2%;"))}document.querySelector(".without .btn").addEventListener("click",(()=>{console.log("Without"),withoutDecentralize=!0,updateUI()})),nearApi.nearInitPromise=connect().then(updateUI).catch(console.error);import Client,{HTTP}from"https://cdn.jsdelivr.net/npm/drand-client/drand.js";const chainHash="8990e7a9aaed2ffed73dbd7092123d6f289930540d7651336225dc172e51b2ce",urls=["https://api.drand.sh","https://drand.cloudflare.com"];function ifLoggedIn(){function e(t){let n=0;setTimeout((function a(){n==T.length?e(t):(function(e){R=e%10,(M=B[R].createBufferSource()).buffer=T[e],M.connect(B[R].destination),M.start()}(n),n++,setTimeout(a,200))}),200),u=!0}function t(e,t,n){for(e=function(e){return 130.81*1.06**e}(e),d=t,y=n,g=[],x=m=0,p=(e,t,n,a)=>Math.sin(e/t*6.28*n+a),C=(e,t)=>y?Math.sin(e/44100*t*6.28+p(e,44100,t,0)**2+.75*p(e,44100,t,.25)+.1*p(e,44100,t,.5)):(S=44100/t,I=0,g.length<=1+~~S?(g.push(2*Math.random()-1),g[g.length-1]):(g[x]=.5*(g[x>=g.length-1?0:x+1]+g[x]),x>=~~S&&(x<1+~~S?m%100>=~~(100*(S-~~S))&&(I=1,g[x+1]=.5*(g[0]+g[x+1]),m++):I=1),g[x=I?0:x+1])),v=[],A=0;A<44100*d;A++)v[A]=88>A?A/88.2*C(A,e):(1-(A-88.2)/(44100*(d-.002)))**(y?(.5*Math.log(1e4*e/44100))**2:1)*C(A,e);return v}function n(e){(M=B[10].createBufferSource()).buffer=e,M.connect(B[10].destination),M.start()}async function a(){const e=await Client.wrap(HTTP.forURLs(urls,chainHash),{chainHash:chainHash}),t=await e.get();k=t.randomness,O=!0}function i(){return++F>=k.length&&(F=0),.1*parseInt(k[F],16)*2-1.5}function o(){canvas.width=innerWidth,canvas.height=innerHeight,U.w=canvas.width,U.h=canvas.height,0===D?(U.w=canvas.width,U.h=canvas.height,U.fillStyle="#4B0082",U.fillRect(U.w/4,U.h/3,U.w/2,U.h/2),U.fillStyle="#000000",U.fillRect(U.w/4+10,U.h/3+10,U.w/2-20,U.h/2-20),r("Hello "+h+", thanks for playing!",U.w/2,.9*U.h,2,"#a4f3f4"),r("Jeff's Nightmare",U.w/2,.55*U.h,4,"#DEC58F"),r("Help Jeff fight his fears!",U.w/2,.62*U.h,2,"#a4f3f4"),r("CLICK TO START!",U.w/2,.75*U.h,1.5,"#DEC58F")):1===D?function(){for(;15>Y.length;)s();Y.forEach((e=>{e.move(),e.update(),e.render(),e.isClose(L.x,L.y,1.2)&&(H-=.2),e.outOfBounds&&function(e){for(var t=0;t<Y.length;t++)Y[t]===e&&(Y[t]=null,Y.splice(t,1),e=null)}(e)})),K.forEach((e=>{e.update(),e.draw(),e.outOfBounds&&function(e){for(var t=0;t<K.length;t++)if(K[t]===e){K[t]=null,K.splice(t,1);break}}(e),Y.forEach((t=>{t.isClose(e.x,e.y,1)&&(t.y=-100,t.outOfBounds=!0,E++,n(q))}))})),function(e,t,n){e.angle=Math.atan2(n-e.y,t-e.x)}(N,W.x,W.y),N.x,N.w,N.y,N.h,P.x=N.x+N.w/2*Math.cos(N.angle),P.y=N.y+N.w/2*Math.sin(N.angle),function(e){U.save(),U.translate(e.x,e.y),U.rotate(e.angle);var t=-e.w/2,n=-e.h/2;U.drawImage(e.img,t,n,e.w,e.h),U.restore()}(N),1<N.x-z.x?N.x-=1:-1>N.x-z.x&&(N.x+=1),1<N.y-z.y?N.y-=1:-1>N.y-z.y&&(N.y+=1),1>H&&(D=2),U.fillStyle="#0000007f",U.fillRect(0,0,U.w,U.h/12),r("[Jeff's Nightmare]",U.w/5,.05*U.h,2.5,"#a4f3f4"),r("Score: "+E+"  Courage: "+Math.floor(H),.6*U.w,.05*U.h,2.5,"#a4f3f4")}():2===D&&(U.w=canvas.width,U.h=canvas.height,U.fillStyle="#4B0082",U.fillRect(U.w/4,U.h/3,U.w/2,U.h/2),U.fillStyle="#000000",U.fillRect(U.w/4+10,U.h/3+10,U.w/2-20,U.h/2-20),r("Hey "+h+", want to play again?",U.w/2,.3*U.h,2,"#a4f3f4"),r("Jeff's Nightmare",U.w/2,.55*U.h,4,"#DEC58F"),r("Unfortunately Jeff woke up... ",U.w/2,.62*U.h,2,"#a4f3f4"),r("Your score: "+E,U.w/2,.7*U.h,1.7,"#a4f3f4"),U.fillStyle="#4B0082",U.fillRect(.42*U.w+5,.72*U.h,.15*U.w,U.h/20),U.fillStyle="#0000007f",U.fillRect(.42*U.w+8,.72*U.h+3,.15*U.w-6,U.h/20-6),r("Click to logout.",U.w/2,.75*U.h+2,1.5,"#DEC58F"),U.fillStyle="#4B0082",U.fillRect(U.w/3,.8*U.h,U.w/3,U.h/10),U.fillStyle="#0000007f",U.fillRect(U.w/3+5,.8*U.h+5,U.w/3-10,U.h/10-10),r("CLICK TO RESTART!",U.w/2,.87*U.h,2.7,"pink")),requestAnimationFrame(o)}function l(e,t,n,a,i,o){if(e>n&&e<a&&t>i&&t<o)return!0}function r(e,t,n,a,i){U.textAlign="center",U.fillStyle=i,U.font=a+"vw Consolas",U.fillText(e,t,n)}function c(e,t){var n=Math.atan2(t.y-e.y,t.x-e.x);return{x:Math.cos(n),y:Math.sin(n)}}function s(){let e,t,n=Math.random()*U.w,a=2*Math.random()+.2;O?(e=i(),t=i()):(e=3*Math.random()-1.5,t=3*Math.random()-1.5),Y.push(function(e,t,n,a,i,o,l,r,c,s){let h=new Image,f=function(e){var t={},n=0,a=0,i=0,o=e.ticksPerFrame||0,l=e.numberOfFrames||1;return t.context=e.context,t.w=e.width,t.h=e.height,t.x=e.x,t.y=e.y,t.image=e.image,t.scaleRatio=1,t.s=e.s,t.seq=[],t.dead=!1,t.outOfBounds=!1,t.newSeq=function(e){i=0,n=0,t.seq=e},t.switch=function(e){n=e},t.update=function(){(a+=1)>o&&(a=0,n<l-1?(n+=1,0<t.seq.length&&(n=t.seq[i],i+=1)):1>t.seq.length&&(n=0),i>t.seq.length-1&&(i=0))},t.render=function(){t.context.drawImage(t.image,n*t.w/l,0,t.w/l,t.h,t.x,t.y,t.w/l*t.scaleRatio,t.h*t.scaleRatio)},t.getFrameWidth=function(){return t.w/l},t.isClose=function(e,n,a){var i=t.x+t.getFrameWidth()/2*t.scaleRatio-(e+t.getFrameWidth()/2),o=t.y+t.getFrameWidth()/2*t.scaleRatio-(n+t.getFrameWidth()/2);return!!(Math.sqrt(i*i+o*o)<t.getFrameWidth()*t.scaleRatio*a)},t.move=function(){t.x+=t.s.x,t.y+=t.s.y,(t.x>U.w||t.y>U.h||0>t.x||-100>t.y)&&(t.outOfBounds=!0)},t}({context:e,width:t,height:n,image:h,numberOfFrames:i,ticksPerFrame:o,s:s});return f.x=l,f.y=r,f.scaleRatio=c,h.src=a,f}(U,32,32,"weird.png",1,10,n,-100,a,{x:e,y:t}))}if(withoutDecentralize)var h="Player";else h=(h=window.walletConnection.getAccountId()).slice(0,h.lastIndexOf("."));var f=[0,7,12,9,7,12,9,0,31,7,12,9,28,7,12,26,9,0,7,28,12,9,7,12,9,0,7,12,9,7,12,9,0,7,12,9,28,7,12,26,9,0,7,28,12,9,7,12,9,0,7,12,9,7,12,9,0];let u=!1;var w,d,y,g,m,x,p,C,v,A,S,I,R,M,b,q,k,T=[],B=[],O=!1,F=0;withoutDecentralize||a();var D,E=0,H=100,U=canvas.getContext`2d`;D=0;canvas.width=innerWidth,canvas.height=innerHeight,U.w=innerWidth,U.h=innerHeight,requestAnimationFrame(o),onclick=i=>{let o=i.pageX,r=i.pageY;switch(D){case 0:if(l(o,r,U.w/4,U.w/4+U.w/2,U.h/3,.8*U.h)){if(withoutDecentralize||a(),!u){for(u=!0,w=0;11>w;w++)B[w]=new AudioContext;(b=B[10].createBuffer(1,1e6,44100)).getChannelData(0).set(t(32,3,!1)),(q=B[10].createBuffer(1,1e6,44100)).getChannelData(0).set(t(4,4,!1)),function(e,n,a){let i,o=0;e.forEach((e=>{i=o%10,T.push(B[i].createBuffer(1,1e6,44100)),T[o].getChannelData(0).set(t(e,n,a)),o++}))}(f,2,!0),e(T)}D=1}break;case 1:!function(e,t){let a=c({x:P.x,y:P.y},{x:e,y:t});K.push(new J(P.x,P.y,a)),a=c({x:P.x,y:P.y},{x:e,y:t+20}),K.push(new J(P.x,P.y,a)),a=c({x:P.x,y:P.y},{x:e,y:t-20}),K.push(new J(P.x,P.y,a)),n(b)}(o,r);break;case 2:l(o,r,U.w/3,U.w/3*2,.8*U.h,.8*U.h+U.h/10)?(E=0,H=100,D=1):l(o,r,U.w/4,U.w/4+U.w/2,U.h/3,.8*U.h)&&(!withoutDecentralize&&window.walletConnection.signOut(),window.location.replace(window.location.origin+window.location.pathname),D=0)}};const W={x:null,y:null},L=new Image;L.src="alternateSpaceCowboy.png";const N={x:U.w/2,y:.9*U.h,w:135,h:118,angle:0,dead:!1,img:L},P={x:0,y:0};var z={x:0,y:0};class J{constructor(e,t,n){this.x=e,this.y=t,this.v=n,this.outOfBounds=!1}draw(){U.fillStyle="steelblue",U.beginPath(),U.arc(this.x,this.y,2.5,0,2*Math.PI,!0),U.fill()}update(){this.x+=5*this.v.x,this.y+=5*this.v.y,(this.x>U.w||0>this.x||this.y>U.h||0>this.y)&&(this.outOfBounds=!0)}isClose(e,t,n){return!!(Math.sqrt((this.x-e)**2+(this.y-t)**2)<n)}}const K=[];onmousemove=e=>{var t=canvas.getBoundingClientRect();(Math.abs(z.x-W.x)>U.w/5||Math.abs(z.y-W.y)>U.h/4)&&(z.x=W.x,z.y=W.y),W.x=e.clientX-t.left,W.y=e.clientY-t.top};const Y=[]}</script>