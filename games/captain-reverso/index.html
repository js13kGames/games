<!doctype html><title>Captain Reverso</title><style>#wrap,canvas{position:absolute}body{background:#000;overflow:hidden}#wrap{top:50%;left:50%}</style><div id=wrap><canvas id=cm></canvas><canvas id=cfg></canvas></div><script>"use strict";!function(t,i,s){function h(t,i,s,h,a){this.A=new g(t,i),this.C=s||10,this.F=h||10,this.r=a||0,this.N=[],this.ba=[],this.va=new g,this.wa=new g,this.Oa(),this.e=!0}function a(t,i){t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function e(t,i){for(var s=Object.keys(i),h=s.length;h--;)t[s[h]]=i[s[h]]}function n(){return t.createElement("canvas")}function r(t,s,h){(h||i).addEventListener(t,s)}function o(t){function i(t){return parseInt(t+""+t,16)}return{r:i(t[0]),Da:i(t[1]),R:i(t[2])}}function f(t,i,s){return 0<(i.x-t.x)*(s.y-t.y)-(i.y-t.y)*(s.x-t.x)}function c(t){return["mozI","webkitI","msI","i"].forEach((function(i){t[i+"mageSmoothingEnabled"]=!1})),t}function l(t,i,s){t.shadowBlur=200,t.shadowColor="#000",t.lineWidth=50,t.strokeRect(-25,-25,i+75,s+75),t.shadowBlur=0,t.lineWidth=2}function u(t,i,s,h){var a=i.x-t.x;i=i.y-t.y;var e=h.x-s.x,n=h.y-s.y,r=-e*i+a*n;return h=(-i*(t.x-s.x)+a*(t.y-s.y))/r,s=(e*(t.y-s.y)-n*(t.x-s.x))/r,0<=h&&1>=h&&0<=s&&1>=s?{x:t.x+s*a,y:t.y+s*i}:null}function y(t,i){this.C=t-20,this.F=i-20,this.Ha=this.Ga=this.Ba=this.ka=this.ab=this.$a=this.y=this.x=0,this.H=[{},{},{},{}]}function p(){this.na=function(t){for(var i=0;24>i;i++)this[String.fromCharCode(97+i)]=t[i]||0;.01>this.A&&(this.A=.01),.18>(t=this.R+this.A+this.e)&&(t=.18/t,this.R*=t,this.A*=t,this.e*=t)}}function A(t,i,s,h,a,e){a-=2,t.save(),t.translate(i,s),t.rotate(h),t.beginPath(),t.moveTo(-29,a/2),t.lineTo(-29,-a/2),t.lineTo(29,-a/2),t.lineTo(29,a/2),t.lineWidth=2,t.strokeStyle=e||"#357",t.stroke(),t.restore()}function w(t){this.H=this.t=t,this.C()}function g(t,i){this.x=t||0,this.y=i||0}function d(t,i,s,a){h.call(this,t,i,a,100,s)}function v(t,i,s){h.call(this,t,i,100,100,s)}function x(t,i,s){h.call(this,t,i,200,100,s)}function b(t,i){this.A=n(),this.A.width=t,this.A.height=i,this.Y=this.A.getContext("2d"),this.Y.fillStyle="#024",this.Y.fillRect(0,0,t,i);var s,h,a=this.Y.getImageData(0,0,t,i),e=a.data;for(h=0,s=e.length;h<s;h+=4){var r=.5>Math.random()?-5:5;e[h]+=r,e[h+1]+=r,e[h+2]+=r}this.Y.putImageData(a,0,0),l(this.Y,t,i),this.Ab=[new I(-10,i/2,0,20,i+40),new I(t/2,-10,0,t,20),new I(t/2,i+10,0,t,20),new I(t+10,i/2,0,20,i+40)]}function m(t,i,s,a){this.t=a,a.P=this,this.D=this.H=!1,h.call(this,t,i,60,200,s)}function M(t,i,s){this.xa=this.Ca=this.O=this.$=0,this.M=this.ha=null,this.B=ot.B.tr,this.L=new D(t,i,this.B.C,this.L),h.call(this,t,i,this.B.C,this.B.F,s),this.V=new h(t,i+this.da/2,this.B.C,this.B.C,0),this.ea=new h(t,i+this.da/2),this.Z=new h(t,i-this.da/2),s&&(t=new g(-Math.sin(s),Math.cos(s)).J(this.da/2),this.V.J(this.A.A().D(t),s),this.ea.J(this.A.A().D(t),s),this.Z.J(this.A.A().B(t),s))}function C(t,i,s){this.t=this.P=null;var a=ot.B.tl;this.B=n(),this.B.width=a.C,this.B.height=a.F;var e=this.B.getContext("2d");e.drawImage(a.fa,0,0);var r=e.getImageData(0,0,a.C,a.F),f=r.data,c=it.shift();it.push(c);c=o(c);for(var l=0,u=f.length;l<u;l+=4)f[l]===f[l+1]&&f[l]===f[l+2]&&(f[l]+=c.r,f[l+1]+=c.Da,f[l+2]+=c.R);e.putImageData(r,0,0),h.call(this,t,i,a.C,a.F,s),this.L=new D(t,i,this.C,this.L),this.da=this.F-40,this.ga=new h(t,i-this.da/2,this.C,this.C,0),this.pa=new g(t,i+this.da/2),s&&(t=new g(-Math.sin(s),Math.cos(s)).J(this.da/2),this.ga.J(this.A.A().B(t),s),this.pa=this.A.A().D(t))}function I(t,i,s,a,e){h.call(this,t,i,a||20,e||200,s)}function B(t,i,h,a,e,n,r,o){this.x=t,this.y=i,this.Ua=a,this.C=e||250,this.F=n||50,this.D=0,this.Xa=1,this.ca=!1,this.e=r===s?1:r,this.X=new G(t,i,h,o||4,this.e?0:"999")}function D(t,i,s,h,a){this.x=t,this.y=i,this.B=s/h,this.C=s,this.F=5,this.H=h,this.A="#"+(a||"0f0")}function F(t,i){this.A=t.A,this.t=i,this.y=this.x=this.D=this.Ka=this.ia=0}function G(t,i,s,h,a){this.x=t,this.y=i,this.B=h||2,this.ta=ot.B.f,this.mb=a,this.A=n(),this.aa(s)}function k(t,i,s){this.R=[],this.x=t,this.y=i,this.D=0;for(var h=(i=Object.keys(s)).length,a=this.y-(70*h-20)/2+25,e=0;e<h;e++)this.R.push(new B(t,a+70*e,i[e],s[i[e]]))}function S(t,i,s){this.x=t,this.y=i,this.B=s,this.C=20}function H(t,i){this.x=t,this.y=i,this.r=70,this.t=null,this.ia=this.Wa=new g(0,-this.r),this.Za=!1,this.X=new G(this.x,this.y-5,"trailer",2)}function J(t,i,s){Z[j=t].ra(i,s),ft.jb()}function P(){var t=tt();for(yt+=Math.min(1,(t-R)/1e3),R=t;yt>Y;)yt-=Y,Z[j].K();ut.clearRect(0,0,800,600),lt.save(),lt.translate(Math.round(T.x)+T.Ga,Math.round(T.y)+T.Ha),Z[j].G(),lt.restore(),requestAnimationFrame(P)}var K,R,T,L,O,N,X,Y=1/60,U=0,j=null,W=localStorage.getItem("tc"),q=W?+W:1,z=[{w:800,h:600,o:[],p:[200,50,0],t:[0,0,0],tr:[200,500,180],tt:[700,230,90]},{w:800,h:800,o:[2,310,600,0,2,490,600,0,6,400,750,0],p:[750,320,90],t:[60,40,20],tr:[400,100,0],tt:[400,600,180]},{w:800,h:600,o:[2,170,500,0],p:[490,550,180],t:[90,60,30],tr:[690,100,0],tt:[80,500,180]},{w:1e3,h:600,o:[2,110,500,0,2,630,500,0,5,630,350,0,2,390,100,0,5,390,250,0],p:[460,40,270],t:[90,70,40],tr:[50,500,180],tt:[910,500,180]},{w:1040,h:600,o:[2,930,100,0,2,470,100,0,5,470,550,0,2,110,500,0,6,470,300,90],p:[170,550,180],t:[90,60,30],tr:[50,500,180],tt:[990,100,0]},{w:800,h:1100,o:[2,210,900,0,2,100,350,90,5,250,350,0,2,250,100,0,6,700,450,0,6,280,750,0,6,280,1050,0],p:[50,50,0],t:[150,100,60],tr:[740,100,0,320,960,270],tt:[320,850,270,90,1e3,180]},{w:800,h:1160,o:[2,250,100,0,2,250,500,0,2,100,350,90,2,250,860,0,6,700,350,0,6,700,1110,0,5,250,350,0,6,250,1060,90],p:[750,730,90],t:[150,90,60],tr:[30,100,0,70,1060,180],tt:[130,1060,180,700,50,90]},{w:1060,h:600,o:[2,170,100,0,2,170,300,0,2,350,300,0,2,350,500,0,2,530,100,0,2,530,300,0,2,710,300,0,2,710,500,0,2,890,100,0,2,890,300,0],p:[980,50,0],t:[150,90,60],tr:[80,100,0],tt:[980,500,180]},{w:800,h:600,o:[2,170,500,0,2,280,190,90,6,130,100,90,5,210,350,0,6,360,350,0,6,750,300,90],p:[40,50,0],t:[120,90,60],tr:[40,500,180,280,510,270],tt:[280,450,270,280,130,270]},{w:800,h:980,o:[2,500,290,90,2,700,290,90,2,200,490,90,2,400,490,90,2,500,690,90,2,700,690,90,2,100,190,90,5,350,310,0,5,50,490,0,5,550,490,0,5,350,670,0,2,100,790,90,6,100,930,0,6,100,50,0],p:[750,490,90],t:[150,120,90],tr:[700,40,90,700,940,90],tt:[100,840,270,100,140,270]},{w:860,h:960,o:[2,660,470,90,2,490,200,0,2,460,610,90,2,570,580,0,2,150,200,0,5,150,50,0,5,530,50,0,6,810,560,90,5,310,630,0,5,50,630,0,6,400,350,0,5,150,350,0],p:[40,50,0],t:[180,150,100],tr:[380,30,90,760,30,90,380,90,90],tt:[730,580,0,610,580,0,670,580,0]},{w:860,h:640,o:[2,380,190,90,2,560,430,90,2,110,340,0,2,110,540,0,6,180,190,0,6,580,190,0,5,410,430,0,6,760,430,0],p:[50,590,180],t:[150,120,70],tr:[380,110,90],tt:[760,530,90]}],V={c:{A:5,B:[0,,.0135,.32,.16,.33,,,,,,,.5,,,,,,1,,,,,.4]},h:{A:10,B:[3,,.2,.5,.05,.04,,,,,,-.25,.67,,,,,,1,,,,,.5]},w:{A:1,B:[0,,.34,,.49,.49,,,,,,.52,.5,,-1,,-1,,1,-1,,,-1,.5]},f:{A:1,B:[0,,.44,,.2,.37,,-.12,,,,,,.01,,,,,.74,,,.24,,.5]},r:{A:5,B:[0,.06,.4,,.06,.56,,,,,,,,,,,,,.5,,,,-1,.3]},a:{A:5,B:[3,,.18,.17,.64,1,,,,,,,,-1,-1,,,,1,,,,,.4]}},Z={},E="tl t w c p bs bb".split(" ");h.prototype={oa:function(t){if(t.e){var i,s,h,a,e,n,r,o,f,c=1/0;for(i=0;4>i;i++){for(h=2>i?this.ba[i]:t.ba[i-2],e=n=a=this.N[0].za(h),s=1;4>s;s++)(a=this.N[s].za(h))<e?e=a:a>n&&(n=a);for(r=o=a=t.N[0].za(h),s=1;4>s;s++)(a=t.N[s].za(h))<r?r=a:a>o&&(o=a);if(0<(s=e<r?r-n:e-o))return null;(s=Math.abs(s))<c&&(c=s,f=h.A(),0>this.A.A().B(t.A).za(f)&&f.J(-1))}return f.J(c)}},pb:function(t){for(var i=0;i<t.N.length;i++){var s=t.N[i];if(!(f(this.N[0],this.N[1],s)&&f(this.N[1],this.N[2],s)&&f(this.N[2],this.N[3],s)&&f(this.N[3],this.N[0],s)))return!1}return!0},Oa:function(){this.va.aa(Math.cos(this.r),Math.sin(this.r)).J(this.C/2),this.wa.aa(-Math.sin(this.r),Math.cos(this.r)).J(this.F/2),this.N[0]=this.A.A().B(this.va).B(this.wa),this.N[1]=this.A.A().D(this.va).B(this.wa),this.N[2]=this.A.A().D(this.va).D(this.wa),this.N[3]=this.A.A().B(this.va).D(this.wa),this.ba[0]=this.N[1].A().B(this.N[0]),this.ba[0]=this.ba[0].ya(this.ba[0].length()),this.ba[1]=this.N[3].A().B(this.N[0]),this.ba[1]=this.ba[1].ya(this.ba[1].length())},Ea:function(){return this.ua||(this.ua=Math.sqrt(this.C*this.C+this.F*this.F)/2),!(this.A.x+this.ua<-T.x||this.A.x-this.ua>800-T.x||this.A.y+this.ua<-T.y||this.A.y-this.ua>600-T.y)},J:function(t,i){this.A.qb(t),i!==s&&(this.r=i),this.Oa()},S:function(t){this.A.D(t),this.Oa()}};var $={f:[72,0,156,5],l:[40,0,32,32],r:[0,0,40,46],tl:[0,46,20,90],tr:[40,32,20,46],tv:[72,5,26,30]},Q=90*Math.PI/180,_=2*Math.PI,tt=i.performance&&i.performance.now?function(){return i.performance.now()}:function(){return+new Date},it=["055","050","005","000"];y.prototype={save:function(){this.$a=this.x,this.ab=this.y,this.Ha=this.Ga=this.y=this.x=0},restore:function(){this.x=this.$a,this.y=this.ab},kb:function(t,i){this.x=this.C/2-t,this.y=this.F/2-i,this.ka=this.Ha=this.Ga=0},sa:function(){this.ka=3,this.Ba=360*Math.random()},K:function(t,i,s){i=t.x<this.C/2?t.x/this.C:t.x>i-this.C/2?1-(i-t.x)/this.C:.5,s=t.y<this.F/2?t.y/this.F:t.y>s-this.F/2?1-(s-t.y)/this.F:.5,this.x+=(this.C*i+10-t.x-this.x)*Y,this.y+=(this.F*s+10-t.y-this.y)*Y,this.ib(),0<this.ka&&(this.Ba+=45,this.Ga=Math.sin(this.Ba)*this.ka,this.Ha=Math.cos(this.Ba)*this.ka,this.ka-=10*Y)},ib:function(){this.H[0].x=-this.x,this.H[0].y=-this.y,this.H[1].x=-this.x+this.C,this.H[1].y=-this.y,this.H[2].x=-this.x+this.C,this.H[2].y=-this.y+this.F,this.H[3].x=-this.x,this.H[3].y=-this.y+this.F}};var st={u:0,d:0,l:0,r:0,a:0,p:0},ht={37:"l",38:"u",39:"r",40:"d",65:"l",68:"r",83:"d",87:"u",32:"a",27:"p",13:"a"},at=0,et=0,nt=0;r("keydown",(function(t){(t=ht[t.keyCode])&&(st[t]=1)})),r("keyup",(function(t){(t=ht[t.keyCode])&&(st[t]=0)})),r("mousemove",(function(t){at=t.offsetX===s?t.layerX:t.offsetX,et=t.offsetY===s?t.layerY:t.offsetY}),cfg),r("mousedown",(function(){nt=1})),r("mouseup",(function(){nt=0})),r("blur",(function(){for(var t in st)st[t]=0;"p"===j&&J("z")}));var rt=new function(){var t,i,s,h,a,e,n,r,o,f,c,l;this.na=new p,this.Sa=function(){var t=this.na;h=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),e=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,l=5e-5*-t.o),r=1+t.l*t.l*(0<t.l?-.9:10),o=0,f=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.gb=function(){this.Sa();var h=this.na;return t=h.b*h.b*1e5,i=h.c*h.c*1e5,s=h.e*h.e*1e5+12,3*((t+i+s)/3|0)},this.fb=function(u,y){var p=1!=(O=this.na).s||O.v,A=O.v*O.v*.1,w=1+3e-4*O.w,g=O.s*O.s*O.s*.1,d=1+1e-4*O.t,v=1!=O.s,x=O.x*O.x,b=O.g,m=O.q||O.r,M=O.r*O.r*O.r*.2,C=O.q*O.q*(0>O.q?-1020:1020),I=O.p?32+((1-O.p)*(1-O.p)*2e4|0):0,B=O.d,D=O.j/2,F=O.k*O.k*.01,G=O.a,k=t,S=1/t,H=1/i,J=1/s;.8<(O=5/(1+O.u*O.u*20)*(.01+g))&&(O=.8);for(var P,K,R,T,L,O=1-O,N=!1,X=0,Y=0,U=0,j=0,W=0,q=0,z=0,V=0,Z=0,E=0,$=Array(1024),Q=Array(32),_=$.length;_--;)$[_]=0;for(_=Q.length;_--;)Q[_]=2*Math.random()-1;for(_=0;_<y;_++){if(N)return _;if(I&&++Z>=I&&(Z=0,this.Sa()),f&&++o>=f&&(f=0,h*=r),(h*=e+=n)>a&&(h=a,0<b&&(N=!0)),K=h,0<D&&(E+=F,K*=1+Math.sin(E)*D),8>(K|=0)&&(K=8),G||(0>(c+=l)?c=0:.5<c&&(c=.5)),++Y>k)switch(Y=0,++X){case 1:k=i;break;case 2:k=s}switch(X){case 0:U=Y*S;break;case 1:U=1+2*(1-Y*H)*B;break;case 2:U=1-Y*J;break;case 3:U=0,N=!0}m&&(0>(R=0|(C+=M))?R=-R:1023<R&&(R=1023)),p&&w&&(1e-5>(A*=w)?A=1e-5:.1<A&&(A=.1)),L=0;for(var tt=8;tt--;){if(++z>=K&&(z%=K,3==G))for(P=Q.length;P--;)Q[P]=2*Math.random()-1;switch(G){case 0:T=z/K<c?.5:-.5;break;case 1:T=1-z/K*2;break;case 2:T=.225*((0>(T=1.27323954*(T=6.28318531*(.5<(T=z/K)?T-1:T))+.405284735*T*T*(0>T?1:-1))?-1:1)*T*T-T)+T;break;case 3:T=Q[Math.abs(32*z/K|0)]}p&&(P=q,0>(g*=d)?g=0:.1<g&&(g=.1),v?(W+=(T-q)*g,W*=O):(q=T,W=0),j+=(q+=W)-P,T=j*=1-A),m&&($[V%1024]=T,T+=$[(V-R+1024)%1024],V++),L+=T}L=.125*L*U*x,u[_]=1<=L?32767:-1>=L?-32768:32767*L|0}return y}},ot={B:{p:{G:function(t,i,s,h){A(t,i,s,h,100)}},t:{G:function(t,i,s,h,a){A(t,i,s,h,200,a)}}},T:function(t){function i(t,i,s,h,a,e,n){a=a||1,e=(e||this.C)*a,n=(n||this.F)*a,t.save(),t.translate(i,s),h&&t.rotate(h),t.drawImage(this.fa,0,0,this.C,this.F,-e/2,-n/2,e,n),t.restore()}var s,h=this;(s=new Image).onload=function(){for(var a in $){var e=a,r=$[a],o=h.B[e]={fa:n(),G:i},f=2;"f"===e&&(f=1),o.fa.width=o.C=r[2]*f,o.fa.height=o.F=r[3]*f,o.Y=c(o.fa.getContext("2d")),o.Y.drawImage(s,r[0],r[1],r[2],r[3],0,0,r[2]*f,r[3]*f)}t()},s.src="sprites.png"}},ft={B:{},J:0,Ya:function(t){this.J=t,localStorage.setItem("tm",t)},T:{},t:{},Ta:function(t){(t=ft.B[t]).B=t.B+1<t.A?t.B+1:0,t.t[t.B].play()},A:function(t){if(!this.J){var i=ft.B[t];i.t[i.B].pause(),i.t[i.B].currentTime=0,clearTimeout(ft.t[t])}},jb:function(){this.J||Object.keys(ft.t).forEach((function(t){clearTimeout(ft.t[t])}))},p:function(t,i){if(!this.J){i=i||100;var s=tt();ft.T[t]&&s<ft.T[t]+i?(clearTimeout(ft.t[t]),ft.t[t]=setTimeout((function(){ft.T[t]=s,ft.Ta(t)}),i)):(ft.T[t]=s,ft.Ta(t))}}};ft.J=+localStorage.getItem("tm")||0,t.documentMode&&ft.Ya(1),Object.keys(V).forEach((function(t){var i,s,h=V[t];for(ft.B[t]={B:0,A:h.A,t:[]},s=0;s<h.A;s++){var a=i=new Audio;rt.na.na(h.B);var e=rt.gb(),n=new Uint8Array(4*((e+1)/2|0)+44);e=2*rt.fb(new Uint16Array(n.buffer,44),e);(r=new Uint32Array(n.buffer,0,44))[0]=1179011410,r[1]=e+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=e;e=e+44;for(var r=0,o="data:audio/wav;base64,";r<e;r+=3){var f=n[r]<<16|n[r+1]<<8|n[r+2];o=o+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&f])}a.src=o,ft.B[t].t.push(i)}})),w.prototype={C:function(){var t=~~(this.H/60),i=3<(i=(10>(i=Math.abs(this.H-60*t))?"0":"")+i).length?i.substr(0,4):i+".0";this.X=t+":"+i},K:function(){this.H-=Y,0>this.H&&(this.H=0),this.C()}},g.prototype={D:function(t){return this.x+=t.x,this.y+=t.y,this},B:function(t){return this.x-=t.x,this.y-=t.y,this},J:function(t){return this.x*=t,this.y*=t,this},ya:function(t){return this.x/=t,this.y/=t,this},Ma:function(t){var i=t.x-this.x;return t=t.y-this.y,Math.sqrt(i*i+t*t)},qb:function(t){return this.x=t.x,this.y=t.y,this},A:function(){return new g(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},za:function(t){return this.x*t.x+this.y*t.y},r:function(t){var i=this.x;return this.x=i*Math.cos(t)+this.y*Math.sin(t),this.y=-i*Math.sin(t)+this.y*Math.cos(t),this},aa:function(t,i){return this.x=t,this.y=i,this}},a(d,h),e(d.prototype,{B:function(){function t(){a.beginPath(),a.moveTo(0,0),a.lineTo(-i/2,-s/2),a.lineTo(-i/2,s/2),a.lineTo(0,0),a.fill()}var i,s,h=n();h.width=h.height=i=s=100;var a=h.getContext("2d"),e=a.createLinearGradient(-i/2,0,-5,5);return e.addColorStop(0,"#333"),e.addColorStop(1,"#777"),a.fillStyle=e,a.translate(i/2,s/2),a.save(),t(),a.scale(-1,1),t(),a.rotate(Math.PI/2),t(),a.rotate(Math.PI),t(),a.restore(),h}(),Na:function(t){t.save(),t.translate(this.A.x,this.A.y),t.rotate(this.r),t.shadowColor="rgba(0,0,0,.5)",t.shadowOffsetX=t.shadowOffsetY=4,t.fillRect(-this.C/2,-this.F/2,this.C,this.F),t.shadowOffsetX=t.shadowOffsetY=0,t.shadowBlur=100,t.drawImage(this.B,-this.C/2,-this.F/2,this.C,this.F),t.restore()}}),a(v,d),a(x,d),b.prototype={D:function(t){t.G(this.Y)},G:function(){lt.drawImage(this.A,0,0)}},a(m,h),e(m.prototype,{G:function(t){t=t||lt,this.Ea()&&(this.D=!(!this.t||!this.t.t),ot.B.t.G(t,this.A.x,this.A.y,this.r,this.H?"#0d0":this.D?"#d00":0))},K:function(){if(this.D){var t=this.r-this.t.r;this.H=Math.abs(t-_*Math.floor((t+Math.PI)/_))<Q&&this.pb(this.t)}}}),a(M,h),e(M.prototype,{ma:45*Math.PI/180,D:6,xb:4,Fa:1.3,da:50,Bb:140,ca:.95,L:100,K:function(){this.xa=this.Ca=0,st.l&&this.Ca--,st.r&&this.Ca++,st.u&&this.xa++,st.d&&this.xa--,st.a&&(st.a=0,this.M?(ft.p("a"),this.M.P&&this.M.P.H&&(this.M.P.e=!1),this.M.t=this.M=null):this.ha&&this.ha.e&&(ft.p("a"),this.M=this.ha,this.M.t=this)),0<this.Ca?this.O+=Y*this.Fa:0>this.Ca?this.O-=Y*this.Fa:q&&(this.O<-Y?this.O+=Y*this.Fa:this.O>Y&&(this.O-=Y*this.Fa),Math.abs(this.O)<Y&&(this.O=0)),this.O=this.O>this.ma?this.ma:this.O<-this.ma?-this.ma:this.O,0<this.xa?this.$+=Y*this.D:0>this.xa?this.$-=Y*this.xb:Math.abs(this.$)<Y&&(this.$=0),this.$*=this.ca+(this.ma-Math.abs(this.O))/this.ma/100;var t=new g(-Math.sin(this.r),Math.cos(this.r)),i=t.A().J(this.da/2);this.Z.A=this.A.A().B(i).D(t.A().J(this.$)),this.Z.r=this.r,this.ea.A=this.A.A().D(i).D(new g(-Math.sin(this.ea.r),Math.cos(this.ea.r)).J(this.$)),this.ea.r=this.O+this.r,this.J(this.ea.A.A().D(this.Z.A).ya(2),Math.atan2(this.Z.A.y-this.ea.A.y,this.Z.A.x-this.ea.A.x)+Q),this.L.x=this.A.x,this.L.y=this.A.y,this.V.J(this.ea.A,this.r)},G:function(){this.B.G(lt,this.A.x,this.A.y,this.r),0>this.$?ft.p("r",1e3):ft.A("r")},nb:function(t){this.M&&(i=this.V.oa(this.M))&&(.5<i.length()&&(this.L.H--,this.M.L.H--,ft.p("h"),T.sa()),this.V.S(i),this.J(this.V.A.A().D(this.Z.A).ya(2),Math.atan2(this.Z.A.y-this.V.A.y,this.Z.A.x-this.V.A.x)+Q));for(var i,s=0,h=t.length;s<h;s++)t[s].Ea()&&((i=this.oa(t[s]))&&(.5<i.length()&&(this.L.H--,ft.p("h"),T.sa()),this.S(i),this.V.S(i)),this.M&&(i=this.M.oa(t[s]))&&(.5<i.length()&&(this.M.L.H--,ft.p("h"),T.sa()),this.S(i),this.V.S(i),this.M.S(i),this.M.ga.S(i)))},ob:function(t){for(var i=0,s=t.length;i<s;i++){var h,a=t[i];a.Ea()&&a!==this.M&&((h=this.V.oa(a))&&(.5<h.length()&&(this.L.H--,a.L&&a.L.H--,ft.p("h"),T.sa()),this.S(h),this.V.S(h)),(h=this.oa(a.ga))&&(.5<h.length()&&(this.L.H--,a.L&&a.L.H--,ft.p("h"),T.sa()),this.S(h),this.V.S(h)),this.M&&(h=this.M.oa(a))&&(.5<h.length()&&(this.M.L.H--,ft.p("h"),T.sa()),this.S(h),this.V.S(h),this.M.S(h),this.M.ga.S(h)))}},lb:function(t){if(!this.M){this.ha=null;for(var i=0,s=t.length;i<s;i++)if(this.Z.A.Ma(t[i].pa)<t[i].rb)return this.ha=t[i],!0}}}),a(C,h),e(C.prototype,{rb:15,L:50,K:function(){this.t&&(this.pa=this.t.Z.A.A(),this.ga.J(this.A.A().B(new g(-Math.sin(this.r),Math.cos(this.r)).A().J(this.da/2)),this.r),this.J(this.pa.A().D(this.ga.A).ya(2),Math.atan2(this.ga.A.y-this.pa.y,this.ga.A.x-this.pa.x)+Q),this.L.x=this.A.x,this.L.y=this.A.y),this.P&&this.P.K(),this.qa&&(this.qa.t=this.t?this.P:this,this.qa.K())},G:function(){this.Ea()&&(lt.save(),lt.translate(this.A.x,this.A.y),lt.rotate(this.r),lt.drawImage(this.B,-this.C/2,-this.F/2),lt.restore(),this.P&&this.L&&this.L.G(lt)),this.qa&&this.qa.G()}}),a(I,h),e(I.prototype,{Na:function(t){t.save(),t.translate(this.A.x,this.A.y),t.rotate(this.r),t.fillStyle="#644",t.strokeStyle="#755",t.shadowColor="#000",t.shadowOffsetX=t.shadowOffsetY=4,t.fillRect(-this.C/2,-this.F/2,this.C,this.F),t.shadowOffsetX=t.shadowOffsetY=0,t.strokeRect(-this.C/2+3,-this.F/2+3,this.C-6,this.F-6),t.restore()},G:function(){this.sb||this.Na(lt)}}),B.prototype={K:function(){this.e&&(this.D=this.Ua&&this.hb(at,et),!this.D&&!this.ca||this.Xa||ft.p("c"),(this.D&&nt||this.ca&&st.a)&&(nt=0,st.a=0,this.Ua()),this.Xa=this.D||this.ca)},hb:function(t,i){return!(t<this.x-this.C/2||t>this.x+this.C/2||i<this.y-this.F/2||i>this.y+this.F/2)},G:function(){ut.beginPath(),ut.fillStyle="rgba(0,0,0, "+(this.e?this.D||this.ca?.6:.3:.1)+")",ut.fillRect(this.x-this.C/2,this.y-this.F/2,this.C,this.F),this.X.G()}},D.prototype.G=function(t){t.fillStyle="#333",t.fillRect(this.x-this.C/2,this.y-this.F/2,this.C+2,this.F+2),0<this.H&&(t.fillStyle=this.A,t.fillRect(this.x-this.C/2,this.y-this.F/2,this.B*this.H,this.F))},F.prototype={K:function(){var t;this.ia+=10*Y,this.Ka=5*Math.sin(this.ia)-5,this.D=Math.atan2(this.t.A.y-this.A.y,this.t.A.x-this.A.x),(t=u(this.A,this.t.A,T.H[0],T.H[1]))||(t=u(this.A,this.t.A,T.H[1],T.H[2]))||(t=u(this.A,this.t.A,T.H[2],T.H[3]))||(t=u(this.A,this.t.A,T.H[3],T.H[0]))?(this.x=t.x,this.y=t.y):(this.x=this.t.A.x,this.y=this.t.A.y),this.x+=this.Ka*Math.cos(this.D),this.y+=this.Ka*Math.sin(this.D)},G:function(){lt.save(),lt.translate(this.x,this.y),lt.rotate(this.D),lt.beginPath(),lt.moveTo(0,0),lt.lineTo(-20,-8),lt.lineTo(-20,8),lt.lineTo(0,0),lt.fillStyle="#f00",lt.strokeStyle="#333",lt.fill(),lt.stroke(),lt.restore()}},G.prototype={aa:function(t,i){i=i||this.mb,this.X=String(t).toLowerCase().split(""),this.La=o(i||"fff"),this.A.width=4*this.X.length-1,this.A.height=this.ta.F;var s,h,a=this.A.getContext("2d");for(a.clearRect(0,0,this.A.width,this.A.height),s=0,h=this.X.length;s<h;s++){-1<(e="abcdefghijklmnopqrstuvwxyz1234567890!?\".,'$()-:;=[]/".indexOf(this.X[s]))&&a.drawImage(this.ta.fa,3*e,0,3,this.ta.F,4*s,0,3,this.ta.F)}var e,n=(e=a.getImageData(0,0,this.A.width,this.ta.F)).data;for(s=0,h=n.length;s<h;s+=4)n[s]=this.La.r,n[s+1]=this.La.Da,n[s+2]=this.La.R;a.putImageData(e,0,0),this.C=this.A.width*this.B,this.F=this.ta.F*this.B},G:function(){ut.drawImage(this.A,this.x-this.C/2,this.y-this.F/2,this.C,this.F)}},k.prototype={K:function(){var t=this.R.length;st.u&&(st.u=0,this.D--),st.d&&(st.d=0,this.D++),this.D=0>this.D?t-1:this.D>t-1?0:this.D;for(var i=0;i<t;i++)this.R[i].ca=i===this.D,this.R[i].K()},G:function(){for(var t=0,i=this.R.length;t<i;this.R[t++].G());}},S.prototype={C:20,G:function(){for(var t=-1;2>t;t++)ut.fillStyle=this.B-1>t?"#ff0":"rgba(0,0,0,.1)",ut.fillRect(this.x-this.C/2+(this.C+5)*t,this.y-this.C/2,this.C,this.C)}},H.prototype={K:function(){var t=this.t.O/this.t.ma*Q;this.ia=this.Wa.A().r(-t)},G:function(){ut.beginPath(),ut.arc(this.x,this.y,this.r,Math.PI,0),ut.lineWidth=8,ut.strokeStyle="#333",ut.stroke(),ut.beginPath(),ut.arc(this.x+this.ia.x,this.y+this.ia.y,12,0,_),ut.fillStyle="#f60",ut.fill(),ut.beginPath(),ut.arc(this.x,this.y-30,12,0,_),ut.fillStyle=this.Za?"#0c0":"#333",ut.fill(),this.X.G()}},Z.c={ra:function(){T.save(),this.I=[new B(400,555,"close",(function(){J("m")}),110),new G(400,50,"captain reverso",10),new G(400,100,"and the missing truckers",4,"0cd"),new G(400,132,"js13kGames 2015 entry",3),new G(400,240,"created by",4),new G(400,280,"Greg Pabian",6),new G(400,320,"pixelchinchilla.com",4),new G(400,350,"twitter: gregpabian",4),new G(400,380,"github: gregpabian",4)],this.I[0].ca=!0},K:function(){for(var t=0;t<this.I.length;t++)this.I[t].K&&this.I[t].K()},G:function(){lt.fillStyle=L,lt.fillRect(0,0,800,600),l(lt,800,600);for(var t=0;t<this.I.length;t++)this.I[t].G()}};var ct=!1;Z.m={ra:function(){T.save(),ct||(this.T=ot.B.l,this.ub=new G(400,390,"pixel chinchilla",4),this.vb=new G(400,414,"presents",2),this.Aa=0),this.I=[new G(400,50,"captain reverso",10),new G(400,100,"and the missing truckers",4,"0cd"),new k(400,300,{start:function(){J("st")},credits:function(){J("c")}}),O,N,new G(160,570,"controls: wasd/arrows - space - esc",2)]},K:function(){if(ct)for(var t=0;t<this.I.length;t++)this.I[t].K&&this.I[t].K();else this.Aa+=Y,1<this.Aa&&!this.B&&(ft.p("w"),this.B=1),3<this.Aa&&(ct=1)},G:function(){if(ct){lt.fillStyle=L,lt.fillRect(0,0,800,600),l(lt,800,600);for(var t=0;t<this.I.length;t++)this.I[t].G()}else lt.fillStyle="#000",lt.fillRect(0,0,800,600),this.T.G(lt,400,300,0,2),this.ub.G(lt),1<this.Aa&&this.vb.G(lt)}},Z.z={ra:function(t,i){T.save();var s,h={},a=0;this.I=[],!0===t?(a=30,h.continue=function(){++U===z.length?J("st",!0):J("p")},s="level complete",this.I.push(new G(400,120,"your score:",4),new S(400,160,i))):!1===t?(ft.p("f"),s="level failed",this.I.push(new G(400,120,i,4))):(s="paused",h.resume=function(){J("p",!0)}),h.restart=function(){J("p")},h["change level"]=function(){J("s")},h["main menu"]=function(){J("m")},this.J=new k(400,300+a,h),this.I.push(new G(400,50,s,10),this.J,O,N)},K:function(){for(var t=0;t<this.I.length;t++)this.I[t].K&&this.I[t].K()},G:function(){lt.fillStyle=L,lt.fillRect(0,0,800,600),l(lt,800,600);for(var t=0;t<this.I.length;t++)this.I[t].G()}},Z.p={yb:[["welcome to the tutorial!",3,200,130],["your goal is to park each trailer in its place...",4],["...without destroying it!",3],["drive your truck and reverse it to attach the trailer",4,230,370,1],["notice the trailer indicator turns green...",4,400,480],["...once your truck is properly positioned",4,0,0,2],["press [space] to attach the trailer",3,0,0,3],["reverse the trailer to the highlighted parking spot",4,580,180,4],["notice the parking spot turns green...",4],["...once the trailer is properly parked",4,0,0,5],["now press the [space] to detach the trailer",4,0,0,6]],ra:function(t){if(t)T.restore();else{U||(this.Qa=4,this.zb=[].concat(this.yb),this.Ia=new G(0,0," "),this.U=null,this.la=0),this.Pa=new H(400,580),this.I=[this.Pa],t=z[U],this.n=t.n,this.C=t.w,this.F=t.h,this.R=t.t[0],this.B=t.t[1],this.Da=t.t[2],this.p=new M(t.p[0],t.p[1],t.p[2]*Math.PI/180),this.Pa.t=this.p,this.J=new b(this.C,this.F),ot.B.p.G(this.J.Y,this.p.A.x,this.p.A.y,this.p.r),this.ja=[],this.W=[],this.P=[],(this.Ra=(this.t=this.R?new w(this.R):null)?new G(400,30,this.t.X,4):null)&&this.I.push(this.Ra);var i,s,h=[];for(i=0,s=t.o.length;i<s;i+=4){var a=pt[E[t.o[i]]];if(a){var e=new a(t.o[i+1],t.o[i+2],t.o[i+3]*Math.PI/180);a===C?h.push(e):(this.ja.push(e),e.Na(this.J.Y),e.sb=!0)}}for(i=0,s=t.tr.length;i<s;i+=3)a=new C(t.tr[i],t.tr[i+1],t.tr[i+2]*Math.PI/180),ot.B.t.G(this.J.Y,a.A.x,a.A.y,a.r),a.qa=new F(this.p,a),this.P.push(new m(t.tt[i],t.tt[i+1],t.tt[i+2]*Math.PI/180,a)),this.W.push(a);this.W=this.W.concat(h),this.ja=this.ja.concat(this.J.Ab),T.kb(this.C/2,this.F/2)}},K:function(){if(st.p)return st.p=0,J("z");var t,i;for(!U&&(this.la&&0<this.la&&(this.la-=Y),!this.U||0>this.la&&(!this.U[4]||1===this.U[4]&&180>this.p.A.Ma(this.W[0].A)||2===this.U[4]&&this.p.ha||3===this.U[4]&&this.p.M||4===this.U[4]&&this.p.M&&100>this.p.M.A.Ma(this.P[0].A)||5===this.U[4]&&this.P[0].H))&&(this.Qa&&this.Qa--,this.U=this.zb.shift(),this.Ia.aa(this.U[0]),this.U[1]?this.la=this.U[1]:this.la=null,this.U[2]&&(this.Ia.x=this.U[2],this.Ia.y=this.U[3])),T.K(this.p.A,this.C,this.F),this.t&&(this.t.K(),this.Ra.aa(this.t.X)),!U&&this.Qa||this.p.K(),this.p.nb(this.ja),this.p.ob(this.W),this.p.lb(this.W),this.Pa.Za=this.p.ha,t=0,i=this.W.length;t<i;t++)this.W[t].K();for(t=0,i=this.P.length;t<i;t++){var s=this.P[t];s.e||(ft.p("w"),this.P.splice(t,1),s.H=!1,s.D=!1,s.t.qa=!1,s.t.L=!1,this.J.D(s),i--,t--)}if(!this.P.length)return t=this.t?this.R-this.t.H<=this.Da?3:this.R-this.t.H<=this.B?2:1:3,(!K[U]||K[U]<t)&&(K[U]=t,localStorage.setItem("ts",K.join(""))),J("z",!0,t);if(this.t&&0>=this.t.H)return J("z",!1,"you run out of time :(");if(0>=this.p.L.H)return J("z",!1,"you destroyed your truck :(");for(t=0,i=this.W.length;t<i;t++)if(0>=this.W[t].L.H)return J("z",!1,"you destroyed the load :(");for(t=0;t<this.I.length;t++)this.I[t].K&&this.I[t].K()},G:function(){var t,i;for(this.J.G(),t=0,i=this.P.length;t<i;t++)this.P[t].G();for(this.p.G(),t=0,i=this.W.length;t<i;t++)this.W[t].G();for(this.p.L.G(lt),t=0,i=this.ja.length;t<i;t++)this.ja[t].G&&this.ja[t].G();for(U||this.Ia.G(),t=0,i=this.I.length;t<i;t++)this.I[t].G()}},Z.s={ra:function(){function t(t){return function(){U=t,J("p")}}T.save(),this.A=[],this.D=U,this.n=new G(400,500," ",4),this.I=[this.n,X];for(var i=0;i<z.length;i++){var s=160+160*(i-4*~~(i/4)),h=120+120*~~(i/4);this.A.push(new B(s,h,i||"t",t(i),70,70,0<i?!!K[i-1]:1,6)),this.I.push(new S(s,h+60,K[i]))}this.A.push(new B(400,555,"back",(function(){J("m")}),100)),this.I=this.I.concat(this.A)},K:function(){for(var t=this.A.length,i=0,s=0;s<t;s++)this.A[s].ca=this.D===s,this.A[s].K&&this.A[s].K();for(st.d&&(st.d=0,i=4),st.u&&(st.u=0,i=-4),st.l&&(st.l=0,i=-1),st.r&&(st.r=0,i=1),this.D+=i,this.D=0>this.D?0:this.D>t-1?t-1:this.D;!this.A[this.D].e;)this.D+=0<i?1:-1;this.n.aa(this.D===this.A.length-1?" ":this.D?"level "+this.D:"tutorial"),X.K()},G:function(){lt.fillStyle=L,lt.fillRect(0,0,800,600),l(lt,800,600);for(var t=0;t<this.I.length;t++)this.I[t].G()}},Z.st={tb:[[0,"breaking news!!!"],[2,"a mysterious disappearence of all truckers..."],[5,"...paralyzed the transport!"],[7,"total chaos reigned over the city!"],[10,"will someone stop this madness???"],[13,"that's something for captain reverso!",1],[16,"time to move, i've got a city to save!",1],[19," ",1]],wb:[[0,"...in other news:"],[2,"missing truckers we're all found..."],[5,"...locked down in an abandoned trailer"],[8,"the transport situation is now back to normal"],[11,"thanks to a mysterious hero..."],[14,"...we can all sleep peacefully again!"],[17,"damn right you can!",1],[21," ",1]],Va:function(){J(this.d?"c":"s")},ra:function(t){T.save(),this.d=t,this.cb=new G(220,90," ",2),this.eb=new G(600,190," ",2),this.I=[new B(400,555,"skip",this.Va.bind(this),100),this.cb,this.eb],this.T=this.d?this.wb:this.tb,this.t=0,this.A=ot.B.r,this.Ja=ot.B.tv,this.I[0].ca=!0},K:function(){var t,i;for(this.t+=Y,t=0;t<this.T.length;t++)this.t>=this.T[t][0]&&(i=this.T[t]);if(i&&(this.cb.aa(i[2]?i[1]:" "),this.eb.aa(i[2]?" ":i[1])),this.t>this.T[this.T.length-1][0]||st.p)return st.p=0,this.Va();for(t=0;t<this.I.length;t++)this.I[t].K&&this.I[t].K()},G:function(){lt.fillStyle=L,lt.fillRect(0,0,800,600),lt.fillStyle="#543",lt.fillRect(0,300,800,300),lt.fillStyle="#987",lt.fillRect(0,300,800,20),lt.drawImage(this.A.fa,50,300-2*this.A.F,3*this.A.C,3*this.A.F),lt.drawImage(this.Ja.fa,600,300-1.5*this.Ja.F,3*this.Ja.C,3*this.Ja.F),l(lt,800,600);for(var t=0;t<this.I.length;t++)this.I[t].G()}},cm.width=cfg.width=800,cm.height=cfg.height=600;var lt=c(cm.getContext("2d")),ut=c(cfg.getContext("2d")),yt=0;wrap.style.cssText="width:800px;height:600px;margin:-300px 0 0 -400px;";var pt={bs:v,bb:x,tl:C,w:I};ot.T((function(){R=tt(),T=new y(800,600);var t=localStorage.getItem("ts"),i=Array.apply(null,Array(z.length)).map(Number.prototype.valueOf,0);K=t?t.split("").map(Number):[].concat(i),(L=lt.createLinearGradient(0,0,0,600)).addColorStop(0,"#024"),L.addColorStop(1,"#078"),O=new B(730,560,"sound:"+(ft.J?"off":"on"),(function(){ft.Ya(ft.J?0:1),O.X.aa("sound:"+(ft.J?"off":"on"))}),100,40,1,2),X=new B(730,560,"reset",(function(){K=[].concat(i),localStorage.setItem("ts",K.join("")),J("s")}),100,40,1,2),N=new B(600,560,"auto center:"+(q?"on":"off"),(function(){q=q?0:1,localStorage.setItem("tc",q),N.X.aa("auto center:"+(q?"on":"off"))}),140,40,1,2),J("m"),P()}))}(document,this)</script>