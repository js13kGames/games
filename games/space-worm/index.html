<!doctype html><meta name=viewport content="width=device-width"><title>Space Worm - js13kGames 2021</title><style>html{background:#000}body,html{position:fixed}body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none!important;margin:0;overflow:hidden}canvas{background:linear-gradient(45deg,#1d2951 0 20%,#003b59);margin:0;padding:0;border:none}</style><canvas class=myCanvas><p>Canvas support required.</canvas><script>const spaceWorm_canvas=document.querySelector(".myCanvas"),spaceWorm_ctx=spaceWorm_canvas.getContext("2d");let spaceWorm_scale=window.devicePixelRatio;const spaceWorm_AudioContext=window.AudioContext||window.webkitAudioContext,spaceWorm_audioCtx=new spaceWorm_AudioContext,spaceWorm_volumeGain=spaceWorm_audioCtx.createGain();spaceWorm_volumeGain.connect(spaceWorm_audioCtx.destination),spaceWorm_volumeGain.gain.value=.1;let spaceWorm_bgNotes=[110,130.81,146.83,164.81,196,220],spaceWorm_cNotes=[440,493.88,523.25,587.33,622.25,659.25,698.46,783.99,880],spaceWorm_nativeWidth=64,spaceWorm_nativeHeight=64,spaceWorm_deviceWidth=window.innerWidth,spaceWorm_deviceHeight=window.innerHeight,spaceWorm_scaleFitNative=Math.min(spaceWorm_deviceWidth/spaceWorm_nativeWidth,spaceWorm_deviceHeight/spaceWorm_nativeHeight),spaceWorm_mouseDown=!1,spaceWorm_mouseMove=!1,spaceWorm_state="start",spaceWorm_drawJoy=!1,spaceWorm_joyAngle=0,spaceWorm_joyDistance=0,spaceWorm_vx=0,spaceWorm_vy=0,spaceWorm_worldX=0,spaceWorm_worldY=0,spaceWorm_oldWorldX=0,spaceWorm_oldWorldY=0,spaceWorm_friction=.99,spaceWorm_maxspeed=20,spaceWorm_background=[],spaceWorm_stars=[],spaceWorm_enemies=[],spaceWorm_tailComponent=[],spaceWorm_levelObstacles=[],spaceWorm_walls=[],spaceWorm_killerWalls=[],spaceWorm_worldBoundsX=0,spaceWorm_worldBoundsY=0,spaceWorm_worldBoundsWidth=0,spaceWorm_worldBoundsHeight=0,spaceWorm_commonUnit=0,spaceWorm_score=0,spaceWorm_starsRemaining=0,spaceWorm_player=new spaceWorm_playerComponent,spaceWorm_level=1;function spaceWorm_displayWindowSize(){spaceWorm_deviceWidth=window.innerWidth,spaceWorm_deviceHeight=window.innerHeight,spaceWorm_scale=window.devicePixelRatio,spaceWorm_scaleFitNative=Math.min(spaceWorm_deviceWidth/spaceWorm_nativeWidth,spaceWorm_deviceHeight/spaceWorm_nativeHeight),spaceWorm_canvas.style.width=spaceWorm_deviceWidth+"px",spaceWorm_canvas.style.height=spaceWorm_deviceHeight+"px",spaceWorm_canvas.width=spaceWorm_deviceWidth*spaceWorm_scale,spaceWorm_canvas.height=spaceWorm_deviceHeight*spaceWorm_scale,spaceWorm_commonUnit=spaceWorm_canvas.width>spaceWorm_canvas.height?spaceWorm_canvas.width:spaceWorm_canvas.height,spaceWorm_ctx.setTransform(spaceWorm_scaleFitNative*spaceWorm_scale,0,0,spaceWorm_scaleFitNative*spaceWorm_scale,Math.floor(spaceWorm_deviceWidth/2)*spaceWorm_scale,Math.floor(spaceWorm_deviceHeight/2)*spaceWorm_scale),spaceWorm_createBg()}function spaceWorm_joyStart(){"levelstart"===spaceWorm_state&&(spaceWorm_score=0,spaceWorm_worldX=0,spaceWorm_worldY=0,spaceWorm_levels(),spaceWorm_createBg(),spaceWorm_vx=0,spaceWorm_vy=0,spaceWorm_joyDistance=0,spaceWorm_state="game"),"game"===spaceWorm_state&&(spaceWorm_joyEndX=spaceWorm_joyStartX,spaceWorm_joyEndY=spaceWorm_joyStartY,spaceWorm_mouseMove=!1,spaceWorm_mouseDown=!0,spaceWorm_drawJoy=!0),"gameover"===spaceWorm_state&&(spaceWorm_state="start"),"win"===spaceWorm_state&&(spaceWorm_state="levelstart"),"start"===spaceWorm_state&&(spaceWorm_playerlayNote(0,0,0,0,0),spaceWorm_state="levelstart")}function spaceWorm_joyMove(){if(spaceWorm_mouseMove=!0,!0===spaceWorm_mouseDown){let e=spaceWorm_joyEndX-spaceWorm_joyStartX,s=spaceWorm_joyEndY-spaceWorm_joyStartY;spaceWorm_joyAngle=Math.atan2(s,e),spaceWorm_joyDistance=Math.sqrt((spaceWorm_joyStartX-spaceWorm_joyEndX)*(spaceWorm_joyStartX-spaceWorm_joyEndX)+(spaceWorm_joyStartY-spaceWorm_joyEndY)*(spaceWorm_joyStartY-spaceWorm_joyEndY)),spaceWorm_joyDistance/=3,spaceWorm_joyDistance>spaceWorm_maxspeed&&(spaceWorm_joyDistance=spaceWorm_maxspeed)}}function spaceWorm_joyEnd(){spaceWorm_mouseDown=!1,spaceWorm_mouseMove=!1,spaceWorm_drawJoy=!1}function spaceWorm_drawJoystick(){spaceWorm_ctx.globalAlpha=.5,spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc((spaceWorm_joyStartX-spaceWorm_deviceWidth/2)/spaceWorm_scaleFitNative,(spaceWorm_joyStartY-spaceWorm_deviceHeight/2)/spaceWorm_scaleFitNative,4,0,2*Math.PI),spaceWorm_ctx.fill(),spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc((spaceWorm_joyEndX-spaceWorm_deviceWidth/2)/spaceWorm_scaleFitNative,(spaceWorm_joyEndY-spaceWorm_deviceHeight/2)/spaceWorm_scaleFitNative,2,0,2*Math.PI),spaceWorm_ctx.fill(),spaceWorm_ctx.globalAlpha=1}function spaceWorm_playerComponent(){this.width=1,this.speed=1,this.x=0,this.y=0,this.update=function(){spaceWorm_levelObstacles.forEach((e=>{e.collision()})),spaceWorm_ctx.fillStyle="black",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc(0,0,this.width,0,2*Math.PI),spaceWorm_ctx.fill(),spaceWorm_tailComponent.push(new spaceWorm_tail(spaceWorm_player.x-spaceWorm_worldX,spaceWorm_player.y-spaceWorm_worldY)),spaceWorm_tailComponent.forEach((e=>{e.update()})),spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc(this.x+Math.cos(spaceWorm_joyAngle)*(this.width/2*spaceWorm_joyDistance/16),this.y+Math.sin(spaceWorm_joyAngle)*(this.width/2*spaceWorm_joyDistance/16),this.width/4,0,2*Math.PI),spaceWorm_ctx.fill()}}function spaceWorm_tail(e,s){this.width=spaceWorm_player.width,this.x=e,this.y=s,this.maxLife=100,this.life=0,this.update=function(){spaceWorm_ctx.fillStyle="black",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc(spaceWorm_worldX+this.x,spaceWorm_worldY+this.y,this.width,0,2*Math.PI),spaceWorm_ctx.fill(),this.life++,this.life>=this.maxLife&&spaceWorm_tailComponent.shift(),this.width=this.width-spaceWorm_player.width/this.maxLife}}function spaceWorm_killerCircle(e,s,o,a,r){this.width=e,this.x=s,this.y=o,this.dx=a,this.dy=r,this.isplaying=!1,this.update=function(){this.x<spaceWorm_worldBoundsX+2&&(this.dx=-this.dx),this.x>spaceWorm_worldBoundsX+spaceWorm_worldBoundsWidth-2&&(this.dx=-this.dx),this.y<spaceWorm_worldBoundsY+2&&(this.dy=-this.dy),this.y>spaceWorm_worldBoundsY+spaceWorm_worldBoundsHeight-2&&(this.dy=-this.dy),spaceWorm_levelObstacles.forEach((e=>{spaceWorm_rectangleCollisionVsOther(e,this);let s=spaceWorm_rectangleCollisionVsOther(e,this);"top"!==s&&"bottom"!==s||(this.dy=-this.dy),"right"!==s&&"left"!==s||(this.dx=-this.dx)})),this.x=this.x+this.dx,this.y=this.y+this.dy,spaceWorm_ctx.fillStyle="firebrick",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc(spaceWorm_worldX+this.x,spaceWorm_worldY+this.y,this.width,0,2*Math.PI),spaceWorm_ctx.fill(),spaceWorm_circleCollision(this,spaceWorm_player)?(spaceWorm_state="gameover",!1===this.isplaying&&(this.isplaying=!0)):this.isplaying=!1}}function spaceWorm_star(e,s,o){this.width=e,this.x=s,this.y=o,this.isplaying=!1,this.note=spaceWorm_cNotes[Math.floor(Math.random()*spaceWorm_cNotes.length)],this.update=function(){var e=Math.PI/2*3;this.cx=spaceWorm_worldX+this.x,this.cy=spaceWorm_worldY+this.y;var a=Math.PI/5;for(spaceWorm_ctx.beginPath(),spaceWorm_ctx.moveTo(this.cx,this.cy-this.width),i=0;i<5;i++)s=this.cx+Math.cos(e)*this.width,o=this.cy+Math.sin(e)*this.width,spaceWorm_ctx.lineTo(s,o),e+=a,s=this.cx+Math.cos(e)*this.width/2,o=this.cy+Math.sin(e)*this.width/2,spaceWorm_ctx.lineTo(s,o),e+=a;spaceWorm_ctx.lineTo(this.cx,this.cy-this.width),spaceWorm_ctx.closePath(),spaceWorm_ctx.fillStyle="gold",spaceWorm_ctx.fill(),spaceWorm_levelObstacles.forEach((e=>{spaceWorm_rectangleCollisionVsOther(e,this);let s=spaceWorm_rectangleCollisionVsOther(e,this);"top"!==s&&"right"!==s&&"bottom"!==s&&"left"!==s||(spaceWorm_score++,delete this.x)})),spaceWorm_circleCollision(this,spaceWorm_player)?(spaceWorm_score++,delete this.x,!1===this.isplaying&&(spaceWorm_playerlayNote(this.note,.01,.5,.25,.5),440===this.note||587.33===this.note||659.25===this.note||880===this.note?(setTimeout((()=>{spaceWorm_playerlayNote(1.19*this.note,.02,.5,.25,.5)}),150),setTimeout((()=>{spaceWorm_playerlayNote(1.5*this.note,.01,.5,.25,.5)}),300),setTimeout((()=>{spaceWorm_playerlayNote(2*this.note,.01,.5,.25,.5)}),450)):493.88===this.note?(setTimeout((()=>{spaceWorm_playerlayNote(1.19*this.note,.02,.5,.25,.5)}),150),setTimeout((()=>{spaceWorm_playerlayNote(1.414*this.note,.01,.5,.25,.5)}),300),setTimeout((()=>{spaceWorm_playerlayNote(2*this.note,.01,.5,.25,.5)}),450)):(setTimeout((()=>{spaceWorm_playerlayNote(1.25*this.note,.02,.5,.25,.5)}),150),setTimeout((()=>{spaceWorm_playerlayNote(1.5*this.note,.01,.5,.25,.5)}),300),setTimeout((()=>{spaceWorm_playerlayNote(2*this.note,.01,.5,.25,.5)}),450)),this.isplaying=!0)):this.isplaying=!1}}function spaceWorm_bgStar(e,s,o){this.width=e,this.x=s,this.y=o,this.dx=.02*Math.random()-.01,this.dy=.02*Math.random()-.01,this.isplaying=!1,this.note=spaceWorm_bgNotes[Math.floor(Math.random()*spaceWorm_bgNotes.length)],this.update=function(){this.x>-spaceWorm_worldX+spaceWorm_canvas.width/spaceWorm_scaleFitNative/2&&(this.x=-spaceWorm_worldX-spaceWorm_canvas.width/spaceWorm_scaleFitNative/2),this.x<-spaceWorm_worldX-spaceWorm_canvas.width/spaceWorm_scaleFitNative/2&&(this.x=-spaceWorm_worldX+spaceWorm_canvas.width/spaceWorm_scaleFitNative/2),this.y>-spaceWorm_worldY+spaceWorm_canvas.height/spaceWorm_scaleFitNative/2&&(this.y=-spaceWorm_worldY-spaceWorm_canvas.height/spaceWorm_scaleFitNative/2),this.y<-spaceWorm_worldY-spaceWorm_canvas.height/spaceWorm_scaleFitNative/2&&(this.y=-spaceWorm_worldY+spaceWorm_canvas.height/spaceWorm_scaleFitNative/2),this.x=this.x+this.dx,this.y=this.y+this.dy,spaceWorm_ctx.globalAlpha=.2,spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.beginPath(),spaceWorm_ctx.arc(spaceWorm_worldX+this.x,spaceWorm_worldY+this.y,this.width,0,2*Math.PI),spaceWorm_ctx.fill(),spaceWorm_ctx.globalAlpha=1,spaceWorm_circleCollision(this,spaceWorm_player)?!1===this.isplaying&&(spaceWorm_playerlayNote(this.note,1,.5,1,2),this.isplaying=!0):this.isplaying=!1}}function spaceWorm_rectangle(e,s,o,a){this.width=e,this.height=s,this.x=o,this.y=a,this.update=function(){spaceWorm_ctx.fillStyle="black",spaceWorm_ctx.fillRect(this.x+spaceWorm_worldX,this.y+spaceWorm_worldY,this.width,this.height)},this.collision=function(){spaceWorm_rectangleCollisionVsPlayer(this,spaceWorm_player);let e=spaceWorm_rectangleCollisionVsPlayer(this,spaceWorm_player);"top"===e&&(spaceWorm_oldWorldY>spaceWorm_worldY&&(spaceWorm_oldWorldY=spaceWorm_worldY),spaceWorm_worldY=spaceWorm_oldWorldY),"right"===e&&(spaceWorm_oldWorldX<spaceWorm_worldX&&(spaceWorm_oldWorldX=spaceWorm_worldX),spaceWorm_worldX=spaceWorm_oldWorldX),"bottom"===e&&(spaceWorm_oldWorldY<spaceWorm_worldY&&(spaceWorm_oldWorldY=spaceWorm_worldY),spaceWorm_worldY=spaceWorm_oldWorldY),"left"===e&&(spaceWorm_oldWorldX>spaceWorm_worldX&&(spaceWorm_oldWorldX=spaceWorm_worldX),spaceWorm_worldX=spaceWorm_oldWorldX)}}function spaceWorm_killerRectangle(e,s,o,a){this.width=e,this.height=s,this.x=o,this.y=a,this.update=function(){spaceWorm_ctx.fillStyle="firebrick",spaceWorm_ctx.fillRect(this.x+spaceWorm_worldX,this.y+spaceWorm_worldY,this.width,this.height)},this.collision=function(){spaceWorm_rectangleCollisionVsPlayer(this,spaceWorm_player);let e=spaceWorm_rectangleCollisionVsPlayer(this,spaceWorm_player);"top"!==e&&"right"!==e&&"bottom"!==e&&"left"!==e||(spaceWorm_state="gameover")}}function spaceWorm_levels(){if(spaceWorm_tailComponent=[],spaceWorm_levelObstacles=[],spaceWorm_enemies=[],spaceWorm_stars=[],1===spaceWorm_level){spaceWorm_worldBoundsX=-48,spaceWorm_worldBoundsY=-48,spaceWorm_worldBoundsWidth=96,spaceWorm_worldBoundsHeight=96,spaceWorm_levelObstacles=[],spaceWorm_walls=[],spaceWorm_killerWalls=[],spaceWorm_enemies=[],spaceWorm_stars=[];let e=3,s=3;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+16,r=32*e+spaceWorm_worldBoundsX+16;0===a&&0===r&&(a=spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}}if(2===spaceWorm_level){spaceWorm_worldBoundsX=-80,spaceWorm_worldBoundsY=-80,spaceWorm_worldBoundsWidth=160,spaceWorm_worldBoundsHeight=160,spaceWorm_levelObstacles=[],spaceWorm_killerWalls=[],spaceWorm_enemies=[],spaceWorm_walls=[],spaceWorm_walls=[{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}];for(let e=0;e<spaceWorm_walls.length;e++){let s=16*spaceWorm_walls[e].w,o=16*spaceWorm_walls[e].h,a=16*spaceWorm_walls[e].x-spaceWorm_worldBoundsWidth/2,r=16*spaceWorm_walls[e].y-spaceWorm_worldBoundsHeight/2;spaceWorm_levelObstacles.push(new spaceWorm_rectangle(s,o,a,r))}spaceWorm_stars=[];let e=5,s=5;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+16,r=32*e+spaceWorm_worldBoundsX+16;0===a&&0===r&&(a=spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}}if(3===spaceWorm_level){spaceWorm_worldBoundsX=-64,spaceWorm_worldBoundsY=-64,spaceWorm_worldBoundsWidth=128,spaceWorm_worldBoundsHeight=128,spaceWorm_levelObstacles=[],spaceWorm_walls=[],spaceWorm_killerWalls=[],spaceWorm_enemies=[],spaceWorm_enemies.push(new spaceWorm_killerCircle(2,32,0,0,.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,-32,0,0,-.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,0,32,-.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,0,-32,.5,0)),spaceWorm_stars=[];let e=4,s=4;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+16,r=32*e+spaceWorm_worldBoundsX+16;0===a&&0===r&&(a=spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}}if(4===spaceWorm_level){spaceWorm_worldBoundsX=-72,spaceWorm_worldBoundsY=-72,spaceWorm_worldBoundsWidth=144,spaceWorm_worldBoundsHeight=144,spaceWorm_walls=[],spaceWorm_walls=[{x:0,y:0,w:2,h:2},{x:7,y:0,w:2,h:2},{x:0,y:7,w:2,h:2},{x:7,y:7,w:2,h:2}];for(let e=0;e<spaceWorm_walls.length;e++){let s=16*spaceWorm_walls[e].w,o=16*spaceWorm_walls[e].h,a=16*spaceWorm_walls[e].x-spaceWorm_worldBoundsWidth/2,r=16*spaceWorm_walls[e].y-spaceWorm_worldBoundsHeight/2;spaceWorm_levelObstacles.push(new spaceWorm_rectangle(s,o,a,r))}spaceWorm_killerWalls=[],spaceWorm_killerWalls=[{x:3,y:1,w:3,h:1},{x:1,y:3,w:1,h:3},{x:3,y:7,w:3,h:1},{x:7,y:3,w:1,h:3}];for(let e=0;e<spaceWorm_killerWalls.length;e++){let s=16*spaceWorm_killerWalls[e].w,o=16*spaceWorm_killerWalls[e].h,a=16*spaceWorm_killerWalls[e].x-spaceWorm_worldBoundsWidth/2,r=16*spaceWorm_killerWalls[e].y-spaceWorm_worldBoundsHeight/2;spaceWorm_levelObstacles.push(new spaceWorm_killerRectangle(s,o,a,r))}spaceWorm_stars=[];let e=5,s=5;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+8,r=32*e+spaceWorm_worldBoundsX+8;0===a&&0===r&&(a=spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}}if(5===spaceWorm_level){spaceWorm_worldBoundsX=-24,spaceWorm_worldBoundsY=-40,spaceWorm_worldBoundsWidth=464,spaceWorm_worldBoundsHeight=80,spaceWorm_levelObstacles=[],spaceWorm_walls=[],spaceWorm_walls=[{x:0,y:0,w:3,h:1},{x:0,y:4,w:3,h:1},{x:3,y:0,w:3,h:2},{x:3,y:3,w:3,h:2},{x:14,y:0,w:1,h:1},{x:14,y:4,w:1,h:1},{x:15,y:0,w:1,h:2},{x:15,y:3,w:1,h:2},{x:21,y:0,w:1,h:2},{x:21,y:3,w:1,h:2},{x:22,y:0,w:7,h:1},{x:22,y:4,w:7,h:1},{x:23,y:0,w:1,h:2},{x:25,y:3,w:1,h:2},{x:27,y:0,w:1,h:2}];for(let e=0;e<spaceWorm_walls.length;e++){let s=16*spaceWorm_walls[e].w,o=16*spaceWorm_walls[e].h,a=16*spaceWorm_walls[e].x+spaceWorm_worldBoundsX,r=16*spaceWorm_walls[e].y+spaceWorm_worldBoundsY;spaceWorm_levelObstacles.push(new spaceWorm_rectangle(s,o,a,r))}spaceWorm_killerWalls=[],spaceWorm_killerWalls=[{x:11,y:0,w:3,h:2},{x:11,y:3,w:3,h:2},{x:18,y:2,w:1,h:1},{x:23,y:2,w:1,h:1},{x:25,y:2,w:1,h:1},{x:27,y:2,w:1,h:1}];for(let e=0;e<spaceWorm_killerWalls.length;e++){let s=16*spaceWorm_killerWalls[e].w,o=16*spaceWorm_killerWalls[e].h,a=16*spaceWorm_killerWalls[e].x+spaceWorm_worldBoundsX,r=16*spaceWorm_killerWalls[e].y+spaceWorm_worldBoundsY;spaceWorm_levelObstacles.push(new spaceWorm_killerRectangle(s,o,a,r))}spaceWorm_enemies=[],spaceWorm_enemies.push(new spaceWorm_killerCircle(2,208,0,0,.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,16,0,0,.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,-16,0,0,-.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,0,16,-.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,0,-16,.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,128,0,0,.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,96,0,0,-.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,112,16,-.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,112,-16,.5,0)),spaceWorm_stars=[];let e=15,s=3;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+8,r=32*e+spaceWorm_worldBoundsY+8;a<32&&(a=-spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}}if(6===spaceWorm_level){spaceWorm_worldBoundsX=-120,spaceWorm_worldBoundsY=-120,spaceWorm_worldBoundsWidth=240,spaceWorm_worldBoundsHeight=240,spaceWorm_walls=[],spaceWorm_walls=[{x:7,y:1,w:1,h:1},{x:7,y:13,w:1,h:1},{x:1,y:7,w:1,h:1},{x:13,y:7,w:1,h:1}];for(let e=0;e<spaceWorm_walls.length;e++){let s=16*spaceWorm_walls[e].w,o=16*spaceWorm_walls[e].h,a=16*spaceWorm_walls[e].x-spaceWorm_worldBoundsWidth/2,r=16*spaceWorm_walls[e].y-spaceWorm_worldBoundsHeight/2;spaceWorm_levelObstacles.push(new spaceWorm_rectangle(s,o,a,r))}spaceWorm_killerWalls=[],spaceWorm_killerWalls=[{x:0,y:0,w:6,h:6},{x:9,y:0,w:6,h:6},{x:0,y:9,w:6,h:6},{x:9,y:9,w:6,h:6},{x:5,y:3,w:2,h:1},{x:8,y:3,w:2,h:1},{x:5,y:11,w:2,h:1},{x:8,y:11,w:2,h:1},{x:3,y:5,w:1,h:2},{x:3,y:8,w:1,h:2},{x:11,y:5,w:1,h:2},{x:11,y:8,w:1,h:2}];for(let e=0;e<spaceWorm_killerWalls.length;e++){let s=16*spaceWorm_killerWalls[e].w,o=16*spaceWorm_killerWalls[e].h,a=16*spaceWorm_killerWalls[e].x+spaceWorm_worldBoundsX,r=16*spaceWorm_killerWalls[e].y+spaceWorm_worldBoundsY;spaceWorm_levelObstacles.push(new spaceWorm_killerRectangle(s,o,a,r))}spaceWorm_stars=[];let e=8,s=8;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+8,r=32*e+spaceWorm_worldBoundsY+8;spaceWorm_stars.push(new spaceWorm_star(s,a,r))}spaceWorm_enemies=[],spaceWorm_enemies.push(new spaceWorm_killerCircle(2,120-spaceWorm_worldBoundsWidth/2,88-spaceWorm_worldBoundsHeight/2,.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,120-spaceWorm_worldBoundsWidth/2,152-spaceWorm_worldBoundsHeight/2,-.5,0)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,88-spaceWorm_worldBoundsWidth/2,120-spaceWorm_worldBoundsHeight/2,0,-.5)),spaceWorm_enemies.push(new spaceWorm_killerCircle(2,152-spaceWorm_worldBoundsWidth/2,120-spaceWorm_worldBoundsHeight/2,0,.5))}if(7===spaceWorm_level){spaceWorm_worldBoundsX=-104,spaceWorm_worldBoundsY=-104,spaceWorm_worldBoundsWidth=208,spaceWorm_worldBoundsHeight=208,spaceWorm_walls=[],spaceWorm_walls=[{x:3,y:1,w:1,h:2},{x:5,y:2,w:3,h:1},{x:9,y:1,w:1,h:2},{x:1,y:2,w:1,h:3},{x:0,y:4,w:1,h:1},{x:3,y:4,w:3,h:1},{x:11,y:2,w:1,h:3},{x:12,y:4,w:1,h:1},{x:7,y:4,w:3,h:1},{x:0,y:6,w:2,h:1},{x:11,y:6,w:2,h:1},{x:3,y:10,w:1,h:2},{x:5,y:10,w:3,h:1},{x:9,y:10,w:1,h:2},{x:1,y:9,w:1,h:2},{x:0,y:8,w:2,h:1},{x:3,y:8,w:3,h:1},{x:11,y:9,w:1,h:2},{x:11,y:8,w:2,h:1},{x:7,y:8,w:3,h:1}];for(let e=0;e<spaceWorm_walls.length;e++){let s=16*spaceWorm_walls[e].w,o=16*spaceWorm_walls[e].h,a=16*spaceWorm_walls[e].x+spaceWorm_worldBoundsX,r=16*spaceWorm_walls[e].y+spaceWorm_worldBoundsY;spaceWorm_levelObstacles.push(new spaceWorm_rectangle(s,o,a,r))}spaceWorm_stars=[];let e=7,s=7;for(let o=0;o<e;o++)for(let e=0;e<s;e++){let s=2,a=32*o+spaceWorm_worldBoundsX+8,r=32*e+spaceWorm_worldBoundsX+8;0===a&&0===r&&(a=spaceWorm_worldBoundsWidth,spaceWorm_score++),spaceWorm_stars.push(new spaceWorm_star(s,a,r))}spaceWorm_killerWalls=[],spaceWorm_killerWalls=[{x:3,y:6,w:1,h:1},{x:9,y:6,w:1,h:1},{x:6,y:1,w:1,h:1},{x:6,y:11,w:1,h:1},{x:0,y:0,w:1,h:1},{x:0,y:12,w:1,h:1},{x:12,y:0,w:1,h:1},{x:12,y:12,w:1,h:1}];for(let e=0;e<spaceWorm_killerWalls.length;e++){let s=16*spaceWorm_killerWalls[e].w,o=16*spaceWorm_killerWalls[e].h,a=16*spaceWorm_killerWalls[e].x+spaceWorm_worldBoundsX,r=16*spaceWorm_killerWalls[e].y+spaceWorm_worldBoundsY;spaceWorm_levelObstacles.push(new spaceWorm_killerRectangle(s,o,a,r))}spaceWorm_enemies=[];for(let e=0;e<10;e++){let s=2,o=Math.floor(Math.random()*(spaceWorm_worldBoundsWidth-32))+(spaceWorm_worldBoundsX+16),a=-96,r=1*Math.random()-.5,c=1*Math.random()-.5;e>4&&(a=96),spaceWorm_enemies.push(new spaceWorm_killerCircle(s,o,a,r,c))}}}function spaceWorm_rectangleCollisionVsPlayer(e,s){let o=e.x+e.width/2-(s.x-spaceWorm_worldX),a=e.y+e.height/2-(s.y-spaceWorm_worldY),r=(e.width+2*s.width)/2,c=(e.height+2*s.width)/2,t=r*a,l=c*o,p="none";return Math.abs(o)<=r&&Math.abs(a)<=c&&(p=t>l?t>-l?"bottom":"left":t>-l?"right":"top"),p}function spaceWorm_rectangleCollisionVsOther(e,s){let o=e.x+e.width/2-s.x,a=e.y+e.height/2-s.y,r=(e.width+2*s.width)/2,c=(e.height+2*s.width)/2,t=r*a,l=c*o,p="none";return Math.abs(o)<=r&&Math.abs(a)<=c&&(p=t>l?t>-l?"bottom":"left":t>-l?"right":"top"),p}function spaceWorm_circleCollision(e,s){let o=e.width,a=e.x,r=e.y,c=s.width,t=a-(s.x-spaceWorm_worldX),l=r-(s.y-spaceWorm_worldY);if(Math.sqrt(t*t+l*l)<o+c)return!0}function spaceWorm_createBg(){spaceWorm_background=[];for(let e=0;e<200;e++){let e=.2*Math.random()+.2,s=Math.floor(Math.random()*spaceWorm_canvas.width/spaceWorm_scaleFitNative)-spaceWorm_canvas.width/spaceWorm_scaleFitNative/2-spaceWorm_worldX,o=Math.floor(Math.random()*spaceWorm_canvas.height/spaceWorm_scaleFitNative)-spaceWorm_canvas.height/spaceWorm_scaleFitNative/2-spaceWorm_worldY;spaceWorm_background.push(new spaceWorm_bgStar(e,s,o))}}function spaceWorm_update(){spaceWorm_ctx.clearRect(-spaceWorm_canvas.width/2/spaceWorm_scaleFitNative,-spaceWorm_canvas.height/2/spaceWorm_scaleFitNative,spaceWorm_canvas.width/spaceWorm_scaleFitNative,spaceWorm_canvas.height/spaceWorm_scaleFitNative),"start"===spaceWorm_state?(spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="center",spaceWorm_ctx.fillText("SPACE WORM!",0,0),spaceWorm_ctx.font="2px Arial",spaceWorm_ctx.fillText("Click/tap to continue.",0,4)):"levelstart"===spaceWorm_state?(spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="center",spaceWorm_ctx.fillText("Level: "+spaceWorm_level,0,-1),spaceWorm_ctx.font="2px Arial",1===spaceWorm_level&&(spaceWorm_ctx.fillText("Collect all of the yellow stars.",0,2),spaceWorm_ctx.fillText("Touch screen and drag or use mouse to move.",0,4)),2===spaceWorm_level&&(spaceWorm_ctx.fillText("Black space is impassible.",0,2),spaceWorm_ctx.fillText("Slow down by not moving the joystick too far.",0,4)),3===spaceWorm_level&&(spaceWorm_ctx.fillText("Red meteors will destroy you.",0,2),spaceWorm_ctx.fillText("Your tail is not affected.",0,4)),4===spaceWorm_level&&(spaceWorm_ctx.fillText("Red space will destroy you.",0,2),spaceWorm_ctx.fillText("You don't want to be an ex-worm...",0,4)),5===spaceWorm_level&&(spaceWorm_ctx.fillText("Let's put these things together.",0,2),spaceWorm_ctx.fillText("Collect all stars, don't be an ex-worm!",0,4)),6===spaceWorm_level&&(spaceWorm_ctx.fillText("Mind the red space!",0,2),spaceWorm_ctx.fillText("You may need to check your speed...",0,4)),7===spaceWorm_level&&(spaceWorm_ctx.fillText("Let's try a maze",0,2),spaceWorm_ctx.fillText("Be careful enemies now roam the map...",0,4)),spaceWorm_ctx.font="1px Arial",spaceWorm_ctx.fillText("Click/tap to continue.",0,6)):"gamecomplete"===spaceWorm_state?(spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="center",spaceWorm_ctx.fillText("CONGRATULATIONS!",0,0),spaceWorm_ctx.font="2px Arial",spaceWorm_ctx.fillText("You completed my little game!",0,4)):"game"===spaceWorm_state?(spaceWorm_background.forEach((e=>{e.update()})),spaceWorm_player.update(),spaceWorm_stars.forEach((e=>{e.update()})),spaceWorm_enemies.forEach((e=>{e.update()})),spaceWorm_levelObstacles.forEach((e=>{e.update()})),spaceWorm_ctx.strokeStyle="black",spaceWorm_ctx.lineWidth=spaceWorm_commonUnit/spaceWorm_scaleFitNative,spaceWorm_ctx.strokeRect(spaceWorm_worldX+spaceWorm_worldBoundsX-spaceWorm_commonUnit/2/spaceWorm_scaleFitNative,spaceWorm_worldY+spaceWorm_worldBoundsY-spaceWorm_commonUnit/2/spaceWorm_scaleFitNative,spaceWorm_worldBoundsWidth+spaceWorm_commonUnit/spaceWorm_scaleFitNative,spaceWorm_worldBoundsHeight+spaceWorm_commonUnit/spaceWorm_scaleFitNative),spaceWorm_oldWorldX=spaceWorm_worldX,spaceWorm_oldWorldY=spaceWorm_worldY,!0===spaceWorm_mouseDown&&!0===spaceWorm_mouseMove&&(spaceWorm_vx=Math.cos(spaceWorm_joyAngle)*(spaceWorm_joyDistance/30),spaceWorm_vy=Math.sin(spaceWorm_joyAngle)*(spaceWorm_joyDistance/30)),spaceWorm_vx*=spaceWorm_friction,spaceWorm_vy*=spaceWorm_friction,spaceWorm_worldX-=spaceWorm_vx,spaceWorm_worldY-=spaceWorm_vy,-spaceWorm_worldX-spaceWorm_player.width<spaceWorm_worldBoundsX&&(spaceWorm_worldX=-spaceWorm_worldBoundsX-spaceWorm_player.width),-spaceWorm_worldY-spaceWorm_player.width<spaceWorm_worldBoundsY&&(spaceWorm_worldY=-spaceWorm_worldBoundsY-spaceWorm_player.width),-spaceWorm_worldX+spaceWorm_player.width>spaceWorm_worldBoundsX+spaceWorm_worldBoundsWidth&&(spaceWorm_worldX=-(spaceWorm_worldBoundsX+spaceWorm_worldBoundsWidth)+spaceWorm_player.width),-spaceWorm_worldY+spaceWorm_player.width>spaceWorm_worldBoundsY+spaceWorm_worldBoundsHeight&&(spaceWorm_worldY=-(spaceWorm_worldBoundsY+spaceWorm_worldBoundsHeight)+spaceWorm_player.width),!0===spaceWorm_drawJoy&&spaceWorm_drawJoystick(),spaceWorm_starsRemaining=spaceWorm_stars.length-spaceWorm_score,spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="left",spaceWorm_ctx.fillText("Stars: "+spaceWorm_starsRemaining,(-spaceWorm_deviceWidth/2+16)/spaceWorm_scaleFitNative,(-spaceWorm_deviceHeight/2+64)/spaceWorm_scaleFitNative),spaceWorm_starsRemaining<=0&&(spaceWorm_level++,spaceWorm_state=8===spaceWorm_level?"gamecomplete":"win")):"gameover"===spaceWorm_state?(spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="center",spaceWorm_ctx.fillText("Oh no! You got ex-wormed!",0,0),spaceWorm_ctx.font="2px Arial",spaceWorm_ctx.fillText("Click/tap to restart the level.",0,4)):"win"===spaceWorm_state&&(spaceWorm_ctx.font="4px Arial",spaceWorm_ctx.fillStyle="white",spaceWorm_ctx.textAlign="center",spaceWorm_ctx.fillText("Well done!",0,0),spaceWorm_ctx.font="2px Arial",spaceWorm_ctx.fillText("Click/tap to continue.",0,4)),requestAnimationFrame(spaceWorm_update)}function spaceWorm_playerlayNote(e,s,o,a,r){const c=spaceWorm_audioCtx.createOscillator(),t=spaceWorm_audioCtx.createGain();t.gain.setValueAtTime(0,0),t.gain.linearRampToValueAtTime(o,spaceWorm_audioCtx.currentTime+s),t.gain.setValueAtTime(o,spaceWorm_audioCtx.currentTime+r-a),t.gain.linearRampToValueAtTime(0,spaceWorm_audioCtx.currentTime+r),c.type="sine",c.frequency.setValueAtTime(e,0),c.start(0),c.stop(spaceWorm_audioCtx.currentTime+r),c.connect(t),t.connect(spaceWorm_volumeGain)}spaceWorm_canvas.width=spaceWorm_deviceWidth,spaceWorm_canvas.height=spaceWorm_deviceHeight,spaceWorm_canvas.addEventListener("touchstart",(e=>{spaceWorm_joyStartX=e.touches[0].clientX,spaceWorm_joyStartY=e.touches[0].clientY,spaceWorm_joyStart(),e.preventDefault()})),spaceWorm_canvas.addEventListener("touchmove",(e=>{spaceWorm_joyEndX=e.changedTouches[0].pageX,spaceWorm_joyEndY=e.changedTouches[0].pageY,spaceWorm_joyMove(),e.preventDefault()})),spaceWorm_canvas.addEventListener("touchend",spaceWorm_joyEnd),spaceWorm_canvas.addEventListener("mousedown",(e=>{spaceWorm_joyStartX=e.clientX,spaceWorm_joyStartY=e.clientY,spaceWorm_joyStart()})),spaceWorm_canvas.addEventListener("mousemove",(e=>{spaceWorm_joyEndX=e.clientX,spaceWorm_joyEndY=e.clientY,spaceWorm_joyMove()})),spaceWorm_canvas.addEventListener("mouseleave",spaceWorm_joyEnd),spaceWorm_canvas.addEventListener("mouseup",spaceWorm_joyEnd),window.addEventListener("resize",spaceWorm_displayWindowSize()),window.onresize=spaceWorm_displayWindowSize,spaceWorm_update()</script>