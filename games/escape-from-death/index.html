<!doctype html><title>Escape from death</title><style>body{background:#000;margin:0 auto}canvas{cursor:none}</style><div id=wrapper><div id=root><canvas id=game width=600 height=600>–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</canvas></div></div><script src=https://cdn.jsdelivr.net/npm/near-api-js@0.45.1/dist/near-api-js.min.js></script><script>let contract,account,wallet,near,nearApi;const accountContract="dev-1663063108095-18567660337802";(async()=>{await async function(){nearAPI=window.nearApi;const{keyStores:e,connect:t,WalletConnection:n}=nearAPI,o={networkId:"testnet",keyStore:new e.BrowserLocalStorageKeyStore,nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};near=await t(o),wallet=new n(near)}();const e=()=>{wallet.requestSignIn(accountContract)},t=()=>{wallet.signOut(),window.location.reload()},n=async()=>await contract.get_greeting(),o=async e=>{let t=await n();if(!t)return void console.log("error");let o=wallet.getAccountId(),l=e,a=t.split("|"),i=[],r=[];for(let e=0;e<a.length;e+=3)i.push(a[e+1]),r.push(parseInt(a[e+2]));i.push(o),r.push(l),console.log(i,r),function(e,t){var n,o,l=[];for(e.sort((function(e,t){var n=e>t?1:e<t?-1:0;return l.push(n),n})),n=0;n<t.length;n++)o=l.concat([]),t[n].sort((function(){return o.splice(0,1)}))}(r,[i]),i.reverse(),r.reverse(),console.log(i,r),i=i.slice(0,10),r=r.slice(0,10);let s="";for(let e=0;e<r.length;e++)s+=`${e+1}|${i[e]}|${r[e]}|`;s.length>0&&(s=s.substr(0,s.length-1)),console.log(s);await contract.set_greeting({message:s});alert("Your result: "+l),window.location.reload()};var l=document.getElementById("game"),a=l.getContext("2d");const i=(e,t,n,o,l)=>{let a=document.createElement("button");return document.body.prepend(a),a.style.position="absolute",a.style.left=e+"px",a.style.top=t+"px",a.innerHTML=l,a.style.width=n+"px",a.style.height=o+"px",a.style.zIndex=5,a};let r,s=.1*innerWidth,c=s/2.5;(r=i(innerWidth/2-s/2,.4*innerHeight-c/2,s,c,"PLAY")).onclick=function(){r.remove(),document.getElementById("nameWallet")?.remove(),document.querySelector("button")?.remove(),p(),d()};const d=()=>{var e,t,n,i;e=document.createElement("span"),document.body.appendChild(e),e.style.position="absolute",e.style.color="white",e.style.fontSize=.05*innerHeight+"px",e.style.left=innerWidth/2-.055*innerWidth+"px",e.style.top=.93*innerHeight+"px",e.style.zIndex=5;var r=[],s=[],c=[],d=0;let p=[],y=!1;asterimg="üëª",fireimg="üî•",shipimg="üßú‚Äç‚ôÇÔ∏è",explimg="üí•",web="üï∏Ô∏è",coffin="‚ö∞Ô∏è";var x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,50)};e.innerHTML="üèÜSCORE: 0",l.addEventListener("mousemove",(function(e){n.x=e.offsetX-25,n.y=e.offsetY-13})),i=0,n={x:300,y:300,animx:0,animy:0,scale:40},function l(){if(function(){++i%50==0&&p.push({lifeTime:100,scale:70,x:550*Math.random(),y:550*Math.random()});let l=[];for(let e=0;e<p.length;e++){if(p[e].lifeTime--,p[e].lifeTime<85&&Math.abs(n.x+n.scale-(p[e].x+p[e].scale))<50&&Math.abs(n.y-p[e].y)<25)return y=!0,void(wallet.isSignedIn()?o(d):(alert("Your result: "+d),window.location.reload()));p[e].lifeTime>0&&l.push(p[e])}p=l,i%10==0&&r.push({angle:0,dxangle:.2*Math.random()-.1,del:0,x:550*Math.random(),y:-50,dx:2*Math.random()-1,dy:2*Math.random()+1});i%30==0&&(s.push({x:n.x+10,y:n.y,dx:0,dy:-10.2}),s.push({x:n.x+10,y:n.y,dx:.5,dy:-10}),s.push({x:n.x+10,y:n.y,dx:-.5,dy:-10.2}));for(t in r){for(j in r[t].x=r[t].x+r[t].dx,r[t].y=r[t].y+r[t].dy,r[t].angle=r[t].angle+r[t].dxangle,(r[t].x<=0||r[t].x>=550)&&(r[t].dx=-r[t].dx),r[t].y>=650&&r.splice(t,1),s)if(Math.abs(r[t].x+25-s[j].x-15)<50&&Math.abs(r[t].y-s[j].y)<25){d++,e.innerHTML=`üèÜSCORE: ${d}`,c.push({x:r[t].x-25,y:r[t].y-25,scale:1}),r[t].del=1,s.splice(j,1);break}1==r[t].del&&r.splice(t,1)}for(t in s)s[t].x=s[t].x+s[t].dx,s[t].y=s[t].y+s[t].dy,s[t].y<-30&&s.splice(t,10);let a=[];for(let e=0;e<c.length;e++)c[e].scale+=.07,c[e].scale<=2&&a.push(c[e]);c=a,n.animx=n.animx+1,n.animx>4&&(n.animy++,n.animx=0);n.animy>3&&(n.animx=0,n.animy=0)}(),function(){for(t in a.clearRect(0,0,600,600),a.save(),a.scale(2,2),a.scale(1,1),a.restore(),a.font="480px Arial",a.fillText(web,20,390,600,600),p)a.font=`${p[t].scale}px Arial`,a.fillText(coffin,p[t].x,p[t].y);for(t in s)a.font="20px Arial",a.fillText(fireimg,s[t].x,s[t].y);for(t in a.font="80px Arial",a.fillText(shipimg,n.x,n.y),r)a.save(),a.translate(r[t].x+25,r[t].y+25),a.rotate(r[t].angle),a.font="80px Arial",a.fillText(asterimg,-25,-25),a.restore();for(let e=0;e<c.length;e++)a.font=20*c[e].scale+"px Arial",a.fillText(explimg,c[e].x,c[e].y)}(),y)return;x(l)}()},p=async()=>{let e=await n(),t=[];t=e.split("|");let o=document.createElement("table");root.append(o),o.style.position="absolute",o.style.color="white",o.style.fontSize=.03*innerHeight+"px",o.style.zIndex=5,o.style.right=.05*innerWidth+"px",o.style.top=.05*innerHeight+"px";let l="";Object.keys(e);for(let e=0;e<t.length;e+=3)l+=`<tr> <td> ${t[e]} </td> <td> | </td>   <td>${t[e+1]}</td>   <td> | </td>   <td>${t[e+2]}</td>    </tr>`;o.innerHTML=l};if(wallet.isSignedIn()){const e=wallet.getAccountId();console.log("IS SIGNED IN!",e),account=await near.account(wallet._authData.accountId);const n=await account.state();console.log("STATE",n),contract=new nearAPI.Contract(account,accountContract,{viewMethods:["get_greeting"],changeMethods:["set_greeting"],sender:account}),(but=i(innerWidth/2-s/2,.6*innerHeight-c/2,s,c,"SIGN OUT")).onclick=t,((e,t,n)=>{let o=document.createElement("div"),l=document.createElement("span");root.append(o),o.append(l),l.style.cssText='\n                    font-family: "Lucida Console", Monaco, monospace;\n                    letter-spacing: 0px;\n                    word-spacing: -2px;\n                    color: #000000;\n                    text-decoration: none;\n                    font-style: normal;\n                    font-variant: normal;\n                    text-transform: uppercase;',l.innerHTML=t,l.id=n,l.style.fontSize=parseInt(e.style.height)/2+"px",l.style.color="white",o.style.left=parseInt(e.style.left)-parseInt(getComputedStyle(o).width)/5+"px",o.style.top=parseInt(e.style.top)-parseInt(e.style.height)/2+"px",o.style.position="absolute",o.style.zIndex=5})(but,e,"nameWallet")}else i(innerWidth/2-s/2,.6*innerHeight-c/2,s,c,"SIGN IN").onclick=e})()</script>