!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var a=(r=o,i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(l," */")),s=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(s).concat([a]).join("\n")}var r,i,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(o)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(a[r]=!0)}for(var i=0;i<e.length;i++){var l=[].concat(e[i]);o&&a[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t){t.song=[[[,0,262],[,0,131]],[[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,-1,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,-1,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0],[,0,15,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,0,0,31,0,0,0,34,0,0,0,32,0,0,0,31,0,0,0,27,0,0,0,31,0,0,0,0,0,29,0,27,0,0,0,24,0,0,0,27,0,0,0,31,0,0,0,32,0,0,0,36,0,0,0,34,0,0,0,0,0,32,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,0,0,31,0,0,0,34,0,0,0,32,0,0,0,31,0,0,0,27,0,0,0,31,0,0,0,0,0,29,0,27,0,0,0,24,0,0,0,27,0,0,0,31,0,0,0,32,0,0,0,36,0,0,0,34,0,0,0,0,0,32,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,26,0,27,0,22,0,22,0,0,0,26,0,0,0,27,0,0,0,31,0,0,0,34,0,0,0,0,0,36,0,32,0,31,0,29,0,32,0,31,0,29,0,27,0,26,0,24,0,22,0,27,0,0,0,27,0,0,0,0,0,26,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,34,0,31,32,34,0,31,32,34,22,24,26,27,29,31,32,31,0,27,29,31,0,19,20,22,24,22,20,22,19,20,22,20,0,24,22,20,0,19,17,19,17,15,17,19,20,22,24,20,0,24,22,24,0,26,27,22,24,26,27,29,31,32,34]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,34,0,27,0,31,0,34,0,34,0,36,0,34,0,32,0,31,0,0,0,0,0,31,0,31,0,32,0,31,0,29,0,27,0,25,0,24,0,25,0,27,0,0,0,22,0,0,22,27,0,25,0,24,0,25,0,27,0,0,0,26,0,0,0]]],[0,1,2,3,4,5,5,6,6,7,7],100,{title:"Canon in D",instruments:["Instrument 0","Instrument 1"],patterns:["1-Bass","5-Treble","9-Harmony","13-Exp","17-Exp/Treble","21/25-Exp2","37","53"]}]},function(e,t,n){var o=n(3),a=n(4);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var s={insert:"head",singleton:!1};o(a,s);e.exports=a.locals||{}},function(e,t,n){"use strict";var o,a=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},s=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function i(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},o=[],a=0;a<e.length;a++){var s=e[a],l=t.base?s[0]+t.base:s[0],c=n[l]||0,p="".concat(l," ").concat(c);n[l]=c+1;var d=i(p),h={css:s[1],media:s[2],sourceMap:s[3]};-1!==d?(r[d].references++,r[d].updater(h)):r.push({identifier:p,updater:g(h,t),references:1}),o.push(p)}return o}function c(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var a=n.nc;a&&(o.nonce=a)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var r=s(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var p,d=(p=[],function(e,t){return p[e]=t,p.filter(Boolean).join("\n")});function h(e,t,n,o){var a=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,a);else{var s=document.createTextNode(a),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function u(e,t,n){var o=n.css,a=n.media,s=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),s&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var m=null,f=0;function g(e,t){var n,o,a;if(t.singleton){var s=f++;n=m||(m=c(t)),o=h.bind(null,n,s,!1),a=h.bind(null,n,s,!0)}else n=c(t),o=u.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var a=i(n[o]);r[a].references--}for(var s=l(e,t),c=0;c<n.length;c++){var p=i(n[c]);0===r[p].references&&(r[p].updater(),r.splice(p,1))}n=s}}}},function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o)()(!0);a.push([e.i,"html,body{overflow:hidden;width:100%;height:100%;margin:0;padding:0}#renderCanvas{width:100%;height:100%;touch-action:none}\n","",{version:3,sources:["/mnt/c/Users/alex/dev/tiny-tower-defense/src/style.scss"],names:[],mappings:"AAAA,UACQ,eAAgB,CAChB,UAAc,CACd,WAAc,CACd,QAAW,CACX,SAAW,CACd,cAGG,UAAc,CACd,WAAc,CACd,iBAAkB",file:"style.scss",sourcesContent:["html, body {\r\n        overflow: hidden;\r\n        width   : 100%;\r\n        height  : 100%;\r\n        margin  : 0;\r\n        padding : 0;\r\n    }\r\n\r\n    #renderCanvas {\r\n        width   : 100%;\r\n        height  : 100%;\r\n        touch-action: none;\r\n    }"]}]),t.default=a},function(e,t){zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxP=(...e)=>{let t=zzfxX.createBufferSource(),n=zzfxX.createBuffer(e.length,e[0].length,zzfxR);return e.map((e,t)=>n.getChannelData(t).set(e)),t.buffer=n,t.connect(zzfxX.destination),t.start(),t},zzfxG=(e=1,t=.05,n=220,o=0,a=0,s=.1,r=0,i=1,l=0,c=0,p=0,d=0,h=0,u=0,m=0,f=0,g=0,w=1,M=0,x=0)=>{let B,y,b=2*Math.PI,C=l*=500*b/zzfxR**2,v=(0<m?1:-1)*b/4,S=n*=(1+2*t*Math.random()-t)*b/zzfxR,P=[],A=0,I=0,O=0,T=1,z=0,L=0,k=0;for(o=99+zzfxR*o,M*=zzfxR,a*=zzfxR,s*=zzfxR,g*=zzfxR,c*=500*b/zzfxR**3,m*=b/zzfxR,p*=b/zzfxR,d*=zzfxR,h=zzfxR*h|0,y=o+M+a+s+g|0;O<y;P[O++]=k)++L%(100*f|0)||(k=r?1<r?2<r?3<r?Math.sin((A%b)**3):Math.max(Math.min(Math.tan(A),1),-1):1-(2*A/b%2+2)%2:1-4*Math.abs(Math.round(A/b)-A/b):Math.sin(A),k=(h?1-x+x*Math.sin(2*Math.PI*O/h):1)*(0<k?1:-1)*Math.abs(k)**i*e*zzfxV*(O<o?O/o:O<o+M?1-(O-o)/M*(1-w):O<o+M+a?w:O<y-g?(y-O-g)/s*w:0),k=g?k/2+(g>O?0:(O<y-g?1:(y-O)/g)*P[O-g|0]/2):k),B=(n+=l+=c)*Math.sin(I*m-v),A+=B-B*u*(1-1e9*(Math.sin(O)+1)%2),I+=B-B*u*(1-1e9*(Math.sin(O)**2+1)%2),T&&++T>d&&(n+=p,S+=p,T=0),!h||++z%h||(n=S,l=C,T=T||1);return P},zzfxV=.3,zzfxR=44100,zzfxX=new(top.AudioContext||webkitAudioContext)},function(e,t){
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(e,t,n,o=125)=>{let a,s,r,i,l,c,p,d,h,u,m,f,g,w,M,x=0,B=[],y=[],b=[],C=0,v=0,S=1,P={},A=zzfxR/o*60>>2;for(;S;C++)B=[S=d=m=g=0],n.map((o,m)=>{for(p=t[o][C]||[0,0,0],S|=!!t[o][C],M=g+(t[o][0].length-2-!d)*A,w=m==n.length-1,s=2,i=g;s<p.length+w;d=++s){for(l=p[s],h=s==p.length+w-1&&w||u!=(p[0]||0)|l|0,r=0;r<A&&d;r++>A-99&&h?f+=(f<1)/99:0)c=(1-f)*B[x++]/2||0,y[i]=(y[i]||0)-c*v+c,b[i]=(b[i++]||0)+c*v+c;l&&(f=l%1,v=p[1]||0,(l|=0)&&(B=P[[u=p[x=0]||0,l]]=P[[u,l]]||(a=[...e[u]],a[2]*=2**((l-12)/12),l>0?zzfxG(...a):[])))}g=M});return[y,b]}},function(e,t,n){"use strict";n.r(t);n(2);const{Vector3:o,Color3:a,MeshBuilder:s,Mesh:r,CSG:i,StandardMaterial:l,SolidParticleSystem:c,DynamicTexture:p}=BABYLON,d=(e,t,n,a)=>new o(e*(a=a||1/3),t*a,n*a),h=e=>{const t=new l("Material-Shape");return t.diffuseColor=e,t},u=e=>{const{drawings:t,color:n}=e,[l,c,p]=n.split(","),u=h(new a(l,c,p)),m=["x","y","z"],f=[];if(t.forEach((e,t)=>{if(!e.polygons.length)return null;if(e.mirror){const t=[];e.polygons.forEach(e=>{const n=[];for(let t=e.length-1;t>=0;t--){const[o,a]=e[t];n.push([64-o,a])}t.push(n)}),e.polygons.push(...t)}const n=(e=>{const t=[],n=[d(0,0,-1,.5),d(0,0,1,.5)];e.forEach(e=>{const o=e.map(e=>{const[t,n]=e;return d(t-32,n-32,0,1/64)});o.push(o[0]);const a=s.ExtrudeShape("star",{shape:o,path:n,cap:r.CAP_ALL,updatable:!0});t.push(a)});return r.MergeMeshes(t,!0)})(e.polygons);"x"===m[t]&&n.rotate(o.Up(),-Math.PI/2),"y"===m[t]&&n.rotate(o.Right(),Math.PI/2),f.push(n)}),!f.length)return null;let g=null;f.forEach(e=>{const t=i.FromMesh(e);g?g.intersectInPlace(t):g=t});const w=g.toMesh("Result-Mesh",u,null,!0);return f.forEach(e=>e.dispose()),w},m=(e,t,n)=>{const{size:a,blocks:r,pickable:i}=e,[l,p,d]=a,[h,u,m]=r,f=h.padStart(d*p,"0").split(""),g=u.padStart(l*d,"0").split(""),w=m.padStart(l*p,"0").split(""),M=1/l,x=new c(e.name+"-SPS",n,{isPickable:i,useModelMaterial:!0}),B=s.CreateBox("b",{size:M});x.addShape(B,l*p*d),B.dispose();const y=x.buildMesh();return y.metadata={sps:x},y.position.y=1,x.initParticles=function(){for(let e=0;e<x.nbParticles;e++){const n=x.particles[e];n.props={state:1},t&&(n.props.correctState=t[e].props.state);const a=e%l,s=Math.floor(e/p)%d,r=Math.floor(Math.floor(e/l)/p);n.position=new o(M*(a+.5)-.5,M*(s+.5)-.5,M*(r+.5)-.5);const i=1===parseInt(f[s*d+r]),c=1===parseInt(g[r*l+a]),h=1===parseInt(w[s*l+a]);n.props.state=i&&c&&h?1:0,n.scaling=1===n.props.state?o.One():o.Zero()}},x.initParticles(),x.setParticles(),x.refreshVisibleSize(),y},f=e=>{const t=((e,t,n)=>{const o=s.CreateBox("Start-Button",{size:e},n),a=new p("TextTexture",{width:t,height:t},n),r=new l("TextMaterial",n);return r.diffuseTexture=a,r.diffuseTexture.hasAlpha=!0,o.material=r,o})(.25,512),{material:n}=t,o=n.diffuseTexture,a=o.getContext();a.fillStyle="green",a.fillRect(0,0,512,512),a.save(),a.lineWidth=64,a.lineCap="round",a.translate(256,256),a.beginPath();let r=0;return a.moveTo(128*Math.cos(r),128*Math.sin(r)),r=2/3*Math.PI,a.lineTo(128*Math.cos(r),128*Math.sin(r)),r=4/3*Math.PI,a.lineTo(128*Math.cos(r),128*Math.sin(r)),a.closePath(),a.stroke(),a.restore(),o.update(),t},g=(e,t)=>{const n=e.width||512,o=e.height||341,a=s.CreatePlane("TextMesh",{width:1,height:o/n},t),r=new p("TextTexture",{width:n,height:o},t),i=new l("TextMaterial",t);return i.diffuseTexture=r,i.diffuseTexture.hasAlpha=!0,a.material=i,a.appendText=function(e){this.text=`${e}|${this.text}`,this.setText(this.text)},a.setText=function(e){this.text=e;const t=r.getContext();if(t.fillStyle="transparent",t.clearRect(0,0,n,o),""===e)return void r.update();t.beginPath(),t.moveTo(n,o),t.arcTo(0,o,0,0,64),t.arcTo(0,0,n,0,64),t.arcTo(n,0,n,o,64),t.arcTo(n,o,0,o,64),t.fillStyle="black",t.fill(),t.font="64px Helvetica",t.fillStyle="white";e.split("|").forEach((e,o)=>{const a=e.split("^");a.forEach((e,s)=>{t.fillStyle="#ffffff",(2===s||e.includes("mistake"))&&(t.fillStyle="#ff3333"),t.fillText(e,75+(n-150)/a.length*s,100+96*o)})}),r.update()},a},w={color:"1,1,1",drawings:[{polygons:[]},{polygons:[[[63,32],[0,32],[32,29]]]},{polygons:[[[32,13],[0,0],[32,5]]],mirror:!0}]},M={name:"Cat",size:[8,8,8],blocks:["0111111100111101001111010011100100110000111000000110000000100000","0001100001011010011111100111111000111100000110000000111100000001","0111111101111111001111010011110100011000001111000011110000100100"],colors:["99,35,7","205,144,87","243,221,198","205,144,87","99,35,7","243,221,198","205,144,87","99,35,7"]},x={name:"Ship",size:[8,8,8],blocks:["0011111011111111001001110010010000100100001001000010010000100100","0001000000111000011111110011101100111011011111110011100100111000","0011101100111100001110000001000001111100011111000111110000010000"],colors:["99,35,7","144,70,23","144,70,23","99,35,7","243,221,198","203,181,158","243,221,198","99,35,7"]},B={name:"Squiggle",size:[8,8,8],color:"0.48,0.44,0.44",blocks:["1111111101100110110000111000000110000001110000110110011011111111","0011110001100110110110111010010110100101110110110110011000111100","1111111100000011000001100001110000111000011000001100000011111111"],colors:["255,253,184","237,163,35","253,246,140","210,141,13","244,205,42","253,246,140","237,163,35","255,253,184"]},y={name:"Blank",pickable:!0,size:[8,8,8],color:"1,1,1",blocks:["1111111111111111111111111111111111111111111111111111111111111111","1111111111111111111111111111111111111111111111111111111111111111","1111111111111111111111111111111111111111111111111111111111111111"]},b={name:"Skull",size:[8,8,8],color:"1,1,1",blocks:["1110000000010000111100001111111011111111011111110111111000111100","0001100001111110111111111111111111111111011111100011110000011000","0011110000100100001111000111111011111111111111110111111000111100"],colors:["29,182,186","244,159,12","255,197,9","222,26,98","171,206,30","29,182,186","244,159,12","222,26,98"]},C={name:"Links",size:[8,8,8],colors:["83,52,25","164,82,9","255,102,0","83,52,25","255,204,51","255,102,0","164,82,9","255,204,51"],blocks:["0001100000011000000110001111111111111111000110000001100000011000","0111000011011000100010001001111110011111100010001101100001110000","0000111000011011000100011111100111111001000100010001101100001110"]};var v=n(1);const S=[.0625,.1875,.3125,.4375,.5625,.6875,.8125,.9375],P=[new BABYLON.Color3(.019,.019,.423),new BABYLON.Color3(.047058823529411764,.6549019607843137,.8274509803921568),new BABYLON.Color3(.8313725490196079,.7215686274509804,.5254901960784314),new BABYLON.Color3(.0196078431372549,.47843137254901963,.16470588235294117),new BABYLON.Color3(.3058823529411765,.22745098039215686,.13333333333333333),new BABYLON.Color3(.5450980392156862,.3411764705882353,.16470588235294117),new BABYLON.Color3(1,1,1)],A=function(e){const t=new BABYLON.NodeMaterial("node"),n=new BABYLON.InputBlock("position");n.setAsAttribute("position");const o=new BABYLON.VectorSplitterBlock("VectorSplitter"),a=new BABYLON.VectorMergerBlock("VectorMerger"),s=new BABYLON.TransformBlock("WorldPos");s.complementZ=0,s.complementW=1;const r=new BABYLON.InputBlock("World");r.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const i=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");i.complementZ=0,i.complementW=1;const l=new BABYLON.InputBlock("ViewProjection");l.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const c=new BABYLON.VertexOutputBlock("VertexOutput"),p=new BABYLON.RemapBlock("Remap");p.sourceRange=new BABYLON.Vector2(-.5,.5),p.targetRange=new BABYLON.Vector2(0,1);const d=new BABYLON.GradientBlock("Gradient");d.colorSteps.push(new BABYLON.GradientBlockColorStep(0,e[0]));for(let t=0;t<S.length;t++){let n=t>=e.length?e[e.length-1]:e[t];d.colorSteps.push(new BABYLON.GradientBlockColorStep(S[t],n))}d.colorSteps.push(new BABYLON.GradientBlockColorStep(1,e[e.length-1]));const h=new BABYLON.FragmentOutputBlock("FragmentOutput");return n.output.connectTo(o.xyzIn),o.x.connectTo(a.x),o.y.connectTo(a.y),o.z.connectTo(a.z),a.xyz.connectTo(s.vector),r.output.connectTo(s.transform),s.output.connectTo(i.vector),l.output.connectTo(i.transform),i.output.connectTo(c.vector),o.y.connectTo(p.input),p.output.connectTo(d.gradient),d.output.connectTo(h.rgb),t.addOutputNode(c),t.addOutputNode(h),t.build(),t};function I(e){Object.assign(e,{startInteraction(e,t,n){this.props=this.props||{},this.props.state=0;const{correctState:o}=this.props;1===o?(this.materialIndex=1,zzfx(1,.05,1171,.01,0,.08,3,.74,0,1.9,-389,.06,0,.1,0,.1,0,1,.03,.59)):(this.scaling=BABYLON.Vector3.Zero(),zzfx(1,.05,1851,.01,0,.07,0,1.06,2.4,0,0,0,0,0,0,0,.01,.09,.03,0))},moveInteraction(e,t){},endInteraction(e,t){}})}var O=245,T=30;const{Vector3:z,Mesh:L,MeshBuilder:k,StandardMaterial:N,Color3:R}=BABYLON,E=e=>{let t="";const n=Math.floor(e/60);t+=n+":";return t+=""+Math.floor(e-60*n).toString().padStart(2,"0"),t};async function Y(e,t){const n=h(new R(1,0,0));let o;if(t.sculptures.push(e.name),e.colors){const t=e.colors.map(e=>{const t=e.split(",");return new R.FromInts(t[0],t[1],t[2])});o=A(t)}else o=A(P);const{scene:a,engine:s,xrHelper:r,xrDefault:i,myStorage:l}=t,c=new L(e.name,a);c.metadata={inProgress:!1,timer:0,counter:0,myStorage:l},c.startGame=function(){const{sculpture:t,solution:n,myStorage:o}=this.metadata,s=t.metadata.sps;for(let e=0;e<s.nbParticles;e++){const t=s.particles[e];t.scaling=z.One(),t.props.state=1,t.materialIndex=0}if(s.setParticles(),s.computeSubMeshes(),this.metadata.timer=O,this.metadata.inProgress=!0,n.parent.scaling=z.One(),i.input.controllers.forEach(t=>{if(t.motionController&&t.motionController.rootMesh){t.motionController.rootMesh.getChildMeshes(!0).forEach(e=>{e.name.includes("Solution-Box")&&(e.scaling=z.Zero(),e.setParent(null))});const n=a.getMeshByName(e.name+"-Solution-Box");n.scaling=new z(.25,.25,.25),n.setParent(t.motionController.rootMesh),n.position=new z(0,.05,-.05),n.rotation=new z(Math.PI/4,Math.PI,0)}}),"Cat"===this.name&&(this.getChildMeshes(!0).forEach(e=>{"Tutorial-Mesh"===e.name&&e.dispose(),"Tutorial-Lines"===e.name&&e.dispose()}),o.isSupported&&!o.get("Cat"))){const e=g({width:960},a);e.setParent(c),e.setText("Aim the laser at the|sculpture and click|to chip away blocks"),e.position=new z(-1,1,-.5),e.name="Tutorial-Mesh",e.billboardMode=L.BILLBOARDMODE_Y;const t=k.CreateLines("Tutorial-Lines2",{points:[new z(-1,1.15,-.5),new z(-.25,1.25,-.2)],colors:[new BABYLON.Color4(0,0,0,1),new BABYLON.Color4(0,0,0,1)],useVertexAlpha:!1},a);t.locallyTranslate(c.position),t.setParent(c)}},c.endGame=function(){this.metadata.inProgress=!1;const{sculpture:e,solution:n,percent:o,mistakes:s,timer:r}=this.metadata,i=e.metadata.sps,p=[];for(let e=0;e<i.nbParticles;e++){const t=i.particles[e];p.push(t.props.state)}if(l.isSupported){const e=t.myStorage.get(c.name);let n=!1;if(!e||e.split("|").length<4)n=!0;else{const[t,a,i,l]=e.split("|");o>parseInt(a,10)&&(n=!0),100===o&&s<parseInt(i,10)&&(n=!0),100===o&&0===s&&r>l&&(n=!0)}n&&l.set(c.name,`${p.join("")}|${o}|${s}|${Math.floor(r)}`)}n.parent.scaling=z.Zero();const d=a.getMeshByName("Timer-Mesh");d&&d.setText("")};const p=k.CreateBox("Pedestal",{height:1.3,width:.4,depth:.4},a);p.checkCollisions=!0,p.position=new z(0,.6,0);const d=m(e,null,a);d.metadata.sps.setMultiMaterial([o,n]),d.position=new z(-1,1.5,0),d.scaling=new z(.5,.5,.5),c.metadata.solution=d;const u=k.CreateBox(e.name+"-Solution-Box",{size:.51},a);u.isPickable=!1,u.position=new z(-1,1.5,0),u.material=new N("box"),u.material.alpha=.5;const w=u.clone(e.name+"-Helper-Box");w.isPickable=!1,w.position.x=0,d.setParent(u);const M=m(y,d.metadata.sps.particles,a);if(M.metadata.sps.setMultiMaterial([o,n]),l.isSupported){const e=l.get(c.name);if(e){const[t,n,o,a]=e.split("|");c.metadata.percent=n,c.metadata.mistakes=o,c.metadata.timer=a,d.parent.scaling=z.Zero();const s=t.split(""),r=M.metadata.sps;for(let e=0;e<r.nbParticles;e++){const t=parseInt(s[e],10);r.particles[e].props.state=t;const{correctState:n}=r.particles[e].props;r.particles[e].scaling=1===t||1===n?z.One():z.Zero(),r.particles[e].materialIndex=0===t&&1===n?1:0}r.computeSubMeshes(),r.setParticles()}}var x;M.scaling=new z(.5,.5,.5),M.position=new z(0,1.5,0),c.metadata.sculpture=M,x=M,Object.assign(x,{getPickedParticle(e){const t=this.metadata.sps,n=t.pickedParticle(e.pickInfo);if(!n)return null;const{idx:o}=n;return t.particles[o]},startInteraction(e,t,n){const o=this.getPickedParticle(e);this.metadata.selectedParticles=this.metadata.selectedParticles||{},this.metadata.selectedParticles[e.event.pointerId]=o;const a=this.metadata.sps;this.metadata.parent.metadata.inProgress&&o&&o.startInteraction&&(o.startInteraction(e,t,n),a.setParticles(),a.computeSubMeshes())},moveInteraction(e,t){const n=this.getPickedParticle(e);if(!n)return;const o=this.metadata.sps;n.moveInteraction&&(n.moveInteraction(e,t),o.setParticles())},endInteraction(e,t){this.metadata.selectedParticles=this.metadata.selectedParticles||{};const n=this.metadata.selectedParticles[e.event.pointerId],o=this.metadata.sps;n&&n.endInteraction&&(n.endInteraction(e,t),o.setParticles()),this.metadata.selectedParticles[e.event.pointerId]=void 0}}),M.metadata.parent=c;const B=M.metadata.sps;for(let e=0;e<B.nbParticles;e++){I(B.particles[e])}B.setParticles();const b=g({},a);b.rotate(z.Right(),Math.PI/8),b.position=new z(0,1,-.3),b.scaling=new z(.7,.7,.7),a.registerBeforeRender(()=>{let{timer:t,counter:n,inProgress:o}=c.metadata;const r=s.getDeltaTime()/1e3;if(t=Math.max(0,t-r),n-=1,0===t&&(n=0),n<=0){const s=a.getMeshByName("Timer-Mesh");o&&s&&s.setText(E(t));let r=t>0?""+E(t):""+e.name;const i=d.metadata.sps,l=M.metadata.sps;let p=0,h=0,u=0;for(let e=0;e<i.nbParticles;e++)0===i.particles[e].props.state?(h+=1,0===l.particles[e].props.state&&(p+=1)):0===l.particles[e].props.state&&(u+=1);const m=Math.floor(p/h*100);r+=`|${m}%`,u&&(r+=`|${u} ${1===u?"mistake":"mistakes"}`),b.setText(r),n=T,o&&100===m&&(zzfx(1,.05,597,.34,.22,.42,0,.71,-5.2,0,9,.08,.2,0,0,0,0,.59,.09,.14),c.endGame(m,u)),c.metadata.percent=m,c.metadata.mistakes=u,c.metadata.timer=t}o&&0===t&&c.endGame(),c.metadata.timer=t,c.metadata.counter=n}),b.setParent(p);const C=f();if(C.position=new z(0,.25,-.1),C.startInteraction=()=>{c.startGame(),C.scaling=new z(.9,.9,1),zzfx(1,.05,239,.04,.09,.29,0,.99,-.9,0,0,0,0,0,0,.1,.05,.91,.08,0)},C.endInteraction=()=>{C.scaling=z.One()},C.setParent(p),"Cat"===e.name&&l&&!l.get("Cat")){const e=g({width:960},a);e.setText("Aim the laser and |click the trigger|to reset and start timer"),e.position=new z(1,1,-.5),e.name="Tutorial-Mesh",e.billboardMode=L.BILLBOARDMODE_Y;k.CreateLines("Tutorial-Lines",{points:[e.position,new z(0,.25,-.2)],colors:[new BABYLON.Color4(0,0,0,1),new BABYLON.Color4(0,0,0,1)],useVertexAlpha:!1},a).setParent(c),e.setParent(c)}else"Skull"===e.name?(M.scaling=new z(2.2,2.2,2.2),M.position=new z(0,1.1,3),p.position.x=-2,u.position.x=-2,w.dispose()):"Ship"===e.name?(M.scaling=new z(8,8,8),M.position=new z(0,4,8),p.position.x=-2,u.position.x=-2,w.dispose()):"Links"===e.name&&(M.scaling=new z(2.2,2.2,2.2),M.position=new z(0,.88,3),p.position.x=-2,u.position.x=-2,w.dispose());return p.setParent(c),u.setParent(c),w.setParent(c),M.setParent(c),c}const{Animation:V,Color3:F,Vector3:D,Mesh:j,Space:$}=BABYLON,G=function(){const e=50*Math.random()+20,t=2*Math.random()*Math.PI;this.position=new D(e*Math.cos(t),0,e*Math.sin(t)),this.getScene().beginAnimation(this,0,50,V.ANIMATIONLOOPMODE_RELATIVE,1*Math.random()+1,G.bind(this))};const{Color3:_,Vector3:W,MeshBuilder:U,Mesh:X,Space:Z}=BABYLON,H=e=>e/57.2958;const{Color3:J,CSG:Q,Vector3:q,HemisphericLight:K,PointLight:ee,StandardMaterial:te,Mesh:ne,MeshBuilder:oe,TransformNode:ae,WebXRState:se}=BABYLON;async function re(e){const{scene:t,engine:n,xrHelper:o,xrDefault:a}=e;new K("light1",new q(1,1,0),t).groundColor=new J(0,0,0);new BABYLON.DirectionalLight("DirectionalLight",new BABYLON.Vector3(.3,-1,.3),t).intensity=.3;const s=oe.CreateBox("Sphere",{width:15,height:6.4,depth:15},t);s.position.y=3;const r=Q.FromMesh(s),i=oe.CreateBox("Sphere",{width:4,height:3,depth:1},t);i.position=new q(0,1.5,7.5);const l=oe.CreateBox("Inner-Box",{width:14.8,height:6,depth:14.8},t);l.position=new q(.05,3,.05),r.subtractInPlace(Q.FromMesh(l)),r.subtractInPlace(Q.FromMesh(i));const c=oe.CreateCylinder("Cylinder",{height:.2,diameter:30});c.position=new q(0,-.1,0),c.material=h(J.FromInts(86,176,0));const p=Q.FromMesh(c),d=c.clone("Floor-2");d.position=new q(0,-.1,20),p.unionInPlace(Q.FromMesh(d)),d.position=new q(20,-.1,4),p.unionInPlace(Q.FromMesh(d)),r.subtractInPlace(p);const m=r.toMesh("Solid");m.checkCollisions=!0;const f=p.toMesh("Floor",c.material,t);f.checkCollisions=!0,t.addMesh(m),s.dispose(),i.dispose(),l.dispose(),c.dispose(),d.dispose();const y=new J(.004,.608,.991),S=h(y);S.specularColor=y;const P=oe.CreateGround("ocean",{width:1e3,height:1e3},t);P.position.y=-1,e.ocean=P,P.material=S,a.teleportation&&(a.teleportation.addFloorMesh(f),a.teleportation.addFloorMesh(m));(await Y(M,e)).position=new q(-3,0,5);const A=await Y(x,e);A.position=new q(6,0,20),A.rotate(q.Up(),Math.PI/2);(await Y(B,e)).position=new q(3,0,5);(await Y(b,e)).position=new q(0,0,20);const I=await Y(C,e);I.position=new q(15,0,5),I.rotate(q.Up(),Math.PI/2),async function(e){const{scene:t,engine:n}=e,o=u(w);o.setPivotPoint(new D(.5,0,.5)),o.billboardMode=j.BILLBOARDMODE_Y,o.material.emissiveColor=F.White();const a=new V("wavesAnimation","scaling.z",30,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CYCLE);a.setKeys([{frame:0,value:0},{frame:13,value:.8},{frame:24,value:1},{frame:35,value:.8},{frame:50,value:0}]),o.animations=[],o.animations.push(a),t.addMesh(o);for(let t=0;t<24;t++){const n=o.clone("WaveMesh-"+t);n.parent=e.ocean,G.bind(n)()}o.dispose()}(e);const O=await async function(e){const{scene:t,engine:n}=e,o=new X("Tramp-Game-Mesh",t),a=U.CreateCylinder("Tramp-Mesh",{diameter:2,height:.25},t);a.position.y=.125,a.setParent(o);const s=g({width:800,height:300},t);s.name="Tramp-Score-Mesh",s.position=new W(0,3.5,.5),s.scaling=new W(2,2,1),s.setParent(o);const r=U.CreateBox("Jumper-Mesh",{width:.25,depth:.25,height:1},t);r.material=h(_.Black()),r.setParent(o),r.resetFalling=function(){r.position=new W(0,.625,0),r.rotation=W.Zero(),r.velocity=9.8,r.acceleration=-9.8,r.rotationalVelocity=2*Math.PI,r.flips=0,r.streak=0,r.lastZ=0},r.startFalling=function(){zzfx(1,.05,80,0,.02,.39,3,1.35,0,0,0,0,0,.2,0,.1,0,.99,.05,0),r.falling=60;r.up.y;r.spinning=!1},r.resetFalling(),r.maxFlips=parseInt(e.myStorage.get("tramp-flips")||0,10),r.maxStreak=parseInt(e.myStorage.get("tramp-streak")||0,10),t.registerBeforeRender(()=>{const t=n.getDeltaTime()/1e3;if(r.falling){const e=r.up.y>=0?-1:1;r.locallyTranslate(new W(0,e*r.velocity*t,0)),r.falling-=1,0===r.falling&&r.resetFalling()}else{r.position.y+=r.velocity*t;const n=r.rotationQuaternion?r.rotationQuaternion.toEulerAngles().z:r.rotation.z;r.lastZ>n&&(r.flips+=1),r.lastZ=n,r.position.y-.5<=a.position.y&&(n<H(-25)||n>H(25)?r.startFalling():(r.interacted&&zzfx(1,.05,178,.05,0,.11,0,1.14,4.2,3.5,0,0,0,0,0,.1,0,.76,.1,0),r.position.y=a.position.y+.5,r.velocity=Math.max(Math.abs(r.velocity),9.8),r.flips>0&&(r.velocity+=1.8),r.streak=r.flips>0?r.streak+1:0,r.streak>r.maxStreak&&(r.maxStreak=r.streak,e.myStorage.set("tramp-streak",r.streak)),r.flips>r.maxFlips&&(r.maxFlips=r.flips,e.myStorage.set("tramp-flips",r.flips)),r.flips=0)),r.velocity+=r.acceleration*t,r.spinning&&r.rotate(W.Forward(),r.rotationalVelocity*t),s.setText(`Flips: ${r.flips}^Max:${r.maxFlips}|Streak:${r.streak}^Max:${r.maxStreak}`)}});const i=U.CreateBox("Jumper-Head",{width:.4,depth:.4,height:.4},t);i.material=h(_.FromInts(254,149,1)),i.position.y=1,i.setParent(r);const l=U.CreateBox("Rotate-Button",{size:.5},t);return l.material=h(_.FromInts(86,176,0)),l.position=new W(-1,.25,-1),l.startInteraction=(e,t,n)=>{r.spinning=!0,r.interacted=!0,l.scaling=new W(.9,.9,.9)},l.endInteraction=()=>{r.spinning=!1,l.scaling=W.One()},l.setParent(o),o}(e);O.position.y=6.2,O.rotation=new q(0,Math.PI,0);const T=g({width:1024,height:500},t);T.position=new q(0,4.5,7.4),T.scaling=new q(5,5,1),T.setText("Welcome speed sculptors!|Complete each sculpture in|4:04 without any mistakes|to earn a high score");const z=g({width:1920,height:1080},t);z.position=new q(-7.34,3,2),z.scaling=new q(8,8,1),z.rotation=new q(0,1.5*Math.PI,0),t.registerBeforeRender(()=>{let t="Scoreboard|";t+="Name^Percent^Mistakes^Timer",e.sculptures=e.sculptures||[],e.myStorage.isSupported&&e.sculptures.forEach(n=>{const o=e.myStorage.get(n);if(!o)return;const[a,s,r,i]=o.split("|");a&&(t+=`|${n}^${s}^${r}^${i}`)}),z.setText(t)});const L=zzfxM(...v.song);zzfxP(...L).loop=!0}n(5),n(6);const{Scene:ie,Color3:le,Vector3:ce,UniversalCamera:pe,DynamicTexture:de,StandardMaterial:he,MeshBuilder:ue,PointerEventTypes:me,WebXRState:fe}=BABYLON,ge={sculptures:[],myStorage:new class{constructor(e){this.localStorage=window.localStorage,this.namespace=e||"bbf20",this.isSupported=this.testLocalStorage()}testLocalStorage(){this.isSupported=!0;try{return this.set("test","1"),this.remove("test"),!0}catch(e){return!1}}set(e,t){return this.isSupported&&this.localStorage.setItem(`${this.namespace}-${e}`,t),!0}get(e){if(!this.isSupported)return null;return this.localStorage.getItem(`${this.namespace}-${e}`)}remove(e){return!!this.isSupported&&(this.localStorage.removeItem(`${this.namespace}-${e}`),!0)}}},we=async()=>{zzfx(1,.05,239,.04,.09,.29,0,.99,-.9,0,0,0,0,0,0,.1,.05,.91,.08,0),document.getElementById("intro").style.display="none";const e=document.getElementById("renderCanvas");e.style.display="block";const t=new BABYLON.Engine(e,!0);ge.engine=t,t.displayLoadingUI();const n=new ie(t),o=(new le(.004,.608,.991),new le(.01,.824,1));n.ambientColor=o,n.clearColor=new le(.01,.824,1),n.gravity=new ce(0,-1.81,0),n.collisionsEnabled=!0,ge.scene=n;const a=ue.CreateSphere("skyBox",{diameter:1e3,segments:100},n),s=new he("skyBox",n);s.backFaceCulling=!1,s.disableLighting=!0,a.infiniteDistance=!0;const r=new de("SkyTexture",{width:512,height:512},n),i=r.getContext();s.reflectionTexture=r;const l=i.createLinearGradient(0,0,0,512);l.addColorStop(1,o.toHexString()),i.fillStyle=l,i.fillRect(0,0,512,512),r.update(),a.material=s;const c=new pe("Camera",new ce(0,2.01,-2),n);c.attachControl(e,!0),c.speed=.1,c.angularSensibility=9e3,c.applyGravity=!0,c.ellipsoid=new ce(1,1,1),c.checkCollisions=!0,c.minZ=.5;const p=await n.createDefaultXRExperienceAsync();p.input.onControllerAddedObservable.add(e=>{e.onMotionControllerInitObservable.add(e=>{const t=e.getMainComponent();t.isButton()?t.onButtonStateChangedObservable.add(e=>{ge.mainComponentActive=1===e.value}):t.isAxes()&&t.onAxisValueChangedObservable.add(e=>{ge.mainComponentActive=1===e.x||1===e.y}),e.onModelLoadedObservable.add(e=>{const t=g({width:960,height:341},n);t.name="Tutorial-Mesh",t.setText("Press up on the joystick|to aim and teleport|to the pointer location"),t.rotate(ce.Right(),Math.PI/4),t.scaling=new ce(.25,.25,.25),t.setParent(e.rootMesh),t.position.y=.08;const o=n.getMeshByName("Timer-Mesh");o&&o.dispose();const a=g({width:300,height:160},n);a.name="Timer-Mesh",a.setText(""),a.rotate(ce.Right(),2/3*Math.PI),a.scaling=new ce(.1,.1,.1),a.setParent(e.rootMesh),a.position=new ce(0,.04,.08)})})}),ge.xrDefault=p;const d=p.baseExperience;d.camera.setTransformationFromNonVRCamera(c),ge.xrHelper=d,d.onStateChangedObservable.add(e=>{e===fe.IN_XR&&(d.camera.ellipsoid=new ce(1,1,1)),e===fe.NOT_IN_XR&&(c.position.y=2.01)}),d.onInitialXRPoseSetObservable.add(e=>{e.onAfterCameraTeleport.add(e=>{p.input.controllers.forEach(e=>{e.motionController&&e.motionController.rootMesh&&e.motionController.rootMesh.getChildMeshes(!0).forEach(e=>{"Tutorial-Mesh"===e.name&&e.dispose()})})})}),ge.selectedMeshes={},n.onPointerObservable.add(e=>{const{pickInfo:t}=e,{hit:o}=t,{pickedMesh:a}=t;if(o&&a&&a.startInteraction)if(ge.selectedMeshes[e.event.pointerId]=a,d&&d.state===fe.IN_XR){const t=p.pointerSelection.getXRControllerByPointerId(e.event.pointerId);if(!t)return;const n=t.motionController;if(!n)return;a.startInteraction(e,n.rootMesh,ge)}else a.startInteraction(e,n.activeCamera,ge)},me.POINTERDOWN),n.onPointerObservable.add(e=>{const t=ge.selectedMeshes[e.event.pointerId];t&&t.moveInteraction&&t.moveInteraction(e,ge)},me.POINTERMOVE),n.onPointerObservable.add(e=>{const t=ge.selectedMeshes[e.event.pointerId];t&&(t.endInteraction&&t.endInteraction(e,ge),delete ge.selectedMeshes[e.event.pointerId])},me.POINTERUP),n.registerBeforeRender(()=>{c.position.y<0&&(console.log("TOO LOW"),c.position=new ce(0,2.01,-2))}),await re(ge),t.hideLoadingUI(),document.addEventListener("keydown",e=>("p"===e.key&&(n.debugLayer.isVisible()?n.debugLayer.hide():n.debugLayer.show()),!1)),t.runRenderLoop(()=>{n.render()}),window.addEventListener("resize",()=>{t.resize()})};window.addEventListener("DOMContentLoaded",()=>{document.getElementById("playButton").onclick=we})}]);