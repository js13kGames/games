<!doctype html><meta name=viewport content="width=device-width"><title>Lasergrid - js13kGames 2018</title><style>body,html{overflow:hidden;width:100%;height:100%;margin:0;padding:0}#renderCanvas{width:100%;height:100%;touch-action:none}</style><script src=/2018/webxr/babylon.js></script><canvas id=renderCanvas touch-action=none></canvas><script>!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();t.Entity=function(){function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"entity",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.name=o+"_"+this.scene.meshes.length,this.position=r,this.rotation=n,this.vertices=[-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5],this.faces=[8,10,11,11,9,8,12,13,15,15,14,12,1,3,7,7,5,1,17,16,18,18,19,17,2,0,4,4,6,2],this.uvs=[1,0,0,0,0,0,1,0,1,1,0,1,0,1,1,1,1,0,0,0,1,1,0,1,0,0,1,0,0,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1],this.mesh=new BABYLON.Mesh(this.name,this.scene),this.mat=new BABYLON.StandardMaterial("mat",this.scene);var s=new BABYLON.Texture("tiles.png",this.scene,!1,!0,BABYLON.Texture.NEAREST_SAMPLINGMODE);this.mat.diffuseTexture=s,this.onPick=function(){},this.onPicked=function(){}}return o(e,[{key:"render",value:function(){}},{key:"onHitByLaser",value:function(e,t){return 0}},{key:"trigger",value:function(){this.onPick(this),this.scene.render(),this.onPicked(this)}},{key:"buildMesh",value:function(){var e=new BABYLON.VertexData;return this.normals=[],BABYLON.VertexData.ComputeNormals(this.vertices,this.faces,this.normals),e.positions=this.vertices,e.indices=this.faces,e.normals=this.normals,e.uvs=this.uvs,e.applyToMesh(this.mesh),this.mesh.material=this.mat,this.mesh.material.backFaceCulling=!1,this.mesh.position=new(Function.prototype.bind.apply(BABYLON.Vector3,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(this.position)))),this.mesh.checkCollisions=!0,this.mesh.actionManager=new BABYLON.ActionManager(this.scene),this.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(e){this.onPick(this),this.scene.render(),this.onPicked(this)}.bind(this,this.mesh))),this.mesh.rotation.y=this.rotation*Math.PI/2,BABYLON.Tags.AddTagsTo(this.mesh,"entity"),BABYLON.Tags.AddTagsTo(this.mesh,"block"),this.mesh.entity=this,this.mesh}}]),e}()},function(e,t,r){"use strict";r(2);var o=r(3);new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.getElementById("renderCanvas"),this.engine=new BABYLON.Engine(this.canvas,!0),this.scene=new BABYLON.Scene(this.engine),window.game=new o.Game(this.scene),game.createScene(this.scene),this.engine.runRenderLoop((function(){return t.scene.render()})),window.addEventListener("resize",(function(){return t.engine.resize()}))}},function(e,t,r){"use strict";window.rnd=function(e){return~~(Math.random()*e)},window.rotate=function(e,t){var r=Math.cos(t),o=Math.sin(t);return new BABYLON.Vector3(r*e.x-o*e.z,0,-o*e.x+r*e.z)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),n=r(4),s=r(5),a=r(6),i=r(7),l=r(8),p=r(9);t.Game=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.maps=this.initMaps(),this.puzzleManager=new n.PuzzleManager,this.initPuzzle()}return o(e,[{key:"win",value:function(){for(var e=this.scene.getMeshesByTags("entity"),t=0;t<e.length;t++)this.scene.removeMesh(e[t]);this.puzzleManager.next(),this.initPuzzle(),this.createPuzzle(),this.updateShadow(),this.laserbeam.drawLaser()}},{key:"initPuzzle",value:function(){this.puzzle=this.puzzleManager.puzzle,this.laserbeam=new p.Laserbeam(this.scene,this.puzzle),this.laserbeam.onWin=this.win.bind(this)}},{key:"initMaps",value:function(){for(var e=[],t=0;t<4;t++)for(var r=0;r<4;r++)e.push(new BABYLON.Vector4(t/4,r/4,t/4+.25,r/4+.25));return e}},{key:"createScene",value:function(e){new BABYLON.HemisphericLight("HemiLight",new BABYLON.Vector3(0,1,0),e).diffuse=new BABYLON.Color3(.2,.4,.5);var t=new BABYLON.DirectionalLight("light2",new BABYLON.Vector3(-2,-3,1),e);t.position=new BABYLON.Vector3(6,9,3),t.shadowMinZ=1,t.shadowMaxZ=20,t.intensity=5;var r=new BABYLON.ShadowGenerator(2048,t);r.forceBackFacesOnly=!0,this.vrHelper=e.createDefaultVRExperience(),this.createPuzzle();var o=new l.Ground(this.scene);e.gravity=new BABYLON.Vector3(0,-9.81,0),this.vrHelper.enableInteractions();var n=this;n.selectedMesh={},n.needsUnpressing=!1,this.vrHelper.onControllerMeshLoaded.add((function(e){e.onTriggerStateChangedObservable.add((function(e){e.pressed&&!n.needsUnpressing?(n.needsUnpressing=!0,n.selectedMesh.entity&&n.selectedMesh.entity.trigger()):!e.pressed&&n.needsUnpressing&&(n.needsUnpressing=!1)}))})),this.vrHelper.onNewMeshSelected.add((function(e){n.selectedMesh=e})),this.vrHelper.onSelectedMeshUnselected.add((function(e){n.selectedMesh={}})),this.vrHelper.meshSelectionPredicate=function(e){return!(!BABYLON.Tags.MatchesQuery(e,"block")&&e.name!=o.name||(console.log(e.name),0))},e.activeCamera.inertia=.6,e.activeCamera.speed=.5,e.activeCamera.minZ=.1,e.activeCamera.applyGravity=!0,e.activeCamera.ellipsoid=new BABYLON.Vector3(.25,.75,.25),e.collisionsEnabled=!0,e.activeCamera.checkCollisions=!0,this.vrHelper.enableTeleportation({floorMeshName:o.name});var s=new BABYLON.DynamicTexture("dynamic texture",{width:512,height:256},e);s.getContext(),s.hasAlpha=!0;var a=new BABYLON.StandardMaterial("Mat",e);a.opacityTexture=s,s.drawText("Grass",75,135,"bold 44px monospace","green",null,!0,!0);var i=BABYLON.MeshBuilder.CreatePlane("sphere1",{height:1,width:1},e);i.material=a,i.position.y=1.5,this.generator=r,this.updateShadow(),this.laserbeam.drawLaser()}},{key:"updateShadow",value:function(){this.generator._shadowMap.renderList=[];for(var e=0;e<this.scene.meshes.length;e++)"Tiled Ground"!=this.scene.meshes[e].name&&this.generator.addShadowCaster(this.scene.meshes[e]),this.scene.meshes[e].receiveShadows=!0}},{key:"createPuzzle",value:function(){for(var e=this,t=0;t<this.puzzle.length;t++)switch(this.puzzle[t].type){case"start":new i.Laser(this.scene,this.puzzle[t].pos,!0,this.puzzle[t].rot).onPicked=function(){var t=e.puzzle.find((function(e){return"start"===e.type}));t.rot=(t.rot+1)%4,e.laserbeam.drawLaser()};break;case"end":new i.Laser(this.scene,this.puzzle[t].pos,!1,this.puzzle[t].rot).onPicked=function(){e.laserbeam.drawLaser()};break;case"mirror":new a.Mirror(this.scene,this.puzzle[t].pos,this.puzzle[t].rot).onPicked=function(){e.laserbeam.drawLaser()};break;case"wall":new s.Wall(this.scene,this.puzzle[t].pos,this.puzzle[t].rot)}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();t.PuzzleManager=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.puzzles=[[{type:"start",pos:[4,.5,0],rot:1},{type:"end",pos:[-4,.5,0],rot:3}],[{type:"start",pos:[2,.5,3],rot:1},{type:"end",pos:[-2,.5,0],rot:3},{type:"mirror",pos:[-2,.5,3],rot:3}],[{type:"start",pos:[2,.5,3],rot:1},{type:"mirror",pos:[-2,.5,-2],rot:3},{type:"end",pos:[-2,.5,3],rot:3},{type:"wall",pos:[0,.5,3],rot:1},{type:"mirror",pos:[2,.5,-2],rot:3}],[{type:"start",pos:[-3,.5,5],rot:3},{type:"end",pos:[3,.5,5],rot:1},{type:"mirror",pos:[-3,.5,-1],rot:3},{type:"mirror",pos:[3,.5,-1],rot:1},{type:"wall",pos:[0,.5,5],rot:1},{type:"wall",pos:[0,.5,4],rot:1},{type:"wall",pos:[0,.5,3],rot:1},{type:"wall",pos:[-2,.5,3],rot:1},{type:"wall",pos:[-1,.5,3],rot:1},{type:"wall",pos:[-4,.5,3],rot:1},{type:"wall",pos:[0,1.5,5],rot:1},{type:"wall",pos:[0,1.5,4],rot:1},{type:"wall",pos:[0,1.5,3],rot:1},{type:"wall",pos:[-2,1.5,3],rot:1},{type:"wall",pos:[-1,1.5,3],rot:1},{type:"wall",pos:[-3,1.5,3],rot:1},{type:"wall",pos:[-4,1.5,3],rot:1}],[{type:"start",pos:[-3,.5,5],rot:3},{type:"end",pos:[0,.5,-1],rot:1},{type:"mirror",pos:[-3,.5,1],rot:3},{type:"mirror",pos:[3,.5,1],rot:1},{type:"wall",pos:[-4,.5,3],rot:1},{type:"mirror",pos:[3,.5,-1],rot:1},{type:"wall",pos:[-3,.5,-1],rot:1},{type:"wall",pos:[0,.5,2],rot:1},{type:"wall",pos:[3,.5,5],rot:1},{type:"wall",pos:[-3,.5,0],rot:1},{type:"wall",pos:[-4,.5,2],rot:1},{type:"wall",pos:[0,.5,3],rot:1},{type:"wall",pos:[3,.5,2],rot:1}],[{type:"start",pos:[-3,.5,5],rot:3},{type:"end",pos:[0,.5,1],rot:1},{type:"mirror",pos:[-3,.5,1],rot:3},{type:"mirror",pos:[1,.5,5],rot:1},{type:"wall",pos:[-3,.5,3],rot:1},{type:"wall",pos:[-4,.5,-1],rot:1},{type:"wall",pos:[0,.5,2],rot:1},{type:"wall",pos:[3,.5,5],rot:1},{type:"wall",pos:[-4,.5,-2],rot:1},{type:"wall",pos:[-3,.5,2],rot:1},{type:"wall",pos:[0,.5,3],rot:1},{type:"wall",pos:[3,.5,2],rot:1},{type:"mirror",pos:[-3,.5,-3],rot:1},{type:"wall",pos:[0,.5,0],rot:1},{type:"wall",pos:[0,1.5,0],rot:1},{type:"wall",pos:[0,1.5,1],rot:1},{type:"wall",pos:[0,1.5,2],rot:1},{type:"mirror",pos:[1,.5,-3],rot:1},{type:"wall",pos:[-2,.5,3],rot:1},{type:"wall",pos:[-1,.5,3],rot:1},{type:"wall",pos:[0,.5,-2],rot:1},{type:"wall",pos:[0,.5,-4],rot:1},{type:"wall",pos:[0,1.5,-4],rot:1},{type:"wall",pos:[0,1.5,-3],rot:1},{type:"wall",pos:[0,1.5,-2],rot:1},{type:"wall",pos:[0,2.5,-2],rot:1},{type:"wall",pos:[0,2.5,-1],rot:1},{type:"wall",pos:[0,2.5,0],rot:1}],[{type:"start",pos:[0,.5,0],rot:3},{type:"wall",pos:[0,.5,1],rot:3},{type:"wall",pos:[0,.5,-1],rot:3},{type:"wall",pos:[0,1.5,-1],rot:3},{type:"wall",pos:[0,1.5,0],rot:3},{type:"wall",pos:[0,1.5,1],rot:3},{type:"mirror",pos:[-3,.5,0],rot:3},{type:"mirror",pos:[-3,.5,-2],rot:3},{type:"mirror",pos:[3,.5,-2],rot:3},{type:"mirror",pos:[3,.5,-4],rot:3},{type:"end",pos:[0,.5,-4],rot:3},{type:"wall",pos:[0,1.5,-3],rot:3},{type:"wall",pos:[0,1.5,-5],rot:3},{type:"wall",pos:[0,.5,-5],rot:3},{type:"wall",pos:[0,.5,-3],rot:3},{type:"wall",pos:[0,1.5,-4],rot:3},{type:"wall",pos:[-1,.5,1],rot:3},{type:"wall",pos:[-2,.5,1],rot:3},{type:"wall",pos:[-3,.5,1],rot:3},{type:"wall",pos:[1,.5,-5],rot:3},{type:"wall",pos:[2,.5,-5],rot:3},{type:"wall",pos:[3,.5,-5],rot:3},{type:"wall",pos:[1,.5,0],rot:3},{type:"wall",pos:[-1,.5,-4],rot:3}],[{type:"start",pos:[2,.5,3],rot:1},{type:"end",pos:[-4,.5,3],rot:3},{type:"wall",pos:[-1,.5,3],rot:2},{type:"mirror",pos:[2,.5,-2],rot:2},{type:"mirror",pos:[-4,.5,-6],rot:1},{type:"wall",pos:[-1,2.5,3],rot:2},{type:"wall",pos:[-1,1.5,3],rot:2},{type:"wall",pos:[-1,.5,-2],rot:2},{type:"wall",pos:[-1,.5,-3],rot:2},{type:"wall",pos:[-1,.5,-4],rot:2},{type:"wall",pos:[-1,.5,-5],rot:2},{type:"wall",pos:[-1,.5,-7],rot:2},{type:"wall",pos:[-1,2.5,-2],rot:2},{type:"wall",pos:[-1,1.5,-2],rot:2},{type:"mirror",pos:[4,.5,-2],rot:2},{type:"mirror",pos:[4,.5,-6],rot:2},{type:"wall",pos:[-1,2.5,-3],rot:2},{type:"wall",pos:[-1,1.5,-3],rot:2},{type:"wall",pos:[-1,2.5,-4],rot:2},{type:"wall",pos:[-1,1.5,-4],rot:2},{type:"wall",pos:[-1,2.5,-5],rot:2},{type:"wall",pos:[-1,1.5,-5],rot:2},{type:"wall",pos:[-1,2.5,-6],rot:2},{type:"wall",pos:[-1,1.5,-6],rot:2},{type:"wall",pos:[-1,2.5,-7],rot:2},{type:"wall",pos:[-1,1.5,-7],rot:2}],[{type:"start",pos:[-3,.5,5],rot:3},{type:"end",pos:[3,.5,5],rot:1},{type:"mirror",pos:[-3,.5,-1],rot:3},{type:"mirror",pos:[3,.5,-1],rot:1},{type:"wall",pos:[0,.5,5],rot:1},{type:"wall",pos:[0,.5,4],rot:1},{type:"wall",pos:[0,.5,3],rot:1},{type:"wall",pos:[-2,.5,3],rot:1},{type:"wall",pos:[-1,.5,3],rot:1},{type:"wall",pos:[-4,.5,3],rot:1},{type:"wall",pos:[0,1.5,5],rot:1},{type:"wall",pos:[0,1.5,4],rot:1},{type:"wall",pos:[0,1.5,3],rot:1},{type:"wall",pos:[-2,1.5,3],rot:1},{type:"wall",pos:[-1,1.5,3],rot:1},{type:"wall",pos:[-3,1.5,3],rot:1},{type:"wall",pos:[-4,1.5,3],rot:1},{type:"wall",pos:[-1,.5,2],rot:1},{type:"wall",pos:[-1,.5,0],rot:1},{type:"wall",pos:[-1,.5,-2],rot:1},{type:"wall",pos:[-1,1.5,0],rot:1},{type:"wall",pos:[-1,1.5,-1],rot:1},{type:"wall",pos:[-1,1.5,-2],rot:1},{type:"wall",pos:[-1,1.5,2],rot:1},{type:"wall",pos:[-1,2.5,2],rot:1},{type:"wall",pos:[-1,2.5,1],rot:1},{type:"wall",pos:[-1,2.5,0],rot:1},{type:"wall",pos:[-1,2.5,-1],rot:1},{type:"wall",pos:[-1,2.5,-2],rot:1}]],this.currentPuzzle=(window.location.href.split("#")[1]||0)-1,this.next()}return o(e,[{key:"next",value:function(){this.currentPuzzle++,this.puzzle=this.puzzles[this.currentPuzzle]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wall=void 0;var o=r(0);t.Wall=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,"wall"));return o.uvs=[.25,.25,.25,.25,.25,.5,.25,.5,0,.25,0,.25,0,.5,0,.5,.25,.25,0,.25,.25,.5,0,.5,0,.25,.25,.25,0,.5,.25,.5,.25,.25,0,.25,.25,.5,0,.5],o.buildMesh(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Entity),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mirror=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),n=r(0);t.Mirror=function(e){function t(e,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,"mirror",o));return n.vertices=[-.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5],n.faces=[6,8,9,9,7,6,4,1,3,3,5,4,11,10,12,2,0,4,4,5,2],n.uvs=[0,.75,.25,.5,.25,.75,.25,.75,0,.5,.25,.5,.5,.25,.25,.25,.5,.5,.25,.5,0,.75,.25,.75,.25,.5],n.buildMesh(),n.onPick=function(){n.rotation=(n.rotation+1)%4,n.mesh.rotation.y=Math.PI*n.rotation/2},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Entity),o(t,[{key:"onHitByLaser",value:function(e,t){return 0!==e&&1!==e?0:(this.mesh.getFacetNormal(e),t>0?1:t<0?2:void 0)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Laser=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),n=r(0);t.Laser=function(e){function t(e,r,o,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=(n-1)%4;var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,o?"startLaser":"endLaser",n));return s.isStart=!!o,s.vertices=[-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5],s.faces=[0,2,3,3,1,0,4,5,7,7,6,4,16,17,19,19,18,16,13,12,14,14,15,13,9,8,10,10,11,9],s.uvs=[.5,.75,.25,.75,.5,1,.25,1,.25,.75,.5,.75,.25,1,.5,1,.5,.75,.5,1,.25,.75,.25,1,.5,1,.75,1,.5,.75,.75,.75,.25,.75,.25,1,0,.75,0,1],s.buildMesh(),s.onPick=function(){return s.mesh.rotation.y=s.mesh.rotation.y+Math.PI/2},s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Entity),o(t,[{key:"onHitByLaser",value:function(e,t){return 5!==e&&4!==e||this.isStart?0:3}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ground=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mesh=new BABYLON.MeshBuilder.CreateTiledGround("Tiled Ground",{xmin:-10,zmin:-10,xmax:10,zmax:10,subdivisions:{h:20,w:20}},this.scene);var r=new BABYLON.Texture("tiles.png",this.scene,!1,!0,BABYLON.Texture.NEAREST_SAMPLINGMODE),o=new BABYLON.StandardMaterial("groundmat",this.scene);o.diffuseTexture=r,o.diffuseTexture.uScale=.249,o.diffuseTexture.vScale=.249,o.diffuseTexture.wrapU=BABYLON.Texture.MIRROR_ADDRESSMODE,o.diffuseTexture.wrapV=BABYLON.Texture.MIRROR_ADDRESSMODE,o.specularTexture=r,o.specularTexture.uScale=.249,o.specularTexture.vScale=.249,o.specularTexture.wrapU=BABYLON.Texture.MIRROR_ADDRESSMODE,o.specularTexture.wrapV=BABYLON.Texture.MIRROR_ADDRESSMODE,o.specularColor=new BABYLON.Color3(0,0,0),this.mesh.material=o,this.mesh.checkCollisions=!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();t.Laserbeam=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.puzzle=r,this.onWin=function(){}}return o(e,[{key:"drawLaser",value:function(){var e=this.puzzle.find((function(e){return"start"===e.type})),t=new(Function.prototype.bind.apply(BABYLON.Vector3,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e.pos)))),r=e.rot,o=new BABYLON.Vector3(e.pos[0]+100*Math.sin(Math.PI*e.rot/2),.5,e.pos[2]+100*Math.cos(Math.PI*e.rot/2)),n=[t],s=t,a=0,i=0,l=void 0;do{a++;var p=this.calculateBeam(s,r,l);if(s=p.nextTarget,i=p.hitStatus,l=p.lastHit,s&&n.push(s),3==i)return void this.onWin();1==i&&(r=(r-1)%4),2==i&&(r=(r+1)%4)}while(0!=i&&a<25);if(1==n.length&&n.push(o),this.laser){var c=this.scene.getMeshByName("laserbeam");this.scene.removeMesh(c)}this.laser=BABYLON.MeshBuilder.CreateTube("laserbeam",{path:n,radius:.15},this.scene),BABYLON.Tags.AddTagsTo(this.laser,"entity"),this.laser.material=new BABYLON.StandardMaterial("laserMat",this.scene);var u=new BABYLON.GlowLayer("glow",this.scene);u.customEmissiveColorSelector=function(e,t,r,o){u.intensity=.75,"laserbeam"===e.name?o.set(.3,1,.3,1):o.set(0,0,0,0)},this.laser.isPickable=!1}},{key:"calculateBeam",value:function(e,t,r){var o=new BABYLON.Vector3(Math.sin(Math.PI*t/2),0,Math.cos(Math.PI*t/2)),n=new BABYLON.Ray(e,o,100),s=this.scene.pickWithRay(n,(function(e){return!(e.name.startsWith("startLaser")||!e.isPickable||e.name===r)}));if(s.pickedMesh&&s.pickedMesh.entity){var a=s.pickedMesh.getFacetNormal(s.faceId),i=Math.round(180*Math.asin(BABYLON.Vector3.Cross(a,n.direction).y)/Math.PI),l=s.pickedMesh.entity.onHitByLaser(s.faceId,i);return{nextTarget:s.pickedMesh.position,hitStatus:l,lastHit:s.pickedMesh.name}}return{nextTarget:new BABYLON.Vector3(e.x+100*Math.sin(Math.PI*t/2),.5,e.z+100*Math.cos(Math.PI*t/2)),hitStatus:0,lastHit:void 0}}}]),e}()}])</script>