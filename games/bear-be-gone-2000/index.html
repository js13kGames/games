<!doctype html><title></title><style>body{width:99.7%;height:100%;padding:0;margin:0;background:#000;overflow:hidden}canvas{background-color:#fff}</style><canvas id=g width=1366 height=768></canvas><script>!function(){"use strict";function t(t,i,e,n,s){this.p=e,this.x=t,this.y=i,this.draggable=n,this.w=64,this.h=64,this.px=0,this.py=0,this.dragged=!1,this.id=s,this.canConnect=!1,this.connections=[]}function i(i,e,n,s,h){var o=new t(i,e,n,s,h);return o.toggle=!1,o.ts=o.getTS(),o.ics=[{x:-22},{x:-8},{x:6},{x:20},{x:34}],o.dr=function(t,i,e,n,s){t.beginPath(),t.rect(o.x+n,o.y+s,i,e),t.fillStyle="#999999",t.fill(),t.lineWidth=1.5,t.strokeStyle="#787878",t.stroke()},o.c=function(t,i,e,n,s){t.beginPath(),t.arc(o.x+i,o.y+e,n,0,2*Math.PI),t.fillStyle=s,t.fill()},o.fc=function(t,i,e,n,s,h){t.beginPath(),t.arc(o.x+i,o.y+e,n,0,2*Math.PI),t.fillStyle=s,t.fill(),t.lineWidth=1.5,t.strokeStyle=h,t.stroke()},o.r=function(t){o.b(t),o.dr(t,65,77,0,0);for(var i=0;i<o.ics.length;i++)o.ic(t,o.x,o.ics[i].x);o.dr(t,65,150,-40,-73),o.toggle?o.c(t,-15,-40,3,"#ff0000"):o.c(t,-5,-40,3,"#00ff00")},o.b=function(t){o.fc(t,90,-50,9,"#c87137","#a05a2c"),o.fc(t,55,-53,9,"#c87137","#a05a2c"),o.fc(t,105,60,6,"#c87137","#a05a2c"),o.fc(t,70,25,50,"#c87137","#a05a2c"),o.fc(t,70,-25,29,"#c87137","#a05a2c"),o.c(t,70,-15,14,"#000"),o.c(t,75,-37,3,"#000"),o.c(t,65,-40,3,"#000"),o.c(t,52,-35,5,"#000")},o.u=function(){var t=o.getTS();if(o.ts+600<t){o.ts=o.getTS(),o.toggle=!o.toggle;for(var i=0;i<o.ics.length;i++)o.ics[i].x+=4,o.ics[i].x>62&&(o.ics[i].x=-8)}},o.p=[0,0,12,0,8,15,4,15],o.ic=function(t,i,e){var n=o.y-15;o.c(t,e,-19,6,"#ffffff");var s=o.p;t.beginPath(),t.fillStyle="#deaa87",t.moveTo(s[0]+i+e-6,s[1]+n);for(var h=2;h<s.length-1;h+=2)t.lineTo(s[h]+i+e-6,s[h+1]+n);t.closePath(),t.fill()},o}function e(i,e,n,s,h,o){var c=new t(i,e,n,s,o);return c.toggle=!1,c.w=200,c.h=100,c.col=h,c.dr=function(t,i,e,n,s){t.beginPath(),t.rect(c.x+n,c.y+s,i,e),t.fillStyle="#999999",t.fill(),t.lineWidth=4,t.strokeStyle="#787878",t.stroke()},c.c=function(t,i,e,n,s){t.beginPath(),t.arc(c.x+i,c.y+e,n,0,2*Math.PI),t.fillStyle=s,t.fill()},c.fc=function(t,i,e,n,s,h){t.beginPath(),t.arc(c.x+i,c.y+e,n,0,2*Math.PI),t.fillStyle=s,t.fill(),t.lineWidth=1.5,t.strokeStyle=h,t.stroke()},c.rect=function(t){t.globalAlpha=.5,t.beginPath(),t.fillStyle=c.col,t.fillRect(c.x,c.y,c.w,c.h),t.globalAlpha=1},c.r=function(t){c.rect(t),c.roundRect(t,c.x,c.y,200,100,5,null,"red")},c.u=function(){var t=c.getTS();if(c.ts+600<t){c.ts=c.getTS(),c.toggle=!c.toggle;for(var i=0;i<c.ics.length;i++)c.ics[i].x+=4,c.ics[i].x>62&&(c.ics[i].x=-8)}},c.roundRect=function(t,i,e,n,s,h){if(void 0===h&&(h=5),"number"==typeof h)h={tl:h,tr:h,br:h,bl:h};else{var o={tl:0,tr:0,br:0,bl:0};for(var c in o)h[c]=h[c]||o[c]}t.beginPath(),t.moveTo(i+h.tl,e),t.lineTo(i+n-h.tr,e),t.quadraticCurveTo(i+n,e,i+n,e+h.tr),t.lineTo(i+n,e+s-h.br),t.quadraticCurveTo(i+n,e+s,i+n-h.br,e+s),t.lineTo(i+h.bl,e+s),t.quadraticCurveTo(i,e+s,i,e+s-h.bl),t.lineTo(i,e+h.tl),t.quadraticCurveTo(i,e,i+h.tl,e),t.closePath(),t.lineWidth=10,t.strokeStyle="#000",t.stroke()},c}function n(t,i,e,n,s){this.p=e,this.x=t,this.y=i,this.w=n,this.h=s,this.isOpen=!0,this.t=["BEAR-BE-GONE 2000","","Oh noes, our brand-new state of the art bear security system has failed overnight!","There's a bear on the loose in our icecream factory, scoffing all the product!","Find the faulty component in the security system and get rid of that greedy bear!","","Alas, This game could not be completed on time :-(","Click to start"]}function s(t,i,e,n,s,h,o){this.p=e,this.x=t,this.y=i,this.w=n,this.h=s,this.isToggled=!1,this.t=h,this.v=o}var h;t.prototype={r:function(t){t.beginPath(),t.fillStyle="red",t.fillRect(this.x,this.y,this.w,this.h)},u:function(){},d:function(t){if(this.dragged){var i=t.x-this.px,e=t.y-this.py;if(i<0||i+this.w>1366)return;if(e<0||e+this.h>768)return;if(this.x=i,this.y=e,this.connections.length>0)for(var n=0;n<this.connections.length;n++){var s=this.connections[n];s.front?(this.p.connections[s.id].x1=this.getCenterX(),this.p.connections[s.id].y1=this.getCenterY()):(this.p.connections[s.id].x2=this.getCenterX(),this.p.connections[s.id].y2=this.getCenterY())}}},addConnection:function(t,i){this.connections.push({id:t,front:i})},isClicked:function(t){return!!this.isOver(t)&&(this.dragged=!0,this.px=t.x-this.x,this.py=t.y-this.y,!0)},isClicked2:function(t){return!!this.isOver2(t)&&(this.dragged=!1,this.px=t.x-this.x,this.py=t.y-this.y,!0)},isOver2:function(t){return t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h},isOver:function(t){return!!this.draggable&&t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h},dropped:function(){this.dragged=!1},getTS:function(){return(new Date).getTime()},getCenterX:function(){return this.x+this.w/2},getCenterY:function(){return this.y+this.h/2}},n.prototype={r:function(t){if(this.isOpen){var i=this.p.gameSize.w,e=this.p.gameSize.h;t.globalAlpha=.25,t.beginPath(),t.fillStyle="#000",t.fillRect(0,0,i,e),t.globalAlpha=1,t.beginPath(),t.fillStyle="#ccc";var n=(i-this.w)/2,s=(e-this.h)/2;t.fillRect(n,s,this.w,this.h),this.x=n,this.y=s,t.font="24px Verdana",t.textAlign="center",t.fillStyle="#000";for(var h=i/2,o=0;o<this.t.length;o++)t.fillText(this.t[o],h,260+40*o)}},isClicked:function(t){return!!this.isOver(t)&&(this.isOpen=!1,!0)},isOver:function(t){return!!this.isOpen&&t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h}},s.prototype={r:function(t){t.beginPath(),this.isToggled?t.fillStyle="#f00":t.fillStyle="#ccc",t.fillRect(this.x,this.y,this.w,this.h),this.isToggled?t.fillStyle="#fff":t.fillStyle="#000",t.font="16px Verdana",t.textAlign="center",t.fillText(this.t,this.x+this.w/2,this.y+33)},isClicked:function(t){return!!this.isOver(t)&&(this.isToggled=!this.isToggled,!0)},isOver:function(t){return t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h},deselect:function(t){this.v!==t&&(this.isToggled=!1)}},h=function(){var t=this;this.STATE=h.STATES.MOVE;var i=document.querySelector("#g");this.ctx=i.getContext("2d"),this.canvas=i,this.gameSize={w:i.width,h:i.height},this.widgets=[],this.currentWidget=null,this.dialogs=[],this.buttons=[],this.connections={},this.activeConnection=null,this.init(),this.idCounter=0;var e=function(t,i){var e=t.getBoundingClientRect();return{x:i.clientX-e.left,y:i.clientY-e.top}};i.addEventListener("click",(function(n){for(var s=e(i,n),o=0;o<t.dialogs.length&&!t.dialogs[o].isClicked(s);o++);if(t.STATE===h.STATES.CONNECT)for(o=0;o<t.widgets.length;o++)if(t.widgets[o].isClicked2(s)&&t.widgets[o].canConnect){var c={x1:t.widgets[o].getCenterX(),y1:t.widgets[o].getCenterY(),x2:s.x,y2:s.y,active:!0,id:t.idCounter,wid:t.widgets[o].id};return t.idCounter++,t.connections[c.id]=c,t.activeConnection=c,t.STATE=h.STATES.CONNECT1,void t.widgets[o].addConnection(c.id,!0)}if(t.STATE===h.STATES.CONNECT1&&null!==t.activeConnection)for(o=0;o<t.widgets.length;o++)if(t.widgets[o].isClicked2(s)&&t.widgets[o].id!==t.activeConnection.wid&&t.widgets[o].canConnect)return t.STATE=h.STATES.CONNECT,t.connections[t.activeConnection.id].active=null,t.widgets[o].addConnection(t.activeConnection.id,!1),void(t.activeConnection=null);for(t.STATE,h.STATES.CUT,o=0;o<t.buttons.length;o++)if(t.buttons[o].isClicked(s)){for(var r=t.buttons[o].v,l=0;l<t.buttons.length;l++)t.buttons[l].deselect(r);t.STATE=h.STATES[r],t.switchState();break}})),i.addEventListener("mouseup",(function(e){t.STATE===h.STATES.MOVE&&null!==t.currentWidget&&(t.currentWidget.dropped(),t.currentWidget=null,i.style.cursor="auto")})),i.addEventListener("mousedown",(function(n){if(t.STATE===h.STATES.MOVE){null!==t.currentWidget&&(t.currentWidget.dropped(),t.currentWidget=null,i.style.cursor="auto");for(var s=e(i,n),o=0;o<t.widgets.length;o++)if(t.widgets[o].isClicked(s)){t.currentWidget=t.widgets[o],i.style.cursor="pointer";break}}})),i.addEventListener("mousemove",(function(n){if(t.STATE===h.STATES.MOVE)if(null!==t.currentWidget)t.currentWidget.d(e(i,n));else{i.style.cursor="auto";for(var s=e(i,n),o=0;o<t.widgets.length;o++)if(t.widgets[o].isOver(s)){i.style.cursor="move";break}}t.STATE!==h.STATES.CONNECT&&t.STATE!==h.STATES.CONNECT1||null===t.activeConnection||(s=e(i,n),t.activeConnection.x2=s.x,t.activeConnection.y2=s.y)}));var n=function(){t.render(),requestAnimationFrame(n)};n();var s=function(){t.update(),setTimeout(s,16.666666666666668)};s()},h.STATES={MOVE:0,CONNECT:1,CONNECT1:2,CUT:3},h.prototype={init:function(){this.widgets.push(new t(100,100,this,!0,1)),this.widgets.push(new t(400,400,this,!0,2)),this.widgets.push(new t(700,550,this,!0,7)),this.widgets.push(new i(600,400,this,!1,3)),this.widgets.push(new e(1e3,550,this,!0,"green",4)),this.widgets.push(new e(1100,600,this,!0,"red",5)),this.buttons.push(new s(0,250,this,100,60,"Move","MOVE")),this.buttons.push(new s(0,320,this,100,60,"Connect","CONNECT")),this.buttons.push(new s(0,390,this,100,60,"Cut","CUT")),this.buttons[0].isToggled=!0,this.widgets[0].canConnect=!0,this.widgets[1].canConnect=!0,this.widgets[2].canConnect=!0,this.dialogs.push(new n(200,200,this,1100,400))},render:function(){this.ctx.clearRect(0,0,this.gameSize.w,this.gameSize.h);var t=this.ctx.createLinearGradient(0,0,0,768);t.addColorStop(0,"#5cbcfc"),t.addColorStop(1,"#048ae3"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,1366,768);for(var i=Object.keys(this.connections),e=0;e<i.length;e++){var n=this.connections[i[e]];this.ctx.beginPath(),this.ctx.strokeStyle="yellow",this.ctx.lineWidth=2,this.ctx.moveTo(n.x1,n.y1),this.ctx.lineTo(n.x2,n.y2),this.ctx.stroke()}for(e=0;e<this.widgets.length;e++)this.widgets[e].r(this.ctx);for(e=0;e<this.buttons.length;e++)this.buttons[e].r(this.ctx);for(e=0;e<this.dialogs.length;e++)this.dialogs[e].r(this.ctx)},update:function(){for(var t=0;t<this.widgets.length;t++)this.widgets[t].u()},switchState:function(){switch(this.activeConnection=null,this.STATE){case h.STATES.MOVE:this.canvas.style.cursor="auto";break;case h.STATES.CUT:this.canvas.style.cursor="no-drop";break;case h.STATES.CONNECT:case h.STATES.CONNECT1:this.canvas.style.cursor="crosshair"}}},window.addEventListener("load",(function(){new h}))}()</script>