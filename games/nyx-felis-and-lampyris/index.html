<!DOCTYPE html>
<html>
<head>
<title>Nyx Felis and Lampyris - js13kGames 2025</title>
<meta name=viewport content=width=device-width>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='6' fill='%23ffdd00'/%3E%3C/svg%3E">

<style>
body{margin:0;overflow:hidden;background:#101020}
#c{display:block;width:100vw;height:100vh;cursor:none}
</style>
</head>
<body>
<canvas id=c></canvas>
<script>const e=2*Math.PI,t=Math.floor,a=Math.random,o=Math.sin,l=Math.cos,i=240,n={title:"'Times New Roman', 'Georgia', serif",body:"'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif",mono:"'Lucida Console', 'Courier New', monospace"},r=(e,t,a)=>Math.max(t,Math.min(a,e)),s=(e,t)=>Math.hypot(e,t),f=e=>B.fillStyle=e,c=e=>B.strokeStyle=e,d=e=>B.lineWidth=e,u=(e=1)=>`rgba(0,0,0,${e})`,h=()=>Math.max(1,t(oe/100)+1);let m;const p=()=>{if(!m)try{m=new AudioContext}catch(e){return!1}return"suspended"===m.state&&m.resume().catch(()=>!1),"running"===m.state||"suspended"===m.state},g=(e,t=.2,a=.1)=>{if(!he||!p())return;const o=m.createOscillator(),l=m.createGain();o.frequency.value=e,l.gain.value=a,l.gain.exponentialRampToValueAtTime(.01,m.currentTime+t),o.connect(l).connect(m.destination),o.start(),o.stop(m.currentTime+t)};let x=null;const y=()=>{x&&(x.oscillators.forEach(e=>{try{e.stop()}catch(e){}}),x=null)};let T=null,b=null,w=!1,v=!1;const $={A3:220,C4:261.63,D4:293.66,E4:329.63,G4:392,A4:440,C5:523.25,D5:587.33,E5:659.25,G5:783.99},E=(e,t=1)=>{b&&(b.gain.cancelScheduledValues(m.currentTime),b.gain.exponentialRampToValueAtTime(Math.max(.001,e),m.currentTime+t))},S=()=>{!v&&he&&p()&&"suspended"!==m.state&&(v=!0,(()=>{if(!m)return;const e=m.createOscillator(),t=m.createGain();e.frequency.value=440,e.type="sine",t.gain.value=.3,t.gain.exponentialRampToValueAtTime(.01,m.currentTime+.5),e.connect(t).connect(m.destination),e.start(),e.stop(m.currentTime+.5)})(),setTimeout(()=>{he&&me&&le&&M()},600)),!v||!he||T&&w||M()},M=()=>{if(he){if(!v){if(!p()||"suspended"===m.state)return;v=!0}T||(()=>{if(!he||!p()||T)return;b=m.createGain(),b.gain.value=0,b.connect(m.destination);let e=[];const t=[{note:"A4",beat:0},{note:"C5",beat:2.5},{note:"E5",beat:5},{note:"D5",beat:7.5},{note:"G4",beat:10},{note:"A4",beat:12},{note:"C4",beat:15}],a=[{note:"A3",beat:0},{note:"A3",beat:8}],o=(t,a,o=!1)=>{const l=setTimeout(()=>{if(!T)return;const e=m.createOscillator(),a=m.createGain(),l=m.createBiquadFilter();e.type="sine",e.frequency.value=t,l.type="lowpass",l.frequency.value=o?400:1e3,l.Q.value=.1;const i=m.currentTime,n=o?.03:.04;a.gain.setValueAtTime(0,i),a.gain.linearRampToValueAtTime(n,i+.02),a.gain.exponentialRampToValueAtTime(.3*n,i+.3),a.gain.exponentialRampToValueAtTime(.001,i+2),e.connect(l).connect(a).connect(b),e.start(i),e.stop(i+2)},1e3*a);e.push(l)},l=()=>{e.forEach(clearTimeout),e=[],a.forEach(({note:e,beat:t})=>{o($[e],t,!0)}),t.forEach(({note:e,beat:t})=>{o($[e],t,!1)});const i=setTimeout(()=>{T&&w&&l()},2e4);e.push(i)};T={cleanup:()=>{e.forEach(clearTimeout),e=[]},playGentlePattern:l},w=!1})(),T&&!w&&(E(.22,3),w=!0,setTimeout(()=>{T&&w&&T.playGentlePattern()},1e3))}};let C,B,A,D,k=!1;const P=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2;let O=0,L=0,R=0,q=0,G=!1,I=0,F=!1,V=0,N=!0,z=!1,H=0,Y=0,W=100,Q=0,U=!1,K=!1,j=0,J=!1,X=0,Z=0,_=!1,ee=0,te=0,ae=!1,oe=0,le=!0,ie=!1,ne=null,re=0,se=0,fe=0,ce=0,de=null,ue=null,he=!0,me=!0,pe=0,ge=!1,xe="gold",ye=0,Te=600,be=!1,we=!1,ve=0,$e="true"===localStorage.getItem("tutorialComplete"),Ee=0,Se=!1,Me=0,Ce=0,Be=0,Ae=0,De=!1,ke=!1,Pe=0,Oe=!1,Le=0,Re=0,qe=[],Ge=[],Ie=[],Fe=[],Ve=[],Ne=[],ze={active:!1,text:"",life:0,maxLife:180,summonCount:0},He=0;const Ye=()=>{Ve=[];for(let t=0;t<100;t++){const t=a();let o,l;t<.3?(o=0,l=.4*a()+.6):t<.6?(o=.005*a()+.002,l=.6*a()+.3):(o=.01*a()+.005,l=.5*a()+.3),Ve.push({x:a()*A,y:a()*D,size:1.2*a()+.3,alpha:l,twinkleSpeed:o,twinkleOffset:a()*e,type:"regular"})}for(let t=0;t<200;t++)Ve.push({x:a()*A,y:a()*D,size:.3*a()+.1,alpha:.3*a()+.1,twinkleSpeed:.003*a()+.001,twinkleOffset:a()*e,type:"dust"});const t=.7*A,i=.3*D,n=.6*A,r=.4*D;for(let s=0;s<80;s++){const s=a()*e,f=(.8*a()+.2)*n/2,c=(.6*a()+.2)*r/2,d=t+l(s)*f,u=i+o(s)*c;d>=0&&d<=A&&u>=0&&u<=D&&Ve.push({x:d,y:u,size:.4*a()+.1,alpha:.4*a()+.1,twinkleSpeed:.002*a()+5e-4,twinkleOffset:a()*e,type:"milkyway"})}},We=(t,a,o,l)=>{const i=.2*o;B.fillRect(t-i/2,a,i,.3*l),B.beginPath(),B.arc(t,a-.2*l,.6*o,0,e),B.fill(),B.beginPath(),B.arc(t-.2*o,a-.4*l,.4*o,0,e),B.fill(),B.beginPath(),B.arc(t+.15*o,a-.35*l,.45*o,0,e),B.fill()},Qe=[{len:110,yOff:45,spread:-25},{len:140,yOff:55,spread:0},{len:110,yOff:65,spread:25}],Ue=()=>{let e;switch(xe){case"gold":default:e={hex:"#ffdd00",r:255,g:221,b:0};break;case"purple":e={hex:"#8844ff",r:136,g:68,b:255};break;case"pink":e={hex:"#ff44aa",r:255,g:68,b:170}}return e.rgba=(t=1)=>`rgba(${e.r}, ${e.g}, ${e.b}, ${t})`,e},Ke=()=>{Ne=[{x:A/2,y:.1*D,blinkTimer:0,isBlinking:!1,blinkDuration:0}]},je=(t,a,l,i,n)=>{const r=a+130*t;for(let a=0;a<Qe.length;a++){const s=Qe[a],c=l+s.yOff,d=1===a?15:8,u=r+t*s.len,h=c+s.spread+i+d;B.beginPath(),B.moveTo(r,c);const m=r+t*(.7*s.len),p=c+.5*(s.spread+i);B.quadraticCurveTo(m,p,u,h),B.stroke();const g=1===a?2:1;for(let l=0;l<g;l++){const u=2===g?(l+1)/3:.6,h=r+t*(s.len*u),m=c+(s.spread+i+d)*u*.7;let p=.5*o(.002*n+2.2*l+3.1*a)+.5;p=.5*(p+(.4*o(.003*n+1.8*l+2.4*a)+.6)),p+=.7*ve;const x=.2+Math.min(.8,.8*p);if(f(`rgba(255, 255, 255, ${x})`),B.beginPath(),B.arc(h,m,1.5,0,e),B.fill(),p>.6||ve>.3){const t=Math.min(1,p+.5*ve);B.shadowBlur=4+3*t,B.shadowColor=`rgba(255, 255, 255, ${.6*t})`,B.beginPath(),B.arc(h,m,.75+.5*t,0,e),B.fill(),B.shadowBlur=0}}}},Je=a=>{if(0===Ne.length)return;const l=Ne[0],n=l.x,u=l.y,h=A/2,m=.2*D,p=O-h,g=L-m,x=p*p+g*g;ve=Math.max(0,1-s(p,g)/150),we=x<6400;const y=Te-ye;let T=1;if(y<=i&&($e||Ee>=2)&&Ge.some(e=>e.captured)){const e=i-y;(e>=80&&e<100||e>=160&&e<180||e>=200&&e<220)&&(T=1.5)}const b=Ue(),w=b.hex,v=b.hex+"ff",$=O-n,E=L-u,S=Math.sqrt((O-h)*(O-h)+(L-m)*(L-m)),M=4+8*Math.max(0,1-S/200),C=Math.min(8,(85-M)/2-5),k=r(.03*$,-C,C),P=r(.03*E,-C,C);if(!l.isBlinking){const a=30*T,o=50*T;B.shadowColor=v,B.shadowBlur=o,B.save(),B.translate(n-120,u),B.rotate(.3),B.fillStyle=w+t(90*T).toString(16).padStart(2,"0"),B.beginPath(),B.ellipse(0,0,85,28,0,0,e),B.fill(),B.restore(),B.save(),B.translate(n-120,u),B.rotate(.3),B.shadowBlur=a,B.fillStyle=w+t(45*T).toString(16).padStart(2,"0"),B.beginPath(),B.ellipse(0,0,95,33,0,0,e),B.fill(),B.restore(),B.save(),B.translate(n+120,u),B.rotate(-.3),B.fillStyle=w+t(90*T).toString(16).padStart(2,"0"),B.beginPath(),B.ellipse(0,0,85,28,0,0,e),B.fill(),B.restore(),B.save(),B.translate(n+120,u),B.rotate(-.3),B.shadowBlur=a,B.fillStyle=w+t(45*T).toString(16).padStart(2,"0"),B.beginPath(),B.ellipse(0,0,95,33,0,0,e),B.fill(),B.restore(),B.shadowBlur=0,B.fillStyle="#0a0a1a",B.save(),B.translate(n-120+k,u+P),B.rotate(.3),B.beginPath(),B.ellipse(0,0,M,20,0,0,e),B.fill(),B.restore(),B.save(),B.translate(n+120+k,u+P),B.rotate(-.3),B.beginPath(),B.ellipse(0,0,M,20,0,0,e),B.fill(),B.restore()}let R=.4,q=0;if(we){const e=(.5*o(.008*a)+.5)*(.3*o(.012*a+1.5)+.7);R=.4+.8*ve+e*ve*.5,q=35*ve+e*ve*20}B.strokeStyle=`rgba(255, 255, 255, ${R})`,B.lineWidth=1.5,B.globalAlpha=R,q>0&&(B.shadowBlur=q,B.shadowColor="rgba(255, 255, 255, 0.9)"),B.beginPath(),B.moveTo(n-8,u+40),B.lineTo(n+8,u+40),B.lineTo(n,u+52),B.closePath(),B.stroke(),B.shadowBlur=0;const G=.5*o(.003*a)+.5,I=.3+.5*G+.8*ve,F=12*G+25*ve,V=L<.65*D,N=V&&we?o(.02*a)*ve*3:0;c(`rgba(255, 255, 255, ${Math.min(1,I)})`),d(1),B.globalAlpha=Math.min(1,I),F>0&&(B.shadowBlur=F,B.shadowColor="rgba(255, 255, 255, 0.5)"),je(-1,n,u,N,a),je(1,n,u,N,a),B.shadowBlur=0,B.globalAlpha=1,((t,a,l,i)=>{const n=t,r=a+85,s=i?.6:.2,c=i?.4*ve:0;for(let t=0;t<6;t++){const a=t/5,d=n-20-70*a,u=r+18*o(a*Math.PI),h=.5*o(l*(i?.006:.002)+1.3*t)+.5,m=s+.3*h+c,p=1+.4*h+.5*c;B.shadowColor=`rgba(255, 255, 255, ${.9*m})`,B.shadowBlur=3*p,f(`rgba(255, 255, 255, ${m})`),B.beginPath(),B.arc(d,u,p,0,e),B.fill(),B.shadowBlur=0}for(let t=0;t<6;t++){const a=t/5,d=n+20+70*a,u=r+18*o(a*Math.PI),h=.5*o(l*(i?.006:.002)+.9*(t+6))+.5,m=s+.3*h+c,p=1+.4*h+.5*c;B.shadowColor=`rgba(255, 255, 255, ${.9*m})`,B.shadowBlur=3*p,f(`rgba(255, 255, 255, ${m})`),B.beginPath(),B.arc(d,u,p,0,e),B.fill(),B.shadowBlur=0}const d=.5*o(l*(i?.005:.002)+2.7)+.5,u=s+.3*d+c;B.shadowColor=`rgba(255, 255, 255, ${.8*u})`,B.shadowBlur=4,f(`rgba(255, 255, 255, ${u})`),B.beginPath(),B.arc(n,r+12.6,.8+.3*d+.3*c,0,e),B.fill(),B.shadowBlur=0})(n,u,a,V)},Xe=(e,a)=>{const o=Te-ye;let l,n;o>=165&&o<=175?(l=1,n="PERFECT",Ge.forEach(e=>{e.captured||(e.perfectlyProtected=!0)})):o>=80&&o<=160?(l=.95,n="GREAT"):o>=200&&o<=i?(l=.85,n="GOOD"):(l=.7,n="LATE");const r=t(e.length*(1-l)),s=e.length-r;let f;r>0&&(oe-=r,et(r)),J=!1,y(),X=180+4*t(oe/50),g({PERFECT:300,GREAT:250,GOOD:200,LATE:180}[n],.2,.12),f=0===r?"SHIELD":`-${r}`,ot(),at(f,A/2,D/2-80,tt(n),300),!$e&&2===Ee&&s>0&&(Ee=3,De=!1)},Ze=()=>{const e=["pink","purple","gold"];let o;do{o=e[t(a()*e.length)]}while(o===xe);xe=o,ye=0,be=!1},_e=()=>{const e=(Date.now()-(de||Date.now()))/6e4;let o=600,l=1200;if(e>2){const a=Math.min(1,(e-2)/3);o=t(600-300*a),l=t(1200-500*a)}if(e>5){const a=Math.min(1,(e-5)/3);o=t(300-120*a),l=t(700-200*a)}Te=o+t(a()*(l-o))},et=e=>{let t=0;Ge.forEach(a=>{a.captured&&t<e&&(a.captured=!1,t++)})},tt=e=>({LATE:"#ff8844",GOOD:"#ffdd00",GREAT:"#88ff44",PERFECT:"#00ff88"}[e]||"#ffaa00"),at=(e,t,a,o="#ffffff",l=180)=>{Ie.push({text:e,x:t,y:a,life:0,maxLife:l,color:o})},ot=()=>{Ie=Ie.filter(e=>!(e.text.includes("SHIELD")||e.text.includes("PERFECT")||e.text.includes("GREAT")||e.text.includes("GOOD")||e.text.includes("LATE")))},lt=()=>{Ge.length>=35||Ge.push({x:a()*A,y:.65*D+a()*D*.33,captured:!1,captureOffset:{x:0,y:0},floatTimer:a()*e,flashTimer:a()*e,roamTarget:null,fadeIn:0,glowIntensity:.5+.5*a(),size:2+2*a()})},it=(e,t,a)=>{const i=t+e.captureOffset.x,n=a+e.captureOffset.y;e.x+=.15*(i-e.x),e.y+=.15*(n-e.y),e.x+=.3*o(e.floatTimer),e.y+=.2*l(1.3*e.floatTimer)},nt=(e,t,i,n)=>{if(e.fadeIn<1)return void(e.fadeIn+=.03);if(z&&!U&&((e,t,a,o)=>(e-=a)*e+(t-=o)*t)(e.x,e.y,t,i)<625)return void rt(e,t,i);if(U){const a=s(e.x-t,e.y-i);if(a<80){const o=Math.atan2(e.y-i,e.x-t),l=(80-a)/80*2;e.x+=Math.cos(o)*l,e.y+=Math.sin(o)*l}}(!e.roamTarget||Math.abs(e.x-e.roamTarget.x)<30&&Math.abs(e.y-e.roamTarget.y)<30)&&(e.roamTarget={x:a()*A,y:.65*D+a()*D*.33});const f=e.roamTarget.x-e.x,c=e.roamTarget.y-e.y,d=s(f,c);if(d>5){const t=(.3+.2*a())*n;e.x+=f/d*t,e.y+=c/d*t}e.x+=.2*o(e.floatTimer)*n,e.y+=.15*l(1.3*e.floatTimer)*n,e.x=r(e.x,20,A-20),e.y=r(e.y,.65*D,D-20)},rt=(t,i,n)=>{t.captured=!0,t.captureOffset.x=t.x-i+20*(a()-.5),t.captureOffset.y=t.y-n+20*(a()-.5),g(800,.2,.1);for(let i=0;i<5;i++){const i=a()*e;qe.push({x:t.x,y:t.y,vx:2*l(i),vy:2*o(i),life:0,maxLife:30,size:1+a(),color:"#00aaff",isBurst:!0})}},st=(t,a,i)=>{if(!N&&!z)return;const n=F||z,r=n?0:3*o(.004*i),s=t+(n?0:1.5*o(.0025*i)),c=a+r,d=(n?.9:.6)+.5*(.5*o(.002*i)+.5);let u,h;if(U){const e=.1*o(.003*i)+.2;u=`rgba(80, 80, 80, ${e})`,h=`rgba(60, 60, 60, ${.3*e})`}else u=`rgba(140, 200, 255, ${d})`,h=`rgba(180, 220, 255, ${.6*d})`;const m=18+((z?40:28)-18)*d,p=B.createRadialGradient(s,c,0,s,c,m);p.addColorStop(0,h),p.addColorStop(.3,`rgba(180, 220, 255, ${.25*d})`),p.addColorStop(.7,`rgba(140, 200, 255, ${.1*d})`),p.addColorStop(1,"transparent"),f(p),B.beginPath(),B.arc(s,c,m,0,e),B.fill();const g=B.createRadialGradient(s,c,0,s,c,10);if(g.addColorStop(0,u),g.addColorStop(.5,`rgba(180, 220, 255, ${.7*d})`),g.addColorStop(1,"transparent"),f(g),B.beginPath(),B.arc(s,c,10,0,e),B.fill(),f(u),B.save(),B.translate(s,c),B.scale(1,.75),B.beginPath(),B.arc(0,0,3,0,e),B.fill(),B.restore(),!U){const t=z?8:4,a=16+4*o(.003*i);for(let n=0;n<t;n++){const r=(8e-4*i+n*e/t+o(.002*i+n))%e,u=a+6*o(.005*i+2*n),h=s+l(r)*u,m=c+o(r)*u,p=.5*o(.006*i+1.2*n)+.5,g=p*d*.6;g>.1&&(B.shadowColor="#aaccff",B.shadowBlur=4,f(`rgba(220, 240, 255, ${g})`),B.beginPath(),B.arc(h,m,.8+.5*p,0,e),B.fill(),B.shadowBlur=0)}}},ft=e=>{for(let t=0;t<3;t++)qe.push({x:e.x,y:e.y,vx:3*(a()-.5),vy:3*(a()-.5),size:1+a(),life:0,maxLife:20+15*a(),color:"#ff6666",alpha:.7,glow:!0})},ct=e=>{k||(R=O,q=L,O=e.clientX,L=e.clientY,N=!0,K||(F=!0,V=Date.now(),z=!0))},dt=t=>{if(S(),!k){if(ke)return Re+=Date.now()-Le,void(ke=!1);(ie||ge)&&bt(),G=!0,I=Date.now(),ae=!1,xt()&&setTimeout(()=>{G&&Date.now()-I>=150&&W>0&&!J&&0===X&&!U&&Tt(!0)},150),((t,i)=>{for(let n=0;n<8;n++){const r=n/8*e;Fe.push({x:t,y:i,vx:l(r)*(2+3*a()),vy:o(r)*(2+3*a()),size:1+2*a(),life:0,maxLife:30+20*a()})}})(O,L)}},ut=e=>{if(k)return;if(!le||ie)return;const t=Date.now()-I;G=!1,t<150&&(gt()?yt():xt()&&(Tt(!1),setTimeout(()=>{J&&(J=!1,y(),X=0)},100))),ae=!1},ht=e=>{if(S(),k)"KeyM"===e.code&&(e.preventDefault(),he=!he);else{if(ke){if(e.preventDefault(),"ArrowUp"===e.code||"KeyW"===e.code)return void(Pe=Math.max(0,Pe-30));if("ArrowDown"===e.code||"KeyS"===e.code){const e=window.helpMaxScroll||400;return void(Pe=Math.min(e,Pe+30))}return Re+=Date.now()-Le,ke=!1,void(Pe=0)}if("KeyM"===e.code)return e.preventDefault(),he=!he,void(he&&le&&!ke&&me?(v||S(),setTimeout(M,100)):(T&&(T.cleanup&&T.cleanup(),T=null,w=!1),y()));if("Escape"===e.code)return e.preventDefault(),ke?Re+=Date.now()-Le:Le=Date.now(),void(ke=!ke);if("Space"===e.code){if(e.preventDefault(),!le)return void(le=!0);!_&&xt()&&(ee=Date.now(),te=ee,ae=!1,setTimeout(()=>{_&&te===ee&&Tt(!0)},150)),_=!0}}},mt=e=>{k||"Space"!==e.code||(Date.now()-ee<150&&(gt()?yt():xt()&&(Tt(!1),setTimeout(()=>{J&&(J=!1,y(),X=0)},100))),_=!1,ae=!1)},pt=e=>{if(!ke)return;e.preventDefault();const t=e.deltaY>0?30:-30,a=window.helpMaxScroll||400;Pe=Math.max(0,Math.min(a,Pe+t))},gt=()=>!U&&W>=10,xt=()=>W>0&&0===X&&!U,yt=()=>{if(!gt())return void(U&&(j=Date.now()));Q+=25,W=Math.max(0,W-10),ze.active?ze.summonCount++:(ze.active=!0,ze.text="Summoning fireflies...",ze.life=0,ze.summonCount=1),He=Date.now();const t=O+100*(a()-.5),i=L+100*(a()-.5);Ge.push({x:r(t,50,A-50),y:r(i,.65*D,D-50),captured:!1,captureOffset:{x:0,y:0},floatTimer:a()*e,flashTimer:a()*e,roamTarget:null,fadeIn:0,glowIntensity:.5+.5*a(),size:2+2*a()}),((t,i)=>{for(let n=0;n<6;n++){const n=a()*e;qe.push({x:t,y:i,vx:l(n)*(1+2*a()),vy:o(n)*(1+2*a()),size:1+a(),life:0,maxLife:40+20*a(),color:"#88ff88",glow:!0})}})(t,i),g(400,.15,.06),Y=50},Tt=(e=!1)=>{U?j=Date.now():(J=!0,Z=Date.now(),((e=!1)=>{e?(()=>{if(!he||!p()||x)return;x={oscillators:[],gains:[],filters:[]};const e=[.018,.011,.006,.003];[1,1.5,2,3].forEach((t,a)=>{const o=m.createOscillator(),l=m.createGain(),i=m.createBiquadFilter(),n=m.createOscillator(),r=m.createGain();o.type="sine",o.frequency.value=120*t,i.type="lowpass",i.frequency.value=400+100*t,i.Q.value=.5,n.type="sine",n.frequency.value=.2+.1*a,r.gain.value=.3*e[a],l.gain.value=e[a],n.connect(r),r.connect(l.gain),o.connect(i),i.connect(l),l.connect(m.destination),o.start(),n.start(),x.oscillators.push(o,n),x.gains.push(l,r),x.filters.push(i)})})():he&&p()&&[800,1200].forEach((e,t)=>{const a=m.createOscillator(),o=m.createGain();a.frequency.value=e,a.type="sine",o.gain.value=.08*(0===t?1:.6),o.gain.exponentialRampToValueAtTime(.01,m.currentTime+.3),a.connect(o).connect(m.destination),a.start(),a.stop(m.currentTime+.3)})})(e),$e||0!==Ee||(Ee=1))},bt=()=>{let e;ie=!1,ge=!1,ne=null,le=!0,oe=0,re=0,se=0,fe=0,ce=0,H=0,z=!1,F=!1,_=!1,te=0,ae=!1,qe=[],Ge=[],Ie=[],Fe=[],xe="gold",ye=0,Te=600+t(300*a()),be=!1,Q=0,U=!1,K=!1,W=100,J=!1,y(),X=0,Z=0,he&&me&&E(.22,1),$e=!1,Ee=0,Ce=0,Be=0,Ae=0,De=!1,Se=!1,Oe=!0,de=Date.now(),ue=Date.now(),Re=0,Le=0,pe=Date.now(),e=$e?25:0===Ee?8:15;for(let t=0;t<e;t++)lt();g(600,.2,.1)};function wt(){const t=Date.now(),{x:r,y:x}={x:O,y:L};if(!(ie||ge||k||ke)&&((()=>{if(!$e&&Ee<2)return void Ne.forEach(e=>{e.blinkTimer++,!e.isBlinking&&e.blinkTimer>1200?(e.isBlinking=!0,e.blinkDuration=10,e.blinkTimer=0):e.isBlinking&&(e.blinkDuration--,e.blinkDuration<=0&&(e.isBlinking=!1))});ye++;const e=Te-ye<=i;e&&!be&&Ge.some(e=>e.captured)&&g(1e3,.1,.08),be=e,ye>=Te&&((()=>{const e=Ge.filter(e=>e.captured);e.length>0&&(J?Xe(e):(e=>{const t=Math.ceil(.5*e.length);let a;e.length,oe-=t,se+=t,ot(),a=t>0?`-${t}`:"NO LOSS",at(a,A/2,D/2-60,"#ffaa44",300),$e||2!==Ee||(De=!0),et(t),e.length-t>0?z=!0:(z=!1,H=0);for(let a=0;a<t;a++)e[a]&&ft(e[a]);X=Math.max(0,X-30),g(150,.3,.1)})(e));const t=Ge.filter(e=>!e.captured);if(t.length>0&&!J){const a=Math.ceil(.5*t.length);t.length;for(let e=0;e<a&&t.length>0;e++){const e=Math.floor(Math.random()*t.length),a=t.splice(e,1)[0],o=Ge.indexOf(a);o>-1&&Ge.splice(o,1)}se+=a,0===e.length&&(ot(),at(`-${a}`,A/2,D/2,"#ffaa44",300))}Ze()})(),_e()),Ne.forEach(e=>{e.blinkTimer++,!e.isBlinking&&e.blinkTimer>1200?(e.isBlinking=!0,e.blinkDuration=10,e.blinkTimer=0):e.isBlinking&&(e.blinkDuration--,e.blinkDuration<=0&&(e.isBlinking=!1))})})(),(e=>{const t=e-V;if(Math.abs(O-R)>5||Math.abs(L-q)>5?(F=!0,V=e,z=!0):t>300&&(F=!1),H=F||z?Math.min(100,H+2):Math.max(0,H-1),Y>0&&(Y=Math.max(0,Y-3)),Q>0&&(Q=Math.max(0,Q-.2)),Q>=100&&!U&&(U=!0,K=!0,overheatCooldown=180,at("OVERHEATED!",O,L-30,"#ff4444",300),g(200,.5,.1),$e||1!==Ee||(Ee=1.5),Ge.forEach(e=>{if(e.captured){e.captured=!1;const t=Math.atan2(e.y-L,e.x-O),o=8+4*a();e.vx=Math.cos(t)*o,e.vy=Math.sin(t)*o,e.vx+=6*(a()-.5),e.vy+=6*(a()-.5)}})),U&&(overheatCooldown--,overheatCooldown<=0&&(K=!1,U=!1,overheatCooldown=0)),ze.active&&(ze.life++,Date.now()-He>500&&ze.summonCount>0&&(ze.text=`Summoned ${ze.summonCount} firefl${1===ze.summonCount?"y":"ies"}`,ze.life=0,ze.maxLife=120,ze.summonCount=0),ze.life>=ze.maxLife&&(ze.active=!1)),X>0&&X--,J){const e=_||G;!e||W<=0||U?(J=!1,y(),X=e?60:0):(W=Math.max(0,W-.1),Q+=.4)}})(t),((e,t)=>{const o=1+oe/200;Ge.forEach(l=>{l.captured?it(l,e,t):nt(l,e,t,o),l.floatTimer+=.02+.01*a(),l.flashTimer+=.006+.004*a()})})(r,x),qe.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.life++,e.isBurst||(e.vy+=.1,e.vx*=.98,e.vy*=.98)}),qe=qe.filter(e=>e.life<e.maxLife),Fe.forEach(e=>{e.life++,e.x+=e.vx,e.y+=e.vy,e.vx*=.95,e.vy*=.95}),Fe=Fe.filter(e=>e.life<e.maxLife),z&&((e,t)=>{if(s(e-A/2,t-.2*D)<80){const e=Ge.filter(e=>e.captured),t=h();e.length>=t&&(e=>{fe++,ce=Math.max(ce,fe);const t=e.length,a=Math.min(3,1+.5*(fe-1)),o=Math.floor(t*a);oe+=o,re+=e.length,Ge=Ge.filter(e=>!e.captured),Q=Math.max(0,Q-15*e.length),U&&Q<=40&&(U=!1);const l=5*e.length;W=Math.min(100,W+l);let i="#00ff00";fe>=5?i="#ffaa00":fe>=3&&(i="#88ff88"),at(`+${o}`,A/2,D/2,i,180);const n=Math.min(3,e.length);for(let e=0;e<n;e++)lt();if(g(600,.3,.12),!Se&&(Se=!0,Oe=!1,!$e&&0===Ee)){Ee=1,Ce=0;for(let e=0;e<8;e++)lt()}$e||1.5!==Ee||(Ee=2,ye=0,_e())})(e)}})(r,x),!ge&&!ie&&de&&Date.now()-de>=6e5&&(ge=!0,at("YOU SURVIVED THE NIGHT!",A/2,D/2,"#ffdd00",600),he&&p()&&[{freq:110,time:0,duration:4,volume:.06,type:"sine"},{freq:165,time:.2,duration:3.8,volume:.04,type:"sine"},{freq:264,time:.5,duration:1.2,volume:.08,type:"triangle"},{freq:330,time:.8,duration:1.2,volume:.07,type:"triangle"},{freq:396,time:1.1,duration:1.2,volume:.06,type:"triangle"},{freq:523,time:1.5,duration:.8,volume:.09,type:"sine"},{freq:659,time:2,duration:.8,volume:.08,type:"sine"},{freq:784,time:2.5,duration:1,volume:.07,type:"sine"},{freq:1047,time:3,duration:1.5,volume:.06,type:"sine"},{freq:1319,time:3.2,duration:.6,volume:.03,type:"sine"},{freq:1568,time:3.5,duration:.6,volume:.02,type:"sine"},{freq:2093,time:3.8,duration:.8,volume:.02,type:"sine"}].forEach(({freq:e,time:t,duration:a,volume:o,type:l})=>{setTimeout(()=>{if(!he)return;const t=m.createOscillator(),i=m.createGain(),n=m.createBiquadFilter();t.type=l,t.frequency.value=e,n.type="lowpass",e<200?(n.frequency.value=300,n.Q.value=.3):e>1e3?(n.frequency.value=.8*e,n.Q.value=.5):(n.frequency.value=1200,n.Q.value=.4);const r=m.currentTime;i.gain.setValueAtTime(0,r),i.gain.linearRampToValueAtTime(o,r+.2),i.gain.setValueAtTime(o,r+.6*a),i.gain.exponentialRampToValueAtTime(.001,r+a),t.connect(n).connect(i).connect(m.destination),t.start(r),t.stop(r+a)},1e3*t)}),E(.25,2)),!ie&&!ge&&W<=0&&0===Ge.length&&(ie=!0,ne=Date.now(),at("Game Over!",A/2,D/2,"#ff4444",300),he&&p()&&[{freq:55,time:0,duration:3,volume:.08,type:"sawtooth"},{freq:1760,time:.3,duration:.8,volume:.03,type:"sine"},{freq:220,time:.8,duration:1.5,volume:.06,type:"triangle"},{freq:233,time:.9,duration:1.4,volume:.05,type:"triangle"},{freq:392,time:1.5,duration:.7,volume:.04,type:"sine"},{freq:370,time:2,duration:.8,volume:.04,type:"sine"},{freq:349,time:2.5,duration:1,volume:.03,type:"sine"}].forEach(({freq:e,time:t,duration:a,volume:o,type:l})=>{setTimeout(()=>{if(!he)return;const t=m.createOscillator(),i=m.createGain(),n=m.createBiquadFilter();t.type=l,t.frequency.value=e,n.type="lowpass",e<100?(n.frequency.value=150,n.Q.value=2):e>1e3?(n.type="bandpass",n.frequency.value=e,n.Q.value=5):(n.frequency.value=400,n.Q.value=.8);const r=m.currentTime;i.gain.setValueAtTime(0,r),i.gain.linearRampToValueAtTime(o,r+.3),i.gain.setValueAtTime(o,r+.7*a),i.gain.exponentialRampToValueAtTime(.001,r+a),t.connect(n).connect(i).connect(m.destination),t.start(r),t.stop(r+a)},1e3*t)}),E(.03,3)),!ie&&le&&de)){const e=(t-de)/6e4,o=Math.max(3e3,8e3-1e3*e);if(t-pe>o/(1+.1*fe)&&Ge.length<35&&(lt(),pe=t,e>2&&a()<.05*e&&lt()),Ge.length<=3&&!$e)for(let e=0;e<3;e++)lt();else if(Ge.length<=5&&$e&&W<50)for(let e=0;e<4;e++)lt()}if(ie||ge||k||(Ie.forEach(e=>{e.life++,e.y-=.5}),Ie=Ie.filter(e=>e.life<e.maxLife)),(t=>{f("#0a0a1a"),B.fillRect(0,0,A,D),Ve.forEach(a=>{let l;if(0===a.twinkleSpeed)l=a.alpha;else{const e=.4*o(t*a.twinkleSpeed+a.twinkleOffset)+.6;l=a.alpha*e}f(`rgba(255, 255, 255, ${l})`),B.beginPath(),B.arc(a.x,a.y,a.size,0,e),B.fill()})})(t),(()=>{f("#1a1a0a"),B.fillRect(0,.8*D,A,.2*D),f("#0d0d0d"),We(.05*A,.8*D,80,120),We(.15*A,.75*D,100,150),We(.25*A,.82*D,60,100),We(.75*A,.85*D,70,110),We(.85*A,.78*D,90,140),We(.95*A,.83*D,65,95),B.save();const e=Ue();B.shadowColor=e.rgba(.3),B.shadowBlur=40,f("#0f0f0f"),B.beginPath(),B.moveTo(0,.6*D),B.lineTo(.3*A,.4*D),B.lineTo(.7*A,.5*D),B.lineTo(A,.3*D),B.lineTo(A,D),B.lineTo(0,D),B.closePath(),B.fill(),B.restore(),f("#0f0f0f"),B.beginPath(),B.moveTo(0,.6*D),B.lineTo(.3*A,.4*D),B.lineTo(.7*A,.5*D),B.lineTo(A,.3*D),B.lineTo(A,D),B.lineTo(0,D),B.closePath(),B.fill()})(),Je(t),h(),Ge.filter(e=>e.captured).length,B.save(),B.setLineDash([]),B.restore(),Ge.forEach(t=>{const a=t.fadeIn;if(a<=0)return;const i=.5*o(t.flashTimer)+.5,n=t.captured?.8:.6;let r,s,c;if(r=i<.1?0:i<.3?(i-.1)/.2*n:i>.8?(1-i)/.2*n:n+.4*(i-.3),r<=0)return;t.captured?(s=`rgba(120, 180, 255, ${r*a})`,c=`rgba(150, 200, 255, ${r*a*.8})`):(s=`rgba(180, 255, 140, ${r*a})`,c=`rgba(200, 255, 180, ${r*a*.8})`);const d=t.x+.8*o(t.floatTimer),u=t.y+.6*l(1.1*t.floatTimer),h=3*t.size,m=h+(8*t.size-h)*r,p=B.createRadialGradient(d,u,0,d,u,m);p.addColorStop(0,c),p.addColorStop(.2,`rgba(${t.captured?"150, 200, 255":"200, 255, 180"}, ${r*a*.4})`),p.addColorStop(.5,`rgba(${t.captured?"120, 180, 255":"180, 255, 140"}, ${r*a*.15})`),p.addColorStop(1,"transparent"),f(p),B.beginPath(),B.arc(d,u,m,0,e),B.fill();const g=2*t.size,x=B.createRadialGradient(d,u,0,d,u,g);x.addColorStop(0,s),x.addColorStop(.4,c),x.addColorStop(1,"transparent"),f(x),B.beginPath(),B.arc(d,u,g,0,e),B.fill(),f(s),B.save(),B.translate(d,u),B.scale(1,.8),B.beginPath(),B.arc(0,0,.7*t.size,0,e),B.fill(),B.restore()}),st(r,x,t),((t,a,i)=>{const n=Ge.filter(e=>e.captured).length,r=12+Math.min(1.5*n,8);if(B.save(),c("rgba(255, 255, 255, 0.1)"),d(1),B.beginPath(),B.arc(t,a,r,0,e),B.stroke(),W>0){const n=Math.ceil(W/100*8);for(let s=0;s<n;s++){const n=s/8*e-Math.PI/2,c=t+l(n)*r,d=a+o(n)*r,u=.3*o(.008*i+.8*s)+.7;B.shadowColor="#aaccff",B.shadowBlur=4,f(`rgba(170, 204, 255, ${.6*u})`),B.beginPath(),B.arc(c,d,1,0,e),B.fill(),B.shadowBlur=0}}if(J){const n=r+8,s=.005*i,u=.3*o(.01*i)+.7,h=U?"120, 120, 120":"170, 220, 255",m=U?"#888888":"#aaddff";for(let i=0;i<4;i++){const r=s+i*e/4,c=t+l(r)*n,d=a+o(r)*n;B.shadowColor=m,B.shadowBlur=U?3:6,f(`rgba(${h}, ${u*(U?.4:.8)})`),B.beginPath(),B.arc(c,d,1.5,0,e),B.fill(),B.shadowBlur=0}B.shadowColor=m,B.shadowBlur=U?5:10,c(`rgba(${h}, ${.4*u*(U?.5:1)})`),d(1),B.setLineDash([4,3]),B.lineDashOffset=6*-s,B.beginPath(),B.arc(t,a,n-2,0,e),B.stroke(),B.setLineDash([]),B.shadowBlur=0}B.restore()})(r,x,t),qe.forEach(t=>{const a=t.life/t.maxLife,o=1-a,l=t.size*(1-.5*a);if(t.glow){const a=B.createRadialGradient(t.x,t.y,0,t.x,t.y,3*l);a.addColorStop(0,t.color+Math.floor(255*o).toString(16).padStart(2,"0")),a.addColorStop(1,"transparent"),f(a),B.beginPath(),B.arc(t.x,t.y,3*l,0,e),B.fill()}f(t.color+Math.floor(255*o).toString(16).padStart(2,"0")),B.beginPath(),B.arc(t.x,t.y,l,0,e),B.fill()}),Fe.forEach(t=>{const a=t.life/t.maxLife,o=1-a,l=t.size*(1-.3*a);f(`rgba(255, 255, 255, ${o})`),B.beginPath(),B.arc(t.x,t.y,l,0,e),B.fill()}),Ie.forEach(e=>{const t=e.life/e.maxLife,a=1-t,o=/^[+\-]\d+$/.test(e.text.trim())||/^\+\d+\s+PERFECT!$/.test(e.text),l=e.text.includes("SHIELD")||e.text.includes("NO SHIELD");let i;if(o){const e=24,a=16;i=Math.floor(e-(e-a)*t)}else i=l?24:16;const r=l?n.body:n.mono;f(e.color+Math.floor(255*a).toString(16).padStart(2,"0")),B.font=`${i}px ${r}`,B.textAlign="center",B.fillText(e.text,e.x,e.y-.3*e.life),e.life++}),Ie=Ie.filter(e=>e.life<e.maxLife),le&&!ie){const e=Te-ye;if(e<=i&&Ge.some(e=>e.captured)){const t=i-e;(t>=80&&t<100||t>=160&&t<180||t>=200&&t<220)&&(f("rgba(200, 80, 80, 0.15)"),B.fillRect(0,0,A,D))}}(()=>{let e;if(B.save(),B.textAlign="left",e=oe<0?"#ff9999":oe<100?"#e6e6e6":oe<=200?"#99ff99":"#ffcc99",f(e),B.font=`22px ${n.body}`,B.fillText(`Cat's Curiosity: ${oe}`,20,30),fe>=2&&(f(fe>=5?"#ffcc99":"#99ff99"),B.font=`18px ${n.body}`,B.fillText(`${fe}x streak`,20,55)),de&&!ie&&!ge){let e=Date.now()-de-Re;ke&&(e-=Date.now()-Le);const t=Math.max(0,6e5-e),a=`${Math.floor(t/6e4)}:${Math.floor(t%6e4/1e3).toString().padStart(2,"0")}`;f(t<6e4?"#ff8844":t<18e4?"#ffaa00":"#88ddff"),B.font=`22px ${n.body}`,B.textAlign="right",B.fillText(a,A-20,30),B.fillText("Time: ",A-80,30)}B.textAlign="left";let t=100;if(f("#00dddd"),B.font=`18px ${n.body}`,B.fillText(`Bioluminescence: ${Math.floor(W)}`,20,t),t+=25,J?(f("#99ccff"),B.font=`18px ${n.body}`,B.fillText("SHIELD ACTIVE",20,t)):X>0?(f("#cccccc"),B.font=`18px ${n.body}`,B.fillText(`Shield: ${Math.ceil(X/60)}s`,20,t)):(f("#99ff99"),B.font=`18px ${n.body}`,B.fillText("Shield: Ready",20,t)),t+=25,ze.active){const e=1-ze.life/ze.maxLife;f(`rgba(255, 255, 255, ${e})`),B.textAlign="center",B.font=`20px ${n.body}`,B.fillText(ze.text,A/2,D/2-150)}B.textAlign="center";const a=Date.now()-j<2e3;(U||a)&&(f("#ff9999"),B.font=`18px ${n.body}`,B.fillText("OVERHEATED",O,L+30)),$e||1!==Ee||(Ce++,Ce>600&&(Ee=2,ye=0,_e())),$e||3!==Ee||(Be++,(W<=40||oe>=20||re>=5||Be>900)&&(Ee=4,Ae=0,W=Math.min(100,W+30),at("+30",A/2,D/2-50,"#00ffff",300))),$e||4!==Ee||(Ae++,(Ae>360||oe>=15||re>=3)&&(Ee=5,Ae=0)),$e||5!==Ee||(Ae++,(Ae>240||oe>=10)&&(Ee=6,Ae=0)),$e||6!==Ee||(Ae++,Ae>180&&($e=!0,localStorage.setItem("tutorialComplete","true"))),$e&&6===Ee&&(Ae++,Ae>180&&(Ee=7)),B.textAlign="right",f("#666666"),B.font=`14px ${n.body}`,B.fillText("Press 'ESC' for help • 'M' - Audio: "+(he?"ON":"OFF"),A-20,D-20),B.restore()})(),(()=>{if($e||ke)return;Me+=.02;const t=.3*o(Me)+.7;switch(B.save(),B.textAlign="center",Ee){case 0:f(`rgba(255, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Collect fireflies and lead them to Nyx Felis in the Sky",A/2,D-100),f(`rgba(255, 255, 255, ${t})`),B.fillText("",A/2,D-75),f(`rgba(100, 255, 100, ${t})`),B.fillText("Move your mouse",A/2,D-75);const a=A/2,l=.2*D,i=.3*o(2*Me)+.7;c(`rgba(128, 128, 128, ${.6*i})`),d(3),B.setLineDash([8,8]),B.beginPath(),B.arc(a,l+50,80,0,e),B.stroke(),B.setLineDash([]);break;case 1:f(`rgba(255, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Your bioluminescence attracts fireflies.",A/2,D-100),f(`rgba(100, 255, 100, ${t})`),B.fillText("Click to summon more fireflies",A/2,D-75);break;case 1.5:f(`rgba(255, 255, 255, ${t})`),B.font=`18px ${n.body}`,B.fillText("CAREFUL! Too much summoning causes overheating.",A/2,D-110),B.fillText("Turn in fireflies to restore energy and prevent overload.",A/2,D-85),f(`rgba(255, 255, 100, ${t})`),B.fillText("More fireflies delivered = faster energy recovery",A/2,D-60);break;case 2:f(`rgba(255, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Watch Nyx's eyes carefully.",A/2,D-100),f(`rgba(100, 255, 100, ${t})`),B.fillText("Hold SPACE or MOUSE when its eyes flash!",A/2,D-75),De&&(f(`rgba(255, 100, 100, ${t})`),B.font=`16px ${n.body}`,B.fillText("Shield protects your fireflies from Nyx's hunger",A/2,D-50));break;case 3:f(`rgba(255, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Overuse your powers and they'll abandon you",A/2,D-100),B.fillText("Manage resources carefully. The night is long and unforgiving",A/2,D-75);break;case 4:f(`rgba(100, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Energy restored! You're ready for the challenge.",A/2,D-100),B.fillText("Remember: Turn in fireflies to restore your power",A/2,D-75);break;case 5:f(`rgba(255, 255, 255, ${t})`),B.font=`20px ${n.body}`,B.fillText("Now... survive until dawn. If you can",A/2,D-100),f(`rgba(100, 255, 100, ${t})`),B.fillText("Press 'ESC' if you need reminding of the rules",A/2,D-75);break;case 6:f(`rgba(100, 255, 100, ${t})`),B.font=`22px ${n.body}`,B.fillText("Tutorial Complete! Survive the night...",A/2,D-100)}B.restore()})(),(()=>{if(!ke)return;f(u(.9)),B.fillRect(0,0,A,D),B.save(),B.textAlign="center",f("#d4af37"),B.font=`42px ${n.title}`,B.shadowColor="#d4af37",B.shadowBlur=8,B.fillText("Nyx Felis and Lampyris",A/2,.08*D),B.shadowBlur=0;const e=.08*D+50,t=["CONTROLS:","- Move mouse to guide Lampyris and collect fireflies","- Tap to summon fireflies (costs bioluminescence)","- Press and hold to activate protective shield (costs bioluminescence)","- ESC for help menu • M - Audio: "+(he?"ON":"OFF"),"","OBJECTIVE:","- Collect fireflies and deliver them to Nyx Felis in the Sky","- Nyx Felis feeds on light to sustain the night","- Survive until dawn (10 minutes) and live to see another night","- Build delivery streaks for bonus points","","DANGER:","- When Nyx's eyes begin to shift and change colors, be prepared","- PERFECT timing (white flash) protects ALL fireflies in view","- Good timing (yellow/green) saves most captured fireflies","- Even without shield, some fireflies may escape to safety","","STRATEGY:","- Manage bioluminescence wisely - summoning and shields costs magic","- Don't overheat Lampyris from excessive magic use","- Master perfect shield timing for maximum protection","- Watch for Nyx's eyes - she grows restless..."];B.save();const a=e,o=D-a-120;B.beginPath(),B.rect(0,a-20,A,o+20),B.clip(),t.forEach((e,t)=>{const l=a+28*t-Pe;l>a-40&&l<a+o+40&&(B.textAlign="center","CONTROLS:"===e||"OBJECTIVE:"===e||"DANGER:"===e||"STRATEGY:"===e?(f("#ce6d54"),B.shadowColor="#ce6d54",B.shadowBlur=1,B.font=`bold 22px ${n.body}`,B.fillText(e,A/2,l)):e.startsWith("- ")?(f("#ffffff"),B.shadowBlur=0,B.font=`16px ${n.body}`,B.fillText(e,A/2,l)):""!==e&&(f("#cccccc"),B.shadowBlur=0,B.font=`16px ${n.body}`,B.fillText(e,A/2,l)),B.shadowBlur=0)}),B.restore();const l=28*t.length,i=Math.max(0,l-o+60);if(400!==i&&(window.helpMaxScroll=i),i>0){if(B.textAlign="center",B.font=`14px ${n.body}`,Pe>0){const e="↑ Scroll up (Arrow keys/Mouse wheel)",t=B.measureText(e),o=a-10;f("rgba(16, 16, 32, 0.8)"),B.fillRect(A/2-t.width/2-10,o-18,t.width+20,24),f("#7fc2a4"),B.shadowColor="rgba(0, 0, 0, 0.8)",B.shadowBlur=3,B.shadowOffsetY=1,B.fillText(e,A/2,o)}if(Pe<i){const e="↓ Scroll down (Arrow keys/Mouse wheel)",t=B.measureText(e),l=a+o+20;f("rgba(16, 16, 32, 0.8)"),B.fillRect(A/2-t.width/2-10,l-18,t.width+20,24),f("#7fc2a4"),B.shadowColor="rgba(0, 0, 0, 0.8)",B.shadowBlur=3,B.shadowOffsetY=1,B.fillText(e,A/2,l)}B.shadowBlur=0,B.shadowOffsetY=0}B.textAlign="center",f("#9a9695"),B.shadowColor="#9a9695",B.shadowBlur=1,B.font=`18px ${n.body}`,B.fillText("Press ESC or click to close",A/2,D-50),B.shadowBlur=0,B.restore()})(),(()=>{if(!ie&&!ge)return;let e,t,a,o;ge?(e=6e5,t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3),o=`${t}:${a.toString().padStart(2,"0")}`):(e=ne?ne-(de||ne):0,t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3),o=`${t}:${a.toString().padStart(2,"0")}`);const l=ge?oe+1e3+50*ce:oe;f(u(.9)),B.fillRect(0,0,A,D),B.save(),B.textAlign="center";let i=D/2-120;ge?(f("#22aa22"),B.font=`52px ${n.title}`,B.shadowColor="#22aa22",B.shadowBlur=12,B.fillText("DAWN BREAKS!",A/2,i)):(f("#aa2222"),B.font=`52px ${n.title}`,B.shadowColor="#aa2222",B.shadowBlur=12,B.fillText("THE LIGHT FADES",A/2,i)),B.shadowBlur=0,i+=70,f("#bbbbbb"),B.font=`20px ${n.body}`,ge?B.fillText("You guided fireflies through the eternal night",A/2,i):B.fillText("The darkness has claimed the light",A/2,i),i+=60,f("#ffffff"),B.font=`24px ${n.body}`,B.fillText(`Fireflies Delivered: ${re}`,A/2,i),i+=40,(ge||se>0)&&(f("#ffaa66"),B.fillText(`Fireflies Lost: ${se}`,A/2,i),i+=40),f("#66aaff"),B.fillText(`Time Survived: ${o}`,A/2,i),i+=60,ge?(f("#44dd44"),B.font=`32px ${n.title}`,B.shadowColor="#44dd44",B.shadowBlur=8,B.fillText(`Nyx's Favor: ${l}`,A/2,i),B.shadowBlur=0):(f("#dd4444"),B.font=`32px ${n.title}`,B.shadowColor="#dd4444",B.shadowBlur=8,B.fillText(`Light Preserved: ${oe}`,A/2,i),B.shadowBlur=0),i+=80,f("#888888"),B.font=`18px ${n.body}`,B.fillText("Click to play again",A/2,i),B.restore()})(),(ke||ie||ge)&&N&&st(O,L,t),(()=>{if(!k)return;f(u(.95)),B.fillRect(0,0,A,D),B.save(),B.textAlign="center";const e=A/2,t=D/2;f("#9a9be9"),((e,t="body")=>{B.font=`${e}px ${n[t]}`})(32,"title"),B.shadowColor="#9a9be9",B.shadowBlur=15,B.fillText("Nyx Felis and Lampyris",e,t-120),B.shadowBlur=0,f("#ffffff"),B.font=`24px ${n.body}`,P()?(B.fillText("This mystical experience requires",e,t-60),B.fillText("a desktop or laptop computer",e,t-30)):(B.fillText("Please resize your browser window",e,t-60),B.fillText("to enjoy the full experience",e,t-30)),f("#cccccc"),B.font=`18px ${n.body}`,P()||(B.fillText("Minimum: 900 × 600 pixels",e,t+20),f("#999999"),B.font=`16px ${n.body}`,B.fillText(`Current: ${A} × ${D} pixels`,e,t+50)),f("#69e4de"),B.font=`20px ${n.body}`,B.shadowColor="#69e4de",B.shadowBlur=8,P()?(B.fillText("Please use a desktop or laptop computer",e,t+100),B.fillText("for the optimal gameplay experience",e,t+130)):(B.fillText("Try maximizing your browser window",e,t+100),B.fillText("or adjusting your zoom level",e,t+130)),B.shadowBlur=0,B.restore()})(),t%5e3<50&&(qe.length>100&&(qe=qe.slice(-50)),Fe.length>50&&(Fe=Fe.slice(-25))),requestAnimationFrame(wt)}(()=>{C=document.getElementById("c"),B=C.getContext("2d");const e=()=>{A=C.width=innerWidth,D=C.height=innerHeight,k=A<900||D<600||P(),k||(Ye(),Ke())};window.onresize=e,e(),de=Date.now(),ue=Date.now(),Ye(),Ke(),Te=600+t(300*a()),C.addEventListener("mousemove",ct),C.addEventListener("mousedown",dt),C.addEventListener("mouseup",ut),C.addEventListener("mouseleave",()=>{N=!1}),C.addEventListener("mouseenter",()=>{N=!0}),document.addEventListener("keydown",ht),document.addEventListener("keyup",mt),document.addEventListener("wheel",pt,{passive:!1}),document.addEventListener("visibilitychange",()=>{me=!document.hidden,me?he&&v&&M():(T&&w&&(E(.001,.5),w=!1),y())});const o=$e?20:8;for(let e=0;e<o;e++)lt();wt()})()</script>
</body>
</html>
