<!doctype html><title>The Maze of Space Goblins</title><meta content="width=device-width" name=viewport><body style=overflow:hidden;cursor:none;background-color:#000><script>"use strict";class n{constructor(t,i){this.key=t,this.value=i}}class p{constructor(t=!1){this.X=()=>this.g,this.g=t}}function t(t,i){let h;h=null;for(let i of t)if(!i.X()){h=i;break}return null==h&&(h=new i.prototype.constructor,t.push(h)),h}class v{constructor(t=0,i=0){this.length=()=>Math.hypot(this.x,this.y),this.clone=()=>new v(this.x,this.y),this.x=t,this.y=i}}var x=(t,i)=>new v(t.x*i,t.y*i);class da extends p{constructor(){super(),this.h=new v,this.i=0,this.j=1,this.l=0,this.speed=new v,this.g=!1}W(t,i,h,s,e=new v){this.h=new v(t,i),this.j=h,this.i=0,this.l=s,this.speed=e.clone(),this.g=!0}update(t){this.g&&(this.h.x+=this.speed.x*t.step,this.h.y+=this.speed.y*t.step,(this.i+=t.step)>=this.j&&(this.g=!1))}A(t){if(this.g){var i=Math.round(this.l*(1-this.i/this.j));t.setFillColor(255,255,255);var h=this.h.x,s=this.h.y;if(!(0>=i)){h+=t.J.x;for(let a=(s+=t.J.y)-i;a<s+i;++a){var e=a-s;e=2*(0|Math.sqrt(i*i-e*e)),t.G.fillRect(h-e/2|0,0|a,0|e,1)}}}}V(){this.g=!1}}const y=(t,i)=>((0|t)%(i|=0)+i)%i,z=(t,i,h)=>Math.max(i,Math.min(t,h));function A(t,i,h=0,s=0){const e=[0,8,0,8],a=[0,0,8,8];if(t.g){if(0==t.id)for(var l of t.F)l.A(i);h=Math.round(t.i.x)+h,s=Math.round(t.i.y)+s,l=3==t.j?1:t.j,l+=[1,4,6,6,6,6][t.id];var n=1;if(5==t.id){n=Array(3);for(var o=0;3>o;++o)n[o]=C(i.data,"art"+String(o+1));o=Math.round(15*(1-t.O));for(let t=0;16>t;++t){var r=(o+t)%15;D(i,r=n[r/5|0],16*l,t,16,1,h,s+t)}}else 3<=t.id&&(n=t.id-1),D(i,n=C(i.data,"art"+String(n)),16*l,0,16,16,h,s,t.s);2<=t.id&&D(i,C(i.data,"art1"),144+e[t.id-2],a[t.id-2],8,8,h+4,s+4)}}class ea extends p{constructor(t,i,h){super(!0),this.da=()=>this.g&&this.h,this.ca=()=>this.i.clone(),this.aa=()=>this.K,this.o=new v(t,i),this.target=this.o.clone(),this.i=x(this.o,16),this.l=0,this.h=!1,this.id=h,this.B=0,this.j=2<=h?t%2==i%2?0:2:0,this.s=0,0==this.id&&(this.F=[],this.m=0),this.K=this.U=!1,this.O=0}update(i,h){if(this.K=!1,this.g){if(this.h)if(12<=(this.l+=h.step))this.o=this.target.clone(),this.o.x=y(this.o.x,i.width),this.o.y=y(this.o.y,i.height),this.i=x(this.o,16),i.v[this.o.y*i.width+this.o.x]=this.id+1,this.h=!1;else{i=this.o;var s=this.target,e=this.l/12;this.i=x(new v((1-e)*i.x+e*s.x,(1-e)*i.y+e*s.y),16)}if(2<=this.id?(8<=(this.B+=h.step)&&(this.B-=8,this.j=(this.j+1)%4),5==this.id&&(this.O=(this.O+1/30*h.step)%1)):0==this.id&&this.h&&(this.s=0,0<Math.abs(this.target.x-this.o.x)?(this.j=2,this.s=this.target.x>this.o.x?0:1):0<Math.abs(this.target.y-this.o.y)&&(this.j=this.target.y>this.o.y?0:1)),0==this.id){for(var a of(i=[0,0,-6,6],s=[-6,6,2,2],this.F))a.update(h);this.h&&(a=this.j,1==this.s&&(a=3),6<=(this.m+=h.step)&&(t(this.F,da).W(this.i.x+8+i[a],this.i.y+8+s[a],30,4),this.m-=6))}}}control(t,i,h){var s;if(!(s=!this.g||this.h)){s=this.o.x;var e=this.o.y;s=y(s,t.width),e=y(e,t.height),s=10==t.D[e*t.width+s]}if(s)return!1;if(e=s=0,1&E(h.keyboard,"right")?s=1:1&E(h.keyboard,"left")?s=-1:1&E(h.keyboard,"down")?e=1:1&E(h.keyboard,"up")&&(e=-1),0!=s||0!=e){if(!(h=fa(t,this.o.x+s,this.o.y+e,0==this.id))&&(h=0!=this.id)){t:{h=this.o.x;var a=this.o.y,l=-s,n=-e;let i,o=h,r=a;do{if(a+=n,h=y(h+=l,t.width),i=(a=y(a,t.height))*t.width+h,1==t.v[i]){h=!0;break t}}while(!ha.includes(t.D[i])&&0!=t.v[i]&&(h!=o||a!=r));h=!1}h=!h}return!h&&(this.h=!0,this.l=0,i&&(t.L.push(Array.from(t.v)),64<t.L.length&&t.L.shift(),t.M.push(Array.from(t.D)),64<t.M.length&&t.M.shift(),t.N.push(t.S),64<t.N.length&&t.N.shift()),i=this.o,s=new v(s,e),this.target=new v(i.x+s.x,i.y+s.y),t.v[this.o.y*t.width+this.o.x]=0,!0)}return!1}A(t,i){A(this,t),0>this.target.x?A(this,t,16*i.width):this.target.x>=i.width&&A(this,t,16*-i.width),0>this.target.y?A(this,t,0,16*i.height):this.target.y>=i.height&&A(this,t,0,16*-i.height)}V(t){return!(!this.g||!this.U)&&(this.U=this.g=!1,t.v[this.o.y*t.width+this.o.x]=0,!0)}}const F=(t,i,h,s,e)=>{const a=[63,0,6];i=t.width/2-s/2+i,h=t.height/2-e/2+h;for(let l=0;2>=l;++l)t.setFillColor(...t.data.Y(a[l])),t.fillRect(i-6+l,h-6+l,s+12-2*l,e+12-2*l)};var ia=[[96,8],[112,18]],ja=[[100,6]],G=[[100,4],[120,8]],ka=[[112,10]],la=[[82,6]],ma=[[144,4],[120,6],[100,10]],na=[[100,4],[120,6],[144,10]],oa=[[90,6],[120,8]],pa=[[80,6],[100,8]];class H{constructor(t,i){this.Z=()=>this.text,this.ba=t=>{this.g(t)},this.text=t,this.g=i}clone(){return new H(this.text,this.g)}}class I{constructor(t){this.I=()=>this.active,this.buttons=Array(t.length).fill(null).map(((i,h)=>t[h].clone())),this.h=Math.max(...this.buttons.map((t=>t.Z().length))),this.g=0,this.active=!1}C(t=-1){0<=t&&(this.g=t%this.buttons.length),this.active=!0}update(t){if(this.active){var i=this.g;3==E(t.keyboard,"up")?--this.g:3==E(t.keyboard,"down")&&++this.g,i!=this.g&&(J(t.u,ja,.6,"square"),this.g=y(this.g,this.buttons.length)),i=this.buttons[this.g],3!=E(t.keyboard,"fire")&&3!=E(t.keyboard,"start")||(i.ba(t),J(t.u,G,.6,"square"))}}A(t,i,h,s=0,e=12,a=!1){if(this.active){var l=C(t.data,"font"),n=C(t.data,"fontYellow"),o=(this.h+1)*(8+s),r=this.buttons.length*e,d=t.width/2-o/2+i,u=t.height/2-r/2+h;for(a&&F(t,i,h-2,o,r),h=0;h<this.buttons.length;++h)i=this.buttons[h].Z(),h==this.g&&(i=" "+i,D(t,C(t.data,"art1"),176,8,8,8,d-1,u+h*e)),K(t,h==this.g?n:l,i,d,u+h*e,s,0)}}}function qa(t,i,h,s,e){t=(Math.sin(t.i[h])+1)/2,t=Math.round(.67*t*3)/3,i.setFillColor(0,0,0,t),i.fillRect(s,e,8,8)}class L{constructor(t=new v(0,0)){this.i=Array(10).fill(0).map(((t,i)=>2*Math.PI/10*i)),this.h=new v(8,0),this.g=t.clone()}update(t){for(let i=0;i<this.i.length;++i)this.i[i]=(this.i[i]+.05*t.step)%(2*Math.PI);this.h.x=(this.h.x+this.g.x*t.step)%176,this.h.y=(this.h.y+this.g.y*t.step)%160}A(t){var i=[[1,1],[4,5],[14,6],[3,11],[12,12],[7,13],[16,13],[5,17],[9,0]];const h=[[8,3],[9,9],[14,16],[16,3],[19,9]];let s,e,a=C(t.data,"art1"),l=Math.round(this.h.x),n=Math.round(this.h.y);t.setFillColor(0);for(let h=0;h<i.length;++h)s=-8+y(8*i[h][0]+l,176),e=-8+y(8*i[h][1]+n,160),D(t,a,80,0,8,8,s,e),qa(this,t,h,s,e);for(i=0;i<h.length;++i)s=-8+y(8*h[i][0]+l,176),e=-8+y(8*h[i][1]+n,160),D(t,a,80,8,8,8,s,e),qa(this,t,i,s,e)}}const M=[["YOU ARE A SPACE \nTRAVELLER FROM A\nFAR AWAY PLANET.\nYOU ARE LOST IN\nA MYSTERIOUS\nSPACE MAZE.","THE MAZE IS FILLED\nWITH MONSTERS. \nTHEY SEEM HARM-\nLESS, BUT YOU \nDECIDED TO KILL\nTHEM NONETHELESS.","AFTER ALL, THEY\nPOSSESS POWER\nSTARS YOU CAN USE\nTO GET BACK HOME."],["CONGRATULATIONS!\nYOU HAVE COL-\nLECTED ENOUGH\nPOWER STARS TO\nRETURN HOME.","TOO BAD YOU HAD\nTO KILL DOZENS\nOF INNOCENT\nSPACE MONSTERS\nFOR THAT.","I HOPE YOU ARE\nPROUD OF YOUR-\nSELF."]];function ra(i,h){for(let t of i.s)t.update(h);6<=(i.l+=h.step)&&(t(i.s,da).W(i.h.x+2,i.h.y+10,30,4,new v(-2,0)),i.l-=6)}class sa{constructor(t,i){this.O=t=>["\n"," ","\t"].includes(t),this.P=()=>null,this.g=Number(t)-1,this.m=this.j=this.i=0,this.K=new L(new v(-1,0)),this.F=0,this.h=new v(-16,24),this.B=0,this.s=[],this.l=0,0==this.g&&i.transition.C(!1,1,1/30,null,[0,0,0],4)}update(t){2!=this.g&&(this.K.update(t),this.F=(this.F+.025*t.step)%(2*Math.PI),this.h.y=24+16*Math.sin(this.F),ra(this,t),1==this.B?t.transition.I()||160<(this.h.x+=1*t.step)&&t.transition.C(!0,1,1/30,(t=>{0==this.g?t.H(ta):1==this.g&&(this.g=2)}),[0,0,0],4):0==this.B&&80>this.h.x?this.h.x=Math.min(80,this.h.x+1*t.step):t.transition.I()||this.g>=M.length||(this.j<M[this.g][this.i].length?t.keyboard.R()?this.j=M[this.g][this.i].length:(4<=(this.m+=t.step)||this.O(M[this.g][this.i]))&&(++this.j,this.m=0):t.keyboard.R()&&(++this.i==M[this.g].length?this.B=1:this.m=this.j=0,J(t.u,ka,.6,"square"))))}T(t){let i=C(t.data,"font");if(2==this.g)K(t,i,"THE END",t.width/2,t.height/2-8,0,0,!0);else{t.clear(),this.K.A(t);for(let i of this.s)i.A(t);D(t,C(t.data,"art1"),48,0,16,16,this.h.x,Math.round(this.h.y)),(0<this.i||0<this.j)&&this.i<M[this.g].length&&(F(t,0,27,140,64),K(t,i,M[this.g][this.i].substring(0,this.j),8,66,0,2))}}}const N=[[1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,1,1,0,0,0,4,0,0,0,0,1,1,4,0,4,1,0,0,0,0,1,1,0,0,0,1,1,1,0,1,1,1,1,4,1,1,4,4,0,4,1,1,0,0,0,1,0,0,4,0,1,1,0,2,0,1,0,0,8,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,4,1,8,1,0,2,0,1,1,0,0,4,4,1,0,0,0,1,1,0,0,0,1,1,1,3,1,1,1,1,4,1,1,4,1,4,0,1,1,0,0,0,1,4,1,0,0,1,1,0,0,3,4,0,0,0,0,1,1,8,3,0,1,4,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,8,4,5,0,0,0,5,8,1,1,4,5,0,0,1,0,0,5,1,1,5,0,1,0,5,4,0,0,1,1,0,0,5,0,0,0,0,0,1,1,0,0,0,4,0,1,0,0,1,1,4,0,1,0,0,0,2,0,1,1,8,4,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,8,5,4,0,5,5,0,0,1,1,5,4,0,0,0,0,0,4,1,1,4,0,0,5,3,0,0,4,1,1,1,1,0,0,1,0,0,0,1,1,0,0,0,0,4,0,0,5,1,1,0,3,0,1,0,0,5,4,1,1,2,0,0,1,0,5,4,8,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,8,4,0,1,1,0,0,2,0,1,4,0,0,1,1,0,0,0,0,1,1,0,0,1,0,3,3,0,1,1,0,3,3,0,1,0,5,0,1,0,0,0,0,1,1,0,4,0,1,5,0,0,0,1,1,0,0,0,1,8,5,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,1,1,1,1,1,1,8,5,4,0,4,0,4,8,1,1,5,0,0,4,3,0,0,4,1,1,3,1,3,1,1,0,0,1,1,0,0,0,0,0,1,0,4,5,0,1,0,1,1,0,0,0,4,1,1,1,0,2,1,4,0,1,3,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,0,4,4,5,4,6,8,1,1,0,0,1,1,0,5,6,3,1,1,3,4,5,1,5,0,5,4,1,1,0,5,0,0,2,0,0,5,1,1,1,4,0,0,1,3,3,0,1,1,0,6,4,0,0,0,5,0,1,1,0,0,4,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,1,1,1,1,0,1,1,1,0,0,0,1,0,0,4,0,1,0,0,0,5,1,6,0,0,0,0,1,0,5,8,1,8,6,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4,8,1,0,0,0,1,0,0,2,0,4,1,0,5,0,0,1,0,0,0,0,1,0,6,0,1,1,1,0,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,10,1,0,8,1,1,0,11,6,0,10,3,4,4,1,1,0,0,0,0,10,10,10,10,1,1,0,0,0,2,0,0,0,0,1,1,10,10,10,0,0,9,9,9,1,1,6,0,10,0,0,9,4,0,1,1,8,6,10,0,0,9,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,5,0,1,0,0,11,0,2,0,0,11,0,0,1,0,0,10,10,10,10,0,0,1,1,0,0,10,8,4,10,0,0,1,1,5,10,10,10,10,10,5,0,1,1,4,5,10,0,0,0,11,0,1,1,8,4,5,0,0,0,5,0,1,1,1,1,1,1,1,1,5,1,1],[1,1,1,1,9,1,1,1,1,1,1,8,4,0,0,0,5,6,8,1,1,4,0,3,0,5,11,5,6,1,1,1,0,5,4,0,1,1,5,1,0,5,3,0,0,2,0,1,10,0,1,10,1,11,0,6,0,0,5,1,1,8,1,1,5,0,4,1,0,1,1,0,4,10,5,4,8,1,8,1,1,1,1,1,9,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,4,6,0,6,0,7,0,1,0,4,6,1,7,1,7,0,0,0,1,0,7,1,2,1,0,7,0,1,1,0,0,1,1,1,10,10,10,1,1,6,11,1,5,4,6,4,0,1,1,8,6,1,8,5,4,6,4,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,1,0,3,0,0,6,8,1,1,0,8,5,0,2,7,0,6,1,1,11,0,1,5,0,0,0,0,1,1,3,1,1,1,10,1,1,1,1,1,8,0,0,10,0,0,0,0,1,1,0,7,0,10,0,3,2,11,1,1,0,0,0,10,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,1,8,10,2,1,0,0,5,0,4,1,10,0,0,0,1,0,0,4,8,1,0,0,0,1,1,3,3,1,1,1,1,3,3,1,1,0,0,11,1,8,5,0,0,1,0,0,0,0,1,5,0,4,0,0,1,2,0,11,1,11,0,0,2,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,7,1,1,1,0,1,1,1,5,0,0,1,8,1,0,6,1,1,5,1,1,1,9,1,1,6,1,0,0,1,0,0,0,0,1,0,7,1,1,1,3,1,1,10,1,1,1,7,0,1,11,1,0,0,1,0,0,1,0,1,3,1,0,1,1,4,1,1,2,1,0,7,7,1,0,4,1,1,1,1,0,1,1,1,7,1,1]];class ua extends p{constructor(){super(),this.X=()=>this.g,this.h=new v,this.speed=new v,this.j=this.i=this.l=0}W(t,i,h,s,e){this.h=t.clone(),this.speed=i.clone(),this.j=h,this.l=s,this.i=e,this.g=!0}update(t){this.g&&(this.h.x+=this.speed.x*t.step,this.h.y+=this.speed.y*t.step,0>=(this.j-=t.step)&&(this.g=!1))}A(t){if(this.g){var i=t.data.Y(this.l),h=this.i/2|0;t.setFillColor(i[0],i[1],i[2]),t.fillRect(Math.round(this.h.x)-h,Math.round(this.h.y)-h,this.i,this.i)}}V(){this.g=!1}}const va=[1,8,9,10,11],ha=[1,10],wa=[[4,44,24],[6,47,27],[36,62,56],[44,27,56],[56,60,62]];function fa(t,i,h,s=!1){i=y(i,t.width),h=y(h,t.height);let e=t.D[h*t.width+i];return!(!ha.includes(e)&&(s||8!=e))||0<t.v[h*t.width+i]}function xa(t){t.D=Array.from(t.data).map((t=>va.includes(t)?t:0)),t.M.length=0,t.M.push(Array.from(t.D)),t.v=Array.from(t.data).map((t=>2<=t&&7>=t?t-1:0)),t.L.length=0,t.L.push(Array.from(t.v)),t.N.length=0,t.N.push(!1),t.g=[],ya(t),t.j=!0,t.h=0,t.i=!1,t.S=!1;for(let i of t.m)i.V()}function ya(t){for(let h=0;h<t.height;++h)for(let s=0;s<t.width;++s){var i=h*t.width+s;if(0!=(i=t.data[i]))switch(--i,i){case 1:case 2:case 3:case 4:case 5:case 6:t.g.push(new ea(s,h,i-1))}}}function za(i,h,s,e,a){let l;for(h=new v(h,s),s=0;s<e;++s){var n=Math.random()*Math.PI*2;n=x(new v(Math.cos(n),Math.sin(n)),.5*Math.random()+.5),l=a[Math.random()*a.length|0],t(i.m,ua).W(h,n,24,l,1+2*Math.random()|0)}}function Aa(t){if(t.j&&!(0<t.h)&&0!=t.L.length){t.v=Array.from(t.L.pop()),t.D=Array.from(t.M.pop()),t.S=t.N.pop();for(let h=0;h<t.height;++h)for(let s=0;s<t.width;++s){var i=t.v[h*t.width+s];if(0!=i){t:{--i;for(let h of t.g)if(!h.aa()&&h.id==i&&h.X()){i=h;break t}for(let h of t.g)if(!h.aa()&&h.id==i){i=h;break t}i=null}null!=i&&(i.o=new v(s,h),i.target=i.o.clone(),i.i=x(i.o,16),i.l=0,i.h=!1,i.g=i.g||!0,i.U=!1,i.K=!0)}}}}class Ba{constructor(t){this.K=()=>this.i,this.B=()=>this.l==N.length,this.width=10,this.height=9,this.m=[],this.l=t,this.data=N[t-1],this.D=[],this.v=[],this.g=[],this.M=[],this.L=[],this.N=[],this.j=!0,this.h=0,this.i=!1,this.s=0,this.S=!1,xa(this),this.F=new L(new v(0,.5))}update(t){for(var i of(this.s=(this.s+1/12*t.step)%1,this.F.update(t),this.m))i.update(t);var h,s=!1;for(var e of this.g)if(e.da()){s=!0;break}if(e=!0,i=!1,!s&&!this.i){if(!this.j){this.j=!0,s=Array(this.width*this.height).fill(0);for(var a=0;a<this.height;++a)for(var l=0;l<this.width;++l){var n=a*this.width+l;if(3>this.v[n]||6<this.v[n])1==this.v[n]&&8==this.D[n]&&(this.D[n]=0,za(this,16*l+8,16*a+8,16,wa[4]),this.h=20,J(t.u,na,.6,"sine"));else{var o=void 0;let t;for(var r=this.v[n],d=0,u=-1;1>=u;++u)for(var g=-1;1>=g;++g)Math.abs(g)!=Math.abs(u)&&(t=y(l+g,this.width),o=(o=y(a+u,this.height))*this.width+t,(this.v[o]==r||6==this.v[o]||6==r&&3<=this.v[o]&&6>=this.v[o])&&++d);s[n]=d}}for(r=0;r<this.height;++r)for(a=0;a<this.width;++a){if(n=r*this.width+a,(l=!(3>this.v[n]||6<this.v[n]))&&!(l=2<=s[n]))t:{for(n=this.v[n],l=-1;1>=l;++l)for(d=-1;1>=d;++d)if(Math.abs(d)!=Math.abs(l)&&(g=y(a+d,this.width),u=(u=y(r+l,this.height))*this.width+g,(this.v[u]==n||6==this.v[u]||6==n)&&2<=s[u])){l=!0;break t}l=!1}if(l){for(var f of this.g)2>f.id||f.o.x!=a||f.o.y!=r||(f.U=!0);var c=!0}}if(c){for(h of this.g)h.V(this)&&za(this,(c=h.ca()).x+8,c.y+8,24,wa[h.id-2]);J(t.u,ma,.7,"sawtooth"),this.h=20}for(this.i=h=!0,f=0;f<this.height;++f)for(s=0;s<this.width&&(c=f*this.width+s,h&&11==this.D[c]&&0==this.v[c]&&(h=!1),this.i&&8==this.D[c]&&(this.i=!1),h||this.i);++s);for(c=!1,f=0;f<this.width*this.height;++f)9==this.data[f]?(this.D[f]=h?10:9,c=!0):10==this.data[f]&&(this.D[f]=h?9:10,c=!0);c&&this.S!=h&&(J(t.u,oa,.6,"square"),this.h=16),this.S=h}if(0>=this.h)do{h=!1;for(let s of this.g)s.control(this,e,t)&&(h=!0,e=!1,0<s.id&&(i=!0));h&&(this.j=!1)}while(h);else this.h-=t.step}i&&J(t.u,la,.5,"square");for(let i of this.g)i.update(this,t)}A(t){this.F.A(t);const i=[0,,,,,,,10];let h,s,e=[C(t.data,"art1"),C(t.data,"art2"),C(t.data,"art3")];for(let a=0;a<this.height;++a)for(let l=0;l<this.width;++l)if(s=this.D[a*this.width+l],0!=s)switch(h=e[0],s){case 9:D(t,h,88,8,8,8,16*l,16*a),D(t,h,88,8,8,8,16*l+8,16*a,1),D(t,h,88,8,8,8,16*l,16*a+8,2),D(t,h,88,8,8,8,16*l+8,16*a+8,3);break;case 10:t.setFillColor(0,0,0),t.fillRect(16*l,16*a,16,16),t.setFillColor(85,0,170),t.fillRect(16*l,16*a+1,15,15),t.setFillColor(255,170,255),t.fillRect(16*l,16*a+1,14,14),t.setFillColor(170,85,255),t.fillRect(16*l+1,16*a+2,13,13),D(t,h,88,0,8,8,16*l+4,16*a+4);break;case 11:t.setFillColor(0,0,0),t.fillRect(16*l+1,16*a+1,14,14),t.setFillColor(85,85,85),t.fillRect(16*l+2,16*a+2,12,12),t.setFillColor(255,255,255),t.fillRect(16*l+2,16*a+2,12,11),t.setFillColor(170,170,170),t.fillRect(16*l+3,16*a+3,11,10),D(t,C(t.data,"art2"),176,0,8,8,16*l+4,16*a+4),D(t,h,176,0,8,8,16*l+4,16*a+3);break;case 8:this.B()&&(h=e[Math.floor(3*this.s)]);default:D(t,h,16*i[s-1],0,16,16,16*l,16*a)}for(let i of this.g)i.A(t,this);for(let i of this.m)i.A(t)}}function Ca(t,i){i.transition.C(!0,3,.05,(()=>{t.j=!1,t.i=0,xa(t.g)}))}class ta{constructor(t,i){this.P=()=>this.j&&this.g.B()?2:0,t=z(Number(t),1,N.length),this.g=new Ba(t),this.h=new I([new H("RESUME",(()=>{this.h.active=!1})),new H("RESTART",(t=>{this.h.active=!1,Ca(this,t)})),new H("CONTROLS",(()=>{this.s=!0})),new H("AUDIO: "+(i.u.isEnabled()?"ON ":"OFF"),(t=>{t.u.toggle(!t.u.isEnabled()),this.h.buttons[3].text="AUDIO: "+(t.u.isEnabled()?"ON ":"OFF")})),new H("QUIT",(t=>{t.transition.C(!0,3,1/30,(t=>t.H(Da)))}))]),this.j=!1,this.i=0,this.m=20,O(i.transition.C(!1,2,1/30,null)),this.F=0,this.s=!1,this.B=0,this.l=1==t?3:0}update(t){t.transition.I()||(0<this.l?2==this.l?t.keyboard.R()&&(--this.l,J(t.u,G,.6,"square")):30<=(this.B+=t.step)&&(this.B=0,0==--this.l&&(this.m=0)):0<this.m?this.m-=t.step:this.s?t.keyboard.R()&&(J(t.u,G,.6,"square"),this.s=!1):this.j?(this.g.update(t),0>=(this.i-=t.step)&&(this.g.B()?t.transition.C(!0,1,1/60,(t=>t.H(sa)),[255,255,255],4):O(t.transition.C(!0,2,1/30,(()=>{try{window.localStorage.setItem("jn__spacemonsters_save",String(this.g.l+1))}catch(t){console.log(t)}this.g=new Ba(this.g.l+1),this.j=!1,this.i=0,this.m=20}),[0,0,0])))):this.h.I()?(this.F=(this.F+.5*t.step)%304,this.h.update(t)):3==E(t.keyboard,"start")?(J(t.u,pa,.6,"square"),this.h.C(0)):(this.g.update(t),!this.j&&this.g.K()?(this.j=!0,this.i=90):3==E(t.keyboard,"back")?(J(t.u,ja,.6,"square"),Aa(this.g)):3==E(t.keyboard,"restart")&&(J(t.u,G,.6,"square"),Ca(this,t))))}T(t){t.clear(0,0,0),t.moveTo(),this.g.A(t);var i=C(t.data,"fontYellow");if(0<this.m&&(t.setFillColor(0,0,0,.67),t.fillRect(),K(t,i,"STAGE "+String(this.g.l),t.width/2,t.height/2-8,0,0,!0)),this.s||0<this.l){i=0;var h=this.B/30;1==this.l?i=-Math.round(144*h):3==this.l&&(i=Math.round(144*(1-h))),0>=this.m&&(t.setFillColor(0,0,0,.67),t.fillRect()),F(t,0,i,128,80),h=C(t.data,"font");let s=C(t.data,"fontYellow");t.moveTo(0,i),K(t,s,"CONTROLS:",t.width/2,32,0,0,!0),K(t,h,"ARROW KEYS: MOVE",t.width/2,48,0,0,!0),K(t,h,"BACKSPACE: UNDO",t.width/2,64,0,0,!0),K(t,h,"R: RESTART",t.width/2,80,0,0,!0),K(t,h,"ENTER: PAUSE",t.width/2,96,0,0,!0),t.moveTo()}else{if(this.h.I())for(t.setFillColor(0,0,0,.67),t.fillRect(),this.h.A(t,0,0,0,13,!0),h=0;2>h;++h)K(t,i,"HINT: PRESS BACKSPACE TO UNDO A MOVE. ",t.width/2-this.F+304*h,134,0,0,!0);this.j&&(t.setFillColor(0,0,0,.67),t.fillRect(),i=C(t.data,"clear"),h=0,60<this.i&&(h=(this.i-60)/30),h=Math.round(t.height/2*h),D(t,i,0,0,i.width,i.height/2,t.width/2-i.width/2,t.height/2-i.height/2-h),D(t,i,0,i.height/2,i.width,i.height/2,t.width/2-i.width/2,t.height/2+h))}}}function Ea(t,i,h){if(t.h=1,!i)try{t.h=z(Number(window.localStorage.getItem("jn__spacemonsters_save")),1,N.length)}catch(i){t.h=1,console.log(i)}O(h.transition.C(!0,2,1/30,(i=>i.H(1==t.h?sa:ta)),[0,0,0]))}class Da{constructor(t,i){this.P=()=>this.h,this.h=1,this.s=0,this.j=new I([new H("NEW GAME",(t=>{Ea(this,!0,t)})),new H("CONTINUE",(t=>{Ea(this,!1,t)})),new H("AUDIO: "+(i.u.isEnabled()?"ON ":"OFF"),(t=>{t.u.toggle(!t.u.isEnabled()),this.j.buttons[2].text="AUDIO: "+(t.u.isEnabled()?"ON ":"OFF")}))]),this.j.C(),this.i=new L,this.g=null==t?0:1,this.m=1,i.transition.C(!1,1,1/30,null,[0,0,0],4),this.l=0}update(t){var i=1/60;this.i.update(t),this.s=(this.s+.05*t.step)%(2*Math.PI),0==this.g?((i=this.i).g.x=0,i.g.y=-.5,90<=(this.l+=t.step)&&(++this.g,(t=this.i).g.x=0,t.g.y=0)):t.transition.I()||(1==this.g?(this.m=(this.m+i*t.step)%1,(3==E(t.keyboard,"start")||3==E(t.keyboard,"fire"))&&(++this.g,J(t.u,ia,.6,"square"))):this.j.update(t))}T(t){t.clear(),this.i.A(t);var i=C(t.data,"logo");let h=t.width/2-i.width/2,s=8;0==this.g&&(s+=Math.round(136*(1-this.l/90)));let e,a=2*Math.PI/i.height;for(let l=0;l<i.height;++l)e=Math.round(4*Math.sin(this.s+a*l)),D(t,i,0,l,i.width,1,e+h,l+s);0!=this.g&&(i=t.width/2,1==this.g?.5>this.m&&K(t,C(t.data,"fontYellow"),"PRESS ENTER",i,t.height-44,0,0,!0):this.j.A(t,0,28,0,13,!0),K(t,C(t.data,"font"),"#2021 JANI NYK$NEN",i,t.height-9,0,0,!0))}}class Fa{constructor(t,i){this.P=()=>null,i.transition.C(!1,1,1/30,null,[0,0,0],4),this.g=120}update(t){t.transition.I()||(0>=(this.g-=t.step)||t.keyboard.R())&&t.transition.C(!0,1,1/30,(t=>t.H(Da)),[0,0,0],4)}T(t){t.clear();var i=C(t.data,"startIntro");D(t,i,0,0,i.width,i.height,0,0,0),D(t,C(t.data,"art1"),184,0,32,16,t.width/2-16,40),D(t,C(t.data,"art1"),216,0,32,16,t.width/2-16,56)}}class Ga{constructor(){this.P=()=>0,this.g=new I([new H("YES",(t=>{Ha(t.u),t.u.toggle(!0),t.H(Fa)})),new H("NO",(t=>{Ha(t.u),t.u.toggle(!1),t.H(Fa)}))]),this.g.C(1)}update(t){this.g.update(t)}T(t){t.clear(0,85,170),K(t,C(t.data,"font"),"WOULD YOU LIKE\nTO ENABLE AUDIO?\nYOU CAN CHANGE\nTHIS LATER.\n\nPRESS ENTER TO\nCONFIRM.",16,12,0,1,!1),this.g.A(t,0,40,0,12)}}const Ia=(t,i,h,s=1)=>"rgba("+String(0|t)+","+String(0|i)+","+String(0|h)+","+String(z(s,0,1));function D(t,i,h,s,e,a,l,n,o=0){if(!(null==i||0>=e||0>=a)){var r=t.G;l+=t.J.x,n+=t.J.y,h|=0,s|=0,e|=0,a|=0,l|=0,n|=0,0!=(o|=0)&&r.save(),0!=(1&o)&&(r.translate(e,0),r.scale(-1,1),l*=-1),0!=(2&o)&&(r.translate(0,a),r.scale(1,-1),n*=-1),r.drawImage(i,h,s,e,a,l,n,e,a),0!=o&&r.restore()}}function K(t,i,h,s,e,a=0,l=0,n=!1){let o=i.width/16|0,r=s;n&&(r=s-=h.length*(o+a)/2);for(let d=0;d<h.length;++d)10==(n=h.charCodeAt(d))?(r=s,e+=o+l):(D(t,i,n%16*o,(n/16|0)*o,o,o,r,e),r+=o+a)}function Ja(t){let i=document.createElement("div");i.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;"),t.g=document.createElement("canvas"),t.g.width=160,t.g.height=144,t.g.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;"),i.appendChild(t.g),document.body.appendChild(i),t.G=t.g.getContext("2d"),t.G.imageSmoothingEnabled=!1,Ka(t)}function Ka(t){var i=window.innerWidth,h=window.innerHeight;t=t.g;var s=Math.min(i/t.width,h/t.height);1<=s&&(s=Math.floor(s));let e=t.width*s;s*=t.height,h=String(h/2-s/2|0)+"px",i=String(i/2-e/2|0)+"px",t.style.width=String(0|e)+"px",t.style.height=String(0|s)+"px",t.style.top=h,t.style.left=i}function La(t,i=1){t.G.globalAlpha=z(i,0,1)}class Ma{constructor(t){this.width=160,this.height=144,this.data=t,this.J=new v,this.g=this.G=null,Ja(this),window.addEventListener("resize",(()=>Ka(this)))}moveTo(t=0,i=0){this.J.x=0|t,this.J.y=0|i}clear(t=0,i=0,h=0){this.G.fillStyle=Ia(t,i,h),this.G.fillRect(0,0,this.width,this.height)}setFillColor(t=0,i=t,h=i,s=1){this.G.fillStyle=Ia(t,i,h,s)}fillRect(t=0,i=0,h=this.width,s=this.height){t+=this.J.x,i+=this.J.y,this.G.fillRect(0|t,0|i,0|h,0|s)}}function C(t,i){for(let h of t.g)if(h.key==i)return h.value}function Na(){let t,i,h,s=Array(64);for(let e=0;e<s.length;++e)t=e>>4,i=(12&e)>>2,h=3&e,s[e]=[85*t,85*i,85*h];return s}function Oa(t,i,h,s=!1){var e=[-1,-1,-1,-1];let a=document.createElement("canvas");a.width=i.width,a.height=i.height;var l=i.width/8|0;let n=i.height/8|0,o=a.getContext("2d");o.drawImage(i,0,0);let r,d,u=o.getImageData(0,0,i.width,i.height),g=Uint8Array.from(u.data);for(let s=0;s<n;++s)for(let a=0;a<l;++a){r=h[s*l+a],null==r&&(r=e);for(let h=0;8>h;++h)for(let e=0;8>e;++e){d=(8*s+h)*i.width+(8*a+e);var f=4*d,c=g[f];let l=g[f+1];f=g[f+2],-1==r[c=85==c&&85==l&&85==f?1:170==c&&170==l&&170==f?2:255==c&&255==l&&255==f?3:0]?(u.data[4*d]=0,u.data[4*d+1]=0,u.data[4*d+2]=0,u.data[4*d+3]=0):(c=t.j[r[c]],u.data[4*d]=c[0],u.data[4*d+1]=c[1],u.data[4*d+2]=c[2],u.data[4*d+3]=255)}}if(s)for(t=i.width,i=i.height,h=Uint8Array.from(u.data),e=1;e<i;++e)for(l=0;l<t-1;++l)0!=h[(s=4*(e*t+l))+3]||255!=h[4*((e-1)*t+l)+3]&&255!=h[4*((e-1)*t+(l-1))+3]&&255!=h[4*(e*t+(l-1))+3]||(u.data[s]=0,u.data[s+1]=0,u.data[s+2]=0,u.data[s+3]=255);return o.putImageData(u,0,0),a}function P(t,i,h,s,e=!1){t.g.push(new n(i,Oa(t,h,s,e)))}function Pa(t,i,h){let s=new Image;++t.i,s.onload=()=>{++t.h,h(s)},s.src=i}function Qa(t,i,h,s,e){let a=document.createElement("canvas");a.width=h,a.height=s,(h=a.getContext("2d")).imageSmoothingEnabled=!1,e(a,h),e=h.getImageData(0,0,a.width,a.height),s=Uint8Array.from(e.data);for(let t=0;t<a.width*a.height*4;t+=4){for(let i=0;3>i;++i)e.data[t+i]=z(85*Math.round(s[t+i]/85),0,255);e.data[t+3]=80>s[t+3]?0:255}h.putImageData(e,0,0),t.g.push(new n(i,a))}class Ra{constructor(){this.l=()=>this.h>=this.i,this.Y=t=>this.j[t],this.i=this.h=0,this.g=[],this.j=Na()}}function E(t,i){for(let h of t.actions)if(h.key==i)return Sa(t,h.value);return 0}function Ta(t,i,h){for(let s of t.keys)if(s.key==i)return void(s.value=h);t.keys.push(new n(i,h))}function Sa(t,i){for(let h of t.keys)if(h.key==i)return h.value;return 0}function Q(t,i,h){return t.actions.push(new n(i,h)),t.h.push(h),t}class Ua{constructor(){this.R=()=>this.g,this.keys=[],this.h=[],this.actions=[],this.g=!1,window.addEventListener("keydown",(t=>{var i=t.code;1!=Sa(this,i)&&(this.g=!0,Ta(this,i,3)),this.h.includes(t.code)&&t.preventDefault()})),window.addEventListener("keyup",(t=>{var i=t.code;0!=Sa(this,i)&&Ta(this,i,2),this.h.includes(t.code)&&t.preventDefault()})),window.addEventListener("contextmenu",(t=>{t.preventDefault()})),window.addEventListener("mousemove",(()=>{window.focus()})),window.addEventListener("mousedown",(()=>{window.focus()}))}update(){for(let t of this.keys)2==t.value?t.value=0:3==t.value&&(t.value=1);this.g=!1}}function J(t,i,h,s="square"){t.stop(),t.h=null;let e=Array(i.length);for(let t=0;t<i.length;++t)e[t]=[i[t][0],i[t][1]];t.h=e,t.s=h,Va(t,t.h[0][0],t.s,t.h[0][1],s),t.h.shift()}function Ha(t){t.j=new AudioContext,t.l=new GainNode(t.j)}function Va(t,i,h,s,e="square"){t.m&&(0<t.i&&t.stop(),t.g=t.j.createOscillator(),t.g.type=e,t.i=s,h*=t.$,t.l.gain.setValueAtTime(z(h,.01,1),0),t.l.gain.exponentialRampToValueAtTime(h/2,1/60*s),t.g.connect(t.l).connect(t.j.destination),t.g.frequency.setValueAtTime(i,0),t.g.start(0))}class Wa{constructor(){this.isEnabled=()=>this.m,this.l=this.g=this.j=null,this.h=[],this.s=1,this.i=0,this.m=!1,this.$=1}update(t){0<this.i&&0>=(this.i-=t.step)&&(this.stop(),0<this.h.length&&(Va(this,this.h[0][0],this.s,this.h[0][1],"square"),this.h.shift()))}stop(){null!=this.g&&(this.g.disconnect(),this.g.stop(0),this.g=null)}toggle(t){this.m=t}}function O(t){t.g=new v(80,72).clone()}class Xa{constructor(){this.I=()=>this.active,this.h=0,this.i=!1,this.m=0,this.j=[0,0,0],this.active=!1,this.g=new v(80,72),this.speed=1,this.l=null,this.s=()=>{}}C(t,i,h,s,e=[0,0,0],a=0){return this.i=t,this.speed=h,this.h=1,this.s=s,this.m=i,this.j=e,this.l=a,this.active=!0,this}update(t){this.active&&0>=(this.h-=this.speed*t.step)&&((this.i=!this.i)?(this.active=!1,this.h=0):(this.h+=1,this.s(t)))}A(t){if(this.active&&0!=this.m){t.moveTo();var i=this.h;switch(this.i&&(i=1-i),t.setFillColor(this.j[0],this.j[1],this.j[2]),this.m){case 1:0<this.l&&(i=Math.round(i*this.l)/this.l),La(t,i),t.fillRect(0,0,t.width,t.height),La(t);break;case 2:var h=Math.max(Math.hypot(this.g.x,this.g.y),Math.hypot(t.width-this.g.x,this.g.y),Math.hypot(t.width-this.g.x,t.height-this.g.y),Math.hypot(this.g.x,t.height-this.g.y));i=(1-i)*h,h=this.g.x;var s=this.g.y;let n=t.G;if(0>=i)n.fillRect(0,0,t.width,t.height);else if(!(i*i>=t.width*t.width+t.height*t.height)){null==h&&(h=t.width/2),null==s&&(s=t.height/2);var e=0|Math.max(0,s-i),a=0|Math.min(t.height,s+i);0<e&&n.fillRect(0,0,t.width,e),a<t.height&&n.fillRect(0,a,t.width,t.height-a);for(let o=e;o<a;++o){var l=o-s;Math.abs(l)>=i?n.fillRect(0,0|o,0|t.width,1):(e=Math.round(h-Math.sqrt(i*i-l*l)),l=Math.round(h+Math.sqrt(i*i-l*l)),0<e&&n.fillRect(0,0|o,0|e,1),l<t.width&&n.fillRect(0|l,0|o,t.width-e|0,1))}}break;case 3:i=Math.round(i*t.height/2),t.fillRect(0,0,t.width,i),t.fillRect(0,t.height-i,t.width,i)}}}}class Ya{constructor(t,i,h,s,e){this.g=t,this.step=1,this.keyboard=i,this.data=h,this.transition=s,this.u=e}H(t){this.g.H(t)}}function Za(t,i){const h=16.66667*t.g.step;for(t.h+=i-t.s,t.h=Math.min(5*h,t.h),t.s=i,i=t.h/h|0;0<i--;)!t.j&&t.data.l()&&(t.i=new t.m.prototype.constructor(null,t.g),t.j=!0),t.j&&t.i.update(t.g),t.keyboard.update(),t.transition.update(t.g),t.u.update(t.g),t.h-=h;t.j&&(t.i.T(t.l),t.transition.A(t.l)),window.requestAnimationFrame((i=>Za(t,i)))}function $a(t=(()=>{})){var i=new ab;i.m=Ga,t(i.g),Za(i,0)}class ab{constructor(){this.data=new Ra,this.l=new Ma(this.data),this.keyboard=new Ua,this.transition=new Xa,this.u=new Wa,this.g=new Ya(this,this.keyboard,this.data,this.transition,this.u),this.s=this.h=0,this.j=!1,this.m=this.i=null}H(t){this.i=new t.prototype.constructor(this.i.P(),this.g)}}const S=[0,32,52,56],T=[0,-1,11,47],U=[0,-1,11,42],bb=[0,-1,40,62],cb=[0,-1,40,20],db=[-1,0,43,63],eb=[0,-1,44,24],V=[0,-1,4,24],fb=[0,-1,47,27],W=[0,-1,6,27],gb=[0,-1,62,56],X=[0,-1,36,56],Y=[0,-1,42,63],hb=[0,-1,56,60],ib=[0,-1,24,44],jb=[0,-1,27,15],kb=[0,-1,39,18],Z=[0,36,56,63],lb=[S,S,T,T,T,T,T,T,bb,bb,db,kb,eb,V,eb,V,eb,V,Y,Y,[0,-1,62,60],hb,kb,Z,Z,Z,Z,Z,Z,Z,Z,null,S,S,U,U,U,U,U,U,cb,cb,db,kb,V,V,V,V,V,V,Y,Y,hb,hb,[0,-1,56,61],Z,Z,Z,Z,Z,Z,Z,Z,null],mb=[null,null,null,null,null,null,null,null,null,null,null,null,fb,W,fb,W,fb,W,null,null,[0,-1,47,15],jb,[21,-1,-1,-1],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,W,W,W,W,W,W,null,null,jb,jb,null,null,null,null,null,null,null,null,null,null],nb=[null,null,null,null,null,null,null,null,null,null,null,null,gb,X,gb,X,gb,X,null,null,[0,-1,62,44],ib,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,X,X,X,X,X,X,null,null,ib,ib,null,null,null,null,null,null,null,null,null,null],ob=(t,i)=>{i.font="bold 24px Arial",i.textAlign="center";for(let h=1;0<=h;--h)i.fillStyle=0==h?"rgb(255, 255, 85)":"rgb(170, 85, 0)",i.fillText("STAGE",t.width/2+h,24+h),i.fillText("CLEAR!",t.width/2+h,48+h)},pb=(t,i)=>{i.font="bold 28px Arial",i.textAlign="center";for(let h=2;0<=h;--h)i.fillStyle=0==h?"rgb(170, 255, 255)":"rgb(85, 170, 170)",2>h&&(i.font="12px Arial",i.fillText("THE MAZE OF",t.width/2+h,12+h)),i.font="bold 24px Arial",i.fillText("SPACE",t.width/2+h,33+h),i.fillText("GOBLINS",t.width/2+h,54+h)},qb=(t,i)=>{i.textAlign="center",i.fillStyle="white",i.font="9px Arial",i.fillText("A GAME BY",t.width/2,84),i.font="15px Arial",i.fillText("JANI NYKÄNEN",t.width/2,98)};window.onload=()=>$a((t=>{t.u.toggle(!1),t.u.$=.5,Q(Q(Q(Q(Q(Q(Q(Q(t.keyboard,"left","ArrowLeft"),"up","ArrowUp"),"right","ArrowRight"),"down","ArrowDown"),"fire","Space"),"back","Backspace"),"start","Enter"),"restart","KeyR"),Pa(t.data,"art.png",(i=>{P(t.data,"art1",i,lb),P(t.data,"art2",i,mb),P(t.data,"art3",i,nb)})),Qa(t.data,"clear",96,56,ob),Qa(t.data,"logo",128,96,pb),Qa(t.data,"startIntro",160,144,qb),Pa(t.data,"font.png",(i=>{P(t.data,"font",i,Array(96).fill([-1,0,0,63]),!0),P(t.data,"fontYellow",i,Array(96).fill([-1,0,0,61]),!0)}))}))</script>