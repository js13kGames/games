<!doctype html><meta name=viewport content="width=device-width"><title>Thirteen Potions</title><link rel=icon href=./knight/right.png><script src=//cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js></script><style>#game-container,body,html{margin:0;padding:0;background:#3b2731}#game-container{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center}</style><script>let controls,cursors,player,PotionLayer,potions,EnemyLayer,enemies,text,time,timerText,config={type:Phaser.AUTO,width:720,height:480,parent:"game-container",pixelArt:!0,scene:{preload:preload,create:create,update:update},physics:{default:"arcade",arcade:{gravity:{y:0}}}},game=new Phaser.Game(config),playerStartedMoving=!1,speed=100,potionScore=0,finalTime=-1;function preload(){this.load.image("tiles","./tilemap_packed.png"),this.load.image("potion","./potion.png"),this.load.image("enemy","./enemy.png"),this.load.tilemapTiledJSON("map","./map/map.json"),this.load.spritesheet("knight","./knight/knight_packed.png",{frameWidth:16,frameHeight:16})}function create(){const e=this.make.tilemap({key:"map",tileWidth:16,tileHeight:16}),t=e.addTilesetImage("thirteen-potions","tiles"),i=(e.createLayer("Ground",t,0,0),e.createLayer("Walls",t,0,0));i.setCollisionByExclusion([-1]),PotionLayer=e.getObjectLayer("Things").objects.slice(1),EnemyLayer=e.getObjectLayer("Enemies").objects,potions=this.physics.add.staticGroup(),PotionLayer.forEach((e=>{let t=potions.create(e.x,e.y-16,"potion");t.setScale(e.width/16,e.height/16),t.setOrigin(0),t.body.width=e.width,t.body.height=e.height})),enemies=this.physics.add.group(),EnemyLayer.forEach((e=>{let t=enemies.create(e.x,e.y-16,"enemy");t.setScale(e.width/16,e.height/16),t.setOrigin(0),t.body.width=e.width,t.body.height=e.height}));const a=e.findObject("Things",(e=>"Spawn"===e.name));player=this.physics.add.sprite(a.x,a.y,"knight").setInteractive(this.input.makePixelPerfect(0)),this.physics.add.collider(player,i),player.setCollideWorldBounds(!0),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("knight",{start:0,end:1}),frameRate:10,repeat:-1}),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("knight",{start:2,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"up-right",frames:this.anims.generateFrameNumbers("knight",{start:4,end:5}),frameRate:10,repeat:-1}),this.anims.create({key:"up-left",frames:this.anims.generateFrameNumbers("knight",{start:6,end:7}),frameRate:10,repeat:-1}),this.physics.add.overlap(player,potions,collectPotion,null,this),this.physics.add.overlap(player,enemies,zappy,null,this);let s=this.cameras.main;s.zoom=4,s.setBounds(0,0,720,480),s.startFollow(player),cursors=this.input.keyboard.createCursorKeys(),text=this.add.text(270,180,"Potions left: "+(13-potionScore),{font:"8px",fill:"#ffffff",backgroundColor:"#3B2731",padding:{x:2,y:2}}),text.setScrollFactor(0),timerText=this.add.text(270,287,"Time: 0",{font:"9px",fill:"#ffffff",backgroundColor:"#3B2731",padding:{x:2,y:2}}),timerText.setScrollFactor(0),this.time.addEvent({delay:1e3,callback:function(){playerStartedMoving&&-1===finalTime&&timerText.setText("Time: "+Math.ceil((this.time.now-this.startTime)/1e3))},callbackScope:this,loop:!0})}function collectPotion(e,t){return t.destroy(t.x,t.y),potionScore++,text.setText("Potions left: "+(13-potionScore)),!1}function zappy(){return speed=50,player.alpha=.6,player.tint=16711680,setTimeout((()=>{speed=100,player.alpha=1,player.clearTint()}),2e3),!1}function update(e,t){const i=player.body.velocity.clone();player.body.setVelocity(0),13===potionScore&&-1===finalTime&&(finalTime=Math.ceil((this.time.now-this.startTime)/1e3),timerText.setText(`Final Time: ${finalTime} seconds!`)),playerStartedMoving||0===i.x||0===i.y||(playerStartedMoving=!0,this.startTime=this.time.now),enemies.children.iterate((function(e){e.body.setVelocity(Phaser.Math.Between(-16,16),Phaser.Math.Between(-16,16))})),cursors.left.isDown?player.body.setVelocityX(-1*speed):cursors.right.isDown&&player.body.setVelocityX(speed),cursors.up.isDown?player.body.setVelocityY(-1*speed):cursors.down.isDown&&player.body.setVelocityY(speed),player.body.velocity.normalize().scale(speed),cursors.up.isDown&&cursors.right.isDown?player.anims.play("up-right",!0):cursors.up.isDown&&cursors.left.isDown?player.anims.play("up-left",!0):cursors.left.isDown?player.anims.play("left",!0):cursors.right.isDown?player.anims.play("right",!0):cursors.up.isDown?player.anims.play("up-right",!0):cursors.down.isDown?player.anims.play("right",!0):(player.anims.stop(),i.x<0?player.setTexture("knight",2):i.x>0?player.setTexture("knight",0):i.y<0?player.setTexture("knight",4):i.y>0&&player.setTexture("knight",0))}</script><div id=game-container></div>