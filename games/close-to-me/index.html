<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>JS13k - Close to me</title>
</head>

<body>
    <canvas id="game" width=1280 height=720></canvas>
<script type="text/javascript">!function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i,e){var n,s,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};s=[i],void 0===(a="function"==typeof(n=function(t){var i=440*Math.pow(Math.pow(2,1/12),-9),e=/^[0-9.]+$/,n=/\s+/,s=/(\d+)/,a={};function r(t){var i=t.split(n);this.frequency=r.getFrequency(i[0])||0,this.duration=r.getDuration(i[1])||0}function h(t,i){this.buffer=t,this.duration=r.getDuration(i)||0}function c(t,i,e){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=i||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,e||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,i){t.split("-").forEach(function(t){a[t]=i})}),r.getFrequency=function(t){var e=t.split(s),n=a[e[0]],o=(e[1]||4)-4,r=i*Math.pow(Math.pow(2,1/12),n);return r*Math.pow(2,o)},r.getDuration=function(t){return e.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,i){return t+("w"===i?4:"h"===i?2:"q"===i?1:"e"===i?.5:"s"===i?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(i,e){(e=this[i[0]]=this.ac.createBiquadFilter()).type="peaking",e.frequency.value=i[1],t.connect(t=e)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push("object"===(void 0===t?"undefined":o(t))?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,i){i||(i=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(i)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,i){var e=60/this.tempo*this.notes[t].duration,n=e*(1-(this.staccato||0));if(this.notes[t]instanceof h){var s=this.ac.createBufferSource();return s.buffer=this.notes[t].buffer,s.connect(this.gain),s.start(i),s.stop(i+e),i+e}return this.setFrequency(this.notes[t].frequency,i),this.smoothing&&this.notes[t].frequency&&this.slide(t,i,n),this.setFrequency(0,i+n),i+e},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,i,e){var n=this.getNextNote(t),s=this.getSlideStartDelay(e);return this.setFrequency(this.notes[t].frequency,i+s),this.rampFrequency(n.frequency,i+e),this},c.prototype.setFrequency=function(t,i){return this.osc.frequency.setValueAtTime(t,i),this},c.prototype.rampFrequency=function(t,i){return this.osc.frequency.linearRampToValueAtTime(t,i),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(i,e){t=this.scheduleNote(e,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sample=h,t.Sequence=c})?n.apply(i,s):n)||(t.exports=a)},function(t,i,e){"use strict";e.r(i);e(2),e(7);var n=e(0),s=120;function a(t){return t/s*60*60}function o(t){return t*Math.PI/180}function r(t,i,e,n){return function(t,i,e){return t*(1-e)+i*e}(t,i,1-Math.exp(-e*n))}function h(t){kontra.context.strokeStyle=this.color,kontra.context.beginPath(),kontra.context.lineWidth=this.width,kontra.context.arc(this.x,this.y,this.radius-this.width/2,0,2*Math.PI),kontra.context.stroke()}function c(t){var i=this.radius||this.height/2,e=this.radius-this.width||0,n=this.x-t.x,s=this.y-t.y,a=Math.sqrt(n*n+s*s);return a<i+t.radius&&a>e-t.radius}for(var d=new AudioContext,l=d.createBuffer(1,10*d.sampleRate,d.sampleRate),u=l.getChannelData(0),f=0;f<u.length;++f)u[f]=2*Math.random()-1;var p=["- 4"],y=["F3 ","Ab3 ","F4 ","Ab4 ","F5 ","Ab5 ","F5 ","Ab4 ","F4 ","Ab3 "],v=["- q",new n.Sample(l,"e"),"- qe",new n.Sample(l,"e"),"- e"];for(f=0;f<440;f++){var g=360*Math.log10((f+1+7.291)/7.291),x=y[f%y.length]+s/g;p.push(x)}var k=new n.Sequence(d,s,["F4 128"]),w=new n.Sequence(d,s,p),m=new n.Sequence(d,s,["F2 7.9","- .1","Eb2 7.9","- .1","Bb1 7.9","- .1","Db2 7.9","- .1"]),b=new n.Sequence(d,s,["- 1.75","C5 .5","- .25","Ab4 .5","Bb4 .5","Ab4 .5"]),S=new n.Sequence(d,s,["- 1.75","C5 .5","- .25","Eb5 .5","Bb4 .5","Ab4 .5"]),M=new n.Sequence(d,s,["G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.80","G2 0.01","C2 0.19","-  0.40","G2 0.01","C2 0.19","-  0.20"]),T=new n.Sequence(d,s,v);w.staccato=.55,b.staccato=.5,S.staccato=.5,M.waveType="sine",M.smoothing=.8,M.bass.frequency.value=60,M.bass.gain.value=5,M.mid.frequency.value=100,M.mid.gain.value=5,T.gain.gain.value=.1,T.bass.frequency.value=150,T.bass.gain.value=4,T.mid.frequency.value=800,T.mid.gain.value=3,T.treble.frequency.value=5e3,T.treble.gain.value=-10,k.gain.gain.value=.05,w.gain.gain.value=.1,b.gain.gain.value=.05,S.gain.gain.value=.1,m.gain.gain.value=.05,M.gain.gain.value=.5,k.createCustomWave([1,.11,.88,.55,.77,.33,.33,.33,.44,.11,.22]),w.waveType="triangle",k.loop=!1,w.loop=!1,b.loop=!1,S.loop=!1,kontra.init("game");var F=[],A=[],q={type:"enemy",width:20,height:90,color:"#909",ttl:1/0,x:640,y:360,rotation:-90,ticks:0,collidesWith:function(t){if(!c.call(this,t))return!1;var i=Math.cos(o(this.rotation))/Math.sin(o(this.rotation)),e=-1*(i*this.x+this.y),n=t.x,s=t.y;return Math.abs(i*n+1*s+e)/Math.sqrt(i*i+1)<this.width/2+t.radius},update:function(t){this.ticks++,this.rotation+=this.ticks>a(36)?16.875/a(1):8.4375/a(1),this.height+=2.1,this.ticks>a(4)&&(this.height=1800),this.advance()},render:function(){kontra.context.save(),kontra.context.translate(this.x,this.y),kontra.context.rotate(o(this.rotation)),kontra.context.fillStyle=this.color,kontra.context.fillRect(-1*this.width/2,-this.height/2,this.width,this.height),kontra.context.restore()}},C={type:"enemy",radius:34,width:34,color:"#909",ttl:1/0,x:0,y:0,dy:-4,rotation:0,collidesWith:c,update:function(t){this.rotation+=1,this.advance()},render:h},P={type:"enemy",radius:0,maxRadius:360,color:"#909",ttl:1/0,x:0,y:0,dy:0,direction:1,rotation:0,collidesWith:c,update:function(t){this.radius+=this.direction*this.maxRadius/a(.5),this.radius>this.maxRadius&&(this.direction=-1),this.radius<0&&(this.ttl=0),this.advance()},render:function(){kontra.context.save(),kontra.context.translate(this.x,this.y),kontra.context.rotate(o(this.rotation)),kontra.context.beginPath(),kontra.context.arc(0,0,this.radius,0,2*Math.PI,!1),kontra.context.fillStyle=this.color,kontra.context.fill(),kontra.context.restore()}},E=kontra.sprite({tears:[],type:"factory",ttl:1/0,start:function(){this.tears=w.notes.map(function(t){return 60*t.duration/s}),F.push(this)},stop:function(){this.tears=[]},update:function(t){for(this.tears[0]-=t;this.tears.length&&this.tears[0]<=0;){for(var i=-1;i<2;i+=2){var e=kontra.sprite({type:"enemy",width:12,height:12,color:"#909",dx:i*(6*Math.random()+3),ddy:.3,x:30*i+kontra.canvas.width/2-6,y:kontra.canvas.height/2-6,ttl:49,update:function(t){this.advance()}});A.push(e)}var n=this.tears.shift();this.tears[0]-=n,I.width+=20*Math.random()+20,I.height+=20*Math.random()+20}}}),_=kontra.sprite({type:"player",x:80,y:80,width:40,height:30,radius:10,rotation:0,ttl:1/0,dashFrames:0,iFrames:0,stunFrames:0,health:7,color:"yellow",update:function(t){if(this.stunFrames>0)this.stunFrames--,this.rotation+=4;else if(this.dx=this.dy=0,kontra.keys.pressed("w")&&(this.dy+=-4),kontra.keys.pressed("s")&&(this.dy+=4),kontra.keys.pressed("a")&&(this.dx+=-4),kontra.keys.pressed("d")&&(this.dx+=4),this.dx&&this.dy&&(this.dx*=.707,this.dy*=.707),this.dy||this.dx){this.rotation=180*Math.atan2(this.dy,this.dx)/Math.PI;for(var i=0;i<this.dashFrames/10+1;i++)if(!(2*Math.random()>1)){var e=kontra.sprite({type:"particle",x:this.x-4+Math.random()*this.width-this.width/2,y:this.y-4+Math.random()*this.height-this.height/2,dx:-2*this.dx*(Math.random()+.5),dy:-2*this.dy*(Math.random()+.5),ttl:16,width:8,height:8,color:"yellow",update:function(t){this.advance()},render:function(){kontra.context.save(),kontra.context.globalAlpha=this.ttl/16,kontra.context.fillStyle="#ff0",kontra.context.fillRect(this.x,this.y,this.width,this.height),kontra.context.restore()}});A.push(e)}}this.dashFrames>0&&(this.dx*=(Math.pow(this.dashFrames,2)+120)/120,this.dy*=(Math.pow(this.dashFrames,2)+120)/120,this.dashFrames--),this.iFrames>0&&this.iFrames--,this.width=r(this.width,40,10,t),this.height=r(this.height,30,10,t),this.moving||!this.dx&&!this.dy?this.moving&&0==this.dx&&0==this.dy&&(this.width-=12,this.height+=12,this.moving=!1):(this.width+=10,this.height-=10,this.moving=!0),this.advance(),this.x=Math.max(0,Math.min(this.x,kontra.canvas.width)),this.y=Math.max(0,Math.min(this.y,kontra.canvas.height))},render:function(){var t=this.canvas||document.createElement("canvas");t.width=this.width,t.height=this.height;var i=t.getContext("2d");i.strokeStyle="yellow",i.fillStyle="yellow",i.globalCompositeOperation="source-over",i.beginPath(),i.moveTo(0,0),i.lineTo(this.width,this.height/2),i.lineTo(0,this.height),i.closePath(),i.stroke(),i.fill(),i.globalCompositeOperation="source-atop",i.strokeStyle="#111",i.beginPath();var e=0-.5*Math.PI,n=2*Math.PI*(7-this.health)/7-.5*Math.PI;i.lineWidth=2*this.width,i.arc(this.width/2,this.height/2,this.width,e,n),i.stroke(),i.globalCompositeOperation="source-over",i.lineWidth=2,i.strokeStyle="yellow",i.beginPath(),i.moveTo(0,0),i.lineTo(this.width,this.height/2),i.lineTo(0,this.height),i.closePath(),i.stroke(),kontra.context.save(),kontra.context.translate(this.x,this.y),kontra.context.rotate(o(this.rotation)),kontra.context.drawImage(t,-this.width/2,-this.height/2),kontra.context.restore()}});A.push(_);var I=kontra.sprite({x:kontra.canvas.width/2,y:kontra.canvas.height/2,type:"enemy",width:120,height:120,ttl:1/0,color:"#909",face:"",collidesWith:function(t){return function(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}(t,{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height})},update:function(t){this.face?this.width=this.height=200:(this.width=r(this.width,120,12,t),this.height=r(this.height,120,12,t)),this.advance(),this.color=this.width>128?"#909":"cyan"},render:function(t){if(kontra.context.fillStyle=this.color,kontra.context.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),"grab"==this.face){var i=kontra.context;i.fillStyle="#000",i.save(),i.translate(this.x-this.width/2,this.y-this.height/2),i.strokeStyle="#000000",i.fillStyle="#000000",i.lineWidth=.1*this.height,i.beginPath(),i.moveTo(.2*this.width,.3*this.height),i.lineTo(.4*this.width,.4*this.height),i.moveTo(.6*this.width,.4*this.height),i.lineTo(.8*this.width,.3*this.height),i.moveTo(.28*this.width,.33*this.height),i.lineTo(.28*this.width,.5*this.height),i.stroke(),i.beginPath(),i.arc(.5*this.width,.9*this.height,.2*this.height,1.25*Math.PI,.25*-Math.PI),i.stroke(),i.restore()}else if("cog"==this.face){var e=kontra.context;e.fillStyle="#000",e.save(),e.translate(this.x-this.width/2,this.y-this.height/2),e.strokeStyle="#000000",e.fillStyle="#000000",e.lineWidth=.1*this.height,e.beginPath(),e.arc(.3*this.width,.4*this.height,.2*this.height,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(.7*this.width,.5*this.height,.2*this.height,0,2*Math.PI),e.stroke(),e.fill(),e.beginPath(),e.arc(.5*this.width,1*this.height,.2*this.height,1.25*Math.PI,.25*-Math.PI),e.stroke(),e.restore()}else if("buzzsaw"==this.face){var n=kontra.context;n.fillStyle="#000",n.save(),n.translate(this.x-this.width/2,this.y-this.height/2),n.strokeStyle="#000000",n.fillStyle="#000000",n.lineWidth=.1*this.height,n.beginPath(),n.moveTo(.28*this.width,.4*this.height),n.lineTo(.28*this.width,.54*this.height),n.stroke(),n.beginPath(),n.arc(.3*this.width,.4*this.height,.1*this.height,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(.7*this.width,.33*this.height,.2*this.height,0,2*Math.PI),n.fill(),n.restore()}else{var s=kontra.context;s.fillStyle="#000",s.save(),s.translate(this.x-this.width/2,this.y-this.height/2),s.strokeStyle="#000000",s.fillStyle="#000000",s.lineWidth=.1*this.height,s.beginPath(),s.moveTo(.2*this.width,.6*this.height),s.lineTo(.4*this.width,.5*this.height),s.moveTo(.6*this.width,.5*this.height),s.lineTo(.8*this.width,.6*this.height),s.moveTo(.28*this.width,.56*this.height),s.lineTo(.28*this.width,.74*this.height),s.stroke(),s.beginPath(),s.arc(.5*this.width,1*this.height,.2*this.height,1.25*Math.PI,.25*-Math.PI),s.stroke(),s.restore()}},reset:function(){this.x=kontra.canvas.width/2,this.y=kontra.canvas.height/2,this.dx=this.dy=0,this.face=""}});A.push(I);var R={type:"enemy",color:"#909",x:kontra.canvas.width/2,y:kontra.canvas.height/2,collidesWith:c,radius:92,ttl:a(10),ticks:0,direction:1,width:92,update:function(t){this.ticks++,this.dx=0,this.dy=0,this.ddy=0,this.ticks<a(2)?this.dx=.2*kontra.canvas.width*this.direction/a(2):this.ticks<a(4)||(this.ticks<a(5)?this.dy=(.5*kontra.canvas.height-64)/a(1):this.ticks<a(10)&&(this.dy=-(kontra.canvas.height-2*this.radius)/a(5))),this.advance()},render:h},L={type:"enemy",color:"#909",x:46,y:-46,collidesWith:c,radius:64,width:64,ttl:a(10),ticks:0,direction:1,update:function(t){this.ticks++,this.ddy=0,this.ticks<a(2)?this.dy=this.radius/a(2):this.ticks<a(6)?this.dy=0:this.ddy=1,this.advance()},render:h},O={type:"enemy",color:"#909",x:kontra.canvas.width/2,y:kontra.canvas.height/2,collidesWith:c,radius:64,width:32,ttl:a(16),ticks:0,direction:"up",update:function(t){if(this.ticks++,this.ddy=0,this.dx=0,this.dy=0,this.ticks<a(1))"up"==this.direction&&(this.dy=-1*this.radius/a(1)),"down"==this.direction&&(this.dy=this.radius/a(1)),"left"==this.direction&&(this.dx=-1*this.radius/a(1)),"right"==this.direction&&(this.dx=this.radius/a(1));else if(this.ticks<a(2));else if(this.ticks<a(3))"up"==this.direction&&(this.y=r(this.y,this.radius,8,t)),"down"==this.direction&&(this.y=r(this.y,kontra.canvas.height-this.radius,8,t)),"left"==this.direction&&(this.x=r(this.x,this.radius,8,t)),"right"==this.direction&&(this.x=r(this.x,kontra.canvas.width-this.radius,8,t));else if(this.ticks<a(4));else if(this.ticks<a(9)){if(this.ticks%4==0){var i=kontra.sprite(C);i.x=this.x,i.y=this.y,i.radius=i.width=16,i.ttl=a(8);var e=10*Math.random()-2.5,n=10*Math.random()-2.5;i.dx={up:-10+e,down:10+e,left:10+e,right:-10+e}[this.direction],i.dy={up:10+n,down:-10+n,left:10+n,right:-10+n}[this.direction],i.ddx={up:0,down:0,left:-1,right:1}[this.direction],i.ddy={up:-1,down:1,left:0,right:0}[this.direction],A.push(i)}if(0==Math.floor(16*Math.random())){var s=kontra.sprite(C);s.x=this.x,s.y=this.y,s.radius=s.width=8,s.ttl=a(8),s.dx={up:0,down:0,left:5,right:-5}[this.direction],s.dy={up:5,down:-5,left:0,right:0}[this.direction],A.push(s)}"up"==this.direction&&(this.dx=(kontra.canvas.width/2+this.radius)/a(5)),"down"==this.direction&&(this.dx=-1*(kontra.canvas.width/2+this.radius)/a(5)),"left"==this.direction&&(this.dy=-1*(kontra.canvas.height/2+this.radius)/a(5)),"right"==this.direction&&(this.dy=(kontra.canvas.height/2+this.radius)/a(5))}this.advance()},render:h},j={type:"enemy",color:"#909",width:kontra.canvas.width,height:kontra.canvas.height,x:0,y:kontra.canvas.height,ticks:0,ttl:a(12),update:function(t){this.ticks++,this.ticks<a(5)?this.dy=-1*(kontra.canvas.height-184)/a(5):this.ddy=2,this.advance()}},W=124,B=140,U=172,N=kontra.gameLoop({fps:s/60,render:function(){},clearCanvas:!1,update:function(t){if(void 0===this.beat&&(this.beat=-1),this.beat++,292!==this.beat){if(console.log("beat "+Math.floor(1+this.beat/4)+"-"+Math.floor(1+this.beat%4)+" ("+this.beat+")"),0===this.beat&&(E.start(),k.play(),w.play()),32===this.beat&&(m.staccato=0,m.smoothing=0,m.play()),this.beat<128?this.beat%8==0&&b.play():this.beat<256&&this.beat%4==0&&(Math.floor(this.beat/4)%4==3?S.play():b.play()),128===this.beat&&(E.stop(),w.stop(),m.stop(),k.stop(),b.gain.gain.value=.1,M.play(),T.play(),m.staccato=.4,m.smoothing=.9,m.play()),28==this.beat||36===this.beat||44===this.beat||52===this.beat){var i=kontra.sprite(q);i.ttl=a(124-this.beat),A.unshift(i)}if(this.beat>96&&this.beat<128){var e=kontra.sprite(C);e.x=Math.random()*kontra.canvas.width,e.y=kontra.canvas.height+e.radius,e.ttl=(kontra.canvas.height+2*e.radius)/Math.abs(e.dy),A.unshift(e)}if(this.beat==W-4||this.beat==B-4||this.beat==U-4)for(var n=0;n<4;n++){var s=kontra.sprite(q);s.rotation=45*n,s.ttl=a(8),A.unshift(s)}if(this.beat==W+1&&(I.face="grab"),this.beat==W+2){var o=kontra.sprite(R);o.direction=-1;var r=kontra.sprite(R);A.unshift(o,r)}if(this.beat==W+6&&(I.dy=(.5*kontra.canvas.height-I.height/2)/a(1)),this.beat==W+7){var h=kontra.sprite(L);h.x=L.radius;var c=kontra.sprite(L);c.x=3*c.radius;var d=kontra.sprite(L);d.x=kontra.canvas.width-d.radius;var l=kontra.sprite(L);l.x=kontra.canvas.width-3*l.radius,A.push(h,c,d,l),I.dy=-1*(kontra.canvas.height-I.height)/a(4);var u=kontra.sprite(j);A.unshift(u)}if(this.beat==W+11&&(I.dy=0),this.beat==W+12&&(I.dy=(kontra.canvas.height-I.height)/a(2)),this.beat==W+14&&(I.dy=-1*(kontra.canvas.height/2-I.height/2)/a(2)),this.beat==W+16&&(I.dy=0,I.reset(),I.face="spaz",220==W&&(W=252),156==W&&(W=220),124==W&&(W=156)),this.beat==B+2&&(I.face="cog"),this.beat==B+4&&(I.dx=.5*kontra.canvas.width/a(2)),this.beat==B+6){I.dx=0;var f=kontra.sprite(P);f.x=kontra.canvas.width,f.y=kontra.canvas.height/2,A.push(f),I.x=-1*I.width}if(this.beat==B+7){I.dx=0;var p=kontra.sprite(C);p.dy=0,p.dx=-1*kontra.canvas.width/a(6),p.radius=kontra.canvas.height/2,p.width=128,p.x=kontra.canvas.width,p.y=kontra.canvas.height/2,p.ttl=a(6),A.push(p)}if(this.beat==B+13){I.dx=(kontra.canvas.width/2+I.width)/a(2);var y=kontra.sprite(P);y.x=0,y.y=kontra.canvas.height/2,A.push(y)}if(this.beat==B+15&&(I.dx=0,I.reset(),I.face="spaz",188==B&&(B=236),140==B&&(B=188)),this.beat==U+2&&(I.face="buzzsaw"),this.beat==U+4){var v=kontra.sprite(O),g=kontra.sprite(O);g.direction="right";var x=kontra.sprite(O);x.direction="down";var F=kontra.sprite(O);F.direction="left",A.unshift(v,g,x,F)}this.beat,this.beat,this.beat==U+15&&(I.dx=0,I.reset(),I.face="spaz",204==U&&(U=268),172==U&&(U=204))}else X()}}),D=kontra.gameLoop({update:function(t){F.map(function(i){i.update(t)}),F=F.filter(function(t){return t.isAlive()}),A.map(function(i){if(i.update(t),!_.iFrames&&"enemy"===i.type&&i.collidesWith(_))if(_.health--,_.health>0){_.stunFrames=45,_.iFrames=60;var e=2*Math.random()*Math.PI;_.dx=8*Math.cos(e),_.dy=8*Math.sin(e);for(var n=0;n<18;n++){var s=kontra.sprite({type:"particle",x:_.x,y:_.y,dx:24*Math.cos(o(20*n)),dy:24*Math.sin(o(20*n)),ttl:20,width:16,height:16,color:"#fff",update:function(t){this.advance()},render:function(){kontra.context.save(),kontra.context.fillStyle=this.color,kontra.context.beginPath(),kontra.context.arc(this.x,this.y,16,0,2*Math.PI),kontra.context.fill(),kontra.context.restore()}});A.push(s)}}else Y()}),A=A.filter(function(t){return t.isAlive()})},render:function(){A.map(function(t){return t.render()})}}),G=kontra.sprite({render:function(){kontra.context.strokeStyle="#fff",kontra.context.fillStyle="#fff",kontra.context.font="bold 48px Verdana",kontra.context.textAlign="right",kontra.context.fillText("CLOSE TO ME",kontra.canvas.width-20,.75*kontra.canvas.height),kontra.context.fillStyle="#0aa",kontra.context.font="24px Verdana",kontra.context.fillText("by",kontra.canvas.width-20,.75*kontra.canvas.height+30),kontra.context.fillText("Sabrepulse",kontra.canvas.width-20,.75*kontra.canvas.height+60),kontra.context.strokeStyle="#fff",kontra.context.fillStyle="#fff",kontra.context.font="bold 48px Verdana",kontra.context.textAlign="left",kontra.context.fillText("CONTROLS",20,.75*kontra.canvas.height),kontra.context.fillStyle="#0aa",kontra.context.font="24px Verdana",kontra.context.fillText("WASD to move",20,.75*kontra.canvas.height+30),kontra.context.fillText("Space to dash",20,.75*kontra.canvas.height+60),kontra.context.fillText("Space to dash",20,.75*kontra.canvas.height+60),kontra.context.textAlign="center",kontra.context.fillText("Space to start",kontra.canvas.width/2,kontra.canvas.height-24)}}),z=kontra.gameLoop({update:function(t){},render:function(){G.render()}});z.start();var V={width:10,height:10,color:"white",update:function(t){this.width=r(this.width,42,this.damping,t),this.height=r(this.height,42,this.damping,t),this.advance()},render:function(){kontra.context.save(),kontra.context.fillStyle="#fff",kontra.context.translate(this.x+21,this.y+21),kontra.context.fillRect(-this.width/2,-this.height/2,this.width,this.height),kontra.context.restore()}},$=kontra.sprite({rank:"E",render:function(){kontra.context.fillStyle="#888",kontra.context.font="bold 48px Verdana",kontra.context.textAlign="center",kontra.context.fillText("Rank: "+this.rank,kontra.canvas.width/2,kontra.canvas.height/2),kontra.context.font="24px Verdana",kontra.context.fillText("R to restart",kontra.canvas.width/2,kontra.canvas.height/2+48)}}),J=Math.sqrt(Math.pow(kontra.canvas.width,2)+Math.pow(kontra.canvas.height,2))/2,H=kontra.gameLoop({update:function(t){if(!this.winSprites){this.winSprites=[];for(var i=0;i<kontra.canvas.height;i+=40)for(var e=0;e<kontra.canvas.width;e+=40){var n=kontra.sprite(V);n.x=e,n.y=i,n.damping=.7+Math.sqrt(Math.pow(e-kontra.canvas.width/2,2)+Math.pow(i-kontra.canvas.height/2,2))/J,this.winSprites.push(n)}}this.winSprites.map(function(i){return i.update(t)})},render:function(t){this.winSprites&&this.winSprites.map(function(t){return t.render()}),$.render()}});kontra.keys.bind("space",function(){z.isStopped?this.dashFrames>0||this.stunFrames>0||(this.dx||this.dy)&&(this.dashFrames=30,this.iFrames=30):K()}.bind(_)),kontra.keys.bind("r",function(){K()});var K=function(){A.forEach(function(t){"player"===!t.type&&(t.ttl=0)}),_.health=7,_.x=100,_.y=kontra.canvas.height/2,F.forEach(function(t){return t.stop()}),F=[],k.stop(),w.stop(),m.stop(),b.stop(),S.stop(),M.stop(),T.stop(),z.stop(),D.isStopped&&D.start(),N.beat=-1,N.isStopped&&N.start(),I.reset(),W=124,B=140,U=172},Q=function(){k.stop(),w.stop(),m.stop(),b.stop(),S.stop(),M.stop(),T.stop(),D.stop(),N.stop(),H.stop(),z.stop()},X=function(){Q(),$.rank=["S","A","B","C","D","D","E"][7-_.health],H.isStopped&&H.start()},Y=function(){Q(),z.isStopped&&z.start()}},function(t,i,e){var n=e(3);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};e(5)(n,s);n.locals&&(t.exports=n.locals)},function(t,i,e){(t.exports=e(4)(!1)).push([t.i,"* {\r\n    box-sizing:border-box;\r\n}\r\n\r\nbody {\r\n    color:white;\r\n    background-color:#303;\r\n    overflow:hidden;\r\n    margin:0;\r\n    text-align:center;\r\n}\r\n\r\ncanvas {\r\n    background-color:#101;\r\n    border: 8px solid #f0f;\r\n    width:100%;\r\n    max-width:1280px;\r\n    margin:0px auto;\r\n}\r\n",""])},function(t,i){t.exports=function(t){var i=[];return i.toString=function(){return this.map(function(i){var e=function(t,i){var e=t[1]||"",n=t[3];if(!n)return e;if(i&&"function"==typeof btoa){var s=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(n),a=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[e].concat(a).concat([s]).join("\n")}return[e].join("\n")}(i,t);return i[2]?"@media "+i[2]+"{"+e+"}":e}).join("")},i.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var a=this[s][0];"number"==typeof a&&(n[a]=!0)}for(s=0;s<t.length;s++){var o=t[s];"number"==typeof o[0]&&n[o[0]]||(e&&!o[2]?o[2]=e:e&&(o[2]="("+o[2]+") and ("+e+")"),i.push(o))}},i}},function(t,i,e){var n={},s=function(t){var i;return function(){return void 0===i&&(i=t.apply(this,arguments)),i}}(function(){return window&&document&&document.all&&!window.atob}),a=function(t){var i={};return function(t,e){if("function"==typeof t)return t();if(void 0===i[t]){var n=function(t,i){return i?i.querySelector(t):document.querySelector(t)}.call(this,t,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}i[t]=n}return i[t]}}(),o=null,r=0,h=[],c=e(6);function d(t,i){for(var e=0;e<t.length;e++){var s=t[e],a=n[s.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](s.parts[o]);for(;o<s.parts.length;o++)a.parts.push(v(s.parts[o],i))}else{var r=[];for(o=0;o<s.parts.length;o++)r.push(v(s.parts[o],i));n[s.id]={id:s.id,refs:1,parts:r}}}}function l(t,i){for(var e=[],n={},s=0;s<t.length;s++){var a=t[s],o=i.base?a[0]+i.base:a[0],r={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(r):e.push(n[o]={id:o,parts:[r]})}return e}function u(t,i){var e=a(t.insertInto);if(!e)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===t.insertAt)n?n.nextSibling?e.insertBefore(i,n.nextSibling):e.appendChild(i):e.insertBefore(i,e.firstChild),h.push(i);else if("bottom"===t.insertAt)e.appendChild(i);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=a(t.insertAt.before,e);e.insertBefore(i,s)}}function f(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var i=h.indexOf(t);i>=0&&h.splice(i,1)}function p(t){var i=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return e.nc}();n&&(t.attrs.nonce=n)}return y(i,t.attrs),u(t,i),i}function y(t,i){Object.keys(i).forEach(function(e){t.setAttribute(e,i[e])})}function v(t,i){var e,n,s,a;if(i.transform&&t.css){if(!(a=i.transform(t.css)))return function(){};t.css=a}if(i.singleton){var h=r++;e=o||(o=p(i)),n=x.bind(null,e,h,!1),s=x.bind(null,e,h,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(e=function(t){var i=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(i,t.attrs),u(t,i),i}(i),n=function(t,i,e){var n=e.css,s=e.sourceMap,a=void 0===i.convertToAbsoluteUrls&&s;(i.convertToAbsoluteUrls||a)&&(n=c(n));s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var o=new Blob([n],{type:"text/css"}),r=t.href;t.href=URL.createObjectURL(o),r&&URL.revokeObjectURL(r)}.bind(null,e,i),s=function(){f(e),e.href&&URL.revokeObjectURL(e.href)}):(e=p(i),n=function(t,i){var e=i.css,n=i.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}.bind(null,e),s=function(){f(e)});return n(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;n(t=i)}else s()}}t.exports=function(t,i){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(i=i||{}).attrs="object"==typeof i.attrs?i.attrs:{},i.singleton||"boolean"==typeof i.singleton||(i.singleton=s()),i.insertInto||(i.insertInto="head"),i.insertAt||(i.insertAt="bottom");var e=l(t,i);return d(e,i),function(t){for(var s=[],a=0;a<e.length;a++){var o=e[a];(r=n[o.id]).refs--,s.push(r)}t&&d(l(t,i),i);for(a=0;a<s.length;a++){var r;if(0===(r=s[a]).refs){for(var h=0;h<r.parts.length;h++)r.parts[h]();delete n[r.id]}}}};var g=function(){var t=[];return function(i,e){return t[i]=e,t.filter(Boolean).join("\n")}}();function x(t,i,e,n){var s=e?"":n.css;if(t.styleSheet)t.styleSheet.cssText=g(i,s);else{var a=document.createTextNode(s),o=t.childNodes;o[i]&&t.removeChild(o[i]),o.length?t.insertBefore(a,o[i]):t.appendChild(a)}}},function(t,i){t.exports=function(t){var i="undefined"!=typeof window&&window.location;if(!i)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var e=i.protocol+"//"+i.host,n=e+i.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,i){var s,a=i.trim().replace(/^"(.*)"$/,function(t,i){return i}).replace(/^'(.*)'$/,function(t,i){return i});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?t:(s=0===a.indexOf("//")?a:0===a.indexOf("/")?e+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,i,e){e(8)(e(9))},function(t,i){t.exports=function(t){function i(t){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",t)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(t):"undefined"!=typeof eval?eval.call(null,t):i("EvalError: No eval function available")}catch(t){i(t)}}},function(t,i){t.exports='/*\n * Kontra.js v4.0.0 (Custom Build on 2018-08-15) | MIT\n * Build: https://straker.github.io/kontra/download?files=gameLoop+keyboard+sprite\n */\nthis.kontra={init(t){var n=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=n.getContext("2d")},_noop:new Function,_tick:new Function};\nkontra.gameLoop=function(e){let t,n,a,r,o=(e=e||{}).fps||60,i=0,p=1e3/o,c=1/o,s=!1===e.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function d(){if(n=requestAnimationFrame(d),a=performance.now(),r=a-t,t=a,!(r>1e3)){for(kontra._tick(),i+=r;i>=p;)m.update(c),i-=p;s(),m.render()}}let m={update:e.update,render:e.render,isStopped:!0,start(){t=performance.now(),this.isStopped=!1,requestAnimationFrame(d)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return m};\n!function(){let n={},t={},e={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let n=0;n<26;n++)e[65+n]=(10+n).toString(36);for(i=0;i<10;i++)e[48+i]=""+i;addEventListener("keydown",function(i){let c=e[i.which];t[c]=!0,n[c]&&n[c](i)}),addEventListener("keyup",function(n){t[e[n.which]]=!1}),addEventListener("blur",function(n){t={}}),kontra.keys={bind(t,e){[].concat(t).map(function(t){n[t]=e})},unbind(t,e){[].concat(t).map(function(t){n[t]=e})},pressed:n=>!!t[n]}}();\n!function(){class t{constructor(t,i){this._x=t||0,this._y=i||0}add(t,i){this.x+=(t.x||0)*(i||1),this.y+=(t.y||0)*(i||1)}clamp(t,i,h,s){this._c=!0,this._a=t,this._b=i,this._d=h,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((i,h)=>new t(i,h)),kontra.vector.prototype=t.prototype;class i{init(t,i,h,s){for(i in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[i]=t[i];if(h=t.image)this.image=h,this.width=h.width,this.height=h.height;else if(h=t.animations){for(i in h)this.animations[i]=h[i].clone(),s=s||h[i];this._ca=s,this.width=s.width,this.height=s.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(t=>(new i).init(t)),kontra.sprite.prototype=i.prototype}();'}]);</script></body>
</html>