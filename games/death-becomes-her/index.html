<html style=background-color:#000;margin:0><title>Death becomes her</title><script type=module>var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();let i,n,s=()=>{},a={};function o(t,...e){(a[t]||[]).map((t=>t(...e)))}let r={get:(t,e)=>"_proxy"==e||s};function l(){return i}function h(){return n}function c(t,e){return(Math.random()*(e-t+1)|0)+t}function d(t,e,s){return Math.min(Math.max(t,s),e)}class m{constructor(t=0,e=0,s={}){this.x=t,this.y=e,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=e)}add(t){return new m(this.x+t.x,this.y+t.y,this)}subtract(t){return new m(this.x-t.x,this.y-t.y,this)}scale(t){return new m(this.x*t,this.y*t)}normalize(t=this.length()){return new m(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,s,i){this._c=!0,this._a=t,this._b=e,this._d=s,this._e=i}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?d(this._a,this._d,t):t}set y(t){this._y=this._c?d(this._b,this._e,t):t}}function u(){return new m(...arguments)}class p extends class{constructor(t){return this.init(t)}init(t={}){this.position=u(),this.velocity=u(),this.acceleration=u(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:s=h(),render:i=this.draw,update:n=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:r=1,rotation:l=0,scaleX:c=1,scaleY:d=1,...m}={}){this._c=[],super.init({width:t,height:e,context:s,anchor:o,opacity:r,rotation:l,scaleX:c,scaleY:d,...m}),this._di=!0,this._uw(),this.addChild(a),this._rf=i,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(e||s)&&t.translate(e,s),this.context.globalAlpha=this.opacity,this._rf(),(e||s)&&t.translate(-e,-s),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:s=1,_wr:i=0,_wsx:n=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=n*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=i+this.rotation;let{x:o,y:r}=function(t,e){let s=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}}({x:this._wx,y:this._wy},i);this._wx=o,this._wy=r,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||s,t._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let s=t.indexOf(e);if(-1!=s)return t.splice(s,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class y extends p{init({image:t,width:e=(t?t.width:void 0),height:s=(t?t.height:void 0),...i}={}){super.init({image:t,width:e,height:s,...i})}get animations(){return this._a}set animations(t){let e,s;for(e in this._a={},t)this._a[e]=t[e].clone(),s=s||this._a[e];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function g(){return new y(...arguments)}let f=new WeakMap,x={},w={},b={0:"left",1:"middle",2:"right"};function v(t,e){let{x:s,y:i,width:n,height:a}=function(t){let{x:e=0,y:s=0,width:i,height:n}=t.world||t;return t.mapwidth&&(i=t.mapwidth,n=t.mapheight),t.anchor&&(e-=i*t.anchor.x,s-=n*t.anchor.y),i<0&&(e+=i,i*=-1),n<0&&(s+=n,n*=-1),{x:e,y:s,width:i,height:n}}(t);do{s-=t.sx||0,i-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(s,Math.min(e.x,s+n)),r=e.y-Math.max(i,Math.min(e.y,i+a));return o*o+r*r<e.radius*e.radius}function k(t,e){return parseFloat(t.getPropertyValue(e))||0}function _(t){let e=null!=t.button?b[t.button]:"left";w[e]=!0,M(t,"onDown")}function E(t){let e=null!=t.button?b[t.button]:"left";w[e]=!1,M(t,"onUp")}function S(t){M(t,"onOver")}function C(t){f.get(t.target)._oo=null,w={}}function B(t,e,s){let i=function(t){let e=t._lf.length?t._lf:t._cf;for(let s=e.length-1;s>=0;s--){let i=e[s];if(i.collidesWithPointer?i.collidesWithPointer(t):v(i,t))return i}}(t);i&&i[e]&&i[e](s),x[e]&&x[e](s,i),"onOver"==e&&(i!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(s),t._oo=i)}function M(t,e){t.preventDefault();let s=t.target,i=f.get(s),{scaleX:n,scaleY:a,offsetX:r,offsetY:l}=function(t){let{canvas:e,_s:s}=t,i=e.getBoundingClientRect(),n="none"!=s.transform?s.transform.replace("matrix(","").split(","):[1,1,1,1],a=parseFloat(n[0]),o=parseFloat(n[3]),r=(k(s,"border-left-width")+k(s,"border-right-width"))*a,l=(k(s,"border-top-width")+k(s,"border-bottom-width"))*o,h=(k(s,"padding-left")+k(s,"padding-right"))*a,c=(k(s,"padding-top")+k(s,"padding-bottom"))*o;return{scaleX:(i.width-r-h)/e.width,scaleY:(i.height-l-c)/e.height,offsetX:i.left+(k(s,"border-left-width")+k(s,"padding-left"))*a,offsetY:i.top+(k(s,"border-top-width")+k(s,"padding-top"))*o}}(i);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:s})=>{let o=i.touches[s];o||(o=i.touches[s]={start:{x:(t-r)/n,y:(e-l)/a}},i.touches.length++),o.changed=!1})),Array.from(t.changedTouches).map((({clientX:s,clientY:h,identifier:c})=>{let d=i.touches[c];d.changed=!0,d.x=i.x=(s-r)/n,d.y=i.y=(h-l)/a,B(i,e,t),o("touchChanged",t,i.touches),"onUp"==e&&(delete i.touches[c],i.touches.length--,i.touches.length||o("touchEnd"))}))):(i.x=(t.clientX-r)/n,i.y=(t.clientY-l)/a,B(i,e,t))}function O({radius:t=5,canvas:e=l()}={}){let s=f.get(e);if(!s){let i=window.getComputedStyle(e);s={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:i},f.set(e,s)}var i,n;return e.addEventListener("mousedown",_),e.addEventListener("touchstart",_),e.addEventListener("mouseup",E),e.addEventListener("touchend",E),e.addEventListener("touchcancel",E),e.addEventListener("blur",C),e.addEventListener("mousemove",S),e.addEventListener("touchmove",S),s._t||(s._t=!0,n=()=>{s._lf.length=0,s._cf.map((t=>{s._lf.push(t)})),s._cf.length=0},a[i="tick"]=a[i]||[],a[i].push(n)),s}function I(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}const D=t=>4*t,T={hp:"Health",str:"Strength",int:"Intelligence",def:"Defence",stamina:"Stamina",wp:"Willpower"},L=t=>({name:"",value:0,type:"str",effect:"str",cost:1,...t}),A=t=>({name:"",color:"",...t,skills:t.skills?t.skills.map((t=>L(t))):[]}),P=t=>({hp:1,str:1,int:1,def:1,stamina:1,wp:1,...t}),Y=t=>{var e,s;return{name:"",height:D(t.sprite&&t.width?t.sprite.length/t.width:1),sprite:"1",width:1,...t,stats:P({...t.stats}),skills:null!=(s=null==(e=t.skills)?void 0:e.map((t=>L(t))))?s:[]}},H={struggle:{name:"Struggle",value:5,cost:0},stumble:{name:"Stumble",value:10},pound:{name:"Pound",value:15,cost:0},scratch:{name:"scratch",value:20},bite:{name:"Bite",value:35,cost:2},dig:{name:"Dig",value:30},cleave:{name:"Cleave",value:45,cost:2},claw:{name:"Claw",value:50,cost:2},shatteredBottle:{name:"Shattered Bottle",value:55,cost:3},bash:{name:"Bash",value:60,cost:3},ss:{name:"Sinister Strike",value:70,cost:4},stomp:{name:"Stomp",value:85,cost:5},hustle:{name:"Hustle",value:10,type:"int",cost:0},badOmen:{name:"Bad omen",value:15,type:"int"},screech:{name:"Screech",value:25,type:"int",cost:2},woundPoison:{name:"Wound Poison",value:30,type:"int",cost:2},sf:{name:"Sacred Flame",value:40,type:"int",cost:2},banishment:{name:"Banishment",value:55,type:"int",cost:3},sta:{name:"Split hairs",value:85,type:"int",cost:5},ts:{name:"Thunderstorm",value:75,type:"int",cost:4},ooze:{name:"Ooze",type:"fixed",value:4},drool:{name:"drool",type:"boost",value:1,cost:2},p:{name:"Pointless Life",type:"boost",value:2},fury:{name:"Fury",type:"boost",value:2,cost:2},innerStr:{name:"Inner Strength",type:"boost",value:3,cost:3},grin:{name:"Grin",type:"boost",value:2,effect:"wp",cost:2},rollingStone:{name:"Rolling stone",type:"boost",value:3,effect:"wp",cost:2},scienceMagazine:{name:"Science Magazine",type:"boost",value:3,effect:"int",cost:3},mindfulness:{name:"Mindfulness",type:"boost",value:1.15,effect:"hp",cost:2},heal:{name:"Heal",type:"boost",value:1.2,effect:"hp",cost:2},blessing:{name:"Blessing",type:"boost",value:1.35,effect:"hp",cost:3},hold:{name:"Hold kitchen knife threateningly",type:"boost",value:1,effect:"def"},ms:{name:"Mud spin",type:"boost",value:3,effect:"def",cost:2},cry:{name:"Cry",value:-1,type:"status",effect:"def",cost:2},warcry:{name:"Warcry",value:-2,type:"status",effect:"def",cost:2},o:{name:"Osteoporosis",type:"status",value:-3,effect:"def",cost:3},pf:{name:"Smirk",type:"status",value:-2,effect:"wp"},spook:{name:"Spook",type:"status",value:-3,effect:"wp",cost:3},backstab:{name:"Backstab",type:"status",value:-2,effect:"int",cost:3},mix:{name:"Mix a Drink",type:"boost",value:1.1,effect:"stamina",cost:0},hy:{name:"Hypnotic Magnetic Glare",type:"status",value:-3,effect:"int",cost:3},smallTalk:{name:"Small talk",type:"status",value:-1,effect:"str"},bandage:{name:"Bandages",type:"status",value:-3,cost:3}},F={color:"yellow",name:"Kid",skills:[H.cry,H.drool,H.scratch]},R=[F,{color:"red",name:"Barbarian",skills:[H.cleave,H.bash,H.fury]},{color:"gold",name:"Cleric",skills:[H.sf,H.blessing,H.banishment]},{color:"green",name:"Rogue",skills:[H.ss,H.woundPoison,H.backstab]},{color:"blue",name:"Monk",skills:[H.pound,H.mindfulness,H.innerStr]},{color:"violet",name:"Bartender",skills:[H.mix,H.shatteredBottle,H.smallTalk]},{color:"cyan",name:"Scientist",skills:[H.scienceMagazine,H.hustle,H.sta]}],z={name:"Goblin",stats:{hp:2,str:3,def:3,stamina:4,wp:2},skills:[H.stumble],width:4,sprite:"00101111010011111001"},X={name:"Girl",width:13,sprite:"00011000110000011111111100001010101010000101111101000010111110100001000100010011100111001110110011100110000011111000000001111100000001111111000001111111110000000101000000000010100000",stats:{hp:2,int:4,def:0},skills:[H.hold]},G=[z,{name:"Human",stats:{hp:3,str:3,int:3,def:2,stamina:3,wp:2},skills:[H.struggle],width:7,sprite:"00111000111110110101101111100111110001110011111111011101101110100101000110110"},{name:"Slime",width:9,sprite:"000001000000010000000010000000111000001111100011111111011111110111111110",stats:{hp:2,str:2,int:2,def:2,stamina:2,wp:2},skills:[H.ooze]},{name:"Rat",width:7,sprite:"100111111111100001010",stats:{str:5,def:3,stamina:3,wp:3},skills:[H.bite]},{name:"Bat",width:9,sprite:"010111010101111101",stats:{int:5,def:3,stamina:3,wp:3},skills:[H.screech]},{name:"Dhalion",width:7,sprite:"00001100000010000011000010100011110000011100011110011110011111100100010111011",stats:{hp:5,def:3,stamina:3,wp:3},skills:[H.heal]},{name:"Elf",width:9,sprite:"000111000111111111001111100000010000001111100001010100001010100000101000000101000",stats:{hp:3,str:3,int:3,def:2,stamina:2,wp:5},skills:[H.pf]},{name:"Ipotane",width:5,sprite:"100001111111111100101001011011",stats:{str:5,int:5,stamina:5},skills:[H.p]},{name:"Imp",width:7,sprite:"001110010111010101010001110100111110010100",stats:{hp:2,str:2,int:2,stamina:5,wp:5},skills:[H.grin]},{name:"Spider",width:9,sprite:"001000100001010100111111111011111110101010101001000100",stats:{hp:2,str:2,int:3,def:5,stamina:2},skills:[H.badOmen]}],U=[{name:"Gargoyle",width:5,sprite:"1101111111011101111110001110111101101010",stats:{hp:10,str:10,int:2,def:5,stamina:2,wp:3},skills:[H.claw]},{name:"Dwarf",width:5,sprite:"01110101011111110001",stats:{hp:7,str:7,int:4,def:4,stamina:2,wp:4},skills:[H.dig]},{name:"Vampire",width:7,sprite:"00111001011101011111000111000001000010101001111100010100",stats:{hp:5,str:8,int:9,def:2,stamina:4,wp:6},skills:[H.hy]},{name:"Minotaur",width:8,sprite:"0010001000110110001111000001100000011000011111100101101001011010000110000001100000011000",stats:{hp:6,str:10,def:4,stamina:2,wp:2},skills:[H.stomp]},{name:"Mummy",width:7,sprite:"000110000111000001000011111010010100101010100100100101000010111",stats:{hp:6,str:3,int:3,def:7,stamina:4,wp:7},skills:[H.bandage]},{name:"Skeleton",width:7,sprite:"011111001010100111110000100011111110001000111111100010000001000011011001000100100010",stats:{hp:5,str:5,int:3,def:7,stamina:4,wp:4},skills:[H.o]},{name:"Ghost",width:5,sprite:"011101111110101111111111110101",stats:{hp:5,int:5,def:3,stamina:5,wp:10},skills:[H.spook]},{name:"Varaha",width:7,sprite:"001001000111100101101011111100011000111111111111000111100011110001001000100100",stats:{hp:10,str:5,def:5,stamina:5,wp:4},skills:[H.ms]},{name:"Roc",width:11,sprite:"100000000001100000000001000000001011011100110010100011000111111100000011000011100110011001111111100",stats:{hp:7,str:5,int:10,def:5,stamina:3,wp:5},skills:[H.ts]},{name:"Troll",width:6,sprite:"100000110011100011100111100111111111000101",stats:{hp:10,str:3,int:3,def:7,stamina:5,wp:7},skills:[H.rollingStone]}],j={name:"Chimera",stats:{hp:10,str:10,int:10,wp:10,def:10,stamina:10},width:40,sprite:Array.from(Array(800)).map((()=>[0,1][c(0,1)])).join()},W={race:Y(j),class:A({name:"Lord",color:"black",skills:[{name:"Ultimate Attack",type:"random"}]}),level:10},$={race:Y(z),class:{...A(F),color:"silver",name:"Reborn"},level:1},Z={name:"Rex",color:"vermillion",skills:[H.bash,H.fury,H.pound]},q={race:Y({name:"Hobgoblin",stats:{hp:5,str:5,int:5,wp:5,def:5,stamina:5},width:7,sprite:"11111111111111110101101111100111110001110011111111011101101110100101001110111",skills:[H.warcry]}),class:{...A(Z)},level:5},N={6:4,5:3.5,4:3,3:2.5,2:2,1:1.5,0:1,"-1":.66,"-2":.5,"-3":.4,"-4":.33,"-5":.28,"-6":.25},K=({power:t,attack:e,defense:s,attackerLevel:i})=>Math.ceil((2*i/5+2)/50*t*(e/s)+2),V=(t,e)=>("hp"!==t.effect&&"stamina"!==t.effect&&(e.statStages[t.effect]+=t.value,e.statStages[t.effect]<-6&&(e.statStages[t.effect]=-6),e.statStages[t.effect]>6&&(e.statStages[t.effect]=6)),"hp"===t.effect&&(e.stats.hp+=e.monsterData.race.stats.hp*t.value,e.stats.hp=Math.ceil(e.stats.hp)),"stamina"===t.effect&&(e.stats.stamina+=1),0);class J extends y{constructor(t){super({...t,color:void 0}),e(this,"display",!0),e(this,"_monsterData"),e(this,"animationTime",0),e(this,"stats"),e(this,"stopped",!1),e(this,"statStages"),e(this,"clickable",!0),e(this,"handler");const{monster:s}=t;this.monsterData=s,function(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:l(),s=f.get(e);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))}))}(this),this.statStages={str:0,int:0,def:0,wp:0}}set monsterData(t){this._monsterData=t,this.width=D(t.race.width),this.height=t.race.height,this.stats={...this.monsterData.race.stats},Object.keys(this.stats).forEach((t=>{if(t in this.stats){const e=t;this.stats[e]*=10}})),this.stats.stamina=this.monsterData.race.stats.stamina,this.monsterSprite()}get monsterData(){return this._monsterData}monsterSprite(){const t=this.monsterData.race.sprite.split("").map((t=>+t)),e=[];for(let s=0;s<t.length;s+=this.monsterData.race.width)e.push(t.slice(s,s+this.monsterData.race.width));this.children=[],e.forEach(((t,e)=>t.forEach(((t,s)=>{t&&this.addChild(g({y:4*e,x:4*s,width:4,height:4,color:this.monsterData.class.color}))}))))}onDown(){this.handler&&this.display&&this.clickable&&this.handler(this)}resetAnimation(){this.animationTime=0}update(t){super.update(),this.stopped||(this.animationTime+=t,this.x+=Math.sign(Math.cos(this.animationTime))*Math.cos(this.animationTime)**2/8,this.y+=Math.sin(2.1*this.animationTime)/20)}render(){this.display&&super.render()}getSkills(){return[this.monsterData.class.skills,this.monsterData.race.skills].flat()}attack(t,e){return((t,e,s)=>{let i=t;if(i.cost>e.stats.stamina)return-1;e.stats.stamina-=i.cost,"random"===i.type&&(i=L(Object.entries(H)[c(0,Object.keys(H).length-1)][1]));const n=i.type;let a=i.value;if("int"===n||"str"===n){const t=String(e.statStages[n]),o="str"===n?"def":"wp",r=String(s.statStages[o]);a=K({power:i.value,attack:e.stats[n]*N[t],attackerLevel:e.monsterData.level,defense:s.stats[o]*N[r]})}return"boost"===n?V(i,e):"status"===n?V(i,s):(s.stats.hp=s.stats.hp-a>0?s.stats.hp-a:0,a)})(t,this,e)}}const Q=t=>{t.forEach(((t,e)=>{const s=l().width/4*(e+1);xt.monsterSprites.push(new J({x:s,y:100,dx:0,monster:t})),xt.monsterSprites.forEach((t=>{t.handler=()=>xt.battleManager.selectForBattle(t)}))}))};class tt extends p{}class et{constructor({canvas:t,y:s,x:i,width:n,height:a,z:o=100,color:r="white"}){e(this,"rootElement"),e(this,"rendered",!1),e(this,"canvas"),e(this,"width"),e(this,"height"),e(this,"x"),e(this,"y"),e(this,"fitElement",(()=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.rootElement.style.width=t.width*this.width+"px",this.rootElement.style.height=t.height*this.height+"px",this.rootElement.style.top=`${t.y+t.height*this.y}px`,this.rootElement.style.left=`${t.x+t.width*this.x}px`})),this.rootElement=document.createElement("div"),this.canvas=t,this.y=s,this.x=i,this.width=n,this.height=a,this.rootElement.style.zIndex=`${o}`,this.rootElement.style.background=r,this.rootElement.style.position="fixed",this.rootElement.style.overflow="hidden",this.rootElement.style.fontSize="2vmin",this.fitElement()}render(){document.body.appendChild(this.rootElement),this.rendered=!0}unrender(){this.rootElement.remove(),this.rendered=!1}update(){this.rendered&&this.fitElement()}}const st=t=>{const e=document.createElement("button");return e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",it(e),e.textContent=t,e},it=t=>{t.style.background="#f8f5de",t.style.backgroundImage="linear-gradient(to right, rgba(255,210,0,0.4), rgba(200, 160, 0, 0.1) 11%, rgba(0,0,0,0) 35%, rgba(200, 160, 0, 0.1) 65%);",t.style.boxShadow="inset 0 0 75px rgba(255,210,0,0.3), inset 0 0 20px rgba(255,210,0,0.4), inset 0 0 30px rgba(220,120,0,0.8)",t.style.textTransform="uppercase",t.style.fontWeight="800",t.style.border="1px solid rgba(255,210,0,0.4)",t.style.fontSize="2vmin"};class nt extends et{constructor(t){super(t);const e=this.rootElement.style;it(this.rootElement),e.display="flex",e.flexDirection="column",e.overflow="auto",e.boxSizing="border-box"}addLine(t){const e=document.createElement("p");e.style.border="0.25vh dotted black",e.textContent=t,e.style.margin="1px",this.rootElement.prepend(e)}update(){super.update()}}class at extends et{constructor(t){super(t),e(this,"options"),e(this,"text"),this.rootElement.style.display="flex",this.rootElement.style.flexFlow="column",this.rootElement.style.backgroundColor="transparent",this.options=t.options,this.text=t.text,this.setOptions()}setOptions(){this.rootElement.innerHTML="";const t=document.createElement("div");it(t),t.textContent=this.text,t.style.width="100%",t.style.textAlign="center",t.style.height="12.5%",this.rootElement.appendChild(t),this.options.forEach((t=>this.addOption(t)))}addOption(t){const e=st(t.title);e.style.height="12.5%",e.style.color=t.color,e.onclick=t.handler(this),this.rootElement.appendChild(e)}update(){super.update()}}class ot{constructor(t,s){e(this,"canvas"),e(this,"monOp"),e(this,"monsterBox"),e(this,"choosingClass",!1),e(this,"battleEnded",!1),this.canvas=s,this.monsterBox=t}selectForBattle(t){this.battleEnded=!1,this.monOp=t,t.x=this.canvas.width/2-t.width/2,t.y=this.canvas.height/2-t.height/2,t.resetAnimation(),xt.monsterSprites.forEach((t=>{t!==this.monOp&&(t.display=!1)})),this.monsterBox.setMonster(t)}shakeObject(t,e=0){setTimeout((()=>{setTimeout((()=>{t.x+=20}),100),setTimeout((()=>{t.x-=40}),300),setTimeout((()=>{t.x+=20}),500)}),e)}battleEndCb(){this.battleEnded=!0,this.monOp&&(xt.player.hp=this.monOp.monsterData.race.stats.hp,this.killMonster(),this.choosingClass||(this.showDialog(),this.choosingClass=!0))}setPlayerMonster(){const t={...this.monOp.monsterData};t.class.name="Reborn",t.class.color="silver",t.level=1,xt.player.monsterData={...t,race:{...t.race,stats:{...t.race.stats,hp:t.race.stats.hp+.5}}},xt.playerBox.setMonster(xt.player),xt.player.statStages={str:0,int:0,def:0,wp:0}}skillsChosenCb(){this.setPlayerMonster(),this.setPlayerSkills(xt.player.skills),this.monOp=void 0,this.monsterBox.setMonster(void 0)}useSkill(t,e){if(!this.monOp)return;e.unrender();const s=xt.player.attack(t,this.monOp),i=rt(t,s,"You");xt.battleLog.addLine(i),this.monOp.stats.hp<=0?this.battleEndCb():(xt.playerBox.setMonster(xt.player),this.shakeObject(this.monOp),this.shakeObject(xt.background,500),setTimeout((()=>{if(!this.monOp)return;const t=this.monOp.getSkills()[c(0,this.monOp.getSkills().length-1)],e=this.monOp.attack(t,xt.player),s=rt(t,e,this.monOp.monsterData.race.name);xt.battleLog.addLine(s),xt.playerBox.setMonster(xt.player),this.monOp.stats.hp<=0&&this.battleEndCb()}),500),setTimeout((()=>{xt.player.stats.stamina=xt.player.stats.stamina<10?xt.player.stats.stamina+1:10,this.monOp&&(this.monOp.stats.stamina=this.monOp.stats.stamina<10?this.monOp.stats.stamina+1:10),this.battleEnded||e.render()}),1e3))}killMonster(){if(xt.showBoss)return;const t=xt.monsterSprites.findIndex((t=>t===this.monOp));t<0||xt.monsterSprites.splice(t,1)}showDialog(){const{player:t}=xt;if(!this.monOp||!t)return;t.skills=[];const e=[...t.monsterData.class.skills,...this.monOp.monsterData.class.skills].filter(((t,e,s)=>s.findIndex((e=>e.name===t.name))===e)).map((s=>({title:s.name,color:"str"===s.type?"red":"int"===s.type?"blue":"status"===s.type?"green":"violet",handler:i=>()=>{t.skills.push(s),i.options=i.options.filter((t=>t.title!==s.name)),i.setOptions();const n=e.length>4?4:e.length;t.skills.length>=n&&this.monOp&&(this.skillsChosenCb(),this.choosingClass=!1,i.unrender(),xt.monsterSprites.forEach((t=>t.display=!0)),xt.showBoss&&(xt.monsterSprites[0].display=!1,xt.storyBox.render(),xt.showBoss=!1))}}))),s=new at({options:e,text:"Choose your skills",x:.2,y:.2,width:.6,height:.6,canvas:this.monsterBox.canvas});this.setPlayerMonster(),s.render(),xt.uiElements.push(s)}setPlayerSkills(t){xt.player.monsterData.class.skills=t,xt.playerBox.setMonster(xt.player)}}const rt=(t,e,s)=>{if(e<0)return s+" used "+t.name+". But there is no stamina to do that";if(t.flavor)return s+" used "+t.name+". "+t.flavor;let i="";switch(t.type){case"str":case"int":case"fixed":i="It dealt "+e+" damage.";break;case"boost":i=T[t.effect]+" increased.";break;case"status":i="Opponent's "+T[t.effect]+" fell.";break;default:i="error"+t.type}return s+" used "+t.name+". "+i};class lt extends et{constructor(t){super(t),e(this,"battleManager"),e(this,"monster"),this.battleManager=t.battleManager,this.rootElement.style.display="flex"}changeSkills(t){this.rootElement.innerHTML="",t.forEach((t=>{const e=st(t.name);"str"===t.type&&(e.style.color="red"),"int"===t.type&&(e.style.color="blue"),"status"===t.type&&(e.style.color="violet"),"boost"===t.type&&(e.style.color="green");const s=document.createElement("span");s.textContent=`Cost: ${t.cost}`,e.appendChild(s),e.style.flex="1",e.onclick=()=>{this.battleManager.useSkill(t,this)},this.rootElement.appendChild(e)}))}update(){super.update(),this.monster!==this.battleManager.monOp&&(this.monster=this.battleManager.monOp,this.monster?(this.render(),this.changeSkills(xt.player.getSkills()||[])):(this.unrender(),this.rootElement.innerHTML=""))}}class ht extends et{constructor(t){super(t),e(this,"monster"),e(this,"hpBar"),e(this,"container"),e(this,"stamina",!1),it(this.rootElement),this.rootElement.style.fontSize="1.5vmin",this.hpBar=document.createElement("div"),this.container=document.createElement("div"),this.rootElement.appendChild(this.container),this.rootElement.appendChild(this.hpBar)}setMonster(t){t?this.render():this.unrender(),this.monster=t,this.container.style.height="50%",this.container.style.display="flex",this.container.innerHTML="",this.monster&&this.addText(`${this.monster.monsterData.class.name} ${this.monster.monsterData.race.name}`,this.container)}addText(t,e){const s=document.createElement("div");e.appendChild(s),s.textContent=t,s.style.flex="1",s.style.textAlign="center"}drawHpBar(){var t,e;this.monster&&(this.hpBar.style.textAlign="center",this.hpBar.innerHTML="",this.hpBar.textContent=`HP: ${null==(t=this.monster)?void 0:t.stats.hp} / ${10*(null==(e=this.monster)?void 0:e.monsterData.race.stats.hp)} ${this.stamina?"Sta: "+this.monster.stats.stamina:""}`)}update(){super.update(),this.drawHpBar()}}const ct={zoom:()=>{},extraZoom:()=>{},brokenHouse:()=>{},doorZoom:()=>{},blackness:()=>{},introBattle:()=>{},startGame:()=>{},becomeGoblin:()=>{},midBossApproach:()=>{xt.showBoss=!0},resumeFight:()=>{xt.battleManager.selectForBattle(xt.monsterSprites[0]),xt.storyBox.unrender()}},dt=["I'm just a little girl, helpful and kind.","Life is always fun, every day is nice.",()=>ct.zoom(),"Helping others is what I love to do.","I have a little secret. I can trade my life for another.",()=>ct.extraZoom(),"It's my dearest dream. To save a life, even if it costs my own.",()=>ct.brokenHouse(),"But then came the misfortune. Goblins attacked us.",()=>ct.doorZoom(),"I was too late. I couldn't save anyone.",()=>ct.blackness(),"A bloodied goblin rose. He wanted my life.",()=>ct.introBattle(),"Oh no. I didn't mean to. Even if you killed my parents.","I don't want you to die. I will save your life. I'll trade my own.",()=>ct.becomeGoblin(),"But why am I a goblin now.",{text:"They left me for dead.",color:"red"},"Who are you?",{text:"I am the goblin you... saved.",color:"red"},"Oh no. What should I do.",{text:"I must take revenge!",color:"red"},"No, I don't want to kill.",{text:'You just have to "save" him. Like you saved me.',color:"red"},"Yes, I must help! I must save.",{text:"The road is dangerous. There'll be many a monster in need of saving.",color:"red"},()=>ct.startGame(),{text:"My home is just over yonder. Let's pay my pal Rex a visit.",color:"red"},()=>ct.midBossApproach(),{text:"Hi old pal.",color:"red"},{text:"Who the fuck are you?",color:"green"},{text:"You left me to die but I was saved. I think you'll need saving as well.",color:"red"},{text:"Seems I'll need to shut up your mad ramblings.",color:"green"},()=>ct.resumeFight(),{text:"Im not.. dead?.",color:"green"},"I saved you! I'm from the human village.",{text:"We were forced to attack humans because our normal hunting grounds were taken over by a weird giant beast.",color:"green"},"I'll make them stop. I'll save them too!",{text:"The beast is a little ways off with dangerous monsters on the way.",color:"green"},()=>{xt.storyBox.unrender(),xt.round++,xt.monsterSprites=[]},{text:"Greetings child.",color:"white"},{text:"I can see you host a number of souls in your body.",color:"white"},{text:"I once was like you but ultimately souls prefer to hold their original shape.",color:"white"},{text:"What happened to me will happen to you, eventually.",color:"white"},{text:"I don't wish such a terrible fate for anyone.",color:"white"},{text:"I shall set your soul free.",color:"white"},()=>{ct.resumeFight(),xt.monsterSprites[0].y-=50},"You killed the monster. But what have you became.","The end.","Game by: mikkael3 and Mikko Kemppainen",()=>{xt.round=-1,xt.storyBox.unrender(),xt.unrenderUi()},""];class mt extends J{constructor(){super(...arguments),e(this,"skills",[]),e(this,"launchRestart",!0)}update(t){if(super.update(t),this.stats.hp<=0&&this.launchRestart){this.rotation+=.1,this.launchRestart=!1;const t=new et({x:0,y:0,width:1,height:1,color:"black",canvas:l()});t.rootElement.textContent="You Died. Please try again!",t.rootElement.style.fontSize="4vmin",t.rootElement.style.color="red",t.rootElement.style.display="flex",t.rootElement.style.alignItems=t.rootElement.style.justifyContent="center",xt.gameUi.battleManager.battleEnded=!0,t.render(),setTimeout((()=>{xt.restartRounds(),xt.storyBox.storyIndex=28,xt.storyBox.text=dt[28].text,xt.round=1,this.launchRestart=!0,t.unrender()}),2500)}}}class ut extends ht{constructor(t){super(t),e(this,"stats"),e(this,"round"),this.stats=new et({...t,y:.76,height:.14}),this.round=new et({...t,y:.66,height:.04}),this.stamina=!0,it(this.stats.rootElement),it(this.round.rootElement),this.stats.rootElement.style.fontSize="1.5vmin"}render(){super.render(),this.stats.render(),this.round.render()}unrender(){super.unrender(),this.stats.unrender(),this.round.unrender()}handleStats(){const t=this.monster;if(!t)return;const e=document.createElement("div");e.style.display="grid",e.style.height="100%",e.style.textAlign="center",e.style.gridTemplateColumns="1fr 1fr",["str","int","def","wp"].forEach((s=>{const i=s,n=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");a.textContent=`${T[i]}`,o.textContent=`${t.stats[i]} ${t.statStages[i]>0?"+":""}${0===t.statStages[i]?"":t.statStages[i]}`,n.appendChild(a),n.appendChild(o),e.appendChild(n),"str"===i&&(a.style.color="red"),"int"===i&&(a.style.color="blue"),"def"===i&&(a.style.color="red"),"wp"===i&&(a.style.color="blue")})),this.stats.rootElement.innerHTML="",this.stats.rootElement.appendChild(e),this.round.rootElement.innerHTML="",this.round.rootElement.style.textAlign="center",xt.round&&(this.round.rootElement.textContent="Area: "+(xt.round-1))}update(){super.update(),this.handleStats(),this.stats.update(),this.round.update()}}class pt extends et{constructor(t){super(t),e(this,"textElement"),e(this,"continueElement"),e(this,"text"),e(this,"lastBlink",performance.now()),e(this,"storyIndex",0),e(this,"dc","magenta"),e(this,"color",this.dc),this.text=dt[0];const s=this.rootElement.style;this.textElement=document.createElement("p"),this.textElement.textContent=this.text,this.rootElement.appendChild(this.textElement),this.continueElement=document.createElement("p"),this.rootElement.appendChild(this.continueElement),s.color=this.color,s.padding="1vmin",this.rootElement.onclick=()=>{const t=()=>{const e=dt[++this.storyIndex];this.color=this.dc,"string"==typeof e?this.text=e:"function"==typeof e?(e(),t()):(this.text=e.text,this.color=e.color),s.color=this.color};t()}}update(){super.update(),performance.now()-this.lastBlink>300&&(this.lastBlink=performance.now(),this.continueElement.textContent=this.continueElement.textContent?"":"Click to Continue"),this.textElement.textContent=this.text}}const yt=class{constructor(){e(this,"background"),e(this,"monsterSprites"),e(this,"player"),e(this,"playerBox"),e(this,"monsterBox"),e(this,"battleManager"),e(this,"uiElements",[]),e(this,"battleLog"),e(this,"gameUi"),e(this,"showPlayer",!1),e(this,"round"),e(this,"introEnded",!1),e(this,"storyBox"),e(this,"showBoss",!1),function(t,{contextless:e=!1}={}){if(i=document.getElementById(t)||t||document.querySelector("canvas"),e&&(i=i||new Proxy({},r)),!i)throw Error("You must provide a canvas element for the game");n=i.getContext("2d")||new Proxy({},r),n.imageSmoothingEnabled=!1,o("init")}(),O(),this.background=new tt,this.restartRounds(),this.storyBox.render()}static get instance(){return this._instance||(this._instance=new yt),this._instance}restartRounds(){var t,e,s,i;null==(t=this.battleLog)||t.unrender(),null==(e=this.monsterBox)||e.unrender(),null==(s=this.playerBox)||s.unrender(),this.uiElements.forEach((t=>t.unrender())),null==(i=this.gameUi)||i.unrender(),this.round=0;const n=l();this.monsterSprites=[],this.uiElements=[],this.battleLog=new nt({x:0,y:.499,height:.4,width:.3,canvas:n,color:"lightgray"}),this.battleLog.render(),this.player=new mt({x:240,y:n.height/1.5,monster:$}),this.playerBox=new ut({x:.79,y:.7,width:.2,height:.06,canvas:n}),this.playerBox.setMonster(this.player),this.monsterBox=new ht({x:0,y:0,width:.2,height:.06,canvas:n}),this.battleManager=new ot(this.monsterBox,n),this.gameUi=new lt({x:0,y:.9,canvas:n,height:.1,width:1,monster:this.player.monsterData,battleManager:this.battleManager}),this.gameUi.unrender(),this.storyBox=new pt({x:.6,y:0,width:.375,height:.166,color:"black",canvas:l()})}update(t){var e;if(this.background.update(t),null==(e=this.player)||e.update(t),this.monsterSprites.forEach((e=>e.update(t))),this.uiElements.forEach((t=>t.update())),this.gameUi.update(),this.monsterBox.update(),this.playerBox.update(),this.battleLog.update(),this.storyBox.update(),ft(),!this.battleManager.choosingClass&&0===this.monsterSprites.length)switch(this.round){case 1:case 2:case 3:case 5:case 6:case 7:Q(((t=1,e=3)=>{const s=t>4?U:G;return Array.from(Array(e)).map((()=>({race:Y(s[c(0,s.length-1)]),class:A(R[c(0,R.length-1)]),level:t})))})(this.round)),this.round++;break;case 4:if(this.storyBox.rendered||this.storyBox.render(),!this.showBoss)return;((t,e,s)=>{const i={race:Y(q.race),class:A(e),level:s},n=new J({x:l().width/2,y:100,dx:0,monster:i});n.handler=()=>xt.battleManager.selectForBattle(n),xt.monsterSprites.push(n)})(0,q.class,q.level),this.monsterSprites[0].clickable=!1,this.storyBox.rendered||this.storyBox.render();break;case 8:Q([W]),this.monsterSprites[0].clickable=!1,this.monsterSprites[0].y-=50,this.storyBox.rendered||this.storyBox.render(),this.round++;break;case 9:this.storyBox.rendered||this.storyBox.render()}}render(){var t;this.background.render(),this.showPlayer&&(null==(t=this.player)||t.render()),this.monsterSprites.forEach((t=>{t.render()}))}unrenderUi(){this.playerBox.unrender(),this.monsterBox.unrender(),this.uiElements.forEach((t=>t.unrender())),this.battleLog.unrender(),this.gameUi.unrender()}renderUi(){this.playerBox.render(),this.uiElements.forEach((t=>t.render())),this.battleLog.render()}};let gt=yt;e(gt,"_instance");const ft=()=>{let t=innerWidth,e=innerHeight;const s=innerHeight,i=innerWidth;1.5*s<i?(e=s,t=1.5*s):e=i/1.5,l().style.width=t+"px",l().style.height=e+"px"},xt=gt.instance;(()=>{const t=g({x:0,y:0,color:"#38205c",width:240,height:64,dx:0}),e=g({x:0,y:64,color:"darkslategrey",width:240,height:96,dx:0}),s=g({x:100,y:64,color:"#BC815F",width:40,height:96,dx:0}),i=g({x:120,y:0,color:"#FEFCD7",radius:40,dx:0,render:function(){var t,e;this.context&&this.color&&(this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(null!=(t=this.x)?t:0,null!=(e=this.y)?e:0,this.radius,0,2*Math.PI),this.context.fill())}}),n=Array.from(Array(12).keys()).map((()=>g({x:c(0,100),y:c(0,30),color:"#FEFCD7",radius:c(0,4),dx:0,render:function(){var t,e;this.context&&this.color&&(this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(null!=(t=this.x)?t:0,null!=(e=this.y)?e:0,this.radius,0,2*Math.PI),this.context.fill())},update(t){0!==this.radius&&(this.radius+=t),this.radius>3&&(this.radius=0,setTimeout((()=>{this.radius=t}),1e3))}}))),a=new tt({scaleX:2,scaleY:2});a.addChild(t),a.addChild(e),a.addChild(s),a.addChild(i),n.forEach((t=>a.addChild(t))),xt.background=a})(),xt.unrenderUi(),xt.monsterSprites=[];const wt=new class extends J{constructor(t){super(t)}update(t){super.update(8*t)}}({x:40,y:68,scaleX:.5,scaleY:.5,monster:{race:Y(X),class:{...A(F),color:"violet"},level:1}}),bt=new class extends y{constructor(t){super({...t,color:"#FEFCD7",radius:40,dx:0}),e(this,"doorColor","sienna"),e(this,"windowColor","white")}draw(){super.draw();const t=this.context;t&&this.color&&(t.fillStyle="darkred",t.beginPath(),t.lineTo(0,0),t.lineTo(0,70),t.lineTo(100,70),t.lineTo(100,0),t.closePath(),t.fill(),t.fillStyle="grey",t.beginPath(),t.lineTo(-10,0),t.lineTo(50,-50),t.lineTo(110,0),t.closePath(),t.fill(),t.fillStyle=this.doorColor,t.fillRect(60,30,25,40),t.fillStyle=this.windowColor,t.fillRect(25,30,20,20))}}({x:32,y:30,scaleX:.6,scaleY:.6});xt.background.setScale(3,3),xt.background.addChild(bt),xt.background.addChild(wt),ct.zoom=()=>{wt.y-=18,xt.background.setScale(5,5),xt.background.y-=80,xt.background.x-=80},ct.extraZoom=()=>{xt.background.setScale(16,16),xt.background.y-=600,xt.background.x-=520},ct.brokenHouse=()=>{bt.doorColor="black",bt.windowColor="black",xt.background.setScale(3,3),xt.background.y=0,xt.background.x=0,xt.background.removeChild(wt)},ct.doorZoom=()=>{xt.background.setScale(8,8),xt.background.x=-300,xt.background.y=-250};const vt=g({width:1e4,height:1e4,color:"black"});ct.blackness=()=>{xt.background.addChild(vt),xt.background.setScale(2,2)},ct.introBattle=()=>{const t={race:{...Y(z),skills:[]},class:A({color:"green",name:"Wounded",skills:[{name:"Stumble",value:-1,type:"boost",effect:"hp",flavor:"Goblin fell on top of you and skewered himself on the knife.",cost:0}]}),level:1};Q([t]),xt.monsterSprites[0].stats.hp=1,xt.player.monsterData=wt.monsterData,xt.player.monsterData.class.name="Little",xt.battleManager.setPlayerSkills([]),xt.storyBox.unrender(),xt.renderUi(),xt.battleManager.selectForBattle(xt.monsterSprites[0]),xt.background.setScale(2,2),xt.background.x=0,xt.background.y=0,wt.setScale(.25,.25),wt.x=115,wt.y=110,xt.background.addChild(wt);const e=xt.battleManager.battleEndCb;xt.battleManager.battleEndCb=()=>{xt.storyBox.render(),xt.battleManager.monOp&&(xt.battleManager.battleEnded=!0,xt.battleManager.monOp.rotation=Math.PI/2,xt.battleManager.monOp.color="red",xt.battleManager.monOp.stopped=!0,xt.battleManager.battleEndCb=e)}},ct.becomeGoblin=()=>{xt.battleManager.monOp&&(xt.player.skills=$.class.skills,xt.battleManager.monOp.monsterData=$,xt.battleManager.killMonster(),xt.battleManager.skillsChosenCb(),xt.showPlayer=!0,xt.background.removeChild(wt))},ct.startGame=()=>{xt.background.removeChild(vt),xt.renderUi(),xt.introEnded=!0,xt.background.removeChild(bt),xt.background.removeChild(wt),xt.background.setScale(2,2),xt.showPlayer=!0,xt.storyBox.unrender(),xt.round=1},function({fps:t=60,clearCanvas:e=!0,update:i=s,render:n,context:a=h(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let l,c,d,m,u,p=0,y=1e3/t,x=1/t,g=e?I:s,f=!0;function w(){if(c=requestAnimationFrame(w),f&&(d=performance.now(),m=d-l,l=d,!(m>1e3))){for(o("tick"),p+=m;p>=y;)u.update(x),p-=y;g(a),u.render()}}return r||(window.addEventListener("focus",(()=>{f=!0})),window.addEventListener("blur",(()=>{f=!1}))),u={update:i,render:n,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(w)},stop(){this.isStopped=!0,cancelAnimationFrame(c)},_frame:w,set _last(t){l=t}},u}({blur:!0,update:t=>{xt.update(t)},render:()=>{xt.render()}}).start()</script><body style=width:100%;height:100%;min-width:100vw;min-height:100vh;display:flex;margin:0;background-color:#000;justify-content:center><canvas height=320 id=kontra width=480></canvas>