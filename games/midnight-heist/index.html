<!doctype html><meta name=viewport content="width=device-width,user-scalable=no"><title>Midnight Heist - js13kGames 2025</title><script src=/2025/webxr/babylon.js></script><style>*{margin:0;padding:0;box-sizing:border-box}body,html{overflow:hidden;width:100%;height:100%;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#0a0a1a;color:#fff}#renderCanvas{width:100%;height:100%;touch-action:none}#ui{position:absolute;top:20px;left:0;width:100%;text-align:center;z-index:10;pointer-events:none}.stat-container{display:inline-flex;background:rgba(10,10,26,.85);border-radius:20px;padding:12px 25px;box-shadow:0 5px 15px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(5px)}.stat{display:flex;align-items:center;margin:0 15px;font-size:18px}.stat i{margin-right:8px;color:#f8c301}#lives{color:#ff5a5a}#lives i{color:#ff5a5a}#level{color:#6a38b3}#level i{color:#6a38b3}#startScreen{position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,#1a1a3a 0,#0a0a1a 100%);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:20;color:#fff;transition:opacity .8s ease}.title-container{text-align:center;margin-bottom:40px;position:relative}h1{font-size:3.5rem;margin-bottom:15px;color:#f8c301;text-shadow:0 0 15px rgba(248,195,1,.7);letter-spacing:2px;position:relative;animation:glow 2s infinite alternate}.subtitle{font-size:1.5rem;color:#a594f9;margin-bottom:30px}.game-info{background:rgba(20,20,40,.7);border-radius:15px;padding:25px;max-width:600px;margin-bottom:30px;border:1px solid rgba(165,148,249,.3)}.info-text{font-size:1.1rem;margin-bottom:12px;display:flex;align-items:center;justify-content:center}.info-text i{margin-right:10px;color:#6a38b3;width:25px}.controls-container{display:flex;justify-content:center;gap:30px;margin:20px 0}.control-item{background:rgba(106,56,179,.2);padding:15px;border-radius:10px;width:140px;border:1px solid rgba(165,148,249,.2)}.control-item i{font-size:2rem;margin-bottom:8px;color:#a594f9}#startButton{background:linear-gradient(135deg,#6a38b3 0,#8a5cd9 100%);color:#fff;border:none;padding:18px 45px;font-size:1.3rem;border-radius:50px;cursor:pointer;margin-top:20px;transition:all .3s;box-shadow:0 5px 15px rgba(106,56,179,.4);letter-spacing:1px;font-weight:700}#startButton:hover{transform:scale(1.05);box-shadow:0 7px 20px rgba(106,56,179,.6)}#gameOver{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(10,10,26,.95);flex-direction:column;justify-content:center;align-items:center;z-index:30;color:#fff;opacity:0;transition:opacity .8s ease}#gameOver h2{font-size:3rem;color:#ff5a5a;margin-bottom:20px;text-shadow:0 0 10px rgba(255,90,90,.5)}#finalScore{font-size:1.5rem;margin-bottom:30px}#restartButton{background:linear-gradient(135deg,#6a38b3 0,#8a5cd9 100%);color:#fff;border:none;padding:15px 40px;font-size:1.2rem;border-radius:50px;cursor:pointer;margin-top:20px;transition:all .3s;box-shadow:0 5px 15px rgba(106,56,179,.4)}#restartButton:hover{transform:scale(1.05);box-shadow:0 7px 20px rgba(106,56,179,.6)}#xrButton{position:absolute;bottom:20px;right:20px;background:rgba(106,56,179,.5);color:#fff;border:none;padding:12px 20px;border-radius:50px;cursor:pointer;z-index:40;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.1)}@keyframes glow{from{text-shadow:0 0 10px rgba(248,195,1,.7)}to{text-shadow:0 0 20px rgba(248,195,1,.9),0 0 30px rgba(248,195,1,.6)}}@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}.notification{position:absolute;top:100px;left:50%;transform:translateX(-50%);background:rgba(20,20,40,.9);color:#fff;padding:12px 25px;border-radius:30px;opacity:0;transition:opacity .5s ease;pointer-events:none;z-index:15;box-shadow:0 5px 15px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1)}#touchControls{position:absolute;bottom:80px;width:100%;display:none;justify-content:center;gap:20px}.touch-btn{width:70px;height:70px;background:rgba(106,56,179,.3);border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:28px;color:#fff;user-select:none;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.1);box-shadow:0 5px 15px rgba(0,0,0,.2)}#touchUpDown{display:flex;flex-direction:column;gap:15px}@media (max-width:768px){h1{font-size:2.5rem}.subtitle{font-size:1.2rem}.game-info{padding:15px;max-width:90%}.info-text{font-size:1rem}.controls-container{flex-direction:column;gap:15px}.stat{font-size:16px;margin:0 10px}#touchControls{display:flex}}</style><canvas id=renderCanvas></canvas><div id=ui><div class=stat-container><div class=stat id=score><i class="fas fa-fish"></i><span>0</span></div><div class=stat id=lives><i class="fas fa-heart"></i><span>9</span></div><div class=stat id=level><i class="fas fa-level-up-alt"></i><span>1</span></div></div><div id=notification class=notification></div></div><div id=startScreen><div class=title-container><h1>Black Cat's Midnight Heist</h1><div class=subtitle>Steal the fish without getting caught!</div></div><div class=game-info><div class=info-text><i class="fas fa-info-circle"></i> You're a black cat on a mission to collect fish while avoiding obstacles!</div><div class=info-text><i class="fas fa-exclamation-triangle"></i> Watch out for the dog and falling obstacles!</div><div class=info-text><i class="fas fa-trophy"></i> Collect 5 fish to advance to the next level.</div><div class=info-text><i class="fas fa-vr-cardboard"></i> Now with WebXR support! Use VR/AR headsets for immersive gameplay.</div></div><div class=controls-container><div class=control-item><i class="fas fa-vr-cardboard"></i><div>VR/AR Controls</div></div><div class=control-item><i class="fas fa-mobile-alt"></i><div>Device Motion</div></div><div class=control-item><i class="fas fa-gamepad"></i><div>XR Controllers</div></div></div><button id=startButton>START GAME</button></div><div id=gameOver><h2>Game Over</h2><p id=finalScore>You collected 0 fish</p><button id=restartButton>PLAY AGAIN</button></div><button id=xrButton>ENTER XR</button><script>let cat,ground,dog,engine,scene,xrHelper,audioContext,score=0,lives=9,level=1,gameActive=!1,isInXR=!1,obstacles=[],fishes=[],moveLeft=!1,moveRight=!1,moveUp=!1,moveDown=!1;function initGame(){const e=document.getElementById("renderCanvas");engine=new BABYLON.Engine(e,!0),scene=new BABYLON.Scene(engine),scene.clearColor=new BABYLON.Color3(.05,.05,.1),new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),scene).intensity=.7,new BABYLON.DirectionalLight("dirLight",new BABYLON.Vector3(0,-1,1),scene).intensity=.5;const t=new BABYLON.UniversalCamera("camera",new BABYLON.Vector3(0,5,-10),scene);t.setTarget(BABYLON.Vector3.Zero()),t.attachControl(e,!0),initWebXR(),createGround(),createCat(),createFishes(5),createDog(),createStars(),setupDeviceOrientation(),scene.onBeforeRenderObservable.add(gameLoop),window.addEventListener("resize",()=>{engine.resize()}),engine.runRenderLoop(()=>{scene.render()})}function createGround(){ground=BABYLON.MeshBuilder.CreateGround("ground",{width:20,height:20},scene);const e=new BABYLON.StandardMaterial("groundMat",scene);e.diffuseColor=new BABYLON.Color3(.1,.3,.1),ground.material=e,ground.position.y=-.5,ground.checkCollisions=!0}function initWebXR(){scene.createDefaultXRExperienceAsync({floorMeshes:[ground]}).then(e=>{xrHelper=e,document.getElementById("xrButton").onclick=()=>{e.baseExperience.enterXRAsync("immersive-vr","local-floor")},e.baseExperience.onStateChangedObservable.add(t=>{isInXR=t===BABYLON.WebXRState.IN_XR,isInXR&&(e.baseExperience.camera.position=new BABYLON.Vector3(0,5,-10),e.baseExperience.camera.setTarget(BABYLON.Vector3.Zero()))}),setupXRControls(e)}).catch(e=>{console.error("Error creating XR experience:",e),document.getElementById("xrButton").style.display="none"})}function setupXRControls(e){e.input.onControllerAddedObservable.add(e=>{e.onMotionControllerInitObservable.add(e=>{if("left"===e.handness){const t=e.getComponent("xr-standard-thumbstick");t&&t.onAxisValueChangedObservable.add(e=>{gameActive&&isInXR&&handleXRMovement(e)})}})})}function handleXRMovement(e){const t=.1+.02*level;cat.position.x+=e.x*t,cat.position.z-=e.y*t,cat.position.x=Math.min(9,Math.max(-9,cat.position.x)),cat.position.z=Math.min(9,Math.max(-9,cat.position.z)),e.x<-.1?cat.rotation.z=Math.PI/12:e.x>.1?cat.rotation.z=-Math.PI/12:cat.rotation.z=0}function createCat(){cat=BABYLON.MeshBuilder.CreateSphere("catBody",{diameter:.8,segments:16},scene),cat.position.y=.5;const e=new BABYLON.StandardMaterial("catMat",scene);e.diffuseColor=new BABYLON.Color3(.05,.05,.05),e.specularColor=new BABYLON.Color3(.1,.1,.1);const t=new BABYLON.NoiseProceduralTexture("furTexture",256,scene);t.animationSpeedFactor=0,t.persistence=.5,t.brightness=.5,t.octaves=4,e.diffuseTexture=t,e.diffuseTexture.level=.5,cat.material=e,createCatDetails(cat,e),scene.collisionsEnabled=!0,cat.checkCollisions=!0,cat.ellipsoid=new BABYLON.Vector3(.5,.5,.5)}function createCatDetails(e,t){const o=BABYLON.MeshBuilder.CreateSphere("catHead",{diameter:.5,segments:16},scene);o.position.y=.9,o.position.z=.4,o.parent=e,o.material=t,createCatEars(e,t);const n=BABYLON.MeshBuilder.CreateCylinder("tail",{diameter:.08,height:1},scene);n.position.y=.3,n.position.z=-.5,n.rotation.x=Math.PI/3,n.parent=e,n.material=t,createCatEyes(e)}function createCatEars(e,t){const o=BABYLON.MeshBuilder.CreateCylinder("ear1",{diameterTop:0,diameterBottom:.2,height:.3,tessellation:3},scene);o.position.y=1.1,o.position.x=-.15,o.position.z=.4,o.rotation.x=Math.PI/4,o.parent=e,o.material=t;const n=BABYLON.MeshBuilder.CreateCylinder("ear2",{diameterTop:0,diameterBottom:.2,height:.3,tessellation:3},scene);n.position.y=1.1,n.position.x=.15,n.position.z=.4,n.rotation.x=Math.PI/4,n.parent=e,n.material=t}function createCatEyes(e){const t=new BABYLON.StandardMaterial("eyeMat",scene);t.emissiveColor=new BABYLON.Color3(.2,.2,.8);const o=BABYLON.MeshBuilder.CreateSphere("eye1",{diameter:.1},scene);o.position.y=.95,o.position.x=-.12,o.position.z=.6,o.parent=e,o.material=t;const n=BABYLON.MeshBuilder.CreateSphere("eye2",{diameter:.1},scene);n.position.y=.95,n.position.x=.12,n.position.z=.6,n.parent=e,n.material=t}function createStars(){for(let e=0;e<100;e++){const e=BABYLON.MeshBuilder.CreateSphere("star",{diameter:.1},scene);e.position.x=40*Math.random()-20,e.position.y=20*Math.random(),e.position.z=40*Math.random()-20;const t=new BABYLON.StandardMaterial("starMat",scene);t.emissiveColor=new BABYLON.Color3(1,1,1),e.material=t,e.isVisible=!1;const o=new BABYLON.PointLight("starLight",e.position,scene);o.intensity=.1,o.diffuse=new BABYLON.Color3(1,1,1)}}function setupDeviceOrientation(){window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",handleDeviceOrientation)}function handleDeviceOrientation(e){if(!gameActive||isInXR)return;const t=e.gamma?Math.min(1,Math.max(-1,e.gamma/45)):0,o=e.beta?Math.min(1,Math.max(-1,(e.beta-90)/45)):0,n=.1+.02*level;cat.position.x+=t*n,cat.position.z+=o*n,cat.rotation.z=t<-.1?Math.PI/12:t>.1?-Math.PI/12:0,cat.position.x=Math.min(9,Math.max(-9,cat.position.x)),cat.position.z=Math.min(9,Math.max(-9,cat.position.z))}function createFishes(e){for(let t=0;t<e;t++){const e=BABYLON.MeshBuilder.CreateCylinder("fish",{diameter:.3,height:.8,tessellation:6},scene);e.position.x=18*Math.random()-9,e.position.z=18*Math.random()-9,e.position.y=.2,e.rotation.x=Math.PI/2;const t=new BABYLON.StandardMaterial("fishMat",scene);t.diffuseColor=new BABYLON.Color3(1,.7,.2),t.specularColor=new BABYLON.Color3(.5,.5,.5),e.material=t,createFishDetails(e,t),e.checkCollisions=!0,e.ellipsoid=new BABYLON.Vector3(.2,.2,.2),animateFish(e),fishes.push(e)}}function createFishDetails(e,t){const o=BABYLON.MeshBuilder.CreateBox("tail",{width:.2,height:.4,depth:.1},scene);o.position.z=-.4,o.parent=e,o.material=t;const n=BABYLON.MeshBuilder.CreateBox("fin",{width:.1,height:.3,depth:.1},scene);n.position.y=.2,n.parent=e,n.material=t}function animateFish(e){const t=new BABYLON.Animation("fishAnim","position.y",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT),o=[];o.push({frame:0,value:.2}),o.push({frame:30,value:.4}),o.push({frame:60,value:.2}),t.setKeys(o),e.animations=[t],scene.beginAnimation(e,0,60,!0)}function createDog(){dog=BABYLON.MeshBuilder.CreateCylinder("dog",{diameter:1,height:1},scene),dog.position.x=0,dog.position.z=10,dog.position.y=.5;const e=new BABYLON.StandardMaterial("dogMat",scene);e.diffuseColor=new BABYLON.Color3(.6,.4,.2),dog.material=e,dog.checkCollisions=!0,dog.ellipsoid=new BABYLON.Vector3(.5,.5,.5),createDogDetails(dog)}function createDogDetails(e){const t=BABYLON.MeshBuilder.CreateSphere("dogHead",{diameter:.7},scene);t.position.y=.8,t.position.z=.3,t.parent=e,createDogEyes(t)}function createDogEyes(e){const t=BABYLON.MeshBuilder.CreateSphere("eye1",{diameter:.1},scene);t.position.y=.85,t.position.x=-.2,t.position.z=.6;const o=new BABYLON.StandardMaterial("eyeMat1",scene);o.diffuseColor=new BABYLON.Color3(1,0,0),o.emissiveColor=new BABYLON.Color3(.5,0,0),t.material=o,t.parent=e;const n=BABYLON.MeshBuilder.CreateSphere("eye2",{diameter:.1},scene);n.position.y=.85,n.position.x=.2,n.position.z=.6;const i=new BABYLON.StandardMaterial("eyeMat2",scene);i.diffuseColor=new BABYLON.Color3(1,0,0),i.emissiveColor=new BABYLON.Color3(.5,0,0),n.material=i,n.parent=e}function gameLoop(){gameActive&&(handlePlayerMovement(),updateObstacles(),updateDog(),checkCollisions())}function handlePlayerMovement(){const e=.1+.02*level;moveLeft&&(cat.position.x-=e),moveRight&&(cat.position.x+=e),moveUp&&(cat.position.z-=e),moveDown&&(cat.position.z+=e),cat.rotation.z=moveLeft?Math.PI/12:moveRight?-Math.PI/12:0,cat.position.x=Math.min(9,Math.max(-9,cat.position.x)),cat.position.z=Math.min(9,Math.max(-9,cat.position.z))}function updateObstacles(){Math.random()<.01+.005*level&&createObstacle();for(let e=obstacles.length-1;e>=0;e--){const t=obstacles[e];t.position.y-=.1+.02*level,t.rotation.x+=.05,t.rotation.z+=.05,t.position.y<-5&&(t.dispose(),obstacles.splice(e,1))}}function createObstacle(){const e=["sphere","box","cylinder"],t=e[Math.floor(Math.random()*e.length)];let o;o="sphere"===t?BABYLON.MeshBuilder.CreateSphere("obstacle",{diameter:.6},scene):"box"===t?BABYLON.MeshBuilder.CreateBox("obstacle",{size:.6},scene):BABYLON.MeshBuilder.CreateCylinder("obstacle",{diameter:.5,height:.6},scene),o.position.x=18*Math.random()-9,o.position.z=18*Math.random()-9,o.position.y=10;const n=new BABYLON.StandardMaterial("obstacleMat",scene);n.diffuseColor=new BABYLON.Color3(.8,.1,.1),o.material=n,o.checkCollisions=!0,o.ellipsoid=new BABYLON.Vector3(.3,.3,.3),obstacles.push(o)}function updateDog(){const e=.05+.01*level;dog.position.z-=e,dog.position.z<-10&&(dog.position.z=10,dog.position.x=18*Math.random()-9),dog.lookAt(cat.position)}function checkCollisions(){checkFishCollisions(),checkObstacleCollisions(),checkDogCollision()}function checkFishCollisions(){for(let e=fishes.length-1;e>=0;e--){const t=fishes[e];if(cat.intersectsMesh(t,!1)){t.dispose(),fishes.splice(e,1),score++,updateUI();const o=document.querySelector("#score span");o.style.transform="scale(1.5)",setTimeout(()=>{o.style.transform="scale(1)"},300),playSound(500,.2,"sine"),showNotification("+1 Fish!","#f8c301"),0===fishes.length&&levelUp()}}}function levelUp(){level++,createFishes(5+level),updateUI(),showNotification("Level Up!","#6a38b3"),playSound(800,.5,"sine")}function checkObstacleCollisions(){for(let e=obstacles.length-1;e>=0;e--){const t=obstacles[e];if(cat.intersectsMesh(t,!1)){t.dispose(),obstacles.splice(e,1),lives--,updateUI();const o=document.querySelector("#lives span");o.style.transform="scale(1.5)",setTimeout(()=>{o.style.transform="scale(1)"},300),playSound(200,.3,"square"),showNotification("Ouch! -1 Life","#ff5a5a");const n=cat.material.emissiveColor;cat.material.emissiveColor=new BABYLON.Color3(1,0,0),setTimeout(()=>{cat.material.emissiveColor=n},300),lives<=0&&endGame()}}}function checkDogCollision(){cat.intersectsMesh(dog,!1)&&(lives=0,updateUI(),playSound(150,.5,"sawtooth"),showNotification("Caught by the dog!","#ff5a5a"),endGame())}function showNotification(e,t){const o=document.getElementById("notification");o.textContent=e,o.style.color=t,o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},2e3)}function playSound(e,t,o){try{audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext));const n=audioContext.createOscillator(),i=audioContext.createGain();n.connect(i),i.connect(audioContext.destination),n.type=o||"sine",n.frequency.value=e,i.gain.value=.1,n.start(),i.gain.exponentialRampToValueAtTime(1e-5,audioContext.currentTime+t),setTimeout(()=>{n.stop()},1e3*t)}catch(e){console.log("Web Audio API not supported")}}function updateUI(){document.querySelector("#score span").textContent=score,document.querySelector("#lives span").textContent=lives,document.querySelector("#level span").textContent=level}function startGame(){document.getElementById("startScreen").style.opacity="0",setTimeout(()=>{document.getElementById("startScreen").style.display="none"},800),gameActive=!0,audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext))}function endGame(){gameActive=!1,document.getElementById("finalScore").textContent=`You collected ${score} fish`,document.getElementById("gameOver").style.display="flex",setTimeout(()=>{document.getElementById("gameOver").style.opacity="1"},10)}function restartGame(){fishes.forEach(e=>e.dispose()),fishes=[],obstacles.forEach(e=>e.dispose()),obstacles=[],dog&&dog.dispose(),score=0,lives=9,level=1,updateUI(),cat.position.x=0,cat.position.z=0,cat.rotation.z=0,createFishes(5),createDog(),document.getElementById("gameOver").style.opacity="0",setTimeout(()=>{document.getElementById("gameOver").style.display="none"},800),gameActive=!0}function setupKeyboardControls(){window.addEventListener("keydown",e=>{if(gameActive&&!isInXR)switch(e.key){case"ArrowLeft":moveLeft=!0;break;case"ArrowRight":moveRight=!0;break;case"ArrowUp":moveUp=!0;break;case"ArrowDown":moveDown=!0}}),window.addEventListener("keyup",e=>{switch(e.key){case"ArrowLeft":moveLeft=!1;break;case"ArrowRight":moveRight=!1;break;case"ArrowUp":moveUp=!1;break;case"ArrowDown":moveDown=!1}})}window.addEventListener("load",()=>{initGame(),document.getElementById("startButton").addEventListener("click",startGame),document.getElementById("restartButton").addEventListener("click",restartGame),setupKeyboardControls()})</script>