<!doctype html><title>Sand Adder - js13kGames 2019</title><meta content="width=device-width,user-scalable=no" name=viewport><body style=margin:0;overflow:hidden><script type=module>var s,c,h,b,l,w,x,j,z=.1,O=.005,p=0,y=[],u=0,m=0;import*as g from"/2019/webxr/three.js";import{BufferGeometry as f,Float32BufferAttribute as M}from"/2019/webxr/three.js";function t(t,e,i,o,n,a){f.call(this);for(var d=(t=t||1)/2,r=(e=e||1)/2,s=(i=i||1)/2,c=t/(o=Math.floor(o)||1),h=e/(n=Math.floor(n)||1),b=i/(a=Math.floor(a)||1),l=[],w=-d,x=-r,j=-s,z=0;z<=o;z++)l.push(w,-r,-s,w,r,-s),l.push(w,r,-s,w,r,s),l.push(w,r,s,w,-r,s),l.push(w,-r,s,w,-r,-s),w+=c;for(z=0;z<=n;z++)l.push(-d,x,-s,d,x,-s),l.push(d,x,-s,d,x,s),l.push(d,x,s,-d,x,s),l.push(-d,x,s,-d,x,-s),x+=h;for(z=0;z<=a;z++)l.push(-d,-r,j,-d,r,j),l.push(-d,r,j,d,r,j),l.push(d,r,j,d,-r,j),l.push(d,-r,j,-d,-r,j),j+=b;this.addAttribute("position",new M(l,3))}(t.prototype=Object.create(f.prototype)).constructor=t,new g.Vector3,new g.Vector3,new g.Clock;var e,i,v=new g.BoxGeometry(1,1,1);function H(){for(s=0,(c=new Object).x=0,c.y=1,c.z=-1,c.meat=.4;c.direction=D(2,8),3==c.direction;);c.next=null,y=[],u=p=c.growth=0,c.tdHeadObject=new g.Mesh(v,new g.MeshLambertMaterial({color:65280})),c.tdHeadObject.position.x=c.x,c.tdHeadObject.position.y=c.y,c.tdHeadObject.position.z=c.z,c.tdHeadObject.scale.x=.11,c.tdHeadObject.scale.y=.11,c.tdHeadObject.scale.z=.11,j.add(c.tdHeadObject),c.tdObject=new g.Mesh(v,new g.MeshLambertMaterial({color:43520})),c.tdObject.position.x=c.x,c.tdObject.position.y=c.y,c.tdObject.position.z=c.z,c.tdObject.scale.x=z,c.tdObject.scale.y=z,c.tdObject.scale.z=z,j.add(c.tdObject)}function L(t){8==t.direction?(t.tdObject.scale.y=z+t.meat,t.tdObject.position.y=t.y-t.meat/2):2==t.direction?(t.tdObject.scale.y=z+t.meat,t.tdObject.position.y=t.y+t.meat/2):4==t.direction?(t.tdObject.scale.x=z+t.meat,t.tdObject.position.x=t.x+t.meat/2):6==t.direction?(t.tdObject.scale.x=z+t.meat,t.tdObject.position.x=t.x-t.meat/2):5==t.direction?(t.tdObject.scale.z=z+t.meat,t.tdObject.position.z=t.z-t.meat/2):7==t.direction&&(t.tdObject.scale.z=z+t.meat,t.tdObject.position.z=t.z+t.meat/2)}function D(t,e){return e<t?D(e,t):(e+=1,Math.floor(Math.random()*(e-t)+t))}function o(){this.userData.isSelecting=!0,this.userData.startPx=this.position.x,this.userData.startPy=this.position.y,this.userData.startPz=this.position.z}function n(){var t,e,i,o;this.userData.isSelecting=!1,this.userData.endPx=this.position.x,this.userData.endPy=this.position.y,this.userData.endPz=this.position.z,t=this.userData.startPx-this.userData.endPx,e=this.userData.startPy-this.userData.endPy,i=this.userData.startPz-this.userData.endPz,o=7,Math.abs(t)>Math.abs(e)&&Math.abs(t)>Math.abs(i)?o=0<t?4:6:Math.abs(e)>Math.abs(t)&&Math.abs(e)>Math.abs(i)?o=0<e?2:8:Math.abs(i)>Math.abs(t)&&Math.abs(i)>Math.abs(e)&&(o=0<i?7:5),t=o,c.meat<z&&(t=-1),-1!=(t=2==c.direction&&8==t||8==c.direction&&2==t||4==c.direction&&6==t||6==c.direction&&4==t||5==c.direction&&7==t||7==c.direction&&5==t?-1:t)&&c.direction!=t&&(e=c,(c=new Object).x=e.x,c.y=e.y,c.z=e.z,c.tdObject=new g.Mesh(v,new g.MeshLambertMaterial({color:43520})),c.tdObject.position.x=c.x,c.tdObject.position.y=c.y,c.tdObject.position.z=c.z,c.tdObject.scale.x=z,c.tdObject.scale.y=z,c.tdObject.scale.z=z,setTimeout(function(){j.add(c.tdObject)},5),c.direction=t,c.meat=0,c.growth=1,c.next=e,c.tdHeadObject=e.tdHeadObject)}(b=new g.Scene).background=new g.Color(1052688),h=new g.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,10),(j=new g.LineSegments(new t(4,4,4,10,10,10),new g.LineBasicMaterial({color:11595952}))).geometry.translate(0,2,0),b.add(j),(e=new g.HemisphereLight(16777215,4473924)).position.set(1,1,1),b.add(e),(l=new g.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),l.vr.enabled=!0,document.body.appendChild(l.domElement),document.body.appendChild(g.WEBVR.createButton(l)),(w=l.vr.getController(0)).addEventListener("selectstart",o),w.addEventListener("selectend",n),b.add(w),(x=l.vr.getController(1)).addEventListener("selectstart",o),x.addEventListener("selectend",n),b.add(x),(e=new g.BufferGeometry).addAttribute("position",new g.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.addAttribute("color",new g.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),i=new g.LineBasicMaterial({vertexColors:!0,blending:g.AdditiveBlending}),w.add(new g.Line(e,i)),x.add(new g.Line(e,i)),window.addEventListener("resize",function(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight)},!1),H(),l.setAnimationLoop(function(){if(w.userData.isSelecting&&x.userData.isSelecting?s=1:2!=s&&(s=0),0==s){var t=c;for(8==t.direction?(t.y+=O,t.tdObject.position.y=t.y,t.tdHeadObject.position.y=t.y):2==t.direction?(t.y-=O,t.tdObject.position.y=t.y,t.tdHeadObject.position.y=t.y):4==t.direction?(t.x-=O,t.tdObject.position.x=t.x,t.tdHeadObject.position.x=t.x):6==t.direction?(t.x+=O,t.tdObject.position.x=t.x,t.tdHeadObject.position.x=t.x):5==t.direction?(t.z+=O,t.tdObject.position.z=t.z,t.tdHeadObject.position.z=t.z):7==t.direction&&(t.z-=O,t.tdObject.position.z=t.z,t.tdHeadObject.position.z=t.z),t.meat+=O,L(t);null!=t.next;)t.next.meat<=O?(j.remove(t.next.tdObject),t.next=null):t=t.next;O<p?p-=O:t.meat-=O,p<0&&(t.meat+=p,p=0),t!=c&&L(t);for(var e=0;e<y.length;e++)d=c,r=y[e],Math.sqrt((d.x-r.x)*(d.x-r.x)+(d.y-r.y)*(d.y-r.y)+(d.z-r.z)*(d.z-r.z))<.05+y[e].size/2?(p=y[e].nutriment,j.remove(y[e].tdObject),y.splice(e,1),--e):y[e].growth<=1&&(y[e].growth+=.01,y[e].tdObject.scale.x=y[e].size*y[e].growth,y[e].tdObject.scale.y=y[e].size*y[e].growth,y[e].tdObject.scale.z=y[e].size*y[e].growth);if(u--<0&&((a=new Object).nutriment=.01*D(20,100),a.size=.001*D(500,1050)*z,a.color=11141120,a.growth=0,a.x=9e-4*D(-2e3,2e3),a.y=9e-4*D(200,4e3),a.z=9e-4*D(-2e3,2e3),a.tdObject=new g.Mesh(v,new g.MeshLambertMaterial({color:a.color})),a.tdObject.position.x=a.x,a.tdObject.position.y=a.y,a.tdObject.position.z=a.z,a.tdObject.scale.x=a.size*a.growth,a.tdObject.scale.y=a.size*a.growth,a.tdObject.scale.z=a.size*a.growth,j.add(a.tdObject),y.push(a),u=D(200,900)+10*y.length),function(){var t=c,e=!1;(t.x-.05<-2||2<t.x+.05||4<t.y+.05||t.y-.05<0||2<t.z+.05||t.z-.05<-2)&&(e=!0);for(var i,o,n=t.next;null!=n;)o=n,i=void 0,i=new Object,8==o.direction?(i.x=o.x-.05,i.y=o.y-o.meat-.1,i.z=o.z-.05,i.width=.1,i.height=o.meat,i.depth=.1):2==o.direction?(i.x=o.x-.05,i.y=o.y,i.z=o.z-.05,i.width=.1,i.height=o.meat,i.depth=.1):4==o.direction?(i.x=o.x,i.y=o.y-.05,i.z=o.z-.05,i.width=o.meat,i.height=.1,i.depth=.1):6==o.direction?(i.x=o.x-o.meat-.1,i.y=o.y-.05,i.z=o.z-.05,i.width=o.meat,i.height=.1,i.depth=.1):5==o.direction?(i.x=o.x-.05,i.y=o.y-.05,i.z=o.z-o.meat-.1,i.width=.1,i.height=.1,i.depth=o.meat):7==o.direction&&(i.x=o.x-.05,i.y=o.y-.05,i.z=o.z,i.width=.1,i.height=.1,i.depth=o.meat),o=i,t.x>o.x&&t.x<o.x+o.width&&t.y>o.y&&t.y<o.y+o.height&&t.z>o.z&&t.z<o.z+o.depth&&(e=!0),n=n.next;return e}()){s=2;for(var i=0;i<y.length;i++)y[i].growth=2;for(var o=c;null!=o;)o.growth=2,o=o.next;m=300,j.remove(c.tdHeadObject)}}else if(2==s){for(e=0;e<y.length;e++)0<y[e].growth?(y[e].growth-=.1,y[e].tdObject.scale.x=y[e].size*y[e].growth,y[e].tdObject.scale.y=y[e].size*y[e].growth,y[e].tdObject.scale.z=y[e].size*y[e].growth):j.remove(y[e].tdObject);for(var n=c;null!=n;)0<n.growth?(n.growth-=.1,n.tdObject.scale.x=z*n.growth,n.tdObject.scale.y=z*n.growth,n.tdObject.scale.z=z*n.growth):j.remove(n.tdObject),n=n.next;m--<0&&H()}var a,d,r;l.render(b,h)})</script>