<!doctype html><title>Sand Adder</title><meta name=viewport content="width=device-width,user-scalable=no"><body><script type=module>var level,snakeHead,camera,scene,renderer,controller1,controller2,room,snakeSize=.1,snakeSpeed=.005,snakeColor=65280,tailColor=43520,snakeGrowing=0,foods=[],newFoodCooldown=0,gameOverCoooldown=0;import*as THREE from"/2019/webxr/three.module.js";import{BoxLineGeometry}from"./BoxLineGeometry.js";var count=0,normal=new THREE.Vector3,relativeVelocity=new THREE.Vector3,clock=new THREE.Clock,geometry=new THREE.BoxGeometry(1,1,1);function generateLevel(){level=0,(snakeHead=new Object).x=0,snakeHead.y=1,snakeHead.z=-1,snakeHead.meat=.4;do{snakeHead.direction=rand(2,8)}while(3==snakeHead.direction);snakeHead.next=null,snakeHead.growth=0,snakeGrowing=0,foods=[],newFoodCooldown=0,snakeHead.tdHeadObject=new THREE.Mesh(geometry,new THREE.MeshLambertMaterial({color:snakeColor})),snakeHead.tdHeadObject.position.x=snakeHead.x,snakeHead.tdHeadObject.position.y=snakeHead.y,snakeHead.tdHeadObject.position.z=snakeHead.z,snakeHead.tdHeadObject.scale.x=snakeSize+.01,snakeHead.tdHeadObject.scale.y=snakeSize+.01,snakeHead.tdHeadObject.scale.z=snakeSize+.01,room.add(snakeHead.tdHeadObject),snakeHead.tdObject=new THREE.Mesh(geometry,new THREE.MeshLambertMaterial({color:tailColor})),snakeHead.tdObject.position.x=snakeHead.x,snakeHead.tdObject.position.y=snakeHead.y,snakeHead.tdObject.position.z=snakeHead.z,snakeHead.tdObject.scale.x=snakeSize,snakeHead.tdObject.scale.y=snakeSize,snakeHead.tdObject.scale.z=snakeSize,room.add(snakeHead.tdObject)}function generateApple(){var e=new Object;e.nutriment=.01*rand(20,100),e.size=.001*rand(500,1050)*snakeSize,e.color=11141120,e.growth=0,e.x=9e-4*rand(-2e3,2e3),e.y=9e-4*rand(200,4e3),e.z=9e-4*rand(-2e3,2e3),e.tdObject=new THREE.Mesh(geometry,new THREE.MeshLambertMaterial({color:e.color})),e.tdObject.position.x=e.x,e.tdObject.position.y=e.y,e.tdObject.position.z=e.z,e.tdObject.scale.x=e.size*e.growth,e.tdObject.scale.y=e.size*e.growth,e.tdObject.scale.z=e.size*e.growth,room.add(e.tdObject),foods.push(e)}function gameOver(){level=2;for(var e=0;e<foods.length;e++)foods[e].growth=2;for(var t=snakeHead;null!=t;)t.growth=2,t=t.next;gameOverCoooldown=300,room.remove(snakeHead.tdHeadObject)}function moveSnake(){var e=snakeHead;for(8==e.direction?(e.y+=snakeSpeed,e.tdObject.position.y=e.y,e.tdHeadObject.position.y=e.y):2==e.direction?(e.y-=snakeSpeed,e.tdObject.position.y=e.y,e.tdHeadObject.position.y=e.y):4==e.direction?(e.x-=snakeSpeed,e.tdObject.position.x=e.x,e.tdHeadObject.position.x=e.x):6==e.direction?(e.x+=snakeSpeed,e.tdObject.position.x=e.x,e.tdHeadObject.position.x=e.x):5==e.direction?(e.z+=snakeSpeed,e.tdObject.position.z=e.z,e.tdHeadObject.position.z=e.z):7==e.direction&&(e.z-=snakeSpeed,e.tdObject.position.z=e.z,e.tdHeadObject.position.z=e.z),e.meat+=snakeSpeed,fixtdObject(e);null!=e.next;)e.next.meat<=snakeSpeed?(room.remove(e.next.tdObject),e.next=null):e=e.next;snakeGrowing>snakeSpeed?snakeGrowing-=snakeSpeed:e.meat-=snakeSpeed,snakeGrowing<0&&(e.meat+=snakeGrowing,snakeGrowing=0),e!=snakeHead&&fixtdObject(e)}function fixtdObject(e){8==e.direction?(e.tdObject.scale.y=snakeSize+e.meat,e.tdObject.position.y=e.y-e.meat/2):2==e.direction?(e.tdObject.scale.y=snakeSize+e.meat,e.tdObject.position.y=e.y+e.meat/2):4==e.direction?(e.tdObject.scale.x=snakeSize+e.meat,e.tdObject.position.x=e.x+e.meat/2):6==e.direction?(e.tdObject.scale.x=snakeSize+e.meat,e.tdObject.position.x=e.x-e.meat/2):5==e.direction?(e.tdObject.scale.z=snakeSize+e.meat,e.tdObject.position.z=e.z-e.meat/2):7==e.direction&&(e.tdObject.scale.z=snakeSize+e.meat,e.tdObject.position.z=e.z+e.meat/2)}function getChosenDirection(e,t,n){var a=7;return Math.abs(e)>Math.abs(t)&&Math.abs(e)>Math.abs(n)?a=e>0?4:6:Math.abs(t)>Math.abs(e)&&Math.abs(t)>Math.abs(n)?a=t>0?2:8:Math.abs(n)>Math.abs(e)&&Math.abs(n)>Math.abs(t)&&(a=n>0?7:5),a}function changeDirection(e){if(snakeHead.meat<snakeSize&&(e=-1),(2==snakeHead.direction&&8==e||8==snakeHead.direction&&2==e||4==snakeHead.direction&&6==e||6==snakeHead.direction&&4==e||5==snakeHead.direction&&7==e||7==snakeHead.direction&&5==e)&&(e=-1),-1!=e&&snakeHead.direction!=e){var t=snakeHead;(snakeHead=new Object).x=t.x,snakeHead.y=t.y,snakeHead.z=t.z,snakeHead.tdObject=new THREE.Mesh(geometry,new THREE.MeshLambertMaterial({color:tailColor})),snakeHead.tdObject.position.x=snakeHead.x,snakeHead.tdObject.position.y=snakeHead.y,snakeHead.tdObject.position.z=snakeHead.z,snakeHead.tdObject.scale.x=snakeSize,snakeHead.tdObject.scale.y=snakeSize,snakeHead.tdObject.scale.z=snakeSize,setTimeout((function(){room.add(snakeHead.tdObject)}),5),snakeHead.direction=e,snakeHead.meat=0,snakeHead.growth=1,snakeHead.next=t,snakeHead.tdHeadObject=t.tdHeadObject}}function checkCollisions(){var e=snakeHead,t=!1;(e.x-snakeSize/2<-2||e.x+snakeSize/2>2||e.y+snakeSize/2>4||e.y-snakeSize/2<0||e.z+snakeSize/2>2||e.z-snakeSize/2<-2)&&(t=!0);for(var n=e.next,a=null;null!=n;)a=getSnakePieceRect(n),e.x>a.x&&e.x<a.x+a.width&&e.y>a.y&&e.y<a.y+a.height&&e.z>a.z&&e.z<a.z+a.depth&&(t=!0),n=n.next;return t}function getSnakePieceRect(e){var t=new Object,n=snakeSize;return 8==e.direction?(t.x=e.x-n/2,t.y=e.y-e.meat-n,t.z=e.z-n/2,t.width=n,t.height=e.meat,t.depth=n):2==e.direction?(t.x=e.x-n/2,t.y=e.y,t.z=e.z-n/2,t.width=n,t.height=e.meat,t.depth=n):4==e.direction?(t.x=e.x,t.y=e.y-n/2,t.z=e.z-n/2,t.width=e.meat,t.height=n,t.depth=n):6==e.direction?(t.x=e.x-e.meat-n,t.y=e.y-n/2,t.z=e.z-n/2,t.width=e.meat,t.height=n,t.depth=n):5==e.direction?(t.x=e.x-n/2,t.y=e.y-n/2,t.z=e.z-e.meat-n,t.width=n,t.height=n,t.depth=e.meat):7==e.direction&&(t.x=e.x-n/2,t.y=e.y-n/2,t.z=e.z,t.width=n,t.height=n,t.depth=e.meat),t}function init(){(scene=new THREE.Scene).background=new THREE.Color(1052688),camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,10),(room=new THREE.LineSegments(new BoxLineGeometry(4,4,4,10,10,10),new THREE.LineBasicMaterial({color:11595952}))).geometry.translate(0,2,0),scene.add(room);var e=new THREE.HemisphereLight(16777215,4473924);function t(){this.userData.isSelecting=!0,this.userData.startPx=this.position.x,this.userData.startPy=this.position.y,this.userData.startPz=this.position.z}function n(){this.userData.isSelecting=!1,this.userData.endPx=this.position.x,this.userData.endPy=this.position.y,this.userData.endPz=this.position.z,changeDirection(getChosenDirection(this.userData.startPx-this.userData.endPx,this.userData.startPy-this.userData.endPy,this.userData.startPz-this.userData.endPz))}e.position.set(1,1,1),scene.add(e),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.vr.enabled=!0,document.body.appendChild(renderer.domElement),document.body.appendChild(THREE.WEBVR.createButton(renderer)),(controller1=renderer.vr.getController(0)).addEventListener("selectstart",t),controller1.addEventListener("selectend",n),scene.add(controller1),(controller2=renderer.vr.getController(1)).addEventListener("selectstart",t),controller2.addEventListener("selectend",n),scene.add(controller2);var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-1],3)),a.addAttribute("color",new THREE.Float32BufferAttribute([.5,.5,.5,0,0,0],3));var o=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending});controller1.add(new THREE.Line(a,o)),controller2.add(new THREE.Line(a,o)),window.addEventListener("resize",onWindowResize,!1),generateLevel()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){renderer.setAnimationLoop(render)}function render(){if(controller1.userData.isSelecting&&controller2.userData.isSelecting?level=1:2!=level&&(level=0),0==level){moveSnake();for(var e=0;e<foods.length;e++)distanceFrom(snakeHead,foods[e])<snakeSize/2+foods[e].size/2?(snakeGrowing=foods[e].nutriment,room.remove(foods[e].tdObject),foods.splice(e,1),e-=1):foods[e].growth<=1&&(foods[e].growth+=.01,foods[e].tdObject.scale.x=foods[e].size*foods[e].growth,foods[e].tdObject.scale.y=foods[e].size*foods[e].growth,foods[e].tdObject.scale.z=foods[e].size*foods[e].growth);newFoodCooldown--<0&&(generateApple(),newFoodCooldown=rand(200,900)+10*foods.length),checkCollisions()&&gameOver()}else if(2==level){for(e=0;e<foods.length;e++)foods[e].growth>0?(foods[e].growth-=.1,foods[e].tdObject.scale.x=foods[e].size*foods[e].growth,foods[e].tdObject.scale.y=foods[e].size*foods[e].growth,foods[e].tdObject.scale.z=foods[e].size*foods[e].growth):room.remove(foods[e].tdObject);for(var t=snakeHead;null!=t;)t.growth>0?(t.growth-=.1,t.tdObject.scale.x=snakeSize*t.growth,t.tdObject.scale.y=snakeSize*t.growth,t.tdObject.scale.z=snakeSize*t.growth):room.remove(t.tdObject),t=t.next;gameOverCoooldown--<0&&generateLevel()}renderer.render(scene,camera)}function rand(e,t){return e>t?rand(t,e):(t+=1,Math.floor(Math.random()*(t-e)+e))}function distanceFrom(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))}init(),animate()</script>