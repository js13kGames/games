<!doctype html><meta content="width=device-width" name=viewport><title>Stronger</title><script type=module>var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);let i=()=>{};function s(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,s.nextSibling)}else document.body.appendChild(t)}function r(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}let h,n,a={};function o(t,...e){(a[t]||[]).map((t=>t(...e)))}let l={get:(t,e)=>"_proxy"==e||i};function d(){return h}function c(){return n}function u(t,{contextless:e=!1}={}){if(h=document.getElementById(t)||t||document.querySelector("canvas"),e&&(h=h||new Proxy({},l)),!h)throw Error("You must provide a canvas element for the game");return n=h.getContext("2d")||new Proxy({},l),n.imageSmoothingEnabled=!1,o("init"),{canvas:h,context:n}}function p(t,e,i){return Math.min(Math.max(t,i),e)}function f(t,e){return[t,e]=[t,e].map((t=>g(t))),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function g(t){let{x:e=0,y:i=0,width:s,height:r}=t.world||t;return t.mapwidth&&(s=t.mapwidth,r=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=r*t.anchor.y),s<0&&(e+=s,s*=-1),r<0&&(i+=r,r*=-1),{x:e,y:i,width:s,height:r}}class y{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new y(this.x+t.x,this.y+t.y,this)}subtract(t){return new y(this.x-t.x,this.y-t.y,this)}scale(t){return new y(this.x*t,this.y*t)}normalize(t=this.length()){return new y(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?p(this._a,this._d,t):t}set y(t){this._y=this._c?p(this._b,this._e,t):t}}function x(){return new y(...arguments)}class w extends class{constructor(t){return this.init(t)}init(t={}){this.position=x(),this.velocity=x(),this.acceleration=x(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=c(),render:s=this.draw,update:r=this.advance,children:h=[],anchor:n={x:0,y:0},opacity:a=1,rotation:o=0,scaleX:l=1,scaleY:d=1,...u}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:n,opacity:a,rotation:o,scaleX:l,scaleY:d,...u}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=r}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:n,y:a}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=n,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||i,t._pc()}))}removeChild(...t){t.flat().map((t=>{r(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class m extends w{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function _(){return new m(...arguments)}let A=/(\d+)(\w+)/;class v extends w{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=c().font,...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(A),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,s=2;for(;s<=e.length;s++){let r=e.slice(i,s).join(" ");t.measureText(r).width>this._fw&&(this._s.push(e.slice(i,s-1).join(" ")),i=s-1)}this._s.push(e.slice(i,s).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,r)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*r)}))}}function P(){return new v(...arguments)}let b=new WeakMap,T={},S={},M={0:"left",1:"middle",2:"right"};function R(t,e){let{x:i,y:s,width:r,height:h}=g(t);do{i-=t.sx||0,s-=t.sy||0}while(t=t.parent);let n=e.x-Math.max(i,Math.min(e.x,i+r)),a=e.y-Math.max(s,Math.min(e.y,s+h));return n*n+a*a<e.radius*e.radius}function E(t,e){return parseFloat(t.getPropertyValue(e))||0}function C(t){let e=null!=t.button?M[t.button]:"left";S[e]=!0,D(t,"onDown")}function G(t){let e=null!=t.button?M[t.button]:"left";S[e]=!1,D(t,"onUp")}function B(t){D(t,"onOver")}function H(t){b.get(t.target)._oo=null,S={}}function L(t,e,i){let s=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):R(s,t))return s}}(t);s&&s[e]&&s[e](i),T[e]&&T[e](i,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function D(t,e){t.preventDefault();let i=t.target,s=b.get(i),{scaleX:r,scaleY:h,offsetX:n,offsetY:a}=function(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),r="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(r[0]),n=parseFloat(r[3]),a=(E(i,"border-left-width")+E(i,"border-right-width"))*h,o=(E(i,"border-top-width")+E(i,"border-bottom-width"))*n,l=(E(i,"padding-left")+E(i,"padding-right"))*h,d=(E(i,"padding-top")+E(i,"padding-bottom"))*n;return{scaleX:(s.width-a-l)/e.width,scaleY:(s.height-o-d)/e.height,offsetX:s.left+(E(i,"border-left-width")+E(i,"padding-left"))*h,offsetY:s.top+(E(i,"border-top-width")+E(i,"padding-top"))*n}}(s);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let o=s.touches[i];o||(o=s.touches[i]={start:{x:(t-n)/r,y:(e-a)/h}},s.touches.length++),o.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:l,identifier:d})=>{let c=s.touches[d];c.changed=!0,c.x=s.x=(i-n)/r,c.y=s.y=(l-a)/h,L(s,e,t),o("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[d],s.touches.length--,s.touches.length||o("touchEnd"))}))):(s.x=(t.clientX-n)/r,s.y=(t.clientY-a)/h,L(s,e,t))}function N({radius:t=5,canvas:e=d()}={}){let i=b.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},b.set(e,i)}var s,r;return e.addEventListener("mousedown",C),e.addEventListener("touchstart",C),e.addEventListener("mouseup",G),e.addEventListener("touchend",G),e.addEventListener("touchcancel",G),e.addEventListener("blur",H),e.addEventListener("mousemove",B),e.addEventListener("touchmove",B),i._t||(i._t=!0,r=()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0},a[s="tick"]=a[s]||[],a[s].push(r)),i}function k(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}class Y{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function I(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(I(t))})),e}class W{constructor({id:t,name:e=t,objects:i=[],context:r=c(),cullObjects:h=!0,cullFunction:n=f,sortFunction:a,...o}){this._o=[];let l=r.canvas,d=this._dn=document.createElement("section");d.tabIndex=-1,d.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",d.id=t,d.setAttribute("aria-label",e),s(d,l),Object.assign(this,{id:t,name:e,context:r,cullObjects:h,cullFunction:n,sortFunction:a,...o});let{width:u,height:p}=l,x=u/2,g=p/2;this.camera=function(){return new w(...arguments)}({x:x,y:g,width:u,height:p,context:r,centerX:x,centerY:g,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map((t=>{this._o.push(t),I(t).map((t=>{this._dn.appendChild(t)}))}))}remove(...t){t.flat().map((t=>{r(this._o,t),I(t).map((t=>{s(t,this.context)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:r,sortFunction:h,cullObjects:n,cullFunction:a}=this;e.translate(i,s);let o=t;n&&(o=o.filter((t=>a(r,t)))),h&&o.sort(h),o.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:r,centerY:h}=e;t.save(),this._sx=r-i,this._sy=h-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function j(){return new W(...arguments)}class ${constructor({name:t,slowPower:i,aP:s,aR:r,sR:h,fCT:n,bullets:a=[]}){e(this,"name"),e(this,"slowPower"),e(this,"aP"),e(this,"aR"),e(this,"sR"),e(this,"fCT"),e(this,"fireTimer"),e(this,"bullets"),this.name=t,this.slowPower=i,this.aP=s,this.aR=r,this.sR=h,this.fCT=n,this.bullets=a,this.fireTimer=0}fire(t){return null}update(t){this.fireTimer+=t}getAttackRate(){return 1/this.fCT/1e3}setAttackRate(t){this.fCT=1/t*1e3}reload(t){this.bullets=[...this.bullets,t]}render(){this.bullets.forEach((t=>t.render()))}}class X extends ${constructor(){super({name:"plasma-gun",aP:3,aR:500,sR:0,fCT:.6})}fire(t){return this.fireTimer=0,P({text:"⚽️",x:xt,y:160,width:10,height:17,anchor:{x:.5,y:.5},sp:10,followEnemy:!0,aP:this.aP,sR:this.sR,targetEnemy:t})}}var F=(t=>(t.G1="G1",t.G2="G2",t.G3="G3",t.G4="G4",t.B1="B1",t.B2="B2",t.B3="B3",t.B4="B4",t.A1="A1",t))(F||{});let z=t=>["A1","B4"].includes(t),O={G1:{HP:10,name:"G1",sp:-1,width:32,height:32,sP:3,aP:2,aR:5,dP:0,fCT:5,text:"👹"},G2:{HP:7,name:"G1",sp:-1.5,width:20,height:20,sP:2,aP:2,aR:5,dP:0,fCT:3,text:"👺"},G3:{HP:15,name:"G3",sp:-1,width:32,height:32,sP:6,aP:11,aR:5,dP:2,fCT:5,text:"👽"},G4:{HP:35,name:"G3",sp:-1,width:32,height:32,sP:20,aP:20,aR:5,dP:5,fCT:5,text:"🤖"},B1:{HP:34,name:"B1",sp:-.7,width:60,height:60,sP:28,aP:35,aR:5,dP:1,fCT:5,text:"👹"},B2:{HP:50,name:"B1",sp:-.5,width:60,height:60,sP:126,aP:100,aR:5,dP:4,fCT:5,text:"👺"},B3:{HP:100,name:"B3",sp:-1.5,width:60,height:60,sP:500,aP:100,aR:5,dP:10,fCT:5,text:"👽"},B4:{HP:200,name:"B4",sp:-1.5,width:60,height:60,sP:0,aP:10,aR:5,dP:10,fCT:.05,text:"🤖"},A1:{HP:8,name:"A1",sp:-2,width:32,height:32,sP:12,aP:6,aR:50,dP:3,fCT:5,text:"👾"}};class U extends class{constructor({x:t,y:i,HP:s,name:r,sp:h,width:n,height:a,sP:o,aP:l,aR:d,dP:c,fCT:u,text:p}){e(this,"HP"),e(this,"name"),e(this,"sp"),e(this,"sP"),e(this,"aP"),e(this,"aR"),e(this,"dP"),e(this,"fCT"),e(this,"fireTimer"),e(this,"isStop"),e(this,"HPWrapSprite"),e(this,"HPSprite"),e(this,"HPMax"),e(this,"Sprite"),this.HP=s,this.name=r,this.sp=h,this.sP=o,this.aP=l,this.aR=d,this.dP=c,this.fCT=u,this.fireTimer=0,this.HPMax=s,this.isStop=!1,this.Sprite=_({x:t,y:i,ddeg:.01,deg:0,width:n,height:a,dx:h,render(){let t=this.context;t&&this.width&&this.height&&this.scaleX&&this.scaleY&&((this.deg<-.2||this.deg>.2)&&(this.ddeg*=-1),this.deg+=this.ddeg,t.translate(this.width/2,this.height),t.rotate(this.deg),t.translate(-this.width/2,-this.height),t.fillText(p,0,0,this.width),t.translate(this.width/2,this.height),t.rotate(-this.deg),t.translate(-this.width/2,-this.height))}}),this.HPSprite=_({x:1,y:1,width:n-2,height:5,color:"red"}),this.HPWrapSprite=_({x:0,y:-40,width:n,height:7,color:"#fff"}),this.HPWrapSprite.addChild(this.HPSprite),this.Sprite.addChild(this.HPWrapSprite)}hit(t){let e=0===t?0:Math.max(t-this.dP,1),i=!1;return this.HP>0&&this.HP-e<=0&&(this.Sprite.playAnimation("smoke"),this.Sprite.dx=0,this.Sprite.removeChild(this.HPSprite,this.HPWrapSprite),i=!0),this.HP-=e,this.HPSprite.width=Math.max((this.Sprite.width-2)*this.HP)/this.HPMax,e>0&&(this.isStop=!1,i||(this.Sprite.dx=1)),i}setSpeed(t){this.sp=-Math.abs(t),this.Sprite.dx=-Math.abs(t)}isAlive(){return this.HP>0}isDone(){return!this.isAlive()&&this.Sprite.currentAnimation._f===this.Sprite.currentAnimation.frames.length-1}isReadyToAttack(){return this.fireTimer>=this.fCT}cooldownAttack(){this.fireTimer=0}stop(){this.Sprite.dx<0&&(this.isStop=!0)}render(){this.Sprite.render()}handleSpeed(){this.isStop?this.Sprite.dx=0:Math.abs(this.Sprite.dx-this.sp)>.2&&(this.Sprite.dx-=.1*Math.sign(this.Sprite.dx-this.sp))}update(t){this.HPWrapSprite.update(),this.HPSprite.update(),this.Sprite.update(),this.handleSpeed(),this.fireTimer+=t}}{constructor({name:t,x:e,y:i}){super({x:e,y:i,...O[t]})}}class q extends w{constructor(t){super(),e(this,"es"),e(this,"soul"),e(this,"canvas"),this.es=[],this.soul=[],this.canvas=t}isDestroyed(){return 0===this.getAliveEnemies().length}getAliveEnemies(){return this.es.filter((t=>!t.isDone()))}buildUp(t){let e=t.summon();this.es=[...this.es,new U({name:null==e?void 0:e.ty,x:this.canvas.width-1,y:z(null==e?void 0:e.ty)?wt:mt})]}update(t){this.es.forEach((e=>e.update(t))),this.es=this.es.filter((t=>!t.isDone()))}render(){this.es.forEach((t=>t.render()))}}class Q{constructor(){e(this,"sprites",[]),e(this,"bg"),this.bg=_({x:0,y:236,width:1024,height:30,color:"#4e3d45"});for(let t=0;t<64;t++){let e=document.createElement("img");e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAElBMVEWJWkdOPET/1GzSiRaJWUb/4pxvBUKCAAAAZklEQVQI1y3G0Q3DIAwA0SN4AFtiAtP809ABrCYTIGX/VQJSTvfx8HvM94G777cv9MNng8pUPZwmZ1/R+lZzJ8P3bP/6ESTAfxFslYQAuQVx6aQISQlIJRAUKZdCUUzNkhnY24IuPCgGDoN65swqAAAAAElFTkSuQmCC",this.sprites.push(_({image:e,x:16*t,y:mt}))}}render(){this.bg.render(),this.sprites.forEach((t=>{t.render()}))}}class K extends v{constructor(t){super({...t,text:"👻"});let e=Math.random()-.5,i=Math.sqrt(.25-Math.pow(e,2))*Math.sign(Math.random()-.5),s=5*Math.random();super.dx=e*s,super.dy=i*s}getDistance(){return Math.sqrt(Math.pow(super.x-20,2)+Math.pow(super.y-10,2))}isDone(){return this.getDistance()<10}update(){super.dx+=super.ddx,super.dy+=super.ddy;let t=this.getDistance();super.ddx=-(super.x-20)/t*.1,super.ddy=-(super.y-10)/t*.1,super.x<50&&(super.dx*=.8),super.y<50&&(super.dy*=.8),super.update()}render(){super.render()}}let J=t=>document.querySelector(t),V=(t,e)=>e.at-t.at,Z=t=>{let e=t.sr.reduce(((t,e)=>t+e.ra),0),i=t.tt;return t.sr.reduce(((s,r)=>{let h=((t,e,i)=>new Array(e).fill({at:0,ty:""}).map((()=>({at:.3*Math.round(Math.random()*i/.3),ty:t.ty}))))(r,Math.ceil(i*(r.ra/e)),t.dr);return[...s,...h]}),[]).sort(V)},tt=[{tt:5,dr:5,sr:[{ty:F.G1,ra:1}]},{tt:10,dr:5,sr:[{ty:F.G1,ra:3},{ty:F.G2,ra:2}]},{tt:14,dr:7,sr:[{ty:F.G1,ra:1},{ty:F.G2,ra:3}]},{tt:14,dr:7,sr:[{ty:F.G1,ra:2},{ty:F.G2,ra:4},{ty:F.A1,ra:1}]},{tt:15,dr:7,sr:[{ty:F.G1,ra:4},{ty:F.G2,ra:8},{ty:F.B1,ra:1},{ty:F.A1,ra:2}]},{tt:14,dr:7,sr:[{ty:F.G1,ra:1},{ty:F.G3,ra:1}]},{tt:14,dr:7,sr:[{ty:F.G1,ra:2},{ty:F.G3,ra:4},{ty:F.A1,ra:1}]},{tt:10,dr:7,sr:[{ty:F.G3,ra:5},{ty:F.B1,ra:1},{ty:F.A1,ra:2}]},{tt:25,dr:7,sr:[{ty:F.G2,ra:4},{ty:F.A1,ra:1}]},{tt:24,dr:7,sr:[{ty:F.G1,ra:4},{ty:F.G2,ra:10},{ty:F.G3,ra:6},{ty:F.B2,ra:1},{ty:F.A1,ra:3}]},{tt:6,dr:7,sr:[{ty:F.G4,ra:1}]},{tt:12,dr:7,sr:[{ty:F.G3,ra:1},{ty:F.G4,ra:1}]},{tt:12,dr:7,sr:[{ty:F.G4,ra:3},{ty:F.B1,ra:1}]},{tt:40,dr:15,sr:[{ty:F.G2,ra:30},{ty:F.A1,ra:3},{ty:F.G4,ra:4},{ty:F.B1,ra:2},{ty:F.B2,ra:1}]},{tt:8,dr:5,sr:[{ty:F.A1,ra:7},{ty:F.B3,ra:1}]},{tt:18,dr:10,sr:[{ty:F.A1,ra:1},{ty:F.G4,ra:1},{ty:F.B1,ra:1}]},{tt:6,dr:4,sr:[{ty:F.G4,ra:1},{ty:F.B1,ra:1},{ty:F.B2,ra:1}]},{tt:9,dr:6,sr:[{ty:F.G4,ra:1},{ty:F.B1,ra:1},{ty:F.B2,ra:1}]},{tt:65,dr:15,sr:[{ty:F.G2,ra:50},{ty:F.G4,ra:8},{ty:F.B1,ra:4},{ty:F.B2,ra:2},{ty:F.B3,ra:1}]},{tt:110,dr:20,sr:[{ty:F.G1,ra:20},{ty:F.G2,ra:20},{ty:F.G3,ra:20},{ty:F.G4,ra:20},{ty:F.A1,ra:20},{ty:F.B1,ra:4},{ty:F.B2,ra:3},{ty:F.B3,ra:2},{ty:F.B4,ra:1}]}];class et{constructor(t){e(this,"waveRecipeList"),e(this,"sL"),e(this,"level",0),e(this,"summonTimer"),this.waveRecipeList=[...t],this.sL=[],this.summonTimer=0}isWavesDone(){return 0===this.waveRecipeList.length&&0===this.sL.length}isWaveDone(){return 0===this.sL.length}isReadyToSummon(){return!this.isWaveDone()&&this.sL[this.sL.length-1].at<this.summonTimer}next(){if(this.isWavesDone())return;let[t]=this.waveRecipeList.splice(0,1);this.level+=1,this.sL=Z(t),this.summonTimer=0;let e=document.querySelector(".ba");e&&(e.innerHTML=`Wave ${this.level}`,e.classList.add("show"),window.setTimeout((()=>{null==e||e.classList.remove("show")}),2e3))}update(t){this.summonTimer+=t}summon(){return this.sL.pop()}}let it=(t,e,i)=>{t&&(t.textContent=i(e))},st=t=>it(J(".info .resource"),`${t}`,(t=>`👻 ${t}`));const rt=class extends w{constructor({wave:t,generation:i}){super(),e(this,"wave"),e(this,"generation"),this.wave=t,this.generation=i}update(){it(rt.$wave,`${this.wave.level}`,(t=>`Wave ${t}`)),it(rt.$generation,`${this.generation}`,(t=>`${t}${"1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th"} Generation`))}};let ht=rt;e(ht,"$wave",J(".info .wg .wave")),e(ht,"$generation",J(".info .wg .generation"));let nt=["info","ups","cr-ups","cr-ws"],at=t=>{for(;null==t?void 0:t.firstChild;)t.removeChild(t.firstChild)};class ot extends w{constructor(t,i){super(),e(this,"user"),e(this,"info"),e(this,"corp"),e(this,"ground"),e(this,"effect"),e(this,"canvas"),e(this,"running"),this.user=t,this.info=new ht({wave:new et(tt),generation:t.generation}),this.corp=new q(i),this.ground=new Q,this.effect=[],this.canvas=i,this.running=!1}start(){nt.forEach((t=>{var e;return null==(e=J(`.${t}`))?void 0:e.classList.remove("hide")})),this.running=!0}end(){nt.forEach((t=>{var e;return null==(e=J(`.${t}`))?void 0:e.classList.add("hide")})),at(J(".pa-con .pa")),at(J(".ws-con .ws")),this.running=!1}render(){this.ground.render(),this.user.render(),this.corp.render(),this.effect.forEach((t=>t.render()))}update(t){let e=this.corp,i=this.info,s=i.wave,r=this.user,h=this.effect;s.update(t),e.isDestroyed()&&s.isWaveDone()&&(s.next(),i.update()),s.isReadyToSummon()&&e.buildUp(s);let n=r.ws;r.update(t),e.getAliveEnemies().sort(((t,e)=>t.Sprite.x-e.Sprite.x)).forEach((t=>{t.Sprite.x<xt&&(t.stop(),t.isReadyToAttack()&&(this.user.setLife(-1*t.aP),t.cooldownAttack())),n.forEach((e=>{if(r.calculateIsInRange(e,(t=>t.Sprite.x-xt)(t))&&r.calculateCanFire(e)&&t.isAlive()){let i=e.fire(t);r.coolDownFire(),i&&e.reload(i)}}))})),e.update(t);let a=t=>{let e=new Array(t.sP).fill("").map((()=>new K({x:t.Sprite.x,y:t.Sprite.y})));h.push(...e)};n.forEach((i=>{let s=i.bullets;s.forEach((h=>{if(h.followEnemy){let t=h.targetEnemy,e=t.Sprite,l={x:e.x+e.width/2,y:e.y+e.height/2},d=Math.sqrt(Math.pow(l.x-h.x,2)+Math.pow(l.y-h.y,2));if(h.x+=(l.x-h.x)/d*h.sp,h.y+=(l.y-h.y)/d*h.sp,h.rotation=(n={x:h.x,y:h.y},o=l,Math.atan2(o.y-n.y,o.x-n.x)+Math.PI/2),f(h,e)){let e=r.calculateBulletDamage(h.aP);if(h.slowPower){let e=1-(1-h.slowPower)*(1-Math.abs(h.x-t.Sprite.x)/h.sR);t.setSpeed(e)}t.hit(e)&&a(t),h.ttl=0,i.bullets=s.filter((t=>t.isAlive())),h.onDestroy&&h.onDestroy()}}else h.y>mt?(e.getAliveEnemies().forEach((t=>{if(0!==h.sR){if(Math.abs(h.x-t.Sprite.x)<h.sR&&!z(t.name)){let e=h.aP*(1-Math.abs(h.x-t.Sprite.x)/h.sR);t.hit(r.calculateBulletDamage(e))&&a(t)}}else f(h,t.Sprite)&&t.hit(r.calculateBulletDamage(h.aP))&&a(t)})),h.ttl=0,i.bullets=s.filter((t=>t.isAlive())),h.onDestroy&&h.onDestroy()):h.onFly&&h.onFly();var n,o;h.update(t)}))})),h.forEach((t=>t.update())),this.effect=h.filter((t=>!t.isDone()||(r.setResource(1),!1)))}}class lt{constructor({target:t,label:i,amount:s,rN:r,totalAmount:h=0}){e(this,"target"),e(this,"label"),e(this,"amount"),e(this,"rN"),e(this,"totalAmount"),this.target=t,this.label=i,this.amount=s,this.rN=r,this.totalAmount=h}getTarget(){return this.target.toString()}increaseResourceNeeded(){this.rN=Math.floor(1.5*this.rN)}}let dt=[{target:"ATTACK_POWER",label:"Attack Power",amount:10,rN:30},{target:"HEALTH",label:"Max Health",amount:10,rN:30},{target:"ATTACK_RANGE",label:"Attack Range",amount:10,rN:50},{target:"ATTACK_RATE",label:"Attack Rate",amount:10,rN:70}];class ct extends w{constructor(t){super(),e(this,"life"),this.life=t}setLife(t){this.life+=t}getIsDead(){return this.life<=0}}class ut{constructor(t){e(this,"r"),this.r=t,this.update(t)}update(t){this.r=t,st(t)}}e(ut,"$resource",J(".info .resource"));class pt extends ct{constructor({name:t,resource:i,ws:s,life:r,ups:h}){super(r),e(this,"name"),e(this,"resource"),e(this,"ws"),e(this,"ups"),e(this,"fCT"),e(this,"fireTimer"),e(this,"generation"),e(this,"upsInital"),e(this,"resourceInital"),e(this,"lifeBase"),e(this,"lifeMax"),e(this,"Sprite");let n=this;n.name=t,n.resource=new ut(i),n.ws=s,n.lifeMax=r,n.lifeBase=r,n.generation=1,n.fireTimer=0,n.fCT=.1,n.resourceInital=i,n.upsInital=n.ups=h,n.Sprite=P({text:"🛖",x:50,y:170,width:55,height:85,scaleX:2.4,scaleY:2.4,anchor:{x:.09,y:0}});let a=_({x:1,y:1,width:53,height:5,color:"#00db00",update:function(){this.width=Math.max(53*n.life/n.lifeMax,0)}}),o=_({x:-3,y:-7,width:55,height:7,color:"#fff",scaleX:1/3,scaleY:1/3});o.addChild(a),n.Sprite.addChild(o)}inherit(){this.life=this.lifeMax,this.resource=new ut(this.resourceInital),this.ups=new Map(this.upsInital),this.generation+=1}setResource(t){let e=this.resource.r;e+t<0||this.resource.update(e+t)}coolDownFire(){this.fireTimer=0}addWeapon(t,e){this.ws=[...this.ws,t],this.setResource(-1*e.rN),e.rN*=2,st(this.resource.r)}addUpgrade(t){let e=this.ups.get(t.getTarget());e&&("HEALTH"===e.getTarget()&&(this.life=this.lifeBase*(1+e.amount),this.lifeMax=this.lifeBase*(1+e.amount)),this.setResource(-1*e.rN),e.totalAmount=e.totalAmount+t.amount,e.increaseResourceNeeded(),st(this.resource.r))}calculateBulletDamage(t){let e=this.ups.get("ATTACK_POWER"),i=e?e.totalAmount:0;return 0===i?t:Math.ceil(t*(1+i/100))}calculateIsInRange(t,e){let i=this.ups.get("ATTACK_RANGE"),s=i?i.totalAmount:0;return e<=Math.ceil(t.aR*(1+s/100))}calculateCanFire(t){if(this.fireTimer<this.fCT)return;let e=this.ups.get("ATTACK_RATE"),i=e?e.totalAmount:0,s=1/(t.getAttackRate()*(1+i/100))/600;return t.fireTimer>=s}getWeaponCount(t){return this.ws.filter((e=>e.name===t)).length}update(t){this.fireTimer+=t,this.Sprite.update(),this.ws.forEach((e=>e.update(t)))}render(){this.Sprite.render(),this.ws.forEach((t=>t.render()))}}let ft=[{label:"Cannon",weaponClass:class extends ${constructor(){super({name:"cannon",aP:8,aR:800,sR:50,fCT:3})}fire(t){this.fireTimer=0;let e=P({text:"🎱",x:xt,y:160,anchor:{x:0,y:0},ddy:500,dy:-300,dx:.5*t.Sprite.x,width:10,height:10,scaleX:.5,scaleY:.5,sp:5,followEnemy:!1,aP:this.aP,sR:this.sR,targetPosition:t.Sprite.x});return e.onFly=()=>{for(let t=1;t<2;t++)_t.get({x:e.x+e.width/2,y:e.y,width:6,height:6,color:"#666",ttl:20,opacity:1,rotation:2*Math.random()*Math.PI})},e.onDestroy=()=>{for(let t=1;t<20;t++)_t.get({x:e.x+e.width/2,y:mt,dx:4*(Math.random()-.5),dy:2*Math.random()*-2,ddy:.1,width:4,height:4,color:"orange",ttl:40,opacity:1,rotation:2*Math.random()*Math.PI})},e}},rN:40},{label:"Electric Fence",weaponClass:class extends ${constructor(){super({name:"electric-fence",aP:2,aR:30,sR:0,fCT:1})}fire(t){this.fireTimer=0;let e=_({x:xt,y:mt-40,ddy:500,dx:10,width:10,height:10,anchor:{x:.5,y:.5},sp:5,followEnemy:!1,aP:this.aP,sR:this.sR,targetPosition:t.Sprite.x});return e.onDestroy=()=>{let t={width:2,height:2,color:"white",ttl:40,opacity:1,rotation:2*Math.random()*Math.PI};for(let e=0;e<10;e++)_t.get({...t,x:xt+e,y:mt-e}),_t.get({...t,x:xt+e,y:mt-e-10}),_t.get({...t,x:xt+e,y:mt-e-20});for(let e=10;e<20;e++)_t.get({...t,x:xt+e,y:mt-20+e}),_t.get({...t,x:xt+e,y:mt-20+e-10}),_t.get({...t,x:xt+e,y:mt-20+e-20});for(let e=20;e<30;e++)_t.get({...t,x:xt+e,y:mt+20-e}),_t.get({...t,x:xt+e,y:mt+20-e-10}),_t.get({...t,x:xt+e,y:mt+20-e-20})},e}},rN:40},{label:"Goo Bomb",weaponClass:class extends ${constructor(){super({name:"goobomb",aP:0,aR:800,slowPower:.5,sR:50,fCT:1})}fire(t){this.fireTimer=0;let e=P({text:"🎾",x:xt,y:160,width:10,height:10,anchor:{x:.5,y:.5},sp:10,followEnemy:!0,slowPower:this.slowPower,aP:this.aP,sR:this.sR,targetEnemy:t});return e.onDestroy=()=>{for(let t=1;t<20;t++)_t.get({x:e.x+e.width/2,y:mt,dx:4*(Math.random()-.5),dy:2*Math.random()*-2,ddy:.1,width:4,height:4,color:"green",ttl:40,opacity:1,rotation:2*Math.random()*Math.PI})},e}},rN:50},{label:"Plasma Gun",weaponClass:X,rN:70}];class gt extends m{constructor(){super(...arguments),e(this,"initialTtl")}init(t){super.init(t),this.initialTtl=this.ttl}update(){this.advance(),this.ttl&&this.initialTtl&&(this.opacity=this.ttl/this.initialTtl)}}class yt{constructor({upgrade:t,user:i}){var s;e(this,"upgrade"),e(this,"user"),e(this,"b"),e(this,"onButtonClick",(()=>{if(!(this.user.resource.r<this.upgrade.rN))if(this.upgrade instanceof lt)this.user.addUpgrade(this.upgrade),J("."+this.upgrade.getTarget()).innerHTML=`+${this.upgrade.totalAmount}%`;else{let t=new this.upgrade.weaponClass;this.user.addWeapon(t,this.upgrade),J(`.${t.name}`).innerHTML=`x${this.user.getWeaponCount(t.name)}`}})),this.upgrade=t,this.user=i,this.b=document.createElement("button"),this.b.classList.add("button"),this.b.addEventListener("click",this.onButtonClick);const r=this.upgrade instanceof lt?".ups .pa":".ups .ws";null==(s=J(r))||s.appendChild(this.b),this.render()}update(){this.b.querySelector(".resource").innerHTML=`👻 ${this.upgrade.rN}`,this.user&&(this.user.resource.r<this.upgrade.rN?this.b.classList.add("notenough"):this.b.classList.remove("notenough"))}render(){this.b.innerHTML=`\n      <div>\n        ${this.upgrade.label} \n        ${this.upgrade instanceof lt?`<span class="amount">+${this.upgrade.amount}%</span>`:""}\n        <span class="resource">👻 ${this.upgrade.rN}</span>\n      </div>\n    `}}let xt=100,wt=180,mt=220,_t=function(){return new Y(...arguments)}({create:t=>new gt(t)}),{canvas:At}=u();Promise.all([]).then((()=>{let t,e,s=new Map;dt.forEach((t=>{s.set(t.target,new lt(t))}));let r,h,n=(t=>{let e;return{update(t){null==e||e.update(t)},render(){null==e||e.render()},set(t){e&&e.hide&&e.hide(),e=t,t.show&&t.show()}}})(),a=(i=!1)=>n.set((i=>(r&&i?(console.log("INHERIT"),r.inherit()):(console.log("NEW TRIAL"),r=new pt({name:"jackie",ws:[new X],resource:30,life:100,ups:s})),t=[...r.ups.values()].map((t=>new yt({upgrade:t,user:r}))),[...r.ups.values()].forEach((t=>{J("."+t.getTarget()).innerHTML=`+${t.totalAmount}%`})),e=ft.map((t=>new yt({upgrade:t,user:r}))),[...r.ws.values()].forEach((t=>{J("."+t.name).innerHTML=`x${r.getWeaponCount(t.name)}`})),h=new ot(r,At),h.start(),h))(i));n.set((t=>{u(),N();let e=P({x:360,y:40,font:"62px Monospace",text:"STRONGER",textAlign:"center",color:"#fff"}),i=P({x:360,y:100,font:"25px Monospace",text:"(What does kill you)",textAlign:"center",color:"#aaa"}),s=new Q,r=P({text:"🛖",x:360,y:171,scaleX:2.4,scaleY:2.4}),h=P({text:"👾",x:520,y:190}),n=P({text:"⚽️",x:450,y:186,rotation:1.8}),a=P({text:"⚽️",x:490,y:195,rotation:1.8});return j({id:"title",objects:[e,i,s.bg,...s.sprites,r,h,n,a],onShow(){var e;let i=document.createElement("button");i.classList.add("sb"),i.innerText="START",i.onclick=t,null==(e=J("#app"))||e.appendChild(i)},onHide(){var t;null==(t=J(".sb"))||t.remove()}})})(a));let l=function({fps:t=60,clearCanvas:e=!0,update:s=i,render:r,context:h=c(),blur:n=!1}={}){if(!r)throw Error("You must provide a render() function");let a,l,d,u,p,f=0,x=1e3/t,g=1/t,y=e?k:i,m=!0;function w(){if(l=requestAnimationFrame(w),m&&(d=performance.now(),u=d-a,a=d,!(u>1e3))){for(o("tick"),f+=u;f>=x;)p.update(g),f-=x;y(h),p.render()}}return n||(window.addEventListener("focus",(()=>{m=!0})),window.addEventListener("blur",(()=>{m=!1}))),p={update:s,render:r,isStopped:!0,start(){a=performance.now(),this.isStopped=!1,requestAnimationFrame(w)},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:w,set _last(t){a=t}},p}({update:i=>{(null==r?void 0:r.getIsDead())&&h.running&&n.set(((t,e,i)=>(u(),N(),t.end(),j({id:"end",objects:[P({x:50,y:90,font:"24px Monospace",text:"You've been swarmed by the incoming enemies.",color:"#fff"}),P({x:50,y:140,font:"24px Monospace",text:"However, your remains will make your descendants stronger.\n      \nWill your people rise up again?",color:"#fff"})],onShow(){var t;let s=document.createElement("div");s.classList.add("ebs");let r=document.createElement("button");r.classList.add("eyb"),r.innerText="YES",r.onclick=e;let h=document.createElement("button");h.classList.add("enb"),h.innerText="NO",h.onclick=i,[r,h].forEach((t=>s.appendChild(t))),null==(t=J("#app"))||t.appendChild(s)},onHide(){var t;null==(t=J(".ebs"))||t.remove()}})))(h,(()=>a(!0)),(()=>a(!1)))),n.update(i),_t.update(),null==t||t.forEach((t=>t.update())),null==e||e.forEach((t=>t.update()))},render:()=>{n.render(),_t.render()}});l.start()}))</script><style>*{font-family:monospace}body{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh;margin:0;background:repeating-linear-gradient(-45deg,#222,#222 10px,#333 10px,#333 20px)}#app{position:relative;width:1024px;height:440px;border:15px solid #6c6c6c;background-color:#000}canvas{background:#000;width:1024px;height:256px;margin-top:20px}p{margin:0;color:#fff}.info{display:flex;justify-content:space-between;position:absolute;z-index:1;width:100%;padding:10px;box-sizing:border-box}.info .resource{font-size:24px}.wg{text-align:center}.wg .wave{font-size:30px;font-weight:700}.wg .generation{font-size:14px;color:#aaa}.ups{display:flex;gap:100px;background-color:#000;position:absolute;top:300px;padding-left:20px}.ups>*{flex:1}.pa-con>span,.ws-con>span{display:block;color:#fff;font-size:20px;margin-bottom:2px}.ups .pa,.ups .ws{display:flex;flex-wrap:wrap;gap:6px}.button{flex-basis:45%;display:block;width:100%;background:0 0;color:#fff;border:2px solid #bbb;font-size:16px;height:48px}.button:hover{cursor:pointer}.button:not(.notenough):active{background:#00db00}.button>div{font-size:13px}.button .amount{color:#00db00;font-weight:600}.button .resource{display:block}.button.notenough .resource{color:red}.ba{position:absolute;top:150px;left:50%;transform:translate(-50%,-50%);min-width:600px;height:70px;text-align:center;color:#fff;font-size:70px;opacity:0;transition:opacity .5s}.ba.show{opacity:1}.hide{display:none}.sb{position:absolute;top:320px;left:50%;transform:translate(-50%);width:200px;height:80px;font-size:40px;background:#000;color:#fff;border:2px solid #bbb;cursor:pointer}.ebs{display:flex;justify-content:center}.enb,.eyb{width:180px;height:64px;font-size:36px;background:#000;color:#fff;border:2px solid #bbb}.eyb{margin-right:10px}.enb:hover,.eyb:hover,.sb:hover{color:#00db00}.cr-ups,.cr-ws{position:absolute;color:#fff}.cr-ups{top:52px;left:10px}.cr-ws{top:80px;right:10px;text-align:end}.cr-ups ul,.cr-ws ul{margin:0;padding:0;list-style:none;width:160px}.cr-ups ul li,.cr-ws ul li{display:flex;justify-content:space-between}</style><div id=app><section class="hide info"><p class=resource><div class=wg><p class=wave><p class=generation></div></section><section class="hide cr-ups"><ul><li>Attack Power <span class=ATTACK_POWER></span><li>Max Health <span class=HEALTH></span><li>Attack Range <span class=ATTACK_RANGE></span><li>Attack Rate <span class=ATTACK_RATE></span></ul></section><section class="hide cr-ws"><ul><li>Cannon <span class=cannon></span><li>Electric Fence <span class=electric-fence></span><li>Goo Bomb <span class=goobomb></span><li>Plasma Gun <span class=plasma-gun></span></ul></section><canvas height=256 id=game width=1024></canvas><section class="hide ups"><div class=pa-con><span>Upgrades (affect all weapons)</span><div class=pa></div></div><div class=ws-con><span>Weapons</span><div class=ws></div></div></section><div class=ba id=ba></div></div>