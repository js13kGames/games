<style>*{font-family:monospace;font-size:20}body{margin:0;overflow:hidden;user-select:none;white-space:nowrap;color:#fff}.menuButton{box-sizing:border-box;width:90;height:30;background:#ccc;color:#000;border:2px solid #000;border-radius:6px;display:inline-block;text-align:center;vertical-align:middle;padding:0}.menuButton:active{background:#faa}.menuButton:hover{background:#ffa}input{background:#ccc;width:80;height:25;margin:4;text-align:center;border-radius:6px}.toolbar{position:absolute;background:#222;border-bottom:4px solid #555;border-right:4px solid #555;border-bottom-right-radius:30px}.toolbarTop{display:flex;align-items:center}.toolbarEditControls{display:flex;margin-left:8}.playControl{display:inline-block;width:40;height:40;font-size:28;margin:3;border-radius:9px;text-align:center}.songTimeDisplay{text-align:center;white-space:pre}.beatDisplay{width:56;height:56;background:#0ff;border:4px solid #000;border-radius:50%;margin:0;overflow:hidden;margin-left:6;margin-right:6}.beatDisplayMarker{width:10;height:10;border:3px solid #000;background:#222;border-radius:50%;position:relative;left:22;top:4;pointer-events:none}.beatDisplaySpinner{width:100%;height:100%}.watermark{position:absolute;bottom:8;right:8;font-size:16;color:#fff5;pointer-events:none}.loadingMessage{font-size:4em;background:#000;z-index:100;position:fixed;left:0;top:300;width:100%;padding:20px;text-align:center;outline:9px solid #222;display:none}.instrumentButton0{background:hsl(0,60%,60%)}.instrumentButton1{background:hsl(90,60%,60%)}.instrumentButton2{background:hsl(180,60%,60%)}.instrumentButton3{background:hsl(270,60%,60%)}.menu{margin:8;padding:8;height:100;background:#000;border:1px solid #fff;border-radius:2px;display:none;overflow-x:auto}.level:hover{color:#000;background:#2c2}</style><body></body>
<script>
const levelData = [
[6,"404 Demo",100,0,517,282,728,0,0,[25,3,6,1,2,4,6,1,4,5,2,1,8,5,3,0,12,5,3,0,13,5,3,0,14,5,3,0,15,5,3,0,16,5,2,1,20,5,2,1,24,5,3,0,4,6,3,0,8,6,3,0,12,6,3,0,16,6,3,0,20,6,3,0,24,6,3,0,4,7,3,0,8,7,3,0,12,7,3,0,16,7,3,0,20,7,3,0,24,7,3,0,4,8,3,0,8,8,3,0,12,8,3,0,16,8,3,0,20,8,3,0,24,8,3,0,4,9,3,0,5,9,3,0,6,9,3,0,7,9,3,0,8,9,3,0,12,9,3,0,16,9,3,0,20,9,3,0,21,9,3,0,22,9,3,0,23,9,3,0,24,9,3,0,8,10,3,0,12,10,3,0,16,10,3,0,24,10,3,0,8,11,3,0,12,11,3,0,16,11,3,0,24,11,3,0,8,12,3,0,12,12,3,0,16,12,3,0,24,12,3,0,8,13,2,1,12,13,2,1,13,13,3,0,14,13,3,0,15,13,3,0,16,13,3,0,24,13,2,1,4,14,1,1,26,14,6,1,3,15,6,1,18,17,6,0,23,17,6,0,19,18,1,1,7,19,1,4,18,19,6,0,20,19,7,2,21,19,7,2,23,19,6,0,6,20,2,3,7,20,7,1,8,20,2,2,17,20,1,4,18,20,6,0,20,20,2,0,21,20,2,0,7,21,6,0,19,21,1,1,20,21,3,0,21,21,0,0,22,21,3,0,23,21,3,0,24,21,3,0,25,21,6,0,7,22,1,4,17,22,1,4,24,22,0,0,25,22,1,4,17,23,6,0,18,23,2,3,19,23,3,0,20,23,3,0,21,23,3,0,22,23,3,0,23,23,3,0,24,23,3,0,20,24,1,4,23,24,1,4,24,24,6,0],29,29],
[6,"Tetris Loop",120,0,-26,96,809,0,0,[31,5,0,0,28,6,0,0,29,6,0,0,31,6,0,0,17,7,0,0,18,7,0,0,19,7,0,0,21,7,0,0,22,7,0,0,24,7,0,0,25,7,0,0,26,7,0,0,28,7,0,0,31,7,0,0,34,7,0,0,35,7,0,0,18,8,0,0,21,8,0,0,22,8,0,0,25,8,0,0,28,8,0,0,31,8,0,0,33,8,0,0,34,8,0,0,20,10,3,0,21,10,3,0,29,10,3,0,30,10,3,0,20,11,3,0,21,11,3,0,29,11,3,0,30,11,3,0,20,12,3,0,21,12,3,0,29,12,3,0,30,12,3,0,20,13,3,0,21,13,3,0,29,13,3,0,30,13,3,0,15,14,3,0,16,14,3,0,20,14,3,0,21,14,3,0,29,14,3,0,30,14,3,0,40,14,3,0,41,14,3,0,15,15,3,0,16,15,3,0,20,15,3,0,24,15,3,0,25,15,3,0,30,15,3,0,32,15,3,0,33,15,3,0,34,15,3,0,35,15,3,0,36,15,3,0,40,15,3,0,41,15,3,0,15,16,3,0,16,16,3,2,17,16,7,4,20,16,3,0,22,16,3,2,24,16,3,2,25,16,3,0,28,16,3,2,30,16,3,0,32,16,3,0,33,16,3,0,34,16,3,0,35,16,3,0,36,16,3,0,38,16,3,2,40,16,3,0,41,16,3,2,11,17,6,0,16,17,2,0,17,17,7,4,20,17,2,0,22,17,2,0,24,17,2,0,25,17,7,4,26,17,7,4,28,17,2,0,30,17,2,0,32,17,2,0,33,17,7,4,34,17,7,4,36,17,2,0,38,17,2,0,40,17,2,0,41,17,7,4,42,17,7,4,43,17,7,4,10,18,7,4,16,18,1,1,42,18,6,0,43,18,7,4,9,19,7,4,10,19,7,4,12,19,2,2,14,19,2,3,16,19,2,2,18,19,2,3,22,19,2,3,24,19,2,2,26,19,2,3,30,19,2,3,32,19,2,2,34,19,2,3,36,19,2,2,38,19,2,2,40,19,2,3,42,19,7,4,43,19,7,4,9,20,7,4,10,20,6,0,9,21,7,4,10,21,7,4,11,21,7,4,12,21,2,0,14,21,7,4,15,21,7,4,16,21,2,0,18,21,7,4,19,21,7,4,20,21,2,0,22,21,7,4,23,21,7,4,24,21,2,0,26,21,7,4,27,21,7,4,28,21,2,0,30,21,2,0,32,21,7,4,33,21,7,4,34,21,7,4,35,21,7,4,36,21,2,0,38,21,2,0,40,21,2,0,41,21,6,0,12,22,3,0,13,22,3,0,14,22,3,0,15,22,3,0,16,22,3,0,20,22,3,2,23,22,3,2,24,22,3,0,28,22,3,2,30,22,3,2,36,22,3,0,38,22,3,2,40,22,3,2,12,23,3,0,13,23,3,0,14,23,3,0,15,23,3,0,16,23,3,0,24,23,3,0,28,23,3,0,36,23,3,0,40,23,3,0,24,24,3,0,28,24,3,0,36,24,3,0,37,24,3,0,40,24,3,0,24,25,3,0,28,25,3,0,36,25,3,0,37,25,3,0,40,25,3,0,24,26,3,0,36,26,3,0,37,26,3,0,36,27,3,0,37,27,3,0,36,28,3,0,37,28,3,0],57,57],
[6,"Mario Intro",100,0,392,186,485,0,0,[42,9,3,0,23,10,6,0,24,10,2,2,42,10,3,0,21,11,3,3,22,11,2,3,24,11,1,1,26,11,6,0,37,11,3,0,39,11,3,0,40,11,3,0,42,11,3,0,44,11,3,0,52,11,3,0,22,12,2,3,26,12,2,3,27,12,3,1,32,12,3,0,37,12,3,0,39,12,3,0,40,12,3,0,42,12,3,0,44,12,3,0,48,12,3,0,52,12,3,0,22,13,6,0,26,13,2,3,27,13,3,3,32,13,3,0,37,13,3,0,39,13,3,0,40,13,3,0,42,13,3,0,44,13,3,0,48,13,3,0,52,13,3,0,57,13,3,0,24,14,2,3,25,14,6,0,32,14,3,0,37,14,3,0,40,14,3,0,42,14,3,0,44,14,3,0,46,14,3,0,48,14,3,0,50,14,3,0,52,14,3,0,54,14,3,0,57,14,3,0,58,14,3,0,12,15,3,2,14,15,3,0,15,15,3,0,32,15,3,0,35,15,3,0,37,15,3,0,40,15,3,0,42,15,3,0,44,15,3,0,46,15,3,0,48,15,3,0,50,15,3,0,52,15,3,0,54,15,3,0,57,15,3,0,58,15,3,0,12,16,3,0,14,16,3,0,15,16,3,0,32,16,3,0,35,16,3,0,37,16,3,0,40,16,3,0,42,16,3,0,44,16,3,0,46,16,3,0,48,16,3,0,50,16,3,0,52,16,3,0,54,16,3,0,57,16,3,0,58,16,3,0,12,17,3,0,14,17,3,0,15,17,3,0,17,17,3,0,18,17,3,0,27,17,1,2,32,17,3,0,35,17,3,0,37,17,3,0,40,17,3,0,42,17,3,0,44,17,3,0,46,17,3,0,48,17,3,0,50,17,3,0,52,17,3,0,54,17,3,0,57,17,3,0,58,17,3,0,5,18,3,2,6,18,3,0,10,18,3,2,12,18,3,0,14,18,3,0,15,18,3,0,17,18,3,0,18,18,3,0,19,18,3,0,27,18,0,0,32,18,3,0,35,18,3,0,37,18,3,0,40,18,3,0,42,18,3,0,44,18,3,0,46,18,3,0,48,18,3,0,50,18,3,0,52,18,3,0,54,18,3,0,57,18,3,0,58,18,3,0,5,19,3,0,6,19,3,0,7,19,3,0,8,19,3,0,10,19,3,0,12,19,3,0,14,19,3,2,15,19,2,0,17,19,3,0,18,19,3,0,19,19,3,0,29,19,3,2,32,19,3,0,35,19,3,0,37,19,3,0,40,19,3,0,42,19,3,0,44,19,3,0,46,19,3,2,48,19,3,0,50,19,3,0,52,19,3,2,54,19,3,2,56,19,3,2,58,19,3,0,4,20,7,4,5,20,2,0,6,20,2,0,8,20,2,0,10,20,2,0,11,20,2,0,12,20,3,0,13,20,7,4,14,20,7,4,15,20,7,4,17,20,2,0,18,20,7,4,19,20,7,4,20,20,7,4,27,20,1,1,28,20,0,3,29,20,2,0,30,20,7,4,32,20,2,0,33,20,7,4,35,20,2,0,36,20,7,4,37,20,3,0,38,20,2,0,40,20,2,0,42,20,2,0,43,20,2,0,44,20,3,0,46,20,2,0,47,20,2,0,48,20,3,2,50,20,3,2,51,20,2,0,52,20,2,0,54,20,2,0,56,20,2,0,58,20,2,0,59,20,7,4,4,21,1,1,5,21,5,1,21,21,4,0,26,21,7,4,28,21,5,1,61,21,4,0,20,22,7,4,21,22,7,4,22,22,7,4,23,22,7,4,24,22,7,4,25,22,7,4,26,22,7,4,27,22,0,3,40,22,3,0,41,22,3,0,42,22,3,0,43,22,3,0,44,22,3,0,45,22,2,0,47,22,3,0,48,22,3,0,49,22,2,0,50,22,3,0,51,22,3,0,52,22,3,0,56,22,3,0,57,22,2,0,60,22,7,4,26,23,7,4,47,23,3,0,48,23,3,0,49,23,3,0,50,23,3,0,51,23,3,0,52,23,3,2,55,23,3,0,56,23,3,0,57,23,3,2,60,23,7,4,26,24,7,4,27,24,7,4,28,24,7,4,29,24,7,4,30,24,7,4,31,24,7,4,32,24,7,4,33,24,7,4,34,24,7,4,35,24,7,4,36,24,7,4,37,24,7,4,38,24,7,4,39,24,7,4,40,24,7,4,41,24,7,4,42,24,7,4,43,24,7,4,44,24,7,4,45,24,7,4,46,24,7,4,47,24,7,4,48,24,7,4,49,24,7,4,50,24,7,4,51,24,7,4,52,24,7,4,53,24,7,4,54,24,7,4,55,24,7,4,56,24,7,4,57,24,7,4,58,24,7,4,59,24,7,4,60,24,7,4,26,25,7,4,26,26,7,4,37,26,3,0,38,26,3,0,39,26,3,0,40,26,3,0,46,26,3,2,47,26,7,4,48,26,7,4,49,26,7,4,50,26,7,4,51,26,7,4,52,26,7,4,54,26,3,0,55,26,3,0,56,26,3,0,57,26,3,0,58,26,3,0,59,26,3,0,20,27,7,4,21,27,7,4,22,27,7,4,23,27,7,4,24,27,7,4,25,27,7,4,26,27,7,4,27,27,0,3,36,27,3,0,37,27,3,0,38,27,3,0,39,27,3,0,40,27,2,1,42,27,3,0,43,27,3,0,44,27,3,0,45,27,3,0,46,27,3,0,47,27,2,1,52,27,7,4,54,27,3,0,55,27,3,0,56,27,3,0,57,27,2,1,58,27,3,0,59,27,3,0,60,27,3,0,4,28,1,1,5,28,5,1,21,28,4,0,26,28,7,4,28,28,5,1,61,28,4,0,4,29,7,4,5,29,2,1,6,29,2,1,7,29,3,0,8,29,2,1,10,29,2,1,11,29,2,1,13,29,2,1,14,29,7,4,15,29,7,4,17,29,2,1,18,29,7,4,19,29,7,4,20,29,7,4,27,29,1,1,28,29,0,3,29,29,2,1,30,29,7,4,32,29,2,1,33,29,7,4,35,29,2,1,36,29,7,4,38,29,2,1,41,29,3,0,42,29,2,1,43,29,2,1,45,29,2,1,46,29,2,1,47,29,3,2,49,29,2,1,51,29,2,1,53,29,3,2,54,29,2,1,56,29,2,1,58,29,2,1,59,29,7,4,5,30,3,0,6,30,3,0,7,30,3,2,10,30,3,0,11,30,3,0,13,30,3,0,14,30,3,0,15,30,3,0,17,30,3,0,18,30,3,0,19,30,3,0,29,30,3,0,30,30,3,0,32,30,3,0,38,30,3,0,41,30,3,0,43,30,3,0,45,30,3,0,49,30,3,2,51,30,3,2,56,30,3,0,58,30,3,0,59,30,3,0,10,31,3,0,11,31,3,2,13,31,3,0,14,31,3,0,15,31,3,0,17,31,3,0,18,31,3,0,19,31,3,0,27,31,0,0,29,31,3,0,30,31,3,0,32,31,3,0,38,31,3,0,41,31,3,0,43,31,3,0,45,31,3,0,49,31,3,0,51,31,3,0,56,31,3,0,58,31,3,0,59,31,3,0,14,32,3,0,15,32,3,0,17,32,3,0,18,32,3,0,27,32,1,0,29,32,3,0,30,32,3,0,32,32,3,0,38,32,3,0,41,32,3,0,43,32,3,0,45,32,3,0,49,32,3,0,51,32,3,0,54,32,3,0,55,32,3,0,56,32,3,0,58,32,3,0,59,32,3,0,15,33,3,2,29,33,3,0,30,33,3,0,32,33,3,0,38,33,3,0,41,33,3,0,43,33,3,0,45,33,3,0,48,33,3,0,49,33,3,0,51,33,3,0,54,33,3,0,55,33,3,0,56,33,3,0,58,33,3,0,59,33,3,0,32,34,3,0,38,34,3,0,41,34,3,0,43,34,3,0,45,34,3,0,48,34,3,0,49,34,3,0,55,34,3,0,56,34,3,0,38,35,3,0,41,35,3,0,43,35,3,0],69,69],
[6,"Row your boat into a fire",120,0,382,163,655,0,0,[37,8,3,0,39,8,3,0,41,8,3,0,42,8,3,0,37,9,3,0,39,9,3,0,41,9,3,0,42,9,3,0,37,10,3,0,39,10,3,0,41,10,3,0,42,10,3,0,12,11,7,4,13,11,7,4,14,11,7,4,15,11,7,4,16,11,7,4,17,11,7,4,18,11,7,4,19,11,7,4,20,11,7,4,21,11,7,4,22,11,7,4,23,11,7,4,24,11,7,4,25,11,7,4,26,11,7,4,27,11,7,4,28,11,7,4,29,11,7,4,30,11,7,4,31,11,7,4,32,11,7,4,35,11,3,0,37,11,3,0,39,11,3,0,41,11,3,0,11,12,0,0,12,12,5,1,15,12,7,4,27,12,3,0,28,12,3,0,32,12,7,4,35,12,3,0,37,12,3,0,39,12,3,0,41,12,3,0,15,13,7,4,17,13,2,0,18,13,7,4,19,13,7,4,21,13,2,0,22,13,7,4,23,13,7,4,25,13,2,0,26,13,7,4,27,13,3,0,28,13,2,0,32,13,7,4,35,13,3,0,36,13,2,0,37,13,2,0,39,13,3,0,40,13,2,0,41,13,2,0,42,13,7,4,43,13,7,4,15,14,1,1,16,14,5,1,42,14,6,0,43,14,7,4,27,15,3,0,28,15,3,0,29,15,7,4,30,15,7,4,33,15,7,4,34,15,7,4,42,15,7,4,43,15,7,4,17,16,0,3,27,16,3,0,28,16,3,0,29,16,3,0,30,16,2,0,31,16,7,4,32,16,7,4,33,16,7,4,42,16,7,4,43,16,7,4,25,17,6,1,29,17,6,1,31,17,6,1,42,17,7,4,23,18,3,3,24,18,2,2,26,18,1,3,30,18,1,1,32,18,2,3,42,18,7,4,25,19,6,1,29,19,6,1,31,19,6,1,42,19,7,4,42,20,7,4,6,21,5,4,7,21,5,4,26,21,2,0,28,21,7,4,29,21,2,0,42,21,7,4,6,22,5,4,7,22,5,4,42,22,6,0,14,23,7,4,15,23,7,4,16,23,7,4,17,23,2,0,18,23,2,0,19,23,3,0,20,23,7,4,21,23,2,0,22,23,2,0,23,23,3,0,24,23,7,4,25,23,2,0,26,23,3,0,27,23,3,0,30,23,2,0,31,23,3,0,32,23,7,4,33,23,2,0,34,23,2,0,35,23,3,0,36,23,7,4,37,23,2,0,38,23,2,0,39,23,3,2,40,23,7,4,41,23,2,0,18,24,3,0,19,24,3,0,21,24,3,0,23,24,3,0,25,24,3,0,26,24,3,0,27,24,3,0,30,24,3,0,31,24,3,0,32,24,3,0,33,24,3,0,35,24,3,0,36,24,3,0,37,24,3,0,41,24,3,2,21,25,3,0,23,25,3,0,25,25,3,0,26,25,3,0,27,25,3,0,35,25,3,0,36,25,3,0,21,26,3,0,23,26,3,0,35,26,3,0,36,26,3,0,21,27,3,0,23,27,3,0,21,28,3,0,23,28,3,0],57,57],
[6,"Automata Bomb 1",100,0,440,5,477,0,0,[33,31,5,4,34,31,5,4,33,32,5,4,34,32,5,4,33,33,1,4,34,33,1,4],68,68],
[6,"Automata Bomb 2",100,0,310,-143,477,0,0,[31,30,1,4,32,30,1,4,33,30,1,4,34,30,1,4,35,30,1,4,36,30,1,4,31,31,1,4,32,31,5,4,33,31,5,4,34,31,5,4,35,31,5,4,36,31,1,4,31,32,1,4,32,32,5,4,33,32,1,4,34,32,1,4,35,32,5,4,36,32,1,4,31,33,1,4,32,33,5,4,33,33,1,4,34,33,1,4,35,33,5,4,36,33,1,4,31,34,1,4,32,34,5,4,33,34,5,4,34,34,5,4,35,34,5,4,36,34,1,4,31,35,1,4,32,35,1,4,33,35,1,4,34,35,1,4,35,35,1,4,36,35,1,4],68,68]];
function aa(){for(var t=ba(),a=[],e=127;--e;)(48<=e&&57>=e||65<=e&&90>=e||97<=e&&122>=e||"-_.!~*'()".includes(String.fromCharCode(e)))&&a.push(String.fromCharCode(e));for(e=32;255>e;++e){var n=String.fromCharCode(e);"\\"==n||a.includes(n)||a.unshift(n)}t=ca(t=t.replace(/\u0001/g,"")),e=a.length,n="";for(var o={},i=2;50>i;i++)for(var c=0;c<t.length-i;++c){var r=t.substr(c,i);if(!o[r]){var l=r.charCodeAt(0),b=r.charCodeAt(r.length-1);if(!(l=56320<=l&&57343>=l||55296<=b&&56319>=b)){for(l=1,b=t.indexOf(r,c+i);0<=b;++l)b=t.indexOf(r,b+i);1<l&&(o[r]=l)}}}for(;;){for(;e--&&t.includes(a[e]););if(0>e)break;i=a[e];var f=void 0;c=0,r=encodeURI(encodeURIComponent(i)).replace(/%../g,"i").length;for(let t in o)l=((l=o[t])-1)*encodeURI(encodeURIComponent(t)).replace(/%../g,"i").length-(l+1)*r,n.length||(l-=encodeURI(encodeURIComponent("")).replace(/%../g,"i").length),0>=l?delete o[t]:l>c&&(f=t,c=l);if(!f)break;t=t.split(f).join(i)+i+f,n=i+n,c={};for(let a in o){for(o=a.split(f).join(i),r=0,l=t.indexOf(o);0<=l;++r)l=t.indexOf(o,l+o.length);1<r&&(c[o]=r)}o=c}return f=t,(a=n).length&&(f+=""+a),encodeURIComponent(f+"_")}function ca(t,a=1){const e=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],n=(t,a)=>t.replace(new RegExp(`${(a[2]?a[2]:"")+a[0]}|${(a[3]?a[3]:"")+a[1]}`,"g"),t=>t===a[0]?a[1]:a[0]);if(a)for(a=0;a<e.length;++a)t=n(t,e[a]);else for(a=e.length;a--;)t=n(t,e[a]);return t}function h(t,a=1,e=0){return t<e?e:t>a?a:t}function da(t=0,a=0,e=0){return`hsla(${360*t},${100*a}%,${100*e}%,1)`}function ea(t,a=440){return a*2**(t/12)}function ha(t=0){return"CCDDEFFGGAAB"[(t+=ia)%12|0]+(0>"02579".indexOf(t%12-1)?"":"#")+(12>t?"":t/12|0)}function ja(t=0){return(10-t||"")+"0%"}function n(t){const a=2&t?1:-1;return[1&t?-a:0,1&t?0:a]}function ka(t,a=.02){const e=t.source;e&&(t.source=0,t.gain.gain.linearRampToValueAtTime(t.gain.gain.value,q.currentTime),t.gain.gain.linearRampToValueAtTime(0,q.currentTime+a),setTimeout(()=>e.stop(),1e3*a))}class la{Play(t,a,e,n){if(this.source&&this.C==t&&this.key==a)this.gain.gain.value=e;else{ka(this);var o=ma[[this.C=t,this.key=a]];o||((o=[...r[t]])[2]=ea(a+ia,o[2]),o=ma[[t,a]]=na(...o)),(this.source=oa(...o)).connect(this.gain=q.createGain()).connect(this.pan=q.createStereoPanner()).connect(qa),this.source&&(this.gain.gain.value=e),this.source&&(this.pan.pan.value=n),this.source.start()}}}const ra=[["Block",4,0],["Power",5,1],["Play Note",4,1],["Control",4,0],["Remove",1,1],["Copy",5,1],["Rotate",2,1],["Power Line",5,1]];function sa(t,a,e){t.h=t.x=a,t.i=t.y=e}function ta(t){t.a=1==t.type,t.key=t.f=0,t.u=t.l=t.s=-1}function ua(t){t.c&&ka(t.c),va(t.x,t.y)}function wa(a,e){if(!(2!=a.type&&!e||8<++xa))if(ya)za.push([a,a.key,a.f]);else{e=1-a.f/10;const n=a.x/(t-1)*2-1;a.c||(a.c=new la),a.c.Play(2==a.type?a.data:0,a.key,e,n),Aa&&ka(a.c,.5)}}function Ba(t){ya?Ca.push(t):t.c&&ka(t.c)}function Da(t){t.A=t.a,t.a=0,t.v=0}function Ea(t){if(0!=t.type&&3!=t.type&&!(5==t.type&&t.j||t.a))if(t.a=1,7==t.type&&4>t.data){var a=n(t.data);(t=u(t.x+a[0],t.y+a[1]))&&Ea(t)}else if(1==t.type||7==t.type)for(a=4;a--;){var e=n(a);(e=u(t.x+e[0],t.y+e[1]))&&Ea(e)}}function Fa(a){if(!a.v&&3==a.type){var e=[],n=[],o=0,i=0,c=(r,l,b=1)=>{const f=u(r,l);if(f&&!e[r+t*l]){var s=3==f.type&&(2==a.type||f.data%2==a.data%2);(s||2==f.type)&&(b||s)&&(2==f.type||s)&&(f.v=1,e[r+t*l]=1,n.push(f),s&&(!i&&2>f.data?i=1:o+=2>f.data?1:f.data-2?5:12),c(r+1,l,s),c(r-1,l,s),c(r,l-1,s),c(r,l+1,s))}};c(a.x,a.y),n.map(t=>{a.data%2?t.f=Math.min(o,10):t.key=o,2==t.type&&Aa&&(t.a=1,wa(t))})}}function Ga(t){if(2==t.type)if(t.a){var a=(e,n,o=1)=>{const i=u(e,n);if(i&&i.l!=v){var c=3==i.type&&(2==t.type||i.data%2==t.data%2);(c||2==i.type)&&(o||c)&&(2==i.type||c)&&(i.l=v,a(e+1,n,c),a(e-1,n,c),a(e,n-1,c),a(e,n+1,c))}};a(t.x,t.y,1),(0<w||Aa)&&wa(t)}else Ba(t)}function Ha(t){xa=0,x.map(t=>t&&ta(t)),x.map(t=>t&&Da(t)),Ea(t),Aa=1,Fa(t),Aa=0,x.map(t=>t&&Fa(t)),Aa=1,x.map(t=>t&&Ga(t)),3==t.type&&!xa&&wa(t,1),Aa=0}function Ia(t,a){const e=2==a;e&&6==t.type&&(t.data=t.data?0:1),(1==t.type||5==t.type||7==t.type)&&4>t.data?e?t.data%2&&(t.data=(t.data+2)%4):t.data=(t.data+4+a)%4:0==t.type&&t.data&&3>t.data&&(t.data=1+(t.data+1+a)%2)}function Ja(t,a,e){if(!(t.D==Ka||(t.D=Ka,0==t.type&&(2<t.data||t.data==1+(1&a)))||5==t.type&&t.g&&!e||t.a&&6==t.type)){if(t.a&&4==t.type)return!0;t.a&&1==t.type&&4>t.data&&(a=t.data);var o=n(a);if(Pa(e=t.x+o[0],o=t.y+o[1])){if((e=u(e,o))&&6==e.type&&e.a){if(o=n(a=(a+(e.data?3:1))%4),!Pa(e=t.x+o[0],o=t.y+o[1]))return;e=u(e,o)}if(!e||Ja(e,a))return 0>t.b.indexOf(a)&&t.b.push(a),!0}}}function Qa(t){const a=a=>{let e=(a+2)%4;var o=n(e);!(o=u(t.x+o[0],t.y+o[1]))||4==o.type&&o.a||0==o.type&&3==o.data||(o.B=v,Ra.add(o),Ka++,Ja(t,a,1)&&(t.o[e]=o))};if(5==t.type&&(t.o=[],!t.g||t.j))if(4>t.data)a(t.data);else for(let t=4;t--;)a(t)}function Sa(a,e){var o=0<=e?n(e):[0,0];Pa(e=a.x+o[0],a=a.y+o[1])&&((o=u(e,a))&&4==o.type||(o=Ta[e+t*a],Ta[e+t*a]=o?o+1:1))}function Ua(t){5==t.type&&t.j?(t.b.map(a=>Sa(t,a)),Sa(t,-1)):1==t.b.length?Sa(t,t.b[0]):Sa(t,-1)}function Va(a){if(a.s==v)return a.x!=a.h||a.y!=a.i;if(a.s=v,4==a.type&&a.a)return!0;if(!a.b||1!=a.b.length)return!1;var e=n(a.b[0]),o=a.x+e[0];if(e=a.y+e[1],1<Ta[o+t*e])return!1;let i=u(o,e);return i&&i.a&&4==i.type?(ua(a),!0):!i||Va(i)?(va(a.x,a.y),x[o+t*e]=a,a.x=o,a.y=e,a.c&&((o=a.c).source&&(o.pan.pan.value=a.x/(t-1)*2-1)),!0):void 0}function Wa(a){1==a.type&&a.a?Va(a)||(a.a=0):5==a.type&&a.b.map(e=>{var o=a.o[(e+2)%4];if(o){var i=n(e),c=a.x+i[0];let r=u(c,i=a.y+i[1]);1!=Ta[c+t*i]||r&&!Va(r)||(c=n(e),u(e=a.x+c[0],c=a.y+c[1])||(va(e,c,o=new Xa(...Ya(o))),o.u=v,o.h=a.x,o.i=a.y))}})}function Ya(t){return[t.x,t.y,t.type,t.data]}function Za(t,a){if(!(a&&t.x<$a|t.y<ab|t.x>bb|t.y>cb||1==a&&t.m||3==a&&!t.m)){var e=!a,n=e?1:y;a=t.h,a+=h(n)*(t.x-a);var o=t.i;o+=h(n)*(t.y-o);var i=t.a;(5==t.type&&t.g||1==t.type&&t.B==v)&&(i=2),t.angle=6==t.type?t.angle+(i?4:1)*(t.data?1:-1)*db*z*eb/8:0;var c=4==t.type&&i?.8+h(.5+Math.cos(2*Math.PI*n)/2)*(1-.8):1;if(A.globalAlpha=t.u==v?n:1,1!=c||t.angle?(A.save(),A.scale(32,32),A.translate(a+.5,o+.5),A.rotate(Math.PI*t.angle),A.drawImage(fb,128*(t.data+5*i),128*t.type,64,64,-c/2,-c/2,c,c),A.restore()):A.drawImage(fb,128*(t.data+5*i),128*t.type,64,64,32*a,32*o,32,32),n=!e&&1>B,i=!e&&.5>=B,c=!e&&.25>=B,A.textAlign="center",A.textBaseline="middle",2==t.type){if(!e&&!n){i=u(t.x-1,t.y);const e=u(t.x,t.y-1);i&&3==i.type&&D(a-.08,o+.2,.16,.6,"#fff"),e&&3==e.type&&D(a+.2,o-.08,.6,.16,"#fff")}A.fillStyle="#fff",A.strokeStyle="#000",A.lineWidth=3,!e&&c||(t.f?(A.font="900 12.8px arial",e=ha(t.key),n||A.strokeText(e,32*(a+.5),32*(o+.34),25.6),A.fillText(e,32*(a+.5),32*(o+.34),25.6),t=ja(t.f),n||A.strokeText(t,32*(a+.5),32*(o+.75),25.6),A.fillText(t,32*(a+.5),32*(o+.75),25.6)):(A.font="900 25.6px arial",t=ha(t.key),n||A.strokeText(t,32*(a+.5),32*(o+.57),25.6),A.fillText(t,32*(a+.5),32*(o+.57),25.6)))}else 3==t.type?(e?t.data%2?t.f=1<t.data?5:0:t.key=t.data?12:0:n||(n=u(t.x-1,t.y),c=u(t.x,t.y-1),n&&(3==n.type&&n.data%2==t.data%2||2==n.type)&&D(a-.08,o+.2,.16,.6,"#fff"),c&&(3==c.type&&c.data%2==t.data%2||2==c.type)&&D(a+.2,o-.08,.6,.16,"#fff")),!e&&i||(e=t.data%2?ja(t.f):ha(t.key),A.fillStyle="#000",A.font=32/(2>t.data?3:2)+"px arial",A.fillText(e,32*(a+.5),32*(o+.51),25.6)),v==t.l&&D(a,o,1,1,"#fff8")):0!=t.type||3!=t.data||e||n||(e=u(t.x-1,t.y),n=u(t.x,t.y-1),e&&e.type==t.type&&e.data==t.data&&D(a-.5,o+.3,1,.4,"#000"),n&&n.type==t.type&&n.data==t.data&&D(a+.3,o-.5,.4,1,"#000"))}}class Xa{constructor(t,a,e=0,n=0){sa(this,t,a),this.type=e,this.data=n,this.m=this.angle=0,ta(this)}}function gb(){x=[],z=100,ia=0,E="",hb()}function Pa(a,e){return 0<=a&&a<t&&0<=e&&e<F}function u(a,e){return Pa(a,e)&&x[a+t*e]}function ib(a,e,n=-1,o=0){if(Pa(a,e)){if(0<=n)return x[a+t*e]=new Xa(a,e,n,o);delete x[a+t*e]}}function va(a,e,n){Pa(a,e)&&(n?(sa(n,a,e),x[a+t*e]=n):delete x[a+t*e])}function jb(t,a){return[Math.floor((t/B-H)/32),Math.floor((a/B-I)/32)]}function kb(t=0){J=[],K=lb-L+1;for(let a=M;a<=mb;++a)for(let e=L;e<=lb;++e){const n=u(e,a);J.push([e-L,a-M,n?n.type:-1,n&&n.data]),t&&ib(e,a)}N()}function nb(a,e,n=0){if(J){let o=0;if(J.map(t=>{Pa(t[0]+a,t[1]+e)&&(o=1),(t=ib(t[0]+a,t[1]+e,t[2],t[3]))&&Ia(t,n)}),o){const n=J.length/K;L=h(a,t-1),M=h(e,F-1),lb=h(a+K-1,t-1),mb=h(e+n-1,F-1),O=1,N()}else O=0}ob()}function pb(){var a=qb[17],e=qb[16],n=qb[9];rb=document.body==document.activeElement&&R==document.elementFromPoint(sb,tb),S[32]&&T(0==w);const o=ub,i=vb,c=wb;for(xb=wb=yb=vb=ub=0,(2==U||n)&&(xb=1,U&&(zb&&(Ab=sb/B-H,Bb=tb/B-I),H=sb/B-Ab,I=tb/B-Bb)),Cb|S[40]|S[38]&&(H=B*(H/32+V.x+.5),I=B*(I/32+V.y+.5),B=h(B*(S[40]?.75:S[38]?1/.75:0<Cb?.9:1/.9),4,.1),H=32*(H/B-V.x-.5),I=32*(I/B-V.y-.5)),n=jb(sb,tb),sa(V,n[0],n[1]),R.style.cursor=xb?"grab":"",n=0;5>n;n++)if(S[n+49]){T(n);break}if(0==w){if(a)S[90]?(O=0,1>=W.length||(Db.push(W.pop()),Eb(W[W.length-1]),Fb())):S[89]?Gb():S[67]||S[88]?kb(qb[88]):S[86]&&J?nb(V.x,V.y):S[83]?Hb():S[86]&&Ib();else{n=S[68]?1:S[65]?-1:0;var r=S[83]?1:S[87]?-1:0;if(n||r)O&&(kb(1),nb(L+=n,M+=r),O||(J=0));else if(S[84]){if(O){kb(1);var l=J.length/K;n=[...J],r=2*K-1,l=2*l-1,J=[];for(let t=0;t<l;t++)for(let a=0;a<r;a++){if(a%2||t%2){J[a+r*t]=[a,t,-1,0];continue}let e=n[(a>>1)+K*(t>>1)];e[0]=a,e[1]=t,J[a+r*t]=e}K=r,J.length=r*l,nb(L,M)}}else if(S[82]||S[69]||S[81]){const t=S[81]?2:S[82]?1:-1;if(O){kb(1);const a=J.length/K;J.map(e=>{let n,o;2==t?(n=K-e[0]-1,o=e[1]):1==t?(n=a-e[1]-1,o=e[0]):(n=e[1],o=K-e[0]-1),e[0]=n,e[1]=o}),2>t&&(K=a),nb(L,M,t)}else(n=u(V.x,V.y))&&Ia(n,t)}}rb&&(e?(vb=1,a=O,e=h(V.x,t-1),n=h(V.y,F-1),1!=zb&&3!=zb&&(1!=U&&3!=U||a)||(Jb=e,Mb=n,O=1),(1==U||3==U||O&&!a)&&(L=Math.min(Jb,e),M=Math.min(Mb,n),lb=Math.max(Jb,e),mb=Math.max(Mb,n))):1==U||3==U&&a||3==Nb?(ub=1,O=0,e=u(V.x,V.y),a||3==Nb?(ib(V.x,V.y),0<w||N(),yb=1):e&&e.type==V.type&&e.data==V.data||(e=ib(V.x,V.y,V.type,V.data))&&(0<w||N(),e.angle=V.angle,Ha(e),N())):3==U&&(wb=1,Ob!=V.x||Pb!=V.y||zb)&&((a=u(V.x,V.y))?(Ha(a),Qb(a.type,a.data)):N(1))),!vb&&i&&Rb(),!ub&&o&&(ub=0,ob()),!wb&&c&&N(),Ob=V.x,Pb=V.y}}function hb(){Sb.style.display="",O=0,T(),Tb(),N(),ob()}function N(t){ma={},xa=v=y=0,x.map(t=>t&&ta(t)),x.map(t=>t&&Da(t)),t||x.map(t=>{var a;return(a=t)&&(1==t.type&&t.A&&Ea(t),a=void 0),a}),x.map(t=>t&&Fa(t)),0<w&&x.map(t=>t&&Ga(t))}function Ub(){v++,xa=0,Vb=[],x.map(t=>{var a;if(a=t){if(t.h=t.x,t.i=t.y,++t.m,t.b=[],1==t.type&&t.a&&4>t.data)Vb.push(t);else if(5==t.type)t.j=0,t.a?(t.g||(t.g=1,t.j=1),Vb.push(t)):t.g=0;else if(6==t.type&&t.a)for(a=4;a--;){var e=n(a);(e=u(t.x+e[0],t.y+e[1]))&&Ia(e,t.data?-1:1)}a=void 0}return a}),Ta=[],Ra=new Set,Vb.map(t=>Qa(t)),Ra.forEach(t=>t.a=0),Vb.map(t=>{if(1==t.type&&t.a){var a=t.data;Ka++,Ja(t,a,1)}}),x.map(t=>t&&Ua(t)),Vb.map(t=>Wa(t)),x.map(t=>t&&Da(t)),x.map(t=>{var a;return(a=t)&&(1==t.type&&t.A&&Ea(t),a=void 0),a}),x.map(t=>t&&Fa(t)),x.map(t=>t&&Ga(t))}function Wb(a=0){if(requestAnimationFrame(Wb),!--Xb){Yb.style.display="none";var e=aa(),n=new URL(window.location.href);n.search="&c="+e;try{navigator.clipboard.writeText(n.toString()),alert("👍 Link copied!")}catch(t){Zb()}}for(!$b&&document.hasFocus()&&(S=[],qb=[],U=Nb=zb=Cb=0),$b=document.hasFocus(),pb(),db=Math.min(.1,(a-ac)/1e3),ac=a,y+=z*eb*(db*=4==w?8:0<w?1:.25),0==w||0==w||2==w||3==w&&bc?1==(y=Math.min(y,1))&&bc&&(T(2),bc=0):1<y&&(Ub(),y=Math.min(y-1,1),3==w&&(bc=1)),R.width=innerWidth,R.height=innerHeight,H=h(H,R.width/2/B,R.width/2/B-32*t),I=h(I,R.height/2/B,R.height/2/B-32*F),A.fillStyle="#112",A.fillRect(0,0,R.width,R.height),A.scale(B,B),A.translate(H,I),[$a,ab]=jb(0,0),[bb,cb]=jb(innerWidth,innerHeight),D(0,0,t,F,"#080808"),e=0;e<t/4;++e)D(4*e,0,1,F,"#111");for(e=0;e<F/4;++e)D(0,4*e,t,1,"#111");for(A.fillStyle="#000",e=0;e<=t;++e)A.fillRect(32*e-1,0,2,32*F);for(e=0;e<=F;++e)A.fillRect(0,32*e-1,32*t,2);x.map(t=>t&&Za(t,1)),x.map(t=>t&&Za(t,2)),0==w&&($b&&(rb||ub)&&!xb&&!vb&&Pa(V.x,V.y)&&D(V.x-.1,V.y-.1,1.2,1.2,0,.1,wb?"#0ff":yb?"#f00":"#fff"),O&&D((e=Math.min(L,lb))-.1,(n=Math.min(M,mb))-.1,Math.max(L,lb)-e+1.2,Math.max(M,mb)-n+1.2,0,.1,"#0f0")),cc.map((t,e)=>t.style.transform=`rotate(${a/2e3*(e?-1:1)}rad)`),e=Math.max(0,v+y-1),dc.style.transform=`rotate(${e*Math.PI/4}rad)`,n=(e=e/z/eb)%60|0,ec.innerText=(e/60|0)+":"+(9<n?"":"0")+n,fc.innerText="NoteCraft v1.05",S=[],zb=Cb=0}const gc=[[2,0,261.6255653005986,,1,,1,,,,,,.2,,,,.01,.5,.01,.2],[,0,130.8127826502993,,1,,,2,,,.5,,,,,.1,,.4,.05],[1.3,0,65.40639132514966,,.02,,,1.5,,,,,,5,,,,.7,.02],[.5,0,260,,,.04,,,,,,,.1,99,,,,2,.005,.2]];function ba(a=1){const e=[];return(0<w?hc:x).map(t=>{t&&e.push(...Ya(t))}),JSON.stringify([6,E,z,ia,0|H,0|I,a?1e3*B|0:0,r,0,e,t,F])}function ic(t){jc(JSON.parse(t,(t,a)=>null===a?void 0:a))}function jc(a){var e=a[0];let n,o,i;if(6!=e)Zb(),gb();else{for([e,E,z,ia,a,n,o,r,,i,t,F]=a,x=[],e=0;e<i.length;)ib(i[e++],i[e++],i[e++],i[e++]);r||(r=[...gc]),o&&(B=o/1e3,H=a,I=n),N(),Tb()}}function ob(){Fb(),Rb()}function Fb(){localStorage.NoteCraftSave=JSON.stringify([2,X]),localStorage.NoteCraftSaveLevel=ba()}function T(t=0){if(w!=t){0<=w&&(kc.style.transition=".5s");var a=0<w;w=t,lc.map((t,a)=>{const e=t[3],n=a==w;e.style.background=n?t[1]:"#555",e.style.border="4px solid "+(n?"#fff":"#000"),n&&(kc.style.background=0==a?"#888":e.style.background)}),a!=0<w&&(a?x.map(t=>t&&ua(t)):hc=x.map(t=>t&&new Xa(...Ya(t))),x=hc.map(t=>t&&new Xa(...Ya(t))),N())}}const lc=[["⏹️","#f00","Stop"],["▶️","#0f0","Play"],["⏸️","#ff0","Pause"],["⏯️","#0ff","Step"],["⏩","#f0f","Fast Forward"]],mc=[[1,0],[1,1],[1,2],[1,3],[1,4],[7,0],[7,1],[7,2],[7,3],[7,4],[6,1],[3,2],[3,0],[2,0],[2,1],[5,0],[5,1],[5,2],[5,3],[5,4],[0,0],[0,1],[0,2],[0,3],[4,0],[6,0],[3,3],[3,1],[2,2],[2,3]];function Qb(t,a){V.type=t,V.data=a,ta(V),mc.map(e=>{const n=e[0]==t&&e[1]==a;e[2].style.border=n?"4px solid #f00":"2px solid #000",e[2].style.padding=n?2:4,e[2].style.background=n?"#ccc":"#444"})}function Tb(){nc.value=E,oc.value=z=h(0|z,oc.max=360,oc.min=30),pc.value=ia=h(0|ia,pc.max=60,pc.min=0),qc.value=100*X,vc.innerHTML=.7<X?"🔊":.2<X?"🔉":X?"🔈":"🔇",document.title="🎵🔨 NoteCraft - "+(E||"Musical Cellular Automata"),qa&&(qa.gain.value=X),wc()}function Y(t,a,e="",n="",o="",i=""){return(t=a.appendChild(document.createElement(t))).className=e,t.style=n,t.innerHTML=o,t.title=i,t}function wc(){const t=Y("div",xc);mc.map((a,e)=>{const n=a[0],o=a[1];a[2]||(a[2]=Y("div",t,"","display:inline-block"),a[3]=Y("canvas",a[2],"","","",yc(...a)),6==n&&cc.push(a[3])),a=a[3],A=a.getContext("2d"),a.height=a.width=32,Za(new Xa(0,0,n,o)),a.onmousedown=a.onmouseover=(t=>ub||xb||t.buttons&&Qb(n,o)),e==mc.length/2-1&&Y("br",t)}),A=R.getContext("2d")}function yc(t,a){let e=ra[t][0];return 0==t?e=["Push","Horzontial Push","Vertical Push","Solid"][a]+" "+e:1==t?e+=4>a?" Mover":" Stationary":3==t&&a%2?e=(1<a?"Half Attenuate ":"Attenuate ")+e:3==t?e=(a?"Octave Key ":"Semitone Key ")+e:5==t?e+=4>a?" Direction":" All Directions":6==t&&(e+=a?" CW":" CCW"),e}function Hb(){document.activeElement&&document.activeElement.blur(),Tb(),zc.href=URL.createObjectURL(new Blob([ba()])),zc.download=(E||"Song")+".nc",zc.click()}function Ac(t){const a=new FileReader;a.onload=(t=>{T();const a=ba();try{ic(t.target.result)}catch(t){Zb(),ic(a)}hb(),ob(),Bc.value=""}),t&&a.readAsText(t)}function Ib(){Bc.onchange=(t=>Ac(t.target.files[0])),Bc.click()}function Cc(){T();let a=prompt("📐 Level Size?",101);a&&(F=t=a=h(0|a,1e3,25),gb())}function Dc(){Xb&&(Yb.style.display="block",Yb.innerHTML="🗜️ Compressing URL...",Xb=2)}function Ec(){let t=prompt("🥁 Export How many beats?",z);(t=h(t,10*z))&&Fc(t)}function Gc(){Sb.style.display=Sb.style.display?"":"block"}function Zb(){alert("👾 I am Error."),localStorage["OS13kTrophy,👾,NoteCraft,Found Bagu"]="Caused an error"}function Hc(){(fb=fb||Y("canvas",document.body,"","display:none")).height=1024,fb.width=1920,(A=fb.getContext("2d")).scale(2,2);for(let i=0;8>i;++i)for(let c=0;c<ra[i][1];++c)for(let r=0;3>r;++r){const l=2*(c+5*r),b=2*i;var t=0,a=1,e=.5;0==i&&3>c?(a=.2,t=.1,e=.4):0==i?e=a=0:1==i?t=1/6:3==i?(a=2>c?.2:.7,e=r?.9:.7,t=c%2?.05:.55):2==i?(t=c/4,e=r?.7:.3):5==i?(t=5/6,e=r?.6:.3):6==i?(t=.5,e=r?.6:.3):7==i?(t=2/6,e=r?.6:.3):4==i&&(e=r?.5:.2);var n=0==i&&2<c,o=n?"#888":r?"#fff":"#000";if(n=n?.2:r?.1:.05,e=da(t,a,e),0==i||2==i||3==i||7==i)D(l,b,1,1,e,n,o);else if(4==i){for(A.fillStyle=e,A.strokeStyle="#ff0",A.lineWidth=2,A.beginPath(),o=9;o--;)e=2*Math.PI*(o+.5)/8,A.arc(32*(l+.5),32*(b+.5),16,e,e);A.fill(),A.stroke()}else Ic(l+.5,b+.5,e,n,o);if(1==i||5==i||7==i){for(A.strokeStyle="#000",A.fillStyle=1<r?da(0,1,.5):da(t,a,r?.9:.1),A.lineWidth=2,t=3<c,A.beginPath(),a=5+t;a--;)o=(c+3)/4*Math.PI*2+2*Math.PI*(a-1)/(3+t),A.arc(32*(l+.5),32*(b+.5),9.6,o,o);A.fill(),A.stroke()}else 0==i?2==c?D(l+.5-.125,b,.25,1,"#000"):1==c&&D(l,b+.5-.125,1,.25,"#000"):6==i&&(t=da(t,a,r?1:.8),A.save(),A.translate(32*(l+.5),32*(b+.5)),D(-.35,-.125,.7,.25,"#000"),D(-.125,-.35,.25,.7,"#000"),D(-.3,-.075,.6,.15,t),D(-.075,-.3,.15,.6,t),A.restore())}A=R.getContext("2d")}function D(t,a,e,n,o,i=0,c="#fff"){A.save(),A.scale(32,32),o&&(A.fillStyle=o,A.fillRect(t,a,e,n)),i&&(A.lineWidth=i,A.strokeStyle=c,A.strokeRect(t+i/2,a+i/2,e-i,n-i)),A.restore()}function Ic(t,a,e,n=0,o="#fff"){A.save(),A.scale(32,32),A.beginPath(),A.arc(t,a,.5-n/2,0,7),e&&(A.fillStyle=e,A.fill()),n&&(A.lineWidth=n,A.strokeStyle=o,A.stroke()),A.restore()}function Rb(){99<W.length&&W.shift(),W.push([ba(0),O,L,M,lb,mb]),Db=[]}function Eb(t){[t,O,L,M,lb,mb]=t,ic(t)}function Gb(){if(O=0,Db.length){var t=Db.pop();Eb(W[W.push(t)-1]),Fb()}}ondragover=(()=>!1),ondrop=(t=>(Ac(t.dataTransfer.files[0]),!1));let Ca,za,q,ya=0;function Fc(t){T(0),ya=1;let a=[];for(;v<4*t-1;)Ca=[],za=[],0<w?Ub():T(1),Ca.map(t=>{let e=a.find(a=>a[2]==t);e&&(e[0][v]=-1,e[2]=0)}),za.map(t=>{const e=t[0],n=e.data,o=12+t[1];t=t[2]/10;let i=a.find(t=>t[2]==e);i||((i=a.find(t=>!t[2]&&t[1]==n))||(a.push([[],n,e,-1,-1]),i=a[a.length-1]));const c=i[2];i[0][v]=o==i[3]&&e==c?h(t,.999):o+h(t,.999),i[2]=e,i[3]=o,i[4]=t});T(0),ya=0;const e=[];a.map(t=>{const a=t[1];(t=t[0]).unshift(0),t.unshift(a),e.push(t)});const n=e.reduce((t,a)=>Math.max(a.length,t),0);e.map(t=>t.length=n),e.sort((t,a)=>t[0]-a[0]),t=JSON.stringify([r,[e],[0],z]).replace(/null/g,""),zc.href=URL.createObjectURL(new Blob([t])),zc.download=(E||"Song")+".txt",zc.click(),localStorage["OS13kMusic,NoteCraft - "+E]=t,localStorage["OS13kTrophy,🎵🔨,NoteCraft,Exporter"]="Exported to OS13k"}function Jc(...t){Kc(...na(...t))}function oa(...t){q||(q=new AudioContext,(qa=q.createGain()).connect(q.destination),qa.gain.value=X);const a=q.createBuffer(1,t.length,44100),e=q.createBufferSource();return a.getChannelData(0).set(t),e.buffer=a,e}function Kc(...t){(t=oa(...t)).connect(qa),t.start()}const na=(t=1,a=.05,e=220,n=0,o=0,i=.1,c=0,r=1,l=0,b=0,f=0,s=0,u=0,d=0,p=0,y=0,h=0,m=1,v=0,g=0)=>{let x=2*Math.PI;u=44100*u|0;let A=(n=99+44100*n)+(v*=44100)+(o*=44100)+(i=99+44100*i)+(h*=44100)|0,S=l*=500*x/194481e4;a=e*=(1+2*a*Math.random()-a)*x/44100;let w,M=(0<p?1:-1)*x/4,k=0,C=0,T=0,Y=0,B=0,R=0,V=1,D=[];for(;T<A;D[T++]=R)++B%(100*y|0)||(R=(0<(R=c?1<c?2<c?3<c?Math.sin((k%x)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/x%2+2)%2:1-4*Math.abs(Math.round(k/x)-k/x):Math.sin(k))?1:-1)*Math.abs(R)**r*(u?1-g+g*Math.sin(2*Math.PI*T/u):1)*t*.5*(T<n?T/n:T<n+v?1-(T-n)/v*(1-m):T<n+v+o?m:T<A-h?(A-T-h)/i*m:0),R=h?R/2+(h>T?0:(T<A-h?1:(T-A)/h)*D[T-h|0]/2):R),k+=(w=(e+=l+=500*b*x/44100**3)*Math.sin(C*p*x/44100-M))-w*d*(1-1e9*(Math.sin(T)+1)%2),C+=w-w*d*(1-1e9*(Math.sin(T)**2+1)%2),V&&++V>44100*s&&(e+=f*x/44100,a+=f*x/44100,V=0),!u||++Y%u||(e=a,l=S,V=V||1);return D};let r,x,hc,U,zb,Nb,Cb,Ab,Bb,Aa,xa,ma,R,fb,A,Sb,y,oc,qc,vc,pc,nc,zc,Bc,Jb,Mb,L,M,lb,mb,J,K,vb,O,ub,xb,wb,yb,Lc,xc,Mc,kc,dc,ec,fc,$a,ab,bb,cb,Ra,rb,Yb,Ob,Pb,Ta,Vb,qa,t=57,F=57,z=100,ia=0,eb=4/60,ac=0,v=-1,bc=0,V=new Xa(0,0),sb=0,tb=0,w=-1,db=0,qb=[],S=[],cc=[],E="",H=0,I=0,B=1,W=[],Db=[],$b=0,Xb=0,Ka=0,X=.5;!function(){let t,a=document.body;Lc=Y("div",a,"toolbar"),Mc=Y("div",Lc,"toolbarTop"),xc=Y("div",Lc,"toolbarEditControls"),R=Y("canvas",a),zc=Y("a",a,"","display:none"),(Bc=Y("input",a,"","display:none")).type="file",Bc.accept=".nc",Hc(),wc(),fc=Y("div",a,"watermark"),(nc=Y("input",Mc,"","font-size:30;height:50;width:530")).placeholder="Song Name",nc.onchange=(t=>ob(Tb(E=t.target.value)));var e=Y("div",Mc,"","margin-right:4;margin-left:4;text-align:center");t=Y("span",e,"","","BPM"),(oc=t=Y("input",e,"","")).title="Beats Per Minute - How fast the song is",t.onchange=(t=>ob(Tb(z=t.target.value))),t.type="number",Y("br",e),t=Y("span",e,"","","Key"),(pc=t=Y("input",e,"","")).title="Transpose song key",t.onchange=(t=>ob(Tb(ia=t.target.value))),t.type="number",e=Y("div",Mc,"","margin-right:8");for(let a=0;4>a;++a)(t=Y("div",e,`instrumentButton${a} menuButton`,"width:30",a+1)).title=`Instrument ${a+1} Paremeters`,t.onmousedown=(()=>{Jc(...r[a]);let t=prompt(`🎹 Instrument ${a+1} ZzFX Code`,`zzfx(...${JSON.stringify(r[a]).replace(/null/g,"")})`);t&&((t=t.split("[")[1])?(r[a]=t.split(",").map(t=>t.length?parseFloat(t):void 0),Jc(...r[a]),alert("Instrument Loaded!")):Zb())}),a-1||Y("br",e);const n=Y("div",Mc,"","");[["Save",Hb,"Save to disk (current song is auto saved)"],["Load",Ib,"Load from disk (you can also drag and drop)"],["New",Cc,"Start a new song"],["Share",Dc,"Share a compressed link"],["Export",Ec,"Export to ZzFXM and OS13k"],["Demos",Gc,"Load a demo"]].map((a,e)=>{(t=Y("div",n,"menuButton","",a[0])).onmousedown=a[1],t.title=a[2],e-2||Y("br",n)}),e=Y("div",xc),(kc=Y("div",e,"beatDisplay")).onmousedown=(()=>{T(0==w)}),(dc=Y("div",kc,"beatDisplaySpinner")).title="Toggle Play [Space]",t=Y("div",dc,"beatDisplayMarker"),ec=Y("div",e,"songTimeDisplay"),e=Y("div",xc);const o=Y("div",e);lc.map((a,e)=>{a[3]=t=Y("div",o,"playControl","",a[0],a[2]+` [${e+1}]`),t.onmousedown=(()=>T(e))}),e=Y("div",e,"","display:flex"),vc=Y("div",e,"","width:30"),qc=t=Y("input",e,"","width:230;margin:0"),t.oninput=(t=>{X=h(0|t.target.value,100,0)/100,Tb()}),t.onchange=(t=>ob(t.target.blur())),t.type="range",Yb=Y("div",a,"loadingMessage"),Sb=Y("div",Lc,"menu"),levelData.map((a,e)=>{(t=Y("div",Sb,"level","",a[1])).onmousedown=(()=>{T(),jc(levelData[e]),hb()})}),x=[],Tb(),Qb(2,0),T(),A=R.getContext("2d")}(),R.onmousedown=(t=>{zb=U=t.button+1,Nb=t.buttons}),onmouseup=R.onmouseup=(t=>{U=0,Nb=t.buttons}),onmousemove=(t=>{sb=t.x,tb=t.y}),oncontextmenu=(()=>!1),document.addEventListener("wheel",t=>{t.ctrlKey&&t.preventDefault(),t.target==R&&(Cb=t.deltaY)},{passive:!1}),onkeydown=(t=>{(9==t.keyCode||t.ctrlKey||t.altKey)&&t.preventDefault(),"input"!=t.target.localName&&(t.repeat||(qb[t.keyCode]=S[t.keyCode]=1))}),onkeyup=(t=>qb[t.keyCode]=0);{try{const t=JSON.parse(localStorage.NoteCraftSave);2==t[0]&&(X=t[1])}catch(t){}const t=new URL(window.location.href);try{var Nc;{var Oc=t.searchParams.get("c");const a=(Oc=Oc.substring(0,Oc.length-1)).split("");let e=a[0];if(1<a.length){let t=a[1];for(let a of t){let t=e.split(a);e=t.join(t.pop())}}Nc=ca(e,0)}ic(Nc),hb()}catch(t){try{ic(localStorage.NoteCraftSaveLevel),hb()}catch(t){T(),jc(levelData[0]),hb()}}t.search="",window.history.pushState(null,null,t.toString())}Wb()
</script>