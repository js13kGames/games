const easeInOut=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;class Tween{constructor(t,e,i,s,h,a=null,n=null){this.target=t,this.property=e,this.startValue=i,this.endValue=s,this.duration=h,this.easingFunction=a||(t=>t),this.onComplete=n,this.currentTime=0,this.isComplete=!1}update(t){if(this.isComplete)return;this.currentTime+=t;const e=Math.min(this.currentTime/this.duration,1),i=this.easingFunction(e),s=this.startValue+(this.endValue-this.startValue)*i;this.target[this.property]=s,e>=1&&(this.isComplete=!0,this.onComplete&&this.onComplete())}}class Button{constructor(t,e,i,s,h,a={}){this.text=t,this.x=e,this.y=i,this.width=s,this.height=h,this.fontSize=a.fontSize||24,this.bgColor=a.bgColor||"#ddd",this.textColor=a.textColor||"#000",this.shadowColor=a.shadowColor||"#888",this.isPressed=!1,this.isHovered=!1}isPointInside(t,e){return t>=this.x-this.width/2&&t<=this.x+this.width/2&&e>=this.y-this.height/2&&e<=this.y+this.height/2}onMouseDown(t,e){return!!this.isPointInside(t,e)&&(this.isPressed=!0,!0)}onMouseUp(t,e){const i=this.isPressed;return this.isPressed=!1,i&&this.isPointInside(t,e)}onMouseMove(t,e){return this.isHovered=this.isPointInside(t,e),this.isHovered}draw(t){const e=this.isPressed?0:-2,i=this.isPressed?0:-2;this.isPressed||(t.fillStyle=this.shadowColor,t.beginPath(),t.roundRect(this.x-this.width/2+2,this.y-this.height/2+2,this.width,this.height,8),t.fill()),t.fillStyle=this.isPressed?"#bbb":this.bgColor,t.beginPath(),t.roundRect(this.x-this.width/2+e,this.y-this.height/2+i,this.width,this.height,8),t.fill(),t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.roundRect(this.x-this.width/2+e,this.y-this.height/2+i,this.width,this.height,8),t.stroke(),t.fillStyle=this.textColor,t.font=this.fontSize+"px Arial",t.textAlign="center",t.fillText(this.text,this.x+e,this.y+i+8)}}class ChickpocalypseMeow{constructor(t,e=8){this.gameTitle="CHICKPOCALYPSE\nMEOW!",this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.gridSize=8,this.uiRowHeight=40,this.cellSize=70,this.mainMenuTitleY=this.canvas.height/2-100,this.mainMenuHighScoreY=this.canvas.height/2-50,this.levelStartTitleY=-100,this.clickToStartY=this.canvas.height+100,this.clickToStartLevelButton=new Button("Click to Start",this.canvas.width/2,this.canvas.height+100,160,40,{shadowColor:"#000"}),this.levelCompleteTitleY=this.canvas.height+50,this.levelCompleteScoreY=this.canvas.height+80,this.levelCompleteTotalScoreY=this.canvas.height+110,this.levelCompleteClickNextY=this.canvas.height+140,this.levelCompleteClickForNextButton=new Button("Click for Next Level",this.canvas.width/2,this.canvas.height+100,240,40,{shadowColor:"#000"}),this.playAgainButtonY=this.canvas.height+110,this.draggedChick=null,this.dragOffset={x:0,y:0},this.mousePos={x:0,y:0},this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.gridOffsetX=(this.canvas.width-this.cellSize*this.gridSize)/2,this.gridOffsetY=this.uiRowHeight+(this.canvas.height-this.uiRowHeight-this.cellSize*this.gridSize)/2,this.startButton=new Button("PLAY!",this.canvas.width/2,this.canvas.height/2,120,50,{shadowColor:"#000"}),this.howToPlayButton=new Button("How To Play",this.canvas.width/2,this.canvas.height-200,240,50,{shadowColor:"#000"});try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=1}catch(t){console.log(t),this.audioContext=null}this.gameState="menu",this.level=1,this.gameOver={fadeAlpha:0,flashTime:0,titleX:this.canvas.width/2,titleY:this.canvas.height+50,titleTargetY:180,finalScoreY:this.canvas.height+80,finalScoreTargetY:200,newHighScoreY:this.canvas.height+110,newHighScoreTargetY:220,highScoreY:this.canvas.height+140,highScoreTargetY:220,buttonY:this.canvas.height+170,buttonTargetY:500,isNewHighScore:!1,selectedLine:null},this.gameOverTagLines=["Meow!\nThat's What I Call Chickpocalypse Vol. 2025.","Black Cats 1 - Cute Little Chicks 0.\nNo Rematches!","Furs 1 - Feathers 0\nGame Over Man!\nGame Over!","It was a purr-fect massacre!","They were purr-ged!","They were absolutely meow-ssacred!","An egg-stinction level event!","They got seriously clucked up!","Those cute little chicks...\neggs-terminated!","Those cats are too fur-midable!","Black cats rule! Chicks drool!","Meow and forever!"],this.playAgainButton=new Button("Play Again!",this.canvas.width/2,this.gameOver.buttonY,200,80,{bgColor:"#0066ff",textColor:"#fff",shadowColor:"#3399ff"}),this.tutorialStep=0,this.tutorialSteps=[{type:"chicks",text:"1/3\n Keep these cute little chicks alive!\nDrag and drop them in the green area\nwhile the timer is running.",spotlight:{x:75,y:80,width:450,height:450}},{type:"timer",text:"2/3\n This is the countdown timer.\n\nYou have this time to figure out cat attack paths\n and drag your cute little chicks into safe areas\nto avoid the cats.\n\nThe time will get shorter as you get \nnearer to the inevitable Chickpocalypse!",spotlight:{x:0,y:0,width:600,height:40}},{type:"paws",text:"3/3\n At the start of each level\nblack cats appear from the bushes.\n\nWhen time runs out they launch\nacross the screen killing all\n chicks in their path!\n\nEvery chick that survives a level\n is worth 10 points.",spotlight:[{x:0,y:40,width:75,height:485},{x:525,y:40,width:75,height:485},{x:75,y:40,width:450,height:40},{x:75,y:520,width:450,height:40}]}],this.tutorialTextY=this.canvas.height+100,this.tutorialButtonsY=this.canvas.height+100,this.nextButton=new Button("Next",450,this.canvas.height+100,80,35,{shadowColor:"#c00"}),this.prevButton=new Button("Prev",350,this.canvas.height+100,80,35,{shadowColor:"#c00"}),this.playButton=new Button("Play!",400,this.canvas.height+100,160,70,{bgColor:"#ff8800",shadowColor:"#c00"}),this.initMenuChicks(),this.activeTweens=[],this.gameOver.isNewHighScore=!1,this.highScoreFlashTime=0,this.highScore=this.loadHighScore(),this.totalScore=0,this.levelScore=0,this.timeLeft=6,this.gameStartTime=Date.now(),this.scoreAnimations=[],this.chicks=this.initializeChicks(),this.paws=[],this.generatePaws(),this.pawsMoving=!1,this.isMuted=!1,this.muteButton=new Button("ðŸ”Š",this.canvas.width-50,20,40,30,{fontSize:22,shadowColor:"#00bada"}),this.pawSpeed=8,this.canStartLevel=!1,this.isRunning=!0,this.startGameLoop(),this.tweenMenuIn()}initMenuChicks(){this.menuChicks=[];for(let t=0;t<24;t++)this.menuChicks.push({x:Math.random()*(this.canvas.width-100)+50,y:Math.random()*(this.canvas.height-100)+50,scurryTimer:0,scurryDuration:60*Math.random()+30,scurryVelX:0,scurryVelY:0,pauseTimer:0,eyeOffsetX:4*Math.random()-2,eyeOffsetY:4*Math.random()-2,eyeTimer:100*Math.random()})}updateMenuChicks(){"menu"===this.gameState&&this.menuChicks.forEach((t=>{if(t.pauseTimer>0)t.pauseTimer--;else if(t.scurryTimer<=0){const e=Math.random()*Math.PI*2;t.scurryVelX=1*Math.cos(e),t.scurryVelY=1*Math.sin(e),t.scurryTimer=40*Math.random()+20,t.pauseTimer=0}else{const e=t.x+t.scurryVelX,i=t.y+t.scurryVelY;e>=30&&e<=this.canvas.width-30?t.x=e:t.scurryVelX*=-1,i>=30&&i<=this.canvas.height-30?t.y=i:t.scurryVelY*=-1,t.scurryTimer--,t.scurryTimer<=0&&(t.pauseTimer=30*Math.random()+10)}t.eyeTimer+=.05,t.eyeOffsetX=2*Math.sin(t.eyeTimer),t.eyeOffsetY=1.5*Math.cos(.7*t.eyeTimer)}))}drawMenuChicks(){if("menu"!==this.gameState)return;const t=.3*this.cellSize;this.menuChicks.forEach((e=>{this.ctx.fillStyle="#ffdd00",this.ctx.beginPath(),this.ctx.roundRect(e.x+3-t,e.y+3-t,2*t,2*t,.3*t),this.ctx.fill(),this.drawChickEyes(e.x,e.y,21,e,!1),this.drawChickBeak(e.x,e.y,21,!1)}))}tweenMenuIn(){this.mainMenuTitleY=-100,this.startButton.y=this.canvas.height+100,this.howToPlayButton.y=this.canvas.height+100,this.mainMenuHighScoreY=this.canvas.height+100;const t=new Tween(this,"mainMenuTitleY",-100,this.canvas.height/2-160,.8,easeInOut),e=new Tween(this,"mainMenuHighScoreY",this.canvas.height+100,this.canvas.height/2-60,.8,easeInOut),i=new Tween(this.startButton,"y",this.canvas.height+100,this.canvas.height/2,.8,easeInOut),s=new Tween(this.howToPlayButton,"y",this.canvas.height+100,this.canvas.height-200,.8,easeInOut);this.activeTweens.push(t,i,s,e)}tweenMenuOut(t){const e=new Tween(this,"mainMenuTitleY",this.mainMenuTitleY,-100,.5,easeInOut),i=new Tween(this.startButton,"y",this.startButton.y,this.canvas.height+100,.5,easeInOut),s=new Tween(this.howToPlayButton,"y",this.howToPlayButton.y,this.canvas.height+100,.5,easeInOut),h=new Tween(this,"mainMenuHighScoreY",this.mainMenuHighScoreY,this.canvas.height+100,.5,easeInOut,t);this.activeTweens.push(e,i,s,h)}tweenLevelStartIn(t){this.levelStartTitleY=-100,this.clickToStartLevelButton.y=this.canvas.height+100,setTimeout((()=>{const e=new Tween(this,"levelStartTitleY",-100,this.canvas.height/2-40,.8,easeInOut),i=new Tween(this.clickToStartLevelButton,"y",this.canvas.height+100,this.canvas.height/2+20,.8,easeInOut,t);this.activeTweens.push(e,i)}),16)}tweenLevelStartOut(t){const e=new Tween(this,"levelStartTitleY",this.levelStartTitleY,-100,.5,easeInOut),i=new Tween(this.clickToStartLevelButton,"y",this.clickToStartLevelButton.y,this.canvas.height+100,.5,easeInOut,t);this.activeTweens.push(e,i)}tweenTutorialIn(){this.setupTutorialButtons(),this.tutorialTextY=this.canvas.height+100;let t=80;0===this.tutorialStep?t=25:this.tutorialStep===this.tutorialSteps.length-1&&(t=this.canvas.height/2-150);const e=new Tween(this,"tutorialTextY",this.canvas.height+100,t,.8,easeInOut);if(this.activeTweens.push(e),0===this.tutorialStep){this.nextButton.y=this.canvas.height+100;const t=new Tween(this.nextButton,"y",this.canvas.height+100,this.canvas.height-100,.8,easeInOut);this.activeTweens.push(t)}else if(this.tutorialStep===this.tutorialSteps.length-1){this.prevButton.y=this.canvas.height+100,this.playButton.y=this.canvas.height+100;const t=new Tween(this.prevButton,"y",this.canvas.height+100,this.canvas.height-100,.8,easeInOut),e=new Tween(this.playButton,"y",this.canvas.height+100,this.canvas.height-100,.8,easeInOut);this.activeTweens.push(t,e)}else{this.prevButton.y=this.canvas.height+100,this.nextButton.y=this.canvas.height+100;const t=new Tween(this.prevButton,"y",this.canvas.height+100,this.canvas.height-100,.8,easeInOut),e=new Tween(this.nextButton,"y",this.canvas.height+100,this.canvas.height-100,.8,easeInOut);this.activeTweens.push(t,e)}}tweenTutorialOut(t){this.prevButton.y=this.canvas.height+100,this.nextButton.y=this.canvas.height+100,this.playButton.y=this.canvas.height+100;const e=new Tween(this,"tutorialTextY",this.tutorialTextY,-250,.5,easeInOut),i=new Tween(this,"tutorialButtonsY",this.tutorialButtonsY,this.canvas.height+100,.5,easeInOut,t);this.activeTweens.push(e,i)}tweenLevelCompleteIn(){this.levelCompleteTitleY=this.canvas.height+50,this.levelCompleteScoreY=this.canvas.height+80,this.levelCompleteTotalScoreY=this.canvas.height+110,this.levelCompleteClickForNextButton.y=this.canvas.height+140;const t=new Tween(this,"levelCompleteTitleY",this.canvas.height+50,this.canvas.height/2-85,.8,easeInOut),e=new Tween(this,"levelCompleteScoreY",this.canvas.height+80,this.canvas.height/2-37,.8,easeInOut),i=new Tween(this,"levelCompleteTotalScoreY",this.canvas.height+110,this.canvas.height/2+7,.8,easeInOut),s=new Tween(this.levelCompleteClickForNextButton,"y",this.canvas.height+140,this.canvas.height/2+60,.8,easeInOut);this.activeTweens.push(t,e,i,s)}tweenLevelCompleteOut(t){const e=new Tween(this,"levelCompleteTitleY",this.levelCompleteTitleY,-100,.5,easeInOut),i=new Tween(this,"levelCompleteScoreY",this.levelCompleteScoreY,-100,.5,easeInOut),s=new Tween(this,"levelCompleteTotalScoreY",this.levelCompleteTotalScoreY,-100,.5,easeInOut),h=new Tween(this.levelCompleteClickForNextButton,"y",this.levelCompleteClickForNextButton.y,this.canvas.height+100,.5,easeInOut,t);this.activeTweens.push(e,i,s,h)}tweenGameOverIn(){const t=new Tween(this.gameOver,"gameOverFadeAlpha",0,.7,.8,easeInOut),e=new Tween(this.gameOver,"titleY",this.canvas.height+50,this.gameOver.titleTargetY,.8,easeInOut),i=new Tween(this.gameOver,"finalScoreY",this.canvas.height+80,this.gameOver.finalScoreTargetY,.8,easeInOut),s=new Tween(this.playAgainButton,"y",this.gameOver.buttonY,this.gameOver.buttonTargetY,.8,easeInOut);this.activeTweens.push(t,e,i,s)}tweenGameOverOut(t){const e=new Tween(this.gameOver,"titleY",this.gameOver.titleY,-250,.5,easeInOut),i=new Tween(this.gameOver,"finalScoreY",this.gameOver.finalScoreY,-100,.5,easeInOut),s=new Tween(this.playAgainButton,"y",this.playAgainButton.y,this.gameOver.buttonY,.8,easeInOut,t);this.activeTweens.push(e,i,s)}tweenPawsIn(t){this.paws.forEach(((e,i)=>{const s=i===this.paws.length-1;if("right"===e.direction||"left"===e.direction){const i=new Tween(e,"displayX",e.displayX,e.x,1,easeInOut,s?t:null);this.activeTweens.push(i)}else{const i=new Tween(e,"displayY",e.displayY,e.y,1,easeInOut,s?t:null);this.activeTweens.push(i)}}))}loadHighScore(){return parseInt(localStorage.getItem("js13k-2025-black-cat-chickProtectorHighScore")||"0")}saveHighScore(){localStorage.setItem("js13k-2025-black-cat-chickProtectorHighScore",this.highScore.toString())}updateHighScore(){return this.totalScore>this.highScore&&(this.highScore=this.totalScore,this.saveHighScore(),!0)}clearTweens(){this.activeTweens=[]}gameLoop(){if(this.activeTweens=this.activeTweens.filter((t=>(t.update(.016666666666666666),!t.isComplete))),this.isRunning){switch(this.gameState){case"menu":this.updateMenuChicks();break;case"levelStart":case"levelComplete":break;case"playing":this.updateTimer(),this.chicks.forEach(((t,e)=>{if(!t.dead&&e!==this.draggedChick&&!t.playerMoved)if(t.pauseTimer>0)t.pauseTimer--;else if(t.scurryTimer<=0){const e=Math.random()*Math.PI*2;t.scurryVelX=.9*Math.cos(e),t.scurryVelY=.9*Math.sin(e),t.scurryTimer=40*Math.random()+20,t.pauseTimer=0}else{const e=.3*this.cellSize,i=this.gridOffsetX+this.cellSize+e,s=this.gridOffsetX+(this.gridSize-1)*this.cellSize-e,h=this.gridOffsetY+this.cellSize+e,a=this.gridOffsetY+(this.gridSize-1)*this.cellSize-e,n=t.x+t.scurryVelX,o=t.y+t.scurryVelY;n>=i&&n<=s?t.x=n:t.scurryVelX*=-1,o>=h&&o<=a?t.y=o:t.scurryVelY*=-1,t.scurryTimer--,t.scurryTimer<=0&&(t.pauseTimer=30*Math.random()+10)}})),this.timeLeft<=0&&(this.gameState="pawsMoving",this.startPawShooting());break;case"pawsMoving":this.updatePaws(),0===this.paws.length&&this.checkLevelEnd();break;case"scoringAnimation":this.updateScoreAnimations();break;case"gameOver":this.gameOver.flashTime+=1/60,this.gameOver.fadeAlpha<1&&(this.gameOver.fadeAlpha=Math.min(1,this.gameOver.fadeAlpha+.02))}this.render(),requestAnimationFrame((()=>this.gameLoop()))}}checkLevelEnd(){const t=this.chicks.filter((t=>!t.dead));0===t.length?(this.gameState="gameOver",this.gameOver.selectedLine=null,this.gameOver.isNewHighScore=this.updateHighScore(),this.tweenGameOverIn(),this.playGameOverSound()):(this.levelScore=10*t.length,this.totalScore+=this.levelScore,this.createSequentialScoreAnimations(t),this.gameState="scoringAnimation")}createParallelScoreAnimations(t){this.scoreAnimations=t.map(((t,e)=>({x:t.x,y:t.y,phase:"rising",ticksRemaining:20,opacity:1,index:e})))}createSequentialScoreAnimations(t){const e=t.sort(((t,e)=>Math.abs(t.y-e.y)<20?t.x-e.x:t.y-e.y));this.scoreAnimations=e.map(((t,e)=>({x:t.x,y:t.y,phase:"waiting",startDelay:12*e,ticksRemaining:0,opacity:1,index:e})))}startGameLoop(){this.gameLoop()}startLevel(){this.gameState="playing";const t=this.getTimerDuration();this.timeLeft=t,this.gameStartTime=Date.now(),this.pawsMoving=!1,this.startPawSlideIn()}nextLevel(){this.level++,this.resetLevel(),this.gameState="levelStart",this.chicks.forEach((t=>{t.dead||(t.playerMoved=!1)})),this.tweenLevelStartIn((()=>this.canStartLevel=!0))}resetLevel(){this.chicks=this.chicks.filter((t=>!t.dead)),this.generatePaws(),this.pawsMoving=!1}actuallyRestart(){this.level=1,this.gameState="levelStart",this.gameOver.titleX=this.canvas.width/2,this.chicks=this.initializeChicks(),this.generatePaws(),this.pawsMoving=!1,this.gameOver.selectedLine=null}updateTimer(){const t=this.getTimerDuration(),e=(Date.now()-this.gameStartTime)/1e3;this.timeLeft=Math.max(0,t-e)}toggleMute(){this.isMuted=!this.isMuted,this.masterGain.gain.value=this.isMuted?0:1,this.muteButton.text=this.isMuted?"ðŸ”ˆ":"ðŸ”Š",this.muteButton.shadowColor=this.isMuted?"#888":"#00bada"}drawMuteButton(){this.ctx.fillStyle=this.isMuted?"#666":"#000",this.ctx.font="24px Arial",this.ctx.textAlign="center",this.ctx.fillText("â™ª",this.canvas.width-50,30),this.isMuted&&(this.ctx.strokeStyle="#f00",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width-65,15),this.ctx.lineTo(this.canvas.width-35,35),this.ctx.stroke())}playCountdownMusic(){if(this.isMuted||!this.audioContext)return;const t=this.getTimerDuration(),e=8e3*t,i=this.audioContext.createBuffer(2,e,8e3),s=i.getChannelData(0),h=i.getChannelData(1),a=(t,e,i,s,h)=>{const a=t.charCodeAt((h>>i)%s);return 32==a?0:31&h*2**(a/12-e)};for(let i=0;i<e;i++){const e=i*(6/t);s[i]=.1*a("024579",6,11,6,e),h[i]=.1*a("0 2 4 7",5,10,8,e)}this.audioSource=this.audioContext.createBufferSource(),this.audioSource.buffer=i,this.audioSource.connect(this.masterGain),this.audioSource.start()}playCatAttackSound(){if(this.isMuted||!this.audioContext)return;const t=this.audioContext.currentTime,e=1+.33*(this.paws.length-1),i=this.audioContext.createGain();i.gain.setValueAtTime(.001,t),i.gain.exponentialRampToValueAtTime(1*e,t+.012),i.gain.exponentialRampToValueAtTime(.4*e,t+.075),i.gain.exponentialRampToValueAtTime(.8*e,t+.125),i.gain.exponentialRampToValueAtTime(.01,t+.3),i.connect(this.masterGain);for(let e=0;e<3;e++){const s=this.audioContext.createOscillator();s.type="sawtooth",s.frequency.setValueAtTime(80+2*e,t);const h=this.audioContext.createGain();h.gain.setValueAtTime(.3,t),s.connect(h).connect(i),s.start(t),s.stop(t+.3)}const s=.3*this.audioContext.sampleRate,h=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),a=h.getChannelData(0);for(let t=0;t<s;t++)a[t]=2*Math.random()-1;const n=this.audioContext.createBufferSource();n.buffer=h,n.loop=!0;const o=this.audioContext.createBiquadFilter();o.type="bandpass",o.frequency.setValueAtTime(1e3,t),o.Q.value=1;const l=this.audioContext.createGain();l.gain.setValueAtTime(.5,t),l.gain.exponentialRampToValueAtTime(.01,t+.3),n.connect(o).connect(l).connect(i),n.start(t),n.stop(t+.3),[500,1200,2e3].forEach((e=>{const s=this.audioContext.createBiquadFilter();s.type="bandpass",s.frequency.setValueAtTime(e,t),s.Q.value=5,i.connect(s).connect(this.masterGain)}));const c=this.audioContext.createOscillator();c.type="sine",c.frequency.setValueAtTime(25,t);const r=this.audioContext.createGain();r.gain.value=.3,c.connect(r).connect(i.gain),c.start(t),c.stop(t+.3)}getMousePos(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}onMouseDown(t){const{x:e,y:i}=this.getMousePos(t);switch(this.gameState){case"menu":(this.startButton.onMouseDown(e,i)||this.howToPlayButton.onMouseDown(e,i))&&this.playButtonClickSound();break;case"tutorial":(this.nextButton.onMouseDown(e,i)||this.prevButton.onMouseDown(e,i)||this.playButton.onMouseDown(e,i))&&this.playButtonClickSound();break;case"levelStart":this.clickToStartLevelButton.onMouseDown(e,i)&&this.playButtonClickSound(),this.muteButton.onMouseDown(e,i)&&this.playButtonClickSound();break;case"playing":this.timeLeft>0&&this.chicks.forEach(((t,s)=>{const h=.3*this.cellSize,a=Math.sqrt((e-t.x)**2+(i-t.y)**2);!t.dead&&a<=h&&(this.playChickChirpSound(),this.draggedChick=s,this.dragOffset.x=e-t.x,this.dragOffset.y=i-t.y,this.mousePos.x=e,this.mousePos.y=i)})),this.muteButton.onMouseDown(e,i)&&(this.playButtonClickSound(),this.toggleMute());break;case"scoringAnimation":case"pawsMoving":this.muteButton.onMouseDown(e,i)&&(this.playButtonClickSound(),this.toggleMute());break;case"levelComplete":this.levelCompleteClickForNextButton.onMouseDown(e,i)&&this.playButtonClickSound(),this.muteButton.onMouseDown(e,i)&&this.playButtonClickSound();break;case"gameOver":this.playAgainButton.onMouseDown(e,i)&&this.playButtonClickSound()}}onMouseMove(t){const{x:e,y:i}=this.getMousePos(t);if(null!==this.draggedChick){if(this.timeLeft<=0)return this.chicks[this.draggedChick].isDragged=!1,this.chicks[this.draggedChick].x=e,this.chicks[this.draggedChick].y=i,void(this.draggedChick=null);const t=.3*this.cellSize,s=this.gridOffsetX+this.cellSize+t,h=this.gridOffsetX+(this.gridSize-1)*this.cellSize-t,a=this.gridOffsetY+this.cellSize+t,n=this.gridOffsetY+(this.gridSize-1)*this.cellSize-t;return this.mousePos.x=Math.max(s,Math.min(h,e)),void(this.mousePos.y=Math.max(a,Math.min(n,i)))}let s=!1;switch(this.gameState){case"menu":s=this.startButton.onMouseMove(e,i)||this.howToPlayButton.onMouseMove(e,i);break;case"tutorial":s=this.nextButton.onMouseMove(e,i)||this.prevButton.onMouseMove(e,i)||this.playButton.onMouseMove(e,i);break;case"levelStart":s=this.clickToStartLevelButton.onMouseMove(e,i)||this.muteButton.onMouseMove(e,i);break;case"playing":s=this.chicks.some((t=>!t.dead&&Math.sqrt((e-t.x)**2+(i-t.y)**2)<=.3*this.cellSize))||this.muteButton.onMouseMove(e,i);break;case"scoringAnimation":case"pawsMoving":s=this.muteButton.onMouseMove(e,i);break;case"levelComplete":s=this.levelCompleteClickForNextButton.onMouseMove(e,i)||this.muteButton.onMouseMove(e,i);break;case"gameOver":s=this.playAgainButton.onMouseMove(e,i)}this.canvas.style.cursor=s?"pointer":"default"}onMouseUp(t){if(null!==this.draggedChick)return this.chicks[this.draggedChick].x=this.mousePos.x-this.dragOffset.x,this.chicks[this.draggedChick].y=this.mousePos.y-this.dragOffset.y,this.chicks[this.draggedChick].playerMoved=!0,void(this.draggedChick=null);const{x:e,y:i}=this.getMousePos(t);switch(this.gameState){case"menu":this.startButton.onMouseUp(e,i)?this.tweenMenuOut((()=>{this.gameState="levelStart",setTimeout((()=>this.tweenLevelStartIn((()=>this.canStartLevel=!0))),16)})):this.howToPlayButton.onMouseUp(e,i)&&(this.gameState="tutorial",this.tutorialStep=0,this.tweenTutorialIn());break;case"tutorial":0===this.tutorialStep?this.nextButton.onMouseUp(e,i)&&this.tweenTutorialOut((()=>{this.tutorialStep++,setTimeout((()=>this.tweenTutorialIn()),16)})):this.tutorialStep===this.tutorialSteps.length-1?(this.playButton.onMouseUp(e,i)&&this.tweenMenuOut((()=>{this.gameState="levelStart",setTimeout((()=>this.tweenLevelStartIn((()=>this.canStartLevel=!0))),16)})),this.prevButton.onMouseUp(e,i)&&this.tweenTutorialOut((()=>{this.tutorialStep--,setTimeout((()=>this.tweenTutorialIn()),16)}))):(this.nextButton.onMouseUp(e,i)&&this.tweenTutorialOut((()=>{this.tutorialStep++,setTimeout((()=>this.tweenTutorialIn()),16)})),this.prevButton.onMouseUp(e,i)&&this.tweenTutorialOut((()=>{this.tutorialStep--,setTimeout((()=>this.tweenTutorialIn()),16)})));break;case"levelStart":this.muteButton.onMouseUp(e,i)&&this.toggleMute(),this.clickToStartLevelButton.onMouseUp(e,i)&&this.canStartLevel&&(this.tweenLevelStartOut(),setTimeout((()=>this.tweenPawsIn((()=>{this.startLevel(),this.playCountdownMusic()}))),16));break;case"levelComplete":this.muteButton.onMouseUp(e,i)&&this.toggleMute(),this.levelCompleteClickForNextButton.onMouseUp(e,i)&&this.tweenLevelCompleteOut((()=>this.nextLevel()));break;case"gameOver":this.playAgainButton.onMouseUp(e,i)&&this.tweenGameOverOut((()=>{this.actuallyRestart(),this.gameState="levelStart",setTimeout((()=>this.tweenLevelStartIn()),16)}))}}initializeChicks(){const t=[],e=(this.gridSize-2)*this.cellSize/6,i=(this.gridSize-2)*this.cellSize/4;for(let s=0;s<4;s++)for(let h=0;h<6;h++){const a=this.gridOffsetX+this.cellSize+h*e+e/2,n=this.gridOffsetY+this.cellSize+s*i+i/2,o=.3*Math.min(e,i),l=a+(Math.random()-.5)*o,c=n+(Math.random()-.5)*o;t.push({x:l,y:c,scurryTimer:0,scurryDuration:60*Math.random()+30,scurryVelX:0,scurryVelY:0,pauseTimer:0,eyeOffsetX:4*Math.random()-2,eyeOffsetY:4*Math.random()-2,eyeTimer:100*Math.random(),beakOpen:!1})}return t}startPawShooting(){this.pawsMoving=!0,this.paws.forEach((t=>{t.currentX=t.x,t.currentY=t.y})),this.playCatAttackSound(this.audioContext)}playChickDeathSound(){if(this.isMuted||!this.audioContext)return;const t=this.audioContext.currentTime,e=.25,i=this.audioContext.createOscillator(),s=this.audioContext.createOscillator(),h=this.audioContext.createGain();i.type="sawtooth",s.type="square",i.frequency.setValueAtTime(1800,t),i.frequency.exponentialRampToValueAtTime(2400,t+.05),i.frequency.exponentialRampToValueAtTime(900,t+e),s.frequency.setValueAtTime(1200,t),s.frequency.exponentialRampToValueAtTime(1600,t+.05),s.frequency.exponentialRampToValueAtTime(600,t+e),h.gain.setValueAtTime(0,t),h.gain.linearRampToValueAtTime(1.2,t+.01),h.gain.exponentialRampToValueAtTime(.01,t+e),i.connect(h),s.connect(h),h.connect(this.masterGain),i.start(t),s.start(t),i.stop(t+e),s.stop(t+e)}updateScoreAnimations(){this.scoreAnimations=this.scoreAnimations.filter((t=>{if(t.ticksRemaining--,"waiting"===t.phase)t.startDelay>0?t.startDelay--:(t.phase="rising",t.ticksRemaining=12,this.playScoreSound(t.index));else if("rising"===t.phase)t.y-=2,t.ticksRemaining<=0&&(t.phase="fading",t.ticksRemaining=30,t.opacity=1);else if("fading"===t.phase&&(t.opacity=t.ticksRemaining/30,t.ticksRemaining<=0))return!1;return!0})),"scoringAnimation"===this.gameState&&0===this.scoreAnimations.length&&(this.gameState="levelComplete",this.tweenLevelCompleteIn())}playGameOverSound(){if(!this.audioContext||this.isMuted)return;const t=[523.25,493.88,466.16,440,415.3,392],e=this.audioContext.currentTime,i=.3;t.forEach(((s,h)=>{const a=this.audioContext.createOscillator(),n=this.audioContext.createGain(),o=h===t.length-1?.8:i;a.type="sine",a.frequency.setValueAtTime(s,e+h*i),n.gain.setValueAtTime(.15,e+h*i),n.gain.exponentialRampToValueAtTime(.01,e+h*i+o),a.connect(n),n.connect(this.masterGain),a.start(e+h*i),a.stop(e+h*i+o)}))}playScoreSound(t){if(this.isMuted)return;if(!this.audioContext)return;const e=this.audioContext.currentTime,i=523*[1,1.125,1.25,1.33,1.5,1.67,1.875,2][t%8],s=this.audioContext.createOscillator(),h=this.audioContext.createGain();s.type="sine",s.frequency.setValueAtTime(i,e),h.gain.setValueAtTime(.3,e),h.gain.exponentialRampToValueAtTime(.01,e+.15),s.connect(h),h.connect(this.masterGain),s.start(e),s.stop(e+.15)}playChickChirpSound(){if(this.isMuted||!this.audioContext)return;const t=this.audioContext.currentTime,e=.1,i=this.audioContext.createOscillator(),s=this.audioContext.createGain();i.type="sine",i.frequency.setValueAtTime(800,t),i.frequency.exponentialRampToValueAtTime(1200,t+.03),i.frequency.exponentialRampToValueAtTime(600,t+e),s.gain.setValueAtTime(.6,t),s.gain.exponentialRampToValueAtTime(.01,t+e),i.connect(s),s.connect(this.masterGain),i.start(t),i.stop(t+e)}playButtonClickSound(){if(!this.audioContext||this.isMuted)return;const t=this.audioContext.currentTime,e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(293.66,t),i.gain.setValueAtTime(.2,t),i.gain.exponentialRampToValueAtTime(.01,t+.1),e.connect(i),i.connect(this.masterGain),e.start(t),e.stop(t+.1)}generatePaws(){const t=[];for(let e=1;e<this.gridSize-1;e++)t.push({x:0,y:e,direction:"right"},{x:this.gridSize-1,y:e,direction:"left"}),t.push({x:e,y:0,direction:"down"},{x:e,y:this.gridSize-1,direction:"up"});this.paws=[];for(let e=0;e<Math.min(this.level,12)&&t.length>0;e++){const e=Math.floor(Math.random()*t.length),i=t.splice(e,1)[0],s=t.findIndex((t=>0===i.x&&t.x===this.gridSize-1&&t.y===i.y||i.x===this.gridSize-1&&0===t.x&&t.y===i.y||0===i.y&&t.y===this.gridSize-1&&t.x===i.x||i.y===this.gridSize-1&&0===t.y&&t.x===i.x));switch(-1!==s&&t.splice(s,1),i.direction){case"right":i.displayX=-2;break;case"left":i.displayX=this.gridSize+1;break;case"down":i.displayY=-2;break;case"up":i.displayY=this.gridSize+1}i.displayX=void 0!==i.displayX?i.displayX:i.x,i.displayY=void 0!==i.displayY?i.displayY:i.y,this.paws.push(i)}}startPawSlideIn(){this.paws.forEach((t=>{"right"===t.direction||"left"===t.direction?t.displayX=t.x:t.displayY=t.y}))}updatePaws(){const t=this.pawSpeed*(1/60);for(let e=this.paws.length-1;e>=0;e--){const i=this.paws[e];switch(i.direction){case"right":i.currentX+=t;break;case"left":i.currentX-=t;break;case"down":i.currentY+=t;break;case"up":i.currentY-=t}this.chicks.forEach(((t,e)=>{if(t.dead)return;const s=.75*this.cellSize,h=this.gridOffsetX+i.currentX*this.cellSize+(this.cellSize-s)/2,a=this.gridOffsetY+i.currentY*this.cellSize+(this.cellSize-s)/2,n=h+s,o=a+s,l=Math.max(h,Math.min(t.x,n)),c=Math.max(a,Math.min(t.y,o));Math.sqrt((l-t.x)**2+(c-t.y)**2)<=.3*this.cellSize&&(t.dead=!0,this.playChickDeathSound(),this.draggedChick===e&&(this.draggedChick=null))})),(i.currentX<0||i.currentX>=this.gridSize||i.currentY<0||i.currentY>=this.gridSize)&&this.paws.splice(e,1)}}drawTextWithDepth(t,e,i,s="Arial",h,a="#000",n="rgba(0,0,0,0.5)",o=3){this.ctx.font=h+"px "+s,this.ctx.textAlign="center",this.ctx.fillStyle=n,this.ctx.fillText(t,e+o,i+o),this.ctx.fillStyle=a,this.ctx.fillText(t,e,i)}drawText(t,e,i,s,h="#000",a=2){this.ctx.fillStyle=h,this.ctx.font=s+"px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.fillText(t,e+a,i+a),this.ctx.fillStyle=h,this.ctx.fillText(t,e,i)}drawTextWithBackground(t,e,i,s,h="#000",a="rgba(255,255,255,0.8)",n=10){this.ctx.font=s+"px Arial",this.ctx.textAlign="center";const o=this.ctx.measureText(t).width,l=s;this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.roundRect(e-o/2-n,i-l/2-n,o+2*n,l+2*n,8),this.ctx.fill(),this.ctx.fillStyle=h,this.ctx.fillText(t,e,i+s/3)}drawTutorialSpotlight(){this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",0===this.tutorialStep?(this.ctx.fillRect(0,0,this.canvas.width,this.gridOffsetY+this.cellSize),this.ctx.fillRect(0,this.gridOffsetY+(this.gridSize-1)*this.cellSize,this.canvas.width,this.canvas.height-(this.gridOffsetY+(this.gridSize-1)*this.cellSize)),this.ctx.fillRect(0,this.gridOffsetY+this.cellSize,this.gridOffsetX+this.cellSize,(this.gridSize-2)*this.cellSize),this.ctx.fillRect(this.gridOffsetX+(this.gridSize-1)*this.cellSize,this.gridOffsetY+this.cellSize,this.canvas.width-(this.gridOffsetX+(this.gridSize-1)*this.cellSize),(this.gridSize-2)*this.cellSize)):1===this.tutorialStep?this.ctx.fillRect(0,this.uiRowHeight,this.canvas.width,this.canvas.height-this.uiRowHeight):2===this.tutorialStep&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(this.gridOffsetX+this.cellSize,this.gridOffsetY+this.cellSize,(this.gridSize-2)*this.cellSize,(this.gridSize-2)*this.cellSize))}drawTutorialText(t){const e=this.tutorialTextY;t.forEach(((t,i)=>this.drawTextWithDepth(t,300,e+30*i,"Arial",24,"#fff","#ccc",1)))}drawTutorialButtons(){0===this.tutorialStep?this.nextButton.draw(this.ctx):this.tutorialStep===this.tutorialSteps.length-1?(this.prevButton.draw(this.ctx),this.playButton.draw(this.ctx)):(this.prevButton.draw(this.ctx),this.nextButton.draw(this.ctx))}drawTutorialOverlay(){const t=this.tutorialSteps[this.tutorialStep].text.split("\n");this.drawTutorialSpotlight(),this.drawTutorialText(t),this.drawTutorialButtons()}setupTutorialButtons(){0===this.tutorialStep?this.nextButton.x=this.canvas.width-100:this.tutorialStep===this.tutorialSteps.length-1?(this.prevButton.x=100,this.playButton.x=this.canvas.width/2):(this.prevButton.x=100,this.nextButton.x=this.canvas.width-100)}drawGameOverText(){this.ctx.fillStyle="#f00",this.ctx.font="24px Arial",this.ctx.textAlign="center";const t=0===this.tutorialStep?this.canvas.height/2-50:80;let e=void 0!==this.tutorialTextY?this.tutorialTextY:t,i=this.canvas.width/2;0===this.tutorialStep&&(e=25),this.tutorialStep===this.tutorialSteps.length-1&&(i=300,e=this.canvas.height/2-50),lines.forEach(((t,s)=>this.drawTextWithDepth(t,i,e+30*s,24,"white","grey",1)))}drawGameOver(t,e){if(this.drawTextWithDepth("GAME OVER",t,this.gameOver.titleY-60,"Impact",72,"#cc0000","#fff",2),this.drawTextWithDepth(`SCORE: ${this.totalScore.toString().padStart(5,"0")}`,t,this.gameOver.titleY+10,"Impact",32,"#cc0000","#fff",1),this.gameOver.isNewHighScore){this.highScoreFlashTime+=1/60;const e=2,i=Math.floor(this.highScoreFlashTime*e)%2?"#ffff00":"#ff8800";this.drawTextWithDepth("NEW HIGH SCORE!",t,this.gameOver.titleY+45,"Impact",28,i,1)}this.drawTextWithDepth("The Chickpocalypse is inevitable!",this.canvas.width/2,this.gameOver.titleY+120,"Arial",24,"#fff","#ccc",1),this.gameOver.selectedLine||(this.gameOver.selectedLine=this.gameOverTagLines[Math.floor(Math.random()*this.gameOverTagLines.length)]);this.gameOver.selectedLine.split("\n").forEach(((t,e)=>this.drawTextWithDepth(t,this.canvas.width/2,this.gameOver.titleY+164+30*e,"Arial",24,"#fff","#ccc",1))),this.playAgainButton.draw(this.ctx)}drawUI(){const t=this.canvas.width/2,e=this.canvas.height/2;switch(this.gameState){case"menu":this.ctx.fillStyle="yellow",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawMenuChicks(),this.gameTitle.split("\n").forEach(((e,i)=>this.drawTextWithDepth(e,t,this.mainMenuTitleY+60*i,"Arial",60,"#000","#ccc",1))),this.drawText(`HIGH SCORE: ${this.highScore.toString().padStart(5,"0")}`,t,this.mainMenuHighScoreY,24,"#000"),this.startButton.draw(this.ctx),this.howToPlayButton.draw(this.ctx);break;case"tutorial":this.drawTutorialOverlay();break;case"levelStart":this.drawTextWithBackground(`Level ${this.level}`,t,this.levelStartTitleY,32),this.clickToStartLevelButton.draw(this.ctx),this.muteButton.draw(this.ctx);break;case"playing":case"scoringAnimation":case"pawsMoving":this.muteButton.draw(this.ctx);break;case"levelComplete":this.drawTextWithBackground(`Level ${this.level} Complete!`,t,this.levelCompleteTitleY,32,"#000"),this.drawTextWithBackground(`Level Score: ${this.levelScore}`,t,this.levelCompleteScoreY,24),this.drawTextWithBackground(`Total Score: ${this.totalScore}`,t,this.levelCompleteTotalScoreY,24),this.levelCompleteClickForNextButton.draw(this.ctx),this.muteButton.draw(this.ctx);break;case"gameOver":this.ctx.fillStyle=`rgba(0, 0, 0, ${this.gameOver.fadeAlpha})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawGameOver(t,e)}}drawWorld(){this.ctx.fillStyle="#654321",this.ctx.fillRect(this.gridOffsetX+this.cellSize,this.gridOffsetY+this.cellSize,(this.gridSize-2)*this.cellSize,(this.gridSize-2)*this.cellSize),this.ctx.fillStyle="#228B22",this.ctx.beginPath(),this.ctx.lineWidth=6,this.ctx.roundRect(this.gridOffsetX+this.cellSize,this.gridOffsetY+this.cellSize,(this.gridSize-2)*this.cellSize,(this.gridSize-2)*this.cellSize,.1*this.cellSize),this.ctx.fill(),this.ctx.fillStyle="#654321";for(let t=0;t<this.gridSize;t++)this.ctx.fillRect(this.gridOffsetX+t*this.cellSize,this.gridOffsetY,this.cellSize,this.cellSize),this.ctx.fillRect(this.gridOffsetX+t*this.cellSize,this.gridOffsetY+(this.gridSize-1)*this.cellSize,this.cellSize,this.cellSize);for(let t=1;t<this.gridSize-1;t++)this.ctx.fillRect(this.gridOffsetX,this.gridOffsetY+t*this.cellSize,this.cellSize,this.cellSize),this.ctx.fillRect(this.gridOffsetX+(this.gridSize-1)*this.cellSize,this.gridOffsetY+t*this.cellSize,this.cellSize,this.cellSize)}drawTreeBorders(){const t=["#228B22","#32CD32","#006400"],e=.8*this.cellSize;for(let i=0;i<4;i++){let s=0;for(;s<this.gridSize*this.cellSize;){const h=.3+7*s%50/100*.4;let a,n;0===i?(a=this.gridOffsetX+s-.5*e,n=this.gridOffsetY-.6*e):1===i?(a=this.gridOffsetX+this.gridSize*this.cellSize+.6*e,n=this.gridOffsetY+s-.5*e):2===i?(a=this.gridOffsetX+this.gridSize*this.cellSize-s+.5*e,n=this.gridOffsetY+this.gridSize*this.cellSize+.6*e):(a=this.gridOffsetX-.6*e,n=this.gridOffsetY+this.gridSize*this.cellSize-s+.5*e),this.ctx.fillStyle=t[(Math.floor(s/20)+i)%t.length],this.ctx.beginPath(),this.ctx.arc(a,n,e,0,2*Math.PI),this.ctx.fill(),s+=e*(2-h)}}}drawTreeCluster(t,e){const i=["#228B22","#32CD32","#006400"];for(let s=0;s<4;s++){const s=(Math.random()-.5)*this.cellSize*.6,h=(Math.random()-.5)*this.cellSize*.6,a=.2*this.cellSize+Math.random()*this.cellSize*.15;this.ctx.fillStyle=i[Math.floor(Math.random()*i.length)],this.ctx.beginPath(),this.ctx.arc(t+s,e+h,a,0,2*Math.PI),this.ctx.fill()}}getTimerDuration(){return this.level<=4?6:this.level<=8?5:4}drawTimer(){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.uiRowHeight),this.ctx.beginPath(),this.ctx.strokeStyle="#000",this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,this.canvas.width,this.uiRowHeight),this.ctx.stroke(),this.ctx.font="24px Arial",this.ctx.textAlign="center";const t=Math.ceil(this.timeLeft).toString().padStart(2,"0");this.drawTextWithDepth(t,this.canvas.width/2,this.uiRowHeight/2+8,"Impact",32,"black","grey",2)}drawCatHead(t,e,i,s){const h=i/2,a=i,n=.7*i;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.beginPath(),this.ctx.moveTo(t-a/2+3,e-h+3),this.ctx.lineTo(t+a/2+3,e-h+3),this.ctx.lineTo(t+n/2+3,e+h+3),this.ctx.lineTo(t-n/2+3,e+h+3),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=s.color||"#000",this.ctx.beginPath(),this.ctx.moveTo(t-a/2,e-h),this.ctx.lineTo(t+a/2,e-h),this.ctx.lineTo(t+n/2,e+h),this.ctx.lineTo(t-n/2,e+h),this.ctx.closePath(),this.ctx.fill()}drawSquareCatHead(t,e,i,s,h){this.setupCatTransform(t,e,i),this.drawCatShadow(),this.drawCatBody(h),this.drawCatEyes(h,s),this.drawCatMouth(s),this.ctx.restore()}setupCatTransform(t,e,i){this.ctx.save(),this.ctx.translate(t+35,e+35),"right"===i?this.ctx.rotate(-Math.PI/2):"left"===i?this.ctx.rotate(Math.PI/2):"up"===i&&this.ctx.rotate(Math.PI)}drawCatShadow(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(-18,-18,42,42),this.ctx.beginPath(),this.ctx.moveTo(-18,-18),this.ctx.lineTo(-7,-18),this.ctx.lineTo(-12,-26),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(7,-18),this.ctx.lineTo(21,-18),this.ctx.lineTo(15,-26),this.ctx.closePath(),this.ctx.fill()}drawCatBody(t){this.ctx.fillStyle=t.color||"#000",this.ctx.fillRect(-21,-21,42,42),this.ctx.beginPath(),this.ctx.moveTo(-21,-21),this.ctx.lineTo(-8,-21),this.ctx.lineTo(-15,-29),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(8,-21),this.ctx.lineTo(21,-21),this.ctx.lineTo(15,-29),this.ctx.closePath(),this.ctx.fill()}drawCatEyes(t,e){const i=this.timeLeft||0;let s=i>0&&i<=2;t.color;this.ctx.fillStyle="#fff600",this.ctx.fillRect(-6,-11,10,15),this.ctx.fillRect(6,-11,10,15),e&&(s=!0),s&&(this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.moveTo(-6,-11),this.ctx.lineTo(4,-11),this.ctx.lineTo(4,4),this.ctx.fill(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.moveTo(16,-11),this.ctx.lineTo(6,-11),this.ctx.lineTo(6,4),this.ctx.closePath(),this.ctx.fill())}drawCatMouth(t){const e=this.timeLeft||0;let i=e>0&&e<=2?Math.min(1,(2-e)/2):0,s=0;t?(i=2,s=2*Math.sin(.02*Date.now())):(this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(-3,10,7,10)),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(4,12+s),this.ctx.lineTo(-5,12+s),this.ctx.lineTo(0,20+s),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(19,12+s),this.ctx.lineTo(10,12+s),this.ctx.lineTo(14,20+s),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillRect(0,12+s,14,4),t&&(this.ctx.fillStyle="#fff",this.ctx.fillRect(2,18-s,10,2)),this.ctx.fillStyle=`rgba(0, 0, 0, ${1-i})`,this.ctx.fillRect(-5,10,25,12)}drawPaws(){this.paws.forEach((t=>{const e=this.pawsMoving?t.currentX:t.displayX,i=this.pawsMoving?t.currentY:t.displayY;this.drawSquareCatHead(this.gridOffsetX+e*this.cellSize,this.gridOffsetY+i*this.cellSize,t.direction,this.pawsMoving,t)}))}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#654321",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawWorld(),this.drawChicks(),this.drawPaws(),this.drawTreeBorders(),"scoringAnimation"===this.gameState&&(this.ctx.fillStyle="#000",this.ctx.font="20px Arial",this.ctx.textAlign="center",this.scoreAnimations.forEach((t=>{this.ctx.globalAlpha=t.opacity,this.drawTextWithDepth("+10",t.x,t.y,"Impact",24,"#000","#fff",1)})),this.ctx.globalAlpha=1),this.drawTimer(),this.drawUI()}drawChicks(){const t=.3*this.cellSize;this.chicks.forEach(((e,i)=>{const s=i===this.draggedChick,h=s?this.mousePos.x-this.dragOffset.x:e.x,a=s?this.mousePos.y-this.dragOffset.y:e.y;s&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.beginPath(),this.ctx.roundRect(h+3-t,a+3-t,2*t,2*t,.3*t),this.ctx.fill()),this.ctx.fillStyle=e.dead?"rgba(157, 160, 12, 1)":s?"#ffee44":"#ffdd00",this.ctx.beginPath(),this.ctx.roundRect(h-t,a-t,2*t,2*t,.3*t),this.ctx.fill(),e.dead?this.drawDeadChickFeatures(h,a,t):(s||(e.eyeTimer+=.05,e.eyeOffsetX=2*Math.sin(e.eyeTimer),e.eyeOffsetY=1.5*Math.cos(.7*e.eyeTimer)),this.drawChickEyes(h,a,t,e,s),this.drawChickBeak(h,a,t,s))}))}drawDeadChickFeatures(t,e,i){const s=.2*i,h=.4*i;this.ctx.strokeStyle="#000",this.ctx.lineWidth=3,this.ctx.beginPath(),[-1,1].forEach((a=>{const n=t+a*h,o=e-.2*i;this.ctx.moveTo(n-s,o-s),this.ctx.lineTo(n+s,o+s),this.ctx.moveTo(n+s,o-s),this.ctx.lineTo(n-s,o+s)})),this.ctx.stroke(),this.drawChickBeak(t,e,i)}drawDeadChickBeak(t,e,i){const s=.5*i,h=e+.5*i,a=.15*i,n=.1*i;this.ctx.fillStyle="#cc5500",this.ctx.beginPath(),this.ctx.moveTo(t+a,h-s+n),this.ctx.lineTo(t-s+a,h+n),this.ctx.lineTo(t+s+a,h+n),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#994400";const o=.6*s;this.ctx.beginPath(),this.ctx.moveTo(t-o+a,h+n),this.ctx.lineTo(t+o+a,h+n),this.ctx.lineTo(t+a,h+o+n),this.ctx.closePath(),this.ctx.fill()}drawChickEyes(t,e,i,s,h){const a=.6*i,n=1*i,o=.4*i;this.ctx.fillStyle="#fff",[-1,1].forEach((s=>{this.ctx.beginPath(),this.ctx.roundRect(t+s*o-a/2,e-.2*i-n/2,a,n,.2*a),this.ctx.fill()}));const l=h?.6*a:.4*a,c=h?0:s.eyeOffsetX,r=h?0:s.eyeOffsetY;this.ctx.fillStyle="#000",[-1,1].forEach((s=>{this.ctx.beginPath(),this.ctx.roundRect(t+s*o-l/2+c,e-.2*i-l/2+r,l,l,.2*l),this.ctx.fill()}))}drawChickBeak(t,e,i,s){const h=.5*i,a=e+.5*i,n=s?1:0;if(s&&n>0){this.ctx.fillStyle="#333";const e=.7*h;this.ctx.fillRect(t-e/2,a-e/2,e,e)}this.ctx.fillStyle="#ffa500",this.ctx.beginPath(),this.ctx.moveTo(t,a-h-n),this.ctx.lineTo(t-h,a-n),this.ctx.lineTo(t+h,a-n),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#cc7700";const o=.6*h;this.ctx.beginPath(),this.ctx.moveTo(t-o,a+n),this.ctx.lineTo(t+o,a+n),this.ctx.lineTo(t,a+o+n),this.ctx.closePath(),this.ctx.fill()}}