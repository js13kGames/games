<!doctype html><title>Cat Fight - js13kGames 2025</title><style>css,html{touch-action:none}*{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;font-size:32px}body,html{height:100%;background:#000}body{margin:0;overflow:hidden}#scrDiv{margin:0 auto;text-align:center}canvas{transform-origin:top left;display:block}#ctrl{position:absolute;bottom:100px;transform-origin:top left;width:100%}#ctrl input{font-size:64px}#debug{position:absolute;bottom:0}#attack{display:block;position:absolute;right:0;top:0}</style><div id=scrDiv><canvas id=scr></canvas></div><div id=ctrl><input type=button id=lu value=↖><input type=button id=u value=↑><input type=button id=ru value=↗><br><input type=button id=l value=←>　<input type=button id=r value=→><br><input type=button id=ld value=↙><input type=button id=d value=↓><input type=button id=rd value=↘><br><input type=button id=attack value=attack></div><div id=debug style=font-size:16px;height:100px;width:256px;word-break:break-all></div><script>function t(t){let e=t[0],s=parseInt(t[1],16),h=0,i=0,n=0;return 0==s?n=30*e+40:s<13?(h=28*s+225,i=55,n=25*e+25):n=30*(e-2)+30,"lch("+n+" "+i+"% "+h+")"}function e(t){return t.split(",").map((t,e)=>parseInt(t,36).toString(2).padStart(16,0).match(/../g).map(t=>parseInt(t,2)))}class s{#t={};#e;#s;#h;#i;#n;#r;#l;#a;constructor(t,e,s,h,i,n,r=0,l=0){this.#e=t,this.#s=e,this.#h=s,this.#i=h,this.#n=i,this.#r=n,this.#l=r,this.#a=l}get x(){return this.#h}get y(){return this.#i}get c(){return this.#n}get r(){return this.#r}set x(t){this.#h=t}set y(t){this.#i=t}set h(t){this.#l=t,Object.values(this.#t).forEach(t=>{t.ptn.map(t=>t.reverse()),t.c=this.#n-1-t.c})}set v(t){this.#a=t,Object.values(this.#t).forEach(t=>{t.ptn.reverse(),t.r=this.#r-1-t.r})}set(t,s,h,i,n,r=0,l=0){let a=this.#e[s].match(/.{2}/g),o=e(this.#s[h]);this.#l^r&&o.map(t=>t.reverse()),this.#a^l&&o.reverse(),this.#l&&(i=this.#n-1-i),this.#a&&(n=this.#r-1-n),this.#t[t]={plt:a,ptn:o,c:i,r:n}}batchSet(t){try{t.forEach(t=>this.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6]))}catch(t){console.log(t)}}dlt(t){t?delete this.#t[t]:this.#t={}}get(){let t=[];return Object.values(this.#t).forEach(e=>{t.push({plt:e.plt,ptn:e.ptn,x:this.#h+8*e.c,y:this.#i+8*e.r})}),t}}class h{#o;#x;#e;#s;#p;#u;#c;#m;#g;#d;#y;#h;#i;#w;#l;#b;#k;#f;#R=0;#L=16;constructor(t,e,s,h,i,n=0,r=0){this.#o=t,this.#e=e,this.#s=s,this.#h=h,this.#i=i,this.z=n,this.#b=r}get name(){return this.#o}get x(){return this.#h}get y(){return this.#i}get w(){return this.#w}get h(){return this.#l}get ax(){return this.#u.x}get aw(){return 8*this.#u.c-7}get way(){return this.#b}get attackCnt(){return this.#R++}get energyVal(){return this.#L}setChrs(t){this.#x=t}setBody(t,e,h,i,n,r,l){this.#g=t,this.#p=new s(this.#e,this.#s,this.#h+e,this.#i+h,i,n,r,l),this.#w=8*i,this.#l=8*n}setAttack(t,e,h,i,n,r,l){this.#d=t,this.#u=new s(this.#e,this.#s,this.#h+e,this.#i+h,i,n,r,l)}setEnergy(t,e,h,i,n,r,l){this.#y=t,this.#c=new s(this.#e,this.#s,this.#h+e,this.#i+h,i,n,r,l),this.#c.batchSet(this.#y[this.#L])}damage(t,e,s){if(this.#L<=0)return this.#L=0,!0;if(this.#L=this.#L-t<0?0:this.#L-t,this.#c.batchSet(this.#y[this.#L]),0==this.#L)return s("lose"),console.log("lose",this.#o,this.#L),void setTimeout(()=>this.#c.dlt(),1500);let h=0;this.animate(e,250);let i=setInterval(()=>{let e=2*this.way-1+0;this.collision(e,0)||this.move(e,0,this.z),this.drop()&&(clearInterval(i),s("drop")),h++,h>4*t&&clearInterval(i)},10)}animate(t,e){clearInterval(this.#k);let s=0;this.#p.batchSet(this.#g[t[0]]),this.#k=setInterval(()=>{s=t.length-1>s?s+1:0,this.#p.batchSet(this.#g[t[s]])},e)}attack(t,e){let s=0;this.#u.batchSet(this.#d[t[0]]),this.#f=setInterval(()=>{s<t.length-1?(s++,this.#u.batchSet(this.#d[t[s]])):(clearInterval(this.#f),this.#u.dlt())},e)}turn(){this.#b^=1,this.#p.h=this.#b,this.#u.h=this.#b,this.#u.x=this.#b?this.#h-this.#w:this.#h+this.#w}collision(t,e,s=0){let h,[i,n,r,l]=s?[this.ax+t,this.y+e,this.aw,this.h]:[this.x+t,this.y+e,this.w,this.h];return this.#x.forEach(t=>{this.name==t.name||this.z||t.z||i+r>t.x&&i<t.x+t.w&&n+l>t.y+t.h-4&&n+l<t.y+t.h+4&&(h=t)}),h}walk(t,e,s,h=25){let i=0,n=0,r=0;"n"==t&&(n=-1),"e"==t&&(i=1),"s"==t&&(n=1),"w"==t&&(i=-1);let l=setInterval(()=>{(0==this.#b&&"w"==t||1==this.#b&&"e"==t)&&this.turn(),this.collision(i,n)||(this.move(i,n,this.z),this.drop()&&(clearInterval(l),s("drop"))),r++,e<=r&&(clearInterval(l),s("stop"))},h)}move(t,e,s=0){this.#h+=t,this.#i+=e,this.z=s,this.#p.x+=t,this.#p.y+=e,void 0!==this.#u&&(this.#u.x+=t,this.#u.y+=e),this.#c.x+=t,this.#c.y+=e}drop(){let t=Math.floor((this.#i-64)/3),e=this.#h<24-t||this.#h>216+t||this.#i<65?1:0,s=this.#i>160?1:0;if(e||s){this.z=e;let t=setInterval(()=>{this.move(0,1,e),this.#i>256&&(clearInterval(t),this.#x.delete(this.name))},5);return!0}}get(){let t=this.#p.get(),e=this.#c?this.#c.get():[],s=this.#u?this.#u.get():[];return t.concat(e,s)}}let i="0d170720112c360a1a36170d".match(/.{6}/g),n=new class{#e;#s;#q=[...Array(16)].map(()=>Array(15));#x=[];constructor(t,e){this.#e=t,this.#s=e}set(t){t.forEach(t=>{this.#q[t[6]][t[5]]={pltId:t[0],ptnId:[t[1],t[2],t[3],t[4]]}}),this.#x=this.#v()}#v(){let t=[];return this.#q.forEach((s,h)=>{s.forEach((s,i)=>{s&&s.ptnId.forEach((n,r)=>{t.push({plt:this.#e[s.pltId].match(/.{2}/g),ptn:e(this.#s[n]),x:16*i+r%2*8,y:16*h+8*Math.floor(r/2)})})})}),t}get(){return this.#x}}(i,["0","1,1,1,6,6,6,q,q","q,2y,2y,2y,bu,bu,bu,1be","1be,1be,59m,59m,59m,l2i,l2i,l2i","1be,1be,59m,59m,59m,l2i,l2i,gut","cn4,cn4,cn4,sg0,sg0,sg0,we8,we8","we8,xds,xds,xds,xmo,xmo,xmo,xow","xow,xow,xpg,xpg,xpg,xpl,xpl,xpl","xow,xow,xpg,xpg,xpg,xpl,xpl,gut","gut,xpm,xpm,xpm,xpm,xpm,xpm,xpm","xpm,xpm,xpm,xpm,xpm,xpm,xpm,gut","xpm,xpm,xpm,xpm,xpm,xpm,xpm,xpm","pa7,pa7,pa7,pa7,pa7,pa7,pa7,gut","1ekf,1ekf,1ekf,1ekf,1ekf,1ekf,1ekf,gut","1ekd,1ekd,1ekd,1ekd,1ekd,1ekd,1ekd,gut","gut,gut,gut,pa7,pa7,pa7,pa7,pa7","gut,gut,gut,1ekf,1ekf,1ekf,1ekf,1ekf","gut,gut,gut,1ekd,1ekd,1ekd,1ekd,1ekd","pa7,pa7,pa7,pa7,pa7,pa7,pa7,pa7","1ekf,1ekf,1ekf,1ekf,1ekf,1ekf,1ekf,1ekf","1ekd,1ekd,1ekd,1ekd,1ekd,1ekd,1ekd,1ekd","xgq,wnu,ti2,thy,thy,gut,gut,gut","xnp,xg5,xg5,wnp,wnp,wnp,thx,thx","l2i,hwq,hpm,gx6,gx6,gve,guy,guu","gut,hud,k2d,gut,gut,gut,gut,gut","h45,hnd,k0m,thx,thx,gx1,gux,gut","gut,gut,gut,gut,gut,gut,gut,gut","gut,gut,gut,gut,xpm,qyw,6qq,qyw","6cg,ea,6cg,ea,0,6cg,0,ea","xpm,xpm,xpm,xpm,1ekf,1ekf,1ekf,1ekf"]),r=[[0,0,1,0,2,1,6],[0,0,3,1,11,1,7],[0,2,11,3,11,1,8],[0,0,1,0,2,0,9],[0,0,3,1,11,0,10],[0,2,11,4,10,0,11],[0,12,13,0,15,0,12],[0,0,18,0,18,0,13],[0,0,18,0,18,0,14],[0,5,0,6,0,14,6],[0,7,0,11,5,14,7],[0,11,6,11,7,14,8],[0,5,0,6,0,15,9],[0,7,0,11,5,15,10],[0,11,6,10,8,15,11],[0,13,14,17,0,15,12],[0,20,0,20,0,15,13],[0,20,0,20,0,15,14],[1,11,11,11,11,0,0],[1,11,21,22,24,1,0],[1,21,11,25,23,2,0],[1,11,22,22,24,0,1],[1,25,26,24,25,1,1],[1,24,24,26,24,2,1],[1,23,11,25,24,3,1],[1,22,23,25,24,4,1],[1,11,11,23,11,5,1]];for(let t=0;t<15;t++)for(let e=0;e<16;e++)0==t&&e>2&&r.push([1,11,11,11,11,e,t]),1==t&&e>5&&r.push([1,11,11,11,11,e,t]),2==t&&r.push([1,29,29,19,19,e,t]),3==t&&r.push([1,19,19,19,19,e,t]),4==t&&r.push([2,27,27,28,28,e,t]),6==t&&e>1&&e<14&&r.push([0,9,9,11,11,e,t]),t>6&&t<9&&e>1&&e<14&&r.push([0,11,11,11,11,e,t]),t>8&&t<11&&e>0&&e<15&&r.push([0,11,11,11,11,e,t]),11==t&&e>0&&e<15&&r.push([0,11,11,10,10,e,t]),12==t&&e>0&&e<15&&r.push([0,13,13,16,16,e,t]),t>12&&e>0&&e<15&&r.push([0,19,19,19,19,e,t]);n.set(r);let l="0d2d360d2036163a15".match(/.{6}/g),a=["0","3y8,4zk,61h,696,696,622,59m,59m","k,9w,h4k,xpw,xpw,xpg,xpg,xpg","59p,1bh,1be,9m,1ba,59l,l2h,kva","xus,xus,10uo,1b28,xds,h1c,xow,xpg","l0a,l2i,59m,1be,1be,1be,1be,1be","xpg,xnt,xih,wx5,wx5,xic,xn4,xmo","59m,59m,596,59h,l1s,l1x,l1x,47p","xmo,xow,uj4,l2c,59g,h49,h49,gus","0,3y8,4zk,61h,696,696,622,59m","0,k,9w,h4k,xpw,xpw,xpg,xpg","59m,59p,1bh,1be,bu,9m,1b9,59l","xpg,xus,xus,10uo,1b28,xfk,h3k,xpg","l2h,kva,l0a,59m,1be,1be,1be,1be","xpg,xpg,xnt,xih,wx5,wx5,xic,xn4","1be,1be,1ba,1b9,59g,59h,hwl,47p","xmo,xmo,kzk,kzk,kzk,l1s,l1w,guo","xus,xus,10uo,1b28,xds,h1x,xpm,xpm","xpm,xn9,xmo,xmo,xmo,xmo,xmo,xmo","0,0,0,0,0,gus,xpl,xih","gx5,2c,0,0,0,0,0,0","0,0,cu8,45c,8w,9g,28,1s","6az,5wr,6az,1at,b9,9m,1b9,59l","1dic,o10,1cpc,uj4,ugw,wn4,hw0,xpg","0,0,0,xpm,xpm,0,0,0","0,0,0,xpn,xpn,0,0,0","0,0,0,xpr,xpr,0,0,0","0,0,0,xq7,xq7,0,0,0","0,0,0,xrz,xrz,0,0,0","0,0,0,xz3,xz3,0,0,0","0,0,0,yrj,yrj,0,0,0","0,0,0,11xb,11xb,0,0,0","0,0,0,1ekf,1ekf,0,0,0","0,8w,b8,dl,e2,e2,dm,bu","0,5,p,gvd,xpl,xpl,xpl,xpl","bu,bu,2y,2y,q,2d,2y,bu","xpl,1779,1779,xwp,yjo,gut,xpm,xpm","bu,bu,bu,1be,1be,1be,1be,1be","xpm,xg5,wvd,xnt,xn8,xmo,xmo,xmo","xow,xpg,ujt,h49,59g,hwk,h45,gus","59p,1bh,1be,bu,2d,2y,bu,bu","xus,xus,10uo,1b28,kqo,tfk,xg0,wx0","be,be,bq,bq,bt,bu,2y,47u","ujo,xpg,xow,xg4,h44,xpg,uj4,ujo","l2d,47k,0,0,0,2d,47p,1","hwk,hwk,k0g,kzk,kzk,l1s,l1w,guo","59m,59p,1bh,192,bt,bu,1be,1bd","xpg,xus,xus,10uo,gu8,xn9,xnu,xp6","59i,59i,l22,l22,l0a,45i,p,489","xp1,xne,wq2,xpm,xpm,xpl,xp0,ksw","l1s,l1s,l1s,l1s,hu8,l1s,m1g,guo","0,0,0,0,0,9g,h4p,l4d","xrt,xn8,wlc,sg0,cn4,0,0,0","1,1,1,1,6,q,2y,gx6","fsw,zk0,11c1,ym9,xox,xph,xph,xih","0,glc,1atc,10jk,xds,xds,xds,xds","l2i,p0q,696,1ih,bu,2y,m,11x","wo9,xih,luh,huu,kva,wwq,xgq,h4a","xds,xds,xds,xds,xds,xmo,xow,xpg","622,5gq,622,11x,0,0,0,0","xpm,xpm,xpm,gve,q,6,1,0","xpl,xpm,xpm,xpm,xpm,xpm,xpm,l2h","2c,gz1,xpl,xq5,xq5,wno,fsw,cn4","59i,59h,58w,58w,o7k,lao,ogg,474","sg0,we8,kr8,57t,1bd,9g,0,0","45c,kzk,l1x,l22,huy,k2y,kve,l0q","l0p,l0m,l0q,57e,592,59h,59m,59m","xic,k84,10uo,1b28,xds,h1c,xow,xpg","59m,59m,59m,1be,1be,1be,1be,1be"],o=[[["hL",0,1,0,0],["hR",0,2,1,0],["fL",0,3,0,1],["fR",0,4,1,1],["bL",0,5,0,2],["bR",0,6,1,2],["lL",0,7,0,3],["lR",0,8,1,3]],[["hL",0,9,0,0],["hR",0,10,1,0],["fL",0,11,0,1],["fR",0,12,1,1],["bL",0,13,0,2],["bR",0,14,1,2],["lL",0,7,0,3],["lR",0,8,1,3]],[["hL",0,9,0,0],["hR",0,10,1,0],["fL",0,11,0,1],["fR",0,12,1,1],["bL",0,13,0,2],["bR",0,14,1,2],["lL",0,15,0,3],["lR",0,16,1,3]],[["hL",0,1,0,0],["hR",0,2,1,0],["fL",0,3,0,1],["fR",0,17,1,1],["bL",0,5,0,2],["bR",0,18,1,2],["lL",0,7,0,3],["lR",0,8,1,3]],[["hL",0,10,0,0,1],["hR",0,9,1,0,1],["fL",0,22,0,1],["fR",0,23,1,1],["bL",0,13,0,2],["bR",0,14,1,2],["lL",0,7,0,3],["lR",0,8,1,3]],[["hL",0,33,0,0],["hR",0,34,1,0],["fL",0,35,0,1],["fR",0,36,1,1],["bL",0,37,0,2],["bR",0,38,1,2],["lL",0,7,0,3],["lR",0,39,1,3]],[["hL",0,1,0,0],["hR",0,2,1,0],["fL",0,40,0,1],["fR",0,41,1,1],["bL",0,42,0,2],["bR",0,43,1,2],["lL",0,44,0,3],["lR",0,45,1,3]],[["hL",0,9,0,0],["hR",0,10,1,0],["fL",0,46,0,1],["fR",0,47,1,1],["bL",0,48,0,2],["bR",0,49,1,2],["lL",0,44,0,3],["lR",0,50,1,3]],[["hL",0,0,0,0],["hR",0,0,0,0],["fL",0,56,-1,1],["fR",0,54,0,0],["bL",0,60,0,2],["bR",0,58,1,1],["lL",0,63,1,3],["lR",0,62,2,2],["hM",0,53,-1,0],["aL",0,59,-1,2],["aR",0,55,1,0],["fM",0,57,0,1],["bM",0,61,1,2],["tM",0,64,2,3]],[["hL",0,0,0,0],["hR",0,0,0,0],["fL",0,0,-1,1],["fR",0,0,0,0],["bL",0,0,0,2],["bR",0,0,1,1],["lL",0,0,1,3],["lR",0,0,2,2],["hM",0,0,-1,0],["aL",0,0,-1,2],["aR",0,0,1,0],["fM",0,0,0,1],["bM",0,0,1,2],["tM",0,0,2,3]],[["hL",0,65,0,0],["hR",0,2,1,0],["fL",0,66,0,1],["fR",0,67,1,1],["bL",0,68,0,2],["bR",0,6,1,2],["lL",0,7,0,3],["lR",0,8,1,3]]],x=[[["p1TL",0,0,0,0],["p1TR",0,0,1,0],["p1BL",0,0,0,1],["p1BR",0,0,1,1]],[["p1TL",0,19,0,0],["p1TR",0,0,1,0],["p1BL",0,20,0,1],["p1BR",0,0,1,1]],[["p1TL",0,19,0,0],["p1TR",2,21,1,0],["p1BL",0,20,0,1],["p1BR",2,21,1,1,0,1]],[["p1TL",0,51,0,0],["p1TR",2,21,1,0],["p1BL",0,52,0,1],["p1BR",2,21,1,1,0,1]]],p=[[["l",2,32,0,0],["r",2,32,1,0]],[["l",2,31,0,0],["r",2,32,1,0]],[["l",2,30,0,0],["r",2,32,1,0]],[["l",2,29,0,0],["r",2,32,1,0]],[["l",2,28,0,0],["r",2,32,1,0]],[["l",2,27,0,0],["r",2,32,1,0]],[["l",2,26,0,0],["r",2,32,1,0]],[["l",2,25,0,0],["r",2,32,1,0]],[["l",2,24,0,0],["r",2,32,1,0]],[["l",2,24,0,0],["r",2,31,1,0]],[["l",2,24,0,0],["r",2,30,1,0]],[["l",2,24,0,0],["r",2,29,1,0]],[["l",2,24,0,0],["r",2,28,1,0]],[["l",2,24,0,0],["r",2,27,1,0]],[["l",2,24,0,0],["r",2,26,1,0]],[["l",2,24,0,0],["r",2,25,1,0]],[["l",2,24,0,0],["r",2,24,1,0]]],u=o.map(t=>t.map(t=>[t[0],1,t[2],t[3],t[4],t[5],t[6]])),c=x.map(t=>t.map(t=>[t[0],t[1]/2+1,t[2],t[3],t[4],t[5],t[6]])),m=new h("ally1",l,a,40,80);m.setBody(o,0,0,2,4),m.setAttack(x,16,8,2,2),m.setEnergy(p,0,-8,2,1);let g=new h("pc",l,a,28,116);g.setBody(o,0,0,2,4),g.setAttack(x,16,8,2,2),g.setEnergy(p,0,-8,2,1);let d=new h("ally2",l,a,16,152);d.setBody(o,0,0,2,4),d.setAttack(x,16,8,2,2),d.setEnergy(p,0,-8,2,1);let y=new h("enemy1",l,a,200,80);y.setBody(u,0,0,2,4),y.setAttack(c,16,8,2,2),y.setEnergy(p,0,-8,2,1),y.turn();let w=new h("enemy2",l,a,212,116);w.setBody(u,0,0,2,4),w.setAttack(c,16,8,2,2),w.setEnergy(p,0,-8,2,1),w.turn();let b=new h("enemy3",l,a,224,152);b.setBody(u,0,0,2,4),b.setAttack(c,16,8,2,2),b.setEnergy(p,0,-8,2,1),b.turn();let k=new Map;k.set("enemy3",b),k.set("enemy2",w),k.set("enemy1",y),k.set("ally2",d),k.set("pc",g),k.set("ally1",m),b.setChrs(k),w.setChrs(k),y.setChrs(k),d.setChrs(k),g.setChrs(k),m.setChrs(k);let f=new class{#S;#z;#E;#I;#M;#x=[];constructor(t,e,s=2){this.#I=t,this.#M=e,this.#I.width=256*s,this.#I.height=240*s,this.#S=this.#I.getContext("2d"),this.#S.imageSmoothingEnabled=!1,this.#S.scale(s,s)}setBg(t){this.#z=new OffscreenCanvas(this.#I.width,this.#I.height),this.#E=this.#z.getContext("2d"),t.get().forEach(t=>this.#C(this.#E,t))}setBgColor(t){this.#M=t}setChr(t){this.#x.push(t)}#C(e,s){s.ptn.forEach((h,i)=>{h.forEach((h,n)=>{h&&(e.fillStyle=t(s.plt[h-1]),e.fillRect(s.x+n,s.y+i,1,1))})})}draw(){this.#S.fillStyle=t(this.#M),this.#S.fillRect(0,0,this.#I.width,this.#I.height),this.#x.sort((t,e)=>t.y-e.y),this.#x.forEach(t=>{t.z&&t.get().forEach(t=>this.#C(this.#S,t))}),this.#S.drawImage(this.#z,0,0),this.#x.forEach(t=>{t.z||t.get().forEach(t=>this.#C(this.#S,t))})}}(document.querySelector("#scr"),"1a",3);f.setBg(n),k.forEach(t=>{f.setChr(t),t.animate([0,1],250)});let R={x:0,y:0},L=setInterval(()=>{0==R.x&&0==R.y||((0==g.way&&R.x<0||1==g.way&&R.x>0)&&g.turn(),!g.collision(R.x,R.y)&&g.energyVal>0&&(g.move(R.x,R.y,g.z),g.drop()&&(clearInterval(L),g.animate([8],250))))},25);function q(t,e){g.z||g.energyVal<1?R={x:0,y:0}:(R[t]=e,g.animate([2,0],250))}function v(t){R[t]=0,0==R.x&&0==R.y&&g.animate([0,1],250)}let S=[[3],[5],[6,7]],z=[[2,2],[2,2],[0,3]],E=!1;function I(){E||(E=!0,setTimeout(()=>E=!1,250),M(g))}function M(t){let e=t.collision(0,0,1);if(e){t.way==e.way&&e.turn();let s=t.attackCnt%z.length;t.energyVal>0&&t.animate(S[s],125),t.attack(z[s],125);let h=s==z.length-1?2:1;e.damage(h,[4],t=>{"drop"==t?e.animate([8],250):"lose"==t&&(e.animate([8,9],250),setTimeout(()=>{e.animate([9],250),k.delete(e.name)},1500))})}else t.animate([3],125),t.attack([1,1],125);setTimeout(()=>{t.animate([0,1],250)},250)}document.querySelector("#l").onpointerdown=()=>q("x",-1),document.querySelector("#r").onpointerdown=()=>q("x",1),document.querySelector("#u").onpointerdown=()=>q("y",-1),document.querySelector("#d").onpointerdown=()=>q("y",1),document.querySelector("#l").onpointerup=()=>v("x"),document.querySelector("#r").onpointerup=()=>v("x"),document.querySelector("#u").onpointerup=()=>v("y"),document.querySelector("#d").onpointerup=()=>v("y"),document.querySelector("#lu").onpointerdown=()=>{q("x",-1),q("y",-1)},document.querySelector("#ru").onpointerdown=()=>{q("x",1),q("y",-1)},document.querySelector("#ld").onpointerdown=()=>{q("x",-1),q("y",1)},document.querySelector("#rd").onpointerdown=()=>{q("x",1),q("y",1)},document.querySelector("#lu").onpointerup=()=>{v("x"),v("y")},document.querySelector("#ru").onpointerup=()=>{v("x"),v("y")},document.querySelector("#ld").onpointerup=()=>{v("x"),v("y")},document.querySelector("#rd").onpointerup=()=>{v("x"),v("y")},document.onkeydown=t=>{if(t.repeat||g.energyVal<1)return;let e=t.key;if(" "==e){let t=I();t&&console.log(t)}"ArrowLeft"!=e&&"a"!=e||q("x",-1),"ArrowRight"!=e&&"d"!=e||q("x",1),"ArrowDown"!=e&&"s"!=e||q("y",1),"ArrowUp"!=e&&"w"!=e||q("y",-1)},document.onkeyup=t=>{if(g.energyVal<1)return;let e=t.key;"ArrowLeft"!=e&&"a"!=e||v("x"),"ArrowRight"!=e&&"d"!=e||v("x"),"ArrowDown"!=e&&"s"!=e||v("y"),"ArrowUp"!=e&&"w"!=e||v("y")},document.querySelector("#attack").onclick=()=>I();let C=setInterval(()=>{k.forEach(t=>{let e;"pc"!=t.name&&(e="ally1"==t.name||"ally2"==t.name?[y,w,b]:[m,g,d],Math.random()>.5&&function(t,e){let s=["n","e","s","w"];e.forEach(e=>{e.y<t.y-16&&s.push("n","n","n","n","n","n","n","n","n"),e.x>t.x+16&&s.push("e","e","e","e","e","e","e","e","e"),e.y>t.y+16&&s.push("s","s","s","s","s","s","s","s","s"),e.x<t.x-16&&s.push("w","w","w","w","w","w","w","w","w")});let h=s[Math.floor(Math.random()*s.length)],i=8*Math.ceil(3*Math.random());t.walk(h,i,e=>{"drop"==e?t.animate([8],250):"stop"==e&&t.energyVal>0&&M(t)}),t.energyVal>0&&t.animate([2,0],250)}(k.get(t.name),e.filter(t=>k.has(t.name))))})},500);document.addEventListener("touchmove",t=>{document.querySelector("#debug").innerText=t.scale,1!==t.scale&&t.preventDefault()},{passive:!1}),function t(){f.draw(),function(){let t=0,e=0;return k.has("pc")&&t++,k.has("ally1")&&t++,k.has("ally2")&&t++,k.has("enemy1")&&e++,k.has("enemy2")&&e++,k.has("enemy3")&&e++,0==t?(k.has("enemy1")&&y.animate([10],250),k.has("enemy2")&&w.animate([10],250),k.has("enemy3")&&b.animate([10],250),"white"):0==e?(k.has("pc")&&g.animate([10],250),k.has("ally1")&&m.animate([10],250),k.has("ally2")&&d.animate([10],250),"black"):void 0}()&&(clearInterval(L),clearInterval(C)),requestAnimationFrame(t)}(),window.onload=function(){window.innerWidth<window.innerHeight?(window.innerWidth,document.querySelector("#scr").width):(window.innerHeight,document.querySelector("#scr").height,document.querySelector("#ctrl").style.display="none"),document.querySelector("#scrDiv").style.width=document.querySelector("#scr").width+"px"}</script>