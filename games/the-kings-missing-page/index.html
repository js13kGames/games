<!DOCTYPE html><html><head><title>The King's Missing Page</title><style>*,::after,::before{box-sizing:border-box;user-select:none}body{background:#000;color:#b2cdde;font-size:24px;font-family:courier new;overflow:hidden;padding:0;margin:0;height:100vh;position:relative}#msg{font-size:50px;display:flex;align-items:center;justify-content:center;height:100%}span{display:inline-block}#overlay{width:100%;height:100%;position:absolute;z-index:2000;display:none}#status{background-color:#fff;color:#000;font-weight:700;height:27px;text-align:center}#sentence{text-align:center;line-height:33px;color:#fff;background-color:#000}#controls{background-color:#000;height:82px;font-family:"Apple Color Emoji","Segoe UI Emoji"}#controls span:hover,#itemlist div:hover{color:#0065cc;text-shadow:hsla(210,100%,20%,.3) 0 -1px 0,#b2d8ff 0 2px 1px,#99dcff 0 0 5px,hsla(210,100%,50%,.6) 0 0 20px}#controls div{float:left}.arrows{width:42px}.arrows span{font-size:40px;height:80px;width:40px;line-height:75px;text-align:center;background-color:#2d2022;margin:1px;cursor:var(--‚ûï)}#items{width:545px;height:82px;background-color:#2d2022;margin:1px;overflow:hidden;position:relative}#itemlist{position:absolute;left:0;width:2000px;transition:left .1s ease-in-out}#itemlist span{width:75px;margin:1px;height:80px;text-align:center;line-height:75px;font-size:40px}#commands{width:328px;font-size:0;cursor:var(--‚ûï)}#commands span{background-color:#2d2022;width:80px;margin:1px;height:80px;text-align:center;line-height:75px;font-size:40px}#wrap{background-color:#31da81;background:linear-gradient(#265d96,#b2cdde,#b2cdde 25% 30%,#252525 30% 35%,#31da81 35% 60%,grey 60% 67%,#31da81 67% 72%,grey 72% 73%,#464646 73% 75%,#252525 75% 100%);top:50vh;left:50vw;width:960px;height:627px;position:absolute;overflow:hidden;transform:scale3d(var(--scale-x),var(--scale-y),1) translate(-50%,-50%);transform-origin:0 0;opacity:0}#screen{position:relative;height:485px;z-index:-2;width:var(--screen-width);will-change:transform;transform:translateX(var(--screen-left))}#screen *{position:absolute}x-ego{transform:rotateY(0) translate(var(--sprite-left),var(--sprite-top)) translateZ(0);will-change:transform}x-shadow{--shadow-width:var(--sprite-width);--shadow-height:calc(var(--sprite-width)/2/3);position:absolute;bottom:calc(var(--shadow-height)/-2);left:0;width:var(--shadow-width);height:var(--shadow-height);background:#000;border-radius:50%;opacity:.5;filter:blur(1.2px);z-index:0;transform:rotateY(0)}x-sprite canvas{width:100%;height:100%;transform:rotateY(0)}x-sprite.bldg{overflow:hidden}.dark{filter:brightness(.4) saturate(3)}.light{filter:brightness(1.3) saturate(1.5)}.wall{background-color:silver;background-image:linear-gradient(335deg,#b00 23px,transparent 23px),linear-gradient(155deg,#b00 23px,transparent 23px),linear-gradient(335deg,#b00 23px,transparent 23px),linear-gradient(155deg,#b00 23px,transparent 23px);background-size:58px 56px;background-position:0 0,4px 31px,29px 28px,33px 3px}.left_path,.right_path{top:120px;background:linear-gradient(230deg,#31da81 0 27%,grey 28% 48%,#31da81 49% 63%,grey 64% 65%,#464646 67% 72%,#252525 74% 100%);box-shadow:inset #31da81 0 -26px 0 0,inset grey 0 -31px 0 0,inset #252525 0 -70px 0 0;border-top:4px solid #80808000;background-repeat:no-repeat}.left_path{left:0;transform:scaleY(-1) rotateX(-60deg);cursor:var(--c,var(--ü°µ,var(--‚ÜóÔ∏è)))}.right_path{right:0;transform:scaleY(-1) rotateX(-60deg) scaleX(-1);cursor:var(--c,var(--ü°¥,var(--‚ÜñÔ∏è)))}.left_path.down{top:273px;box-shadow:#31da81 0 -5px 0 0;background-position-y:-4px;border:none;transform:rotateX(-60deg) scaleX(-1);cursor:var(--c,var(--ü°∑,var(--‚ÜôÔ∏è)))}.right_path.down{top:273px;box-shadow:#31da81 0 -5px 0 0;background-position-y:-4px;border:none;transform:rotateX(-60deg);cursor:var(--c,var(--ü°∂,var(--‚ÜòÔ∏è)))}.castle_path{border-bottom:150px solid grey;border-left:125px solid transparent;border-right:125px solid transparent;cursor:var(--c,var(--ü°±,var(--‚¨ÜÔ∏è)))}.actor{width:100%;height:100%;z-index:2000}.head{border-radius:50%;background:linear-gradient(grey 16px,#000 16px 19px,#fff 19px);width:42px;height:42px;top:7px;left:4px;border:3px solid #000}.head:after{content:"";width:12px;height:12px;background-color:grey;position:absolute;border-radius:50%;border:3px solid #000;top:-9px;left:12px;z-index:-1}.body{position:relative;border-bottom:86px solid #000;border-left:15px solid transparent;border-right:15px solid transparent;height:0;width:50px;top:47px}.body:after{content:"";position:absolute;border-bottom:81px solid grey;border-left:14px solid transparent;border-right:14px solid transparent;height:0;width:42px;top:3px;left:-11px}.facing1 .body{width:35px;border-right-width:0}.facing1 .body:after{width:27.5px;border-right-width:0}.facing2 .body{width:35px;left:15px;border-left-width:0}.facing2 .body:after{width:27.5px;left:3.5px;border-left-width:0}.feet{top:114px;height:20px;z-index:-1}.feet:before{content:"";width:3.5px;height:20px;background-color:#000;position:absolute;bottom:-5px;left:15px;animation:.3s ease-out infinite alternate-reverse paused feet}.feet:after{content:"";width:3.5px;height:20px;background-color:#000;position:absolute;bottom:-5px;left:31.5px;animation:.3s ease-out infinite alternate paused feet}.walking .feet:after,.walking .feet:before{animation-play-state:running}@keyframes feet{0%{bottom:-5px}100%,90%{bottom:-15px}}.pack{width:40px;height:44px;background-color:red;top:51px;left:5px;border:3px solid #000;z-index:-1}.facing2 .pack{width:20px}.facing1 .pack{width:20px;left:25px}.facing3 .pack{z-index:0}.bubble{font-size:smaller;font-family:"Comic Sans MS",cursive,sans-serif;font-weight:700;padding:15px;color:#000;background:#fff;border-radius:20px;border:2px solid #000;box-shadow:6px 3px #000;z-index:1010;transform:rotateY(0)}.bubble:before{z-index:1011;content:"";display:block;position:absolute;bottom:-9px;left:var(--left);width:15px;height:15px;transform:rotate(45deg);background-color:#fff;border-right:2px solid #000;border-bottom:2px solid #000;box-shadow:5px 1px #000}.outside{opacity:.7;background:#000;height:512px!important;top:-27px!important}.inside{background:#000}.inside:after{content:"";display:inline-block;width:100%;height:82px;background:#2d2022;bottom:0;position:absolute}.bldg{cursor:var(--c,var(--ü°±,var(--‚¨ÜÔ∏è)))}.road{cursor:var(--c,var(--ü°≥,var(--‚¨áÔ∏è)))}.woods{cursor:var(--c,var(--ü°¥,var(--‚ÜñÔ∏è)))}#screen.left:before{left:-20px;content:'';position:absolute;width:60px;top:225px;height:200px;cursor:var(--c,var(--ü°∞,var(--‚¨ÖÔ∏è)))}#screen.right:after{right:-20px;content:'';position:absolute;width:60px;top:225px;height:200px;cursor:var(--c,var(--ü°≤,var(--‚û°Ô∏è)))}[data-name=syringe]{filter:grayscale()}</style></head><body><div id="msg">Click to start</div><div id="wrap"><div id="overlay"></div><div id="status">The King's Missing Page</div><div id="screen"></div><div id="sentence">Walk to</div><div id="controls"><div id="commands"><span data-name="Walk to">üö∂</span><span data-name="Look at">üëÅÔ∏è</span><span data-name="Pick up">ü§öüèº</span><span data-name="Talk to">üí¨</span></div><div class="arrows"><span id="up">&#9665;</span></div><div id="items"class="metal"><div id="itemlist"></div></div><div class="arrows"><span id="down">&#9655;</span></div></div></div><template id="person"><div class="actor"><div class="head"></div><div class="body"></div><div class="pack"></div><div class="feet"></div></div></template><script>class t{constructor(t){this.t=t}s(t,s,i,h){let a=s,o=this.t,r=o.i,n=o.h,l=o.o.find(t=>t.dataset.name==i),c=()=>o.l(i),u=o.u?o.u:n;switch(t){case"Talk to":switch(i){case"guard":o.u.m("Hello Detective Pip.",250,()=>{o.p("map")?o.u.m("Have you found our missing Page Boy yet?",500):o.u.m("Please take the map to help your search.",500)});break;case"moai statue":r[3]?o.p("magic ring")?n.m("They're ignorning me now."):l.m("We're hungry!"):l.m("Zzzzzzz...",150,()=>{n.m("I think they're... asleep?")});break;case"family":o.u.m("Happy Halloween!");break;case"boy":o.u.m("I used to be a Page Boy for the King.",450,()=>{o.u.m("Then the goblin did something to me.",500)});break;case"goblin":o.u.m("The Page Boy? Yes, I saw him.",400,()=>{o.u.m("Told me some bad news, so I taught him a lesson.")});break;case"sheep":h.target.parentNode.m("Baaaaa!");break;case"cow":h.target.parentNode.m("Mooooo!");break;case"office worker":o.p("ticket")?o.u.m("Hello!"):o.u.m("I've lost my briefcase!");break;case"self service":o.u.m("Does not compute!");break;case"clown":o.u.m("Do you like my makeup?");break;default:l&&l==o.u?o.u.m("Hello!"):u.m("It doesn't speak.")}break;case"Walk to":switch(i){case"outside":for(;l&&l.nextElementSibling;)l=l.nextElementSibling,o.remove(l.previousElementSibling);o.remove(l),o.u=null,n.k(n.x,n.z-544),n.g(),o.T=0,o.I="";break;case"left path":case"right path":{let t=i.includes("left"),e=document.querySelectorAll(".down").length>0,s=e?1e3:490,h=t?e?-70:70:o.v[1]-(e?-70:70),a=t?e?100:20:o.v[1]-(e?100:20);o.M=0,n._(),n.moveTo(a,740),n.moveTo(h,s)}break;case"woods":r[4]?o.p("map")?(o.M=0,n._(),n.moveTo(210,740),n.moveTo(210,640),n.moveTo(70,555),n.moveTo(-50,555)):n.m("I might get lost in the woods. I need a map."):n.m("The elephant blocks my way.");break;case"road":o.M=0,n._(),n.moveTo(o.H+h.pageX/o.P,850),n.moveTo(o.H+h.pageX/o.P,1e3);break;case"castle path":case"mountain":o.M=0,n._(),n.moveTo(3280,740),n.moveTo(3280,400);break;default:if(l&&l.j&&16&l.j[1])if("circus"!=i||o.p("ticket"))if("coffin"!=i||o.p("magic ring")){let t=o.L.filter(t=>t[0]==l.j[10]);t.length?(n._(1),n.moveTo(n.cx,740,()=>{n.moveTo(l.cx,740,()=>{let e=Math.min(Math.max(l.cx-200,280),o.v[1]-680);o.W([0,14,"outside",null,6720,485,0,970,,1e3]),o.W([0,14,"inside",null,400,300,e,700,,1001]),t.forEach(t=>o.W(t)),n.$(),o.T=1,n.k(n.x,n.z+544)})})):n.m("This building is locked.")}else n.m("Magic is stopping me opening the coffin.");else n.m("I need a ticket.");else{let t=2*(h.pageY/o.A-27);if(t<=970){if(!o.T){n._(1);let e=o.H+h.pageX/o.P;e=e>o.v[1]-50?o.v[1]+10:e<50?-10:e,n.moveTo(e,t>710?t:740)}}else o.U="Use",a="Use "+i+" with "}}break;case"Pick up":if(o.p(i))n.m("I already have that.");else switch(i){case"jack-o-lantern":n.m("No, I shouldn't.");break;default:l&&1&l.j[1]?l.j[0]<11?n.moveTo(n.cx,740,()=>n.moveTo(l.x,740,c)):31==l.j[0]||28==l.j[0]?c():"bellhop"==i?o.u?o.u.m("Please leave that there."):c():o.u.m(`Hey! That's my ${i}.`):n.m("I can't get that.")}break;case"Look at":switch(i){case"left path":case"right path":n.m("The paths will take me to another part of town.");break;case"magic ring":n.m("The engraving says it negates other magic.");break;case"boy":n.m("He's awake, but he doesn't look too good.");break;case"moai statue":r[3]?n.m("They're wide awake now."):n.m("They seem to be sleeping.");break;case"bellhop":n.m("It makes a loud sound.");break;case"ticket":n.m("It's a ticket for the circus.");break;case"bank card":n.m("It has my name on it.");break;case"circus":n.m("The circus is in town.");break;case"road":n.m("Maybe I should cross the road?");break;case"halloween house":case"jack-o-lantern":n.m("Someone is celebrating Halloween.");break;case"mailbox":n.m("This is my mailbox.");break;case"water pistol":n.m(r[2]?"It contains water.":"It is empty.");break;case"shopping cart":n.moveTo(n.cx,740,()=>n.moveTo(l.cx,740,()=>{o.p("water pistol")?n.m("Nothing in there."):(n.m("I found a water pistol."),o.l("water pistol","üî´"))}));break;case"map":n.m("It is a map of the woods. The entrance is to the left of the circus.");break;case"chipmunk":n.m("It's scaring the elephant.");break;case"briefcase":n.m("Someone forgot this briefcase at the bus stop.");break;case"elephant":r[4]?n.m("He looks happy now."):n.m("It's blocking the entrance to the woods.",250,()=>{r[6]?n.m("I need something to lure him away."):n.m("I think it's afraid of the chipmunk.")});break;case"feeding hole":n.m("This is where the elephant feeds.");break;case"castle":n.m("The King's castle.");break;case"my house":n.m("This is where I live.");break;case"tree":case"trees":4==o.S||7==o.S?n.m("This might be the woods, but where is the entrance?"):n.m("The trees make this town look very pretty.");break;default:""!=i&&n.m("It's just a "+i+".")}break;case"Use":let e=()=>{let t=s.substring(4,s.indexOf(" with ")),e;switch([i,t].sort().join()){case"bank,bank card":n.m("The ATM is broken. I should go inside.");break;case"bride,tulip":case"bride,rose":o.u.m("I'd prefer a bouquet.");break;case"rose,tulip":o.p("rose")&&o.p("tulip")?(o.l("bouquet","üíê"),o.q("tulip"),o.q("rose"),n.m("I made a bouquet.")):n.m("I should pick them both up first.",200);break;case"fountain,water pistol":r[2]?n.m("It's already full."):(n.m("The pistol now contains water."),r[2]=1);break;case"bouquet,bride":o.q("bouquet"),o.u.m("Thanks. Take my lipstick."),o.l("lipstick");break;case"briefcase,office worker":o.q("briefcase"),o.u.m("Thanks. Take my circus ticket."),o.l("ticket");break;case"clown,lipstick":o.q("lipstick"),o.u.m("Thanks. Take my mask."),o.l("mask");break;case"cash,salesperson":o.p("syringe")?o.u.m("I have nothing to sell."):(o.u.m("Here's your syringe."),o.l("syringe"));break;case"cash,cashier":o.p("banana")?o.u.m("I only have bananas to sell."):(o.u.m("Here's your banana."),o.l("banana"));break;case"bank card,cashier":case"bank card,salesperson":o.u.m("We only take cash.");break;case"chipmunk,palm nut":o.q("palm nut"),n.m("The chipmunk took the palm nut and ran away."),l.j[0]=-1,o.remove(l),r[6]=1;break;case"banana,feeding hole":let t=[4,2,"banana","üçå",30,30,1125,640,,651];o.q("banana"),o.L.push(t),o.W(t),r[5]=1;break;case"candy,moai statue":r[3]?(o.q("candy"),l.m("Mmmm... yummy. Here, take this magic ring."),o.l("magic ring","üíç")):n.m("They're asleep.");break;case"boy,syringe":o.p("blood")?o.u.m("You already have my blood."):(o.u.m("Sure, take my blood. Please find a cure."),o.q("syringe"),o.l("blood","üíâ"));break;case"blood,doctor":o.q("blood"),o.u.m("Here, this is the cure."),o.l("pill","üíä");break;case"bellhop,moai statue":r[3]?n.m("They're already awake."):(n.m("The bell sound woke them up."),r[3]=1);break;case"family,water pistol":o.p("candy")?n.m("I already have candy."):r[2]?o.p("mask")?(o.u.m("Here's some candy."),o.l("candy")):o.u.m("You're not dressed up!"):n.m("It doesn't have water.");break;case"bank card,bank teller":o.p("cash")?n.m("I already have enough cash."):(o.u.m("Here's your cash."),o.l("cash"));break;case"boy,pill":o.M=0,o.u.m("An antidote? Really? Thank you so much!",450,()=>{o.u.m("It tastes... strange...",350,()=>{o.u.m("I feel... something...",350,()=>{o.u.B("üë¶"),o.u.m("I'm normal again!!",300,()=>{o.S=7,n.D,o.N(o.wrap),setTimeout(()=>{n.k(n.x,n.z-544),o.T=0,o.O(),n.m("I have returned the page boy to the castle.",200,()=>{n.m("Thank you for helping me to solve the case.",200,()=>{n.m("Well done!!!",200,()=>{setTimeout(()=>location.reload(),3e3)})})})},200)})})})});break;default:n.m("Hmmm, that didn't work.")}};o.T||!l?e():n.moveTo(n.cx,740,()=>n.moveTo(l.cx,740,e)),a=t;break;default:n.m("Nothing happened.")}return a.endsWith("with ")&&(o.R=o.F[i].innerHTML,o.G[o.R]=`url(${e.K(o.R,50,50)[0].toDataURL()}) 25 25, auto`),a}}class e{static K(t,s,i,h=0,a=1){let o=Math.max(s,i),r=document.createElement("canvas");r.height=o+o/8+20,r.width=1.4*o+10;let n=r.getContext("2d");n.font=o+"px 'Segoe UI Emoji'",n.textBaseline="bottom",a&&(n.fillStyle="red"),n.fillText(t,5,r.height-5);let[l,c,u,d]=e.Y(n,0,0),m=document.createElement("canvas"),p=u-l+3,k=d-c+3;m.width=s,m.height=i;let b=m.getContext("2d");return p>0&&k>0&&(b.shadowColor="black",b.shadowBlur=3,h&&(b.translate(s,0),b.scale(-1,1)),b.drawImage(r,l-1,c-1,p,k,0,0,s,i)),[m,b.getImageData(0,0,s,i)]}static Y(t,s,i){let{width:h,height:a}=t.canvas,o=h<<2,r=t.getImageData(0,0,h,a),n=new Uint32Array(r.data.length),l=[[s,i]],[c,u]=[h,a],d=0,m=0;for(;l.length;){let[t,s]=l.shift(),i=s*o+(t<<2);if(n[i])continue;n[i]=1;let[p,k,b,f]=r.data.slice(i,i+4),g=Math.round(Math.sqrt(p*p*.241+k*k*.691+b*b*.068)),y=0;0==f?y=1:0==p&&0==k&&0==b?e.C&&(r.data[i+3]=0,y=1):g<70&&e.C&&(r.data[i+3]=Math.round(g*(255/70)),y=1),y&&(t>0&&l.push([t-1,s]),t<h-1&&l.push([t+1,s]),s>0&&l.push([t,s-1]),s<a-1&&l.push([t,s+1])),r.data[i+3]&&(t<c&&(c=t),t>d&&(d=t),s<u&&(u=s),s>m&&(m=s))}return t.putImageData(r,0,0),[c,u,d,m]}}e.C=navigator.platform.indexOf("Win")>-1,e.Z=navigator.platform.indexOf("Mac")>-1;class s extends HTMLElement{static J=1;static V=2;static X=4;static tt=8;constructor(){super()}et(t,e,i,h,a=1,o=0){this.t=t,this.width=e,this.height=i,this.st=h,this.style.width=e+"px",this.style.height=i+"px",this.style.setProperty("--sprite-width",e+"px"),h&&this.B(h,o),a&&(this.it=document.createElement("x-shadow"),this.appendChild(this.it)),this.ht=0,this.at=[],this.ot=this.width/2,this.cx=0,this.rt=5,this.nt=this.lt=this.rt/10,this.ct=s.tt,this.ut=null,this.dt=4,this.pt=-1,this.kt=-1,this.bt=null,this.ft=[],this.gt=0,this.visible=0,this.S=this.t.S}B(t,s=0){let i=`${t}_${this.width}_${this.height}_${s}`,h=this.t.yt.get(i);if(this.wt&&this.removeChild(this.wt),h){let t=document.createElement("canvas");t.width=h.width,t.height=h.height,t.getContext("2d").putImageData(h,0,0),this.wt=t}else{let[h,a]=e.K(t,this.width,this.height,s);this.wt=h,this.t.yt.set(i,a)}this.appendChild(this.wt)}Tt(t,e){if(this.It||t.It||t==this)return 0;if(t){let s=this.cx-t.cx,i=this.vt-t.vt+15,h=s*s+i*i,a=this.ot+t.ot+(0|e);return h<=a*a}return 0}Mt(){let t=this.at.pop();return t&&(this.k(t.x,t.z),this.at.pop()),this.nt=1,t}k(t,e){this.z&&(this.at.push({x:this.x,z:this.z}),this.at.length>5&&(this.at=this.at.slice(-5))),this.x=t,this.z=e,this.cx=t+this.width/2,this.vt=3*e,this.top=Math.floor(this.z/2)-this.height,this==this.t.h?(this.style.setProperty("--sprite-top",this.top+"px"),this.style.setProperty("--sprite-left",this.x+"px")):(this.style.top=this.top+"px",this.style.left=this.x+"px"),this.style.zIndex=Math.floor(this.z),this.wt&&(this.wt.style.zIndex=Math.floor(this.z))}$(){this.style.display="none",this.visible=0,this.It=1,this.style.opacity=1}g(){this.style.display="block",this.visible=1,this.It=0}_t(t){let e=this.dt,s=0;if(t&&t!=this.ct){for(this.ct=t,s=0;s<=4&&!(t>>s++&1););this.dt=s}e!=this.dt&&(this.classList.remove("facing"+e),this.classList.add("facing"+this.dt))}xt(){if(this.ht=0,this.ct||null!=this.ut){let t=this.x,e=this.z,s=0,i=this.t.v[1];null!=this.ut&&(t+=Math.cos(this.ut)*Math.round(this.nt*this.t.Ht),e+=Math.sin(this.ut)*Math.round(this.nt*this.t.Ht),this.t.M?(t<0&&4!=this.t.S&&(s=1),t+this.width>i&&(s=5),(e<710||e>850)&&(s=10)):(e<710&&t<0&&(s=1),e<540&&(s=t<250?2:t>i-250?4:6),e>985&&(s=7==this.S?7:this.t.v[3]>=0?3:t<250?2:t>i-250?4:3)),(this.nt+=this.lt)>this.rt&&(this.nt=this.rt)),s?this.Pt(s):t==this.x&&e==this.z||(this.k(t,e),this.ht=1)}else this.nt=1}m(t,e,s){let i=this.t,h=this;e=e||Math.min(350,15*t.length),i.M=0,i.zt.style.display="block",i.zt.onclick=null;let a=document.createElement("span"),o;a.className="bubble",a.innerHTML=t,o=this.x>800?40-e:this.x<100?-10:-e/2,a.style.width=e+"px",a.style.setProperty("--left",-o+"px"),a.style.left=this.x+o+"px",a.style.bottom=500-this.top+"px",i.Et.appendChild(a),this.classList.add("speech");let r=null,n=t=>{if(t&&(clearTimeout(r),i.zt.onclick=null),h.classList.remove("speech"),i.Et.contains(a)&&i.Et.removeChild(a),s){let t;setTimeout(s,200),s=null}else i.M=1};r=setTimeout(n,t.length/10*1500),i.zt.onclick=n}}class i extends s{constructor(){super()}et(t,e,s,i,h){super.et(t,e,s,i,h),this.appendChild(document.importNode(document.getElementById("person").content,1))}_(t){this.kt=this.pt=-1,this.ut=null,this.gt=0,this.bt&&!t&&(this.bt(),this.bt=null),t&&(this.ft=[])}moveTo(t,e,s){this.ft.push({z:e,x:t,jt:s})}Lt(){if("none"!=this.style.display){let t;if(-1!=this.kt&&-1!=this.pt)this.Tt({cx:this.kt,vt:3*this.pt,ot:-this.ot},20)?this._():(this.ut=Math.atan2(this.pt-this.z,this.kt-this.cx),this.gt=(this.gt+1)%30);else if(this.ft.length>0){let t=this.ft.shift();this.pt=t.z,this.kt=t.x,this.bt=t.jt}null!==this.ut&&(Math.abs(this.ut)>2.356?t|=s.J:Math.abs(this.ut)<.785?t|=s.V:this.ut>0?t|=s.tt:t|=s.X),this._t(t),null!==this.ut&&this.xt(),this.ht?this.classList.add("walking"):this.classList.remove("walking")}}Wt(t){if(this.t.M){for(;this.Mt()&&this.Tt(t););this._(1),this.M=1}else{for(;this.Mt()&&this.Tt(t););this.ft[0]||this.ft.unshift({x:this.kt,z:this.pt}),this.kt=this.cx<t.cx?t.cx-t.ot-50:t.cx+t.ot+50,this.ft.unshift({x:this.kt,z:this.pt}),this.pt=this.z}}}class h extends i{constructor(){super()}Pt(t){if(t&&(this.kt=this.pt=-1,this.ut=null,this.gt=0,t<8)){let e=this.t.$t[this.S-1][t+1];if(50==e&&(e=this.S,t=[5,4,0,2,1][t-1]),e){this.t.M=0,e!=this.S&&this.$(),this.S=Math.abs(e);let i=this.t.$t[this.S-1][1],h=this.t.$t[this.S-1][3]<0,a=h?980:600,o=h?-70:70,r=h?100:30,n=i-this.x/this.t.v[1]*i;switch(t){case 1:this.k(i,this.z),this._t(s.J),this.moveTo(i-70,740,()=>this.t.M=1);break;case 2:this.k(i-o-this.ot,a),this._t(h?s.X:s.tt),this.moveTo(i-r,740,()=>this.t.M=1);break;case 6:case 3:this.k(n,950),this._t(s.X),this.moveTo(n,740,()=>this.t.M=1);break;case 4:this.k(o-this.ot,a),this._t(s.tt),this.moveTo(r,740,()=>this.t.M=1);break;case 5:this.k(-50,this.z),this._t(s.V),this.moveTo(70,740,()=>this.t.M=1);break;case 7:this.k(3300,600),this._t(s.tt),this.moveTo(3300,740,()=>this.t.M=1)}this.at=[],this.nt=1,this.D=t}}}}var a=function(){var t=function(t){return Math.sin(6.283184*t)},e,s,i=function(t){return.003959503758*Math.pow(2,(t-128)/12)},h=function(t,e,s){var h=a[t.At[0]],o=t.At[1],r=t.At[3],n=a[t.At[4]],l=t.At[5],c=t.At[8],u=t.At[9],d=t.At[10]*t.At[10]*4,m=t.At[11]*t.At[11]*4,p=t.At[12]*t.At[12]*4,k=1/p,b=t.At[13],f=s*Math.pow(2,2-t.At[14]),g=new Int32Array(d+m+p),y=0,w=0,T,I,v,M,_,x,H;for(T=0,I=0;T<d+m+p;T++,I++)I>=0&&(I-=f,x=i(e+(15&(b=b>>8|(255&b)<<4))+t.At[2]-128),H=i(e+(15&b)+t.At[6]-128)*(1+8e-4*t.At[7])),v=1,T<d?v=T/d:T>=d+m&&(v-=(T-d-m)*k),M=x,r&&(M*=v*v),_=h(y+=M)*o,M=H,c&&(M*=v*v),_+=n(w+=M)*l,u&&(_+=(2*Math.random()-1)*u),g[T]=80*_*v|0;return g},a=[t,,function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}],o,r,n,l,c;this.et=function(t){o=t,r=t.Ut,n=0,l=t.St*t.qt*(r+1)*2,c=new Int32Array(l)},this.Bt=function(){var e,s,i,u,d,m,p,k,b,f,g,y,w,T,I,v,M,_=new Int32Array(l),x=o.Dt[n],H=o.St,P=o.qt,z=0,E=0,j,L,W=0,$=[];for(u=0;u<=r;++u)for(k=x.Nt[u],d=0;d<P;++d){var A=k?x.c[k-1].f[d]:0;A&&(x.At[A-1]=x.c[k-1].f[d+P]||0,A<16&&($=[]));var U=a[x.At[15]],S=x.At[16]/512,q=Math.pow(2,x.At[17]-9)/H,B=x.At[18],D=x.At[19],N=135.82764118168*x.At[20]/44100,O=1-x.At[21]/255,R=1e-5*x.At[22],F=x.At[23]/32,G=x.At[24]/512,K=6.283184*Math.pow(2,x.At[25]-9)/H,Y=x.At[26]/255,C=x.At[27]*H&-2;for(I=(u*P+d)*H,m=0;m<4;++m)if(p=k?x.c[k-1].n[d+m*P]:0){$[p]||($[p]=h(x,p,H));var Z=$[p];for(s=0,e=2*I;s<Z.length;s++,e+=2)_[e]+=Z[s]}for(s=0;s<H;s++)(T=_[b=2*(I+s)])||W?(v=N,B&&(v*=U(q*b)*S+.5),E+=(v=1.5*Math.sin(v))*(j=O*(T-E)-(z+=v*E)),T=3==D?E:1==D?j:z,R&&(T=(T*=R)<1?T>-1?t(.25*T):-1:1,T/=R),W=(T*=F)*T>1e-5,L=T*(1-(f=Math.sin(K*b)*G+.5)),T*=f):L=0,b>=C&&(L+=_[b-C+1]*Y,T+=_[b-C]*Y),_[b]=0|L,_[b+1]=0|T,c[b]+=0|L,c[b+1]+=0|T}return++n/o.Ot},this.Rt=function(){var t=44,e=44+2*l-8,s=e-36,i=new Uint8Array(44+2*l);i.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&s,s>>8&255,s>>16&255,s>>24&255]);for(var h=0,a=44;h<l;++h){var o=c[h];o=o<-32767?-32767:o>32767?32767:o,i[a++]=255&o,i[a++]=o>>8&255}return i}};class o{constructor(){setTimeout(()=>{let t=new Audio,e=new a;e.et(o.Ft),e.Bt(),e.Bt(),e.Bt(),e.Bt(),t.src=URL.createObjectURL(new Blob([e.Rt()],{type:"audio/wav"})),t.loop=1,t.volume=1,this.Gt=t},1)}Kt(){this.Gt.play()}static Ft={Dt:[{At:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],Nt:[1,2,1,2,1,2,1,2,2,2,2,2,3,2,3,2],c:[{n:[130,,135,,139,,142,,140,,139,,135,,137,,135,,139,,137,,135],f:[]},{n:[130,,134,,135,,130,,134,,135,,130,,134,,135,,130,,134,,135],f:[]},{n:[130,,135,,137,,130,,135,,137,,130,,135,,137,,130,,135,,137],f:[]}]},{At:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],Nt:[1,2,3,4,1,2,3,4,5,4,3,4,5,4,3,4],c:[{n:[111,,123,,,,111,,123,,,,111,,123,,,,111,,123],f:[]},{n:[115,,115,,,,115,,127,,,,115,,127,,,,115,,127],f:[]},{n:[116,,128,,,,116,,128,,,,116,,128,,,,116,,128],f:[]},{n:[118,,130,,,,118,,130,,,,118,,130,,,,118,,130],f:[]},{n:[120,,132,,,,,,,,,,120,,132],f:[]}]},{At:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],Nt:[,,,,1,1,1,1,,,,,1,1,1,1],c:[{n:[142],f:[]}]},{At:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],Nt:[,,,,,,,,1,1,1,1,1,1,1],c:[{n:[142],f:[]}]}],St:5513,qt:24,Ut:15,Ot:4}}class r{F={};U="Walk to";command="Walk to";I="";Yt=0;$t=[[7,4800,5,3,2,3,6],[3,4800,9,50,1,50,10],[7,4800,0,1,4,1,0],[2,6720,8,-5,3,-6,0,7],[7,2880,50,0,10,4,1],[7,2880,1,4,9,0,50],[3,960,0,-4,4,-4,0,,4],[10,1440,0,0,0,0,4],[3,2880,50,0,6,50,2],[3,2880,2,50,5,0,50]];L=[[1,30,"office","üè¢",400,400,280,700,,,11],[1,2,"tree","üå¥",300,300,50,825,30],[1,2,"tree","üå¥",300,300,810,825,30],[1,2,"tree","üå¥",300,300,1770,825,30],[1,2,"tree","üå¥",300,300,2730,825,30],[1,2,"tree","üå¥",300,300,3690,825,30],[1,2,"ambulance","üöë",200,200,1500,950],[1,30,"hospital","üè•",400,400,1240,700,,,12],[1,2,"police_car","üöì",200,200,2e3,950],[1,2,"police_car","üöì",200,200,2600,950],[1,30,"courthouse","üèõÔ∏è",400,400,2200,700,,,13],[1,30,"bank","üè¶",400,400,3160,700,,,14],[1,2,"lorry","üöõ",200,200,4040,950],[1,2,"lorry","üöö",200,200,4460,950],[1,30,"building_site","üèóÔ∏è",400,400,4120,700,,,15],[11,0,"office_worker","üë®‚Äçüíº",200,150,380,450,,1002],[11,1,"ticket","üéüÔ∏è",40,40,380,670,,1002],[12,0,"doctor","üë©‚Äç‚öïÔ∏è",200,150,1340,450,,1002],[13,0,"judge","üë©‚Äç‚öñÔ∏è",200,150,2300,450,,1002],[14,0,"bank_teller","üë©‚Äçüíº",200,150,3260,450,,1002],[14,1,"cash","üíµ",40,40,3260,670,,1002],[15,0,"builder","üë∑",200,150,4220,450,,1002],[2,2,"tree","üå¥",300,300,50,825,30],[2,2,"tree","üå¥",300,300,810,825,30],[2,2,"tree","üå¥",300,300,1770,825,30],[2,2,"tree","üå¥",300,300,2730,825,30],[2,2,"tree","üå¥",300,300,3690,825,30],[2,30,"pharmacy","üè¨",400,400,280,700,,,16],[2,2,"shopping_cart","üõí",100,100,720,650],[2,30,"store","üè™",400,400,1240,700,,,17],[2,30,"post_office","üè§",400,400,2200,700,,,18],[2,30,"hotel","üè®",400,400,3160,700,,,19],[2,30,"house","üè†",400,400,4120,700,,,20],[16,0,"salesperson","üôé‚Äç‚ôÇÔ∏è",200,150,380,450,,1002],[16,1,"syringe","üíâ",40,40,455,670,,1002],[17,0,"cashier","üôéüèΩ‚Äç‚ôÄÔ∏è",200,150,1340,450,,1002],[17,1,"banana","üçå",40,40,1340,670,,1002],[18,0,"self_service","üñ•Ô∏è",200,150,2300,450,,1002],[19,1,"bellhop","üõéÔ∏è",40,40,3260,670,,1002],[19,0,"hotel_clerk","ü§µ",200,150,3260,450,,1002],[3,30,"house","üè†",400,400,330,700,,,20],[3,2,"tree","üå≥",300,300,810,650],[3,2,"tree","üå≥",300,300,1770,650],[3,2,"tree","üå≥",300,300,2730,650],[3,2,"tree","üå≤",300,300,3690,650],[3,2,"car","üöô",200,200,800,950],[3,30,"house","üè°",400,400,1240,700,,,20],[3,1,"tulip","üå∑",30,30,1190,680],[3,2,"car","üöó",200,200,1900,950],[3,2,"minivan","üöê",200,200,3e3,950],[3,2,"jack-o-lantern","üéÉ",50,50,2140,690],[3,30,"halloween_house","üè†",400,400,2200,700,,,21],[3,2,"jack-o-lantern","üéÉ",50,50,2610,690],[3,30,"house","üè°",400,400,3160,700,,,20],[3,1,"rose","üåπ",30,30,3600,680],[3,2,"scooter","üõµ",150,150,4460,950],[3,30,"house","üè†",400,400,4120,700,,,20],[21,0,"family","üë®‚Äçüë©‚Äçüë¶",200,150,2300,450,,1002],[21,1,"candy","üç¨",40,40,2300,670,,1002],[4,14,"woods",null,300,300,-50,650],[4,2,"tree","üå≤",300,300,-150,650],[4,2,"tree","üå≤",300,300,350,600],[4,66,"tree","üå≤",300,300,150,550],[4,130,"elephant","üêò",200,200,150,600],[4,2,"chipmunk","üêøÔ∏è",50,50,900,600],[4,14,"feeding_hole","üï≥Ô∏è",80,20,1100,650],[4,30,"circus","üé™",400,400,1240,650,,,22],[4,2,"fountain","‚õ≤",200,200,2300,600],[4,14,"mountain","‚õ∞Ô∏è",350,350,3160,350,,99],[4,14,"castle_path",null,300,300,3160,700,,100],[4,2,"bus","üöå",250,250,4900,950],[4,2,"bus_stop","üöè",50,200,4800,825],[4,1,"briefcase","üíº",40,40,4790,820],[4,2,"bicyle","üö≤",100,100,4450,600],[4,2,"goal_net","ü•Ö",100,100,4200,500],[4,2,"moai_statue","üóø",100,200,3500,650],[4,130,"moai_statue","üóø",100,200,3025,650],[4,30,"school","üè´",400,400,5080,700,,,23],[4,2,"tractor","üöú",200,200,5900,950],[4,30,"barn","üèöÔ∏è",400,400,6100,540,,,24],[4,2,"cow","üêÑ",100,100,5800,500],[4,2,"sheep","üêè",100,100,6e3,620],[4,2,"sheep","üêë",100,100,6350,620],[4,2,"sheep","üêë",100,100,5600,560],[22,0,"clown","ü§°",200,150,1340,450,,1002],[22,1,"mask","üëπ",40,40,1340,670,,1002],[23,0,"teacher","üë©‚Äçüè´",200,150,5180,450,,1002],[24,0,"farmer","üë®‚Äçüåæ",200,150,6150,450,,1002],[5,2,"tree","üå¥",300,300,50,825,30],[5,2,"tree","üå¥",300,300,810,825,30],[5,2,"tree","üå¥",300,300,1770,825,30],[5,30,"church","‚õ™",350,350,1240,700,,,25],[5,2,"car","üöô",200,200,2100,950],[5,30,"house","üè†",400,400,2200,700,,,20],[25,0,"bride","üë∞",200,150,1315,450,,1002],[25,1,"lipstick","üíÑ",40,40,1340,670,,1002],[6,2,"pump","‚õΩ",120,120,150,825],[6,2,"pump","‚õΩ",120,120,620,825],[6,2,"pump","‚õΩ",120,120,1090,825],[6,30,"factory","üè≠",350,350,350,600,,499,26],[6,30,"factory","üè≠",350,350,800,600,,499,26],[6,6,"oil_drum","üõ¢Ô∏è",100,100,820,680],[6,6,"oil_drum","üõ¢Ô∏è",100,100,930,680],[6,2,"car","üöô",200,200,350,950],[6,30,"garage","üèöÔ∏è",400,400,1240,700,,,27],[26,0,"factory_worker","üë®‚Äçüè≠",200,150,425,450,,1002],[27,0,"mechanic","üë©‚Äçüîß",200,150,1340,450,,1002],[7,30,"castle","üè∞",600,400,180,630,,,28],[7,2,"tree","üå≤",300,300,-150,650],[7,2,"tree","üå≤",300,300,810,650],[28,0,"guard","üíÇ",200,150,380,450,,1002],[28,1,"map","üó∫Ô∏è",40,40,380,670,,1002],[8,22,"coffin","‚ö∞Ô∏è",100,100,180,660,,,29],[8,2,"tree","üå≤",300,300,-150,650],[8,2,"tree","üå≤",300,300,350,650],[8,66,"tree","üå≤",300,300,250,550],[8,2,"tree","üå≤",350,350,-150,850],[8,2,"tree","üå≥",400,400,800,600],[8,18,"door","üö™",100,200,1250,500,,,30],[29,0,"boy","üë§",200,150,380,450,,1002],[30,0,"goblin","üë∫",200,150,860,450,,1002],[30,1,"crystal_ball","üîÆ",40,40,860,670,,1002],[9,2,"tree","üå¥",300,300,50,825,30],[9,2,"tree","üå¥",300,300,810,825,30],[9,2,"tree","üå¥",300,300,1770,825,30],[9,2,"mailbox","üì´",80,80,1150,680],[9,30,"my_house","üè†",400,400,1240,700,,,31],[9,30,"house","üè°",400,400,2200,700,,,20],[31,1,"bank_card","üí≥",40,40,1340,670,,1002],[10,2,"tree","üå¥",300,300,50,825,30],[10,2,"tree","üå¥",300,300,810,825,30],[10,2,"tree","üå¥",300,300,1770,825,30],[10,1,"palm_nut","üå∞",30,30,2e3,825],[10,30,"house","üè°",400,400,280,700,,,20],[10,30,"derelict_house","üèöÔ∏è",400,400,1240,700,,,20],[0,14,"wall",null,6720,114,0,620,,500],[0,14,"road",null,6720,50,0,985,,100],[0,14,"left_path",null,100,305,null,866,,501],[0,14,"right_path",null,100,305,null,866,,501]];i=[];constructor(){this.Et=document.getElementById("screen"),this.wrap=document.getElementById("wrap"),this.zt=document.getElementById("overlay"),this.Ct=document.getElementById("itemlist"),this.Zt=document.getElementById("sentence"),this.Jt=document.getElementById("commands"),this.status=document.getElementById("status"),this.Qt=document.getElementById("msg"),customElements.define("x-sprite",s),customElements.define("x-ego",h),customElements.define("x-shadow",class t extends HTMLElement{}),customElements.define("x-wall",class t extends HTMLElement{}),this.Vt=new t(this),this.Xt=new o,this.yt=new Map,this.te(),onresize=t=>this.te(t),document.getElementById("up").onclick=t=>this.ee(1),document.getElementById("down").onclick=t=>this.ee(-1),this.Jt.querySelectorAll("*").forEach(t=>{t.onclick=t=>{this.command=this.U=t.target.dataset.name,this.R=t.target.innerText}});let i=navigator.userAgent.match(/Firefox/)?32:50;this.G={},(e.Z?["üö∂","ü§öüèº","‚¨ÜÔ∏è","üí¨","‚¨áÔ∏è","‚è≥","‚ÜñÔ∏è","üëÅÔ∏è","‚¨ÖÔ∏è","‚ûï","‚ÜóÔ∏è","ü§èüèº","‚û°Ô∏è","‚ùî","‚ÜôÔ∏è","üîç","‚ÜòÔ∏è"]:["üö∂","ü§öüèº","ü°±","üí¨","ü°≥","‚è≥","ü°¥","üëÅÔ∏è","ü°∞","‚ûï","ü°µ","ü§èüèº","ü°≤","‚ùî","ü°∑","üîç","ü°∂"]).forEach((t,s)=>{let h=[i-1,i/2][s%2];this.G[t]=`url(${e.K(t,i,i)[0].toDataURL()}) ${i/2} ${h}, auto`,document.body.style.setProperty("--"+t,this.G[t])}),this.R="üö∂",this.se=0,this.N(this.wrap),onclick=t=>{this.se||(this.se=1,onclick=null,document.fullscreenEnabled&&document.documentElement.requestFullscreen(),this.N(this.Qt),setTimeout(()=>{this.Qt.style.display="none",this.Xt.Kt(),this.et(),this.loop()},200))}}et(){this.Et.onclick=t=>this.ie(t),this.o=[],this.S=7,this.h=document.createElement("x-ego"),this.h.et(this,50,150),this.h.k(450,750),this.Et.appendChild(this.h),this.O(),this.M=0,this.h.m("Hello!!",100,()=>{this.h.m("I'm detective Pip.",250,()=>{this.h.m("The King has commissioned me to find his missing Page Boy.",300,()=>{this.h.m("He was on his way to deliver a message to The Goblin...",300,()=>{this.h.moveTo(300,740,()=>{this.h.m("...but went missing in the woods to the west.",300,()=>{this.h.moveTo(300,800,()=>{this.h.m("Please help me to find him.",200,()=>{this.h.m("Use the Walk, Look, Pick up, and Talk icons below.",300,()=>{this.M=1,this.N(this.status)})})})})})})})})}),this.he(this.wrap)}add(t){this.Et.appendChild(t),this.o.push(t)}remove(t){try{this.Et.removeChild(t)}catch(t){}this.o=this.o.filter(e=>e!==t)}te(t){this.P=innerWidth/this.wrap.offsetWidth,this.A=innerHeight/this.wrap.offsetHeight,this.wrap.style.setProperty("--scale-x",this.P),this.wrap.style.setProperty("--scale-y",this.A)}loop(t){requestAnimationFrame(t=>this.loop(t)),this.ae(t),this.oe();let e=this.command+" "+this.I;if(e!=this.re&&(this.Zt.innerHTML=this.re=e),this.h.visible){let t=this.h.cx-480;t<0&&(t=0),t>this.v[1]-960&&(t=this.v[1]-960),t!=this.H&&(this.H=t,this.Et.style.setProperty("--screen-left",`-${this.H}px`))}this.h.D&&(this.D=this.h.D,this.S==this.h.S?this.h.ft[0].jt=()=>this.h.m("I didn't find much in that direction.",200):(this.S=this.h.S,this.N(this.wrap),setTimeout(()=>this.O(),200)),this.h.D=0),this.zt.style.display=this.M?"none":"block";let s=this.G[this.M?this.R:"‚è≥"];s!=this.ne&&(this.wrap.style.cursor=s,"üö∂"!=this.R?this.wrap.style.setProperty("--c",s):this.wrap.style.removeProperty("--c")),this.ne=s}ae(t){t&&(this.delta=t-(this.le?this.le:t-16),this.Ht=.06*this.delta,this.le=t)}oe(){let t=this.h;t.Lt(),this.o.forEach(e=>{t.Tt(e)&&t.Wt(e)}),t.ht=0}ie(t){this.M&&(this.command=this.Vt.s(this.U,this.command,this.I,t),this.command==this.U&&(this.command=this.U="Walk to",this.R="üö∂")),t&&t.stopPropagation()}O(){if(this.T=0,this.I="",this.command=this.U="Walk to",this.R="üö∂",this.o.forEach(t=>this.Et.removeChild(t)),this.o=[],this.v=this.$t[this.S-1],this.Et.style.setProperty("--screen-width",this.v[1]+"px"),this.L.forEach(t=>{t[0]!=this.S&&0!=t[0]||this.W(t)}),2&this.v[0]){let t=4&this.v[0]?100:200;for(let e=0;e<this.v[1];e+=t)this.W([0,74,"trees","üå≤",t,t,e,400]);for(let e=-t/2;e<this.v[1];e+=t)this.W([0,10,"trees","üå≤",t,t,e,450])}if(8&this.v[0]){for(let t=0;t<this.v[1];t+=300)this.W([0,66,"trees","üå≤",300,300,t,1100,,990]);for(let t=-150;t<this.v[1];t+=300)this.W([0,2,"trees","üå≤",300,300,t,1150,,991])}if(this.Et.className=(this.v[2]&&4!=this.S?"left ":"")+(this.v[6]?"right":""),this.h.g(),3==this.D){let t=this.h,e=this.o.find(e=>t.Tt(e));e&&(t.k(t.cx<e.cx?e.x-t.width-20:e.x+e.width+20,t.z),t.ft[0].x=t.x)}this.he(this.wrap),this.he(this.h)}W(t){if("wall"==t[2]&&!(1&this.v[0])||"left_path"==t[2]&&!this.v[3]||"right_path"==t[2]&&!this.v[5]||"hotel_clerk"==t[2]&&Math.random()<.5)return;"elephant"==t[2]&&this.i[5]&&this.i[6]&&(this.i[4]=1,t[6]=875,t[11]=null);let e=t[11];e||(e=new s,e.et(this,t[4],t[5],t[3],!(4&t[1]),128&t[1]),e.dataset.name=t[2].replace("_"," "),e.classList.add(t[2]),e.j=t,null!==t[6]&&e.k(t[6],t[7]),16&t[1]&&e.classList.add("bldg"),32&t[1]&&e.classList.add("light"),64&t[1]&&e.classList.add("dark"),8&t[1]&&(e.It=1),t[8]&&(e.ot=t[8]),t[9]&&(e.style.zIndex=t[9]),t[11]=e),t[2].includes("path")&&(e.classList.remove("down"),this.v[3]<0&&e.classList.add("down"),t[11]=null),t[1]||(this.u=e),this.add(e),this.ce(e)}ce(t){t.onmouseleave=t=>this.I="",t.onclick=t=>this.ie(t),t.onmousemove=t=>this.ue(t)}ue(t){let e=t.currentTarget;if(e.canvas){let i=e.getBoundingClientRect(),h=~~((t.clientX-i.left)/this.P),a=~~((t.clientY-i.top)/this.A),{width:o,height:r}=e,n,l;if(!e.canvas.getContext("2d").getImageData(0,0,o,r).data[a*(o<<2)+(h<<2)+3]){let i=document.elementsFromPoint(t.clientX,t.clientY).filter(t=>t instanceof s);e=i[1]?i[1]:null}}this.I=e?e.dataset.name:""}l(t,e){let s=document.createElement("span");s.dataset.name=t,this.Ct.appendChild(s),this.ce(s),this.F[t]=s;let i=this.o.find(e=>e.dataset.name==t);i?(i.j[0]=-1,this.remove(i),s.innerHTML=i.j[3]):s.innerHTML=e}p(t){return this.F.hasOwnProperty(t)}q(t){let e=this.F[t];this.Ct.removeChild(e),delete this.F[t],this.ee(1)}ee(t){let e=this.Yt+77*t,s=this.Ct.children.length;e<=0&&e>=-77*(s-7)&&(this.Yt=e,this.Ct.style.left=this.Yt+"px")}he(t){t.style.transition="opacity 0.5s",t.style.opacity=1,setTimeout(()=>t.style.removeProperty("transition"),700)}N(t){t.style.transition="opacity 0.5s",t.style.opacity=0}};onload=()=>new r();</script></body></html>