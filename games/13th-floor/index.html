<title>13th Floor - js13kGames 2024</title><body style=margin:0;background-color:#000;display:grid;place-items:center;height:100%><canvas height=1080 id=c3d style="width:min(100vw,calc(100vh * 16/9));position:absolute;aspect-ratio:16/9;color:#fff" width=1920></canvas><div id=tmpl style="width:min(100vw,calc(100vh * 16/9));position:absolute;aspect-ratio:16/9;color:#fff"></div><script>function aa(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t}function ca(t){return new f(t.x,t.y,t.z,t.w)}function g(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t}function da(t,e){return g(t,t,e),t}function ea(t,e,i){var a=e.z*i.x-e.x*i.z,n=e.x*i.y-e.y*i.x;return t.x=e.y*i.z-e.z*i.y,t.y=a,t.z=n,t}function h(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function fa(t){return[t.x,t.y,t.z]}function m(t){var e=t.$;return 0===e?new f:(t.x/=e,t.y/=e,t.z/=e,t)}function ia(t,e,i){t.x+=(e.x-t.x)*i,t.y+=(e.y-t.y)*i,t.z+=(e.z-t.z)*i}function ka(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}class f extends DOMPoint{K(t){return aa(this,this,t),this}set(t,e,i){return t&&"object"==typeof t&&(e=t.y,i=t.z,t=t.x),this.x=t??this.x,this.y=e??this.y,this.z=i??this.z,this}m(t){return this.x*=t,this.y*=t,this.z*=t,this}get $(){return Math.hypot(...fa(this))}}class la{constructor(){this.B=this.l=this.s=this.i=!1,this.A=new f,this.g=new Map,document.addEventListener("keydown",t=>this.g.set(t.code,!0)),document.addEventListener("keyup",t=>this.g.set(t.code,!1)),document.addEventListener("mousedown",()=>this.g.set("KeyE",!0)),document.addEventListener("mouseup",()=>this.g.set("KeyE",!1)),document.addEventListener("mousemove",t=>{this.A.x=t.movementX,this.A.y=t.movementY,this.G?.(this.A)}),this.j=new f}}let p=new la;class r{constructor(t){this.O=t?.O}}class ma{constructor(){this.g=c3d.getContext("webgl2");var t=this.createShader(35633,"#version 300 es\nlayout(location=0) in vec3 L;layout(location=1) in vec3 B;layout(location=2) in vec2 F;layout(location=3) in float H;uniform mat4 I,M,e,l;out vec2 o;out float n;out vec3 u;out mat4 h;out vec4 K;out vec3 t;void main(){vec4 v=vec4(L,1);gl_Position=I*v;o=F;n=H;u=B;h=M;K=e*v;t=(l*v).xyz;}"),e=this.createShader(35632,"#version 300 es\nprecision highp float;\nin vec2 o;in float n;in vec3 u;in mat4 h;in vec3 t;uniform vec3 v,d;vec4 s=vec4(1);uniform mediump sampler2DArray z;uniform mediump samplerCube x;uniform vec3 c,y;vec4 A=vec4(1,1,.8,1);float C=1.,D=.85;vec4 G=vec4(.05,.05,.05,1);out vec4 g;float p(float v,float m,float f,float h){return 1./(v*v*m+v*f+h);}void main(){vec3 m=t-v,l=v-t;float f=length(m);vec3 e=normalize(m),i=normalize(l);float B=texture(x,e).x*40.,E=.015,F=0.;F=B+E<f?0.:1.;vec3 H=normalize(mat3(h)*u);float I=max(0.,dot(i,H)),J=p(f,d.x,d.y,d.z);vec4 K=s*I*J*F;vec3 L=c-t,M=normalize(L);float N=length(L),O=max(0.,dot(M,H)),P=dot(y,-M),Q=smoothstep(D,C,P),R=p(N,.005,.001,.4);vec4 S=A*O*Q*R,T=clamp(G+K+S,G,vec4(1));g=texture(z,vec3(o,n))*T;}");this.i=this.createProgram(t,e),t=this.createShader(35633,"#version 300 es\nprecision highp float;\nlayout(location=0) in vec4 i;uniform mat4 e,l;out vec3 f;void main(){gl_Position=e*i;f=vec3(l*vec4(i.xyz,1));}"),e=this.createShader(35632,"#version 300 es\nprecision highp float;\nuniform vec3 v;in vec3 f;out float m;void main(){m=length(f-v)/40.;}"),this.j=this.createProgram(t,e),t=this.g.getUniformLocation(this.i,"x"),e=this.g.getUniformLocation(this.i,"z"),this.g.useProgram(this.i),this.g.uniform1i(e,0),this.g.uniform1i(t,2)}createShader(t,e){return t=this.g.createShader(t),this.g.shaderSource(t,e),this.g.compileShader(t),t}createProgram(t,e){var i=this.g.createProgram();return this.g.attachShader(i,t),this.g.attachShader(i,e),this.g.linkProgram(i),i}}let t=new ma,z=t.g;class na{constructor(t,e){this.source=e,this.id=t}}function C(t,e){return e=new na(t.g.length,e),t.g.push(e),e}function oa(){var t=E;z.activeTexture(z.TEXTURE0),z.bindTexture(35866,z.createTexture()),z.texStorage3D(35866,8,z.RGBA8,512,512,t.g.length),t.g.forEach((t,e)=>{z.texSubImage3D(35866,0,0,0,e,512,512,1,z.RGBA,z.UNSIGNED_BYTE,t.source)}),z.generateMipmap(35866)}class ra{constructor(){this.g=[]}}let E=new ra;async function sa(t){let e=new Image;return e.src=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),new Promise(t=>e.addEventListener("load",()=>t(e)))}let F={};async function ta(){F.o=new r({O:C(E,await sa('<svg width="512" height="512" xmlns="http://www.w3.org/2000/svg"><filter id="a"><feTurbulence type="fractalNoise" baseFrequency="0.1, 0.007" numOctaves="6" stitchTiles="stitch"/><feComposite in="s" operator="arithmetic" k2=".5" k3=".6"/><feComponentTransfer><feFuncA type="table" tableValues="0, .1, .2, .3, .4, .2, .4"/></feComponentTransfer><feDiffuseLighting color-interpolation-filters="sRGB" surfaceScale="3" lighting-color="#6e3f2b"><feDistantLight azimuth="110" elevation="48"/></feDiffuseLighting></filter><rect height="100%" width="100%" filter="url(#a)"/></svg>'))}),F.face=new r({O:C(E,await sa('<svg style="filter: invert()" width="512" height="512" xmlns="http://www.w3.org/2000/svg"><filter id="a" x="-0.01%" primitiveUnits="objectBoundingBox" width="100%" height="100%"><feTurbulence seed="7" type="fractalNoise" baseFrequency="0.005" numOctaves="5" result="n"/><feComposite in="SourceAlpha" operator="in"/><feDisplacementMap in2="n" scale="0.9"/></filter><rect x="0" y="-14" width="100%" height="100%" id="l" filter="url(#a)"/><rect fill="#fff" width="100%" height="100%"/><use href="#l" x="22%" y="42" transform="scale(2.2, 1.2)"></use><use href="#l" x="-22%" y="42" transform="rotate(.1) scale(-2.2 1.2)"></use><rect fill="#777" x="220" y="230" width="50" height="50"/></svg>'))}),F.R=new r({O:C(E,await ua("",20))}),F.wa=new r({O:C(E,await ua())}),F.bb=new r({O:C(E,await sa('<svg width="512" height="512" xmlns="http://www.w3.org/2000/svg"><pattern id="a" width="256" height="256" patternUnits="userSpaceOnUse"><circle r="290" fill="#fff"/><path d="M0 0h128v256h128V128H0z"/></pattern><filter id="b"><feTurbulence baseFrequency=".04" numOctaves="5"/><feColorMatrix values="1 -1 0 0 0 1 -1 0 0 0 1 -1 0 0 0 0 0 0 0 0.3"/><feBlend in="SourceGraphic" mode="soft-light"/></filter><rect width="100%" height="100%" fill="url(#a)" filter="url(#b)"/></svg>'))}),F.Ya=new r({O:C(E,await sa('<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512"><pattern id="b" width="512" height="256" patternUnits="userSpaceOnUse"><path d="M8 7h502v248H8z"/></pattern><filter id="a"><feTurbulence type="fractalNoise" baseFrequency=".8" numOctaves="8"/><feComposite in="SourceGraphic" operator="arithmetic" k2=".5" k3=".5"/><feComponentTransfer result="n"><feFuncA type="gamma" exponent="4"/></feComponentTransfer><feDiffuseLighting color-interpolation-filters="sRGB" lighting-color="#fff" surfaceScale="-1" result="d"><feDistantLight azimuth="40" elevation="55"/></feDiffuseLighting></filter><rect width="100%" height="100%" filter="url(#a)" fill="url(#b)"/></svg>'))}),F.jb=new r({O:C(E,await va())}),F.mb=new r({O:C(E,await sa('<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512"><filter id="a"><feTurbulence type="fractalNoise" baseFrequency=".09" numOctaves="2"/><feDiffuseLighting color-interpolation-filters="sRGB" lighting-color="#600" result="d"><feDistantLight azimuth="90" elevation="55"/></feDiffuseLighting></filter><rect width="100%" height="100%" filter="url(#a)"/></svg>'))}),F.S=new r({O:C(E,await wa(!0))}),F.na=new r({O:C(E,await wa())}),F.C=new r({O:C(E,await Aa("#bbb"))}),F.red=new r({O:C(E,await Aa("#b00"))});for(let t=1;t<=13;t++)F[t]=new r({O:C(E,await ua(`<text x="21%" y="42%" font-size="150px" style="transform: scaleY(1.5)">13${t.toString().padStart(2,"0")}</text>`,30))});oa()}function wa(t=!1){return sa(`<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512"><pattern id="b" width="128" height="128" patternUnits="userSpaceOnUse"><path fill="#687A5E" d="M0 0h128v128H0z"/>${t?'<text x="64" y="64" style="font-size:64px" stroke="#506546" fill="#506546">❀</text><text y="128" style="font-size:50px" stroke="#506546" fill="#506546">✦</text>':""}</pattern><filter id="a"><feTurbulence baseFrequency=".4" stitchTiles="stitch"/><feDiffuseLighting color-interpolation-filters="sRGB" lighting-color="#687A5E"><feDistantLight azimuth="120" elevation="45"/></feDiffuseLighting><feBlend in="SourceGraphic" mode="difference"/></filter><rect width="100%" height="100%" filter="url(#a)" fill="url(#b)"/></svg>`)}async function va(){let e=[30,50,70],i=70,a=(t,e,i)=>`<ellipse cx="${t}%" cy="${e}%" rx="40" ry="40" fill="${i<13?"#777":"#ffa"}" stroke="black" stroke-width="4"></ellipse><text x="${t}%" dx="${9<i?-30:-14}" y="${e}%" dy="18" style="font-weight: bold; font-size: 60px;">${i}</text>`,n=a(50,90,1);for(let t=0;t<12;t++){var s=t%3;0<t&&0==s&&(i-=20),n+=a(e[s],i,t+2)}return ua(n,30)}function ua(t="",e=1){return sa(`<svg width="512" height="512" xmlns="http://www.w3.org/2000/svg"><filter id="b"><feTurbulence baseFrequency="0.01,0.0008" numOctaves="2" seed="23" type="fractalNoise" stitchTiles="stitch" /><feColorMatrix values="${e*=.01}, ${e}, ${e}, 0, 0,${e}, ${e}, ${e}, 0, 0,${e}, ${e}, ${e}, 0, 0,1, 1, 1, 1, 1"/></filter><rect x="0" y="0" width="100%" height="100%" filter="url(#b)"/>${t}</svg>`)}function Aa(t){return sa(`<svg width="512" height="512" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="100%" height="100%" fill="${t}"/></svg>`)}function Ba(t){return Math.floor((t.x+90)/15)+12*Math.floor((t.z+90)/15)}function Ca(t,e){return[t=Ba(t),t-1-12,t-12,t+1-12,t-1,t+1,t-1+12,t+12,t+1+12].filter(t=>0<=t&&t<e)}function Da(t){let i=[];return t.forEach(e=>{e.Aa.map(Ba).forEach(t=>{i[t]||(i[t]=new Set),i[t].add(e)})}),i}let Ea=new f(0,1,0),Fa=new f(0,-1,0);function Ga(t,e){for(var i of t)if(!ka(i.D,Fa)&&!ka(i.D,Ea)){t:{t=e.Za;var a=i;if(!(h(g(new f,t.Fa,a.Aa[0]),a.D)<0)){var a=Ha(t.Fa,a.Aa[0],a.Aa[1],a.Aa[2]),n=h(a=g(new f,t.Fa,a),a);if(n<=t.Ra*t.Ra){t={Pa:m(a),lb:t.Ra-Math.sqrt(n)};break t}}t=void 0}t&&(a=t.Pa.m(t.lb+1e-8),e.Za.Fa.K(a),t=t.Pa.m(h(e.aa,t.Pa)),da(e.aa,t),.6<=i.D.y&&e.aa.y<0||i.D.y<=-.6&&0<e.aa.y)&&(e.aa.y=0)}}function Ha(t,e,i,a){var n,s,r,o=g(new f,i,e),c=g(new f,a,e),l=g(new f,t,e),u=h(o,l),w=h(c,l);return u<=0&&w<=0?e:(n=h(o,l=g(new f,t,i)),s=h(c,l),0<=n&&s<=n?i:(l=u*s-n*w)<=0&&0<=u&&n<=0?(c=u/(u-n),aa(new f,e,(new f).set(o).m(c))):(t=h(o,r=g(new f,t,a)),0<=(r=h(c,r))&&t<=r?a:(u=t*w-u*r)<=0&&0<=w&&r<=0?(o=w/(w-r),aa(new f,e,(new f).set(c).m(o))):(w=n*r-t*s)<=0&&0<=s-n&&0<=t-r?(e=(s-n)/(s-n+(t-r)),e=g(new f,a,i).m(e),aa(new f,i,e)):(a=u*(i=1/(w+u+l)),i*=l,o=(new f).set(o).m(a),c=(new f).set(c).m(i),aa(new f,o,c).K(e))))}let G=new AudioContext,Ja=G.createDynamicsCompressor(),Ka=G.createBiquadFilter(),La=(Ka.type="lowshelf",Ka.frequency.value=500,Ka.gain.value=20,Ka.connect(Ja),Ja.threshold.value=-50,Ja.knee.value=40,Ja.ratio.value=12,Ja.connect(G.destination),.5*G.sampleRate),Ma={};Ma.n0=G.createBuffer(1,La,G.sampleRate),Ma.n1=G.createBuffer(1,La,G.sampleRate);for(let t=0;t<La;++t)Ma.n0.getChannelData(0)[t]=2*Math.random()-1;for(let t=0;t<64;++t){let i=10*Math.random()+1,a=10*Math.random()+1;for(let e=0;e<La;++e){let t=Math.sin(e/La*2*Math.PI*440*i)*Math.sin(e/La*2*Math.PI*440*a);Ma.n1.getChannelData(0)[e]+=t/8}}function Na(t,e,i,a){0!=a?t.setTargetAtTime(e,i,a):t.setValueAtTime(e,i)}function H(e,i,a,n,s,r){let o,h=[],c=[],f=[],l=[],u=440*2**((a-69)/12);for(let t=0;t<s.length;++t){var w,g=s[t];for(0===g.N?(w=e.g,o=n*n/16384,l[t]=u*g.t+g.f):(o=h[g.N-1].frequency?(w=h[g.N-1].frequency,l[g.N-1]):(w=h[g.N-1].playbackRate,l[g.N-1]/440),l[t]=l[g.N-1]*g.t+g.f),"n"===g.w[0]?(h[t]=G.createBufferSource(),h[t].buffer=Ma[g.w],h[t].loop=!0,h[t].playbackRate.value=l[t]/440,1!=g.p&&Na(h[t].playbackRate,l[t]/440*g.p,i,g.q)):(h[t]=G.createOscillator(),h[t].frequency.value=l[t],1!=g.p&&Na(h[t].frequency,l[t]*g.p,i,g.q),h[t].type=g.w),h[t].detune&&(e.j.connect(h[t].detune),h[t].detune.value=e.i),c[t]=G.createGain(),g.r,h[t].connect(c[t]),c[t].connect(w),f[t]=o*g.F,g.k&&(f[t]*=2**((a-60)/12*g.k)),g.a?(c[t].gain.value=0,c[t].gain.setValueAtTime(0,i),c[t].gain.linearRampToValueAtTime(f[t],i+g.a)):c[t].gain.setValueAtTime(f[t],i),Na(c[t].gain,g.fa*f[t],i+g.a+g.da,g.d),h[t].start(i),w=c.length-1;0<=w;--w)c[w].gain.cancelScheduledValues(g.d+r),Na(c[w].gain,0,r,g.d),h[t].stop(r+g.d)}}class Oa{constructor(){this.g=G.createGain(),this.j=G.createGain(),this.i=0}}let I={N:0,w:"sine",t:1,f:0,F:.5,a:0,da:.01,d:.01,fa:0,r:.05,p:1,q:1,k:0},Pa=[{...I,w:"triangle",F:.7,t:.5,d:.2,r:.2,p:.95},{...I,w:"n1",F:9,N:1,d:.2,r:.2}],Qa=[{...I,w:"sawtooth",F:.4,a:.1,d:.2},{...I,w:"sine",F:5,d:.2,fa:.2,N:1}],Ra=[{...I,w:"square",F:.1,a:.1,d:.5,fa:.5,r:.08},{...I,w:"sine",F:1,d:.1,fa:4,N:1}],Sa=[{...I,w:"sawtooth",F:.4,a:.1,d:1,p:2,q:1.5},{...I,N:1,w:"n1",F:.8,f:11,d:11,fa:.2}],Ta=[{...I,w:"n0",F:.2,a:.05,da:.02,d:.02,r:.02}],Ua=[{...I,w:"n0",p:0,r:.01,da:0,F:.3}],Va=[{...I,w:"sine",f:1651,F:.15,d:.5,r:.2,da:0,t:0},{...I,w:"sawtooth",N:1,t:1.21,F:7.2,d:.1,r:11,da:1},{...I,N:1,w:"n0",F:3.1,t:.152,d:.002,r:.002}],Wa=[{...I,w:"sine",t:0,f:100,a:.2,d:1,r:2,fa:1,q:7},{...I,N:1,w:"n1",F:.7,t:.9,d:1,fa:1,r:1.5,f:40}],Xa=[{...I,w:"triangle",t:0,f:88,F:1,d:.05,da:.03,p:.5,q:.1},{...I,w:"n0",N:1,t:5,F:42,r:.01,da:0,p:0}],Ya=[{...I,w:"sine",t:0,f:90,F:1,d:1,da:.5,p:.5,q:.5,a:1,fa:.5,r:1},{...I,w:"n0",N:1,t:5,F:3.6,r:1,da:.5,p:0,f:40,a:1,d:.75,fa:.5}],Za="2P(322P*322P,322P.322Q0322P2322P4322Q6322R8322R:322R<322R>322S@322RB322RD322SF322MH322MJ322ML322MN322NP322MR322MT322NV3235(B<32(B<3/(B<3/8B<3,8B<3)8B<36HB<33HB<30HB<".match(/.{5}/g).map(t=>[t.charCodeAt(0)-50,t.charCodeAt(1),(t.charCodeAt(2)-40)/8,(t.charCodeAt(3)-50)/8,t.charCodeAt(4)-20]);var $a=new f(0,7,0),ab=(new f(1,1,1),new f(.008,.01,.4)),bb=new f,cb=new f;new f(1,1,1);class db{constructor(t){this.Fa=t,this.Ra=2}}function fb(t){t.ia+=50,t.ia=Math.min(t.ia,100)}function gb(t,e){t.s.set(t.M),t.W=!0,t.g.position.set(e.position),t.J.set(e.J),H(t.j,G.currentTime,30,40,Ta,G.currentTime+1)}function hb(t){t.W=!1,t.M.set(t.s),H(t.j,G.currentTime,38,40,Ta,G.currentTime+1)}function ib(t){var e=Math.sin(t.J.y)*p.j.y*.24,i=Math.sin(t.J.y+Math.PI/2)*p.j.x*.24;t.aa.z=Math.cos(t.J.y)*p.j.y*.24+Math.cos(t.J.y+Math.PI/2)*p.j.x*.24,t.aa.x=e+i,m(t.aa).m(.24),p.s&&!p.B&&(H(t.j,G.currentTime,31+(t.xa?0:10),40,Ua,G.currentTime+1),t.xa=!t.xa)}function jb(t){t.i.positionX?(t.i.positionX.value=t.g.position.x,t.i.positionY.value=t.g.position.y,t.i.positionZ.value=t.g.position.z,t.i.forwardX.value=t.D.x,t.i.forwardY.value=t.D.y,t.i.forwardZ.value=t.D.z):(t.i.setPosition(...fa(t.g.position)),t.i.setOrientation(t.D.x,t.D.y,t.D.z,0,1,0))}function kb(a,e){a.l&&-1!==a.l&&(tmpl.innerHTML+=`<div style="font-size: 30px; text-align: center; position: absolute; bottom: 50px; right: 80px;">🗝️ #${a.l}</div>`),tmpl.innerHTML+=`<div style="font-size: 40px; text-align: center; position: absolute; bottom: 10px; right: 280px; color: #b00;">♥ <div style="position: absolute; bottom: 13px; left: 30px; width: ${2*a.ia}px; height: 20px; background-color: #b00;"></div></div>`;let n=1/0;[a.H,...lb(a.H)].forEach(t=>{var e=g(new f,a.M,t.position),i=e.$;i<n&&(a.H=t,n=i,a.va=e)}),a.ya||a.W?a.aa.set(0,0,0):ib(a),a.W?p.i&&!p.l&&hb(a):(Ca(a.M,e.length).forEach(t=>Ga(e[t],a)),a.M.K(a.aa),a.M.y=2.5,a.g.position.set(a.M),a.g.position.y+=3.5),mb(a.g,...fa(a.J)),a.D.set(0,0,-1),a.D.set(a.g.sa.transformPoint(a.D)),bb.set(a.g.position),cb.set(a.D),a.xa&&!a.W||(bb.y=-100),nb(a.g),jb(a)}class ob{constructor(){var t=new pb(Math.PI/3,16/9,1,500),e=qb[0];this.M=new f,this.aa=new f,this.ya=!1,this.J=new f,this.W=!1,this.s=new f,this.va=new f,this.xa=!1,this.D=new f,this.ia=100,this.j=new Oa,this.j.g.connect(Ja),this.H=e,this.M.set(2,2.5,-2),this.Za=new db(this.M),this.g=t,this.i=G.listener,p.G=t=>{this.ya||(this.J.x+=-.001*t.y,this.J.y+=-.001*t.x,this.J.x=Math.min(Math.max(this.J.x,-Math.PI/2),Math.PI/2),this.J.y%=2*Math.PI)}}}function J(t){return 180/Math.PI*t}function rb(t){var e=da(ca(t[2]),t[1]);return t=da(ca(t[0]),t[1]),ea(new f,e,t)}function mb(t,e,i,a){t.sa=new DOMMatrix,t.I.set(J(e),J(i),J(a)),t.sa.rotateSelf(J(e),J(i),J(a))}function nb(t){t.s=sb(t),t.za?t.T=t.za.T.multiply(t.s):t.T=DOMMatrix.fromMatrix(t.s),t.ha.forEach(t=>nb(t))}function sb(t){var e=new DOMMatrix;return e.translateSelf(t.position.x,t.position.y,t.position.z),t.B?e.multiplySelf(t.sa):e.rotateSelf(t.I.x,t.I.y,t.I.z),e.scaleSelf(t.m.x,t.m.y,t.m.z),e}function tb(t){var e=[];return function e(t,i){t.ha.forEach(t=>{i.push(t),e(t,i)})}(t,e),e}function ub(t,e){t.B=!0,m(g(t.g,t.position,e)),m(ea(t.i,t.ma,t.g)),m(ea(t.j,t.g,t.i)),t.sa=new DOMMatrix([t.i.x,t.i.y,t.i.z,0,t.j.x,t.j.y,t.j.z,0,t.g.x,t.g.y,t.g.z,0,0,0,0,1])}class vb{constructor(...t){this.I=new f,this.B=!1,this.i=new f,this.j=new f,this.g=new f,this.position=new f,this.m=new f(1,1,1),this.ha=[],this.s=new DOMMatrix,this.T=new DOMMatrix,this.ma=new f(0,1,0),this.sa=new DOMMatrix,t&&this.K(...t)}K(...t){t.forEach(t=>{t.za&&(t.za.ha=t.za.ha.filter(t=>t!==this)),(t.za=this).ha.push(t)})}A(e){this.ha=this.ha.filter(t=>t!==e)}v(t,e,i){this.I.K({x:J(t),y:J(e),z:J(i)}),this.sa.rotateSelf(J(t),J(e),J(i))}}class wb extends vb{constructor(){super(...arguments),this.Ba=[]}K(...t){super.K(...t),[...t,...t.flatMap(t=>tb(t))].forEach(t=>{t.ca&&(xb(t.ca),this.Ba.push(t))})}A(t){super.A(t),[t,...tb(t)].forEach(e=>{e.ca&&(this.Ba=this.Ba.filter(t=>t!==e))})}}class pb extends vb{constructor(t,e,i,a){super(),t=Math.tan(.5*Math.PI-.5*t);var n=1/(i-a);this.fb=new DOMMatrix([t/e,0,0,0,0,t,0,0,0,0,(i+a)*n,-1,0,0,i*a*n*2,0])}}class K extends vb{constructor(t,e){super(),this.ca=t,this.kb=e}}class yb{constructor(t){this.Aa=t,this.D=m(rb(t))}}function zb(t,e,i){return(new f).set(i.transformPoint(new f(e[t],e[t+1],e[t+2])))}function Ab(t){return t.flatMap(e=>{var i=e.ca.ba,a=e.ca.V.get(0),n=[];for(let t=0;t<i.length;t+=3){var s=3*i[t+1],r=3*i[t+2],o=zb(3*i[t],a.data,e.T),s=zb(s,a.data,e.T),r=zb(r,a.data,e.T);n.push([o,s,r])}return n.map(t=>new yb(t))})}function Bb(t){var e=Cb;z.activeTexture(z.TEXTURE2),z.bindFramebuffer(36160,e.i),z.viewport(0,0,e.size,e.size),z.framebufferTexture2D(36160,36064,34069+t,e.g,0)}class Db{constructor(){this.size=1024,z.activeTexture(z.TEXTURE2),this.j=z.createTexture(),z.bindTexture(3553,this.j),z.texStorage2D(3553,1,z.DEPTH_COMPONENT32F,1024,1024),this.g=z.createTexture(),z.bindTexture(34067,this.g),z.texParameteri(34067,10241,z.LINEAR),z.texParameteri(34067,10240,z.LINEAR),z.texParameteri(34067,z.TEXTURE_WRAP_S,33071),z.texParameteri(34067,z.TEXTURE_WRAP_T,33071),z.texParameteri(34067,z.TEXTURE_WRAP_R,33071);for(let t=0;t<6;t++)z.texImage2D(34069+t,0,z.RGBA32F,1024,1024,0,z.RGBA,z.FLOAT,null);this.i=z.createFramebuffer(),z.bindFramebuffer(36160,this.i),z.framebufferTexture2D(36160,z.DEPTH_ATTACHMENT,3553,this.j,0),z.readBuffer(z.NONE)}}z.enable(z.CULL_FACE),z.enable(z.DEPTH_TEST),z.blendFunc(z.SRC_ALPHA,771),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!0),z.getExtension("EXT_color_buffer_float"),z.getExtension("OES_texture_float_linear");let Eb=z.getUniformLocation(t.i,"I"),Fb=z.getUniformLocation(t.i,"M"),Gb=z.getUniformLocation(t.i,"d"),Hb=z.getUniformLocation(t.i,"c"),Ib=z.getUniformLocation(t.i,"y"),Jb=z.getUniformLocation(t.j,"l"),Kb=z.getUniformLocation(t.j,"v"),Lb=z.getUniformLocation(t.j,"e"),Mb=z.getUniformLocation(t.i,"l"),Nb=z.getUniformLocation(t.i,"v"),Ob=(z.useProgram(t.i),new pb(Math.PI/2,1,.1,60));function Pb(t,e,i){e=m(g(new f,e,t)),i=m(ea(new f,e,i));var a=ea(new f,i,e);return e=new f(-1*e.x,-1*e.y,-1*e.z),new DOMMatrix([i.x,a.x,e.x,0,i.y,a.y,e.y,0,i.z,a.z,e.z,0,-h(i,t),-h(a,t),-h(e,t),1])}let Cb=new Db;function Qb(e,a){let i=e.T.inverse(),n=e.fb.multiply(i);z.useProgram(t.j),z.disable(z.BLEND),z.uniform3fv(Kb,fa($a)),[{target:new f(1,0,0),ma:new f(0,-1,0)},{target:new f(-1,0,0),ma:new f(0,-1,0)},{target:new f(0,1,0),ma:new f(0,0,1)},{target:new f(0,-1,0),ma:new f(0,0,-1)},{target:new f(0,0,1),ma:new f(0,-1,0)},{target:new f(0,0,-1),ma:new f(0,-1,0)}].forEach((t,e)=>{Bb(e),z.clearColor(1,1,1,1),z.clear(16640),t=Pb($a,aa(new f,$a,t.target),t.ma);let i=Ob.fb.multiply(t);a.Ba.forEach(t=>{z.bindVertexArray(t.ca.Ta),z.uniformMatrix4fv(Jb,!1,t.T.toFloat32Array()),z.uniformMatrix4fv(Lb,!1,i.multiply(t.T).toFloat32Array()),z.drawElements(z.TRIANGLES,t.ca.ba.length,5123,0)})}),z.useProgram(t.i),z.enable(z.BLEND),z.uniform3fv(Nb,fa($a)),z.uniform3fv(Hb,fa(bb)),z.uniform3fv(Ib,fa(cb)),z.uniform3fv(Gb,fa(ab)),z.activeTexture(z.TEXTURE0),z.texParameteri(35866,10241,9987),z.viewport(0,0,z.canvas.width,z.canvas.height),z.bindFramebuffer(36160,null),z.cullFace(z.BACK),z.clearColor(0,0,0,0),z.clear(16640),a.Ba.forEach(e=>{z.useProgram(t.i);var i=n.multiply(e.T);z.vertexAttrib1f(3,e.kb.O?.id??-1),z.bindVertexArray(e.ca.Ta),z.uniformMatrix4fv(Fb,!0,e.color?e.nb:e.T.inverse().toFloat32Array()),z.uniformMatrix4fv(Mb,!1,e.T.toFloat32Array()),z.uniformMatrix4fv(Eb,!1,i.toFloat32Array()),z.drawElements(z.TRIANGLES,e.ca.ba.length,5123,0)}),z.bindVertexArray(null)}function Rb(t,e,i){return Array((t+1)*(e+1)).fill().map(()=>i.O.id)}function xb(t){let e=[...t.V.values()].reduce((t,e)=>t+e.data.length,0),i=new Float32Array(e),a=(z.bindBuffer(34962,z.createBuffer()),z.bindVertexArray(t.Ta),0),n=0;t.V.forEach((t,e)=>{z.vertexAttribPointer(e,t.size,z.FLOAT,!1,0,a),z.enableVertexAttribArray(e),i.set(t.data,n),a+=t.data.length*t.data.BYTES_PER_ELEMENT,n+=t.data.length}),z.bufferData(34962,i,z.STATIC_DRAW),z.bindBuffer(34963,z.createBuffer()),z.bufferData(34963,t.ba,z.STATIC_DRAW)}function Sb(t,e,i,a){t.V.set(e,{data:i,size:a})}function L(t,e,i,a,n,s,r){return e=[...Rb(t.i,t.j,e),...Rb(t.i,t.j,i??e),...Rb(t.l,t.i,a??e),...Rb(t.l,t.i,n??e),...Rb(t.l,t.j,s??e),...Rb(t.l,t.j,r??e)],Sb(t,3,new Float32Array(e),1),t}function P(e,i=!1){var a=e.P.map(()=>new f);i=i?Tb(e):e.ba;for(let t=0;t<i.length;t+=3){var n=rb([e.P[i[t]],e.P[i[t+1]],e.P[i[t+2]]]);a[i[t]].K(n),a[i[t+1]].K(n),a[i[t+2]].K(n)}return Sb(e,1,new Float32Array(a.flatMap(t=>fa(m(t)))),3),e}function Q(t){return Sb(t,0,new Float32Array(t.P.flatMap(t=>fa(t))),3),t}function Ub(t){return t.g=t.P,t}function Vb(t,e){return t.g=t.P.filter(e),t}function Wb(t,e){return t.g.forEach(e),t}function Xb(t,e){return Wb(t,t=>{m(t).m(e)}),t}function R(e,t){var i=t.ba.map(t=>t+e.P.length),a=(e.ba=new Uint16Array([...e.ba,...i]),e.P.push(...t.P),i=e.V.get(2).data,t.V.get(2).data),i=new Float32Array([...i,...a]);return Sb(e,2,i,2),i=e.V.get(1).data,a=t.V.get(1).data,i=new Float32Array([...i,...a]),Sb(e,1,i,3),e.V.get(3)&&(i=e.V.get(3).data,t=t.V.get(3).data,t=new Float32Array([...i,...t]),Sb(e,3,t,1)),e}function Yb(t,i,a="y"){var n={x:0,y:0,z:0};return Wb(t,t=>{var e=t[a];t[a]=0,m(da(t,n)).m(i),t[a]=e}),t}function S(t,i=12,a=12,n=0){let s,r,o=(t.l-1+2)*(t.i-1+2)*2,h=o+(t.i-1+2)*(t.j-1+2)*2,c=t.V.get(2).data;return t.P.forEach((t,e)=>{r=e<o?(s=t.x,t.z):(s=e<h?t.z:t.x,t.y),c.set([s/i+n,r/a],2*e)}),Sb(t,2,c,2),t}function Tb(t){let e=[],n=t.ba.slice();return t.g.forEach(i=>{var a;e.find(t=>ka(i,t))||(e.push(i),a=t.P.findIndex(t=>ka(i,t)),t.P.forEach((t,e)=>{ka(i,t)&&(n[n.indexOf(e)]=a)}))}),n}class T{constructor(t=1,e=1,i=1,a=1,n=1,s=1,r=6){this.P=[],this.g=[],this.V=new Map,this.l=a,this.i=s,this.j=n,this.Ta=z.createVertexArray();let d=[],x=[],T=0,o=(i,a,n,s,r,o,t,h,c,l)=>{var u=o/c,w=t/l,g=(o/=2,t/2),p=h/2;h=c+1,t=l+1;for(let e=0;e<t;e++){var b=e*w-g;for(let t=0;t<h;t++){var m=t*u-o,v=new f;v[i]=m*s,v[a]=b*r,v[n]=p,this.P.push(v),x.push(t/c,1-e/l)}}for(i=0;i<l;i++)for(a=0;a<c;a++)n=T+a+h*(i+1),s=T+(a+1)+h*i,d.push(T+a+h*i,n,s,n,T+(a+1)+h*(i+1),s);T+=h*t};for(t=[["x","z","y",1,1,t,i,e,a,s],["x","z","y",1,-1,t,i,-e,a,s],["z","y","x",-1,-1,i,e,t,s,n],["z","y","x",1,-1,i,e,-t,s,n],["x","y","z",1,-1,t,e,i,a,n],["x","y","z",-1,-1,t,e,-i,a,n]],e=0;e<r;e++)o(...t[e]);Sb(this,2,new Float32Array(x),2),this.ba=new Uint16Array(d),Ub(Q(P(this)))}h(e=0,i=0,a=0){return this.g.forEach(t=>t.K({x:e,y:i,z:a})),this}m(t=1,e=1,i=1){let a=(new DOMMatrix).scaleSelf(t,e,i);return this.g.forEach(t=>t.set(a.transformPoint(t))),this}v(t=0,e=0,i=0){let a=(new DOMMatrix).rotateSelf(J(t),J(e),J(i));return this.g.forEach(t=>t.set(a.transformPoint(t))),this}}function U(a,n,t,s,r=1,o=12,h){let c,e,f=0,l=0;return t.forEach((t,e)=>{var i=a[e];0<t&&(t=S(new T(i,t,r,1,1,1,6).h(f+(0===e?0:i/2),n-t/2),o,o),h&&L(t,...h),c?R(c,t):c=t),0<s[e]&&(t=S(new T(i,s[e],r,1,1,1,6).h(f+(0===e?0:i/2),s[e]/2),o,o),h&&L(t,...h),c?R(c,t):c=t),f+=0===e?i/2:i,l+=i}),e=l,c&&Q(P(Ub(c).h((a[0]-l)/2,0))),[c,e]}function Zb(t,e,i){return t?.h(0,0,i),e?.h(0,0,-i),t&&e?Q(R(t,e)):t??e}function $b(t,e,i,a){return Q(P(R(Zb(t[0],e[0],(i[1]+1)/2),Zb(i[0],a[0],(t[1]-1)/2).v(0,Math.PI/2))))}function ac(t){t.i?t.G():t.g&&t.s()}class bc{constructor(){this.g=this.i=this.j=!1;var t=U([4,7.9,4],12,[12,3,12],[0,0,0],1),e=U([16],12,[12],[],1),i=U([10],12,[12],[],1),a=U([10],12,[12],[],1),t=new K($b(t,e,i,a),F.R),e=new K(Q(R(R(new T(10,.5,.3).h(0,4,-4),new T(.3,.5,6).h(-6,4,0)),new T(.3,.5,6).h(6,4,0))),F.R),i=new K(Q(P(S(new T(1.5,2,1).h(5.4,5,5.2),-2,2,.2).h(0,0,.2))),F.jb),n=[.5,4,.5,4,.5],a=new K(Q($b(U([(a=[1.25,4,.5,4,.5,4,1.25]).reduce((t,e)=>t+e)],9,[0],[0]),U(a,9,[0,9,0,9,0,9,0],[0]),U(n,9,[0,9,0,9,0],[0]),U(n,9,[0,9,0,9,0],[0])).h(0,1.25)),F.o),n=new K(S(new T(15,1.5,10.5),5,5),F.bb);let s=new K(S(Q(new T(15,1.5,10).h(0,12))),F.Ya),r=new K(Q(new T(4,9,.5).h(-2,4.5,5.5)),F.R),o=new K(Q(new T(4,9,.5).h(2,4.5,5.5)),F.R);this.l=t,this.A=new Set(Ab([r,o])),this.B=[t,e,n,s,a,i,r,o],this.G=()=>{-5<r.position.x?(r.position.x-=.035,o.position.x+=.035):this.i=!1,this.j=r.position.x<-1},this.s=()=>{r.position.x<0?(r.position.x+=.04,o.position.x-=.04):this.g=!1,this.j=r.position.x<-1}}}function V(t,e=!1,i=!1){function a(){var t=L(new T(3,3,2),F.o);return i&&R(t,L(new T(1,.2).h(0,1,.6),F.R)),Q(P(t))}var n=U([3,5,15],12,[12,3,12],[0,0,0],1,4,[F.na,,,,,F.S]),s=U([23],12,[12],[],1,4,[F.S,,,,,F.na]),r=U([34],12,[12],[],1,4,[F.S,,,,,F.na]),o=U([34],12,[12],[],1,4,[F.S]),[h]=U([4,5,4],12,[12,3,12],[],1,4,[F.na]),c=(P(h.v(0,Math.PI).h(-10)),S(L(new T(1,12,11.5),F.na).h(-4,6,-6.25),4,4)),f=S(L(new T(3,12,4),F.na).h(-6,6,-9.5),4,4),l=S(R(L(new T(9,3,1),F.na),L(new T(12,.5,1.5).h(2,1.25),F.o)).h(-12,10,-8),4,4),u=Q(L(new T(7,2,8).h(6,2,-6.5),F.C)),w=Q(L(new T(3,1,7).h(-5.5,3,-4),F.C)),g=Q(L(new T(2,3,4.75).h(-14.5,1.5,-.25),F.C)),p=Q(L(new T(7,5,3).h(-11.5,3,-9),F.C)),b=Q(L(new T(4,8,6).h(14,4,5),F.C)),m=L(S(new T(10,2,8).h(-11,-.4,-4),6,6,-.03),F.bb),v=Q(P(R(R(R(R(R(Ub(L(Vb(Wb(Xb(Vb(new T(3,1,7,12,1,12),t=>0<t.y&&Math.hypot(t.x,t.z)<1),1).h(0,-.5),t=>t.y*=-1).h(0,.4,0),t=>-.5<t.y&&Math.hypot(t.x,t.z)<1.3).h(-.2),F.C)),L(Yb(new T(1,1,1,2,1,2),.2).h(1.1,.3,-.5),F.R)),L(Yb(new T(1,1,1,2,1,2),.2).h(1.1,.3,.5),F.R)),L(new T(1,.2,.4).h(.7,.7),F.R)),L(new T(3,3,7).h(.1,-2),F.o)),L(new T(1,4,4).h(1.5,3.2),F.R)).h(-6,3.2,-4),!0)),d=Q(P(R(R(R($b([L(new T(8.5,3,.5),F.C),9.75],[L(new T(8.5,15,.5),F.C),9.75],[L(new T(3.75,15,.5),F.C),2.5],[L(new T(3.75,15,.5),F.C),2.5]),L(new T(8.5,.5,3),F.C)),L(Ub(Vb(Yb(new T(1,1,1,1,3,3),.1,"x"),t=>t.x<0).m(1,3,3)).v(0,0,.5).h(3.75,6.5),F.R)),L(Wb(new T(6,7,.1,10,1,1),t=>t.z=.3*Math.sin(3*t.x)).h(-.5,3.75,2.5).v(-.1),F.C)).h(-11.75,1,-9.5))),x=Q(R(R(R(R(R(R(L(new T(.2,8,6).h(1.5),F.o),L(new T(3,.2,6).h(0,-4),F.o)),L(new T(3,.2,6).h(0,4),F.o)),L(new T(3,8.2,.2).h(0,0,3.1),F.o)),L(new T(3,8.2,.2).h(0,0,-3.1),F.o)),L(new T(.2,8,3).h(-.5,0,-1.75).v(0,.25),F.o)),L(new T(.2,8,3).h(-2.75,0,.8).v(0,.5),F.o)).h(14,4.5,5)),z=()=>Q(P(L(Ub(Vb(Xb(new T(1,1,1,4,3,4),1),t=>.8<Math.abs(t.x)||.8<Math.abs(t.z)).m(.8,1,.8)).m(2,.3).v(.5).h(0,1.3,-3.5),F.C),!0)),z=Q(R(P(R(R(L(Ub(Vb(Vb(new T(7,2,7,8,1,8),t=>4.5<Math.hypot(t.x,t.z)).m(.9,1,.9),t=>3<Math.hypot(t.x,t.z)).m(1,.9,1)).m(1,1,1.2),F.C),z().h(-1.5)),z().h(1.5)),!0),P(R(L(new T(7,7,.5).h(0,0,-4.5),F.o),L(new T(7,1,8.5).h(0,-1.5),F.o)))).h(6,2,-6.5)),y=Q(Ub(R(L(Vb(Yb(new T(2,2,2,6,2,6),1).m(1,1,1.2),t=>0===t.y).m(.7,1,.7).h(0,-.5),F.C),L(new T(2,2,1).h(0,1.5,1.5),F.C))).h(-14.5,1.5,-2.25)),M=a().h(-.25,1.5,-9.5),A=a().h(12.25,1.5,-9.5),E=R(R(a(),a().h(3)),a().h(-3)).v(0,3.14).h(0,1.5,10),G=U([3,5,15],12,[1,1,1],[1,0,1],1.5,4,[F.o]),I=U([23],12,[1],[1],1.5,4,[F.o]),j=U([34],12,[1],[1],1.5,4,[F.o]),C=U([34],12,[1],[1],1.5,4,[F.o]),D=U([4.25,4.5,4.25],12,[1,1,1],[1,0,1],1.5,4,[F.o]),H=U([12],12,[1],[1],1.5,4,[F.o]),B=U([.5,4.5,.5],9,[12,.5,12],[],1.5,4,[F.o]),m=Q(P(R(R(R(R(R($b(j,C,I,G),D[0].v(0,Math.PI).h(-10)),H[0].v(0,Math.PI/2).h(-4,0,-5.25)),B[0].v(0,Math.PI/2).h(-16.5,0,6)),m),R(R(R(R(S(L(new T(1,3.5,3),F.o),4,4).h(-16.6,2.5,10),S(L(new T(1,3.5,15),F.o),4,4).h(-16.6,2.5,-4)),S(L(new T(1,3.5,23),F.o),4,4).h(16.6,2.5,0)),S(L(new T(33,3.5,1),F.o),4,4).h(0,2.5,12.1)),S(L(new T(33,3.5,1),F.o),4,4).h(0,2.5,-12.1)))));return t=L(new T(1,1),F[t]).h(-16.6,5,e?9.5:2.5),n=R(R(R(R($b(r,o,s,n),h),c),f),l),R(R(R(i?R(R(R(R(R(R(R(n,m),t),x),v),d),z),y):R(R(R(R(R(n,u),b),w),g),p),M),A),E)}function cc(t=!1){var e=Q(R(R(R(R(R(R(R(R(R(R(R(R(R(R(R(V(1,!1,t).h(0,0,10),V(2,!1,t).h(0,0,45)),V(3,!1,t).h(0,0,80)),V(5,!1,t).h(-44,0,10)),V(7,!1,t).h(-44,0,45)),V(9,!1,t).h(-44,0,80)),V(4,!0,t).v(0,Math.PI).h(-88,0,10)),V(6,!0,t).v(0,Math.PI).h(-88,0,45)),V(8,!0,t).v(0,Math.PI).h(-88,0,80)),V(10,!0,t).v(0,Math.PI).h(-132,0,10)),V(11,!0,t).v(0,Math.PI).h(-132,0,45)),V(12,!0,t).v(0,Math.PI).h(-132,0,80)).h(66,0,14),U([45,11,45],12,[12,2,12],[],1,4,[F.S])[0]),R(R(R(R(U([45,11,45],12,[12,3,12],[],1,4,[F.S])[0],U([.5,10,.5],9,[12,.5,12],[],1.5,12,[F.o])[0]),L(new T(2,1.5),F[13]).h(0,10,-.1)),$b([S(L(new T(20,12,.5),F.S),6,6),20],[void 0,20],[S(L(new T(19.5,12,.5),F.S),6,6),19],[S(L(new T(19.5,12,.5),F.S),6,6),19]).h(0,6,10)),L(new T(3,3.25,3).h(0,1.5,15),F.o)).h(0,0,118)),U([11,25,10,25,10,25,11],12,[12,0,12,0,12,0,12],[],1,4,[F.S])[0].v(0,Math.PI/2).h(49.5,0,59)),U([11,25,10,25,10,25,11],12,[12,0,12,0,12,0,12],[],1,4,[F.S])[0].v(0,Math.PI/2).h(-49.5,0,59)));return t&&P(R(e,dc())),e}function dc(){var t=[-44,0,44].map(t=>R(R(R(R(R(ec(t,0),ec(t,24.25)),ec(t,35)),ec(t,59.25)),ec(t,70)),ec(t,94.25)));return R(R(t[0],t[1]),t[2])}function ec(t,e){return U([.75,9.5,.75],12,[12,1,12],[],1.25,4,[F.o])[0].h(t,0,11.875+e)}function fc(t,e=!1){t.U=e?1:3,t.ea||(t.ea=!0,t.la*=-1,H(t.l,G.currentTime,10,40,Xa,G.currentTime+1),e&&H(t.l,G.currentTime,72,20,Sa,G.currentTime+1))}class W extends vb{constructor(t,e,i=1,a=1,n,s){super(new K(Q(R(L(new T(5,7.75,.25),F.o),L(Yb(new T(1,1,1,4,4),.2,"z").h(2*i,-.5),F.R))),F.C)),this.G=0,this.pa=!1,this.la=-1,this.ea=!1,this.U=3,this.l=new Oa,this.pa=!!s,this.Qa=new f(t-(n?2*i:0),4.75,e-(n?2*i:0)),this.Y=i,this.Z=a,this.l.g.connect(Ja),this.position.set(t-2*i,4.75,e),this.ha[0].position.x=2*i,this.X=new K(Q(new T(n?1:4,7,n?4:1).h(t-(n?2*i:0),4.75,e-(n?2*i:0))),new r),this.Qa.y-=3,this.ib=new Set(Ab([this.X])),n&&(this.G=this.I.y=90)}Sa(){this.ea&&(this.I.y+=this.Z*this.Y*this.U*this.la,Math.abs(this.I.y)-this.G==(-1===this.la?0:120))&&(this.ea=!1)}}function lb(t){return t.$a().filter(t=>void 0!==t)}function gc(t,e){(t.ra=e).Ga=t}function hc(t,e){(t.Ga=e).ra=t}function X(t,e,i){t.Xa=e,t.Ea=i,e.Ea=t,i.Xa=t}function ic(t,e,i){t.Ga=e,t.ra=i,e.ra=t,i.Ga=t}class Z{constructor(t,e,i,a){this.position=t,this.L=e,this.u=i,this.oa=a}$a(){return[this.Xa,this.Ea,this.ra,this.Ga]}}class jc{constructor(t,e){this.position=t,this.J=e}}class kc{constructor(t,e,i){this.ab=!1,this.qa=(this.u=i)?-1===this.u?new K(Q(P(R(R(R(U([.5,2,.5,2,.5],2,[2,.5,2,.5,2],[],1,4,[F.red])[0],L(new T(5.5,.5),F.red).h(0,-2,0)).v(0,0,-Math.PI/2),L(Ub(Yb(new T(3,4,3,8,1,8),6)).h(0,-5.5),F.C)),L(Ub(Yb(new T(4,1,4,8,1,8),8)).h(0,-8),F.C)).v(0,Math.PI).m(.1,.1,.1))),F.R):new K(Q(R(Yb(new T(1,1,.5,3,3),.75,"z"),U([1,.5,.5,.5],1,[.25,1,.25,1],[0],.3)[0].h(1.75,-.75)).m(.5,.5,.5).h(-.5)),F.R):new K(Q(R(R(L(new T(1.9,1,.5),F.C),L(new T(.75,.2,.75),F.red)),L(new T(.2,.75,.75),F.red))),F.o),this.qa.position.set(t),mb(this.qa,e.x,e.y,e.z),nb(this.qa)}}let qb=[],lc=[],mc=[1304,1306,1308,1310,1311,1312];function nc(t,e,i){var a=mc.includes(e),n=new Z(t,i,e),s=new f(12,0,-1),r=new f(27,0,-3),o=new f(35.5,0,.5),h=new f(12.75,0,-15);return a&&(s.m(-1),r.m(-1),o.m(-1),h.m(-1)),i=new Z(new f(t.x+s.x,t.y,t.z+s.z),i,e,new jc(new f(t.x+h.x,5.5,t.z+h.z),new f(0,a?0:3.14))),t=new Z(new f(t.x+r.x,t.y,t.z+r.z),void 0,e,new jc(new f(t.x+o.x,5.5,t.z+o.z),new f(0,a?-1.7:1.7))),ic(i,a?n:t,a?t:n),n}function oc(t){let l=[...t=[nc(new f(44,2.5,36),1301,t[0]),nc(new f(44,2.5,71),1302,t[1]),nc(new f(44,2.5,106),1303,t[2]),nc(new f(0,2.5,24),1304,t[3]),nc(new f(0,2.5,36),1305,t[4]),nc(new f(0,2.5,59),1306,t[5]),nc(new f(0,2.5,71),1307,t[6]),nc(new f(0,2.5,94),1308,t[7]),nc(new f(0,2.5,106),1309,t[8]),nc(new f(-44,2.5,24),1310,t[9]),nc(new f(-44,2.5,59),1311,t[10]),nc(new f(-44,2.5,94),1312,t[11])]],e=l[Math.floor(Math.random()*(l.length-1))];e.L.pa=!0,function t(i){var e=mc.includes(i.u)?-1:1,e=[[{position:new f(4.25*e,1.75,-7*e),I:new f(0,Math.PI/4)},{position:new f(-4.5*e,.5,-7.5*e),I:new f(0,-Math.PI/2)},{position:new f(-5.5*e,.75,-12.75*e),I:new f(0,0,Math.PI/2)}],[{position:new f(5.25*e,-.75,-12*e),I:new f(0,0,Math.PI/2)},{position:new f(-1*e,-.5,8.4*e),I:new f(0,0,-Math.PI/2)},{position:new f(-2*e,.8,-13.5*e),I:new f(Math.PI/3*-e,0,0)}]];l=l.filter(t=>t!==i);let a,n=0,s=new f;l.forEach(t=>{var e=g(s,i.position,t.position).$;e>n&&(n=e,a=t)}),Math.random()<=.3&&(a=l[Math.floor(Math.random()*(l.length-1))]);var r=lb(i).find(t=>t.oa),o=lb(r).find(t=>t.oa),h=Math.floor(2*Math.random()),c=Math.floor(3*Math.random()),r=[r,o][h];3<l.length?(r.item=new kc(aa(new f,r.position,e[h][c].position),e[h][c].I,a.u),a.L.pa=!0):r.item=2<l.length?new kc(aa(new f,r.position,e[h][c].position),e[h][c].I,1313):new kc(aa(new f,r.position,e[h][c].position),e[h][c].I),lc.push(r.item),1<=l.length&&t(a)}(e);var i=new Z(new f(44,2.5,12)),a=new Z(new f(-44,2.5,12)),n=new Z(new f(44,2.5,118)),s=new Z(new f(-44,2.5,118)),r=new Z(new f(0,2.5,12)),o=new Z(new f(0,2.5,47.5)),h=new Z(new f(0,2.5,82.5)),c=new Z(new f(0,2.5,118.5),void 0,1313),u=(c.item=new kc(new f(0,1.4,20).K(c.position),new f,-1),lc.push(c.item),new Z(new f(44,2.5,47.5))),w=new Z(new f(44,2.5,82.5)),p=new Z(new f(-44,2.5,47.5)),b=new Z(new f(-44,2.5,82.5));return n.ra=s,n.Ea=i,s.Ea=a,i.ra=a,ic(r,i,a),ic(c,n,s),X(h,c,r),X(o,h,r),X(u,n,i),gc(u,o),X(w,n,u),gc(w,h),X(p,s,a),hc(p,o),X(b,s,p),hc(b,h),X(t[0],u,i),X(t[1],w,u),X(t[2],n,w),X(t[9],p,a),X(t[10],b,p),X(t[11],s,b),X(t[3],o,r),X(t[4],o,t[3]),X(t[5],h,o),X(t[6],h,t[5]),X(t[7],c,h),X(t[8],c,t[7]),qb.push(r,i,a,n,s),e}function pc(t,e,...i){t.g.ob?.(),t.g={ka:()=>{}},e.ja?.(...i),t.g=e}class qc{constructor(t){this.g=t,this.g.ja?.()}}function rc(){var t=new K(Q(P(Ub(L(Vb(Vb(Xb(new T(1,1,1,6,6,6),.8).m(1,1.3,.8),t=>.7<t.y).m(3,1,1.5),t=>.8<t.y).m(1.5,8,2),F.wa,F.wa,F.wa,F.wa,F.face,F.wa)).v(Math.PI).h(0,5),!0)),F.face);return t.position.set(0,54,2),t}function sc(t){t.ta.g.gain.linearRampToValueAtTime(0,G.currentTime+1),clearInterval(t.Wa)}function tc(a,t){if(uc(a,t),t.H.oa?vc(a,4,2):vc(a,8,9),!wc(a,t)){if(a.Y>6-2*xc(a))ia(a.A,a.X,xc(a)/4),yc(a);else{yc(a);let i=a.g;a.g=a.i,Math.random()<a.l/3?zc(a,t.H):(1<(t=lb(a.g)).length&&(t=t.filter(t=>{var e=a.g.L&&t.L&&a.g.u===t.u&&a.g!==t&&!a.g.oa;return t!==i&&!e})),a.i=t[Math.floor(Math.random()*t.length)])}a.i||(a.i=a.g)}}function Ac(t,e){vc(t,5,5),e.W||pc(t.j,t.B,e),.5<t.Y?(ia(t.A,t.X,1),yc(t)):t.Da<=300?(t.s.v(0,100<t.Da?-.02:.02,0),t.Da++):(t.Oa++,t.g=t.i,t.g===e.H&&Math.random()<Math.min(t.l,.3)?pc(t.j,t.Ja,e):(t.i=lb(t.g).find(t=>t.oa),Bc(t),t.Da=0,2<=t.Oa&&.25<Math.random()&&(pc(t.j,t.Ua,e),Cc(t))))}function Gc(i,a){let n=0,s=new f;qb.forEach(t=>{var e=g(s,a.M,t.position).$;e>n&&(n=e,i.U=t)})}function Hc(t,e){ab.set(.005,.001,.4),t.Ha=!0,Gc(t,e),t.position.set(t.U.position),t.g=t.U,e=lb(t.g),t.i=e[Math.floor(Math.random()*e.length)],pc(t.j,t.Na)}function Ic(e){var t=()=>{for(var t of Za)H(e.ta,G.currentTime+t[2],t[1],t[4]-10,[Qa,Ra][t[0]],G.currentTime+t[2]+t[3])};e.ta.g.gain.cancelScheduledValues(G.currentTime),e.ta.g.gain.setValueAtTime(1,G.currentTime),t(),e.Wa=setInterval(t,6e3)}function Cc(t){t.l<=.9&&(t.l+=.1)}function xc(t){return Math.min(.15+.23*t.l,.3)}function Bc(t){g(t.La,t.i.position,t.position),t.Y=t.La.$,t.X=m(ca(t.La)),g(t.ga,t.g.position,t.position)}function vc(t,e,i){t.Ka.position.z=e,$a.set(t.Ka.T.transformPoint(new f(0,0,0))),$a.y=i}function uc(a,n){let s=(t,e)=>{var i=t?.$a()[e];if(i&&!(i.L&&1!==i.L.la&&i.u&&t.u&&i.u===t.u))if(i===n.H){if(t=e<2&&Math.abs(n.va.x)<5.75||1<e&&Math.abs(n.va.z)<5.75,e=e<2&&Math.abs(a.ga.x)<5.75||1<e&&Math.abs(a.ga.z)<5.75,!n.W&&t&&e&&g(new f,n.M,a.position).$<60)return a.ua=0,a.j.g!==a.B&&pc(a.j,a.B,n),!0}else s(i,e)},t=Math.abs(n.va.x)<5.75||Math.abs(n.va.z)<5.75,e=Math.abs(a.ga.x)<5.75||Math.abs(a.ga.z)<5.75;!n.W&&a.g===n.H&&t&&e?(a.ua=0,a.j.g!==a.B&&pc(a.j,a.B,n)):s(a.g,0)||s(a.g,1)||s(a.g,2)||s(a.g,3)}function wc(t,e){if(t.g.L&&t.i.L&&t.g.u===t.i.u&&t.g!==t.i){if(-1===t.g.L.la||t.g.L.ea)return t.g.L.ea||(fc(t.g.L,!0),ub(t.s,t.i.position),t.A.set(t.X),Jc(t,e,2e3)),!0;t.g.L.ea||Jc(t,e,100)}return!1}function yc(t){.3<t.Y?(t.position.K(m(ca(t.A)).m(xc(t))),ub(t.s,aa(new f,t.position,t.A)),t.position.y=2.5+.1*Math.sin(t.position.x+t.position.z),t.position.y<2.402&&(clearTimeout(t.Va),t.Va=setTimeout(()=>H(t.Ca,G.currentTime,38+4*Math.random(),60,Pa,G.currentTime+1),40)),t.Ma.positionX.value=t.position.x,t.Ma.positionZ.value=t.position.z):t.position.set(t.i.position)}function zc(t,e){if(t.gb===e&&t.G.length)t.i=t.G[t.Z],t.Z<t.G.length-1&&t.Z++;else{t.Z=0,t.gb=e;t:if((i=t.g)===e)e=[i];else{for(var i=[{cb:i,eb:[i]}],a=new Set;0<i.length;){var n,{cb:s,eb:r}=i.shift();a.add(s);for(n of lb(s))if(!a.has(n)){var o=[...r,n];if(n===e){e=o;break t}i.push({cb:n,eb:o})}}e=void 0}t.G=e}}function Jc(t,e,i){t.g.u===e.H.u&&setTimeout(()=>{e.W?pc(t.j,t.hb,e):t.j.g!==t.B&&t.j.g!==t.Ja&&pc(t.j,t.B,e)},i)}class Kc{constructor(){this.Oa=this.Da=0,this.G=[],this.Z=0,this.A=new f,this.La=new f,this.Y=0,this.X=new f,this.ga=new f,this.Wa=0,this.Ca=new Oa,this.Ma=new PannerNode(G,{distanceModel:"linear",maxDistance:80,rolloffFactor:99,coneOuterGain:.1}),this.l=this.ua=0,this.ta=new Oa,this.Ka=new vb,this.Va=0,this.Ha=!1,this.Ia=0,this.U=qb[0],this.ta.g.connect(Ka),this.Ca.g.connect(this.Ma).connect(Ja),this.g=qb[2],this.position=(new f).set(this.g.position),this.i=this.g,this.Na={ja:()=>{sc(this)},ka:t=>tc(this,t)},this.B={ja:t=>{sc(this),Ic(this),this.G=[],this.Z=0,zc(this,t.H),this.i=this.G[1]??this.g,this.Z++,t=m(g(new f,this.i.position,this.position)),this.A.set(t),this.ua=0},ka:t=>{vc(this,8,9),wc(this,t)||(this.ua++,uc(this,t),this.ua>=600+600*this.l&&(pc(this.j,this.Ua,t),Cc(this)),this.g.oa&&t.W&&t.H===this.g||(this.g===t.H||this.i===t.H)&&g(new f,this.position,t.M).$<7?pc(this.j,this.Ja,t):this.Y>(this.i.L?1:6)-2*xc(this)?(ia(this.A,this.X,xc(this)/4),yc(this)):(yc(this),this.g=this.i,zc(this,t.H),this.i||(this.i=this.g)))}},this.hb={ja:()=>{this.Oa=0},ka:t=>Ac(this,t)},this.Ua={ja:t=>{sc(this),Gc(this,t),zc(this,this.U),this.i=this.G[0],Bc(this)},ka:()=>{vc(this,3,9),1<this.Y?(ia(this.A,this.X,1),yc(this)):(yc(this),this.g=this.i,zc(this,this.U),this.i||(this.i=this.g),this.i===this.U&&pc(this.j,this.Na))}},this.Ja={ka:t=>{vc(this,5,5),this.Ia++,t.ia-=.1,300===this.Ia&&(Hc(this,t),t.ya=!1,this.l*=.4)},ja:t=>{this.Ia=0,sc(this),t.xa=!1;var e=(new f).set(t.M);ub(this.s,e),H(this.Ca,G.currentTime,70,100,Pa,G.currentTime+1),H(this.Ca,G.currentTime+.1,1,80,Ya,G.currentTime+5),t.W&&hb(t),t.ya=!0}},this.j=new qc(this.Na),this.s=rc(),this.s.K(this.Ka)}Sa(t){this.Ha?(Bc(this),this.j.g.ka(t),this.s.position.set(this.position)):(this.s.position.y=-1e3,this.g=qb[0],sc(this))}}function Lc(t){H(t.g.j,G.currentTime,60,70,Va,G.currentTime+4),H(t.g.j,G.currentTime+.5,60,70,Pa,G.currentTime+2.5),H(t.g.j,G.currentTime+1.8,60,70,Pa,G.currentTime+2.5),H(t.s,G.currentTime,60,70,Ya,G.currentTime+1)}class Mc{constructor(){this.X=[],this.Y=this.G=!1,this.s=new Oa,this.Z=!1,this.ga=new f,this.A=new f,this.U=!1,this.s.g.connect(Ka),this.B=new wb,this.i=[new W(48,33.75,-1,-1,!0),new W(48,68.75,-1,-1,!0),new W(48,103.75,-1,-1,!0),new W(-4,26.25,1,1,!0),new W(4,33.75,-1,-1,!0),new W(-4,61.25,1,1,!0),new W(4,68.75,-1,-1,!0),new W(-4,96.25,1,1,!0),new W(4,103.75,-1,-1,!0),new W(-48,26.25,1,1,!0),new W(-48,61.25,1,1,!0),new W(-48,96.25,1,1,!0),new W(2.5,124,-1,-1,!1,!0),new W(-2.5,124,1,-1,!1,!0)];var t=oc(this.i).u;this.g=new ob,this.g.l=t,this.l=new Kc,this.j=new bc}ja(){var t=new K(Q(S(new T(180,1,180,20,1,20),5,5).h(0,0,64)),F.mb),e=new K(S(Q(new T(170,1,160).h(0,12,65)),5,5),F.Ya),i=new K(Q(cc(!0).h(0,0,6)),F.S),a=new K(Q(cc().h(0,0,6)),F.S);this.B.K(...this.j.B,e,t,i,...this.i,this.l.s,...lc.map(t=>t.qa)),this.X=Da(Ab([t,a,this.j.l])),this.g.J.set(0,Math.PI,0),H(this.g.j,G.currentTime,60,70,Wa,G.currentTime+6),setTimeout(()=>{this.j.i=!0,Lc(this)},7e3)}ka(){tmpl.innerHTML="",kb(this.g,this.X),this.l.Sa(this.g),ac(this.j),nb(this.B),Qb(this.g.g,this.B),this.j.j||Ga(this.j.A,this.g),[this.g.H.L,this.i[12],this.i[13]].forEach((t,e)=>{var i,a;t&&(i=g(this.ga,this.g.M,t.Qa).$,-1===t.la&&!t.ea&&i<7&&Ga(t.ib,this.g),i<8)&&(a=h(this.g.D,m(this.ga)),i<1||a<-.77)&&(t.pa?this.g.l===this.g.H.u?(tmpl.innerHTML+='<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">🗝️ &nbsp; Unlock and Open</div>',p.i&&(fc(t),t.pa=!1,0<e)&&(fc(this.i[12]),this.i[12].pa=!1,fc(this.i[13]),this.i[13].pa=!1)):tmpl.innerHTML+='<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">🔒 &nbsp; Locked</div>':this.l.g.L===t?tmpl.innerHTML+='<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">🚫</div>':(tmpl.innerHTML+=`<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">${-1===t.la?"Open":"Close"} Door</div>`,p.i&&fc(t)))}),this.i.forEach(t=>{t.ea&&t.Sa()});var t=this.g.H.oa;t&&g(this.A,this.g.g.position,t.position).$<8&&h(this.g.D,m(this.A))<-.77&&!this.g.W&&(tmpl.innerHTML+='<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">Hide</div>',p.i)&&!p.l&&gb(this.g,t),(t=this.g.H.item)&&!t.ab&&g(this.A,this.g.g.position,t.qa.position).$<6&&h(this.g.D,m(this.A))<-.9&&(tmpl.innerHTML=t.u?-1===t.u?tmpl.innerHTML+'<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">🎂 Make a Wish</div>':tmpl.innerHTML+`<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">🗝️ Take Room ${t.u} Key</div>`:tmpl.innerHTML+'<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">Use Health Pack</div>',p.i)&&!p.l&&(t.ab=!0,-1!==t.u&&(this.B.A(t.qa),H(this.s,G.currentTime,90,30,Ta,G.currentTime+1)),t.u&&(this.g.l=t.u,Cc(this.l),this.Y||(ab.set(.001,.001,.4),this.l.l=0,this.Y=!0,Hc(this.l,this.g)),1313===t.u&&(this.l.Ha=!1,$a.set(0,3.7,138)),-1===t.u)&&(H(this.s,G.currentTime,120,30,Ta,G.currentTime+1),$a.set(0,8,0),setTimeout(()=>{this.j.i=!0,Lc(this)},1e3)),t.u||fb(this.g)),!this.G&&17<g(new f,this.g.M,qb[0].position).$&&(this.G=!0,this.j.g=!0,Lc(this)),this.G&&this.g.M.z<3&&(this.g.ya=!0,tmpl.innerHTML+='<div style="font-size: 40px; text-align: center; position: absolute; bottom: 20px; width: 100%;">You Win!</div>',this.Z||(this.Z=!0,this.j.g=!0,Lc(this))),this.g.ia<=0&&!this.U&&(this.U=!0,alert("YOU DIED"),location.reload())}}let Nc=0,Oc=1e3/60;tmpl.innerHTML='<div style="font-size: 30px; text-align: center; position: absolute; bottom: 20px; width: 100%;">Click to Start</div>',document.onclick=async()=>{tmpl.requestPointerLock(),tmpl.innerHTML="",await ta();let s=new Mc;s.ja(),function t(e){var i,a,n=e-Nc;n>=Oc&&(Nc=e-n%Oc,p.l=p.i,p.B=p.s,e=p.g.get("KeyA")?-1:0,n=p.g.get("KeyD")?1:0,i=p.g.get("KeyW")?-1:0,a=p.g.get("KeyS")?1:0,p.j.x=e+n,p.j.y=i+a,p.i=!!p.g.get("KeyE"),p.s=!!p.g.get("KeyF"),s.ka()),requestAnimationFrame(t)}(0),document.onclick=()=>tmpl.requestPointerLock()}</script>