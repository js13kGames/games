<!DOCTYPE html>
<html>
<head>
<title>Medieval Matchup</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEUAAAD///9MzgD/agDH7lxmAAAAAXRSTlMAQObYZgAAACxJREFUCNdjYA0NDWAQDQ0NYYj//zUUStSiElWrljKERoGJTEwCCMAGgI0CALGIHFWGAp68AAAAAElFTkSuQmCC">      
<script src=/2023/webxr/aframe.js></script>
<script>
/**************************************\
*       Entry for j213KGames          *
* Copyright (c) 2023 Samuel Van Egmond *
*           MIT License                *
\**************************************/
"use strict";
if(location.protocol !='https:'){location.href='https:'+location.href.substring(window.location.protocol.length);}
var MMU={};
function Xc(t,Y,e,i){let s=document.createElement(Y);if(i!==null&&i!==undefined&&i!==""){s.innerHTML+=i}for(let t in e){s.setAttribute(t,e[t])}if(t!==undefined)return t.appendChild(s);else return s}AFRAME.registerComponent("fps-counter",{schema:{},init:function(){this.framecount=0;this.lasttime=Math.round((new Date).getTime())},update:function(){},tick:function(){this.framecount++;let Y=Math.round((new Date).getTime());if(Y-this.lasttime>500){let t=Math.round(1e3*this.framecount/(Y-this.lasttime));this.el.setAttribute("value",`${t}`);if(t<45)this.el.setAttribute("color","#FF0000");else if(t<55)this.el.setAttribute("color","#FF8000");else this.el.setAttribute("color","#00FF00");this.framecount=0;this.lasttime=Y}},remove:function(){},pause:function(){},play:function(){}});AFRAME.registerComponent("show-on-move",{schema:{},dependencies:["position"],init:function(){this.originalPos=this.el.object3D.position.clone();this.el.object3D.visible=false},tick:function(){if(!this.el.object3D.position.equals(this.originalPos)){this.el.object3D.visible=true}}});AFRAME.registerComponent("show-on-enter-ar",{init:function(){var t=this;this.el.sceneEl.addEventListener("enter-vr",function(){if(t.el.sceneEl.is("ar-mode")){t.el.object3D.visible=true}});this.el.sceneEl.addEventListener("exit-vr",function(){t.el.object3D.visible=false})}});AFRAME.registerComponent("island",{schema:{size:{"default":25},height:{"default":10},color:{type:"color","default":"#080"}},init:function(t){var s=1;let R=[];let h=[];let a=[];let n=this.data.size;let o=this.data.height;let l=-n/2;let G=10;for(let i=0;i<=n;i++){let e=-n/2+.25-(i%2===1?.5:0);for(let Y=0;Y<=n;Y++){let t=this.Kb((Y+e)/n,(i+l)*s/n)*o;R.push(Y+e,t,(i+l)*s);h.push((Y+e)/G,(i+l)*s/G);if(t>1.75){let t=Math.random()*.1+.1;a.push(Math.random()*.1,Math.random()*.1+.1,0)}else if(t>.75){a.push(Math.random()*.1,Math.random()*.3+.2,0)}else{a.push(Math.random()*.1+.4,Math.random()*.1+.4,0)}}}let c=[];for(let i=0;i<n;i++){for(let e=0;e<n;e++){let t=(i+0)*(n+1);let Y=(i+1)*(n+1);if(i%2===0){c.push(Y+e+1,t+e,Y+e);c.push(t+e,Y+e+1,t+e+1)}else{c.push(t+e,Y+e,t+e+1);c.push(Y+e+1,t+e+1,Y+e)}}}let Y=new THREE.BufferGeometry;Y.setAttribute("position",new THREE.Float32BufferAttribute(R,3));Y.setAttribute("color",new THREE.Float32BufferAttribute(a,3));Y.setAttribute("uv",new THREE.Float32BufferAttribute(h,2));Y.uvsNeedUpdate=true;Y.setIndex(c);Y.addGroup(0,c.length,0);Y.computeVertexNormals();Y.computeBoundingBox();let e=new THREE.MeshStandardMaterial({roughness:1,metalness:0,side:THREE.FrontSide,fog:true,vertexColors:true,color:new THREE.Color(1,1,1),wireframe:false,map:new THREE.CanvasTexture(Nb.Na(),THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping)});this.mesh=new THREE.Mesh(Y,e);this.el.setObject3D("mesh",this.mesh)},Kb:function(t,Y){let e=Math.sqrt(t*t+Y*Y);return(.5-Math.min(.5,e))*(1+Math.sin(t*12+4)*Math.sin(Y*12+4)/2)/1.5}});class Nb{static Na(){let t=document.createElement("canvas");t.width=256;t.height=256;let Y=t.getContext("2d");let e=Y.getImageData(0,0,t.width,t.height);let i=e.data;for(let Y=0;Y<i.length;Y+=4){let t=255-Math.floor(Math.random()*64);i[Y+0]=t;i[Y+1]=t;i[Y+2]=t;i[Y+3]=255}Y.putImageData(e,0,0);return t}}AFRAME.registerComponent("seagull",{schema:{},init:function(){if(!this.init.mesh){this.init.mesh=this.Ra();this.mesh=this.init.mesh}else{this.mesh=new THREE.Mesh(this.init.mesh.geometry,this.init.mesh.material)}this.el.setObject3D("mesh",this.mesh)},Ra:function(){let t=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,vertexColors:true});let Y=new THREE.BufferGeometry;Y.setAttribute("position",new THREE.Float32BufferAttribute([-100,100,-200,-50,100,-150,-50,100,-217,50,100,-217,-50,100,-50,50,100,-50,100,100,-200,50,100,-150,-50,100,50,-50,100,-50,-19,53,-6,-17,46,58,50,100,50,17,46,58,19,53,-6,50,100,-50,-350,100,-50,-250,125,-25,-250,125,25,-250,125,25,-317,133,17,-350,100,-50,-250,125,-25,-150,125,-25,-150,125,25,-250,125,25,-150,125,-25,-50,100,-50,-50,100,50,-150,125,25,150,125,25,50,100,50,50,100,-50,150,125,-25,250,125,25,150,125,25,150,125,-25,250,125,-25,317,133,17,250,125,25,250,125,-25,250,125,-25,350,100,-50,317,133,17,-18,68,143,-12,38,143,18,68,143,12,38,143,-7,57,188,-18,68,143,-12,38,143,-5,45,188,7,57,188,5,45,188,12,38,143,18,68,143].map(t=>t*.01),3));Y.setAttribute("normal",new THREE.Float32BufferAttribute([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,-.5,.3,.7,-.4,.3,-.9,-.3,-.8,-.4,-.6,-.8,-.1,.5,.4,.8,.6,-.8,0,.5,-.8,-.3,.3,.5,-.8,0,-1,.2,0,-1,.2,0,-1,.2,0,-.9,.3,0,-.9,.3,0,-.9,.3,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-.2,-1,0,-.2,-1,0,-.2,-1,0,-.2,-1,0,.2,-1,0,.2,-1,0,.2,-1,0,.2,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,.2,0,-1,.2,0,-1,.2,0,-.9,.3,0,-.9,.3,0,-.9,.3,-.8,.4,.4,-.7,-.8,.1,.5,.8,.4,.7,-.7,0,-.8,.4,.4,-.8,.4,.4,-.7,-.8,.1,-.5,-.8,.3,.4,.8,.4,.8,-.5,.3,.7,-.7,0,.5,.8,.4],3));Y.setAttribute("color",new THREE.Float32BufferAttribute([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,.5,.5,.5,.5,.5,.5,.5,.5,.5,0,0,0,0,0,0,.5,.5,.5,1,1,1,1,1,1,.5,.5,.5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.5,.5,.5,1,1,1,1,1,1,.5,.5,.5,0,0,0,.5,.5,.5,.5,.5,.5,.5,.5,.5,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,.2,.1,1,.2,.1,1,.2,.1,1,.2,.1,1,.2,.1,1,.2,.1,1,.2,.1,1,.2,.1],3));Y.setIndex([0,0,1,1,2,0,3,2,4,4,5,3,6,3,7,7,6,6,8,9,10,10,11,8,12,13,14,14,15,12,13,11,10,10,14,13,15,9,8,8,12,15,9,15,14,14,10,9,16,17,18,19,20,21,22,23,24,24,25,22,26,27,28,28,29,26,30,31,32,32,33,30,34,35,36,36,37,34,38,39,40,41,42,43,44,8,11,11,45,44,46,47,13,13,12,46,47,45,11,11,13,47,46,12,8,8,44,46,48,49,50,50,51,48,52,53,54,54,55,52,53,51,50,50,54,53,52,55,49,49,48,52,53,52,48,48,51,53]);Y.addGroup(0,138,0);Y.computeBoundingBox();return new THREE.Mesh(Y,t)}});var Bc=`
vec2 hash(vec2 x,float time)
{
float s=mod(x.x+x.y,2.)*2.-1.;
s*=time;
const vec2 k=vec2(.3183099,.3678794);
x=x*k+k.yx+5.;
return(-1.+2.*fract(16.*k*fract(x.x*x.y*(x.x+x.y))))
*mat2(cos(s+vec4(0,33,11,0)));
}
float noise(vec2 p,float time)
{
vec2 i=floor(p),
f=fract(p),
u=f*f*(3.-2.*f);
#define P(x,y)dot(hash(i+vec2(x,y),time),f - vec2(x,y))
return mix(mix(P(0,0),P(1,0),u.x),
mix(P(0,1),P(1,1),u.x),u.y);
}
`;var Jd=`
uniform float time;
varying float t;
varying vec3 p;
varying float Eb;
`;AFRAME.registerShader("water",{schema:{time:{type:"time",is:"uniform"}},vertexShader:Jd+`
void main()
{
t=time;
p=position;  
vec4 pos=modelViewMatrix*vec4(position,1.0);
Eb=-pos.z;    
gl_Position=projectionMatrix*pos;
}
`,fragmentShader:Bc+Jd+`
void main(){
vec3 temp=vec3(1.0,1.0,1.0);
float depth=max(0.,(15.-Eb)/15.);
depth*=depth;
float n1=noise(vec2(p.xy*4.),t/1000.);
float n2=noise(vec2(p.xy*4.),t/1000.+1.);
float l1=step(abs(n1),0.02);
float l2=step(abs(n2),0.02)*0.5;
float wl=n1;
gl_FragColor=vec4(0.1+(l1+l2)*depth,0.6+(l1+l2)*depth,0.7+(l1+l2)*depth,1)*(1.- wl*depth);
}
`});MMU.Od=function(){MMU.Fe=new(window.AudioContext||window.webkitAudioContext);const i=MMU.Fe.createBuffer(2,MMU.Fe.sampleRate*3,MMU.Fe.sampleRate);for(let t=0;t<i.numberOfChannels;t++){const s=i.getChannelData(t);let e=0;for(let Y=0;Y<i.length;Y++){let t=Math.sin(Y/i.length*Math.PI*2)*.02+.03;s[Y]=(e*10+(Math.random()*2-1)*t)/11;e=s[Y]}}MMU.Ee=MMU.Fe.createBufferSource();MMU.Ee.buffer=i;MMU.Ee.loop=true;MMU.Ee.connect(MMU.Fe.destination);MMU.Ee.start()};class Qd{static Na(){let t=[-.5,-.4,-.4,-.5,-.4,-.4,-.5,.4,-.4,-.5,.4,-.4,-.5,.4,.4,-.5,.4,.4,-.5,-.4,.4,-.5,-.4,.4,.5,-.4,.4,.5,-.4,.4,.5,.4,.4,.5,.4,.4,.5,.4,-.4,.5,.4,-.4,.5,-.4,-.4,.5,-.4,-.4,-.4,-.5,-.4,-.4,-.5,-.4,-.4,-.5,.4,-.4,-.5,.4,.4,-.5,.4,.4,-.5,.4,.4,-.5,-.4,.4,-.5,-.4,-.4,.5,.4,-.4,.5,.4,-.4,.5,-.4,-.4,.5,-.4,.4,.5,-.4,.4,.5,-.4,.4,.5,.4,.4,.5,.4,.4,-.4,-.5,.4,-.4,-.5,.4,.4,-.5,.4,.4,-.5,-.4,.4,-.5,-.4,.4,-.5,-.4,-.4,-.5,-.4,-.4,-.5,-.4,-.4,.5,-.4,-.4,.5,-.4,.4,.5,-.4,.4,.5,.4,.4,.5,.4,.4,.5,.4,-.4,.5,.4,-.4,.5];let Y=[-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];let e=[0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4,0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4,0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4,0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4,0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4,0,0,1e-4,1e-4,0,1,1e-4,1e-4,1,1,1e-4,1e-4,1,0,1e-4,1e-4];let i=[2,0,4,6,4,0,10,8,12,14,12,8,18,16,20,22,20,16,26,24,28,30,28,24,34,32,36,38,36,32,42,40,44,46,44,40,25,43,31,45,31,43,31,11,29,13,29,11,29,35,27,37,27,35,27,3,25,5,25,3,25,5,43,31,45,11,29,13,35,27,37,3,7,41,5,43,5,41,47,9,45,11,45,9,15,33,13,35,13,33,39,1,37,3,37,1,19,41,7,21,9,47,23,33,15,17,1,39,41,19,47,21,47,19,9,21,15,23,15,21,33,23,39,17,39,23,1,17,7,19,7,17];let s=new THREE.BufferGeometry;s.setAttribute("position",new THREE.Float32BufferAttribute(t,3));s.setAttribute("normal",new THREE.Float32BufferAttribute(Y,3));s.setAttribute("uv",new THREE.Float32BufferAttribute(e,2));s.setIndex(i);s.uvsNeedUpdate=true;s.addGroup(0,132,0);return s}}class Rd{static Mb(t){if(!Rd.Mb.Pc){this.Va();this.Ua()}let Y=Rd.Mb.Pc;let e=.125*(t&7);let i=.125*(Math.floor(t/8)%8);let s=Y.clone();s.emissive=new THREE.Color(1,1,1),s.color=new THREE.Color(1,1,1),s.map=Y.map.clone();s.map.offset=new THREE.Vector2(e,i);return s}static Ua(){Rd.Mb.Pc=new THREE.MeshStandardMaterial({roughness:1,metalness:1,emissive:new THREE.Color(1,1,1),emissiveIntensity:.25,map:Rd.Td,emissiveMap:Rd.Pd,roughnessMap:Rd.Ud,normalMap:Rd.Sd})}static Va(){let t=new Rc;t.Na("rgba(255,255,255,1)","rgba(128,128,128,1)");t.Oa(2,3,"rgba(255,255,255,1)");Rd.Td=new THREE.CanvasTexture(t.Jb());Rd.Td.repeat.set(.125,.125);t=new Rc;t.Na("rgba(255,255,255,1)","rgba(0,0,0,1)");t.Oa(2,3,"rgba(128,128,128,1)");Rd.Pd=new THREE.CanvasTexture(t.Jb());Rd.Pd.repeat.set(.125,.125);t=new Rc;t.Na("rgba(0,0,0,1)","rgba(128,128,128,1)");Rd.Ud=new THREE.CanvasTexture(t.Jb());Rd.Ud.repeat.set(.125,.125);t=new Rc;t.Na("rgba(0,0,0,1)","rgba(255,255,255,1)");t.Ta(3,0,-1);Rd.Sd=new THREE.CanvasTexture(t.Jb());Rd.Sd.repeat.set(.125,.125)}Pb(t){const Y=new THREE.Texture;const e=new THREE.ImageLoader;e.load(t,t=>{Y.source=new THREE.Source(t)});return Y}}class Rc{constructor(t){if(!t){t=document.createElement("canvas");t.width=1024;t.height=t.width}this.canvas=t;this.size=t.width/8;this.Da=this.size/8;this.Aa="rgba(0,255,0,0.5)"}Na(t,Y){this.Qc=t??"rgba(0,0,0,1)";this.Ib=Y??"rgba(255,255,255,1)";let e={c:this.canvas.getContext("2d"),x:0,y:0};e.c.fillStyle=this.Ib;e.c.fillRect(0,0,this.canvas.width,this.canvas.height);this.Ca(e);this.Ba(e);this.Ja(e);this.Ka(e);this.La(e);this.Ma(e);this.Kd(e);this.Ld(e);this.Yd(e);this.Zd(e);this.Za(e);this.Ab(e);this.Bb(e);this.Ia(e)}Jb(){return this.canvas}Lb(){return this.canvas.toDataURL()}Ta(e,n,i){n=n??255;i=i??1;let t=this.canvas.getContext("2d");e=e??5;let Y=t.getImageData(0,0,this.canvas.width,this.canvas.height);let o=Y.data;for(let t=0;t<o.length;t+=4){o[t+3]=o[t]}let l=this.canvas.width;let G=this.canvas.height;for(let a=0;a<G;a++){for(let h=0;h<l;h++){let R=null;for(let s=0;s<=e;s++){if(R)break;for(let i=-s;i<=s;i++){for(let e=-s;e<=s;e++){if(!(e===-s||i==-s||e==s||i==s))continue;let t=Math.max(Math.min(a+i,G),0);let Y=Math.max(Math.min(h+e,l),0);if(o[(t*l+Y)*4+3]===n){let t=Math.abs(e)+Math.abs(i);if(!R||t<R.l){R={x:e,y:i,l:t}}}}}}let Y={x:.5,y:.5,z:1};if(R){Y.x=i*R.x/e;Y.y=i*R.y/e;Y.z=1;let t=2*Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);Y.x=Y.x/t+.5;Y.y=Y.y/t+.5;Y.z=Y.z/t+.5}o[(a*l+h)*4+0]=Math.round(Y.x*255.499999);o[(a*l+h)*4+1]=Math.round(Y.y*255.499999);o[(a*l+h)*4+2]=Math.round(Y.z*255.499999)}}for(let t=0;t<o.length;t+=4){o[t+3]=255}t.putImageData(Y,0,0);t.filter="blur(1.5px)";t.drawImage(this.canvas,0,0,l,G)}Oa(e,i,t){t=t??"rgba(255,255,255,1)";let s=this.canvas.getContext("2d");s.strokeStyle=t;s.lineJoin="miter";s.lineWidth=i-e+1;s.beginPath();for(let Y=0;Y<8;Y++){for(let t=0;t<8;t++){s.rect(t*this.size+.5+(e+i)/2,Y*this.size+.5+(e+i)/2,this.size-1-(e+i),this.size-1-(e+i))}}s.stroke()}Ac(t){t.x+=this.size;if(t.x===this.size*8){t.x=0;t.y+=this.size}}Ca(t){this.Fa(t,3,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Fa(t,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,3,4,2,this.Ib);this.Ac(t)}Ba(t){this.Ha(t,1,0,1,this.Qc);this.Ac(t);this.Ha(t,1,0,1,this.Qc);this.Ha(t,3,4,2,this.Ib);this.Ac(t);this.Ha(t,1,0,1,this.Qc);this.Fa(t,1.66,this.Ib);this.Ac(t)}La(t){this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,3,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,3,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,3,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Nd(t,4,3,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,15,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,15,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,15,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Nd(t,4,15,1,this.Qc);this.Ac(t)}Ma(t){this.Fa(t,3,this.Qc);this.Nd(t,4,0,2,this.Ib);this.Nd(t,4,3,2,this.Ib);this.Nd(t,4,12,2,this.Ib);this.Nd(t,4,15,2,this.Ib);this.Nd(t,4,0,1,this.Qc);this.Nd(t,4,3,1,this.Qc);this.Nd(t,4,12,1,this.Qc);this.Nd(t,4,15,1,this.Qc);this.Ac(t)}Ja(t){this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,3,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,3,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,3,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ha(t,4,3,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,15,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,15,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,15,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ha(t,4,15,1,this.Qc);this.Ac(t)}Ka(t){this.Fa(t,3,this.Qc);this.Ha(t,4,0,2,this.Ib);this.Ha(t,4,3,2,this.Ib);this.Ha(t,4,12,2,this.Ib);this.Ha(t,4,15,2,this.Ib);this.Ha(t,4,0,1,this.Qc);this.Ha(t,4,3,1,this.Qc);this.Ha(t,4,12,1,this.Qc);this.Ha(t,4,15,1,this.Qc);this.Ac(t)}Kd(t){this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,14,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,14,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,14,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ha(t,5,14,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,22,2,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,22,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,22,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ha(t,5,22,1,this.Qc);this.Ac(t)}Ld(t){this.Fa(t,3,this.Qc);this.Ha(t,5,2,2,this.Ib);this.Ha(t,5,14,2,this.Ib);this.Ha(t,5,10,2,this.Ib);this.Ha(t,5,22,2,this.Ib);this.Ha(t,5,2,1,this.Qc);this.Ha(t,5,14,1,this.Qc);this.Ha(t,5,10,1,this.Qc);this.Ha(t,5,22,1,this.Qc);this.Ac(t)}Yd(t){}Zd(t){this.Zc(t,this.Qc);this.Ac(t);this.Zc(t,this.Qc);this.Ae(t,0,this.Qc);this.Ac(t);this.Zc(t,this.Qc);this.Ae(t,0,this.Qc);this.Ae(t,1,this.Qc);this.Ac(t);this.Zc(t,this.Qc);this.Ae(t,0,this.Qc);this.Ae(t,2,this.Qc);this.Ac(t);this.Zc(t,this.Qc);this.Ae(t,0,this.Qc);this.Ae(t,1,this.Qc);this.Ae(t,2,this.Qc);this.Ac(t);this.Zc(t,this.Qc);this.Ae(t,0,this.Qc);this.Ae(t,1,this.Qc);this.Ae(t,2,this.Qc);this.Ae(t,3,this.Qc);this.Ac(t)}Za(t){this.Fa(t,3,this.Qc);this.Ha(t,7,24,3,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,9,22,3,this.Ib);this.Ha(t,9,58,3,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,9,20,3,this.Ib);this.Ha(t,9,60,3,this.Ib);this.Ac(t);this.Fa(t,3,this.Qc);this.Ha(t,9,20,3,this.Ib);this.Ha(t,9,24,3,this.Ib);this.Ha(t,9,56,3,this.Ib);this.Ha(t,9,60,3,this.Ib);this.Ac(t)}Ab(t){this.Ha(t,7,24,3,this.Qc);this.Ac(t);this.Ha(t,7,10,3,this.Qc);this.Ha(t,7,38,3,this.Qc);this.Ac(t);this.Ea(t,5,7,2,this.Qc);this.Ea(t,5,28,2,this.Qc);this.Ac(t);this.Ea(t,5,7,2,this.Qc);this.Ea(t,5,10,2,this.Qc);this.Ea(t,5,25,2,this.Qc);this.Ea(t,5,28,2,this.Qc);this.Ac(t)}Bb(t){this.Nd(t,7,24,3,this.Qc);this.Ac(t);this.Nd(t,7,10,3,this.Qc);this.Nd(t,7,38,3,this.Qc);this.Ac(t);this.Nd(t,7,8,3,this.Qc);this.Nd(t,7,40,3,this.Qc);this.Ac(t);this.Nd(t,7,8,3,this.Qc);this.Nd(t,7,12,3,this.Qc);this.Nd(t,7,36,3,this.Qc);this.Nd(t,7,40,3,this.Qc);this.Ac(t)}Ia(Y){this.Ha(Y,5,12,5,this.Qc);this.Nd(Y,7,21,1.5,this.Ib);this.Nd(Y,7,22,1.5,this.Ib);this.Nd(Y,7,23,1.5,this.Ib);this.Nd(Y,7,24,1.5,this.Ib);this.Nd(Y,7,25,1.5,this.Ib);this.Nd(Y,7,26,1.5,this.Ib);this.Nd(Y,7,27,1.5,this.Ib);this.Ac(Y);for(let t=0;t<2;t++){this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,7,21,1.5,this.Ib);this.Nd(Y,7,22,1.5,this.Ib);this.Nd(Y,7,26,1.5,this.Ib);this.Nd(Y,7,27,1.5,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y);this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,2,1,1,this.Ib);this.Nd(Y,2,2,1,this.Ib);this.Nd(Y,2,3,1,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y);this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,2,2,1,this.Ib);this.Nd(Y,2,3,1,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y);this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,2,1,1,this.Ib);this.Nd(Y,2,2,1,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y);this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,2,0,1,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y);this.Ha(Y,5,12,5,this.Qc);this.Ha(Y,5,12,3,this.Ib);this.Nd(Y,7,3,1.5,this.Ib);this.Nd(Y,7,10,1.5,this.Ib);this.Nd(Y,7,21,1.5,this.Ib);this.Nd(Y,7,22,1.5,this.Ib);this.Nd(Y,7,26,1.5,this.Ib);this.Nd(Y,7,27,1.5,this.Ib);this.Nd(Y,7,38,1.5,this.Ib);this.Nd(Y,7,45,1.5,this.Ib);if(t===1){this.Ha(Y,5,12,1.5,this.Qc)}this.Ac(Y)}}Fa(t,Y,e){t.c.fillStyle=e;t.c.beginPath();t.c.fillRect(t.x+this.size/2-Y*this.Da,t.y+this.size/2-Y*this.Da,Y*2*this.Da,Y*2*this.Da)}Zc(t,Y){t.c.beginPath();t.c.fillStyle=Y;t.c.moveTo(t.x+this.Da,t.y+this.size/2);t.c.lineTo(t.x+this.size/2,t.y+this.Da);t.c.lineTo(t.x+this.size-this.Da,t.y+this.size/2);t.c.lineTo(t.x+this.size/2,t.y+this.size-this.Da);t.c.closePath();t.c.fill()}Ae(t,Y,e){t.c.beginPath();t.c.fillStyle=e;switch(Y){case 0:t.c.moveTo(t.x+this.Da,t.y+this.Da);t.c.lineTo(t.x+this.size/2-this.Da,t.y+this.Da);t.c.lineTo(t.x+this.Da,t.y+this.size/2-this.Da);break;case 1:t.c.moveTo(t.x+this.size-this.Da,t.y+this.Da);t.c.lineTo(t.x+this.size-this.Da,t.y+this.size/2-this.Da);t.c.lineTo(t.x+this.size/2+this.Da,t.y+this.Da);break;case 2:t.c.moveTo(t.x+this.size-this.Da,t.y+this.size-this.Da);t.c.lineTo(t.x+this.size/2+this.Da,t.y+this.size-this.Da);t.c.lineTo(t.x+this.size-this.Da,t.y+this.size/2+this.Da);break;case 3:t.c.moveTo(t.x+this.Da,t.y+this.size-this.Da);t.c.lineTo(t.x+this.Da,t.y+this.size/2+this.Da);t.c.lineTo(t.x+this.size/2-this.Da,t.y+this.size-this.Da);break}t.c.closePath();t.c.fill()}Nd(t,Y,e,i,s){let R=(this.size-2*this.Da)/Y;let h=e%Y;let a=Math.floor(e/Y);t.c.beginPath();t.c.fillStyle=s;t.c.fillRect(t.x+this.Da+R*(h+.5-i/2),t.y+this.Da+R*(a+.5-i/2),R*i,R*i);t.c.fill()}Ha(t,Y,e,i,s){let R=(this.size-2*this.Da)/Y;let h=e%Y;let a=Math.floor(e/Y);t.c.beginPath();t.c.fillStyle=s;t.c.arc(t.x+this.Da+R*(h+.5),t.y+this.Da+R*(a+.5),i*R/2,0,2*Math.PI);t.c.fill()}Ea(t,Y,e,i,s){let R=(this.size-2*this.Da)/Y;let h=e%(Y+1);let a=Math.floor(e/(Y+1));t.c.beginPath();t.c.fillStyle=s;t.c.arc(t.x+this.Da+R*h,t.y+this.Da+R*a,i*R/2,0,2*Math.PI);t.c.fill()}}MMU.Ub=[];MMU.Ub[0]={name:"Tree",size:{x:5,y:10,z:5},model:"-----------GGG--GGG---G----G--------------------------------GGGGGG---G-G-G--G-G---G----G--------------R----R--GGGGGG---GG---GG---G-G-G--G-G---G----G------------GGGGGG---G-G-G--G-G---G----G-----------------------GGG--GGG---G----G----------------------",pos:[{x:1,y:.4,z:6.5,r:-135},{x:0,y:1.4,z:5,r:-135},{x:2,y:1.2,z:5,r:-135},{x:0,y:1,z:-4,r:-135}],animation:"property:object3D.rotation.z; from:-3; to:3; loop:true; dir:alternate; dur:1500; easing:easeInOutSine;"};MMU.Ub[1]={name:"Dock",size:{x:12,y:4,z:6},model:"-B--B--B--B--B--B--B--B--B--B--B--B--B--B--B--B-------------------------RRRRRRRRRRRR------------------------------------RYYYYYYYYYYR------------------------------------RYYYYYYYYYYR------------------------------------RRRRRRRRRRRR-------------B--B--B--B--B--B--B--B--B--B--B--B--B--B--B--B-",pos:[{x:-4,y:-.35,z:11.5,r:70},{x:-5.03,y:-.35,z:14.33,r:70}]};MMU.Ub[2]={name:"Boat",size:{x:14,y:3,z:5},model:"--YYYYYYYYYY----YYYYYYYYYY----BBBBBBBBBB----YGGGGGGGGGY---Y---------Y---B---RR----B-YYYGGGGGGGGGGYBBY----------Y--B---RR-----B--YGGGGGGGGGY---Y---------Y---B---RR----B---YYYYYYYYYY----YYYYYYYYYY----BBBBBBBBBB--",pos:[{x:-3.3,y:-.2,z:13,r:-110}],animation:"property:object3D.position.y; from:0; to:-0.1; loop:true; dir:alternate; dur:1100; easing:easeInOutSine;"};MMU.Ub[3]={name:"Well",size:{x:7,y:8,z:5},model:"--YYY----YYY----YYY----------------RRRRRRR---------------YBBBY--YBBBY--Y---Y----------------------RRRRRRR--------YBBBY--YBBBY--Y---Y--Y---Y--Y---Y--YYYYY--Y---Y-RRRRRRR-YBBBY--YBBBY--Y---Y----------------------RRRRRRR---------YYY----YYY----YYY----------------RRRRRRR--------------",pos:[{x:5,y:.6,z:6,r:0}]};MMU.Ub[4]={name:"House",size:{x:9,y:8,z:7},model:"------------------------------------RRRRRRRRR----------------------------YYYYYYY--Y--Y--Y--Y--Y--Y--YYYYYYY--GYYYYYG-RRRRRRRRR-------------------Y-----Y--------------------Y-----Y--G-----G--G-----G-RRRRRRRRR----------Y-----Y--Y-----Y--Y-----Y--Y-----Y--G-----G-----------G-----G-RRRRRRRRR-Y-----Y--------------------Y-----Y--G-----G--G-----G-RRRRRRRRR----------YBBYYYY--YBBY--Y--YBBY--Y--YYYYYYY--GYYYYYG-RRRRRRRRR------------------------------------------------------RRRRRRRRR---------------------------",pos:[{x:8,y:.1,z:4,r:150},{x:7.5,y:.1,z:1,r:60}]};MMU.Ub[5]={name:"Cannon",size:{x:12,y:6,z:10},model:"----YY--YY------YY--YY--------YY----------YY--------------------------------YY--YY------YY--YY--------YY----------YY--------------------------------------------------------------------------------------------------------------------G----G-----------------------------------------------------RRR--RRR----RGR--RGR----RRR--RRR-----------------------------------------------------G----G--BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB----------------------------G----G--BBBBBBBBBBBB-----------BBBBBBBBBBBBB----------B-----------------G----G--BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB---------------RRR--RRR----RGR--RGR----RRR--RRR-----------------------------------------------------G----G--------------------------------------------------",pos:[{x:-2.5,y:1,z:-7,r:-60}]};MMU.Ub[6]={name:"Windmill",size:{x:13,y:18,z:10},model:"----BBBBB--------BBBBB---------BBB-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------B-----B------B-----B-------B---B---------BBB------------------------------------------------------------------------------------------------------G--------------------------------------------------------------------------------------B-------B----B-------B-----B-----B-------B---B---------BBB----------YYY----------YYY----------YYY----------Y-Y----------Y-Y----------YYY----------YYY---------RYYYR---------RYR-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y-G-Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y----------------------------------Y---Y--------Y-G-Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y-G-Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B-----B-----B-------B---B---------BBB----------YYY----------YYY----------YYY----------YYY----------YYY----------YYY----------YYY---------RYYYR---------RYR-----------R------------------------------------------------B-----B------B-----B-------B---B---------BBB------------------------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------BBBBB--------BBBBB---------BBB-----------------------------------GGG----------G-G----------GGG----------G-G----------GGG-GGGGG------G-G-G-GGGGGGGGGGGGGGG-G-G-G------GGGGG-GGG----------G-G----------GGG----------G-G----------GGG---------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------",pos:[{x:-5,y:1.4,z:-4,r:230}]};MMU.Ub[7]={name:"Church",size:{x:14,y:20,z:7},model:"-----YYYYYYYYY-----YYYYYYYYY-----Y-Y-Y-Y-Y-----Y-Y-Y-Y-Y-----YYYYYYYYY-----RRRRRRRRR----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------GGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGGRRRRRRRRRGGGGG---------GGGGG---------G-G-G---------G-G-G---------GGGGG---------RRRRR----------RRR------------R---------------------------------------------------------------------------------B------------YB------------YB------------YB------------YB-------------G---G--------YG---G--------YG---GRRRRRRRRRG---G-------------G-------------G---------G---G---------R---R---------R---R----------R-R------------R-----------------------------------------Y-------------------------B------------YB------------YB------------YB-------------B-------------G---G---------G---G--------YG---G--------YG---GRRRRRRRRRG---G---------G---G---------G---G---------R---R---------R---R---------R---R----------R-R------------Y-------------Y-------------Y-------------Y-----------B------------YB------------YB------------YB------------YB-------------G---G--------YG---G--------YG---GRRRRRRRRRG---G-------------G-------------G---------G---G---------R---R---------R---R----------R-R------------R-----------------------------------------Y-------------------------GGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGG--------YGGGGGRRRRRRRRRGGGGG---------GGGGG---------G-G-G---------G-G-G---------GGGGG---------RRRRR----------RRR------------R--------------------------------------------------------------------------------------YYYYYYYYY-----YYYYYYYYY-----Y-Y-Y-Y-Y-----Y-Y-Y-Y-Y-----YYYYYYYYY-----RRRRRRRRR----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",pos:[{x:3,y:.5,z:-6.5,r:200}]};MMU.Ub[8]={name:"Gate",size:{x:18,y:12,z:5},model:"------------------------------------------------------------------------------------------------------------------------------------------------RRRRRRRRRRRRRRRRRRRR-R-R-RBBR-R-R-RRRR-R-R-RBBR-R-R-RRRRRRRRRRRRRRRRRRRR-GGGGG------GGGGG--GGGGG------GGGGG--GGGGG------GGGGG--YYYYY------YYYYY--YYYYY------YYYYY--YYYYYY----YYYYYY--YYYYYYYYYYYYYYYY--YYYYYYYYYYYYYYYY-R----------------RR----------------RR----------------RRRRRRRRRRRRRRRRRRR-G---G------G---G--G---G------G---G--G---G------G---G--Y---Y------Y---Y--Y---Y------Y---Y--Y---YY----YY---Y--Y---YYYYYYYY---Y--Y--------------Y-R----------------RR----------------RR----------------RRRRRRRRRRRRRRRRRRR-GGGGG------GGGGG--GGGGG------GGGGG--GGGGG------GGGGG--YYYYY------YYYYY--YYYYY------YYYYY--YYYYYY----YYYYYY--YYYYYYYYYYYYYYYY--YYYYYYYYYYYYYYYY-R----------------RR----------------RR----------------RRRRRRRRRRRRRRRRRRR------------------------------------------------------------------------------------------------------------------------------------------------RRRRRRRRRRRRRRRRRRRR-R-R-RBBR-R-R-RRRR-R-R-RBBR-R-R-RRRRRRRRRRRRRRRRRRRR",pos:[{x:-3.15,y:.25,z:8.4,r:-20}]};MMU.Ub[9]={name:"Watermill",size:{x:18,y:12,z:10},model:"-------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------------------------------------------------------------YYY---------------YYY---------------YYY---------------YYY---------------YGY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY----------------------------------------------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------YYY---------------------------------------YY-----YY---------YY-----YY--RRRRR--YY-----YY-RRRRRRR-YY-----YY-RR-R-RR-YY-----YY-RRRGRRR-YY-----YY-RR-R-RR-YY-----YY-RRRRRRR-YY-----YY--RRRRR--YYY---YYYY--------YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YY-----YY--------BYY-----YY----R---BYY-----YY----R---BYY-----YY--------BYY-----YY-RR-G-RRBYY-----YY------BB-YY-----YY----R-B--YY-----YY----R-B--YYY---YYYY-----B--YYYYYYYYYYYYYYYB--YBBBBBBBBBBBBBB---Y-----------------YY-----YY--------BYY-----YY----R---BYY-----YY----R---BYY-----YY--------BYY-----YY-RR-G-RRBYY-----YY------BB-YY-----YY----R-B--YY-----YY----R-B--YYY---YYYY-----B--YYYYYYYYYYYYYYYB--YBBBBBBBBBBBBBB---Y-----------------YY-----YY---------YY-----YY--RRRRR--YY-----YY-RRRRRRR-YY-----YY-RR-R-RR-YY-----YY-RRRGRRR-YY-----YY-RR-R-RR-YY-----YY-RRRRRRR-YY-----YY--RRRRR--YYY---YYYY--------YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY----------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------YYY---------------------------------------------------YYY---------------YYY---------------YYY---------------YYY---------------YGY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY----------------------------------------------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------------------------------------------------",pos:[{x:8,y:0,z:-4.5,r:40}]};MMU.Ub[10]={name:"Galleon",size:{x:20,y:19,z:11},model:"------------------------------------------------------------------------------------------------------------------------------------BGG-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-----------------BGG---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------B-G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-----------------B-G-----------------------------------------------------------------------------------------B--B--B--B--------------------------BBBBBBBBBBBBBBBBBB--BBBBBBBB------------B-R-R-BB----BGG-----BBBBBBBB------G-------------------G-------------------G-------------------R-------------------R-------------------R-------------------G-------------------G-------------------G-----------------BGG-----------------------------------------------YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY--BB---B----------BBB-BBBBBB------------B-------------B-G-----B-------------G-------------------G-------------------G-------------------R-------------------G-------------------R-------------------G-------------------G-------------------G-----------------B-G-----------------------------------------------YYYYYYYYYYYYYYYYY---Y-------------YYY---Y-------------YYY---Y---YYYYYYYYYYYYY-BB---B------------BBBBBBBB------------BBR----B------BGG----BB----B--------G-------------------R-------------------R-------------------R-------------------G-------------------R-------------------R-------------------R-------------------G-----------------BGG---------------------------------------------RRRYYYYYYYYYYYYYYRRRRRR-------------YRRRRRR-------------YRRRRRR---YYYYYYYYYYYYRRBB---B-----B------RRBBBBBB-----B------RR-----B-----BB-G---RRB----B-----B--G---RR-----------B--R----------------B--G----------------B--G----------------B--G----------------B--G----------------B--G----------------B--R----------------B--G----------------BB-G----------------B-------------------B----------YYYYYYYYYYYYYYYYY---Y-------------YYY---Y-------------YYY---Y---YYYYYYYYYYYYY-BB---B------------BBBBBBBB------------BBR----B------BGG----BB----B--------G-------------------R-------------------R-------------------R-------------------G-------------------R-------------------R-------------------R-------------------G-----------------BGG-----------------------------------------------YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY----YYYYYYYYYYYYYYYY--BB---B----------BBB-BBBBBB------------B-------------B-G-----B-------------G-------------------G-------------------G-------------------R-------------------G-------------------R-------------------G-------------------G-------------------G-----------------B-G-----------------------------------------------------------------------------------------B--B--B--B--------------------------BBBBBBBBBBBBBBBBBB--BBBBBBBB------------B-R-R-BB----BGG-----BBBBBBBB------G-------------------G-------------------G-------------------R-------------------R-------------------R-------------------G-------------------G-------------------G-----------------BGG---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------B-G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-----------------B-G---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------BGG-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-------------------G-----------------BGG---------------------------------------------",pos:[{x:-6.75,y:-.2,z:12.25,r:70}],animation:"property:object3D.position.y; from:0; to:-0.24; loop:true; dir:alternate; dur:2300; easing:easeInOutSine;"};MMU.Ub[11]={name:"Castle",size:{x:17,y:11,z:17},model:"---------------------------------------------------------------------------------------------------------------------------------------------------------RRRRRRRRRRRRRRRRRR-R-R-R-R-R-R-R-R-GGGGR-----RGGGG--GGGGR-----RGGGG--GGGGR-----RGGGG--GGGGR-----RGGGG--YYYYR-----RYYYY--YYYYRR---RRYYYY--YYYYYRRRRRYYYYY--Y-Y-YYYYYYY-Y-Y--YYYYYYYYYYYYYYY-R---------------R------------------G---R-B-B-R---G--G---RBBBBBR---G--G---R-B-B-R---G--G---RBBBBBR---G--Y---R-B-B-R---Y--Y---RBBBBBR---Y--Y---YYYYYYY---Y-------------------YYYYYYYYYYYYYYY-R---------------RR---------------R-G---R-----R---G--G---R-----R---G--G---R-----R---G--G---R-----R---G--Y---R-----R---Y--Y---RR---RR---Y--Y---YRRRRRY---Y--Y---YYYYYYY---Y--YYYYYYYYYYYYYYY-R--RRRRRRRRRRR--R---R-R-R-R-R-R----G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y-------------------YYY---------YYY-R--R---------R--RR---------------R-G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--R---R---------R----G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--RR---------------R-G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--R---R---------R----G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--RR---------------R-G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--R---R---------R----G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--RR---------------R-G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y--Y-------------Y--YYY---------YYY-R--R---------R--R---R---------R----G-------------G--G-------------G--G-------------G--G-------------G--Y-------------Y--Y-------------Y--Y-------------Y-------------------YYY---------YYY-R--R---------R--RR---------------R-G---R-----R---G--G---R-----R---G--G---R-----R---G--G---R-----R---G--Y---R-----R---Y--Y---RR---RR---Y--Y---YRRRRRY---Y--Y---YYYYYYY---Y--YYYYYYYYYYYYYYY-R--RRRRRRRRRRR--R---R-R-R-R-R-R----G---R-B-B-R---G--G---RBBBBBR---G--G---R-B-B-R---G--G---RBBBBBR---G--Y---R-B-B-R---Y--Y---RBBBBBR---Y--Y---YYYYYYY---Y-------------------YYYYYYYYYYYYYYY-R---------------RR---------------R-GGGGR-----RGGGG--GGGGR-----RGGGG--GGGGR-----RGGGG--GGGGR-----RGGGG--YYYYR-----RYYYY--YYYYRR---RRYYYY--YYYYYRRRRRYYYYY--Y-Y-YYYYYYY-Y-Y--YYYYYYYYYYYYYYY-R---------------R--------------------------------------------------------------------------------------------------------------------------------------------------------------------------RRRRRRRRRRRRRRRRRR-R-R-R-R-R-R-R-R",pos:[{x:-7,y:.4,z:2,r:-60}]};MMU.Ub[12]={name:"Logo",size:{x:37,y:11,z:1},model:"Y-Y-Y-Y--Y---Y----YYY-Y--Y--GGG-G----Y-Y-Y-Y--Y---Y---Y----Y--Y-G--G-GGG--Y-Y-Y-YYYY---Y---Y----YYYY-G--G-G--G-Y-Y-Y-Y--Y---Y---Y----Y--Y-G--G-G--G-YYYYY--YY--YYYYY--YYY-Y--Y-G--G-GGG---------------------------------------R-R-R-RRRR-RRR--R-RRRR---R---R--R-RRRR-R-R-R----R--R-R-R-----R-R--R--R-R--R-R-R-RRR--R--R-R-RRR--R---R-RRRR-R--R-R-R-R----R--R-R-R----R---R-R--R-R--RRRRR-RRRR-RRR--R-RRRR-R---R--RR--R--",pos:[{x:1,y:5,z:0,r:0}],animation:"property:rotation; from:0 -120 0; to:0 240 0; loop:true; dur:30000; easing:linear;"};MMU.Ub["Windmill"]={name:"Windmill",size:{x:13,y:18,z:10},model:"----BBBBB--------BBBBB---------BBB-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------B-----B------B-----B-------B---B---------BBB---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------B-------B----B-------B-----B-----B-------B---B---------BBB----------YYY----------YYY----------YYY----------Y-Y----------Y-Y----------YYY----------YYY---------RYYYR---------RYR-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y----------------------------------Y---Y--------Y---Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B----B-------B-----B-----B-------B---B--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------Y---Y--------R---R---------R-R-----------R-----------------------------------------------B-------B----B-------B-----B-----B-------B---B---------BBB----------YYY----------YYY----------YYY----------YYY----------YYY----------YYY----------YYY---------RYYYR---------RYR-----------R------------------------------------------------B-----B------B-----B-------B---B---------BBB-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------BBBBB--------BBBBB---------BBB--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",pos:null};MMU.Ub["WindmillBlades"]={name:"WindmillBlades",size:{x:13,y:13,z:9},model:"------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G------------------------------------------------------------------------------------------------------------------------------------------------------------------------G----------------------------------------------------------------------------------------GGG----------G-G----------GGG----------G-G----------GGG-GGGGG------G-G-G-GGGGGGGGGGGGGGG-G-G-G------GGGGG-GGG----------G-G----------GGG----------G-G----------GGG----------------------------------------------------------------------------------------G------------------------------------------------------------------------------------",pos:null};MMU.Ub["Watermill"]={name:"Watermill",size:{x:18,y:12,z:10},model:"------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------YYY---------------------------------------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YYY---YYYY--------YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY------BB-YY-----YY------B--YY-----YY------B--YYY---YYYY-----B--YYYYYYYYYYYYYYYB--YBBBBBBBBBBBBBB---Y-----------------YY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY--------BYY-----YY------BB-YY-----YY------B--YY-----YY------B--YYY---YYYY-----B--YYYYYYYYYYYYYYYB--YBBBBBBBBBBBBBB---Y-----------------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YY-----YY---------YYY---YYYY--------YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---YYYYYYYYYYYYYYY---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------YYY---------------------------------------------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------YYY---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",pos:null};MMU.Ub["WatermillWheel"]={name:"WatermillWheel",size:{x:7,y:7,z:10},model:"------------------------G------------------------------------------------G------------------------------------------------G-------------------------RRRRR-RRRRRRRRR-R-RRRRRGRRRRR-R-RRRRRRRRR-RRRRR----R------R----------RR-G-RR----------R------R------R------R----------RR-G-RR----------R------R----RRRRR-RRRRRRRRR-R-RRRRRGRRRRR-R-RRRRRRRRR-RRRRR-------------------------G------------------------------------------------G------------------------------------------------G------------------------",pos:null};MMU.Ub["Play"]={name:"Play",size:{x:19,y:5,z:1},model:"G----GGG-G--G---G--GGG--G---G--G---G--G--G-G---GGGG--GGG-G--G-G---G--G-G---GGGG--G----GG--G---G",pos:[{x:1,y:12,z:0,r:0}],animation:"property:rotation; from:0 -120 0; to:0 240 0; loop:true; dur:30000; easing:linear;"};MMU.Ub["Reset"]={name:"Reset",size:{x:25,y:5,z:1},model:"R--R-RRRR-RRR--RRRR---R--R--R-R-------R-R------R--RRR--RRR---RR--RRR----R--R--R-R----R----R------R--RRR--RRRR--RRR-RRRR-RRRRR",pos:[{x:1,y:8.5,z:0,r:0}],animation:"property:rotation; from:0 -120 0; to:0 240 0; loop:true; dur:30000; easing:linear;"};MMU.Ub["QuestController"]={name:"QuestController",size:{x:6,y:7,z:9},model:"--YY---YYYY-Y----YY----YY----YY----Y-YYYY---YY---YBBY-Y----YY----YY----YY----Y-YYYY---YY---YBBY---------------------------------YY---YYYY---------------------------------YY----YY----------------------------------YY----YY----------------------------------YY----YY----------------------------------YY----YY----------------------------------YY----YY--------------------------------",pos:null};MMU.Ub["GoController"]={name:"GoController",size:{x:6,y:2,z:9},model:"--YY---YYYY---YY---YBBY---YY---YBBY---YY---YYYY---YY----YY----YY----YY----YY----YY----YY----YY----YY----YY--",pos:null};AFRAME.registerComponent("model",{schema:{level:{type:"string","default":"0"},yoffset:{type:"float","default":0}},dependencies:[],init:function(){if(!this.init.Tb){this.init.Tb=[]}if(!this.init.Tb[this.data.level]){let t=MMU.Ub[this.data.level];this.init.Tb[this.data.level]=MeshGenerator.generate(t.name,t.size,t.model,this.data.yoffset)}let t=this.init.Tb[this.data.level];t=new THREE.Mesh(t.geometry,t.material);this.el.setObject3D("mesh",t)}});class MeshGenerator{static generate(t,R,h,Y){h=h.replaceAll(/[\r\n\t ]/gm,"");let e;let a=0;this.De=[];for(let s=0;s<R.z;s++){let t=[];this.De.push(t);for(let i=0;i<R.y;i++){let e=[];t.push(e);for(let Y=0;Y<R.x;Y++){let t=h[a++];switch(t){case"R":e.push({x:Y,y:i,z:s,col:{id:"R",r:1,g:0,b:0}});break;case"G":e.push({x:Y,y:i,z:s,col:{id:"G",r:0,g:1,b:0}});break;case"B":e.push({x:Y,y:i,z:s,col:{id:"B",r:0,g:0,b:1}});break;case"Y":e.push({x:Y,y:i,z:s,col:{id:"Y",r:1,g:.7,b:0}});break;default:e.push(null);break}}}}let s=[];let n=[];let o=[];let l=[];a=0;const G=-R.x/2;const c=-R.y*Y;const r=-R.z/2;const i=[-.25,-.25,.75,-.25,.25,.75,.25,.25,.75,.25,-.25,.75];for(let i=0;i<R.y;i++){for(let e=0;e<R.x;e++){for(let Y=0;Y<R.z;Y++){let t=this.De[Y][i][e];if(t&&!this.De[Y]?.[i]?.[e-1]){this._setPosition(s,e+G,i+c,Y+r-1,e+G,i+c+1,Y+r-1,e+G,i+c+1,Y+r,e+G,i+c,Y+r);o.push(-.8,-.4,-.4,-.8,.4,-.4,-.8,.4,.4,-.8,-.4,.4);this.Dd(n,t.col,e-1,i,Y-1,e-1,i+1,Y,e-1,i,Y+1,e-1,i-1,Y);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}for(let i=0;i<R.y;i++){for(let e=0;e<R.x;e++){for(let Y=0;Y<R.z;Y++){let t=this.De[Y][i][e];if(t&&!this.De[Y]?.[i]?.[e+1]){this._setPosition(s,e+G+1,i+c,Y+r,e+G+1,i+c+1,Y+r,e+G+1,i+c+1,Y+r-1,e+G+1,i+c,Y+r-1);o.push(.8,-.4,.4,.8,.4,.4,.8,.4,-.4,.8,-.4,-.4);this.Dd(n,t.col,e+1,i,Y+1,e+1,i+1,Y,e+1,i,Y-1,e+1,i-1,Y);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}for(let i=0;i<R.y;i++){for(let e=0;e<R.x;e++){for(let Y=0;Y<R.z;Y++){let t=this.De[Y][i][e];if(t&&!this.De[Y]?.[i-1]?.[e]){this._setPosition(s,e+G,i+c,Y+r-1,e+G,i+c,Y+r,e+G+1,i+c,Y+r,e+G+1,i+c,Y+r-1);o.push(-.4,-.8,-.4,-.4,-.8,.4,.4,-.8,.4,.4,-.8,-.4);this.Dd(n,t.col,e-1,i-1,Y,e,i-1,Y+1,e+1,i-1,Y,e,i-1,Y-1);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}for(let i=0;i<R.y;i++){for(let e=0;e<R.x;e++){for(let Y=0;Y<R.z;Y++){let t=this.De[Y][i][e];if(t&&!this.De[Y]?.[i+1]?.[e]){this._setPosition(s,e+G,i+c+1,Y+r,e+G,i+c+1,Y+r-1,e+G+1,i+c+1,Y+r-1,e+G+1,i+c+1,Y+r);o.push(-.4,.8,.4,-.4,.8,-.4,.4,.8,-.4,.4,.8,.4);this.Dd(n,t.col,e-1,i+1,Y,e,i+1,Y-1,e+1,i+1,Y,e,i+1,Y+1);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}for(let i=0;i<R.y;i++){for(let e=0;e<R.z;e++){for(let Y=0;Y<R.x;Y++){let t=this.De[e][i][Y];if(t&&!this.De[e-1]?.[i]?.[Y]){this._setPosition(s,Y+G+1,i+c,e+r-1,Y+G+1,i+c+1,e+r-1,Y+G,i+c+1,e+r-1,Y+G,i+c,e+r-1);o.push(.4,-.4,-.8,.4,.4,-.8,-.4,.4,-.8,-.4,-.4,-.8);this.Dd(n,t.col,Y+1,i,e-1,Y,i+1,e-1,Y-1,i,e-1,Y,i-1,e-1);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}for(let i=0;i<R.y;i++){for(let e=0;e<R.z;e++){for(let Y=0;Y<R.x;Y++){let t=this.De[e][i][Y];if(t&&!this.De[e+1]?.[i]?.[Y]){this._setPosition(s,Y+G,i+c,e+r,Y+G,i+c+1,e+r,Y+G+1,i+c+1,e+r,Y+G+1,i+c,e+r);o.push(-.4,-.4,.8,-.4,.4,.8,.4,.4,.8,.4,-.4,.8);this.Dd(n,t.col,Y-1,i,e+1,Y,i+1,e+1,Y+1,i,e+1,Y,i-1,e+1,Y,i,e);l.push(a+1,a+0,a+2,a+3,a+2,a+0);a+=4}}}}let B=.25;for(let t=0;t<s.length;t++){s[t]*=B}let d=new THREE.BufferGeometry;d.setAttribute("position",new THREE.Float32BufferAttribute(s,3));d.setAttribute("normal",new THREE.Float32BufferAttribute(o,3));d.setAttribute("color",new THREE.Float32BufferAttribute(n,3));d.setIndex(l);d.uvsNeedUpdate=true;d.addGroup(0,a,0);d.computeBoundingBox();return new THREE.Mesh(d,new THREE.MeshStandardMaterial({roughness:1,metalness:0,vertexColors:true}))}static _setPosition(t,Y,e,i,s,R,h,a,n,o,l,G,c){t.push(Y+0*Math.sin(e/3)*.5,e,i+0*Math.cos(e/3)*.5,s+0*Math.sin(R/3)*.5,R,h+0*Math.cos(R/3)*.5,a+0*Math.sin(n/3)*.5,n,o+0*Math.cos(n/3)*.5,l+0*Math.sin(G/3)*.5,G,c+0*Math.cos(G/3)*.5)}static Dd(t,Y,e,i,s,R,h,a,n,o,l,G,c,r){let B=1;let d=1;let u=1;let m=1;if(this.De[s]?.[i]?.[e]){B*=.3;d*=.3}if(this.De[a]?.[h]?.[R]){d*=.3;u*=.3}if(this.De[l]?.[o]?.[n]){u*=.3;m*=.3}if(this.De[r]?.[c]?.[G]){m*=.3;B*=.3}let b=this._getCol;t.push(b(Y.r,B),b(Y.g,B),b(Y.b,B),b(Y.r,d),b(Y.g,d),b(Y.b,d),b(Y.r,u),b(Y.g,u),b(Y.b,u),b(Y.r,m),b(Y.g,m),b(Y.b,m))}static _getCol(t,Y,e){return Math.max(0,Math.min(1,(t+Math.random()*.4-.2)*Y))}}AFRAME.registerComponent("menu",{schema:{},init:function(){this.Rb=Xc(this.el,"a-entity",{model:`level:Play;`,position:{x:0,y:-.1,z:-1.5},animation__scale:`property:scale; from:0 0 0; to:0.2 0.2 0.2; dur:1000; delay:0;easing:easeOutElastic;`});this.Sb=Xc(this.el,"a-entity",{model:`level:Reset;`,position:{x:0,y:-.6,z:-1.5},animation__scale:`property:scale; from:0 0 0; to:0.1 0.1 0.1; dur:1000; delay:0;easing:easeOutElastic;`});this.Wc=new THREE.Raycaster;this.Uc=new THREE.Vector2;document.addEventListener("click",this.Hc.bind(this));document.getElementById("controllerLeft").addEventListener("triggerup",this.Fc.bind(this));document.getElementById("controllerRight").addEventListener("triggerup",this.Gc.bind(this));document.getElementById("controllerGo").addEventListener("triggerup",this.Ec.bind(this))},update:function(){},tick:function(){},remove:function(){},pause:function(){this.el.setAttribute("visible","false");this.active=false},play:function(){this.el.setAttribute("visible","true");this.Hd();this.active=true},Hc:function(t){if(!this.camera){this.camera=document.getElementById("camera").getObject3D("camera");if(!this.camera){return}}this.Uc.x=t.clientX/window.innerWidth*2-1;this.Uc.y=-(t.clientY/window.innerHeight)*2+1;this.Wc.setFromCamera(this.Uc,this.camera);this.Ga(this.Wc)},Fc(){let t=document.getElementById("raycasterLeft").components["raycaster"].raycaster;this.Ga(t)},Gc(){let t=document.getElementById("raycasterRight").components["raycaster"].raycaster;this.Ga(t)},Ec(){let t=document.getElementById("raycasterGo").components["raycaster"].raycaster;this.Ga(t)},Ga(t){if(!this.active)return;if(!this.Rb.isMesh){this.Rb=this.Rb.object3D.children[0];this.Sb=this.Sb.object3D.children[0]}const e=t.intersectObjects(this.el.object3D.children,true);if(e.length>0){let t=e[0].object;let Y=e[0].instanceId;this.Ic(t)}},Ic(t){if(t===this.Rb){if(MMU.Fd.level>=MMU.Ub.length){MMU.Fd.setLevel(0);document.getElementById("orchestrator").Sa()}this.el.pause();document.getElementById("level").play();MMU.Od()}else if(t===this.Sb){document.getElementById("orchestrator").reset()}},Hd(){let t=document.getElementById("rig");let Y=document.getElementById("camera");t.object3D.position.set(-3,2,15);t.object3D.rotation.y=.2;Y.object3D.position.set(0,1.6,0);Y.object3D.rotation.set(0,0,0)}});class Settings{constructor(){this.load()}load(){this.Fd=JSON.parse(localStorage.getItem("medievalmatchup"));if(!this.Fd){this.Fd={level:MMU.Ub.length,cleared:[]};this.store()}}store(){localStorage.setItem("medievalmatchup",JSON.stringify(this.Fd))}Zb(){this.setLevel(this.Fd.level+1)}setLevel(t){this.Fd.level=t;this.Fd.cleared=[];this.store()}get level(){return this.Fd.level}Ob(t,Y,e){let i=Math.round(t*10);let s=Math.round(Y*10);let R=Math.round(e*10);return this.Fd.cleared.find(t=>t.x===i&&t.y===s&&t.z===R)!=null}Cd(t,Y,e){let i=Math.round(t*10);let s=Math.round(Y*10);let R=Math.round(e*10);this.Fd.cleared.push({x:i,y:s,z:R})}}MMU.Fd=new Settings;AFRAME.registerComponent("orchestrator",{schema:{},init:function(){this.Sa();this.el.Sa=this.Sa;this.el.reset=this.reset},update:function(){},tick:function(){},remove:function(){},pause:function(){},play:function(){this.level=document.getElementById("level");this.level.pause();this.menu=document.getElementById("menu")},reset:function(){MMU.Fd.setLevel(0);this.Sa();MMU.Fd.setLevel(MMU.Ub.length);this.Sa()},Sa:function(){this.Be=document.getElementById("visiblemodels");let R=0;for(let s=0;s<MMU.Ub.length;s++){let i=MMU.Ub[s];for(let e=0;e<i.pos.length;e++){let t=i.name+(e===0?"":e);let Y=document.getElementById(t);if(Y&&s<MMU.Fd.level){continue}else if(Y&&s>=MMU.Fd.level){Y.remove();continue}else if(s>=MMU.Fd.level){continue}R+=250;if(i.name==="Windmill"){let t=Xc(this.Be,"a-entity",{id:"Windmill",model:`level:Windmill;`,position:i.pos[e],rotation:{x:0,y:i.pos[e].r,z:0},scale:"0 0 0",shadow:"cast:true;",animation__scale:`property:scale; from:0 0 0; to:1 1 1; dur:3000; delay:${R};easing:easeOutElastic;`});Xc(t,"a-entity",{model:`level:WindmillBlades; yoffset:0.5;`,position:"0 2.875 0.125",shadow:"cast:true;",animation__rotate:`property:object3D.rotation.z; from:0; to:360; loop:true; dur:3000; easing:linear;`})}else if(i.name==="Watermill"){let t=Xc(this.Be,"a-entity",{id:"Watermill",model:`level:Watermill;`,position:i.pos[e],rotation:{x:0,y:i.pos[e].r,z:0},scale:"0 0 0",shadow:"cast:true;",animation__scale:`property:scale; from:0 0 0; to:1 1 1; dur:3000; delay:${R};easing:easeOutElastic;`});Xc(t,"a-entity",{model:`level:WatermillWheel; yoffset:0.5;`,position:"1.125 1.125 0",shadow:"cast:true;",animation__rotate:`property:object3D.rotation.z; from:360; to:0; loop:true; dur:3000; easing:linear;`})}else if(i.animation)Xc(this.Be,"a-entity",{id:`${t}`,model:`level:${s};`,position:i.pos[e],rotation:{x:0,y:i.pos[e].r,z:0},scale:"0 0 0",shadow:"cast:true;",animation__scale:`property:scale; from:0 0 0; to:1 1 1; dur:3000; delay:${R};easing:easeOutElastic;`,animation__extra:i.animation});else Xc(this.Be,"a-entity",{id:`${t}`,model:`level:${s};`,position:i.pos[e],rotation:{x:0,y:i.pos[e].r,z:0},shadow:"cast:true;",scale:"0 0 0",animation__scale:`property:scale; from:0 0 0; to:1 1 1; dur:3000; delay:${R};easing:easeOutElastic;`})}}}});AFRAME.registerComponent("level",{schema:{},dependencies:[],Qb:100,init:function(){this.Pa();this.scale=.25;this.el.addEventListener("Mc",this.Nc.bind(this))},play:function(){this.Gd()},pause:function(){this.Ya()},Pa:function(){let i=this.el.object3D;let s=new THREE.Color;let R=Qd.Na();let h=[];for(let e=0;e<64;e++){let t=Rd.Mb(e);let Y=new THREE.InstancedMesh(R,t,this.Qb);Y.count=0;Y.frustumCulled=false;Y.userData.Tc=e;Y.setColorAt(0,s);i.add(Y);h.push(Y)}this.Tb=h},Id(){let t=this.level.pos[0];let Y=document.getElementById("rig");let e=document.getElementById("camera");let i=document.getElementById("levelrig");let s=t.y+this.level.size.y/2*this.scale+2;let R=Math.atan2(t.x,t.z);i.object3D.position.set(t.x,s,t.z);i.object3D.rotation.y=R;e.object3D.position.set(0,1.6,0);e.object3D.rotation.set(0,0,0);let h=Math.sqrt(t.x*t.x+t.z*t.z)+Math.max(this.level.size.x,Math.max(this.level.size.y,this.level.size.z))/2*this.scale+2;Y.object3D.position.set(Math.sin(R)*h,s-1.6,Math.cos(R)*h);Y.object3D.rotation.y=R;this.el.object3D.rotation.set(.3,-.3,0)},Qa(){this.Vd=0;for(let t=0;t<this.Tb.length;t++){this.Tb[t].count=0}let s=this.level;s.model=s.model.replaceAll(/[\r\n\t ]/gm,"");let R=0;let t;let h={r:[],g:[],b:[],y:[]};for(let i=0;i<s.size.z;i++){for(let e=0;e<s.size.y;e++){for(let Y=0;Y<s.size.x;Y++){let t=s.model[R++];switch(t){case"R":h.r.push({x:Y,y:e,z:i,col:"#F22",r:Math.random()});break;case"G":h.g.push({x:Y,y:e,z:i,col:"#2F2",r:Math.random()});break;case"B":h.b.push({x:Y,y:e,z:i,col:"#22F",r:Math.random()});break;case"Y":h.y.push({x:Y,y:e,z:i,col:"#FC2",r:Math.random()});break;default:break}}}}this.Xa("R",h.r.sort(this.Md),s);this.Xa("G",h.g.sort(this.Md),s);this.Xa("B",h.b.sort(this.Md),s);this.Xa("Y",h.y.sort(this.Md),s)},Md(t,Y){return t.r-Y.r},Xa(t,R,h){let a=Array.from(Array(64),(t,Y)=>({i:Y,r:Math.random()})).sort(this.Md);let n=0;let o=0;for(let t=0;t<R.length;t++){let Y=R[t];let e=(Y.x-(h.size.x-1)/2)*this.scale;let i=(Y.y-(h.size.y-1)/2)*this.scale;let s=(Y.z-(h.size.z-1)/2)*this.scale;if(!MMU.Fd.Ob(e,i,s)){let t=a[n].i;if(o%2){n=(n+1)%64}o++;this.Wa(e,i,s,t,new THREE.Color(Y.col));this.Vd++}}},Wa:function(t,Y,e,i,s){let R=this.Tb[i];let h=R.count;if(h===this.Qb)throw`MaxCount reached on Tc ${i}`;R.count+=1;let a=new THREE.Vector3(t,Y,e);let n=new THREE.Vector3(this.scale,this.scale,this.scale);let o=0;let l=new THREE.Euler(0,0,0,"ZYX");let G=new THREE.Quaternion;l.set(0,o,0);G.setFromEuler(l);let c=new THREE.Matrix4;c.compose(a,G,n);R.setMatrixAt(h,c);R.instanceMatrix.needsUpdate=true;R.setColorAt(h,s);R.instanceColor.needsUpdate=true},Nc:function(t){let Y=t.detail.object;let e=t.detail.instanceId;let i=new THREE.Color;i.fromArray(Y.instanceColor.array,e*3);let s=0;for(let t=0;t<Y.count;t++){if(Y.instanceMatrix.array[t*16]!==0&&i.r===Y.instanceColor.array[t*3+0]&&i.g===Y.instanceColor.array[t*3+1]&&i.b===Y.instanceColor.array[t*3+2]){s++}}let R=new THREE.Matrix4;Y.getMatrixAt(e,R);const h=new THREE.Vector3;const a=new THREE.Quaternion;const n=new THREE.Vector3;R.decompose(h,a,n);let o={object:Y,instanceId:e,position:h,color:i,instanceMatrix:R,position:h,quaternion:a,scale:n};if(!this.lastSelection&&s===1){R.multiplyScalar(0);Y.setMatrixAt(o.instanceId,R);Y.instanceMatrix.needsUpdate=true;MMU.Fd.Cd(h.x,h.y,h.z);MMU.Fd.store();this.Cb("sine",1300,1);this.Vd--}else if(!this.lastSelection){o.scale.set(this.scale*1.2,this.scale*1.2,this.scale*1.2);o.instanceMatrix.compose(o.position,o.quaternion,o.scale);Y.setMatrixAt(o.instanceId,o.instanceMatrix);Y.instanceMatrix.needsUpdate=true;this.lastSelection=o;this.Cb("sine",25,1)}else if(this.lastSelection.object.uuid!==o.object.uuid||this.lastSelection.instanceId===o.instanceId||this.lastSelection.color.r!==o.color.r||this.lastSelection.color.g!==o.color.g||this.lastSelection.color.b!==o.color.b){this.lastSelection.scale.set(this.scale,this.scale,this.scale);this.lastSelection.instanceMatrix.compose(this.lastSelection.position,this.lastSelection.quaternion,this.lastSelection.scale);this.lastSelection.object.setMatrixAt(this.lastSelection.instanceId,this.lastSelection.instanceMatrix);this.lastSelection.object.instanceMatrix.needsUpdate=true;this.lastSelection=null;this.Cb("triangle",25,2)}else{R.multiplyScalar(0);Y.setMatrixAt(this.lastSelection.instanceId,R);Y.setMatrixAt(o.instanceId,R);Y.instanceMatrix.needsUpdate=true;MMU.Fd.Cd(this.lastSelection.position.x,this.lastSelection.position.y,this.lastSelection.position.z);MMU.Fd.Cd(h.x,h.y,h.z);MMU.Fd.store();this.lastSelection=null;this.Cb("sine",1300,1);this.Vd-=2}if(this.Vd===0){MMU.Fd.Zb();document.getElementById("orchestrator").Sa();if(MMU.Fd.level===MMU.Ub.length){this._victory()}setTimeout(()=>{if(MMU.Fd.level<MMU.Ub.length){document.getElementById("orchestrator").Sa();this.Gd()}else{this.el.pause();document.getElementById("menu").play();document.getElementById("orchestrator").reset()}},5e3)}},Gd:function(){MMU.Fd.load();this.level=MMU.Ub[MMU.Fd.level];if(!this.level){return}this.Qa();this.Id()},Ya(){for(let t=0;t<this.Tb.length;t++){this.Tb[t].count=0}},Cb:function(t,Y,e){if(!this.audioContext){this.audioContext=new AudioContext}let i=this.audioContext.createOscillator();let s=this.audioContext.createGain();i.frequency.value=Y;i.connect(s);i.type=t;s.connect(this.audioContext.destination);i.start(0);s.gain.exponentialRampToValueAtTime(1e-5,this.audioContext.currentTime+e)},_victory:function(t=0){if(t++<6){setTimeout(()=>{this.Cb("sine",100+t*t*10,3);this._victory(t)},500)}}});AFRAME.registerComponent("clicker",{schema:{},init:function(){this.Wc=new THREE.Raycaster;this.Uc=new THREE.Vector2;document.addEventListener("click",this.Hc.bind(this));document.getElementById("controllerLeft").addEventListener("triggerup",this.Fc.bind(this));document.getElementById("controllerRight").addEventListener("triggerup",this.Gc.bind(this));document.getElementById("controllerGo").addEventListener("triggerup",this.Ec.bind(this))},update:function(){},tick:function(){},Hc:function(t){if(!this.camera){this.camera=document.getElementById("camera").getObject3D("camera");if(!this.camera){return}}this.Uc.x=t.clientX/window.innerWidth*2-1;this.Uc.y=-(t.clientY/window.innerHeight)*2+1;this.Wc.setFromCamera(this.Uc,this.camera);this.Ga(this.Wc)},Fc(){let t=document.getElementById("raycasterLeft").components["raycaster"].raycaster;this.Ga(t)},Gc(){let t=document.getElementById("raycasterRight").components["raycaster"].raycaster;this.Ga(t)},Ec(){let t=document.getElementById("raycasterGo").components["raycaster"].raycaster;this.Ga(t)},Ga(t){if(!this.stones){this.stones=this.el;if(!this.stones){return}this.stones=this.stones.object3D.children}const e=t.intersectObjects(this.stones,false);if(e.length>0){let t=e[0].object;let Y=e[0].instanceId;this.el.emit("Mc",{object:t,instanceId:Y})}},remove:function(){},pause:function(){},play:function(){}});AFRAME.registerComponent("rotator",{schema:{},init:function(){this.state="nodrag";document.addEventListener("mousedown",this.Jc.bind(this));document.addEventListener("mousemove",this.Kc.bind(this));document.addEventListener("mouseup",this.Lc.bind(this));document.addEventListener("touchstart",this.Jc.bind(this));document.addEventListener("touchmove",this.Kc.bind(this));document.addEventListener("touchend",this.Lc.bind(this));document.getElementById("controllerGo").addEventListener("axismove",this.Dc.bind(this));document.getElementById("controllerLeft").addEventListener("thumbstickmoved",this.Oc.bind(this));document.getElementById("controllerRight").addEventListener("thumbstickmoved",this.Oc.bind(this))},update:function(){},tick:function(){},Jc:function(t){if(!isNaN(t.button)||t.type==="touchstart"){if(t.type==="touchstart"){t=t.touches[0]}this.state="dragstart";this.pointerX=t.clientX/window.innerWidth*2-1;this.pointerY=-(t.clientY/window.innerHeight)*2+1}else this.state="nodrag"},Kc:function(t){if(t.type==="touchmove"){t=t.touches[0]}let Y=t.clientX/window.innerWidth*2-1;let e=-(t.clientY/window.innerHeight)*2+1;let i=Math.max(Math.abs(Y-this.pointerX),Math.abs(e-this.pointerY));if(this.state==="dragstart"&&i>.01||this.state==="dragging"){this.state="dragging";this.el.object3D.rotation.y+=Math.PI*(Y-this.pointerX)/2;this.el.object3D.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.el.object3D.rotation.x-Math.PI*(e-this.pointerY)/4));this.pointerX=Y;this.pointerY=e}},Lc:function(t){this.state="nodrag"},Dc:function(t){let Y=t.detail.axis[0];let e=t.detail.axis[1];this.Ad(Y,e)},Oc:function(t){let Y=t.detail.x;let e=t.detail.y;this.Ad(Y,e)},Ad(t,Y){if(t<-.05)t=(t+.05)/.95;else if(t>.05)t=(t-.05)/.95;else t=0;if(Y<-.05)Y=(Y+.05)/.95;else if(Y>.05)Y=(Y-.05)/.95;else Y=0;this.el.object3D.rotation.y+=.05*t;this.el.object3D.rotation.x+=.05*Y;this.el.object3D.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.el.object3D.rotation.x))},remove:function(){},pause:function(){},play:function(){}});
</script>
<style>
.a-canvas.a-grab-cursor:hover{cursor:default !important}
.a-canvas.a-grab-cursor:active,.a-grabbing{cursor:default !important}
</style>
</head>
<body>
<a-scene id="scene" renderer="colorManagement:true;" light="defaultLightsEnabled:false" shadow="type:pcfsoft;">
<a-sky hide-on-enter-ar src="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAgCAYAAADT5RIaAAAAAXNSR0IArs4c6QAAADZJREFUGFdjUFuz7z8DmYT2uv3/GUL2nfnPUHv2xn+G5Xef/mc4/+bDf4aff//+Z/j//z/lBACQnGoWboVOzgAAAABJRU5ErkJggg==)"></a-sky>
<a-entity light="type:ambient; color:#555"></a-entity>
<a-entity light="type:directional; color:#FFF; intensity:1; castShadow:true; shadowCameraAutomatic:#island;" position="-1 1 1"></a-entity>      
<a-entity id="levelrig">
<a-entity id="level" level clicker rotator></a-entity>
</a-entity>
<a-entity id="rig">
<a-entity id="menu" menu position="0 1.6 0">
<a-sphere color="#000" radius="2" material="side:back; opacity:0.4; shader:flat;"></a-sphere>
</a-entity>      
<a-entity camera id="camera" position="0 1.6 0" look-controlszzz wasd-controlszzz="fly:true;acceleration:10;">
<a-text fps-counterzzz position="0 -0.1 -0.25" width="0.25"></a-text>
</a-entity>
<a-entity id="controllerLeft" oculus-touch-controls="hand:left; model:false;" show-on-move>
<a-entity model="level:QuestController;yoffset:1;" scale="0.05 0.05 0.05"></a-entity>
<a-entity id="raycasterLeft" raycaster="objects:no_auto_intersects; showLine:true; lineColor:white; lineOpacity:0.5,interval:250;" rotation="-45 0 0" position="0 -0.065 -0.06"></a-entity>
</a-entity>
<a-entity id="controllerRight" oculus-touch-controls="hand:right; model:false;" show-on-move>
<a-entity model="level:QuestController;yoffset:1;" scale="0.05 0.05 0.05"></a-entity>
<a-entity id="raycasterRight" raycaster="objects:.no_auto_intersects; showLine:true; lineColor:white; lineOpacity:0.5,interval:250;" rotation="-45 0 0" position="0 -0.065 -0.06"></a-entity>
</a-entity>
<a-entity id="controllerGo" oculus-go-controls="hand:right; armModel:true; model:false;" position="0 -1 -0.25" show-on-move>
<a-entity model="level:GoController" scale="0.05 0.05 0.05" rotation="20 0 0" >
<a-entity id="raycasterGo" raycaster="objects:.no_auto_intersects; showLine:true; lineColor:white; lineOpacity:0.5,interval:250;" position="0 0.25 0"></a-entity>
</a-entity>
</a-entity>      
</a-entity>
<a-entity id="island" island position="0 -0.5 0" shadow="receive:true;"></a-entity>
<a-entity id="visiblemodels"></a-entity>
<a-ring hide-on-enter-ar radius-inner="9" radius-outer="200" rotation="-90 0 0" material="shader:water;"></a-ring>
<a-ring show-on-enter-ar radius-inner="9" radius-outer="20" rotation="-90 0 0" material="shader:water;"></a-ring>
<a-entity position="-3 5 10" scale="0.1 0.1 0.1" 
animation__rotate="property:rotation; from:0 0 0; to:0 360 0; loop:true; dur:10000; easing:linear;">
<a-entity seagull position="-25 0 0" rotation="0 0 -15"
animation__updown="property:object3D.position.y; from:0; to:4; loop:true; dir:alternate; dur:1000; easing:easeInOutSine;">
</a-entity>
<a-entity seagull position="25 0 0" rotation="0 180 -15"
animation__updown="property:object3D.position.y; from:4; to:0; loop:true; dir:alternate; dur:1300; easing:easeInOutSine;">
</a-entity>
</a-entity>
<a-entity position="6 8 3" scale="0.1 0.1 0.1" animation="property:rotation; from:0 270 0; to:0 -90 0; loop:true; dur:10000; easing:linear;">
<a-entity seagull position="-25 0 0" rotation="0 180 15"
animation__updown="property:object3D.position.y; from:0; to:4; loop:true; dir:alternate; dur:900; easing:easeInOutSine;">
</a-entity>
<a-entity seagull position="25 0 0" rotation="0 0 15"
animation__updown="property:object3D.position.y; from:4; to:0; loop:true; dir:alternate; dur:1100; easing:easeInOutSine;">
</a-entity>
</a-entity>
<a-entity id="orchestrator" orchestrator></a-entity>
</a-scene>
<script>
let scene=document.getElementById('scene');
let environment=new THREE.TextureLoader().load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAgBAMAAABQs2O3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJUExURYCAgAAAAP///z6loLUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAtSURBVDjLY2AUYGBgUmDASRNWgF8aRBNSQKl+BmKcSUDBaDiMhsNoOKDRTAoAk+wZgR6ayGIAAAAASUVORK5CYII=");
environment.encoding=THREE.sRGBEncoding;
environment.mapping=THREE.EquirectangularReflectionMapping;
scene.object3D.environment=environment;
</script> 
</body> 
</html>
