<!doctype html><title>Economy of Motion - js13kGames 2024</title><style>html{background-color:#000;cursor:none}body{margin:0;overflow:hidden}canvas{image-rendering:pixelated;width:100vw;height:100vh;object-fit:contain}img{display:none}song{display:none}stage{display:none}</style><img src="data:image/png;base64,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"><song name=sm>H)bD(GD'?,GQ'Z(SD,NJ'M)_D(GD'[(SE,NN'M(GD,GX'M(SF'L,NI'?(SF'L)bX(GH'[)dM(SD'M,GZ)bK(GI'[(SD,NG'M)_G(GN'\,NM(SF'L)^Z,GZ'?(GG'K(SG'M)_y'?,NI(SE'M(GP'[(SD'M)aP(BJ,B['Z(ND'?,IJ'L(BK'?)aM'[(ND,IP'M)a[(BG,BX'M(NE'L(NF)_N,IJ'M(BD'[)^~(NG'M(BI,B['[(ND,IH'M(BD'\(ND,IP'L(BD,G\'L(NE'N(ND,FN'L(BF,CZ'[,BM'?(NE'L)af(@L,@k'\(LE'M)^L(@K,Co'L)aM'M)^U(LD'M)[O(@E,Fk'L(LD)XO'M)[P(LD'M)^T(@D,Ii'M)aN'L)dO(LF'M)b~(CH,J~'[(OG'M(CI'[(OI'M,C~)_~(CH'M(OD'M(OL'L(CJ'\(OL'L)^T(BH,Bi'\(NE'M)^S(BH,Fj'[(ND'M)^[(BI,Il'L(NC'M(ND)_O'M(BD,Nl'[)a~(NL'M(BJ,Rh'[(NF'M(BH'[)ZN(NJ,BT'M)\m(BH,Dl'M(NC'M(NG'L)^o(BM,Fi'\(NE'L)_L(GJ,GZ'\(SD,NJ'L)ZM(GD'\,NQ(SD'M(GE,G['L(SD'M(SD,NJ'M)_O(GF'[)aR(SE'M)_L(GI,GV'[(SD,NJ'M(GF)ZN'[(SD,NM'M)YZ(GF,GZ'L(SE'M)Ze(SD,NM'M(GE'\(SD'L)YT(BH,BY'\)ZP(NJ,IK'L(BD'T(NG'E)YQ'?,IN'L)ZO'?,BZ(BH'L(NF'M,IJ(NH'L)YX'?(BH'[)Z~(NH'L,BX'?(BG'[,IJ(NI'M(BF'[(NE,IQ'M(BE,GY'M(NF'L(ND,FL'M(BG,CZ'\(ND,BM'L,@k)ZX(@I'[)[U'?(LH'L,Cn)^J(@H'[(LD'?)ZT'L(@J,Fj)[['M(LF'M(LF)aD'L(@J,Ij'?)ZM'[(LE)[L'L(@K,Lq'?)dW'[(LG)ZS'L(@H'?)[G,Ol'[)gO(LF'M)Z^(@J,Rn'M(LF'L(LI)[L'M)f`(@J,Uh'[)dN(LE'M)a](BJ,Bp'\)bO(NH'L)gR(BG,Fi'[(ND'?)aD'L(BH)bY,Im'M(NF'M(ND)gM'L(BH)a]'?,Nk'[(NF)bP'M)f~(BH,Rm'[(NG'M(BH,Um'[(NF'M(BI,Zj'M(NF'M(NF'L(BF'Z(NF'O</song><song name=taf>H(aD'A(bD'A(eG'B(fF(ZH'X(gL'L(fK'X(eO'L(fX'Y(ZO'K(af'f(bg(Zg'f(^h'f(_I(SX'X(GQ(GQ'~'~'Q</song><song name=tts>H*E^*[]'W*LX*ZW'W*QV*Ur'W*ST'W*QS*VV'W*LW*UW'W*EZ*Vn'W*LV'W*QW*Us'W*SV'W*QS*Vn'W*LV'W*Cc*S~'W*JX'W*O['W*QZ'W*S['W*UW'W*E]*Vr'W*LX'W*QV*Uu'W*SX'W*QW*Vq'W*LX'W*Gb*Sn'W*NZ'W*SW'W*Uc'W*V['W*Z\'W*^~'~'b*ZW'W*XY'W*EZ*Z~'W*LZ'W*QX'W*S^'W*UY'W*VX'W*X~'~'b*VZ'W*UV'W*C[*S~'W*J['W*O]'W*QY'W*SZ'W*UX'W*Eb*Vq'W*LW'W*QW*Ur'W*SW'W*QW*Vn'W*LX'W*G]*Sm'W*NX'W*SX'W*G['W*NU'W*SV'W*GW'W*NU'W*ST'W*GX'W*NS'W*SQ'W</song><stage>hJQeoUOEwAg?EwoYOCwAQTQwTYIIwTUEEwbcEE</stage><stage>hZJehFQEwAi?DwhJQCw1JLCwAJQCwfACZwUJLCwAXHCwLXUCwhXGCwrXVClQHQlHVNlnVNlxHQ</stage><stage>hHgeAFIEpIII0gp1HKg0wAg?EwAJICwsHIE</stage><stage>hLgeqRIEpHIIgMp3BIg0wAg?EwAAGSwAbGFwASCJwQJEXwqVICwoACX</stage><stage>hGgeyPIEplYI0gwAg?EwyTICwSHHZwkAHVlOHZ</stage><stage>hEHe0DMEwAg?Ew0HMZwUHEZwAHIZwMAEZwsAEZwcAEZwkHEZlwHZlIHZlQHZlYHZlgHZloHZ</stage><stage>hEgeycOEpPZGvgpYKGMgpVPG5gpSUGCgwAg?EwuHEZlIHZ</stage><stage>hDIeuESEpSUI0gwAi?CwuISCwWIUCw2KKKwAKKKweAEKwAISClqIIlSII</stage><stage>h3JeGKIEpzVI5gwYSGDwAi?CwxJLMwcAHLwGOICl8JZ</stage><stage>hGgeAHIEp5LGg0w0gMEwAgMEwbgMEwwLICwALICwQLICwgLIC</stage><stage>hGie0DIEp0KG2gwAi?CwyACJwySOQw0HIClMAi</stage><stage>hIieyFIEpEGIg0pERIg+wAi?CwOWQEwyJICwAACiwOHdEleWM</stage><stage>h2geyDIEwAg?Ew0JEQwyHICwoJEQweMENwUPEKwKSEHwAZEH</stage><canvas></canvas><script>const t={ArrowLeft:1,KeyA:1,ArrowRight:2,KeyD:2,ArrowUp:4,KeyW:4,ArrowDown:8,KeyS:8,Space:16,KeyZ:16,Comma:32,KeyX:32,Enter:64},s=[[.01,.11,.02,.04,.3,.5,"0963"],[.01,.08,.025,.05,.5,[1,1,0,.5,0,.3,0,.2,0,.1]],[.04,.11,.03,.05,.8,[1,1,.5,.3,.2,.05]],[.01,.11,.02,.05,.9,7.6,"9990"],[.025,.11,.04,.06,.5,[1,1,0,.2,0,.07]],[.015,.11,.025,.03,.9,2,"0972"]],i=[[.7,"sine",300,1e3],[.2,"sawtooth",100]];class h{constructor(t,s,i){this.e=t,this.v=s,this.a=i}reset(){this.x=0,this.y=0,this.gr=80,this.flr=0,this.flp=0,this.clm=0,this.j=0,this.jt=0,this.ded=0,this.af=0,this.ac=0}setup(t,s){this.x=t,this.y=s}die(){this.e.wt||(this.e.dc++,this.a.snd(1),this.a.playSong("tts"),this.ded=.001)}jon(){(this.clm||this.flr)&&(this.a.snd(0),this.clm=0,this.flr=0,this.j=1,this.jt=.375)}joff(){this.j=0}update(t){this.ded?this.ded+=t:(this.pvy=this.y,this.e.bdx?(this.x+=this.e.bdx*t*120,this.flp=this.e.bdx<0,(this.ac-=t)<=0&&(this.ac+=this.clm?.2:.125,4<=++this.af)&&(this.af=0),this.clm=0):this.e.wt?(this.ac-=t)<=0&&(this.ac+=.2,2<=++this.af)&&(this.af=0):this.clm&&!this.flr||(this.af=0,this.ac=0),this.e.bdy&&(this.clm=this.fldr())&&(this.y+=this.e.bdy*t*80,this.y<this.clm.y-24&&(this.y=this.clm.y-24),this.x=this.clm.x,this.flr=0,this.e.bdx||(this.ac-=t)<=0&&(this.ac+=.2,2<=++this.af)&&(this.af=0)),this.clm||(this.j&&this.jt?(this.y-=t*this.jt*550,(this.jt-=t)<=0&&(this.jt=0)):1===this.flr?this.y=120:this.flr?this.y=this.flr.y-24:(this.gr<160&&(this.gr+=80*t),this.y+=this.gr*t)),this.collide())}collide(){let t=0,s=0,i=0,h=0,e=0;this.x<0?(this.x=0,s++):240<this.x&&(this.x=240,i++),this.y<0?(this.y=0,h++):120<=this.y&&(t=1,this.y=120,e++);var n=[];for(const l of this.e.wv){var o,r,a,c=l.x+l.w-this.x;c<=0||(o=l.y+l.h-this.y)<=0||(r=this.x+16-l.x)<=0||(a=this.y+24-l.y)<0||((l.dx||l.dy)&&n.push(l),c<=r&&c<=o&&c<=a?(this.x=l.x+l.w,s++,this.clm=0):r<=o&&r<=a?(this.x=l.x-16,i++,this.clm=0):o<=a?(this.y=l.y+l.h,h++):(this.y=l.y-24,t=l,e++))}if(!this.clm)for(const s of this.e.ldrv)this.x>=s.x+16||this.x+16<=s.x||this.pvy+24>s.y||this.y+24<s.y||(this.y=s.y-24,t=s,e++);if(s&&i||h&&e)for(const t of n)t.dx*=-1,t.dy*=-1,t.x+=.02*t.dx,t.y+=.02*t.dy;t!==this.flr&&(this.flr=t,this.gr=80)}fldr(){for(const t of this.e.ldrv)if(!(this.x+8<t.x||this.y+24<t.y||this.x+8>=t.x+16||this.y>t.y+t.h))return t;return 0}render(){if(this.ded){let i=this.x+8,h=this.y+12,e=80*this.ded,n=3&Math.floor(10*this.ded);for(let t=0,s=0;t<7;t++,s+=2*Math.PI/7){var o=Math.floor(i+Math.cos(s)*e-3.5),r=Math.floor(h+Math.sin(s)*e-3.5);this.v.blit(o,r,7*n,0,7,7),4<=++n&&(n=0)}}else{let t=Math.round(this.x),s=Math.round(this.y),i=0,h=7;if(this.e.wt)h+=24,this.af&&(i+=16),this.flp?this.v.flop(t,s,i,h,16,24):this.v.blit(t,s,i,h,16,24);else if(this.clm&&!this.flr&&this.y+24>this.clm.y)i=48,h=7,1&this.af?this.v.blit(t,s,i,h,16,24):this.v.flop(t,s,i,h,16,24);else{if(!this.clm)switch(this.af){case 1:i+=16;break;case 3:i+=32}this.flp?this.v.flop(t,s,i,h,16,24):this.v.blit(t,s,i,h,16,24)}}}}class e{constructor(t,s,i,e){this.g=t,this.v=s,this.a=i,this.i=e,this.bdx=0,this.bdy=0,this.bj=0,this.bc=0,this.pvs=0,this.dot=new h(this,s,i),this.wv=[],this.ldrv=[],this.tkv=[],this.wz={x:0,y:0,w:0,h:0},this.wt=0,this.dt=0,this.fin=0,this.tt=0,this.sc=0,this.dc=0,this.scr=0}reset(s){this.st=s,this.bdx=0,this.bdy=0,this.bj=0,this.bc=0,this.dot.reset(),this.wv=[],this.ldrv=[],this.tkv=[],this.wz={x:0,y:0,w:0,h:0},this.a.playSong("sm");var i=t=>65<=(t=t.charCodeAt(0))&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43===t?62:47===t?63:63===t?64:0;for(let t=0;t<s.length;)switch(s[t++]){case"w":var h=i(s[t++])<<2,e=i(s[t++])<<2,n=i(s[t++])<<2,o=i(s[t++])<<2;this.wv.push({x:h,y:e,w:n,h:o,c:"#040"});break;case"h":h=(i(s[t++])<<2)-8,e=(i(s[t++])<<2)-24,this.dot.setup(h,e);break;case"p":var n=i(s[t++])<<2,o=i(s[t++])<<2,r=i(s[t++])<<2,a=(i(s[t++])<<2)-128,c=(i(s[t++])<<2)-128;this.wv.push({x:n,y:o,w:r,h:8,dx:a,dy:c,hold:0});break;case"l":r=i(s[t++])<<2,a=i(s[t++])<<2,c=i(s[t++])<<2,this.ldrv.push({x:r,y:a,h:c});break;case"e":var l=i(s[t++])<<2,d=i(s[t++])<<2,f=i(s[t++])<<2,v=i(s[t++])<<2;this.wz={x:l,y:d,w:f,h:v}}this.rbg()}win(){this.dot.ded||(this.a.playSong("taf",1),this.wt=.01)}stk(){13<=this.bc||(this.tkv.push({x:this.dot.x+8-3.5,y:this.dot.y-8,y0:this.dot.y-8,dx:this.bdx<0||!(0<this.bdx)&&this.dot.flp?1:-1,t:0,n:this.bc}),this.sc++,13<=++this.bc&&this.dot.die())}victory(){this.fin=.001,this.cscr=13,this.ttscr=Math.round(Math.max(0,170-this.tt)),this.scscr=Math.max(0,170-this.sc),this.dscr=this.dc?0:50,this.scr=this.cscr+this.ttscr+this.scscr+this.dscr}restart(){this.fin=0,this.tt=0,this.sc=0,this.dc=0,this.scr=0,this.reset(this.g.nextStage())}update(s,t){if(0<this.wt&&(this.wt+=s,this.bdx=0,this.bdy=0),this.dot.ded&&(this.dt+=s),0<this.fin)this.fin+=s,t!==this.pvs&&(16&t&&!(16&this.pvs)&&.5<this.fin&&this.restart(),this.pvs=t);else{if(this.wt||this.dot.ded||(this.tt+=s),t!==this.pvs){const s=t=>{switch(t){case 1:case 4:return-1;case 2:case 8:return 1}return 0};var i,h;if(this.wt||(i=s(3&t),h=s(12&t),i!==this.bdx&&(this.bdx=i)&&this.stk(),h!==this.bdy&&(this.bdy=h)&&this.dot.fldr()&&this.stk()),16&t){if(!this.bj)if(this.bj=1,this.wt){this.wt=0;const s=this.g.nextStage();if(!s)return void this.victory();this.reset(s)}else.5<this.dot.ded?this.reset(this.st):0<this.dot.ded||this.wt||(this.stk(),this.dot.jon())}else this.bj&&(this.bj=0,this.dot.joff());this.pvs=t}for(const t of this.wv){var e,n;(t.dx||t.dy)&&(e=t.dx*s,n=t.dy*s,t.x+=e,t.y+=n,this.dot.ded||this.wt||this.dot.flr!==t||(this.dot.x+=e,this.dot.y+=n),0<t.hold?t.hold-=s:this.ckwl(t)&&(t.x-=e,t.y-=n))}for(let t=this.tkv.length;0<t--;){var o=this.tkv[t];o.t+=s,o.x+=o.dx*s*10,o.y=o.y0+(o.t-.25)**2*100,144<o.y&&this.tkv.splice(t,1)}if(this.dot.update(s),!this.dot.ded&&!this.wt){const s=this.dot.x+8,t=this.dot.y+12;s>=this.wz.x&&t>=this.wz.y&&s<this.wz.x+this.wz.w&&t<this.wz.y+this.wz.h&&this.win()}}}ckwl(t){if(t.x<0||256<=t.x+t.w||t.y<0||144<=t.y+t.h)return t.dx*=-1,t.dy*=-1,t.hold=.25,1;for(const s of this.wv)if(s!==t&&!(s.x>=t.x+t.w||s.y>=t.y+t.h||s.x+s.w<=t.x||s.y+s.h<=t.y))return t.dx*=-1,t.dy*=-1,t.hold=.25,1;return 0}rfin(){this.v.rect(0,0,256,144,"#466"),this.v.blit(80,40,32,31,37,5),this.v.decint(160,40,this.cscr,3),this.v.blit(100,47,32,36,17,5),this.v.decint(120,47,this.tt,5),this.v.decint(160,47,this.ttscr,3),this.v.blit(93,54,32,41,24,5),this.v.decint(120,54,this.sc,5),this.v.decint(160,54,this.scscr,3),this.v.blit(93,61,32,46,24,5),this.v.decint(120,61,this.dc,5),this.v.decint(160,61,this.dscr,3),this.v.decint(160,70,this.scr,3),this.v.rect(160,68,17,1,"#888"),this.v.blit(60,60,5*this.fin&1?16:0,31,16,24)}render(){if(this.fin)return this.rfin();this.v.bg();for(const e of this.wv)if(!e.c){var i=Math.round(e.x),h=Math.round(e.y);for(let t=i+8,s=Math.floor(e.w/8)-2;0<s--;t+=8)this.v.blit(t,h,88,7,8,8);this.v.blit(i,h,80,7,8,8),this.v.flop(i+e.w-8,h,79,7,8,8)}this.dot.render();for(const i of this.tkv)this.v.blit(Math.floor(i.x),Math.floor(i.y),28+7*i.n,0,7,7);this.v.blit(1,138,88+3*Math.floor(this.bc/10),15,3,5),this.v.blit(5,138,88+this.bc%10*3,15,3,5),this.wt?(this.v.rect(99,137,58,6,2*this.wt&1?"#000":"#084"),this.v.blit(100,138,64,23,56,4)):this.dot.ded&&(this.v.rect(99,137,64,6,2*this.dt&1?"#000":"#408"),this.v.blit(100,138,64,27,62,4))}rbg(){const s=this.wz.x+(this.wz.w>>1),n=this.wz.y+(this.wz.h>>1),t=this.v.bc.createRadialGradient(s,n,1,s,n,256);t.addColorStop(0,"#ace"),t.addColorStop(1,"#46a"),this.v.bc.fillStyle=t,this.v.bc.fillRect(0,0,256,144);var o=new Uint8Array(2508);for(let t=0;t<66;t++)o[t]=o[2508-t]=1;for(let t=0;t<38;t++)o[66*t]=o[66*(t+1)-1]=1;for(const s of this.wv)if(s.c){const n=1+(s.x>>2),t=1+(s.y>>2),h=s.w>>2;let i=66*t+n;for(let t=s.h>>2;0<t--;i+=66)for(let t=i,s=h;0<s--;t++)o[t]=1}for(let h=0,e=67,t=36;0<t--;e+=66,h+=4)for(let t=0,s=e,i=64;0<i--;s++,t+=4)if(o[s]){const n=o[s-66-1],r=o[s-66],a=o[s-66+1],c=o[s-1],l=o[s+1],d=o[s+66-1],f=o[s+66],v=o[s+66+1];r&&c&&l&&f?n&&a&&d&&v?this.v.bblit(t,h,120,7,4,4):n?a?d?this.v.bblit(t,h,104,7,4,4):this.v.bblit(t,h,108,7,4,4):this.v.bblit(t,h,104,11,4,4):this.v.bblit(t,h,108,11,4,4):r&&c&&l?this.v.bblit(t,h,112,7,4,4):r&&c&&f?this.v.bblit(t,h,116,11,4,4):r&&l&&f?this.v.bblit(t,h,112,11,4,4):c&&l&&f?this.v.bblit(t,h,116,7,4,4):r&&c?this.v.bblit(t,h,100,11,4,4):r&&l?this.v.bblit(t,h,96,11,4,4):c&&f?this.v.bblit(t,h,100,7,4,4):l&&f?this.v.bblit(t,h,96,7,4,4):this.v.bblit(t,h,124,11,4,4)}for(const s of this.ldrv){const n=Math.round(s.x);let t=Math.round(s.y+s.h);for(;t>s.y;)t-=6,this.v.bblit(n,t,64,7,16,6)}let h=this.wz.x+8;const r=this.wz.y+this.wz.h;let a=(this.wz.w-16)/8;for(;0<a--;h+=8)this.v.bblit(h,r,72,15,8,8);this.v.bblit(this.wz.x,r,64,15,8,8),this.v.bblit(this.wz.x+this.wz.w-8,r,80,15,8,8)}}class n{constructor(){this.v=Array.from(document.getElementsByTagName("stage")).map(t=>t.innerText)}}new class{constructor(t,s,i){this.v=t,this.a=s,this.i=i,(t.game=this).running=!1,this.pf=null,this.pvtime=0,this.i.kh.Escape=()=>this.end(),this.ecom=new e(this,this.v,this.a,this.i),this.stg=new n}begin(){this.running||(this.running=!0,this.stp=0,this.ecom.reset(this.stg.v[this.stp]),this.pvtime=Date.now(),this.pf=window.requestAnimationFrame(()=>this.update()))}end(){this.v.end(),this.a.end(),this.i.end(),this.running=!1,this.pf&&(window.cancelAnimationFrame(this.pf),this.pf=null)}update(){if(this.pf=null,this.running){this.a.update();let t=this.i.update(),s=Date.now(),i=s-this.pvtime;10<=i&&(20<i&&(i=20),this.ecom.update(i/1e3,t),this.pvtime=s,this.ecom.render()),this.pf=window.requestAnimationFrame(()=>this.update())}}nextStage(){return this.stp++,this.stp>=this.stg.v.length?(this.stp=-1,null):this.stg.v[this.stp]}}(new class{constructor(){this.src=document.querySelector("img"),this.cv=document.querySelector("canvas"),this.cv.width=256,this.cv.height=144,this.c=this.cv.getContext("2d"),this.bcv=document.createElement("CANVAS"),this.bcv.width=256,this.bcv.height=144,this.bc=this.bcv.getContext("2d")}end(){this.c.fillStyle="#888",this.c.fillRect(0,0,256,144)}bg(){this.c.drawImage(this.bcv,0,0)}rect(t,s,i,h,e){this.c.fillStyle=e,this.c.fillRect(t,s,i,h)}blit(t,s,i,h,e,n){this.c.drawImage(this.src,i,h,e,n,t,s,e,n)}flop(t,s,i,h,e,n){this.c.save(),this.c.translate(t+e/2,s+n/2),this.c.scale(-1,1),this.c.drawImage(this.src,i,h,e,n,-e/2,-n/2,e,n),this.c.restore()}decint(t,s,i,h){i=Math.floor(i);let e=10**h,n=0;for(;1<=e;e/=10,t+=4){const h=Math.floor(i/e)%10;!h&&!n&&1<e||(n=1,this.blit(t,s,88+3*h,15,3,5))}}bblit(t,s,i,h,e,n){this.bc.drawImage(this.src,i,h,e,n,t,s,e,n)}bflop(t,s,i,h,e,n){this.bc.save(),this.bc.translate(t+e/2,s+n/2),this.bc.scale(-1,1),this.bc.drawImage(this.src,i,h,e,n,-e/2,-n/2,e,n),this.bc.restore()}},new class{constructor(){if(AudioContext){this.hz=[];for(let t=0;t<128;t++)this.hz.push(440*Math.pow(2,(t-69)/12));this.ctx=new AudioContext({sampleRate:44100,latencyHint:"interactive"}),"suspended"===this.ctx.state&&this.ctx.resume(),this.songs={},this.songTempo=1,this.song=0,this.songp=0,this.songDelay=0,this.vv=[],this.ldc()}}end(){this.ctx&&(this.ctx.suspend(),this.ctx=null)}snd(h){if(this.ctx){var e=i[h];if(e){var n=this.ctx.currentTime,t=(h=n+.015)+.02,s=t+.2,o=s+.5,r={frequency:e[2]};"string"==typeof e[1]?r.type=e[1]:r.periodicWave=new PeriodicWave(this.ctx,{real:e[1]});const i=new OscillatorNode(this.ctx,r);if(3<e.length){const h=(o-n)/(e.length-3);let t=n,s=3;for(i.frequency.setValueAtTime(e[2],n);s<e.length;s++)t+=h,i.frequency.linearRampToValueAtTime(e[s],t)}const a=new GainNode(this.ctx);a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.3*e[0],h),a.gain.linearRampToValueAtTime(.1*e[0],t),a.gain.setValueAtTime(.1*e[0],s),a.gain.linearRampToValueAtTime(0,o),i.connect(a),a.connect(this.ctx.destination),i.start(),setTimeout(()=>{a.disconnect(),i.stop()},1e3*(o-this.ctx.currentTime))}}}update(){if(this.ctx&&this.song)for(var t=this.ctx.currentTime+3;this.songTime<t;){if(this.songp>=this.song.length){if(this.srpt){this.songp=1,this.songTime+=.01;continue}return void(this.song=null)}var s=this.song[this.songp++];if(39===s){var i=this.song[this.songp++]-62;if(i<1||64<i)return this.ps();this.songTime+=i*this.songTempo/1e3}else{if((i=s-40)<0||15<i)return this.ps();if((s=35+this.song[this.songp++]-63)<35||98<s)return this.ps();var h=this.song[this.songp++]-63;if(h<0||64<=h)return this.ps();this.playNote(i,s,h*this.songTempo/1e3,this.songTime)}}}playNote(e,n,o,r){var a=s[e];if(a){let t=0,s={frequency:this.hz[n]};if(a[5]instanceof Array&&(a[5]=new PeriodicWave(this.ctx,{real:a[5]})),a[5]instanceof PeriodicWave)s.periodicWave=a[5];else if("string"==typeof a[5])s.type=a[5];else{if("number"!=typeof a[5])return;s.type="sine",t=a[5]}const c=new OscillatorNode(this.ctx,s),l=r,d=l+a[0],f=a[1],v=d+a[2],u=a[3],y=v+o,p=y+a[4];let i,h;if(t){if(i=new GainNode(this.ctx),a[6]){const e=s.frequency*a[6][0].toString()/10,n=s.frequency*a[6][1].toString()/10,o=s.frequency*a[6][2].toString()/10,r=s.frequency*a[6][3].toString()/10;i.gain.setValueAtTime(e,0),i.gain.setValueAtTime(e,l),i.gain.setValueAtTime(n,d),i.gain.setValueAtTime(o,v),i.gain.setValueAtTime(o,y),i.gain.setValueAtTime(r,p)}else i.gain.value=s.frequency;(h=new OscillatorNode(this.ctx,{type:"sine",frequency:s.frequency*t})).start(),h.connect(i),i.connect(c.frequency)}const g=new GainNode(this.ctx),x=(g.gain.setValueAtTime(0,0),g.gain.setValueAtTime(0,l),g.gain.linearRampToValueAtTime(f,d),g.gain.linearRampToValueAtTime(u,v),g.gain.setValueAtTime(u,y),g.gain.linearRampToValueAtTime(0,p),c.connect(g),g.connect(this.ctx.destination),c.start(),{env:g,osc:c,modgain:i,mod:h});this.vv.push(x),setTimeout(()=>{g.disconnect(),c.stop(),i&&i.disconnect(),h&&(h.stop(),h.disconnect());var t=this.vv.indexOf(x);0<=t&&this.vv.splice(t,1)},1e3*(p-this.ctx.currentTime))}}playSong(t,s){t?this.songs[t]?this.ps(this.songs[t],s):(this.pendingSongName=t,this.pendingSongOnce=s):this.ps()}ps(t,s){for(const t of this.vv)1<=t.env.gain.value||!t.env.gain.value?t.env.disconnect():(t.env.gain.cancelScheduledValues(0),t.env.gain.setValueAtTime(t.env.gain.value,0),t.env.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.1));this.vv=[],t&&1<t.length&&this.ctx?(this.song=t,this.songp=1,this.songTempo=t[0]-62,this.songTime=this.ctx.currentTime,this.srpt=!s):(this.song="",this.songp=0,this.songTempo=1,this.songTime=0)}ldc(){for(const i of document.querySelectorAll("song")){var t=new TextEncoder("utf8").encode(i.innerText.replace(/\s+/g,"")),s=i.getAttribute("name");this.songs[s]=t}}},new class{constructor(){this.state=0,this.gp=[],this.kh={},this.kl=t=>this.onKey(t),window.addEventListener("keydown",this.kl),window.addEventListener("keyup",this.kl)}end(){this.kl&&(window.removeEventListener("keydown",this.kl),window.removeEventListener("keyup",this.kl),this.kl=null),this.gp=[],this.state=0}update(){return this.ugp(),this.state}onKey(s){if(s.repeat)t[s.code]&&(s.stopPropagation(),s.preventDefault());else if(!s.ctrlKey&&!s.altKey){s.stopPropagation(),s.preventDefault();var i="keydown"===s.type,h=t[s.code];if(h)return this.setState(h,i);i&&this.kh[s.code]?.()}}ugp(){for(const n of navigator?.getGamepads?.()||[])if(n){let e=this.gp[n.index];e=e||(this.gp[n.index]={axes:n.axes.map(t=>0),buttons:n.buttons.map(t=>0),state:0});const o=.25,s=(t,s,i)=>{var h=n.axes[t]>o?1:n.axes[t]<-o?-1:0;h!==e.axes[t]&&(e.axes[t]<0?this.setState(s,0,e):0<e.axes[t]&&this.setState(i,0,e),e.axes[t]=h,e.axes[t]<0?this.setState(s,1,e):0<e.axes[t]&&this.setState(i,1,e))};s(0,1,2),s(1,4,8);var t=(t,s)=>{n.buttons[t].value?e.buttons[t]||(e.buttons[t]=1,this.setState(s,1,e)):e.buttons[t]&&(e.buttons[t]=0,this.setState(s,0,e))};t(0,16),t(1,32),t(2,32),t(8,64),t(9,64),t(12,4),t(13,8),t(14,1),t(15,2)}}setState(t,s,i){if(i)if(s){if(i.state&t)return;i.state|=t}else{if(!(i.state&t))return;i.state&=~t}s?this.state&t||(this.state|=t):this.state&t&&(this.state&=~t)}}).begin()</script>