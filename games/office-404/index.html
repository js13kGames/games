<!DOCTYPE html><html><head><title>Office 404</title><meta name="viewport"content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="monetization"content="$ilp.uphold.com/YLmwMmr82Kpe"><style>body,html{display:flex;width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#000}#game{margin:auto;width:100%;align-self:center;justify-self:center;image-rendering:-moz-crisp-edges;image-rendering:pixelated}*{-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;user-select:none}@media (min-aspect-ratio:9 / 16){#game{width:auto;height:100%}}</style></head><body><canvas id="game"width="108"height="192"></canvas><script>!function(){function t(t,s,i,e=!1){t.addEventListener(s,i,e)}async function s(){document.fullscreenElement||await document.body.requestFullscreen()}const i=new class{constructor(){this.listeners={all:[]}}parse(t){return t.replace(/[^-_\w]+/," ").trim().split(" ").filter(t=>!!t)}on(t,s){for(const i of this.parse(t))i in this.listeners||(this.listeners[i]=[]),this.listeners[i].push(s);return this}off(t,s){for(const i of this.parse(t))if(i in this.listeners){const t=this.listeners[i].indexOf(s);t>=0&&this.listeners[i].splice(t,1)}return this}emit(t){var s;this.listeners.all.forEach(s=>s(t)),null===(s=this.listeners[t.name])||void 0===s||s.forEach(s=>s(t))}},e={};function a(t,s){const a=t.code;return e[a]!==s&&(e[a]=s,i.emit({name:"input",target:a,data:e})),!1}t(document,"keydown",t=>a(t,!0)),t(document,"keyup",t=>a(t,!1));class h{constructor(){this.data=new Float32Array(9),this.reset()}reset(t){return this.data.set(t?t.data:[1,0,0,0,1,0,0,0,1]),this}project(t,s){return this.data.set([2/t,0,0,0,-2/s,0,-1,1,1]),this}translate(t,s){if(t||s){const[i,e,a,h,n,r,o,c,l]=this.data;this.data.set([t*i+s*h+o,t*e+s*n+c,t*a+s*r+l],6)}return this}rotate(t){if(t){const s=Math.sin(t),i=Math.cos(t),[e,a,h,n,r,o]=this.data;this.data.set([i*e+s*n,i*a+s*r,i*h+s*o,i*n-s*e,i*r-s*a,i*o-s*h])}return this}scale(t,s=t){if(1!==t||1!==s){const i=this.data;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=s,i[4]*=s,i[5]*=s}return this}}var n=new class{constructor(){this.mat=new h,this.param={},this.canvas=document.querySelector("#game"),this.gl=this.canvas.getContext("webgl");const{width:t,height:s}=this.canvas;this.gl.viewport(0,0,t,s),this.set({x:0,y:0,r:0,s:1})}set(t){this.param={...this.param,...t};const{x:s,y:i,r:e,s:a}=this.param,{width:h,height:n}=this.canvas;this.mat.project(h,n).translate(h/2-s,n/2-i).rotate(-e).scale(a)}raycast(t){const s=document.body,{x:i,y:e,r:a,s:h}=this.param,{width:n,clientWidth:r}=this.canvas;t.sub(s.clientWidth/2,s.clientHeight/2).scale(n/r).add(i,e).rotate(a).scale(1/h)}};class r{constructor(t=0,s=t){this.x=t,this.y=s}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get angle(){return Math.atan2(this.y,this.x)}copy(t){return t.x=this.x,t.y=this.y,this}clone(){return new r(this.x,this.y)}set(t=0,s){return t instanceof r?t.copy(this):(this.x=t,this.y=void 0!==s?s:t),this}add(t=0,s=0){return this.x+=t instanceof r?t.x:t,this.y+=t instanceof r?t.y:s,this}sub(t=0,s=0){return this.x-=t instanceof r?t.x:t,this.y-=t instanceof r?t.y:s,this}scale(t,s=t){return this.x*=t,this.y*=s,this}rotate(t){const s=Math.sin(t),i=Math.cos(t);return this.x=this.x*i-this.y*s,this.y=this.x*s+this.y*i,this}invert(){return this.x=-this.x,this.y=-this.y,this}norm(){const t=this.length;return t>0?this.scale(1/t):this.set(),this}}const o=new r;function c(t,s){if(n.raycast(o.set(t.clientX,t.clientY)),i.emit({name:"pointer",target:o}),void 0!==s){const a="Mouse"+t.button;e[a]=s,i.emit({name:"input",target:a,data:e})}}const l=document.body;t(l,"contextmenu",t=>t.preventDefault()),t(l,"mousedown",t=>c(t,!0)),t(l,"mouseup",t=>c(t,!1)),t(l,"mousemove",t=>c(t));var d={size:[289,46],frames:{tile:[1,1],font:[1,19],icon:[1,29],tiny:[71,29],ptc:[241,1]}};function u(){return(new Date).getTime()/1e3}const p=new class{constructor(){this.tasks=[],this.delta=0,this.time=u()}update(){const t=u();this.delta=Math.min(t-this.time,.1),this.time=t;for(const t of this.tasks)t.update()}add(t){0>this.tasks.indexOf(t)&&this.tasks.push(t)}remove(t){const s=this.tasks.indexOf(t);return s>=0&&(this.tasks.splice(s,1),!0)}};class m{constructor(t){this._factory=t,this._stopped=!1,this._promise=null,this._resolve=null,this._child=null}async start(t){return await this.stop(),this.data=t,this._stopped=!1,this._promise=this._factory(this),this._promise}async waitAll(t){for(const s of t)await this.waitTo(s)}async waitTo(t){this._child=t,await t.start(),this._stopped&&t.stop(),await t._promise}wait(t,s){return this._stopped?null:(this._delay=t,this._length=t,this._update=s,p.add(this),new Promise(t=>{this._resolve=t}))}async stop(){this._stopped=!0,this._child&&await this._child.stop(),this.resolve(),await this._promise}update(){if(this._resolve){const t=this._length;this._delay-=p.delta,this._delay>0||this.resolve(),this._update&&t&&this._update(1-this._delay/t)}}resolve(){if(this._resolve){const t=this._resolve;this._update&&this._update(1),this._resolve=null,this._update=null,this._length=0,this._delay=0,t()}p.remove(this)}}class f{constructor(t=0,s=0,i=1,e=i){this.x=t,this.y=s,this.w=i,this.h=e}add(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.w=Math.max(this.x+this.w,t.x+t.w)-this.x,this.h=Math.max(this.y+this.h,t.y+t.h)-this.y}has(t){return!(this.x>t.x||t.x>this.x+this.w||this.y>t.y||t.y>this.y+this.h)}collide(t){return t.x+t.w>this.x&&this.x+this.w>t.x&&t.y+t.h>this.y&&this.y+this.h>t.y}contains(t){return!(this.x>t.x||t.x+t.w>this.x+this.w||this.y>t.y||t.y+t.h>this.y+this.h)}intersect(t,s=new f){let i=Math.round(this.x),e=Math.round(this.y),a=i+this.w,h=e+this.h,n=Math.round(t.x),r=Math.round(t.y),o=n+t.w,c=r+t.h;return s.x=n>i?n:i,s.y=r>e?r:e,s.w=(o>a?a:o)-s.x,s.h=(c>h?h:c)-s.y,s}}class y{constructor(t={}){var s;this.mesh=new Float32Array(8),this.tint=[1,1,1,1],this.box=new f,this.mat=new h,this.children=[],this.param={n:"",f:0,x:0,y:0,w:0,h:0,r:0,s:1,px:0,py:0,mh:0,mv:0,l:0,c:"",a:1,p:null,...t},null===(s=t.p)||void 0===s||s.addChild(this),this.compute();let{w:i,h:e,mh:a,mv:n}=this.param;const r={...this.param,x:i,y:e,r:0,px:i,py:e,mh:0,mv:0,p:this};a&&new y({...r,x:a,sx:-1,sy:1}),n&&new y({...r,y:n,sx:1,sy:-1}),a&&n&&new y({...r,x:a,y:n,sx:-1,sy:-1})}set(t,s={}){var i,e;void 0!==t.p&&(null===(i=this.param.p)||void 0===i||i.removeChild(this)),null===(e=t.p)||void 0===e||e.addChild(this),this.param={...this.param,...t},this.compute(),s&&this.children.forEach(t=>{t.set(s,s),this.box.add(t.box)})}addChild(t){0>this.children.indexOf(t)&&(this.children.push(t),t.param.p=this)}removeChild(t){const s=this.children.indexOf(t);0>s||(this.children.splice(s,1),t.param.p=null)}compute(){const t=this.box,s=this.mesh,{x:i,y:e,w:a,h,r:n,s:r,sx:o,sy:c,px:l,py:d,c:u,a:p,p:m}=this.param;m?m.tint.forEach((t,s)=>this.tint[s]=t):this.tint.fill(1),u.split("").forEach((t,s)=>this.tint[s]*=parseInt(t,16)/15),this.tint[3]*=p;const f=this.mat.reset(null==m?void 0:m.mat).translate(i,e).rotate(n).scale(o||r,c||r).translate(-l,-d).data;s.set([f[6],f[7],f[0]*a+f[6],f[1]*a+f[7],f[3]*h+f[6],f[4]*h+f[7],f[0]*a+f[3]*h+f[6],f[1]*a+f[4]*h+f[7]]),t.x=Math.min(s[0],s[2],s[4],s[6]),t.y=Math.min(s[1],s[3],s[5],s[7]),t.w=Math.max(s[0],s[2],s[4],s[6])-t.x,t.h=Math.max(s[1],s[3],s[5],s[7])-t.y}}class w extends y{constructor(t,s=""){super(t),this.font={ha:0,va:0,ls:1,lg:1,...this.param,r:0,s:1,sx:0,sy:0,c:"ffff",p:this},this.text(s)}text(t=""){const{children:s,font:i}=this;let e=0,a=0,h=0,n=0,{w:r,h:o,ha:c,va:l,ls:d,lg:u}=i;r+=d;for(let c=0;t.length>c;c++){let l=t.charCodeAt(c);switch(l){case 10:a+=o+u,e=i.x;continue;case 33:l=39;break;case 36:l=40;break;case 44:l=36;break;case 46:l=37;break;case 63:l=38;break;default:if(48>l||l>57)if(97>l||l>122){if(65>l||l>90){e+=r;continue}l-=55}else l-=87;else l-=48}s.length>h?s[h].set({f:l,x:e,y:a}):new y({...i,f:l,x:e,y:a}),e+=r,n=Math.max(e,n),h++}this.set({n:"",px:Math.round(n*c/2),py:Math.round((a+o)*l/2)}),s.length=h}}class x{constructor(t,s){this.param=t,this.ctx=s,this.srcVol=s.createGain(),this.srcVol.connect(s.destination),this.filter=s.createBiquadFilter(),this.filter.connect(this.srcVol);const i=this.ctx.createBufferSource();i.buffer=x.noise,i.loop=!0,i.connect(this.filter),this.src=i,this.oscVol=s.createGain(),this.oscVol.connect(s.destination),this.osc=this.ctx.createOscillator(),this.osc.type=t[0],this.osc.connect(this.oscVol)}set(t,s,i,e){s instanceof Array?t.setValueCurveAtTime(Float32Array.from(s),e,i-.01):t.setValueAtTime(s,e)}render(t,s=this.param[1],i=0){this.set(this.osc.frequency,t,s,i),this.set(this.filter.detune,t,s,i),this.set(this.oscVol.gain,t&&this.param[2]||0,s,i),this.set(this.srcVol.gain,t&&this.param[3]||0,s,i)}start(t=this.param[1]){this.src.start(),this.src.stop(t),this.osc.start(),this.osc.stop(t)}}class g{constructor(t){this.param=t,this.size=0,this.length=0;const[s,i,e]=t,a=i.split("|");this.data=a.reduce((t,s,i)=>t+(i%2?(","+a[i-1]).repeat(parseInt(s)-1):(t?",":"")+s),"").split(",").map(t=>{const s=t.match(/^([\d\.]+)/);if(s){const i=parseFloat(s[1]);this.length+=i*e;const a=t.match(/([a-z]+\d+)/g);return a?(this.size=Math.max(a.length,this.size),[i].concat(a.map(t=>{let s=t.match(/([a-z]+)(\d+)/);return s?g.freq[12*parseInt(s[2])+g.keys.indexOf(s[1])]:0}))):[i]}})}render(t){let s=0;const[i,e,a]=this.param,h=[];for(let s=0;this.size>s;s++)h.push(new x(i,t));this.data.forEach(t=>{const i=t[0]*a;h.forEach((e,a)=>e.render(t[a+1]||0,i,s)),s+=i}),h.forEach(t=>t.start(s))}}g.keys="c,db,d,eb,e,f,gb,g,ab,a,bb,b".split(","),g.freq=[],window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var v=new class{constructor(){this.bitrate=44100,this.ctx=new AudioContext,this.mix={},this.buff={}}async init(){const t=this.ctx,s=this.bitrate;"suspended"===t.state&&await t.resume(),x.noise=t.createBuffer(1,2*s,s);const i=x.noise.getChannelData(0);for(let t=0;2*s>t;t++)i[t]=2*Math.random()-1;for(let t=-69;50>t;t++){const s=440*Math.pow(1.0594630943592953,t),i=Math.pow(10,7-s.toFixed().length);g.freq.push(Math.round(s*i)/i)}}mixer(t,s=-1){const i=this.ctx,e=this.mix;return t in e||(e[t]=i.createGain(),e[t].connect(i.destination)),0>s||s>1||(e[t].gain.value=s),e[t]}play(t,s=!1,i="master"){if(t in this.buff){let e=this.ctx.createBufferSource();return e.loop=s,e.buffer=this.buff[t],e.connect(this.mixer(i)),e.start(),e}return null}async sound(t,s,i){const e=this.context(t,s[1]),a=new x(s,e);a.render(i),a.start(),await e.startRendering()}async music(t,s){const i=s.map(t=>new g(t)),e=Math.max(...i.map(t=>t.length)),a=this.context(t,e);i.forEach(t=>t.render(a)),await a.startRendering()}context(t,s){const i=new OfflineAudioContext(1,this.bitrate*s,this.bitrate);return i.addEventListener("complete",s=>this.buff[t]=s.renderedBuffer),i}};class A{constructor(){this.children=[]}add(t){return this.children.push(t),t.parent=this,this}remove(t){const s=this.children.indexOf(t);0>s||(this.children.splice(s,1),t.parent=null)}each(t){for(let s=this.children.length-1;s>=0;s--)t(this.children[s],s)}update(t){this.each(s=>s.update(t))}render(t){this.each(s=>s.render(t))}}function E(t=1,s=0,i=!1){if(0>=t)return t;const e=233280;E.SEED=(9301*E.SEED+49297)%e;let a=(s=s?E.SEED*s%e:E.SEED)/e*t;return i?Math.round(a):a}E.SEED=Math.random();var b,T={ptc:{n:"ptc",w:4,h:4,px:2,py:2},font:{n:"font",w:6,h:8,c:"fff"},tiny:{n:"tiny",w:3,h:5,c:"999"},icon:{n:"icon",w:16,h:16,px:8,py:8},tile:{n:"tile",w:16,h:16,px:8,py:8},init:[0,20,10,10,10,0,0,5,2,0,0,0,0,0],odds:[0,45,20,10,2,0,0,2,15,2,0,0,2,2],coin:[0,5,10,20,50,100,500,0,50,100,0,500,0,100],shop:[5,0,0,0,25,25,0,20,0,0,0,0,15,10],coil:[0,0,0,0,200,250,0,350,0,0,0,0,500,1e3],price:[0,0,0,0,300,400,0,500,0,0,0,0,750,1500]};(t=>{t[t.EMPTY=0]="EMPTY",t[t.BOX=1]="BOX",t[t.DRAWER=2]="DRAWER",t[t.SHELF=3]="SHELF",t[t.DESKTOP=4]="DESKTOP",t[t.SERVER=5]="SERVER",t[t.CLOUD=6]="CLOUD",t[t.PLANT=7]="PLANT",t[t.DUDE=8]="DUDE",t[t.BOSS=9]="BOSS",t[t.PINATA=10]="PINATA",t[t.GOLD=11]="GOLD",t[t.SELL=12]="SELL",t[t.WILD=13]="WILD"})(b||(b={}));class _{constructor(t=0,s=0,i=0,e){this._count=Array(14),this._empty=!0,this._tiles=[],this.showAnim=new m(async t=>{await t.wait(.2,t=>this._sprite.set({s:t*t})),this._sprite.set({s:1})}),this.hideAnim=new m(async t=>{await t.wait(.2,t=>this._sprite.set({s:1-t*t})),this._sprite.set({s:1})}),this.moveAnim=new m(async t=>{this._empty=!0;const{x:s,y:i}=this._sprite.param,e=t.data._sprite.param;await t.wait(.3,t=>{const a=1-t*t;this._sprite.set({x:e.x-(e.x-s)*a,y:e.y-(e.y-i)*a,l:1})}),this._sprite.set({x:s,y:i,l:0}),this._empty&&(this.type=b.EMPTY)}),this.lockAnim=new m(async t=>{await t.wait(.2,t=>this._sprite.set({r:Math.PI*t,s:1-t})),this.type=10,await t.wait(.2,t=>this._sprite.set({r:Math.PI*(t+1),s:t})),this._sprite.set({r:0,s:1})}),this._type=i,this._sprite=new y({...T.tile,n:"",x:t,y:s,f:i,p:e})}get type(){return this._type}set type(t){this._type=t,this._empty=!t,this._sprite.set({n:t?"tile":"",f:t})}set layer(t){this._sprite.set({l:t})}get sprite(){return this._sprite}get isWild(){return this.type==b.WILD}get isGold(){return this.type==b.GOLD}get isMovable(){return this.type==b.DUDE||this.type==b.BOSS}get targets(){if(this.type===b.DUDE)return this._tiles.filter(t=>t._empty);let t=[];return this.type===b.BOSS&&this.traverse(s=>!s._empty||t.push(s)>0),t}get isLocked(){let t=!0;return this.traverse(s=>!(!t||!s.isMovable)&&(s.targets.length&&(t=!1),t)),t}get isHover(){return this._sprite.box.has(o)}add(t){return t&&this._tiles.push(t),this}traverse(t,s=[]){if(!s.includes(this)&&(s.push(this),t(this)))for(const i of this._tiles)i.traverse(t,s)}count(){const t=this._count.fill(0);if(this.isWild)for(const s of this._tiles)s._empty||s.isMovable||this.traverse(i=>(i.isWild||i.type===s.type)&&++t[s.type]>0);else this.traverse(s=>s.type===this.type&&++t[this.type]>0);return t}upgrade(t=this.type){b.CLOUD>t?this.type=t+1:b.GOLD>t?this.type=b.GOLD:t===b.WILD&&(this.type=b.PLANT)}async show(){await this.showAnim.start()}async move(){const t=this.targets;if(t.length){const s=t[t.length>1?E(t.length-1,0,!0):0],i=this.type;s._empty=!1,await this.moveAnim.start(s),s.type=i}}async moveTo(t){await this.moveAnim.start(t)}async merge(t=this.type){const s=[];this.traverse(i=>(i===this||t===i.type)&&(this!==i&&s.push(i.moveAnim.start(this)),!0)),s.length&&await Promise.all(s)}async lock(){await this.lockAnim.start()}async clear(){await this.hideAnim.start()}}class M extends y{constructor(t,s){super(t),this.props=s;const{w:i,h:e,m:a}=s,h=Array(i*e).fill(-1),n=Array(i*e).fill(0);let r=0,o=0;for(;a.length>r;){let t=a.charAt(r++),s="|-+".indexOf(t)+1,i=1;s&&(t=a.charAt(r++)),t.match(/[A-Z]/)?t=t.toLowerCase():i=parseInt(a.charAt(r++),36)+1,"0"!==t&&(h.fill(parseInt(t,36)-10,o,o+i),n.fill(s,o,o+i)),o+=i}h.forEach((t,i)=>{if(0>t)return;const{n:e,w:a,h,l:r,c:o}=this.param,c=s.h*h/2;new y({n:e,w:a,h,l:r,c:o,f:t,x:i%s.w*a+a/2-s.w*a/2,y:Math.floor(i/s.w)*h+h/2-c,px:a/2,py:h/2,sx:1&n[i]?-1:1,sy:2&n[i]?-1:1,p:this})}),this.param.n=""}}class I extends A{constructor(t,s){super(),this.width=t,this.height=s,this.group=new y,this.back=new M({...T.tile,x:8,y:8,p:this.group},{w:6,h:6,m:"az"}),this.tiles=[];for(let t=0;this.height>t;t++)for(let s=0;this.width>s;s++)this.tiles.push(new _(16*s-40,16*t-40,0,this.group));for(let t=0;this.height>t;t++)for(let s=0;this.width>s;s++)this.tile(s,t).add(this.tile(s-1,t)).add(this.tile(s+1,t)).add(this.tile(s,t-1)).add(this.tile(s,t+1))}load(t){this.tiles.forEach((s,i)=>s.type=t[i]||0)}toJSON(){return this.tiles.map(t=>t.type)}render(t){t.add(this.group)}tile(t,s){return 0>t||t>=this.width||0>s||s>this.height?null:this.tiles[this.height*s+t]}check(){return this.tiles.reduce((t,s)=>(s.type>b.EMPTY?0:1)+t,0)}async setTile(t){const s=t.type,e=this.tiles.filter(t=>t.isHover).pop();e&&(e.type!==b.EMPTY?(s===b.SELL||e.isGold)&&(await e.clear(),i.emit({name:"clear",target:e}),e.type=b.EMPTY,await this.move(e)):s!==b.SELL&&(await t.moveTo(e),e.type=s,i.emit({name:"place",target:e}),e.isMovable||await this.merge(e),await this.lock(e),await this.move(e)))}async move(t){const s=this.tiles.filter(s=>s.isMovable&&s!==t);s.length&&await Promise.all(s.map(t=>t.move()))}async merge(t){t.layer=2;let s=t.type,e=t.count();for(;e.filter(t=>t>2).length;)s=e.reduce((t,s,i)=>!t&&s>2?i:t,0),await t.merge(s),i.emit({name:"merge",target:t,data:e[s]}),t.isWild||t.upgrade(s),e=t.count();t.isWild&&t.upgrade(s),t.layer=0}async lock(t){let s=this.tiles.filter(t=>t.isMovable&&t.isLocked);if(s.length)for(i.emit({name:"lock",target:t,data:s}),await Promise.all(s.map(t=>t.lock()));s.length;){let i=s.length>1?E(s.length-1,0,!0):0;const e=0>s.indexOf(t)?s[i]:t;await this.merge(e),s=s.filter(t=>t.type&&t!==e)}}}class D extends A{constructor(){super(),this._data={coin:0,type:1,move:404,item:12},this.tile=new _(-40,-58),this.shop=new _(0,70),this.moveLbl=new w({...T.tiny,x:-30,y:-62,va:1},"Days"),this.moveTxt=new w({...T.font,x:-30,y:-55,va:1}),this.coinLbl=new w({...T.tiny,x:48,y:-62,va:1,ha:2},"Money"),this.coinTxt=new w({...T.font,x:48,y:-55,va:1,ha:2}),this.infoTxt=new w({...T.tiny,y:52,ha:1},"Merge 3 objects"),this.priceTxt=new w({...T.font,y:84,va:1,ha:1},"$9999"),this.infoAnim=new m(async t=>{await t.wait(.2,t=>this.infoTxt.set({a:1-t*t})),this.infoTxt.text(t.data),await t.wait(.3,t=>this.infoTxt.set({a:t*t}))}),this.infoIdx=0,this.info=["Merge more","Buy better stuff","Subscribers have discount!","Collect the gold bars","Pinata party is cool"],this.load(this._data)}get type(){return this._data.type}set type(t){this._data.type=t,this.tile.type=t,this.move--}get move(){return this._data.move}set move(t){this._data.move=t,this.moveTxt.text(""+t)}get coin(){return this._data.coin}set coin(t){this._data.coin=t,this.enabled=this.enabled,this.coinTxt.text("$"+t)}get price(){return T.price[this.item]}get item(){return this._data.item}set item(t){this._data.item=t,this.shop.type=t,this.enabled=this.enabled,this.priceTxt.text(t?"$"+this.price:"Free")}get enabled(){return this.coin>=this.price}set enabled(t){const s=t?1:.5;this.shop.sprite.set({a:s}),this.priceTxt.set({a:s})}load(t){this.type=t.type,this.coin=t.coin,this.move=t.move,this.item=t.item}async buy(t){const s=this.price,e=this.shop.type;i.emit({name:"buy",target:this.shop,data:s}),await this.shop.moveTo(this.tile),this.item=t,this.coin-=s,this.type=e,this.move++,await this.shop.show(),this.help()}show(){this.tile.show(),this.help()}help(){switch(this.type){case b.PLANT:this.infoAnim.start("Hmm... a plant?");break;case b.DUDE:this.infoAnim.start("Hey dude!");break;case b.BOSS:this.infoAnim.start("Bosses are annoying!");break;case b.SELL:this.infoAnim.start("You can sell something!");break;case b.WILD:this.infoAnim.start("Diamond merge all stuff!");break;default:this.infoAnim.start(this.info[this.infoIdx]),++this.infoIdx<this.info.length||(this.infoIdx=0)}}render(t){t.add(this.tile.sprite).add(this.shop.sprite).add(this.moveLbl).add(this.moveTxt).add(this.coinLbl).add(this.coinTxt).add(this.infoTxt).add(this.priceTxt)}toJSON(){return this._data}}class L extends A{constructor(){super(...arguments),this.scoreTxt=new w({...T.tiny,c:"fff",ha:1,va:1,l:3}),this.scoreAnim=new m(async t=>{const{x:s,y:i}=t.data.sprite.param;this.scoreTxt.set({x:s,y:i,a:0}),await t.wait(.2,t=>this.scoreTxt.set({a:t})),await t.wait(.3),this.scoreTxt.set({a:0})})}render(t){t.add(this.scoreTxt)}score(t,s){this.scoreTxt.text("$"+s),this.scoreAnim.start(t)}}class k extends y{constructor(t,s){super(t),this.time=0,this.loop=!1,this.length=0,this.active=!1,this.finished=!0,this.particles=[],this.props={x:0,y:0,v:0,r:0,a:0,c:1,s:0,t:1,...s};for(let s=0;this.props.c>s;s++)this.particles.push(new y(t))}start(t=-1,s=0,i=this.props.s){this.time=-s,this.loop=0>t,this.length=t+this.props.t,this.props.s=i,this.active=!0,this.finished=!1}stop(t=0){this.length=this.time+this.props.t+t,this.active=!1,this.loop=!1}update(t){if(!this.loop&&this.time>this.length){if(this.finished)return;return this.finished=!0,void(this.props.of&&this.props.of(this))}const s=this.props,i=k.pos,{v:e,c:a,w:h,h:n,s:r,t:o,ou:c}=s;let{a:l,r:d}=s;l=Math.abs(l),E.SEED=r,this.time+=t,this.active=this.loop||this.length-o>this.time,this.particles.forEach((u,p)=>{const m=r?E(o):o,f=(m+this.time)%o,y=Math.floor((this.time+o-f)/o),w=Math.min(t,f),x=f-w;let{x:g,y:v}=this.param;g+=h?E(h,y)-h/2:0,v+=n?E(n,y)-n/2:0;const A=f>t?u.param:{...this.param,x:g,y:v};i.set(0,e*w).rotate(d-(r?E(l,y):l/a*p)+l/2).add(s.x*f*f-s.x*x*x+A.x,s.y*f*f-s.y*x*x+A.y);const b={...A,x:i.x,y:i.y};c&&c(b,f/o,y),(0>this.time||f>this.time||!this.loop&&o*y+o-m>this.length)&&(b.a=0),u.set(b,null)})}}k.pos=new r;class S extends A{constructor(){super(),this.back=new y({...T.ptc,s:24,f:3,c:"000a",l:4}),this.txt1=new w({...T.font,y:-12,ha:1,l:4},"You are"),this.txt2=new w({...T.font,ha:1,l:4}),this.color=["f00","0c0","00f","fc0","0ff","f0f"],this.emitter=new k({...T.ptc,y:4,f:1,l:4},{c:40,a:.5,v:-100,y:150,w:90,h:90,s:E(),t:.7,ou:(t,s,i)=>{let e=this.color;t.a=1-s**4,t.l=E(1,i,!0)+4,t.r=E(3,i)+3*s,t.c=e[E(e.length-1,i,!0)]}}),this.showAnim=new m(async t=>{await t.wait(.3,t=>{this.back.set({a:t}),this.txt1.set({a:t,s:t>.2?3-2*t:0}),this.txt2.set({a:t,s:t>.6?5-4*t:0})})}),this.hideAnim=new m(async t=>{await t.wait(.3,t=>{const s=1-t*t;this.back.set({a:s}),this.txt1.set({a:s}),this.txt2.set({a:s})})}),this.hide(!1)}async show(t,s){s&&this.emitter.start(),this.txt2.text(t+"!"),await this.showAnim.start()}async hide(t=!0){this.emitter.active&&this.emitter.stop(),t&&await this.hideAnim.start(),this.back.set({a:0}),this.txt1.set({a:0}),this.txt2.set({a:0})}emit(t){this.emitter.start(t)}render(t){t.add(this.back).add(this.emitter.particles).add(this.txt1).add(this.txt2)}update(t){this.emitter.update(t)}}class C extends A{constructor(t){super(),this.hud=new D,this.grid=new I(6,6),this.score=new L,this.overlay=new S,this.active=!0,this.ended=!1,this.onInput=async t=>{if("Mouse0"===t.target&&t.data[t.target]){const{hud:t,grid:s}=this;this.ended?(this.overlay.hide(),this.create()):this.active&&(this.active=!1,t.enabled&&t.shop.isHover?await t.buy(this.roll(T.shop)):await s.setTile(t.tile),s.check()?t.move?this.save():(this.clear(),this.ended=!0,i.emit({name:"promoted"}),this.overlay.show("promoted",!0)):(this.clear(),this.ended=!0,i.emit({name:"fired"}),this.overlay.show("fired",!1)),this.active=!0)}},this.onPlace=()=>{this.hud.type=this.roll(),this.hud.show()},this.onMerge=t=>{const s=t.target;this.coin(s,t.data),s.type===b.PINATA?(this.overlay.emit(.4),v.play("pinata")):v.play("coin")},this.onClear=t=>{const s=t.target;this.coin(s),s.isGold||(this.hud.type=this.roll(),this.hud.show())},this.onALL=t=>{v.play(t.name)},this.add(this.hud).add(this.grid).add(this.score).add(this.overlay),i.on("input",this.onInput).on("place",this.onPlace).on("merge",this.onMerge).on("clear",this.onClear).on("all",this.onALL),t?(this.hud.load(t.hud),this.grid.load(t.grid)):this.create()}static load(){try{return JSON.parse(localStorage.getItem(C.store))}catch(t){}return null}create(){for(const t of this.grid.tiles)t.type=this.roll(T.init);this.hud.load({coin:0,type:1,move:404,item:12}),this.ended=!1,this.save()}save(){const{hud:t,grid:s}=this;localStorage.setItem(C.store,JSON.stringify({hud:t,grid:s}))}clear(){localStorage.removeItem(C.store)}coin(t,s=1){const i=T.coin[t.type]*s;i&&(this.score.score(t,i),this.hud.coin+=i)}roll(t=T.odds){let s=E(99);for(let i=t.length-1;i>0;i--){if(t[i]&&t[i]>s)return i;s-=t[i]}return 0}}C.store="office_404";const R={scenes:[]};class P extends A{constructor(){super(),this.sound=1,this.twtIcon=new y({...T.icon,x:-40,y:84,f:3,a:0}),this.sndIcon=new y({...T.icon,x:40,y:84,f:1,a:0}),this.showAnim=new m(async t=>t.wait(.5,t=>{const s=t*t;this.twtIcon.set({a:s}),this.sndIcon.set({a:s})})),this.onInput=async t=>{if("Mouse0"===t.target&&t.data[t.target]&&(this.sndIcon.box.has(o)&&(++this.sound>2&&(this.sound=0),this.sndIcon.set({f:this.sound}),i.emit({name:"sound",data:this.sound})),this.twtIcon.box.has(o))){const t=new URLSearchParams;t.set("url",location.href),t.set("text","Check out OFFICE 404!"),t.set("hashtags","js13k,office404"),window.open("http://www.twitter.com/share?"+t,"_blank")}},i.on("input",this.onInput)}render(t){t.add(this.twtIcon).add(this.sndIcon)}}class O extends A{constructor(){super(),this.logo=new w({...T.font,s:2,c:"eee",va:1,ha:1}),this.num=new w({...T.font,y:-10,r:.3,c:"900",ha:1}),this.newTxt=new w({...T.font,y:0,ha:1}),this.loadTxt=new w({...T.font,y:12,ha:1}),this.clickTxt=new w({...T.tiny,y:12,ha:1}),this.settings=new P,this.introAnim=new m(async t=>{await t.wait(.5),await t.wait(1.5,t=>this.logo.text("Office".substr(0,Math.ceil(6*t)))),this.num.text("404!"),await t.wait(.3,t=>this.num.set({x:34*t,s:3.7-2*t*t,a:t*t})),await t.wait(.5),this.clickTxt.text("Click to start"),i.on("input",this.onInit)}),this.startAnim=new m(async t=>{this.clickTxt.text(),await t.wait(.5,t=>{const s=t**4;this.logo.set({y:-80*s}),this.num.set({y:-80*s-10})}),this.newTxt.text("New game"),this.data&&(this.newTxt.set({y:-12}),this.loadTxt.text("Continue")),await t.wait(.3,t=>{this.newTxt.set({a:t*t}),this.loadTxt.set({a:t*t})}),i.on("input",this.onInput).on("pointer",this.onPointer),await this.settings.showAnim.start()}),this.hideAnim=new m(async t=>{await t.wait(.5,t=>{const s=1-t*t;this.newTxt.set({a:s}),this.loadTxt.set({a:s})})}),this.onInit=async t=>{if("Mouse0"===t.target&&t.data[t.target]){i.off("input",this.onInit),this.clickTxt.text("Loading...");const t=["sine",.2,[.2,0],0],s=["triangle",.3,[.2,.1],0],e=["sawtooth",.3,[.05,.07,.05],0],a=["square",.2,[.2,0],0],h=["sine",.3,[1,.1,0],0],n=["sine",.2,0,[1,0]];await v.init(),await v.sound("place",h,[110,15,0]),await v.sound("lock",["triangle",.4,[0,.2],0],[880,220,880]),await v.music("clear",[[["square",.2,[.2,0],0],"1a6,1c7,1e7",.05]]),await v.music("coin",[[t,"2a4,2a5",.05]]),await v.music("buy",[[t,"2a6,2e7,2a7",.05]]),await v.sound("fired",["triangle",1,[.3,0],[.2,0]],[880,110]),await v.music("promoted",[[t,"1f5a5c6,3f5a5c6,1f5a5c6,3g5b5d6,4a5c6e6",.1],[s,"1f6,3f6,1f6,3g6,4a6",.1],[a,"4f3,1f3,3g3,4a3",.1]]),await v.music("pinata",[[t,"2g4b4d5,1g4b4d5,1g4b4d5,4c5e5g5",.1],[s,"2g6,1g6,1g6,4c7",.1],[a,"2g2,1g2,1g2,4c3",.1]]),await v.music("music",[[s,"8|8|1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8f6,4e6,20,1a5,1,1a5,1,2d6,1e6,2f6,7,2e6,2,2e6,2c6,4g5,4,8d6,4c6,20|2",.125],[e,"8a4d5f5,8a4c5e5,8g4c5e5,8g4b4d5|10",.125],[a,"1a2,1a2,3f3,1d2,2,1a2,1a2,3e3,1c2,2,1g2,1g2,3e3,1c2,2,1g2,1g2,3d3,1b2,2|8",.125],[h,"1a3,7,1a3,1,1a3,5|20",.125],[n,"8|8|4,1a7,3|24",.125]]),this.sound=this.settings.sound,await this.startAnim.start()}},this.onInput=async t=>{const s=this.load;"Mouse0"===t.target&&t.data[t.target]&&(s||this.create)&&(this.hideAnim.start(),i.off("input",this.onInput).off("pointer",this.onPointer),v.play("music",!0,"music"),i.on("sound",t=>this.sound=t.data),R.scenes[1]=new C(s?this.data:null))},this.onPointer=()=>{this.loadTxt.set({c:this.load?"0ff":"fff"}),this.newTxt.set({c:this.create?"0ff":"fff"})},this.onCoil=()=>{T.price=T.coil,this.logo.set({c:"c90"})},this.data=C.load(),this.add(this.settings),this.introAnim.start(),i.on("coil",this.onCoil)}get load(){return this.loadTxt.box.has(o)}get create(){return this.newTxt.box.has(o)}set sound(t){v.mixer("master",t>0?.8:0),v.mixer("music",1===t?.2:0)}render(t){super.render(t),t.add(this.logo).add(this.num).add(this.newTxt).add(this.loadTxt).add(this.clickTxt)}}const B=n.gl,U=new class{constructor(t=1){this.margin=t,this.count=0,this.layers=[];const s=[0,1,2,2,1,3];this.uv=new Float32Array(131072),this.pos=new Float32Array(131072),this.idx=new Uint16Array(98304),this.color=new Float32Array(262144);for(let t=0;this.idx.length>t;t++)this.idx[t]=s[t%6]+4*Math.floor(t/6)}flush(t,s=this.layers.keys()){this.count=0;for(const i of s){const s=this.layers[i];s&&((t?s.sort(t):s).forEach(t=>this.addSprite(t)),s.length=0)}return this}add(t){if(t instanceof Array)return t.forEach(t=>this.add(t)),this;const{n:s,l:i}=t.param;return s&&(this.layers[i]||(this.layers[i]=[]),this.layers[i].push(t)),this.add(t.children),this}addSprite(t){const s=t.param;if(s.n in d.frames&&16384>this.count){this.addUv(s),this.pos.set(t.mesh,8*this.count);let i=16*this.count++;for(let s=0;4>s;s++)this.color.set(t.tint,4*s+i)}}addUv({n:t,f:s,w:i,h:e}){const[a,h]=d.size,n=this.margin/a;let[r,o]=d.frames[t];r/=a,o/=h,e/=h,r+=((i/=a)+n)*Math.floor(s),this.uv.set([r,o,r+i,o,r,o+e,r+i,o+e],8*this.count)}},N=new class{constructor(t,s,i){this.gl=t,this.buffers={},this.textures={},this.locations={};const e=t.createProgram();t.attachShader(e,this.compile(t.VERTEX_SHADER,s)),t.attachShader(e,this.compile(t.FRAGMENT_SHADER,i)),t.linkProgram(e),this.program=e}compile(t,s){const i=this.gl,e=i.createShader(t);return i.shaderSource(e,s),i.compileShader(e),e}buffer(t,s){const i=this.gl,e=this.buffers,a=s instanceof Float32Array?i.ARRAY_BUFFER:i.ELEMENT_ARRAY_BUFFER;return t in e||(e[t]=i.createBuffer()),i.bindBuffer(a,e[t]),i.bufferData(a,s,i.STATIC_DRAW),this}texture(t,s,i=!0){const e=this.gl,a=this.textures;if(s){const h=e.createTexture();e.bindTexture(e.TEXTURE_2D,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i?e.NEAREST:e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),a[t]=h}else t in a&&e.bindTexture(e.TEXTURE_2D,a[t]);return this}attrib(t,s,i){const e=this.gl,a=this.locations;return this.buffer(t,i),t in a||(a[t]=e.getAttribLocation(this.program,t),e.enableVertexAttribArray(a[t]),e.vertexAttribPointer(a[t],s,e.FLOAT,!1,0,0)),this}uniform(t,s,i){const e=this.gl,a=this.locations;t in a||(a[t]=e.getUniformLocation(this.program,t));const h=a[t];if("number"==typeof s)e.uniform1f(h,s);else switch(i||s.length){case 2:e.uniform2fv(h,s);break;case 3:e.uniform3fv(h,s);break;case 4:e.uniform4fv(h,s);break;case 9:e.uniformMatrix3fv(h,!1,s);break;case 16:e.uniformMatrix4fv(h,!1,s)}return this}}(B,"precision lowp float;attribute vec2 aUv;attribute vec2 aPos;attribute vec4 aColor;uniform mat3 uProj;varying vec2 vUv;varying vec4 vColor;void main(){vUv=aUv;vColor=aColor;gl_Position=vec4(uProj*vec3(aPos,1),1);}","precision lowp float;uniform sampler2D uImage;varying vec2 vUv;varying vec4 vColor;void main(){gl_FragColor=texture2D(uImage,vUv)*vColor;gl_FragColor.rgb*=gl_FragColor.a;}"),F=new Image,G=R.scenes;function q(){requestAnimationFrame(q),p.update(),G.forEach(t=>t.update(p.delta)),G.forEach(t=>t.render(U)),U.flush(),B.clear(B.COLOR_BUFFER_BIT),N.uniform("uProj",n.mat.data).attrib("aUv",2,U.uv).attrib("aPos",2,U.pos).attrib("aColor",4,U.color),B.drawElements(B.TRIANGLES,6*U.count,B.UNSIGNED_SHORT,0)}t(F,"load",()=>{G[0]=new O,B.enable(B.BLEND),B.clearColor(0,0,0,0),B.blendFunc(B.ONE,B.ONE_MINUS_SRC_ALPHA),B.useProgram(N.program),N.buffer("indices",U.idx).texture("sprite",F),q(),t(document,"click",s),document.monetization&&t(document.monetization,"monetizationstart",()=>i.emit({name:"coil"}))}),F.src="data:image/png;base64,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"}();</script></body></html>