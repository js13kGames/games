<script src=/2017/webxr/aframe.js></script><style>div.text{font:24px impact;color:#fff;position:absolute;width:100%;text-align:center;z-index:100;display:block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}</style><body><script>var game={inProgress:!1,score:0,highScore:document.cookie||0};const growthFactor=2,interval=1500,resetInterval=1e3;var colors=["#3c6e6f","#9c0e3e","#007727","#730075","#b8aa01","#48019d","#966401","#0350a0"],colorIndex=0,myAudioContext=new AudioContext;const initialize=function(){game.inProgress=!1,game.highScore=parseInt(document.cookie)||0;var e=game.score>0?"Last: "+game.score+" ":"Swivel chair recommended. ";document.getElementById("score").setAttribute("canvas-text","text: "+e+" Best: "+game.highScore),document.getElementById("shapes").setAttribute("visible",!1),document.getElementById("titleShape").setAttribute("visible",!0),document.getElementById("instructions").setAttribute("visible",!0),document.getElementById("sky").setAttribute("color","#000000")};window.onload=initialize;const newGame=function(){game.inProgress||(game.inProgress=!0,game.score=0,document.getElementById("shapes").setAttribute("visible",!0),document.getElementById("titleShape").setAttribute("visible",!1),document.getElementById("instructions").setAttribute("visible",!1),document.getElementById("score").setAttribute("canvas-text","text:;"),playSound("intro"))},increaseScore=function(){game.score++,playSound("point"),document.getElementById("score").setAttribute("canvas-text","text: "+game.score)},gameOver=function(){game.inProgress=!1,playSound("end"),game.score>game.highScore&&(game.highScore=game.score,document.cookie=game.highScore),initialize()},playSound=function(soundName){if(myAudioContext.close(),myAudioContext=new AudioContext,"intro"==soundName)with(myAudioContext)[1,1,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,10,10,10,10,13,13,13,13,13,13,15,15,15,15].map(((v,i)=>{with(createOscillator())v&&(start(e=[15,16,5,6,13,14,21,22,23,24,25,26,28,29,30,31,32,33,34,36,27,35,3,4,11,12,1,2,7,9,17,19,8,10,18,20][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}));else if("point"==soundName){let index=Math.floor(game.score/4)%5;if(0==index)with(myAudioContext)[18,18,20,20,22,23,23,25,25].map(((v,i)=>{with(createOscillator())v&&(start(e=[2,7,3,8,10,4,9,1,6][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}));else if(1==index)with(myAudioContext)[10,11,13,13,15,20,22].map(((v,i)=>{with(createOscillator())v&&(start(e=[3,4,6,7,5,2,1][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}));else if(2==index)with(myAudioContext)[13,13,15,15,18,18,18,20].map(((v,i)=>{with(createOscillator())v&&(start(e=[1,4,2,5,3,7,8,6][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}));else if(3==index)with(myAudioContext)[18,18,20,22,23,25,25,25,25].map(((v,i)=>{with(createOscillator())v&&(start(e=[1,7,2,4,3,5,6,8,9][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}));else with(myAudioContext)[13,17,18,20,22,25,25].map(((v,i)=>{with(createOscillator())v&&(start(e=[6,5,3,4,2,1,7][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}))}else if("end"==soundName)with(myAudioContext)[15,16,17,18,18].map(((v,i)=>{with(createOscillator())v&&(start(e=[1,2,3,4,5][i]/5,connect(destination),frequency.value=988/1.06**v,type="triangle"),stop(e+.2))}))};AFRAME.registerComponent("canvas-text",{schema:{text:{type:"string",default:""},width:{type:"number",default:256},height:{type:"number",default:64}},init:function(){this.update()},update:function(e){var t=this;e||this.createCanvas(this.data.width,this.data.height);var i=48,n={};for(t.ctx.font=i+"px Impact",t.ctx.fillStyle="white",t.ctx.textBaseline="hanging";!((n=t.ctx.measureText(this.data.text)).width<this.data.width);)i-=2,t.ctx.font=i+"px Impact";var o=this.data.width-n.width;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.fillText(this.data.text,o/2,10),this.el.setAttribute("src",t.canvas.toDataURL()),this.el.setAttribute("width",t.canvas.width/100),this.el.setAttribute("height",t.canvas.height/100)},createCanvas:function(e,t){var i=document.createElement("canvas");i.width=e,i.height=t,this.canvas=i,this.ctx=i.getContext("2d")}}),AFRAME.registerComponent("collider-check",{dependencies:["raycaster"],init:function(){this.el.addEventListener("raycaster-intersection",(function(e){game.inProgress&&gameOver()}))}}),AFRAME.registerComponent("floating-shape",{init:function(){this.forward=new THREE.Vector3(0,0,-32),this.helperVector=new THREE.Vector3,this.parentPosition=new THREE.Vector3,this.mainCamera=document.querySelector("#mainCamera")},tick:function(e,t){this.helperVector.copy(this.forward).applyQuaternion(this.mainCamera.object3D.quaternion),this.parentPosition.copy(this.mainCamera.getAttribute("position")),this.el.setAttribute("position",{x:this.helperVector.x+this.parentPosition.x,y:this.helperVector.y+this.parentPosition.y,z:this.helperVector.z+this.parentPosition.z})}}),AFRAME.registerComponent("growing-shape",{schema:{interval:{type:"number",default:1}},init:function(){this.startScale=this.el.getAttribute("scale"),this.randomize(),this.scored=!1,this.loops=0},tick:function(e,t){if(game.inProgress){let e=this.el.getAttribute("scale").x;if(e*=Math.pow(growthFactor,t/(interval-75*this.loops)),e>36&&!this.scored&&(increaseScore(),this.scored=!0),e>256){let t=e;document.querySelectorAll(".shape").forEach((function(e,i,n){t=Math.min(e.getAttribute("scale").x,t)})),document.getElementById("sky").setAttribute("color",this.color),e=t/4,this.randomize(),this.scored=!1,this.loops++}this.el.setAttribute("scale",{x:e,y:e,z:e})}else this.loops=0,this.scored=!1,this.el.setAttribute("scale",this.startScale)},randomize:function(){this.color=colors[colorIndex++%colors.length];var e=new THREE.MeshStandardMaterial({shading:THREE.FlatShading,color:this.color,side:THREE.DoubleSide}),t=new THREE.DodecahedronGeometry(1,0);t.faces.splice(3*Math.floor(12*Math.random()),3),t.faces.splice(3*Math.floor(11*Math.random()),3);var i=new THREE.Mesh(t,e);this.el.setObject3D("mesh",i);var n=AFRAME.scenes[0].querySelector("[raycaster]");n.components.hasOwnProperty("raycaster")&&n.components.raycaster.refreshObjects()}}),document.querySelector("body").addEventListener("mousedown",newGame),document.querySelector("body").addEventListener("touchstart",newGame)</script><a-scene id=scene><a-sky color=#000000 id=sky></a-sky><a-entity id=shapes><a-entity id=shape1 class="collidable shape" floating-shape growing-shape scale="1 1 1"></a-entity><a-entity id=shape2 class="collidable shape" floating-shape growing-shape scale=".25 .25 .25"></a-entity><a-entity id=shape3 class="collidable shape" floating-shape growing-shape scale=".0625 .0625 .0625"></a-entity><a-entity id=shape4 class="collidable shape" floating-shape growing-shape scale=".0156 .0156 .0156"></a-entity></a-entity><a-entity id=titleShape><a-dodecahedron color=red floating-shape material=flatShading:true; position="0 0 -10" scale="16 16 16"></a-dodecahedron><a-dodecahedron color=black floating-shape material=wireframe:true; position="0 0 -10" scale="16 16 16"></a-dodecahedron></a-entity><a-camera id=mainCamera userheight=0><a-entity id=instructions><a-image canvas-text="text:Polyhedron Runner; width:256;height:64" id=title position="0 1.5 -2.5"></a-image><a-image canvas-text="text:You are always flying toward the center; width:256;height:64" id=title position="0 1.0 -2.5"></a-image><a-image canvas-text="text:Move your body to line up with the holes; width:256;height:64" id=title position="0 0.5 -2.5"></a-image></a-entity><a-image canvas-text="text:Loading; width:256;height:64" id=score position="0 -1.5 -2.5"></a-image><a-entity><a-entity collider-check raycaster="objects:.collidable; far:4; interval: 17;"></a-entity></a-entity><a-entity light="color: #AFA; intensity: 1.5" position="0 1 1"></a-entity></a-camera><a-entity light="type: ambient; color: #BBB"></a-entity></a-scene>