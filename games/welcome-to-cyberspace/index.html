<meta charset=utf-8><body style=background:#555>
<canvas id=g width=800 height=600 style="margin:0 auto;display:block"></canvas><script>!function(){"use strict";let t=document.getElementById("g"),e=t.getContext("webgl",{alpha:!1});e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let i=1;function n(t){2==t&&0!=i||(i=t)}function o(t,e=0,i=1){return Math.max(e,Math.min(i,t))}function r(t=0){let e=2*Math.random()-1;return e>0?e+t:e-t}function s(t=2){return Math.random()*t|0}function l(t,e=null){return 0==t.length?e:t[s(t.length)]}let h=[0,0,0],a=[1,0,0],c=[0,1,0],f=[0,0,1],u=[a,c,f];function d(t,e,i,n=0){t[n+0]=e,t[n+1]=i}function v(t,e,i,n,o=0){t[o+0]=e,t[o+1]=i,t[o+2]=n}function m(t,e){for(let i=0;3>i;i++)t[i]=e[i]||0;return t}function y(t,e,i){for(let n=0;3>n;n++)t[n]=e[n]*i;return t}function w(t,e,i){for(let n=0;3>n;n++)t[n]=e[n]-i[n];return t}function p(t,e=h){return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)}function M(t,e,i,n=1,o=0){e=e||t;for(let r=0;3>r;r++)t[o+r]=e[r]+i[r]*n;return t}function A(t,e,i=1,n=0){for(let o=0;3>o;o++)t[n+o]+=e[o]*i}function g(t,e){let i,n=0;for(i=0;3>i;i++)n+=t[i]*e[i];return n}function b(t,e,i=1){let n,o=g(e=e||t,e);if(o>1e-8)for(n=0;3>n;n++)t[n]=i/Math.sqrt(o)*e[n];else t[0]=0,t[1]=0,t[2]=i;return t}function x(t,e,i){return v(t,e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]),t}let U=new Float32Array(9);let z=e.createTexture();e.bindTexture(e.TEXTURE_2D,z),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,512,512,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D);let k=e.createTexture();e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,k),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);let F=document.createElement("canvas"),C=F.getContext("2d");function D(){return C.getImageData(0,0,64,64).data}function E(t){C.clearRect(0,0,64,64),C.save(),C.font='48px "Noto Color Emoji"',C.textAlign="center",C.textBaseline="middle",C.fillText(t,32,32);let e=C.measureText(t);if(C.restore(),e.width>80)return{};let i=D(),n=0,o=0,r=0,s=0;for(let t=0;t<i.length;t+=4)n+=i[t+0]*i[t+3],o+=i[t+1]*i[t+3],r+=i[t+2]*i[t+3],s+=i[t+3];return n+o+r?{data:i,color:[n/s,o/s,r/s]}:{}}function j(t,i){e.texSubImage2D(e.TEXTURE_2D,0,64*(7&t),64*(t>>3),64,64,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(i.buffer))}F.width=512,F.height=512;let q,_,P,R,B=[],W=4,K=[],L=[[],[]],S=[[],[]],I=[[],[]],G=[[],[]],N={};function O(t){let{data:e}=E(t);if(!e)return null;j(W,e);let[i]=t;return B[W]=N[i]||{},W++}function Y(t,...e){for(let i of t){let t=O(i);if(null!=t)for(let i of e)i.push(t)}}function $(t,e){let[i,n,o]=e.split(",");Y(i,t[0],t[1]),Y(n,t[0]),Y(o,t[1])}let J,T=e.createTexture();function X(t,e,i,n=1){return o(256*t|0,0,255)|o(256*e|0,0,255)<<8|o(256*i|0,0,255)<<16|o(256*n|0,0,255)<<24}function H(t){let i=0;C.clearRect(0,0,512,512);for(let e of t){let{action:t,text:n,y:o=i,size:r=.05}=e;t&&(n=`[${n}]`),C.save(),C.translate(256,512*o|0),C.font=`bold ${512*r|0}px sans`,C.textAlign="center",C.textBaseline="middle",C.fillStyle="#000",C.strokeStyle="#000",C.lineWidth=3,C.strokeText(n,2,2),C.fillText(n,2,2),C.strokeText(n,0,0),C.fillStyle="#fff",C.fillText(n,0,0),C.restore(),e.y=o,e.size=r,i=o+1.4*r}let{data:n}=C.getImageData(0,0,512,512);e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,k),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,512,512,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(n.buffer)),e.generateMipmap(e.TEXTURE_2D),J=t}!function(){e.activeTexture(e.TEXTURE0),C.clearRect(0,0,64,64),C.save(),C.translate(32,32);let t=C.createRadialGradient(0,0,0,0,0,28);t.addColorStop(0,"#fff"),t.addColorStop(1,"transparent"),C.fillStyle=t,C.arc(0,0,28,0,2*Math.PI),C.fill(),C.restore(),j(0,D()),C.clearRect(0,0,64,64),C.save(),C.beginPath(),C.translate(32,32),C.strokeStyle="#fff",C.lineWidth=4;for(let t=0;4>t;t++)C.rotate(Math.PI/2),C.moveTo(0,10),C.lineTo(0,20);C.stroke(),C.restore(),j(1,D());for(let t=0;2>t;t++)C.clearRect(0,0,64,64),C.save(),C.beginPath(),C.translate(32,32),C.strokeStyle=t?"#ddd":"#888",C.fillStyle=t?"#d00":"#000",C.lineWidth=2,C.font="60px sans",C.textAlign="center",C.textBaseline="middle",C.fillText("â™¥",0,0),C.strokeText("â™¥",0,0),C.restore(),j(2+t,D());let{color:i}=E("ğŸ«");q=80>p(i,[197,189,100]),_=80>p(i,[220,56,114]),q&&((...t)=>{for(let e of t)for(let t of e.t)N[t]=Object.assign(N[t]||{},e)})({t:"ğŸ‘ğŸ‘Ÿ",i:30},{t:"ğŸ¤š",o:!0}),P=O("ğŸ§ "),Y("ğŸ˜ˆğŸ˜­ğŸ˜±ğŸ¤‘ğŸ¤ªğŸ¤¬ğŸ¤®ğŸ¤¯ğŸ¥´ğŸ¥µ",K);let n=[];for(let t=0;5>t;t++)n.push(String.fromCodePoint(127995+t));let o=[];Y(n.map(t=>"ğŸ¤š"+t),o);let r=[[..."ğŸ§‘ğŸ§’ğŸ§“ğŸ‘¦ğŸ‘¨ğŸ‘´ğŸ§”"],[..."ğŸ§‘ğŸ§’ğŸ§“ğŸ‘§ğŸ‘©ğŸ‘µ"]];for(let t=0;2>t;t++)for(;10>L[t].length;){let e=s(5),i=O(l(r[t])+n[e]);null!=i&&L[t].push({head:i,h:o[e]})}$(S,"ğŸ§¥,ğŸ‘•ğŸ‘”,ğŸ‘—ğŸ‘š"),$(I,"ğŸ‘ŸğŸ¥¾,ğŸ‘,ğŸ‘¢ğŸ¥¿"),R=O("ğŸ©"),$(G,",,ğŸ‘›ğŸ‘œğŸ‘"),e.bindTexture(e.TEXTURE_2D,z),e.generateMipmap(e.TEXTURE_2D);let h=new Uint8Array(262144);for(let t=0;t<h.length;t++)h[t]=256*Math.random();e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,T),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,256,0,e.RGBA,e.UNSIGNED_BYTE,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST)}();let Q={KeyW:"f",KeyA:"l",KeyS:"b",KeyD:"r",ArrowLeft:"L",ArrowUp:"f",ArrowDown:"b",ArrowRight:"R",ControlLeft:"s",ControlRight:"s",m0:"s"},V={},Z={};function tt(t){for(let e of"flbrLRsxy")t[e]=0}function et(t){let e;if("keydown"==t.type){if("Escape"==t.code)return n(2),void t.preventDefault();e=Q[t.code]}else e=Q["m"+t.button];e&&(V[e]=1,Z[e]=1,t.preventDefault())}function it(t){let e;(e="keyup"==t.type?Q[t.code]:Q["m"+t.button])&&(Z[e]=0,t.preventDefault())}function nt(t){V.x+=t.movementX||0,V.y-=t.movementY||0}function ot(){t.requestPointerLock()}document.addEventListener("pointerlockchange",function(){document.pointerLockElement==t?(document.addEventListener("mousemove",nt),document.addEventListener("mousedown",et),document.addEventListener("mouseup",it)):(document.removeEventListener("mousemove",nt),document.removeEventListener("mousedown",et),document.removeEventListener("mouseup",it))});let rt,st,lt=[];function ht(e){let[,i]=function(e){let i=e.pageX,n=e.pageY;for(let e=t;e;e=e.offsetParent)i+=e.scrollLeft-e.offsetLeft,n+=e.scrollTop-e.offsetTop;return[i,n]}(e);i/=t.clientHeight;for(let t of rt)if(Math.abs(i-t.y)<t.size/2)return t}function at(t){t.preventDefault();let e=ht(t);e&&e.action&&e.action()}function ct(t){st=ht(t)}function ft(){st=null}function ut(...e){lt.length=0,H(e),rt=e,t.addEventListener("click",at),t.addEventListener("mousemove",ct),t.addEventListener("mouseleave",ft)}function dt(){H(rt=lt.pop())}function vt(){J=null,rt=null,t.removeEventListener("click",at),t.removeEventListener("mousemove",ct),t.removeEventListener("mouseleave",ft)}let mt,yt,wt,pt,Mt,At=new Float32Array(16),gt=new Float32Array(16),bt=new Float32Array(16),xt=new Float32Array(16),Ut=new Float32Array(16);function zt(t){mt=t}function kt(t,e,i){let n,o,r,s;for(o=0;4>o;o++)for(n=0;4>n;n++){for(s=0,r=0;4>r;r++)s+=e[n+4*r]*i[r+4*o];Ut[n+4*o]=s}t.set(Ut)}function Ft(){xt.fill(0),xt[0]=1,xt[5]=1,xt[10]=1,xt[15]=1}function Ct(t,e){let[i,n,o,r]=t?[0,5,1,4]:[5,10,6,9];Ft(),xt[i]=xt[n]=Math.cos(e),xt[o]=-(xt[r]=Math.sin(e)),kt(At,At,xt),xt[r]=-(xt[o]=Math.sin(e)),kt(gt,xt,gt)}function Dt(t,i,n){let o=e.createProgram();for(let[t,r]of[[e.VERTEX_SHADER,i],[e.FRAGMENT_SHADER,n]]){let i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Failed to compile shader.\n"+e.getShaderInfoLog(i)+r);e.attachShader(o,i),e.deleteShader(i)}for(let i=0;t>i;i++)e.bindAttribLocation(o,i,`A${i}`);if(e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link shader.\n"+e.getProgramInfoLog(o));let r={u:o},s=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(let t=0;s>t;t++){let{name:i}=e.getActiveUniform(o,t);r[i.split("[")[0]]=e.getUniformLocation(o,i)}return r}let Et,jt,qt,_t=Dt(3,"attribute vec3 A0;attribute vec2 A1;attribute vec4 A2;varying vec2 a;varying vec4 b;uniform mat4 U0;void main(){a=A1;b=A2;gl_Position=U0*vec4(A0,1.);}","precision lowp float;varying vec2 a;varying vec4 b;uniform sampler2D U1;void main(){vec4 c=texture2D(U1,a);gl_FragColor=vec4(mix(b.rgb*dot(c.rgb,vec3(.3)),c.rgb,b.w),c.w);if(c.w<.5){discard;}}"),Pt=Dt(3,"attribute vec3 A0;attribute vec2 A1;attribute vec4 A2;varying vec2 a;varying vec4 b;uniform mat4 U0;void main(){a=A1;b=A2;gl_Position=U0*vec4(A0,1.);}","precision lowp float;varying vec2 a;varying vec4 b;uniform sampler2D U1;void main(){float c=texture2D(U1,a).w;c*=c*b.w;gl_FragColor=mix(c*b,vec4(1.),c*c*c);}"),Rt=Dt(3,"attribute vec3 A0;attribute vec2 A1;attribute vec4 A2;varying vec2 a;varying vec4 b;uniform mat4 U0;void main(){a=A1;b=A2;gl_Position=U0*vec4(A0,1.);}","precision lowp float;varying vec2 a;varying vec4 b;uniform sampler2D U1;void main(){gl_FragColor=b*texture2D(U1,a);}"),Bt=Dt(3,"attribute vec3 A0;attribute vec4 A1;attribute mat3 A2;uniform mat4 U0;varying vec3 c;varying vec4 a;varying mat3 d;void main(){c=A0;a=A1;d=A2;gl_Position=U0*vec4(c,1.);}","precision lowp float;varying vec3 c;varying vec4 a;varying mat3 d;uniform sampler2D U1;uniform vec4 U2[8];uniform vec4 U3[8];vec3 e(vec3 g){vec3 i,e;g=normalize(d*g);for(int q=0;q<8;q++){e=normalize(U2[q].xyz-U2[q].w*c);float s=mix(dot(g,e),1.,U3[q].w);if(s>0.){i+=s/dot(e,e)*U3[q].rgb;}}return 1.-1./(i+1.);}vec4 f(in vec2 h){vec2 j=floor(h),k;h-=j;vec3 l=vec3(1.),m=l,n;float o;for(int r=-1;r<=1;r++){for(int t=-1;t<=1;t++){k=vec2(t,r);k+=texture2D(U1,(j+k)/128.).xy-h;float o=dot(k,k);if(o<l.z){m=l;l=vec3(k,o);}else if(o<m.z){m=vec3(k,o);}}}o=sqrt(m.z-l.z);if(o<.5){n=normalize(vec3(normalize(m.xy-l.xy),3.));}else{n=vec3(0.,0.,1.);}return vec4(n,o);}void main(){vec4 p=f(a.xy*2.);gl_FragColor=vec4(e(p.xyz)*min(1.,p.w)*min(1.,a.z*10.),1.);}"),Wt=Dt(1,"attribute vec2 A0;varying vec3 e;uniform mat4 U4;void main(){vec4 f=U4*vec4(A0,0.,1.);e=f.xyz;gl_Position=vec4(A0,.99,1.);}","precision lowp float;varying vec3 e;uniform vec4 U2[8];uniform vec4 U3[8];const mat3 d=mat3(1.);const vec3 c=vec3(0.);void main(){vec3 f,g,h=normalize(e);for(int i=0;i<8;i++){g=normalize(U2[i].xyz-U2[i].w*c);float j=mix(dot(h,g),1.,U3[i].w);if(j>0.){f+=j*U3[i].rgb;}}gl_FragColor=vec4(1.-1./(f+1.),1.);}"),Kt=-10,Lt=[],St=[[],[],[]];class It{constructor(t,e,...i){this.v=[...t||h],this.m=e,this.p=e,this.M=i}move(){}update(){}A(){}g(t){Lt.push(this),null!=t&&St[t].push(this)}U(){this.v[2]=Tt(0|this.v[0],0|this.v[1])+this.p}}let Gt=[];function Nt(t,e){let{v:i,m:n}=t;for(let s of e)if(!s.k&&s!=t){let{children:e,v:l,m:h}=s;if(Math.abs(i[0]-l[0])<n+h&&Math.abs(i[1]-l[1])<n+h&&Math.abs(i[2]-l[2])<n+h){if(n+h>(r=l,((o=i)[0]-r[0])**2+(o[1]-r[1])**2))if(e){if(Nt(t,e))return 1}else if(w(Gt,i,l),b(Gt),t.F(s,Gt),t.k)return 1}}var o,r;return 0}class Ot extends It{constructor(t,e,...i){super(t,e,...i),this.C=[...h],this.D=0,this.j=0,this.q=!1,this._=!1}P(t=0){if(this.D)return;let[e,i,n]=this.v,o=p(this.C);o>8&&y(this.C,this.C,8/o),A(this.v,this.C,wt),this._||(A(this.v,f,this.j*Kt*wt*wt/2),A(this.C,f,this.j*Kt*wt));for(let e=0;3>e;e++)if(t&1<<e&&Nt(this,St[e]))return;let r,s,[l,h,a]=this.v,c=Math.max(n,a)-this.p+(this.q?.3:.1),u=l>e?1:-1,d=h>i?1:-1,v=l-u*this.m|0,m=l+u*this.m|0,w=h-d*this.m|0,M=h+d*this.m|0;for(let t=v;t!=m;t+=u)Tt(t,M)>c&&(r=1);for(let t=w;t!=M;t+=d)Tt(m,t)>c&&(s=1);let g=m+(e>l)-u*this.m,b=M+(i>h)-d*this.m;s||r||Tt(m,M)<=c||(s=!(r=Math.abs((h-i)*(g-e))>Math.abs((l-e)*(b-i)))),s&&(this.v[0]=l=g,this.B([-u,0,0])),r&&(this.v[1]=h=b,this.B([0,-d,0]));let x=a-this.p;if(this.q){let t=Tt(0|l,0|h);v=l-.5|0,w=h-.5|0;let e=0,i=0;for(let n=0;2>n;n++)for(let o=0;2>o;o++){let r=Tt(v+o,w+n);if(.3>Math.abs(r-t)){let t=1-Math.abs(v+o+.5-l),s=1-Math.abs(w+n+.5-h);t>0&&s>0&&(e+=r*t*s,i+=t*s)}}i>.1&&(t=e/i),this._=this._?1>this.C[2]||.3>x-t:t>x,this._&&(this.v[2]=t+this.p,this.C[2]=0)}else{v=l-.9*this.m|0,m=l+.9*this.m|0,w=h-.9*this.m|0,M=h+.9*this.m|0;let t=-100,e=100;for(let i=w;M>=i;i++)for(let n=m;m>=n;n++){let o=Tt(i,n);c>o&&(t=Math.max(t,o)),e=Math.min(t,o)}(t=Math.max(t,e))>x&&(this.v[2]=t+this.p,this.B(f))}}W(t,e){A(this.v,t,e);let i=g(t,this.C);0>i&&A(this.C,t,-i)}B(){}F(t,e){let i=g(e,this.C);0>i&&A(this.C,e,2*-i)}}function Yt(t,e){let i=0,n=t.length;for(;n>i;)if(t[i].k)n--,t[i]=t[n];else{if(e){let{children:e}=t[i];e&&Yt(e)}i++}t.length=n}function $t(){Lt.length=0;for(let t of St)t.length=0}function Jt(){!function t(e,i){for(let n of e)if(n.update(i),!n.k){let{children:e}=n;e&&t(e,n.v)}}(Lt,h),Yt(Lt,!0);for(let t of St)Yt(t)}function Tt(t,e){return t>=0&&e>=0&&Et>t&&jt>e?qt[e*Et+t]:0}let Xt=new Float32Array(32),Ht=new Float32Array(32),Qt=[],Vt=[new Float32Array([1,1,.8,0,.1,.3,.5,.8]),new Float32Array([.5,-.4,1,0,-.5,1,1,0])];let Zt=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,Zt),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),e.STATIC_DRAW);let te=[[-1,-1,0,1],[1,-1,1,1],[-1,1,0,0],[-1,1,0,0],[1,-1,1,1],[1,1,1,0]],ee=e.createBuffer();let ie=e.createBuffer();class ne extends Ot{constructor(t){super(t,.2),this.p=.5;let e=s(),{head:i,h:n}=l(L[e]),o=l(I[e]);this.K=0,this.S=2**(.2*r()),this.I=new Float32Array(24),this.M=[{n:i,size:.2},{n:l(S[e]),size:.25},{n:n,size:.1,rotate:180},{n:n,size:.1,G:!0,rotate:180},{n:o,size:.15},{n:o,size:.15,G:!0},{n:.2>Math.random()?R:null,size:.15},{n:.3>Math.random()?l(G[e]):null,size:.15}];for(let t=0;t<this.M.length;t++)this.M[t].offset=this.I.subarray(3*t,3*t+3);this.M=this.M.filter(t=>null!=t.n)}update(){super.P(4),this.K=(this.K+4*wt*this.S)%(2*Math.PI);let t=Math.sin(this.K);this.I.set([0,.2+.05*Math.abs(t),2,0,.03*Math.abs(t)-.1,1,.15,-.2-.04*t,5,-.15,.04*t-.2,5,.15,.06*Math.max(0,t)-.3,0,-.15,.06*Math.max(0,-t)-.3,0,0,.4+.05*Math.abs(t),3,.15,-.25-.04*t,4])}g(){super.g(2)}}class oe extends Ot{constructor(t,e,i){super(t,.1),this.N=i,y(this.C,e,4);let n=new Float32Array(45);for(let t=0;15>t;t++){let i=t/15,o=n.subarray(3*t);A(o,e,-i/2),this.M.push({v:o,n:0,size:.1*(1-i),mode:1,color:X(1,(1-i)**2,0,1-i)})}this.O=pt+2,this.Y=[1,1,.1]}update(){pt>this.O?this.k=1:this.P(this.N)}F(t){t.A(),this.k=1}B(){this.k=1}}let re,se=["sine","square","sawtooth","triangle"];let le="A,EC/eA,CA,BC,DEeeA,CB".split(" ").map(t=>t.split(",").map(t=>Array.from(t).map(t=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t))));function he(t){return t&&.9**(63-t)}function ae(t){return 40*1.1**t}function ce(t,e,i){let n=re.currentTime;t.setValueAtTime(i(e[2]),n);for(let r=3;r<e.length;r+=2)t.linearRampToValueAtTime(i(e[r+1]),n+=(o=e[r])&&.005*1.1**o);var o;return n}class fe extends Ot{constructor(t,e,i=h){super(t,e),m(this.C,i),this.$=0,this.j=1}update(){this.P(0)}B(t){t[2]>.7&&++this.$>2?this.D=1:(A(this.C,t,1.5*-g(t,this.C)),this.J())}J(){}}class ue extends fe{constructor(t,e=h){super(t.v,t.m,e),this.M.push(t.M[0]),this.O=pt+5,this.T=1e3*r(.5)}update(){let[t]=this.M;this.k=pt>this.O;let e=(this.O-pt)/5;t.color=X(3*e,e,e,4*e-3),t.size=this.m*Math.min(1,5*e),this.D||(t.rotate=((t.rotate||0)+this.T*wt)%360),super.update()}J(){this.T*=-.5}}let de=[];class ve extends fe{constructor(t){super(t.v,.2,[2*r(),2*r(),2*Math.random()]),this.X=pt,this.H=[...t.angle],this.V=[r(),-t.angle[1],1-t.angle[2]],this.angle=[...h]}update(){super.update(),zt(this),M(this.angle,this.H,this.V,o(pt-this.X)),pt>this.X+1&&n(3)}}class me extends Ot{constructor(t){super(t,.2),this.p=.5,this.angle=[...h],this.Z=0,this.direction=[...h],this.tt=0,this.et=6,this.j=1,this.q=1,this.it=[];for(let t=0;6>t;t++)this.it.push({n:2+(1&t),v:[.1+.2*(t>>1),.1,0],size:.1,anchor:[-1,-1]});this.M=[{n:1,v:[0,0,0],mode:3,size:.1},...this.it]}update(){{let t=.003*V.x,e=.003*V.y,i=3*(Z.L-Z.R),n=15*wt;this.Z=Math.abs(i-this.Z)>n?this.Z+n*Math.sign(i-this.Z):i;let r=this.angle[0]=(this.angle[0]+this.Z*wt-t)%(2*Math.PI),s=this.angle[1]=o(this.angle[1]+e,-1.5,1.5);v(this.direction,Math.cos(s)*Math.cos(r),Math.cos(s)*Math.sin(r),Math.sin(s))}let[t,e,i]=this.C;{let i=Z.f-Z.b,n=Z.r-Z.l,o=3/Math.max(1,Math.hypot(i,n)),r=Math.cos(this.angle[0])*o,s=Math.sin(this.angle[0])*o,l=r*i+s*n,h=s*i-r*n,a=15*wt,c=l-t,f=h-e,u=Math.hypot(c,f);u>a?(t+=c*a/u,e+=f*a/u):(t=l,e=h)}v(this.C,t,e,i),this.P(6),pt>this.tt&&(Z.s||V.s?(this.tt=(this.tt||pt)+.3,function(t){let e=le[t];if(!e||!re)return;let i,n,o=[],r=[re.destination],s=re.currentTime;for(let t of e){switch(n=s,t[0]){case 0:i=re.createGain(),r.push(i,i.gain);break;case 1:(i=re.createOscillator()).type=se[t[1]],r.push(i,i.frequency),o.push(i);break;case 2:i.connect(r[t[1]]);break;case 3:n=ce(r[t[1]],t,ae);break;case 4:n=ce(r[t[1]],t,he)}s=Math.max(s,n)}for(i of o)i.start(),i.stop(s)}(0),new oe(M(de,this.v,f,-.1),this.direction,2).g()):this.tt=0);for(let t=0;6>t;t+=2)this.it[t].mode=t+2>this.et?2:4,this.it[t+1].mode=t<this.et?2:4,this.it[t+1].size=t==this.et-1?.05:.1}A(){this.k||(this.et--,this.et>0||(this.k=!0,new ve(this).g()))}g(){super.g(0),zt(this)}}class ye extends It{constructor(t){super(0,.3,{n:P,size:.3}),this.nt=t}update(t){v(this.v,...t)}A(){this.k=!0,new ue(this).g(),this.nt.ot=pt+.5}}class we extends It{constructor(t){super(0,.2,{n:l(K),size:.2});let e=Math.PI*r(),i=Math.asin(r());this.v=[...h],this.m=.2,this.rt=[Math.cos(e)*Math.cos(i),Math.sin(e)*Math.cos(i),Math.sin(i)],this.st=[-Math.sin(e),Math.cos(e),0],this.K=Math.PI*r(),this.lt=t}update(t){this.K=(this.K+2*wt)%(2*Math.PI),M(this.v,t,this.rt,Math.cos(this.K)*this.lt),M(this.v,this.v,this.st,Math.sin(this.K)*this.lt)}A(){this.k=!0;let t=[];M(t,h,this.rt,-Math.sin(this.K)*this.lt*2),M(t,t,this.st,Math.cos(this.K)*this.lt*2),new ue(this,t).g()}}let pe=[1,.6,1],Me=[];class Ae extends It{constructor(t){super(t,.9);this.count=20,this.Y=[],this.children=[new ye(this)];for(let t=0;20>t;t++)this.children.push(new we(.5+.2*t/20));this.ht=0}update(){if(M(this.Y,h,pe,this.children.length/this.count),this.ot)for(;pt>this.ot;){if(!this.children.length){this.k=!0;break}this.children.pop().A(),this.ot+=.05}else if(this.ht<pt){let t=100,e=null;for(let i of St[0]){let n=p(i.v,this.v);t>n&&(t=n,e=i)}e&&(b(M(Me,e.v,this.v,-1)),this.ht<pt&&new oe(this.v,Me,1).g()),this.ht+=1}}g(){super.g(1)}}class ge{constructor(t,e){this.at=t,this.ct=e}ft(){this.ut||this.at(this)}dt(){return this.vt?e.bindBuffer(e.ARRAY_BUFFER,this.vt):(this.ft(),this.vt=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vt),e.bufferData(e.ARRAY_BUFFER,this.yt,e.STATIC_DRAW)),this.wt}pt(){var t,e,i;this.ft(),t=this.Mt,e=this.At,i=this.ut,Et=t,jt=e,qt=i,this.ct()}}let be,xe=[];function Ue(){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clearColor(.1,.1,.1,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),function(){let t=Bt;if(mt){e.enableVertexAttribArray(0),e.enableVertexAttribArray(1),e.enableVertexAttribArray(2),e.enableVertexAttribArray(3),e.enableVertexAttribArray(4),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.useProgram(t.u),e.uniformMatrix4fv(t.U0,!1,At),e.uniform1i(t.U1,1),e.uniform4fv(t.U2,Ht),e.uniform4fv(t.U3,Xt);for(let t of xe){if(!t)continue;let i=t.dt(),n=64;e.vertexAttribPointer(0,3,e.FLOAT,!1,n,0),e.vertexAttribPointer(1,4,e.FLOAT,!1,n,12),e.vertexAttribPointer(2,3,e.FLOAT,!1,n,28),e.vertexAttribPointer(3,3,e.FLOAT,!1,n,40),e.vertexAttribPointer(4,3,e.FLOAT,!1,n,52),e.drawArrays(e.TRIANGLES,0,i)}e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.disableVertexAttribArray(1),e.disableVertexAttribArray(2),e.disableVertexAttribArray(3),e.disableVertexAttribArray(4)}}(),function(){let t=Wt;e.bindBuffer(e.ARRAY_BUFFER,Zt),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.enable(e.DEPTH_TEST),e.depthMask(!1),e.useProgram(t.u),e.uniformMatrix4fv(t.U4,!1,gt),e.uniform4fv(t.U2,Ht.subarray(24)),e.uniform4fv(t.U3,Xt.subarray(24)),e.drawArrays(e.TRIANGLES,0,3),e.disable(e.DEPTH_TEST),e.depthMask(!0)}(),function(){let i=[0,0,0,0,0],n=[...Lt];for(let t=0;t<n.length;t++){let{children:e,M:o}=n[t];e&&n.push(...e);for(let{mode:t=0}of o)i[t]++}let o=0,r=[];for(let t=0;4>t;t++)r[t]=o,o+=i[t];if(!o)return;let s=new Float32Array(36*o),l=new Uint32Array(s.buffer),u=[[],[],[],[]],v=t.clientWidth/t.clientHeight;for(let t of n)for(let e of t.M){let{n:i,size:n,v:o=h,offset:y=h,rotate:w=0,G:p=!1,mode:g=0,color:U=4294967295,anchor:z}=e;if(4==g)continue;let k=36*r[g]++,F=B[i];if(F){let{o:t,i:e=0}=F;w+=p?-e:e,p=t?!p:p}let C=a,D=c,E=f;2>g?(o=M(u[0],t.v,o),E=b(M(u[1],o,yt,-1)),C=b(x(u[2],E,f)),D=b(x(u[3],C,E))):z&&(A(o=m(u[0],o),C,z[0]*v),A(o,D,z[1]));let j=Math.cos(Math.PI/180*w),q=Math.sin(Math.PI/180*w);for(let[t,e,r,h]of te)p&&(r=1-r),A(s,o,1,k),A(s,C,(t*j-e*q)*n+y[0],k),A(s,D,(e*j+t*q)*n+y[1],k),A(s,E,-.01*y[2],k),d(s,((7&i)+r)/8,((i>>3)+h)/8,k+3),l[k+5]=U,k+=6}function y(t){let n=i[t];n&&e.drawArrays(e.TRIANGLES,6*(r[t]-n),6*n)}e.bindBuffer(e.ARRAY_BUFFER,ee),e.bufferData(e.ARRAY_BUFFER,s,e.STREAM_DRAW),e.enableVertexAttribArray(0),e.enableVertexAttribArray(1),e.enableVertexAttribArray(2),e.vertexAttribPointer(0,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(1,2,e.FLOAT,!1,24,12),e.vertexAttribPointer(2,4,e.UNSIGNED_BYTE,!0,24,20);let w=_t,p=Pt,g=Rt;e.enable(e.DEPTH_TEST),mt&&(e.useProgram(w.u),e.uniformMatrix4fv(w.U0,!1,At),y(0)),e.enable(e.BLEND),mt&&(e.useProgram(p.u),e.depthMask(!1),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR),e.uniformMatrix4fv(p.U0,!1,At),y(1),e.depthMask(!0)),e.disable(e.DEPTH_TEST),e.useProgram(g.u),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.uniformMatrix4fv(g.U0,!1,bt),y(2),e.useProgram(p.u),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR),e.uniformMatrix4fv(p.U0,!1,bt),y(3),e.disable(e.BLEND),e.disable(e.BLEND),e.disableVertexAttribArray(1),e.disableVertexAttribArray(2)}(),function(){if(!J)return;let t=J.length,i=new Float32Array(30*t),n=new Uint32Array(i.buffer),o=0,r=24*t;for(let{size:t,y:e,color:s=-1}of J){t+=.04;for(let[n,r,s]of te)i.set([n,i[o+1]=1-2*e+t*r,s,i[o+3]=e-.5*t*r],o),o+=4;n.fill(s,r,r+6),r+=6}e.bindBuffer(e.ARRAY_BUFFER,ie),e.bufferData(e.ARRAY_BUFFER,i,e.STREAM_DRAW);let s=Rt;e.enableVertexAttribArray(0),e.enableVertexAttribArray(1),e.enableVertexAttribArray(2),e.vertexAttribPointer(0,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(1,2,e.FLOAT,!1,16,8),e.vertexAttribPointer(2,4,e.UNSIGNED_BYTE,!0,0,96*t),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.useProgram(s.u),e.uniformMatrix4fv(s.U0,!1,bt),e.uniform1i(s.U1,2),e.drawArrays(e.TRIANGLES,0,6*t),e.uniform1i(s.U1,0),e.disable(e.BLEND),e.disableVertexAttribArray(1),e.disableVertexAttribArray(2)}()}function ze(){pt=0,$t(),function(){if(null!=re)return;try{re=new AudioContext}catch(t){return void(re=!1)}let t=re.currentTime,e=re.createGain();e.gain.setValueAtTime(.01,t),e.connect(re.destination);let i=re.createOscillator();i.connect(e),i.start(),i.stop(re.currentTime+.05)}(),n(0),ot(),xe[0].pt()}function ke(){$t(),n(1)}function Fe(){!function(...t){lt.push(rt),H(t),rt=t}({text:"Instructions",y:.1},{y:.5,text:"Move: WASD"},{text:"Turn: Mouse"},{text:"Shoot: Ctrl, Mouse"},{text:"Back",y:.9,action:dt})}!function(){let t,e=[-1,0,1,0,-1];function i(i){let n,o,a=l+1-r,c=h+1-s,f=new Float32Array(a*c),d=new Float32Array(256),v=0,m=[],A=[],z=[],k=new Float32Array(9);function F(t,e,i,...l){if(48>d.length-v){let t=new Float32Array(2*d.length);t.set(d),d=t}w(m,l[1],l[0]),w(A,l[2],l[0]);let h=p(M(z,A,m,-g(m,A)/g(m,m)));b(x(z,m,A)),x(m,u[e],z),y(m,m,1/m[t]),x(A,z,u[t]),y(A,A,1/A[e]),function(t,e,i,n){t.set(e,0),t.set(i,3),t.set(n,6)}(k,m,A,z),function(t,e){e=e||t;for(let t=0;3>t;t++){let i=(t+1)%3,n=(t+2)%3;for(let o=0;3>o;o++){let r=(o+1)%3,s=(o+2)%3;U[3*t+o]=e[3*i+r]*e[3*n+s]+e[3*i+s]*e[3*n+r]}}let i=1/(e[0]*U[0]+e[1]*U[1]+e[2]*U[2]);for(let e=0;3>e;e++)for(let n=0;3>n;n++)t[3*e+n]=U[3*e+n]*i}(k);for(let a=0;3>a;a++){let c=l[a];c[0]+=n-r,c[1]+=o-s,d.set(c,v),d[v+3]=c[t],d[v+4]=c[e],d[v+5]=i?2==a?h:0:1,d.set(c,v),d.set(k,v+7),v+=16}}for(let i in t){let l=t[i];[n,o]=i.split(","),f[((o=+o)-s)*a+(n=+n)-r]=l;for(let i=0;4>i;i++){let r=i+0>>1&1,s=i+1>>1&1,h=i+2>>1&1,a=t[[n+e[i+1],o+e[i]]];F(0,1,null!=a&&a!=l,[s,r,l],[h,s,l],[.5,.5,l]),null!=a&&l>a&&(F(1&i,2,1,[h,s,l],[s,r,l],[(s+h)/2,(r+s)/2,a]),F(1&i,2,1,[s,r,l],[s,r,a],[(s+h)/2,(r+s)/2,a]),F(1&i,2,1,[h,s,a],[h,s,l],[(s+h)/2,(r+s)/2,a]))}}i.Mt=a,i.At=c,i.ut=f,i.yt=d.slice(0,v),i.wt=v/16}function n(t){return function(e,i,n){let o=new t([e-r+.5,i-s+.5,0]);null!=n&&Object.assign(o,n),o.g(),o.U()}}let o,r,s,l,h,a=n(ne),c=n(me),f=n(Ae);function d(e,i){null==t[[e,i]]&&(r=Math.min(e,r),s=Math.min(i,s),l=Math.max(e,l),h=Math.max(i,h),t[[e,i]]=o)}function v(t,e,i,n){for(let o=0;n>o;o++)for(let n=0;i>n;n++)d(t+n,e+o)}!function(e,n,o){let a=new ge(()=>{t={},r=s=100,l=h=-100,n(),a.gt=r,a.bt=s,i(a)},()=>{({gt:r,bt:s}=a),o()});xe[e]=a}(0,()=>{o=5,d(1,1),d(5,1),d(1,5),d(5,5),o=0,function(t,e,i,n,r,s){let l=o;for(let h=r-1;h>=0;h--)o=l+s*h,v(t+h,e+h,i-2*h,n-2*h)}(0,0,7,7,3,.2),o=3,function(t,e,i,n,o,r){for(let s=0;r>s;s++)for(let r=0;o>r;r++)d(t+i*r,e+n*s)}(-7,1,4,4,8,2),o=-.2,v(-8,-4,20,12)},()=>{c(-8,4),a(3,3),a(5,4),a(6,2),a(11,3),a(11,7),f(3,-4),f(6,6)})}(),e&&(window.requestAnimationFrame(function e(n){if(i!=be){switch(0==be?(t.removeEventListener("click",ot),window.removeEventListener("keydown",et),window.removeEventListener("keyup",it),document.exitPointerLock()):vt(),i){case 0:t.addEventListener("click",ot),window.addEventListener("keydown",et),window.addEventListener("keyup",it),tt(V),tt(Z),Mt=0;break;case 1:ut({text:"Welcome to Cyberspace",y:.1,size:.07},{text:"New Game",y:.5,action(){ze()}},{text:"Instructions",action:Fe},{text:"Made for JS13K 2018 by @DietrichEpp",y:.98,size:.03,color:4289374890});break;case 2:ut({text:"Paused",y:.25,size:.07},{text:"Resume",y:.5,action:ze},{text:"Instructions",action:Fe},{text:"End Game",y:.9,action:ke});break;case 3:ut({text:"You died.",y:.25,size:.07},{text:"Instructions",y:.5,action:Fe},{text:"End Game",y:.9,action:ke})}be=i}0==i?((t=>{wt=Mt?.001*o(t-Mt,0,250):0,pt+=wt,Mt=t})(n),Jt(),(()=>{let t=Vt,e=t[0].length/4,i=8-e;Qt.length=0;for(let t of Lt)t.Y&&Qt.push({xt:t,Ut:1/p(yt,t.v)*p(t.Y)});Qt.sort((t,e)=>t.Ut-e.Ut),Xt.fill(0);for(let t=0;t<Math.min(i,Qt.length);t++){let{xt:e}=Qt[t];Ht.set(e.v,4*t),Ht[4*t+3]=1,Xt.set(e.Y,4*t)}Xt.set(t[0],4*(8-e)),Ht.set(t[1],4*(8-e))})(),tt(V)):(()=>{for(let t of rt)t.action&&(t.color=t==st?4278190335:4291611852)})(),(()=>{if(bt.fill(0),bt[0]=t.clientHeight/t.clientWidth,bt[5]=1,bt[10]=1,bt[15]=1,yt=h,!mt)return;if(mt.k)return void(mt=null);let{v:e,angle:i}=mt;yt=e;let n=.7*t.clientHeight/t.clientWidth;At.fill(0),At[0]=.5/.7,At[5]=.5/n,At[10]=20.1/-19.9,At[11]=-1,At[14]=4/-19.9,gt.fill(0),gt[0]=1/At[0],gt[5]=1/At[5],gt[11]=1/At[14],gt[14]=1/At[11],gt[15]=-At[10]/(At[11]*At[14]),Ct(1,i[2]),Ct(0,i[1]+.5*Math.PI),Ct(1,i[0]-.5*Math.PI),Ft(),A(xt,e,-1,12),kt(At,At,xt)})(),Ue(),window.requestAnimationFrame(e)}),window.addEventListener("blur",function(){n(2)}))}();
</script>