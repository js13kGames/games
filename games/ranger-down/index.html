<!doctype html><title>RANGER DOWN</title><style>body{background:#000;margin:0;overflow:hidden}#c{background:#000;display:block;margin:auto;image-rendering:-moz-crisp-edges;image-rendering:pixelated;width:100vmin;height:100vmin;filter:contrast(80%) brightness(95%)}#c.i{filter:contrast(60%) brightness(30%) sepia(60%) saturate(666%) hue-rotate(190deg)}#c.g{filter:contrast(80%) brightness(80%) sepia(60%) saturate(666%) hue-rotate(71deg)}#c.a{filter:contrast(90%) brightness(80%) sepia(60%) saturate(999%) hue-rotate(345deg)}</style><canvas id=c></canvas><script>let s=()=>{let e=e=>new Promise((t=>{let l=new Image;l.onload=()=>t(l),l.src=e})),t=e=>e[l(e.length)],l=(e,t=0)=>~~(Math.random()*e)+t,s=e=>e.slice().sort((()=>l(3)-1)),r=(e,t)=>Math.max(e,t)-Math.min(e,t),h=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1]],a=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1],[e-1,t-1],[e+1,t-1],[e-1,t+1],[e+1,t+1]],o=(e,t,l)=>h(t).filter((t=>e[t[1]][t[0]]===l)),n=([e,t],[l,s])=>Math.hypot(r(e,l),r(t,s)),u=(e,t)=>{let l,s=25600;for(let r=0;r<t.length;r++){let h=n(e,t[r]);h<s&&(s=h,l=t[r])}return l},g=([e,t],l)=>{let s=[],r=[[e,t,0]],a=[],o=([e,t,o])=>{m([e,t])&&l([e,t])&&(a[160*t+e]||(s.push([e,t,o]),a[160*t+e]=1,r.push(...h([e,t]).map((([e,t])=>[e,t,o+1])))))};for(;r.length;)o(r.shift());return s},p=([e,t],[l,s])=>{let h=r(e,l),a=r(t,s),o=e,n=t;return h>a&&(l>e&&(o=e+1),e>l&&(o=e-1)),a>h&&(s>t&&(n=t+1),t>s&&(n=t-1)),[o,n]},d=([e,l],[s,r],a=m,o=.66)=>{let n=[],u=[],g=([e,l])=>{u[160*l+e]||(n.push([e,l]),u[160*l+e]=1),e===s&&l===r||g(Math.random()<o?t(h([e,l]).filter(a))||[e,l]:p([e,l],[s,r]))};return g([e,l]),n},i=(e,l=8448)=>{let s=e.slice(),r=[];for(let e=0;e<s.length;e++){let[t,l]=s[e];r[160*l+t]=1}for(;s.length<l;){let[e,l]=t(s),a=h([e,l]);if(a.length){let[e,l]=t(a);r[160*l+e]||(s.push([e,l]),r[160*l+e]=1)}}return s},f=e=>[3===e?20:1===e?140:l(120,20),0===e?20:2===e?140:l(120,20)],m=([e,t])=>e>=0&&e<=159&&t>=0&&t<=159,S=([e,t])=>e>=8&&e<=152&&t>=8&&t<=152,I=()=>{let e=[];for(let t=0;t<160;t++){let t=[];for(let e=0;e<160;e++)t.push(1);e.push(t)}return e},E=(e,t,l)=>{for(let s=0;s<t.length;s++){let[r,h]=t[s];e[h][r]=l([r,h])}},N=e=>{for(let t=0;t<160;t++)for(let s=0;s<160;s++)2===e[t][s]&&(o(e,[s,t],0).length?e[t][s]=l(3)+17:e[t][s]=l(13)+2)},R=e=>e<2||e>=11&&e<15||20===e||27===e||24===e||25===e||26===e||21===e||22===e||23===e||e>=28&&e<31||e>=31&&e<34||36===e||44===e||43===e||34===e,O=[];O[0]=[0,"s.png"],O[1]=[1,["Lost contact with","RANGER. Take boat","and investigate."]],O[2]=[1,["Sunrise"]],O[3]=[1,["Sunset"]],O[8]=[1,["I should","investigate"]],O[9]=[2,["Sleep?",""],[["Yes",11],["No",-1]],0,"g"],O[10]=[1,["I'm not tired!"]],O[11]=[4,0],O[12]=[1,["I'm hungry!"]],O[13]=[1,["You died","","GAME OVER!"]],O[14]=[1,["It's RANGER!","","RANGER is DEAD!","","Found 1 keycard","Found 5 food","Found 3 chips","Found 2 backups"]],O[15]=[1,["It's locked!"]],O[16]=[2,["It's locked!","","Use keycard?",""],[["Yes",17],["No",-1]],0,"g"],O[17]=[4,1],O[18]=[2,["Search ruins?","","1 hour",""],[["Yes",19],["No",-1]],0,"g"],O[19]=[4,2],O[21]=[4,3],O[23]=[4,4],O[26]=[4,5],O[27]=[4,6],O[28]=[4,7],O[29]=[4,8],O[30]=[4,9],O[31]=[4,10],O[33]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 1","","RANGER:","Sent to investigate","ruins. Found strange","technology"],[],0,"a"],O[34]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 2","","RANGER:","Was testing strange","technology. Portals","appeared!"],[],0,"a"],O[35]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 3","","RANGER:","Monsters coming out","of portals! Made it","back to hut. They","only come out at","night"],[],0,"a"],O[36]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 4","","RANGER:","Monsters affecting","computers. Have been","stashing items in","ruins for emergency.","Tried comms but the","satellite is offline"],[],0,"a"],O[37]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 5","","RANGER:","Programmed synth to","make mod chips that","can shut down portal","but computer went","offline! There are","more of them every","night"],[],0,"a"],O[38]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 6","","RANGER:","Got computer online.","Still has errors.","Comms are badly","damaged"],[],0,"a"],O[39]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 7","","RANGER:","Rigged comms to send","distress signal but","satellite offline.","Synth can make chip","to fix it"],[],0,"a"],O[40]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 8","","RANGER:","Must disable portals","before send distress","signal, no way to","warn rescue team","about monsters","with comms offline"],[],0,"a"],O[41]=[4,11],O[42]=[4,12],O[43]=[4,13],O[44]=[4,14],O[45]=[4,15];let w,T,y,C,k,A=e=>{let t=D[0]()[6],l=D[0]()[7];c.className=t,c.width=c.height=160,3===l[0]&&(G(e),L()),0===l[0]&&"s.png"===l[1]&&(b.drawImage(C,0,0),b.drawImage(y,64,0,16,16,72,72,16,16),M("Js13kGames OFFLINE",1,16),M("C2018 Nik Coughlin",1,18)),1===l[0]&&v(l[1]),2===l[0]&&Y(l),5===l[0]&&$(),requestAnimationFrame(A)},F=(e="",t=0,l=0)=>b.drawImage(w,8*(e.charCodeAt(0)-32),0,8,8,8*t,8*l,8,8),M=(e="",t=0,l=0)=>{for(let s=0;s<e.length;s++)F(e[s],t+s,l)},v=e=>{let t=~~((20-e.length)/2);for(let l=0;l<e.length;l++){let s=~~((20-e[l].length)/2);M(e[l],s,t+l)}},Y=e=>{for(let t=0;t<e[1].length;t++)M(e[1][t],0,t);M("<X>",17,0);let t=e[1].length%2?1:0;for(let l=0;l<e[2].length;l++)M(`${l+1} ${l===e[3]?"<":" "}${e[2][l][0]}${l===e[3]?">":" "}`,0,2*l+e[1].length+t)},G=e=>{let t=~~(e/500)%2?0:1,l=D[0]()[8],s=D[0]()[7],r=s[3],h=s[1],a=s[2],o=s[4],n=s[5],u=s[6],g=D[0]()[2],p=D[0]()[0],d=D[0]()[16],i=D[0]()[12],f=D[0]()[4]>=18||D[0]()[4]<6;for(let e=0;e<9;e++)for(let s=0;s<9;s++){let S=h-4+s,I=a-4+e,E=16*t;if(m([S,I])){let e=r[I][S];e&&(E=16*e)}if(b.drawImage(T,E,0,16,16,16*(s+1),16*(e+1),16,16),36===r[I][S]&&(f?b.drawImage(T,16*(36+t),0,16,16,16*(s+1),16*(e+1),16,16):b.drawImage(T,704,0,16,16,16*(s+1),16*(e+1),16,16)),34===r[I][S]&&d&&b.drawImage(T,16*(34+t),0,16,16,16*(s+1),16*(e+1),16,16),0===o&&f)for(let r=0;r<l.length;r++){let h=l[r],a=h[0],o=h[1],n=h[2];a===S&&o===I&&h[3]>0&&(E=16*(7+t)+16*n*2,b.drawImage(y,E,0,16,16,16*(s+1),16*(e+1),16,16))}4===s&&4===e&&(E=g?16*t+16*p*2:64,b.drawImage(y,E,0,16,16,16*(s+1),16*(e+1),16,16)),0===o&&S===n-2&&I===u&&b.drawImage(y,80,0,16,16,16*(s+1),16*(e+1),16,16),0===o&&S===n-1&&I===u&&b.drawImage(y,96,0,16,16,16*(s+1),16*(e+1),16,16),0!==o||i[160*I+S]||b.drawImage(T,672,0,16,16,16*(s+1),16*(e+1),16,16)}},L=()=>{let e=D[0]()[1],t=D[0]()[2],l=D[0]()[9],s=D[0]()[10],r=D[0]()[11],h=D[0]()[17],a=D[0]()[18];M(`RANGER DOWN ${D[2]()}`,2.5,.5),b.drawImage(T,256,0,16,16,0,0,16,16),M(`${t}`,t<10?.5:0,2),b.drawImage(T,240,0,16,16,0,24,16,16),M(`${e}`,e<10?.5:0,5),b.drawImage(T,624,0,16,16,0,48,16,16),M(`${l}`,l<10?.5:0,8),b.drawImage(T,640,0,16,16,0,72,16,16),M(`${r}`,r<10?.5:0,11),b.drawImage(T,656,0,16,16,0,96,16,16),M(`${s}`,s<10?.5:0,14),h>-1&&M(`${h}`,h<10?.5:0,15),a>-1&&M(`${a}`,a<10?.5:0,16)},$=()=>{let e=D[0]()[7],t=D[0]()[12],s=D[0]()[13],r=D[0]()[14],h=D[0]()[16],a=e[1],o=e[2],n=e[3],u=e[4];for(let e=0;e<160;e++)for(let s=0;s<160;s++){let r=~~(s/40),h=~~(e/40),a=n[e][s],o=a>=17&&a<20;u[4*h+r]?R(a)?b.drawImage(T,432,0,1,1,s,e,1,1):t[160*e+s]||o||s%2&&!(e%2)||!(s%2)&&e%2?b.drawImage(T,32,0,1,1,s,e,1,1):b.drawImage(T,432,0,1,1,s,e,1,1):s>8&&e>8&&(l(2)?b.drawImage(T,32,0,1,1,s,e,1,1):b.drawImage(T,432,0,1,1,s,e,1,1))}for(let e=0;e<160;e++)for(let t=0;t<160;t++){let l=~~(t/40),a=~~(e/40),o=n[e][t];u[4*a+l]&&(20===o&&(s[160*e+t][0]?(b.drawImage(T,32,0,9,9,t-4,e-4,9,9),b.drawImage(k,35,0,7,7,t-3,e-3,7,7)):(b.drawImage(T,432,0,9,9,t-4,e-4,9,9),b.drawImage(k,0,0,7,7,t-3,e-3,7,7))),o>=28&&o<31&&(r[160*e+t].length?(b.drawImage(T,32,0,9,9,t-4,e-4,9,9),b.drawImage(k,7,0,7,7,t-3,e-3,7,7)):(b.drawImage(T,432,0,9,9,t-4,e-4,9,9),b.drawImage(k,42,0,7,7,t-3,e-3,7,7))),34===o&&(h?(b.drawImage(T,32,0,9,9,t-4,e-4,9,9),b.drawImage(k,49,0,7,7,t-3,e-3,7,7)):(b.drawImage(T,432,0,9,9,t-4,e-4,9,9),b.drawImage(k,14,0,7,7,t-3,e-3,7,7))),36===o&&(b.drawImage(T,32,0,9,9,t-4,e-4,9,9),b.drawImage(k,28,0,7,7,t-3,e-3,7,7)),43===o&&(b.drawImage(T,32,0,9,9,t-4,e-4,9,9),b.drawImage(k,56,0,7,7,t-3,e-3,7,7)))}b.drawImage(T,32,0,9,9,a-4,o-4,9,9),b.drawImage(k,21,0,7,7,a-3,o-3,7,7);for(let e=0;e<40;e++)b.drawImage(w,8*(16+e),0,8,8,0,40*e+20,8,8);for(let e=0;e<40;e++)b.drawImage(w,8*(33+e),0,8,8,40*e+20,0,8,8)},b=c.getContext("2d"),D=(()=>{let e,r,h,o,c,w,T,y,C,k,A,F,M,v,Y,G,L,$,b,D,P,H,B,U,x=()=>{e=[[]],r=[[]],U=[[]],h=0,o=5,c=20,w=20,T=0,y=0,C=0,k=17,A=55,O[7]=((e,r,h)=>{let o=I(),p=l(10,40),m=[f(0),f(1),f(2),f(3)];for(;m.length<p;){let e=[l(120,20),l(120,20)],t=u(e,m);n(e,t)>10&&m.push(e)}let c=[],R=m.slice(),O=R.pop(),w=O;for(;R.length;){let e=u(O,R),t=d(O,e,S,.33);c.push(...t),O=R.pop()}let T=d(O,w,S,.33);c.push(...T);for(let e=0;e<10;e++){let e=d(t(m),t(m),S,.33);c.push(...e)}let y=[];for(let e=0;e<m.length;e++)y.push(...a(m[e]));let C=(e=>{let t=[],l=[];for(let s=0;s<e.length;s++){let[r,h]=e[s];l[160*h+r]||(t.push(e[s]),l[160*h+r]=1)}return t})([...m,...y,...c]),k=i(C),[A,F]=(e=>{let t=160,l=[0,0];for(let s=0;s<e.length;s++){let[r,h]=e[s];r<t&&(t=r,l=[r,h])}return l})(k);E(o,k,(()=>2));let M=g([0,0],(([e,t])=>1===o[t][e]));E(o,M,(()=>0));let v=((e,t)=>t.slice().sort(((t,l)=>n(e,t)-n(e,l))))([A,F],m),Y=d([A,F],v[0],S,.33);c.push(...Y),(e=>{let t=0,r=s([0,3,6,9]);for(let s=0;s<160;s++)for(let h=0;h<160;h++)if(1===e[s][h]){let a=g([h,s],(([t,l])=>1===e[l][t])),o=0;a.length>5&&(o=t<4?r[t]:l(10),t++),E(e,a,o<3?()=>l(9)+2:o<6?()=>l(3)?l(4)+11:l(9)+2:o<9?()=>l(4)?l(3)+31:l(9)+2:()=>0)}})(o),N(o),E(o,c,(([e,t])=>o[t][e]>=17&&o[t][e]<20?o[t][e]:2)),E(o,y,(([e,t])=>o[t][e]>=17&&o[t][e]<20?o[t][e]:l(9)+2));let G=v.length-4,L=~~(.25*G),$=~~(.15*G),b=~~(.5*G),D=G-L-$-b,P=[];for(let e=0;e<L;e++)P.push(1);for(let e=0;e<$;e++)P.push(3);for(let e=0;e<b;e++)P.push(2);for(let e=0;e<D;e++)P.push(5);let H=[0,1,2,...s(P),4];for(let t=0;t<v.length;t++){let[s,a]=v[t],n=H[t];0===n?o[a][s]=38:1===n?(o[a][s]=20,e[160*a+s]=[0,0,0],e[0].push([s,a])):2===n?(o[a][s]=l(3)+28,r[160*a+s]=[],r[0].push([s,a])):3===n?(o[a][s]=36,h[0].push([s,a])):4===n&&(o[a][s]=34)}return[3,A,F,o,0,A,F]})(e,r,U),M=[O[7],O[1],O[0]],F="",v=[],L=0,H=-1,B=-1,D=[33],P=[],Y=[],G=0;let p=O[7],m=p[1],R=p[2];P[4*~~(R/40)+~~(m/40)]=1,Z(),z(),V(p)},K=()=>{M.pop(),M.length||x()},W=([e,t])=>{let s=l(2),r=l(2)+1,h=O[7],a=h[3][t][e],o=h[1],n=h[2];R(a)||((e,[t,l])=>{for(let s=0;s<e.length;s++)if(e[s][0]===t&&e[s][1]===l)return!0;return!1})(v,[e,t])||o===e&&n===t||v.push([e,t,s,r])},Z=()=>{for(;v.length<8;){let e=l(160),t=l(160);W([e,t])}},X=([e,t])=>{for(let l=0;l<v.length;l++){let s=v[l],r=s[0],h=s[1];if(s[3]>0&&e===r&&t===h)return 1}},z=()=>{let l=e[0].length,h=l+2,a=~~(7*l),o=~~(2*l),n=[];for(let e=0;e<h;e++)n.push(0);for(let e=0;e<a;e++)n.push(1);for(let e=0;e<50;e++)n.push(2);for(let e=0;e<o;e++)n.push(3);for(n=s(n);n.length;){let e=n.pop(),[l,s]=t(r[0]);r[160*s+l].push(e)}},q=(t=0)=>{if(c<1)M=[O[13]];else{if(60==++A&&(A=0,k++,t?(c<w&&c++,6===k&&(F="")):(6===k&&(F="",M.push(O[2])),18===k&&(F="i",M.push(O[3])),o>0?(o--,c<w&&c++):(c--,M.push(O[12])))),24===k){let t=e[0];for(let l=0;l<t.length;l++){let[s,r]=t[l];e[160*r+s][2]=0}k=0;let s=O[7];for(let e=0;e<160;e++)for(let t=0;t<160;t++)if(36===s[3][e][t]){let s=a([t,e]);for(let e=0;e<s.length;e++)l(3)||W(s[e])}}(()=>{for(let e=0;e<v.length;e++){let t=v[e],s=t[0],r=t[1],h=M[M.length-1],a=O[7],o=a[1],n=a[2],u=[s,r];if((k>=18||k<6)&&Math.random()<.66){let e=p([s,r],[o,n]);u[0]=e[0],u[1]=e[1]}else l(2)?u[0]=s+(l(3)-1):u[1]=r+(l(3)-1);let g=a[3][u[1]][u[0]];R(g)||X([u[0],u[1]])||o===u[0]&&n===u[1]||(t[0]=u[0],t[1]=u[1],u[0]<s&&(t[2]=1),u[0]>s&&(t[2]=0)),3===h[0]&&0===h[4]&&(k>=18||k<6)&&o===u[0]&&n===u[1]&&l(2)&&c>0&&t[3]>0&&c--}})()}},V=e=>{if(0===e[4]){let t=e[1],l=e[2];for(let e=-4;e<4;e++)for(let s=-4;s<4;s++){let r=t+s,h=l+e;n([t,l],[r,h])<4&&(Y[160*h+r]=1)}}},J=[()=>{for(;6!==k;)q(1)},()=>{$[0]=1,T--},()=>{let e=O[7],t=e[1],s=e[2],r=a([t,s]),h=0;for(let e=0;e<60;e++){q();for(let t=0;t<r.length;t++){let[l,s]=r[t];(k>=18||k<6)&&X([l,s])&&(h=1,e=60)}}if(h)M.push([1,["Under attack!"]]);else{let e=b.pop();if(3===e){let e=l(3)+2;M.push([1,[`Found ${e} food`]]),o+=e}else 0===e?(M.push([1,["Found keycard"]]),T++):1===e?(M.push([1,["Found chip"]]),y++):2===e&&(M.push([1,["Found backup"]]),C++)}},()=>{$[1]?M.push([2,["RSOS v3.27","--------------------",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42],["NOTES",28],["COMMS",29],["MAP",31]],0,"a"]):M.push([2,["RSOS v3.27","--------------------","NETWORK OFFLINE","","EMERGENCY MODE",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42]],0,"a"])},()=>{M.push([1,["Fixed 6 chips"]]),y-=6,$[1]=1},()=>{let e=l(3)+6;$[2]=1,o+=e,M.push([1,[`Synthesized ${e} food`]])},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","SYNTHESIZER"],e,0,"a"];$[2]?t[1].push("  CHARGING..."):(e.push(["RATIONS",26]),H>-1&&e.push(["MOD CHIPS",43]),B>-1&&e.push(["SATELLITE CHIP",44])),M.push(t)},()=>{let e=[2,["RSOS v3.27","--------------------","NOTES"],D.map((e=>[`ENTRY ${e}`,e])),0,"a"];M.push(e)},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","COMMS"],e,0,"a"];G?e.push(["DISTRESS SIGNAL",45]):t[1].push("  SATELLITE OFFLINE"),M.push(t)},()=>{},()=>{let e=O[7],t=[5,e[1],e[2],e[3],P];M.push(t)},()=>{C--;let e=D.length+33,s=l(8);if(D.length+33>37&&-1===H)M.push([1,["Recovered 1 synth","database entry"]]),H=0;else if(D.length+33>39&&-1===B)M.push([1,["Recovered 1 synth","database entry"]]),B=0;else if(s<3&&e<41)D.push(e),M.push(O[D.length+33-1]),M.push([1,["Recovered 1 note","database entry"]]);else{let l=[];for(let e=0;e<4;e++)for(let t=0;t<4;t++)P[4*e+t]||l.push([t,e]);if(l.length){let[e,s]=t(l);P[4*s+e]=1,J[10](),M.push([1,["Recovered 1 map","database entry"]])}else e<41?(D.push(e),M.push(O[D.length+33-1]),M.push([1,["Recovered 1 note","database entry"]])):M.push([1,["Backup already","restored"]])}},()=>{if($[1]){let e=[];for(let t=0;t<4;t++)for(let l=0;l<4;l++)P[4*t+l]||e.push([l,t]);let t=["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK ONLINE","SYNTHESIZE ONLINE"];-1===B&&t.push("  RESTORE BACKUPS"),t.push("NOTES ONLINE"),D.length<8&&t.push("  RESTORE BACKUPS"),G?(t.push("COMMS ONLINE"),t.push("  DISTRESS MODE ONLY")):t.push("COMMS OFFLINE"),t.push("MAP ONLINE"),e.length&&t.push("  RESTORE BACKUPS"),M.push([2,t,[],0,"a"])}else M.push([2,["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK OFFLINE","  FIX 6 CHIPS","SYNTHESIZE ONLINE","  EMERGENCY MODE","NOTES OFFLINE","COMMS OFFLINE","MAP OFFLINE"],[],0,"a"])},()=>{let e=l(2)+2;$[2]=1,H+=e,M.push([1,[`Synthesized ${e}`,"mod chips"]])},()=>{$[2]=1,B++,M.push([1,["Synthesized","satellite chip"]])},()=>{let e=U[0],t=O[7][3],l=0;for(let s=0;s<e.length;s++){let[r,h]=e[s];43!==t[h][r]&&(l=1)}M=l?[[1,["You send the","distress signal.","","As the rescue team","arrives monsters","pour out of","remaining portals","and kill them all!","","GAME OVER!"]]]:[[1,["You send the","distress signal.","","The rescue team","arrives and you","help them kill","the remaining","monsters.","","YOU WIN!"]]]}];return x(),[()=>[h,o,c,w,k,A,0===M[M.length-1][0]||1===M[M.length-1][0]?"g":5===M[M.length-1][0]?"a":2===M[M.length-1][0]?M[M.length-1][4]:F,M[M.length-1],v,T,y,C,Y,e,r,U,G,H,B],x,()=>`${k<10?"0":""}${k}:${A<10?"0":""}${A}`,q,(t,s)=>{let a,n=M[M.length-1];if(3===n[0]){if(q(),-1===t&&(h=1),1===t&&(h=0),t=n[1]+t,s=n[2]+s,(k>=18||k<6)&&0===n[4])for(let e=0;e<v.length;e++)v[e][0]===t&&v[e][1]===s&&v[e][3]>0&&(a=v[e]);if(c>0&&m([t,s])&&!R(n[3][s][t])&&!a&&(n[1]=t,n[2]=s),V(n),0===n[4]&&(20===n[3][s][t]&&(($=e[160*s+t])[0]?M.push((()=>{let e=I(),t=g([0,0],(([t,l])=>1===e[l][t]));return E(e,t,(()=>27)),e[19][18]=21,e[19][19]=22,e[19][20]=23,e[20][18]=2,e[20][19]=2,e[20][20]=2,e[21][18]=24,e[21][19]=25,e[21][20]=26,[3,20,20,e,1,20,20]})()):T?M.push(O[16]):M.push(O[15])),s===n[6]&&t===n[5]-1&&M.push(O[8]),a&&l(2)&&a[3]--,38!==n[3][s][t]||L||(L=1,M.push(O[14]),T++,o+=5,y+=3,C+=2),n[3][s][t]>=28&&n[3][s][t]<31&&((b=r[160*s+t]).length?M.push(O[18]):M.push([1,["Nothing here"]])),36===n[3][s][t]&&(H>0?(M.push([1,["Portal disabled!"]]),n[3][s][t]=43,U[160*s+t]=1,H--):H>-1?M.push([1,["Need mod chips"]]):M.push([1,["A strange portal"]])),34===n[3][s][t]&&(B>0&&!G?(M.push([1,["Fixed satellite!"]]),G=1,B--):B>-1&&!G?M.push([1,["Need satellite chip"]]):G||M.push([1,["Satellite is offline"]]))),1===n[4]){if(26===n[3][s][t]&&M.pop(),21===n[3][s][t]){let e=[["Use",21]],t=[2,["A computer",""],e,0,"g"];!$[1]&&y>5&&e.push(["Fix Chips",23]),$[1]&&C>0&&e.push(["Restore Backups",41]),e.length>1?M.push(t):J[3]()}23===n[3][s][t]&&(k>=17||k<6?M.push(O[9]):M.push(O[10]))}}},K,e=>{2===M[M.length-1][0]&&(M[M.length-1][3]=e)},()=>{if(2===M[M.length-1][0]){let e=M[M.length-1];if(!e[2].length)return void M.pop();let t=e[3],l=e[2][t][1];-1===l?K():4===O[l][0]?(M.pop(),J[O[l][1]]()):M.push(O[l])}}]})();document.onkeyup=e=>{let t=D[0]()[7];if(3===t[0]&&(e=>{65!==e.keyCode&&37!==e.keyCode||D[4](-1,0),68!==e.keyCode&&39!==e.keyCode||D[4](1,0),87!==e.keyCode&&38!==e.keyCode||D[4](0,-1),83!==e.keyCode&&40!==e.keyCode||D[4](0,1)})(e),0!==t[0]&&1!==t[0]&&5!==t[0]||32!==e.keyCode&&27!==e.keyCode&&13!==e.keyCode||D[5](),2===t[0]){let l=t;27===e.keyCode&&D[5](),87!==e.keyCode&&38!==e.keyCode||l[3]>0&&D[6](l[3]-1),83!==e.keyCode&&40!==e.keyCode||l[3]<l[2].length-1&&D[6](l[3]+1),32!==e.keyCode&&13!==e.keyCode||D[7]()}};let P=([e,t])=>{let l=D[0]()[7],s=c.getBoundingClientRect().width/10,h=~~((e-c.getBoundingClientRect().left)/s)-1,a=~~((t-c.getBoundingClientRect().top)/s)-1;if(3===l[0]){if(4===h&&4===a)return;if(h<0||a<0)return;let e=r(h,4),t=r(a,4),l=0,s=0;e>t?l=h>4?1:-1:e<t&&(s=a>4?1:-1),D[4](l,s)}if(0!==l[0]&&1!==l[0]&&5!==l[0]||D[5](),2===l[0]){let e=l,t=e[1].length%2?1:0,s=(e[1].length+t)/2,r=e[2].length,h=a-s+1;a<0&&D[5](),r||D[5](),h>=0&&h<r&&(h===e[3]?D[7]():D[6](h))}};c.ontouchend=e=>{e.preventDefault();for(let t=0;t<e.changedTouches.length;t++)P([e.changedTouches[t].clientX,e.changedTouches[t].clientY])},c.onclick=e=>{e.preventDefault(),P([e.clientX,e.clientY])},((...t)=>Promise.all(t.map(e)))("f.gif","t.gif","p.gif","s.png","c.gif").then((e=>{[w,T,y,C,k]=e,requestAnimationFrame(A)}))};s()</script>