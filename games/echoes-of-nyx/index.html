<!doctype html><html><title>Echoes of Nyx - js13kGames 2025</title><meta content="width=device-width" name=viewport><title></title><style>*,:after,:before{box-sizing:border-box}html{background:#333;height:100%;width:100%;font-family:Arial}body{position:relative;display:flex;height:100%;width:100%;margin:0;justify-content:center;align-items:center;color:#fff;overflow:hidden}canvas{border-radius:6px}</style><canvas></canvas><script>function t(){k=v(window.innerWidth,80),v(k,10,16)>v(window.innerHeight,90)&&(k=v(v(window.innerHeight,90),16,10)),X=W*M()}function s(t,s,e,i,h=3,a=y){t.save(),i.split("").reduce((i,n)=>{let r=f.indexOf(n);const o=z.findIndex(t=>t.includes(n))+1||5;return t.drawImage(a,0+(5*r+Math.floor((5-o)/2)),0,o,7,s+i,e+(","===n?h:"gjpqy".includes(n)?4*h/2:0),o*h,7*h),i+(o+1)*h},0),t.restore()}function e(t,s){return{width:(t.split("").reduce((t,s)=>t+(z.findIndex(t=>t.includes(s))+1||5),0)+t.length-1)*s,height:7*s}}function i(){const t=new et,s=new st(0,0,[!0,!0]);s.t=ys.h.i>vs?0:1;const e=new ht(0,0,"Choose a level",5,[!0,!1]),i=new st(0,0,[!0,!1]);let h=0;U.forEach((t,s)=>{const e=new st(0,0,[!1,!1],"row"),a=new ht(0,0,"World "+(s+1),2,[!1,!0]);e.add(a),t.forEach((t,i)=>{const a=new nt(0,0,`${s+1}-${i+1}`,[!1,!0],w,-1===ys.h.o.indexOf(h));h>ys.h.i&&(a.disabled=!0);const n=h;a.u=()=>{ys.h.restart(n)},e.add(a),h++}),i.add(e)});const a=new nt(0,0,"Back",[!0,!1]);return a.u=()=>{ys.h.l(os)},s.add(e,i,a),t.add(s),t}function h(){const t=new et,s=new st(0,0,[!0,!0],"column",50),e=new ht(0,0,C,12,[!0,!1]),h=new ht(0,0,"A game by Corentin Pillet",3,[!0,!1]),a=new st(0,0,[!0,!1]);return s.add(e,h,a),t.add(s),t.p=()=>{if(s.t=ys.h.i>vs?0:1,a.elements=[],(ys.h.i||ys.h.m)&&6>ys.h.i){const t=new nt(0,0,"Continue",[!0,!1]);t.u=()=>{ys.h.restart(ys.h.i)},a.add(t)}if(ys.h.i){const t=new nt(0,0,"Load level",[!0,!1]);t.u=()=>{ys.h.v[gs]=i(),ys.h.l(gs)},a.add(t)}const e=new nt(0,0,"New Game",[!0,!1]);e.u=()=>{ys.h.X=!1,ys.h.S=[],localStorage.setItem(P,"0"),ys.h.restart(),ys.h.M=!1},a.add(e),t.update()},t}async function a(t,s){for(;s>t.x;)t.update(I(),0,!0),await u(1e3/60);t.update(0)}async function n(t){await a(t,S()),ys.h.i++,ys.h.l(cs),ys.h.reset()}async function r(t){await a(t,S()/2-t.width/2)}function o(t,s="Continue",e=n,i=r){const h=new $(-2,1),a=new rs(-2,1),o=new As(0,0,E,1,!0),l=new et(!0);l.k=t=>{h.T(t),a.T(t),o.T(t)};const c=new st(0,0,[!0,!1]),d=new nt(0,0,s,[!0,!1]);return t.split("\n").forEach(t=>c.add(new ht(0,0,t,3,[!0,!1]))),c.add(d),c.y=(F()-c.P().height)/2,c.x=(S()-c.P().width)/2,d.u=async()=>await e(h,a),l.add(c),l.p=async()=>{l.Y=!0,h.x=-2,h.L.x=0,a.x=-2,a.L.x=0,c.t=ys.h.i>vs?0:1,c.elements=[],await i(h,a,o),await(async(t,s)=>{const e=s.split("\n");for(const s of e){const e=new ht(0,0,"",3,[!0,!1]);t.add(e);for(let t=0;s.length>t;t++)e.text=e.I+s[t],await u(40);t.elements.pop(),t.add(e.R())}})(c,t),c.add(d)},l}function l(t,s){return!(!t||!s)&&(!(s instanceof As)||s instanceof As&&s.O)&&s.x+s.width>t.x&&t.x+t.width>s.x&&s.y+s.height>t.y&&t.y+t.height>s.y}function c(t,s){return!(s.x>t.x||t.x>s.x+s.width||s.y>t.y||t.y>s.y+s.height)}function d(t){const s=p.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}function u(t){return new Promise(s=>setTimeout(s,t))}function g(t,s){return Math.floor(Math.random()*(s-t+1)+t)}function m(){return 0===parseFloat(localStorage.getItem(O)??""+j)?"Unmute":"Mute"}const p=document.querySelector("canvas"),f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789#-/ .,'",w=new Image(10,10);w.src="data:image/webp;base64,UklGRlIAAABXRUJQVlA4TEYAAAAvCUACECcgECBDNqgiJCBDtrCPQIAMKeDE/AcA+NOUwBCSJMnhGoOPYNfgHoLdiuh/QAH1FXn9I6/Go85SJ49GHv+gdgEF";const y=new Image(345,7);y.src="data:image/webp;base64,UklGRlABAABXRUJQVlA4TEQBAAAvWIEBEA8wHdMxIfMf8IAj27Zpa99X37Zt27ZtRc5s27ZtNICRbdu2jYdGRPRfYdo2jLp7ChfglZPG4yEgRQAAQNxztvsnEcumm33bexabLT16lx703n/HBgBagKFHgseHgBExIBjDTB5E0jTlg7nSo0zG2dIGTObZcnpMTSgqDAEmTzeSeLqHXOMO5QJ3s4sRJncibhonnRoMo2xr4WLiZBk8uiNCIgA45ytLVk0ms7ZV8U0uQ6MYYTyMOqBV0ul+GDlDK6CyIfZ4UD8cCMQDAImUZzyTZDo0EiGmAnf58W9MUy5Et2npZSLjbHtq6Yx4TgPqA0IUAAi30GHwYXEV2JkL4bwLy3WypZuZjO3kC6mM06XQGlAIoOCWySfZWI/PpohYiO003eR05GyXUiKWMS5bYv08nVek8G47bF75gA2ACgE=";const x=new Image(420,20);x.src="data:image/webp;base64,UklGRgwFAABXRUJQVlA4TAAFAAAvo8EJEFdgpm2bguhXlVnhFtG0dxoNtZAkQQux6Vqf0MFceAK/gjaSlDPB5OD823mU8fn5DwAA8P9rPRdOee0O4yLWSGQV0NH2P24b4X+D/59ZhlBHr31uMaWOkPUAcwN14xKzo1Q51yR+vx8gCfZMGdF/CG4kKZJyjzEyqnrpCektu1hySfCfcPFDOpsiuCH+Pojb8l2PWdHPl04jSzvxjp18pKWbZGE+ZrmC5wFm1fKS1ChZEUh6t4sj/B04Z9HSBFpmPg9BcJBeBnp4iObsr9fyCqk1KwLJfCYIXbczdE7zXzL8nglXwkZlllKN+DxLL2r6io+bm+JL2E21vCg/1z+sQ4A20EE0Y4ODKAftr8AUypCrEsRyLhn5WiPlhVtaUnzsNAt/Z9UNCXpxLaQldwhGWuaxCZjywlMoikVuDrN449kv1nGvNlHxqXkMdBMtu8eENoxAa9YEHoEtvQY1qjaSnLhb5ilop2L6npllT2nJqWgvopvgI/eD3RRBW1z016Bp5inxtBSBl5rJfanktNDey+sr3Y2mIFvy9CHEQskQxSy2JIhPuR/uxvT+L/lLvE1wKNCVJyRATHQPoUkHMmPCPJLuxlOQLYvaEuVPfqKYR/i8Bvob7iboc+daipYu6hpNkyDwWirsPYSnVXPA9Vrn+oq7VcN5SBY1/VQ0i9g15V5thNhTbt7rdqJukp72Ss2t5Kj15de1rZogyKWutPdVOs20u+q85eBuGacgWdT0U1EszKdYvAo+Zz5oCf5GuxG99CdPT4UL7w8pKPWFrOV/VjGtTMwHMY9auVHFKXRYcgRsxKV8Xof4dpqX8W4dgkz7J09KlJaTJUHQ0iyEtazstNb+tajuxlPosJCNm/AlR39DzB0Cr6FOPG4TMOfIa1IE5z3mgJLCykpOq7hmCD7T3GiIQE71+nyYU/N3ITOpEufyRZ0U24XB6gQQeBJpsNQo55VOVOCZvjzOU70iX2AsgYRB0pP1w7urTkpp5DQOIoB7qMEQQVsirlXkPE7YbQoCfH9qYjK2rStQ5X+UvyiSGYUrf7uKQlScvHbvbnZ5Cpzpzl6doNs0BB50wWGWwPnGKvisw0xSFEteu/7M0uAlhGpkLEVcE4a13nMQjLSluhGh+HyAVFLtpOzvepcdVXX7n395+57feCX+4OtH8w/XeH4D+a76/MYA8+wR/j5wjsKpCbSF+TwEwQflxfo99PMb7O+1xI2zLe3r8HsmXAkbd8yy3Rnx+SKnMDD9TZAeTfEl7DZ3tg/a33Z31wiGXG1BLMdtQb5mVzAv7N6S4mOni/B3xG5Tp9mQXvzul7tnE07lRiTlzxvPfjHtXuzBkhSfmsdAt6mzJOoGxVsW7VRM3xdm2bO1LHuIWW2JZHZyP9ht5ih/VPzT3aL68vQhxEL5BFHMYkuC+JT7oW5Tp+OPtlj23dSWKH/yE8U8wud3MTQjYp78y+SvEQSfMuVKbIliYT7BordYnO5Ggv563T6/gh9ZAroBwd3HCJMsavppUyzMp1j8TvA587Us4G+k29TvYQ3BCxJ8+fGxx7JEwEZcyud3Q3w7zRdwP8Q8c/pe9qF2WdDGLfha0P0g89yfYrdBAjXVG/BhPu/+eqRvQBynelW+wBjs3TJI+tmmz+fWbRICfP95X3wcfyx3K1AtT4LvLrbpk7bPrdskBCPPb2yB04qPgs9mz6t9fmPqJA==";const A=new Image(40,40);A.src="data:image/webp;base64,UklGRsYAAABXRUJQVlA4TLoAAAAvJ8AJED+gkG0EaP44B/VJHIeatpGY48/vxvuydwZkAhZLo6mabi8J5j8AAFsl2j6si81T4Ma2bTW5sf4FG0C0xgYgL/TeR2AAmvkvuziUEf2fAPwtxeDEkAGXGjI1GNkYWHWZYR8QdUk1AMwOx9b7HgDIkXRqltreqKRKDgDIfkceDCA90gNAXNoAIEfSwP12ZFOinud5c602qZ7K+A6e51XGi6ZE9VSWZbtEVT3P87i272BH1rmkAQA=";const b=15,T=new Image(15,b);T.src="data:image/webp;base64,UklGRlwAAABXRUJQVlA4TFAAAAAvDoADEB8gFkxxEL0TC6Y4iN6paduADYVE3o75jwL/IsAmtq04n+oroMbSbgITmKHCWfp9vVUmFiL6H1KseJqZQWfQA9z/9Omg/UX9qEaKFQ==";const v=(t,s,e=100)=>Math.round(t/e*s),E=40,W=v(E,10,16);let k=0,M=()=>Math.round(k/E),S=()=>E*M(),F=()=>W*M(),X=0;t();const I=()=>M()/5,B=()=>M()/10,G=()=>M()*E*2,D="#f7f6f0",V="#111111",C="Echoes of Nyx";document.title=C;const R=C+"-t",P=C+"-l",L=C+"-i",O=C+"-v",U=[[{j:1,N:1,b:[[-1,0,12,1,!0],[15,3,11,1,!1],[30,5,11,1,!0]],end:[37,6],U:[32,6]},{j:1,N:7,b:[[-1,6,8,1,!0],[-1,0,8,1,!1],[13,0,1,1,!0],[6,3,1,3,!1],[11,7,4,1,!1],[18,0,15,1,!1],[30,3,1,16,!1],[37,3,3,1,!0],[31,7,3,1,!1],[37,11,3,1,!0],[31,15,3,1,!1],[37,18,3,1,!0],[27,16,3,1,!1],[18,16,5,1,!0],[8,16,5,1,!1],[-1,18,5,1,!0]],end:[1,19],U:[1,1,!1]},{j:36,N:19,Z:!0,b:[[35,18,6,1,!0],[27,17,3,1,!1],[20,16,4,1,!0],[19,17,1,2,!0],[19,19,1,1,!1],[13,21,3,1,!1],[6,16,4,1,!0],[6,17,1,20,!0],[5,17,1,2,!1],[5,8,1,2,!0],[6,7,1,1,!0],[7,0,1,16,!0],[1,4,1,1,!1],[-1,0,8,1,!0]],end:[1,1],U:[6,8]},{j:37,N:1,Z:!0,b:[[32,0,8,1,!0],[27,3,1,1,!1],[20,5,1,1,!0],[19,1,2,1,!1],[8,0,5,1,!0],[8,1,1,3,!0],[4,0,4,1,!1],[11,4,1,4,!1],[15,10,8,1,!0],[9,14,4,1,!1],[25,11,1,1,!1],[28,13,1,1,!0],[31,15,1,1,!1],[36,17,4,1,!0],[-1,18,7,1,!0]],end:[37,18],U:[1,19]},{j:1,N:18,b:[[-1,17,4,1,!0],[6,7,1,40,!1],[7,5,1,40,!0],[-1,0,7,1,!1],[9,0,3,1,!0],[8,4,1,1,!1],[10,8,1,1,!0],[12,12,1,1,!1],[16,5,1,1,!0],[21,5,5,1,!1],[25,6,1,3,!1],[26,12,1,1,!0],[25,16,1,1,!1],[18,17,1,1,!0],[8,18,4,1,!1],[29,5,3,1,!0],[33,0,8,1,!1]],end:[37,1],U:[9,19,!1]}],[{j:2,N:1,b:[[-1,0,7,1,!0],[8,3,7,1,!1,10],[27,11,5,1,!0,0,-10],[27,8,5,1,!1],[7,14,4,1,!1,10],[0,14,4,1,!0],[24,11,3,1,!0,0,5],[32,18,9,1,!1]],end:[37,19],U:[1,15]},{j:1,N:19,b:[[-1,18,5,1,!0],[6,16,1,9,!1],[2,15,5,1,!1],[0,0,2,1,!1],[4,2,2,1,!0,8],[12,5,2,1,!1,-8],[16,13,1,2,!0,0,-4],[17,8,2,1,!0],[20,10,1,1,!1],[7,14,4,1,!1],[12,16,1,2,!0],[7,19,1,2,!1,7],[15,19,1,2,!0],[23,19,2,2,!1,-7],[25,19,2,1,!0,7],[34,6,1,17,!0],[35,6,1,17,!1],[35,22,1,3,!0],[36,22,4,1,!1],[36,21,4,1,!0],[31,12,3,1,!1],[33,3,2,1,!0],[36,0,4,1,!1]],end:[37,1],U:[37,23,!1]},{j:1,N:1,b:[[-1,0,7,1,!0],[23,2,7,1,!1,-14],[19,3,1,3,!1],[19,6,1,1,!0],[32,4,4,1,!0],[30,5,1,4,!1],[27,8,3,1,!1],[14,11,4,1,!0,7],[9,11,4,1,!1,-7],[6,15,1,1,!0],[12,17,2,1,!1],[16,17,3,1,!0,13],[24,18,1,2,!0],[24,20,1,1,!1],[35,18,6,1,!1]],end:[37,19],U:[34,5]},{j:1,N:1,b:[[-1,0,7,1,!0],[8,3,4,1,!1,8],[12,3,4,1,!0,8],[13,4,1,4,!1],[15,9,2,1,!0,0,4],[5,8,3,1,!1],[0,6,2,1,!0,0,6],[2,15,2,1,!1,0,-6],[5,17,4,1,!0],[23,0,1,1,!0],[10,18,3,1,!1,7],[33,4,1,30,!0],[32,0,2,1,!0],[35,8,1,1,!1],[36,14,1,1,!1],[35,0,2,1,!1,0,22],[37,21,4,1,!1]],end:[38,22],U:[23,1]},{j:1,N:22,b:[[-1,21,38,1,!0],[36,0,1,21,!0],[38,2,2,1,!0],[32,11,2,1,!1,0,-8],[27,0,2,1,!0],[24,0,2,1,!1,-7],[17,2,1,1,!0],[21,4,1,1,!1],[19,7,1,1,!0],[16,11,1,1,!1,6],[19,15,1,1,!0],[22,17,1,1,!1],[25,17,1,1,!0],[28,17,2,1,!1],[15,0,1,16,!1],[14,0,1,16,!0],[12,15,1,1,!1,0,-13],[9,0,1,1,!0,0,15],[6,18,1,1,!1,0,-18],[5,7,1,14,!1],[4,7,1,14,!0],[1,18,2,1,!0,0,-18]],end:[1,19],U:[29,18,!1]}],[{j:1,N:1,b:[[-1,0,8,1,!0],[8,8,5,1,!1],[17,0,4,1,!0,0,8],[36,0,5,1,!0]],V:[[-1,0,8,1,!0],[10,4,3,1,!1],[31,8,4,1,!1,-8]],end:[37,1],U:[10,9,!1]},{j:1,N:1,b:[[-1,0,8,1,!0],[9,1,3,1,!1,6],[9,7,2,1,!0],[22,1,1,1,!0],[25,10,3,1,!1,-8],[30,8,2,1,!0]],V:[[-1,0,8,1,!0],[16,8,1,1,!1],[25,1,2,1,!1,0,7],[37,0,3,1,!0],[30,0,2,1,!1],[-1,8,6,1,!1]],H:[1,9],J:[39,1]},{j:1,N:1,b:[[-1,0,5,1,!0],[0,4,2,1,!1,8],[19,10,2,1,!0,-8],[23,0,2,1,!1],[35,5,1,1,!0],[30,7,4,1,!1],[36,8,5,1,!0]],V:[[-1,0,1,1,!0],[8,6,2,1,!0,-8],[0,8,2,1,!1,8],[16,4,2,1,!0],[25,4,1,20,!1],[27,0,2,1,!0],[28,2,1,1,!1,10]],end:[37,9],U:[17,5]},{j:1,N:9,b:[[-1,8,5,1,!0],[-1,2,5,1,!0],[6,8,1,10,!1],[15,8,2,1,!0,-4],[16,0,1,1,!0],[25,0,3,1,!0],[28,3,1,1,!1],[32,5,2,1,!1],[40,1,1,1,!0]],V:[[-1,0,1,1,!0],[5,0,2,1,!1],[7,8,1,10,!0],[8,2,3,1,!1,0,6],[17,9,2,1,!1,4],[28,0,1,3,!0],[36,9,5,1,!0]],end:[37,10],J:[16,1]},{j:1,N:9,b:[[-1,8,5,1,!0],[1,5,5,1,!1],[7,5,1,20,!0],[7,0,2,1,!1,-4],[9,4,1,1,!1],[8,8,4,1,!1],[13,3,3,1,!0,5],[17,4,1,2,!0],[24,6,2,1,!1,0,-6],[32,3,1,1,!1],[36,0,5,1,!0]],V:[[-1,0,1,1,!0],[0,0,1,1,!0],[6,5,1,20,!1],[10,3,1,1,!0],[16,3,3,1,!1,5],[23,0,1,10,!1],[17,10,3,1,!0],[30,10,1,1,!1],[33,8,1,1,!0],[32,0,2,1,!0]],H:[37,1],U:[30,11,!1]}]],j=.5,z=[".'i",",lj","f","abcdeghknopqrstuxyz"];class q{set x(t){this.W=t}get x(){return Math.round(this.W*M())}set y(t){this.q=t}get y(){return Math.round(this.q*M())}set width(t){this.K=t}get width(){return Math.round(this.K*M())}set height(t){this.$=t}get height(){return Math.round(this.$*M())}constructor(t,s,e,i){this.x=t,this.y=s,this.width=e,this.height=i}}class N extends q{constructor(t,s,e=!0){super(t,s,2,2),this.O=e}T(t){t.save(),this.O||(t.filter="invert(1) opacity(0.4)"),t.drawImage(A,this.x,F()-this.y-this.height,this.width,this.height),t.restore()}}class J extends q{constructor(t,s,e=!0){super(t,s,.5,.5),this._=0,this.tt=0,this.st=!0,this.O=e}T(t){this._++,this._>6&&(this._=0,this.tt+=this.st?1:-1,3===this.tt?this.st=!1:-3===this.tt&&(this.st=!0)),this.O||(t.filter="invert(1) opacity(0.4)"),t.drawImage(w,this.x+.25*M(),F()-this.y-1.5*this.height+this.tt,this.width,this.height)}}class Q{constructor(t,s,e,i=!1,h,a,n=!1,r,o){this.it=!1,this.ht=!1,this.name=t,this.j=s,this.N=e,this.Z=i,this.et=a,this.ht=n,this.nt=h.map(([t,s,e,i,h,a,n])=>new As(t,s,e,i,h,a,n)),r&&(this.rt=r[2]??!0,this.U=new J(r[0],r[1],r[2])),o&&(this.end=new N(o[0],o[1],this.nt[this.nt.length-1].O))}reset(t=!1){this.nt.forEach(t=>t.reset()),this.end&&(this.end.O=this.nt[this.nt.length-1].O),this.it=t,this.U&&(this.U.O=this.rt)}ot(t){return!(!this.U||this.it||!l(t,this.U)||(this.it=!0,this.ht))}T(t){this.nt.forEach(s=>s.T(t)),this.U&&!this.it&&(t.save(),this.U.T(t),t.restore()),this.end?.T(t)}ct(){this.nt.forEach((t,s)=>0!==s&&(t.O=!t.O)),this.end&&(this.end.O=!this.end.O),this.U&&(this.U.O=!this.U.O)}}const Z=Symbol(),K=Symbol(),Y=Symbol(),H=Symbol(),_=Symbol();class $ extends q{constructor(t,s,e=!1){super(t,s,2,2),this.ut=!1,this.lt=!1,this.dt=!1,this.wt=!1,this.gt=Z,this.paused=!1,this.L={x:0,y:0},this.ft=0,this.yt=0,this.bt={[Z]:[0,7],[K]:[8,11],[Y]:[13,16,1],[H]:[17,18],[_]:[19,20]},this.wt=e,this._=0,this.gt=Z,this.At=this.bt[this.gt][0],this.vt=!0,this.Xt=new q(.5,0,1,1)}set x(t){this.W=t}get x(){return Math.round((this.W+this.K/2*(this.wt?1:0))*M()+this.L.x)}set y(t){this.q=t}get y(){return Math.round(this.q*M()+this.L.y)}get St(){return{x:this.x-this.Xt.x*(this.wt?1:-1),y:this.y-this.Xt.y,width:this.Xt.width,height:this.Xt.height}}Et(t){t&&(this.gt=t),this.At=this.bt[this.gt][0],this.vt=[K,Z].includes(this.gt),this.gt===_&&(this.xt=!0)}Mt(t){const{x:s,width:e}=this.St;return s+t+e<=S()&&s+t>=0}update(t=0,s=0,e=!1){let i=[H,_].includes(this.gt)?_:Z;t&&(e||this.Mt(t))&&(t-this.yt!==0&&(i=K),this.L.x+=t),s&&(this.L.y+=s,i=0>s?H:Y),this.gt!==i&&this.Et(i)}T(t,s=!0){if(s&&!this.paused){this._++;const[t,s,e]=this.bt[this.gt];this._>(e??s-t+1)&&(this._=0,this.At+1===s+1?(this.vt&&this.Et(),this.xt&&(this.Et(this.lt?K:Z),this.xt=!1)):this.At++)}t.save(),this.wt&&(t.translate(Math.round(this.width/2),0),t.scale(-1,1)),t.drawImage(x,20*this.At,20*this.ft,20,20,this.x*(this.wt?-1:1),F()-this.y-this.height,this.width,this.height),t.restore()}}class tt{constructor(t,s,e,i=[!1,!1]){this.u=()=>{},this.loaded=!1,this.kt=[!1,!1],this.t=-1,this.x=t,this.y=s,this.size=e,this.kt=i}set size(t){this.Ct=t}get size(){return Math.round(this.Ct*M()/40)}Dt(t){this.parent=t,this.Gt()}Gt(){if(!this.parent)return;const t=this.parent.P()??{width:S(),height:F()},s=this.P();this.height=s.height,this.width=s.width,this.kt[0]&&(this.x=this.parent.x+Math.round((t.width-this.width)/2)),this.kt[1]&&(this.y=this.parent.y+Math.round((t.height-this.height)/2)),this.Bt=!0}update(){this.parent?.update()}refresh(){this.parent?.refresh()}P(){return{width:0,height:0}}T(t,s){(s||-1!==this.t)&&(t.filter=`invert(${this.t})`)}load(){this.loaded=!0}Ft(){this.loaded=!1}}class st extends tt{constructor(t,s,e=[!1,!1],i="column",h=30){super("function"==typeof t?t():t,"function"==typeof s?s():s,0,e),this.elements=[],this.direction=i,this.gap=h}set gap(t){this.Tt=t}get gap(){return Math.round(this.Tt*M()/40)}get Bt(){return this.Pt}set Bt(t){this.Pt=!0,this.elements.forEach(s=>{s.Bt=t})}P(){const t=(this.elements.length-1)*this.gap;return{width:"row"===this.direction?this.elements.reduce((t,s)=>t+s.P().width,0)+t:Math.max(...this.elements.map(t=>t.P().width),0),height:"column"===this.direction?this.elements.reduce((t,s)=>t+s.P().height,0)+t:Math.max(...this.elements.map(t=>t.P().height),0)}}load(){this.loaded=!0,this.elements.forEach(t=>{t.load()})}Ft(){this.loaded=!1,this.elements.forEach(t=>{t.Ft()})}Gt(){super.Gt(),this.Yt()}Dt(t){super.Dt(t),this.Gt()}Yt(){this.elements.reduce((t,s)=>("column"===this.direction?(s.y=this.y+t,s.x=this.x,t+=s.P().height+this.gap):"row"===this.direction&&(s.x=this.x+t,s.y=this.y,t+=s.P().width+this.gap),t),0),this.elements.forEach(t=>t.Gt())}add(...t){for(const s of t)s.Dt(this),this.loaded&&s.load(),this.elements.push(s);this.Yt()}T(t,s){t.save(),super.T(t,s),this.elements.forEach(e=>{t.save(),e.T(t,s||1===this.t),t.restore()}),t.restore()}}class et{constructor(t=!1,s){this.x=0,this.y=0,this.elements=[],this.Lt=!1,this.It=!0,this.Y=!1,this.p=()=>{},this.k=()=>{},this.kt=[!0,!0],this.background=s,this.Y=t}get height(){return S()}get width(){return F()}P(){return{width:S(),height:F()}}update(){this.elements.forEach(t=>t.Gt())}add(...t){for(const s of t)s.Dt(this),s.Bt=!0,this.elements.push(s)}load(){this.Lt=!0,this.It=!0,this.p(),this.elements.forEach(t=>{t.load()})}refresh(){this.It=!0}Ft(){this.Lt=!1,this.It=!0,this.elements.forEach(t=>{t.Ft()})}T(t){this.Lt&&(this.It&&(!this.background&&Ts[ys.h.i]?(t.clearRect(0,0,S(),F()),t.drawImage(Ts[ys.h.i],0,0,S(),F())):this.background&&(t.save(),t.beginPath(),t.fillStyle=this.background,t.fillRect(0,0,S(),F()),t.closePath(),t.restore())),this.It=this.Y,this.elements.forEach(s=>{t.save(),this.Y&&(s.Bt=!0),s.T(t,!1),t.restore()}),this.k(t))}}class it extends tt{constructor(t,s,e,i,h=[!1,!1]){super(t,s,e,h),this.image=i,this.Gt()}P(){return{width:this.Rt?this.Rt.w:this.image.width*this.size,height:this.Rt?this.Rt.Qt:this.image.height*this.size}}T(t,s){this.Bt&&(t.save(),super.T(t,s),this.Rt?t.drawImage(this.image,this.Rt.x,this.Rt.y,this.Rt.w,this.Rt.Qt,this.x,this.y,this.Rt.w,this.Rt.Qt):t.drawImage(this.image,this.x,this.y,this.image.width*this.size,this.image.height*this.size),t.restore(),this.Bt=!1)}}class ht extends tt{constructor(t,s,e,i,h){super(t,s,i,h),this.text=e,this.Gt()}set text(t){this.I=t,this.parent?.update()}P(){return e(this.I,this.size)}T(t,e){this.Bt&&(t.save(),super.T(t,e),s(t,this.x,this.y,this.I,this.size),t.restore(),this.Bt=!1)}R(){const t=new Image;t.src=p.toDataURL("image/png");const s=new it(0,0,1,t,this.kt);return s.t=0,s.Rt={x:this.x,y:this.y,w:this.width,Qt:this.height+3*this.size},s}}const at=()=>Math.round(2*M()/40);class nt extends tt{constructor(t,s,e,i,h,a=!1,n=4){super(t,s,n,i),this.u=()=>{},this.zt=!1,this.disabled=!1,this.Ot=!1,this.jt=t=>{this.disabled||c(d(t),this)&&!this.Ot&&(this.Ot=!0,this.u())},this.Nt=t=>{if(this.disabled)return;const s=c(d(t),this);s&&!this.zt?(this.zt=!0,this.Bt=!0):!s&&this.zt&&(this.zt=!1,this.Bt=!0)},this.text=e,this.image=h,this.Ut=a,this.Gt()}set text(t){this.I=t,this.parent&&(this.parent.update(),this.parent.refresh())}load(){super.load(),p.addEventListener("mousedown",this.jt),p.addEventListener("mousemove",this.Nt)}Ft(){super.Ft(),this.Ot=!1,p.removeEventListener("mousedown",this.jt),p.removeEventListener("mousemove",this.Nt)}Zt(){const t=2*this.size,s=Math.round(this.size/100*80),i=e(this.I.toUpperCase(),s).width;return{Vt:i,Ht:s,Jt:i+(this.image?this.image.width*at()+t:0),spacing:t}}P(){const{Jt:t}=this.Zt();return{width:14*this.size+t,height:b*this.size}}T(t,e){if(!this.Bt)return;t.save(),super.T(t,e);const i=b*this.size,{Jt:h,Ht:a,Vt:n,spacing:r}=this.Zt();this.disabled&&(t.filter=`invert(${e?0:1})`),this.zt&&(t.filter=(e||1===this.t?"invert(1) ":"")+"brightness(0.8)");let o=7*this.size;if(t.drawImage(T,0,0,7,b,this.x,this.y,7*this.size,i),t.drawImage(T,7,0,1,b,this.x+7*this.size,this.y,h,i),t.save(),t.filter="brightness(0) invert(1)",s(t,this.x+o,this.y+Math.round((i-7*a)/2),this.I.toUpperCase(),a),t.restore(),o+=n,this.image){o+=r,t.save(),t.filter=t.filter.replace("invert(1)",""),t.filter=this.Ut?"brightness(0.3) opacity(0.3)":"invert(0)";const s=at();t.drawImage(this.image,this.x+o,this.y+Math.round((i-this.image.height*s)/2),this.image.width*s,this.image.height*s),o+=this.image.width*s,t.restore()}t.drawImage(T,8,0,7,b,this.x+o,this.y,7*this.size,i),this.Bt=!1,t.restore()}}const rt=new et,ot=new st(0,0,[!0,!0],"column");ot.t=1;const lt=new ht(0,0,"The End",12,[!0,!1]),ct=new nt(0,0,"Back to menu",[!0,!1]);ct.u=()=>{ys.h.l(os)},ct.t=0,rt.p=()=>{ot.t=ys.h.i>vs?0:1};const dt=new st(0,0,[!0,!1],"row"),ut=new it(8,6,3,w,[!1,!0]);ut.t=0;const gt=new ht(0,16,"0",5,[!1,!0]);dt.add(ut,gt),ot.add(lt,dt,ct),rt.add(ot);const mt=new et(!0,"transparent"),pt=new st(()=>Math.round(M()/2),()=>Math.round(M()/2),[!1,!1],"row",8),ft=new it(0,0,2,w,[!1,!0]),wt=new ht(0,0,"0",3,[!1,!0]);pt.add(ft,wt);const yt=new st(0,F()/4,[!0,!1]);mt.p=()=>{wt.t=ys.h.i>vs?0:1;const t=new it(0,0,3,bs,[!0,!0]);yt.elements=[],0===ys.h.i&&yt.add(t),yt.update()},mt.add(yt,pt);class xt{constructor(t,s){this.Wt=t,this.qt=s}}const At=[{A:29.13523509488062,B:30.867706328507754},{C:32.70319566257483,"C#":34.64782887210901,D:36.70809598967595,"D#":38.89087296526011,E:41.20344461410874,F:43.65352892912549,"F#":46.2493028389543,G:48.99942949771866,"G#":51.91308719749314,A:55,"A#":58.27047018976124,B:61.73541265701551}];for(let t=2;7>=t;t++)At.push(Object.fromEntries(Object.entries(At[t-1]).map(([t,s])=>[t,2*s])));At.push({C:4186.009044809578});class bt extends xt{constructor(t,s,e){super(t,s),this.Kt=e}$t(t,s,e,i){const h=this.Wt.createGain();return h.gain.setValueAtTime(this.Kt.volume,t),h.connect(this.qt),this._t(t,s,e,i).connect(h),this.ts.forEach(s=>s.start(t)),this.ts.forEach(e=>e.stop(t+s+this.Kt.ss.release)),this.ts}hs(t,s){const e=Array.from({length:Math.floor(t/2)},(t,e)=>s/Math.pow(2,e)),i=e.sort((t,s)=>t-s).reduce((t,s)=>[...t,-s],[]);return t%2!=0&&i.push(0),i.push(...e),i.sort((t,s)=>t-s)}es(t,s,e){const i=Object.keys(At[1]),h=i.indexOf(t),a=e%12;let n=(e-a)/12,r=(h+a)%i.length;return 0>h+a?n--:h+a>i.length&&n++,{key:i[0>r?i.length+r:r],ns:s+n}}rs(t,s,e,i,h=0,a=.1){if(t.cancelScheduledValues(e),t.setValueAtTime(h,e),!s)return;const{attack:n,cs:r=0,us:o=1,ls:l=1,release:c}=s,d=n>i?i:n;if(t.linearRampToValueAtTime(a,e+d),i-d>0){const s=d+r>i?i-d:d+r;if(t.linearRampToValueAtTime(a,e+s),i-s>0){const h=d+s+o>i?i-s:s+o;t.linearRampToValueAtTime(a*l,e+h),i-h>0&&t.linearRampToValueAtTime(a*l,e+i)}}t.linearRampToValueAtTime(h,e+i+c)}_t(t,s,e,i){const h=this.hs(this.Kt.ws.ds,this.Kt.ws.percent);this.Wt.createGain().gain.setValueAtTime(this.Kt.volume,t);const a=this.Wt.createGain();this.ts=[];for(let s=0;this.Kt.ws.ds>s;s++){const n=this.Wt.createOscillator();n.type=this.Kt.type,n.frequency.setValueAtTime(At[i][e],t),n.detune.setValueAtTime(h[s],t),n.connect(a),this.ts.push(n)}const n=this.Wt.createBiquadFilter(),{key:r,ns:o}=this.es(e,i,this.Kt.filter.gs);if(this.Kt.filter.ss&&this.Kt.filter.ps){const{key:e,ns:i}=this.es(r,o,this.Kt.filter.ps);this.rs(a.gain,this.Kt.ss,t,s,At[o][r],At[i][e])}else n.frequency.setValueAtTime(At[o][r],t);return this.rs(a.gain,this.Kt.ss,t,s),a.connect(n),n}}const Tt=.008,vt={volume:.4,type:"sawtooth",ss:{attack:.5,release:.09},filter:{gs:-6,ps:12,ss:{attack:.5,release:.09}},ws:{ds:7,percent:20}},Et={volume:.5,type:"sawtooth",ss:{attack:Tt,release:.09},filter:{gs:0,ps:24,ss:{attack:Tt,release:.09}},ws:{ds:7,percent:20}},Wt={attack:Tt,us:.25,ls:.42,release:.215},kt={volume:.5,type:"sine",ss:Wt,filter:{gs:2,ps:12,ss:Wt},ws:{ds:3,percent:7}},Mt={volume:.5,type:"sawtooth",ss:Wt,filter:{gs:5,ps:0},ws:{ds:2,percent:4}},St={attack:.024,us:.5,ls:.5,release:1},Ft={volume:.18,type:"sine",ss:St,filter:{gs:0,ps:24,ss:St},ws:{ds:12,percent:20}},Xt={volume:.17,type:"square",ss:St,filter:{gs:-12,ps:12,ss:St},ws:{ds:12,percent:6}};class It extends xt{constructor(t,s,e){super(t,s),this.volume=e,this.fs=this.Wt.createBuffer(1,11025,44100);const i=this.fs.getChannelData(0);for(let t=0;4096>t;t++)i[t]=Math.random()}$t(t){const s=this.Wt.createOscillator();s.frequency.value=54;var e=this.Wt.createGain(),i=this.Wt.createGain();const h=this.Wt.createGain();h.gain.value=0,h.gain.setValueAtTime(0,t+1e-4),h.gain.linearRampToValueAtTime(1,t+2e-4);const a=this.Wt.createBufferSource();a.buffer=this.fs,a.loop=!0;const n=this.Wt.createGain(),r=this.Wt.createBiquadFilter();r.type="bandpass",r.frequency.value=2760,r.Q.value=20,n.gain.setValueAtTime(1.0078740157480315,t),n.gain.exponentialRampToValueAtTime(1e-4,t+.01),i.gain.setValueAtTime(1e-4,t),i.gain.exponentialRampToValueAtTime(1,t+.004),i.gain.exponentialRampToValueAtTime(1e-4,t+.920708661417323),s.connect(i),a.connect(r),r.connect(n),i.connect(h),n.connect(h),h.connect(e),e.connect(this.qt),e.gain.setValueAtTime(this.volume,t),e.gain.linearRampToValueAtTime(this.volume,t+.2-Tt),e.gain.linearRampToValueAtTime(0,t+.2);const o=[s,a];return o.forEach(s=>s.start(t)),o.forEach(s=>s.stop(t+.2)),o}}class Bt extends xt{constructor(t,s,e){super(t,s),this.volume=e,this.fs=this.Wt.createBuffer(1,11025,44100);const i=this.fs.getChannelData(0);for(let t=0;4096>t;t++)i[t]=Math.random()}$t(t){const s=this.Wt.createGain();s.gain.setValueAtTime(this.volume,t),s.connect(this.qt);const e=this.Wt.createOscillator(),i=this.Wt.createGain(),h=this.Wt.createGain();h.gain.setValueAtTime(1,t),h.gain.exponentialRampToValueAtTime(.01,t+.2);const a=this.Wt.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(3e3,t),e.type="triangle",e.frequency.value=100,i.gain.value=0,i.gain.setValueAtTime(0,t),e.connect(i),i.connect(a);const n=this.Wt.createBufferSource(),r=this.Wt.createBuffer(1,4096,this.Wt.sampleRate).getChannelData(0),o=this.Wt.createBiquadFilter();o.type="highpass",o.frequency.setValueAtTime(100,t),o.frequency.linearRampToValueAtTime(1e4,t+.2);for(let t=0;4096>t;t++)r[t]=Math.random();n.buffer=this.fs,n.loop=!0,n.connect(o),o.connect(h),h.connect(a),a.connect(s);const l=[e,n];return l.forEach(s=>s.start(t)),l.forEach(s=>s.stop(t+.2)),l}}const Gt=[["D2:64"],["C2:64"]],Dt=[["D3:12","F3:2","D3:14","G3:2","F3:2","D3:12","F3:2","D3:18"],["C3:12","D3:2","C3:14","F3:2","G3:2","A3:12","F3:2","G3:18"]],Vt=[["D4:2","-:10","F4:2","D4:2","-:12","G4:2","F4:2","D4:2","-:10","F4:2","D4:2"],["C4:2","-:10","D4:2","C4:2","-:12","F4:2","G4:2","A4:2","-:10","F4:2","G4:2"]],Ct=["X","-:3","X","-:3","X","-","X","-","X","-:3","X","-:3","X","-:2","X","X","-","X","-","X","-:3"],Rt=[Ct.concat(Ct),Ct.concat(Ct)],Pt=["-:4","X","-:7","X","-:7","X","-:7","X","-:7","X","-:7","X","-:7","X","-:7","X","-","X"],Lt=[Pt,Pt],Ot=[["D4","-","D4","F4","-","F4","D4","-:9","D4","-","D4","F4","-","F4","D4","-:3","F4","-","C4","-","E4","-","D4","-","D4","F4","-","F4","D4","-:9","D4","-","D4","F4","-","F4","D4","-:3","G4","-","E4","-","F4"],["C4","-","C4","E4","-","E4","C4","-:9","C4","-","C4","E4","-","E4","C4","-:3","C4","-","E4","-","G4","-","E4","-","E4","F4","-","F4","E4","-:9","E4","-","E4","F4","-","F4","E4","-:3","G4","-","F4","-","E4"]],Ut=["-:2","X","-:3","X","X","-:2","X","-:3","X","-:4","X","-:4","X","-","X","-","X","-","X","-:3","X","-:3","X","X","-:2","X","-:3","X","-:4","X","-:4","X","X","X","-","X","-","X"],jt=[Ut,Ut],zt=[[],[]],qt={loop:{sub:[Gt,Gt,Gt,Gt,Gt,Gt,Gt].flat(),ys:[Dt,Dt,Dt,Dt,Dt,Dt,Dt].flat(),bs:[Vt,Vt,Vt,Vt,Vt,Vt,Vt].flat(),As:[zt,Rt,Rt,zt,Rt,Rt,Rt].flat(),vs:[Lt,Lt,Lt,zt,Lt,Lt,Lt].flat(),Xs:[jt,jt,jt,zt,jt,zt,jt].flat(),Ss:[zt,zt,Ot,Ot,Ot,Ot,zt].flat()},Es:14},Nt=["C3,E3,G3:16","B2,D3,G3:16","D3,F#3,A3:32"],Jt=[["D3,F#3,A3:16","E3,G3,C4:16","D3,F#3,A3:32"],Nt,["D3,F#3,A3:16","G3,B3,E4:16","F#3,A3,D4:32"],Nt],Qt={loop:{Ss:Jt,bs:Jt},Es:4},Zt=[2,3,4.16,5.43,6.79,8.21];class Kt extends xt{constructor(t,s,e){super(t,s),this.volume=e}$t(t){const s=this.Wt.createGain(),e=this.Wt.createBiquadFilter();e.type="notch",e.frequency.value=15e3;const i=this.Wt.createBiquadFilter();i.type="highpass",i.frequency.value=1e4,e.connect(i),i.connect(s),s.connect(this.qt);const h=[];return Zt.forEach(t=>{var s=this.Wt.createOscillator();s.type="square",s.frequency.value=40*t,s.connect(e),h.push(s)}),s.gain.setValueAtTime(1e-5*this.volume,t),s.gain.exponentialRampToValueAtTime(1*this.volume,t+.02),s.gain.exponentialRampToValueAtTime(.3*this.volume,t+.03),s.gain.exponentialRampToValueAtTime(1e-5*this.volume,t+.3),h.forEach(s=>{s.start(t),s.stop(t+.3)}),h}}const Yt={};Yt.game=qt,Yt.transition=Qt;class Ht{constructor(){this.xs={},this.Ms={},this.ks={},this.Cs={},this.Ds={},this.Gs=[],this.Bs=j,this.Wt=new AudioContext,this.Fs=this.Wt.createGain(),this.Fs.connect(this.Wt.destination),this.Fs.gain.setValueAtTime(this.volume,this.Wt.currentTime),this.Ds.sub=[new bt(this.Wt,this.Fs,vt)],this.Ds.ys=[new bt(this.Wt,this.Fs,Et)],this.Ds.bs=[new bt(this.Wt,this.Fs,kt),new bt(this.Wt,this.Fs,Mt)],this.Ds.As=[new It(this.Wt,this.Fs,.35)],this.Ds.vs=[new Bt(this.Wt,this.Fs,.15)],this.Ds.Xs=[new Kt(this.Wt,this.Fs,.1)],this.Ds.Ss=[new bt(this.Wt,this.Fs,Ft),new bt(this.Wt,this.Fs,Xt)]}get volume(){return this.Bs=parseFloat(localStorage.getItem(O)??""+j),this.Bs}set volume(t){this.Bs=t,localStorage.setItem(O,""+this.Bs),this.Fs.gain.cancelScheduledValues(this.Wt.currentTime),this.Fs.gain.value=this.volume}static get h(){return Ht.Ts||(Ht.Ts=new Ht),Ht.Ts}Ps(t){const s=Yt[t];this.xs[t]||(this.xs[t]=0),this.xs[t]===s.Es&&(this.xs[t]=0),this.Gs=[];for(const[e,i]of Object.entries(s.loop)){let s=0;i[this.xs[t]].forEach(t=>{const[i,h]=t.split(":"),a=parseFloat(h??"1")/4;let n=[i];1!==i.indexOf(",")&&(n=i.split(",")),n.forEach(t=>{if("-"!==t){const i=t.slice(0,-1),h=t.slice(-1),n=this.Wt.currentTime+60*s/100;this.Gs.push(...this.Ds[e].flatMap(t=>t.$t(n,60*a/100,i,parseInt(h))))}}),s+=a})}this.xs[t]++,this.ks[t]=Date.now()+9600,this.Ms[t]=setTimeout(()=>{this.Ps(t)},9600)}pause(){this.Ys||(this.Ys=!0,"running"===this.Wt.state&&(Object.entries(this.Ms).forEach(([t,s])=>{this.Cs[t]=this.ks[t]-Date.now(),clearTimeout(s)}),this.Wt.suspend()))}resume(){this.Ys&&(this.Ys=!1,"suspended"===this.Wt.state&&(Object.entries(this.Cs).forEach(([t,s])=>{this.ks[t]=Date.now()+s,this.Ms[t]=setTimeout(()=>{this.Ps(t)},s)}),this.Wt.resume()))}Ls(t){this.Is(),this.Ys=!1,this.Fs.gain.setValueAtTime(this.volume,this.Wt.currentTime),this.Wt.resume(),this.xs[t]=0,this.Ps(t)}Rs(t){return void 0!==this.Ms[t]}Is(){this.Fs.gain.setValueAtTime(0,this.Wt.currentTime),this.Gs.forEach(t=>t.stop(0)),Object.values(this.Ms).forEach(clearTimeout),this.Ms={}}}const _t=new et(!0,V+"ba"),$t=new st(0,0,[!0,!0]),ts=new ht(0,0,"Pause",3,[!0,!1]);ts.t=1;const ss=new st(0,0,[!0,!1],"row"),es=new st(0,0,[!0,!1]),is=new nt(0,0,"Resume",[!0,!1]);is.u=()=>{ys.h.Qs()};const hs=new nt(0,0,m(),[!0,!1]);hs.u=()=>{Ht.h.volume=Ht.h.volume?0:j,hs.text=m(),hs.update(),hs.Ot=!1};const as=new nt(0,0,"Quit",[!0,!1]);as.u=()=>{Ht.h.Is(),ys.h.M=!1,ys.h.zs=parseInt(localStorage.getItem(P)??"0"),ys.h.reset(),ys.h.l(os)};const ns=new nt(0,0,"Skip",[!0,!1]);ns.u=()=>{ys.h.Qs(),ys.h.Os()},$t.add(ts,ss,es),_t.add($t),_t.p=async()=>{es.elements=[],ss.elements=[];const t=new ht(0,0,`Level ${Math.floor(ys.h.i/5)+1}-${ys.h.i%5+1}`,3,[!1,!0]);t.t=1;const s=new st(0,0,[!1,!0],"row",8),e=new it(0,0,3,w,[!1,!0]),i=new ht(0,0,""+ys.h.m,3,[!1,!0]);i.t=1,s.add(e,i),ss.add(t,s),ss.update(),es.add(is,hs,as),es.add(ns),es.update()};class rs extends ${constructor(t=0,s=1,e=!1){super(t,s,!e),this.js=0,this.width=1.8,this.height=1.8,this.lt=!0,this.ft=1}Mt(){return this.L.x<S()&&this.x+this.width>0}Ns(t){90>this.js?(this.js++,90===this.js&&(this.wt=!this.wt)):super.update(t)}}const os=Symbol(),ls=Symbol(),cs=Symbol(),ds=Symbol(),us=Symbol(),gs=Symbol(),ms=Symbol(),ps=Symbol(),fs=Symbol(),ws=Symbol();class ys{constructor(){this.M=!1,this.stop=!1,this.dt=!1,this.keys={},this.v={},this.Us=os,this.Zs=[],this.Vs=[],this.Hs=new rs,wt.text=""+this.m,gt.text=`${this.m}/${U.flat().length}`}static get h(){return ys.Ts||(ys.Ts=new ys,ys.Ts.v={[os]:h(),[cs]:mt,[ds]:_t,[us]:rt,[gs]:i(),[ls]:o("At first, there was Chaos, a primordial and pure being.\nThen came Nyx, goddess of the night, and Erebus, god of darkness.\nNyx was close to her brother, but their bond evolved beyond mere kinship.\nAshamed of her actions, Nyx disguised herself as a cat and left Hell\nto ponder her choices.","Leave",async()=>{ys.h.M=!0,ys.h.l(cs)},async(t,s,e)=>{e.y=-1}),[ms]:o("In her feline disguise, she navigated through the shadows of the night.\nBut as she moved farther from her home, the sun began to rise.\nThe light was relentless, its rays a tangible, physical weight.\nShe was hungry and needed food to recover from the pain.\nYet for some obscure reason, she kept going, drawn toward the light."),[ps]:o("As the light filled the sky, Nyx saw a flicker of movement.\nBeyond the brightness, hidden in a mirror dimension,\na small white cat was peeking directly at her. Its presence felt magnetic.\nNyx pierced through the mirror to reach the little cat,\nbut at the sight of her, the white cat ran away."),[fs]:o("As she pushed forward to catch up,\nthe little ball of fur stopped and looked right at her.\nAs she approached, its gaze pierced through her soul.\nThe white cat began to shine brighter and brighter, but Nyx remained unfazed.\nAnd then it clicked, the white cat before her was her own daughter.\nShe had just created Aether, the personification of light itself.","Continue",async(t,s)=>{s.wt=!1,await a(t,24*M()),await Promise.all([a(t,S()+t.width),a(s,S()+s.width)]),ys.h.l(ws)},async(t,s)=>{s.x=22,s.wt=!0,await a(t,S()/2-t.width/2)}),[ws]:o("Nyx and her newborn daughter returned to their ethereal forms\nand left the mirror dimension to travel back to the Atlas.\nThere, Erebus was waiting for them and welcomed his daughter.\nThey both looked at Aether and thought the same thing:\nShe had just been born, and yet, she had come to restore equilibrium.","Continue",async(t,s)=>{await Promise.all([a(t,S()+t.width),a(s,S()+s.width)]),ys.h.l(us),ys.h.reset()},async(t,s)=>{s.wt=!1,s.x=-4,await Promise.all([a(t,S()/2-t.width/2),a(s,S()/2-t.width-s.width/2)])})},ys.Ts.l(os)),ys.Ts}get X(){return"true"===localStorage.getItem(L)}set X(t){localStorage.setItem(L,""+t)}get Js(){return this.Zs[this.i]}get Ws(){return this.Vs[this.i]}get qs(){return!!this.Ws?.nt.length}get o(){return JSON.parse(localStorage.getItem(R)??"[]")}set S(t){localStorage.setItem(R,JSON.stringify(t)),wt.text=""+this.m,gt.text=`${this.m}/${U.flat().length}`}get i(){return void 0===this.zs&&(this.zs=parseInt(localStorage.getItem(P)??"0")),this.zs}set i(t){t>parseInt(localStorage.getItem(P)??"0")&&localStorage.setItem(P,""+t),this.zs=t,wt.text=""+this.m,gt.text=`${this.m}/${U.flat().length}`;const s=this.Js.end??this.Ws.end,e=20>s.W;this.Hs=new rs(s.W+1.5*(e?1.5:-1),s.q,e)}get m(){return this.o.length}Ks(t){this.Zs=[],this.Vs=[],t.forEach(({name:t,j:s,N:e,Z:i,b:h,V:a,end:n,U:r,J:o,H:l},c)=>{this.Zs.push(new Q(t,s,e,i,h,!1,-1!==this.o.indexOf(c),r,n)),this.Vs.push(new Q(t,s,e,i,a??[],!0,-1!==this.o.indexOf(c),o,l))}),this.reset()}$s(){this.S=[...this.o,this.i]}restart(t=0){this.stop=!1,this.paused=!1,this.M=!0,this.i=t,this.X?this.l(cs):(this.l(ls),this.X=!0),this.Zs.forEach((t,s)=>{t.reset(this.o.includes(s))}),this.Vs.forEach((t,s)=>{t.reset(this.o.includes(s))}),this.reset()}reset(){this.keys={},this.paused=!1;const t=this.o.includes(this.i);this.Js.reset(t),this.Ws.reset(t),this._s=new $(this.Js.j,this.Js.N,this.Js.Z),this.ti=0,this.si=0,this.dt=!1,this.ii=0,this.radius=G()}l(t){t===cs?Ht.h.Rs("game")?Ht.h.resume():Ht.h.Ls("game"):t===os?Ht.h.Is():t!==gs&&t!==ds?Ht.h.Rs("transition")||Ht.h.Ls("transition"):Ht.h.pause(),this.v[this.Us].Ft(),this.Us=t,this.v[this.Us].load()}Os(){if(this.i+1===this.Zs.length)return this.hi(),!1;let t=0;const s=U.findIndex(s=>(t+=s.length,this.i+1===t));return-1!==s?this.l(0===s?ms:ps):(this.i++,this.v[this.Us].Ft(),this.v[this.Us].load(),this.reset()),!0}T(t){t.save();const s=this._s.St;t.fillStyle=V,t.fillRect(0,0,S(),F()),t.beginPath(),t.arc(s.x+s.height/2,F()-s.y-1.25*s.height+Math.max(0,this.radius)/2,Math.max(0,this.radius),0,2*Math.PI,!0),t.restore(),t.clip(),t.drawImage(Ts[ys.h.i],0,0,S(),F()),this.qs?(t.save(),t.filter="contrast(.7)",t.translate(0,1.5*F()),t.scale(1,-1),t.beginPath(),t.fillStyle="rgba(65, 188, 226, 0.2)",t.fillRect(0,0,S(),F()),t.closePath(),this.Ws.T(t),this._s.T(t),this.Hs.T(t),t.restore(),t.save(),t.translate(0,Math.round(-F()/2)),this.Js.T(t),this._s.T(t,!1),t.beginPath(),t.fillStyle="#c5cfdb69",t.fillRect(0,F(),S(),1),t.closePath(),t.restore()):(this.Js.T(t),this._s.T(t))}ei(t){t.imageSmoothingEnabled=!1,this.v[this.Us].T(t)}ni(){this.Js.ct(),this.Ws.ct()}ri(t){return this.Js.nt.concat(this.Ws.nt).filter(s=>l(t,s))}pause(t=!0){this.M&&(this._s.paused=!0,this.paused=!0,t&&this.l(ds))}Qs(){this._s.paused=!1,this.paused=!1,this.l(cs)}hi(){this.radius=1.5*M(),this.paused=!0,setTimeout(()=>{this.stop=!0,this.l(fs)},50)}}const xs=()=>Math.round(M()/8);class As extends q{constructor(t,s,e,i,h,a=0,n=0){super(t,s,e,i),this.oi=0,this.ai=0,this.ci=0,this.ui=!0,this.li=!1,this.L={x:0,y:0},this.j=this.x,this.O=h,this.di=h,this.wi=n,this.gi=a,this.ui=a>0,this.li=n>0}set x(t){this.W=t}get x(){return this.W*M()+this.L.x}set y(t){this.q=t}get y(){return this.q*M()+this.L.y}set gi(t){this.oi=t}get gi(){return(this.oi??0)*M()}set wi(t){this.ai=t}get wi(){return(this.ai??0)*M()}reset(){this.O=this.di,this.L={x:0,y:0},this.ci=0}update(){0!==this.gi&&((this.gi>0&&(0>this.L.x||this.L.x>=this.gi)||0>this.gi&&(this.L.x>0||this.gi>=this.L.x))&&(this.ui=!this.ui),this.ci=(this.ui?1:-1)*xs(),this.L.x+=this.ci),0!==this.wi&&((this.wi>0&&(0>this.L.y||this.L.y>=this.wi)||0>this.wi&&(this.L.y>0||this.wi>=this.L.y))&&(this.li=!this.li),this.L.y+=(this.li?1:-1)*xs())}T(t){t.save(),t.beginPath();const s=ys.h.i>vs?V+"20":D+"50";t.fillStyle=this.O?V:ys.h.i>vs?V+"10":D+"35",t.strokeStyle=this.O?"black":s,t.lineWidth=2,this.O||t.setLineDash([5]);let e=4;0===this.y&&(e=[4,4,0,0]);const i=F()-this.y-this.height;t.roundRect(this.x,i,this.width,this.height,e),t.stroke(),t.fill(),t.closePath(),t.restore()}}let bs,Ts=[],vs=4;const Es=800,Ws=v(Es,10,16),ks=["#061527","#1a1b1f","#333c66","#8c7586","#ca9a88","#e9c0b1ff","#5197cb","#e8f1f0","#fde4dbff"],Ms=[[0,0,1,1,1,2],[0,0,1,1,2],[0,1,1,2,3],[0,1,2,2,3,4],[0,1,2,3,4,5],[2,3,4,5],[2,3,4,5,8],[3,4,5],[7,8,5],[6,7,8],[6,7],[6,7],[6,7],[6,7],[6,7]],Ss=[];for(let t=0;400>t;t++)Ss.push([g(0,Es),g(0,Ws)]);const Fs=Symbol(),Xs=Symbol(),Is=Symbol(),Bs=Symbol();class Gs{constructor(){this.pi=!1,this.fi=0,this.interval=16,this.startTime=performance.now(),this.mi=this.startTime,this.currentTime=0,this.yi=0,this.game=ys.h,this.game.Ks(U.flat()),this.bi=p.getContext("2d")}Ai(){this.game.keys.Space||(this.pi=!1),this.game.keys.Escape&&[cs,ds].includes(this.game.Us)&&(this.game.paused?this.game.Qs():this.game.pause(),this.game.keys.Escape=!1),(this.game.keys.KeyA||this.game.keys.ArrowLeft)&&(this.game.si=-I(),this.game._s.wt=!0),(this.game.keys.KeyD||this.game.keys.ArrowRight)&&(this.game.si=I(),this.game._s.wt=!1),this.game.keys.Space&&this.game._s.ut&&!this.pi&&(this.game.ti=M()/5*5,this.pi=!0,this.game.ni())}Xi(){return-M()/4-this.game.ii}Si(){const t=this.game._s.St;this.game._s.ut&&(this.game.Js.ot(t)||this.game.Ws.ot(t))&&this.game.$s(),this.game.Js.nt.concat(this.game.Ws.nt).forEach(t=>t.update()),this.game.Ei=this.Xi()+this.game.ti;let s=0,e=0;this.game.Hs?.Ns(Math.round(I()/3)*(this.game.Hs.wt?-1:1));const i=(t=>{const s=t._s.St,e=t.ri({x:s.x+t.si,y:s.y+t.Ei,width:s.width,height:s.height});let i=[];if(e.length){const h=s.x+t.si,a=s.y+t.Ei;i=e.map(e=>{const i=c({x:h,y:a+s.height},e),n=c({x:h+s.width,y:a+s.height},e),r=c({x:h,y:a},e),o=c({x:h+s.width,y:a},e);let l;return o&&r||r&&!i&&0>t.Ei||o&&!n&&0>t.Ei?l=Fs:n&&i||i&&!r&&t.Ei>0||n&&!o&&t.Ei>0?l=Xs:o&&n||o&&t.Ei>0||n&&0>t.Ei?l=Is:(r&&i||r&&t.Ei>0||i&&0>t.Ei)&&(l=Bs),{xi:e,Mi:l}})}return{top:i.find(t=>t.Mi===Xs),bottom:i.find(t=>t.Mi===Fs),right:i.find(t=>t.Mi===Is),left:i.find(t=>t.Mi===Bs)}})(this.game);if(!i.bottom&&0>this.game.Ei||!i.top&&this.game.Ei>0){const t=this.game._s.ut&&0>this.game.Ei;t?this.fi++:this.fi=0,(!t||t&&this.fi>3)&&(s+=this.game.Ei,this.game.Ei>0&&this.game._s.ut&&(s=0),this.game._s.ut=!1,this.game.ii+=M()/152)}else{if(i.bottom){const s=i.bottom.xi;e+=s.ci,this.game._s.yt=s.ci,this.game._s.L.y+=s.y+s.height-t.y,this.game._s.ut=!0,this.game.ii=0}i.top&&(this.game._s.L.y+=t.y+t.height-i.top.xi.y,this.game.ti=0)}!i.right&&this.game.si>0||!i.left&&0>this.game.si?e+=this.game.si:(i.right&&(this.game._s.L.x+=i.right.xi.x-(t.x+t.width)),i.left&&(this.game._s.L.x+=i.left.xi.x+i.left.xi.width-t.x)),this.game._s.update(e,s),this.game.si=0>this.game.si?Math.min(0,this.game.si+B()):Math.max(0,this.game.si-B()),this.game.ti=Math.max(0,this.game.ti-M()/20)}T(){this.bi.save(),this.bi.imageSmoothingEnabled=!1,this.bi.clearRect(0,0,S(),F()),this.game.T(this.bi),this.bi.restore()}ei(){this.bi.save(),this.game.ei(this.bi),this.bi.restore()}ki(t){const s=()=>{this.game.radius<G()&&(this.game.radius+=M()/1.72,setTimeout(s.bind(this)))},e=()=>{0>this.game.radius?t()&&(this.game.radius=0,setTimeout(s,150)):(this.game.radius-=M()/1.58,setTimeout(e.bind(this)))};e()}Ci(){const t=this.game._s.St;this.game.Js.end?.O&&l(t,this.game.Js.end)||this.game.Ws.end?.O&&l(t,this.game.Ws.end)?(this.game.pause(!1),this.game.v[this.game.Us].Ft(),this.ki(()=>(this.fi=0,this.game.Os()))):2*-t.height>t.y&&(this.fi=0,this.game.reset())}loop(t){this.Ai(),this.currentTime=t,this.yi=this.currentTime-this.mi,this.yi>this.interval&&(this.mi=this.currentTime-this.yi%this.interval,this.game.M&&!this.game.stop&&(this.game.paused||this.Si(),this.game.M&&[cs,ds].includes(this.game.Us)&&this.T(),this.game.paused||this.Ci()),this.ei()),requestAnimationFrame(this.loop.bind(this))}}window.addEventListener("keydown",t=>ys.h.keys[t.code]=!0),window.addEventListener("keyup",t=>ys.h.keys[t.code]=!1),(async()=>{if(!p)return;p.style.display="none",await new Promise(t=>{const i=p.getContext("2d");if(!i)return;p.width=Es,p.height=Ws,i.save();const h=[];Ms.forEach((t,s)=>{((t,s)=>{const e=Ms[s].map((t,e)=>[1/Ms[s].length*e,ks[t]]),i=t.createLinearGradient(400,0,400,Ws);e.forEach(([t,s])=>{i.addColorStop(t,s)}),t.save(),t.beginPath(),t.fillStyle=i,t.fillRect(0,0,Es,Ws),t.closePath(),s>7||(t=>{t.save(),Ss.forEach(([s,e])=>{t.fillStyle="#ffffff4d",t.fillRect(s,e,1,1)}),t.restore()})(t),t.restore()})(i,s);const e=new Image;e.src=p.toDataURL("image/png"),h.push(e),i.clearRect(0,0,Es,Ws)}),Ts=h,y.onload=()=>{const h="Use the Arrow Keys to move and Space to jump.\nEach jump switches the platform state.\nPress Escape to pause or skip the level".split("\n"),a=h.map(t=>e(t,1));p.width=Math.max(...a.map(({width:t})=>t)),p.height=a.reduce((t,{height:s})=>t+s+8,0)-5,i.filter="invert(1)",h.reduce((t,e,h)=>(s(i,0==h?0:Math.round((p.width-a[h].width)/2),t,e,1),t+a[h].height+8),0),bs=new Image,bs.src=p.toDataURL("image/png"),i.clearRect(0,0,Es,Ws),i.filter="none",i.restore(),t(1)}}),p.style.display="flex",p.height=X,p.width=S(),window.addEventListener("resize",()=>{t(),p.height=X,p.width=S(),ys.h.radius=G(),ys.h.v[ys.h.Us].update(),ys.h.v[ys.h.Us].It=!0});const i=new Gs;window.requestAnimationFrame(i.loop.bind(i))})()</script>