<!doctype html><title>Nexus overload</title><style>#menu,#stage,body{background:#181818}#container,#menuHead{width:100%;position:absolute}#container,#menu,#menuHead,#stage,.footer,.menuButtons{position:absolute}body,html{margin:0;padding:0;overflow:hidden;font-family:Consolas,monaco,monospace;font-weight:400;text-align:left;cursor:default}#menuHead,.lvlData,.menuButton{text-align:center}body{min-height:100vh;min-width:100%}#container{top:0;left:0;height:100vh}#menu,#stage{top:0;left:0;width:1500px;height:1080px;transition:background .5s;-webkit-transition:background .5s;-moz-transition:background .5s}#menu{transition:opacity .5s,visibility .5s;-webkit-transition:opacity .5s,visibility .5s;-moz-transition:opacity .5s,visibility .5s;visibility:hidden;opacity:0}.mapNode,.menuButton{transition:background .25s}#menu.show{visibility:visible;opacity:1}#menuHead{top:80px;height:100px;line-height:170px;font-size:170px;color:#fff}.menuButtons{top:350px;left:calc(50% - 365px);width:730px;min-height:100px}.menuButton{margin:0 0 40px;display:block;width:730px;height:140px;line-height:90px;font-size:80px;color:#fff;-webkit-transition:background .25s;-moz-transition:background .25s}.menuButtonSubText{line-height:50px;font-size:20px;color:grey;text-align:center}.endData{width:730px;height:360px}.footer,.lvlData{height:100px;font-size:35px}.lvlData{width:730px;margin:0 0 20px;line-height:40px}.btnGreen{box-shadow:0 0 0 4px #24ff96}.btnBlue{box-shadow:0 0 0 4px #3effec}.btnOrange{box-shadow:0 0 0 4px #ff945f}.btnRed{box-shadow:0 0 0 4px #ff5c87}.btnDarkGrey{box-shadow:0 0 0 4px #282828}.btnGrey{box-shadow:0 0 0 4px grey}.btnWhite{box-shadow:0 0 0 4px #fff}.txtGreen{color:#24ff96}.txtBlue{color:#3effec}.txtOrange{color:#ff945f}.txtRed{color:#ff5c87}.txtWhite{color:#fff}.fillGreen{background:#24ff96}.fillWhite{background:#fff}.menuButton.btnGreen:hover{background:#005627}.menuButton.btnBlue:hover{background:#004238}.menuButton.btnOrange:hover{background:#6b2600}.mapNode.btnGrey.next:hover{background:grey}.lastMapNode.btnRed.next:hover{background:#ff5c87}.mapNode.btnBlue.next:hover{background:#3effec}.mapNode.btnOrange.next:hover{background:#ff945f}.footer{top:950px;width:100%;line-height:35px;color:#ff5c87;text-align:center}#endHead,#endStats,#mapLayer,.ugHead{width:700px;left:calc(50% - 350px);position:absolute;text-align:center}#map,#mapLines{position:absolute;top:460px;left:calc(50% - 365px);width:730px;height:400px}#endHead,#mapLayer,.ugHead{top:300px;font-size:30px}#endStats{top:380px;font-size:25px;line-height:40px}.ugHead{top:290px}#mapLegend{position:absolute;top:380px;left:calc(50% - 350px);width:730px;height:40px}.legendBlock,.legendText{height:30px;vertical-align:middle;line-height:30px;display:inline-block}.legendBlock{width:30px;font-size:20px;text-align:center;left:0;margin:0 10px 0 0}.legendText{width:125px;font-size:18px;margin:0}.legendText:last-child{position:absolute;top:40px;left:0;width:700px}.mapCol{position:absolute;top:0;left:0;width:130px;height:400px;margin:0;padding:0}.mapNode,.mapNode.row1{top:10px}.mapCol:nth-child(2){left:130px}.mapCol:nth-child(3){left:260px}.mapCol:nth-child(4){left:390px}.mapCol:nth-child(5){left:520px}.mapCol:last-child{left:650px;width:80px}.lastMapNode,.mapNode{left:10px;width:60px;position:absolute}.mapNode{height:60px;-webkit-transition:background .25s;-moz-transition:background .25s}.mapNode.row2{top:90px}.mapNode.row3{top:170px}.mapNode.row4{top:250px}.mapNode.row5{top:330px}.lastMapNode{top:10px;height:380px;transition:background .25s;-webkit-transition:background .25s;-moz-transition:background .25s}#playArea{position:absolute;top:0;left:0;width:1500px;height:1080px}.hpBar,.room,.xpBar{left:150px;width:1200px}.border{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;border-style:solid;border-color:#000;border-width:1px}.room{cursor:none;position:relative;top:115px;height:850px}.hpBar,.xpBar{position:absolute;background:#444}.hpBar{top:40px;height:30px}.xpBar{top:1000px;height:20px}#hpInd,#xpInd{float:left;width:0;transition:width .5s;-webkit-transition:width .5s;-moz-transition:width .5s}#hpInd{height:30px;background:#54ba56}#xpInd{height:20px;background:#2daa9b}#hpTxt,#xpTxt{position:absolute;top:0;width:1200px;color:#fff;text-align:center}#hpTxt{font-size:25px;line-height:30px}#xpTxt{font-size:15px;line-height:20px}.hidden{visibility:hidden}.noselect{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#story,#tutorial{position:absolute;top:175px;left:calc(50% - 500px);width:1000px;text-align:center}.clickHere{font-size:16px;line-height:30px;text-align:center}#story{top:875px;font-size:20px}.tHead{font-size:60px;line-height:70px;margin-bottom:20px}.tTxt{font-size:25px}.tLeft,.tRight{position:relative;display:inline-block;width:450px}.tLeft{float:left}.tRight{float:right}.tKey{position:absolute;font-size:30px;width:50px;height:50px;text-align:center;line-height:50px}.tKey:first-child{top:20px;left:200px}.tKey:nth-child(2){top:90px;left:130px}.tKey:nth-child(3){top:90px;left:200px}.tKey:nth-child(4){top:90px;left:270px}</style><div id=container><div id=stage class=hidden><div id=playArea><div id=tutorial class=noselect></div><div id=story class="txtGreen noselect"></div><canvas id=mainCanvas class="room btnGrey"></canvas><div class=hpBar><div id=hpInd></div><div id=hpTxt></div></div><div class=xpBar><div id=xpInd></div><div id=xpTxt></div></div></div><div id=menu class=noselect><div id=menuHead></div><div id=mainMenu class=hidden><div class=menuButtons><div id=record class="menuButton hidden"></div><div class="menuButton btnGreen" onclick="Menu.open()&&(Network.highestLevel>1&&(Network.tutorial=!1),Game.start())">Play<div class="menuButtonSubText txtGreen">The little packet that could.</div></div><div id=tutButton class="menuButton btnBlue hidden" onclick="Menu.open()&&(Network.tutorial=!0,Game.start())">Tutorial<div class="menuButtonSubText txtBlue">Replay through the tutorial level.</div></div></div><div class=footer>A game by Jeremy de Reuck</div></div><div id=endScreen class=hidden></div><div id=upgradeMenu class=hidden></div><div id=mapMenu class=hidden><div id=mapLayer class=txtWhite></div><canvas id=mapLines></canvas><div id=map class=btnGrey></div><div id=mapLegend><div class="legendBlock btnGreen fillGreen"></div><div class="legendText txtGreen">You</div><div class="legendBlock btnBlue"></div><div class="legendText txtBlue">Proxy</div><div class="legendBlock btnOrange txtOrange">+</div><div class="legendText txtOrange">Firewall</div><div class="legendBlock btnRed txtRed">+</div><div class="legendText txtRed">Router</div><div class="legendText txtWhite">+ Gain an additional upgrade when completing this node</div></div></div><div id=pauseMenu class=hidden><div id=endHead class=txtWhite></div><div id=endStats class=txtGreen></div><div class=menuButtons><div id=resumeBtn class="menuButton btnGreen" onclick=Menu.open()&&Menu.toggle()>Resume<div class="menuButtonSubText txtGreen">Get back in the fight</div></div><div class="menuButton btnBlue" onclick=Menu.open()&&Game.start()>Restart<div class="menuButtonSubText txtBlue">Let's try this again!</div></div><div class="menuButton btnOrange" onclick='Menu.open()&&Menu.toggle("main")'>Main menu<div class="menuButtonSubText txtOrange">Thatâ€™s enough for now thanks</div></div></div></div></div></div></div><script>function angleBetween(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI}function degToRad(t){return t/180*Math.PI}function randomInt(t,e){return Math.floor(random(t,e+.99999))}function random(t,e){return t+(e-t)*Math.random()}function getAreaOfTriangle(t,e,i){return Math.round(Math.abs(t.x*e.y+e.x*i.y+i.x*t.y-t.x*i.y-i.x*e.y-e.x*t.y)/2*100)/100}function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){var t,e,i,s,a,n,h,r,o,l,u,c;this._params=new SfxrParams,this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),n=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(u=.5-t.n/2,c=5e-5*-t.o),r=1+t.l*t.l*(t.l>0?-.9:10),o=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(d,m){var p=this._params,y=1!=p.s||p.v,g=p.v*p.v*.1,v=1+3e-4*p.w,f=p.s*p.s*p.s*.1,w=1+1e-4*p.t,b=1!=p.s,x=p.x*p.x,M=p.g,k=p.q||p.r,T=p.r*p.r*p.r*.2,S=p.q*p.q*(p.q<0?-1020:1020),P=p.p?32+((1-p.p)*(1-p.p)*2e4|0):0,L=p.d,E=p.j/2,j=p.k*p.k*.01,O=p.a,N=t,I=1/t,H=1/e,C=1/i,R=5/(1+p.u*p.u*20)*(.01+f);R>.8&&(R=.8),R=1-R;for(var D,G,A,q,F,B,W=!1,X=0,U=0,K=0,V=0,Y=0,_=0,z=0,J=0,Q=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<m;et++){if(W)return et;if(P&&++Q>=P&&(Q=0,this.reset()),l&&++o>=l&&(l=0,s*=r),(s*=n+=h)>a&&(s=a,M>0&&(W=!0)),G=s,E>0&&(Z+=j,G*=1+Math.sin(Z)*E),(G|=0)<8&&(G=8),O||((u+=c)<0?u=0:u>.5&&(u=.5)),++U>N)switch(U=0,++X){case 1:N=e;break;case 2:N=i}switch(X){case 0:K=U*I;break;case 1:K=1+2*(1-U*H)*L;break;case 2:K=1-U*C;break;case 3:K=0,W=!0}k&&((A=0|(S+=T))<0?A=-A:A>1023&&(A=1023)),y&&v&&((g*=v)<1e-5?g=1e-5:g>.1&&(g=.1)),B=0;for(var it=8;it--;){if(++z>=G&&(z%=G,3==O))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(O){case 0:F=z/G<u?.5:-.5;break;case 1:F=1-z/G*2;break;case 2:F=.225*(((F=1.27323954*(q=6.28318531*((q=z/G)>.5?q-1:q))+.405284735*q*q*(q<0?1:-1))<0?-1:1)*F*F-F)+F;break;case 3:F=tt[Math.abs(32*z/G|0)]}y&&(D=_,(f*=w)<0?f=0:f>.1&&(f=.1),b?(Y+=(F-_)*f,Y*=R):(_=F,Y=0),V+=(_+=Y)-D,F=V*=1-g),k&&($[J%1024]=F,F+=$[(J-A+1024)%1024],J++),B+=F}B*=.125*K*x,d[et]=Math.max(-1,Math.min(1,B))||0}return m}}function jsfxr(t,e){var i,s;return synth._params.setSettings(t),s=new Float32Array(synth.totalReset()),synth.synthWave(s,s.length),(i=e.createBuffer(1,s.length,44100)).getChannelData(0).set(s),i}function Bullet(t,e,i,s,a){this.x=t,this.y=e,this.angle=i,this.damage=s,this.colour="",this.vx=0,this.vy=0,this.friendly=void 0===a||!a,this.passThrough=!1,this.hitAccuracy=2,this.kill=!1,this.init(),this.calcVelocity()}function createLevel(t,e){return{map:t,connections:e}}function Enemy(t,e,i){this.mod=i,this.x=t,this.y=e,this.vx=0,this.vy=0,this.distanceToPlayerSquared=0,this.speed=0,this.range=0,this.xp=0,this.maxHp=10,this.hp=10,this.radius=14,this.colour="#FF9D00",this.dCol=["#282828","#333","#383838"],this.angle=0,this.damage=0,this.alive=!0,this.attackSpeed=1,this.attackTimer=Date.now(),this.spawnTimer=Date.now()+randomInt(-1e3,1e3),this.spawnTime=5e3,this.stopTimer=null,this.spawned=0,this.difAdj=1,this.dc=0,this.init()}function Crawler(t){this.parentObj=null,this.type=t}function Pulser(t){this.parentObj=null,this.type=t}function Particle(t,e,i){this.x=t,this.y=e,this.kill=!1,this.angle=0,this.radius=randomInt(1,5),this.speed=15,this.colour=i}var requestAnimation=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,AudioContext=window.AudioContext||window.webkitAudioContext,Point=function(t,e){this.x=t||null,this.y=e||null};Point.prototype={distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}};var synth=new SfxrSynth,Game={stage:document.querySelector("#stage"),playArea:document.querySelector("#playArea"),canvas:document.querySelector("#mainCanvas"),ctx:null,width:1500,height:1080,offsetTop:0,offsetLeft:0,canvasWidth:1200,canvasHeight:850,canvasTop:115,canvasLeft:150,aspectRatio:1,clientAspectRatio:1,scale:1,paused:!0,pausedFrom:null,timerAdjust:0,shakeEnd:0,shaking:!1,shakeStr:0,glitchCount:0,glitching:!1,init:function(){this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.setScale(),window.onresize=function(){Game.setScale()},window.onblur=function(){Menu.open()||Menu.toggle("pause")},Network.init(),Input.init(),Player.init(),Network.start(),Menu.toggle("main"),this.loop()},start:function(){Player.reset(),Room.reset(),Room.story=1,Enemies.clear(),Bullets.totalBullets=0,Enemies.totalKills=0,this.timerReset(),Network.level=1,Network.goToNextLevel=!1,Network.start(),Player.availableUG>0&&!Network.tutorial?Menu.toggle("upgrade"):Menu.toggle("map")},pause:function(){this.paused||(this.paused=!0,this.pausedFrom=Date.now())},unpause:function(){this.paused&&(this.paused=!1,null!==this.pausedFrom&&(this.timerAdjust=Date.now()-this.pausedFrom,this.pausedFrom=null))},updateTimer:function(){return this.timerAdjust},timerReset:function(){this.pausedFrom=null,this.timerAdjust=0},screenShake:function(t,e){this.shakeEnd=Date.now()+e,this.shaking=!0,this.shakeStr=Math.round(t/2)},shakeScreen:function(){this.shaking&&(this.playArea.style.transform="translate("+randomInt(-this.shakeStr,this.shakeStr)+"px,"+randomInt(-this.shakeStr,this.shakeStr)+"px)",this.shakeEnd+=this.updateTimer(),Date.now()>=this.shakeEnd&&(this.shakeStr>.5?this.shakeStr-=.1*this.shakeStr:(this.playArea.style.transform="translate(0px, 0px)",this.shaking=!1,this.shakeStr=0)))},calcScale:function(){this.aspectRatio=this.width/this.height,window.innerWidth/window.innerHeight>=this.aspectRatio?(this.scale=window.innerHeight/this.height,this.offsetTop=0,this.offsetLeft=(window.innerWidth-this.width*this.scale)/2):(this.scale=window.innerWidth/this.width,this.offsetTop=(window.innerHeight-this.height*this.scale)/2,this.offsetLeft=0),this.scale>1&&(this.scale=1)},setScale:function(){this.calcScale();var t=window.innerWidth-this.width,e=window.innerHeight-this.height;this.stage.style.left=t/2+"px",this.stage.style.top=e/2+"px",this.stage.style.transform="scale("+this.scale+")",this.stage.style.webkitTransform="scale("+this.scale+")",this.stage.style.MozTransform="scale("+this.scale+")"},loop:function(){requestAnimation(Game.loop),Game.update(),Game.render()},update:function(){this.paused||(this.shakeScreen(),Player.update(),Enemies.update(),Bullets.update(),Room.update(),FX.update(),0!==this.timerAdjust&&this.timerReset())},clearCanvas:function(){this.glitching?(this.glitchCount++,this.glitchCount>=10&&(this.glitchCount=0,this.glitching=!1)):this.canvas.width=this.canvasWidth},render:function(){if(!this.paused){if(this.clearCanvas(),!Network.tutorial)for(var t=0;t<12;t++)for(var e=0;e<10;e++){this.ctx.strokeStyle="#222",this.ctx.lineWidth=2;var i=randomInt(2*(1-Network.level),2*(Network.level-1)),s=randomInt(2*(1-Network.level),2*(Network.level-1));this.ctx.strokeRect(55.5*t+41+41*t+s/2,40*e+41+41*e+i/2,55.5+s/2,40+i/2)}Enemies.drawDeadEnemies(this.ctx),Bullets.draw(this.ctx),Player.draw(this.ctx),Enemies.draw(this.ctx),Player.drawCursor(this.ctx),FX.draw(this.ctx)}}},Menu={menu:document.querySelector("#menu"),menuHeading:document.querySelector("#menuHead"),btnNames:["Mutate MTU","ECC","Packet TAP","FEC","SSL inspection","Jumbo frame","Decode","Encapsulation","Bruteforce","Ping flood","Overflow","Traceroute"],btnDescripts:["Increases max health by 25%.","Gain 4% health every 3 seconds. This effect stacks.","Gain 2.5% of damage done back as health. This effect stacks.","Gain 12.5% max health and 2% health every 3 seconds.","5% higher chance for pings to pierce entities.","Chance to do critical damage increases by 5%.","Critical damage increases by 10%.","Gain 5% damage reduction for each attack.","Each ping does 20% more damage.","Shoot additional pings at the cost of accuracy.","Rate of fire increases by 4 pings per second.","Increased accuracy."],toggle:function(t){if(this.open())Game.stage.classList.contains("hidden")&&Game.stage.classList.toggle("hidden"),void 0===t?(this.menu.classList.toggle("show"),Game.unpause(),Game.stage.classList.contains("hidden")&&Game.stage.classList.toggle("hidden")):Game.stage.classList.contains("hidden")||(Game.stage.classList.toggle("hidden"),this.menu.classList.toggle("show"),setTimeout((function(){Menu.toggle(t)}),500));else{if(document.querySelector("#mainMenu").className="hidden",document.querySelector("#endScreen").className="hidden",document.querySelector("#upgradeMenu").className="hidden",document.querySelector("#mapMenu").className="hidden",document.querySelector("#pauseMenu").className="hidden","main"===t||void 0===t)this.menuHeading.innerHTML="Nexus overload",!Network.tutorial&&document.querySelector("#tutButton").classList.contains("hidden")&&(document.querySelector("#tutButton").classList.toggle("hidden"),document.querySelector("#record").classList.toggle("hidden")),document.querySelector("#record").innerHTML="Record: "+Network.highestLevel+"<div class='menuButtonSubText txtGrey'>You will get "+Math.floor(Network.highestLevel/2)+" free upgrade(s) when you try again.</div>",document.querySelector("#mainMenu").classList.toggle("hidden");else if("pause"===t)this.menuHeading.innerHTML="Paused",document.querySelector("#endHead").innerHTML="",document.querySelector("#endStats").innerHTML="",document.querySelector("#resumeBtn").className="menuButton btnGreen",document.querySelector("#pauseMenu").classList.toggle("hidden");else if("end"===t)this.menuHeading.innerHTML="Game over",document.querySelector("#endHead").innerHTML="Reached network layer "+Network.level,document.querySelector("#endStats").innerHTML="You killed "+Enemies.totalKills+" enemies<br/>and sent "+Bullets.totalBullets+" ping requests!",document.querySelector("#resumeBtn").className="menuButton btnGreen hidden",document.querySelector("#pauseMenu").classList.toggle("hidden");else if("upgrade"===t){this.menuHeading.innerHTML="Packet glitch",document.querySelector("#upgradeMenu").classList.toggle("hidden");var e="<div class='ugHead txtWhite'>";e+=1===Network.level&&0===Network.currentCol?"You have "+Player.availableUG+" source upgrade(s) remaining":"You have "+Player.availableUG+" upgrade(s) to choose",e+="</div><div class='menuButtons'>";for(var i=["btnGreen","btnBlue","btnOrange"],s=["txtGreen","txtBlue","txtOrange"],a=[randomInt(0,3),randomInt(4,7),randomInt(8,11)],n=0;n<3;n++)e+="<div class='menuButton "+i[n]+"' onclick='Player.upgrade("+a[n]+");''>"+this.btnNames[a[n]]+"<div class='menuButtonSubText "+s[n]+"'>"+this.btnDescripts[a[n]]+"</div></div>";e+="</div>",document.querySelector("#upgradeMenu").innerHTML=e}else"map"===t&&(this.menuHeading.innerHTML="Network map",document.querySelector("#mapMenu").classList.toggle("hidden"));this.menu.classList.toggle("show"),Game.pause()}},open:function(){return!!this.menu.classList.contains("show")}},Input={mouse:new Point(0,0),canvasMouse:new Point(0,0),mouseDown:!1,up:!1,down:!1,left:!1,right:!1,init:function(){this.addKeyboardListeners(),this.addMouseListeners()},addMouseListeners:function(){document.addEventListener("mousemove",Input.updateMouseCoordinates),document.addEventListener("mousedown",Input.onMouseDown),document.addEventListener("mouseup",Input.onMouseUp)},updateMouseCoordinates:function(t){Input.mouse.x=t.clientX,Input.mouse.y=t.clientY,Input.canvasMouse.x=(t.clientX-Game.canvasLeft*Game.scale-Game.offsetLeft)/Game.scale,Input.canvasMouse.y=(t.clientY-Game.canvasTop*Game.scale-Game.offsetTop)/Game.scale},onMouseDown:function(t){t.preventDefault(),Input.mouseDown=!0},onMouseUp:function(t){Input.mouseDown=!1},addKeyboardListeners:function(){document.addEventListener("keydown",Input.keyDown),document.addEventListener("keyup",Input.keyUp)},keyDown:function(t){87===t.which&&(Input.up=!0),65===t.which&&(Input.left=!0),83===t.which&&(Input.down=!0),68===t.which&&(Input.right=!0),27===t.which&&(Menu.open()?"Paused"===Menu.menuHeading.innerHTML?Menu.toggle():"Nexus overload"!==Menu.menuHeading.innerHTML&&Menu.toggle("main"):Menu.toggle("pause"))},keyUp:function(t){87===t.which&&(Input.up=!1),65===t.which&&(Input.left=!1),83===t.which&&(Input.down=!1),68===t.which&&(Input.right=!1)}};Bullet.prototype={init:function(){this.friendly?(this.passThrough=Math.random()<Player.bullestPassThrough,this.passThrough?this.colour="#38FF00":this.colour="#9FF1FF",Math.random()<Player.crit&&(this.damage+=Math.floor(this.damage*Player.critDamage),this.colour="#FFE600",this.passThrough&&(this.colour="#FFF"))):this.colour="#FF5C87"},calcVelocity:function(){this.vx=Math.cos(degToRad(this.angle))*Bullets.speed,this.vy=Math.sin(degToRad(this.angle))*Bullets.speed},move:function(){this.x+=this.vx,this.y+=this.vy,this.remove()},hit:function(){if(this.friendly){for(var t in Enemies.enemies)if(Enemies.enemies[t].alive&&!this.kill){for(var e=!1,i=0;i<this.hitAccuracy;i++)this.x+this.vx*(i/this.hitAccuracy)<=Enemies.enemies[t].x+Enemies.enemies[t].radius&&this.x+this.vx*(i/this.hitAccuracy)>=Enemies.enemies[t].x-Enemies.enemies[t].radius&&this.y+this.vy*(i/this.hitAccuracy)<=Enemies.enemies[t].y+Enemies.enemies[t].radius&&this.y+this.vy*(i/this.hitAccuracy)>=Enemies.enemies[t].y-Enemies.enemies[t].radius&&(e=!0);e&&(this.passThrough||(this.kill=!0),Enemies.enemies[t].takeDamage(this.damage),this.damage>=Player.damage&&Sound.play("damage"),Player.gainHP(Player.lifeSteal*this.damage),Player.lifeSteal>0&&FX.createParticles(Enemies.enemies[t].x,Enemies.enemies[t].y,Math.min(Math.ceil(Player.lifeSteal*this.damage),10),Enemies.enemies[t].colour),this.damage=Math.round(.5*this.damage))}}else for(var s=0;s<this.hitAccuracy;s++)if(this.x+this.vx*(s/this.hitAccuracy)<=Player.x+37&&this.x+this.vx*(s/this.hitAccuracy)>=Player.x-37&&this.y+this.vy*(s/this.hitAccuracy)<=Player.y+37&&this.y+this.vy*(s/this.hitAccuracy)>=Player.y-37&&Player.collidingPoint(this.x+this.vx*(s/this.hitAccuracy),this.y+this.vy*(s/this.hitAccuracy))){Player.takeDamage(this.damage),this.kill=!0;break}},remove:function(){(this.x<0||this.x>Game.canvasWidth||this.y<0||this.y>Game.canvasHeight)&&(this.kill=!0)},draw:function(t){t.strokeStyle=this.colour,t.lineWidth=2,t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x+this.vx,this.y+this.vy),t.stroke()}};var Bullets={bullets:[],totalBullets:0,bulletSpray:5,bulletsPerShot:1,speed:20,fireBullet:function(t,e,i,s,a,n){if(this.speed=a||20,void 0!==n&&n)for(var h=0;h<this.bulletsPerShot;h++)this.bullets.push(new Bullet(t,e,i+random(-this.bulletSpray,this.bulletSpray),s,n));else for(var r=0;r<Player.bulletsPerShot;r++)this.bullets.push(new Bullet(t,e,i+random(-Player.bulletSpray,Player.bulletSpray),s,n)),this.totalBullets++},update:function(){this.clean();for(var t=0;t<this.bullets.length;t++)this.bullets[t].move(),this.bullets[t].hit()},draw:function(t){for(var e=0;e<this.bullets.length;e++)this.bullets[e].draw(t)},clean:function(){for(var t=this.bullets.length-1;t>=0;t--)this.bullets[t].kill&&this.bullets.splice(t,1)},clear:function(){this.bullets=[]}},Player={xpBarElem:document.querySelector("#xpInd"),hpBarElem:document.querySelector("#hpInd"),xpTextElem:document.querySelector("#xpTxt"),hpTextElem:document.querySelector("#hpTxt"),x:50,y:Game.canvasHeight/2,width:60,height:40,colour:["#808080","#3EDBFF","#F00","#0F0","#0FF","#FFF"],angle:0,bulletSpeed:20,top:new Point(0,0),bottomLeft:new Point(0,0),bottomRight:new Point(0,0),area:0,hpTopLeft:new Point(0,0),hpWidth:50,distanceToMouse:0,lvlAnim:0,init:function(){this.calcTriPoints(),this.area=getAreaOfTriangle(this.top,this.bottomLeft,this.bottomRight),this.reset()},reset:function(){this.alive=!0,this.deathTime=null,this.armor=0,this.maxHp=100,this.hp=100,this.hpRegen=0,this.hpTimer=Date.now(),this.availableUG=Math.floor(Network.highestLevel/2),Network.tutorial&&(this.availableUG=0),this.xp=0,this.prevLevelXP=0,this.nextLevelXP=40,this.level=1,this.speed=6,this.bulletRate=4,this.bulletTimer=null,this.bulletSpray=1.5,this.bulletsPerShot=1,this.bullestPassThrough=0,this.damage=20,this.lifeSteal=0,this.crit=.01,this.critDamage=.5;var t=this.nextLevelXP-this.prevLevelXP,e=this.xp-this.prevLevelXP;this.xpBarElem.style.width=Math.round(e/t*100)+"%",this.xpTextElem.innerHTML=e+" / "+t+" bits",this.hpBarElem.style.width="0%",this.moveToStart()},rotate:function(){this.alive&&(this.angle=angleBetween(new Point(this.x,this.y),Input.canvasMouse))},move:function(){this.alive&&(Input.up&&Input.down||(Input.up?this.y-=this.speed:Input.down&&(this.y+=this.speed)),Input.left&&Input.right||(Input.left?this.x-=this.speed:Input.right&&(this.x+=this.speed))),this.calcTriPoints(),this.insideRoom()},moveToStart:function(){this.x=50,this.y=Game.canvasHeight/2},insideRoom:function(){for(;this.top.x<0||this.bottomLeft.x<0||this.bottomRight.x<0;)this.x++,this.calcTriPoints();for(;this.top.x>Game.canvasWidth||this.bottomLeft.x>Game.canvasWidth||this.bottomRight.x>Game.canvasWidth;)this.x--,this.calcTriPoints();for(;this.top.y<0||this.bottomLeft.y<0||this.bottomRight.y<0;)this.y++,this.calcTriPoints();for(;this.top.y>Game.canvasHeight||this.bottomLeft.y>Game.canvasHeight||this.bottomRight.y>Game.canvasHeight;)this.y--,this.calcTriPoints()},calcTriPoints:function(){this.top.x=this.x+Math.cos(degToRad(this.angle))*(this.width/2),this.top.y=this.y+Math.sin(degToRad(this.angle))*(this.width/2),this.bottomLeft.x=this.x+Math.cos(degToRad((this.angle+180)%360))*(this.width/2),this.bottomLeft.y=this.y+Math.sin(degToRad((this.angle+180)%360))*(this.width/2),this.bottomRight.x=this.bottomLeft.x+Math.cos(degToRad((this.angle-90)%360))*(this.height/2),this.bottomRight.y=this.bottomLeft.y+Math.sin(degToRad((this.angle-90)%360))*(this.height/2),this.bottomLeft.x+=Math.cos(degToRad((this.angle+90)%360))*(this.height/2),this.bottomLeft.y+=Math.sin(degToRad((this.angle+90)%360))*(this.height/2)},shoot:function(){Input.mouseDown&&this.alive?(null===this.bulletTimer&&(this.bulletTimer=Date.now(),Bullets.fireBullet(this.x,this.y,this.angle,this.damage,this.bulletSpeed),Sound.play("shoot")),this.bulletTimer+=Game.updateTimer(),Date.now()-this.bulletTimer>1e3/this.bulletRate&&(this.bulletTimer=null)):null!==this.bulletTimer&&(this.bulletTimer=null)},takeDamage:function(t){if(this.alive){var e=Math.floor(t-t*this.armor);e>=this.hp?(this.hp=0,this.alive=!1,Game.screenShake(150,250),Sound.play("die"),this.deathTime=Date.now()):(this.hp-=e,Game.screenShake(Math.floor(e/this.maxHp*50),10),Sound.play("damage"))}},gainXP:function(t){this.xp+=t,this.xp>=this.nextLevelXP&&(this.prevLevelXP=this.nextLevelXP,this.nextLevelXP+=this.nextLevelXP,this.availableUG++,Sound.play("level"),this.hp=this.maxHp,this.lvlAnim=30);var e=this.nextLevelXP-this.prevLevelXP,i=this.xp-this.prevLevelXP;this.xpBarElem.style.width=Math.round(i/e*100)+"%",this.xpTextElem.innerHTML=i+" / "+e+" bits"},regenHP:function(){this.alive&&(this.hpTimer+=Game.updateTimer(),Date.now()>=this.hpTimer+3e3&&(this.hpTimer=Date.now(),this.gainHP(Math.floor(this.hpRegen*this.maxHp))))},update:function(){this.move(),this.rotate(),this.shoot(),this.distanceToMouse=Math.sqrt(Math.pow(Player.x-Input.canvasMouse.x,2)+Math.pow(Player.y-Input.canvasMouse.y,2)),this.regenHP(),this.alive||null===this.deathTime||(this.deathTime+=Game.updateTimer(),Date.now()>=this.deathTime+1250&&(Menu.toggle("end"),this.deathTime=null))},collidingPoint:function(t,e){var i=getAreaOfTriangle({x:t,y:e},this.top,this.bottomLeft);if(i>this.area)return!1;var s=getAreaOfTriangle({x:t,y:e},this.top,this.bottomRight);return!(i+s>this.area)&&i+s+getAreaOfTriangle({x:t,y:e},this.bottomRight,this.bottomLeft)===this.area},upgrade:function(t){if(this.availableUG>0&&Menu.open()){switch(this.level++,this.availableUG--,t){case 0:this.maxHp+=Math.floor(.25*this.maxHp),this.hp+=Math.floor(.25*this.hp);break;case 1:this.hpRegen+=.04;break;case 2:this.lifeSteal+=.025;break;case 3:this.maxHp+=Math.floor(.125*this.maxHp),this.hp+=Math.floor(.125*this.hp),this.hpRegen+=.02;break;case 4:this.bullestPassThrough+=.05;break;case 5:this.crit+=.05;break;case 6:this.critDamage+=.1;break;case 7:this.armor+=.05,this.armor>.9&&(this.armor=.9);break;case 8:this.damage+=Math.floor(.2*this.damage);break;case 9:this.bulletsPerShot++,this.bulletsPerShot>20?this.bulletsPerShot=20:this.damage-=Math.floor(.3*this.damage),this.bulletSpray+=1.5,this.bulletSpray>20&&(this.bulletSpray=20);break;case 10:this.bulletRate+=4,this.bulletRate>50?this.bulletRate=50:this.damage-=Math.floor(.3*this.damage),this.bulletSpray++,this.bulletSpray>20&&(this.bulletSpray=20);break;case 11:this.bulletSpray-=2,this.bulletSpray<.5&&(this.bulletSpray=.5)}0===this.availableUG?Menu.toggle("map"):Menu.toggle("upgrade")}},gainHP:function(t){this.hp+=t,this.hp>this.maxHp&&(this.hp=this.maxHp)},drawHp:function(t){this.alive?(this.hpBarElem.style.width=Math.round(this.hp/this.maxHp*100)+"%",this.hpTextElem.innerHTML=Math.round(this.hp)+" / "+this.maxHp+" MTU"):(this.hpBarElem.style.width="0%",this.hpTextElem.innerHTML="0 / "+this.maxHp+" MTU")},draw:function(t){this.drawHp(t);var e=0;if(this.alive){var i=1;if(Input.mouseDown&&(i=Math.min(Math.floor(this.bulletsPerShot+this.bulletRate/10),5)),t.fillStyle=this.colour[randomInt(1,i)],e=Math.min(50*(this.armor/10+(this.crit-.01)/10+(this.critDamage-.5)/20)+Math.floor(this.level/3),7),this.lvlAnim>0){t.strokeStyle="#999",t.lineWidth=this.lvlAnim/5;for(var s=0;s<5;s++)t.beginPath(),t.arc(this.x,this.y,(30-this.lvlAnim)*s,0,2*Math.PI),t.stroke(),this.lvlAnim-=.2}}else t.fillStyle=this.colour[0];t.beginPath(),t.moveTo(this.top.x+randomInt(-e,e),this.top.y+randomInt(-e,e)),t.lineTo(this.bottomRight.x+randomInt(-e,e),this.bottomRight.y+randomInt(-e,e)),t.lineTo(this.bottomLeft.x+randomInt(-e,e),this.bottomLeft.y+randomInt(-e,e)),t.closePath(),t.fill()},drawCursor:function(t){t.strokeStyle="#484848",t.fillStyle="#EEE",t.lineWidth=1,t.beginPath(),t.arc(Input.canvasMouse.x,Input.canvasMouse.y,.0175*this.bulletSpray*this.distanceToMouse,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(Input.canvasMouse.x,Input.canvasMouse.y,2.5,0,2*Math.PI),t.fill()}},Room={clear:!1,exitTime:null,story:1,tutorialElem:document.querySelector("#tutorial"),storyElem:document.querySelector("#story"),start:function(t){if(Game.timerReset(),this.nextStory(),FX.clear(),document.querySelector("#mainCanvas").className="room btnGrey",this.story<=6&&Network.tutorial){if(this.story-1==1||this.story-1==2)for(var e=0;e<3;e++)Enemies.spawnCrawler(1e3,375+50*e,1);else if(this.story-1==3)for(var i=0;i<3;i++){var s=1;1===i&&(s=2),Enemies.spawnCrawler(1e3,325+50*i,s)}else if(this.story-1==4)for(var a=0;a<5;a++)Enemies.spawnCrawler(1e3,325+50*a,1);else if(this.story-1==5){document.querySelector("#mainCanvas").className="room btnRed";for(var n=0;n<3;n++)Enemies.spawnCrawler(1e3,325+100*n,1);for(var h=0;h<2;h++)Enemies.spawnCrawler(1e3,375+100*h,2)}Enemies.setSpeed(.5)}else-1===t?(document.querySelector("#mainCanvas").className="room btnRed",this.spawnElite(),this.spawnMob(),this.spawnMob()):5===t?(document.querySelector("#mainCanvas").className="room btnBlue",this.spawnElite()):6===t?(document.querySelector("#mainCanvas").className="room btnOrange",this.spawnBoss(),Player.availableUG++):this.spawnMob()},spawnMob:function(){var t=randomInt(2*Network.level,3*Network.level),e=randomInt(Network.level,2*Network.level);Enemies.spawnCrawlerDen(t,1),Enemies.spawnPulserDen(e,1)},spawnElite:function(){this.spawnMob();var t=randomInt(Math.ceil(.5*Network.level),Math.ceil(.75*Network.level)),e=randomInt(Math.ceil(.25*Network.level),Math.ceil(.5*Network.level));Enemies.spawnCrawlerDen(t,2),Enemies.spawnPulserDen(e,2)},spawnBoss:function(){this.spawnElite();var t=randomInt(Math.ceil(.25*Network.level),Math.ceil(.5*Network.level)),e=randomInt(Math.ceil(.1*Network.level),Math.ceil(.25*Network.level));Enemies.spawnCrawlerDen(t,3),Enemies.spawnPulserDen(e,3)},reset:function(){this.clear=!1,this.exitTime=null,Bullets.clear(),Enemies.clear(),Player.moveToStart()},nextStory:function(){if(this.tutorialElem.innerHTML="",this.storyElem.innerHTML="",this.story<=5&&Network.tutorial){var t="<div class='tHead txtWhite'>",e="<em>";1===this.story?(t="<div class='tHead txtWhite tLeft'>",t+="Movement",t+="</div><div class='tHead txtWhite tRight'>",t+="Attack",t+="</div><div class='tLeft'>",t+="<div class='tKey btnBlue txtBlue'>W</div>",t+="<div class='tKey btnBlue txtBlue'>A</div>",t+="<div class='tKey btnBlue txtBlue'>S</div>",t+="<div class='tKey btnBlue txtBlue'>D</div>",t+="</div><div class='tRight tTxt txtOrange'>",t+="Mouse to aim<br/>Left mouse to shoot",e+="There once was a little data-packet,<br/>trapped in a looped network."):2===this.story?(t+="Data Gain",t+="</div><div class='tTxt txtOrange'>",t+="Overload crawlers and pulsars with<br/>ping requests to gain their data bits.",e+="He found a way to glitch the system,<br/>overloading the hostile entities and learning their secrets."):3===this.story?e+="The data gained through his experience helped<br/>him to understand how to bend the Nexus to his advantage.":4===this.story?e+="The little packet was convinced he would fulfil his destiny,<br/>unaware that the looping Nexus was just drawing him in deeper.":5===this.story&&(t+="Nexus source",t+="</div><div class='tTxt txtOrange'>",t+="For every two layers you complete, you gain<br/>one free upgrade on your future play-throughs.",e+="As the little packet moved deeper through the Nexus, his<br/>understanding of the source grew and he knew this would serve him well one day."),t+="</div>",e+="</em>",this.tutorialElem.innerHTML=t,this.storyElem.innerHTML=e,this.story++}},update:function(){!this.clear&&Enemies.enemiesKilled()&&(this.clear=!0,this.exitTime=Date.now()+500),null!==this.exitTime&&(this.exitTime+=Game.updateTimer()),null!==this.exitTime&&Date.now()>=this.exitTime&&Player.alive&&(this.exitTime=null,Network.updateMap(),Player.availableUG>0?Menu.toggle("upgrade"):Menu.toggle("map"))}},Network={mapElem:document.querySelector("#map"),mapCtx:document.querySelector("#mapLines").getContext("2d"),mapHead:document.querySelector("#mapLayer"),width:730,height:400,level:1,highestLevel:1,layer:0,colour:[],currentRow:0,currentCol:0,workingMap:[],goToNextLevel:!1,tutorial:!0,levelData:[createLevel([[0,0,0,0,0],[0,0,0,0,0],[1,3,3,3,3],[0,0,0,0,0],[0,0,0,0,0]],[[[],[],[],[],[]],[[],[],[],[],[]],[[2],[2],[2],[2],[2]],[[],[],[],[],[]],[[],[],[],[],[]]]),createLevel([[0,0,0,0,3],[0,5,3,5,5],[1,0,5,6,3],[0,3,0,3,0],[0,0,3,6,5]],[[[],[],[],[],[0]],[[],[1,2],[1,2],[0,1],[1]],[[1,3],[],[2,3],[1,2],[2]],[[],[2,4],[],[2,4],[]],[[],[],[3,4],[4],[4]]]),createLevel([[0,0,3,0,3],[0,5,0,5,0],[1,3,3,0,6],[0,0,5,5,0],[0,0,0,6,3]],[[[],[],[1],[],[0]],[[],[0],[],[0,2],[]],[[1,2],[2,3],[1,3],[],[2]],[[],[],[3,4],[2,4],[]],[[],[],[],[4],[4]]]),createLevel([[0,0,0,0,5],[0,0,3,6,0],[1,3,3,5,3],[0,5,3,0,6],[0,0,0,5,3]],[[[],[],[],[],[0]],[[],[],[1,2],[0,2],[]],[[2,3],[1,2],[2],[2,3],[2]],[[],[3],[2,4],[],[3]],[[],[],[],[3,4],[4]]]),createLevel([[0,0,3,5,0],[0,3,5,6,3],[1,0,3,5,5],[0,5,5,0,6],[0,0,3,3,3]],[[[],[],[0,1],[1],[]],[[],[0,1,2],[1,2],[1],[1]],[[1,3],[],[2],[1,2,3],[2]],[[],[3,4],[2,4],[],[3]],[[],[],[4],[3,4],[4]]]),createLevel([[0,0,5,5,6],[0,5,3,0,3],[1,3,3,3,0],[0,0,5,0,6],[0,0,0,5,3]],[[[],[],[0],[0,1],[0]],[[],[0,1],[2],[],[1]],[[1,2],[2,3],[2],[1,3],[]],[[],[],[2,4],[],[3]],[[],[],[],[3,4],[4]]])],init:function(){this.colour[0]="rgba(0,0,0,0)",this.colour[1]="#24FF96",this.colour[2]="#FFF",this.colour[3]="#808080",this.colour[4]="#282828",this.colour[5]="#3EFFEC",this.colour[6]="#FF945F"},start:function(){this.level>1&&(this.tutorial=!1),this.tutorial?this.layer=0:this.layer=randomInt(1,5),this.currentRow=2,this.currentCol=0;for(var t=0;t<5;t++){this.workingMap[t]=[];for(var e=0;e<5;e++)this.workingMap[t][e]=this.levelData[this.layer].map[t][e]}this.showMap()},showMap:function(){this.mapElem.innerHTML="",this.mapHead.innerHTML="Network layer: "+this.level;for(var t="",e=[" btnGreen fillGreen"," btnWhite fillWhite"," btnGrey"," btnDarkGrey"," btnBlue"," btnOrange"],i=0;i<this.currentCol+2&&i<5;i++){t+="<div class='mapCol'>";for(var s=0;s<5;s++)if(0!==this.workingMap[s][i]){if(t+="<div onclick='Network.goToNode(this);' data-row='"+s+"' data-col='"+i+"' class='mapNode row"+(s+1)+e[this.workingMap[s][i]-1],i===this.currentCol+1)for(var a in this.levelData[this.layer].connections[this.currentRow][this.currentCol])this.levelData[this.layer].connections[this.currentRow][this.currentCol][a]===s&&(t+=" next");t+=Network.tutorial&&0===this.currentCol&&1===i?" txtWhite clickHere'>click here</div>":"'></div>"}t+="</div>"}t+="<div onclick='Network.goToLastNode();' class='mapCol'> <div class='lastMapNode btnRed",4===this.currentCol&&(t+=" next"),t+="'></div> </div>",this.mapElem.innerHTML=t,this.strokeConnections()},strokeConnections:function(){document.querySelector("#mapLines").width=this.width,document.querySelector("#mapLines").height=this.height;for(var t=0;t<5;t++)for(var e=0;e<this.currentCol+1;e++)if(0!==this.workingMap[t][e]){this.mapCtx.strokeStyle=this.colour[this.workingMap[t][e]],this.mapCtx.lineWidth=4;for(var i=this.levelData[this.layer].connections,s=0;s<i[t][e].length;s++)2!==this.workingMap[t][e]||1!==this.workingMap[i[t][e][s]][e+1]&&2!==this.workingMap[i[t][e][s]][e+1]?2===this.workingMap[t][e]&&(this.mapCtx.strokeStyle=this.colour[4]):this.mapCtx.strokeStyle=this.colour[this.workingMap[t][e]],this.mapCtx.beginPath(),this.mapCtx.moveTo(72+130*e,40+80*t),this.mapCtx.lineTo(138+130*e,40+80*i[t][e][s]),this.mapCtx.stroke()}},goToNode:function(t){var e=parseInt(t.dataset.row),i=parseInt(t.dataset.col);if(Menu.open()&&this.currentCol+1===i&&t.classList.contains("next")){this.workingMap[this.currentRow][this.currentCol]=2,this.currentRow=e,this.currentCol=i;var s=this.workingMap[e][i];this.workingMap[e][i]=1,this.updateNodes(),Room.reset(),Room.start(s),Menu.toggle()}},goToLastNode:function(){var t=document.querySelector(".lastMapNode");Menu.open()&&t.classList.contains("next")&&(this.currentCol=0,this.goToNextLevel=!0,Player.availableUG++,Room.reset(),Room.start(-1),Menu.toggle())},updateNodes:function(){var t=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]];t[this.currentRow][this.currentCol]=1;for(var e=this.levelData[this.layer].connections,i=this.currentCol;i<5;i++)for(var s=0;s<5;s++)if(0!==t[s][i])for(var a in e[s][i])t[e[s][i][a]][i+1]=1;for(var n=this.currentCol;n<5;n++)for(var h=0;h<5;h++)0!==this.workingMap[h][n]&&1!==this.workingMap[h][n]&&2!==this.workingMap[h][n]&&0===t[h][n]&&(this.workingMap[h][n]=4)},updateMap:function(){this.goToNextLevel&&(this.nextLevel(),this.goToNextLevel=!1,Player.maxHp+=Math.round(Network.level*Network.level*.75-(Network.level-1)*(Network.level-1)*.75),Player.hp=Player.maxHp,Player.damage+=Math.floor((Network.level*Network.level-(Network.level-1)*(Network.level-1))/Player.bulletsPerShot)),this.showMap()},nextLevel:function(){this.level++,this.highestLevel<this.level&&(this.highestLevel=this.level),this.start()}};Enemy.prototype={init:function(){this.mod.init(this),this.xp=Math.round(10*Network.level*this.mod.type*this.difAdj),this.maxHp=Math.round(Network.level*Network.level*this.difAdj*2*this.mod.type+(20+30*this.difAdj)),this.hp=this.maxHp,this.damage=Math.round(.25*(Network.level*Network.level*this.difAdj*this.mod.type+20*this.difAdj))},calcVelocity:function(){this.mod.calcVelocity()},move:function(){for(this.x+=this.vx,this.y+=this.vy;this.x-this.radius<0;)this.x++,this.followPlayer();for(;this.x+this.radius>Game.canvasWidth;)this.x--,this.followPlayer();for(;this.y-this.radius<0;)this.y++,this.followPlayer();for(;this.y+this.radius>Game.canvasHeight;)this.y--,this.followPlayer()},attack:function(){this.mod.attack()},takeDamage:function(t){var e=Math.round(t-t*(.25*(this.mod.type-1)));this.alive&&(e>=this.hp?(this.hp=0,this.alive=!1,Player.gainXP(this.xp),Sound.play("enemyDie"),3===this.mod.type&&(Game.screenShake(15,200),Sound.play("bossDie")),this.dc=0):(this.hp-=e,this.dc=3))},followPlayer:function(){this.angle=angleBetween(new Point(this.x,this.y),new Point(Player.x,Player.y))},update:function(){this.alive&&(this.mod.update(),this.special(),this.calcVelocity(),0===this.vx&&0===this.vy||(this.angle+=randomInt(-15,15)),this.move(),this.attack())},drawHp:function(t){t.strokeStyle="#A0A0A0",t.lineWidth=2,t.beginPath(),t.moveTo(this.x-this.radius,this.y-2*this.radius),t.lineTo(this.x+this.radius,this.y-2*this.radius),t.stroke(),t.strokeStyle="#FF5A5A",t.beginPath(),t.moveTo(this.x-this.radius,this.y-2*this.radius),t.lineTo(this.x-this.radius+2*this.radius*Math.max(this.hp/this.maxHp,0),this.y-2*this.radius),t.stroke()},draw:function(t){t.fillStyle=this.colour,this.alive?this.dc>0&&(this.dc--,t.fillStyle="#DDD"):t.fillStyle=this.dCol[randomInt(0,2)],t.save(),t.translate(this.x,this.y),t.rotate(this.angle%360*Math.PI/180),t.translate(-this.x,-this.y),t.beginPath(),this.mod.draw(t),t.restore(),this.alive&&this.drawHp(t)},special:function(){Player.alive&&this.alive&&3===this.mod.type&&(this.spawnTimer+=Game.updateTimer(),Date.now()>=this.spawnTimer+this.spawnTime&&(this.speed=0,this.colour="#FFF",Date.now()>=this.spawnTimer+this.spawnTime+250&&(Date.now()>=this.spawnTimer+this.spawnTime+250+500*this.spawned&&(this.spawned++,Sound.play("bossSpawn"),this.mod.spawnMinion()),this.spawned>=Network.level&&(this.spawnTimer=Date.now(),this.stopTimer=Date.now(),this.spawned=0))),null!==this.stopTimer&&(this.stopTimer+=Game.updateTimer(),Date.now()>=this.stopTimer+250&&(this.stopTimer=null,this.speed=this.mod.speed,this.colour=this.mod.colour)))}},Crawler.prototype={init:function(t){this.parentObj=t,this.parentObj.difAdj=.7,this.parentObj.speed=2+this.type/2,this.parentObj.range=50+30*(this.type-1),this.parentObj.radius=14+10*(this.type-1),1===this.type?this.parentObj.colour="#FF9D00":2===this.type?this.parentObj.colour="#C63E02":this.parentObj.colour="#C41205",this.parentObj.angle=0,this.parentObj.alive=!0,this.parentObj.attackSpeed=3,this.speed=this.parentObj.speed,this.colour="#C41205"},calcVelocity:function(){this.parentObj.distanceToPlayerSquared=Math.pow(Player.x-this.parentObj.x,2)+Math.pow(Player.y-this.parentObj.y,2),this.parentObj.distanceToPlayerSquared>Math.pow(this.parentObj.range,2)?(this.parentObj.vx=Math.cos(degToRad(this.parentObj.angle))*this.parentObj.speed,this.parentObj.vy=Math.sin(degToRad(this.parentObj.angle))*this.parentObj.speed):(this.parentObj.vx=0,this.parentObj.vy=0)},attack:function(){this.parentObj.distanceToPlayerSquared<=Math.pow(this.parentObj.range,2)&&Player.alive&&(this.parentObj.attackTimer+=Game.updateTimer(),Date.now()-this.parentObj.attackTimer>1e3/this.parentObj.attackSpeed&&(this.parentObj.attackTimer=Date.now(),Player.takeDamage(this.parentObj.damage),Sound.play("enemyAttack")))},update:function(){this.parentObj.followPlayer()},draw:function(t){t.fillRect(this.parentObj.x-this.parentObj.radius,this.parentObj.y-this.parentObj.radius,2*this.parentObj.radius,2*this.parentObj.radius)},spawnMinion:function(){Math.random()<.85?Enemies.spawnCrawler(this.parentObj.x,this.parentObj.y,1):Enemies.spawnCrawler(this.parentObj.x,this.parentObj.y,2)}},Pulser.prototype={init:function(t){this.parentObj=t,this.parentObj.difAdj=1,this.parentObj.speed=2,this.parentObj.range=500,this.parentObj.radius=20+10*(this.type-1),1===this.type?this.parentObj.colour="#E461FF":2===this.type?this.parentObj.colour="#B71D93":this.parentObj.colour="#D10554",this.parentObj.angle=randomInt(0,359),this.parentObj.alive=!0,this.parentObj.attackSpeed=.5,this.bulletSpeed=10,this.parentObj.attackTimer+=randomInt(-1e3,1e3),this.speed=this.parentObj.speed,this.colour="#D10554"},calcVelocity:function(){this.parentObj.angle+=randomInt(-10,10),this.parentObj.vx=Math.cos(degToRad(this.parentObj.angle))*this.parentObj.speed,this.parentObj.vy=Math.sin(degToRad(this.parentObj.angle))*this.parentObj.speed},attack:function(){if(Player.alive&&(this.parentObj.attackTimer+=Game.updateTimer(),Date.now()-this.parentObj.attackTimer>1e3/this.parentObj.attackSpeed)){this.parentObj.attackTimer=Date.now();for(var t=0;t<360;t+=Math.floor(18))Bullets.fireBullet(this.parentObj.x,this.parentObj.y,t,this.parentObj.damage,this.bulletSpeed,!0);Sound.play("enemyAttack")}},update:function(){},draw:function(t){var e=0;this.parentObj.alive&&(e=randomInt(2*-this.type,2*this.type)),t.arc(this.parentObj.x,this.parentObj.y,this.parentObj.radius+e,0,2*Math.PI),t.fill()},spawnMinion:function(){Math.random()<.85?Enemies.spawnPulser(this.parentObj.x,this.parentObj.y,1):Enemies.spawnPulser(this.parentObj.x,this.parentObj.y,2)}};var Enemies={totalKills:0,enemies:[],deadEnemies:[],spawn:function(t,e,i){this.enemies[this.enemies.length]=new Enemy(t,e,i)},clean:function(){for(var t=this.enemies.length-1;t>=0;t--)this.enemies[t].alive||(this.deadEnemies.push(this.enemies[t]),this.enemies.splice(t,1),this.totalKills++)},update:function(){for(var t in this.clean(),this.enemies)this.enemies[t].update()},draw:function(t){for(var e=this.enemies.length-1;e>=0;e--)this.enemies[e].draw(t)},drawDeadEnemies:function(t){for(var e in this.deadEnemies)this.deadEnemies[e].draw(t)},spawnCrawlerDen:function(t,e){for(var i=0;i<t;i++){var s=randomInt(300,Game.canvasWidth-300),a=randomInt(200,Game.canvasHeight-200);this.spawnCrawler(s,a,e)}},spawnCrawler:function(t,e,i){Enemies.spawn(t,e,new Crawler(i))},spawnPulser:function(t,e,i){this.spawn(t,e,new Pulser(i))},spawnPulserDen:function(t,e){for(var i=0;i<t;i++){var s=randomInt(500,Game.canvasWidth-500),a=randomInt(400,Game.canvasHeight-400);this.spawnPulser(s,a,e)}},enemiesKilled:function(){return 0===this.enemies.length},clear:function(){this.enemies=[],this.deadEnemies=[]},setSpeed:function(t){for(var e in this.enemies)this.enemies[e].speed=t}},FX={particles:[],createParticles:function(t,e,i,s){for(var a=0;a<i;a++)this.particles.push(new Particle(t,e,s)),this.particles[this.particles.length-1].speed+=randomInt(-3,3)},update:function(){for(var t=this.particles.length;t>=0;t--)void 0!==this.particles[t]&&(this.particles[t].kill?this.particles.splice(t,1):this.particles[t].moveToPlayer())},draw:function(t){for(var e=0;e<this.particles.length;e++)this.particles[e].draw(t)},clear:function(){this.particles=[]}};Particle.prototype={moveToPlayer:function(){this.x>Player.x-15&&this.x<Player.x+15&&this.y>Player.y-15&&this.y<Player.y+15?this.kill=!0:(this.angle=angleBetween(new Point(this.x,this.y),new Point(Player.x,Player.y)),this.x+=Math.cos(degToRad(this.angle))*this.speed,this.y+=Math.sin(degToRad(this.angle))*this.speed)},draw:function(t){t.fillStyle=this.colour,t.fillRect(this.x-this.radius/2,this.y-this.radius/2,this.radius,this.radius)}};var Sound={ctx:null,sounds:{},add:function(t,e){null!==this.ctx&&(this.sounds[t]=[],e.forEach((function(e,i){this.sounds[t].push(jsfxr(e,this.ctx))}),this))},play:function(t){if(null!==this.ctx){var e=this.sounds[t],i=e.length>1?e[randomInt(0,e.length-1)]:e[0],s=this.ctx.createBufferSource();s.buffer=i,s.connect(this.ctx.destination),s.start(0)}}};void 0!==AudioContext&&(Sound.ctx=new AudioContext),Sound.add("shoot",[[2,,.18,,,.75,,-.48,,.32,.41,.02,,,-1,,.58,,.79,,1,,,.25]]),Sound.add("damage",[[3,,.1,.75,.1423,.04,,-.3253,,,,,,,,,,,1,,,.2797,,.25],[3,,.1298,.7299,.1152,.121,.0359,-.3636,.0194,.0016,.1639,.1275,.016,.0303,.035,.0901,.1947,-.1091,.9605,-.1113,,.3222,-.0271,.25]]),Sound.add("die",[[3,,.01,.3347,.8256,.507,,-.9429,-7e-4,.1645,,.0677,-.24,-.8962,-.0062,,-.0312,-.0032,.9774,.8827,.9143,.0021,,.5]]),Sound.add("level",[[0,,.1,.58,.66,.71,,-.04,-.6,.76,1,-.48,,.2,,,.1282,-.0457,.33,-.0799,,,,.3]]),Sound.add("enemyAttack",[[1,,.18,.25,.38,.53,.1,-.4,-.02,.79,.66,.02,,,-1,,.58,,.79,,1,.61,,.25]]),Sound.add("enemyDie",[[3,.19,.1623,.3627,.26,.0661,,-.0971,,,,-.6375,.6342,,,,.2429,-.0249,1,,,,,.3],[3,.1488,.2141,.3548,.2375,.0913,,-.1366,-.0419,,.0198,-.6375,.6342,,,,.2429,-.0249,1,-.0332,,,,.3]]),Sound.add("bossSpawn",[[0,.16,.28,,.61,.43,,-.2421,-.0095,.83,.09,.36,.37,.15,.54,.02,.7042,.0568,.9978,.1092,,,.7862,.3]]),Sound.add("bossDie",[[1,,.14,.35,.68,,,.4281,-.1004,.578,-.429,.1456,.4425,.6189,-.0799,.53,.3077,,.74,.26,-.9031,.67,-.36,.3]]),Game.init()</script>