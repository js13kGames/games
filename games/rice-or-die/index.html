<!doctype html><meta content="width=device-width" name=viewport><title>Rice or Die</title><style>body,html{width:100%;height:100%;min-width:100vw;min-height:100vh;display:flex;margin:0;background-color:#000;-webkit-user-select:none;-ms-user-select:none;user-select:none}</style><script type=module>var V=Object.defineProperty,W=(e,t,i)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,p=(e,t,i)=>(W(e,"symbol"!=typeof t?t+"":t,i),i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.wait=200,window.pause=!1;const X={system:{timer:0,wave:1,waveStarted:!1,showingEndScreen:!1},player:{rice:2e3,life:50},uiState:{activeUnit:null,dialog:null},enemies:[],towers:[],village:{x:39,y:11,height:7,width:3}};let I=JSON.parse(JSON.stringify(X));const u=()=>JSON.parse(JSON.stringify(I)),k=e=>{I=e},w=()=>u().uiState,T=e=>k({...u(),uiState:e}),f=()=>u().enemies,E=e=>k({...u(),enemies:e}),C=()=>u().towers,S=e=>k({...u(),towers:e}),y=()=>u().system,G=e=>k({...u(),system:{...y(),...e}}),h=()=>u().player,x=e=>k({...u(),player:e}),A=()=>{k(JSON.parse(JSON.stringify(X)))},K=10,_=41,q=1,Q=27,O=(e,t,i)=>{const n={},r=[e],o={[g(e)]:0},a={[g(e)]:Y(e,t)};for(;r.length>0;){r.sort(((e,t)=>a[g(e)]-a[g(t)]));const e=r[0];if(t.some((t=>g(t)===g(e))))return Z(n,e);r.shift();for(const s of te(e)){g(s)in o||(o[g(s)]=1/0);const l=o[g(e)]+ee(e,s,i);l<o[g(s)]&&(n[g(s)]=e,o[g(s)]=l,a[g(s)]=l+Y(s,t),r.find((e=>g(e)===g(s)))||r.push(s))}}return console.log("Couldn't find path start to goal:",e,t),null},Z=(e,t)=>{let i=t;const n=[i];for(;g(i)in e;)i=e[g(i)],n.push(i);return n.reverse()},ee=(e,t,i)=>i.towers.find((e=>e.gridX===t.x&&e.gridY===t.y))?1/0:1,g=e=>`${e.x},${e.y}`,Y=(e,t)=>{const i=t.map((t=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y)));return Math.min(...i)},te=e=>[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}].filter((e=>!(e.x<K||e.x>_||e.y>Q||e.y<1))),ne=e=>{const t=u().village,i=document.createElement("div");return i.style.gridArea=`${t.y}/${t.x}/${t.y+t.height}/${t.x+t.width}`,i.style.background="transparent",i.style.backgroundImage="url('./v.png')",i.style.backgroundSize="32px",e.entityGrid.appendChild(i),i},U=()=>{const e=u().village.x,t=u().village.y,i=[];for(let n=0;n<u().village.width;n++)for(let r=0;r<u().village.height;r++)i.push({x:e+n,y:t+r});return i},re=(e,t)=>U().some((i=>i.x===e&&i.y===t)),z=e=>"enemy"===e.name,ie=(e,t)=>{t.style.background="transparent",t.style.backgroundImage="fasterEnemy"===e.type?"url('./e1.png')":"url('./e2.png')",t.style.backgroundSize="cover",e.takingDamage&&(t.style.backgroundColor="orange"),e.stats.hp<=0&&(t.style.backgroundColor="black")},se=e=>{if(e.stats.hp<=0)return e;if(e.moveCd>0)return{...e,moveCd:e.moveCd-1};const t=O({x:e.gridX,y:e.gridY},U(),u());return t?1===t.length?(console.log("Enemy reached the goal"),e):{...e,gridX:t[1].x,gridY:t[1].y,moveCd:e.stats.speed}:(console.error("Enemy couldn't find any path to village and is mighty confused!"),e)},oe=[{name:"Start Wave",handler:e=>()=>{G({...y(),waveStarted:!0,timer:0}),m(e)}}],m=e=>{e.uiHtmlGrid.innerHTML="";const t=ce(e);le(t);const i=C().find((e=>e.selected));if(i)return ae(t,e,i);de(t,e),ue(t,e)},ae=(e,t,i)=>{const n=ge[i.name];i.class||n.forEach((n=>{if(!i.color)return;const r=document.createElement("div");r.style.backgroundColor="gray",r.style.width="100%",r.style.cursor="pointer",r.textContent=n.name;const o=document.createElement("div");o.style.whiteSpace="break-spaces";const a="Rice plantation"!==n.name?`Attack:${n.stats.attack}\nRange:${n.stats.range}\nCoolDown:${n.stats.cd}`:"Produce: 100 rice\nin intervals";o.textContent=`Rice: ${n.price}\n\n${a}`,r.appendChild(o),r.onclick=()=>{const e=w();T(e);const i=C().map((e=>e.selected&&h().rice>=n.price?(x({...h(),rice:h().rice-n.price}),{...e,stats:n.stats,class:n.name,selected:!1}):e));S(i),m(t)},e.appendChild(r)}));const r=document.createElement("div");r.style.backgroundColor="blue",r.style.color="white",r.style.width="100%",r.style.cursor="pointer",r.textContent="Back",r.onclick=()=>{S(C().map((e=>({...e,selected:!1})))),m(t)},e.appendChild(r)},ce=e=>{const t=document.createElement("div");return t.style.backgroundColor="white",t.style.gridArea="1/42/28/49",t.style.display="grid",t.style.gridTemplateColumns="repeat(1, 1fr)",t.style.gridTemplateRows="repeat(6,1fr)",e.uiHtmlGrid.appendChild(t),t},le=e=>{const t=document.createElement("div");t.style.width="100%",t.style.cursor="pointer",t.textContent=`Wave ${y().wave}/10`;const i=document.createElement("div");i.textContent=`Rice: ${h().rice}`;const n=document.createElement("div");n.textContent=`Life: ${h().life}`;const r=document.createElement("div");r.style.backgroundColor="orange",r.appendChild(t),r.appendChild(i),r.appendChild(n),e.appendChild(r)},de=(e,t)=>{const i=w();N.forEach((n=>{const r=document.createElement("div");r.style.backgroundColor="gray",n===i.activeUnit&&(r.style.backgroundColor="red"),r.style.width="100%",r.style.cursor="pointer",r.textContent=n;const o=document.createElement("div");o.style.whiteSpace="break-spaces";const a="Rice Farmer"!==n?`Attack:${B[n]}\nRange:${D[n]}\nCoolDown:${J[n]}`:"Produce: 50 rice\nin intervals";o.textContent=`Rice: ${F[n]}\n\n${a}`,r.appendChild(o),r.onclick=()=>{const e=w();e.activeUnit=n,T(e),m(t)},e.appendChild(r)}))},ue=(e,t)=>{y().waveStarted||oe.forEach((i=>{const n=document.createElement("div");n.style.backgroundColor="blue",n.style.color="white",n.style.width="100%",n.style.cursor="pointer",n.textContent=i.name,n.onclick=i.handler(t),e.appendChild(n)}))},N=["Peasant","Tower","Rice Farmer","Creeper"],F={"Rice Farmer":900,Peasant:100,Tower:400,Creeper:200},B={"Rice Farmer":0,Peasant:1,Tower:3,Creeper:2},D={"Rice Farmer":0,Peasant:1,Tower:6,Creeper:3},J={"Rice Farmer":20,Peasant:4,Tower:5,Creeper:1},ge={"Rice Farmer":[{name:"Rice plantation",price:800,stats:{attack:0,range:0,cd:20}}],Peasant:[{name:"Samurai",price:400,stats:{attack:4,range:2,cd:3}},{name:"Archer",price:350,stats:{attack:1,range:5,cd:3}}],Tower:[{name:"Stone pagoda",price:600,stats:{attack:8,range:7,cd:3}}],Creeper:[{name:"Ninja",price:350,stats:{attack:2,range:4,cd:0}}]},ye={Peasant:"url('./t2.png')",Tower:"url('./t1.png')","Rice Farmer":"url('./t3.png')",Creeper:"url('./t4.png')"},he=e=>N.includes(e.name),me=(e,t)=>{t.style.background="transparent",t.style.backgroundImage=ye[e.name],t.style.backgroundSize="cover",e.selected&&(t.style.border="1px solid gold")},pe=()=>{C().forEach(((e,t)=>{we(e,t)}))},we=(e,t)=>{const i=C();if(e.shootCd>0)return i[t]={...e,shootCd:e.shootCd-1},void S(i);if("Rice Farmer"===e.name){const n=h();return n.rice+=e.class?100:50,x(n),i[t]={...e,shootCd:e.stats.cd},S(i),void m(v)}const n=f(),r=n.findIndex((t=>Math.abs(t.gridX-e.gridX)+Math.abs(t.gridY-e.gridY)<=e.stats.range&&t.stats.hp>0)),o=f();if(r>-1){const a=n[r],s={...e,targetPosition:{x:a.gridX,y:a.gridY},shootCd:e.stats.cd};i[t]=s;const l={...a,stats:{...a.stats,hp:a.stats.hp-e.stats.attack},takingDamage:!0};o[r]=l}else{const n={...e,targetPosition:void 0};i[t]=n}E(o),S(i)},fe=(e,t,i="Tower")=>({color:"purple",gridX:e,gridY:t,name:i,selected:!1,stats:{attack:B[i],range:D[i],cd:J[i]},shootCd:0}),H=(e,t)=>{const i=document.createElement("div");return i.style.backgroundColor=e.color,i.style.gridArea=`${e.gridY}/${e.gridX}`,i.style.width="30px",i.style.height="30px",i.style.justifySelf="center",i.style.alignSelf="center",t.appendChild(i),z(e)&&ie(e,i),he(e)&&me(e,i),i},d=["cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","green","green","green","green","green","green","green","brown","green","green","green","green","brown","green","green","green","green","brown","green","green","green","green","brown","green","green","green","green","green","green","green","green","green","green","green","green","green"],L=["cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","cyan","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown","brown"],be=[...L,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...d,...L];class ve{constructor(){p(this,"bgGrid"),p(this,"entityGrid"),p(this,"uiHtmlGrid"),p(this,"colCount",48),p(this,"rowCount",27),p(this,"tileSize",32),p(this,"mountainLInes",[20,25,30,35]),p(this,"mountainLines2",[1,27]),p(this,"handleClick",(e=>({clientX:t,clientY:i})=>{const n=Math.ceil((t-e.uiHtmlGrid.getBoundingClientRect().left)/32),r=Math.ceil((i-e.uiHtmlGrid.getBoundingClientRect().top)/32),o=C().findIndex((e=>e.gridX===n&&e.gridY===r));if(n>41)return;let a=null;if(n<42&&!this.mountainLInes.includes(n)&&!this.mountainLines2.includes(r)){if(-1===o&&w().activeUnit){const t=F[w().activeUnit];if(h().rice>=t){if(a=fe(n,r,w().activeUnit),!O({x:14,y:13},U(),{...u(),towers:[...C(),a]}))return console.log("Couldn't find path to village"),T({...w(),activeUnit:null}),void m(e);if(n<12)return console.log("Tried to build on water"),T({...w(),activeUnit:null}),void m(e);x({...h(),rice:h().rice-t})}}T({...w(),activeUnit:a?w().activeUnit:null}),m(e)}S([...C().map(((e,t)=>({...e,selected:t===o}))),...a?[a]:[]]),m(this)})),p(this,"handleMouseMove",(e=>({clientX:t,clientY:i})=>{const n=Math.ceil((t-e.uiHtmlGrid.getBoundingClientRect().left)/32);if(null===w().activeUnit)return;if(n>41)return void m(e);const r={gridX:n,gridY:Math.ceil((i-e.uiHtmlGrid.getBoundingClientRect().top)/32),color:"pink",name:"hover-unit"};m(e),H(r,e.uiHtmlGrid)})),this.bgGrid=document.createElement("div"),this.bgGrid.style.display="grid",this.bgGrid.style.gridTemplateColumns=`repeat(${this.colCount}, 1fr)`,this.bgGrid.style.gridTemplateRows=`repeat(${this.rowCount},1fr)`,this.bgGrid.style.width=this.tileSize*this.colCount+"px",this.bgGrid.style.height=this.tileSize*this.rowCount+"px",this.bgGrid.style.backgroundColor="white",this.bgGrid.style.margin="auto",document.body.insertAdjacentElement("afterbegin",this.bgGrid),this.entityGrid=document.createElement("div"),this.entityGrid.style.position="absolute",this.entityGrid.style.display="grid",this.entityGrid.style.gridTemplateColumns=`repeat(${this.colCount},1fr)`,this.entityGrid.style.gridTemplateRows=`repeat(${this.rowCount},1fr)`,this.entityGrid.style.width=this.tileSize*this.colCount+"px",this.entityGrid.style.height=this.tileSize*this.rowCount+"px",this.entityGrid.style.margin="auto",this.uiHtmlGrid=document.createElement("div"),this.uiHtmlGrid.style.position="absolute",this.uiHtmlGrid.style.display="grid",this.uiHtmlGrid.style.gridTemplateColumns=`repeat(${this.colCount},1fr)`,this.uiHtmlGrid.style.gridTemplateRows=`repeat(${this.rowCount},1fr)`,this.uiHtmlGrid.style.width=this.tileSize*this.colCount+"px",this.uiHtmlGrid.style.height=this.tileSize*this.rowCount+"px",this.uiHtmlGrid.style.margin="auto",this.uiHtmlGrid.addEventListener("click",this.handleClick(this)),this.uiHtmlGrid.addEventListener("mousemove",this.handleMouseMove(this))}genEls(){this.bgGrid.innerHTML="";const e=be.map((e=>{const t=document.createElement("div");return t.style.width=`${this.tileSize}px`,t.style.height=`${this.tileSize}px`,t.style.backgroundColor=e,t}));this.entityGrid.innerHTML="",e.forEach((e=>this.bgGrid.appendChild(e))),f().forEach((e=>H(e,this.entityGrid))),C().forEach((e=>H(e,this.entityGrid))),ne(this),this.bgGrid.appendChild(this.entityGrid),this.bgGrid.appendChild(this.uiHtmlGrid)}}const i=(e,t,i,n,r=2)=>[{type:"fasterEnemy",x:10,y:e,count:t,interval:r,delay:n},{type:"basicEnemy",x:10,y:e,count:i,interval:r,delay:t*r+n}],Ce={basicEnemy:(e,t)=>({name:"enemy",color:"red",type:"basicEnemy",gridX:e,gridY:t,stats:{hp:10,attack:2,speed:1,defence:2},moveCd:0}),fasterEnemy:(e,t)=>({name:"enemy",color:"hotpink",type:"fasterEnemy",gridX:e,gridY:t,stats:{hp:3,attack:1,speed:0,defence:1},moveCd:0})},Ee={groups:[{type:"fasterEnemy",x:10,y:11,count:5,interval:2,delay:0},{type:"fasterEnemy",x:10,y:17,count:5,interval:2,delay:8}]},j={groups:[{type:"fasterEnemy",x:10,y:11,count:9,interval:2,delay:0},{type:"fasterEnemy",x:10,y:17,count:9,interval:2,delay:8},{type:"basicEnemy",x:10,y:11,count:1,interval:2,delay:20},{type:"basicEnemy",x:10,y:17,count:1,interval:2,delay:28}]},Se={groups:[...j.groups,...i(7,9,1,15)]},xe={groups:[...i(7,10,0,15),...i(7,0,3,0,4),...i(11,11,0,17),...i(11,0,4,2,4),...i(17,10,0,15),...i(17,0,3,0,4)]},ke={groups:[...i(7,9,0,15),...i(7,0,3,0,4),...i(11,9,0,17),...i(11,0,4,2,4),...i(17,9,0,15),...i(17,0,4,0,4),...i(23,9,0,15),...i(23,0,3,0,4)]},Ge={groups:[...i(7,9,0,15),...i(7,0,6,0,4),...i(11,8,0,17),...i(11,0,7,2,4),...i(17,8,0,15),...i(17,0,7,0,4),...i(23,9,0,15),...i(23,0,6,0,4)]},Te={groups:[...i(4,10,0,15),...i(4,0,4,0,4),...i(7,10,0,15),...i(7,0,4,0,4),...i(11,10,0,17),...i(11,0,4,2,4),...i(17,10,0,15),...i(17,0,4,0,4),...i(23,10,0,15),...i(23,0,4,0,4)]},$e={groups:[...i(4,10,0,15),...i(4,0,6,0,4),...i(7,10,0,15),...i(7,0,6,0,4),...i(11,10,0,17),...i(11,0,6,2,4),...i(17,10,0,15),...i(17,0,6,0,4),...i(23,10,0,15),...i(23,0,6,0,4)]},Re={groups:[...i(4,11,0,15),...i(4,0,4,0,4),...i(7,11,0,15),...i(7,0,4,0,4),...i(11,11,0,17),...i(11,0,4,2,4),...i(17,11,0,15),...i(17,0,4,0,4),...i(20,11,0,15),...i(20,0,4,0,4),...i(23,11,0,15),...i(23,0,4,0,4)]},He={groups:[...i(4,0,16,0,4),...i(7,0,17,0,4),...i(11,0,17,2,4),...i(17,0,17,0,4),...i(20,0,17,0,4),...i(23,0,16,0,4)]},M=[Ee,j,Se,xe,ke,Ge,Te,$e,Re,He],Ue=(e,t)=>{if(e>M.length)return console.log("No more waves remaining. You win, I guess."),[];return M[e-1].groups.filter((e=>{const i=t-e.delay;return i>=0&&i%e.interval==0&&e.count>i/e.interval})).map((e=>(0,Ce[e.type])(e.x,e.y)))},P=(e,t)=>{E([]),S([]),e.uiHtmlGrid.innerHTML="";const i=document.createElement("div");i.textContent=t,i.style.backgroundColor="black",i.style.color="white",i.style.gridArea="1/1/28/49",i.style.display="grid",i.style.gridTemplateColumns="repeat(1, 1fr)",i.style.gridTemplateRows="repeat(6,1fr)",e.uiHtmlGrid.appendChild(i);const n=document.createElement("button");n.textContent="Start a new game click here",n.style.background="red",n.style.fontSize="20px",i.appendChild(n),n.onclick=A},v=new ve,Ye=async()=>{do{await new Promise((e=>setTimeout(e,window.wait)))}while(window.pause)},Le=()=>{if(h().life<=0)return A(),v.genEls(),void P(v,"You lost. Your country is ruined and burned!");if(E(f().map((e=>se(e)))),f().forEach(((e,t)=>{re(e.gridX,e.gridY)&&(E(f().filter(((e,i)=>i!==t))),x({...h(),life:h().life-e.stats.attack}),m(v))})),u().system.waveStarted){const e=Ue(y().wave,y().timer);e.length>0&&E([...f(),...e])}if(E(f().filter((e=>{if(e.stats.hp<=0){const t="fasterEnemy"===e.type?15:30;return x({...h(),rice:h().rice+t}),m(v),!1}return!0}))),E(f().map((e=>z(e)?{...e,takingDamage:!1}:e))),C().forEach(((e,t)=>{we(e,t)})),0===f().length&&y().waveStarted&&y().wave<10&&(x({...h(),rice:h().rice+100*y().wave}),G({...y(),waveStarted:!1}),G({...y(),wave:y().wave+1}),console.log("Wave over"),m(v)),0===f().length&&y().waveStarted&&y().wave>=10)return G({...y(),waveStarted:!1}),void P(v,"Invaders chased away! Victory is yours! ");const e=y();G({...e,timer:e.timer+1}),window.state=u()},Me=async()=>{for(;;)Le(),y().showingEndScreen||v.genEls(),await Ye()};m(v),Me()</script>