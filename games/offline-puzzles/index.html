<!doctype html><title>OFFLINE PUZZLES</title><style>#g,#p,body,html,p{margin:0;width:100%;font-size:10vh;user-select:none}#p{display:none}#g p{line-height:35vh;height:35vh}p{text-align:center}.n{display:inline-block;width:15%;position:relative}.n:after,.n:before{content:"△";position:absolute;left:0;width:100%;top:-1em}.n:after{content:"▽";top:1em}.h:after,.h:before{content:''}#i{position:fixed;font-size:15px;transition-duration:1s}#i.hide{bottom:-15px}#i:not(.hide){bottom:15px}</style><link rel=stylesheet href=print.css media=print><div id=g><p id=t>Loading<p id=m></div><div id=p><div class=c>game div</div></div><p id=i class=hide>Petite info-bulle</p><audio id=a></audio><audio id=b></audio><script>for(var id,winTxt,j,iTo,gId=document.getElementById.bind(document),to=setTimeout,lS=localStorage,titre=gId("t"),machine=gId("m"),paper=gId("p"),audio=[gId("a"),gId("b")],iDiv=gId("i"),corpus="ARST",solution="START",dontSave=!1,els=[],loaded=0,canPlay=!0,i=-1,level=0;++i<10;)i<5?machine.innerHTML+='<div class="n" id="'+i+'">.</div>':gId(i-5).addEventListener("click",clickEl);function load(){if(2<loaded)return audio[0].removeEventListener("canplaythrough",load),launch();audio[0].src="data/s"+loaded+".mp3",loaded++,audio[0].load()}function play(e){audio[0].src="data/s"+e+".mp3",audio[0].play(),audio.push(audio.shift())}function launch(){titre.textContent="Offline puzzles",lS.getItem("level")&&(corpus+="E",info("START to continue ; RESET to delete save",3e3)),setMachine()}function nextPuzzle(e,n){if(e||"START"!=solution||(e=parseInt(lS.getItem("level"))),level=e&&(n=JSON.parse(lS.getItem("save")))?e:level+1,(e=e?puzzles.splice(0,e).pop():puzzles.shift())?(corpus=e.c?e.c:"0123456789",e.t="Puzzle "+level+" : "+e.t,titre.textContent=e.t,p_setTitle(e.t),solution=e.f(),n?(solution=n.s,p_setTitle(e.t),n.c.forEach((function(e){var i=p_addCanvas(),n=document.createElement("img");n.src=e,n.addEventListener("load",(function(){i.drawImage(n,0,0)}))}))):dontSave?dontSave=!1:save(),to(window.print,500)):(titre.textContent="Thank you for playing!",corpus="BRAVO"),setMachine(),canPlay=!0,!e){for(i=0;i<5;i++)for(j=0;j<i;j++)els[i].push(els[i].shift());display()}}function display(e){for(i=0;i<5;i++)(e=gId(i)).textContent=els[i][0],e.className="n"}function setMachine(){for(i=-1;++i<5;)els[i]=corpus.split("");display()}function clickEl(e){canPlay&&(id=parseInt(e.target.id),e.pageY-gId(id).offsetTop<gId(id).clientHeight/2?els[id].push(els[id].shift()):els[id].unshift(els[id].pop()),play(0),display(),testSolve())}function testSolve(){for(canPlay=!1,i=0;i<5;i++)els[i][0]!=solution[i]&&(canPlay=!0);if(canPlay&&"START"==solution){if(solution="RESET",testSolve())return lS.clear(),dontSave=!0;solution="START"}if(!canPlay)return winTxt="GOOD!".split(""),displayWin(),!0}function displayWin(e){if(!winTxt.length)return nextPuzzle();(e=gId(5-winTxt.length)).textContent=winTxt.shift(),e.className="n h",winTxt.length?play(1):play(2),to(displayWin,400)}function rand(e){return 0===e?0:Math.random()*(e||10)|0}function sort(e){e.sort((function(e,i){return e-i}))}function save(e,n){for(lS.setItem("level",level),e={c:[],s:solution},n=paper.getElementsByTagName("canvas"),i=0;i<n.length;i++)e.c.push(n[i].toDataURL());lS.setItem("save",JSON.stringify(e)),info("progression saved")}function info(e,i){"hide"!=iDiv.className&&clearTimeout(iTo),iDiv.textContent=e,iDiv.className="",iTo=to(infoHide,i||2e3)}function infoHide(){iDiv.className="hide"}audio[0].addEventListener("canplaythrough",load),load();var nbCanvas,width=1181,nbCasesW=20,nbCasesH=9,caseW=width/nbCasesW,caseH=caseW,height=nbCasesH*caseW;function p_setTitle(e){paper.innerHTML="<p>"+e+"</p>",nbCanvas=0}function p_addCanvas(e,i,n){return nbCanvas++,i=document.createElement("canvas"),(n=document.createElement("div")).className="c",i.id="c"+nbCanvas,i.width=width,i.height=height,n.appendChild(i),paper.appendChild(n),(i=i.getContext("2d")).font="50px Arial",i.textBaseline="middle",i.textAlign="center",i.lineWidth=2,e&&p_fill(i),i}function p_gridX(e){return e*caseW}function p_gridY(e){return e*caseH}function p_fill(e){for(i=0;i<nbCasesW;i++)for(j=0;j<nbCasesH;j++)p_write(rand(),e,i,j)}function p_write(e,i,n,a,t){t||p_clearSquare(i,n,a),i.fillText(e,p_gridX(n)+caseW/2,p_gridY(a)+caseH/2)}function p_square(e,i,n){e.strokeRect(.5+p_gridX(i),.5+p_gridY(n),caseW-1,caseH-1)}function p_clearSquare(e,i,n){e.clearRect(.5+p_gridX(i),.5+p_gridY(n),caseW-1,caseH-1)}function p_lineFold(e,i,n){p_fold(e,n?i:0,n?0:i,n?i:nbCasesW,n?nbCasesH:i)}function p_fold(e,i,n,a,t){e.setLineDash([15,15]),p_line(e,i,n,a,t),e.setLineDash([])}function p_line(e,i,n,a,t){e.beginPath(),e.moveTo(p_gridX(i),p_gridY(n)),e.lineTo(p_gridX(a),p_gridY(t)),e.stroke()}function p_lineRect(e,i,n){p_line(e,n?i:0,n?0:i,n?i:width,n?height:i)}function p_clearLine(e,i,n){e.clearRect(n?p_gridX(i):0,n?0:p_gridY(i),n?caseW:width,n?height:caseH)}var puzzles=[{t:"Simple case",f:function(){var e,n,a,t=p_addCanvas(1),s=p_addCanvas(),r="";for(e=randCoor(),i=0;i<5;i++)n=e.X[i],a=e.Y[i],r+=rand(),p_square(s,n,a),p_write(r[i],t,n,a);return r}},{t:"Dashes ?",f:function(){var e,n,a,t=p_addCanvas(1),s="";for(e=randCoor(0,1),p_lineFold(t,a=2+rand((nbCasesW-1)/2|0),1),p_lineFold(t,1,1),i=0;i<5;i++)n=e[i],s+=rand(),p_write("▷",t,0,n),p_write(s[i],t,2*a-1,n);return s}},{t:"Arithmetic",f:function(e,n,a,t,s,r){var o;for(e=p_addCanvas(),a=5-nbCasesW%2,i=0;i<nbCasesH*nbCasesW/2;i++)p_write(rand(),e,rand(nbCasesW-a),rand(nbCasesH));p_clearLine(e,nbCasesH-1),p_lineFold(e,nbCasesW-a,1),p_lineFold(e,(nbCasesW-a+1)/2,1),p_lineRect(e,nbCasesH-1);do{for(i=n=0;i<nbCasesH-1;i++){for(s="",j=r=0,o=Math.min(1+rand(a),4);j<o;j++)p_write(r=rand(),e,nbCasesW-j-1,i),s=r+s;for(;j<a;)p_clearSquare(e,nbCasesW-j-1,i),j++;n+=parseInt(s),0==i?p_clearSquare(e,0,0):p_write("+",e,0,i)}}while(n<1e4||99999<n);return n+""}},{t:"More folds",f:function(){var e,n,a,t,s,r,o,d=p_addCanvas(1),l="";for(e=randCoor(0,1),[a=2*(t=(o=3+rand(nbCasesW-6))-(1+rand((o/2|0)-2)))-o,t,s=o+1+rand((nbCasesW-o-2)/2|0),r=o+2*(s-o)].forEach((function(e){p_lineFold(d,e,1)})),i=0;i<5;i++)n=e[i],l+=rand(),p_write("▷",d,a-1,n),p_write(l[i],d,r,n);return l}},{t:"Hide and seek",f:function(){var e,n,a,t,s=p_addCanvas(1),r="",o=Math.ceil(nbCasesH/2);for(n=o+rand(nbCasesW-nbCasesH-6),t=(e=2+2*rand((nbCasesH-3)/2|0))+(nbCasesH-e+1)/2,p_lineFold(s,a=e/2),p_lineFold(s,t),p_fold(s,n,t,n-o,a),p_fold(s,n+5,t,n+o+5,a),i=0;i<5;i++)p_write((r+=rand())[i],s,n+i,e);return r}},{t:"Two again",f:function(){var e,n,a,t=p_addCanvas(1),s=p_addCanvas(),r="";function o(e,i){var n=!0;return e==i&&(n=!1),[[4,1],[6,3],[6,5],[8,0],[8,3],[8,5],[8,6],[9,3],[9,5],[9,6]].forEach((function(a){a[0]==e&&a[1]==i&&(n=!1),a[0]==i&&a[1]==e&&(n=!1)})),n}for(e=randCoor(),i=0;i<nbCasesW;i++)for(j=0;j<nbCasesH;j++)if(n=rand(),i==e.X[0]&&j==e.Y[0])e.X.shift(),e.Y.shift(),p_write((r+=n)[r.length-1],t,i,j),p_write(r[r.length-1],s,i,j);else{for(;!o(n,a=rand()););p_write(n,t,i,j),p_write(a,s,i,j)}return r}},{t:"On board!",f:function(){var e,n,a=p_addCanvas(1),t=p_addCanvas(),s="",r=nbCasesH/2|0+nbCasesH%2,o=1+rand(nbCasesH-r-2);for(p_lineFold(a,r),p_lineFold(t,r),p_lineFold(t,r+o),p_lineFold(t,r-o),p_write("◉",t,0,r+o),p_write("◉",a,0,r-o-1),e=randCoor(1),i=1;i<5;i+=2)s+=n=rand(),p_write("△",t,e[i],r+o),p_write(n,a,e[i],r-o-1);for(a.scale(-1,-1),e=randCoor(1),i=0;i<nbCasesW;i++)for(j=nbCasesH/2|0;j<nbCasesH;j++)p_write(rand(),a,-i-1,-j-1);for(i=0;i<5;i+=2)s+=n=rand(),p_write("▽",t,nbCasesW-e[i]-1,r-o-1),p_write(n,a,-nbCasesW+e[i],-r-o-1);return s}},{t:"Arrow",f:function(){var e,a,t=p_addCanvas(1),s=p_addCanvas(),r="",o=nbCasesH/2;for(p_fold(s,0,0,2*(a=(6+rand(nbCasesW-nbCasesH-6))/2|0),nbCasesH),p_fold(s,0,nbCasesH,2*a,0),p_lineFold(s,a,1),p_lineFold(s,2*a,1),p_write("◉",s,2*a+nbCasesH,nbCasesH-1);(e=randCoor(1))[0]<o;);for(i=0;i<5;i++)n=rand(),r+=n,p_write("◉",t,e[i]-(0|o),nbCasesH-1),p_write(r[i],t,e[i],a);return r}},{t:"Elevator",f:function(){var e,n,a,t,s,r,o,d,l=p_addCanvas(1),p=p_addCanvas(),c="";for(n=nbCasesH-4,a=(nbCasesW-nbCasesH)/2|0,s=(nbCasesW-2)/3|0;(e=randCoor(0,1))[0]<2||e[4]>2+n-1;);function f(e){r=a+nbCasesH,p_write("✂",l,a+.5,e-.5,!0),p_line(l,a,e,r,e)}for(e=e.sort((function(e,i){return rand(2)||-1})),l.setLineDash([5,5]),f(1),f(2),f(2+n),f(3+n),p_write("▽",l,d=a+nbCasesH/2|0,nbCasesH/2|0),p_write("◉",l,d,1),p_write("◉",l,d,nbCasesH-2),p_write("▷",p,nbCasesW-1,nbCasesH/2|0),i=0;i<5;i++)i%2==0&&e[i]>e[i+1]&&(o=e[i],e[i]=e[i+1],e[i+1]=o),c+=rand(),t=rand(2),p_write(c[i],l,t?a-1:a+nbCasesH,e[i]),o=t?nbCasesH-1:0,p_write("◉",p,r=nbCasesW-3-(i/2|0)*s,nbCasesH/2|0),p_write("◉",p,r-n+1,nbCasesH/2|0),p_write(t?"▽":"△",p,r-(n-e[i])-1,o);return c}},{t:"End with a joke",f:function(){for(var e=p_addCanvas(),a="",t="";-1==a.indexOf("9");)for(i=0;i<5;i++)n=rand(2),a=(n?9:8)+a,t+=n?6:8;return e.fillText(t,width/2,height/2),a}}];function randCoor(e,n,a){do{for(a={X:[],Y:[]},i=0;i<5;i++)a.X.push(rand(nbCasesW)),a.Y.push(rand(nbCasesH));sort(a.X),sort(a.Y),e&&(a.Y=null),n&&(a.X=null)}while(testSame(a.X,a.Y));return e?a.X:n?a.Y:a}function testSame(e,n){for(n=n||[0,0,0,0,0],e=e||[0,0,0,0,0],i=0;i<4;i++)if(e[i]==e[i+1]&&n[i]==n[i+1])return!0;return!1}</script>