<!doctype html><meta content="width=device-width,user-scalable=0,user-scalable=no,minimum-scale=1,maximum-scale=1" name=viewport><style>#c,body,html{margin:0;padding:0;border:0;position:absolute}body,html{width:100%;height:100%}@media (min-aspect-ratio:16/9){#c{max-height:100%}}@media (max-aspect-ratio:16/9){#c{max-width:100%}}</style><canvas height=1080 id=c width=1920></canvas><script>function SfxrParams(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var s=.18/e;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){var t,i,e,s,h,n,a,r,o,c,l,u;this._params=new SfxrParams,this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),h=100/(t.g*t.g+.001),n=1-t.h*t.h*t.h*.01,a=-t.i*t.i*t.i*1e-6,t.a||(l=.5-t.n/2,u=5e-5*-t.o),r=1+t.l*t.l*(0<t.l?-.9:10),o=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,i=s.c*s.c*1e5,e=s.e*s.e*1e5+12,3*((t+i+e)/3|0)},this.synthWave=function(v,p){var f=this._params,d=1!=f.s||f.v,y=f.v*f.v*.1,_=1+3e-4*f.w,g=f.s*f.s*f.s*.1,x=1+1e-4*f.t,w=1!=f.s,b=f.x*f.x,m=f.g,M=f.q||f.r,S=f.r*f.r*f.r*.2,T=f.q*f.q*(f.q<0?-1020:1020),k=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,P=f.d,I=f.j/2,z=f.k*f.k*.01,F=f.a,A=t,N=1/t,R=1/i,D=1/e,X=5/(1+f.u*f.u*20)*(.01+g);.8<X&&(X=.8),X=1-X;for(var Y,B,U,C,L,E,W=!1,O=0,q=0,Z=0,j=0,H=0,V=0,G=0,$=0,J=0,K=0,Q=new Array(1024),tt=new Array(32),it=Q.length;it--;)Q[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<p;it++){if(W)return it;if(k&&++J>=k&&(J=0,this.reset()),c&&++o>=c&&(c=0,s*=r),h<(s*=n+=a)&&(s=h,0<m&&(W=!0)),B=s,0<I&&(K+=z,B*=1+Math.sin(K)*I),(B|=0)<8&&(B=8),F||((l+=u)<0?l=0:.5<l&&(l=.5)),++q>A)switch(q=0,++O){case 1:A=i;break;case 2:A=e}switch(O){case 0:Z=q*N;break;case 1:Z=1+2*(1-q*R)*P;break;case 2:Z=1-q*D;break;case 3:W=!(Z=0)}M&&((U=0|(T+=S))<0?U=-U:1023<U&&(U=1023)),d&&_&&((y*=_)<1e-5?y=1e-5:.1<y&&(y=.1)),E=0;for(var et=8;et--;){if(B<=++G&&(G%=B,3==F))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(F){case 0:L=G/B<l?.5:-.5;break;case 1:L=1-G/B*2;break;case 2:L=.225*(((L=1.27323954*(C=6.28318531*(.5<(C=G/B)?C-1:C))+.405284735*C*C*(C<0?1:-1))<0?-1:1)*L*L-L)+L;break;case 3:L=tt[Math.abs(32*G/B|0)]}d&&(Y=V,(g*=x)<0?g=0:.1<g&&(g=.1),w?(H+=(L-V)*g,H*=X):(V=L,H=0),j+=(V+=H)-Y,L=j*=1-y),M&&(Q[$%1024]=L,L+=Q[($-U+1024)%1024],$++),E+=L}E*=.125*Z*b,v[it]=1<=E?32767:E<=-1?-32768:32767*E|0}return p}}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var i=synth.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),s=2*synth.synthWave(new Uint16Array(e.buffer,44),i),h=new Uint32Array(e.buffer,0,44);h[0]=1179011410,h[1]=s+36,h[2]=1163280727,h[3]=544501094,h[4]=16,h[5]=65537,h[6]=44100,h[7]=88200,h[8]=1048578,h[9]=1635017060,h[10]=s,s+=44;for(var n=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="data:audio/wav;base64,";n<s;n+=3){var o=e[n]<<16|e[n+1]<<8|e[n+2];r+=a[o>>18]+a[o>>12&63]+a[o>>6&63]+a[63&o]}return r},function(t){"use strict";var i=function(){return M.__string_rec(this,"")},e=e||{};function s(t,i){var e=Object.create(t);for(var s in i)e[s]=i[s];return i.toString!==Object.prototype.toString&&(e.toString=i.toString),e}var h=function(t){this.g=t};h.__name__=!0,h.prototype={update:function(t,i){},mouseMove:function(t,i){},click:function(t,i){},pan:function(t,i){},zoom:function(t,i,e){}};var n=function(t,i){h.call(this,t),this.rtn=new k(i.canvas.width/2,i.canvas.height/2,"Return to menu",(function(){t.menu()}))};n.__name__=!0,n.__super__=h,n.prototype=s(h.prototype,{update:function(t,i){h.prototype.update.call(this,t,i),t.fillStyle="#FFF",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.font="200px arial",t.fillStyle="#000";var e=t.canvas.width/2-t.measureText(n.TXT).width/2;t.fillText(n.TXT,e,.25*t.canvas.height),this.rtn.render(t)},mouseMove:function(t,i){h.prototype.mouseMove.call(this,t,i),this.rtn.mouseMove(t,i)},click:function(t,i){h.prototype.click.call(this,t,i),this.rtn.click(t,i)}});var a=function(){this.dir=0,this.x=0,this.y=0,this.xSpeed=0,this.ySpeed=0,this.aabb=new S};a.__name__=!0,a.prototype={update:function(t){if(this.x+=this.xSpeed*t,this.y+=this.ySpeed*t,this.aabb.x+=this.xSpeed*t,this.aabb.y+=this.ySpeed*t,0!=this.xSpeed||0!=this.ySpeed){var i=Math.atan2(this.ySpeed,this.xSpeed);this.dir=i<0?i+2*Math.PI:i>2*Math.PI?i-2*Math.PI:i}},render:function(t){}};var r=function(t){this.mouseStart=null,this.panning=!1,this.isMouseDown=!1,this.c=t,this.menu()};r.__name__=!0,r.prototype={update:function(t){null!=this.r&&this.r.update(this.c,t)},onMouseDown:function(t,i){this.isMouseDown=!0,this.panning=!1,this.mouseStart={x:t,y:i}},onMouseUp:function(t,i){this.isMouseDown=!1},onMouseMove:function(t,i,e,s){null!=this.r&&this.r.mouseMove(t,i),this.isMouseDown&&(10<Math.sqrt(Math.pow(t-this.mouseStart.x,2)+Math.pow(i-this.mouseStart.y,2))&&(this.panning=!0),this.panning&&this.pan(e,s))},pan:function(t,i){null!=this.r&&this.r.pan(t,i)},zoom:function(t,i,e){null!=this.r&&this.r.zoom(t,i,e)},onClick:function(t,i){null==this.r||this.panning||this.r.click(t,i)},loadLevel:function(t){var i=new u(this,this.c);i.loadLevel(t),this.r=i},menu:function(){this.r=new I(this,this.c)},end:function(){this.r=new n(this,this.c)}};var o=function(t,i,e,s,h,n){a.call(this),this.aabb.x=t,this.aabb.y=i,this.aabb.w=e,this.aabb.h=s,this.l=h,this.r=n};o.__name__=!0,o.__super__=a,o.prototype=s(a.prototype,{update:function(t){a.prototype.update.call(this,t);for(var i=this.p=0,e=this.r.player;i<e.length;){var s=e[i];++i,s.aabb.check(this.aabb)&&this.p++}},render:function(t){a.prototype.render.call(this,t),t.fillStyle="#0000FF55",t.fillRect(this.aabb.x,this.aabb.y,this.aabb.w,this.aabb.h)}});var c=function(){this.snd=[{n:"clap",d:[3,0,.0293,0,.1749,.247,0,-.5214,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,.55]},{n:"distr",d:[0,.115,.16,0,.355,.51,0,.2099,0,.3916,.0752,0,0,.1278,0,0,0,0,1,0,0,0,0,.395]},{n:"found",d:[0,0,.5222,.3277,.0934,.7885,0,.03,.033,-.0054,-.0021,-.5854,.6463,.557,.7781,.2525,-3e-4,-.0656,.8835,.0016,.3551,.0025,0,.395]},{n:"step1",d:[1,.095,.32,0,0,.51,.135,-.74,-1,0,0,-1,0,0,-1,.345,-.4499,.01,.53,-.35,.265,.11,.02,.555]},{n:"step2",d:[1,.0511,.32,0,0,.5437,.1309,-.7242,-.9818,.0347,0,-1,0,.0093,-1,.345,-.4499,.01,.53,-.3157,.3054,.1452,.02,.555]},{n:"step3",d:[1,.0511,.291,0,0,.5238,.1309,-.7035,-.9525,.0347,0,-.9892,0,.041,-1,.345,-.4499,.0077,.5635,-.2912,.2558,.1518,.0545,.555]},{n:"step4",d:[1,.036,.2565,.0376,0,.4758,.1309,-.6627,-.9525,.0347,0,0,.021,.0038,-1,.345,-.4499,.0088,.5635,-.2912,.2558,.161,.0369,.555]}],this.lvl=[{wl:[{c:[[32,0],[32,32],[192,32],[192,0]]},{c:[[0,0],[32,0],[32,608],[0,608]]},{c:[[192,224],[448,224],[448,0],[192,0]]},{c:[[416,224],[416,384],[448,384],[448,224]]},{c:[[448,384],[192,384],[192,608],[448,608]]},{c:[[32,576],[32,608],[192,608],[192,576]]}],gl:[{l:1,h:64,x:48,y:32,w:128}],g:32,h:19,en:[],pl:[{x:112,y:528},{x:368,y:304}],w:14},{wl:[{c:[[544,352],[544,96],[576,96],[576,352]]},{c:[[576,352],[320,352],[320,384],[576,384]]},{c:[[544,256],[480,256],[480,224],[544,224]]},{c:[[416,256],[416,224],[288,224],[288,384],[320,384],[320,256]]},{c:[[288,288],[224,288],[224,384],[288,384]]},{c:[[224,224],[0,224],[0,384],[224,384]]},{c:[[0,96],[224,96],[224,0],[0,0]]},{c:[[224,32],[288,32],[288,0],[224,0]]},{c:[[288,96],[576,96],[576,0],[288,0]]},{c:[[32,96],[32,224],[0,224],[0,96]]}],gl:[{l:2,h:128,x:32,y:96,w:48}],g:32,h:12,en:[{a:0,x:464,y:144,nav:[[304,144],[208,144],[112,144],[144,176],[272,176],[368,176],[496,176],[464,144]]}],pl:[{x:400,y:304},{x:464,y:304}],w:18},{wl:[{c:[[0,0],[1024,0],[1024,32],[0,32]]},{c:[[416,128],[640,128],[640,320],[608,320],[608,160],[448,160],[448,320],[416,320]]},{c:[[800,128],[800,192],[864,192],[864,128]]},{c:[[800,320],[800,384],[864,384],[864,320]]},{c:[[800,512],[800,576],[864,576],[864,512]]},{c:[[192,128],[192,192],[256,192],[256,128]]},{c:[[192,320],[192,384],[256,384],[256,320]]},{c:[[192,512],[192,576],[256,576],[256,512]]},{c:[[0,32],[0,704],[32,704],[32,32]]},{c:[[32,672],[1056,672],[1056,704],[32,704]]},{c:[[1024,0],[1024,672],[1056,672],[1056,0]]}],gl:[{l:3,h:80,x:448,y:160,w:160}],g:32,h:22,en:[{a:1.5707963267948966,x:624,y:368,nav:[]},{a:1.5707963267948966,x:432,y:368,nav:[]}],pl:[{x:912,y:560},{x:880,y:624}],w:33},{wl:[{c:[[448,384],[672,384],[672,192],[640,192],[640,352],[480,352],[480,192],[448,192]]},{c:[[32,0],[1088,0],[1088,32],[32,32]]},{c:[[832,192],[832,576],[1120,576],[1120,192]]},{c:[[832,544],[832,576],[288,576],[288,544]]},{c:[[0,192],[0,576],[288,576],[288,192]]},{c:[[0,0],[0,192],[32,192],[32,0]]},{c:[[1088,0],[1088,192],[1120,192],[1120,0]]}],gl:[{l:4,h:160,x:32,y:32,w:80}],g:32,h:18,en:[{a:4.71238898038469,x:368,y:464,nav:[[368,176],[400,112],[688,112],[752,144],[752,400],[720,464],[432,464],[368,432]]},{a:1.5707963267948966,x:752,y:112,nav:[[752,432],[688,464],[400,464],[368,400],[368,144],[432,112],[720,112],[752,176]]}],pl:[{x:528,y:304},{x:592,y:304}],w:35},{wl:[{c:[[0,0],[0,224],[224,224],[224,192],[160,192],[160,0]]},{c:[[160,32],[480,32],[480,64],[512,64],[512,32],[672,32],[672,0],[160,0]]},{c:[[288,192],[480,192],[480,128],[512,128],[512,192],[672,192],[672,224],[288,224]]},{c:[[0,224],[0,384],[32,384],[32,224]]},{c:[[288,384],[672,384],[672,416],[480,416],[480,480],[448,480],[448,416],[288,416]]},{c:[[288,384],[288,608],[0,608],[0,384]]},{c:[[288,576],[448,576],[448,544],[480,544],[480,576],[800,576],[800,608],[288,608]]},{c:[[736,384],[960,384],[960,608],[800,608],[800,416],[736,416]]},{c:[[928,384],[928,224],[960,224],[960,384]]},{c:[[672,224],[672,0],[960,0],[960,224]]},{c:[[192,320],[224,320],[224,384],[192,384]]},{c:[[736,224],[736,288],[768,288],[768,224]]}],gl:[{l:5,h:160,x:32,y:224,w:80}],g:32,h:19,en:[{a:3.141592653589793,x:656,y:336,nav:[[496,336],[304,336],[304,272],[464,272],[656,272],[656,336]]}],pl:[{x:816,y:272},{x:880,y:272}],w:30},{wl:[{c:[[128,224],[128,416],[224,416],[224,224]]},{c:[[320,512],[320,608],[416,608],[416,512]]},{c:[[416,320],[416,128],[704,128],[704,224],[512,224],[512,320]]},{c:[[704,512],[704,608],[992,608],[992,416],[896,416],[896,512]]},{c:[[1088,512],[1184,512],[1184,320],[1088,320]]},{c:[[1088,224],[1088,128],[992,128],[992,224]]},{c:[[32,32],[32,0],[1280,0],[1280,32]]},{c:[[1280,0],[1312,0],[1312,704],[1280,704]]},{c:[[1312,736],[32,736],[32,704],[1312,704]]},{c:[[32,736],[32,0],[0,0],[0,736]]}],gl:[{l:6,h:96,x:32,y:272,w:96}],g:32,h:23,en:[{a:1.5707963267948966,x:1040,y:240,nav:[]},{a:4.71238898038469,x:368,y:496,nav:[]},{a:3.141592653589793,x:656,y:368,nav:[[368,368],[368,80],[848,176],[688,368],[560,560],[1040,656],[1040,368],[720,368]]}],pl:[{x:1232,y:368},{x:1232,y:464}],w:41},{wl:[{c:[[0,0],[160,0],[160,224],[0,224]]},{c:[[0,224],[0,608],[32,608],[32,224]]},{c:[[96,288],[96,544],[128,544],[128,288]]},{c:[[0,608],[0,640],[736,640],[736,608]]},{c:[[736,608],[736,0],[704,0],[704,608]]},{c:[[0,-32],[736,-32],[736,0],[0,0]]},{c:[[320,192],[544,192],[544,160],[352,160],[352,0],[320,0]]},{c:[[320,288],[320,512],[352,512],[352,320],[544,320],[544,288]]}],gl:[{l:7,h:80,x:160,y:0,w:160}],g:32,h:20,en:[{a:0,x:144,y:368,nav:[]},{a:1.5707963267948966,x:240,y:112,nav:[]}],pl:[{x:656,y:336},{x:656,y:400}],w:23},{wl:[{c:[[96,96],[192,96],[192,0],[0,0],[0,192],[96,192]]},{c:[[0,192],[0,256],[64,256],[64,192]]},{c:[[96,256],[96,320],[0,320],[0,256]]},{c:[[0,320],[64,320],[64,384],[0,384]]},{c:[[0,512],[96,512],[96,576],[192,576],[192,448],[224,448],[224,608],[0,608]]},{c:[[224,608],[224,256],[704,256],[704,608]]},{c:[[192,256],[192,192],[256,192],[256,256]]},{c:[[192,32],[256,32],[256,0],[192,0]]},{c:[[256,0],[256,96],[320,96],[320,0]]},{c:[[320,32],[384,32],[384,0],[320,0]]},{c:[[512,0],[512,96],[672,96],[672,192],[704,192],[704,0]]},{c:[[96,384],[96,448],[0,448],[0,384]]},{c:[[0,448],[64,448],[64,512],[0,512]]},{c:[[320,192],[320,256],[384,256],[384,192]]},{c:[[448,192],[448,256],[512,256],[512,192]]},{c:[[576,192],[576,256],[704,256],[704,192]]},{c:[[384,0],[384,96],[448,96],[448,0]]},{c:[[448,32],[512,32],[512,0],[448,0]]},{c:[[192,384],[192,320],[224,320],[224,384]]}],gl:[{l:8,h:96,x:592,y:96,w:80}],g:32,h:19,en:[{a:0,x:144,y:144,nav:[]}],pl:[{x:144,y:528},{x:144,y:464}],w:22},{wl:[{c:[[0,0],[896,0],[896,32],[0,32]]},{c:[[896,0],[928,0],[928,608],[896,608]]},{c:[[928,640],[32,640],[32,608],[928,608]]},{c:[[32,640],[0,640],[0,32],[32,32]]},{c:[[192,128],[192,192],[320,192],[320,128]]},{c:[[192,448],[192,512],[320,512],[320,448]]},{c:[[608,128],[608,192],[736,192],[736,128]]},{c:[[608,448],[608,512],[736,512],[736,448]]}],gl:[{l:9,h:176,x:832,y:240,w:64}],g:32,h:20,en:[{a:1.5707963267948966,x:624,y:432,nav:[[624,208],[720,432],[720,208],[624,432]]},{a:4.71238898038469,x:304,y:208,nav:[[304,432],[208,208],[208,432],[304,208]]},{a:0,x:112,y:80,nav:[[464,80],[816,80],[816,304],[816,560],[464,560],[112,560],[112,336],[112,80]]}],pl:[{x:80,y:272},{x:80,y:368}],w:29},{wl:[{c:[[0,0],[800,0],[800,32],[0,32]]},{c:[[0,32],[0,800],[32,800],[32,32]]},{c:[[0,800],[768,800],[768,832],[0,832]]},{c:[[768,32],[768,832],[800,832],[800,32]]},{c:[[192,96],[192,288],[224,288],[224,96]]},{c:[[384,160],[384,224],[416,224],[416,160]]},{c:[[576,96],[576,288],[608,288],[608,96]]},{c:[[192,736],[192,544],[224,544],[224,736]]},{c:[[576,544],[576,736],[608,736],[608,544]]},{c:[[384,608],[384,672],[416,672],[416,608]]},{c:[[320,384],[320,448],[480,448],[480,384]]},{c:[[32,352],[96,352],[96,480],[32,480]]},{c:[[768,352],[704,352],[704,480],[768,480]]}],gl:[{l:10,h:80,x:608,y:720,w:160}],g:32,h:26,en:[{a:3.141592653589793,x:560,y:592,nav:[]},{a:1.5707963267948966,x:592,y:304,nav:[]},{a:4.71238898038469,x:304,y:208,nav:[]},{a:0,x:272,y:336,nav:[[400,336],[528,336],[528,496],[400,496],[272,496],[272,336]]}],pl:[{x:80,y:80},{x:144,y:80}],w:25},{wl:[{c:[[0,0],[864,0],[864,32],[0,32]]},{c:[[864,0],[896,0],[896,864],[864,864]]},{c:[[896,864],[896,896],[32,896],[32,864]]},{c:[[32,896],[0,896],[0,32],[32,32]]},{c:[[128,736],[128,224],[192,224],[192,736]]},{c:[[768,224],[704,224],[704,736],[768,736]]},{c:[[288,768],[288,704],[352,704],[352,768]]},{c:[[544,704],[544,768],[608,768],[608,704]]},{c:[[288,448],[288,512],[352,512],[352,448]]},{c:[[544,448],[544,512],[608,512],[608,448]]},{c:[[288,192],[288,256],[352,256],[352,192]]},{c:[[544,192],[544,256],[608,256],[608,192]]},{c:[[352,32],[352,64],[416,64],[416,32]]},{c:[[480,32],[480,64],[544,64],[544,32]]}],gl:[{l:-2,h:80,x:400,y:784,w:112}],g:32,h:28,en:[{a:0,x:336,y:592,nav:[]},{a:3.141592653589793,x:592,y:368,nav:[]},{a:1.5707963267948966,x:80,y:176,nav:[[80,368],[80,560],[80,784],[240,784],[240,592],[240,400],[240,176],[80,176]]},{a:1.5707963267948966,x:816,y:176,nav:[[816,368],[816,560],[816,784],[656,784],[656,592],[656,400],[656,176],[816,176]]}],pl:[{x:752,y:80},{x:816,y:80}],w:28}]},l=function(){};l.__name__=c.__name__=!0,l.main=function(){l.canvas=window.document.getElementById("c"),window.document.body.onresize=l.onResize,l.onResize(),l.c=l.canvas.getContext("2d",null),l.g=new r(l.c),l.s=new p(l.r.snd),window.onmousedown=l.onMouseDown,window.onmouseup=l.onMouseUp,window.onmousemove=l.onMouseMove,window.onwheel=l.onMouseWheel,window.onclick=l.onClick,window.ontouchstart=l.onTouchStart,window.ontouchmove=l.onTouchMove,window.ontouchend=l.onTouchEnd;var t=new URLSearchParams(window.location.search);t.has("l")&&l.g.loadLevel(l.r.lvl[f.parseInt(t.get("l"))]),window.requestAnimationFrame(l.update)},l.update=function(t){l.g.update((t-l.lastFrame)/1e3),l.lastFrame=t,window.requestAnimationFrame(l.update)},l.onResize=function(){var t=f.string(Math.floor((window.document.body.clientWidth-l.canvas.clientWidth)/2));l.canvas.style.left=t+"px",t=f.string(Math.floor((window.document.body.clientHeight-l.canvas.clientHeight)/2)),l.canvas.style.top=t+"px"},l.touchCenter=function(t,i){return{x:t.clientX+(i.clientX-t.clientX)/2,y:t.clientY+(i.clientY-t.clientY)/2}},l.onMouseDown=function(t){t.preventDefault(),l.g.onMouseDown((t.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(t.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight))},l.onMouseUp=function(t){t.preventDefault(),l.g.onMouseUp((t.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(t.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight))},l.onMouseMove=function(t){t.preventDefault(),l.g.onMouseMove((t.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(t.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight),t.movementX*(l.canvas.width/l.canvas.clientWidth),t.movementY*(l.canvas.height/l.canvas.clientHeight))},l.onMouseWheel=function(t){t.preventDefault(),l.g.zoom((t.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(t.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight),-.1*t.deltaY)},l.onClick=function(t){l.g.onClick((t.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(t.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight))},l.onTouchStart=function(t){if(1==t.touches.length?(l.firstTouch=t.touches[0].identifier,l.touchStart=t.timeStamp,l.pan.x=t.touches[0].clientX,l.pan.y=t.touches[0].clientY):l.firstTouch=-1,2==t.touches.length){var i=t.touches[0],e=t.touches[1];l.lastPinch=Math.sqrt(Math.pow((i.clientX-e.clientX)*(l.canvas.width/l.canvas.clientWidth),2)+Math.pow((i.clientY-e.clientY)*(l.canvas.height/l.canvas.clientHeight),2))}},l.onTouchMove=function(t){t.preventDefault();var i=t.changedTouches[0];if(2==t.touches.length){var e=t.touches[0],s=t.touches[1],h=Math.sqrt(Math.pow((e.clientX-s.clientX)*(l.canvas.width/l.canvas.clientWidth),2)+Math.pow((e.clientY-s.clientY)*(l.canvas.height/l.canvas.clientHeight),2)),n=l.touchCenter(t.touches[0],t.touches[1]);l.g.zoom(n.x,n.y,.01*(h-l.lastPinch)),l.lastPinch=h}else 1==t.touches.length&&i.identifier==l.firstTouch&&(l.g.pan((i.clientX-l.pan.x)*(l.canvas.width/l.canvas.clientWidth),(i.clientY-l.pan.y)*(l.canvas.height/l.canvas.clientHeight)),l.pan.x=i.clientX,l.pan.y=i.clientY)},l.onTouchEnd=function(t){t.preventDefault();var i=t.changedTouches[0];i.identifier==l.firstTouch&&(t.timeStamp-l.touchStart<500&&l.g.onClick((i.clientX-l.canvas.offsetLeft)*(l.canvas.width/l.canvas.clientWidth),(i.clientY-l.canvas.offsetTop)*(l.canvas.height/l.canvas.clientHeight)),l.firstTouch=-1)},Math.__name__=!0;var u=function(t,i){this.menu=null,this.delay=-1,this.currentActor=-1,this.bsp=null,this.viewZoom=1,this.viewY=0,this.viewX=0,this.lvl=null,this.ec=[],h.call(this,t),this.c=i,this.walls=[],this.player=[],this.actor=[],this.goals=[],this.snd=[],this.distractBtn=new k(120,0,"👏",F(this,this.distract),120),this.distractBtn.y=i.canvas.height-(this.distractBtn.aabb.h-20),this.volumeButton=new k(0,60,"🔊",F(this,this.toggleVolume),60)};u.__name__=!0,u.__super__=h,u.prototype=s(h.prototype,{update:function(t,i){h.prototype.update.call(this,t,i),-1!=this.delay&&(this.delay-=i,this.delay<=0&&(this.delay=-1,this.delayAction()));for(var e=0,s=this.goals;e<s.length;){var n=s[e];++e,n.update(i)}if(-1!=this.currentActor&&this.actor[this.currentActor].phase==g.TURN_END){var a=this.checkGoal();-1==a?(this.actor[this.currentActor].phase=g.IDLE,this.currentActor=this.currentActor+1>=this.actor.length?0:this.currentActor+1,this.actor[this.currentActor].phase=g.TURN_START):-2==a?this.g.end():(this.currentActor=-1,this.g.loadLevel(l.r.lvl[a]))}for(e=0,s=this.actor;e<s.length;){var r=s[e];++e,r.update(i)}for(e=0,s=this.snd;e<s.length;){var o=s[e];++e,o.update(i)}for(t.fillStyle="#AAA",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.save(),t.translate(this.viewX,this.viewY),t.scale(this.viewZoom,this.viewZoom),e=0,s=this.ec;e<s.length;){var c=s[e];++e,c.clearRect(0,0,c.canvas.width,c.canvas.height)}if(t.strokeStyle="#FFF",null!=this.bsp){for(e=1,s=this.bsp.w;e<s;){var u=e++;t.beginPath(),t.moveTo(u*this.grid,0),t.lineTo(u*this.grid,this.bsp.h*this.grid),t.stroke()}for(e=1,s=this.bsp.h;e<s;){var v=e++;t.beginPath(),t.moveTo(0,v*this.grid),t.lineTo(this.bsp.w*this.grid,v*this.grid),t.stroke()}}for(e=0,s=this.walls;e<s.length;){var p=s[e];++e,p.render(t)}for(e=0,s=this.goals;e<s.length;)n=s[e],++e,n.render(t);for(e=0,s=this.snd;e<s.length;)i=s[e],++e,i.render(t);for(e=0,s=this.actor;e<s.length;)r=s[e],++e,r.render(t);t.restore(),null!=this.menu?(t.fillStyle="#00000088",t.fillRect(.25*t.canvas.width,.125*t.canvas.height,.5*t.canvas.width,.75*t.canvas.height),this.menu.render(t)):-1!=this.currentActor&&this.actor[this.currentActor].isPlayer()&&this.distractBtn.render(t),this.volumeButton.x=t.canvas.width-this.volumeButton.aabb.w+20,this.volumeButton.render(t)},pan:function(t,i){h.prototype.pan.call(this,t,i),this.viewX+=t,this.viewY+=i},zoom:function(t,i,e){h.prototype.zoom.call(this,t,i,e);var s=(t-this.viewX)/this.viewZoom,n=(i-this.viewY)/this.viewZoom;this.viewZoom+=e,this.viewZoom<=0&&(this.viewZoom=.1),this.viewX+=((t-this.viewX)/this.viewZoom-s)*this.viewZoom,this.viewY+=((i-this.viewY)/this.viewZoom-n)*this.viewZoom},click:function(t,i){h.prototype.click.call(this,t,i);for(var e=0,s=this.player;e<s.length;){var n=s[e];++e,n.click((t-this.viewX)/this.viewZoom,(i-this.viewY)/this.viewZoom)}null!=this.menu?this.menu.click(t,i):-1!=this.currentActor&&this.actor[this.currentActor].isPlayer()&&this.distractBtn.click(t,i),this.volumeButton.click(t,i)},mouseMove:function(t,i){h.prototype.mouseMove.call(this,t,i),null!=this.menu?this.menu.mouseMove(t,i):-1!=this.currentActor&&this.actor[this.currentActor].isPlayer()&&this.distractBtn.mouseMove(t,i),this.volumeButton.mouseMove(t,i)},loadLevel:function(t){this.lvl=t,this.ec=[],this.grid=t.g,this.bsp=new w(t.w,t.h),this.walls=[];for(var i=0,e=t.wl;i<e.length;){var s=e[i];++i;var h=new d(s.c);this.walls.push(h);for(var n=this.bsp,a=Math.floor(h.aabb.x/this.grid),r=Math.floor(h.aabb.y/this.grid),c=Math.ceil(h.aabb.w/this.grid),l=Math.ceil(h.aabb.h/this.grid),u=new T(h.aabb.x-2,h.aabb.y-1,0,0),v=0,p=c;v<p;){var f=v++;u.b.x=h.aabb.x+f*this.grid+this.grid/2;for(var y=0,b=l;y<b;){var m=y++;u.b.y=h.aabb.y+m*this.grid+this.grid/2,h.countIntersect(u)%2!=0&&n.set(a+f,r+m,!0)}}}for(this.actor=[],this.player=[],i=0,e=t.pl;i<e.length;){var M=e[i];++i;var S=new x(this);S.x=M.x,S.y=M.y,S.phase=g.IDLE,this.player.push(S),this.actor.push(S)}for(i=0,e=t.en;i<e.length;){var k=e[i];++i;var P=new _(this);for(P.x=k.x,P.y=k.y,P.dir=k.a,v=0,p=k.nav;v<p.length;){var I=p[v];++v,P.ptrl.push({x:Math.floor(I[0]/this.grid),y:Math.floor(I[1]/this.grid)})}this.actor.push(P)}for(0<this.actor.length&&(this.currentActor=0,this.actor[0].phase=g.TURN_START),this.goals=[],i=0,e=t.gl;i<e.length;){var z=e[i];++i,this.goals.push(new o(z.x,z.y,z.w,z.h,z.l,this))}for(i=0,e=this.snd;i<e.length;){var F=e[i];++i,F.kill()}var A=t.w*this.grid,N=t.h*this.grid;this.viewX=this.c.canvas.width/2-A/2,this.viewY=this.c.canvas.height/2-N/2},newCanvas:function(){var t=window.document.createElement("canvas");t.width=this.c.canvas.width,t.height=this.c.canvas.height;var i=t.getContext("2d",null);return this.ec.push(i),i},spotted:function(t,i){var e=this;-1!=this.currentActor&&(this.currentActor=-1,this.delay=1,this.delayAction=function(){e.showMenu("Found!")})},showMenu:function(t){var i=this,e=this.c.canvas.width,s=this.c.canvas.height;this.menu=new P(t),this.menu.x=e/2,this.menu.y=.25*s,this.menu.add("Retry",e/2,s/2,(function(){i.menu=null,i.loadLevel(i.lvl)})),this.menu.add("Exit to menu",e/2,.75*s,(function(){i.g.menu()}))},checkGoal:function(){for(var t=0,i=this.goals;t<i.length;){var e=i[t];if(++t,e.p==this.player.length)return e.l}return-1},makeSnd:function(t,i,e){for(var s=null,h=0,n=this.snd;h<n.length;){var a=n[h];if(++h,!a.alive){s=a;break}}null==s&&(s=new v,this.snd.push(s)),s.init(t,i,e)},distract:function(){var t=this.actor[this.currentActor];this.makeSnd(t.x,t.y,50),l.s.play("clap")},toggleVolume:function(){0==l.s.v?(l.s.v=1,this.volumeButton.text="🔊"):(l.s.v=0,this.volumeButton.text="🔈")}});var v=function(){a.call(this)};v.__name__=!0,v.__super__=a,v.prototype=s(a.prototype,{init:function(t,i,e){this.x=t,this.y=i,this.v=e,this.t=0,this.r=0,this.alive=!0},update:function(t){if(a.prototype.update.call(this,t),this.alive){if(this.t+=t,1<this.t)return void this.kill();this.r+=3*this.v*t,this.aabb.x=this.x-this.r,this.aabb.y=this.y-this.r,this.aabb.w=2*this.r,this.aabb.h=2*this.r}},render:function(t){a.prototype.render.call(this,t),this.alive&&(t.strokeStyle="#FFF",t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.stroke())},kill:function(){this.alive=!1}});var p=function(t){this.s=new m,this.v=1;for(var i=0;i<t.length;){var e=t[i];++i;var s=jsfxr(e.d),h=window.document.createElement("audio");h.src=s,this.s.h[e.n]=h}};p.__name__=!0,p.prototype={play:function(t,i){null==i&&(i=1),this.s.h[t].currentTime=0,this.s.h[t].volume=this.v*i,this.s.h[t].play()}};var f=function(){};f.__name__=!0,f.string=function(t){return M.__string_rec(t,"")},f.parseInt=function(t){if(null!=t)for(var i=0,e=t.length;i<e;){var s=i++,h=t.charCodeAt(s);if(h<=8||14<=h&&32!=h&&45!=h){var n=t.charCodeAt(s+1),a=parseInt(t,120==n||88==n?16:10);return isNaN(a)?null:a}}return null};var d=function(t){a.call(this),this.e=[],this.aabb.x=t[0][0],this.aabb.y=t[0][1];for(var i=this.aabb.x,e=this.aabb.y,s=0,h=0,n=0,r=t.length;n<r;){var o=n++,c=t[o][0],l=t[o][1];this.aabb.x=Math.min(c,this.aabb.x),this.aabb.y=Math.min(l,this.aabb.y),i=Math.max(c,i),e=Math.max(l,e),0<o&&this.e.push(new T(s,h,c,l)),s=c,h=l}this.aabb.w=i-this.aabb.x,this.aabb.h=e-this.aabb.y,this.e.push(new T(s,h,t[0][0],t[0][1]))};d.__name__=!0,d.__super__=a,d.prototype=s(a.prototype,{render:function(t){a.prototype.render.call(this,t),t.fillStyle="#000",t.beginPath(),t.moveTo(this.e[0].a.x,this.e[0].a.y),t.lineTo(this.e[0].b.x,this.e[0].b.y);for(var i=1,e=this.e.length-1;i<e;){var s=i++;t.lineTo(this.e[s].b.x,this.e[s].b.y)}t.closePath(),t.fill()},renderShadow:function(t,i,e,s){for(var h=0,n=this.e;h<n.length;){var a=n[h];++h;var r=Math.atan2(a.a.y-e,a.a.x-i),o=Math.atan2(a.b.y-e,a.b.x-i);t.beginPath(),t.moveTo(a.a.x,a.a.y),t.lineTo(a.b.x,a.b.y),t.lineTo(a.b.x+Math.cos(o)*s,a.b.y+Math.sin(o)*s),t.lineTo(a.a.x+Math.cos(r)*s,a.a.y+Math.sin(r)*s),t.lineTo(a.a.x,a.a.y),t.fill()}},countIntersect:function(t){for(var i=0,e=0,s=this.e;e<s.length;){var h=s[e];++e,null!=t.getIntersect(h)&&++i}return i}});var y=function(t){this.stp=0,this.navSpeed=0,this.navIndex=0,this.navNodes=[],a.call(this),this.g=t,this.bsp=t.bsp,this.gridSize=t.grid,this.phase=g.IDLE,this.dst=new b(this.bsp)};y.__name__=!0,y.__super__=a,y.prototype=s(a.prototype,{update:function(t){if(a.prototype.update.call(this,t),this.navNodes.length>this.navIndex){var i=this.navNodes[this.navIndex];if(Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))<this.navSpeed*t)this.x=i.x,this.y=i.y,this.navIndex+=1,this.xSpeed=0,this.ySpeed=0;else{var e=Math.atan2(i.y-this.y,i.x-this.x);this.xSpeed=Math.cos(e)*this.navSpeed,this.ySpeed=Math.sin(e)*this.navSpeed,this.stp-=t,this.stp<=0&&(this.step(),this.stp=38/this.navSpeed)}}else this.phase==g.MOVING&&(this.phase=g.TURN_END)},render:function(t){a.prototype.render.call(this,t)},resetNav:function(){this.navNodes=[],this.navIndex=0,this.navSpeed=0,this.xSpeed=0,this.ySpeed=0},step:function(){},isPlayer:function(){return!1}});var _=function(t){this.rtnDir=0,this.rtnPoint=null,this.rtn=!1,this.alrt=null,this.playerFound=!1,this.canSeePlayer=!1,this.ptrlIdx=-1,y.call(this,t),this.ptrl=[],this.vc=t.newCanvas()};_.__name__=!0,_.__super__=y,_.prototype=s(y.prototype,{update:function(t){if(y.prototype.update.call(this,t),this.phase==g.TURN_START)if(null!=this.alrt||this.rtn){var i=null==this.alrt?this.rtnPoint.x:this.alrt.x,e=null==this.alrt?this.rtnPoint.y:this.alrt.y,s=Math.floor(this.x/this.gridSize),h=Math.floor(this.y/this.gridSize);if(s==i&&h==e)this.rtn=!this.rtn,this.alrt=null,this.dir=this.rtnDir;else{for(var n=this.dst.route(s,h,i,e,100),a=[],r=0,o=Math.floor(Math.min(n.length,5));r<o;){var c=r++;a.push(n[c])}this.navNodes=z.fromPoints(a,this.gridSize,!0),this.navIndex=0,this.navSpeed=128,this.phase=g.MOVING}}else 0==this.ptrl.length?this.phase=g.TURN_END:(s=Math.floor(this.x/this.gridSize),h=Math.floor(this.y/this.gridSize),this.ptrlIdx+=1,this.ptrlIdx>=this.ptrl.length&&(this.ptrlIdx=0),this.navNodes=z.fromPoints(this.dst.route(s,h,this.ptrl[this.ptrlIdx].x,this.ptrl[this.ptrlIdx].y,50),this.gridSize,!0),this.navIndex=0,this.navSpeed=128,this.phase=g.MOVING);for(this.canSeePlayer=!1,r=0,o=this.g.player;r<o.length;){var u=o[r];++r,this.canSee(u.x,u.y)&&(this.canSeePlayer=!0,this.resetNav(),this.g.spotted(this,u),this.playerFound||(this.playerFound=!0,l.s.play("found")))}for(r=0,o=this.g.snd;r<o.length;)if(t=o[r],++r,t.alive&&Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))<this.gridSize/2+t.r){null==this.alrt&&(this.rtnPoint={x:Math.floor(this.x/this.gridSize),y:Math.floor(this.y/this.gridSize)},this.rtnDir=this.dir);var v=this.alrt;this.alrt={x:Math.floor(t.x/this.gridSize),y:Math.floor(t.y/this.gridSize)},null==v||this.alrt.x==v.x&&this.alrt.y==v.y||l.s.play("distr")}},canSee:function(t,i){var e=t-this.x,s=i-this.y;if(512<Math.sqrt(Math.pow(e,2)+Math.pow(s,2)))return!1;var h,n=(h=Math.atan2(s,e))<0?h+2*Math.PI:h>2*Math.PI?h-2*Math.PI:h,a=this.dir-.5497782499999999,r=this.dir+.5497782499999999,o=a<0?Math.abs(a):Math.min(0,2*Math.PI-r),c=(h=n+o)<0?h+2*Math.PI:h>2*Math.PI?h-2*Math.PI:h;if(c<a+o||r+o<c)return!1;for(var l=new T(this.x,this.y,t,i),u=0,v=this.g.walls;u<v.length;){var p=v[u];if(++u,0<p.countIntersect(l))return!1}return!0},render:function(t){y.prototype.render.call(this,t),t.fillStyle="#F00",t.beginPath(),t.arc(this.x,this.y,this.gridSize/2,0,2*Math.PI),t.fill(),this.vc.globalCompositeOperation="source-over",this.vc.fillStyle=this.canSeePlayer?"#FF000055":"#00FF0055",this.vc.beginPath(),this.vc.moveTo(this.x,this.y),this.vc.arc(this.x,this.y,512,this.dir-.5497782499999999,this.dir+.5497782499999999),this.vc.lineTo(this.x,this.y),this.vc.fill(),this.vc.globalCompositeOperation="destination-out",this.vc.fillStyle="#000";for(var i=0,e=this.g.walls;i<e.length;){var s=e[i];++i,s.renderShadow(this.vc,this.x,this.y,262144)}t.drawImage(this.vc.canvas,0,0),null!=this.alrt&&(t.font="30px arial",t.fillStyle="#FF0",t.fillText("?",this.x,this.y))},step:function(){y.prototype.step.call(this),l.s.play("step"+f.string(Math.ceil(4*Math.random())))}});var g=e["actor.Phase"]={__ename__:!0,__constructs__:["IDLE","TURN_START","MOVING","TURN_END"],IDLE:{_hx_index:0,__enum__:"actor.Phase",toString:i},TURN_START:{_hx_index:1,__enum__:"actor.Phase",toString:i},MOVING:{_hx_index:2,__enum__:"actor.Phase",toString:i},TURN_END:{_hx_index:3,__enum__:"actor.Phase",toString:i}},x=function(t){this.dstFillCurrent=!1,y.call(this,t)};x.__name__=!0,x.__super__=y,x.prototype=s(y.prototype,{update:function(t){y.prototype.update.call(this,t),this.phase!=g.TURN_START||this.dstFillCurrent||(this.dst.fillFrom(Math.floor(this.x/this.gridSize),Math.floor(this.y/this.gridSize),10),this.dstFillCurrent=!0),this.aabb.x=this.x-this.gridSize/2,this.aabb.y=this.y-this.gridSize/2,this.aabb.w=this.gridSize,this.aabb.h=this.gridSize},render:function(t){if(y.prototype.render.call(this,t),t.fillStyle="#00F",t.beginPath(),t.arc(this.x,this.y,this.gridSize/2,0,2*Math.PI),t.fill(),this.phase==g.TURN_START){t.strokeStyle="#FF0",t.beginPath(),t.arc(this.x,this.y,this.gridSize/1.5,0,2*Math.PI),t.stroke();for(var i=Math.floor(this.x/this.gridSize),e=Math.floor(this.y/this.gridSize),s=i-10,h=i+10;s<h;)for(var n=s++,a=e-10,r=e+10;a<r;){var o=a++,c=this.dst.get(n,o);if(0<c&&c<=10){var l=c/10*255,u=255*(1-c/10);t.fillStyle="rgba("+l+", "+u+", 0, 0.3)",t.fillRect(n*this.gridSize,o*this.gridSize,this.gridSize,this.gridSize)}}}},click:function(t,i){if(this.phase==g.TURN_START){var e=Math.floor(this.x/this.gridSize),s=Math.floor(this.y/this.gridSize),h=Math.floor(t/this.gridSize),n=Math.floor(i/this.gridSize);this.navNodes=z.fromPoints(this.dst.route(e,s,h,n,10),this.gridSize,!0),this.navIndex=0,this.navSpeed=100+15*this.navNodes.length,0<this.navNodes.length&&(this.phase=g.MOVING,this.dstFillCurrent=!1)}},step:function(){y.prototype.step.call(this);var t=Math.sqrt(Math.pow(0-this.xSpeed,2)+Math.pow(0-this.ySpeed,2));this.g.makeSnd(this.x,this.y,10+.2*(t-100));var i=Math.min(1,t/250);l.s.play("step"+f.string(Math.ceil(4*Math.random())),i)},isPlayer:function(){return!0}});var w=function(t,i){this.w=t,this.h=i,this.space=[];for(var e=0,s=t;e<s;){e++;for(var h=[],n=0,a=i;n<a;)n++,h.push(!1);this.space.push(h)}};w.__name__=!0,w.prototype={get:function(t,i){return t<0||t+1>this.w||i<0||i+1>this.h||this.space[t][i]},set:function(t,i,e){t<0||t+1>this.w||i<0||i+1>this.h||(this.space[t][i]=e)}};var b=function(t){this.dirty=!1,this.space=[];for(var i=0,e=t.w;i<e;){i++;for(var s=[],h=0,n=t.h;h<n;)h++,s.push(-1);this.space.push(s)}this.bsp=t};b.__name__=!0,b.prototype={clear:function(){if(this.dirty){for(var t=0,i=this.space;t<i.length;){var e=i[t];++t;for(var s=0,h=e.length;s<h;)e[s++]=-1}this.dirty=!1}},route:function(t,i,e,s,h){var n=this;if(t<0||t>=this.bsp.w||i<0||i>=this.bsp.h||e<0||e>=this.bsp.w||s<0||s>=this.bsp.h)return[];if(0!=this.space[t][i]&&this.fillFrom(t,i,h),-1==this.space[e][s])return[];var a=function(t,i){for(var e=n.space[t][i],s=-1,h=0,a=0,r=0,o=0,c=0,l=0,u=[-1,0,1];l<u.length;){var v=u[l];++l;for(var p=0,f=[-1,0,1];p<f.length;){var d=f[p];++p,o=t+v,c=i+d,0==v&&0==d||o<0||o+1>n.bsp.w||c<0||c+1>n.bsp.h||e-(r=n.space[o][c])<2&&-1!=r&&(-1==s||r<s)&&(s=r,h=o,a=c)}}return-1!=s?{x:h,y:a}:null},r=[];r.push({x:e,y:s});for(var o=r[0];null!=o&&(o.x!=t||o.y!=i);)o=a(o.x,o.y),r.push(o);return r.reverse(),r},fillFrom:function(t,i,e){this.clear(),this.space[t][i]=0,this.calculateNeighbors(t,i,e),this.dirty=!0},calculateNeighbors:function(t,i,e){var s=this,h=this.space[t][i];if(!(e<=h)){var n=0,a=function(t,i,a){return null==a&&(a=1),!s.bsp.get(t,i)&&((-1==(n=s.space[t][i])||h+a<n)&&(s.space[t][i]=h+a,s.calculateNeighbors(t,i,e)),!0)},r=a(t+1,i),o=a(t-1,i),c=a(t,i-1),l=a(t,i+1);r&&c&&a(t+1,i-1,1.4),r&&l&&a(t+1,i+1,1.4),o&&c&&a(t-1,i-1,1.4),o&&l&&a(t-1,i+1,1.4)}},get:function(t,i){return t<0||t>=this.bsp.w||i<0||i>=this.bsp.h?-1:this.space[t][i]}};var m=function(){this.h=Object.create(null)};m.__name__=!0;var M=function(){};M.__name__=!0,M.__string_rec=function(t,i){if(null==t)return"null";if(5<=i.length)return"<...>";var s=typeof t;switch("function"==s&&(t.__name__||t.__ename__)&&(s="object"),s){case"function":return"<function>";case"object":if(t.__enum__){var h=e[t.__enum__],n=h.__constructs__[t._hx_index],a=h[n];return a.__params__?(i+="\t",n+"("+function(e){for(var s=[],h=0,n=a.__params__;h<n.length;){var r=n[h];h+=1,s.push(M.__string_rec(t[r],i))}return s}().join(",")+")"):n}if(t instanceof Array){var r="[";i+="\t";for(var o=0,c=t.length;o<c;){var l=o++;r+=(0<l?",":"")+M.__string_rec(t[l],i)}return r+"]"}var u;try{u=t.toString}catch(o){return"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var v=t.toString();if("[object Object]"!=v)return v}r="{\n",i+="\t";var p=null!=t.hasOwnProperty,f=null;for(f in t)p&&!t.hasOwnProperty(f)||"prototype"!=f&&"__class__"!=f&&"__super__"!=f&&"__interfaces__"!=f&&"__properties__"!=f&&(2!=r.length&&(r+=", \n"),r+=i+f+" : "+M.__string_rec(t[f],i));return r+"\n"+(i=i.substring(1))+"}";case"string":return t;default:return String(t)}};var S=function(t,i,e,s){null==s&&(s=0),null==e&&(e=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.w=e,this.h=s};S.__name__=!0,S.prototype={check:function(t){var i,e,s,h,n,a,r=this.x,o=this.y;return r<t.x||r>t.x+t.w||o<t.y||o>t.y+t.h?(r=this.x+this.w,o=this.y,a=!(r<t.x||r>t.x+t.w||o<t.y||o>t.y+t.h)):a=!0,a?n=!0:(r=this.x,o=this.y+this.h,n=!(r<t.x||r>t.x+t.w||o<t.y||o>t.y+t.h)),n?h=!0:(r=this.x+this.w,o=this.y+this.h,h=!(r<t.x||r>t.x+t.w||o<t.y||o>t.y+t.h)),h?s=!0:(r=t.x,o=t.y,s=!(r<this.x||r>this.x+this.w||o<this.y||o>this.y+this.h)),s?e=!0:(r=t.x+t.w,o=t.y,e=!(r<this.x||r>this.x+this.w||o<this.y||o>this.y+this.h)),e?i=!0:(r=t.x,o=t.y+t.h,i=!(r<this.x||r>this.x+this.w||o<this.y||o>this.y+this.h)),!!i||(r=t.x+t.w,o=t.y+t.h,!(r<this.x||r>this.x+this.w||o<this.y||o>this.y+this.h))}};var T=function(t,i,e,s){this.a={x:t,y:i},this.b={x:e,y:s}};T.__name__=!0,T.prototype={getVector:function(){return{x:this.b.x-this.a.x,y:this.b.y-this.a.y}},getIntersect:function(t){var i=this.getVector(),e=t.getVector(),s=i.x*e.y-e.x*i.y;if(0==s)return null;var h=(e.x*(this.a.y-t.a.y)-e.y*(this.a.x-t.a.x))/s,n=0;if(0!=e.x)n=(this.a.x-t.a.x+i.x*h)/e.x;else{if(0==e.y)return null;n=(this.a.y-t.a.y+i.y*h)/e.y}return h<0||1<h||n<0||1<n?null:{x:this.a.x+i.x*h,y:this.a.y+i.y*h}}};var k=function(t,i,e,s,h){null==h&&(h=30),a.call(this),this.x=t,this.y=i,this.text=e,this.callback=s,this.size=h,this.over=!1,this.aabb.h=1.2*h+40,this.font=(null==h?"null":""+h)+"px arial"};k.__name__=!0,k.__super__=a,k.prototype=s(a.prototype,{render:function(t){a.prototype.render.call(this,t),t.font=this.font;var i=t.measureText(this.text).width;this.aabb.w=i+40,this.aabb.x=this.x-i/2,this.aabb.y=this.y-this.size/2,t.fillStyle=this.over?"#888":"#aaa",t.fillRect(this.aabb.x,this.aabb.y,this.aabb.w,this.aabb.h),t.fillStyle="#000",t.fillText(this.text,this.aabb.x+20,this.aabb.y+this.size+20)},mouseMove:function(t,i){var e=this.aabb;this.over=!(t<e.x||t>e.x+e.w||i<e.y||i>e.y+e.h)},click:function(t,i){var e=this.aabb;t<e.x||t>e.x+e.w||i<e.y||i>e.y+e.h||this.callback()}});var P=function(t){this.btn=[],a.call(this),this.title=t};P.__name__=!0,P.__super__=a,P.prototype=s(a.prototype,{add:function(t,i,e,s){this.btn.push(new k(i,e,t,s))},render:function(t){a.prototype.render.call(this,t),t.strokeStyle="#000",t.fillStyle="#FFF",t.font="60px arial";var i=t.measureText(this.title).width;t.fillText(this.title,this.x-i/2,this.y),t.strokeText(this.title,this.x-i/2,this.y);for(var e=0,s=this.btn;e<s.length;){var h=s[e];++e,h.render(t)}},mouseMove:function(t,i){for(var e=0,s=this.btn;e<s.length;){var h=s[e];++e,h.mouseMove(t,i)}},click:function(t,i){for(var e=0,s=this.btn;e<s.length;){var h=s[e];++e,h.click(t,i)}}});var I=function(t,i){h.call(this,t),this.playBtn=new k(i.canvas.width/2,.5*i.canvas.height,"Play",(function(){t.loadLevel(l.r.lvl[0])})),this.fsBtn=new k(i.canvas.width/2,.75*i.canvas.height,"Fullscreen",(function(){window.document.body.requestFullscreen()}))};I.__name__=!0,I.__super__=h,I.prototype=s(h.prototype,{update:function(t,i){h.prototype.update.call(this,t,i),t.fillStyle="#FFF",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.font="200px arial",t.fillStyle="#000";var e=t.canvas.width/2-t.measureText("404").width/2;t.strokeText("404",e,.25*t.canvas.height),this.playBtn.render(t),this.fsBtn.render(t)},click:function(t,i){h.prototype.click.call(this,t,i),this.playBtn.click(t,i),this.fsBtn.click(t,i)},mouseMove:function(t,i){h.prototype.mouseMove.call(this,t,i),this.playBtn.mouseMove(t,i),this.fsBtn.mouseMove(t,i)}});var z=function(){};function F(i,e){return null==e?null:(null==e.__id__&&(e.__id__=t.$haxeUID++),null==i.hx__closures__?i.hx__closures__={}:s=i.hx__closures__[e.__id__],null==s&&(s=e.bind(i),i.hx__closures__[e.__id__]=s),s);var s}z.__name__=!0,z.fromPoints=function(t,i,e){null==e&&(e=!1);var s=[];if(null==t)return s;for(var h=e?i/2:0,n=0;n<t.length;){var a=t[n];++n,s.push({x:a.x*i+h,y:a.y*i+h})}return s},t.$haxeUID|=0,String.__name__=!0,Array.__name__=!0,M.__toStr={}.toString,n.TXT="Thanks for playing!",l.r=new c,l.lastFrame=0,l.firstTouch=-1,l.touchStart=0,l.pan={x:0,y:0},l.lastPinch=0,l.main()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)</script>