<!doctype html><title>Before it Back OnLine - js13kGames 2019</title><meta content="width=device-width,user-scalable=no" name=viewport><script src=/2019/webxr/aframe.js></script><script>(()=>{var t=Math.PI;AFRAME.registerComponent("rotation-ctrl",{tick:function(){var n=this.el.object3D.rotation;if(window.gameRunning){var e=t/4;n.y=-t/2,n.x>e/2&&(n.x=e/2),n.x<-e&&(n.x=-e),n.set(n.x,n.y,n.z)}else n.y=0,n.x=0}})})()</script><style>body{font-family:"Liberation Sans",Arial,sans-serif}#browserBG{position:absolute;z-index:10;top:0;bottom:0;left:0;right:0;border:35px solid #08e;border-left:105px solid #08e;border-right:105px solid #08e;transition:2s}.game-on #browserBG{border:0 solid #08e}#browser{position:absolute;top:30px;bottom:30px;left:100px;right:100px;border:6px solid #ccc;border-radius:9px 9px 5px 5px;box-shadow:5px 5px 20px rgba(0,0,0,.6);z-index:10;transition:2s}.game-on #browser{top:-6px;bottom:-6px;left:-6px;right:-6px}#browserHeader{position:absolute;top:0;left:0;right:0;padding:20px 0 8px 5px;background:#ccc;font-size:14px;white-space:nowrap;transition:1.5s 1.5s}.post-game #browserHeader{transition:2s}.game-on #browserHeader{top:-100px}#browserHeader::before{content:"\21BA";display:inline-block;color:#666;border:1px solid #999;border-radius:20px;padding:5px;width:17px;text-align:center;font-size:22px;line-height:17px;overflow:hidden;vertical-align:middle}#browserHeader::after{content:"\D7";position:absolute;top:5px;right:5px;color:#a33;background:#d88;border:1px solid #b66;border-radius:20px;padding:5px;width:8px;line-height:8px;text-align:center;overflow:hidden;vertical-align:middle}#browserURL{display:inline-block;background:#fff;border:1px solid #777;border-radius:20px;padding:5px 10px;width:75%;vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#browserMsg{position:absolute;top:5px;right:20px;font-size:8vw;text-align:right;font-weight:700;text-shadow:-1px -1px 4px #fff,1px 1px 4px #fff;transition:5s}.game-on #browserMsg{opacity:0}#browserMsg small{display:block;font-size:3.5vw;font-weight:400}</style><body class="game-off pre-game"><a-scene background="color: #FFF" id=scene vr-mode-ui="enabled: false"><a-assets><canvas id=cSky></canvas><canvas id=cFloor></canvas><canvas id=cCactus></canvas></a-assets><a-camera active far=15 id=cam look-controls="enabled: true" position="0 3 10" rotation="0 0 0" rotation-ctrl wasd-controls="enabled: false"><a-entity id=camContent visible><a-entity id=lifeBar position="-11 7 -10" line__length="start: 0, 0, 0; end: 3, 0, 0; color: #800" line__pct="start: 0, 0, 0; end: 3, 0, 0; color: #F00"></a-entity><a-text align=right anchor=right color=#FFF font=exo2bold id=odometerI position="-10.1 6.5 -10" value=0 width=20></a-text><a-text align=left anchor=left color=#FFF font=exo2bold id=odometerD position="-10.16 6.37 -10" value=.00 width=14></a-text><a-text align=left anchor=left color=#FFF font=exo2bold id=odometerUnd position="-9.25 6.5 -10" value=km width=20></a-text><a-box color=#A04 depth=.1 height=.1 position="0 -.1 -.05" width=.12></a-box><a-box color=#A04 depth=.025 height=.025 position="-.033 -.06 -.092" width=.025 rotation="-30 55 55"></a-box><a-box color=#A04 depth=.025 height=.025 position="+.033 -.06 -.092" width=.025 rotation="-30 55 55"></a-box></a-entity></a-camera><a-sky animation__rotation="property: rotation.z; to: 450; dur: 240000; loop: true; easing: linear; startEvents: start; pauseEvents: pause" id=sky material="fog: false" radius=5000 rotation="0 0 90" src=#cSky><a-light color=#FFF id=ambientLight intensity=0 type=ambient></a-light><a-light color=#FFF id=sunLight intensity=0 type=directional position="0 -6000 0" x=.5></a-light><a-light color=#48F id=moonLight intensity=0 type=directional position="0 6000 0" x=.4></a-light></a-sky><a-entity id=dino position="0 0 0" color=#C00></a-entity><a-entity id=florLine line="start: -20,   0, 0; end: 20,   0, 0; color: #000"></a-entity><a-entity id=floor position="5000 0 0" animation="property: position.x; to: 0; dur: 900000; loop: true; easing: linear; startEvents: start; pauseEvents: pause"><a-plane height=10200 id=floorPlane material="src:#cFloor; repeat: 900 900" opacity=0 position="0 0 0" rotation="-90 0 0" width=10200></a-plane></a-entity></a-scene><div id=browserBG></div><div id=browser><div id=browserHeader><div id=browserURL>https://js13kgames.com/games/dino</div></div><p id=browserMsg>You are off-line!</div><script>const DEBUG=!!document.location.href.match(/debug/);var tempCactus,round=Math.round,rnd=Math.random,random=(t,e)=>e?rnd()*(e-t)+t:rnd()*t,abs=Math.abs,PI=Math.PI,cactus=[],mountains=[],log=(...t)=>DEBUG&&console.log(...t),life=1,lifeBarLineLength=lifeBar.getObject3D("line__length"),lifeBarLinePct=lifeBar.getObject3D("line__pct"),lifeBarLinePctPos=lifeBarLinePct.geometry.attributes.position,distanceInc=0,gameStatus="PRE GAME",html=document.documentElement;setInterval((()=>lifeBarLineLength.material.linewidth=lifeBarLinePct.material.linewidth=window.innerHeight/40),1e3),html.requestFS=html.requestFullscreen||html.mozRequestFullScreen||html.webkitRequestFullscreen,window.addEventListener("click",(()=>{var t=html.requestFS();t&&t.then((()=>screen.orientation.lock("landscape-primary"))).catch((t=>{}))}));var mk=function(t,e,i){var o=document.createElement("a-"+t);for(var a in e)o.setAttribute(a,e[a]);return i?i.appendChild(o):scene.appendChild(o),o};function getStarsData(t,e,i){if(getStarsData.data)return getStarsData.data;t.fillStyle="#000",t.fillRect(0,0,e,i);var o,a;for(t.fillStyle="#FFF",a=3;a<i-3;a+=2){t.beginPath();var n=abs(a-i/2)/(i/2),r=1+e*(.001*Math.asin(n)**10);for(o=2*r;o<e-2*r;o+=2*r)if(rnd()<.01){let e=rnd()+.5;t.ellipse(o,a,r*e,1*e,0,0,2*PI)}t.fill()}return getStarsData.data=t.getImageData(0,0,e,i)}function initEnv(){log("Game init."),floor.components.animation.config.loopComplete=()=>{log("Animation Loop Complete. distanceInc: "+(distanceInc+=5e3))},browserMsg.innerHTML+="<small>Touch the screen, before it back on-line.</small>",window.addEventListener("click",(()=>{"PRE GAME"==gameStatus&&(document.body.className="game-on",prepareGame())}))}function prepareGame(){gameStatus="PREPARING",cam.setAttribute("animation__pos","property: position; to: .4 1.7 0; dur: 6000"),cam.setAttribute("animation__far","property: far; to: 5100; dur: 6000"),ambientLight.setAttribute("animation","property: intensity; to: .8; dur: 2000"),floorPlane.setAttribute("animation","property: opacity; to: 1; delay: 500; dur: 2000"),mountains.forEach((t=>t.setAttribute("animation","property: opacity; to: 1; delay: 1000; dur: 2000"))),setTimeout((()=>florLine.setAttribute("visible",!1)),1e3),setTimeout(startGame,6e3)}function endGame(){window.gameRunning=!1,document.body.className="game-off post-game";var t=getDist();browserMsg.innerHTML=`You are dead.<small>You ran for ${t[1]}.${t[2]}km.</small>`,sky.dispatchEvent(new Event("pause")),floor.dispatchEvent(new Event("pause")),cam.setAttribute("animation__pos","property: position; to: 0 3 10; dur: 6000"),cam.setAttribute("animation__rot","property: rotation; to: 0 0 0; dur: 600"),cam.setAttribute("animation__far","property: far; to: 15; dur: 6000"),ambientLight.setAttribute("animation__col","property: color; to: #FFF; dur: 1000"),ambientLight.setAttribute("animation__int","property: intensity; to: 0; delay: 4000; dur: 2000"),sunLight.setAttribute("intensity",0),moonLight.setAttribute("intensity",0),floorPlane.setAttribute("animation","property: opacity; to: 0; delay: 2000; dur: 2000"),mountains.forEach((t=>t.setAttribute("animation","property: opacity; to: 0; delay: 1000; dur: 2500"))),cactus.forEach((t=>t.g.setAttribute("animation","property: rotation; to: 0 0 0; dur: 1500"))),setTimeout((()=>florLine.setAttribute("visible",!0)),1e3),setTimeout((()=>dino.setAttribute("position","0 0 0")),500),camContent.setAttribute("visible",!1)}function startGame(){gameStatus="STARTED",dino.setAttribute("position","0 -99 0"),cam.setAttribute("position","0 1.5 0"),cam.setAttribute("rotation","0 -90 0"),cam.setAttribute("far",5100),camContent.setAttribute("visible",!0),window.gameRunning=!0,cactus.forEach((t=>t.g.setAttribute("rotation",`0 ${t.g.baseRotation} 0`))),tempCactus.setAttribute("position","0 -9 0"),setTimeout((()=>sky.dispatchEvent(new Event("start"))),2e3),setTimeout((()=>floor.dispatchEvent(new Event("start"))),2e3),window.addEventListener("click",jump),window.addEventListener("keydown",jump)}function jump(t){"keydown"==t.type&&"ArrowUp"!=t.key&&" "!=t.key||!cam.jumping&&window.gameRunning&&(cam.jumping=!0,cam.setAttribute("animation","property: position.y; to: 4; dur: 500; easing: easeOutSine"),setTimeout((()=>{cam.setAttribute("animation","property: position.y; to: 1.5; dur: 600; easing: easeInSine")}),600),setTimeout((()=>{cam.jumping=!1,cam.removeAttribute("animation")}),1200))}function tic(){if(window.gameRunning){var t=sky.object3D.rotation.z,e=(t>PI?t-2*PI:t)/PI,i=abs(e);if(i<.4)ambientLight.setAttribute("color","rgb(0,0,255)");else if(i<.6){let t=round(255*(i-.4)/.2);ambientLight.setAttribute("color",`rgb(${t},${t},255)`)}else ambientLight.setAttribute("color","rgb(255,255,255)");var o=e<0?e<-.8?.5-2.5*(1+e):0:e<.5?e**2*2:.5;sunLight.setAttribute("intensity",o),ambientLight.setAttribute("intensity",o+.3);var a=-floor.object3D.position.x;placeCactus(round(a),!0);var n=getDist();odometerI.setAttribute("value",n[1]),odometerD.setAttribute("value","."+n[2]),touchACactus(a)&&(life-=.25,ambientLight.setAttribute("color","rgb(255,0,0)"),life<=0&&(life=0,endGame())),lifeBarLinePctPos.array[3]=3*life,lifeBarLinePctPos.needsUpdate=!0}}function getDist(){for(var t=round((5e3-floor.object3D.position.x+distanceInc)/10).toString();t.length<3;)t="0"+t;return t.match(/^(.*)(..)$/)}function touchACactus(t){if(cam.jumping)return!1;var e=!1;return cactus.forEach((i=>{0==i.z&&t-.2<i.x&&t+.2>i.x&&(e=!0,i.z=9999)})),e}function mkCactus(t,e,i,o){var a="#0B0";zNoize=abs(e)<.1?random(-.6,.6):e+random(-10,10);var n=rnd()<.5?random(-80,-100):random(80,100),r=mk("entity",{position:`${t} 0 ${zNoize}`,rotation:`0 ${n} 0`,height:i,radius:o,color:a},floor);return mk("cylinder",{position:`0 ${i/2} 0`,height:i,radius:1.25*o,color:a},r),mk("cylinder",{position:`-${i/6} ${.6*i} 0`,rotation:"0 0 90",height:i/3,radius:o,color:a},r),mk("cylinder",{position:`+${i/6} ${.5*i} 0`,rotation:"0 0 90",height:i/3,radius:o,color:a},r),mk("cylinder",{position:`-${i/3} ${.7333*i} 0`,height:i/4,radius:o,color:a},r),mk("cylinder",{position:`+${i/3} ${.6666*i} 0`,height:i/3,radius:o,color:a},r),mk("sphere",{position:`0 ${i} 0`,radius:1.25*o,color:a},r),mk("sphere",{position:`-${i/3} ${.8666*i} 0`,radius:o,color:a},r),mk("sphere",{position:`-${i/3} ${.6*i} 0`,radius:o,color:a},r),mk("sphere",{position:`+${i/3} ${.8333*i} 0`,radius:o,color:a},r),mk("sphere",{position:`+${i/3} ${.5*i} 0`,radius:o,color:a},r),r.baseRotation=n,r.baseZ=e,cactus.push({x:t,z:e,g:r}),r}HTMLElement.prototype.mk=function(t,e){return mk(t,e,this)},HTMLElement.prototype.selfRemove=function(){this.parentNode.removeChild(this)},(()=>{var t=cSky.width=2e3,e=cSky.height=1e3,i=cSky.getContext("2d");i.putImageData(getStarsData(i,t,e),0,0);var o=i.createLinearGradient(0,0,0,e);o.addColorStop(0,"rgba(255,255,255, 1)"),o.addColorStop(.12,"rgba(255,255,255, 0)"),o.addColorStop(.3,"rgba(  0,  0,200, 0)"),o.addColorStop(.6,"rgba(  0,100,200, 1)"),o.addColorStop(.85,"rgba(  0,128,255, 1)"),o.addColorStop(1,"rgba(255,255,255, 1)"),i.fillStyle=o;for(let o=0;o<5;o++){i.beginPath();let a=e/2+e/15*(o-1),n=e/2+e/15*(o-5);i.moveTo(0,a),i.bezierCurveTo(.25*t,a,.25*t,n,.5*t,n),i.bezierCurveTo(.75*t,n,.75*t,a,t,a),i.lineTo(t,e),i.lineTo(0,e),i.fillStyle=4==o?"#08F":`rgba(0,128,255,${.2*o})`,i.fill()}i.fillStyle="#999",i.fillRect(0,0,t,.07*e),i.fillStyle="#FE0",i.fillRect(0,.93*e,t,e)})(),scene.addEventListener("loaded",initEnv),setInterval(tic,33),setInterval((()=>{life>0&&(life+=.01),life>1&&(life=1)}),1e3),(()=>{var t=cFloor.width=512,e=cFloor.height=512,i=cFloor.getContext("2d");i.fillStyle="#DB7",i.fillRect(0,0,t,e);for(let o=4;o<t;o+=8)for(let t=4;t<e;t+=8)i.beginPath(),i.arc(random(o-2,o+2),random(t-2,t+2),3,0,2*PI),i.fillStyle=rnd()<.5?"#CA6":"#EC8",i.fill()})();var lastIniX=null;function placeCactus(t,e){if(t!=lastIniX){lastIniX=t;var i=t+120;if(rnd()<.1){var o=random(10,100);rnd()<.5&&(o*=-1),mkCactus(i,o,random(1.7,2.2),random(.15,.22))}rnd()<.04&&mkCactus(i,0,random(1.7,2.2),random(.15,.22)),t>-120&&placeCactus(t-5e3),cactus=cactus.filter((i=>!e||!(i.x<t-1&&i.x>t-1e3||t<-4990&&i.x>-1e3)||(i.g.parentNode.removeChild(i.g),!1)))}}for(let t=0;t>-150;t--)placeCactus(t-5e3);function plotPix(t,e,i,o=1,a=1,n=1){o/=10,a/=10,n/=10,t=(t-data[0].length/2)/10,e=(e-data.length)/-10;var r="#"+round(random(150,180)).toString(16)+round(random(10,30))+round(random(50,70));mk("box",{position:`${t} ${e} ${i}`,width:o,height:a,depth:n,color:r},dino)}mkCactus(random(-5009,-5004),0,1.8,.15),tempCactus=mkCactus(random(-4997,-4995),.01,1.8,.15),mkCactus(random(-4994,-4992),0,1.7,.13),cactus.forEach((t=>t.g.setAttribute("rotation","0 0 0"))),(()=>{for(let t=0;t<4900;t+=600){let e=random(150,330),i=random(0,360),o=random(300,2e3)*(rnd()<.5?-1:1);mountains.push(mk("icosahedron",{position:`${t} 0 ${o}`,radius:e,opacity:0,color:"#DB7",rotation:`0 ${i} 0`},floor)),mountains.push(mk("icosahedron",{position:`${t-5e3} 0 ${o}`,radius:e,opacity:0,color:"#DB7",rotation:`0 ${i} 0`},floor)),mountains.push(mk("sphere",{position:`${t} ${.3*-e} ${-o}`,radius:e,opacity:0,color:"#DB7","segments-height":5,"segments-width":5,rotation:"90 0 0"},floor)),mountains.push(mk("sphere",{position:`${t-5e3} ${.3*-e} ${-o}`,radius:e,opacity:0,color:"#DB7","segments-height":5,"segments-width":5,rotation:"90 0 0"},floor))}})(),data=["           ####    ","          ### #####","          #########","          #########","          #####    ","          ######## ","         ####      ","#       #####      ","#      ########    ","##    ####### #    ","###  ########      ","#############      "," ############      ","  ##########       ","   #########       ","    #### ##        ","     ##   #        ","     #    #        ","     ##   ##       "],data.forEach(((t,e)=>t.split("").forEach(((t,i)=>"#"==t?plotPix(i,e,0):null)))),DEBUG&&scene.setAttribute("stats",!0)</script>