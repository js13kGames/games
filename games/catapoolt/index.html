<meta content="width=device-width,user-scalable=no,viewport-fit=cover" name=viewport><title>Catapoolt - js13kGames 2025</title><style>*{margin:0;padding:0;box-sizing:border-box}body,html{background-color:#000;margin:0;padding:0;width:100%;height:100%;overflow:hidden;position:fixed;font-family:Arial,sans-serif}body{display:flex;justify-content:center;align-items:center}#c{background-color:#000;border:2px solid #333;cursor:default;transition:cursor .1s ease;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;max-width:100vw;max-height:100vh;width:auto;height:auto}@media (max-width:600px),(max-height:600px){#c{border:none}}</style><canvas height=600 id=c width=800></canvas><script>!function(){let t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(let t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(let s of t)if("childList"===s.type)for(let t of s.addedNodes)"LINK"==t.tagName&&"modulepreload"==t.rel&&i(t)}).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.t)return;t.t=!0;let i=function(t){let i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"==t.crossOrigin?i.credentials="include":"anonymous"==t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();let t=(()=>{let t=navigator.userAgent.toLowerCase(),i=/iphone|ipad|ipod/.test(t),s=t.includes("android"),h=i||s||t.includes("mobile");return{i:i,h:s,l:h,o:!h,userAgent:t}})();class i{constructor(){this.u=!1}get M(){return this.u}p(){this.u=!0}}var s=(t=>(t[t.CLICK=0]="CLICK",t[t.m=1]="MOUSE_DOWN",t[t.v=2]="MOUSE_UP",t[t.S=3]="MOUSE_MOVE",t[t.k=4]="MOUSE_LEAVE",t))(s||{});class h extends i{constructor(t,i,s){super(),this.C=t,this.A=i,this.type=s}}function e(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}let n="catapoolt_highScore";class r{constructor(t){this.P=t,this.$=500,this.alpha=0,this.currentTime=0,this.children=[],this.bgColor="#FFFFFF"}add(...t){this.children.push(...t)}R(t){this.children.map(i=>i.R(t)),this.currentTime+=t,this.alpha=this.currentTime<this.$?e(this.currentTime/this.$):1,this.F(t)}F(t){}W(t){t.fillStyle=this.bgColor,t.fillRect(0,0,c.width,c.height),this.children.map(i=>{t.save(),t.translate(i.D.x,i.D.y),i.W(t),t.restore()}),this.alpha<1&&(t.globalAlpha=1-this.alpha,t.fillStyle=this.bgColor,t.fillRect(0,0,c.width,c.height),t.globalAlpha=1)}T(){return this.alpha>=1}H(){let t=window.innerWidth<window.innerHeight,i=t?.75:1.3333333333333333,{innerWidth:s,innerHeight:h}=window,e=s/i<=h,n=e?s:h*i,r=e?s/i:h,o=t?600:800,l=t?800:600,a=1.5*o,d=1.5*l,f=Math.floor(n),u=Math.floor(r);if(f<o||u<l){let t=Math.max(o/f,l/u);f=Math.floor(f*t),u=Math.floor(u*t)}if(f>a||u>d){let t=Math.min(a/f,d/u);f=Math.floor(f*t),u=Math.floor(u*t)}c.width=f,c.height=u,this.I()}I(){}L(t,i){this.O(new h(t,i,s.CLICK))}B(t,i){this.O(new h(t,i,s.m))}V(t,i){this.O(new h(t,i,s.v))}G(t,i){this.O(new h(t,i,s.S))}U(t,i){this.O(new h(t,i,s.k))}O(t){for(let i of this.children)if(i.O(t),t.M)return;t.M||this.N(t)}N(t){}destroy(){}}let o=null,l=()=>(o||(o=new(window.AudioContext||window.webkitAudioContext)),"suspended"==o.state&&o.resume(),o);window.Pico8=function(t,i){let s=t.split("\n"),h=i.split("\n"),e=0,n=(t,i,s)=>parseInt(t.substr(i,s),16),r=[t=>Math.abs(2*t-1)-1,t=>.5*(.9>t?2*t/.9-1:2*(1-t)/(1-.9)-1),t=>.6*(.5>t?t:t-1),t=>.5>t?.5:-.5,t=>.3>t?.5:-.5,t=>(.5>t?3-Math.abs(24*t-6):1-Math.abs(16*t-12))/9,()=>{let t=(e+.02*(2*Math.random()-1))/1.02;return e=t,10*t},(t,i)=>(Math.abs((t+.5*Math.abs(i/128%1*2-1))%1*4-2)-Math.abs(8*t-4))/6],o={},a=(t,i)=>{{let g=t+"-"+i;var h=o[g];if(!h){{t=s[t];let o=(h=n(t,2,2))/120,g=n(t,4,2),m=n(t,6,2)||32,b=44100*m,M=l().createBuffer(1,b,44100),w=M.getChannelData(0),S=0,A=0,D=0;var e=24;let v=260;var c=-1;let z=-1;var d=-1;let P,W,V,R,C;for(;S<b;){P=n(t,8+5*D,2)+i,W=65*2**(P/12),V=n(t,5*D+10,1),R=n(t,5*D+11,1)/8,C=n(t,5*D+12,1);var f=D+1>=m?g:D+1,u=n(t,8+5*f,2)+i,y=n(t,5*f+10,1),x=n(t,5*f+11,1),p=n(t,5*f+12,1);for(f=.02,(4==C||V==c&&(P==e||1==C)&&0<z&&5!==d)&&(f=0),e=.05,(5==C||V==y&&(P==u||1==p)&&0<x&&4!==p)&&(e=0),u=44100*o+.5|0,y=7<V&&a(V-8,i+P-24),x=0,c=S;c<S+u;c++){p=1,(d=(c-S)/u)<f?p=d/f:d>1-e&&(p=(1-d)/e);let s=W,o=R;1==C&&(s=(1-d)*v+d*W,0<z&&(o=(1-d)*z+d*R)),2==C&&(s*=1+.02*Math.sin(7.5*d)),3==C&&(s*=1-d),4==C&&(o*=d),5==C&&(o*=1-d),6<=C&&(s=65*2**((n(t,8+5*(-4&D|(8>=h?32:16)/(6==C?4:8)*d&3),2)+i)/12)),A+=s/44100,8>V?w[c]+=o*p*r[V](A%1,A):(w[c]+=o*p*y[x],x=(x+1)%y.length)}S+=u,e=P,v=W,c=V,z=R,d=C,D=D+1>=m?g:D+1}h=M}o[g]=h}return h}},c=(t,i,s,h,e=0)=>{for(h=a(h,e).getChannelData(0),e=0;i<s;)t[i]+=h[e],e=(e+1)%h.length,i++},d=(t,i=!1,s=0)=>{let h=l().createBufferSource();return h.buffer=t,h.loop=i,h.loopStart=s,h.connect(l().destination),h.start(),h};this.j=t=>d(a(t,0)),this.q=t=>{var i=[];let e=[],r=0;var o=0;let a=h.length-1;for(var f=t;f<=a;f++){var u=h[f],y=n(u,0,2);i[f]=0;for(var x=0;4>x;x++){var p=n(u,3+2*x,2);if(p<s.length&&0==n(s[p],6,2)){i[f]=x;break}}if(u=n(u,3+2*i[f],2),u=n(s[u],2,2)/120,e[f]=1411200*u+.5|0,!(1&~y)&&(r=o),o+=32*u,!(2&~y)){a=f;break}}for(i=44100*o,o=(i=l().createBuffer(1,i,44100)).getChannelData(0),f=0;t<=a;t++){for(y=h[t],u=e[t],x=0;4>x;x++)(p=n(y,3+2*x,2))<s.length&&c(o,f,f+u,p);f+=u}return d(i,!0,r)},this._=()=>l()};var a=(t=>(t[t.Y=19]="Beep",t[t.K=20]="Stretching",t[t.J=21]="ReleaseWobble",t[t.X=22]="Poop",t[t.Z=23]="Smacking",t[t.tt=25]="Landing",t))(a||{});let d=new Pico8("001480000000000000000000000000000000000000000000222540000021254000000000000000000000000000000000000000000000000000000000000000001a25400000182540000000000000000000000000\n011400001306515065160651306013060130601a0601a0601a0601d0651f0651a0601a0601a0601106011060110651d0651106518065180651a065180601806021060210601f0661f0661f0601f0601f0601f060\n001400001355515555165550e5500e5500e5501355013550135501d5551f5551655016550165500e5500e550115551d55511555155551555515555155501555021550215501f5561f5561f5501f5501f5501f550\n00140000004250042500425074250742507425074250a4250742507425074250a4250a4250a4250a4250e4250a4250a4250a42505425054250542505425094250542505425054250042500425004250042504425\n01041b000000000000000000000000000000002d23000030000302d230000302d232000202d2202d2200002021220000202d220000202d2102e210000102e210000102e2002e200000002e202000000000000000\n000814000000000000000002e3102d3102a310283102531122311203111d3111b3111931115311004000040000000000000000000000000000000000000000000000000000000000000000000000000000000000\n011400002e020300203202030020300202e0202b0202b020290202b020290202e0202e020290202602026020290202b020290202d0252d0252902024020240202902029025290252902529020280202402024020\n00140000221201f1201f1201f1201f120221201f120000001a1201a1201a1201d1201d1201a12000000000001812018120181201d1201d1200000000000000001812018120181200c12000000130501f1201f120\n011400000035500355003551a42000000000001a4200000000000000000000000000000000000000000000000000000000000001a42000000000001a420000000e040110400e0400c040160400c0401604013040\n001400000000000000000001f42000000000001f4200000000000000000000000000000000000000000000000000000000000001f42000000000001f420000000000000000000000000000000000000000000000\n001400000000000000000001342000000000001342000000000000000000000000000000000000000000000000000000000000013420000000000013420000000000000000000000000000000000000000000000\n0014000000000000000000000000000000000000000000001f040210401f040220401f040260401f04024040220401f0401830000300003000030000300003001a0401d0401a040180402204024040220401f040\n00140000004550045500455074300040000400074300040000400074300040009430004000040009430004000040009430004000a43000400004000a43000400004000a430004000c43000400004000c43000400\n001400000040000400004001f43018400184001f43018400184001f43018400214301840018400214301840018400214300040022430004000040022430184000040022430004002443000400004002243021430\n001400000040000400004000e43000400004000e43000400004000e430004000e43000400004000e43000400004000e430004000e43000400004000e43000400004000e430004000e43000400004000e43000400\n001400000000000000000001f43000000000001f43000000000001f43000000214300000000000214300000000000214300000022430000000000022430000000000022430000002643000000000002643000000\n001400000000000000000001f430000000000000000000000000000000000001d4300000000000000000000000000000000000000000000000000000000000001843000000000001843000000000000000000000\n001400000000000000000002243000000000000000000000000000000000000224300000000000000000000000000000000000000000000000000000000000001d43000000000001c43000000000000000000000\n001400000000000000000001a430000000000000000000000000000000000001a4300000000000000000000000000000000000000000000000000000000000002143000000000001f43000000000000000000000\n000a01000f31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n00051000110201302015020210200c0200e0201e02010020120201d02013030100201c02014030140301403000000000000000000000000000000000000000000000000000000000000000000000000000000000\n000217000760010750107501c750177501475010750147500b750027500a75014750127500a750067500355003550005500655002550087500275002750016000000000000000000000000000000000000000000\n000218000251007310073100831007310053100231000310083100831004430023300833008330083300333003330026300863004530035300253001520005200110001100011000110001100011000110002100\n0002150029560275602756028560295602a5602a5602b56035760367602d5602d5602d5602d5602d560267603e7603e7603e7603d7603d7600000000000000000000000000000000000000000000000000000000\n00061100015400054002540025400554007540075400a5400854006540095400654005540085400554004540035403d5003d5003d500087000670000000000000000000000000000000000000000000000000000\n0002060000730033300773002630055500265003600000001150012500125000a1000e1000f100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","00 03404445\n00 03440544\n00 03400504\n00 03004445\n00 01420344\n00 01020304\n00 01020300\n00 01020300\n00 03064740\n00 03060744\n00 01060300\n00 01060300\n00 03054344\n00 03440504\n00 08090a0b\n00 08090a0b\n00 0c0d0e4f\n00 0c0e0f05\n00 0c0d0e06\n00 0c0e0f06\n00 0c0d0e06\n00 0c0e0f05\n00 10031112\n00 03101112\n00 03020145\n00 01020304\n00 01020005\n00 01424345"),f=null,u=1,y=null,x=t=>{d.j(t)},p=()=>{f&&(f.stop(),f=null)};class g{constructor(t,i,s=0,h=0){this.width=t,this.height=i,this.D={x:s,y:h}}R(t){}W(t){}O(t){t.M||this.N(t)}N(t){}it(t,i){this.D.x=t,this.D.y=i}st(t,i){this.width=t,this.height=i}}class m extends g{constructor({width:t,height:i=t,x:s=0,y:h=s,text:e,ht:n,isEnabled:r=!0,fontSize:o=16}){super(t,i,s,h),this.isVisible=!0,this.currentState=0,this.isEnabled=!0,this.fontSize=16,this.text=e,this.ht=n,this.isEnabled=r,this.fontSize=o}et(t,i){return t>=this.D.x&&t<=this.D.x+this.width&&i>=this.D.y&&i<=this.D.y+this.height}W(t){if(!this.isVisible)return;this.isEnabled||(this.currentState=3);let i=1==this.currentState?{rt:"#e0e0e0",border:"#999",text:"#000"}:2==this.currentState?{rt:"#d0d0d0",border:"#666",text:"#000"}:3==this.currentState?{rt:"#f5f5f5",border:"#ccc",text:"#999"}:{rt:"#f0f0f0",border:"#aaa",text:"#000"};t.fillStyle=i.rt,t.fillRect(0,0,this.width,this.height),t.strokeStyle=i.border,t.lineWidth=2,t.strokeRect(0,0,this.width,this.height),t.save(),t.fillStyle=i.text,t.textAlign="center",t.textBaseline="middle",t.font=`${this.fontSize}px Arial`,t.fillText(this.text,this.width/2,this.height/2),t.restore()}N(t){if(this.isEnabled){if(t instanceof h){let i=this.et(t.C,t.A);switch(t.type){case s.S:i?0==this.currentState&&(this.currentState=1,c.style.cursor="pointer"):1!=this.currentState&&2!=this.currentState||(this.currentState=0,c.style.cursor="default");break;case s.m:i&&(this.currentState=2,t.p());break;case s.v:2==this.currentState&&(this.currentState=i?1:0);break;case s.CLICK:i&&(x(a.Y),this.ht(),t.p())}}}else c.style.cursor="default"}}class b extends g{constructor(t,i,s="Arial",h="normal",e=0,n=0){super(t.length*i*.6,1.2*i,e,n),this.text=t,this.fontSize=i,this.fontFamily=s,this.fontWeight=h}nt(t){this.fontSize=t,this.width=this.text.length*t*.6,this.height=1.2*t}W(t){t.fillStyle="#000",t.textAlign="center",t.textBaseline="middle",t.font=`${this.fontWeight} ${this.fontSize}px ${this.fontFamily}`,t.fillText(this.text,0,0)}}class M extends g{constructor(t,i,s="Arial",h="normal",e=0,n=0){super(0,1.2*i,e,n),this.text=t,this.fontSize=i,this.fontFamily=s,this.fontWeight=h,this.lt=[],this.time=0,this.amplitude=15,this.frequency=.002,this.ot=.5,this.ct()}ct(){this.lt=[];let t=.7*this.fontSize,i=0,s=Array.from(this.text);for(let h=0;h<s.length;h++){let e=s[h];this.lt.push({char:e,dt:h*this.ot,x:i}),i+=" "==e?.7*t:t*(new RegExp("\\p{Emoji}","u").test(e)?1.5:1.2)}this.width=i}nt(t){this.fontSize=t,this.height=1.2*t,this.ct()}ft(t,i,s){this.amplitude=t,this.frequency=i,this.ot=s,this.ct()}R(t){this.time+=t}W(t){t.fillStyle="#000",t.font=`${this.fontWeight} ${this.fontSize}px ${this.fontFamily}`,this.lt.map(i=>{" "!==i.char&&t.fillText(i.char,-this.width/2+i.x,Math.sin(this.time*this.frequency+i.dt)*this.amplitude)})}}class w extends m{constructor({width:t,height:i=t,x:s=0,y:h=s,fontSize:e=16}){super({width:t,height:i,x:s,y:h,text:"🔊",ht:()=>{this.ut=(u=0==u?1:0,y&&(y.gain.value=u),0==u),this.Mt()},fontSize:e}),this.ut=!1,this.ut=0==u,this.Mt()}Mt(){this.text=this.ut?"🔇":"🔊"}}class S extends g{constructor(t){super(32,32,0,0),this.wt=!1,this.gt=t}W(t){t.save(),t.beginPath(),t.arc(16,16,16,0,6.28),t.fillStyle=this.wt?"#ff6b6b":"#ff4757",t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(8,8),t.lineTo(24,24),t.moveTo(24,8),t.lineTo(8,24),t.stroke(),t.restore()}N(t){if(!(t instanceof h))return;let i=this.xt(t.C,t.A);t.type==s.S?(this.wt=i,c.style.cursor=i?"pointer":"default"):i&&(t.type==s.CLICK&&this.gt(),t.p())}xt(t,i){let s=t-(this.D.x+16),h=i-(this.D.y+16);return s*s+h*h<=256}}class A extends g{constructor({title:t,width:i,height:s,bt:h,buttons:e}){super(i,s),this.isVisible=!1,this.buttons=[],this.yt=300,this.vt=0,this.St=0,this.currentScale=0,this.kt=0,this.bt=h,this.body={x:0,y:0,width:i,height:s},this.title=new b(t,24,"Arial","bold"),this.close=new S(()=>this.Ct()),e&&(this.buttons=e.map(({text:t,L:i})=>new m({width:180,height:45,text:t,fontSize:16,ht:i})))}At(){this.isVisible||(this.isVisible=!0,this.St=1,this.vt=0,this.currentScale=0,this.kt=0,this.H())}Pt(t){this.title=new b(t,24,"Arial","bold")}$t(t){this.Rt=new b(t,16,"Arial","normal")}Ct(){this.isVisible&&2!=this.St&&(this.St=2,this.vt=0)}N(t){if(this.isVisible&&2!=this.St)if(1==this.St&&this.kt<.8)t instanceof h&&t.p();else if(this.close.O(t),!t.M){for(let i of this.buttons)if(i.O(t),t.M)return;if(t instanceof h&&t.type==s.CLICK&&(i=t.C,e=t.A,!(i>=(n=this.body).x&&i<=n.x+n.width&&e>=n.y&&e<=n.y+n.height)))return this.Ct(),void t.p();var i,e,n;t instanceof h&&t.p()}}H(){if(!this.isVisible)return;let t=(c.width-this.body.width)/2,i=(c.height-this.body.height)/2;this.body.x=t,this.body.y=i,this.title.it(t+.5*this.body.width,i+50),this.Rt&&this.Rt.it(t+.5*this.body.width,i+90),this.close.it(t+this.body.width-47,i+15);let s=60*this.buttons.length-15,h=i+this.body.height-s-40,e=t+.5*(this.body.width-180);this.buttons.map((t,i)=>{t.it(e,h+60*i)})}R(t){if(this.isVisible){if(this.St){this.vt+=t;let i=Math.min(this.vt/this.yt,1),s=e(i);1==this.St?(this.currentScale=function(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}(i),this.kt=s,i>=1&&(this.St=0,this.currentScale=1,this.kt=1)):(this.currentScale=1-s,this.kt=1-s,i>=1&&(this.St=0,this.isVisible=!1,this.currentScale=0,this.kt=0,this.bt?.()))}2!==this.St&&(this.title.R(t),this.Rt&&this.Rt.R(t),this.close.R(t),this.buttons.map(i=>i.R(t)))}}W(t){if(!this.isVisible)return;t.fillStyle=`rgba(0,0,0,${.7*this.kt})`,t.fillRect(0,0,c.width,c.height);let{x:i,y:s,width:h,height:e}=this.body,n=i+.5*h,r=s+.5*e;t.save(),t.translate(n,r),t.scale(this.currentScale,this.currentScale),t.globalAlpha=this.kt,t.translate(-n,-r),t.fillStyle="#fff",this.roundRect(t,i,s,h,e,8),t.fill(),t.strokeStyle="#333",t.lineWidth=2,this.roundRect(t,i,s,h,e,8),t.stroke(),this.zt(t,this.title),this.Rt&&this.zt(t,this.Rt),this.zt(t,this.close),this.buttons.map(i=>this.zt(t,i)),t.restore()}zt(t,i){t.save(),t.translate(i.D.x,i.D.y),i.W(t),t.restore()}roundRect(t,i,s,h,e,n){t.beginPath(),t.moveTo(i+n,s),t.lineTo(i+h-n,s),t.quadraticCurveTo(i+h,s,i+h,s+n),t.lineTo(i+h,s+e-n),t.quadraticCurveTo(i+h,s+e,i+h-n,s+e),t.lineTo(i+n,s+e),t.quadraticCurveTo(i,s+e,i,s+e-n),t.lineTo(i,s+n),t.quadraticCurveTo(i,s,i+n,s),t.closePath()}}class D{constructor(t=0,i=0){this.x=t,this.y=i}static Ft(t,i=1){return new D(Math.cos(t)*i,Math.sin(t)*i)}static random(){let t=Math.random()*Math.PI*2;return D.Ft(t)}static add(t,i){return new D(t.x+i.x,t.y+i.y)}static sub(t,i){return new D(t.x-i.x,t.y-i.y)}static Wt(t,i){return new D(t.x*i,t.y*i)}static Dt(t,i){let s=t.x-i.x,h=t.y-i.y;return Math.sqrt(s*s+h*h)}Et(){return new D(this.x,this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}Wt(t){return this.x*=t,this.y*=t,this}div(t){return 0!==t&&(this.x/=t,this.y/=t),this}Tt(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.Tt();return t>0&&this.div(t),this}Ht(t){return this.normalize(),this.Wt(t),this}It(t){return this.Tt()>t&&this.Ht(t),this}heading(){return Math.atan2(this.y,this.x)}set(t,i){return this.x=t,this.y=i,this}}class v{constructor(t,i,s={}){this.Lt=2,this.Ot=15,this.Bt=[],this.position=new D(t,i),this.Vt=D.random(),this.acceleration=new D(0,0),this.Gt=s.Gt??2,this.Ut=s.Ut??.05,this.size=s.size??6,this.Nt=0,this.jt=s.jt??25,this.qt=s.qt??80,this._t=s._t??.3,this.Yt=s.Yt??25,this.Kt=s.Kt??1.5,this.Jt=s.Jt??100,this.Xt=s.Xt??2,this.color="#7f7f7f",this.Zt=s.Zt??"#000000",this.strokeWidth=s.strokeWidth??1;for(let t=0;t<this.Ot;t++)this.Bt[t]={x:this.position.x,y:this.position.y}}R(){this.Vt.add(this.acceleration),this.Vt.It(this.Gt),this.position.add(this.Vt),this.acceleration.Wt(0);let t=this.Vt.x<0,i=4*this.size,s=-i/2,h=i/2,e=this.position.x+(t?h-2:s+2),n=this.position.y+.6*this.size;this.Bt[0]={x:e,y:n};for(let t=1;t<this.Ot;t++){let i=this.Bt[t-1],s=this.Bt[t],h=Math.atan2(s.y-i.y,s.x-i.x);this.Bt[t]={x:i.x+this.Lt*Math.cos(h),y:i.y+this.Lt*Math.sin(h)}}}Qt(t){this.acceleration.add(t)}ti(){this.Nt+=2*(Math.random()-.5)*this._t;let t=this.Vt.Et();t.normalize(),t.Wt(this.qt),t.add(this.position);let i=this.Vt.heading(),s=new D(this.jt*Math.cos(this.Nt+i),this.jt*Math.sin(this.Nt+i)),h=D.add(t,s);this.seek(h)}ii(t){let i=new D(0,0),s=0;for(let h of t){let t=D.Dt(this.position,h.position);if(t>0&&t<this.Yt){let e=D.sub(this.position,h.position);e.normalize(),e.div(t),i.add(e),s++}}return s>0&&(i.div(s),i.normalize(),i.Wt(this.Gt),i.sub(this.Vt),i.It(this.Ut*this.Kt)),i}seek(t){let i=D.sub(t,this.position);i.Ht(this.Gt);let s=D.sub(i,this.Vt);s.It(this.Ut),this.Qt(s)}si(t,i=100){let s=D.Dt(this.position,t);if(s>i)return new D(0,0);let h=D.sub(this.position,t);h.Ht(this.Gt);let e=D.sub(h,this.Vt);e.It(this.Ut);let n=(i-s)/i;return e.Wt(n),e}hi(t,i){this.position.x<this.size&&(this.position.x=this.size,this.Vt.x=Math.abs(this.Vt.x)),this.position.x>t-this.size&&(this.position.x=t-this.size,this.Vt.x=-Math.abs(this.Vt.x)),this.position.y<this.size&&(this.position.y=this.size,this.Vt.y=Math.abs(this.Vt.y)),this.position.y>i-this.size&&(this.position.y=i-this.size,this.Vt.y=-Math.abs(this.Vt.y))}ei(t,i,s=50){let h=new D(0,0),e=2*this.Gt;if(this.position.x<s){let t=(s-this.position.x)/s;h.x+=e*t}if(this.position.x>t-s){let i=(this.position.x-(t-s))/s;h.x-=e*i}if(this.position.y<s){let t=(s-this.position.y)/s;h.y+=e*t}if(this.position.y>i-s){let t=(this.position.y-(i-s))/s;h.y-=e*t}return h.Tt()>0&&(h.normalize(),h.Wt(this.Gt),h.sub(this.Vt),h.It(this.Ut)),h}W(t){let{Bt:i,position:s,Vt:h,size:e,strokeWidth:n,Zt:r,color:o}=this,l=h.x<0;t.fillStyle=o,t.strokeStyle=r,t.lineWidth=n,t.save(),t.translate(s.x,s.y);let a=4*e,c=1.5*e,d=e,f=-a/2,u=a/2,y=.15*a*(l?1:-1),x=c/2,p=-c/2;t.beginPath(),t.moveTo(f,x),t.lineTo(u,x);let g=y-u,m=p-x,b=Math.sqrt(g*g+m*m),M=y-g/b*d,w=p-m/b*d;t.lineTo(M,w);let S=y-f,A=p-x,D=Math.sqrt(S*S+A*A),v=y-S/D*d,z=p-A/D*d;if(t.quadraticCurveTo(y,p,v,z),t.lineTo(f,x),t.closePath(),t.fill(),t.fillStyle="#999999",t.beginPath(),t.arc(l?f+2:u-2,x-2,.2*this.size,0,2*Math.PI),t.fill(),t.restore(),!(i.length<2)){t.strokeStyle="#666666",t.lineWidth=1.5,t.lineCap=t.lineJoin="round",t.beginPath(),t.moveTo(i[0].x,i[0].y);for(let s=1;s<i.length;s++)t.lineTo(i[s].x,i[s].y);t.stroke()}}ri(t){let i=this.position.x,s=this.position.y+.8*this.size,h=2*this.size;t.save(),t.translate(i,s),t.scale(1,.4);let e=t.createRadialGradient(0,0,0,0,0,h);e.addColorStop(0,"rgba(0, 0, 0, 0.15)"),e.addColorStop(.7,"rgba(0, 0, 0, 0.1)"),e.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=e,t.beginPath(),t.arc(0,0,h,0,2*Math.PI),t.fill(),t.restore()}ni(t){}ai(t,i){}li(t,i,s,h,e){this.ti();let n=this.ii(t);if(this.Qt(n),s&&h&&void 0!==e){let t=this.ei(s,h,e);this.Qt(t)}if(i){let t=this.si(i,this.Jt);t.Wt(this.Xt),this.Qt(t)}}run(t,i,s,h,e=!1){this.li(h),this.R(),this.hi(i,s),this.W(t),e&&this.ni(t)}}class z{constructor(t,i,s=30,h){this.oi=h,this.ci=!1,this.di=60,this.fi=20,this.ui=30,this.Mi=0,this.pi=.18,this.wi=.35,this.gi=.2,this.xi=.3,this.bi=1.2,this.mi=50,this.z=0,this.yi=0,this.Si=1,this.ki=.5,this.Ci=.7,this.Ai=3,this.Pi=0,this.$i=!1,this.Ri=0,this.zi=800,this.Fi=600,this.Wi=!1,this.Di=[],this.Ei=100,this.Ti=150,this.Hi=.5,this.Ii=!1,this.Li=.05,this.Oi=.15,this.Bi=200,this.Vi=1.2,this.Gi=0,this.Ui=300,this.Ni=!1,this.ji=0,this.qi=800,this._i=0,this.Yi=0,this.Ki=0,this.Ji=500,this.Xi=0,this.Zi=0,this.Qi=0,this.ts=0,this.ss=3,this.hs=2,this.es=100,this.rs=100,this.ns=100,this.ls=.025,this.cs=10,this.ds=!1,this.fs=0,this.us=10,this.Ms=2,this.ps=0,this.ws=1.5,this.gs=.1,this.xs=.05,this.bs=0,this.ys=800,this.vs=100,this.Ss=100,this.ks=!1,this.position=new D(t,i),this.Cs=new D(t,i),this.radius=s,this.strokeWidth=3,this.speed=3,this.Vt=new D(0,0),this.As=new D(t,i),this.Ri=i}Ps(){return this.position.y+this.mi+this.z}$s(){return{position:{x:this.position.x,y:this.position.y-this.z},radius:this.radius}}W(t){let i=this.position.x+this.Qi,s=this.position.y-this.z+this.Xi;t.fillStyle=t.strokeStyle="#000",t.lineWidth=this.strokeWidth,t.beginPath(),t.arc(i,s,this.radius,0,2*Math.PI),t.fill(),t.stroke();let h=this.di*Math.PI/360,e=Math.sin(h),n=Math.cos(h),r=.8*this.radius,o=this.fi/2,l=h=>{let l=i+h*e*r,a=s-n*r+this.Mi;t.beginPath(),t.moveTo(l-o,a),t.lineTo(l+o,a),t.lineTo(l,a-this.ui),t.closePath(),t.fill()};l(-1),l(1),t.beginPath(),t.arc(i,s,this.radius,0,2*Math.PI),t.fill();let a=this.radius*this.pi,c=this.radius*this.wi,d=this.radius*this.gi,f=a*this.xi/2,u=a*this.bi/2,y=h=>{let e=i+h*c,n=s-d;t.fillStyle="#228B22",t.beginPath(),t.arc(e,n,a,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.fillRect(e-f,n-u,2*f,2*u)};y(-1),y(1),this.ci&&(t.strokeStyle="#4444ff",t.lineWidth=3,t.beginPath(),t.arc(i,s,this.radius,0,2*Math.PI),t.stroke(),t.fillStyle="#4444ff",t.beginPath(),t.arc(i,s,8,0,2*Math.PI),t.fill())}Rs(t,i){this.$i||(x(a.K),this.Ii=!0,this.As.set(t,i),this.Xi=0,this.Qi=0,this.ts=0)}zs(t,i){if(this.Ii&&!this.$i){let s=D.sub(new D(t,i),this.As).Tt(),h=this.position.y+this.mi+this.z,e=this.position.y+this.radius-this.z;this.Zi=Math.max(0,h-e);let n=Math.min(s/this.Bi,1);this.Xi=n*this.Zi}}Fs(t,i){if(this.Ii&&!this.$i&&this.rs>0){this.Ii=!1,this.Xi=0,this.Qi=0,this.ts=0;let s=D.sub(this.As,new D(t,i)),h=s.Tt(),e=h*this.ls,n=this.Ws(),r=Math.min(e*n,this.rs),o=Math.max(0,this.rs-r);this.Ds(o),this.rs=o,this.rs<=0&&(this.ds=!0);let l=Math.min(h,this.Bi),a=Math.min(this.Li,this.Oi),c=a/this.Si*(l/Math.max(h,1)),d=this.Es();this.Vt=D.Wt(s,c*d),this.yi=l*a*this.Vi*d,this.$i=!0,this.Pi=0,this.Wi&&(this.Di=[])}}R(t){if(this.ks){this.bs+=t;let i=Math.min(this.bs/this.ys,1),s=e(i);this.ns=this.vs+(this.Ss-this.vs)*s,i>=1&&(this.ks=!1,this.ns=this.Ss)}if(this.Ni){this.ji+=t;let i=Math.min(this.ji/this.qi,1),s=e(i);this.fs=this._i+(this.Yi-this._i)*s,i>=1&&(this.Ni=!1,this.fs=this.Yi)}if(this.Ki>0&&(this.Ki-=t,this.Ki<0&&(this.Ki=0)),this.Ii&&!this.$i){this.ts+=t;let i=this.Xi/Math.max(this.Zi,1);this.Qi=Math.sin(this.ts*this.ss*.001*Math.PI*2)*this.hs*i}this.$i&&(this.position.add(this.Vt),this.z+=this.yi,this.Wi&&this.Ts("normal"),this.yi-=this.ki,this.Hs(),this.z<=0&&(this.z=0,this.Pi<this.Ai&&Math.abs(this.yi)>.5?(x(a.tt),this.yi=-this.yi*this.Ci,this.Vt.Wt(this.Ci),this.Pi++,this.Wi&&this.Ts("bounce")):(this.$i=!1,this.Vt.Wt(0),this.yi=0,this.Wi&&this.Ts("ground"),this.ds&&(this.ds=!1,this.oi&&this.oi()))))}Is(t,i){this.zi=t,this.Fi=i}Ls(){let t=this.position.y-this.radius,i=1.02*(this.position.y+this.mi+this.z);return{Os:this.position.x,Bs:(t+i)/2,radius:Math.abs(i-t)/2}}Vs(t,i,s=0){if(this.z>5)return!1;let h=this.Ls(),e=t-h.Os,n=i-h.Bs,r=e*e+n*n,o=h.radius+s;return r<=o*o}Gs(t){if(!this.ci||this.z>5)return;let i=this.Ls();t.strokeStyle="#ff0000",t.lineWidth=2,t.setLineDash([4,4]),t.beginPath(),t.arc(i.Os,i.Bs,i.radius,0,2*Math.PI),t.stroke(),t.setLineDash([])}Hs(){[this.position.x,this.Vt.x]=this.Us(this.position.x,this.Vt.x,this.radius,this.zi-this.radius,100,.95,.05),[this.position.y,this.Vt.y]=this.Us(this.position.y,this.Vt.y,this.radius+this.z,this.Fi-this.radius,100,.95,.05)}Us(t,i,s,h,e,n,r){let o=t-s;if(o<=0)return[s,Math.max(0,i)];if(o<=e&&i<0)return[t,i*(n+r*(o/e))];let l=h-t;return l<=0?[h,Math.min(0,i)]:l<=e&&i>0?[t,i*(n+r*(l/e))]:[t,i]}Ns(t){return D.Dt(this.position,t)<=2*this.radius}Ts(t){this.Di.push({x:this.position.x,y:this.position.y-this.z+this.mi,z:this.z,type:t}),this.Di.length>this.Ei&&this.Di.shift()}js(t,i){let s=D.sub(this.As,new D(t,i)),h=s.Tt(),e=Math.min(h,this.Bi),n=Math.min(this.Li,this.Oi),r=n/this.Si*(e/Math.max(h,1)),o=this.Es(),l=this.position.x,a=this.position.y,c=this.z,d=s.x*r*o,f=s.y*r*o,u=e*n*this.Vi*o,y=[];for(let t=0;t<this.Ti;t++){if(l+=d*this.Hi,a+=f*this.Hi,c+=u*this.Hi,u-=this.ki*this.Hi,[l,d]=this.Us(l,d,this.radius,this.zi-this.radius,100,.95,.05),[a,f]=this.Us(a,f,this.radius+c,this.Fi-this.radius,100,.95,.05),c<=0){c=0,y.push({x:l,y:a-c+this.mi,z:c,type:"ground"});break}t%3==0&&y.push({x:l,y:a-c+this.mi,z:c,type:"normal"})}return y}qs(t,i,s){if(!this.Ii)return;let h=this.js(i,s);if(!(h.length<2)){t.strokeStyle="rgba(0, 150, 255, 0.6)",t.lineWidth=3,t.setLineDash([8,8]),t.beginPath();for(let i=0;i<h.length;i++){let s=h[i];"bounce"!==s.type&&"ground"!==s.type&&(0==i?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y))}t.stroke(),t.setLineDash([]);for(let i of h)if("ground"==i.type){t.fillStyle="rgba(0, 150, 255, 0.6)",t.save(),t.translate(i.x,i.y),t.scale(1,.5),t.beginPath(),t.arc(0,0,6,0,2*Math.PI),t.fill(),t.restore();break}}}ri(t,i){let s=this.position.x,h=i._s(),e=i.Ys(),n=Math.abs(e.Ks.D.x-h.Ks.D.x)/2;s=(h.Ks.D.x+e.Ks.D.x)/2;let r=this.position.y+this.mi+this.z,o=n*Math.max(.1,1-this.z/200);t.save(),t.translate(s,r),t.scale(1,.5);let l=t.createRadialGradient(0,0,0,0,0,o);l.addColorStop(0,"rgba(0, 0, 0, 1)"),l.addColorStop(.6,"rgba(0, 0, 0, 0.9)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=l,t.beginPath(),t.arc(0,0,o,0,2*Math.PI),t.fill(),t.restore()}Js(){let t=Math.min(this.es,this.rs+this.cs);this.Ds(t),this.rs=t}Xs(){this.rs=this.es,this.Ds(this.es)}Ds(t){this.vs=this.ns,this.Ss=t,this.bs=0,this.ks=!0}Zs(){this.fs<this.us&&(this.fs=Math.min(this.us,this.fs+this.Ms))}Qs(t){this.fs=Math.max(0,Math.min(this.us,t))}th(){let t=Date.now();return t-this.Gi<this.Ui&&this.fs>=this.us&&!this.Ni?(this.ih(),!0):(this.Gi=t,!1)}ih(){this.Ni=!0,this.ji=0,this._i=this.fs,this.Yi=0,this.Ki=this.Ji;let t=Math.random()*Math.PI*2;this.Vt.x=.05*Math.cos(t)*80,this.Vt.y=.05*Math.sin(t)*80,this.yi=4*this.Vi*.5,this.$i=!0,this.Pi=0,this.Wi&&(this.Di=[])}sh(){return 1+this.fs/this.us*(this.ws-1)}get hh(){return this.Ni}get eh(){return this.Ki>0}rh(t,i,s){if(this.eh)return!1;let h=this.position.x-t,e=this.Ps()-i;if(Math.sqrt(h*h+e*e)<15+.6*s){let t=15,i=Math.max(0,this.rs-t);return this.Ds(i),this.rs=i,this.rs<=0&&(this.ds=!0),!0}return!1}Ws(){return 1+this.fs*this.gs}Es(){return Math.max(.2,1-this.fs*this.xs)}nh(t){this.ps=t}ah(){return 0==this.ps?0:this.ps*this.sh()}}const P=class t{constructor(t,i,s=24){this.alpha=1,this.oh=0,this.isActive=!0,this.position=new D(t,i),this.size=s}R(i){this.isActive&&(this.oh+=i,this.alpha=Math.max(t.dh,1-this.oh/t.fh*t.uh))}W(i){if(!this.isActive)return;let s=i.globalAlpha,h=i.fillStyle,e=i.font,n=i.textAlign,r=i.textBaseline;i.globalAlpha=this.alpha,i.fillStyle=t.Mh,i.font=`${this.size}px Arial`,i.textAlign="center",i.textBaseline="middle",i.fillText(t.ph,this.position.x,this.position.y),i.globalAlpha=s,i.fillStyle=h,i.font=e,i.textAlign=n,i.textBaseline=r}wh(){return this.isActive&&this.oh>=t.fh}gh(t,i){this.position.set(t,i),this.oh=0,this.alpha=1}xh(t,i,s=0){if(!this.isActive)return!1;let h=t-this.position.x,e=i-this.position.y,n=.5*this.size+s;return h*h+e*e<=n*n}collect(){this.isActive=!1}get active(){return this.isActive}isVisible(t,i,s,h){if(!this.isActive)return!1;let e=this.position.x,n=this.position.y,r=this.size;return e>=t-r&&e<=t+s+r&&n>=i-r&&n<=i+h+r}};P.fh=3e3,P.uh=.9,P.dh=.1,P.ph="☘︎",P.Mh="#00FF00";let W=P;class V{constructor(t,i){this.angle=Math.random()*Math.PI*2,this.radius=.8,this.position=new D(t,i),this.speed=.002+.006*Math.random(),this.bh=10+20*Math.random(),this.mh=5+15*Math.random(),this.yh=15*(Math.random()-.5),this.Sh=-10-15*Math.random()}R(t,i,s){this.angle+=this.speed*t,this.angle>6.283185307179586&&(this.angle-=6.283185307179586);let h=i+this.yh,e=s+this.Sh;this.position.x=h+Math.cos(this.angle)*this.bh,this.position.y=e+Math.sin(this.angle)*this.mh}W(t){t.fillStyle="#000000",t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),t.fill()}}class R{constructor(t,i,s=20){this.kh=0,this.Ch=.003,this.Ah=2,this.Ph=[],this.position=new D(t,i),this.size=s;let h=2+Math.floor(2*Math.random());for(let s=0;s<h;s++)this.Ph.push(new V(t,i))}isVisible(t,i,s,h){let e=.6*this.size;return this.position.x+e>=t-50&&this.position.x-e<=t+s+50&&this.position.y+e>=i-50&&this.position.y-e<=i+h+50}R(t){this.kh+=t;for(let i=0;i<this.Ph.length;i++)this.Ph[i].R(t,this.position.x,this.position.y)}W(t){let i=this.position.x,s=this.position.y,h=.6*this.size,e=i+3,n=s+3+.5*this.size;t.save(),t.translate(e,n),t.scale(1,.5);let r=t.createRadialGradient(0,0,0,0,0,h);r.addColorStop(0,"rgba(0, 0, 0, 0.3)"),r.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=r,t.beginPath(),t.arc(0,0,h,0,2*Math.PI),t.fill(),t.restore(),t.strokeStyle="#654321",t.fillStyle="#654321",t.lineWidth=3;let o=.5*this.size,l=.6*this.size,a=i,c=s-o,d=i-l,f=s+o,u=i+l,y=s+o;t.beginPath(),t.moveTo(d,f),this.$h(t,d,f,a,c,8),this.$h(t,a,c,u,y,8),this.$h(t,u,y,d,f,8),t.closePath(),t.fill(),t.stroke();for(let i=0;i<this.Ph.length;i++)this.Ph[i].W(t)}$h(t,i,s,h,e,n){let r=(h-i)/n,o=(e-s)/n;for(let h=1;h<=n;h++){let e=h/n,l=i+r*h,a=s+o*h,c=-o/n,d=r/n,f=Math.sin(this.kh*this.Ch+e*Math.PI*4)*this.Ah,u=l+c*f,y=a+d*f;t.lineTo(u,y)}}}class C{constructor(t){this.D={x:t.x,y:t.y},this.Rh={x:t.x,y:t.y},this.zh={x:0,y:0},this.Fh=0}Wh(){let{D:t,Rh:i}=this,s=t.x,h=t.y,e=.99*(t.x-i.x),n=.99*(t.y-i.y);t.x+=e,t.y+=n,i.x=s,i.y=h}Dh(){this.D.y+=.15}Eh(t){this.zh.x+=t.x,this.zh.y+=t.y,this.Fh+=1}Th(){let{zh:t,Fh:i,D:s}=this;i>0&&(t.x/=i,t.y/=i,s.x+=t.x,s.y+=t.y,t.x=0,t.y=0,this.Fh=0)}Hh(t,i){this.D.x=Math.max(0,Math.min(t,this.D.x)),this.D.y=Math.max(0,Math.min(i,this.D.y))}Ih(t){let{D:i}=this,s=i.x-t.position.x,h=i.y-t.position.y,e=Math.sqrt(s*s+h*h);if(e<t.radius)if(e>0){let n=s/e,r=h/e;i.x=t.position.x+n*t.radius,i.y=t.position.y+r*t.radius}else{let s=Math.random()*Math.PI*2;i.x=t.position.x+Math.cos(s)*t.radius,i.y=t.position.y+Math.sin(s)*t.radius}}}class T{constructor(t,i,s,h,e,n){this.Lh=n,this.points=[],this.Oh=h*h*Math.PI*e,this.Bh=this.Oh,this.Vh=2*h*Math.PI,this.Gh=this.Vh/s;for(let e=0;e<s;e++){let n=2*Math.PI*e/s-Math.PI/2,r=Math.cos(n)*h,o=Math.sin(n)*h;this.points.push(new C({x:t+r,y:i+o}))}}R(t,i,s){let{points:h,Gh:e,Bh:n,Vh:r}=this;for(let t of h)t.Wh(),t.Dh();for(let o=0;o<10;o++){for(let t=0;t<h.length;t++){let i=h[t],s=h[(t+1)%h.length],n=s.D.x-i.D.x,r=s.D.y-i.D.y,o=Math.sqrt(n*n+r*r);if(o>e){let t=(o-e)/2,h=n/o*t,l=r/o*t;i.Eh({x:h,y:l}),s.Eh({x:-h,y:-l})}}let o=(n-this.Uh())/r;for(let t=0;t<h.length;t++){let i=h[(t-1+h.length)%h.length],s=h[t],e=h[(t+1)%h.length],n=e.D.x-i.D.x,r=-(e.D.y-i.D.y),l=n,a=Math.sqrt(r*r+l*l);if(a>0){let t=r/a*o,i=l/a*o;s.Eh({x:t,y:i})}}for(let t of h)t.Th();for(let e of h)e.Hh(i,s),e.Ih(t)}}Uh(){let{points:t}=this,i=0;for(let s=0;s<t.length;s++){let h=t[s],e=t[(s+1)%t.length];i+=(h.D.x-e.D.x)*(h.D.y+e.D.y)/2}return Math.abs(i)}Nh(){let{points:t}=this,i=0,s=0;for(let h of t)i+=h.D.x,s+=h.D.y;return{x:i/t.length,y:s/t.length}}W(t){let{points:i,Lh:s}=this;if(t.strokeStyle=t.fillStyle="#000000",t.lineWidth=s,t.beginPath(),i.length>3){let s=[];for(let t=0;t<i.length;t++){let h=i[(t-1+i.length)%this.points.length],e=i[t],n=i[(t+1)%i.length],r=.2,o=(n.D.x-h.D.x)*r,l=(n.D.y-h.D.y)*r;s.push({D:e.D,jh:{x:e.D.x-o,y:e.D.y-l},qh:{x:e.D.x+o,y:e.D.y+l}})}t.moveTo(s[0].D.x,s[0].D.y);for(let i=0;i<s.length;i++){let h=s[i],e=s[(i+1)%s.length];t.bezierCurveTo(h.qh.x,h.qh.y,e.jh.x,e.jh.y,e.D.x,e.D.y)}}t.closePath(),t.fill(),t.stroke()}_s(){let{points:t}=this,i=t[0],s=0;for(let h=1;h<t.length;h++)t[h].D.x<i.D.x&&(i=t[h],s=h);return{Ks:i,index:s}}Ys(){let{points:t}=this,i=t[0],s=0;for(let h=1;h<t.length;h++)t[h].D.x>i.D.x&&(i=t[h],s=h);return{Ks:i,index:s}}_h(t,i){let{points:s}=this,h=s.length,e=!1;for(let n=0,r=h-1;n<h;r=n++){let h=s[n].D.x,o=s[n].D.y,l=s[r].D.x,a=s[r].D.y;o>i!=a>i&&t<(l-h)*(i-o)/(a-o)+h&&(e=!e)}return e}Yh(t){this.Bh=t}Kh(){return this.Oh}}class k{constructor(t,i,s=!1){this.Jh=s,this.D={x:t,y:i},this.Rh={x:t,y:i}}Wh(){let{D:t,Rh:i,Jh:s}=this;if(s)return;let h=t.x,e=t.y,n=.99*(t.x-i.x),r=.99*(t.y-i.y);t.x+=n,t.y+=r,i.x=h,i.y=e}Dh(){let{D:t,Jh:i}=this;i||(t.y-=.3)}Xh(t,i){let{D:s,Rh:h}=this;s.x=t,s.y=i,h.x=t,h.y=i,this.Jh=!0}}class I{constructor(t,i,s,h){this.Zh=t,this.Qh=s,this.te=h,this.ie=[];let e=t.D.x,n=t.D.y;for(let t=0;t<i;t++)this.ie.push(new k(e,n-t*s,0==t))}R(){let{ie:t,Qh:i}=this;for(let i=1;i<t.length;i++)t[i].Wh(),t[i].Dh();for(let s=0;s<3;s++)for(let s=0;s<t.length-1;s++){let h=t[s],e=t[s+1],n=e.D.x-h.D.x,r=e.D.y-h.D.y,o=Math.sqrt(n*n+r*r);if(o>0){let t=(i-o)/o/2,s=n*t,l=r*t;h.Jh||(h.D.x-=s,h.D.y-=l),e.Jh||(e.D.x+=s,e.D.y+=l)}}}se(t){this.Zh=t}he(t){let{Zh:i,ie:s}=this,[h]=s;t._h(h.D.x,h.D.y)||h.Xh(i.D.x,i.D.y)}W(t){let{ie:i,te:s}=this;t.strokeStyle="#000000",t.lineCap="round",t.lineWidth=s,t.beginPath(),t.moveTo(i[0].D.x,i[0].D.y);for(let s=1;s<i.length-1;s++){let h=i[s],e=i[s+1];t.quadraticCurveTo(h.D.x,h.D.y,(h.D.x+e.D.x)/2,(h.D.y+e.D.y)/2)}let h=i[i.length-1];t.lineTo(h.D.x,h.D.y),t.stroke()}}class $ extends g{constructor(t,i){super(t,i),this.ee=[],this.re=[],this.ne=null,this.ae=!1,this.le=null,this.camera={x:0,y:0},this.oe={width:1600,height:1200},this.ce={x:0,y:0},this.de=!1,this.fe=0,this.ue=!1,this.Me=1,this.pe=0,this.we=new D(0,0),this.controls={ge:20,Gt:2,Ut:.05,jt:25,qt:80,_t:.3,Yt:25,Kt:1.5,Jt:150,Xt:4,xe:30,be:1600,me:1200,ye:160,ve:50,Se:!1,ke:()=>this.Ce(this.controls)},this.Ae=new z(this.controls.be/2,this.controls.me/2-1,this.controls.xe,()=>{this.ue=!0,this.Pe&&this.Pe(this.fe)}),this.Ae.Is(this.controls.be,this.controls.me),this.oe.width=this.controls.be,this.oe.height=this.controls.me,this.$e=new T(this.Ae.position.x,this.Ae.position.y,20,36,1.5,12),this.Ae.nh(this.$e.Kh());let s=Math.random()<.5?this.$e.Ys():this.$e._s();this.Re=new I(s.Ks,8,15,12),this.Ce(this.controls),this.ze()}Ce({ge:t,Gt:i,Ut:s,jt:h,qt:e,_t:n,Yt:r,Kt:o,Jt:l,Xt:a}){this.ee=[];for(let c=0;c<t;c++){let t=Math.random()*this.oe.width,c=Math.random()*this.oe.height,d={Gt:i,Ut:s,size:8,jt:h,qt:e,_t:n,Yt:r,Kt:o,Jt:l,Xt:a,Zt:"#000000",strokeWidth:3};this.ee.push(new v(t,c,d))}}Fe(){this.ee.map(t=>{t.Gt=this.controls.Gt,t.Ut=this.controls.Ut,t.jt=this.controls.jt,t.qt=this.controls.qt,t._t=this.controls._t,t.Yt=this.controls.Yt,t.Kt=this.controls.Kt,t.Jt=this.controls.Jt,t.Xt=this.controls.Xt})}We(){this.Ae.radius=this.controls.xe}De(){this.oe.width=this.controls.be,this.oe.height=this.controls.me,this.Ae.Is(this.controls.be,this.controls.me)}ze(){let t=this.Ee();this.ne=new W(t.x,t.y),this.le={x:t.x,y:t.y}}Te(){if(this.ne){let t=this.Ee();this.ne.gh(t.x,t.y),this.le={x:t.x,y:t.y}}}Ee(){let t=0;for(;t<20;){let i=Math.random()*this.oe.width,s=Math.random()*this.oe.height;if(!this.le)return{x:i,y:s};let h=i-this.le.x,e=s-this.le.y;if(Math.sqrt(h*h+e*e)>=300)return{x:i,y:s};t++}return this.le?{x:this.le.x>this.oe.width/2?Math.random()*(this.oe.width/2):this.oe.width/2+Math.random()*(this.oe.width/2),y:this.le.y>this.oe.height/2?Math.random()*(this.oe.height/2):this.oe.height/2+Math.random()*(this.oe.height/2)}:{x:Math.random()*this.oe.width,y:Math.random()*this.oe.height}}He(){let t=this.$e.Nh(),i=this.Ae.position.x-t.x,s=this.Ae.position.y-t.y,h=2*this.Ae.radius;if(i*i+s*s>h*h){let t=this.Ae.Vt.x,i=this.Ae.Vt.y;for(let s of this.$e.points)s.D.x+=t,s.D.y+=i,s.Rh.x+=t,s.Rh.y+=i}}Ie(){this.camera.x=this.Ae.position.x-c.width/2,this.camera.y=this.Ae.position.y-c.height/2;let t=-this.controls.ye,i=this.oe.width+this.controls.ye-c.width,s=-this.controls.ye,h=this.oe.height+this.controls.ye-c.height;this.camera.x=Math.max(t,Math.min(i,this.camera.x)),this.camera.y=Math.max(s,Math.min(h,this.camera.y))}Le(t,i){return this.we.set(t+this.camera.x,i+this.camera.y)}Oe(t){return t.x>=this.camera.x&&t.x<=this.camera.x+c.width&&t.y>=this.camera.y&&t.y<=this.camera.y+c.height}Be(t,i,s=50){let{x:h,y:e}=this.camera;return t.x+i>=h-s&&t.x-i<=h+c.width+s&&t.y+i>=e-s&&t.y-i<=e+c.height+s}Ve(t,i){let s,h,e=c.width/2,n=c.height/2,r=t-(this.camera.x+e),o=i-(this.camera.y+n),l=Math.atan2(o,r),a=20,d=Math.abs(l),f=c.width/2-a,u=c.height/2-a;return d<=Math.atan2(u,f)?r>0?(s=c.width-a,h=n+f*Math.tan(l)):(s=a,h=n-f*Math.tan(l)):o>0?(s=e+u/Math.tan(l),h=c.height-a):(s=e-u/Math.tan(l),h=a),{x:s,y:h}}Ge(t){}R(t){if(this.ue)return;this.pe+=t,this.Ae.R(t),this.Ie();let i=Math.min(this.Ae.position.y+this.Ae.mi,this.oe.height),s=this.Ae.ah();s>0&&this.$e.Yh(s),this.$e.R(this.Ae.$s(),this.oe.width,i),this.He(),this.Re.he(this.$e),this.Re.R();for(let i=0;i<this.re.length;i++){let s=this.re[i];s.isVisible(this.camera.x,this.camera.y,c.width,c.height)&&s.R(t)}if(this.ne&&this.ne.active&&!this.ae&&(this.ne.R(t),this.ne.wh()&&this.Te()),this.Ae.z<=5){for(let t=this.re.length-1;t>=0;t--){let i=this.re[t];this.Ae.rh(i.position.x,i.position.y,i.size)&&(this.re.splice(t,1),x(a.X))}this.ne&&this.ne.active&&!this.ae&&this.ne.xh(this.Ae.position.x,this.Ae.position.y,this.Ae.radius)&&(this.ne.collect(),this.ae=!0,this.Ae.Xs(),x(a.J))}if(this.ee.map(t=>{t.li(this.ee,this.Ae.position,this.oe.width,this.oe.height,this.controls.ve),t.R(),t.hi(this.oe.width,this.oe.height)}),this.Ae.z<=5)for(let t=this.ee.length-1;t>=0;t--){let i=this.ee[t];this.Ae.Vs(i.position.x,i.position.y,i.size)&&this.Ae.fs<this.Ae.us&&(x(a.Z),this.ee.splice(t,1),this.fe++,this.Ae.Js(),this.Ae.Zs(),0==this.ee.length&&setTimeout(()=>{this.Ue()},100))}}W(t){t.save(),t.translate(-this.camera.x,-this.camera.y);let i=this.controls.ye;t.fillStyle="#e0e0e0",t.fillRect(-i,-i,this.oe.width+2*i,this.oe.height+2*i),t.fillStyle="#f0f0f0",t.fillRect(0,0,this.oe.width,this.oe.height),t.strokeStyle="#333333",t.lineWidth=4,t.strokeRect(0,0,this.oe.width,this.oe.height),this.ee.map(i=>{this.Be(i.position,2*i.size)&&i.ri(t)}),this.Ae.Ii&&this.Ne(t),this.Ae.ri(t,this.$e),this.ee.map(i=>{this.Be(i.position,2*i.size)&&(i.W(t),this.controls.Se&&(i.ni(t),i.ai(t,this.Ae.position)))});for(let i=0;i<this.re.length;i++){let s=this.re[i];s.isVisible(this.camera.x,this.camera.y,c.width,c.height)&&s.W(t)}this.ne&&this.ne.active&&!this.ae&&this.ne.isVisible(this.camera.x,this.camera.y,c.width,c.height)&&this.ne.W(t),this.$e.W(t),this.Re.W(t),this.Ae.W(t),this.Ae.Gs(t),this.Ae.Ii&&this.Ae.qs(t,this.ce.x,this.ce.y),t.restore(),this.je(t),t.fillStyle="#333333",t.font="bold 24px Arial",t.textAlign="center";let s=`Mice ${this.ee.length}`;t.fillText(s,c.width/2-80,35);let h=`Wave ${this.Me}`;if(t.fillText(h,c.width/2+80,35),this.Ae.fs>=this.Ae.us){let i=(Math.sin(.005*this.pe*Math.PI)+1)/2;t.fillStyle=`rgba(204, 0, 0, ${i})`,t.font="16px Arial",t.fillText("Can't eat more. Need to purge: double-tap on the cat.",c.width/2,65)}t.textAlign="left";let e=c.width-40,n=c.height-30-20,r=this.Ae.ns/this.Ae.es;if(t.fillStyle="#333333",t.fillRect(20,n,e,30),r>0){let i=e*r,s=`rgb(${Math.round(255*(1-r))}, ${Math.round(255*r)}, 0)`;t.fillStyle=s,t.fillRect(20,n,i,30)}t.fillStyle="#000000",t.font="bold 16px Arial",t.textAlign="left",t.fillText("Stamina",20,n-5)}qe(){for(let t of this.ee)if(this.Oe(t.position))return!0;return!1}je(t){this.qe()||this.ee.filter(t=>!this.Oe(t.position)).map(t=>({_e:t,Ye:D.Dt(t.position,this.Ae.position)})).sort((t,i)=>t.Ye-i.Ye).slice(0,5).map(({_e:i})=>{let s=this.Ve(i.position.x,i.position.y),h=c.width/2,e=c.height/2,n=i.position.x-(this.camera.x+h),r=i.position.y-(this.camera.y+e),o=Math.atan2(r,n);t.fillStyle="#ff0000",t.save(),t.translate(s.x,s.y),t.rotate(o),t.beginPath(),t.moveTo(8,0),t.lineTo(-8,-8),t.lineTo(-8,8),t.closePath(),t.fill(),t.restore()})}Ne(t){let i=this.Ae.position.x,s=this.Ae.Ps(),h=this.ce.x,e=this.ce.y,n=h-i,r=e-s,o=Math.sqrt(n*n+r*r),l=this.Ae.Bi,a=h,c=e;if(o>l){let t=l/o;a=i+n*t,c=s+r*t}let d=Math.min(o/l,1),f=Math.min(o,l),u=Math.atan2(c-s,a-i),y=8+32*d;if(f>10){let h=t.createLinearGradient(i,s,a,c),e=0,n=150,r=255,o=.6*d;h.addColorStop(0,`rgba(${e}, ${n}, ${r}, 0)`),h.addColorStop(.3,`rgba(${e}, ${n}, ${r}, ${.3*o})`),h.addColorStop(1,`rgba(${e}, ${n}, ${r}, ${o})`);let l=Math.cos(u+Math.PI/2),f=Math.sin(u+Math.PI/2),x=y/2,p=i,g=s,m=a+l*x,b=c+f*x,M=a-l*x,w=c-f*x;t.fillStyle=h,t.beginPath(),t.moveTo(p,g),t.lineTo(m,b),t.lineTo(M,w),t.closePath(),t.fill()}if(f>10){let i=0,s=150,h=255,e=.6*d;t.fillStyle=`rgba(${i}, ${s}, ${h}, ${e})`;let n=u,r=n-Math.PI/2,o=n+Math.PI/2;t.beginPath(),t.arc(a,c,y/2,r,o,!1),t.fill()}}N(t){if(!this.ue&&t instanceof h)switch(t.type){case s.S:this.G(t.C,t.A);break;case s.m:this.B(t.C,t.A);break;case s.v:case s.k:this.V(t.C,t.A)}}B(t,i){let s=this.Le(t,i);this.Ae.Ns(s)&&(this.Ae.th()&&this.Ke(),this.Ae.hh||(this.de=!0,this.Ae.Rs(s.x,s.y)))}Ke(){let t=15+10*Math.random(),i=new R(this.Ae.position.x,this.Ae.Ps(),t);this.re.push(i)}Ue(){this.Me++,this.controls.Jt+=50,this.controls.Xt+=1,this.Ae.Xs(),this.Je?this.Je(this.Me,()=>{this.Xe()}):this.Xe()}Xe(){this.ee=[];for(let t=0;t<this.controls.ge;t++){let t={Gt:this.controls.Gt,Ut:this.controls.Ut,jt:this.controls.jt,qt:this.controls.qt,_t:this.controls._t,Yt:this.controls.Yt,Kt:this.controls.Kt,Jt:this.controls.Jt,Xt:this.controls.Xt},i=new v(Math.random()*this.oe.width,Math.random()*this.oe.height,t);this.ee.push(i)}this.ae=!1,this.le=null,this.ze()}V(t,i){if(this.de&&(this.de=!1,this.Ae.Ii)){x(a.J);let s=this.Le(t,i);this.Ae.Fs(s.x,s.y)}}G(t,i){let s=this.Le(t,i);this.ce.x=s.x,this.ce.y=s.y,this.de&&this.Ae.Ii&&this.Ae.zs(s.x,s.y)}}class L extends r{constructor(t){super(t),this.title=new b("High Scores",64,"Arial","bold");let i=localStorage.getItem(n),s=i?`Your best run: ${i} mice`:"Your best run is still ahead";this.Ze=new b(s,32);let h=new m({width:60,x:20,text:"✖",fontSize:32,ht:()=>this.P.Qe(O)});this.add(this.title,this.Ze,h)}I(){this.title.it(c.width/2,c.height/3),this.Ze.it(c.width/2,c.height/2)}}class q extends r{constructor(t){super(t),this.tr=null,this.title=new b("Game Screen",64,"Arial","bold"),this.ir=new A({title:"Pause",width:400,height:280,buttons:[{text:"Continue",L:()=>{this.ir.Ct()}},{text:"Menu",L:()=>{this.ir.Ct(),t.Qe(O)}}]}),this.sr=new A({title:"Game Over",width:400,height:300,bt(){t.Qe(O)},buttons:[{text:"Scores",L:()=>{t.Qe(L)}},{text:"Restart",L:()=>{t.Qe(q)}}]}),this.hr=new A({title:"Next Wave",width:400,height:200,bt:()=>{this.tr&&(this.tr(),this.tr=null)},buttons:[{text:"Continue",L:()=>{this.hr.Ct(),this.tr&&(this.tr(),this.tr=null)}}]}),this.hr.$t("Mice became stronger"),this.er=new m({width:60,x:16,text:"☰",fontSize:32,ht:()=>{this.ir.At()}});let i=new w({x:16,width:60,fontSize:24});this.rr=new $(c.width,c.height),this.rr.Pe=t=>{let i=localStorage.getItem(n);t>(i?parseInt(i,10):0)&&localStorage.setItem(n,t.toString()),this.sr.Pt("Game Over"),this.sr.$t(`Your score: ${t} mice eaten`),this.sr.At()},this.rr.Je=(t,i)=>{this.hr.Pt(`Next Wave ${t}`),this.tr=i,this.hr.At()},this.nr=this.rr.R.bind(this.rr),this.rr.R=t=>{this.ir.isVisible||this.sr.isVisible||this.hr.isVisible||this.nr(t)},this.add(this.title,this.rr,i,this.er,this.ir,this.sr,this.hr),((t=0)=>{p();let i=d._();if(!y){y=i.createGain(),y.connect(i.destination),y.gain.value=u;let t=i.destination;Object.defineProperty(i,"destination",{get:()=>y||t,configurable:!0})}f=d.q(t)})()}O(t){this.sr.isVisible&&(this.sr.O(t),t.M)||this.ir.isVisible&&(this.ir.O(t),t.M)||this.hr.isVisible&&(this.hr.O(t),t.M)||super.O(t)}I(){this.title.it(c.width/2,c.height/2),this.rr.st(c.width,c.height),this.er.it(c.width-this.er.width-16,16),this.ir.H(),this.sr.H(),this.hr.H()}}class O extends r{constructor(t){super(t),this.title=new M("🅒🅐🅣🅐🅟🅞🅞🅛🅣",72,"Arial","bold"),this.title.ft(20,.003,.4),this.ar=new b("v1.0.0",16);let i=[{text:"Play",ht(){this.text="Loading...",requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.Qe(q)})})}},{text:"High Scores",ht:()=>t.Qe(L)},{text:"Credits",ht:()=>t.Qe(G)}];this.buttons=i.map(t=>new m({width:200,height:60,...t})),this.add(this.title,...this.buttons,this.ar),p()}I(){this.title.nt(((t,i)=>{let s=1*c.width;return 72*i*.6>s?Math.floor(s/i/.6):72})(0,this.title.text.length)),this.title.it(c.width/2,150);let t=c.height/2-80,i=c.width/2;this.buttons.map((s,h)=>{s.it(i-s.width/2,t+80*h)}),this.ar.it(c.width-40,c.height-20)}}class G extends r{constructor(t){super(t),this.title=new b("Credits",64,"Arial","bold"),this.lines=[new b("Development by Gleb V.",32),new b("Cover art by Alisa A.",32),new b("Sound design by Katie S.",32)];let i=new m({width:60,x:20,text:"✖",fontSize:32,ht:()=>this.P.Qe(O)});this.add(this.title,...this.lines,i)}I(){let{title:t,lines:i}=this;t.it(c.width/2,c.height/3);let s=c.height/2;i[0].it(c.width/2,s-50),i[1].it(c.width/2,s),i[2].it(c.width/2,s+50)}}let K=class extends r{constructor(t){super(t),this.title=new b("A game by Gleb V.",64,"Arial","bold"),this.add(this.title)}I(){this.title.it(c.width/2,c.height/2)}F(t){this.currentTime>=1e3&&this.T()&&this.P.Qe(O)}},B=(t,i)=>{let s=c.getBoundingClientRect(),h=t-s.left,e=i-s.top,n=c.width/s.width,r=c.height/s.height;return{x:Math.max(0,Math.min(c.width,h*n)),y:Math.max(0,Math.min(c.height,e*r))}},E=t=>i=>{let{x:s,y:h}=B(i.clientX,i.clientY);t(s,h)},F=t=>i=>{i.preventDefault();let s=i.touches[0]||i.changedTouches[0];if(s){let{x:i,y:h}=B(s.clientX,s.clientY);t(i,h)}},N=new class{constructor(){this.pr=null;let i=t.i?{alpha:!1,wr:!0}:t.h?{alpha:!1,wr:!1}:{gr:!0,alpha:!1};this.context=c.getContext("2d",i);let s=K;this.screen=new s(this),c.onclick=E((t,i)=>this.screen.L(t,i)),c.onmousedown=E((t,i)=>this.screen.B(t,i)),c.onmouseup=E((t,i)=>this.screen.V(t,i)),c.onmousemove=E((t,i)=>this.screen.G(t,i)),c.onmouseleave=E((t,i)=>this.screen.U(t,i)),c.addEventListener("touchstart",F((t,i)=>{this.pr={x:t,y:i},this.screen.B(t,i)}),{passive:!1}),c.addEventListener("touchend",F((t,i)=>{if(this.screen.V(t,i),this.pr){let s=t-this.pr.x,h=i-this.pr.y;s*s+h*h<100&&this.screen.L(t,i),this.pr=null}}),{passive:!1}),c.addEventListener("touchmove",F((t,i)=>this.screen.G(t,i)),{passive:!1}),c.addEventListener("touchcancel",t=>{t.preventDefault(),this.pr&&(this.screen.V(this.pr.x,this.pr.y),this.pr=null)},{passive:!1}),window.onresize=()=>this.screen.H(),this.screen.H()}Qe(t,...i){this.screen.destroy(),c.style.cursor="default";let s=new t(this,...i);s.H(),this.screen=s}R(t){this.screen.R(t),this.screen.W(this.context)}},U=performance.now();(()=>{let t=performance.now(),i=(s,h=60)=>{requestAnimationFrame(i);let e=s-t,n=1e3/h;e>=n-.1&&(t=s-e%n,(t=>{N.R(t-U),U=t})(s))};requestAnimationFrame(i)})()</script>