<!doctype html><title>Zabobon - js13kGames 2025</title><div id=start class=overlay><div id=startEyes class="eyes eyes--lg"><i class=eye><b></b></i> <i class=eye><b></b></i></div><button id=play class=btn>Play</button></div><div id=avatar><div class=head><i class="ear left"></i> <i class="ear right"></i><div id=avatarEyes class="eyes eyes--sm"><i class=eye><b></b></i> <i class=eye><b></b></i></div><div id=avatarCross class=cross aria-hidden=true><span>x</span><span>x</span></div><div id=avatarTip class=avatar-tip style=display:none></div></div><div id=hearts></div></div><canvas id=gl></canvas><style>body,html{margin:0;height:100%;background:#111;overflow:hidden;font-family:sans-serif}canvas{display:block;width:100vw;height:100vh}#hearts{position:absolute;top:10px;left:10px;display:flex;gap:4px;font-size:28px}.heart{color:red;text-shadow:0 0 4px #fff}.heart.lost{color:gray}.overlay{position:fixed;inset:0;display:grid;place-items:center;background:#000;color:#fff;z-index:9;text-align:center}.eyes{display:flex;align-items:center;justify-content:center;transform:scaleY(1)}.eyes--lg{gap:48px}.eyes--sm{gap:10px}.eyes .eye{position:relative;display:block;border-radius:50%;background:#dfff5a}.eyes--lg .eye{width:110px;height:70px}.eyes--sm .eye{width:22px;height:14px}.eyes .eye>b{position:absolute;left:50%;top:15%;transform:translateX(-50%);background:#000;border-radius:6px}.eyes--lg .eye>b{width:6px;height:60%}.eyes--sm .eye>b{width:3px;height:70%;border-radius:3px}#avatar{position:absolute;top:10px;left:10px;width:60px;height:60px;display:grid;place-items:center;z-index:5}#avatar .head{position:relative;width:54px;height:54px;border-radius:50%;background:#000;display:grid;place-items:center}.ear{position:absolute;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:14px solid #000;top:-6px}.ear.left{left:10px}.ear.right{right:10px}#avatarEyes{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(.85,1)}.cross{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:none;gap:18px;font-size:20px;color:#dfff5a;font-family:monospace}.avatar-tip{position:absolute;left:0;top:66px;max-width:220px;width:300px;padding:6px 8px;border-radius:8px;background:#fff;color:#000;font-size:16px;line-height:1.3;box-shadow:0 2px 10px rgba(0,0,0,.35);pointer-events:none;z-index:6}#avatar #hearts{position:absolute;top:0;left:82px}.btn{font:inherit;font-size:36px;padding:30px 100px;border:3px solid #fff;border-radius:8px;color:#fff;cursor:pointer;background:0 0}.btn:hover{background:#222}.btn:active{transform:translateY(1px)}.overlay .btn{margin-top:12px}</style><script>var e,t,o=Object.getOwnPropertyNames;(e={"main.js"(){var e=document,t=e.getElementById("gl"),o=t.getContext("webgl"),r=Math,n=r.sin,a=r.cos,s=r.hypot,i=Float32Array,l=()=>r.random(),m=(e,t)=>e+l()*(t-e),f=34962,d={general:["A cat has night in its paws.","In the dark, all cats are lucky.","Paws are silent; omens are loud."],intro:["Follow the red dot, they said. You'll be fine, they said.","Bring them bad luck... follow the red dot.","Summon the black Volga. Chase the red light."],nineLives:["Nine lives aren't infinite.","Nine lives, one shadow.","Spend a life wisely, cat!!!"]},c=(e,t)=>{let r=o.createShader(e);if(o.shaderSource(r,t),o.compileShader(r),!o.getShaderParameter(r,35713))throw o.getShaderInfoLog(r);return r},u=e=>o.getAttribLocation(F,e),y=e=>o.getUniformLocation(F,e),p=(e,t,r,n)=>{o.uniform3f(e,t,r,n)},h=e=>{o.uniformMatrix4fv(K,!1,e)},x=e=>{let t=o.createBuffer();return o.bindBuffer(f,t),o.bufferData(f,e,35044),t},A=(e,t,r)=>{o.bindBuffer(f,e),o.vertexAttribPointer(t,r,o.FLOAT,!1,0,0),o.enableVertexAttribArray(t)},g=e=>{const t=new i(e.length);for(let o=0;o<e.length;o+=9){const[r,n,a,i,l,m,f,d,c]=e.slice(o,o+9),u=i-r,y=l-n,p=m-a,h=f-r,x=d-n,A=c-a;let g=y*A-p*x,v=p*h-u*A,w=u*x-y*h,T=1/(s(g,v,w)||1);g*=T,v*=T,w*=T,t.set([g,v,w,g,v,w,g,v,w],o)}return t},v=(e=50)=>new i([-e,0,-e,e,0,-e,e,0,e,-e,0,-e,e,0,e,-e,0,e]),w=(e,t,o=12,s=18,l="x")=>{const m=[],f=e/2,d=[];for(let i=0;i<=o;i++){const m=i/o,c=(m*e-f)/f,u=t*r.sqrt(r.max(0,1-c*c)),y=[];for(let t=0;t<=s;t++){const o=t/s*6.28318,r=a(o),i=n(o);let d=0,c=0,p=0;"x"===l?(d=m*e-f,c=u*r,p=u*i):(c=m*e-f,d=u*r,p=u*i),y.push([d,c,p])}d.push(y)}for(let e=0;e<o;e++){const t=d[e],o=d[e+1];for(let e=0;e<s;e++){const r=t[e],n=t[e+1],a=o[e],s=o[e+1];m.push(r[0],r[1],r[2],a[0],a[1],a[2],n[0],n[1],n[2],n[0],n[1],n[2],a[0],a[1],a[2],s[0],s[1],s[2])}}return new i(m)},T=(e=.9,t=.22,o=12,r=18)=>w(e,t,o,r,"x"),b=(e=.45,t=.05,o=12,r=18)=>w(e,t,o,r,"y"),S=()=>{const e=a(Wt),t=n(Wt),o=kt[0]+.15*e,r=kt[2]+.15*t,i=4*wt.bodyLen*wt.scale;let l=kt[0]+e*i-o,m=-.38,f=kt[2]+t*i-r;const d=s(l,m,f)||1;return l/=d,m/=d,f/=d,{pos:[o,.38,r],dir:[l,m,f]}},R=(e,t,o)=>{const n=r.max(0,r.min(1,(o-e)/(t-e)));return n*n*(3-2*n)},I=(e,t)=>{const o=e,n=t;let a=0-o,i=15-n,l=s(a,5,i)||1,m=a/l,f=5/l,d=i/l,c=r.max(f,0)*(1/(Nt+Ct*l+Mt*l*l)),u=[-m,-f,-d];if(Vt<=0)return c>0?{dir:u,strength:c}:{dir:u,strength:0};let y=0,p=[0,-1,0];for(let e=0;e<at.length;e++){const t=at[e].x,a=at[e].z,i=o-t,l=0-Pt,m=n-a,f=s(i,l,m)||1,d=i/f,c=l/f,u=m/f,h=R(zt,Et,-c),x=r.max(-c,0)*(1/(Nt+Ct*f+Mt*f*f))*h*Vt;x>y&&(y=x,p=[d,c,u])}return y>c?{dir:p,strength:y}:{dir:u,strength:c}},L=(e,t)=>{o.uniform1f(q,1),o.uniform3f(H,e[0],e[1],e[2]),o.uniform1f(Z,t),o.uniform1f(ae,0),o.uniform1f(se,0)},P=()=>{o.uniform1f(q,0),o.uniform1f(Z,1),o.uniform1f(ae,.2),o.uniform1f(se,.8)},E=()=>{no.textContent="☠ "+mo},z=e=>{ao.textContent="⏱ "+e.toFixed(1)+"s"},N=(e,t,r,n,a,s)=>{p(Y,.23,.33,.58),h(_.m(_.T(e,t,r),_.m(_.Ry(n),_.S(a,s,1)))),A(St,X,3),A(xe,B,3),o.drawArrays(o.TRIANGLE_STRIP,0,4)},C=(e,t,r,n,a,s)=>{p(Y,.29,.18,.08),A(St,X,3),A(nt,B,3),h(_.m(_.T(e,t,r),_.m(_.Ry(n),_.m(_.T(0,0,.0015),_.S(a,s,1))))),o.drawArrays(o.TRIANGLE_STRIP,0,4)},M=(e,t)=>{const r=_.m(_.T(e,0,t),_.S(.3,9,.3)),n=_.m(_.T(e,3,t),_.S(1,1,1));A(Ze,X,3),A(je,B,3),p(Y,.3,.3,.3),h(r),o.drawArrays(o.TRIANGLES,0,Ue),A(Ve,X,3),o.disableVertexAttribArray(B),o.vertexAttrib3f(B,0,0,1),p(Y,1,1,.6),h(n),o.drawArrays(o.TRIANGLES,0,Ke),o.enableVertexAttribArray(B)},G=(e,t,r)=>{const n={sx:5,sy:.8,sz:2},a={sx:2.2,sy:.55,sz:1.55},s=e=>({x:e.sx*gt*.5,y:e.sy*gt*.5,z:e.sz*gt*.5}),i=s(n),l=s(a),m=_.T(e,r,t),f=(e,t)=>{A(Ye,X,3),A(qe,B,3),h(e),p(Y,t[0],t[1],t[2]),o.drawArrays(o.TRIANGLES,0,He)},d=+i.x-.07,c=i.z-.18,u=i.z+.11+.01,y=+(i.x-.18),x=-(i.x-.18),g=.5-r-.01,v=(e,t)=>{A(Ve,X,3),A(ke,B,3),h(_.m(m,_.m(_.T(e,g,t),_.S(.5,.5,.22)))),p(Y,.5,.5,.5),o.drawArrays(o.TRIANGLES,0,Ke)};f(_.m(m,_.S(n.sx,n.sy,n.sz)),[.05,.05,.06]),f(_.m(m,_.m(_.T(0,i.y+l.y+.01,0),_.S(a.sx,a.sy,a.sz))),[.05,.05,.06]),f(_.m(m,_.m(_.T(+d,.26,+c),_.S(.18,.14,.14))),[.95,.95,.9]),f(_.m(m,_.m(_.T(+d,.26,-c),_.S(.18,.14,.14))),[.95,.95,.9]),v(y,+u),v(y,-u),v(x,+u),v(x,-u)},D=(e,t,a)=>{const s=Ht+2.1*a.pos[0],i=.3*n(s),l=.7*-i,m=_.S(.71,.82,.71),f=.05*.28,d=.45*.28*.5*.75,c=.14900000000000002,u=.16*.28,y=.5*u+d,x=_.m(e,_.T(0,.99,0)),g=e=>{p(Y,0,0,0),A(et,X,3),A(tt,B,3),h(_.m(e,_.S(f,d,d))),o.drawArrays(o.TRIANGLES,0,ot)},v=_.m(x,_.T(c,0,-y)),w=_.m(x,_.T(c,0,+y));p(Y,1,t?1:.5,t?0:.7),A(Ne,X,3),A(Ce,B,3),h(_.m(e,_.m(_.T(0,.275,.09),_.Rz(i)))),o.drawArrays(o.TRIANGLES,0,Me),h(_.m(e,_.m(_.T(0,.275,-.09),_.Rz(-i)))),o.drawArrays(o.TRIANGLES,0,Me),A(ve,X,3),A(we,B,3),h(_.m(e,_.T(0,.55,0))),o.drawArrays(o.TRIANGLES,0,Te),A(Ne,X,3),A(Ce,B,3),h(_.m(e,_.m(_.m(_.T(0,.55,.18),_.Rz(l)),m))),o.drawArrays(o.TRIANGLES,0,Me),h(_.m(e,_.m(_.m(_.T(0,.55,-.18),_.Rz(-l)),m))),o.drawArrays(o.TRIANGLES,0,Me),A(Ve,X,3),A(Ve,B,3),h(_.m(e,_.T(0,.99,0))),o.drawArrays(o.TRIANGLES,0,Ke),g(v),g(w),p(Y,0,0,0),A(St,X,3),A(nt,B,3),h(_.m(x,_.m(_.T(c,0,0),_.m(_.Ry(-r.PI/2),_.S(u,.6*d,1))))),o.drawArrays(o.TRIANGLE_STRIP,0,4);for(const e of[-.11690000000000003,.11690000000000003])for(const t of[.5,1.5])h(_.m(x,_.m(_.T(c-.07*t,0,e),_.S(.07,.037800000000000014,1)))),o.drawArrays(o.TRIANGLE_STRIP,0,4)},O=(e,t,a)=>{const s=_.m(e,_.S(wt.scale,wt.scale,wt.scale)),i=a?[1,.3,.3]:[0,0,0],l=[0,0,0],m=wt.headR/.14,f=_.m(s,_.T(.7,.2*wt.bodyRad,0)),d=.95*wt.headR,c=.05*wt.bodyRad,u=.45*wt.headR,y=wt.headR*(1/3)*4,x=y*$t*2,g=.08*wt.headR,v=.08*y,w=.9*x,T=.02*wt.headR,b=.18,S=.35*wt.headR,R=.2*wt.bodyRad+.9*wt.headR,I=.7-.2*wt.headR,L=-.02,P=.55*r.min(t/8,1),E=e=>n(e)*P,z=E(Ht),N=E(Ht+r.PI),C=E(Ht+r.PI),M=E(Ht),G=([e,t,r,n])=>{h(_.m(s,_.m(_.T(e,t,r),_.m(_.Rz(n),_.T(0,-.275,0))))),o.drawArrays(o.TRIANGLES,0,Me)},D=.35*(.5+.5*r.min(t/10,1));p(Y,i[0],i[1],i[2]),h(s),A(Ie,X,3),A(Le,B,3),o.drawArrays(o.TRIANGLES,0,Pe),h(_.m(f,_.S(m,m,m))),A(Ve,X,3),A(Ve,B,3),o.drawArrays(o.TRIANGLES,0,Ke),p(Y,223/255,1,90/255),A(Ve,X,3),A(ke,B,3);for(const e of[u,-u])h(_.m(f,_.m(_.T(d,c,e),_.S(g,x,y)))),o.drawArrays(o.TRIANGLES,0,Ke);p(Y,0,0,0),A(St,X,3),A(nt,B,3);for(const e of[u,-u])h(_.m(f,_.m(_.T(d+T,c,e),_.m(_.Ry(-r.PI/2),_.S(v,w,1))))),o.drawArrays(o.TRIANGLE_STRIP,0,4);A(Ze,X,3),A(je,B,3),p(Y,l[0],l[1],l[2]);for(const e of[S,-S])h(_.m(s,_.m(_.T(I,R,e),_.S(b,b,b)))),o.drawArrays(o.TRIANGLES,0,Ue);p(Y,i[0],i[1],i[2]),A(Ne,X,3),A(Ce,B,3),G([.4,L,.18,z]),G([.4,L,-.18,N]),G([-.4,L,.18,C]),G([-.4,L,-.18,M]),A(Oe,X,3),A(_e,B,3);let O=_.m(s,_.T(-.4,.1,0));for(let e=0;e<3;e++){const t=n(Qt+.6*e)*D;O=_.m(O,_.m(_.Ry(t),_.T(-.19,0,0))),h(O),o.drawArrays(o.TRIANGLES,0,Fe),O=_.m(O,_.T(-.19,0,0))}};if(!o)throw"WebGL?";var _,F,X,B,V,k,K,W,Y,q,H,Q,Z,j,U,$,J,ee,te,oe,re,ne,ae,se,ie,le,me,fe,de,ce,ue,ye,pe,he,xe,Ae,ge,ve,we,Te,be,Se,Re,Ie,Le,Pe,Ee,ze,Ne,Ce,Me,Ge,De,Oe,_e,Fe,Xe,Be,Ve,ke,Ke,We,Ye,qe,He,Qe,Ze,je,Ue,$e,Je,et,tt,ot,rt,nt,at,st,it,lt,mt,ft,dt,ct,ut=t.width,yt=t.height,pt=ut/2,ht=yt/2,xt=x(v(200)),At=x(v(24)),gt=.35,vt=23,wt={scale:.6,bodyLen:1.2,bodyRad:.25,headR:.18},Tt=!1,bt=((e=.2,t=.3)=>new i([-e/2,-t/2,0,e/2,-t/2,0,-e/2,t/2,0,e/2,t/2,0]))(),St=x(bt),Rt=(()=>{const e=[],t=(t,o,r,n,a,s)=>e.push({x:t,y:n*gt*.5,z:o,sx:r,sy:n,sz:a,color:s});for(let e=-vt;e<=vt;){let o=m(10,20),r=m(12,20),n=m(7,9),a=m(.4,.9);o=Math.min(o,(24-e)/gt),t(-(vt+2.3),e+o*gt*.5,n,r,o,[.62,.6,.56]),t(+(vt+2.3),e+o*gt*.5,n,r,o,[.58,.6,.65]),e+=o*gt+a}for(let e=-vt;e<=vt;){let o=m(10,20),r=m(8,16),n=m(7,9),a=m(0,.3);o=Math.min(o,(24-e)/gt),t(e+o*gt*.5,-(vt+2.3),o,r,n,[.95,.92,.85]),e+=o*gt+a}return e})(),It=Rt[0],Lt=-(vt+1.2),Pt=3,Et=r.cos(25*r.PI/180),zt=r.cos(50*r.PI/180),Nt=1,Ct=.14,Mt=.07,Gt=r.cos(12*r.PI/180),Dt=r.cos(22*r.PI/180),Ot=[{on:120,off:160},{on:200,off:240},{on:320,off:420}],_t=0,Ft=0,Xt=0,Bt=0,Vt=0,kt=(x(new i(18)),[0,0,0]),Kt=[0,0,0],Wt=0,Yt=[0,6,10],qt=[0,0],Ht=0,Qt=0,Zt=0,jt=0,Ut=9,$t=1,Jt=0,eo=0,to=1.5+2.5*l(),oo=0,ro=document.getElementById("hearts"),no=document.createElement("span"),ao=e.createElement("span"),so=0,io=0,lo=0,mo=0,fo=performance.now();onresize=()=>{t.width=innerWidth,t.height=innerHeight,o.viewport(0,0,t.width,t.height)},onresize(),onpointermove=e=>{pt=e.clientX,ht=e.clientY};for(let e=0;e<9;e++){const e=document.createElement("span");e.textContent="♥",e.classList.add("heart"),ro.appendChild(e)}if(no.style.marginLeft="8px",no.style.color="#fff",ro.appendChild(no),E(),ao.style.marginLeft="8px",ao.style.color="#fff",ro.appendChild(ao),z(0),F=o.createProgram(),o.attachShader(F,c(o.VERTEX_SHADER,"attribute vec3 p, n; uniform mat4 P, V, M; uniform float shadow; uniform vec3 shadowDir; uniform float shadowYOffset; varying vec3 vN, vW; void main() { vec4 w = M * vec4(p, 1.0); if (shadow > 0.5) { float denom = shadowDir.y; denom = (abs(denom) < 1.0e-5) ? (denom < 0.0 ? -1.0e-5 : 1.0e-5) : denom; float k = w.y / denom; w.x -= shadowDir.x * k; w.z -= shadowDir.z * k; w.y = shadowYOffset; vW = w.xyz; vN = vec3(0.0, 1.0, 0.0); gl_Position = P * V * w; } else { vW = w.xyz; mat3 Nmat = mat3(M[0].xyz, M[1].xyz, M[2].xyz); vN = normalize(Nmat * n); gl_Position = P * V * w; } }")),o.attachShader(F,c(o.FRAGMENT_SHADER,"precision mediump float;varying vec3 vN,vW;uniform vec3 C;uniform float scene;uniform vec3 L;uniform vec3 Lcolor;uniform float ambientK;uniform float diffuseK;const int MAX_LAMPS=16;uniform int lampCount;uniform vec3 lampPos[MAX_LAMPS];uniform vec3 lampDir[MAX_LAMPS];uniform vec3 lampColor[MAX_LAMPS];uniform float lampInnerDot[MAX_LAMPS];uniform float lampOuterDot[MAX_LAMPS];uniform vec3 att;uniform float lampK;uniform float opacity;uniform float headOn;uniform vec3 headPos;uniform vec3 headDir;uniform vec3 headColor;uniform float headInnerDot;uniform float headOuterDot;void main(){vec3 n=normalize(vN);vec3 ambient=C*ambientK*scene;vec3 toL=L-vW;float rL=length(toL);vec3 ldir=toL/max(rL,1e-5);float ndl=max(dot(n,ldir),0.0);vec3 globalDiff=C*diffuseK*ndl*Lcolor*scene;vec3 spotSum=vec3(0.0);for(int i=0;i<MAX_LAMPS;++i){if(i>=lampCount)break;vec3 Lp=lampPos[i];vec3 Ld=lampDir[i];vec3 toPoint=vW-Lp;float r=length(toPoint);vec3 lightToPoint=toPoint/max(r,1e-5);float d=dot(Ld,lightToPoint);float spot=smoothstep(lampOuterDot[i],lampInnerDot[i],d);float lambert=max(dot(n,-lightToPoint),0.0);float atten=1.0/(att.x+att.y*r+att.z*r*r);spotSum+=C*diffuseK*lambert*atten*spot*lampColor[i]*lampK;}vec3 headSum=vec3(0.0);if(headOn>0.5){vec3 toPoint=vW-headPos;float r=length(toPoint);vec3 lightToPoint=toPoint/max(r,1.0e-5);float d=dot(headDir,lightToPoint);float spot=smoothstep(headOuterDot,headInnerDot,d);float lambert=max(dot(n,-lightToPoint),0.0);float atten=1.0/(att.x+att.y*r+att.z*r*r);headSum=C*diffuseK*lambert*atten*spot*headColor;}vec3 color=ambient+globalDiff+spotSum+headSum;color=pow(clamp(color,0.0,1.0),vec3(1.0/1.4));gl_FragColor=vec4(color,opacity);}")),o.linkProgram(F),!o.getProgramParameter(F,35714))throw o.getProgramInfoLog(F);o.useProgram(F),X=u("p"),B=u("n"),V=y("P"),k=y("V"),K=y("M"),W=y("L"),Y=y("C"),q=y("shadow"),H=y("shadowDir"),Q=y("shadowYOffset"),Z=y("opacity"),j=y("headOn"),U=y("headPos"),$=y("headDir"),J=y("headColor"),ee=y("headInnerDot"),te=y("headOuterDot"),oe=y("lampK"),re=y("scene"),o.uniform1f(Z,1),o.uniform1f(q,0),o.uniform1f(Q,.002),ne=y("Lcolor"),ae=y("ambientK"),se=y("diffuseK"),ie=y("att"),le=y("lampCount"),me=y("lampPos"),fe=y("lampDir"),de=y("lampColor"),ce=y("lampInnerDot"),ue=y("lampOuterDot"),o.enable(2929),o.enable(o.POLYGON_OFFSET_FILL),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),_={I:()=>new i([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),p:(e,t,o,n)=>{const a=1/r.tan(e/2);return new i([a/t,0,0,0,0,a,0,0,0,0,(n+o)/(o-n),-1,0,0,2*n*o/(o-n),0])},v:(e,t,o)=>{let[r,n,a]=e,[l,m,f]=t,[d,c,u]=o,y=r-l,p=n-m,h=a-f,x=1/(s(y,p,h)||1);y*=x,p*=x,h*=x;let A=c*h-u*p,g=u*y-d*h,v=d*p-c*y;x=1/(s(A,g,v)||1),A*=x,g*=x,v*=x;let w=p*v-h*g,T=h*A-y*v,b=y*g-p*A;return new i([A,w,y,0,g,T,p,0,v,b,h,0,-(A*r+g*n+v*a),-(w*r+T*n+b*a),-(y*r+p*n+h*a),1])},m:(e,t)=>{const o=new i(16);for(let r=0;r<4;r++){const n=t[4*r],a=t[4*r+1],s=t[4*r+2],i=t[4*r+3];o[4*r]=e[0]*n+e[4]*a+e[8]*s+e[12]*i,o[4*r+1]=e[1]*n+e[5]*a+e[9]*s+e[13]*i,o[4*r+2]=e[2]*n+e[6]*a+e[10]*s+e[14]*i,o[4*r+3]=e[3]*n+e[7]*a+e[11]*s+e[15]*i}return o},T:(e,t,o)=>new i([1,0,0,0,0,1,0,0,0,0,1,0,e,t,o,1]),Rx:e=>{const t=a(e),o=n(e);return new i([1,0,0,0,0,t,o,0,0,-o,t,0,0,0,0,1])},Ry:e=>{const t=a(e),o=n(e);return new i([t,0,o,0,0,1,0,0,-o,0,t,0,0,0,0,1])},Rz:e=>{const t=a(e),o=n(e);return new i([t,o,0,0,-o,t,0,0,0,0,1,0,0,0,0,1])},S:(e,t,o)=>new i([e,0,0,0,0,t,0,0,0,0,o,0,0,0,0,1]),sub:(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],cr:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],nm:e=>{const t=1/s(e[0],e[1],e[2]);return[e[0]*t,e[1]*t,e[2]*t]}},ye=((e=20,t=1)=>{const o=[];for(let r=-e;r<=e;r+=t)o.push(-e,0,r,e,0,r,r,0,-e,r,0,e);return new i(o)})(25,1),pe=x(ye),he=new i(ye.length);for(let e=1;e<he.length;e+=3)he[e]=1;xe=x(he),gt=.35,vt=23,wt={scale:.6,bodyLen:1.2,bodyRad:.25,headR:.18},be=.0015,Tt=!1,p(W,0,5,15),o.uniform3f(ne,1,1,1),o.uniform1f(ae,.2),o.uniform1f(se,.8),o.uniform3f(ie,1,.14,.07),Se=T(wt.bodyLen,wt.bodyRad,14,20),Re=g(Se),Ie=x(Se),Le=x(Re),Pe=Se.length/3,Ee=b(.45,.05,12,18),ze=g(Ee),Ne=x(Ee),Ce=x(ze),Me=Ee.length/3,Ge=T(.38,.055,10,16),De=g(Ge),Oe=x(Ge),_e=x(De),Fe=Ge.length/3,Xe=((e,t,o,s=.14,l=8,m=12)=>{const f=[];for(let i=0;i<l;i++){const d=(i+1)/l,c=i/l*r.PI,u=d*r.PI;for(let i=0;i<m;i++){const l=(i+1)/m,d=i/m*2*r.PI,y=2*l*r.PI,p=(r,i)=>[e+s*n(r)*a(i),t+s*a(r),o+s*n(r)*n(i)],h=p(c,d),x=p(u,d),A=p(c,y),g=p(u,y);f.push(...h,...x,...A,...A,...x,...g)}}return new i(f)})(0,0,0,.14,8,12),Be=g(Xe),Ve=x(Xe),ke=x(Be),Ke=Xe.length/3,We=((e=.35)=>{const t=e/2,o="+--++-++++--++++-+--+-++-+---+-+-----+--+++++-+-+++++---+---+----++--+-+--++-++++--++++-+++------+-+---+-++-".split("").map(e=>"+"===e?t:-t),r="+..+..+..+..+..+..-..-..-..-..-..-...+..+..+..+..+..+..-..-..-..-..-..-...+..+..+..+..+..+..-..-..-..-..-..-".split("").map(e=>"+"===e?1:"-"===e?-1:0);return{v:new i(o),n:new i(r),count:o.length/3}})(.35),Ye=x(We.v),qe=x(We.n),He=We.count,Qe=(e=>{const t=.5*e,o=[-t,0,-t],r=[t,0,-t],n=[t,0,t],a=[-t,0,t],s=[0,e,0],l=new i([...o,...r,...s,...r,...n,...s,...n,...a,...s,...a,...o,...s]),m=g(l);for(let e=0;e<m.length;e++)m[e]=-m[e];return{v:l,n:m,count:l.length/3}})(gt),Ze=x(Qe.v),je=x(Qe.n),Ue=Qe.count,$e=T(1,1,12,24),Je=g($e),et=x($e),tt=x(Je),ot=$e.length/3,rt=new i(bt.length);for(let e=2;e<rt.length;e+=3)rt[e]=1;nt=x(rt);for(const e of Rt)(r.abs(e.z-Lt)<r.abs(It.z-Lt)||r.abs(e.z-Lt)===r.abs(It.z-Lt)&&r.abs(e.x)<r.abs(It.x))&&(It=e);at=(()=>{const e=[],t=[.7*-24,-12,12,.7*24],o=.8*-24,r=.8*24;for(const n of t)for(let t=0;t<4;t++){const a=t/3,s=o*(1-a)+r*a;e.push({x:n,z:s})}return e})();{const e=r.min(at.length,16),t=new i(48),n=new i(48),s=new i(48),l=new i(16),m=new i(16),f=a(25*r.PI/180),d=a(50*r.PI/180);for(let o=0;o<e;o++){let e=3*o,r=at[o].x,a=at[o].z;t[e]=r,t[e+1]=3,t[e+2]=a,n[e+1]=-1,s[e]=1.8,s[e+1]=1.6,s[e+2]=1.1,l[o]=f,m[o]=d}o.uniform1i(le,e),o.uniform3fv(me,t),o.uniform3fv(fe,n),o.uniform3fv(de,s),o.uniform1fv(ce,l),o.uniform1fv(ue,m)}st=Array.from({length:25},()=>({pos:[m(-.9*vt,.9*vt),0,m(-.9*vt,.9*vt)],dir:(()=>{let e=m(-1,1),t=m(-1,1),o=1/(s(e,t)||1);return[e*o,t*o]})(),spd:m(.8,3.2),yellow:0,prevLat:0,abducted:0,abdTimer:0,carX:0,carZ:0,carPhase:0,captured:0,driveOff:0,driveSpeed:0})),mt=e.getElementById("avatarEyes"),ft=e.getElementById("avatarCross"),(()=>{const t=e.getElementById("avatarTip"),o={pendingCategory:null,introRemaining:3},r=()=>{const e=(()=>{let e=d.general;return o.pendingCategory&&d[o.pendingCategory]?(e=d[o.pendingCategory],o.pendingCategory=null):o.introRemaining>0&&d.intro.length&&(e=d.intro,o.introRemaining--),e[Math.random()*e.length|0]})();t.textContent=e,t.style.display="block",setTimeout(()=>t.style.display="none",3e3)};if(!t)return;e.defaultView.queueQuoteCategory=e=>{o.pendingCategory=e};let n=null;e.defaultView.startAvatarQuotes=()=>{n||(r(),n=setInterval(r,1e4))}})(),it=e.getElementById("start"),lt=e.getElementById("startEyes"),(()=>{if(!lt)return;const e=()=>{lt.style.transform="scaleY(.06)",setTimeout(()=>lt.style.transform="scaleY(1)",110),setTimeout(e,900+2e3*l())};e()})(),e.getElementById("play").onclick=()=>{lo=1,it&&it.remove(),fo=performance.now(),io=fo,so=Date.now(),"function"==typeof startAvatarQuotes&&startAvatarQuotes()},Ae=b(.6,.12,12,18),ge=g(Ae),ve=x(Ae),we=x(ge),Te=Ae.length/3,dt=e=>{for(let t=0;t<e;t++){const e=Rt[Math.random()*Rt.length|0],t=e.x,o=e.z,r=Math.sign(t)||0,n=Math.sign(o)||0;st.push({pos:[t,0,o],dir:[r,n],spd:m(.8,3.2),yellow:0,prevLat:0,abducted:0,abdTimer:0,carX:0,carZ:0,carPhase:0,captured:0,driveOff:0,driveSpeed:0})}},ct=f=>{requestAnimationFrame(ct),ut=t.width,yt=t.height;const d=r.min((f-fo)/1e3,.033);if(fo=f,!lo)return;z((Date.now()-so)/1e3);const c=f-io,u=c/6e3%21,y=u<6?0:u<9?(u-6)/3:u<12?1:u<15?1-(u-12)/3:0,x=1-.95*y;!Tt&&Math.floor(c/6e3)>=3&&(dt(100),Tt=!0);const g=[kt[0],kt[1]+.6,kt[2]],v=[g[0]+Yt[0],g[1]+Yt[1],g[2]+Yt[2]],w=_.v(v,g,[0,1,0]),T=60*r.PI/180,b=ut/yt,K=_.p(T,b,.1,200),q=pt/ut*2-1,H=-(ht/yt*2-1),Q=r.tan(T/2),Z=q*Q*b,ne=H*Q,ae=_.nm(_.sub(g,v)),se=_.nm(_.cr(ae,[0,1,0])),ie=_.cr(se,ae);let le=_.nm([se[0]*Z+ie[0]*ne+1*ae[0],se[1]*Z+ie[1]*ne+1*ae[1],se[2]*Z+ie[2]*ne+1*ae[2]]),me=(0-v[1])/le[1],fe=isFinite(me)&&me>0?v[0]+le[0]*me:qt[0],de=isFinite(me)&&me>0?v[2]+le[2]*me:qt[1];fe=r.max(-vt,r.min(vt,fe)),de=r.max(-vt,r.min(vt,de));const ce=1-r.exp(-20*d);qt[0]+=(fe-qt[0])*ce,qt[1]+=(de-qt[1])*ce;const ue=qt[0]-kt[0],he=qt[1]-kt[2],Ae=s(ue,he)||1,ge=Ae<3?Ae/3*10:10,ve=ue/Ae,we=he/Ae,Te=1-r.exp(-6*d);Kt[0]+=(ve*ge-Kt[0])*Te,Kt[2]+=(we*ge-Kt[2])*Te,kt[0]+=Kt[0]*d,kt[2]+=Kt[2]*d,kt[0]>vt&&(kt[0]=vt,Kt[0]*=-.7),kt[0]<-vt&&(kt[0]=-vt,Kt[0]*=-.7),kt[2]>vt&&(kt[2]=vt,Kt[2]*=-.7),kt[2]<-vt&&(kt[2]=-vt,Kt[2]*=-.7);const Se=r.atan2(we,ve),Re=r.atan2(n(Se-Wt),a(Se-Wt));Wt+=Re*(1-r.exp(-12*d));const Ie=4*a(Wt),Le=4*n(Wt)+10;Yt[0]+=(Ie-Yt[0])*(1-r.exp(-2*d)),Yt[2]+=(Le-Yt[2])*(1-r.exp(-2*d)),o.viewport(0,0,ut,yt);const Pe=.7*(1-y)+.02*y,Ee=.8*(1-y)+.03*y,ze=.95*(1-y)+.08*y;o.clearColor(Pe,Ee,ze,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.useProgram(F),p(W,0,5,15),o.uniform1f(re,x);{const e=r.max(0,r.min(1,y));!Xt&&!_t&&Bt<.05&&e>=.05&&(_t=1,Ft=f),Bt>.05&&e<.02&&(Xt=0,_t=0);let t=0;if(_t){const o=f-Ft;if(o>=Ot.reduce((e,t)=>e+t.on+t.off,0))_t=0,Xt=1,t=e;else{let r=0,n=0;for(let e=0;e<Ot.length;e++){const t=Ot[e];if(o<r+t.on){n=1;break}if(r+=t.on,o<r+t.off){n=0;break}r+=t.off}t=n?e:0}}else t=Xt?e:0;o.uniform1f(oe,t),Vt=t,Bt=e}o.uniformMatrix4fv(V,!1,K),o.uniformMatrix4fv(k,!1,w),A(xt,X,3),o.disableVertexAttribArray(B),o.vertexAttrib3f(B,0,1,0),h(_.T(0,-be,0)),p(Y,.16,.46,.16),o.polygonOffset(1,1),o.drawArrays(o.TRIANGLES,0,6),A(At,X,3),h(_.I()),p(Y,.5,.5,.5),o.polygonOffset(1,2),o.drawArrays(o.TRIANGLES,0,6),o.polygonOffset(0,0),o.enableVertexAttribArray(B);const Ne=s(Kt[0],Kt[2]);Ht+=8*r.max(Ne/7,2)*d,Qt+=4*d,0===Jt&&(to-=d)<=0&&(Jt=1,eo=0),1===Jt&&((eo+=d)<.1?$t=1-eo/.1:eo<.2?$t=(eo-.1)/.1:($t=1,Jt=0,to=1.5+2.5*l())),(()=>{if(mt&&ft)if(Zt)mt.style.display="none",ft.style.display="flex";else{ft.style.display="none",mt.style.display="flex";const e=Math.max(.06,Math.min(1,$t));mt.style.transform=`translate(-50%,-50%) scale(0.85, ${e})`}})();const Ce=Zt&&(10*jt|0)%2==0;!oo&&Zt&&"function"==typeof queueQuoteCategory&&queueQuoteCategory("nineLives"),oo=Zt;{const{pos:e,dir:t}=S(),r=Math.max(0,Math.min(1,y));o.uniform1f(j,$t>.5&&r>.01&&!Ce?1:0),o.uniform3f(U,e[0],e[1],e[2]),o.uniform3f($,t[0],t[1],t[2]),o.uniform3f(J,2*r,2*r,1.6*r),o.uniform1f(ee,Gt),o.uniform1f(te,Dt)}p(Y,.35,.4,.5),h(_.T(0,be,0)),A(pe,X,3),A(xe,B,3),o.drawArrays(1,0,ye.length/3);for(const e of Rt){A(Ye,X,3),A(qe,B,3);const t=_.m(_.T(e.x,e.y,e.z),_.S(e.sx,e.sy,e.sz));p(Y,e.color[0],e.color[1],e.color[2]),h(t),o.drawArrays(o.TRIANGLES,0,He),A(Ze,X,3),A(je,B,3);const n=.6*r.min(e.sx,e.sz),a=e.y+e.sy*gt*.5,s=_.m(_.T(e.x,a,e.z),_.S(e.sx,n,e.sz));p(Y,1,.5,.31),h(s),o.drawArrays(o.TRIANGLES,0,Ue);const i=e.sx*gt,l=e.sy*gt,m=e.sz*gt,f=.003,d=r.abs(e.x)<=r.abs(e.z);let u,y;if(d){const t=e.z<0;u=e.z+(t?m/2+f:-m/2-f),y=t?0:r.PI}else{const t=e.x<0;u=e.x+(t?i/2+f:-i/2-f),y=t?-r.PI/2:r.PI/2}if(e!==It){const t=r.min(5,r.max(2,.45*e.sy|0)),o=r.min(2,t>2?2:0),n=r.max(1,t-o),a=r.min(3,r.max(2,.25*e.sx|0)),s=r.min(3,r.max(2,.25*e.sz|0)),f=(d?i:m)/(d?a:s),c=.92*f,p=l/t*1.5;for(let r=0;r<n;r++){const n=e.y-l/2+(o+r+.5)*(l/t);for(let t=0;t<(d?a:s);t++){const o=(d?e.x-i/2:e.z-m/2)+(t+.5)*f;d?N(o,n,u,y,c,p):N(u,n,o,y,c,p)}}}{const t=4,o=9,r=0;let n=e.x,a=e.z,s=.0015;d?(a=u+(0===y?s:-s),n=e.x):(n=u+(y===-Math.PI/2?s:-s),a=e.z),C(n,r,a,y,t,o)}if(e===It){const t=1.5*l,n=e.y+.15*l,a=y,s=.03*t,i=.2*t,m=.08*t,f=-c*r.PI/3e3,x=.01;let g=e.x,v=u;d?v+=0===a?x:-x:g+=a===-r.PI/2?x:-x;const w=-.003,T=0,b=.0015,S=.003,R=.002,I=.7142857*t;A(Ve,X,3),o.disableVertexAttribArray(B),o.vertexAttrib3f(B,0,0,1),p(Y,.08,.08,.1),h(_.m(_.T(g,n,v),_.m(_.Ry(a),_.m(_.T(0,0,w),_.S(1.08*I,1.08*I,R))))),o.drawArrays(o.TRIANGLES,0,Ke),p(Y,1,1,1),h(_.m(_.T(g,n,v),_.m(_.Ry(a),_.m(_.T(0,0,T),_.S(I,I,R))))),o.drawArrays(o.TRIANGLES,0,Ke),A(St,X,3),A(nt,B,3),p(Y,.2,.2,.2);const L=[{dx:0,dy:+m,sx:s,sy:i},{dx:0,dy:-m,sx:s,sy:i},{dx:+m,dy:0,sx:i,sy:s},{dx:-m,dy:0,sx:i,sy:s}];for(const e of L)h(_.m(_.T(g+e.dx,n+e.dy,v),_.m(_.Ry(a),_.m(_.T(0,0,b),_.S(e.sx,e.sy,1))))),o.drawArrays(o.TRIANGLE_STRIP,0,4);p(Y,.9,.2,.2);const P=.3*t;h(_.m(_.T(g,n,v),_.m(_.Ry(a),_.m(_.Rz(f),_.m(_.T(0,.15*P,S),_.S(.8*s,P,1)))))),o.drawArrays(o.TRIANGLE_STRIP,0,4)}}A(Ve,X,3),o.disableVertexAttribArray(B),o.vertexAttrib3f(B,0,1,0),p(Y,1,.2,.2),h(_.m(_.T(qt[0],3*be,qt[1]),_.S(.6,.2,.6))),o.drawArrays(o.TRIANGLES,0,Ke),o.enableVertexAttribArray(B);for(const e of st){const t=r.atan2(e.dir[1],e.dir[0]),o=I(e.pos[0],e.pos[2]),n=r.min(.6,2*o.strength);if(e.abducted&&(L(o.dir,n),G(e.carX,e.carZ,.62),P(),G(e.carX,e.carZ,.62)),!e.captured){const a=_.m(_.T(e.pos[0],0,e.pos[2]),_.Ry(t));if(L(o.dir,n),D(a,e.yellow,e),P(),$t>.5&&!Ce){const t=r.max(0,r.min(1,y));if(t>.01){const o=e.pos[0],n=0,i=e.pos[2],{pos:l,dir:m}=S(),f=l[0],d=l[1],c=l[2],u=m[0],y=m[1],p=m[2],h=o-f,x=n-d,A=i-c,g=s(h,x,A)||1,v=h/g,w=x/g,T=A/g,b=R(Dt,Gt,u*v+y*w+p*T);if(b>.001){const o=r.max(-w,0)*(1/(Nt+Ct*g+Mt*g*g))*b,n=r.min(.6,2*o*t);n>.01&&(L([v,w,T],n),D(a,e.yellow,e),P())}}}}if(!e.captured){const o=_.m(_.T(e.pos[0],0,e.pos[2]),_.Ry(t));D(o,e.yellow,e)}}const Me=a(Wt),Ge=n(Wt),De=new i([Me,0,Ge,0,0,1,0,0,-Ge,0,Me,0,kt[0],.25,kt[2],1]);let Oe=0,_e=1;Zt&&((jt-=d)<=0?Zt=0:(Oe=1*n(r.min(1,1-jt/1.2)*r.PI),_e=(10*jt|0)%2==0)),De[13]+=Oe;{const e=I(kt[0],kt[2]),t=r.min(.6,2*e.strength);L(e.dir,t),O(De,Ne,Zt&&!_e),P()}O(De,Ne,Zt&&!_e);const Fe=[];for(let e=0;e<st.length;e++){const t=st[e];if(t.abducted){if(t.abdTimer-=d,0===t.carPhase){const e=t.pos[0]-1-t.carX;t.carX+=e*r.min(1,2*d),r.abs(e)<.05&&(t.carPhase=1)}else{const e=t.carX+.45,o=2.5*d;t.pos[0]>e&&(t.pos[0]=r.max(e,t.pos[0]-o)),t.pos[0]<=e&&(t.captured||(t.captured=1,mo++,E()),t.driveOff=1,t.driveSpeed=12)}t.driveOff&&(t.carX+=t.driveSpeed*d,t.carX>vt+2&&Fe.push(e))}else{const e=.6*(l()-.5)*d,o=a(e),s=n(e),i=t.dir[0]*o-t.dir[1]*s,f=t.dir[0]*s+t.dir[1]*o;t.dir[0]=i,t.dir[1]=f,t.pos[0]+=i*t.spd*d,t.pos[2]+=f*t.spd*d,(t.pos[0]>vt||t.pos[0]<-vt)&&(t.pos[0]=r.max(-vt,r.min(vt,t.pos[0])),t.dir[0]*=-1),(t.pos[2]>vt||t.pos[2]<-vt)&&(t.pos[2]=r.max(-vt,r.min(vt,t.pos[2])),t.dir[1]*=-1),l()<.01&&(t.spd=m(.8,3.2));const c=t.dir[0],u=t.dir[1],y=-u,p=c,h=kt[0]-t.pos[0],x=kt[2]-t.pos[2],A=h*c+x*u,g=h*y+x*p;!t.yellow&&A>0&&A<2&&r.abs(g)<.45&&t.prevLat*g<0&&(t.yellow=1,t.abducted=1,t.abdTimer=3,t.carPhase=0,t.carX=t.pos[0]-6,t.carZ=t.pos[2]),t.prevLat=g}}for(let e=Fe.length-1;e>=0;e--)st.splice(Fe[e],1);if(!Zt)for(const e of st){if(e.abducted)continue;const t=kt[0]-e.pos[0],o=kt[2]-e.pos[2];if(s(t,o)<.6){Zt=1,jt=.8,Ut--,ro.querySelectorAll(".heart").forEach((e,t)=>{t<Ut?e.classList.remove("lost"):e.classList.add("lost")});break}}lo&&Ut<=0&&(lo=0,e.body.insertAdjacentHTML("beforeend",'<div id="gameover" class="overlay" style="font-size:64px;display:flex;flex-direction:column;align-items:center;justify-content:center"><div style="font-size:128px;margin-bottom:8px">Game<br>Over</div><div style="margin-bottom:6px">☠ '+mo+'</div><div style="margin-bottom:8px">⏱ '+((Date.now()-so)/1e3).toFixed(1)+'s</div><button id="play" class="btn">Play Again</button></div>'),e.getElementById("play").onclick=()=>location.reload());for(const e of at)M(e.x,e.z)},requestAnimationFrame(ct)}},function(){return t||(0,e[o(e)[0]])((t={exports:{}}).exports,t),t.exports})()</script>