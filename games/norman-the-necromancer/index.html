<title>Norman the Necromancer - js13kGames 2022</title><body style=display:flex;align-items:center;justify-content:center;background:#181622;touch-action:none><canvas id=c style=image-rendering:pixelated></canvas><script>const t=[0,18,16,15],e=[11,33,13,15],n=[16,18,16,15],i=[32,18,14,15],s=[58,18,13,15],a=[71,18,14,15],r=[85,18,13,15],o=[98,18,10,15],l=[72,61,8,7],h=[18,52,2,2],u=[16,54,16,16],f=[0,54,16,8],g=[22,48,4,4],m=[67,33,22,20],d=[48,50,7,7],p=[22,52,2,2],y=[24,52,1,1],w=[25,53,1,1],x=[24,53,1,1],v=[25,52,1,1],b=[65,54,6,6],N=[71,55,5,5],T=[76,56,4,4],j=[142,18,18,17],k=[11,51,3,3],q=[11,48,3,3],A=[11,49,1,1],M=[11,52,1,1],C=[108,18,14,17],D=[131,35,29,31],K=[109,35,22,22],X=[36,33,16,17],I=[122,18,20,11],B=[111,57,5,5],V=[24,33,12,14],P=[0,62,16,8],U=[111,62,5,5],L=[116,57,5,5],J=[116,62,5,5],R=[55,53,10,11],S=[121,57,5,5],E=[18,48,4,4],W=[20,52,1,1],Z=[21,52,1,1],$=[18,52,1,2],O=[21,53,1,1],G=[14,48,4,4],H=[17,53,1,1],F=[122,29,20,6],Y=[53,64,7,6],z=[60,64,5,6],Q=[49,64,4,6],_=[52,33,15,17],tt=[65,60,7,8],et=[89,33,14,15],nt=[89,48,15,20],it=[80,53,9,15],st=[83,54,2,2],at=[82,57,1,1],rt=[82,56,1,1],ot=[104,58,7,8],lt=[26,48,4,4],ht=[104,48,3,3],ct=[104,51,3,3],ut=[104,54,3,3],ft=[106,50,1,1],gt=[106,51,1,1],mt=[106,54,1,1],dt=[58,50,3,3],pt=[61,50,2,2],yt=[61,52,1,1],wt=[26,53,1,1],xt=[27,52,2,2],vt=[32,50,16,20],bt=[0,33,11,20],Nt=[46,18,12,15],Tt={"mMWTVw/$%":6,'I1f-=*+?{}"':4,"lj[]()|'`,":3,"i:.!":2},jt=Math.PI,kt=jt/2,qt=2*jt;function At(t,e){return{x:t,y:e}}function Mt(t,e,n){return t<e?e:t>n?n:t}function Ct(t){return[Math.cos(t),Math.sin(t)]}function Dt(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function Kt(t,e){let n=t.indexOf(e);n>=0&&t.splice(n,1)}function Xt(t){return t[It(t.length)]}function It(t){return Math.random()*t|0}function Bt(t=1){return Math.random()*t}let Vt={};for(let t in Tt)for(let e of t)Vt[e]=Tt[t];let Pt=new Image;Pt.src="./sprites.png";let Ut=c,Lt=Ut.getContext("2d");function Jt([t,e,n,i],s,a){St(t,e,n,i,s,a,n,i)}function Rt(t,e,n){Jt(t,e,-n-t[3])}function St(t,e,n,i,s,a,r,o){Lt.drawImage(Pt,t,e,n,i,0|s,0|a,r,o)}function Et(t,e,n,i,s){let[a,r,o,l]=t;if(i<=3||s<=3)return;let h=a,c=a+3,u=a+o-3,f=r,g=r+3,m=r+l-3,d=u-c,p=m-g,y=e,w=e+3,x=e+i-3,v=n,b=n+3,N=n+s-3,T=x-w,j=N-b;St(h,f,3,3,y,v,3,3),St(u,f,3,3,x,v,3,3),St(h,m,3,3,y,N,3,3),St(u,m,3,3,x,N,3,3),St(c,f,d,3,w,v,T,3),St(c,m,d,3,w,N,T,3),St(h,g,3,p,y,b,3,j),St(u,g,3,p,x,b,3,j),St(c,g,d,p,w,b,T,j)}let Wt=0,Zt=0;function $t(t,e=Wt,n=Zt){var i;Wt=0|e,Zt=0|n;for(let n=0;n<t.length;n++){let s=t[n];if("\n"===s)Wt=e,Zt+=7;else{let t=s.charCodeAt(0)-32,e=t%32*5,n=6*(t/32|0),a=Wt,r=Zt;Lt.drawImage(Pt,e,n,5,6,a,r,5,6),Wt+=null!=(i=Vt[s])?i:5}}}function Ot(){let{width:t,height:e}=Ut,n=Math.min(innerWidth/t,innerHeight/e,3);Ut.style.width=Ut.width*n+"px",Ut.style.height=Ut.height*n+"px",Lt.imageSmoothingEnabled=!1}let Gt=[],Ht=t=>t;function Ft(t,e,n,i,s=Ht){Gt.push({t:t,i:e,duration:n,o:i,l:s,h:0})}const Yt=[0,0];function zt([t,e]){return t+Math.random()*e}let Qt=[];const _t=class{constructor(t={}){this.u=new Set,this.x=0,this.y=0,this.w=0,this.g=0,this.m=[],this.frequency=0,this.p=Yt,this.angle=Yt,this.duration=Yt,this.v=Yt,this.C=Yt,this.k=Yt,this.M=0,this.done=!1,Object.assign(this,t),Qt.push(this)}extend(t){return Object.assign(this,t)}remove(){this.done=!0}update(t){let e=t/1e3;for(this.M+=this.frequency;!this.done&&this.M>0;)this.M-=1,this.R();for(let n of this.u)(n.h+=t)>=n.duration?(this.u.delete(n),_t.S.push(n)):(n.x+=n.q*e,n.y+=n.A*e,n.A-=n.k*e,n.y<=0&&(n.y=0,n.A*=-n.v,n.q*=n.C));this.done&&0===this.u.size&&Kt(Qt,this)}R(){let t=_t.S.pop()||{},e=zt(this.p),n=zt(this.angle),[i,s]=Ct(n);t.x=zt([this.x,this.w]),t.y=zt([this.y,this.g]),t.q=i*e,t.A=s*e,t.h=0,t.duration=zt(this.duration),t.v=zt(this.v),t.C=zt(this.C),t.k=zt(this.k),t.variant=0|zt([0,this.m.length]),this.u.add(t)}B(t){for(let e=0;e<t;e++)this.R();return this}};let te=_t;te.S=[];class ee{constructor(){this.x=0,this.y=0,this.q=0,this.A=0,this.k=0,this.v=0,this.C=0,this.$=0,this.N=[0,0,0,0],this.tags=0,this.O=0,this.T=0,this.D=0,this.j=0,this.F=0,this.H=!1,this.I=!1,this.groupId=0,this.P=[],this.U=0,this.G=0}is(t){return(this.tags&t)>0}bounds(){return{x:this.x,y:this.y,w:this.N[2],g:this.N[3]}}L(){return At(this.x+this.N[2]/2,this.y+this.N[3]/2)}update(t){this.V(t),this.G-=t,this.G<=0&&(this.G=this.U,this.W()),this.K&&(this.K.x=this.x,this.K.y=this.y)}X(t=new ne(this),e=this.P.length){let{constructor:n}=Object.getPrototypeOf(t);return n!==ne&&this.Y(n)||(this.P.splice(e,0,t),t.J()),t}Z(t){Kt(this.P,t),t._()}Y(t){return this.P.find(e=>e instanceof t)}V(t){for(let e of this.P)e.V(t)}W(){for(let t of this.P)if(++t.tt>=t.et&&(t.tt=0,t.W()))break}nt(t){for(let e of this.P)e.nt(t)}it(t){for(let e of this.P)e.it(t)}st(){for(let t of this.P)t.st();this.I&&game.ot(this)}rt(t){for(let e of this.P)e.rt(t);this.H&&game.ot(this)}}class ne{constructor(t){this.object=t,this.et=1,this.tt=0}J(){}_(){}W(){}st(){}nt(t){}it(t){}V(t){}rt(t){}}function ie(t,e,n,i){return{lt:t,name:e,description:n,ht:i}}function se(){return new te({duration:[1e4,5e3],C:[.6,0],p:[5,20],angle:[kt-.5,1],v:[.1,.5],k:[60,0],m:[[b],[N],[T]]})}function ae(){return new te({duration:[500,1e3],p:[1,10],angle:[Math.PI,-.5],v:[0,0],frequency:2,k:[3,0],C:[.5,0],m:[[p,y,w],[y,w,x],[p,y,w]]})}function re(t,e){return new te({...t,duration:[500,1e3],p:[1,10],angle:[kt-.2,.4],v:[0,0],frequency:2,k:[-2,0],m:e})}function oe(){return ae().extend({frequency:.5,m:[[k,q,A],[q,A,M],[k,A]]})}function le(t){return re(t.bounds(),[[p,y,w],[y,w,x],[p,w,v]]).extend({frequency:0})}let he=new AudioContext;const ce=-12,ue=[-.8,1,.8,.8,-.8,-.8,-1],fe=[ce,-10,-9,-7,-4,-5,-1,0,0,2,3,5,8,7,11,12];let ge=new GainNode(he,{gain:0});function me(t=3,e=2){let n=new ConvolverNode(he,{}),i=he.sampleRate,s=i*t,a=he.createBuffer(2,s,i),r=a.getChannelData(0),o=a.getChannelData(1);for(let t=0;t<s;t++)r[t]=(2*Math.random()-1)*Math.pow(1-t/s,e),o[t]=(2*Math.random()-1)*Math.pow(1-t/s,e);return n.buffer=a,n}function de(){let t=new GainNode(he,{gain:1});t.connect(ge);let e=new GainNode(he,{gain:0});e.connect(t);let n=new BiquadFilterNode(he,{type:"lowpass",frequency:500});n.connect(e);let i=new OscillatorNode(he);return i.connect(n),{gain:e,ut:i,filter:n,volume:t,play(t,n){e.gain.setValueAtTime(.2,t),i.frequency.setValueAtTime(n,t)},start(){this.ut.start(),this.ct()},ct(){t.gain.linearRampToValueAtTime(.5,he.currentTime+1)},ft(){t.gain.linearRampToValueAtTime(0,he.currentTime+1)}}}function pe(t=1,e=1){let n=de();n.ut.setPeriodicWave(he.createPeriodicWave(ue,ue));let i=me(t,e);return i.connect(n.gain),n.filter.connect(i),n.filter.type="highpass",n.filter.frequency.value=200,n}function ye(t,e=0,n){let i=he.currentTime;!function s(){let a=new OscillatorNode(he);a.start(i);for(let s=0;s<t.length;s+=2){let a=t[s],o=.25/(t[s+1]/4),l=(r=a+e,440*Math.pow(Math.pow(2,1/12),r));n.play(i,l,o),i+=o}var r;a.stop(i),a.onended=()=>{s()}}()}ge.connect(he.destination);let we=!1;function xe(t=4,e=[1,2,4,8],n=fe){let i=t,s=[];for(;i>0;){let t=Xt(e),a=Xt(n),r=1/t;i-r<0||(i-=r,s.push(a,t))}return s}let ve={gt:function(){let t=de();return t.filter.type="lowpass",t.filter.frequency.value=80,t.ut.frequency.value=150,t.play=e=>{t.ut.frequency.setValueAtTime(150,e),t.gain.gain.setValueAtTime(1,e),t.filter.frequency.setValueAtTime(80,e),t.ut.frequency.exponentialRampToValueAtTime(.001,e+.5),t.gain.gain.exponentialRampToValueAtTime(.001,e+.5),t.filter.frequency.linearRampToValueAtTime(.001,e+.5)},t}(),dt:pe(6,1),wt:function(){let t=de(),e=me(3,1);return e.connect(t.gain),t.filter.connect(e),t.ut.type="sawtooth",t.play=(e,n)=>{t.ut.frequency.setValueAtTime(n,e),t.gain.gain.setValueAtTime(.25,e),t.gain.gain.setTargetAtTime(0,e+.05,.2)},t}(),vt:pe(3,.25),yt:pe(3,1),xt:pe()},be=[ve.gt,ve.wt],Ne=[ve.xt,ve.vt,ve.yt];function Te(){if(0===game.level&&ve.dt.start(),1===game.level&&ve.wt.start(),2===game.level&&ve.gt.start(),9===game.level){for(let t of be)t.ft();for(let t of Ne)t.start()}else for(let t of be)t.ct()}class je extends ne{rt(t){let e=this.object.T,n=t.T;He(t,e,this.object),He(this.object,n,t)}}class ke extends ne{constructor(t,e){super(t),this.duration=e,this.h=0}V(t){(this.h+=t)>=this.duration&&game.ot(this.object)}}class qe extends ne{constructor(t,e){super(t),this.step=e}W(){this.object.y>0||(Ft(this.object.x,this.object.x+this.step,200,(t,e)=>{this.object.x=t,this.object.$=2*Math.sin(e*Math.PI),1===e&&this.object.k>=100&&(ln=50)}),(this.step<0&&this.object.x<0||this.step>0&&this.object.x>game.bt.width)&&game.ot(this.object))}}class Ae extends ne{constructor(){super(...arguments),this.Ct=1}rt(t){He(t,this.Ct,this.object)}}class Me extends ne{constructor(){super(...arguments),this.N=Q,this.et=3,this.Ct=1,this.K=re({x:0,y:0,w:0,g:0},[[B,h],[h]]).extend({k:[10,30],p:[10,30],frequency:0})}W(){var t;this.K.extend(this.object.L()),null==(t=this.K)||t.B(1),He(this.object,1,this.object)}}class Ce extends ne{constructor(t,e){super(t),this.mask=e,this.N=Y,this.K=re({x:0,y:0,w:0,g:0},[[B,h],[h]]).extend({k:[10,30],p:[10,30],frequency:0})}nt(t){t.kt&&t.kt.is(this.mask)&&(He(this.object,-t.Ct,this.object),t.Ct=0,this.K.extend(this.object.bounds()).B(4))}}class De extends ne{V(){let t,e=this.object,n=100;for(let a of game.Mt)if(a.is(this.object.O)){let r=(i=e,s=a,Math.hypot(s.x-i.x,s.y-i.y));r<n&&(t=a,n=r)}var i,s,a,r;if(t){let n=(a=e.q,r=e.A,Math.atan2(r,a)),i=n+(Dt(e,t.L())-n)/20,s=Math.hypot(e.q,e.A),[o,l]=Ct(i);e.q=o*s,e.A=l*s}}}class Ke extends ne{constructor(t,e,n){super(t),this.create=e,this.Rt=n,this.St=0,this.qt=0}At(t){}V(t){if((this.St+=t)>this.Rt){this.St=0,this.qt++;let t=this.create();game.Bt(t,this.object.x,this.object.y),this.At(t)}}}const Xe=class extends ne{constructor(){super(...arguments),this.$t=!1,this.Nt=void 0,this.rt=()=>this.$t=!0,this.J=()=>{var t,e;this.Nt=(t=Xe.Ot)[e=this.object.groupId]||(t[e]={total:0,Tt:0}),this.Nt.total++}}_(){this.$t&&this.Nt.Tt++,--this.Nt.total||(this.Nt.Tt?game.Dt=Mt(game.Dt+1,0,10):game.Dt=0)}};let Ie=Xe;Ie.Ot={};class Be extends ne{constructor(){super(...arguments),this.N=z}nt(t){t.Ct>0&&(t.Ct=0)}}class Ve extends ne{constructor(){super(...arguments),this.jt=10}W(){return this.jt--<=0&&this.object.Z(this),!0}}class Pe extends ne{rt(t){for(let e=0;e<3;e++){let e=Je();e.A=-200,e.q=It(20)-10,e.y=Mt(50+It(100),0,game.bt.Ft-10),e.x=t.x+It(50)-25,game.Bt(e)}}}function Ue(){let t=new ee;return t.N=l,t.k=100,t.tags=8,t}function Le(){let t=new ee;return t.N=g,t.tags=16,t.O=3,t.k=100,t.K=ae(),t.C=.1,t.H=!0,t.I=!0,t.X(new Ae(t)),t}function Je(){let t=Le();return t.N=lt,t.K.frequency=.8,t.K.m=[[ct,ht,ut,ft],[ct,ht,ut,gt],[ht,ut,mt],[ft,gt,mt],[H]],t}function Re(){let t=new ee;return t.N=e,t.tags=5,t.O=2,t.T=t.D=1,t.U=1e3,t.P.push(new qe(t,16)),t.P.push(new je(t)),t}function Se(){let t=Re();return t.N=bt,t.T=t.D=3,t.U=1500,t}function Ee(){let t=new ee;return t.N=Xt([i,Nt,s,a]),t.C=.8,t.k=75,t.x=game.bt.width,t.tags=3,t.T=t.D=1,t.U=600,t.X(new qe(t,-16)),t.F=.75,t.j=5,t}function We(){let t=Ee();return t.T=t.D=2,t}function Ze(){let t=Ee();return t.N=r,t.U=300,t.T=t.D=2,t}function $e(){let t=Ee();return t.N=F,t.U=200,t.j=5,t.F=0,t}function Oe(){let t=Ee();t.N=X,t.T=t.D=4,t.j=10;let e=t.Y(qe),n=!1,i=t.X();return i.et=3,i.W=()=>{n=!n,e.step=n?0:-16,t.N=n?_:X},i.nt=t=>{var e;if(n&&(null==(e=t.kt)?void 0:e.is(16))&&t.kt.q>0){t.Ct=0;let e=function(){let t=new ee;return t.N=S,t.tags=16,t.O=33,t.T=1,t.I=!0,t.H=!0,t.X(new Ae(t)),t.X(new ke(t,3e3)),t.C=.9,t.K=oe(),t}();e.q=t.kt.q*=-1,e.A=t.kt.A*=-.25,e.k=t.kt.k,game.Bt(e,t.kt.x-e.N[2]-1,t.kt.y)}},t.P.reverse(),t}function Ge(){let t=new ee;return t.N=it,t.tags=2,t.T=t.D=3,t.j=10,t.X(new ke(t,3e4)),t.X(new Ke(t,()=>Xt([Ee,We,Ze])(),3e3)),t.K=re(t.bounds(),[[st,at,rt],[at,rt],[rt]]).extend({frequency:.2}),t}function He(t,e,n){let i={Ct:e,kt:n};t.nt(i),t.T=Mt(t.T-i.Ct,0,t.D),t.T||Fe(t,n)}function Fe(t,e){var n;let i={object:t,Ht:e,j:t.j};if(t.is(1)){let e=t.L();se().extend(e).B(2+It(3)).remove(),t.it(i);for(let t of game.Et)null==(n=t.it)||n.call(t,i);Bt()<=t.F&&game.Bt(Ue(),e.x,e.y),game.It(i.j)}game.ot(t)}let Ye=0,ze=1;const Qe=[Ee,Ze,function(){let t=Ee();t.N=o,t.U=600,t.T=t.D=3,t.j=10;let e=new ne(t);return e.et=5,e.W=()=>{for(let e of game.Mt)e.is(2)&&He(e,-1,t);re(t.bounds(),[[k,q,A],[q,A,M],[k,A]]).B(10).remove()},t.X(e),t},function(){let t=Ee();return t.N=m,t.U=1e3,t.T=t.D=10,t.j=25,t},function(){let t=Ee();return t.N=V,t.U=500,t.T=t.D=15,t.X(new Ke(t,$e,2e3)),t.j=100,t},function(){let t=Ee();t.N=et,t.U=500,t.T=t.D=5;let e=t.X(),n=t.Y(qe),i=new Ce(t,16),s=!1,a=n.step;return e.et=5,e.W=()=>{s=!s,s?t.X(i):t.Z(i),t.N=s?nt:et,n.step=s?0:a},t.j=20,t},Oe,function(){let t=Ee();t.N=j,t.U=1e3,t.T=t.D=5,t.j=15;let e=t.X(),n=!1,i=0;return e.W=()=>{n=i++%4>1,t.N=n?I:j,e.N=n?z:void 0},e.nt=t=>{n&&(t.Ct=Math.min(0,t.Ct))},t},function(){let t=Ee();return t.N=C,t.T=t.D=15,t.j=10,t.X(new Ke(t,Ge,3e3)),t},function(){let t=Ee();t.N=D,t.U=5e3,t.T=t.D=100,t.P=[],t.k=1e3,t.K=oe().extend({frequency:.2,angle:[kt,.5],w:t.N[2],g:t.N[3]});let e=1,n=new qe(t,-32),i=new Ke(t,Oe,2e3),s=new Ce(t,16),a=new Be(t),r=new ne(t);return t.X(n),t.X(r),r.nt=({Ct:r})=>{let o=t.T-r<=0;if(1===e&&o)e=2,t.X(i),t.X(s),t.X(a),n.step*=-1;else if(3===e&&o){ve.gt.ct(),e=4,t.T=t.D,t.N=K,t.U=t.G=1e3,n.step/=2;let i=0;t.X().V=t=>{(i+=t)>300&&(i=0,game.Bt(Ue(),It(game.bt.width),game.bt.Ft))}}},i.At=()=>{i.qt>=5&&(e=3,t.Z(s),t.Z(a),t.Z(i),n.step*=-1)},t},$e,Ee,We],_e={10:()=>It(500),0:()=>It(200),12:()=>It(200),11:()=>-It(500)},tn=[4,0,98,4,0,98,2,0,1,1,98,2,0,1,1,4,0,99,2,1,4,0,98,3,1,4,0,98,8,0,2,1,98,1,3,99,1,2,98,4,12,98,2,12,1,2,98,2,1,1,2,98,4,0,2,12,2,1,1,2,99,1,7,98,4,0,3,12,98,1,7,1,2,1,98,2,1,1,2,1,7,98,8,0,98,1,7,1,3,1,7,99,1,10,98,3,10,98,7,10,1,4,99,4,12,98,1,5,98,4,12,1,3,2,1,98,4,12,1,5,98,2,5,1,2,98,1,8,99,20,11,1,5,20,11,1,5,20,11,98,20,11,1,5,20,11,1,5,20,11,98,3,3,99,10,12,1,2,10,12,1,2,98,10,12,1,8,1,7,98,5,12,3,1,3,5,98,1,3,1,8,1,3,99,1,0,98,2,6,98,2,1,98,10,6,98,10,6,2,2,10,6,98,2,6,1,7,1,3,1,2,98,2,6,1,7,1,3,1,8,99,1,9,99];let en=0,nn=0;function sn(){return!game.Mt.some(t=>t.is(2))}let an={Et:[],items:[],selectedIndex:0};function rn(t){an.selectedIndex=Mt(an.selectedIndex+t,0,an.items.length-1)}function on(){let t=function(t){let e=(t=[...t]).length;for(;e;){let n=It(e--);[t[e],t[n]]=[t[n],t[e]]}return t}(an.Et.filter(t=>game.Pt(t))),e=t.filter(t=>1!==t.Ut);return t.filter(t=>1===t.Ut).slice(0,1).concat(e.slice(0,2)).map(t=>({name:t.name,description:t.description,lt:1===t.Ut?200+It(100):75+It(100),ht(){Kt(an.Et,t),game.Gt(t)}}))}let ln=0,hn=At(0,150);function cn(t,e,n,i,s,a){let r=t-4*i/2;for(let t=0;t<i;t++)Rt(t<n?s:a,r+4*t,e)}let un={tags:0,name:"Streak",description:"",Lt:t=>t.X(new Ie(t))},fn={tags:1,name:"Bouncing",description:"Spells bounce",Lt(t){t.X(new ke(t,3e3)),t.I=!1,t.v=.5}},gn={tags:2,Vt:2,Ut:1,name:"Doubleshot",description:"Cast 2 spells",Wt(){game.Kt.zt=2}},mn={tags:8,Ut:1,name:"Hunter",description:"Spells seek targets",Lt(t){t.X(new De(t))}},dn={tags:0,name:"Weightless",description:"Spells are not affected by gravity",Lt(t){t.k=0,t.C=0,t.v=1}};class pn extends ne{rt(t){t.k<1e3&&Ft(t.x,t.x+16,200,e=>t.x=e)}}let yn={tags:0,name:"Knockback",description:"Spells knock backwards",Lt(t){t.X(new pn(t))}},wn={tags:0,Xt:1,name:"Ceiling",description:"Adds a ceiling",Wt(){game.bt.Ft=48}};class xn extends ne{constructor(){super(...arguments),this.split=!1}V(){if(!this.split&&this.object.A<0){this.split=!0;let t=this.object,e=Le(),n=Le();e.x=n.x=t.x,e.y=n.y=t.y,e.q=n.q=t.q,e.A=n.A=t.A,e.q-=20,n.q+=20,e.groupId=n.groupId=t.groupId,game.Lt(e,!0),game.Lt(n,!0),game.Bt(e),game.Bt(n)}}}let vn={tags:2,Vt:2,Ut:1,name:"Rain",description:"Spells split when they drop",Yt:!1,Lt(t){t.X(new xn(t))}},bn={tags:0,name:"Drunkard",description:"2x damage, wobbly aim",Lt(t){t.q+=It(100)-50,t.A+=It(100)-50,t.Y(Ae).Ct*=2}},Nn={tags:0,name:"Seer",description:"Spells pass through the dead",Lt(t){t.O=2}},Tn={tags:0,name:"Tearstone",description:"2x damage when < half HP",Lt(t){game.Jt.T<game.Jt.D/2&&(t.Y(Ae).Ct*=3)}},jn={tags:0,name:"Impatience",description:"Resurrection recharges 2x faster",Wt(){game.Zt.Qt/=2}},kn={tags:64,name:"Bleed",description:"Inflicts bleed on hits",Lt(t){t.N=E,t.K.extend({m:[[$,Z,W],[O,$,Z],[$,Z,W]],frequency:5,angle:[jt,0],k:[20,50]}),t.X().rt=t=>{t.X(new Me(t))}}},qn={tags:0,name:"Allegiance",description:"Summon your honour guard after resurrections",_t(){for(let t=0;t<3;t++){let e=Se();e.U=200,game.Bt(e,-15*t,0)}}},An={tags:0,name:"Salvage",description:"Corpses become souls at the end of levels",te(){let t=game.Mt.filter(t=>t.is(8));for(let e of t){let t=se().extend({...e.L(),m:[[g]],duration:[100,1e3]});t.B(5),t.remove(),game.ot(e),game.It(5)}}},Mn={tags:0,Ut:1,name:"Studious",description:"Rituals are 50% cheaper",ee(){for(let t of an.items)t.lt=t.lt/2|0}},Cn={tags:0,Ut:1,name:"Electrodynamics",description:"Lightning strikes after hits",Lt(t){t.X(new Pe(t))}},Dn={tags:0,name:"Chilly",description:"10% chance to freeze enemies",Lt(t){Bt()<=.1&&(t.K.m=[[dt,pt,yt]],t.N=G,t.Y(Ae).Ct=0,t.X().rt=t=>{t.k<1e3&&t.X(new Ve(t),0)})}},Kn={tags:0,name:"Giants",description:"20% chance to resurrect giant skeletons",ne(t){Bt()<.2&&(game.ot(t),game.Bt(Se(),t.x,t.y))}},Xn={tags:0,name:"Avarice",description:"+1 soul for each corpse you resurrect",ne(){game.It(1)}},In={tags:0,name:"Hardened",description:"Unead have +1 HP*",ne(t){t.T=t.D+=1}},Bn=function(){let t=new ee;return t.x=5,t.tags=36,t.N=n,t.O=2,t.U=1e3,t.T=t.D=5,t.K=le(t),t.rt=e=>{He(t,e.T),Fe(e),t.T<=0&&(window.location=window.location)},t}();Bn.N=l;let Vn=new class{constructor(t){this.bt={width:400,height:200,floor:0,Ft:200},this.Mt=[],this.Jt=void 0,this.Et=[],this.state=0,this.j=0,this.Dt=0,this.level=0,this.ie=[],this.Kt={se:0,oe:15,ae:180,zt:1,re:.1,le:3,he:3,ue:1e3,ce:0},this.Zt={Qt:1e4,tt:1e4},this.Jt=t,this.Bt(t),window.game=this}Bt(t,e=t.x,n=t.y){t.x=e,t.y=n,this.Mt.push(t)}ot(t){var e;null==(e=t.K)||e.remove();for(let e of Array.from(t.P))t.Z(e);Kt(this.Mt,t)}fe(){return this.Dt/10}It(t){this.j+=t+t*this.fe()}Gt(t){var e;this.Et.push(t),null==(e=t.Wt)||e.call(t)}Pt(t){if(t.Vt)for(let e of this.Et)if(t.Vt&e.tags)return!1;if(t.Xt){for(let e of this.Et)if(t.Xt&e.tags)return!0;return!1}return!0}update(t){this.ge(t),this.me(t),this.de(t),this.pe(t),this.we(t)}ge(t){game.Zt.tt+=t,game.Jt.K.frequency=game.Zt.tt>=game.Zt.Qt?.1:0}me(t){this.Kt.he<this.Kt.le&&(this.Kt.ce+=t,this.Kt.ce>this.Kt.ue&&(this.Kt.he+=1,this.Kt.ce=0))}we(t){var e;for(let n of this.Et)null==(e=n.V)||e.call(n,t)}de(t){for(let e of this.Mt)e.update(t)}pe(t){let e=t/1e3;for(let t of this.Mt)t.x+=t.q*e,t.y+=t.A*e;for(let t of this.Mt){let n=this.bt.floor,i=this.bt.Ft-t.N[3];(t.y<n||t.y>i)&&(t.y=Mt(t.y,n,i),Math.abs(t.A)>=10&&t.st(),t.A*=-t.v),t.y!==n&&t.y!==i||(t.q*=1-t.C),t.k&&t.y>0&&(t.A-=t.k*e)}for(let t of this.Mt)for(let e of this.Mt)t.O&e.tags&&(n=t.bounds(),i=e.bounds(),n.x<i.x+i.w&&n.y<i.y+i.g&&n.x+n.w>i.x&&n.y+n.g>i.y&&t.rt(e));var n,i}ve(){var t;for(let e of game.Et)null==(t=e.ve)||t.call(e)}te(){var t;for(let e of game.Et)null==(t=e.te)||t.call(e)}ee(){var t;for(let e of game.Et)null==(t=e.ee)||t.call(e)}Lt(t,e=!1){var n;for(let i of game.Et)e&&0==i.Yt||null==(n=i.Lt)||n.call(i,t)}ye(){let{Kt:t,Jt:e}=this,n=e.L(),[i,s]=Ct(t.se);return{x:n.x+i*t.oe,y:n.y+s*t.oe}}}(Bn),Pn=!1;const Un=["","It was over.","Norman was able to study peacefully.","But he knew that eventually, they'd be back.","THE END"];onpointerup=()=>{0===Vn.state&&(function(){if(we)return;we=!0;let t=[0,.5,2,.5,3,.5,2,.5];ye([0,2,-24e3,2],-36,ve.gt),ye([0,8,ce,8],-36,ve.dt),ye(function(){let t=xe(4,[8,4],[fe,ce,ce,ce,ce,ce].flat());return[t,t,t,xe(4,[8,4],fe)].flat()}(),-24,ve.wt);{let e=[0,2,2,2,3,2,2,2],n=[e,e,e,[0,2,2,2,3,2,5,2]].flat();ye(n,0,ve.vt),ye(n,-12,ve.yt),ye(t,-36,ve.xt)}let e=he.currentTime;ge.gain.linearRampToValueAtTime(.5,e+5),Te()}(),Vn.state=1,Vn.Jt.N=n),function(){let{Kt:e,Jt:i}=game;if(0===e.he)return;e.he--,i.N=t,clearTimeout(Ye),Ye=setTimeout(()=>i.N=n,500);let s=e.ae,a=e.se-e.zt*e.re/2,r=ze++;for(let t=0;t<e.zt;t++){let n=Le(),i=a+t*e.re,[o,l]=Ct(i),{x:h,y:c}=game.ye();n.x=h-n.N[2]/2,n.y=c-n.N[3]/2,n.q=o*s,n.A=l*s,n.groupId=r,game.Bt(n),game.Lt(n)}}()},onpointermove=({clientX:t,clientY:e})=>{let n=Bn.L(),i=function(t,e){let n=Ut.getBoundingClientRect(),i=(t-n.x)*(Ut.width/n.width)|0,s=(e-n.y)*(Ut.height/n.height)|0;return{x:i,y:hn.y-s}}(t,e);Vn.Kt.se=Dt(n,i)},onkeydown=({which:t})=>{1===Vn.state?(32===t&&function(){var t,e;if(game.Zt.tt<game.Zt.Qt)return;game.Zt.tt=0;for(let e of game.Et)null==(t=e._t)||t.call(e);let n=game.Mt.filter(t=>t.is(8));for(let t of n){game.ot(t);let n=Re();game.Bt(n,t.x,0),le(n).B(10).remove();for(let t of game.Et)null==(e=t.ne)||e.call(t,n)}}(),80===t&&(Pn=!Pn)):2===Vn.state&&(38===t&&rn(-1),40===t&&rn(1),13===t&&function(){let t=an.items[an.selectedIndex];t&&t.lt<=game.j&&(game.j-=t.lt,Kt(an.items,t),t.ht(),rn(an.selectedIndex))}())};let Ln=!1,Jn=0;Vn.Gt(un),an.Et=[fn,wn,vn,gn,mn,dn,yn,bn,Nn,Tn,jn,kn,An,Mn,Cn,Dn,Kn,Xn,In,qn],Vn.ie=["Norman wasn't a particularly popular necromancer...","         The other villagers hunted him.","     Sometimes they even finished the job (@)","  But like any self-respecting necromancer...","        Norman just brought himself back."],function(t,e){Ut.width=t,Ut.height=e,(onresize=Ot)();let n=0;!function t(e=0){var i;requestAnimationFrame(t),function(t){(Jn+=t)>4e3&&(Vn.ie.shift(),Jn=0,0===Vn.state&&0===Vn.ie.length&&Vn.ie.push("                (Click to begin)"))}(i=e-n),function(t){Lt.clearRect(0,0,Ut.width,Ut.height),Lt.save(),ln>0&&(ln-=t,Lt.translate(It(2),It(2))),Lt.translate(hn.x,hn.y),function(){for(let t=0;t<game.bt.width/16;t++)Rt(t%5?u:vt,16*t,0),Rt(f,16*t,-f[3]),Rt(P,16*t,game.bt.Ft)}(),function(){for(let t of Qt)for(let e of t.u){let n=t.m[e.variant];Rt(n[e.h/e.duration*n.length|0],e.x,e.y)}}(),function(){for(let t of game.Mt){if(Rt(t.N,t.x,t.y+t.$),t.Y(Ve)&&Et(ot,t.x,-t.N[3],t.N[2],t.N[3]),t.D>1&&t!==game.Jt)if(t.D<10){let{x:e}=t.L();cn(e,-6,t.T,t.D,B,U)}else Rt(B,t.x,-6),$t(`${t.T}/${t.D}`,t.x+6,0);let{x:e}=t;for(let n of t.P)n.N&&(Rt(n.N,e,-12),e+=n.N[2]+1)}}(),1===game.state&&function(){let{x:t,y:e}=game.ye();Rt(d,t-d[2]/2,e-d[3]/2)}(),Lt.restore(),function(){if(game.ie.length&&$t(game.ie[0],75,50),0===game.state)return;Jt(R,0,0);for(let t=0;t<game.Jt.D;t++)Jt(t<game.Jt.T?B:U,11+4*t,0);for(let t=0;t<game.Kt.le;t++)Jt(t<game.Kt.he?L:J,11+4*t,6);let t=0|game.j;if(t){let e=game.fe();$t(`$${t} ${e?`(+${100*e+"%"})`:""}`,Ut.width/2-30,0)}if($t(`${game.level+1}-10`,Ut.width-30,2),1===game.state){let t=150,e=Ut.height-12,n=Mt(game.Zt.tt/game.Zt.Qt,0,1);Et(tt,t,e,52*(1-n)|0,10),$t("Resurrect",t+10,e+2),$t(1===n?" (Space)":" ("+((1-n)*game.Zt.Qt/1e3|0)+"s)"),Jt(l,t+1,e+1)}}(),2===game.state&&function(){$t("Rituals\n\n",160,20);let t=an.items[an.selectedIndex];for(let e of an.items)$t(`${e===t?">":" "}${e.name} $${e.lt}\n`);$t("\n"+(null==t?void 0:t.description)+"\n")}()}(i),Pn||(1===Vn.state&&function(t){var e;let n=tn[nn];if((en-=t)>0);else if(98===n)sn()&&nn++;else if(99===n);else if(n){tn[nn]--;let t=tn[nn+1],n=Qe[t]();game.Bt(n),en=n.U+((null==(e=_e[t])?void 0:e.call(_e))||0)}else nn+=2}(i),0!==Vn.state&&Vn.update(i),function(t){Gt=Gt.filter(e=>{e.h+=t;let n=Mt(e.h/e.duration,0,1),i=e.l(n),s=e.t+(e.i-e.t)*i;return e.o(s,i),n<1})}(i),function(t){for(let e of Qt)e.update(t)}(i),1===Vn.state&&99===tn[nn]&&sn()&&(nn>=tn.length-1?(Vn.state=4,Vn.ie=Un):(Vn.te(),game.state=2,function(){let t=Math.pow(game.level+1,2),e=[game.Jt.T<game.Jt.D&&ie(10*game.level,"Heal","Heal 1*",()=>He(game.Jt,-1)),ie(10*t,"Renew","+1* max hp",()=>{game.Jt.D++,game.Jt.T++}),ie(10*t,"Recharge","+1 max casts",()=>game.Kt.le++),...on(),ie(0,"Continue","Begin the next level",()=>(game.state=1,nn++,game.level++,game.ve(),void Te()))];an.items=e.filter(t=>t)}(),game.ee(),ve.gt.ft())),2!==Vn.level||Ln||(Vn.Jt.X(new qe(Vn.Jt,0)),Vn.Jt.G=100,Vn.Jt.U=500,Ln=!0)),n=e}(),onfocus=()=>n=performance.now()}(Vn.bt.width,Vn.bt.height),new te({x:0,y:0,w:game.bt.width,g:game.bt.height,angle:[0,qt],duration:[5e3,1e4],p:[1,3],v:[0,0],frequency:.1,m:[[wt,xt],[xt,wt,[26,52,1,1],wt]]}).B(200)</script>