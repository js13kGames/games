<!doctype html><style>body{margin:0;padding:0;overflow:hidden}</style><script src=/2024/webxr/playcanvas.js></script><script type=module>var x=Object.defineProperty,R=(t,e,i)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,o=(t,e,i)=>R(t,"symbol"!=typeof e?e+"":e,i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class V{constructor(t,e,i){o(this,"entity"),o(this,"app"),o(this,"game"),o(this,"isMove",!0),o(this,"speed",4),o(this,"startPos",new pc.Vec3),o(this,"endPos",new pc.Vec3),o(this,"pos",new pc.Vec3),o(this,"dir",new pc.Vec3),o(this,"vel",new pc.Vec3),o(this,"pauseTimer",0),this.entity=t,this.app=e,this.game=i,this.startPos.copy(t.getPosition()),this.dir.copy(pc.Vec3.DOWN),this.entity.tags.has("enemy_x")&&this.dir.copy(pc.Vec3.RIGHT),this.entity.tags.has("enemy_z")&&this.dir.copy(pc.Vec3.BACK);let s=new pc.Ray(t.getPosition(),this.dir),a=new pc.Vec3;i.level.rayCast(s,a)&&(this.dir.mulScalar(.5),a.sub(this.dir),this.endPos.copy(a))}update(t){if(this.pauseTimer>0)this.pauseTimer-=t;else if(this.pos=this.entity.getPosition(),this.moveVecTowards(this.pos,this.endPos,t*this.speed),this.entity.setPosition(this.pos),this.pos.equals(this.endPos)){let t=this.startPos;this.startPos=this.endPos,this.endPos=t,this.pauseTimer=.3}}move(t,e){}moveVecTowards(t,e,i){let s=e.x-t.x,o=e.y-t.y,a=e.z-t.z,b=s*s+o*o+a*a;if(0==b||i>=0&&b<=i*i)return void t.copy(e);let n=Math.sqrt(b);t.x+=s/n*i,t.y+=o/n*i,t.z+=a/n*i}}var v=console.log;class k{constructor(t,e){o(this,"app"),o(this,"g"),o(this,"player"),o(this,"levelEntity"),o(this,"blockList"),o(this,"aabbList",[]),o(this,"coinList",[]),o(this,"trapList",[]),o(this,"blockMat"),o(this,"blockMatA"),o(this,"playerMat"),o(this,"coinMat"),o(this,"enemyMat"),o(this,"enemyMat2"),o(this,"trapMat"),o(this,"blackMat"),o(this,"point",new pc.Vec3),o(this,"blockTexture"),o(this,"vrTexture"),o(this,"resetBtnTexture"),o(this,"titleTexture"),o(this,"batchGroupBlocks"),o(this,"batchGroupCoins"),o(this,"batchGroupTraps"),o(this,"shortName",{Block:"b",Enemy1:"e1",Enemy2:"e2",Enemy3:"e3",Player:"p",Coin:"c",Trap:"t",b:"Block",e1:"Enemy1",e2:"Enemy2",e3:"Enemy3",p:"Player",c:"Coin",t:"Trap"}),o(this,"levelsAsset",{Level1:"p,-6.5,8,-7.5:e1,7.5,8,0.5:e1,-5.5,8,7.5:e1,-7.5,8,-4.5:e3,-7.5,4,-1.5:c,-6.5,1,-7.5:c,0.5,5,-7.5:c,-3.5,5,-7.5:c,3.5,1,-7.5:c,2.5,8,-7.5:c,0.5,8,-7.5:c,7.5,8,-6.5:c,7.5,8,-3.5:c,7.5,8,2.5:c,7.5,6,-2.5:c,4.5,8,7.5:c,0.5,5,7.5:c,-6.5,8,7.5:c,-1.5,1,7.5:c,-6.5,1,7.5:c,0.5,3,7.5:c,6.5,1,7.5:c,-7.5,1,4.5:c,-7.5,5,4.5:c,-7.5,6,-1.5:c,-7.5,7,5:c,-7.5,5,-6.5:c,-7.5,1,-6.5:c,-7.5,6,-3.5:c,-7.5,2,-1.5:c,7.5,8,6.5:c,7.5,1,6.5:c,7.5,1,-0.5:c,7.5,3,2.5:c,6.5,8,-7.5:c,-0.5,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,2,-8.5:b,7.5,3,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,2,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,4.5,1,-7.5:b,4.5,2,-7.5:b,4.5,3,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,1.5,8,-7.5:b,1.5,7,-7.5:b,1.5,6,-7.5:b,1.5,5,-7.5:b,1.5,4,-7.5:b,0.5,4,-7.5:b,-0.5,4,-7.5:b,-1.5,4,-7.5:b,-1.5,1,-7.5:b,-2.5,4,-7.5:b,-3.5,4,-7.5:b,-2.5,7,-7.5:b,-2.5,8,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,2,3.5:b,7.5,1,0.5:b,7.5,2,0.5:b,7.5,3,0.5:b,7.5,2,4.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,3.5:b,7.5,7,3.5:b,7.5,6,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7.02117395401001,-2.5:b,7.5,4,1.5:b,7.5,4,0.5:b,7.5,4,-0.5:b,7.5,4,-1.5:b,7.5,3,-5.5:b,7.5,3,-4.5:b,7.5,3,-3.5:b,7.5,3,-6.5:b,7.5,1,7.5:b,7.5,4,2.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,8,-2.5:b,-7.5,7,-2.5:b,-7.5,6,-2.5:b,-7.5,5,-2.5:b,-7.5,4,-2.5:b,-7.5,4,-3.5:b,-7.5,4,-4.5:b,-7.5,1,-1.5:b,-7.5,1,-4.5:b,-7.5,4,2.5:b,-7.5,3,2.5:b,-7.5,5,2.5:b,-7.5,6,2.5:b,-7.5,6,3.5:b,-7.5,6,4.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,5,8.5:b,8.5,4,8.5:b,8.5,3,8.5:b,8.5,4,7.5:b,8.5,3,7.5:b,8.5,2,7.5:b,7.5,4,8.5:b,7.5,3,8.5:b,7.5,2,8.5:b,8.5,5,7.5:b,7.5,5,8.5:b,-7.5,2,7.5:b,7.5,2,7.5:b,-7.5,3,7.5:b,-7.5,5,7.5:b,-6.5,3,7.5:b,-5.5,3,7.5:b,3.5,3,7.5:b,3.5,2,7.5:b,3.5,4,7.5:b,3.5,5,7.5:b,4.5,5,7.5:b,-7.5,7,7.5:b,7.5,7,7.5:b,-8.5,5,7.5:b,-8.5,4,7.5:b,-8.5,3,7.5:b,-7.5,4,8.5:b,-7.5,3,8.5:b,-7.5,5,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,3,7.5:b,7.5,5,6.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,6,6.5:b,-7.5,6,5.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,0.5,8,7.5:b,0.5,7,7.5:b,0.5,4,7.5:b,-0.5,4,7.5:b,-0.5,3,7.5:b,-0.5,1,7.5:b,-0.5,2,7.5:b,1.5,2,7.5:b,2.5,2,7.5:b,1.5,4,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:e2,2.5,5,-7.5:e2,1.5,7,7.5:e2,-4.5,3,7.5:t,7.5,4,-5,0,0,0:t,7.5,5,-0.5,0,0,0:t,7.5,5,1.5,0,0,0:t,3,1,7.5,0,0,0:t,-7.5,7,2.5,0,0,0:t,-0.5,5,-7.5,0,0,0:",Level2:"p,-5.5,6,-7.5:e1,7.5,8,-5:e1,-7.5,7,0:e3,-7.5,2,3.5:e3,7.5,2,-1.5:c,-2.5,1,-7.5:c,6.5,8,-7.5:c,1.5,8,-7.5:c,-1.5,8,-7.5:c,-6.5,8,-7.5:c,-7.5,8,-6.5:c,-7.5,8,1:c,-7.5,4,-1.5:c,-7.5,1,-6.5:c,-7.5,1,-3.5:c,-7.5,3,3.5:c,-7.5,4,1.5:c,-7.5,8,6.5:c,-6.5,8,7.5:c,-3.5,8,7.5:c,1.5,4,7.5:c,3.5,5,7.5:c,5,1,7.5:c,6.5,8,7.5:c,7.5,8,6.5:c,7.5,6,3.5:c,7.5,8,3.5:c,7.5,1,6.5:c,7.5,1,2.5:c,7.5,8,-3.5:c,7.5,3,-1.5:c,7.5,5,-6.5:c,-6.5,1,7.5:c,-1.5,8,7.5:c,6.5,5,-7.5:c,4.5,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,4,-6.5:b,6.5,4,-7.5:b,5.5,4,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,8,-7.5:b,-0.5,6,-7.5:b,-6.5,6,-7.5:b,0.5,6,-7.5:b,1.5,6,-7.5:b,1.5,5,-7.5:b,1.5,4,-7.5:b,1.5,3,-7.5:b,0.5,3,-7.5:b,-0.5,3,-7.5:b,-1.5,3,-7.5:b,-0.5,5,-7.5:b,-1.5,5,-7.5:b,-1.5,4,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,1.5,1,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,1,3.5:b,7.5,2,3.5:b,7.5,3,3.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,2.5:b,7.5,5,3.5:b,7.5,5,4.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7,-2.5:b,7.5,4,-2.5:b,7.5,3,-2.5:b,7.5,2,-2.5:b,7.5,1,-2.5:b,7.5,4,-1.5:b,7.5,4,-0.5:b,7.5,5,-0.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,8,0:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,3,2.5:b,-7.5,2,2.5:b,-7.5,1,2.5:b,-7.5,1,-2.5:b,-7.5,2,-2.5:b,-7.5,3,-2.5:b,-7.5,3,-1.5:b,-7.5,3,-0.5:b,-7.5,3,0.5:b,-7.5,3,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,4,8.5:b,8.5,5,8.5:b,8.5,3,8.5:b,8.5,2,8.5:b,8.5,3,7.5:b,8.5,2,7.5:b,7.5,3,8.5:b,7.5,2,8.5:b,8.5,4,7.5:b,8.5,5,7.5:b,7.5,4,8.5:b,7.5,5,8.5:b,-7.5,2,7.5:b,7.5,1,7.5:b,6.5,1,7.5:b,6.5,2,7.5:b,-7.5,3,7.5:b,7.5,2,7.5:b,-7.5,4,7.5:b,-1.5,1,7.5:b,-2.5,1,7.5:b,-7.5,7,7.5:b,7.5,7,7.5:b,-8.5,5,7.5:b,-7.5,5,8.5:b,-7.5,6,8.5:b,-7.5,4,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-8.5,6,7.5:b,-8.5,4,7.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,-2.5,8,7.5:b,-2.5,7,7.5:b,-2.5,6,7.5:b,-2.5,5,7.5:b,-2.5,4,7.5:b,-3.5,4,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,2.5,8,7.5:b,2.5,7,7.5:b,2.5,6,7.5:b,2.5,5,7.5:b,2.5,4,7.5:b,3.5,4,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:e2,-1.5,4,7.5:e2,-6.5,6,7.5:e2,3.5,6.5,7.5:e2,-6.5,4,-7.5:e2,2.5,4,-7.5:t,1.5,2,-7.5,0,0,0:t,3.5,1,7.5,0,0,0:t,-7.5,8,-5,180,0,0:t,7.5,4.5,2.5,-89.99999999999999,0,0:",Level3:"p,-6.5,8,-7.5:e1,1.5,8,-7.5:e1,-4.5,4,7.5:e1,7.5,8,0:e1,7.5,8,5.5:e2,-6.5,7,7.5:e2,1.5,4,7.5:e3,-7.5,1,-1.5:e3,-7.5,8,-0.5:t,-1.5,1,-7.5,0,0,0:t,-2.5,8,7.5,180,0,0:t,7.5,1,-4.5,0,0,0:t,-7.5,5,-6.5,89.99999999999999,0,0:t,-0.5,2,7.5,0,0,89.99999999999999:c,-2.5,5,-7.5:c,-6.5,6,7.5:c,-6.5,8,7.5:c,0.5,8,7.5:c,-0.5,5,-7.5:c,4.5,3,-7.5:c,4.5,1,-7.5:c,-0.5,8,-7.5:c,4.5,8,-7.5:c,-6.5,7,-7.5:c,6.5,5,7.5:c,0.5,5,7.5:c,6.5,8,7.5:c,7.5,1.5,2.5:c,7.5,5,-2.5:c,7.5,5,3.5:c,7.5,5,-6.5:c,7.5,8,-6.5:c,7.5,5,6.5:c,7.5,8,6.5:c,-7.5,4,2.5:c,-7.5,1,-3.5:c,-7.5,1,2.5:c,-7.5,1,-1.5:c,-7.5,1,-6.5:c,-7.5,8,-2.5:c,-7.5,8,-6:c,-7.5,7,6.5:c,7.5,1,4.5:c,1.5,1,7.5:c,-6.5,1,7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,2,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,8.5,2,-7.5:b,8.5,3,-7.5:b,7.5,3,-8.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,3.5,1,-7.5:b,3.5,2,-7.5:b,3.5,3,-7.5:b,3.5,4,-7.5:b,4.5,4,-7.5:b,4.5,5,-7.5:b,4.5,6,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,-1.5,8,-7.5:b,-1.5,7,-7.5:b,-1.5,6,-7.5:b,-1.5,5,-7.5:b,-1.5,4,-7.5:b,-0.5,4,-7.5:b,-2.5,4,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,1,3.5:b,7.5,2,3.5:b,7.5,3,3.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,3.5:b,7.5,7,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7,-2.5:b,7.5,4,-2.5:b,7.5,4,-3.5:b,7.5,4,-4.5:b,7.5,4,-5.5:b,7.5,4,-6.5:b,7.5,4,6.5:b,7.5,4,-1.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,8,-1.5:b,-7.5,1,-2.5:b,-7.5,4,1.5:b,-7.5,5,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,1,8.5:b,8.5,0,8.5:b,8.5,0,7.5:b,7.5,0,8.5:b,8.5,1,7.5:b,7.5,1,8.5:b,-7.5,2,7.5:b,7.5,2,8.5:b,7.5,3,8.5:b,8.5,2,8.5:b,8.5,2,7.5:b,8.5,3,7.5:b,-8.5,3,7.5:b,-8.5,2,7.5:b,7.5,3,7.5:b,-7.5,5,7.5:b,-6.5,5,7.5:b,-5.5,5,7.5:b,-4.5,5,7.5:b,0.5,3,7.5:b,0.5,1,7.5:b,0.5,2,7.5:b,0.5,4,7.5:b,6.5,4,7.5:b,-7.5,7,7.5:b,7.5,4,7.5:b,7.5,7,7.5:b,-8.5,4,7.5:b,-8.5,5,7.5:b,-7.5,4,8.5:b,-7.5,5,8.5:b,-7.5,3,8.5:b,-7.5,2,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,6,6.5:b,-7.5,6,5.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:",Level4:"p,-6.5,8,-7.5:e1,7.5,8,0.5:e3,-7.5,1,-6.5:c,0,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-7.5:b,-7.5,2,-7.5:b,7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-1.5,6,-7.5:b,-1.5,5,-7.5:b,-0.5,5,-7.5:b,0.5,4,-7.5:b,1.5,4,-7.5:b,3.5,4,-7.5:b,1.5,3,-7.5:b,3.5,3,-7.5:b,1.5,2,-7.5:b,3.5,2,-7.5:b,1.5,5,-7.5:b,3.5,5,-7.5:b,1.5,6,-7.5:b,3.5,6,-7.5:b,4.5,6,-7.5:b,5.5,5.5,-7.5:b,5.5,5,-7.5:b,5.5,4,-7.5:b,5.5,3,-7.5:b,4.5,2,-7.5:b,-1.5,4,-7.5:b,-1.5,3,-7.5:b,-1.5,2,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,-5.5,6,-7.5:b,-5.5,5,-7.5:b,-5.5,4,-7.5:b,-5.5,3,-7.5:b,-5.5,2,-7.5:b,-4.5,4,-7.5:b,-4.5,2,-7.5:b,-3.5,2,-7.5:b,-4.5,6,-7.5:b,-3.5,6,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,7.5,1,7.5:b,-7.5,2,7.5:b,7.5,2,7.5:b,-7.5,3,7.5:b,7.5,3,7.5:b,-7.5,4,7.5:b,-7.5,7,7.5:b,7.5,4,7.5:b,7.5,7,7.5:b,-7.5,5,7.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:"}),this.app=t,this.g=e,this.blockList=this.app.root.findByTag("block"),this.createAABBList(),this.createTextures(),this.blockMat=new pc.StandardMaterial,this.blockMat.diffuse.set(1,1,1),this.blockMat.diffuseTint=!0,this.blockMat.update(),this.blockMatA=new pc.StandardMaterial,this.blockMatA.diffuse.fromString("#ffc400"),this.blockMatA.diffuseTint=!0,this.blockMatA.update(),this.playerMat=new pc.StandardMaterial,this.playerMat.diffuse.fromString("#f0b71b"),this.playerMat.emissive.fromString("#f0b71b"),this.playerMat.emissiveIntensity=.4,this.playerMat.update(),this.coinMat=new pc.StandardMaterial,this.coinMat.diffuse.set(1,1,.3),this.coinMat.emissive.set(1,1,.3),this.coinMat.update(),this.enemyMat=new pc.StandardMaterial,this.enemyMat.diffuse.set(1,.2,.2),this.enemyMat.update(),this.enemyMat2=new pc.StandardMaterial,this.enemyMat2.diffuse.set(.7,.1,.1),this.enemyMat2.update(),this.trapMat=new pc.StandardMaterial,this.trapMat.diffuse.set(.3,.1,.1),this.trapMat.update(),this.blackMat=new pc.StandardMaterial,this.blackMat.diffuse.fromString("#000000"),this.blackMat.update(),this.batchGroupBlocks=this.app.batcher.addGroup("Blocks",!1,100),this.batchGroupCoins=this.app.batcher.addGroup("Coins",!1,100),this.batchGroupTraps=this.app.batcher.addGroup("Spikes",!0,100)}loadLevelJson(t){v("load level",t),localStorage.setItem("mibjs13k_jump",t);let e=this.app.root.findByName("Level");e&&e.destroy();let i=this.levelsAsset["Level"+t],s=["#ffffff","#ffffff","#72c296","#59a79c","#c485b4","#b865b1","#ece475","#e0d56d","#81dd6a","#5dc46e"];this.blockMat.diffuse.fromString(s[2*t]),this.blockMat.update(),this.blockMatA.diffuse.fromString(s[2*t+1]),this.blockMatA.update();let o=new pc.Entity;o.name="Level",this.app.root.addChild(o),this.levelEntity=o;let a=i.split(":");for(let t of a){if(""==t)continue;let e=t.split(",");if(this.shortName.hasOwnProperty(e[0])){let t=this.createUnit(this.shortName[e[0]],e[0]);if(o.addChild(t),t.setPosition(e[1],e[2],e[3]),"t"===e[0]&&t.setEulerAngles(e[4],e[5],e[6]),t.tags.has("enemy")&&(7.5===t.getPosition().z&&t.setEulerAngles(0,180,0),7.5===t.getPosition().x&&t.setEulerAngles(0,-90,0),-7.5===t.getPosition().x&&t.setEulerAngles(0,90,0)),t.tags.has("block")){let e=t.getPosition().y,i=!0;(t.getPosition().x-.5)%2==0&&(i=!1),(t.getPosition().z-.5)%2==0&&(i=!i),e%2==0&&(i=!i),i&&(t.render.material=this.blockMatA)}}else v("no shortName",e[0])}this.blockList=o.find((t=>"Block"==t.name)),this.aabbList=[];for(let t of this.blockList){let e=new pc.BoundingBox;e.center.copy(t.getPosition()),e.halfExtents.set(.5,.5,.5),this.aabbList.push(e)}this.g.player.entity=o.findByName("Player"),this.g.player.reset(),this.g.player.orient(!0),this.g.enemyList=[];let b=this.app.root.findByTag("enemy");for(let t of b)this.g.enemyList.push(new V(t,this.app,this.g));this.coinList=this.levelEntity.findByTag("coin"),this.trapList=this.levelEntity.findByTag("trap"),this.g.control.showArrows(),this.app.scene.skyboxIntensity=.5,this.g.light.light.intensity=.5,this.g.light2.light.intensity=.5;let n=new pc.BasicMaterial;n.diffuse=new pc.Color(.6,.6,.3),n.update(),this.g.partsList.forEach((t=>t.enabled=!1)),this.g.levelRestartTimer=-1,v("coins",this.coinList.length),v("traps",this.trapList.length),v("enemies",this.g.enemyList.length)}nextLevel(){this.g.lvl++,this.g.lvl>this.g.nLvl&&(this.g.lvl=1),this.loadLevelJson(this.g.lvl)}createUnit(t,e){let i=new pc.Entity;if(i.name=t,"Player"===t){i.tags.add("player");let t=new pc.Entity;i.addChild(t);let e=new pc.Entity;t.addChild(e),e.addComponent("render",{type:"box",castShadows:!1}),e.render.material=this.playerMat,e.setLocalScale(.5,.5,.8),e.setLocalPosition(0,0,.1),e=new pc.Entity,t.addChild(e),e.addComponent("render",{type:"box",castShadows:!1}),e.render.material=this.playerMat,e.setLocalScale(.1,.1,.3),e.setLocalPosition(.15,0,-.3),e=new pc.Entity,t.addChild(e),e.addComponent("render",{type:"box",castShadows:!1}),e.render.material=this.playerMat,e.setLocalScale(.1,.1,.3),e.setLocalPosition(-.15,0,-.3),e=new pc.Entity,t.addChild(e),e.addComponent("render",{type:"box",castShadows:!1}),e.render.material=this.blackMat,e.setLocalScale(.1,.1,.1),e.setLocalPosition(.13,.25,-.1),e=new pc.Entity,t.addChild(e),e.addComponent("render",{type:"box",castShadows:!1}),e.render.material=this.blackMat,e.setLocalScale(.1,.1,.1),e.setLocalPosition(-.13,.25,-.1)}if("e1"==e||"e2"==e||"e3"==e){i.tags.add("enemy"),"e2"==e&&i.tags.add("enemy_x"),"e3"==e&&i.tags.add("enemy_z");let t=new pc.Entity;t.addComponent("render",{type:"box",castShadows:!1}),t.render.material=this.enemyMat,t.setLocalScale(.8,.8,.5),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"box",castShadows:!1,material:this.blackMat}),t.setLocalScale(.13,.13,.13),t.setLocalPosition(-.2,.1,.3),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"box",castShadows:!1,material:this.blackMat}),t.setLocalScale(.13,.13,.13),t.setLocalPosition(.2,.1,.3),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"cone",castShadows:!1}),t.render.material=this.enemyMat2,t.setLocalScale(.2,.2,.2),t.setLocalPosition(0,.5,0),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"cone",castShadows:!1}),t.render.material=this.enemyMat2,t.setLocalScale(.2,.2,.2),t.setLocalPosition(0,-.5,0),t.setEulerAngles(0,0,180),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"cone",castShadows:!1}),t.render.material=this.enemyMat2,t.setLocalScale(.2,.2,.2),t.setLocalPosition(-.5,0,0),t.setEulerAngles(0,0,90),i.addChild(t),t=new pc.Entity,t.addComponent("render",{type:"cone",castShadows:!1}),t.render.material=this.enemyMat2,t.setLocalScale(.2,.2,.2),t.setLocalPosition(.5,0,0),t.setEulerAngles(0,0,-90),i.addChild(t)}if("Block"===t&&(i.tags.add("block"),i.addComponent("render",{type:"box",isStatic:!0,batchGroupId:this.batchGroupBlocks.id}),i.render.material=this.blockMat),"Coin"===t&&(i.setLocalScale(.2,.2,.2),i.tags.add("coin"),i.addComponent("render",{type:"box",castShadows:!1,batchGroupId:this.batchGroupCoins.id}),i.render.material=this.coinMat,i.render.isStatic=!0),"Trap"===t){i.setLocalScale(1,1,1),i.tags.add("trap");let t=new pc.Entity;i.addChild(t);let e=.3,s=[[e,-.2,e],[-e,-.2,-e],[e,-.2,-e],[-e,-.2,e]];for(let e=0;e<4;e++){let i=new pc.Entity;t.addChild(i),i.setLocalScale(.2,.8,.2),i.setLocalPosition(new pc.Vec3(s[e])),i.addComponent("render",{type:"cone",castShadows:!1,batchGroupId:this.batchGroupTraps.id}),i.render.material=this.trapMat}}return i}createAABBList(){for(let t of this.blockList){let e=new pc.BoundingBox;e.center.copy(t.getPosition()),e.halfExtents.set(.5,.5,.5),this.aabbList.push(e)}}rayCast(t,e){let i=!1,s=new pc.Vec3(100,100,100);for(let e of this.aabbList)e.intersectsRay(t,this.point)&&(i=!0,t.origin.distance(this.point)<t.origin.distance(s)&&s.copy(this.point));return!!i&&(e.copy(s),!0)}rayCastOne(t,e){return e.intersectsRay(t,this.point)||this.point.set(0,0,0),this.point}createTextures(){let t=document.createElement("canvas");t.width=100,t.height=100;let e=t.getContext("2d"),i=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});i.setSource(t),this.blockTexture=i,t=document.createElement("canvas"),t.width=120,t.height=60,e=t.getContext("2d"),e.fillStyle="#e9b91e",e.fillRect(0,0,120,60),e.fillStyle="#8d6d52",e.beginPath(),e.arc(30,30,12,0,2*Math.PI),e.fill(),e.arc(90,30,12,0,2*Math.PI),e.fill(),e.moveTo(45,60),e.lineTo(60,45),e.lineTo(75,60),e.fill(),e.closePath,i=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),i.setSource(t),this.vrTexture=i,t=document.createElement("canvas"),t.width=100,t.height=100,e=t.getContext("2d"),e.fillStyle="#e0ad3d",e.fillRect(0,0,100,100),e.strokeStyle="#644c18",e.lineWidth=10,e.moveTo(75,75),e.lineTo(25,75),e.lineTo(25,25),e.lineTo(75,25),e.lineTo(75,55),e.stroke(),e.lineWidth=5,e.moveTo(60,45),e.lineTo(75,55),e.lineTo(90,45),e.stroke(),i=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),i.setSource(t),this.resetBtnTexture=i,t=document.createElement("canvas"),t.width=300,t.height=300,e=t.getContext("2d"),e.fillStyle="#644f66",e.fillRect(0,0,300,300),e.textAlign="center",e.fillStyle="#aee4d4",e.font="40px arial",e.fillText("BITTY JUMP",150,50),i=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),i.setSource(t),this.titleTexture=i}}class _{constructor(t,e,i){o(this,"entity"),o(this,"body"),o(this,"app"),o(this,"g"),o(this,"isMove",!1),o(this,"speed",15),o(this,"playerMoveDir",new pc.Vec3(-1,0,0)),o(this,"camDir",new pc.Vec3(0,0,1)),o(this,"endPos",new pc.Vec3),o(this,"playerPos",new pc.Vec3),o(this,"stopTimer",0),o(this,"scale1",pc.Vec3.o),o(this,"isActive",!0),o(this,"isUndead",!1),this.entity=t,this.app=e,this.g=i}update(t){if(this.stopTimer>0){let e=this.body.getLocalScale();this.moveVecTowards(e,pc.Vec3.ONE,2*t),this.body.setLocalScale(e);let i=this.body.getLocalPosition();this.moveVecTowards(i,pc.Vec3.ZERO,.7*t),this.body.setLocalPosition(i)}this.isMove&&this.isActive&&(this.playerPos=this.entity.getPosition(),this.moveVecTowards(this.playerPos,this.endPos,this.speed*t),this.entity.setPosition(this.playerPos),this.playerPos.equals(this.endPos)&&(this.isMove=!1,this.g.control.showArrows(),this.orient(!0)))}move(t,e){this.playerMoveDir.copy(t),this.endPos.copy(e),this.isMove=!0,this.orient()}moveVecTowards(t,e,i){let s=e.x-t.x,o=e.y-t.y,a=e.z-t.z,b=s*s+o*o+a*a;if(0==b||i>=0&&b<=i*i)return void t.copy(e);let n=Math.sqrt(b);t.x+=s/n*i,t.y+=o/n*i,t.z+=a/n*i}hide(){this.isMove=!1,this.isActive=!1,this.entity.enabled=!1,this.g.control.hideArrows()}reset(){this.isMove=!1,this.isActive=!0,this.playerMoveDir.set(-1,0,0),this.body=this.entity.children[0]}orient(t=!1){let e=this.entity.getPosition(),i=this.playerMoveDir;0!=i.x&&e.z<0&&this.camDir.set(0,0,1),0!=i.x&&e.z>0&&this.camDir.set(0,0,-1),0!=i.z&&e.x<0&&this.camDir.set(1,0,0),0!=i.z&&e.x>0&&this.camDir.set(-1,0,0);let s=e.clone();t?s.sub(i):s.add(i),this.entity.lookAt(s,this.camDir),t?(this.body.setLocalScale(1.2,1.2,.8),this.body.setLocalPosition(0,0,.1),this.stopTimer=.5):this.body.setLocalScale(.8,.8,1.4)}}var M=console.log;const w=class t{constructor(e,i){o(this,"app"),o(this,"game"),this.game=i,this.app=e,this.buttonVr=this.app.root.findByName("Button VR2"),this.cameraEntity=this.app.root.findByName("Camera"),this.app.xr.start(this.cameraEntity.camera,pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR),this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR),this.buttonVr.element.on("click",(function(e){e.stopPropagation(),M("--",this.app.xr.isAvailable(pc.XRTYPE_VR)),this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){M("response"),"granted"==e&&window.addEventListener("deviceorientation",function(e){t.controllerRayList=[],this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCAL)}.bind(this))}.bind(this)).catch(console.error):(M("start vr"),t.controllerRayList=[],this.app.xr.start(this.cameraEntity.camera,pc.XRTYPE_VR,pc.XRSPACE_LOCAL)))}),this),this.app.keyboard.on("keydown",(function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.end()}),this),this.app.xr.on("start",(function(){console.log("xr start"),this.buttonVr.enabled=!1}),this),this.app.xr.on("end",(function(){this.buttonVr.enabled=!0,E.dot.enabled=!0}),this),this.app.xr.on("available",(function(){this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR)}),this)}};o(w,"controllerRayList",[]);let f=w;var B=console.log;class I{constructor(t,e){o(this,"app"),o(this,"g"),o(this,"cameraEntity"),o(this,"hitPosition",new pc.Vec3),o(this,"ray",new pc.Ray),o(this,"arrowList",[]),o(this,"activeArrow"),o(this,"arrowBase"),o(this,"buttonList",[]),o(this,"activeBtn"),o(this,"arrowMat"),o(this,"debugColor",new pc.Color(1,1,1,.2)),o(this,"debugColorActive",new pc.Color(1,1,1,1)),o(this,"rndID",Math.random()),this.app=t,this.g=e,this.cameraEntity=this.app.root.findByName("Camera");let i=new pc.Entity;t.root.addChild(i),this.arrowList.push(new g(new pc.Vec3(1,0,0),i)),this.arrowList.push(new g(new pc.Vec3(-1,0,0),i)),this.arrowList.push(new g(new pc.Vec3(0,1,0),i)),this.arrowList.push(new g(new pc.Vec3(0,-1,0),i)),this.arrowList.push(new g(new pc.Vec3(0,0,1),i)),this.arrowList.push(new g(new pc.Vec3(0,0,-1),i)),this.arrowBase=i;let s=new pc.Entity("BtnRestart");s.tags.add("vrButton");let a=new pc.StandardMaterial;a.diffuseMap=this.g.level.resetBtnTexture,s.addComponent("render",{type:"plane",material:a,castShadows:!1}),this.app.root.addChild(s),s.setPosition(0,-.35,-5),this.createButtons(),a=new pc.StandardMaterial,a.diffuseMap=this.g.level.titleTexture,a.alphaTest=0,a.opacity=.5;let b=new pc.Entity("Title");b.addComponent("render",{type:"plane",material:a,castShadows:!1}),this.app.root.addChild(b),b.setPosition(0,-.45,-4.6),b.setLocalScale(4,0,4)}update(t){let e=null,i=null;this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.copy(this.cameraEntity.forward),this.app.xr.active&&f.controllerRayList.length>0&&this.ray.copy(f.controllerRayList[0]);for(let t of this.arrowList)if(t.isVisible&&(t.isActive=!1,t.aabb.intersectsRay(this.ray))){e||(e=t);let i=e.aabb.center.distance(this.cameraEntity.getPosition());t.aabb.center.distance(this.cameraEntity.getPosition())<i&&(e=t)}e&&(e.isActive=!0),this.activeArrow=e;for(let t of this.buttonList)t.isActive=!1,t.aabb.intersectsRay(this.ray)&&(i=t);i&&(i.isActive=!0),this.activeBtn=i;for(let t of this.arrowList)t.repos(this.g.player.entity.getPosition()),t.isVisible&&(t.isActive?(t.mat.opacity=1,t.mat.emissiveIntensity=1,t.mat.update()):(t.mat.opacity=.3,t.mat.emissiveIntensity=0,t.mat.update()));for(let t of this.buttonList)t.isActive?t.entity.setLocalScale(1.1,1.1,1.1):t.entity.setLocalScale(1,1,1)}showArrows(){this.arrowBase.setPosition(this.g.player.entity.getPosition()),this.arrowList.forEach((t=>{let e=this.g.player.entity.getPosition(),i=new pc.Ray(e,t.dir),s=new pc.Vec3;this.g.level.rayCast(i,s)?s.sub(e):s=i.direction,s.length()>.5?t.isVisible=!0:t.isVisible=!1,Math.abs(e.x)<7.5&&0!=t.dir.z&&(t.isVisible=!1),Math.abs(e.z)<7.5&&0!=t.dir.x&&(t.isVisible=!1)}),this)}hideArrows(){this.arrowList.forEach((t=>{t.isVisible=!1}))}onMouseClick(t){if(this.activeArrow&&!this.g.player.isMove){let t=(new pc.Vec3).copy(this.activeArrow.dir),e=new pc.Ray(this.g.player.entity.getPosition(),t),i=new pc.Vec3,s=t.clone();this.g.level.rayCast(e,i)?(s.mulScalar(.5),i.sub(s)):(i.copy(this.g.player.entity.getPosition()),s.mulScalar(50),i.add(s)),this.g.player.move(t,i),this.hideArrows()}this.activeBtn&&"BtnRestart"==this.activeBtn.entity.name&&this.g.level.loadLevelJson(this.g.lvl)}onMouseMove(t){}createButtons(){this.buttonList=[];let t=this.app.root.findByTag("vrButton");for(let e of t)this.buttonList.push(new D(e))}rayCastButtons(t){for(let e of this.buttonList)e.aabb.intersectsRay(t)&&B("button hit")}}var g=class{constructor(t,e){o(this,"dir",new pc.Vec3),o(this,"_isVisible",!0),o(this,"isActive",!1),o(this,"aabb",new pc.BoundingBox),o(this,"entity",null),o(this,"mat",null);let i=this.aabb;i.halfExtents.set(.8,.8,.8),this.dir.copy(t),0!=t.x&&(i.halfExtents.x=2),0!=t.y&&(i.halfExtents.y=2),0!=t.z&&(i.halfExtents.z=2);let s=new pc.Entity;s.addComponent("render",{type:"cone"}),e.addChild(s);let a=new pc.Vec3;a.set(90*t.z,0,t.y<0?180:90*-t.x),s.rotate(a),t.mulScalar(1.2),s.setLocalPosition(t),s.setLocalScale(.5,1,.5),this.entity=s;let b=new pc.StandardMaterial;b.diffuse.set(0,.5,0),b.emissive.set(.4,1,.4),b.emissiveIntensity=0,b.update(),s.render.material=b,s.render.castShadows=!1,s.render.receiveShadows=!1,b.opacity=.3,b.blendType=pc.BLEND_NORMAL,b.update(),this.mat=b}set isVisible(t){this._isVisible=t,this.entity.enabled=t}get isVisible(){return this._isVisible}repos(t){let e=new pc.Vec3;e.copy(this.dir),e.mulScalar(2.5),t.add(e),this.aabb.center.copy(t)}},D=class{constructor(t){o(this,"isActive",!1),o(this,"aabb",new pc.BoundingBox),o(this,"entity"),this.entity=t,this.aabb.copy(t.render.meshInstances[0].aabb)}},L=console.log;const S=class t{constructor(e,i){o(this,"lvl",1),o(this,"nLvl",4),o(this,"levelRestartTimer",-1),o(this,"nextLevelTimer",-1),o(this,"trapTimer",.1),o(this,"trapActive",!0),o(this,"app"),o(this,"entity"),o(this,"player"),o(this,"camera"),o(this,"level"),o(this,"control"),o(this,"enemyList",[]),o(this,"partsList",[]),o(this,"controllerList",[]),o(this,"blockList"),o(this,"aabbList",[]),o(this,"endPos",new pc.Vec3),o(this,"eulers",new pc.Vec3),o(this,"light"),o(this,"light2"),o(this,"isMouseControl",!0),o(this,"eulers",new pc.Vec3),o(this,"lookSpeed",.1),o(this,"rndID",Math.round(1e3*Math.random()));let s=localStorage.getItem("mibjs13k_jump");L("----",s),s?(this.lvl=s,L("****")):(L("**"),localStorage.setItem("mibjs13k_jump",this.lvl)),L("--init");pc.Application.getApplication().graphicsDevice.maxPixelRatio=Math.min(window.devicePixelRatio,2),this.app=e,this.entity=i,this.createLights();let a=new pc.Entity("Camera Offset");this.app.root.addChild(a),a.setPosition(0,5,0),this.camera=new pc.Entity("Camera"),this.camera.addComponent("camera"),a.addChild(this.camera),this.camera.camera.fov=75,this.player=new _(null,this.app,this),this.level=new k(this.app,this),this.control=new I(e,this),this.level.loadLevelJson(this.lvl),this.control.createButtons();let b=new pc.Entity;b.addComponent("render",{type:"plane"}),b.setLocalScale(15,0,15),b.setPosition(0,-.5,0),this.app.root.addChild(b);let n=new pc.StandardMaterial;n.diffuse.fromString("#644f66"),b.render.material=n;for(let t=0;t<15;t++){let t=new pc.Entity;t.addComponent("render",{type:"box",material:this.level.playerMat}),this.app.root.addChild(t),t.enabled=!1,this.partsList.push(t)}const r=new pc.Entity;r.addComponent("screen",{referenceResolution:new pc.Vec2(1280,720),scaleBlend:.5,scaleMode:pc.SCALEMODE_BLEND,screenSpace:!0}),e.root.addChild(r);const c=new pc.Entity("Button VR2");c.addComponent("button",{active:!0,hoverTint:(new pc.Color).fromString("#f3b96e"),inactiveTint:[1,1,1,0],imageEntity:c}),c.addComponent("element",{anchor:[1,0,1,0],height:60,pivot:[1,0],type:pc.ELEMENTTYPE_IMAGE,width:120,useInput:!0,color:(new pc.Color).fromString("#ffffff"),opacity:.5}),r.addChild(c),c.setLocalPosition(-10,10,0),c.element.texture=this.level.vrTexture,c.element.on("click",(function(t){L("click")}));let l=new pc.Entity("Dot");l.addComponent("element",{anchor:[.5,.5,.5,.5],height:5,pivot:[.5,.5],type:pc.ELEMENTTYPE_IMAGE,width:5,color:[1,1,1],opacity:.7}),r.addChild(l),t.dot=l,this.createSky()}update(t){this.levelRestartTimer<0&&this.nextLevelTimer<0&&(this.app.scene.skyboxIntensity<1&&(this.app.scene.skyboxIntensity+=t),this.light.light.intensity<1&&(this.light.light.intensity+=t),this.light2.light.intensity<1&&(this.light2.light.intensity+=t),this.app.scene.ambientLight.intensity<1&&(this.app.scene.ambientLight.intensity+=t)),this.control.update(t),this.player.update(t),new pc.Color(1,1,1);for(let t of this.level.aabbList);this.camera.setLocalEulerAngles(this.eulers.x,this.eulers.y,0),this.player.entity.getPosition().lengthSq()>1e3&&this.level.loadLevelJson(lvl),this.levelRestartTimer>0&&(this.levelRestartTimer-=t,this.partsList.forEach((function(t){let e=t.getPosition();e.add(t.dir),t.setPosition(e);let i=t.getLocalScale();i.mulScalar(.95),t.setLocalScale(i)})),this.app.scene.skyboxIntensity-=t/2,this.light.light.intensity-=t/2,this.levelRestartTimer<=0&&this.level.loadLevelJson(this.lvl)),this.nextLevelTimer>0&&(this.app.scene.skyboxIntensity-=t/2,this.light.light.intensity-=t/2,this.nextLevelTimer-=t,this.nextLevelTimer<=0&&this.level.nextLevel()),this.trapTimer+=t,this.trapTimer>=2&&(this.trapTimer=0,this.trapActive=!this.trapActive);for(let e of this.enemyList)e.update(t),this.player.isActive&&!this.player.isUndead&&this.player.entity.getPosition().distance(e.entity.getPosition())<1&&(this.levelRestartTimer=1,this.player.hide(),this.partsEmit());for(let t of this.level.trapList)0==this.trapTimer&&(this.trapActive?t.children[0].setLocalPosition(0,0,0):t.children[0].setLocalPosition(0,-.5,0)),this.trapActive&&this.player.isActive&&!this.player.isUndead&&this.player.entity.getPosition().distance(t.getPosition())<1&&(this.levelRestartTimer=1,this.player.hide(),this.partsEmit());let e=0;for(let t of this.level.coinList)this.player.entity.getPosition().distance(t.getPosition())<1&&(t.enabled=!1),t.enabled||e++;e==this.level.coinList.length&&this.nextLevelTimer<0&&(this.nextLevelTimer=1)}swap(t){}onMouseClick(t){t.buttons[2]?this.app.mouse.disablePointerLock():this.app.xr.active||pc.Mouse.isPointerLocked()&&this.control.onMouseClick(t)}onMouseUp(t){this.app.xr.active||pc.Mouse.isPointerLocked()||setTimeout((function(t){t.app.mouse.enablePointerLock()}),10,this)}onMouseMove(t){this.app.xr.active||pc.Mouse.isPointerLocked()&&(this.eulers.y-=this.lookSpeed*t.dx,this.eulers.x-=this.lookSpeed*t.dy)}onVrAction(t){this.control.onMouseClick(t)}partsEmit(){let t=new pc.Vec3;for(const e of this.partsList){t.copy(this.player.entity.getPosition());let i=this.player.playerMoveDir.clone();i.mulScalar(.5),t.add(i),i.x=1-2*Math.random(),i.y=1-2*Math.random(),i.z=1-2*Math.random(),i.normalize(),i.mulScalar(.5),t.add(i),e.setPosition(t),e.setLocalScale(.3,.3,.3),i.normalize(),i.mulScalar(.05),e.dir=i,e.enabled=!0}}createLights(){let t=new pc.Entity("Light");this.light=t.addComponent("light",{type:"directional",shadowUpdateMode:pc.SHADOWUPDATE_THISFRAME,shadowType:pc.SHADOW_PCF3,shadowResolution:2024,isStatic:!0,castShadows:!1,shadowBias:.3,vsmBias:.01,vsmBlurMode:1,normalOffsetBias:.05,shadowIntensity:.4,color:(new pc.Color).fromString("#ffffff")}),this.app.root.addChild(t),t.setEulerAngles(-30,150,0),new pc.Color;let e=new pc.Entity("Light");this.light2=e.addComponent("light",{type:"directional",isStatic:!0,castShadows:!1,color:(new pc.Color).fromString("#6388cc"),intensity:1}),this.app.root.addChild(e),e.setEulerAngles(-90,-80,0)}createSky(){const t=document.createElement("canvas");t.width=100,t.height=100;let e=t.getContext("2d");const i=e.createLinearGradient(0,0,0,100);i.addColorStop(.2,"#5eb4df"),i.addColorStop(.6,"#ccdee9"),i.addColorStop(.8,"#662dc2"),e.fillStyle=i,e.fillRect(0,0,100,100);const s=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});s.setSource(t);var o=new pc.Texture(this.app.graphicsDevice,{cubemap:!0,width:1024,height:1024}),a=new pc.Texture(this.app.graphicsDevice,{width:1024,height:1024});pc.reprojectTexture(s,o,{}),this.app.scene.skybox=o,this.app.scene.ambientLight.fromString("#5b5e51"),pc.EnvLighting.generateAtlas(o,{target:a})}};o(S,"dot");let E=S;var P=console.log;class O{constructor(t,e,i){o(this,"entity",null),o(this,"app",null),o(this,"list"),this.list=i,this.entity=t,this.app=e,P("controller init"),this.vecA=new pc.Vec3,this.color=new pc.Color(1,1,1),this.color2=new pc.Color(.2,.8,.8),this.hoverEntity=null,this.model=this.entity.children[0],this.n=f.controllerRayList.length,f.controllerRayList.push(new pc.Ray),this.selectDeleayTimer=0}setInputSource(t){P(t),this.inputSource=t,this.inputSource.once("remove",this.onRemove,this)}onRemove(){P("remove"),this.entity.destroy();const t=this.list.indexOf(this);t>-1&&this.list.splice(t,1)}update(t){if(f.controllerRayList[this.n].origin.copy(this.inputSource.getOrigin()),f.controllerRayList[this.n].direction.copy(this.inputSource.getDirection()),this.selectDeleayTimer>0&&this.selectDeleayTimer--,this.inputSource.selecting&&0==this.selectDeleayTimer){this.color.set(0,1,0);let t=new pc.Ray(this.inputSource.getOrigin(),this.inputSource.getDirection());this.app.fire("vr_action",t),this.selectDeleayTimer=20}else this.color.set(1,1,1);this.inputSource.grip?(E.dot.enabled=!1,this.model.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation()),this.vecA.copy(this.inputSource.getDirection()),this.vecA.scale(1e3).add(this.inputSource.getOrigin()),this.app.renderLine(this.inputSource.getOrigin(),this.vecA,this.color)):this.model.enabled=!1}}class N{constructor(t){o(this,"controllerList",[]),this.app=t,this.cameraParent=this.app.root.findByName("Camera Offset"),this.app.xr.input.on("add",this.onAdd,this)}onAdd(t){console.log("add controller");let e=new pc.Entity;this.cameraParent.addChild(e);let i=new pc.Entity;i.addComponent("render",{type:"box"}),i.setLocalScale(.06,.06,.06),i.setEulerAngles(-40,0,0),e.addChild(i);let s=new O(e,this.app,this.controllerList);s.setInputSource(t),this.controllerList.push(s)}}let z=console.log;const C=document.getElementById("application"),p=new pc.Application(C,{elementInput:new pc.ElementInput(C)});p.setCanvasResolution(pc.RESOLUTION_AUTO),p.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW),p.start(),z(p.batcher);var y=new E(p);p.mouse=new pc.Mouse(document.body),p.keyboard=new pc.Keyboard(document.body),p.mouse.disableContextMenu(),p.mouse.on(pc.EVENT_MOUSEMOVE,y.onMouseMove,y),p.mouse.on(pc.EVENT_MOUSEDOWN,y.onMouseClick,y),p.mouse.on(pc.EVENT_MOUSEUP,y.onMouseUp,y),p.on("vr_action",y.onVrAction,y),new f(p,y);var F=new N(p);function G(t){y.update(t);for(let t of F.controllerList)t&&p.xr.active&&t.update();p.keyboard.wasPressed(pc.KEY_R)&&y.level.loadLevelJson(y.lvl)}p.on("update",G),window.addEventListener("resize",(()=>p.resizeCanvas()))</script><canvas id=application></canvas>