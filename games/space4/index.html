<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=no"><meta name=theme-color content=#000><link rel=icon type=image/png href=i.png><link rel=manifest href=m.json><title>Space4</title><style>:root{--b:#000;--pa:polygon(0% 0%,100% 0%,99% 95%,68% 94%,61% 100%,54% 95%,0 95%);--p:#ff2d95;--c:#675c60;--o:rgba(255,255,255,0);--i:#fff}*{margin:0;padding:0}body,html{background:var(--b);color:var(--i);font-family:Arial;overflow:hidden;position:fixed;user-select:none}div{box-sizing:border-box}.cs{align-items:center;display:flex;justify-content:center}.wh{width:100%;height:100%}#root{height:var(--h);justify-content:center;overflow:hidden;position:relative;width:var(--w);background:radial-gradient(ellipse at bottom,#1b2735 0,#090a0f 100%)}a{color:var(--b);font-weight:700}a:visited{color:var(--b)}@keyframes aS{from{transform:translateY(-2000px)}to{transform:translateY(-150px)}}@keyframes bt{0%{transform:scale(.8)}14%{transform:scale(1.5)}28%{transform:scale(.8)}42%{transform:scale(1.5)}70%{transform:scale(.8)}}@keyframes vs{from{transform:translateY(0)}to{transform:translateY(-90%)}}@keyframes bI{20%,40%,60%,80%,from,to{animation-timing-function:cubic-bezier(0.215,0.61,0.355,1)}0%{opacity:0;transform:scale3d(.3,.3,.3)}20%{transform:scale3d(1.1,1.1,1.1)}40%{transform:scale3d(.9,.9,.9)}60%{opacity:1;transform:scale3d(1.03,1.03,1.03)}80%{transform:scale3d(.97,.97,.97)}to{opacity:1;transform:scale3d(1,1,1)}}@keyframes bD{0%{transform:translateY(-1200px) scale(.7);opacity:.7}80%{transform:translateY(0) scale(.7);opacity:.7}100%{transform:scale(1);opacity:1}}.button{position:relative;margin:auto;padding-right:1.5rem;padding-left:1.5rem;font-size:1rem;line-height:3rem;text-decoration:none;color:var(--i);text-transform:uppercase;letter-spacing:2px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-image:linear-gradient(160deg,red,#ec008c);border-radius:30px;cursor:pointer;user-select:none;box-shadow:0 0 0 0 #ec008c,.5rem .5rem 30px #13092d;transition:box-shadow .6s}.button:hover{box-shadow:0 0 60px 2px #ec008c,.5rem .5rem 30px #13092d}.button:after{content:"";position:absolute;top:2px;right:2px;bottom:2px;left:2px;border-radius:30px;background-image:linear-gradient(170deg,rgba(255,255,255,.3),var(--o));pointer-events:none}meteor{position:absolute;border-radius:100%;overflow:hidden;background:#bbacb0;background-image:radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,#81767a 60%,var(--o) 61%),radial-gradient(circle,#938c8f 60%,var(--o) 61%);background-repeat:no-repeat;background-size:89% 85%,60% 60%,30% 30%,15% 15%,15% 15%,15% 15%,23% 23%,120% 120%,120% 120%;background-position:-109% -82%,115% -5%,70% 42%,59% 7%,39% 52%,55% 87%,30% 77%,-60% 53%,0 53%}#m-g{transition:top .5s cubic-bezier(.86,-.02,.45,1.35)}@keyframes cr{from{transform:rotate(0)}to{transform:rotate(-359deg)}}board{position:relative;animation:bI .5s both}holes{background:linear-gradient(to bottom,silver 0,#b1b1b1 100%);border-radius:10px;box-shadow:inset 0 0 9px 6px #6c6b6b;display:block;position:absolute;z-index:1}holes>button{background:0 0;border:none;cursor:pointer;height:100%}board>meteor{transition:top .5s cubic-bezier(.86,-.02,.45,1.35)}.p-r{transition:.35s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}avatar{flex-direction:column;position:relative}.avs,avimg{background:#bbacb0;border-radius:50%;border:5px solid var(--i);box-shadow:1px -1px 19px 1px var(--i);font-size:5rem;height:100px;overflow:hidden;text-align:center;width:100px}avimg.bl{animation:bl 1s linear infinite}.avatars{cursor:pointer;position:absolute;top:5%;width:100px;height:100px;opacity:0;font-size:40px;border-width:2px}avname a{color:var(--i)}.score{font-size:20px;margin-left:10px;font-weight:700;margin-top:10px}@keyframes bl{25%{box-shadow:0 0 30px 11px var(--turn)}75%{box-shadow:0 0 0 transparent}}.logo{font-size:60px;text-shadow:var(--i) 0 0 5px,var(--i) 0 0 10px,var(--i) 0 0 15px,var(--p) 0 0 20px,var(--p) 0 0 30px,var(--p) 0 0 40px,var(--p) 0 0 50px,var(--p) 0 0 75px;margin-bottom:30px;animation:bD .5s both}modal{position:absolute;top:0;left:0;z-index:100}modal.hide{pointer-events:none;visibility:hidden;transition:visibility .2s}modal.show{visibility:visible}.ms,.mw{left:0;position:absolute;top:0}.ms{backdrop-filter:blur(5px);background:#b6b7c742}.mw{z-index:1}.mc{border-radius:5px;overflow:hidden;width:71%;background:var(--i);overflow:hidden}.mc .txt{color:#8f9cb5;padding:20px;flex-direction:column}.mb button{width:100%;border:none;height:50px;background:#fc7169;cursor:pointer;color:var(--i);text-transform:uppercase;font-weight:700}.mb button:nth-child(2){background:#b6bece}modal.show .mc{animation:fD .2s both}modal.hide .mc{animation:fUp .2s both}@keyframes fD{from{opacity:0;transform:translate3d(0,-100%,0)}to{opacity:1;transform:translate3d(0,0,0)}}@keyframes fUp{from{opacity:1}to{opacity:0;transform:translate3d(0,-100%,0)}}.chat{display:none;position:absolute;clip-path:var(--pa);width:280px;height:280px;top:-281px;left:-122px;background:#01866e;border-radius:10px;z-index:1}.chat.s{display:block}.chat button{border:none;cursor:pointer}.chat-msg{padding:10px}.chat-emoji,.chat-msg{width:100%;display:flex;justify-content:space-around;flex-flow:wrap}.chat-msg button{width:32%;font-size:10px;margin-bottom:5px;padding:7px;color:var(--i);border-radius:10px;background:#016e59}.chat-emoji button{background:0 0;font-size:2.1em;width:20%}bubble{visibility:hidden;position:absolute;background:var(--i);color:gray;font-family:Arial;font-weight:700;text-align:center;width:140px;height:50px;border-radius:9px;padding:0;top:120px;z-index:1;opacity:0;transition:opacity 1s,visibility 1s}bubble.show{visibility:visible;opacity:1}bubble:after{content:"";position:absolute;display:block;width:0;z-index:1;border-style:solid;border-color:var(--i) transparent;border-width:0 14px 10px;top:-10px;left:50%;margin-left:-14px}fieldset{background:rgba(255,255,255,.1);box-shadow:0 8px 32px 0 rgba(31,38,135,.37);backdrop-filter:blur(1px);border-radius:10px;border:1px solid rgba(255,255,255,.18);padding:20px;margin:30px 0;animation:bI 1s both}fieldset form{display:flex}fieldset #code{border-radius:15px;border:none;font-size:30px;text-align:center;width:60%}#back,#sh,#sounds{width:40px;height:40px;background:0 0;border:none;cursor:pointer;font-size:2em;position:absolute;right:5%;top:3%}#back,#sh{left:5%}</style><body class="cs wh"><div id=root></div><script src=/socket.io.js></script><script src=shared.js></script><script>let zzfx,zzfxV,zzfxX,zzfxR;zzfxV=.3,zzfx=(t=1,e=.05,o=220,n=0,i=0,a=.1,s=0,r=1,l=0,c=0,d=0,h=0,m=0,p=0,u=0,f=0,b=0,g=1,x=0,v=0)=>{let $,y,w=2*Math.PI,k=l*=500*w/zzfxR**2,z=(0<u?1:-1)*w/4,T=o*=(1+2*e*Math.random()-e)*w/zzfxR,O=[],R=0,S=0,A=0,M=1,E=0,j=0,P=0;for(c*=500*w/zzfxR**3,u*=w/zzfxR,d*=w/zzfxR,h*=zzfxR,m=zzfxR*m|0,y=(n=99+zzfxR*n)+(x*=zzfxR)+(i*=zzfxR)+(a*=zzfxR)+(b*=zzfxR)|0;A<y;O[A++]=P)++j%(100*f|0)||(P=s?1<s?2<s?3<s?Math.sin((R%w)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/w%2+2)%2:1-4*Math.abs(Math.round(R/w)-R/w):Math.sin(R),P=(m?1-v+v*Math.sin(2*Math.PI*A/m):1)*(0<P?1:-1)*Math.abs(P)**r*t*zzfxV*(A<n?A/n:A<n+x?1-(A-n)/x*(1-g):A<n+x+i?g:A<y-b?(y-A-b)/a*g:0),P=b?P/2+(b>A?0:(A<y-b?1:(y-A)/b)*O[A-b|0]/2):P),R+=($=(o+=l+=c)*Math.sin(S*u-z))-$*p*(1-1e9*(Math.sin(A)+1)%2),S+=$-$*p*(1-1e9*(Math.sin(A)**2+1)%2),M&&++M>h&&(o+=d,T+=d,M=0),!m||++E%m||(o=T,l=k,M=M||1);return(t=zzfxX.createBuffer(1,y,zzfxR)).getChannelData(0).set(O),(o=zzfxX.createBufferSource()).buffer=t,o.connect(zzfxX.destination),o.start(),o},zzfxX=new(window.AudioContext||webkitAudioContext),zzfxR=44100,(()=>{const t=document.querySelector.bind(document),e=document.querySelectorAll.bind(document),o=732,n=412,i=50,a=4,s=["👩‍🚀","👩🏽‍🚀","👨‍🚀","👩🏻‍🚀","👨🏼‍🚀","👩🏼‍🚀","👩🏾‍🚀","👨🏽‍🚀","👨🏻‍🚀","👨🏿‍🚀","👩🏿‍🚀","👨🏾‍🚀"],r={beep:[2,.8,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22],click:[,,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04],win:[,,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14],ring:[,0,1600,.13,.52,.61,1,1.1,,,,,,.1,,.14],drop:[,,1e3,,,.5,,,,,99,.01,.03]},l=["blue","red"],c={msg:["TODAY IS YOUR DAY","WELL PLAYED","GOOG GAME","TODAY IS MY DAY","NICE MOVE","HEHEHEHE","OOPS!","THANKS","PLAY FAST","HI","YEAH","UNLUCKY"],emoji:["😝","🤓","😟","👊","👍","😨","😂","😭","🥰","🤬"]},d="share"in navigator,h="space-four";let m,p,u=!1;t("html").style.cssText+="--h: 732px; --w: 412px; --turn: red;";const f=(t,e)=>t.innerHTML=e,b=t=>Object.keys(t),g=()=>{const t=localStorage.getItem(h)||"";return""!==t?JSON.parse(t):{}},x=(t,e)=>{const o=g();var n;o[t]=e,n=o,localStorage.setItem(h,JSON.stringify(n))},v=(t="",e)=>g()[t]||e,$=(t,e,o,n={})=>{t&&t.addEventListener(e,o,n)},y=(t,e)=>{t&&e.split(" ").forEach((e=>{t.classList.add(e)}))},w=(t,e)=>{t&&e.split(" ").forEach((e=>{t.classList.remove(e)}))},k=(t,e)=>{if(t)for(let o in e)t.style[o]=e[o]},z=t=>b(t).length?`style='${b(t).map((e=>`${e}:${t[e]}`)).join(";")}'`:"",T=(t,e)=>{var o;return function(){clearTimeout(o),o=setTimeout(t,e)}},O=T((()=>{const{w:e,h:i}={w:window.innerWidth,h:window.innerHeight},a=Math.min(e/n,i/o),s=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);k(t("body"),{zoom:`${e<n?Math.round(e/n*100):100}%`,transform:a>=1||s?`scale(${s?1:a})`:void 0})}),50),R=t=>new Array(6).fill(null).map(((e,o)=>new Array(7).fill(null).map(((e,n)=>t(o,n))))),S=t=>`brightness(40%) sepia(100%) hue-rotate(${1===t?183:-50}deg) saturate(600%)`,A=(t="",e="")=>`<a title=${t} href=${e} target="_blank" rel="noopener noreferrer">${t}</a>`,M=()=>({name:v("name",""),avatar:v("avatar",0),token:v("token","")}),E=t=>/^\d+$/.test(t)&&5===t.length,j=(t="",e="",o="",n="",i=0)=>{d?navigator.share({title:t,text:e,url:o}).then((()=>{D.show({icon:"🥰",txt:"<h2>Thanks for sharing</h2>",no:"",yes:"Ok",timer:2e3})})).catch((t=>{D.show({icon:"⚠️",txt:`<h2>Error</h2><p>${t}</p>`,no:"",yes:"Ok",timer:2e3})})):((t=>{const e=document.createElement("input");e.setAttribute("value",t),document.body.appendChild(e),e.select();const o=document.execCommand("copy");document.body.removeChild(e)})(o),D.show({icon:"👍",txt:n,no:"",yes:"Ok",timer:i}))},P=()=>{if(t("#sounds")){const e="yes"===v("sounds","yes")?"no":"yes";x("sounds",e),t("#sounds").textContent="yes"===e?"🔊":"🔇"}},L=()=>j("Space4","Play Space4 #js13k 2021 edition by Jorge Rubiano @ostjh",location.href,"<h2>URL copied</h2><p>The url has been copied to your clipboard, share it with your friends</p>"),I={play(t="click",e=0){"yes"===v("sounds","yes")&&zzfx(...r[t]),e&&(p=setInterval((()=>{"yes"===v("sounds","yes")&&zzfx(...r[t])}),2e3))},stop(){p&&clearInterval(p)}},C=({style:t={},id:e=""})=>`<meteor ${e?`id=${e} `:""}${z(t)}></meteor>`,N=()=>`<board ${z({width:"350px",height:"300px"})}><holes class=wh ${z({"-webkit-mask-image":"radial-gradient(transparent 50%, #fff 50%)","-webkit-mask-size":"50px 50px","-webkit-mask-position":"50px 50px"})}>${new Array(7).fill(null).map(((t,e)=>`<button id='h-${e}' ${z({width:"50px"})}></button>`)).join("")}</holes>${R(((t,e)=>C({id:`m-${e+7*t}`,style:{width:"31.5px",height:"31.5px",visibility:"hidden"}}))).map((t=>t.join(""))).join("")}</board>`,D={show({txt:e,icon:o="",yes:n="yes",no:i="no",cb:a,timer:s=0}){t("modal .txt").innerHTML=(o?`<p ${z({"font-size":"3rem"})}>${o}</p>`:"")+e,k(t("modal #btn1"),{display:n?"block":"none"}),k(t("modal #btn2"),{display:i?"block":"none"}),t("modal #btn1").textContent=n,t("modal #btn2").textContent=i,w(t("modal"),"hide"),y(t("modal"),"show"),this.interval&&clearTimeout(this.interval),s&&(this.interval=setTimeout((()=>{this.hide()}),s)),this.callback=a},hide(){w(t("modal"),"show"),y(t("modal"),"hide"),this.interval&&clearTimeout(this.interval)},render:()=>'<modal class="hide wh"><div class="ms wh"></div><div class="mw wh cs"><div class=mc><div class="wh cs txt"></div><div class="mb wh cs"><button id=btn1></button><button id=btn2></button></div></div></div></modal>',events(){e("modal button").forEach((t=>$(t,"click",(t=>{this.hide(),this.callback&&this.callback("btn1"===t.target.id)}))))}},H=o=>{const{isTwoPlayers:n=!1,isBot:r="",numMeteorites:d=a,isOnline:h={}}=o,p=M(),g=!(!n&&!r);let x=R((()=>[])),v=0,O=!1,A=g?randomNumber(1,2):h.playerStartsGame===p.token?1:2,E=A,j=g?!n&&2===A:2===A;const L=[],H=[{name:p.name,image:s[p.avatar],color:g?randomNumber(1,2):h.color,token:p.token,score:0}];if(H.push({name:g?n?"Guest":"Mr. Bot":h.p2.name,image:g?n?"👽":"🤖":s[h.p2.avatar],color:g?1===H[0].color?2:1:h.p2.color,token:g?"":h.p2.token,score:0}),g&&r)for(let t=d-1;t>=1;t--)L.push({c:l[H[1].color-1],i:t},{c:l[H[0].color-1],i:t});let Y,F,B={},V=!1;const J=()=>{Y&&clearInterval(Y),F&&clearTimeout(F);for(let t=0;t<H.length;t++)H[t].interval&&clearTimeout(H.interval)},_=(e="",o=0,n=1)=>{const i=t(`#pl-${n} bubble`);i.innerHTML=c[e][o],y(i,"show"),k(i,{"font-size":"msg"===e?"14px":"2em"}),H[n-1].interval&&clearTimeout(H[n-1].interval),H[n-1].interval=setTimeout((()=>{w(i,"show")}),2e3)},K=(e=1,o=!0)=>{let n=100;const i=t(`#pl-${e} circle`),a=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=`${a} ${a}`,i.style.strokeDashoffset=`${a}`;const s=t=>{const e=a-t/100*a;i.style.strokeDashoffset=e};s(n),Y&&clearInterval(Y),o&&(Y=setInterval((()=>{if(s(n),n--,n<=50&&n%4==0&&I.play("beep"),n<0&&(clearInterval(Y),1===e)){const t=at();ot(t,H[e-1].color)}}),150))},Q=e=>{const o={show:!1,txt:""};if(b(e.posible).length){const t=l[H[E-1].color-1];B[t]||(B[t]={});for(let o=d-1;o>=1;o--){const n="c-"+(d-o);B[t][n]||(B[t][n]=[]),e.posible[n].length&&(B[t][n]=[...new Set([...B[t][n],...e.posible[n]].map((t=>`${t[0]}${t[1]}`)))].map((t=>t.split("").map((t=>+t)))))}}if(e.connect){const n=e.meteorites.map((t=>x[t[0]][t[1]][1]));for(let e=0;e<=v;e++)k(t(`#m-${e}`),n.includes(e)?{animation:"bt 2s ease-out infinite","z-index":1}:{opacity:".5"});H[E-1].score+=1,t(`#pl-${E} .score`).innerHTML=H[E-1].score,o.show=!0,o.icon=H[E-1].image,o.txt=`<h2>${H[E-1].name} has won</h2><p>Do you want to play again?</p>`,I.play("win",2e3)}else 0!==it().length?(O=!1,v++,E=1===E?2:1,j=g?!(!r||2!==E):2===E,nt()):(o.show=!0,o.icon="🤝",o.txt="<h2>Tied game</h2><p>Do you want to play again?</p>");o.show&&(J(),D.show({...o,cb(t){I.stop(),g?t?rt():q():t?(m.emit("action",{type:"pA",room:h.room,currentPlayer:p}),D.show({icon:"⏳",txt:`<h2 ${z({"text-align":"center"})}>Waiting for opponent's response</h2>`,no:"",yes:"Cancel",cb(){tt(),q()}})):(tt(),q())}}))},Z=(t,e)=>t>=0&&t<6&&e>=0&&e<7,et=t=>{const e=+t[0],o=+t[1],n=x[e][o][0],i={v:[[e,o]]},a={};for(let t=e+1;t<6&&x[t][o][0]===n;t++)if(i.v.push([t,o]),i.v.length===d)return{connect:!0,posible:a,meteorites:i.v};i.h=[[e,o]];for(let t=1;t<=2;t++){let s=o+(1===t?-1:1);for(;;){if(!Z(e,s)||x[e][s][0]!==n)break;if(i.h.push([e,s]),s+=1===t?-1:1,i.h.length===d)return{connect:!0,posible:a,meteorites:i.h}}}for(let t=1;t<=2;t++){const s=1===t?"id":"di";i[s]=[[e,o]];for(let r=1;r<=2;r++){const l={col:1===t?1===r?-1:1:1===r?1:-1,row:1===r?-1:1};let c=o+l.col,h=e+l.row;for(;;){if(!Z(h,c)||x[h][c][0]!==n)break;if(i[s].push([h,c]),h+=l.row,c+=l.col,i[s].length===d)return{connect:!0,posible:a,meteorites:i[s]}}}}if(r&&("medium"===r||"hard"===r))for(let t=d-1;t>=1;t--){const n="c-"+(d-t);if(a[n]=[],i.h.length===d-t){const t=i.h.map((t=>t[1])).sort(),o={left:t[0]-1,right:t[t.length-1]+1};for(let t=1;t<=2;t++){const i=1===t?"left":"right";Z(e,o[i])&&0===x[e][o[i]].length&&a[n].push([e,o[i]])}}if(i.v.length===d-t){const t=i.v[0][0]-1;Z(t,o)&&0===x[t][o].length&&a[n].push([t,o])}for(let e=1;e<=2;e++){const o=1===e?"id":"di";if(i[o].length===d-t){const t=i[o].sort(((t,e)=>t[0]-e[0]));for(let o=1;o<=2;o++){const i=t[1===o?0:t.length-1],s=i[0]+(1===o?-1:1),r=i[1]+(1===e?1===o?-1:1:1===o?1:-1);Z(s,r)&&0===x[s][r].length&&a[n].push([s,r])}}}}return{connect:!1,posible:a}},ot=(e=0,o=1)=>{const n=x.map((t=>t[e])).filter((t=>!t.length)).length-1;if(O||n<0)return;t("#turn").innerHTML="...",I.play("drop");const a=t(`#m-${v}`);x[n][e]=[o,v],a.setAttribute("p",`${n}-${e}`),k(a,{left:9+i*e+"px",top:"-59px",filter:S(o),visibility:"visible"}),setTimeout((()=>{a&&k(a,{top:9+i*n+"px"})}),100),O=!0,g||(K(E,!1),1===E&&m.emit("action",{type:"drop",currentPlayer:p,room:h.room,index:e,color:o})),V=!1,F&&clearTimeout(F),F=setTimeout((()=>{V=!0,a&&k(a,{top:9+i*n+"px"}),Q(et([n,e]))}),2e3)},nt=()=>{document.documentElement.style.setProperty("--turn",l[H[E-1].color-1]);const e=1===E?2:1;y(t(`#pl-${E} avimg`),"bl"),w(t(`#pl-${e} avimg`),"bl"),t("#turn").innerHTML=1===E?"You turn":"Opponent's turn",r&&2===E&&st(),g||K(E)},it=()=>{const t=[];for(let e=0;e<7;e++){let o=0;for(let t=0;t<6;t++)o+=+(0===x[t][e].length);0!==o&&t.push(e)}return t},at=()=>{const t=it();return t[randomNumber(0,t.length-1)]},st=T((()=>{let t=at(),e=!1;const o="easy"!==r&&("medium"!==r||!!randomNumber(0,1));if(0!==b(B).length&&o)for(let o of L)if(B[o.c]){const a=B[o.c][`c-${o.i}`],s=[];if(0!==a.length)for(let o=0;o<a.length;o++)if(0===x[a[o][0]][a[o][1]].length){if(n=a[o][0],i=a[o][1],n+1===6||0!==x[n+1][i].length){t=a[o][1],s.push(o),e=!0;break}}else s.push(o);for(let t=0;t<s.length;t++)B[o.c][`c-${o.i}`].splice(s[t],1);if(e)break}var n,i;ot(t,H[E-1].color)}),500),rt=()=>{x=R((()=>[])),e("board > meteor").forEach((t=>{t.style="",k(t,{width:"31.5px",height:"31.5px",visibility:"hidden"})})),v=0,O=!1,A=1===A?2:1,E=A,j=g?!n&&2===A:2===A,B={},V=!1,J(),nt(),I.stop()};f(t("#render"),`<div class='wh cs' ${z({"flex-direction":"column","z-index":3})}>${W()}${G()}${((t=[],e=!1)=>`<div class=cs ${z({width:"100%",margin:"30px 0"})}>${t.map(((t,o)=>`<div ${z({width:"100%",display:"flex","justify-content":"center","flex-direction":"column","align-items":"center",position:"relative",animation:`b-${o?"right":"left"} 0.8s both`})} id=pl-${o+1}>${e?`<svg class="p-r" width="120" height="120" ${z({position:"absolute","z-index":1,top:"11px",transform:"scale(0.7)"})}><circle class="progress-ring__circle" stroke="${l[t.color-1]}" stroke-width="12" fill="transparent" r="52" cx="60" cy="60"/></svg><bubble class=cs></bubble>`:""}${X({name:t.name,styles:{"margin-bottom":"10px","font-size":"18px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","text-align":"center",width:"120px"}})}${U({image:t.image,styles:{width:"70px",height:"70px","font-size":"3.5rem"}})}<div class=cs>${C({style:{filter:S(t.color),width:"20px",height:"20px",position:"relative","margin-top":"10px",animation:"cr 3s infinite linear"}})}<div class=score>0</div></div></div>`)).join("")}</div>`)(H,!g)}<div id=turn ${z({"font-size":"25px","margin-bottom":"30px"})}></div>${N()}${g?"":`<chat ${z({"margin-top":"30px",position:"relative","z-index":1})}><div class=chat>${b(c).map((t=>`<div class=chat-${t}>${c[t].map(((e,o)=>`<button id="${t}-${o}">${e}</button>`)).join("")}</div>`)).join("")}</div><button class=button>Chat</button></chat>`}</div>`),g||($(t("chat .button"),"click",(()=>{t(".chat").classList.toggle("s")})),e(".chat button").forEach((e=>{$(e,"click",(e=>{const o=e.target.id.split("-");_(o[0],+o[1]),m.emit("action",{type:"chat",room:h.room,currentPlayer:p,value:o}),w(t(".chat"),"s")}))}))),e("holes > button").forEach((t=>$(t,"click",(t=>!j&&ot(+t.target.id.split("-")[1],H[E-1].color))))),e("board > meteor").forEach((t=>{return e=t=>{F&&clearTimeout(F),V||Q(et(t.target.getAttribute("p").split("-")))},$(t,"transitionend",(t=>e(t)));var e})),$(t("#back"),"click",(()=>{D.show({icon:"⚠️",txt:`<h2 ${z({"margin-bottom":"10px"})}>Exit game</h2><p>Are you sure you want to finish the game?</p>`,cb(t){t&&(J(),g||tt(),q())}})})),$(t("#sounds"),"click",P),u&&m&&(m.on("action",(t=>{if(t.currentPlayer.token!==p.token){const{type:e=""}=t;"drop"===e&&(O=!1,V=!1,J(),ot(t.index,t.color)),"pA"===e&&(I.stop(),D.show({icon:"😃",txt:`<h2 ${z({"text-align":"center"})}>Your opponent wants to play again</h2>`,cb(t){t?(m.emit("action",{type:"at",room:h.room,currentPlayer:p}),rt()):(tt(),q())}})),"at"===e&&(D.hide(),rt()),"chat"===e&&_(t.value[0],+t.value[1],2)}})),m.on("pD",(()=>{J(),tt(),q(),D.show({icon:"😩",txt:`<h2 ${z({"margin-bottom":"10px"})}>User disconnected</h2><p>Your partner has left the room</p>`,no:"",yes:"Ok",timer:2e3})}))),nt()},G=()=>"<button id=back>⬅️</button>",Y=()=>{f(t("#render"),`<div class='cs' ${z({"flex-direction":"column"})}>${G()}${F()}<h2 ${z({margin:"30px 0","text-align":"center","text-transform":"uppercase"})}>CHOOSE DIFFICULTY</h2>${["Easy","Medium","Hard"].map(((t,e)=>`<button class=button id=${t.toLowerCase()} ${z({width:"150px","margin-bottom":"20px",animation:`bI ${.5*e+.5}s both`})}>${t}</button>`)).join("")}</div>`),e(".button").forEach((t=>$(t,"click",(t=>q("Game",{isBot:t.target.id}))))),$(t("#back"),"click",(()=>q()))},F=()=>"<h1 class=logo>Space4</h1>",U=({image:t="",styles:e={}})=>`<avimg ${z(e)}>${t}</avimg>`,X=({name:t="",edit:e=!1,styles:o={}})=>`<avname ${z(o)}>${e?`<a href="#">${t}</a>`:t}</avname>`,B=({name:t,stylesImage:e={},stylesName:o={},avatar:n={},edit:i=!1})=>`<avatar class=cs>${U({image:n.image,styles:e})}${X({name:t,styles:o,edit:i})}${i?` <select class=avatars>${s.map(((t,e)=>`<option value=${e}${n.index===e?" selected":""}>${t}</option>`)).join("")}</select>`:""}</avatar>`,V=(e={})=>{const o=M(),n={"margin-top":"15px","font-weight":"bold","font-size":"15px"};f(t("#render"),`<div class=cs ${z({"flex-direction":"column",width:"100%","z-index":5})}>${W()}${G()}${F()}<div class="cs" ${z({margin:"50px 0",width:"90%","justify-content":"space-around"})}>${B({name:o.name,avatar:{image:s[o.avatar],index:o.avatar},stylesImage:{width:"70px",height:"70px","font-size":"3.5rem"},stylesName:n})}<h1>Vs</h1><div id="vs" class=cs ${z({"flex-direction":"column"})}><div class=avs ${z({width:"80px",height:"80px",overflow:"hidden",position:"relative"})}><div class=cs ${z({"flex-direction":"column",position:"absolute",top:0,left:0,width:"100%",animation:"vs 1.5s infinite linear","font-size":"3.5rem"})}>${s.map((t=>t)).join("")}</div></div>${X({name:"Searching...",styles:n})}</div></div>${e.createRoom?`<div ${z({width:"90%"})}><fieldset class=cs ${z({"margin-top":0,"flex-direction":"column"})}><legend>Play with Friends</legend><code ${z({"font-size":"50px","font-weight":"bold","margin-bottom":"10px","text-align":"center"})}>${e.friendRoom}</code><button id=share class=button ${z({"margin-bottom":"20px"})}>Share Room</button><p>Share this room code to play with your friend</p></fieldset></div>`:""}<button id=cancel class=button>Cancel</button></div>`);const i=()=>{q(),tt()};$(t("#back"),"click",i),$(t("#cancel"),"click",i),$(t("#sounds"),"click",P),I.play("ring",2e3),e.createRoom&&$(t("#share"),"click",(()=>{j("Space4","Come Play a Space4 match with me :)",`${location.href}?room=${e.friendRoom}`,"<h2>URL copied</h2><p>The URL of the room has been copied into your clipboard</p>",2e3)})),et(e)},J=()=>{f(t("#render"),`<div class=cs ${z({"flex-direction":"column",width:"100%","z-index":5})}>${G()}${F()}${[{legend:"Please enter the five room code",html:'<form><input type="tel" id="code" autocomplete="off"><button type="submit" class=button>JOIN</button></form>'},{legend:"Create a private room",html:"<button class=button>CREATE</button>"}].map(((t,e)=>`<div id=f-${e} ${z({width:"80%"})}><fieldset class=cs><legend>${t.legend}</legend>${t.html}</fieldset></div>${0===e?"<h2>OR</h2>":""}`)).join("")}</div>`),$(t("#back"),"click",(()=>q())),$(t("form"),"submit",(e=>{e.preventDefault();const o=t("#code").value;E(o)?q("SearchOpponent",{friendRoom:o,type:"friend"}):D.show({icon:"⚠️",txt:"<h2>Invalid code</h2><p>The code of the room must be a number and five characters</p>",no:"",yes:"Ok"})})),$(t("#f-1 button"),"click",(()=>{q("SearchOpponent",{createRoom:!0,friendRoom:randomNumber(1e4,99999),type:"friend"})}))},W=()=>`<button id=sounds>${"yes"===v("sounds","yes")?"🔊":"🔇"}</button>`,_=()=>{const o=M();f(t("#render"),`<div class=cs ${z({"flex-direction":"column","z-index":5})}><button id=sh>🚀</button>${W()}${F()}${B({name:o.name,avatar:{image:s[o.avatar],index:o.avatar},stylesName:{"margin-top":"15px","font-weight":"bold","font-size":"25px"},edit:!0})}<div class='cs options' ${z({"flex-direction":"column","margin-top":"25px"})}>${[["Two Players","two"],["Vs Bot","bot"],["Play with friends","friend"],["Play Online","online"]].map(((t,e)=>`<button class=button id=${t[1]} ${z({width:"260px","margin-bottom":"20px",animation:`bI ${.5*e+.5}s both`})}>${t[0]}</button>`)).join("")}</div><a id="about" ${z({color:"white","z-index":2,"font-size":"20px"})} href="#">About</a></div>`),$(t("#about"),"click",(t=>{t.preventDefault(),D.show({txt:`<p ${z({"font-size":"3rem","margin-bottom":"10px"})}>👨🏻‍💻</p><p>Game developed by Jorge Rubiano for the 2021 edition of ${A("#js13k","https://js13kgames.com/")}</p><div class=wh ${z({padding:"15px"})}><ul>${[["Twitter","https://twitter.com/ostjh"],["Github","https://github.com/Jorger"],["Linkedin","https://www.linkedin.com/in/jorge-rubiano-a8616319"]].map((t=>`<li ${z({"margin-bottom":"5px"})}>${A(t[0],t[1])}</li>`)).join("")}</ul></div>`,yes:"Ok",no:""})})),e(".options > button").forEach((t=>{$(t,"click",(t=>{const e=t.target.id;"two"===e?q("Game",{isTwoPlayers:!0}):q({bot:"Difficulty",online:"SearchOpponent",friend:"PlayFriends"}[e])}))})),$(t(".avatars"),"change",(e=>{f(t("avimg"),s[e.target.value]),x("avatar",+e.target.value)})),$(t("avname a"),"click",(e=>{e.preventDefault();const o=sanizateTags(prompt("Write your name (MAX 10)",v("name","")));if(o){const e=o.length>10?o.substring(0,10)+"...":o;t("avname a").textContent=e,x("name",e)}})),$(t("#sounds"),"click",P),$(t("#sh"),"click",L)},q=(e="Lobby",o={})=>{const n={Lobby:_,Game:H,Difficulty:Y,SearchOpponent:V,PlayFriends:J};I.stop(),n[e](o),k(t("#m-g"),{top:"Game"===e?"732px":"567.2px"})},K=[600,300,200].map(((t,e)=>`.star-${e} {width: 1px; height: 1px; background: transparent; box-shadow: ${new Array(t).fill(null).map((()=>`${randomNumber(1,2e3)}px ${randomNumber(1,2e3)}px #FFF`)).join(",")}; animation : aS ${50*e+50}s linear infinite;}`)).join(""),Q=["left","right"].map(((t,e)=>`@keyframes b-${t} {0% { transform: translateX(${2e3*(e?1:-1)}px) scale(0.7); opacity: 0.7; } 80% { transform: translateX(0px) scale(0.7); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; }}`)).join(""),Z=document.createElement("style");f(Z,Q+K),t("head").appendChild(Z),f(t("#root"),`${D.render()}<div id="render" class="wh cs"></div>${new Array(3).fill(null).map(((t,e)=>`<div class='star-${e}'></div>`)).join("")}${C({id:"m-g",style:{width:"412px",height:"412px",top:"567.2px","z-index":1,animation:"cr 60s infinite linear"}})}`),D.events(),$(t("#root"),"click",(t=>{const e=t.target,o=e.id||"";["A","BUTTON"].includes(e.nodeName)&&0===["h-","msg-","emoji-"].filter((t=>o.includes(t))).length&&I.play()}));const tt=()=>{u&&m&&(u=!1,m.disconnect())},et=(t={})=>{m=io({path:location.pathname+"io",upgrade:!1,transports:["websocket"]}),u=!0,m.on("connect",(()=>{m.emit("nU",{...t,player:M()},(t=>{t&&(q("PlayFriends"),tt(),D.show({icon:"⚠️",txt:`<h2>${t}</h2>`,no:"",yes:"Ok",timer:2e3}))}))})),m.on("connect_error",(()=>{q(),tt(),D.show({icon:"🔌",txt:"<h2>Error connecting to server</h2>",no:"",yes:"Ok",timer:2e3})})),m.on("sG",(t=>{const e=t.p1.token===M().token?"p1":"p2";q("Game",{isOnline:{room:t.room,playerStartsGame:t.playerStartsGame,color:t[e].color,p2:t["p1"===e?"p2":"p1"]}})}))};b(g()).length||(x("name",`Astronaut ${randomNumber(100,999)}`),x("avatar",randomNumber(0,s.length-1)),x("token",guid()));const ot={screen:"Lobby",param:{}},nt=(()=>{let t=[];const e=window.location.search;return"?"===e[0]&&(t=e.slice(1).split("&").map((t=>{let e,o;return[e,o]=t.split("="),{key:e,value:o}}))),t})();if(0!==nt.length){const t=nt.filter((t=>"room"===t.key));if(t.length){const e=t[0].value||"";E(e)&&(ot.screen="SearchOpponent",ot.param={friendRoom:e,type:"friend"})}history.replaceState({},document.title,location.protocol+"//"+location.host+location.pathname)}q(ot.screen,ot.param),$(document,"contextmenu",(t=>t.preventDefault())),$(window,"resize",O),O()})()</script>