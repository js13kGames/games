<!doctype html><meta name=viewport content="width=device-width"><title>COD: Black CAT</title><script src=/2025/webxr/aframe.js></script><script>var t=class{R;H;mesh;M;T;A;_;constructor(){this.R=new THREE.BufferGeometry,this.H=new THREE.MeshStandardMaterial({vertexColors:!0}),this.mesh=new THREE.Mesh(this.R,this.H),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.M=[],this.T=[],this.A=[],this._=0}resetBuffers(){this.M=[],this.T=[],this.A=[],this._=0,this.R.setAttribute("position",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setAttribute("color",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setAttribute("normal",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setIndex([])}addQuad(t,e){let i=t[0],s=t[1],o=(t[2],t[3]),r=(new THREE.Vector3).subVectors(s,i).cross((new THREE.Vector3).subVectors(o,i)).normalize(),n=[0,1,2,0,2,3];for(let i=0;i<6;i++){let s=n[i];this.M.push(t[s].x,t[s].y,t[s].z),this.A.push(r.x,r.y,r.z);let o=(e>>16&255)/255,a=(e>>8&255)/255,h=(255&e)/255;this.T.push(o,a,h),this._++}}updateBuffers(){this.R.setAttribute("position",new THREE.BufferAttribute(new Float32Array(this.M),3)),this.R.setAttribute("color",new THREE.BufferAttribute(new Float32Array(this.T),3)),this.R.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(this.A),3)),this.R.computeVertexNormals(),this.R.attributes.position.needsUpdate=!0,this.R.attributes.color.needsUpdate=!0,this.R.attributes.normal.needsUpdate=!0}render(t){0!==this._&&(t.children.includes(this.mesh)||t.add(this.mesh))}},i=[0,4292465625,4290293945,4288319899,4285358189,4278190080,4280950826,4290938499,4289165163,4286995798,4285089604,4282263344,4287245887,4289216328,4291122768,4292048725,4292647261,4292789621,4289245540,4285503326,4282084184,4281157963,4282806135,4285307815,4288526533,4286483111,4283584371,4282921813,4284560993,4286725737,4290142332,4292059282,4292261809,4284448934,4283852692,4285817487,4285285242,4283709242,4284558136,4281743165,4282592578];function s(t){return i[t]||4294967295}var e=class{F;C;$;Y;X;Z;S;B;O;P;U;I;L;constructor(t){this.$=t?.metersX??10,this.Y=t?.metersY??10,this.X=t?.metersZ??10,this.Z=t?.voxelsPerMeter??8,this.S=1/this.Z,this.B=Math.max(0,this.$/this.S|0),this.O=Math.max(0,this.Y/this.S|0),this.P=Math.max(0,this.X/this.S|0),this.L=t?.origin??{x:0,y:0,z:0},this.U=this.B*this.O,this.I=this.U*this.P,this.F=new Uint8Array(this.I),this.C=null}N(t,e,i){let s=t-this.L.x,o=e-this.L.y,r=i-this.L.z;return s<0||s>=this.$||o<0||o>=this.Y||r<0||r>=this.X}V(t,e,i){let s=t-this.L.x,o=e-this.L.y,r=i-this.L.z,n=s/this.S|0,a=o/this.S|0;return(r/this.S|0)*this.B*this.O+a*this.B+n}D(t,e,i){return t>=0&&t<this.B&&e>=0&&e<this.O&&i>=0&&i<this.P}G(t,e,i){return i*this.U+e*this.B+t}J(t,e,i){return!this.D(t,e,i)||0===this.F[this.G(t,e,i)]}getCube(t,e,i){return this.N(t,e,i)?0:this.F[this.V(t,e,i)]}setCube(t,e,i,s){this.N(t,e,i)||(this.F[this.V(t,e,i)]=s)}K(t,e,i){return 0===this.getCube(t,e,i)}W(){this.C=new t;let e=0;for(let t=0;t<this.P;t++)for(let i=0;i<this.O;i++)for(let o=0;o<this.B;o++){let r=this.F[e++];if(0===r)continue;let n=s(r),a=o*this.S+this.L.x,h=i*this.S+this.L.y,l=t*this.S+this.L.z,c=a+this.S,d=h+this.S,u=l+this.S,m=new THREE.Vector3(a,d,u),f=new THREE.Vector3(c,d,u),p=new THREE.Vector3(c,d,l),E=new THREE.Vector3(a,d,l),b=new THREE.Vector3(a,h,u),y=new THREE.Vector3(c,h,u),g=new THREE.Vector3(c,h,l),w=new THREE.Vector3(a,h,l);this.J(o,i+1,t)&&this.C.addQuad([m,f,p,E],n),this.J(o,i-1,t)&&this.C.addQuad([w,g,y,b],n),this.J(o,i,t+1)&&this.C.addQuad([f,m,b,y],n),this.J(o,i,t-1)&&this.C.addQuad([E,p,g,w],n),this.J(o-1,i,t)&&this.C.addQuad([m,E,w,b],n),this.J(o+1,i,t)&&this.C.addQuad([p,f,y,g],n)}this.C.updateBuffers()}getMesh(t=!1){return(!this.C||t)&&this.W(),this.C.mesh}render(t){this.C&&this.C.render(t)}};function o(t,e,i=0,s=new THREE.Vector3(0,0,0)){let o=t.split("|"),r=o[0]||"",n=o[1]||"",a=o[2]||"",h=r?r.split(","):[],l=[];if(a){let t=a.split(",").filter(Boolean);for(let e=0;e<t.length;e++){let i=parseInt(t[e],10);l[e+1]=isNaN(i)?0:i}}let c=0;for(let t=0;t<8;t++)for(let o=0;o<8;o++){let r=n[c++],a=h["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_".indexOf(r)];if(a)for(let r=0;r<8;r++){let n=parseInt(a[r]||"0",16);if(0!==n){let a=void 0!==l[n]?l[n]:n,h=t,c=o;switch(i){case 1:h=o,c=7-t;break;case 2:h=7-t,c=7-o;break;case 3:h=7-o,c=t}let d=h/8+s.x,u=r/8+s.y,m=c/8+s.z;e.setCube(d,u,m,a)}}}}var h=["11111111,22212221,00000000|0111011101110111222222222222222222222222222222222222222222222222|3,1","00000000,33330000,33333000,11111111,22212221,00002221,00000221,00000111,11112221|0012210034567584000000000000000000000000000000000000000000000000|3,1,5","11111111,22222222,00000000|0110011001100110222222222222222222222222222222222222222222222222|19,20","00000000,33330000,33333000,11111111,22222222,00002222,00000111|0012210034566543000000000000000000000000000000000000000000000000|19,20,5","12232333,12231223,11121223,23331223,12231112,00000000|0112311401123114555555555555555555555555555555555555555555555555|12,13,14","00000000,22220000,22222000,13343444,13341334,00001334,00000334,13341113|0012210034566547000000000000000000000000000000000000000000000000|12,5,13,14"],n=["00000000,11111111,00000001|0000000100000002000000020000000200000002000000020000000200000001|37","00000000,11111111|0000000100000000000000000000000000000000000000000000000000000001|37"],r=["00000000,33000000,22222220,22111120,11111120,11111111,02222222,02111111,02111122,00000033|0010000002344420555555555555555555555555555555550677786000000900|10,9,4","00000000,00000400,01100000,00004000,01100300,11123000,11120000,11122300,00000030,00000004|0000000000000000010223000045620000267200000228000000009000000000|28,20,19,17","00000000,00011130,01111110,11111110,00011110,01111100,11113110,01110000,11200000,00110000,01200000|01233240042332400056650000788700009aa900000990000000000000000000|1,34,4","00000000,00000020,11000000,00022220,01100020,02222220,00222220,00222200,02222200,22222200,00000200|0011110021333312456776541588885115999951a899998aa899998aa899998a|40,1","11111111,12232241,12322241,13222241,12222231,12222341,14443441,10000001,00000000|0123456007777770888888888888888888888888888888888888888888888888|10,23,24,22","11111111,12322651,13322261,14352221,14442251,14444421,13222521,00000000|0123456077777777777777777777777777777777777777777777777777777777|37,34,26,6,17,24","00000000,11110000,00010000|0000000000000000001221000022220000222200001221000000000000000000|10","11111111,01111110,01111111,01120000,01123000|0122221034444443344444433444444334444443344444433444444334444443|10,1,12","00000000,00010000,00011000,00011111,00001000,00000111|0123321001455410014444100111111000000000000000000000000000000000|4","11111114,22221224,22231234,00000004,00000000|0111111001111110011111100111111001111110011221103333333344444444|9,8,11,40","11111111,00000000,22222220,21111120,03444300|0000000000000000000000000000000000000000123222211141111111111111|2,1,4,40","00000000,11122222,00022222,00020000,11120000|0012210000333300003333000033330000433400000000000000000000000000|10,37","11111111,22213301,33012201,44415551,22013331,55010001,33312221,44410001,00010001,00013331,00000000|00000000012345600127456008279580aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa|10,21,12,16,15","00000002,11111112|0000000000000000000000000000000000000000000000000100000000000000|10,37","00022222,11111100,00020000,00020100|0000000012222221322222233222222332222223322222231222222122222222|10,12"],a=[[1,2],[0],[0,3],[2,4],[3,5,6],[4,10],[4,7,8],[6],[6,9],[8],[5]],l=[{origin:[0,0,5],size:[7,9,3],wallModel:2,doors:[{x:7,z:1,rotation:1},{x:1,z:9,rotation:0}],mouseHoles:[],contents:[{model:r[0],pos:[5,.125,0],rot:3},{model:r[0],pos:[5,1.125,0],rot:1},{model:r[4],pos:[2,1.125,.125],rot:3},{model:r[4],pos:[1,1.125,.125],rot:3},{model:r[6],pos:[1,.125,0],rot:3},{model:r[13],pos:[5,.125,7],rot:3},{model:r[13],pos:[4,.125,7],rot:2},{model:r[13],pos:[5,.125,6],rot:0},{model:r[13],pos:[4,.125,6],rot:1},{model:r[11],pos:[5,.125,5],rot:3}]},{origin:[7,0,5],size:[5,4,3],wallModel:4,doors:[{x:0,z:1,rotation:3}],mouseHoles:[{x:3,z:4,rotation:1}],contents:[{model:r[0],pos:[2,.125,3],rot:1},{model:r[0],pos:[2,1.125,3],rot:3}]},{origin:[0,0,14],size:[7,4,3],wallModel:2,doors:[{x:1,z:0,rotation:2},{x:7,z:1,rotation:1}],mouseHoles:[{x:0,z:2,rotation:0}],contents:[{model:r[4],pos:[3,1.125,2.875],rot:1},{model:r[4],pos:[2,1.125,2.875],rot:1},{model:r[5],pos:[3,1.125,.25],rot:3}]},{origin:[7,0,12],size:[5,5,3],wallModel:4,doors:[{x:0,z:3,rotation:3},{x:3,z:0,rotation:2}],mouseHoles:[{x:2,z:5,rotation:1},{x:1,z:0,rotation:3}],contents:[{model:r[14],pos:[3.75,.125,2],rot:2},{model:r[6],pos:[3.75,.125,3],rot:2},{model:r[1],pos:[3.75,.625,3],rot:2}]},{origin:[7,0,9],size:[8,3,3],wallModel:2,doors:[{x:3,z:3,rotation:0},{x:6,z:0,rotation:2},{x:6,z:3,rotation:0}],mouseHoles:[{x:2,z:0,rotation:3},{x:8,z:1,rotation:2}],contents:[{model:r[12],pos:[.25,.125,1],rot:0},{model:r[12],pos:[.25,1.125,1],rot:0},{model:r[5],pos:[3,1.125,.25],rot:3}]},{origin:[12,0,12],size:[6,6,3],wallModel:2,doors:[{x:1,z:0,rotation:2},{x:6,z:1,rotation:1}],mouseHoles:[{x:1,z:6,rotation:1},{x:4,z:0,rotation:3}],contents:[{model:r[7],pos:[3,.125,4.75],rot:1},{model:r[7],pos:[4,.125,4.75],rot:1},{model:r[7],pos:[3,.125,3.75],rot:3},{model:r[7],pos:[4,.125,3.75],rot:3},{model:r[6],pos:[2,.125,4.75],rot:0},{model:r[0],pos:[3,.125,0],rot:3},{model:r[0],pos:[3,1.125,0],rot:1}]},{origin:[12,0,5],size:[6,4,3],wallModel:2,doors:[{x:1,z:4,rotation:0},{x:2,z:0,rotation:2},{x:6,z:1,rotation:1}],mouseHoles:[{x:0,z:2,rotation:0}],contents:[{model:r[11],pos:[4.5,.125,2.5],rot:2},{model:r[12],pos:[.25,.125,1],rot:0},{model:r[12],pos:[.25,1.125,1],rot:0}]},{origin:[12,0,0],size:[5,5,3],wallModel:4,doors:[{x:2,z:5,rotation:0}],mouseHoles:[{x:0,z:2,rotation:0},{x:0,z:3,rotation:0},{x:5,z:1,rotation:2}],contents:[]},{origin:[18,0,4],size:[5,5,3],wallModel:0,doors:[{x:0,z:2,rotation:3},{x:3,z:5,rotation:0}],mouseHoles:[{x:5,z:3,rotation:2},{x:1,z:5,rotation:1}],contents:[{model:r[10],pos:[.25,.125,.25],rot:3},{model:r[10],pos:[.25,1.125,.25],rot:3},{model:r[9],pos:[1.25,.125,.25],rot:3},{model:r[9],pos:[2.25,.125,.25],rot:3},{model:r[9],pos:[3.25,.125,.25],rot:3},{model:r[8],pos:[3.25,1.5,.25],rot:3}]},{origin:[18,0,9],size:[5,3,3],wallModel:4,doors:[{x:3,z:0,rotation:2}],mouseHoles:[{x:2,z:3,rotation:1},{x:0,z:1,rotation:0}],contents:[]},{origin:[18,0,12],size:[5,4,3],wallModel:0,doors:[{x:0,z:1,rotation:3}],mouseHoles:[{x:2,z:4,rotation:1},{x:2,z:0,rotation:3}],contents:[{model:r[3],pos:[3.5,.125,2],rot:1},{model:r[3],pos:[3.5,.125,1],rot:3},{model:r[2],pos:[.25,.125,2.5],rot:0}]}];function u(t,e,i,s,r){let a=e.origin[0],c=e.origin[1],d=e.origin[2],u=e.size[0],m=e.size[1],f=e.size[2],p=(t,e)=>(0|t)+(0|e)*s;for(let e=0;e<u;e++)for(let i=0;i<m;i++)o("10000000,20000000,30000000|0001000101120112011201121222122200010001011201120112011212221222|3,2,1",t,0,new THREE.Vector3(a+e,c+0,d+i)),o("00000012,00000002|0000000001111110011111100111111001111110011111100111111000000000|37,2",t,0,new THREE.Vector3(a+e,c+(f-1)+.2,d+i));let E=(t,i,s)=>{if(e.doors&&!(i>=2))return e.doors.find((e=>e.x===t&&e.z===s))},b=(t,i,s)=>{if(e.mouseHoles&&!(i>=1))return e.mouseHoles.find((e=>e.x===t&&e.z===s))};for(let s=0;s<u;s++)for(let r=0;r<f;r++)!E(s,r,m)&&!b(s,r,m)&&(o(h[e.wallModel],t,1,new THREE.Vector3(a+s,c+r+.125,d+m-1)),0===r&&(i[p(a+s,d+m-1)]|=1));for(let s=0;s<u;s++)for(let r=0;r<f;r++)!E(s,r,0)&&!b(s,r,0)&&(o(h[e.wallModel],t,3,new THREE.Vector3(a+s,c+r+.125,d+0)),0===r&&(i[p(a+s,d+0)]|=2));for(let s=0;s<m;s++)for(let r=0;r<f;r++)!E(0,r,s)&&!b(0,r,s)&&(o(h[e.wallModel],t,0,new THREE.Vector3(a+0,c+r+.125,d+s)),0===r&&(i[p(a+0,d+s)]|=4));for(let s=0;s<m;s++)for(let r=0;r<f;r++)!E(u,r,s)&&!b(u,r,s)&&(o(h[e.wallModel],t,2,new THREE.Vector3(a+u-1,c+r+.125,d+s)),0===r&&(i[p(a+u-1,d+s)]|=8));if(e.doors)for(let i of e.doors)o(n[1],t,i.rotation,new THREE.Vector3(a+(1===i.rotation?i.x-1:i.x),.125,d+(0===i.rotation?i.z-1:i.z))),o(n[0],t,i.rotation,new THREE.Vector3(a+(1===i.rotation?i.x-1:i.x),1.125,d+(0===i.rotation?i.z-1:i.z)));if(e.mouseHoles)for(let s of e.mouseHoles){let n=2===s.rotation?-1:0,c=1===s.rotation?-1:0,u=a+s.x+n,m=d+s.z+c;i[p(u,m)]|=16+(0===s.rotation?4:1===s.rotation?1:2===s.rotation?8:2),r.registerMouseHole({x:u,z:m,rotation:s.rotation,roomid:l.indexOf(e)}),o(h[e.wallModel+1],t,s.rotation,new THREE.Vector3(u,.125,m))}if(e.contents)for(let s of e.contents)s.pos[1]<1&&(i[p(a+s.pos[0],d+s.pos[2])]|=32),o(s.model,t,s.rot??0,new THREE.Vector3(a+s.pos[0],c+s.pos[1],d+s.pos[2]))}AFRAME.registerComponent("world",{init:function(){this.engine=new e({metersX:30,metersY:4,metersZ:30}),this.game=this.el.sceneEl?.systems.game;let t=new Uint8Array(900);for(let e of l){u(this.engine,e,t,30,this.game);let i=document.createElement("a-entity");i.setAttribute("mixin","l"),i.setAttribute("position",`${e.origin[0]+e.size[0]/2} 2.8 ${e.origin[2]+e.size[1]/2}`),i.setAttribute("visible","false"),this.game.addLamp(i),this.el.sceneEl?.appendChild(i)}let i=document.createElement("a-entity");i.setAttribute("bomb",""),i.setAttribute("position","21 0 6"),this.el.sceneEl.appendChild(i),t[201]|=96,this.game.setGrid(30,30,t);let s=this.engine.getMesh();this.el.setObject3D("mesh",s),this.game.worldMesh=this.el.object3D.children[0],this.game.bomb=i.components.bomb,s.position.set(0,-.125,0)}}),AFRAME.registerComponent("paw",{schema:{gun:{type:"boolean",default:!1}},init:function(){let t=new e({metersX:1,metersY:1,metersZ:2}),i=["11000000,11100000,00000000|0000000011111111111111111111111111111111111111110000000022222222|5","11000000,00000000,11100000,21100000|0000001123223201333222202333232033322220232232010000001111111111|5,31","00000000,00000100,11000200,00000200,00001410,11102120,00001110,00002120,00003333,00003113,11121113,00001113,00002113,00000500|012113100456676089abbc6d0456676d89abbc6d045667600121131000000000|3,4,1,12,33"];o(i[0],t,0,new THREE.Vector3(0,0,0)),o(i[1],t,0,new THREE.Vector3(0,0,1)),this.data.gun&&o(i[2],t,0,new THREE.Vector3(0,0,.5));let s=t.getMesh();this.el.setObject3D("mesh",s)}}),AFRAME.registerSystem("coroutine",{schema:{},init(){this.tt=new Map,this.it=0},tick:function(t,e){for(let[t,i]of this.tt.entries())i.update(e)||this.tt.delete(t)},addCoroutine(t){let e=this.it++;return this.tt.set(e,t),e},stopCoroutine(t){this.tt.delete(t)}});var f=class{generator;constructor(t){this.generator=t}update(t){return!this.generator.next(t).done}};function*c(t){let e=0;for(;e<t;)e+=(yield)/1e3}var d=new THREE.Vector3,m=new THREE.Vector3;AFRAME.registerComponent("mouse",{schema:{t:{type:"number",default:200},s:{type:"number",default:.02},ar:{type:"number",default:1},hm:{type:"number",default:1200},r:{type:"number",default:2}},init:function(){let t=new e({metersX:1,metersY:1,metersZ:1});o("00000000,22000000,20000000,03000000,03300000,13300000,03330000,03333000,00333000,13332300,03333300,03430000|000122200344432005666520066666000766670089a6a98006b6b60000030000|4,30,3,12",t);let i=t.getMesh(),s=i.geometry;s.computeBoundingBox();let r=s.boundingBox,n=(r.min.x+r.max.x)/2,a=(r.min.z+r.max.z)/2;s.translate(-n,-r.min.y,-a),this.el.setObject3D("mesh",i),this.st=this.el.object3D.position.clone(),this.et=this.el.sceneEl.systems.game,this.ot=this.el.sceneEl.systems.coroutine.addCoroutine(new f(this.ai())),this.el.sceneEl.addEventListener("gamestatechange",(t=>{let e=t.detail;(2===e.newState||3===e.newState)&&(this.el.sceneEl.systems.coroutine.stopCoroutine(this.ot),this.ht())}))},tick:function(t,e){if(this.nt){void 0===this.rt&&(this.rt=0),this.rt+=e/1e3*1.3;let t=THREE.MathUtils.lerp(this.nt[0],this.nt[2],this.rt),i=THREE.MathUtils.lerp(this.nt[1],this.nt[3],this.rt);this.el.setAttribute("position",{x:t,y:0,z:i});let s=Math.atan2(this.nt[2]-this.nt[0],this.nt[3]-this.nt[1]);this.el.setAttribute("rotation",{x:0,y:180*s/Math.PI-90,z:0}),this.rt>1&&(this.rt=void 0,this.nt=void 0)}},lt:function(){return d.set(this.el.object3D.position.x,.5,this.el.object3D.position.z),m.set(this.et.currentPlayerPos[0],.5,this.et.currentPlayerPos[1]),this.et.rayCast(d,m).distance>d.distanceTo(m)},ht:function(){this.et.removeMouse(this.el.object3D),this.el.setAttribute("self-destruct",{timer:1})},ai:function*(){let t=0,e=0;for(;;){let i=this.el.object3D.position;if(i.x<-1||i.x>this.et.grid.w||i.z<-1||i.z>this.et.grid.d)return void this.ht();if(2!==t){if(0===t&&this.lt()&&(t=1),1===t){let e=this.et.currentPlayerPos[0]-i.x,s=this.et.currentPlayerPos[1]-i.z,o=Math.sqrt(e*e+s*s);if(o<this.data.ar){this.et.bite(),t=2;continue}let r=e/o,n=s/o,a=Math.abs(r)<.5?0:r>0?1:-1,h=Math.abs(n)<.5?0:n>0?1:-1,l=~~(i.x+a),c=~~(i.z+h);if(this.et.isEmpty(l,c))for(this.nt=[i.x,i.z,l+.5,c+.5];this.nt;)yield;else this.nt=void 0,t=0}if(0===t){let t=Math.round(2*Math.random())-1,e=Math.round(2*Math.random())-1,s=~~(i.x+t),o=~~(i.z+e);for(0===t&&0===e||!this.et.isEmpty(s,o)?(this.nt=void 0,yield):this.nt=[i.x,i.z,s+.5,o+.5];this.nt;)yield}}else{let t=this.st.x-i.x,s=this.st.z-i.z,o=Math.sqrt(t*t+s*s);if(!(o>1.8))return void this.ht();{let r=t/o,n=s/o,a=Math.abs(r)<.5?0:r>0?1:-1,h=Math.abs(n)<.5?0:n>0?1:-1,l=~~(i.x+a),d=~~(i.z+h);if(this.et.isEmpty(l,d))for(e=0,this.nt=[i.x,i.z,l+.5,d+.5];this.nt;)yield;else{if(e++,e>10)return void this.ht();this.nt=void 0,yield*c(.2)}}}}}});var E=new THREE.Vector3,w=new THREE.Euler(0,0,0,"YXZ");function p(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}new THREE.Vector3,AFRAME.registerComponent("smooth-locomotion",{schema:{speed:{type:"number",default:.005},camera:{type:"selector",default:"#camera"},rig:{type:"selector",default:"#rig"}},init:function(){this.ut=new THREE.Vector3;let t=this.el.sceneEl?.systems.game;this.ft=t.grid,this.ct=t=>{let{axis:e}=t.detail,i=this.data.speed;this.ut.z=e[3]*i,this.ut.x=e[2]*i},this.el.sceneEl.addEventListener("gamestatechange",(t=>{let e=t.detail;(2===e.newState||3===e.newState)&&this.el.removeEventListener("axismove",this.ct)}))},play:function(){this.el.addEventListener("axismove",this.ct)},pause:function(){this.el.removeEventListener("axismove",this.ct)},tick:function(t,e){let i=this.data.camera.getAttribute("rotation"),s=this.data.rig.getAttribute("rotation");E.copy(this.ut).multiplyScalar(e),w.set((i.x+s.x)*Math.PI/180,(i.y+s.y)*Math.PI/180,0),E.applyEuler(w);let o=this.data.rig.object3D.position,r=this.ft,n=.2,a=(t,e)=>{let i=(t,e)=>{let i=0|t;i<0?i=0:i>=r.w&&(i=r.w-1);let s=0|e;return s<0?s=0:s>=r.d&&(s=r.d-1),r.occ[i+s*r.w]};return!!(32&(i(t-n,e)|i(t+n,e)|i(t,e-n)|i(t,e+n))||E.x>0&&8&i(t-n,e)||E.x<0&&4&i(t+n,e)||E.z>0&&1&i(t,e-n)||E.z<0&&2&i(t,e+n))},h=o.x+E.x,l=o.z+E.z;a(h,l)?a(h,o.z)?a(o.x,l)||(o.z=l):o.x=h:o.set(h,o.y,l),this.data.rig.object3D.position.copy(o)}}),AFRAME.registerComponent("snap-rotate",{schema:{player:{type:"selector",default:"#rig"},degrees:{type:"int",default:30}},init:function(){this.dt=!1,this.Et=new THREE.Vector3,this.wt=new THREE.Vector3,this.yt=new THREE.Vector3,this.ct=t=>{let e=t.detail?.axis;if(!e||e.length<3)return;let i=e[2];if(i>-.2&&i<.2)return void(this.dt=!1);if(Math.abs(i)<.8||!this.data.player)return;this.data.player.object3D.getWorldPosition(this.Et),i<-.8&&!this.dt&&(this.data.player.object3D.rotateY(this.data.degrees*Math.PI/180),this.dt=!0),i>.8&&!this.dt&&(this.data.player.object3D.rotateY(-this.data.degrees*Math.PI/180),this.dt=!0),this.data.player.object3D.getWorldPosition(this.wt),this.yt.subVectors(this.Et,this.wt);let s=this.data.player.object3D.parent;s&&s.worldToLocal(this.yt),this.data.player.object3D.position.add(this.yt)}},play:function(){this.el.addEventListener("axismove",this.ct)},pause:function(){this.el.removeEventListener("axismove",this.ct)}});var y=new function(){var t,e,i,s,o,r,n,a,h,l,c,d;this.Rt=new p,this.reset=function(){var t=this.Rt;s=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,d=5e-5*-t.o),a=1+t.l*t.l*(t.l>0?-.9:10),h=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this.Rt;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(u,m){var f=this.Rt,p=1!=f.s||f.v,E=f.v*f.v*.1,b=1+3e-4*f.w,y=f.s*f.s*f.s*.1,g=1+1e-4*f.t,w=1!=f.s,x=f.x*f.x,v=f.g,z=f.q||f.r,A=f.r*f.r*f.r*.2,R=f.q*f.q*(f.q<0?-1020:1020),M=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,H=f.d,T=f.j/2,C=f.k*f.k*.01,V=f.a,S=t,L=1/t,F=1/e,D=1/i,P=5/(1+f.u*f.u*20)*(.01+y);P>.8&&(P=.8),P=1-P;for(var j,k,B,O,Y,$,I=!1,U=0,X=0,G=0,_=0,W=0,q=0,Z=0,N=0,J=0,Q=0,K=Array(1024),tt=Array(32),et=K.length;et--;)K[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<m;et++){if(I)return et;if(M&&++J>=M&&(J=0,this.reset()),l&&++h>=l&&(l=0,s*=a),(s*=r+=n)>o&&(s=o,v>0&&(I=!0)),k=s,T>0&&(k*=1+Math.sin(Q+=C)*T),(k|=0)<8&&(k=8),V||((c+=d)<0?c=0:c>.5&&(c=.5)),++X>S)switch(X=0,++U){case 1:S=e;break;case 2:S=i}switch(U){case 0:G=X*L;break;case 1:G=1+2*(1-X*F)*H;break;case 2:G=1-X*D;break;case 3:G=0,I=!0}z&&((B=0|(R+=A))<0?B=-B:B>1023&&(B=1023)),p&&b&&((E*=b)<1e-5?E=1e-5:E>.1&&(E=.1)),$=0;for(var it=8;it--;){if(++Z>=k&&(Z%=k,3==V))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(V){case 0:Y=Z/k<c?.5:-.5;break;case 1:Y=1-Z/k*2;break;case 2:Y=.225*(((Y=1.27323954*(O=6.28318531*((O=Z/k)>.5?O-1:O))+.405284735*O*O*(O<0?1:-1))<0?-1:1)*Y*Y-Y)+Y;break;case 3:Y=tt[Math.abs(32*Z/k|0)]}p&&(j=q,(y*=g)<0?y=0:y>.1&&(y=.1),w?(W+=(Y-q)*y,W*=P):(q=Y,W=0),_+=(q+=W)-j,Y=_*=1-E),z&&(K[N%1024]=Y,Y+=K[(N-B+1024)%1024],N++),$+=Y}$*=.125*G*x,u[et]=$>=1?32767:$<=-1?-32768:32767*$|0}return m}},R=function(t){y.Rt.setSettings(t);var e=y.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),s=2*y.synthWave(new Uint16Array(i.buffer,44),e),o=new Uint32Array(i.buffer,0,44);o[0]=1179011410,o[1]=s+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44049,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=s,s+=44;for(var r=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="data:audio/wav;base64,";r<s;r+=3){var h=i[r]<<16|i[r+1]<<8|i[r+2];a+=n[h>>18]+n[h>>12&63]+n[h>>6&63]+n[63&h]}return a},v=[],H=[],x=null,M=0,b=[R([1,,.1272,,.3603,.6492,.2,-.2783,,,,,,.7756,-.6954,,,,1,,,.228,,1]),R([3,,.242,.5252,.272,.0531,,-.0104,,,,.444,.7092,,,,.09972,-.2081,1,,,,,1]),R([3,.09,.67,.35,.93,.2,,-.12,,,,-.3774,.62,,,,.1399,-.3,1,,,,,.5]),R([3,,.2043,.5884,.2696,.1493,,-.35,,,,,,,,,,,1,,,,,.5]),,,R([0,,.0343,,.2762,.533,,-.4588,,,,,,.2202,,,,,1,,,,,1]),R([0,,.1957,,.1236,.5185,,.1997,,,,,,.2281,,,,,.8683,,,,,.5])],T=function(t){x&&(v[M].src=b[t],v[M].play(),M=(M+1)%25)},z=new THREE.Vector3,g=new THREE.Vector3;AFRAME.registerComponent("shoot",{schema:{},init:function(){this.vt=this.el.sceneEl.systems.game;let t=document.createElement("a-light");t.setAttribute("type","point"),t.setAttribute("intensity",0),t.setAttribute("distance",10),t.setAttribute("color","cyan"),t.setAttribute("position","0.007 0.07 -.07"),this.el.appendChild(t);let e=document.createElement("a-box");e.setAttribute("position","0.007 0.07 -5.021"),e.setAttribute("depth","10"),e.setAttribute("height","0.007"),e.setAttribute("width","0.007"),e.setAttribute("material","color: cyan; shader: flat"),e.setAttribute("visible","false"),this.el.appendChild(e),this.Ht=i=>{if(0!==i.detail.id)return;T(0),this.el.object3D.getWorldPosition(z),z.y+=.07,this.el.object3D.getWorldDirection(g),g.multiplyScalar(-1);let s=this.vt.rayCastD(z,g);if(e.setAttribute("visible","true"),t.setAttribute("intensity",2),setTimeout((()=>{e.setAttribute("visible","false"),t.setAttribute("intensity",0)}),50),(s?.object).el.classList?.contains("m")){setTimeout((()=>{T(1)}),100);let t=document.createElement("a-entity");t.setAttribute("position",s.point),t.setAttribute("particles",{}),this.el.sceneEl.appendChild(t),(s?.object).el.components.mouse.ht()}else if(s){let t=document.createElement("a-box");t.setAttribute("position",s.point),t.setAttribute("scale",{x:.05,y:.05,z:.05}),t.setAttribute("color","black"),t.setAttribute("self-destruct",{timer:2500}),this.el.sceneEl.appendChild(t)}}},play:function(){this.el.addEventListener("buttondown",this.Ht)},pause:function(){this.el.removeEventListener("buttondown",this.Ht)}}),AFRAME.registerComponent("self-destruct",{schema:{timer:{default:5e3}},tick:function(t,e){this.data.timer-=e,this.data.timer<0&&this.el.remove()}}),AFRAME.registerComponent("head-offset",{schema:{height:{type:"number",default:.5},Camera:{type:"selector",default:"#camera"}},init:function(){this.xt=this.el.getAttribute("position"),this.Mt=0,this.bt=30,this.Tt=!1,this.el.sceneEl.addEventListener("enter-vr",(()=>{this.Mt=0,this.Tt=!0}))},tick:function(t,e){if(!this.Tt)return;let i=new THREE.Vector3;this.data.Camera.object3D.getWorldPosition(i);let s=i.y;if((this.Mt||0)<(this.bt||30)&&Math.abs(s)<.001)return void(this.Mt=(this.Mt||0)+1);let o=this.data.height-s,r=this.el.getAttribute("position")||{x:0,y:0,z:0},n=r.y+o;this.el.setAttribute("position",{x:r.x,y:n,z:r.z}),this.Tt=!1}});var A=(t,e)=>t+Math.random()*(e-t);AFRAME.registerComponent("particles",{schema:{},init:function(){let t=new THREE.Group,e=new THREE.BoxGeometry(.05,.05,.05),i=new THREE.MeshLambertMaterial({color:"red"});this.particles=[];for(let s=0;s<25;s++){let s=new THREE.Mesh(e,i);s.velocity=new THREE.Vector3(A(-.03,.03),A(.001,.05),A(-.03,.03)),s.acceleration=new THREE.Vector3(0,-.003,0),t.add(s),this.particles.push(s)}this.el.object3D.add(t),this.el.setAttribute("self-destruct",{timer:500})},tick:function(t,e){for(let t of this.particles)t.velocity&&t.acceleration&&(t.velocity.add(t.acceleration),t.position.add(t.velocity))}});var _=new THREE.Vector3;AFRAME.registerComponent("interact",{schema:{},init:function(){this.Ht=t=>{0===t.detail.id&&(this.el.object3D.getWorldPosition(_),this.el.sceneEl.emit("interact",{pos:_.clone()}))},this.zt=t=>{0===t.detail.id&&this.el.sceneEl.emit("interactEnd")}},play:function(){this.el.addEventListener("buttondown",this.Ht),this.el.addEventListener("buttonup",this.zt)},pause:function(){this.el.removeEventListener("buttondown",this.Ht),this.el.removeEventListener("buttonup",this.zt)}}),AFRAME.registerComponent("bomb",{schema:{},init:function(){let t=new e({metersX:1,metersY:1,metersZ:1});o("14410000,04410000,04010000,10010000,10410000,11110000,00000000,14010000,35353600,33333600,14410600,35353700,25252000,25252600,00000600|0120034567000005664000566689a056668ba5666cdedc666cc6cc6666666666|16,12,38,17,6,2,1",t,0,new THREE.Vector3),this.el.setObject3D("mesh",t.getMesh()),this.el.sceneEl.addEventListener("gamestatechange",(t=>{1===t.detail.newState?this.start():this.el.sceneEl.systems.coroutine.stopCoroutine(this.ot)}))},start:function(){this.ot=this.el.sceneEl.systems.coroutine.addCoroutine(new f(this.gt()))},gt:function*(){let t=this.el.sceneEl.systems.game;t.notify("Bomb activated!\nYou have 10 minutes to defuse it!"),yield*c(300),t.notify("5 minutes remaining!"),yield*c(120),t.notify("3 minutes remaining!"),yield*c(120),t.notify("1 minutes remaining!"),yield*c(30),t.notify("30 seconds remaining!"),yield*c(20),t.notify("10 seconds remaining!"),yield*c(10),t.boom()}});var F=new THREE.Vector3;AFRAME.registerSystem("game",{schema:{},init(){this.gameState=0,this.At=9,this._t=new Map,this.tt=new Map,this.Ft=[],this.kt=[],this.Ct=this.el.sceneEl.systems.coroutine,this.currentRoom=-1,this.text=this.el.sceneEl.querySelector("#t"),this.text.setAttribute("visible","false"),this.el.sceneEl.addEventListener("enter-vr",(()=>{(function(){(x=new AudioContext).listener.upY.value=1;let t=x.createGain();t.connect(x.destination);for(let e=0;e<25;e++){let e=new Audio;v.push(e);let i=x.createMediaElementSource(e),s=new PannerNode(x,{panningModel:"HRTF",distanceModel:"exponential"});i.connect(s),s.connect(t),H.push(s)}})(),this.el.sceneEl.querySelector("#title").setAttribute("visible","false"),this.changeGameState(1)})),this.el.sceneEl.addEventListener("interact",(t=>{let e=t.detail;if(64&this.grid.occ[(0|e.pos.x)+(0|e.pos.z)*this.grid.w]){if(this.el.sceneEl.querySelector("#win").setAttribute("visible","true"),this.bomb){this.bomb.el.setAttribute("visible","false"),this.changeGameState(3),this.tt.forEach((t=>{this.Ct.stopCoroutine(t)}));let t=document.getElementsByClassName("m");for(let e=0;e<t.length;e++)t[e].remove()}}else this.blockMouseHole(e.pos.x,e.pos.z)})),this.el.sceneEl.addEventListener("interactEnd",(t=>{}))},notify(t){this.notifyCRID&&this.Ct.stopCoroutine(this.notifyCRID),this.notifyCRID=this.Ct.addCoroutine(new f(this.notifyCR(t)))},bite(){this.At--,this.At<=0?this.gameOver():(T(6),this.notify(`Ouch! You have ${this.At} lives left.`))},notifyCR:function*(t){this.text.setAttribute("text","value",t),this.text.setAttribute("visible","true"),yield*c(3),this.text.setAttribute("visible","false")},updateLamps(){for(let t=0;t<this.kt.length;t++)t===this.currentRoom||a[this.currentRoom]?.includes(t)?this.kt[t].setAttribute("visible","true"):this.kt[t].setAttribute("visible","false")},tick:function(t,e){if(1!==this.gameState)return;this.currentPlayerPos=this.$t();let[i,s]=this.currentPlayerPos;i|=0,s|=0,l.forEach(((t,e)=>{i>=t.origin[0]&&i<t.origin[0]+t.size[0]&&s>=t.origin[2]&&s<t.origin[2]+t.size[1]&&this.currentRoom!==e&&(this.currentRoom=e,this.updateLamps(),this._t.forEach((t=>{if(t.roomid===e)t.active||(t.active=this.Yt(t));else{t.active=!1;let e=`${t.x},${t.z}`;this.Ct.stopCoroutine(this.tt.get(e)),this.tt.delete(e)}})))}))},isEmpty(t,e){let i=this.grid;return t>=0&&e>=0&&t<i.w&&e<i.d&&0===i.occ[e*i.w+t]},addLamp(t){1==this.kt.push(t)&&this.kt[0].setAttribute("visible","true")},rayCastD(t,e){let i=new THREE.Raycaster(t,e,.25,25).intersectObjects([this.worldMesh,...this.Ft],!0);return i.length>0?i[0]:null},rayCast(t,e){let i=e.clone().sub(t).normalize();return this.rayCastD(t,i)},changeGameState(t){this.gameState=t,this.el.sceneEl.emit("gamestatechange",{newState:t})},boom(){this.gameOver()},gameOver(){this.changeGameState(2),T(2),this.el.sceneEl.querySelector("#go").setAttribute("visible","true"),this.tt.forEach((t=>{this.Ct.stopCoroutine(t)}));let t=document.getElementsByClassName("m");for(let e=0;e<t.length;e++)t[e].remove()},setGrid(t,e,i){this.grid={w:t,d:e,occ:i}},registerMouseHole(t){let e=`${t.x},${t.z}`;this._t.set(e,t)},blockMouseHole(t,i){let s=`${t|=0},${i|=0}`,r=this._t.get(s);if(r){T(3);let t=document.createElement("a-entity"),i=new e({metersX:1,metersY:1,metersZ:1});o("00000000,01200000,01300000,02110000,00210000,00110000,00121000,00011000,00013000|0000000000000000123456780000000000000000000000000000000000000000|9,10,40",i,r.rotation,new THREE.Vector3),t.setObject3D("mesh",i.getMesh()),t.setAttribute("position",`${r.x} 0 ${r.z}`),t.classList.add("b"),this.el.sceneEl?.appendChild(t),this.Ct.stopCoroutine(this.tt.get(s)),this._t.delete(s)}},playerPos(){return this.currentPlayerPos},$t:function(){return this.el.sceneEl.camera.getWorldPosition(F),[F.x,F.z]},Yt(t){let e=this.Ct.addCoroutine(new f(this.Xt(t)));return this.tt.set(`${t.x},${t.z}`,e),!0},removeMouse(t){let e=this.Ft.indexOf(t);-1!==e&&this.Ft.splice(e,1)},Xt:function*(t){for(yield*c(2*Math.random());;){T(7);let e=document.createElement("a-entity");e.setAttribute("mixin","ms"),e.classList.add("r","m"),e.setAttribute("position",{x:t.x+.5,y:0,z:t.z+.5}),this.el.sceneEl?.appendChild(e),this.Ft.push(e.object3D),yield*c(t.spawnRate||5)}}})</script><body><a-scene><a-assets><a-mixin id=ms shadow="receive: true" mouse scale="0.4 0.4 0.4"></a-mixin><a-mixin id=l light="angle: 75;intensity:2; color: #FED; type: spot; castShadow: true; shadowCameraFar: 25" rotation="-90 0 0"></a-mixin></a-assets><a-sky color=#000></a-sky><a-entity><a-entity light="color: #223; type: ambient"></a-entity><a-entity class=r shadow="receive: true" world></a-entity><a-entity id=rig head-offset position="5 0 10"><a-entity id=camera wasd-controls look-controls camera position="0 1.7 0"><a-entity id=title text="value: COD: Black CAT; align: center; color: #FFF" position="0 0 -.5" scale="2 2 2" visible=true></a-entity><a-entity id=t text="value: ...; align: center; color: #268" position="0 -.1 -.5"></a-entity><a-entity id=go text="value: GAME OVER; align: center; color: #F44" scale="1.5 1.5 1.5" position="0 -.1 -.5" visible=false></a-entity><a-entity id=win text="value: YOU WIN; align: center; color: #FF4" position="0 -.1 -.5" scale="2 2 2" visible=false></a-entity></a-entity><a-entity interact smooth-locomotion oculus-touch-controls=hand:left;model:false><a-entity paw="" scale="0.1 0.1 0.1" rotation="0 180 0" position="0.05 0 0.1"></a-entity></a-entity><a-entity shoot snap-rotate oculus-touch-controls=hand:right;model:false><a-entity paw=gun:true scale="0.1 0.1 0.1" rotation="0 180 0" position="0.05 0 0.1"></a-entity></a-entity></a-entity></a-scene>