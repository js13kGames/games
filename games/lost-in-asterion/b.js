!function t(i,e,n){function r(h,o){if(!e[h]){if(!i[h]){var u="function"==typeof require&&require;if(!o&&u)return u(h,!0);if(s)return s(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var a=e[h]={exports:{}};i[h][0].call(a.exports,function(t){var e=i[h][1][t];return r(e||t)},a,a.exports,t,i,e,n)}return e[h].exports}for(var s="function"==typeof require&&require,h=0;h<n.length;h++)r(n[h]);return r}({1:[function(t,i,e){function n(t,i,e,n,r){this.x=t,this.y=i,this.s=e,this.dx=0,this.dy=0,this.mx=0,this.my=0,this.flipped=!1,this.t=n,this.w=4*e,this.h=4*e;let s=h[n];this.sight=s[0]*(1+r/10),this.spda=s[1]*(1+r/10),this.spdb=s[2]*(1+r/10),this.life=s[3]*(1+r/10)}const r=t(5)(),s=t(3),h={a:[400,100,100,10],b:[400,150,70,10],c:[600,70,150,20],d:[400,100,100,40],e:[400,150,150,10],f:[600,50,200,15],h:[900,150,150,30],i:[900,100,200,1e3]};n.prototype={act:function(){let t=this._();if(t){let i=t.x-this.x,e=t.y-this.y;this.dx=Math.sign(i)*r.range(this.spda-20,this.spda+20),this.dy=Math.sign(e)*r.range(this.spdb-20,this.spdb+20),this.flipped=i<0}else this.dy-=r.range(50,120),this.dx=r.range(-50,50);setTimeout(this.act.bind(this),r.range(100,500))},_:function(){return!(!this.world.player||s.d(this.world.player.x,this.world.player.y,this.x,this.y)>this.sight)&&this.world.player},takeDamage:function(){--this.life<=0&&this.U(),this.takingDamage=!0,setTimeout(()=>this.takingDamage=!1,50)},U:function(){if(this.dead=!0,this.bo){for(var t=0;t<40;t++)this.world.bubblePuff(this.x+r.range(-150,150),this.y+r.range(-150,150),50);this.world.won()}let i=this.world.player;i.orbs[1]&&i.hull<100&&i.hull++,this.world.bubblePuff(this.x,this.y,50)}},i.exports=n},{3:3,5:5}],2:[function(t,i,e){function n(t,i,e){for(let n=0;n<i;n++)t.forEach(t=>r(t,e))}function r(t,i){i.forEach(i=>{if(void 0===t.chance||F.chance(t.chance))if(i.type==t.type){var e=s(i);if(">"===t.op){if(e>t.q)return void(i.nextType=t.nType)}else if("<"===t.op&&e<t.q)return void(i.nextType=t.nType);i.nextType=i.type}else i.nextType=i.type;else i.nextType=i.type}),i.forEach(t=>t.type=t.nextType)}function s(t){return t.sur.reduce((t,i)=>1===i.type?t+1:t,0)}function h(t,i){null!==t&&t.voronoiId!==i.voronoiId&&(i.sur.find(function(i){return i.voronoiId===t.voronoiId})||i.sur.push(t))}function o(t,i){t.cells.forEach(function(t){var e=t.site;e.vs=[],i&&(e.sur=[]),t.halfedges.forEach(function(t){e.vs.push([t.getStartpoint().x,t.getStartpoint().y]),i&&(h(t.edge.lSite,e),h(t.edge.rSite,e))})})}function u(t,i,e,n){e*=b,n*=b;var r=g[t];let s=0,h=r.substr(s,2);for(var o=[];""!=h;){var t=parseInt(h,16);o.push([1&t,2&t,4&t,8&t,16&t,32&t,64&t,128&t]),s++,h=r.substr(2*s,2)}o.forEach((t,r)=>f(t,r,i,e,n))}function f(t,i,e,n,r){let s=i%3*8*y,h=Math.floor(i/3)*p;t.forEach((t,i)=>{t&&e.push({x:n+s+i*y,y:r+h,vs:[[n+s+i*y,r+h],[n+s+(i+1)*y,r+h],[n+s+(i+1)*y,r+h+p],[n+s+i*y,r+h+p]]})})}function a(t,i){let e,n=!!x[i]&&x[i][t];n?e=k[n.charAt(0)]:(e=k.C,n="");let r={u:n.indexOf("u"),d:n.indexOf("d"),l:n.indexOf("l"),r:n.indexOf("r"),c:n.indexOf("c")};for(let t in r)r[t]=-1!=r[t]&&C[n.charAt(r[t]+1)];let s=e.orb?e.orb:!!/([0-9])/g.exec(n)&&{type:/([0-9])/g.exec(n)[0],x:(t+.5)*b,y:(i+.5)*b};return Object.assign({},e,{stories:r,u:-1!=n.indexOf("u"),d:-1!=n.indexOf("d"),l:-1!=n.indexOf("l"),r:-1!=n.indexOf("r"),orb:s,bo:-1!=n.indexOf("*")})}var c=t(3),l=t(5),v=t(8),F=l(),d=new v,b=3e3,y=b/24,p=b/18,w={T:[{type:0,op:">",q:1,nType:1,chance:60},{type:1,op:"<",q:1,nType:0,chance:90}],O:[{type:0,op:">",q:1,nType:1,chance:30},{type:1,op:"<",q:2,nType:0,chance:90}]},g=["FFFFFF03F8E101C0C001D8C001D8C0031CC07FFFC041FFE151C3FF5380FFDF8383D90F80DB83830B80DFE3C3DFF9FFDFFF0FC0FFEFFF","FFEFFF398FC1018781011C800185C1458DEFFFFDEFFF8187FFE184000084000080FF0184FF0184FF01ECFF03EEFFFF87FF0780FF87FF","FFFFFFE1FF8FE1FF8FE11F8061308C7B708F40518DC05BFD00000000000040E7FB40C3C177C3C121E6C121C2EFE1C3C1E1E7C1FFFFFF","FFC1FFFFE383E1F783E1F783E1F783F9F7EBE1F701E18001030000030000E18001E1F701E1FFABFBFF81E1FAAB01C0FF63F5FFFFFFFF"],x=[["FdrcF3","Fdl","Cdr","ClcE1","CdCr","GlBcOr","ClPcA"],["Fur","Fuld","Cur","Odlr","OudlR","Td"],["","PuJr","Rlr","OudKlHr","OulrI","QudQl"],["OcMr*","SlcLr","ClNr","Dul","VrcG4","Vul"]],E=["4422000","442112","033112","666055"],M="The Orb of ",C={A:["*You wake up in an underwater cavern","*Where are you? You got to find a way out","*Use the arrows, Z to drill"],P:["*You hear a sweet voice in your head","I know you can hear me","I am princess Melkaia of Asterion"],O:["This is the gate of Atlantis, a passage to the surface","It can be opened by using the orbs"],B:["I can help you find the orbs, but I need your help","I'm trapped in these cold depths!"],C:["The orbs will give you powers to survive","One is at the Temple of Poseidon","Dive deeper and travel east"],R:"A orb was hidden on a cave to the west",D:M+"Verra Kera",E:M+"Gabrielle",F:M+"Cosiaca",G:M+"Athena",H:"The ruins of our great underwater city",I:"Our great temple to Poseidon, the lord of the seas",J:"These used to be the very fertile farmlands",K:"The abyss, cursed with eternal darkness",Q:["The rift, a place full of energy","The power of Cosiaca will let you in"],N:"A strong current blocks the entrance here",L:"I can feel you are close... I'm so eager to meet you!",M:["Thank you for bringing the orbs... YOU FOOL!","I shall use them to drown your world in darkness!"]},k={F:{cv:!0,c:["#3B5323","#526F35","#636F57"],open:20,ca:0,rules:[],ec:"adf"},C:{cv:!0,open:50,ca:1,rules:w.T,ec:"bce"},G:{cv:!0,open:30,ca:2,rules:w.O,gate:!0,ec:"bcd"},O:{cv:!0,open:20,ca:2,rules:[],ec:"cd"},T:{s:0,bg:"#1c0030",orb:{type:2,x:5*b+20*y,y:b+6*p,s:"D"},ec:"bdf"},Q:{s:1,bg:"#1c0030",ec:"bdf"},R:{s:2,bg:"#001c33",ec:"cf"},P:{s:3,bg:"#001c33",ec:"cf"},D:{cv:!0,c:["#000"],open:70,ca:1,rules:w.O,ec:"aeh"},S:{cv:!0,open:80,ca:1,rules:w.T,cu:!0,ec:"beh"},V:{cv:!0,c:["#fdcf58","#f27d0c","#800909","#f07f13"],open:70,ca:1,rules:w.O,bu:!0,ec:"bcf"}};i.exports={g:function(t,i,e){let r=b,s=b,h=t*r,f=i*s;var l={xl:h,xr:h+r,yt:f,yb:f+s},v=a(t,i),y=v.c||["#001c33","#002a4d","#0e3f66"],p=[];for(let t=0;t<1e3;t++)p.push({x:F.range(l.xl+20,l.xr-20),y:F.range(l.yt+20,l.yb-20)});let w=d.compute(p,l);o(w,!0);let g=[];w.cells.forEach(t=>g.push(t.site)),g.forEach(t=>{v.cv?(F.range(0,100)<v.open?t.type=1:t.type=0,(Math.abs(t.x-h)<100||Math.abs(t.x-(h+r))<100||Math.abs(t.y-f)<100||Math.abs(t.y-(f+s))<100)&&(t.type=4)):t.type=0,c.d(t.x,t.y,h+r/2,f+s/2)<300&&(t.type=3),v.u&&t.y<f+s/2&&Math.abs(t.x-(h+r/2))<150&&(t.type=3),v.d&&t.y>f+s/2&&Math.abs(t.x-(h+r/2))<150&&(t.type=3),v.l&&t.x<h+r/2&&Math.abs(t.y-(f+s/2))<150&&(t.type=3),v.r&&t.x>h+r/2&&Math.abs(t.y-(f+s/2))<150&&(t.type=3)}),n(v.rules,v.ca+1,g),g=g.filter(t=>1===t.type||4===t.type);var x=[];if(v.cv){for(var M=[],k=0;k<1450;k++)M.push({x:F.range(l.xl,l.xr),y:F.range(l.yt,l.yb)});o(w=d.compute(M,l),!1),w.cells.forEach(t=>{t.site.type=F.range(0,y.length),x.push(t.site)}),x.forEach(t=>t.color=y[t.type])}void 0!=v.s&&u(v.s,g,t,i);let m=!1;var T=[];return v.orb&&!e.orbs[v.orb.type]&&(m={type:v.orb.type,x:v.orb.x,y:v.orb.y},v.orb.s&&T.push({x:m.x,y:m.y,t:C[v.orb.s]})),v.stories&&(v.stories.u&&T.push({x:h+r/2,y:f,t:v.stories.u}),v.stories.d&&T.push({x:h+r/2,y:f+s,t:v.stories.d}),v.stories.l&&T.push({x:h,y:f+s/2,t:v.stories.l}),v.stories.r&&T.push({x:h+r,y:f+s/2,t:v.stories.r}),v.stories.c&&T.push({x:h+r/2,y:f+s/2,t:v.stories.c})),{x:h,y:f,gate:!!v.gate&&{x:h+r/2,y:f+s/2},orb:m,stones:g,bgStones:x,stories:T,bg:v.bg,bu:v.bu,cu:v.cu,bo:v.bo,lv:E[i]&&""!=E[i].charAt(t)?parseInt(E[i].charAt(t)):0,ec:v.ec}}}},{3:3,5:5,8:8}],3:[function(t,i,e){function n(t,i,e,n,r,s,h,o){var u,f,a;return 0!==(u=(e-t)*(o-s)-(h-r)*(n-i))&&(a=((o-s)*(h-t)+(r-h)*(o-i))/u,f=((i-n)*(h-t)+(e-t)*(o-i))/u,0<a&&a<1&&0<f&&f<1)}i.exports={p:function(t,i){for(var e=0,r=i.length-1;e<i.length;r=e++){var s=i[e][0],h=i[e][1],o=i[r][0],u=i[r][1];if(n(t.a.x,t.a.y,t.b.x,t.b.y,s,h,o,u))return!0}return!1},d:function(t,i,e,n){return Math.abs(t-e)+Math.abs(i-n)}}},{}],4:[function(t,i,e){function n(){this.setSettings=function(t){for(var i=0;24>i;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(.18>e){var n=.18/e;this.b*=n,this.c*=n,this.e*=n}}}function r(t){return window.requestAnimationFrame(function(){var i=Date.now(),e=i-l;e>999?e=1/60:e/=1e3,l=i,t(e)})}function s(t){b[t.which]&&b[t.which]()}function h(t){return d[t]}function o(t,i){b[t]=i}function u(t,i){if(void 0===i&&(i=5),0!==i){for(var e=g[t](),n=0;n<1;n++)F.bubbles.push({x:y.range(e.x-5,e.x+5),y:y.range(e.y-5,e.y+5),dx:y.range(e.dx-5,e.dx+5),dy:y.range(-200,0),life:y.range(15,100)});setTimeout(function(){u(t,i-1)},100)}}function f(){v.t||(h(38)?(p.play(0),w.dy-=10,w.dy<-120&&(w.dy=-120),u("left"),u("right")):h(40)&&(p.play(0),w.dy<60&&(w.dy+=10),u("top")),h(37)?(p.play(0),w.flipped=!0,w.dx>-120&&(w.dx-=15),w.dy-=5,u("right")):h(39)&&(p.play(0),w.flipped=!1,w.dx<120&&(w.dx+=15),w.dy-=5,u("left")))}function a(){p.play(1),setTimeout(a,1e4)}var c=new function(){this.a=new n;var t,i,e,r,s,h,o,u,f,a,c,l;this.reset=function(){var t=this.a;r=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),h=1-t.h*t.h*t.h*.01,o=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,l=5e-5*-t.o),u=1+t.l*t.l*(t.l>0?-.9:10),f=0,a=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var n=this.a;return t=n.b*n.b*1e5,i=n.c*n.c*1e5,e=n.e*n.e*1e5+12,3*((t+i+e)/3|0)},this.synthWave=function(n,v){var F=this.a,d=1024,b=1!=F.s||F.v,y=F.v*F.v*.1,p=1+3e-4*F.w,w=F.s*F.s*F.s*.1,g=1+1e-4*F.t,x=1!=F.s,E=F.x*F.x,M=F.g,C=F.q||F.r,k=F.r*F.r*F.r*.2,m=F.q*F.q*(F.q<0?-1020:1020),T=F.p?32+((1-F.p)*(1-F.p)*2e4|0):0,_=F.d,D=F.j/2,B=F.k*F.k*.01,O=F.a,A=t,I=1/t,S=1/i,q=1/e,P=5/(1+F.u*F.u*20)*(.01+w);P>.8&&(P=.8),P=1-P;var L,R,N,U,Y,G,V,j=!1,H=0,Q=0,W=0,K=0,J=0,Z=0,z=0,X=0,$=0,tt=0,it=new Array(d),et=new Array(32);for(V=it.length;V--;)it[V]=0;for(V=et.length;V--;)et[V]=2*Math.random()-1;for(V=0;v>V;V++){if(j)return V;if(T&&++$>=T&&($=0,this.reset()),a&&++f>=a&&(a=0,r*=u),h+=o,(r*=h)>s&&(r=s,M>0&&(j=!0)),R=r,D>0&&(tt+=B,R*=1+Math.sin(tt)*D),8>(R|=0)&&(R=8),O||(0>(c+=l)?c=0:c>.5&&(c=.5)),++Q>A)switch(Q=0,++H){case 1:A=i;break;case 2:A=e}switch(H){case 0:W=Q*I;break;case 1:W=1+2*(1-Q*S)*_;break;case 2:W=1-Q*q;break;case 3:W=0,j=!0}C&&(m+=k,0>(N=0|m)?N=-N:N>d-1&&(N=d-1)),b&&p&&(1e-5>(y*=p)?y=1e-5:y>.1&&(y=.1)),G=0;for(var nt=8;nt--;){if(++z>=R&&(z%=R,3==O))for(var rt=et.length;rt--;)et[rt]=2*Math.random()-1;switch(O){case 0:Y=c>z/R?.5:-.5;break;case 1:Y=1-z/R*2;break;case 2:Y=.225*((0>(Y=1.27323954*(U=6.28318531*((U=z/R)>.5?U-1:U))+.405284735*U*U*(0>U?1:-1))?-1:1)*Y*Y-Y)+Y;break;case 3:Y=et[Math.abs(32*z/R|0)]}b&&(L=Z,0>(w*=g)?w=0:w>.1&&(w=.1),x?(J+=(Y-Z)*w,J*=P):(Z=Y,J=0),Z+=J,K+=Z-L,K*=1-y,Y=K),C&&(it[X%d]=Y,Y+=it[(X-N+d)%d],X++),G+=Y}G*=.125*W*E,n[V]=G>=1?32767:-1>=G?-32768:32767*G|0}return v}};window.jsfxr=function(t){c.a.setSettings(t);var i=c.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),n=2*c.synthWave(new Uint16Array(e.buffer,44),i),r=new Uint32Array(e.buffer,0,44);r[0]=1179011410,r[1]=n+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=n,n+=44;for(var s=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";n>s;s+=3){var u=e[s]<<16|e[s+1]<<8|e[s+2];o+=h[u>>18]+h[u>>12&63]+h[u>>6&63]+h[63&u]}return o};var l=0,v=t(7),F=t(9),d={},b={},v=t(7),y=t(5)(),p=t(6);window.onkeydown=(t=>d[t.which]=!0),window.onkeyup=(t=>d[t.which]=!1),window.addEventListener("keypress",s);let w=!1;o(122,function(){p.play(0),F.sonicBoom(w.flipped?-1:1)}),o(13,()=>{v.t&&(v.t=!1,setTimeout(()=>w.lt=!0,1e4))});var g={left:function(){return{x:w.x-11,y:w.y+16+8,dx:-3}},right:function(){return{x:w.x+24+3,y:w.y+16+8,dx:3}},top:function(){return{x:w.x+8,y:w.y+8,dx:0}}};a(),v.init(F),function(t){w=t.player}(F),F.start(),function(t){r(function i(e){t(e),r(i)})}(function(t){t>1||(f(),F.update(t),v.draw())})},{5:5,6:6,7:7,9:9}],5:[function(t,i,e){i.exports=function(t){function i(){return Math.random()}var e={int:function(t){return i()*(t||268435455)|0},bool:function(){return i()>.5},range:function(t,i){return e.int(i-t)+t},sign:function(){return e.bool()?1:-1},chance:function(t){return e.range(0,100)<=t},pick:function(t){return t[e.range(0,t.length)]},pickS:function(t){return t.charAt(e.range(0,t.length))}};return e}},{}],6:[function(t,i,e){let n=[[3,.48,.2,.68,.7694,.0148,,.9602,,.2499,,-.0549,-.0738,.096,.0641,.4837,.6,-.0364,.254,-.2507,.3391,.575,-.5669,.57],[2,.0291,.0583,.2147,.8409,.35,.0635,.0459,-.0634,,.0155,.2254,.683,.8177,-.0768,.3105,.2867,-.2637,.5362,.0717,,.2806,-.1257,.5],[3,.0351,.6046,.3476,.2765,.5924,,-.0441,-.7271,,,-.1849,,.8845,.0752,.2964,-.0093,.8966,.5593,-.4031,,.0586,-.0038,.15]];n=n.map(t=>jsfxr(t)).map(t=>[...Array(10).keys()].map(()=>new Audio(t)));let r={},s=[0,0,0];i.exports={play:function(t){if(!r[t]){r[t]=!0;var i=n[t][s[t]++];10==s[t]&&(s[t]=0),i.play(),setTimeout(()=>r[t]=!1,300)}}}},{}],7:[function(t,i,e){function n(t){return t-g.x+400}function r(t){return t-g.y+300}function s(t,i){p.moveTo(n(t),r(i))}function h(t,i){p.lineTo(n(t),r(i))}function o(t,i,e,s){p.fillRect(n(t),r(i),e,s)}function u(t,i,e,s,h){s=s||0,h=h||2*Math.PI,p.beginPath(),p.arc(n(t),r(i),e,s,h),p.fill()}function f(t,i,e,s,h){s=s||0,h=h||2*Math.PI,p.beginPath(),p.arc(n(t),r(i),e,s,h),p.stroke()}function a(t,i){i.forEach(i=>{u(t.x+i[0]*t.s,t.y+i[1]*t.s,t.s*i[2],Math.PI*(i[3]||0),Math.PI*(i[4]||2))})}function c(t,i){p.beginPath(),i.forEach(i=>{s(t.x+t.s*i[0],t.y+t.s*i[1]);for(var e=2;e<i.length;e+=2)h(t.x+t.s*i[e],t.y+t.s*i[e+1]);p.stroke()})}function l(t,i){i.forEach(i=>{p.beginPath(),s(t.x+t.s*i[0],t.y+t.s*i[1]);for(var e=2;e<i.length;e+=2)h(t.x+t.s*i[e],t.y+t.s*i[e+1]);p.closePath(),p.fill()})}function v(){g.lt&&(p.fillStyle="rgba(255,255,255,0.5)",p.beginPath(),g.flipped?(s(g.x,g.y-3),h(g.x-500,g.y-200),h(g.x-500,g.y+200)):(s(g.x+15,g.y-3),h(g.x+500,g.y-200),h(g.x+500,g.y+200)),p.closePath(),p.fill()),p.fillStyle=g.takingDamage?"#444":"#000",u(g.x+g.w/2,g.y+g.w/2,g.w),g.flipped?o(g.x-8,g.y-7,14,16):o(g.x+8,g.y-7,14,16)}function F(t){b.d(t.x,t.y,g.x,g.y)>1e3||(p.fillStyle=t.takingDamage?"#444":"#000",p.strokeStyle=p.fillStyle,V[t.t](t))}function d(){if(N)p.font=U?"italic 28px serif":"24px sans-serif",p.fillText(N,400,550);else if(R.length>0){let t=R.shift();U="*"!==t.charAt(0),N=U?t:t.substr(1),setTimeout(()=>N=!1,g.won?8e3:5e3)}}var b=t(3),y=t(5)(),p=document.querySelector("canvas").getContext("2d");p.textAlign="center";let w,g;var x=[[1.8,1.7,1.25,1,1.75,0],[1.8,2,1,1.8],[1.8,2.3,1,2.8],[1.8,2.9,1.5,3.5,1.8,4],[2.2,1.7,2.75,1,2.75,0],[2.2,2,3,1.8],[2.2,2.3,3,2.8],[2.2,2.9,2.5,3.5,2.2,4]],E=[[2,2,2],[2,4,2,1,2]],M=[[1,2,2],[3,2,2],[2,1,2][2]],C=[[2,2,2,1],[3,2,1]],k=[[2,2,2,1],[1,2,1]],m=[[2,2,2],[3,2,3,.25,1]],T=[[2,2,2],[1,2,3,0,.75]],_=[[2,2,2,0,1.25],[2,3,2,1.5]],D=[[2,2,2,-.25,1],[2,3,2,1,1.5]],B=[[2,2,2,1],[3,2,1],[3,2,3,.5,1.5]],O=[[2,2,2,1],[1,2,1],[1,2,3,-.5,.5]],A=[[1,4,1,6],[2,4,2,7],[3,4,3,6]],I=[[2,2,2,.7,1.9]],S=[[4.5,-.5,1]],q=[[4.5,-.5,.5]],P=[[3,1,.3]],L=[[1,3.5,4,3.5,4,2.2,3.6,3,1,3],[3.8,1,3.8,2.5,2.5,1],[1,1.5,-1,1.5,0,2,-1,2.5,1,2.5]],R=[],N=!1,U=!1;i.exports={init:function(t){g=(w=t).player,this.t=!0},draw:function(){if(g.dead)return p.fillStyle="#000",p.fillRect(0,0,800,600),p.font="italic 28px serif",p.fillStyle="white",void p.fillText("You are forever lost.",400,550);if(g.won)return p.fillStyle="#FFF",p.fillRect(0,0,800,600),p.fillStyle="#000",void d();for(var t in w.sectors)(t=w.sectors[t]).bg&&(p.fillStyle=t.bg,p.strokeStyle=t.bg,o(t.x,t.y,3e3,3e3)),t.bgStones.forEach(function(t){if(!(b.d(t.x,t.y,g.x,g.y)>1e3)){p.fillStyle=t.color,p.strokeStyle=t.color,p.beginPath(),s(t.vs[0][0],t.vs[0][1]);for(var i=1;i<t.vs.length;i++)h(t.vs[i][0],t.vs[i][1]);p.closePath(),p.fill(),p.stroke()}}),t.orb&&(p.fillStyle="rgba("+G[t.orb.type-1]+",0.5)",u(t.orb.x+10,t.orb.y+10,40),p.fillStyle="rgb("+G[t.orb.type-1]+")",u(t.orb.x+10,t.orb.y+10,5)),t.gate&&(p.fillStyle="#000",u(t.gate.x,t.gate.y,50),o(t.gate.x-70,t.gate.y-15,140,30),o(t.gate.x-15,t.gate.y-70,30,140));p.strokeStyle="#ccc",w.bubbles.forEach(function(t){f(t.x,t.y,2)}),p.strokeStyle="#fcc",w.booms.forEach(function(t){f(t.x,t.y,t.s+y.range(0,5))}),v(),w.entities.forEach(t=>F(t));for(t in w.sectors)(t=w.sectors[t]).stones.forEach(function(t){if(!(b.d(t.x,t.y,g.x,g.y)>1e3)){p.fillStyle="#000",p.strokeStyle="#000",p.beginPath(),s(t.vs[0][0],t.vs[0][1]);for(var i=1;i<t.vs.length;i++)h(t.vs[i][0],t.vs[i][1]);p.closePath(),p.fill(),p.stroke()}});if(!this.t){p.font="bold 20px sans-serif",p.fillStyle="white",p.fillText(g.hull+"%",700,40);for(let t in g.orbs)g.orbs[t]&&(p.fillStyle="rgb("+G[t-1]+")",p.beginPath(),p.arc(30*t,40,10,0,2*Math.PI),p.fill())}p.fillStyle="white",this.t?(p.font="italic 36px serif",p.fillText("Lost in Asterion",400,100),p.font="italic 24px serif",p.fillText("A js13k game by Santiago Zapata",400,150),p.fillText("Press Enter",400,450)):d()},showText:function(t){R.push(t)},won:function(){Y.forEach(t=>R.push(t))}};var Y=["You make the journey back to the Gate of Atlantis.","You wake up in the middle of the Ocean.","The SOS beacon is activated, you'll be rescued soon.","Noone will believe you...","but you'll never forget you were almost Lost."],G=["99,99,0","99,0,0","0,99,0","0,0,99"],V={i:t=>{a(t,t.flipped?B:O),p.fillStyle="#00F",u(t.x+(t.flipped?1:3)*t.s,t.y+3*t.s,t.s/2)},a:t=>a(t,M),b:t=>a(t,t.flipped?k:C),c:t=>a(t,t.flipped?m:T),d:t=>a(t,t.flipped?_:D),e:t=>{o(t.x+1.8*t.s,t.y+t.s,.4*t.s,2*t.s),c(t,x)},f:t=>{a(t,E),c(t,A)},h:t=>{p.fillStyle="rgba(255,255,255,0.5)",a(t,S),p.fillStyle="#000",a(t,I),l(t,L),f(t.x+3.5*t.s,t.y,1.5*t.s,1*Math.PI,1.75*Math.PI),a(t,q),p.fillStyle="#F00",a(t,P)}}},{3:3,5:5}],8:[function(t,i,e){function n(){this.Y=null,this.W=null,this.Z=null,this.z=null,this.X=[],this.$=[],this.tt=[],this.it=[],this.et=[]}var r=function(){},s=function(t){this.site=t,this.halfedges=[],this.closeMe=!1};s.prototype={init:function(t){return this.site=t,this.halfedges=[],this.closeMe=!1,this},prepareHalfedges:function(){for(var t,i=this.halfedges,e=i.length;e--;)(t=i[e].edge).vb&&t.va||i.splice(e,1);return i.sort(function(t,i){return i.angle-t.angle}),i.length},getNeighborIds:function(){for(var t,i=[],e=this.halfedges.length;e--;)null!==(t=this.halfedges[e].edge).lSite&&t.lSite.voronoiId!=this.site.voronoiId?i.push(t.lSite.voronoiId):null!==t.rSite&&t.rSite.voronoiId!=this.site.voronoiId&&i.push(t.rSite.voronoiId);return i},getBbox:function(){for(var t,i,e,n=this.halfedges,r=n.length,s=1/0,h=1/0,o=-1/0,u=-1/0;r--;)i=(t=n[r].getStartpoint()).x,e=t.y,i<s&&(s=i),e<h&&(h=e),i>o&&(o=i),e>u&&(u=e);return{x:s,y:h,width:o-s,height:u-h}},pointIntersection:function(t,i){for(var e,n,r,s,h=this.halfedges,o=h.length;o--;){if(e=h[o],n=e.getStartpoint(),r=e.getEndpoint(),!(s=(i-n.y)*(r.x-n.x)-(t-n.x)*(r.y-n.y)))return 0;if(s>0)return-1}return 1}};var h=function(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0},o=function(t){this.site=t},u=function(t,i){this.lSite=t,this.rSite=i,this.va=this.vb=null},f=function(t,i,e){if(this.site=i,this.edge=t,e)this.angle=Math.atan2(e.y-i.y,e.x-i.x);else{var n=t.va,r=t.vb;this.angle=t.lSite===i?Math.atan2(r.x-n.x,n.y-r.y):Math.atan2(n.x-r.x,r.y-n.y)}};f.prototype={getStartpoint:function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},getEndpoint:function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va}};var a=function(){this.root=null};a.prototype={rbInsertSuccessor:function(t,i){var e;if(t){if(i.rbPrevious=t,i.rbNext=t.rbNext,t.rbNext&&(t.rbNext.rbPrevious=i),t.rbNext=i,t.rbRight){for(t=t.rbRight;t.rbLeft;)t=t.rbLeft;t.rbLeft=i}else t.rbRight=i;e=t}else this.root?(t=this.getFirst(this.root),i.rbPrevious=null,i.rbNext=t,t.rbPrevious=i,t.rbLeft=i,e=t):(i.rbPrevious=i.rbNext=null,this.root=i,e=null);i.rbLeft=i.rbRight=null,i.rbParent=e,i.rbRed=!0;var n,r;for(t=i;e&&e.rbRed;)e===(n=e.rbParent).rbLeft?(r=n.rbRight)&&r.rbRed?(e.rbRed=r.rbRed=!1,n.rbRed=!0,t=n):(t===e.rbRight&&(this.rbRotateLeft(e),e=(t=e).rbParent),e.rbRed=!1,n.rbRed=!0,this.rbRotateRight(n)):(r=n.rbLeft)&&r.rbRed?(e.rbRed=r.rbRed=!1,n.rbRed=!0,t=n):(t===e.rbLeft&&(this.rbRotateRight(e),e=(t=e).rbParent),e.rbRed=!1,n.rbRed=!0,this.rbRotateLeft(n)),e=t.rbParent;this.root.rbRed=!1},rbRemoveNode:function(t){t.rbNext&&(t.rbNext.rbPrevious=t.rbPrevious),t.rbPrevious&&(t.rbPrevious.rbNext=t.rbNext),t.rbNext=t.rbPrevious=null;var i,e=t.rbParent,n=t.rbLeft,r=t.rbRight;i=n?r?this.getFirst(r):n:r,e?e.rbLeft===t?e.rbLeft=i:e.rbRight=i:this.root=i;var s;if(n&&r?(s=i.rbRed,i.rbRed=t.rbRed,i.rbLeft=n,n.rbParent=i,i!==r?(e=i.rbParent,i.rbParent=t.rbParent,t=i.rbRight,e.rbLeft=t,i.rbRight=r,r.rbParent=i):(i.rbParent=e,e=i,t=i.rbRight)):(s=t.rbRed,t=i),t&&(t.rbParent=e),!s)if(t&&t.rbRed)t.rbRed=!1;else{var h;do{if(t===this.root)break;if(t===e.rbLeft){if((h=e.rbRight).rbRed&&(h.rbRed=!1,e.rbRed=!0,this.rbRotateLeft(e),h=e.rbRight),h.rbLeft&&h.rbLeft.rbRed||h.rbRight&&h.rbRight.rbRed){h.rbRight&&h.rbRight.rbRed||(h.rbLeft.rbRed=!1,h.rbRed=!0,this.rbRotateRight(h),h=e.rbRight),h.rbRed=e.rbRed,e.rbRed=h.rbRight.rbRed=!1,this.rbRotateLeft(e),t=this.root;break}}else if((h=e.rbLeft).rbRed&&(h.rbRed=!1,e.rbRed=!0,this.rbRotateRight(e),h=e.rbLeft),h.rbLeft&&h.rbLeft.rbRed||h.rbRight&&h.rbRight.rbRed){h.rbLeft&&h.rbLeft.rbRed||(h.rbRight.rbRed=!1,h.rbRed=!0,this.rbRotateLeft(h),h=e.rbLeft),h.rbRed=e.rbRed,e.rbRed=h.rbLeft.rbRed=!1,this.rbRotateRight(e),t=this.root;break}h.rbRed=!0,t=e,e=e.rbParent}while(!t.rbRed);t&&(t.rbRed=!1)}},rbRotateLeft:function(t){var i=t,e=t.rbRight,n=i.rbParent;n?n.rbLeft===i?n.rbLeft=e:n.rbRight=e:this.root=e,e.rbParent=n,i.rbParent=e,i.rbRight=e.rbLeft,i.rbRight&&(i.rbRight.rbParent=i),e.rbLeft=i},rbRotateRight:function(t){var i=t,e=t.rbLeft,n=i.rbParent;n?n.rbLeft===i?n.rbLeft=e:n.rbRight=e:this.root=e,e.rbParent=n,i.rbParent=e,i.rbLeft=e.rbRight,i.rbLeft&&(i.rbLeft.rbParent=i),e.rbRight=i},getFirst:function(t){for(;t.rbLeft;)t=t.rbLeft;return t},getLast:function(t){for(;t.rbRight;)t=t.rbRight;return t}};var c=function(t,i){this.x=t,this.y=i};n.ε=1e-9,n.invε=1/n.ε,n.prototype={reset:function(){if(this.nt||(this.nt=new a),this.nt.root)for(var t=this.nt.getFirst(this.nt.root);t;)this.X.push(t),t=t.rbNext;this.nt.root=null,this.rt||(this.rt=new a),this.rt.root=this.st=null,this.Y=[],this.W=[],this.Z=[]},sqrt:Math.sqrt,abs:Math.abs,"ε":1e-9,"invε":n.invε,ht:function(t,i){return this.abs(t-i)<1e-9},ot:function(t,i){return t-i>1e-9},ut:function(t,i){return i-t>1e-9},ft:function(t){var i=this.et.pop();return i?i.init(t):new s(t)},at:function(t,i,e){return new f(t,i,e)},ct:function(t,i){var e=this.tt.pop();return e?(e.x=t,e.y=i):e=new c(t,i),this.Y.push(e),e},vt:function(t,i,e,n){var r=this.it.pop();return r?(r.lSite=t,r.rSite=i,r.va=r.vb=null):r=new u(t,i),this.W.push(r),e&&this.Ft(r,t,i,e),n&&this.dt(r,t,i,n),this.Z[t.voronoiId].halfedges.push(this.at(r,t,i)),this.Z[i.voronoiId].halfedges.push(this.at(r,i,t)),r},bt:function(t,i,e){var n=this.it.pop();return n?(n.lSite=t,n.rSite=null):n=new u(t,null),n.va=i,n.vb=e,this.W.push(n),n},Ft:function(t,i,e,n){t.va||t.vb?t.lSite===e?t.vb=n:t.va=n:(t.va=n,t.lSite=i,t.rSite=e)},dt:function(t,i,e,n){this.Ft(t,e,i,n)},pt:function(t){var i=this.X.pop();return i||(i=new r),i.site=t,i},wt:function(t,i){var e=t.site,n=e.x,r=e.y,s=r-i;if(!s)return n;var h=t.rbPrevious;if(!h)return-1/0;var o=(e=h.site).x,u=e.y,f=u-i;if(!f)return o;var a=o-n,c=1/s-1/f,l=a/f;return c?(-l+this.sqrt(l*l-2*c*(a*a/(-2*f)-u+f/2+r-s/2)))/c+n:(n+o)/2},gt:function(t,i){var e=t.rbNext;if(e)return this.wt(e,i);var n=t.site;return n.y===i?n.x:1/0},xt:function(t){this.Et(t),this.nt.rbRemoveNode(t),this.X.push(t)},Mt:function(t){var i=t.circleEvent,e=i.x,n=i.ycenter,r=this.ct(e,n),s=t.rbPrevious,h=t.rbNext,o=[t],u=Math.abs;this.xt(t);for(var f=s;f.circleEvent&&u(e-f.circleEvent.x)<1e-9&&u(n-f.circleEvent.ycenter)<1e-9;)s=f.rbPrevious,o.unshift(f),this.xt(f),f=s;o.unshift(f),this.Et(f);for(var a=h;a.circleEvent&&u(e-a.circleEvent.x)<1e-9&&u(n-a.circleEvent.ycenter)<1e-9;)h=a.rbNext,o.push(a),this.xt(a),a=h;o.push(a),this.Et(a);var c,l=o.length;for(c=1;c<l;c++)a=o[c],f=o[c-1],this.Ft(a.edge,f.site,a.site,r);f=o[0],(a=o[l-1]).edge=this.vt(f.site,a.site,void 0,r),this.Ct(f),this.Ct(a)},kt:function(t){for(var i,e,n,r,s=t.x,h=t.y,o=this.nt.root;o;)if((n=this.wt(o,h)-s)>1e-9)o=o.rbLeft;else{if(!((r=s-this.gt(o,h))>1e-9)){n>-1e-9?(i=o.rbPrevious,e=o):r>-1e-9?(i=o,e=o.rbNext):i=e=o;break}if(!o.rbRight){i=o;break}o=o.rbRight}var u=this.pt(t);if(this.nt.rbInsertSuccessor(i,u),i||e){if(i===e)return this.Et(i),e=this.pt(i.site),this.nt.rbInsertSuccessor(u,e),u.edge=e.edge=this.vt(i.site,u.site),this.Ct(i),void this.Ct(e);if(!i||e){if(i!==e){this.Et(i),this.Et(e);var f=i.site,a=f.x,c=f.y,l=t.x-a,v=t.y-c,F=e.site,d=F.x-a,b=F.y-c,y=2*(l*b-v*d),p=l*l+v*v,w=d*d+b*b,g=this.ct((b*p-v*w)/y+a,(l*w-d*p)/y+c);return this.Ft(e.edge,f,F,g),u.edge=this.vt(f,t,void 0,g),e.edge=this.vt(t,F,void 0,g),this.Ct(i),void this.Ct(e)}}else u.edge=this.vt(i.site,u.site)}},Ct:function(t){var i=t.rbPrevious,e=t.rbNext;if(i&&e){var n=i.site,r=t.site,s=e.site;if(n!==s){var o=r.x,u=r.y,f=n.x-o,a=n.y-u,c=s.x-o,l=s.y-u,v=2*(f*l-a*c);if(!(v>=-2e-12)){var F=f*f+a*a,d=c*c+l*l,b=(l*F-a*d)/v,y=(f*d-c*F)/v,p=y+u,w=this.$.pop();w||(w=new h),w.arc=t,w.site=r,w.x=b+o,w.y=p+this.sqrt(b*b+y*y),w.ycenter=p,t.circleEvent=w;for(var g=null,x=this.rt.root;x;)if(w.y<x.y||w.y===x.y&&w.x<=x.x){if(!x.rbLeft){g=x.rbPrevious;break}x=x.rbLeft}else{if(!x.rbRight){g=x;break}x=x.rbRight}this.rt.rbInsertSuccessor(g,w),g||(this.st=w)}}}},Et:function(t){var i=t.circleEvent;i&&(i.rbPrevious||(this.st=i.rbNext),this.rt.rbRemoveNode(i),this.$.push(i),t.circleEvent=null)},mt:function(t,i){var e=t.vb;if(e)return!0;var n,r,s=t.va,h=i.xl,o=i.xr,u=i.yt,f=i.yb,a=t.lSite,c=t.rSite,l=a.x,v=a.y,F=c.x,d=c.y,b=(l+F)/2,y=(v+d)/2;if(this.Z[a.voronoiId].closeMe=!0,this.Z[c.voronoiId].closeMe=!0,d!==v&&(r=y-(n=(l-F)/(d-v))*b),void 0===n){if(b<h||b>=o)return!1;if(l>F){if(!s||s.y<u)s=this.ct(b,u);else if(s.y>=f)return!1;e=this.ct(b,f)}else{if(!s||s.y>f)s=this.ct(b,f);else if(s.y<u)return!1;e=this.ct(b,u)}}else if(n<-1||n>1)if(l>F){if(!s||s.y<u)s=this.ct((u-r)/n,u);else if(s.y>=f)return!1;e=this.ct((f-r)/n,f)}else{if(!s||s.y>f)s=this.ct((f-r)/n,f);else if(s.y<u)return!1;e=this.ct((u-r)/n,u)}else if(v<d){if(!s||s.x<h)s=this.ct(h,n*h+r);else if(s.x>=o)return!1;e=this.ct(o,n*o+r)}else{if(!s||s.x>o)s=this.ct(o,n*o+r);else if(s.x<h)return!1;e=this.ct(h,n*h+r)}return t.va=s,t.vb=e,!0},Tt:function(t,i){var e=t.va.x,n=t.va.y,r=0,s=1,h=t.vb.x-e,o=t.vb.y-n,u=e-i.xl;if(0===h&&u<0)return!1;var f=-u/h;if(h<0){if(f<r)return!1;f<s&&(s=f)}else if(h>0){if(f>s)return!1;f>r&&(r=f)}if(u=i.xr-e,0===h&&u<0)return!1;if(f=u/h,h<0){if(f>s)return!1;f>r&&(r=f)}else if(h>0){if(f<r)return!1;f<s&&(s=f)}if(u=n-i.yt,0===o&&u<0)return!1;if(f=-u/o,o<0){if(f<r)return!1;f<s&&(s=f)}else if(o>0){if(f>s)return!1;f>r&&(r=f)}if(u=i.yb-n,0===o&&u<0)return!1;if(f=u/o,o<0){if(f>s)return!1;f>r&&(r=f)}else if(o>0){if(f<r)return!1;f<s&&(s=f)}return r>0&&(t.va=this.ct(e+r*h,n+r*o)),s<1&&(t.vb=this.ct(e+s*h,n+s*o)),(r>0||s<1)&&(this.Z[t.lSite.voronoiId].closeMe=!0,this.Z[t.rSite.voronoiId].closeMe=!0),!0},_t:function(t){for(var i,e=this.W,n=e.length,r=Math.abs;n--;)i=e[n],(!this.mt(i,t)||!this.Tt(i,t)||r(i.va.x-i.vb.x)<1e-9&&r(i.va.y-i.vb.y)<1e-9)&&(i.va=i.vb=null,e.splice(n,1))},Dt:function(t){for(var i,e,n,r,s,h,o,u,f,a=t.xl,c=t.xr,l=t.yt,v=t.yb,F=this.Z,d=F.length,b=Math.abs;d--;)if((i=F[d]).prepareHalfedges()&&i.closeMe){for(r=(n=i.halfedges).length,e=0;e<r;){if(h=n[e].getEndpoint(),u=n[(e+1)%r].getStartpoint(),b(h.x-u.x)>=1e-9||b(h.y-u.y)>=1e-9)switch(!0){case this.ht(h.x,a)&&this.ut(h.y,v):if(f=this.ht(u.x,a),o=this.ct(a,f?u.y:v),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;h=o;case this.ht(h.y,v)&&this.ut(h.x,c):if(f=this.ht(u.y,v),o=this.ct(f?u.x:c,v),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;h=o;case this.ht(h.x,c)&&this.ot(h.y,l):if(f=this.ht(u.x,c),o=this.ct(c,f?u.y:l),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;h=o;case this.ht(h.y,l)&&this.ot(h.x,a):if(f=this.ht(u.y,l),o=this.ct(f?u.x:a,l),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;if(h=o,f=this.ht(u.x,a),o=this.ct(a,f?u.y:v),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;if(h=o,f=this.ht(u.y,v),o=this.ct(f?u.x:c,v),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break;if(h=o,f=this.ht(u.x,c),o=this.ct(c,f?u.y:l),s=this.bt(i.site,h,o),e++,n.splice(e,0,this.at(s,i.site,null)),r++,f)break}e++}i.closeMe=!1}},compute:function(t,i){var e=new Date;this.reset(),this.z&&(this.tt=this.tt.concat(this.z.vertices),this.it=this.it.concat(this.z.edges),this.et=this.et.concat(this.z.cells),this.z=null);var n=t.slice(0);n.sort(function(t,i){var e=i.y-t.y;return e||i.x-t.x});for(var r,s,h,u=n.pop(),f=0,a=this.Z;;)if(h=this.st,u&&(!h||u.y<h.y||u.y===h.y&&u.x<h.x))u.x===r&&u.y===s||(a[f]=this.ft(u),u.voronoiId=f++,this.kt(u),s=u.y,r=u.x),u=n.pop();else{if(!h)break;this.Mt(h.arc)}this._t(i),this.Dt(i);var c=new Date,l=new o;return l.cells=this.Z,l.edges=this.W,l.vertices=this.Y,l.execTime=c.getTime()-e.getTime(),this.reset(),l}},i.exports=n},{}],9:[function(t,i,e){function n(t,i,e,n,r){g[b.mx+i+":"+(b.my+e)]||s(i,e),g[b.mx+n+":"+(b.my+r)]&&delete g[b.mx+n+":"+(b.my+r)]}function r(t){var i=b.x<b.mx*d+d/2,e=b.x>b.mx*d+d/2,r=b.y>b.my*d+d/2,s=b.y<b.my*d+d/2;e?(n(t,1,0,-1,0),n(t,0,0,-1,1),n(t,0,0,-1,-1),s&&n(t,1,-1,-1,-1),r&&n(t,1,1,-1,1)):i&&(n(t,-1,0,1,0),n(t,0,0,1,-1),n(t,0,0,1,1),s&&n(t,-1,-1,1,-1),r&&n(t,-1,1,1,1)),s?(n(t,0,-1,0,1),n(t,0,0,1,1),n(t,0,0,-1,1)):r&&(n(t,0,1,0,-1),n(t,0,0,1,-1),n(t,0,0,-1,-1))}function s(t,i){var e=a.g(b.mx+t,b.my+i,b);if(g[b.mx+t+":"+(b.my+i)]=e,e.bo&&!b.bo){b.bo=!0;let e=new v((b.mx+t+.5)*d,(b.my+i+.5)*d,40,"i",0);e.world=x,e.bo=!0,w.push(e),e.act()}}function h(){if(w.length>20)setTimeout(()=>h(),5e3);else{for(var t=0;t<5;t++){var i=l.range(3,12);if(0!==b.dx)var e=b.x+l.range(1e3,1200)*Math.sign(b.dx),n=b.y+l.range(100,200)*l.sign();else if(0!==b.dy)var e=b.x+l.range(100,200)*l.sign(),n=b.y+l.range(1e3,1200)*Math.sign(b.dy);else var e=b.x+l.range(1e3,1200)*l.sign(),n=b.y+l.range(1e3,1200)*l.sign();var r=Math.floor(e/d),s=Math.floor(n/d);let t=g[r+":"+s];if(!t)continue;let h=l.pickS(t.ec),u=new v(e,n,i,h,t.lv);o(t,u.x,u.y,u)||(u.world=x,w.push(u),u.act())}setTimeout(()=>h(),5e3)}}function o(t,i,e,n){return t.stones.find(function(t){return!(f.d(i,e,t.x,t.y)>300)&&(!!(f.p({a:{x:i,y:e},b:{x:i+n.w,y:e}},t.vs)||f.p({a:{x:i,y:e},b:{x:i,y:e+n.h}},t.vs)||f.p({a:{x:i+n.w,y:e},b:{x:i+n.w,y:e+n.h}},t.vs)||f.p({a:{x:i,y:e+n.h},b:{x:i+n.w,y:e+n.h}},t.vs)||f.p({a:{x:n.x+n.w/2,y:n.y+n.h},b:{x:i+n.w/2,y:e+n.h}},t.vs))||void 0)})}function u(t,i){var e=t.x+t.dx*i,n=t.y+t.dy*i;let r;r=t.dx>0?Math.floor((e+t.w)/d):Math.floor(e/d);var s=Math.floor((n+t.h)/d);let h=!1,u=g[r+":"+s];(h=!u||o(u,e,n,t))?(t.dx=0,t.dy=0):(t.x=e,t.y=n,t.dx+=3*(t.dx>0?-1:t.dx<0?1:0),t.dy+=3*(t.dy>0?-1:t.dy<0?1:0)),t.dy+=200*i,t===b?(u.bu&&!b.orbs[3]&&(b.hull--,t.dy=-400),u.cu&&!b.orbs[4]&&(t.dx=400),u.orb&&f.d(u.orb.x,u.orb.y,b.x,b.y)<10&&(b.orbs[u.orb.type]=!0,u.orb=!1)):(!b.invul&&f.d(t.x,t.y,b.x,b.y)<t.w&&(b.takingDamage=!0,setTimeout(()=>b.takingDamage=!1,50),F.play(2),b.hull--,b.dx=2*t.dx,b.dy=2*t.dy,b.invul=!0,b.hull<=0&&(b.dead=!0),setTimeout(()=>b.invul=!1,500)),p.forEach(function(i,e){f.d(t.x,t.y,i.x,i.y)<t.w&&(t.takeDamage(),"i"!==t.t&&(t.dx=2*i.dx),F.play(2),p.splice(e,1))}))}var f=t(3),a=t(2),c=t(7),l=t(5)(),v=t(1),F=t(6),d=3e3,b={x:6.5*d,y:.5*d,h:16,w:16,dx:0,dy:0,mx:6,my:0,flipped:!1,invul:!1,sonic:!0,hull:100,orbs:{}},y=[],p=[],w=[],g={},x={update:function(t){if(b.dead||b.won)return;y.forEach(function(i,e){i.life--,i.x+=i.dx*t,i.y+=i.dy*t,i.life<=0&&y.splice(e,1)}),p.forEach(function(i,e){i.life--,i.x+=i.dx*t,i.y+=i.dy*t,i.life<=0&&p.splice(e,1)});let i=g[b.mx+":"+b.my];i&&(i.stories.forEach((t,e)=>{f.d(t.x,t.y,b.x,b.y)<300&&(this.showStory(t),i.stories.splice(e,1))}),u(b,t),w.forEach((i,e)=>{i.dead||!i.bo&&f.d(i.x,i.y,b.x,b.y)>3e3?w.splice(e,1):u(i,t)}),r(this),b.mx=Math.floor(b.x/d),b.my=Math.floor(b.y/d))},player:b,sectors:g,bubbles:y,booms:p,start:function(){s(0,0),h()},sonicBoom:function(t,i){void 0===i&&(i=5),0!==i&&(p.push({x:b.x+8,y:l.range(b.y+3,b.y+13),dx:l.range(250,280)*t,dy:l.range(-10,10),s:b.orbs[2]?5:1,life:b.orbs[2]?l.range(80,100):8}),setTimeout(()=>this.sonicBoom(t,i-1),100))},bubblePuff:function(t,i,e){for(var n=0;n<e;n++)y.push({x:l.range(t-5,t+5),y:l.range(i-5,i+5),dx:l.range(-40,40),dy:l.range(-200,0),life:l.range(15,100)})},showStory:function(t){"string"==typeof t.t?c.showText(t.t):t.t.forEach(t=>c.showText(t))},entities:w,won:()=>{setTimeout(()=>{b.won=!0,c.won()},3e3)}};i.exports=x},{1:1,2:2,3:3,5:5,6:6,7:7}]},{},[4]);