<!DOCTYPE html><title>Escape from Planet XIII - js13kGames 2024</title><script>var e,r,t,a,n,o,i,l,v,f,c,u,s,d,m,p,x,h,$,y,g,w,b,z,A,M,T,E,k,P,S,F,C,I,L,D,B,H,W,U,N,O,_,R,V,G,Z,j,K,Y=34962,q=3553,J=2884,X=5126,Q=6408,ee=33984,re=36160,te=36064,ae=Math.sqrt,ne=Math.sin,oe=Math.cos,ie=Math.tan,le=Math.pow,ve=Math.floor,fe=e=>0|e,ce=e=>e-(0|e),ue=Math.max,se=Math.min,de=Math.acos,me=Math.abs,pe=Math.random,xe=(e,r)=>e+pe()*(r-e),he=(e,r)=>fe(xe(fe(e),fe(r))),$e=Math.PI,ye=$e/180,ge=(e,r,t)=>e+(r-e)*t,we=(e,r,t,a,n)=>ge(a,n,r==t?r:(e-r)/(t-r)),be=(e,...r)=>e.push(...r),ze=e=>e[he(0,e.length)],Ae=r=>{var t=r.length;for(let e=0;t-1>e;++e){var a=he(e,t),n=r[e];r[e]=r[a],r[a]=n}return r},Me=(r,t)=>(r=e.createShader(r),e.shaderSource(r,"#version 300 es\nprecision highp float;precision highp int;"+t),e.compileShader(r),r),Te=(r,t)=>{let a=Me(35633,r),n=Me(35632,t),o=(r=>{let t=e.createProgram();return r.forEach(r=>e.attachShader(t,r)),e.linkProgram(t),e.validateProgram(t),r.forEach(r=>e.deleteShader(r)),t})([a,n]),i=()=>e.useProgram(o);return i(),{t:o,o:{},i:a,l:n,v:i}},Ee=(r,...t)=>{for(var a of(r.v(),t))r.o[a]=e.getUniformLocation(r.t,a)},ke=(r,t,a)=>{e.uniformMatrix4fv(r.o[t],0,new Float32Array(a))},Pe=(r,t,...a)=>{e.uniform2f(r.o[t],...a)},Se=(r,t,...a)=>{e.uniform3f(r.o[t],...a)},Fe=(r,t,...a)=>{e.uniform4f(r.o[t],...a)},Ce=(a,...r)=>{Ee(a,...r),r.forEach((r,t)=>e.uniform1i(a.o[r],t))},Ie=(r,t,a,n,o,i)=>{var l=e.createTexture();for(e.bindTexture(q,l);0<r&&0<t&&(e.texImage2D(q,0,a,r,t,0,n,o,i),0!=e.getError());)r/=2,t/=2;return e.texParameteri(q,10241,9728),e.texParameteri(q,10240,9728),e.texParameteri(q,10242,33071),e.texParameteri(q,10243,33071),l.w=r,l.u=t,l},Le=(e,r,t,a)=>Ie(e,r,t,t==Q?Q:6402,t==Q?5121:X,a),De=r=>{e.bindFramebuffer(re,r),e.viewport(0,0,r.w,r.u)},Be=(r,t,...a)=>{var n,o,i=e.createFramebuffer(),l=(e.bindFramebuffer(re,i),[]);let v,f;for(n of a)"number"==typeof n?0==n?e.drawBuffers([0]):f=1==n?(v=Le(r,t,36012,null),e.framebufferTexture2D(re,36096,q,v,0),v):(o=2==n?Le(r,t,Q,null):Ie(r,t,34842,Q,X,null),e.framebufferTexture2D(re,te+l.length,q,o,0),be(l,o),o):(e.framebufferTexture2D(re,te+l.length,q,n,0),be(l,n),f=n);return i.w=f.w,i.u=f.u,i.$=l,i.m=v,i},He=r=>{e.enable(r)},We=r=>{e.disable(r)},Ue=(r,t,...a)=>{for(var n of a)e.activeTexture(t++),e.bindTexture(r,n);return t},Ne=(e,r)=>[e,r,0,0],Oe=(e,r,t)=>[e,r,t,0],_e=e=>[e=e??0,e,e,0],Re=(e,r,t,a)=>[e,r,t,a],Ve=e=>[e=e??0,e,e,e],Ge=(e,r,t,a,n)=>{e[0]=r??0,e[1]=t??0,e[2]=a??0,e[3]=n??0},Ze=e=>{Ge(e)},je=(e,r)=>{Ge(e,...r)},Ke=e=>Re(...e),Ye=(e,r,t)=>{(t=t??e)[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3]},qe=(e,r,t)=>{(t=t??e)[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3]},Je=(e,r,t)=>{(t=t??e)[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r},Xe=(e,r,t,a)=>(a[0]=e[0]*r+t[0],a[1]=e[1]*r+t[1],a[2]=e[2]*r+t[2],a[3]=e[3]*r+t[3],a),Qe=(e,r)=>e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],er=e=>ae(Qe(e,e)),rr=(e,r)=>{r=r??e,Je(e,1/er(e),r)},tr=(e,r,t,a)=>{(a=a??e)[0]=ge(e[0],r[0],t),a[1]=ge(e[1],r[1],t),a[2]=ge(e[2],r[2],t),a[3]=ge(e[3],r[3],t)},ar=(e,r)=>{r=r??e;var t=er(e);0===t?Ze(r):Je(e,1/t,r)},nr=(e,r,t)=>{t[0]=e[1]*r[2]-e[2]*r[1],t[1]=e[2]*r[0]-e[0]*r[2],t[2]=e[0]*r[1]-e[1]*r[0]},or=(e,r,t)=>(nr(e,r,t),ar(t),t),ir=(e,r,t,a)=>{var n=zr(),o=(qe(a,t,n),er(n)),i=(Je(n,1/o),((e,r,t,a)=>{var n=zr();if(qe(e,t,n),e=Qe(n,a),r*r<(t=Qe(n,n)-e*e))return[];let o=e-(a=ae(r*r-t)),i=e+a;return o>i&&([o,i]=[i,o]),[o,i]})(e,r,t,n));for(let e=0;e<2;++e){var l=i[e];if(null!=l&&0<=l&&l<=o)return l}return-1},lr=(e,r)=>{r.fill(0),r[0]=r[5]=r[10]=r[15]=e},vr=()=>{var e=Array(16);return lr(1,e),e},fr=vr(),cr=(vr(),(r,t)=>{for(let e=0;e<16;++e)r[e]=t[e]}),ur=(t,...a)=>{lr(1,t);for(let r=0;r<4;++r){var n=0==r?-1:1;for(let e=0;e<3;++e)t[4*r+e]=a[r][e]*n}},sr=(e,r,t,a)=>{var n=zr();qe(r,e,n),rr(n),r=zr(),nr(n,t,r),rr(r),t=zr(),nr(n,r,t),rr(t),lr(1,a),a[0]=r[0],a[1]=t[0],a[2]=-n[0],a[4]=r[1],a[5]=t[1],a[6]=-n[1],a[8]=r[2],a[9]=t[2],a[10]=-n[2],a[12]=-Qe(r,e),a[13]=-Qe(t,e),a[14]=Qe(n,e)},dr=(e,r,t)=>{Ge(t,e[r*=4],e[1+r],e[2+r],e[3+r])},mr=(e,r,t)=>{lr(1,fr),fr[12]=r[0],fr[13]=r[1],fr[14]=r[2],xr(e,fr,t)},pr=(e,r,t)=>{lr(r,fr),fr[15]=1,xr(e,fr,t)},xr=(t,e,a)=>{var n,o=zr(),i=zr();for(let r=0;r<4;++r){dr(e,r,i);for(let e=0;e<4;++e)Ge(o,t[n=e],t[n+4],t[n+8],t[n+12]),a[4*r+e]=Qe(o,i)}},hr=(e,r,t)=>{t[0]=e[0]*ne(r/=2),t[1]=e[1]*ne(r),t[2]=e[2]*ne(r),t[3]=oe(r)},$r=(e,r,t)=>{t[3]=e[3]*r[3]-e[0]*r[0]-e[1]*r[1]-e[2]*r[2],t[0]=e[3]*r[0]+e[0]*r[3]+e[1]*r[2]-e[2]*r[1],t[1]=e[3]*r[1]-e[0]*r[2]+e[1]*r[3]+e[2]*r[0],t[2]=e[3]*r[2]+e[0]*r[1]-e[1]*r[0]+e[2]*r[3]},yr=(e,r,t)=>{var a=zr(),n=zr(),o=zr();$r(e,r,n),r=e,(e=o)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],$r(n,o,a),je(t,a),t[3]=0},gr=(e,r,t)=>{yr(e,r,t),ar(t)},wr=0,br=Array(131072).fill(0).map(()=>Ve()),zr=()=>{var e=br[wr++];return Ze(e),e},Ar=()=>wr,Mr=e=>{wr=e},Tr=Oe(1,0,0),Er=Oe(0,1,0),kr=Oe(0,0,1),Pr=Oe(-1,0,0),Sr=Oe(0,-1,0),Fr=Oe(0,0,-1),Cr=[0,0,0,0],Ir=(_e(1),_e(.5)),Lr=vr(),Dr=(Re(800,600,0,1),(e,r)=>{var t=e.length;return e[(r%t+t)%t]}),Br=(e,r)=>(""+e).padStart(r,"0"),Hr=e=>.99<e?1:e<.01?0:e,Wr=(e,r)=>e&&!r||!e&&r,Ur="l",Nr="z",Or="x",_r="layout(location=0) in vec3 v;layout(location=1) in vec3 m;layout(location=2) in float i;layout(location=3) in vec2 t;uniform mat4 x,z,l;flat out float n;out vec2 o;out vec3 u;out vec4 f;out vec3 s,d;out vec2 r;out vec3 h;void main(){s=v;f=l*vec4(v,1);h=(l*vec4(0,0,0,1)).xyz;vec4 a=z*x*f;gl_Position=a;r=(vec2(a/a.w)+1.)/2.;d=m;u=transpose(inverse(mat3(l)))*m;n=i;o=t;}",Rr="in vec2 v;out vec2 o;uniform mat4 x,z;void main(){o=vec2(v.xy*.5+.5);gl_Position=vec4(v,0,1);}",Vr=100,Gr=101,Zr=150,jr=e=>{let{p:n,h:o,A:i,k:l,M:r,S:v,T:t,I:f}=e,c=()=>o([40]),u=(e,r)=>`float(${e??r??0})`,a=e=>`vec4(${e[0]},${e[1]},${e[2]},0)`,s=e=>n(`vec4(${e},${i("m")},0,0)`);return{0:e=>{var r=c();s(`length(${r})-`+u(e))},1:e=>{var r=c();s(`box(${r},${a(e)})`)},2:e=>{var r=c();s(`dot(${r},normalize(${a(e)}))`)},40:()=>{n(i("p"))},50:(e,r)=>{e=o(e),r=o(r),n(e+`.x<${r}.x?${e}:`+r)},51:(e,r)=>{e=o(e),r=o(r),n(e+`.x>${r}.x?${e}:`+r)},52:(e,r,t)=>{r=u(r),e=u(e);var a=c();t=o(t),s(t+`.x-(sin(${e}*${a}.x)*sin(${e}*${a}.y)*sin(${e}*${a}.z)*${r})`)},53:(e,r)=>{var t=i("p");l("p",t+".xyww"),r=o(r),v("p"),r=f(`vec2(${r}.x,abs(${t}.z)-${u(e)})`,"vec2"),s(`min(max(${r}.x,${r}.y),0.0) + length(max(${r},0.0))`)},100:(e,r)=>{l("p",i("p")+"-"+a(e)),e=o(r),v("p"),n(e)},101:(e,r)=>{e=u(e),l("p",i("p")+"/"+e),r=o(r),v("p"),n(r+`*vec4(${e},1,1,1)`)},102:(e,r)=>{var t=i("p"),a=f(`abs(${t})`);l("p",`vec4(${1==e[0]?a:t}.x,${1==e[1]?a:t}.y,${1==e[2]?a:t}.z,0)`),e=o(r),v("p"),n(e)},103:(e,r)=>{var t=i("p");e=f(`rr(${t}.xz,${u(-e)})`,"vec2"),l("p",`vec4(${e}.x,${t}.y,${e}.y, 0)`),t=o(r),v("p"),n(t)},150:(e,r)=>{l("m",u(e),"float"),e=o(r),v("m"),n(e)},200:e=>{r("p","P"),l("m",u(0),"float"),e=o(e),t(`return ${e}.xy;`)}}},Kr=(...e)=>e.reduce((e,r)=>[50,e,r]),Yr=(...e)=>e.reduce((e,r)=>[51,e,r]),qr=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],Jr=[Oe(0,0,0),Oe(1,0,0),Oe(1,1,0),Oe(0,1,0),Oe(0,0,1),Oe(1,0,1),Oe(1,1,1),Oe(0,1,1)],Xr=(e,r)=>[6,0,e,0,1,r],Qr=[9,"f"],et=[9,"h"],rt=e=>[3,[5,[7],0,[12,[13,[11,1e3,[3,18e3,[4,1,[3,-1,e=Xr(0,e)]]]],t/2],0],1],e],tt=()=>{var r=[6,et,0,.01,.8,.08],t=[];for(let e=0;e<3;++e)be(t,[3,[0,3,[11,Qr,5*e]],r]);return[4,...t]},at=(e,a,n,o)=>{{var d=((i,l)=>{let a=(e=>{let r=e*l|0,t=((e,r,t)=>{let v=e=>`(${e.toFixed(50)})`,m=e=>`o[(((${e})|0)<<2)>>2]`,p=v(r),a=t,n=[],o={},f=["v",0],c=[],u=e=>{var r=a;return a+=e,r},x=e=>(e=[u(e),new Float32Array(e)],n.push(e),e),i=x(t);for(let e=0;t>e;++e)i[1][e]=2*Math.random()-1;let l='"use asm";var o=new s.Float32Array(b);',h=(["min","max","cos","sin","fround","floor","abs","pow","log","PI"].forEach(e=>l+=`var ${e}=s.Math.${e};`),l+=`function log2(x){x=+x;return +(log(x)/log(2.));}function fct(x){x=+x;return +(x-floor(x))}function rnd(sn){sn=+sn;return +${m("((~~floor(sn))|0)+"+i[0])}}function m(sn){sn=+sn;`,""),s=0,$=(e,r)=>{var t="m"+s++;return c.push([t,r??"0.0"]),h+=t+`=${e};`,t},y=e=>d(...e instanceof Array?e:[8,e]),d=(e,...r)=>{++f[f.length-1];let t=f.join("_"),s=(c.push([t,"0.0"]),f.push(0),e=>{h+=t+`=${e};`}),i=(e,r,t)=>`((1.0-(${t}))*(${e})+(${t})*(${r}))`,d=(e,r,t)=>`min(max(${e},${r}),${t})`,l=(e,r,t)=>`((${e}==${r})?(1.0):(((${t})-(${e}))/((${r})-(${e}))))`;return{0:(r,e,t)=>{e=y(e),t=t??0,(n=x(1))[1][0]=t,t=n[0];var a=$("+"+m(""+t)),n=$(e+"/"+p);if(h=(h+=a+`=+fct(${a}+${n});`)+m(""+t)+`=fround(${a});`,e=`(${a}*2.0-1.0)`,0==r)s(`sin(${a}*2.0*PI)`);else if(4==r)s(e+">0.0?1.0:-1.0");else if(6==r)s(e);else if(5==r)s(`1.0-2.0*abs(${e})`);else{var o=$("0.0");for(let e=0;e<32;++e){var i=2*e+1,l=0==e?1:-1;3==r?h+=`${o}=${o}+${v(l)}*sin(${v(e)}*${a}*2.0*PI)/(${v(e+1)});`:2==r&&(h+=`${o}=${o}+${v(l)}*sin(${v(i)}*${a}*2.0*PI)/(${v(i*i)});`)}s(o)}},3:(...e)=>{s(e.map(e=>y(e)).join("*"))},4:(...e)=>{s(e.map(e=>y(e)).join("+"))},5:(e,r,t,a)=>{e=y(e),t=y(t),a=y(a),t=$(`2.0*PI*${t}/`+p);var n=$(`cos(${t})`),o=(t=$(`sin(${t})`),t=$(a+`==0.0?0.0:(${t}/(2.0*${a}))`),r=$(`(1.0+${a=0==r?"1.0":"(-1.0)"}*${n})/2.0`),a=$(`-${a}-`+n),$(""+r)),i=$("1.0+"+t),l=(n=$("-2.0*"+n),t=$("1.0-"+t),x(4)),v=$("+"+m(""+l[0])),f=$("+"+m(""+(l[0]+1))),c=$("+"+m(""+(l[0]+2))),u=$("+"+m(""+(l[0]+3)));r=$(`(${r}/${i})*${e}+(${a}/${i})*${v}+(${o}/${i})*${f}-(${n}/${i})*${c}-(${t}/${i})*`+u),h=(h=(h=(h=(h+=`${r}=${d(r,"-1.0","1.0")};`)+m(""+l[0])+`=${e};`)+m(""+(l[0]+1))+`=${v};`)+m(""+(l[0]+2))+`=${r};`)+m(""+(l[0]+3))+`=${c};`,s(r)},6:(e,r,t,a,n)=>{r=y(r),e=y(e),t=$(r+" + "+v(t+1e-4)),e=$(""+e);var o=$("sn/"+p);a=$(`${v(a)}*(1.0-${d(l(e,e+" + "+v(n+1e-4),o),"0.0","1.0")})`),e=$(d(l("0.0",r,o),"0.0","1.0")),n=$(d(l(r,t,o),"0.0","1.0")),s(`${t} == 0.0 ? ${a} : (${i(e,a,n)})`)},7:()=>{s("+rnd(sn)")},8:e=>{s(v(e))},9:e=>{o[e]||(o[e]=u(1)),s("+"+m(""+o[e]))},10:(e,r,t)=>{e=y(e),r=y(r),t=y(t),s(i(e,r,t))},11:(e,r)=>{e=y(e),r=y(r),s(e+`*pow(2.0,${r}/1200.0)`)},12:(e,r)=>{e=y(e),r=y(r),s(`min(${e},${r})`)},13:(e,r)=>{e=y(e),r=y(r),s(`max(${e},${r})`)},14:(e,r)=>{e=y(e),r=y(r),s(`pow(2.0,+log2(${e})*${r})`)}}[e](...r),f.pop(),t};return y(e),{P:l=(l=(l+="var "+c.map(e=>e[0]+"="+e[1]).join(",")+";")+`${h}return fround(${f.join("_")});}`)+`function r(){var i=0;for(;(i|0)<${t};i=(i+1)|0){${m("i")}=fround(m(+(i|0)))}}return {r:r};`,C:a,F:n,o:o}})(i,e,r),a=Function("s","f","b",t.P),n=Math.pow(2,Math.ceil(Math.log2(4*t.C))),o=new Float32Array(n);return{init:()=>{for(var e of t.F)o.set(e[1],e[0])},D:a(window,null,o.buffer).r,N:(e,r)=>{o[t.o[e]]=r},O:o,L:r,R:e,...t}})(t);return{_:(e,r,t)=>(a.N(Qr[1],e),a.N(et[1],t),a),B:[]}})(e,a),m=n+"k",p=o;let u,s=()=>{var e=parseInt(u,10);return isNaN(e)?0:(u=u.slice((""+e).length),e)};return p*=.6,(e,...t)=>{u="v10"+m;let a=120,n=4,o=4,i=0,l=r.currentTime,v=l;for(;""!=u;){c=void 0,f=(c=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b","r","o",">","<","t","v","k"]).findLastIndex(e=>u.startsWith(e)),u=u.slice((c[f]??"").length);var f,c=f;switch(c<=12&&((f=s())&&(o=f),f=240/(a*o),12!=c&&e(v,d,12*n+c,f,p*i/10,...t),v+=f),c){case 13:n=s();break;case 14:++n;break;case 15:--n;break;case 16:a=s();break;case 17:i=s()}}return 1e3*(v-l)}}},nt=[],ot=(e,t,a)=>{let n,o,i,l=(e,t,a,n,o,i)=>{i.gain.value=o,o=t.B[a][n],t=e,a=i,(n=r.createBufferSource()).buffer=o,a.G(n),n.playbackRate.value=1,n.start(t)},v=nt[e],f=v.map(()=>{{let t=r.createGain(),a=(t.connect(r.destination),[]);return t.G=e=>{e.connect(t),a.push(e)},t.K=()=>{if(a.length)for(var e of(t.disconnect(),a))e.stop()},t}});return(e=()=>{n=v.map((e,r)=>e(l,f[r])).reduce((e,r)=>ue(e,r))})(),t&&(o=setInterval(e,n)),a&&(i=setTimeout(a,n)),()=>{t&&clearInterval(o),a&&(clearTimeout(i),a()),f.forEach(e=>e.K())}},it=.2,lt=(r,t,a,n)=>{var e=Ar(),o=or(r,t,zr()),i=or(a,n,zr()),l=or(o,i,zr()),v=(e,r,t)=>{var a=de(Qe(e,r));return e=de(Qe(e,t)),r=de(Qe(r,t)),e<a&&r<a};for(let e=0;e<2;++e){if(v(r,t,l)&&v(a,n,l))return Ke(l);Je(l,-1)}Mr(e)},vt=(r,t)=>{var a=[],n=zr(),o=zr(),i=zr(),l=zr(),v=zr();for(let e=0;r.length>e;++e){var f=Dr(r,e),c=Dr(r,e+1);qe(c,Dr(r,e-1),o),Je(o,.5),qe(Dr(r,e+2),f,i),Je(i,.5),Ye(o,i,l),Xe(f,2,l,l),Xe(c,-2,l,l),Je(i,-1,v),Xe(f,-3,v,v),Xe(c,3,v,v),Xe(o,-2,v,v);for(let e=0;t>e;++e){var u=e/(t-1);Xe(o,u,f,n),Xe(v,u*u,n,n),Xe(l,u*u*u,n,n),ar(n),be(a,Ke(n))}}return a},ft=["Endurance","Close View","No Sun","Night","Tight Fences","Slippery","Sticky Road","Extra Long"],ct=(o,i)=>o.map((e,r)=>{var t=_e(),a=Dr(o,r+1),n=(qe(Dr(o,r+1),Dr(o,r-1),t),ar(t),r=_e(),qe(a,e,r),a=er(r),_e());return or(e,t,n),i&&Je(n,-1),{U:e,V:t,H:n,X:a,dir:r}}),ut=e=>{let i,L=Ar(),t=[],r=Gt(n);r.Y=5;for(var o=[],l=e.includes(100);!(()=>{let[a,r]=Rt(1),t=r[0],n=t,o=[];for(;;){let e=(a=>r.filter(r=>{let t=0;for(let e=0;r!=a&&e<3;++e)if(2==(t+=r.J.includes(a.J[e])?1:0))return 1;return 0}))(n);if(1<o.length&&e.includes(t))return i=o.map(e=>{var r,t=_e(0);for(r of e.J)Ye(t,a[r],t);return Je(t,1/3),ar(t),t}),1;if(0==(e=e.filter(e=>!o.includes(e))).length)return 0;be(o,n),n=ze(e)}})(););i=ct(i).map(e=>Xe(e.dir,.5,e.U,_e()));let v=vt(i,20),f=0,N=e.includes(4)||e.includes(3),c=_e(),u=_e(),s=_e(),d=e.includes(5)?.7*it:it;for(let r=0;r<2;++r)t[r]=ct(vt(ct(i).map(e=>(e=Xe(e.H,(r?1:-1)*d,e.U,_e()),ar(e),e)),20),!r);let m=[,,,,,,].fill(0).map(()=>[]),p=[],x=.5;var h,$=ct(v),Z=l?pt:mt;for(let n=0;$.length>n;++n){let{U:r,H:t,V:e,X:a}=$[n];10==n&&(je(c,v[n]),je(u,e),je(s,t));var y,g,b=e=>(e=Xe(t,e,r,_e()),ar(e),e);for(let r=0;r<6;++r)for(let e=1;0<=e;--e){var z=b(-(l?.18:.085)*(2*(r+e)/6-1));be(m[r],[z,z,[Z],[(r+e)/6,0]])}f+=a,N&&(x-=a)<=0&&(x+=.5,y=Xe(r,yt,r,_e()),g=_e(),Je(r,-1,g),be(p,[y,g])),(n+10)%20==0&&(y=b(1.25*d),g=b(1.25*-d),be(o,[y,g]))}for(h of m)for(var U of(be(h,h[0],h[1],h[1]),r.W(...h[0]),h))r.W(...U);r.j=1;var w=[Gt(n),Gt(n)];if(l)r.q=1;else for(let r=0;r<2;++r){var A,O=zr(),k=zr();for(A of(w[r].Y=5,w[r].q=1,t[r]))for(let e=0;e<2;++e)Xe(A.U,.025*(e-.5),A.U,O),Je(A.H,-1,k),w[r].W(O,k,[xt])}var M=vr(),G=vr(),D=Ve(),T=[],E=zr(),_=zr(),F=zr();if(!l)for(let e=0;e<120;++e){var C=Zt(a[wt+e%4]);do{var X=2*$e*pe(),P=de(xe(-1,1))}while(Ge(E,oe(X)*ne(P),ne(X)*ne(P),oe(P)),ar(E),dt($,E)<.248);0==E[0]&&0==E[1]?Ge(_,0,1,0):Ge(_,-E[1],E[0],E[2]),hr(E,5*pe(),D),yr(D,_,_),or(E,_,F),or(E,F,_),ur(M,_,F,E,E),pr(M,18,G),mr(G,Oe(0,0,.0035),C.Z),be(T,C)}var S,I=[Zt(w[0]),Zt(w[1]),Zt(r),...T],V=(l||be(I,Zt(a[bt])),[]);for(S of p)be(V,[S[0],Oe(1.5,1.5,.8),.3,0,S[1]]);var B=Zt(a[gt]),q=B.Z;return ur(M,s,u,c,c),mr(M,Oe(0,0,.65*$t),q),be(I,B),Mr(L),{tt:I,et:w,ot:r,nt:t,rt:c,ct:u,st:o,it:f,lt:$,ft:e,vt:V}},st=e=>{e.et[0].destroy(),e.et[1].destroy(),e.ot.destroy()},dt=(e,a)=>{let n=zr();return e.reduce((e,r)=>{qe(a,r.U,n);var t=Qe(r.V,n),t=ue(0,se(r.X,t));return Xe(r.V,t,r.U,n),qe(a,n,n),se(e,er(n))},1/0)},mt=1,pt=6,xt=7,ht=.02,$t=.07,yt=.05,gt=3,wt=4,bt=8,zt=0,At=0,Mt=r=>(++zt,new Promise(e=>{setTimeout(()=>{++At,e(r())})})),Tt=()=>{var e=[Vr,[0,2/3-1,t=.8400000000000001],Yr([1,[.475,2/3,.25]],[Vr,[0,.45,0],[2,[0,1,1]]],[Vr,[0,-.5,0],[2,[0,-1,.6]]],[Vr,[0,0,.2],[2,[0,-.2,1]]],[102,[1,0,0],[Vr,[.4,0,0],[2,[1,0,.5]]]])],r=Kr([Vr,[0,0,.42000000000000004],[51,[1,[.5,1,.17]],[Vr,[0,.45,.2],[2,[0,.3,1]]]]],e),t=Kr([102,[1,1,0],[Vr,[.55,.53,.25],[103,90*ye,[53,.1,[0,.25]]]]],[Gr,1.01,[51,[Vr,[0,.1,t-.12],[1,[.5,.4,.14]]],e]]);return[[[Zr,2,[Gr,ht,r]],.03,60],[[Zr,xt,[Gr,ht,r]],.03,60],[[Zr,3,[Gr,ht,t]],.03,60]]},Et=()=>{let e=[0,.4],t=[52,3e3,.02,[52,1500,.08,Kr(e,[Vr,[0,0,.4],[Gr,.7,e]])]];return[,,,,].fill(0).map((e,r)=>[[Zr,4|r<<5,[Gr,.01,t]],.012,18])},kt=Ve(),Pt=vr(),St=Oe(2,2,2),Ft=Ve(),Ct=Oe(0,0,1),It=[],Lt=[],Dt=vr(),Bt=vr(),Ht=e=>{l=e},Wt=(e,r,t,a,n)=>(be(Lt,e={U:e,color:r,ut:t,$t:a,xt:n}),e),Ut=e=>(e=Zt(e),be(It,e),e),Nt=()=>{It.length=0,Lt.length=0},Ot=()=>{var e=Gt(n),r=(e.Y=5,Oe(0,0,1));return e.W(Ne(-1,1),r,[mt,0,0]),e.W(Ne(-1,-1),r,[mt,0,0]),e.W(Ne(1,1),r,[mt,1,0]),e.W(Ne(1,-1),r,[mt,1,0]),e.upload(),e},_t={f:4},Rt=r=>{let o=[],i=[],l=zr(),v=zr(),f=(r,...t)=>{if(0<r){--r;var a=[];for(let e=0;e<3;++e){var n=a[e]=zr();Ye(Dr(t,e-1),t[e],n),Je(n,.5)}f(r,...a);for(let e=0;e<3;++e)f(r,t[e],Dr(a,e+1),a[e])}else{var e=_e();qe(t[1],t[0],l),qe(t[2],t[0],v),or(l,v,e),be(i,{xt:e,J:t.map(e=>{return t=e,(e=o.findIndex(e=>{return me((r=t)[0]-e[0])<1e-5&&me(r[1]-e[1])<1e-5&&me(r[2]-e[2])<1e-5&&me(r[3]-e[3])<1e-5;var r}))<0?(be(o,Ke(t)),o.length-1):e;var t})})}},t=[Tr,Er,Pr,Sr];for(let e=0;e<4;++e)f(r,kr,t[e],Dr(t,e+1)),f(r,Fr,Dr(t,e+1),t[e]);return[o,i]},Vt=(e,r,t)=>{var a,[o,e]=Rt(e);for(a of o)ar(a);var i,l=Gt(n),v=zr();for(i of e)for(var f of i.J)Je(o[f],r,v),l.W(v,o[f],[t]);return l},Gt=l=>{let v={yt:0,dt:1e4,Y:4},f=()=>{var e=v.ht;v.ht=new ArrayBuffer(v.dt*l.wt),e&&new Uint8Array(v.ht).set(new Uint8Array(e))};return f(),v.W=(...r)=>{v.yt==v.dt&&(v.dt*=2,f());let e=v.yt++*l.wt,t=new DataView(v.ht,e),a=0;for(let e=0;r.length>e;e++){var n=l.attributes[e],o=r[e],i=n.type;for(let e=0;n.gt>e;++e)t.setFloat32(a,o[e],1),a+=_t[i]}},v.upload=()=>{var r;v.zt||(r=v.zt=e.createBuffer(),e.bindBuffer(Y,r),e.bufferData(Y,v.ht,35044),v.bt=(t=>{var a={f:X},r=e.createVertexArray();e.bindVertexArray(r);let n=0,o=t.attributes;for(let r=0;o.length>r;++r){var i=o[r];e.vertexAttribPointer(r,i.gt,a[i.type],0,t.wt,n),n+=_t[i.type]*i.gt,e.enableVertexAttribArray(r)}return{layout:t,At:r}})(l))},v.D=()=>{e.bindBuffer(Y,v.zt),e.bindVertexArray(v.bt.At),e.drawArrays(v.Y,0,v.yt)},v.destroy=()=>{e.deleteBuffer(v.zt),v.zt=null},v},Zt=e=>(e.upload(),{kt:e,Z:vr()}),jt=[],Kt=[],Yt=[],qt=0,Jt={ArrowDown:3,ArrowUp:1,ArrowLeft:4,ArrowRight:2,KeyS:3,KeyW:1,KeyA:4,KeyD:2,KeyZ:7,Enter:7,Space:7},Xt=(e,r)=>{e.repeat||(jt[Jt[e.code]||0]=r),e.preventDefault(),r||(()=>{for(var e in Jt)if(Qt(Jt[e]))return 1;return 0})()||(qt=0)},Qt=e=>!qt&&jt[e],ea=e=>!qt&&!Yt[e]&&Kt[e],ra=_e(),ta=_e(),aa=_e(),na=[],oa=1,ia=_e(),la=e=>{H&&!e&&W&&(W(),W=0),H=e},va=()=>{E=z.st.map(()=>0)},fa=(e,r)=>{let t=ut(e);for(var a=!r&&0==e.length&&pe()<.25,n=!a&&e.includes(8);Wr(a,t.it<4)||Wr(n,9.85<t.it);)st(t),t=ut(e);return t},ca=e=>{let r=0;H&&(Qt(10)&&ba(pa),(t=Qt(2))||Qt(4)?(n=zr(),y=se(y+.006,.032),hr(ra,y*(t?-1:1),n),gr(n,ta,ta)):y=0,Qt(1))&&(r=3),$*=.987;var t=or(ta,ra,zr()),a=zr(),n=zr(),o=(or(aa,ra,n),A.includes(6)?4:A.includes(7)?.5:G?3:.7);if(tr(n,t,1-(1-le(1-$/h,o)),n),ar(n),Je(n,$,a),0!=r&&Xe(t,r*e,a,a),F)H&&.18<dt(z.lt,ra)&&ba(xa);else for(let e=0;e<2;++e){var i,l,v=z.nt[e],f=Ar();for(let e=0;v.length-1>e;++e)0<=ir(ra,.01,v[e].U,v[e+1].U)&&(i=Qe(a,v[e].V),l=Qe(a,v[e].H),Je(v[e].V,.98*i,a),Xe(v[e].H,.7*-me(l),a,a));Mr(f)}if(!F||ha!=xa){or(ra,a,aa),$=se(er(a),h);var c=zr();if(je(c,ra),o=zr(),hr(aa,$*e,o),gr(o,ra,ra),gr(o,ta,ta),gr(o,ia,ia),c[0]!==ra[0]||c[1]!==ra[1]||c[2]!==ra[2]||c[3]!==ra[3]){var u=z.st;for(let e=0;u.length>e;++e)lt(c,ra,u[e][0],u[e][1])&&(E[e]=1,0!=e||E.includes(0)||(++oa>L&&ba(pa),C+=I,va()))}}!H||0<(C-=e)||ba(xa)},ua=0,sa=1/120,da=-1,ma=0,pa=5,xa=6,ha=0,$a=e=>{var r=document.createElement("div");return r.style.boxSizing="border-box",e&&ya(r),r},ya=e=>{e.Mt=e.Mt??e.style.display,e.style.display="none"},ga=e=>{e.style.display=e.Mt},wa=e=>e<10?9==e?"IX":e<5?4==e?"IV":0<e?"I".repeat(e):"":"V"+wa(e-5):"X"+wa(e-10),ba=(o,i)=>{if(o!=pa||0!=M){switch(ha){case 3:Nt(),st(j);break;case 4:ya(O);break;case pa:case xa:Nt(),st(z),ya(R),ya(N);break;case 7:Nt(),ya(U)}switch(o){case 1:(d=(_=$a()).style).position="relative",d.width="min(95%,177vh)",d.marginInline="auto",d.padding="5vh",document.body.appendChild(_),R=$a(1),_.appendChild(R);var l=$a();l.style.display="flex",l.style.justifyContent="center",V=[];for(let e=0;e<3;++e){var f=$a(),c=((c=f.style).flex="1",c.border="#fff 7px solid",c.margin=c.padding="1rem",c.maxWidth="35vw",c.backgroundColor="#900B",c.minHeight="40vh",$a()),u=(f.St=c,f.appendChild(c),(c=$a()).style);u.textAlign="left",u.fontSize="1.4rem",f.Tt=c,f.appendChild(c),l.appendChild(f),be(V,f)}R.appendChild(l),(d=(U=$a()).style).marginTop="27vh",d.textAlign="right",d.width="88%",d.fontWeight="bold",d.filter="drop-shadow(#000 0.1rem 0.2rem)",d.fontSize="2rem",_.appendChild(U),N=$a(1),_.appendChild(N),(d=(O=$a(1)).style).textAlign="left",d.filter="drop-shadow(0 0 0.4rem #000)",_.appendChild(O),(async()=>{{r=r??new(window.AudioContext||window.webkitAudioContext),t=r.sampleRate;var o,i=(e,r)=>e.repeat(r),l="t150",f=l+i((f=i("g4ggg",3))+"gggg8g",3)+f+"gggg16ggg",c=at((c=Xr(.02,.55),[3,[0,0,[13,1,[14,Qr,c],.06]],c]),.6,i(f,1),.5),u=(f=l+i("g16ggg",64),f=at(rt(.03),.04,i(f,1),.035),l+i("r8g4ggg8",16)),s=(u=at(rt(.15),.16,i(u,1),.02),[]);for(o of[l+i("o4a8r2a4r8a8r8r2r4a8r2a4r8r8a8r16a8r16a8r16a8r16r8",1),l+i("o5e8r2f4r8e8r8r2r4e8r2f4r8r1",1),l+i("o5c8r2c4r8c8r8r2r4c8r2c4r8a8r16g#8r16g8r16f#8r16f8e",1)])be(s,at(tt(),2,i(o,4),.06));l=[c,f,u,...s],nt[0]=l,nt[1]=[at(tt(),2,"t100o5c#4rc#rc#r>>c#2",.1)];let a=(e,t,a,n)=>{t.B[a]&&t.B[a][n]||(t.B[a]||(t.B[a]=[]),t.B[a][n]=((a=t=t._(440*Math.pow(2,(a-69)/12),a,n)).init(),a.D(),a=a.O.subarray(0,a.L),(t=r.createBuffer(1,a.length,t.R)).copyToChannel(a,0),t))};nt.forEach(e=>e.forEach(e=>Mt(()=>e(a))))}c=[...Tt(),[[Zr,xt,[50,[102,[1,0,0],[Vr,[it,0,0],[1,[.005,.005,$t]]]],[Zr,8,[Vr,[0,0,$t-.02],[1,[it,.005,.02]]]]]],1.1*it,25],...Et()],a=await Promise.all(c.map(L=>Mt(()=>{{var[r,g,t]=[...L];let a=Gt(n),o=2*t,i=((u,t,a)=>{u="out vec2 G;in vec4 y;vec2 rr(vec2 v,float n){return mat2(cos(n),sin(n),-sin(n),cos(n))*v;}float box(vec4 v,vec4 n){vec3 m=abs(v.xyz)-n.xyz;return length(max(m,0.))+min(max(m.x,max(m.y,m.z)),0.);}$void main(){G=_s(y);}".replace("$",`vec2 _s(vec4 P){${(v=>{let r="",f=e=>{r+=e},c=0;{v=[200,u];let t,{Et:e,I:a,T:r}={Et:jr,T:f,I:(e,r)=>{var t="c"+c++;return f(`${r??"vec4"} ${t}=${e};`),t}},n={},o=(e,r)=>{var t=n[e]??[];n[e]=t,be(t,r)},i=[],l=e=>{return[e,...r]=[...e],t[e](...r),i.pop();var r};t=e({p:e=>{be(i,a(e))},I:a,T:r,h:l,M:o,k:(e,r,t)=>(r=a(r,t),o(e,r),r),A:e=>(e=n[e])[e.length-1],S:e=>{n[e].pop()}}),l(v)}return r})()}}`);var r,n=new Float32Array(t*t*t*4),o=t*t*4,i=4*o,l=Te("in vec2 v;out vec4 y;uniform vec2 a;void main(){gl_Position=vec4(v,0,1);y=vec4(vec3(v,a.y)*a.x,0);}",u);Ee(l,"a"),l.v(),u=Be(t,t,3),De(u);for(let r=0;t>r;r++)Pe(l,"a",a,2*r/(t-1)-1),v.D(),e.readPixels(0,0,t,t,Q,X,new Float32Array(n.buffer,r*i,o));for(r of u.$)e.deleteTexture(r);return u.m&&e.deleteTexture(u.m),e.deleteFramebuffer(u),e.deleteShader((u=l).i),e.deleteShader(u.l),e.deleteProgram(u.t),n})(r,o,g),l=(()=>{var r=[];for(let e=0;e<4;++e)r.push([0,0,0,0]);return r})(),f=(l[0][0]=l[1][2]=l[2][1]=l[3][0]=l[3][1]=l[3][2]=1,l[0][1]=l[0][2]=l[1][0]=l[1][1]=l[2][0]=l[2][2]=-1,zr()),c=zr(),u=e=>4*(e[2]*o*o+e[1]*o+e[0]),s=e=>i[u(e)],d=zr(),m=zr(),p=zr(),x=zr(),h=zr(),$=_e(-g),y={};for(let a=0;o-1>a;++a)for(let t=0;o-1>t;++t)for(let r=0;o-1>r;++r){Ge(h,r,t,a),Ze(p);let e=0;var b,z=[];for(b of qr){var w=Jr[b[0]],A=(Ye(h,w,x),s(x)),O=Jr[b[1]],k=(Ye(h,O,x),s(x));be(z,A),(A<=0&&0<k||k<=0&&0<A)&&(tr(w,O,A/(A-k),f),Ye(p,f),++e)}if(0<e){Je(p,1/e);var M=u(h);Ye(p,h),Xe(p,2*g/(o-1),$,p),Ze(c);for(let e=0;e<4;++e){Xe(l[e],1e-4,p,f);var G=(e=>{Xe(e,1/(2*g),Ir,m),Je(m,o-1),e=m,(t=(t=d)??e)[0]=ce(e[0]),t[1]=ce(e[1]),t[2]=ce(e[2]),t[3]=ce(e[3]),(e=t=m)[0]=ve(t[0]),e[1]=ve(t[1]),e[2]=ve(t[2]),e[3]=ve(t[3]);var r=[];for(let e=0;e<8;++e)Ge(f,e>>2&1,e>>1&1,1&e),Ye(f,m),r[e]=s(f);e=ge(r[0],r[4],d[0]);var t=ge(r[2],r[6],d[0]),a=ge(r[1],r[5],d[0]),n=ge(r[3],r[7],d[0]);return e=ge(e,t,d[1]),t=ge(a,n,d[1]),ge(e,t,d[2])})(f);Xe(l[e],G,c,c)}rr(c),y[M]=[[Ke(p),Ke(c),[i[M+1]]],Ke(h),z]}}var D,T=[0,3,8],E=[[3,2,1],[1,2,3]],_=[[Oe(0,-1,0),Oe(0,-1,-1),Oe(0,0,-1)],[Oe(-1,0,0),Oe(-1,0,-1),Oe(0,0,-1)],[Oe(-1,0,0),Oe(-1,-1,0),Oe(0,-1,0)]],F=[];for(D in y){var C,P=y[D],S=P[1];if(0!=S[0]&&0!=S[1]&&0!=S[2]){F[0]=P;for(let t=0;t<3;++t){let r=1;for(let e=0;e<3;++e){Ye(_[t][e],S,f);var I=y[u(f)];F[e+1]=I,r=r&&I}r&&(C=E[0<P[2][T[t]]?0:1],a.W(...F[0][0]),a.W(...F[C[0]][0]),a.W(...F[C[1]][0]),a.W(...F[0][0]),a.W(...F[C[1]][0]),a.W(...F[C[2]][0]))}}}return a}}))),be(a,Vt(4,1,0)),(f=Vt(2,1,0)).upload(),be(a,f),(u=Ot()).upload(),be(a,u)})().then(()=>{ba(2)});break;case 2:U.innerHTML="CLICK TO START";break;case 3:U.innerHTML="<h1>ESCAPE FROM PLANET XIII</h1>js13kGames 2024<br>by Miguel Ángel Pérez Martínez",j=ut([]),be(It,...j.tt),sr(Oe(8,0,0),Oe(0,1,0),Oe(0,0,1),Pt),Ge(Ft,1.3,1.3,1,1),Ge(Ct,.45,.66,.86),ga(U);break;case 4:if(d=7==ha)z=fa([],d),M=13;else{for(var s of(z=na[D],na))s!=z&&st(s);M-=D+1,na.length=0}F=(A=z.ft).includes(100);var d=A.includes(3),m=A.includes(4)||d,p=(m?(d?Ze(Ft):Ge(Ft,.17,.24,.3,0),Ge(Ct,.1,.01,.1)):F?(Ge(Ft,2,2,2,0),Ge(Ct,.9,.9,.9)):(Ge(Ft,1.3,1.3,1,1),Ge(Ct,.45,.66,.86)),h=G?1.25:we(M,13,1,.8,1.2),I=.95*z.it*1.25/h,d=we(F?20:M,1,13,1.1,1.6),C=I*d,T=wa(M),L=A.includes(1)?6:3,je(ra,z.rt),or(ra,z.ct,ta),je(aa,ta),je(ia,z.ct),g=Ut(a[G?1:0]),w=Ut(a[2]),Oe(1,1,.9));if(b=[],m)for(let e=0;e<2;++e)be(b,Wt(_e(0),p,.3,.95,_e(0)));z.vt.forEach(e=>Wt(...e)),be(It,...z.tt),ga(O),oa=1,y=$=0,va(),y=0,P=A.includes(2)?.9:1.7,k=P+.8,S=P,B=[D=0,0,0],la(0),ot(1,0,()=>{la(1),W=ot(0,1)});break;case pa:la(0);var x=1==M?1:se(3,M-1);for(let r=0;r<3;++r){var E=V[r];if(x>r){var q,H=[[1],[2],[4,3],[5],[6,7],[8]],J=(Ae(H),1==M?[100]:[]);for(let e=0;r>e;++e){var Y=H.pop();be(J,ze(Y))}be(na,fa(J)),1==M?(E.St.innerHTML="SYSTEM CORE",E.Tt.innerHTML="• Exit warphole"):(E.St.innerHTML="PLANET "+wa(M-r-1),q=J.map(e=>ft[e-1]),E.Tt.innerHTML=q.map(e=>"• "+e).join("<br>")),ga(E)}else ya(E)}ga(R);break;case xa:la(0),N.innerHTML=i?"CONGRATULATIONS YOU ESCAPED!":"GAME OVER",ga(N);break;case 7:m=Zt(a[10]),K=[[Zt(a[0]),Zt(a[2])],[Zt(a[1]),Zt(a[2])]],be(It,...K[0],...K[1],m),G=Z=0}Ht(ma=0),ha=o}else ba(xa,1)},za=r=>{wr=0;var t=(r-da)/1e3;switch(da=r,ma+=t,ha){case 1:U.innerHTML="Loading "+ve(100*At/zt);break;case 3:Ge(St,2,-1,2),ea(7)&&ba(7);var n,o=vr(),y=vr();for(n of(o[0]=o[5]=oe(.008),o[1]=ne(.008),o[4]=-ne(.008),j.tt))cr(y,n.Z),xr(o,y,n.Z);break;case 4:case pa:case xa:for(ua=se(ua+t,.5);sa<=ua;)ua-=sa,ca(sa);var z,A,M=ve(C/60),E=ve(_=C-60*M),_=ve(1e3*ce(_)),I=(O.innerHTML=`PLANET ${T}<br><b>TIME ${Br(M,2)}:${Br(E,2)}:${Br(_,3)}<br>LAPS ${oa}/${L}</b>`,S=ge(S,$/h<.4?P:k,.05),M=zr(),Xe(ra,S,ra,M),Xe(ia,-S/2,M,M),sr(M,ra,ia,Pt),E=zr(),qe(ra,M,E),ar(E),_=or(ia,E,zr()),Xe(_,3,M,M),je(St,M),or(ta,ra,zr())),N=g.Z,X=(ur(N,ta,I,ra,ra),cr(w.Z,N),zr());for(let e=0;b.length>e;++e){var H=b[e];je(H.xt,I),Ge(X,(0==e?1:-1)*ht/3,.01,.005,1),(H=H.U)[0]=(z=N)[0]*(A=X)[0]+z[4]*A[1]+z[8]*A[2]+z[12]*A[3],H[1]=z[1]*A[0]+z[5]*A[1]+z[9]*A[2]+z[13]*A[3],H[2]=z[2]*A[0]+z[6]*A[1]+z[10]*A[2]+z[14]*A[3],H[3]=z[3]*A[0]+z[7]*A[1]+z[11]*A[2]+z[15]*A[3]}if(ha==pa){for(let e=0;e<3;++e){var W=V[e].style,Q=Hr(ge(B[e],e==D?1:.8,.18));W.transform=`scale(${Q})`,W.filter=`grayscale(${we(Q,.8,1,.8,0)})`,B[e]=Q}ea(4)&&(D=(D+na.length-1)%na.length),ea(2)&&(D=(D+1)%na.length),ea(7)&&ba(4)}ha==xa&&(Ht(se(1,ma/2.5)),2.5<=ma&&(()=>{for(var e in Jt)if(ea(Jt[e]))return 1;return 0})()&&ba(3),F)&&tr(ra,Cr,.1,ra);break;case 7:var R=[zr(),zr()];for(let e=0;e<2;++e)Ge(R[e],-.03*(2*e-1),0,0),mr(Lr,R[e],K[e][0].Z),mr(Lr,R[e],K[e][1].Z);E=zr(),Z=Hr(ge(Z,G,.2)),tr(R[0],R[1],Z,E),sr(Oe(0,.18,.14),E,Oe(0,0,1),Pt),Ge(Ft,1.3,1.3,1,1),Ge(Ct,.45,.66,.86),Ge(St,ge(-.5,.5,Z),0,.4),U.innerHTML=`<h2>${G?"TOFU DRIFTER":"EASY RIDER"}</h2>`,ea(4)&&(G=G&&0),ea(2)&&!G&&(G=1),ea(7)&&ba(4)}if(1!=ha){Yt=[...Kt],Kt=[...jt],r=r=>{for(var t of It)ke(r,Ur,t.Z),t.kt.q&&We(J),t.kt.j&&(He(32823),e.polygonOffset(0,-10)),t.kt.D(),He(J),We(32823)},He(2929),He(J),e.cullFace(1029),De(f),e.clear(256),e.colorMask(0,0,0,0),m.v();var Y,ae,le,fe=7==ha?.2:2.5,ue=fe,de=(lr(1,Y=Bt),Y[0]=1/ue,Y[5]=-1/fe,Y[10]=-2/4.5,Y[14]=-5.5/4.5,sr(St,Cr,kr,Dt),ke(m,Or,Dt),ke(m,Nr,Bt),r(m),e.colorMask(1,1,1,1),De(i),e.drawBuffers([te,36065,36066]),e.clearColor(0,0,0,1),e.clear(16640),ue=vr(),fe=kt[0]/kt[1],Y=ue,fe*=-(le=-.005*ie(25*ye/2)),lr(1,Y),Y[0]=.005/fe,Y[5]=.005/le,Y[10]=-10.005/9.995,Y[11]=-1,Y[14]=-.1/9.995,Y[15]=0,s.v(),ke(s,Or,Pt),ke(s,Nr,ue),r(s),De(c),e.drawBuffers([te,36065]),We(2929),d.v(),ke(d,"C",Dt),ke(d,"E",Bt),ke(d,Or,Pt),ke(d,Nr,ue),Se(d,"b",...St),Fe(d,"_",...Ft),Se(d,"B",...Ct),Ue(q,ee,...i.$,f.m),v.D(),De(u),p.v(),ke(p,Or,Pt),ke(p,Nr,ue),Ue(q,ee,i.$[1],i.$[2],c.$[1]),a[9]),me=vr(),pe=vr();for(ae of(e.enable(3042),e.blendFunc(1,1),Lt))mr(Lr,ae.U,me),pr(me,ae.ut,pe),ke(p,Ur,pe),Fe(p,"N",ae.$t,...ae.xt),Fe(p,"O",ae.ut,...ae.color),de.D();e.disable(3042),fe=kt[0],le=kt[1],e.bindFramebuffer(re,null),e.viewport(0,0,fe,le),x.v(),Pe(x,"H",l,0),Ue(q,ee,u.$[0]),v.D()}window.requestAnimationFrame(za)};window.addEventListener("DOMContentLoaded",()=>{window.addEventListener("click",()=>{2==ha&&(r.resume(),ba(3))}),window.addEventListener("keydown",e=>{Xt(e,1)},1),window.addEventListener("keyup",e=>{Xt(e,0)},1),(async()=>{var r,t=document.body,a=t.style;if(a.margin="0",a.fontFamily="sans-serif",a.fontSize="6vh",a.color="#fff",a.backgroundColor="#000",a.userSelect="none",a.textAlign="center",a.overflow="auto",kt[0]=window.innerWidth,kt[1]=window.innerHeight,(a=document.createElement("canvas")).width=kt[0],a.height=kt[1],(r=a.style).position="absolute",r.inset="0",o=a,t.appendChild(o),!(e=o.getContext("webgl2",{alpha:0,powerPreference:"high-performance",antialias:1})))throw alert("Needs WebGL2"),Error();e.getExtension("EXT_color_buffer_float"),n=(()=>{let t={attributes:[],wt:0,append:(e,r)=>(be(t.attributes,{gt:e,type:r}),t.wt+=_t[r]*e,t)};return t})().append(3,"f").append(3,"f").append(1,"f").append(2,"f"),f=Be(4096,4096,0,1),i=Be(+kt[0],+kt[1],3,3,3,1),c=Be(+kt[0],+kt[1],2,2),u=Be(+kt[0],+kt[1],c.$[0]),s=Te(_r,"layout(location=0) out vec4 I;layout(location=1) out vec4 J;layout(location=2) out vec4 K;flat in float n;in vec2 o;in vec3 u;in vec4 f;in vec3 s,d;uniform highp sampler2DArray L;void main(){vec2 v=o;if(n==8.)v=s.xz*35.;I=vec4(normalize(d),n);J=vec4(normalize(u),v.x);K=vec4(f.xyz,v.y);}"),Ee(s,Or,Nr,Ur),d=Te(Rr,"layout(location=0) out vec3 e;layout(location=1) out vec3 g;uniform highp sampler2D c,w,A,D;uniform vec3 b;uniform vec4 _;uniform vec3 B;uniform mat4 C,E;in vec2 o;float p(float v){return(1.+sin(v))*.5;}float F(vec2 v){v=step(.5,fract(v));return mod(v.x+v.y,2.);}vec4 F(vec2 v,int n){if(n==1)return vec4(F(v));if(n==2){vec3 n=mix(vec3(.18,.56,.15),vec3(.42,.65,.07),p(v.x*120.)),d=mix(vec3(.18,.56,.15),vec3(.42,.65,.07),p(v.y*120.));n=mix(n,d,F(v));return vec4(n,1);}if(n==3){v.x=abs(v.x*2.-1.);float n=min(smoothstep(.75,.76,v.x),smoothstep(.86,.85,v.x));return vec4(mix(vec3(.4),vec3(.97,.71,0),n),1);}if(n==4){vec2 n=vec2(cos(v.x*6.28318),sin(v.x*6.28318));return(1.+vec4(n.x,dot(n,normalize(vec2(-1,1))),dot(n,normalize(vec2(-1))),1))/2.;}return vec4(1);}void main(){vec2 v=vec2(textureSize(c,0));vec4 n=texture(c,o.xy),d=texture(w,o.xy),l=texture(A,o.xy),i;vec3 m=normalize(b);if(length(d.xyz)==0.)e=_.w*vec3(.52,.73,.95),g=vec3(0);else{int v=int(n.w),t=v&31,c=t==0?1:0;vec2 o=vec2(d.w,l.w);float u=t==0?2.5:1.;int s[9]=int[](2,3,0,0,0,0,4,0,1),y=s[t];vec3 a[9]=vec3[](vec3(1),vec3(1),vec3(1,0,0),vec3(.1),vec3(0,.4,0)+float(v>>5)/7.*.5,vec3(.5,.25,0),vec3(1),vec3(.6),vec3(1));if(c==0)i=F(u*o,y);else if(c==1){vec3 v=abs(n.xyz);i=v.x>v.y&&v.x>v.z?F(u*n.xyz.zy/n.xyz.x,y):v.y>v.x&&v.y>v.z?F(u*n.xyz.xz/n.xyz.y,y):F(u*n.xyz.xy/n.xyz.z,y);}i.xyz*=a[t];vec4 f=E*C*vec4(l.xyz,1);f=.5+.5*(f/f.w);u=0.;o=1./vec2(textureSize(D,0));for(int v=-1;1>=v;++v)for(int n=-1;1>=n;++n){float m=texture(D,f.xy+vec2(v,n)*o).x;u+=f.z-.002>m?1.:0.;}u/=9.;g=i.xyz;e=i.xyz*max(_.xyz*max(0.,dot(m,d.xyz))*(1.-u),B*(1.+.2*max(0.,dot(d.xyz,normalize(-l.xyz)))));}}"),Ee(d,Or,Nr,"b","_","B","C","E"),Ce(d,"c","w","A","D"),m=Te(_r,"void main(){}"),Ee(m,Or,Nr,Ur),p=Te(_r,"out vec3 G;uniform highp sampler2D w,A,M;in vec2 r;in vec3 h;uniform vec4 N,O;void main(){vec3 v=texture(A,r).xyz-h;float n=length(v);v/=n;n=3.*min(1.,1./pow(n/(O.x*sqrt(.01)),2.))*smoothstep(N.x-.05,N.x,dot(N.yzw,v))*max(0.,dot(texture(w,r).xyz,-v));G=texture(M,r).xyz*O.yzw*n;}"),Ee(p,Or,Nr,Ur,"N","O"),Ce(p,"w","A","M"),x=Te(Rr,"out vec3 G;uniform highp sampler2D c;in vec2 o;uniform vec2 H;void main(){vec3 v=texture(c,o.xy).xyz;G=mix(v,mat3(.39,.35,.27,.77,.69,.53,.19,.17,.13)*v,H.x);}"),Ee(x,"H"),Ce(x,"c"),v=Ot()})().then(()=>{ba(1),window.requestAnimationFrame(za)})})</script>
