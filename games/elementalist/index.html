<!doctype html><title>Elementalist - js13kGames 2014</title><meta name=viewport content="width=device-width,user-scalable=no"><style>body,html{margin:0;padding:0;background-color:#fff}canvas{display:block;margin:auto;background-color:#000}</style><body><script>!function r(n,t,e){function o(u,f){if(!t[u]){if(!n[u]){var i="function"==typeof require&&require;if(!f&&i)return i(u,!0);if(l)return l(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var c=t[u]={exports:{}};n[u][0].call(c.exports,(function(r){var t=n[u][1][r];return o(t||r)}),c,c.exports,r,n,t,e)}return t[u].exports}for(var l="function"==typeof require&&require,u=0;u<e.length;u++)o(e[u]);return o}({1:[function(){var r,n,t,e,o,l,u,f,i,a,c,d,h,s,v,g,p,m,x,b,S,y,C,M,w,k,q,L,O,X,Y,z,B,D,E,R,A,F,I,N,T,U,_,P,W,j,G,H,J,K,Q,V,Z,$,rr,nr,tr,er,or=[].slice,lr={}.hasOwnProperty,ur=[].indexOf||function(r){for(var n=0,t=this.length;t>n;n++)if(n in this&&this[n]===r)return n;return-1};P=function(r,n){return Math.floor(r+Math.random()*(n-r+1))},T=function(r){return r[P(0,r.length-1)]},z=function(r,n){return r%n},R=function(r,n){return Math.floor(r/n)},D=function(r,n,t){return n*t+r},A=function(r,n,t){var e,o,l,u,f,i,a,c;if(u=0,o=r.length,f=z(n,t),i=R(n,t),(l=f-1)>=0&&t>l)for(e=a=l;(0>=l?0>=a:a>=0)&&r[i*t+e]===r[n];e=0>=l?++a:--a)u+=1;if((l=f+1)>=0&&t>l)for(e=c=l;(t>=l?t>c:c>t)&&o>i*t+l&&r[i*t+e]===r[n];e=t>=l?++c:--c)u+=1;return u>=2},tr=function(r,n,t,e){var o,l,u,f,i,a,c,d;if(f=0,l=r.length,i=z(n,t),u=(a=R(n,t))-1,a>=0&&e>a)for(o=c=u;(0>=u?0>=c:c>=0)&&r[o*t+i]===r[n];o=0>=u?++c:--c)f+=1;if(u=a+1,a>=0&&e>a)for(o=d=u;(e>=u?e>d:d>e)&&l>u*t+i&&r[o*t+i]===r[n];o=e>=u?++d:--d)f+=1;return f>=2},N=function(r,n,t,e){var o,l;return o=A(r,n,t),l=tr(r,n,t,e),o||l},d=function(r,n,t){var e,o,l,u,f,i,a,c;return e=z(r,t),l=R(r,t),o=z(n,t),u=R(n,t),!(ur.call(function(){a=[];for(var r=f=o-1,n=o+1;n>=f?n>=r:r>=n;n>=f?r++:r--)a.push(r);return a}.apply(this),e)<0)&&(!(ur.call(function(){c=[];for(var r=i=u-1,n=u+1;n>=i?n>=r:r>=n;n>=i?r++:r--)c.push(r);return c}.apply(this),l)<0)&&(e===o||l===u))},C=function(r,n,t,e,o,l,u){var f,i,a,c,d;for(d=[],f=i=0,a=r.length;a>=0?a>i:i>a;f=a>=0?++i:--i)d.push(q(t,f,n,e,o,null!=(c=l[r[f]])?c:"#000",u));return d},w=function(r,n,t,e,o,u){return null!=o?q(r,o,n,t,e,l,u):void 0},q=function(r,n,t,e,o,l,u){var f,i,a,c,d,h;return f=u.borderColor,i=u.borderSize,a=u.offsetX,c=u.offsetY,d=a+z(n,t)*e,h=c+R(n,t)*o,X(r,d,h,e,o,l),K(r,d,h,e,o,f,i)},X=function(r,n,t,e,o,l){return r.fillStyle=l,r.fillRect(n,t,e,o)},K=function(r,n,t,e,o,l,u){return r.lineWidth=u,r.strokeStyle=l,r.strokeRect(n,t,e,o)},M=function(r,n,t,e,o,l,u,f,i){var a,c,d,h;return a=i.backgroundColor,c=i.borderColor,d=i.borderSize,h=n/t,X(r,e,o,l,u,a),X(r,e,o,h*l,u,f),K(r,e,o,l,u,c,d)},y=function(r,n,t,e,o){var l,u,f,i,a,c,d,h,s,v,g,p;for(c=o.offsetX,d=o.offsetY,p=[],i=v=0,g=n.length;g>v;i=++v)f=(l=n[i]).current,a=l.max,u=l.color,h=c,s=d+i*e,l.current/l.max,p.push(M(r,f,a,h,s,t,e,u,o));return p},k=function(r,n,t,e,o,l){var u,f,i;return u=l.align,f=l.baseline,i=l.font,r.fillStyle=o,r.font=i,r.textAlign=u,r.textBaseLine=f,r.fillText(n,t,e)},E=function(){var r;return null!=(r="undefined"!=typeof localStorage&&null!==localStorage?localStorage.getItem("lastBestLvl"):void 0)?r:0},H=function(r){return"undefined"!=typeof localStorage&&null!==localStorage?localStorage.setItem("lastBestLvl",r):void 0},t=640,n=960,o=10,i=a=64,r=a,u=["#ddd","#855","#f55","#69f"],e="#444",c="#ddd",l="rgba(0,0,0,0.5)",er=[0,1,2,3],f=er,(m=document.createElement("canvas")).width=t,m.height=n,b=m.getContext("2d"),x=null,document.body.appendChild(m),Y=function(r,n,t){var e,o,l,u;for(l=r*n,e=[],o=u=0;l>=0?l>u:u>l;o=l>=0?++u:--u)for(;e[o]=T(t),N(e,o,r,n););return e},G=!1,rr=null,O=null,S=0,U=0,g=0,F=0,Z=null,$=null,Q=function(r,n,t){var e;return e=[r[t],r[n]],r[n]=e[0],r[t]=e[1],e},j=function(){return rr={color:"#2a8",current:2e4,max:2e4},O={color:"#f95",current:0,max:120},S=1,U=2,g=2,F=E(),!1},m.addEventListener("click",(function(n){var t,e,l,u,f,c,h;return null==x&&(x=m.getBoundingClientRect()),t=n.clientX-x.left,e=n.clientY-x.top,G?(c=Math.floor((t-r)/a),h=Math.floor((e-256)/i),c>=0&&8>c&&h>=0&&o>h&&(u=D(c,h,8),null===Z?Z=u:$=u,null!=Z&&null!=$)?(d(Z,$,8)&&(Q(s,Z,$),l=N(s,Z,8,o),f=N(s,$,8,o),l||f||Q(s,Z,$)),Z=$=null):void 0):(G=!0,void j())})),p=function(r,n,t,e){var o,l,u,f,i,a,c,d;for(o=f=a=r.length-1;0>=a?0>=f:f>=0;o=0>=a?++f:--f)null===r[o]&&(u=z(o,n),(l=(R(o,n)-1)*n+u)>=0&&l<r.length&&Q(r,o,l));for(d=[],o=i=0,c=r.length;c>=0?c>i:i>c;o=c>=0?++i:--i)null===r[o]?d.push(r[o]=T(e)):d.push(void 0);return d},B=function(r,n,t){var e;return e=3*n,r.length-3>=0&&(e+=(r.length-3)*t),e},h={backgroundColor:"#eee",borderColor:"#fff",borderSize:4,offsetX:64,offsetY:160},s=Y(8,o,f),v={borderColor:"#fff",borderSize:4,offsetX:r,offsetY:256},j(),nr=function(r){var n,t,e,l,u,i;if(!0===G){if(rr.current-=1e3*r,rr.current<=0)return rr.current=0,G=!1,!0,void(S>E()&&H(S));for(t=[],n=e=0,i=s.length;i>=0?i>e:e>i;n=i>=0?++e:--e)N(s,n,8,o)&&t.push(n);for(l=0,u=t.length;u>l;l++)n=t[l],s[n]=null;if(t.length>0)return O.current+=B(t,U,g),O.current>=O.max&&(O.current=0,U*=S,g+=1,S+=1,O.max*=S,rr.current=rr.max=1.1*rr.max),p(s,8,0,f)}},W=function(){return b.clearRect(0,0,t,n),X(b,0,0,t,n,"#fff"),y(b,[rr,O],512,32,h),C(s,8,b,a,i,u,v),w(b,8,a,i,Z,v),G||(X(b,r,256,512,640,"rgba(4,4,4,0.9)"),k(b,"Click to start",76.8,512,c,{align:"left",font:"bold 80px helvetica"}),k(b,"a new game",89.6,576,c,{align:"left",font:"bold 80px helvetica"}),k(b,"Match 3 or more elements",135.68,684.8,c,{align:"left",font:"bold 30px helvetica"})),k(b,"Level "+S,r,120,e,{align:"left",font:"bold 80px helvetica"}),k(b,"Last best: "+F,r,920,e,{align:"left",font:"bold 20px helvetica"}),k(b,"@Mickawesomesque",576,920,e,{align:"right",font:"bold 20px helvetica"})},I=1*(J=1/60),L=0,_=new Date,requestAnimationFrame(V=function(){var r;for(r=new Date,L+=Math.min(1,(r-_)/1e3),_=r;L>I;)nr(J),L-=I;return W(),requestAnimationFrame(V)})},{}]},{},[1])</script>