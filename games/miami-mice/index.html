<!doctype html><html><meta name=viewport content="width=device-width"><title>Miami Mice - js13kGames 2025</title><style>body{margin:0;overflow:hidden;background-color:#555;display:flex;justify-content:center;align-items:center}canvas{outline:1000px solid #555;aspect-ratio:16/9;max-width:100vw;max-height:100vh;z-index:5}.a{position:absolute;top:0;left:0;right:0}.e{transition:all .5s ease-in}.sky{height:50vh}.water{top:32vh;height:.55vh;background:#00a;overflow:hidden}.water_sun{width:200%;height:100%;margin-left:auto;margin-right:auto;animation:3s infinite alternate water-scale}.watershade{top:32vh;height:25vh;background:linear-gradient(180deg,#00f4 0,transparent 10%,#0ff5 100%)}@keyframes water-scale{from{width:60%}to{width:99%}}.torii{background:#632727}.v{width:2vw;height:47vh;top:10vh}.l{border-right:.5vw solid #9a544e;left:30vw}.r{border-left:.5vw solid #9a544e;left:auto;right:30vw}.h{border-bottom:.2vw solid #9a544e;width:50vw;height:3vh}.t1{background:#171010;top:3vh;height:3vh;width:52vw;left:24vw}.t2{top:6vh;height:4vh;left:25vw}.t3{top:16vh;height:3vh;width:44vw;left:28vw}.ground{top:54vh;height:50vh;background-size:40px 30px;background-color:#555;background-image:linear-gradient(to right,transparent 0,#0005 2px,#0005 4px,transparent 6px),linear-gradient(to bottom,#0005 2px,transparent 6px);transform:perspective(80vh) rotateX(60deg);transform-origin:top center}.chrome>div{text-align:center;font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif}.chrome .shadow{text-shadow:0 0 4px #fff,0 0 3px #fff,0 0 2px #fff,0 5px 10px #000,0 5px 15px #000}.chrome .text{background-image:linear-gradient(180deg,#003 12%,#0bf 39%,#cff 47%,#000 51%,#f5f 83%,#edf 100%);color:transparent;background-clip:text}.bigtext{z-index:9;font-size:20vh;top:20vh}.neon{top:36vh;left:20vw;color:#0bf;text-shadow:-1px -1px 2px #fff,-2px -2px 2px #fff3,1px 1px 2px #000,2px 2px 2px #0003,0 0 8px #f5f,0 0 12px #f5f,0 0 15px #f5f;font-family:cursive;font-style:italic;font-size:10vh;text-align:center;z-index:9;rotate:-7deg}.btn{top:70vh;text-align:center;font-size:10vh;font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;color:#fff;text-shadow:0 0 5px #000,0 4px 10px #000;z-index:9;cursor:pointer}.btn:hover{color:#ffa;text-shadow:0 0 5px #000,0 4px 10px #fff;transform:scale(1.1)}.btn.start{top:60vh}.btn.horde{top:75vh}.cast{top:18vh;font-size:3.5vh;color:#fff;text-align:center;font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;text-shadow:0 0 3px #000,0 0 6px #000}.cast2{top:54vh}.load{font-size:6vh;top:60vh}.hint{top:82vh;left:20vw;right:20vw;font-family:cursive;font-size:3vh;color:#fff;text-shadow:0 0 5px #000,0 4px 10px #000;z-index:20;text-align:center}.txt{top:32vh;left:20vw;right:20vw;font-family:cursive;font-size:3.5vh;color:#fff;text-shadow:0 0 5px #000,0 4px 10px #000;z-index:20;background:#0004;padding:1vh;border-radius:2vh;border:4px solid #fff5;box-shadow:0 0 30px #000}.stats{z-index:30;pointer-events:none;opacity:.7}.health{top:95vh;left:15vw;width:30vw;height:2.8vh;border:.4vh solid #000;background-color:#400;box-shadow:0 0 5px #000,0 0 10px #000 inset;border-radius:2vh}.healthbar{height:100%;background:linear-gradient(0deg,#750000,red,#ff6969);box-shadow:0 0 5px #000,0 0 10px #000 inset;transition:width .5s ease-out;border-radius:2vh}.stamina{top:91vh;left:15vw;width:30vw;height:2.8vh;border:.4vh solid #000;background-color:#400;box-shadow:0 0 5px #000,0 0 10px #000 inset;border-radius:2vh}.staminabar{height:100%;background:linear-gradient(0deg,#001b75,#07f,#69fff8);box-shadow:0 0 5px #000,0 0 10px #000 inset;transition:width .5s ease-out;border-radius:2vh}.score{top:92vh;left:48vw;width:30vw;height:5vh;border:.4vh solid #000;background-color:#222;box-shadow:0 0 5px #000,0 0 10px #000 inset;font-family:cursive;font-size:3.5vh;color:#fff;text-shadow:0 0 5px #000,0 4px 10px #000;padding-left:1vw;border-radius:2vh}.stat{font-size:2vh;font-family:Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;color:#fffa;padding-left:1vw}</style><div class="a sky"></div><div class="a water"><div class=water_sun></div></div><div class="a watershade"></div><div class="a ground"></div><div class="a torii v l"></div><div class="a torii v r"></div><div class="a torii h t2"></div><div class="a torii h t1"></div><div class="a torii h t3"></div><canvas id=gameCanvas width=1920 height=1080></canvas><div class="a cast load">LOADING</div><div class="a intro e" style=opacity:0><div class="a chrome bigtext miamimice e"><div class="a shadow">MIAMI MICE</div><div class="a text">MIAMI MICE</div></div><div class="a neon e"><b>Paws of Steel</b></div><div class="a cast e">ARNOLD SCHWARZENMOUSER                   JEAN CLAWS VAN DAMME</div><div class="a cast cast2 e">feat.    DANNY DE CHEETO    as    "RAT KING"</div><div class="a mainmenu"><div class="a btn start" onclick=gameStart()>START</div><div class="a btn horde" onclick=gameStartHorde()>HORDE MODE</div></div></div><div class="a txt" style=display:none></div><div class="a gameover e" style=opacity:0><div class="a chrome bigtext e"><div class="a shadow">GAME OVER</div><div class="a text">GAME OVER</div></div><div class="a btn" onclick=gameRetry()>RETRY STAGE</div><div class="a hint">Retry costs half of your current score</div></div><div class="a stats"><div class="a stamina"><div class="a staminabar" style=width:100%></div><div class="a stat">STAMINA</div></div><div class="a health"><div class="a healthbar" style=width:100%></div><div class="a stat">HEALTH</div></div><div class="a score">SCORE: <span id=sc>0</span></div></div><script>const t=t=>t*(Math.PI/180),e=(t,e)=>{t.strokeStyle=e},s=(t,e)=>{t.fillStyle=e},i=t=>{t.beginPath()},h=(t,e,s)=>{t.moveTo(e,s)},n=(t,e,s)=>{t.lineTo(e,s)},a=(t,e,s,i,h,n,a=!1)=>{t.arc(e,s,i,h,n,a)},r=(t,e,s,i,h,n,a,r,o=!1)=>{t.ellipse(e,s,i,h,n,a,r,o)},o=t=>{t.fill()},d=t=>{t.stroke()},l=(t,e)=>{t.lineWidth=e},c=(t,e,s,i,h,n,a)=>{t.bezierCurveTo(e,s,i,h,n,a)},u=t=>{t.save()},p=t=>{t.restore()},m=(t,e,s)=>{t.translate(e,s)},g=[];g[1]={s:50,ttl:.8,color:"#ccc2",dx:200,dy:200};class b{constructor(t,e,s="gameObject"){this.x=t,this.y=e,this.game=null,this.type=s,this.particles=[],this.ttl=1/0}update(t){this.ttl-=t,this.particles.forEach(e=>{e.ttl-=t,e.r+=e.dr*t,e.x+=e.dx*t,e.y+=e.dy*t}),this.particles=this.particles.filter(t=>t.ttl>0)}renderParticles(t){this.particles.forEach(e=>{u(t),m(t,e.x,e.y),((t,e)=>{t.rotate(e)})(t,e.r),i(t);let h=e.s*e.ttl/e.ittl;s(t,e.c),((t,e,s,i,h)=>{t.rect(e,s,i,h)})(t,-h/2,-h/2,h,h),o(t),p(t)})}addParticle(t,e,s=1){let i=g[s];this.particles.push({x:t,y:e,dx:Math.random()*i.dx-i.dx/2,dy:Math.random()*i.dy-i.dy/2,s:i.s,ttl:i.ttl,type:s,ittl:i.ttl,r:0,dr:30*(Math.random()>.5?1:-1),c:i.color})}}class f{constructor(t,e,s,i,h,n=null,a=10){this.x=t,this.y=e,this.width=s,this.height=i,this.bone=null,this.dmg=a,this.type=h,this.poseId=n}getRect(){let t=this.width*(this.bone?this.bone.kinematicObject.sizing:1),e=this.height*(this.bone?this.bone.kinematicObject.sizing:1);return{x:this.x-t/2,y:this.y-e/2,w:t,h:e}}getWorldRect(){if(!this.bone)return this.getRect();let t=this.getRect(),e=this.bone.kinematicObject;return t.x+=e.x,t.y+=e.y,t}intersects(t){let e=this.getWorldRect(),s=t.getWorldRect();return e.x<s.x+s.w&&e.x+e.w>s.x&&e.y<s.y+s.h&&e.y+e.h>s.y}render(t){}}class y{constructor(t,e,s){this.x=0,this.y=0,this.kinematicObject=s,this.length=t,this.angle=e,this.worldAngle=0,this.endX=0,this.endY=0,this.children=[],this.parent=null,this.hitboxStart=null,this.hitboxEnd=null,this.calculateEndPosition(1)}addHitboxStart(t){return t.bone=this,this.kinematicObject.hitboxes.push(t),this.hitboxStart=t,this}addHitboxEnd(t){return t.bone=this,this.kinematicObject.hitboxes.push(t),this.hitboxEnd=t,this}addChild(t){t.parent=this,this.children.push(t)}calculateEndPosition(t,e=0){this.hitboxStart&&(this.hitboxStart.x=this.x,this.hitboxStart.y=this.y),this.worldAngle=this.angle+e,this.kinematicObject&&this.kinematicObject.invertX?this.endX=this.x-Math.cos(this.worldAngle)*this.length*t:this.endX=this.x+Math.cos(this.worldAngle)*this.length*t,this.endY=this.y+Math.sin(this.worldAngle)*this.length*t,this.hitboxEnd&&(this.hitboxEnd.x=this.endX,this.hitboxEnd.y=this.endY);for(const e of this.children)e.x=this.endX,e.y=this.endY,e.calculateEndPosition(t,this.worldAngle)}render(t){e(t,"black"),t.lineWidth=15,t.lineCap="round",i(t)(),ctxMoveTo(t,this.x,this.y),ctxLineTo(t,this.endX,this.endY),t.stroke();for(const e of this.children)e.render(t)}}class x extends b{constructor(t,e,s="kinematicObject"){super(t,e,s),this.rootBone=new y(0,0,this),this.bones=[],this.lastMorph={poseId:null,duration:1,data:{}},this.morphQueue=[],this.morphFrom=[],this.morphTo=[],this.morphDuration=1,this.morphTimer=0,this.invertX=!1,this.state=1,this.subState=0,this.sizing=1,this.lastPunch=0,this.poseDefs=[[]],this.tailWiggle=[],this.walkSpeed=100,this.hitboxes=[],this.forceX=0,this.forceY=0,this.kiTarget=null,this.kiTargetReached=null,this.hp=100,this.fadeTimeout=2,this.fadeDuration=1,this.fadeTimer=0,this.updateSizing()}getHitboxes(t=!1){return this.hitboxes.filter(e=>t?3==e.type:3!=e.type)}addBone(t,e,s,i=BONE_ROOT){let h=new y(e,s,this);return this.bones[t]=h,this.bones[i].addChild(h),h}updateSizing(){this.sizing=this.y/1080}updateAngles(){this.rootBone.x=0,this.rootBone.y=0,this.rootBone.calculateEndPosition(this.sizing)}getPoseDefinition(t){return[]}pose(e){const s=this.poseDefs[e];for(let e=0;e<s.length;e++)this.bones[e].angle=t(s[e]);this.updateAngles()}morph(e,s,i){if(this.lastMorph={poseId:e,duration:s,data:i},this.morphFrom=this.bones.map(t=>t.angle),e)this.morphTo=this.poseDefs[e].map(e=>t(e)),4===e?this.lastPunch=1:5===e&&(this.lastPunch=2);else if(1===this.state){let e=5;this.morphTo=this.poseDefs[1].map(s=>t(s+Math.random()*e-e/2))}this.tailWiggle.forEach(e=>{this.morphTo[e[0]]=t(e[1]+Math.random()*e[2])}),this.morphDuration=s,this.morphTimer=s}clearMorph(){this.morphQueue=[]}queueMorph(t,e,s=!1,i={},h=0){if(s&&(this.clearMorph(),this.morphTimer=0),this.morphQueue.push({poseId:t,duration:e,data:i,mutatePose:h}),this.morphTimer<=0){const t=this.morphQueue.shift();this.morph(t.poseId,t.duration,t.data,t.mutatePose)}}update(t){super.update(t),this.kiUpdate&&this.kiUpdate(t),0!=this.forceX&&(this.x+=this.forceX*t,this.forceX*=.9,Math.abs(this.forceX)<.05&&(this.forceX=0)),this.updateSizing(),this.hp<=0&&(6!==this.state&&(this.state=6,this.fadeTimer=0,this.ttl=this.fadeTimeout+this.fadeDuration+.5),this.fadeTimer+=t),this.updateMorph(t)}updateMorph(t){if(this.morphTimer>0){this.morphTimer<t&&(t=this.morphTimer);for(let e=0;e<this.morphFrom.length;e++){let s=(this.morphTo[e]+100-(this.morphFrom[e]+100))/(this.morphDuration/t);this.bones[e].angle+=s}if(this.updateAngles(),this.morphTimer-=t,this.morphTimer<=0&&this.morphQueue.length>0){let t=this.morphQueue.shift();10==t.poseId?(this.checkAttackHitboxes(),t=this.morphQueue.shift()):17==t.poseId&&(this.handleThrow(),t=this.morphQueue.shift()),t&&this.morph(t.poseId,t.duration,t.data)}}if(0===this.morphQueue.length)if(2===this.state){let t=3==this.lastMorph.poseId?2:3;this.queueMorph(t,.5)}else 6===this.state?13!==this.lastMorph.poseId&&this.queueMorph(13,.4,!0):this.queueMorph(null,.6)}handleThrow(){}handleHit(){}checkAttackHitboxes(){let t=this.getHitboxes(!0);t.length>0&&this.game.getGameObjects().filter(t=>t.type!=this.type&&t.hp>0&&t!==this&&t.y>this.y-30&&t.y<this.y+30&&8!=t.state).forEach(e=>{e.getHitboxes().forEach(s=>{let i=t.find(t=>t.intersects(s));if(i){"cat"==this.type&&(this.score+=1),this.game.sfxPlayer.playAudio("hit");let t=e.x>this.x?1:-1;e.forceX=500*t,3!=e.state&&(e.hp-=i.dmg,s.poseId&&(e.queueMorph(s.poseId,.1,!0),e.queueMorph(1,.2)),e.handleHit());let h=i.getWorldRect();for(let t=0;t<10;t++)e.addParticle(h.x,h.y)}})})}renderShadow(t,e,h,n,a){u(t),s(t,"#0001"),[1,.8,.6,.4].forEach(s=>{i(t),r(t,e,h,n*s*this.sizing,a*s*this.sizing,0,0,2*Math.PI),o(t)}),p(t)}renderHitboxes(t){this.hitboxes.forEach(e=>{e.render(t)})}kiWalk(t){if(null==this.kiTarget)return;let e=this.state,s=this.kiTarget.x-this.x;this.invertX=s<0,s=this.kiTarget.x-this.x+180*(this.invertX?1:-1)*this.sizing;let i=this.kiTarget.y-this.y,h=Math.sqrt(s*s+i*i);if(h>10){this.state=2,2!=e&&this.queueMorph(3,.2,!0);let n=this.x+s/h*this.walkSpeed*t,a=this.y+i/h*this.walkSpeed*t,r=this.game.enemies.find(t=>{if(t==this)return!1;let e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)<120*this.sizing});r&&(s=this.x-r.x,i=this.y-r.y,h=Math.sqrt(s*s+i*i),n=this.x+s/h*this.walkSpeed*t,a=this.y+i/h*this.walkSpeed*t),this.x=n,this.y=a}else this.state=1,2==e&&this.queueMorph(1,.2,!0),this.kiTargetReached&&this.kiTargetReached()}}const k=40,w=12,S=15,T=16,M=17,B=18,P=[];P[0]=-90,P[1]=150,P[2]=30,P[3]=190,P[4]=20,P[5]=0,P[6]=100,P[7]=40,P[8]=-100,P[9]=-100,P[10]=-50,P[11]=-100,P[12]=-10,P[13]=110,P[14]=90,P[S]=0,P[T]=-20,P[M]=65,P[B]=62;const I=[...P];I[1]=150,I[2]=30,I[3]=190,I[4]=20,I[5]=4;const C=[...P];C[1]=190,C[2]=20,C[3]=150,C[4]=30,C[5]=0;const O=[...P];O[7]=-15,O[8]=-10,O[1]=140,O[2]=40,O[3]=200,O[5]=10;const j=[...P];j[7]=110,j[8]=-90,j[10]=-160,j[11]=-10,j[1]=145,j[2]=40,j[3]=190,j[5]=10;const v=[...P];v[1]=40,v[2]=90,v[5]=-40,v[3]=185,v[7]=80,v[8]=-150,v[10]=-0,v[11]=-130;const A=[...P];A[1]=90,A[2]=10,A[5]=-40,A[3]=185,A[7]=80,A[8]=-150,A[10]=-0,A[11]=-130;const E=[...P];E[5]=60,E[7]=50,E[10]=-130,E[12]=40,E[3]=170;const R=[...P];R[7]=0,R[8]=-100,R[10]=-30,R[11]=-50,R[1]=110,R[2]=70,R[3]=180,R[4]=20;const D=[...P];D[0]=-110,D[5]=30,D[12]=30;const z=[...P];z[5]=-15,z[12]=-15;const X=[...P];X[0]=-170,X[5]=-10,X[12]=-30,X[1]=170,X[7]=-80,X[8]=-40,X[10]=-20,X[11]=-60;const H="round",L="butt";class Y extends x{constructor(t,e,s="cat"){super(t,e,s),this.giColors=["#fff","#aaa"],this.poseDefs[1]=P,this.poseDefs[2]=I,this.poseDefs[3]=C,this.poseDefs[4]=O,this.poseDefs[5]=j,this.poseDefs[6]=v,this.poseDefs[7]=A,this.poseDefs[8]=E,this.poseDefs[9]=R,this.poseDefs[12]=D,this.poseDefs[11]=z,this.poseDefs[13]=X,this.poseDefs[14]=P,this.tailWiggle=[[19,-130,80],[20,-60,120],[21,-60,120]],this.createBones(),this.updateSizing()}createBones(){this.rootBone=new y(185,-90,this),this.bones[0]=this.rootBone,this.addBone(1,100,t(60),0),this.addBone(2,80,t(30),1).addHitboxEnd(new f(0,0,40,40,3,null,20)),this.addBone(3,100,t(100),0),this.addBone(4,80,t(20),3),this.addBone(5,100,t(-90),0).addHitboxStart(new f(0,0,100,100,2,12)).addHitboxEnd(new f(0,0,100,100,1,11)),this.addBone(w,50,t(-10),5),this.addBone(6,10,t(80),5),this.addBone(7,80,t(40),6),this.addBone(8,80,t(-100),7).addHitboxEnd(new f(0,0,40,40,3)),this.addBone(9,10,t(-100),5),this.addBone(10,80,t(-30),9),this.addBone(11,80,t(-90),10).addHitboxEnd(new f(0,0,40,40,3)),this.addBone(13,k*this.sizing*.55,t(0),w),this.addBone(14,k*this.sizing*1.15,t(0),w),this.addBone(S,k*this.sizing*1.8,t(0),w),this.addBone(T,k*this.sizing*1.8,t(-20),w),this.addBone(M,k*this.sizing*.95,t(70),w),this.addBone(B,k*this.sizing*.75,t(65),w),this.addBone(19,60,t(-90),0),this.addBone(20,60,t(45),19),this.addBone(21,60,t(-45),20),this.pose(1),this.updateAngles()}renderCat(t,s,a=!0){if(e(s,"black"),l(s,40*this.sizing),s.lineCap="round",i(s),h(s,t.x,t.y),n(s,t.endX,t.endY),d(s),a)for(const e of t.children)this.renderCat(e,s,!0)}renderSuit(t,e,s=!0,i=1){[[50,this.giColors[1],L],[48,this.giColors[0],H]].forEach(([h,n,a])=>{h*=i,this.renderBoneLine(t,e,h*this.sizing,n,a,s)})}renderBoneLine(t,s,a,r,o,c=!0){if(e(s,r),l(s,a),s.lineCap=o||H,0==t.children.length&&(s.lineCap=L),i(s),h(s,t.x,t.y),n(s,t.endX,t.endY),d(s),c)for(const e of t.children)this.renderBoneLine(e,s,a,r,c)}renderShadow(t){super.renderShadow(t,this.bones[0].x,this.bones[0].y,90,15)}render(r){r.save(),r.translate(this.x,this.y),this.renderShadow(r),this.renderCat(this.bones[6],r),this.renderSuit(this.bones[6],r),this.renderCat(this.bones[1],r),this.renderSuit(this.bones[1],r),e(r,"#000"),l(r,15*this.sizing),r.lineCap="round",i(r),h(r,this.bones[19].x,this.bones[19].y),c(r,this.bones[20].x,this.bones[20].y,this.bones[21].x,this.bones[21].y,this.bones[21].endX,this.bones[21].endY),d(r),this.renderSuit(this.bones[5],r,!1,1.4),this.renderCat(this.bones[3],r),this.renderSuit(this.bones[3],r),this.renderCat(this.bones[9],r),this.renderSuit(this.bones[9],r),s(r,"#000");let u=this.bones[12];i(r),a(r,u.endX,u.endY,k*this.sizing,0,2*Math.PI),o(r),s(r,"#000"),i(r),a(r,this.bones[13].endX,this.bones[13].endY,28*this.sizing,0,2*Math.PI),o(r),s(r,"#844"),i(r),a(r,this.bones[14].endX,this.bones[14].endY,5*this.sizing,0,2*Math.PI),o(r),[S,T].forEach(e=>{s(r,"#000"),i(r),l(r,1),h(r,u.endX,u.endY),n(r,this.bones[e].endX,this.bones[e].endY);let a=this.bones[e].worldAngle-t(90*(this.invertX?-1:1)),d=u.endX+Math.cos(a)*k*.8*this.sizing,c=u.endY+Math.sin(a)*k*.8*this.sizing;n(r,d,c),o(r)}),[M,B].forEach(t=>{i(r),s(r,"#ff0"),a(r,this.bones[t].endX,this.bones[t].endY,3*this.sizing,0,2*Math.PI),o(r)}),this.renderHitboxes(r),r.restore(),this.renderParticles(r)}kiUpdate(t){0===this.game.cutscene.length&&null==this.kiTarget||this.kiWalk(t)}}class W extends Y{constructor(t,e,s=1){super(t,e),this.playerNumber=s,this.score=0,this.maxHp=100,this.stamina=100,this.walkSpeed=250,this.playerStatsIndex=s-1,this.staminaRecharge=0}setStats(t){this.game=t,this.hp=t.playerStats[this.playerStatsIndex].hp,this.maxHp=t.playerStats[this.playerStatsIndex].maxHp,this.score=t.playerStats[this.playerStatsIndex].score,this.stamina=t.playerStats[this.playerStatsIndex].stamina}storeStats(){this.game&&(this.game.playerStats[this.playerStatsIndex].hp=this.hp,this.game.playerStats[this.playerStatsIndex].maxHp=this.maxHp,this.game.playerStats[this.playerStatsIndex].score=this.score,this.game.playerStats[this.playerStatsIndex].stamina=this.stamina)}update(t){if(this.stamina<100&&(this.staminaRecharge+=10*t,this.staminaRecharge>=1)){let t=Math.floor(this.staminaRecharge);this.stamina+=t,this.stamina>100&&(this.stamina=100),this.staminaRecharge-=t}this.storeStats(),document.querySelector(".stats .health .healthbar").style.width=Math.floor(this.hp/100*100)+"%",document.querySelector(".stats .stamina .staminabar").style.width=Math.floor(this.stamina/100*100)+"%";let e=this.state;if(this.hp<=0)return this.state=6,6!=e&&this.queueMorph(13,.8,!0),super.update(t),void(document.querySelector(".gameover").style.opacity=1);let s=!0,i=!0;if(s&&this.game.getActionState(Pt)&&(this.state=3,3!=e&&this.queueMorph(9,.1,!0),s=!1,i=!1),s&&this.game.getActionState(qt)&&(this.stamina>20&&(this.state=5,5!=e&&(this.queueMorph(6,.1,!0),this.queueMorph(7,.1),this.queueMorph(10,0),this.game.sfxPlayer.playAudio("swoosh"),this.stamina-=20)),s=!1,i=!1),s&&this.game.getActionState(It)){if(this.stamina>5&&(this.state=4,4!=e)){let t=1==this.lastPunch?5:4;this.queueMorph(t,.1,!0),this.queueMorph(10,0),this.game.sfxPlayer.playAudio("swoosh"),this.stamina-=5}s=!1,i=!1}if(this.stamina<0&&(this.stamina=0),i){let e=this.game.getActionState(St),i=this.game.getActionState(Tt),h=this.game.getActionState(Mt),n=this.game.getActionState(Bt);e&&(this.x-=this.walkSpeed*e*t,this.state=2,s=!1,this.invertX=!0),i&&(this.x+=this.walkSpeed*i*t,this.state=2,s=!1,this.invertX=!1),h&&(this.y-=.8*this.walkSpeed*h*t,this.state=2,s=!1),n&&(this.y+=.8*this.walkSpeed*n*t,this.state=2,s=!1)}this.game.cutsceneRunning||(this.y<650&&(this.y=650),this.y>1050&&(this.y=1050),this.x<100&&(this.x=100),this.x>1820&&(this.x=1820)),s?(this.state=1,1!==e&&this.queueMorph(1,.2,!0)):2===this.state&&2!==e&&this.queueMorph(3,100/this.walkSpeed,!0),super.update(t)}}class K extends b{constructor(t,e,s,i,h,n){super(t,e,"projectile"),this.h=s,this.dx=i,this.dy=h,this.owner=n,this.ttl=4,this.sink=1,this.radius=30,this.rot=0}update(t){this.x+=this.dx*t,this.y+=this.dy*t,this.ttl-=t,this.rot+=10*t;let e=this.getH(),s=new f(this.x,this.y+e,this.radius,this.radius);this.game.getGameObjects("cat").filter(t=>t.hp>0&&t!==this&&t.y>this.y-30&&t.y<this.y+30).forEach(t=>{t.getHitboxes().forEach(e=>{let i=s.intersects(e)?e:null;if(i){if(this.game.sfxPlayer.playAudio("hit"),3==t.state)return this.ttl=1,this.dx*=-1,void(this.dy=300*Math.random()-150);this.ttl=-1;let s=t.x>this.x?1:-1;t.forceX=500*s,t.hp-=10,e.poseId&&(t.queueMorph(e.poseId,.1,!0),t.queueMorph(1,.2));let h=i.getWorldRect();for(let e=0;e<10;e++)t.addParticle(h.x,h.y)}})})}getH(){let t=this.h;return this.ttl<this.sink&&(t=this.h*(this.ttl/this.sink)),t}render(t){let e=this.getH();u(t),m(t,this.x,this.y+e),s(t,"#0001"),[1,.8,.6,.4].forEach(s=>{i(t),r(t,0,-e,this.radius*s,this.radius*s*.5,0,0,2*Math.PI),o(t)}),t.rotate(this.rot),i(t),h(t,-10,-10),a(t,0,0,this.radius,0,Math.PI/4),s(t,"yellow"),o(t),t.closePath(),p(t)}}const G=12,U=17,F=18,N=[];N[0]=-90,N[1]=150,N[2]=30,N[3]=190,N[4]=20,N[5]=10,N[6]=100,N[7]=40,N[8]=-100,N[9]=-100,N[10]=-50,N[11]=-100,N[12]=8,N[13]=30,N[14]=90,N[15]=0,N[16]=-40,N[U]=65,N[F]=62;const $=[...N];$[1]=150,$[2]=30,$[3]=190,$[4]=20;const Q=[...N];Q[1]=190,Q[2]=20,Q[3]=150,Q[4]=30;const J=[...N];J[7]=-15,J[8]=-10,J[1]=160,J[2]=40,J[3]=200;const _=[...N];_[7]=110,_[8]=-90,_[10]=-160,_[11]=-10,_[1]=160,_[2]=40,_[3]=200;const V=[...N];V[1]=40,V[2]=90,V[5]=-40,V[3]=185,V[7]=80,V[8]=-150,V[10]=-0,V[11]=-130;const Z=[...N];Z[1]=90,Z[2]=10,Z[5]=-40,Z[3]=185,Z[7]=80,Z[8]=-150,Z[10]=-0,Z[11]=-130;const tt=[...N];tt[5]=60,tt[7]=50,tt[10]=-130,tt[12]=40,tt[3]=170;const et=[...N];et[7]=0,et[8]=-100,et[10]=-30,et[11]=-50,et[1]=110,et[2]=70,et[3]=180,et[4]=20;const st=[...N];st[0]=-110,st[5]=30,st[12]=30;const it=[...N];it[5]=-15,it[12]=-15;const ht=[...N];ht[0]=-170,ht[5]=-10,ht[12]=-30,ht[1]=170,ht[7]=-80,ht[8]=-40,ht[10]=-20,ht[11]=-60;const nt=[...N];nt[7]=-140,nt[8]=20,nt[10]=-120,nt[11]=-30;const at=[...N];at[7]=-10,at[8]=-10,at[10]=-20,at[11]=-120;const rt=[...N];rt[0]=-175,rt[5]=60,rt[7]=10,rt[8]=-120,rt[10]=-10,rt[11]=-30,rt[1]=150,rt[2]=90,rt[12]=50,rt[15]=20,rt[16]=-80,rt[14]=100;const ot="round",dt="butt",lt=["#462626","#777","#494034"],ct=["#000","#010","#100","#002"],ut={PUNCH:{state:4,poses:[[4,.2]]},KICK:{state:5,poses:[[6,.2],[7,.2]]},PUNCH2:{state:4,poses:[[5,.2]]}};class pt extends x{constructor(t,e,s="rat"){super(t,e,s),this.giColors=[ct[Math.floor(Math.random()*ct.length)],"#333"],this.fur=lt[Math.floor(Math.random()*lt.length)],this.walkSpeed=120+60*Math.random(),this.renderEars=!0,this.isThrower=!1,this.hp=100,this.knockdownInterval=30,this.nextKnockdown=this.hp-this.knockdownInterval,this.knockdownTime=2,this.knockdownTimer=0,this.poseDefs[1]=N,this.poseDefs[2]=$,this.poseDefs[3]=Q,this.poseDefs[4]=J,this.poseDefs[5]=_,this.poseDefs[6]=V,this.poseDefs[7]=Z,this.poseDefs[8]=tt,this.poseDefs[9]=et,this.poseDefs[12]=st,this.poseDefs[11]=it,this.poseDefs[13]=ht,this.poseDefs[14]=N,this.poseDefs[15]=nt,this.poseDefs[16]=at,this.poseDefs[18]=rt,this.attackFrequency=1.5,this.attackDuration=.5,this.attackTimer=1.3,this.attackPoseIdx=0,this.attackPattern=["PUNCH","KICK","PUNCH2","PUNCH","KICK"],this.tailWiggle=[[19,-130,80],[20,-60,120],[21,-60,120]],this.createBones(),this.updateSizing()}handleHit(){this.hp<=0||this.hp<=this.nextKnockdown&&8!=this.state&&(this.state=8,this.knockdownTimer=0,this.queueMorph(18,.5,!0),this.nextKnockdown=this.hp-this.knockdownInterval)}createBones(){this.rootBone=new y(155,-90,this),this.bones[0]=this.rootBone,this.addBone(1,90,t(60),0),this.addBone(2,60,t(30),1).addHitboxEnd(new f(0,0,40,40,3)),this.addBone(3,90,t(100),0),this.addBone(4,60,t(20),3),this.addBone(5,80,t(-100),0).addHitboxStart(new f(0,0,100,100,2,12)),this.addBone(G,40,t(-10),5).addHitboxEnd(new f(0,0,100,80,1,11)),this.addBone(6,10,t(80),5),this.addBone(7,80,t(40),6),this.addBone(8,80,t(-100),7).addHitboxEnd(new f(0,0,40,40,3)),this.addBone(9,10,t(-100),5),this.addBone(10,80,t(-30),9),this.addBone(11,80,t(-90),10).addHitboxEnd(new f(0,0,40,40,3)),this.addBone(13,22,t(0),G),this.addBone(14,100,t(0),G),this.addBone(15,48,t(0),G),this.addBone(16,48,t(-20),G),this.addBone(U,38,t(70),G),this.addBone(F,30,t(65),G),this.addBone(19,60,t(-90),0),this.addBone(20,60,t(45),19),this.addBone(21,60,t(-45),20),this.pose(1),this.updateAngles()}kiUpdate(t){if(this.state,6!==this.state)if(this.game.cutsceneRunning)this.kiWalk(t);else{if(8===this.state)return this.knockdownTimer+=t,void(this.knockdownTimer>=this.knockdownTime&&(this.state=1,this.knockdownTimer=0,this.queueMorph(1,1,!0)));if(null==this.kiTarget){let t=this.game.getGameObjects(["cat","player"]);this.kiTarget=t[Math.floor(Math.random()*t.length)]}else{this.attackTimer+=t;let e=this.kiTarget.x-this.x,s=Math.abs(this.kiTarget.y-this.y),i=Math.sqrt(e*e+s*s);if(this.invertX=e<0,i<200*this.sizing&&s<9){if(this.attackTimer>this.attackFrequency){this.attackTimer=0,this.attackPoseIdx=(this.attackPoseIdx+1)%this.attackPattern.length;let t=ut[this.attackPattern[this.attackPoseIdx]];this.state=t.state,t.poses.forEach(t=>{this.queueMorph(t[0],t[1])}),this.queueMorph(10,0),this.queueMorph(1,.2)}}else s<30&&Math.abs(e)>300*this.sizing&&this.isThrower?this.attackTimer>this.attackFrequency&&(this.attackTimer=0,this.state=7,this.queueMorph(15,.5,!0),this.queueMorph(16,.2),this.queueMorph(17,0)):this.kiWalk(t)}}}renderRat(t,s,a=!0){if(e(s,this.fur),l(s,40*this.sizing),s.lineCap="round",i(s),h(s,t.x,t.y),n(s,t.endX,t.endY),d(s),a)for(const e of t.children)this.renderRat(e,s,!0)}renderSuit(t,e,s=!0,i=1){[[50,this.giColors[1],dt],[48,this.giColors[0],ot]].forEach(([h,n,a])=>{h*=i,this.renderBoneLine(t,e,h*this.sizing,n,a,s)})}renderBoneLine(t,s,a,r,o,c=!0){if(e(s,r),l(s,a),s.lineCap=o||ot,0==t.children.length&&(s.lineCap=dt),i(s),h(s,t.x,t.y),n(s,t.endX,t.endY),d(s),c)for(const e of t.children)this.renderBoneLine(e,s,a,r,c)}renderShadow(t){super.renderShadow(t,this.bones[0].x,this.bones[0].y,90,15)}render(t){var r;t.save(),this.fadeTimer>this.fadeTimeout&&(t.globalAlpha=(r=1-(this.fadeTimer-this.fadeTimeout)/this.fadeDuration,Math.max(0,Math.min(1,r)))),t.translate(this.x,this.y),this.renderShadow(t),this.renderRat(this.bones[6],t),this.renderSuit(this.bones[6],t),this.renderRat(this.bones[1],t),this.renderSuit(this.bones[1],t),e(t,this.fur),l(t,15*this.sizing),t.lineCap="round",i(t),h(t,this.bones[19].x,this.bones[19].y),c(t,this.bones[20].x,this.bones[20].y,this.bones[21].x,this.bones[21].y,this.bones[21].endX,this.bones[21].endY),d(t),this.renderSuit(this.bones[5],t,!1,1.8),this.renderRat(this.bones[3],t),this.renderSuit(this.bones[3],t),this.renderRat(this.bones[9],t),this.renderSuit(this.bones[9],t),this.renderEars&&(s(t,this.fur),i(t),a(t,this.bones[15].endX,this.bones[15].endY,40*this.sizing*.6,0,2*Math.PI),o(t)),s(t,this.fur);let u=this.bones[12];i(t),a(t,u.endX,u.endY,40*this.sizing,0,2*Math.PI),o(t),s(t,this.fur),i(t),h(t,this.bones[13].endX,this.bones[13].endY),n(t,this.bones[14].endX,this.bones[14].endY),n(t,this.bones[12].x,this.bones[12].y),o(t),s(t,"#844"),i(t),a(t,this.bones[14].endX,this.bones[14].endY,5*this.sizing,0,2*Math.PI),o(t),this.renderEars&&(s(t,this.fur),i(t),a(t,this.bones[16].endX,this.bones[16].endY,40*this.sizing*.6,0,2*Math.PI),o(t),s(t,"#844"),i(t),a(t,this.bones[16].endX,this.bones[16].endY,40*this.sizing*.5,0,2*Math.PI),o(t)),[U,F].forEach(e=>{i(t),s(t,"#f00"),a(t,this.bones[e].endX,this.bones[e].endY,3*this.sizing,0,2*Math.PI),o(t)}),this.renderHitboxes(t),this.renderSpecials(t),t.restore(),this.renderParticles(t)}renderSpecials(t){}handleThrow(){let t=this.bones[8].endX+this.x,e=this.y,s=this.bones[8].endY,i=300*(this.invertX?-1:1);this.game.addGameObject(new K(t,e,s,i,0,this))}}const mt=18;class gt extends pt{constructor(t,e){super(t,e),this.bones[0].length=80,this.bones[5].length=60,this.bones[1].length=50,this.bones[2].length=30,this.bones[3].length=50,this.bones[4].length=30,this.bones[10].length=50,this.bones[11].length=40,this.bones[7].length=50,this.bones[8].length=40,this.bones[mt].length=20,this.fur="#222",this.giColors=["#000","#333"],this.renderEars=!1,this.invertX=!0}renderSpecials(t){[mt].forEach(s=>{i(t),e(t,"#a60"),t.lineWidth=2,a(t,this.bones[s].endX,this.bones[s].endY,10*this.sizing,0,2*Math.PI),d(t)});let s=this.bones[16],r=s.endX-s.x,o=s.endY-s.y;i(t),e(t,"#000"),t.lineWidth=90*this.sizing,h(t,s.x+.5*r,s.y+.5*o),n(t,s.x+.6*r,s.y+.6*o),d(t),i(t),t.lineWidth=60*this.sizing,h(t,s.x+.5*r,s.y+.5*o),n(t,s.x+1.5*r,s.y+1.5*o),d(t)}}const bt=(t,e)=>t.addGameObject(e),ft=(t,e,s="center")=>{t.texts=[{text:e,align:s}],t.nextText(),(t=>{t.cutsceneCallback=t=>{t.nextCutscene()}})(t)},yt=(t,e)=>{t.sceneWonCallback=t=>{0===t.getGameObjects(["rat"]).length&&t.initObjects(e)}},xt=[];function kt(){let t,e,s,i,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,e,s){let i,h,n,r,d,l,c=o[t.i[0]],u=t.i[1],p=t.i[3]/32,m=o[t.i[4]],g=t.i[5],b=t.i[8]/32,f=t.i[9],y=t.i[10]*t.i[10]*4,x=t.i[11]*t.i[11]*4,k=t.i[12]*t.i[12]*4,w=1/k,S=-t.i[13]/16,T=t.i[14],M=s*2**(2-t.i[15]),B=new Int32Array(y+x+k),P=0,I=0;for(i=0,h=0;i<y+x+k;i++,h++)h>=0&&(T=T>>8|(255&T)<<4,h-=M,d=a(e+(15&T)+t.i[2]-128),l=a(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,i<y?n=i/y:i>=y+x&&(n=(i-y-x)*w,n=(1-n)*3**(S*n)),P+=d*n**p,r=c(P)*u,I+=l*n**b,r+=m(I)*g,f&&(r+=(2*Math.random()-1)*f),B[i]=80*r*n|0;return B},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){let e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,s=0,i=n.rowLen*n.patternLen*(e+1)*2,h=new Int32Array(i)},this.generate=function(){let a,d,l,c,u,p,m,g,b,f,y,x,k,w,S=new Int32Array(i),T=t.songData[s],M=t.rowLen,B=t.patternLen,P=0,I=0,q=!1,C=[];for(l=0;l<=e;++l)for(m=T.p[l],c=0;c<B;++c){let t=m?T.c[m-1].f[c]:0;t&&(T.i[t-1]=T.c[m-1].f[c+B]||0,t<17&&(C=[]));let e=o[T.i[16]],s=T.i[17]/512,i=2**(T.i[18]-9)/M,O=T.i[19],j=T.i[20],v=43.23529*T.i[21]*3.141592/44100,A=1-T.i[22]/255,E=1e-5*T.i[23],R=T.i[24]/32,D=T.i[25]/512,z=6.283184*2**(T.i[26]-9)/M,X=T.i[27]/255,H=T.i[28]*M&-2;for(y=(l*B+c)*M,u=0;u<4;++u)if(p=m?T.c[m-1].n[c+u*B]:0,p){C[p]||(C[p]=r(T,p,M));let t=C[p];for(d=0,a=2*y;d<t.length;d++,a+=2)S[a]+=t[d]}for(d=0;d<M;d++)g=2*(y+d),f=S[g],f||q?(x=v,O&&(x*=e(i*g)*s+.5),x=1.5*Math.sin(x),P+=x*I,k=A*(f-I)-P,I+=x*k,f=3==j?I:1==j?k:P,E&&(f*=E,f=f<1?f>-1?n(.25*f):-1:1,f/=E),f*=R,q=f*f>1e-5,b=Math.sin(z*g)*D+.5,w=f*(1-b),f*=b):w=0,g>=H&&(w+=S[g-H+1]*X,f+=S[g-H]*X),S[g]=0|w,S[g+1]=0|f,h[g]+=0|w,h[g+1]+=0|f}return s++,s/t.numChannels},this.createAudioBuffer=function(t){let e=t.createBuffer(2,i/2,44100);for(let t=0;t<2;t++){let s=e.getChannelData(t);for(let e=t;e<i;e+=2)s[e>>1]=h[e]/65536}return e},this.createWave=function(){let t=44+2*i-8,e=t-36,s=new Uint8Array(44+2*i);s.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(let t=0,e=44;t<i;++t){let i=h[t];i=i<-32767?-32767:i>32767?32767:i,s[e++]=255&i,s[e++]=i>>8&255}return s},this.getData=function(t,e){let s=2*Math.floor(44100*t),i=new Array(e);for(let n=0;n<2*e;n+=1){let e=s+n;i[n]=t>0&&e<h.length?h[e]/32768:0}return i}}xt[0]=t=>{setBackground("day"),t.gameObjects=[];let e=bt(t,new Y(-200,900)),s=bt(t,new gt(2100,800));s.walkSpeed=200;let i=bt(t,new pt(2200,700));i.walkSpeed=300;let h=bt(t,new pt(2200,1e3));h.walkSpeed=300,t.cutscene=[t=>{ft(t,"Welcome to Miami Mice!<br><br>Keyboard: WASD to move, H to punch, J to kick, B to block<br>Gamepad: Left stick to move, B to punch, A to kick, X to block<br><br>Press punch/kick to start","center")},t=>{ft(t,"Miami Beach, 1992.<br>The notorious Rat King has taken over the city and is terrorizing its citizens.<br>Only one hero can stop him...<br>Special Agent KUNG FURBALL!"),e.walkSpeed=300,e.kiTarget={x:400,y:900}},t=>{s.kiTarget={x:1400,y:880},s.kiTargetReached=()=>{s.kiTargetReached=null,t.nextCutscene()},i.kiTarget={x:1700,y:700},h.kiTarget={x:1700,y:1050}},t=>{ft(t,"Special Agent <b>KUNG FURBALL</b>:<br>I've tracked you down, Rat King!<br>Your reign of terror ends here!<br>You're under arrest!","left")},t=>{ft(t,"<b>RAT KING</b>: <br>Agent Furball! Finally, we meet in person.<br>So, the Feline Bureau of Investigation has come to play!<br><br>This is my city!<br>Stay out of my way!","right")},t=>{ft(t,"Special Agent <b>KUNG FURBALL</b>:<br>You may have the police in your pocket.<br> But I am the law!<br>The Feline Bureau of Investigation will bring you to justice!","left")},t=>{t.nextText(),s.queueMorph(3,.2,!0),s.kiTarget={x:2300,y:900},s.kiTargetReached=()=>{s.kiTargetReached=null,t.initObjects(1)},i.kiTarget={x:2400,y:700},h.kiTarget={x:2400,y:1200},t.keepObjects=[new W(e.x,e.y,1)]}],t.nextCutscene()},xt[1]=t=>{t.gameObjects=[],t.keepObjects.forEach(e=>bt(t,e)),t.keepObjects=[],bt(t,new pt(1800,900)),yt(t,2)},xt[2]=t=>{t.gameObjects=[],bt(t,new W(900,900,1)),bt(t,new pt(1800,800)),bt(t,new pt(1900,1e3)),bt(t,new pt(100,800)),bt(t,new pt(200,1e3)),yt(t,3)},xt[3]=t=>{setBackground("dusk"),t.gameObjects=[],bt(t,new Y(400,900));let e=bt(t,new gt(2100,1050));e.walkSpeed=200;let s=bt(t,new pt(2200,900));s.walkSpeed=300,t.cutscene=[t=>{e.kiTarget={x:1400,y:1050},e.kiTargetReached=()=>{e.kiTargetReached=null,t.nextCutscene()}},t=>{ft(t,"<b>RAT KING</b>: <br>I see, Master Splinter the traitor trained you well.<br>Hah! But you are no match for me, kitty!","right")},t=>{ft(t,"<b>RAT KING</b>:<br>May I introduce you to my best cheese thrower?<br>Il grande Alonzo Padano! <br>Prepare to meet your cheesy doom, Furball!","right"),s.kiTarget={x:1550,y:900}},t=>{t.nextText(),e.queueMorph(3,.2,!0),e.kiTarget={x:2300,y:1050},e.kiTargetReached=()=>{e.kiTargetReached=null,t.initObjects(4)},s.isThrower=!0,s.walkSpeed=100,t.keepObjects=[s]}],t.nextCutscene()},xt[4]=t=>{t.gameObjects=[],bt(t,new W(400,900,1)),bt(t,new pt(2100,750)),bt(t,new pt(2300,1e3)),t.keepObjects.forEach(e=>{e.kiTarget=null,bt(t,e)}),t.keepObjects=[],yt(t,5)},xt[5]=t=>{t.gameObjects=[],bt(t,new W(400,900,1)),bt(t,new pt(1800,800)).isThrower=!0,bt(t,new pt(1900,1e3)),bt(t,new pt(100,800)),bt(t,new pt(200,1e3)).isThrower=!0,yt(t,6)},xt[6]=t=>{setBackground("night"),t.gameObjects=[],bt(t,new Y(700,900));let e=bt(t,new gt(2100,1050));e.walkSpeed=200,t.cutscene=[t=>{e.kiTarget={x:1400,y:1050},e.kiTargetReached=()=>{e.kiTargetReached=null,t.nextCutscene()}},t=>{ft(t,"<b>RAT KING</b>: <br>What a shame! I am running out of kilobytes!<br>Ok, I will have to take matters into my own hands!<br>Showdown time!","right")},t=>{setTimeout(()=>t.initObjects(7),200)}],t.nextCutscene()},xt[7]=t=>{t.gameObjects=[],bt(t,new W(700,900,1)),bt(t,new gt(1450,1050)).hp=200,bt(t,new pt(1800,800)).isThrower=!0,bt(t,new pt(1900,1e3)),bt(t,new pt(100,800)),bt(t,new pt(200,1e3)).isThrower=!0,yt(t,8)},xt[8]=t=>{t.gameObjects=[],bt(t,new W(700,900,1)),t.cutscene=[t=>{ft(t,"<b>KUNG FURBALL</b>: <br>Finally, justice is served!","left")},t=>{t.texts=[{text:"Thank you for playing Miami Mice!<br>I hope you enjoyed the (short) game.<br><br>Made by: DerBenniBanni<br><br>Special thanks to Alkor and Randy Tayler for<br>excellent naming suggestions<br>and to Rob Louie for the knockdown gameplay hints.<br><br>Press action to restart.",align:"center"}],t.nextText(),q(".mainmenu").style.display=null,q(".miamimice").style.fontSize=null,q(".miamimice").style.opacity=null,q(".miamimice").style.top="5vh",q(".miamimice").style.zIndex=null,q(".neno"),t.cutsceneCallback=t=>{t.gameObjects=[],t.playerStats=[{hp:100,maxHp:100,score:0,stamina:100}],q(".intro").style.opacity="1",document.querySelectorAll(".mainmenu,.neon,.cast").forEach(t=>t.style.opacity=null),q(".mainmenu").style.display=null,q(".miamimice").style.fontSize=null,q(".miamimice").style.opacity=null,q(".miamimice").style.top=null,q(".miamimice").style.zIndex=null,t.nextText(),setBackground("day")}}],t.nextCutscene()},xt[9]=t=>{let e=Math.random();e<.33?setBackground("day"):e<.66?setBackground("dusk"):setBackground("night"),t.gameObjects=[],t.hordePlayer||(t.hordePlayer=new W(950,900,1)),bt(t,t.hordePlayer);for(let e=0;e<t.hordeStage;e++){let s=960+(Math.random()<.5?-1:1)*(960+200*e+80*Math.random()),i=350*Math.random()+700,h=bt(t,new pt(s,i));Math.random()<.5&&(h.isThrower=!0)}t.sceneWonCallback=e=>{0===e.getGameObjects(["rat"]).length&&(t.hordeStage++,e.initObjects(9))}};class wt{constructor(){this.sfx={}}add(t,e,s=!1){let i=new kt;for(i.init(e);i.generate()<1;);let h=i.createWave();this.sfx[t]=document.createElement("audio"),this.sfx[t].src=URL.createObjectURL(new Blob([h],{type:"audio/wav"})),this.sfx[t].loop=s,s&&this.sfx[t].addEventListener("timeupdate",function(){this.currentTime>this.duration-.15&&(this.currentTime=0,this.play())})}playAudio(t,e=!0){let s=this.sfx[t];s&&(e||s.paused)&&(s.currentTime=0,s.play())}stopAudio(t){let e=this.sfx[t];e&&(e.pause(),e.currentTime=0)}isPlaying(t){let e=this.sfx[t];return!!e&&!e.paused}}const St=0,Tt=1,Mt=2,Bt=3,Pt=4,It=5,qt=6,Ct={KeyA:St,KeyD:Tt,KeyW:Mt,KeyS:Bt,KeyB:Pt,KeyH:It,KeyJ:qt};class Ot{constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.isGameRunning=!1,this.gameObjects=[],this.enemies=[],this.lastUpdateTime=0,this.texts=[],this.txtPointer=-1,this.sfxPlayer=new wt,this.cutscene=[],this.cutsceneCallback=null,this.cutsceneSkip=.5,this.cutsceneRunning=!1,this.currentScene=null,this.sceneWonCallback=null,this.keys={},this.actions=[],this.hordeStage=0,this.hordePlayer=null,this.playerStats=[{hp:100,maxHp:100,score:0,stamina:100}],this.scoreElem=document.getElementById("sc"),window.addEventListener("keydown",t=>{t.code in Ct&&t.preventDefault(),this.keys[t.code]=!0,this.actions[Ct[t.code]]=1}),window.addEventListener("keyup",t=>{t.code in Ct&&t.preventDefault(),this.keys[t.code]=!1,this.actions[Ct[t.code]]=0})}nextCutscene(){this.cutsceneCallback=null,this.txtPointer=-1,this.cutsceneSkip=.5,this.texts=[],this.clearText(),this.cutscene.length>0&&(this.cutscene.shift()(this),this.cutsceneRunning=!0)}nextText(){let t=document.querySelector(".txt");this.txtPointer<this.texts.length-1?(this.txtPointer++,t.innerHTML=this.texts[this.txtPointer].text,t.style.textAlign=this.texts[this.txtPointer].align||"center",t.style.display="block"):this.clearText()}clearText(){let t=document.querySelector(".txt");t.innerHTML="",t.style.display="none"}getActionState(t){return this.actions[t]||0}addGameObject(t){return t.game=this,t.setStats&&t.setStats(this),this.gameObjects.push(t),t}startHorde(){this.hordeStage=1,this.start(9)}start(t=0){9!=t&&(this.hordeStage=0,this.hordePlayer=null),this.sfxPlayer.playAudio("gamemusic"),document.querySelectorAll(".mainmenu,.neon,.cast").forEach(t=>t.style.opacity=0),document.querySelector(".mainmenu").style.display="none",document.querySelector(".miamimice").style.fontSize="33vh",document.querySelector(".miamimice").style.opacity="0",document.querySelector(".miamimice").style.top="15vh",document.querySelector(".miamimice").style.zIndex="20",this.isGameRunning=!0,this.gameLoop(),this.initObjects(t)}initObjects(t){this.cutscene=[],this.cutsceneRunning=!1,this.currentScene=t,this.sceneWonCallback=null,xt[t](this)}retry(){document.querySelector(".gameover").style.opacity=0,this.gameObjects=[],this.enemies=[],this.playerStats[0].hp=this.playerStats[0].maxHp,this.playerStats[0].score=Math.round(.5*this.playerStats[0].score),this.initObjects(this.currentScene)}getGameObjects(t){return t?this.gameObjects.filter(e=>t.includes(e.type)):this.gameObjects}gameLoop(){if(!this.isGameRunning)return;const t=performance.now();let e=(t-this.lastUpdateTime)/1e3;this.lastUpdateTime=t,e=Math.min(e,.05),this.checkGamepads(),this.gameObjects=this.gameObjects.filter(t=>t.ttl>=0),this.gameObjects.sort((t,e)=>t.y-e.y),this.sceneWonCallback&&this.sceneWonCallback(this),this.update(e),this.render(),this.scoreElem.innerText=this.playerStats[0].score,requestAnimationFrame(()=>this.gameLoop())}checkGamepads(){if(!navigator.getGamepads)return;let t=navigator.getGamepads().filter(t=>t&&"standard"===t.mapping&&t.connected)[0];t&&(this.actions[qt]=t.buttons[0].pressed,this.actions[It]=t.buttons[1].pressed,this.actions[Pt]=t.buttons[2].pressed,this.actions[St]=t.axes[0]<-.2?-1*t.axes[0]:0,this.actions[Tt]=t.axes[0]>.2?t.axes[0]:0,this.actions[Mt]=t.axes[1]<-.2?-1*t.axes[1]:0,this.actions[Bt]=t.axes[1]>.2?t.axes[1]:0,t.buttons[15].pressed&&(this.actions[Tt]=1),t.buttons[14].pressed&&(this.actions[St]=1),t.buttons[12].pressed&&(this.actions[Mt]=1),t.buttons[13].pressed&&(this.actions[Bt]=1))}update(t){this.cutsceneCallback&&this.cutsceneSkip<0&&(this.actions[qt]||this.actions[It]||this.actions[Pt])&&this.cutsceneCallback(this),this.cutsceneSkip-=t,this.enemies=this.getGameObjects(["rat"]).filter(t=>t.hp>0),this.gameObjects.forEach(e=>{e.update(t)})}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.gameObjects.forEach(t=>{t.render(this.ctx)})}}const jt={songData:[{i:[0,194,128,0,2,69,128,35,0,0,5,0,60,76,0,0,0,131,4,1,2,64,128,32,61,89,4,0,0],p:[3,4,1,2,1,2,3,4,5,6,7,8,9,10,11,12,9,10,7,8,5,6,3,4,7,8],c:[{n:[103,,103,,103,,115,,103,,103,,103,,115,,103,,103,,103,,103,,103,,103,,103,,113,115],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,85,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[108,,108,,108,,120,,108,,108,,108,,120,,99,,99,,99,,99,,99,,99,,99,,109,111],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,85,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,113,115],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,85,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[108,,120,,108,,120,,108,,120,,108,,120,,99,,111,,99,,111,,99,,111,,99,,109,111],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,85,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[103,,115,,103,,113,115,103,,115,,103,,115,,103,,115,,103,,113,115,103,,115,,103,,115],f:[13,,,,,,13,,13,,,,,,,,,,,,,,13,,13,,,,,,,,85,,,,,,60,,85,,,,,,,,,,,,,,60,,85]},{n:[108,,120,,108,,118,120,108,,120,,108,,120,,99,,111,,99,,109,111,99,,111,,99,,111],f:[13,,,,,,13,,13,,,,,,,,,,,,,,13,,13,,,,,,,,85,,,,,,60,,85,,,,,,,,,,,,,,60,,85]},{n:[103,,115,,103,,113,115,103,,115,,103,,113,115,103,,115,,103,,113,115,103,,115,,103,,113,115],f:[13,,,,,,13,,13,,,,,,13,,13,,,,,,13,,13,,,,,,13,,85,,,,,,60,,85,,,,,,60,,85,,,,,,60,,85,,,,,,60]},{n:[108,,120,,108,,118,120,108,,120,,108,,118,120,99,,111,,99,,109,111,99,,111,,99,,109,111],f:[13,,,,,,13,,13,,,,,,13,,13,,,,,,13,,13,,,,,,13,,85,,,,,,60,,85,,,,,,60,,85,,,,,,60,,85,,,,,,60]},{n:[103,,113,115,103,,113,115,103,,113,115,103,,113,115,103,,113,115,103,,113,115,103,,113,115,103,,113,115],f:[13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60]},{n:[108,,118,120,108,,118,120,108,,118,120,108,,118,120,99,,109,111,99,,109,111,99,,109,111,99,,109,111],f:[13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60,,85,,60]},{n:[103,103,115,115,103,103,113,115,103,103,115,115,103,103,113,115,103,103,115,115,103,103,113,115,103,103,115,115,103,103,113,115],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[108,108,120,120,108,108,118,120,108,108,120,120,108,108,118,120,99,99,111,111,99,99,109,111,99,99,111,111,99,99,109,111],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]}]},{i:[0,255,116,85,0,255,116,0,37,0,4,6,64,99,0,0,0,0,0,0,2,60,120,3,13,0,0,0,0],p:[,,1,1,1,1,1,1,1,1,1,1,1,1,3,2,1,1,1,1,1,1,1,1,1,1],c:[{n:[132,,,,144,,,,132,,,,144,,,,132,,,,144,,,,132,,,,144],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1]},{n:[,,,,,,,,,,,,,,,,159,159,,156,156,,152,152,,149,149,,144,,137],f:[,,,,,,,,,,,,,,,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13]},{n:[132],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,37,0,1,97,35,0,0,0,0,0,0,1,193,171,59,11,39,3,71,2],p:[1,2,1,2,1,2,1,2,1,1,1,1,1,1,2,1,1,1,2,1,2,1,2,1,1,1],c:[{n:[,,,,128,,,,,,,,128,,,,,,,,128,,,,,,,,128],f:[]},{n:[,,,,128,,,,,,,,128,,,,,,,,128,,,,,,,,128,,128],f:[]}]},{i:[0,92,128,0,2,37,140,0,0,0,7,0,93,103,0,0,0,131,8,1,2,20,0,24,4,89,4,123,4],p:[,,,,1,2,3,4,2,1,1,2,5,,,,,6,1,2,3,4,2,1],c:[{n:[139,,142,,144,,146,,147,,146,,142,,139,,139,,142,,144,,146,,147,,146,,142,,139],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,93]},{n:[139,139,142,142,144,144,146,146,147,147,146,146,142,142,139,139,139,139,142,142,144,144,146,146,147,147,146,146,142,142,139,139],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,57]},{n:[139,139,151,151,139,139,149,151,139,139,151,151,139,139,149,151,139,139,151,151,139,139,149,151,139,139,151,151,139,139,149,151],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,57]},{n:[144,144,156,156,144,144,156,156,144,144,156,156,144,144,156,156,147,147,159,159,147,147,159,159,147,147,159,159,147,147,157,159],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,57]},{n:[139],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24]},{n:[144,,,,,,,,,,,,,,,,147,,,,,,,,147],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24]}]}],rowLen:5513,patternLen:32,endPattern:25,numChannels:4},vt={songData:[{i:[3,40,96,27,2,36,97,0,128,255,13,39,65,35,83,5,0,24,7,1,3,5,235,141,120,0,0,0,0],p:[1],c:[{n:[141],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},At={songData:[{i:[0,0,92,0,0,0,92,0,0,80,20,0,53,32,0,0,0,231,6,1,3,89,93,97,31,0,0,0,0],p:[1],c:[{n:[141],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1};window.q=t=>document.querySelector(t),window.setBackground=t=>{let e=["#54f","#f47","#ff4"],s=["#ff4","#fa4","#40f","#ff9"],i="50vh";"night"==t?(e=["#115","#55f","#acf"],s=["#eff","#025","#001","#0af7"],i="40vh"):"dusk"==t&&(e=["#227","#c49","#ff4"],s=["#fc0","#d64","#00a","#ffa"],i="70vh"),document.querySelectorAll(".water").forEach(t=>{let s=t.gradScale,i="repeating-linear-gradient(90deg, transparent 0, #fff1 40px, #fff1 45px, transparent 80px)";i+=`,linear-gradient(90deg, ${e[0]} ${50-25*s}%, ${e[1]} ${50-15*s}%, ${e[2]} ${50-5*s}%, ${e[2]} ${50+5*s}%, ${e[1]} ${50+15*s}%, ${e[0]} ${50+25*s}%)`,t.firstElementChild.style.background=i,t.style.backgroundColor=e[0]});let h=q(".sky");h.style.height=i,h.style.background=`linear-gradient(0deg, ${s[3]} 0%, transparent 70%),radial-gradient(circle, ${s[0]} 10%, ${s[1]} 11%, ${s[2]} 75%)`},document.addEventListener("DOMContentLoaded",()=>{let t=q(".water");for(let e=0;e<45;e++){let s=t.cloneNode(!0);s.firstElementChild.style.animationDuration=2+2*Math.random()+"s",s.style.top=.5*e+32+"vh",s.gradScale=.7-e/90,document.body.insertBefore(s,t)}t.remove(),setBackground("day"),setTimeout(()=>{const t=new Ot("gameCanvas");window.gameStart=()=>{t.start()},window.gameStartHorde=()=>{t.startHorde()},window.gameRetry=()=>{t.retry()},t.sfxPlayer.add("gamemusic",jt,!0),t.sfxPlayer.add("hit",vt),t.sfxPlayer.add("swoosh",At),q(".load").remove(),q(".intro").style.opacity="1"},100)})</script>