<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta content="width=device-width,initial-scale=1" name="viewport"> <title>Shadow Alley</title> <style>#hud,.hint{opacity:.8}#tutorial,.kbd{background:#0f1320}body,html{height:100%;margin:0;background:#0b0d12;color:#dbe0ea;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}.wrap{display:grid;place-items:center;height:100%;gap:12px}canvas{background:#121621;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.45),inset 0 0 0 1px rgba(255,255,255,.04)}.hint{font-size:14px}.kbd{padding:2px 6px;border:1px solid #384152;border-bottom-width:2px;border-radius:6px;color:#c7cee0}a{color:#9ec5ff;text-decoration:none}#hud{width:100%;text-align:center;font:14px system-ui,sans-serif;color:#dbe0ea;pointer-events:none;margin-bottom:4px}#tutorial{border:1px solid #384152;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35),inset 0 0 0 1px rgba(255,255,255,.04);padding:12px;opacity:0}</style> </head> <body> <div class="wrap"> <div id="hud"> Level: <span class="kbd" id="levelCount"></span> Â· Fish: <span class="kbd" id="fishCount"></span> Â· <span id="doorState"></span> </div> <canvas aria-label="Shadow Alley" height="320" id="game" width="480"></canvas> <div class="hint" id="tutorial"></div> <div class="hint" id="levelSelectWrapper" style="margin-top:6px;text-align:center"> <label for="levelSelect">Select Level:</label> <select class="kbd" id="levelSelect" style="min-width:140px"></select> </div> <div class="hint"> Controls: <span class="kbd">WASD</span>/<span class="kbd">Arrows</span> Â· Restart: <span class="kbd">R</span> Â· Mute: <span class="kbd">M</span> </div> </div> <script>const LEVELS=["##############################\n#............f............x..#\n#..####....####.......####...#\n#..#..#................#.....#\n#..#..#................#.....#\n#..####................#.....#\n#............................#\n#.####..####..####..####.....#\n#............................#\n#............................#\n#..........####..............#\n#..........#..#..............#\n#..........#..#..............#\n#..####....####..####..####..#\n#..#..#..................#...#\n#..#..#..................#...#\n#..####..................#...#\n#c...........................#\n#..f.........................#\n##############################","##############################\n#....l.......f...............#\n#......####...........####...#\n#.....................#..#...#\n#.........####........#..#...#\n#.....................#..#...#\n#..##.........l.......####...#\n#............................#\n#............f...............#\n#..l.....####............l...#\n#........#..#..............###\n#.######.#..#...........#....#\n#........####...........#....#\n#.......................#....#\n#..............l........#....#\n#...........#...........#....#\n#...........#...........#....#\n#c..........#......f....#....#\n#...........#...........#.x..#\n##############################","##############################\n#....l..........f...l........#\n#............................#\n#.x.....####.................#\n#.......................####.#\n#...####......####...........#\n#........l........####.......#\n#.................#..#.......#\n#......f..........#..#.......#\n#.................####...l...#\n#............................#\n#....L......###...........f..#\n#.####........#..............#\n#.#..#........#..........#####\n#.#..#...................#...#\n#.####........L..........#...#\n#........................#...#\n#c.......................#...#\n#...................f....#...#\n##############################","##############################\n#...................s........#\n#............................#\n#.....####l...........#..###.#\n#l....#..#............#......#\n#.....####............#......#\n#.....................#......#\n#.....####...............###.#\n#........................#.#f#\n#.f.......s......L.......#.#.#\n#...........##...........###.#\n######.......................#\n#....#.......................#\n#....#.............s...s.....#\n######..........###......#####\n#.x.L...........#........#...#\n#.c......f......#s.......#...#\n#........s......#f.......#...#\n#...............#..l.....#...#\n##############################","##############################\n#........#..#...#............#\n#........#..#...#............#\n#l.......####...L.....l......#\n#........f...................#\n#........####.........s......#\n#............................#\n#.#......s...####.......##...#\n#.#...####......#.......##...#\n#x#L..#..#..s.c.#.......##..f#\n#.#...#..#......#.......##...#\n#.#...####......#.......##...#\n#........s...####.......##...#\n#............................#\n#........####.........s......#\n#........f...................#\n#........####...L............#\n#l.......#..#...#............#\n#........#..#...#.....l......#\n##############################","##############################\n#.........#...#..#.......#...#\n#.........#...#f.#.......#...#\n#f........#####..#########...#\n#.L.......s..............#...#\n#....###.......###.s.....#...#\n#..............#.#.......#...#\n#..............#.#.......#...#\n#l......####...###.......#####\n#................L.......s..c#\n#.....s###...............#####\n#####..###....###........#...#\n#...#.........#.#........#...#\n#...#f.l......#.#........#...#\n#...#..###....###........#...#\n#...#..#........f........#...#\n#...#..#l.......s#########...#\n#...#..###.......#.......#...#\n#...#...x#.......#.......#...#\n##############################","##############################\n#...........................c#\n#.############################\n#.......s....................#\n#.L............f.............#\n############################.#\n#...#.....#.......f..........#\n#.#.#.....#......###.........#\n#.#.#.....l......#.#....######\n#.#s.f...........###.L..#....#\n#.#.#.....s.............#....#\n#.#.#..####.........###s#....#\n#.#.L..#..#...###.......#....#\n#.#.#..####.............######\n#.#.#........................#\n#.#.#...s....................#\n#.#.#......#...l......###....#\n#.#.#f.....#..###.....#.#....#\n#x#........#..........#.#..f.#\n##############################","##############################\n#........#...#f.........s...f#\n#........#...#s.......####...#\n#l.......#...#........#..#...#\n#...f....#...#........####...#\n#...####.#####L..............#\n#............................#\n#............................#\n#....................ssss....#\n#x...........................#\n#.........c......###..L......#\n#l.......###.................#\n#####........###.............#\n#...#......L.................#\n#...#........................#\n#...#..................####..#\n#...#.....#####........#..#..#\n#...#f....#...#........####..#\n#...#.....#...#.....s.......f#\n##############################","##############################\n#f.........###L....#.#.#...#f#\n#s...###...#.#.....#.#.#...#.#\n#....l.....###.....###.#...#.#\n#..###.......f.........#...#.#\n#....s.....#####.###...#...#.#\n####.......#...#.......#...#.#\n#..........#...#.......#####.#\n#x.........#####.............#\n#.........................####\n#L..........c....l........#..#\n#####......###............####\n#...#......#.#...............#\n#####......#.#.###.......##..#\n#..........###.......###.....#\n#.l..........................#\n#..##...................l##..#\n#s.....##..............####..#\n#f............L.......s.....f#\n##############################"],TIPS=["Collect all fish and head to the door.","Watch out for fixed lamps â€” stay in the shadows, collect all fish, then reach the door.","Moving guards with light cones â€” timing matters! Collect all fish and reach the door.","Use hiding spots (bluish patches), avoid light cones, collect all fish, and reach the door."]</script> <script>function e(){if(A){A.innerHTML="";for(let e=0;e<LEVELS.length;e++){const t=document.createElement("option");t.value=e,t.textContent=`Level ${e+1}`,e>V.unlocked&&(t.disabled=1),e===I&&(t.selected=1),A.appendChild(t)}}}function t(e,t,l){return Math.max(t,Math.min(l,0|e))}function l(){try{localStorage.setItem(L,JSON.stringify(V))}catch(e){}}function n(){const e=LEVELS.length-1,t=Math.min(I+1,e);V.unlocked<t&&(V.unlocked=t,l())}function a(e){E.length=q.length=G.length=B.length=W.length=0,Q=0,J=0,z=0,_=0,e.split("\n").forEach((e,t)=>{for(let l=0;l<e.length;l++){const a=e[l],n=l*R,o=t*R;if("#"==a)E.push({x:n,y:o,w:R,h:R});else if("s"==a)q.push({x:n,y:o,w:R,h:R,glowIntensity:0});else if("l"==a)G.push({x:n+8,y:o+8,range:120,fov:Math.PI/3,angle:0,offX:10,offY:-11});else if("L"==a){const e=["#cc4455","#4aa3ff","#7bd389","#f2b134","#d45ed4","#ff8c00","#88cfff","#00bfff","#3cb371"],t=e[Math.floor(Math.random()*e.length)];B.push({x:n+8,y:o+8,range:160,fov:Math.PI/2,angle:0,dir:1,sweep:.9,accent:t})}else"f"==a?W.push({x:n+8,y:o+8,t:1,dir:.5>Math.random()?0:Math.PI,p:6.28*Math.random(),anim:0,cycle:1.5+3*Math.random()}):"x"==a?O={x:n,y:o,w:R,h:R}:"c"==a&&(F.x=n+8,F.y=o+8)}}),H=W.length}function o(){n();const t=LEVELS.length-1;I=t>I?Math.min(V.unlocked,t):t,V.current=I,l(),a(LEVELS[I]),le=0,ne=0,z=0,J=0,Z=null,e(),g()}function i(e,t,l){return t>e?t:e>l?l:e}function r(e,t,l){return!(e<l.x||e>l.x+l.w||t<l.y||t>l.y+l.h)}function c(e,t,l){for(let a=0;a<l.length;a++)if(r(e,t,l[a]))return 1;return 0}function s(e,t){return c(e,t,q)}function f(e,t,l,a,n,o,i){const r=e-l,x=t-a;if(Math.hypot(r,x)>i)return 0;const c=Math.atan2(x,r),s=Math.atan2(Math.sin(c-n),Math.cos(c-n));return Math.abs(s)<=.5*o}function h(e,t){for(const l of G)if(f(e,t,l.x+(l.offX||0),l.y+(l.offY||0),0,l.fov,l.range))return 1;for(const l of B)if(f(e,t,l.x,l.y,l.angle,l.fov,l.range))return 1;return 0}function u(){if(ie)return;ie=1,ae=new(window.AudioContext||window.webkitAudioContext),oe=ae.createGain(),oe.gain.value=re?0:.7,oe.connect(ae.destination),ce=ae.createGain(),ce.gain.value=.05,de=ae.createStereoPanner(),de.pan.value=0,ce.connect(de).connect(oe);const e=d(1),t=ae.createBiquadFilter();t.type="lowpass",t.frequency.value=700,t.Q.value=1e-4;const l=ae.createBiquadFilter();l.type="lowshelf",l.frequency.value=180,l.gain.value=8;const a=ae.createBiquadFilter();a.type="highshelf",a.frequency.value=1500,a.gain.value=-24;const n=ae.createGain();n.gain.value=.9,e.connect(t).connect(l).connect(a).connect(n).connect(ce);const o=d(1),i=ae.createBiquadFilter();i.type="bandpass",i.frequency.value=900,i.Q.value=.8;const r=ae.createBiquadFilter();r.type="highshelf",r.frequency.value=1500,r.gain.value=-12;const x=ae.createGain();x.gain.value=.35,o.connect(i).connect(r).connect(x).connect(ce),se=ae.createOscillator(),se.frequency.value=.5,fe=ae.createGain(),fe.gain.value=.04,se.connect(fe).connect(ce.gain),he=ae.createOscillator(),he.frequency.value=.12,ue=ae.createGain(),ue.gain.value=.18,he.connect(ue).connect(de.pan);const c=ae.currentTime;e.start(c),o.start(c),se.start(c),he.start(c),(()=>{if(!ae||ye)return;me=ae.createGain(),me.gain.value=.05,ge=ae.createGain(),ge.gain.value=0,ye=ae.createOscillator(),ye.type="triangle",ye.frequency.value=440,ye.connect(ge).connect(me).connect(oe);const e=ae.currentTime;ye.start(e);const t=[440,523.25,587.33,659.25,783.99,880];!function e(){!function(){if(!ae)return;const e=ae.currentTime;be=(()=>{if(.72>Math.random()){const e=[-1,0,1][Math.floor(3*Math.random())];let l=be+e;return l=Math.max(0,Math.min(t.length-1,l)),l}return Math.floor(Math.random()*t.length)})();const l=t[be]*(.08>Math.random()?.5:1);ye.frequency.cancelScheduledValues(e),ye.frequency.setValueAtTime(ye.frequency.value,e),ye.frequency.exponentialRampToValueAtTime(Math.max(60,l),e+.12),ge.gain.cancelScheduledValues(e),ge.gain.setValueAtTime(0,e),ge.gain.linearRampToValueAtTime(.12,e+.04),ge.gain.exponentialRampToValueAtTime(1e-4,e+.35)}();const l=.6+.2*Math.random();pe=setTimeout(e,1e3*l)}()})()}function d(e=0){const t=(ae||new(window.AudioContext||window.webkitAudioContext)).createBuffer(1,Math.floor(44100),44100),l=t.getChannelData(0);for(let e=0;e<l.length;e++)l[e]=.6*(2*Math.random()-1);const a=ae.createBufferSource();return a.buffer=t,a.loop=!!e,a}function y(){ae&&setTimeout(()=>{ae.suspend()},500)}function g(){ae&&setTimeout(()=>{ae.resume()},500)}function m(e,t){const l=e.range,a=e.fov,n=t?0:e.angle,o=t&&null!=e.offX?e.x+e.offX:e.x,i=t&&null!=e.offY?e.y+e.offY:e.y,r=n-a/2,c=n+a/2,s=x.createRadialGradient(o,i,8,o,i,l);s.addColorStop(0,"rgba(255,220,120,0.45)"),s.addColorStop(.7,"rgba(255,210,110,0.18)"),s.addColorStop(1,"rgba(255,200,100,0.0)"),x.save(),x.fillStyle=s,x.beginPath(),x.moveTo(o,i),x.lineTo(o+Math.cos(r)*l,i+Math.sin(r)*l),x.arc(o,i,l,r,c),x.closePath(),x.fill(),x.restore()}function p(e){const{x:t,y:l,dir:a,p:n,anim:o}=e,i=te,r=1+1.2*o,c=Math.sin(7*i+(n||0))*(.7*r),s=Math.sin(1.6*i+(n||0))*(.9*(.5+.5*r)),f=Math.sin(2.2*i+1.3*(n||0))*(.05*r),h=1+f,u=1-.7*f;x.save();const d=x.createRadialGradient(t,l,0,t,l,10);d.addColorStop(0,"rgba(255,214,102,0.16)"),d.addColorStop(1,"rgba(255,214,102,0)"),x.fillStyle=d,x.fillRect(t-12,l-12,24,24),x.restore(),x.save(),x.translate(t,l+s);const y=a&&.001>Math.abs(a-Math.PI);x.scale((y?-1:1)*h,u),x.fillStyle="#ffd166",x.beginPath(),x.ellipse(0,0,9*.6,3,0,0,2*Math.PI),x.fill(),x.strokeStyle="rgba(50,60,80,0.35)",x.lineWidth=.8,x.stroke(),x.fillStyle="#eab54a",x.beginPath(),x.moveTo(.6*-9,0),x.lineTo(.6*-9-3.5,2+c),x.lineTo(.6*-9-3.5,-2-c),x.closePath(),x.fill(),x.fillStyle="#f6c255",x.save(),x.translate(1.2,-2.25),x.rotate(.1*c),x.beginPath(),x.moveTo(-2.2,0),x.lineTo(1.8,-3),x.lineTo(3.2,0),x.closePath(),x.fill(),x.restore(),o>.05&&(x.fillStyle="rgba(80,70,60,0.25)",x.beginPath(),x.ellipse(-1.5,.2,1.2*(1+.6*o),1,0,0,2*Math.PI),x.fill()),x.fillStyle="#4b4f5a",x.beginPath(),x.arc(9*.28,-.4,.7,0,2*Math.PI),x.fill(),x.globalAlpha=.28+.22*o,x.fillStyle="#ffffff",x.beginPath(),x.ellipse(.45,-1.25,2,1,0,0,2*Math.PI),x.fill(),x.globalAlpha=1,x.restore()}function b(e){const{x:t,y:l,angle:a,accent:n}=e,o=te;x.save(),x.translate(t,l),x.rotate(a);const i=.72;x.fillStyle="rgba(0,0,0,0.35)",x.beginPath(),x.ellipse(0,6*i,8*i,2.6*i,0,0,2*Math.PI),x.fill();const r="#4f4436",c=n||"#cc4455";x.fillStyle=r,x.beginPath(),x.ellipse(-1*i,0,9*i,6*i,0,0,2*Math.PI),x.fill(),x.fillStyle="#3f362c",x.beginPath(),x.ellipse(-2*i,2.6*i,4.608,2.6*i,0,0,2*Math.PI),x.fill();const s=3.8*i,f=2.5*i;x.fillStyle=r,x.beginPath(),x.ellipse(s,-.72,2.592,f,0,0,2*Math.PI),x.fill(),x.strokeStyle=c,x.lineWidth=.864,x.beginPath(),x.ellipse(s,-.648,2.4624,.99,0,0,2*Math.PI),x.stroke(),x.fillStyle="#ffd166",x.beginPath(),x.arc(s-.2*2.592,.72,.648,0,2*Math.PI),x.fill(),x.fillStyle=r,x.beginPath(),x.ellipse(7.6*i,-1.584,3.312,2.592,0,0,2*Math.PI),x.fill(),x.fillStyle="#c7ab92",x.beginPath(),x.moveTo(6.912,-3*i),x.lineTo(9.072,-2.016),x.lineTo(9.072,-.864),x.lineTo(6.912,-1.3*i),x.closePath(),x.fill(),x.beginPath(),x.ellipse(12.7*i,-2*i,1*i,1*i,0,0,2*Math.PI),x.fill(),x.fillStyle="#1b1f28",x.beginPath(),x.arc(9.648,-2*i,.54,0,2*Math.PI),x.fill();const h=.18*Math.sin(5.2*o)*i;x.fillStyle=r,x.beginPath(),x.moveTo(4.752,-5.2*i),x.lineTo(5.616,-5.688-h),x.lineTo(9*i,-5*i),x.closePath(),x.fill(),x.globalAlpha=.85,x.beginPath(),x.moveTo(4.104,-3.528),x.lineTo(4.968,-7.3*i+.6*h),x.lineTo(7.6*i,-3.384),x.closePath(),x.fill(),x.globalAlpha=1,x.fillStyle="#12151b",x.beginPath(),x.arc(7.056,-3*i,.432,0,2*Math.PI),x.fill();const u=2.304,d=Math.sin(4.8*o);x.fillStyle=r,x.fillRect(3.168,u+-.2*d*i,1.152,2.592),x.fillRect(6.2*i,u+.2*d*i,1.152,2.592),x.fillRect(-3.888,u+.2*d*i,1.296,3.8*i),x.fillRect(-2.448,u+-.2*d*i,1.296,3.8*i);const y=.5*Math.sin(9.5*o)*i;x.strokeStyle=r,x.lineWidth=2,x.beginPath(),x.moveTo(-9*i,-.432),x.quadraticCurveTo(-8.352,-4*i+y,-6.048,-4.896+y),x.stroke(),x.restore()}function T(e){const{x:t,y:l}=e;x.save(),x.fillStyle="rgba(0,0,0,0.25)",x.beginPath(),x.ellipse(t,l+8,6,2,0,0,2*Math.PI),x.fill(),x.fillStyle="#2a3140",x.fillRect(t-1,l-12,2,16),x.fillRect(t+0,l-10,8,2);const a=t+(e.offX??10),n=l+(e.offY??-11);x.fillStyle="#232a38",x.fillRect(a-5,n-3,10,6),x.fillStyle="#1d2330",x.fillRect(a-4,n-5,8,2),x.fillStyle="rgba(255,236,170,0.9)",x.fillRect(a-4,n-2,8,4),x.fillStyle="#1d2330",x.fillRect(a-1,n-6,2,1),x.fillStyle="#2a3140",x.fillRect(t-3,l+3,6,2);const o=a+2,i=n,r=x.createRadialGradient(o,i,0,o,i,12);r.addColorStop(0,"rgba(255,236,170,0.30)"),r.addColorStop(1,"rgba(255,236,170,0.0)"),x.fillStyle=r,x.fillRect(a-26,n-26,52,52),x.restore()}function S(e){function t(){return y=1e4*Math.sin(y),y-Math.floor(y)}const l=e.x,a=e.y,n=e.w,o=e.h,i=te||0;x.save(),x.fillStyle="rgba(8,14,24,0.78)",x.fillRect(l,a,n,o);const r=l+.5*n,c=a+.5*o,s=x.createRadialGradient(r,c,2,r,c,.75*Math.max(n,o));s.addColorStop(0,"rgba(0,0,0,0.38)"),s.addColorStop(.65,"rgba(0,0,0,0.2)"),s.addColorStop(1,"rgba(0,0,0,0)"),x.fillStyle=s,x.fillRect(l-8,a-8,n+16,o+16);let f=x.createLinearGradient(l,a,l,a+7);f.addColorStop(0,"rgba(0,0,0,0.65)"),f.addColorStop(1,"rgba(0,0,0,0.0)"),x.fillStyle=f,x.fillRect(l,a,n,7),f=x.createLinearGradient(l,a+o,l,a+o-7),f.addColorStop(0,"rgba(0,0,0,0.55)"),f.addColorStop(1,"rgba(0,0,0,0.0)"),x.fillStyle=f,x.fillRect(l,a+o-7,n,7),f=x.createLinearGradient(l,a,l+7,a),f.addColorStop(0,"rgba(0,0,0,0.6)"),f.addColorStop(1,"rgba(0,0,0,0.0)"),x.fillStyle=f,x.fillRect(l,a,7,o),f=x.createLinearGradient(l+n,a,l+n-7,a),f.addColorStop(0,"rgba(0,0,0,0.6)"),f.addColorStop(1,"rgba(0,0,0,0.0)"),x.fillStyle=f,x.fillRect(l+n-7,a,7,o),x.strokeStyle="rgba(120,170,220,0.12)",x.lineWidth=1,x.strokeRect(l+.5,a+.5,n-1,o-1),x.globalAlpha=.08,x.fillStyle="#5f6d85";const u=l/n|0,d=a/o|0;let y=1e4*Math.sin(91*(u+31)+57*(d+17)+.8*i);for(let e=0;8>e;e++){const e=l+Math.floor(t()*n),i=a+Math.floor(t()*o);x.fillRect(e,i,1,1)}x.globalAlpha=1;const g=l+.5*n,m=a+.5*o,p=h(g,m)?1:0;if("number"!=typeof e.glowIntensity&&(e.glowIntensity=0),e.glowIntensity+=.08*(p-e.glowIntensity),e.glowIntensity>.01){const t=.18*(.6+.4*(.5+.5*Math.sin(1.6*(te||0))))*e.glowIntensity,i=x.createRadialGradient(g,m,2,g,m,1.2*Math.max(n,o));i.addColorStop(0,`rgba(120,170,255,${t})`),i.addColorStop(1,"rgba(120,170,255,0)"),x.fillStyle=i,x.fillRect(l-12,a-12,n+24,o+24)}x.restore()}function M(e,t,l){x.fillStyle="rgba(0,0,0,0.6)",x.fillRect(0,0,v,k),x.textAlign="center",x.fillStyle=e,x.font="bold 24px system-ui, sans-serif",x.fillText(t,v/2,k/2-6),x.fillStyle="#dbe0ea",x.font="14px system-ui, sans-serif",x.fillText(l,v/2,k/2+16),x.textAlign="left"}const P=document.getElementById("game"),x=P.getContext("2d"),v=P.width,k=P.height,R=16;Math.floor(v/R),Math.floor(k/R);let I=0;const A=document.getElementById("levelSelect"),w=document.getElementById("levelSelectWrapper"),C=document.getElementById("hud");A&&A.addEventListener("change",()=>{const t=parseInt(A.value,10);Number.isNaN(t)||t>V.unlocked||(I=t,V.current=t,l(),a(LEVELS[I]),le=0,ne=0,z=0,J=0,Z=null),e()});const L="js13k_shadowalley_v1";let V={current:0,unlocked:0},E=[],q=[],G=[],B=[],W=[],O={x:v-32,y:16,w:R,h:R};const F={x:64,y:k-64,r:6,speed:1.7,vx:0,vy:0,dir:"R",step:0,state:"idle",idle:0,blink:1,blinkTimer:2,fpTimer:0,pawParity:0,db:0},D=[],N=[],Y=[],$=[{x:80,y:60,dx:.06,dy:.02,r:90,a:.12},{x:240,y:140,dx:-.04,dy:.03,r:120,a:.1},{x:380,y:220,dx:.03,dy:-.05,r:100,a:.09}];let X=0;const j=[];let H=0,Q=0,z=0,J=0,_=0,U=1;(()=>{try{const e=localStorage.getItem(L);if(e){const t=JSON.parse(e);"object"==typeof t&&t&&(V={current:0|t.current,unlocked:0|t.unlocked})}}catch(e){}const e=LEVELS.length-1;V.unlocked=t(V.unlocked,0,e),V.current=t(V.current,0,V.unlocked)})(),I=t(V.current,0,Math.max(0,Math.min(V.unlocked,LEVELS.length-1))),a(LEVELS[I]),e();const K=Object.create(null);addEventListener("keydown",t=>{if(K[t.key]=1,U&&("Enter"===t.key||" "===t.key||"Space"===t.code))return U=0,u(),g(),w.style.opacity="1",void(C.style.opacity="1");ie||u(),"m"!==t.key&&"M"!==t.key||(re=!re,oe&&(oe.gain.value=re?0:.7)),"r"!==t.key&&"R"!==t.key||(_?(LEVELS.length,I=0,V.current=0,l(),a(LEVELS[I]),le=0,ne=0,z=0,J=0,_=0,Z=null,e(),g()):(a(LEVELS[I]),le=0,ne=0,F.vx=F.vy=0,_=0,V.current=I,l(),e(),g())),"n"!==t.key&&"N"!==t.key||!J||o()}),addEventListener("keyup",e=>K[e.key]=0);let Z=null,ee=performance.now(),te=0,le=0,ne=0,ae=null,oe=null,ie=0,re=0,ce=null,se=null,fe=null,he=null,ue=null,de=null,ye=null,ge=null,me=null,pe=null,be=0,Te=0;const Se={collect(){if(!ae)return;const e=ae.currentTime,t=ae.createGain();t.gain.setValueAtTime(0,e),t.gain.linearRampToValueAtTime(.25,e+.005),t.gain.exponentialRampToValueAtTime(1e-4,e+.18);const l=ae.createOscillator();l.type="sine",l.frequency.setValueAtTime(880,e),l.frequency.exponentialRampToValueAtTime(1320,e+.12);const a=ae.createOscillator();a.type="sine",a.frequency.setValueAtTime(660,e+.02),a.frequency.exponentialRampToValueAtTime(990,e+.18),l.connect(t),a.connect(t),t.connect(oe),l.start(e),l.stop(e+.2),a.start(e+.02),a.stop(e+.22)},door(){if(!ae)return;const e=ae.currentTime,t=d(),l=ae.createGain();l.gain.setValueAtTime(0,e),l.gain.linearRampToValueAtTime(.2,e+.05),l.gain.exponentialRampToValueAtTime(1e-4,e+.6);const a=ae.createBiquadFilter();a.type="bandpass",a.frequency.value=1200,a.Q.value=.8,t.connect(a).connect(l).connect(oe),t.start(e),t.stop(e+.65);const n=ae.createOscillator();n.type="sine",n.frequency.setValueAtTime(180,e),n.frequency.exponentialRampToValueAtTime(90,e+.5);const o=ae.createGain();o.gain.setValueAtTime(0,e),o.gain.linearRampToValueAtTime(.12,e+.1),o.gain.exponentialRampToValueAtTime(1e-4,e+.6),n.connect(o).connect(oe),n.start(e),n.stop(e+.65)},alert(){if(!ae)return;const e=ae.currentTime,t=ae.createOscillator();t.type="square",t.frequency.setValueAtTime(340,e),t.frequency.exponentialRampToValueAtTime(160,e+.08);const l=ae.createGain();l.gain.setValueAtTime(0,e),l.gain.linearRampToValueAtTime(.28,e+.005),l.gain.exponentialRampToValueAtTime(1e-4,e+.15),t.connect(l).connect(oe),t.start(e),t.stop(e+.16);const a=d(),n=ae.createGain();n.gain.setValueAtTime(.2,e),n.gain.exponentialRampToValueAtTime(1e-4,e+.06),a.connect(n).connect(oe),a.start(e),a.stop(e+.08)},footstep(e){if(!ae)return;const t=ae.currentTime,l=ae.createBuffer(1,Math.floor(.05*ae.sampleRate),ae.sampleRate),a=l.getChannelData(0);for(let e=0;e<a.length;e++){const t=Math.exp(-e/180),l=.5*(2*Math.random()-1);a[e]=l*t}const n=ae.createBufferSource();n.buffer=l;const o=ae.createBiquadFilter();o.type="lowpass",o.frequency.value=1100+200*Math.random();const i=ae.createBiquadFilter();i.type="highshelf",i.frequency.value=2e3,i.gain.value=-10;const r=ae.createGain(),x=.16+.05*Math.random();r.gain.value=e?.55*x:x,n.connect(o).connect(i).connect(r).connect(oe),n.start(t)},success(){if(!ae)return;const e=ae.currentTime;[523.25,659.25,783.99].forEach(t=>{const l=ae.createOscillator();l.type="sine",l.frequency.value=t;const a=ae.createGain();a.gain.setValueAtTime(0,e),a.gain.linearRampToValueAtTime(.15,e+.02),a.gain.exponentialRampToValueAtTime(1e-4,e+.25),l.connect(a).connect(oe),l.start(e),l.stop(e+.3)})}};requestAnimationFrame(function e(t){const a=(t-ee)/1e3;ee=t,te+=a,(e=>{if(U)return;if(z||J||_)return J&&null!=Z&&te>=Z?void o():void 0;let t=0,a=0;if((K.ArrowLeft||K.a||K.A)&&(t-=1),(K.ArrowRight||K.d||K.D)&&(t+=1),(K.ArrowUp||K.w||K.W)&&(a-=1),(K.ArrowDown||K.s||K.S)&&(a+=1),t||a){const e=Math.hypot(t,a);t/=e,a/=e}const x=60*F.speed*e;let h=i(F.x+t*x,F.r+1,v-F.r-1);c(h,F.y,E)||(F.x=h),h=i(F.y+a*x,F.r+1,k-F.r-1),c(F.x,h,E)||(F.y=h),-.01>t?F.dir="L":t>.01&&(F.dir="R"),t||a?F.step+=8*e:F.step=0;const u=!(!t&&!a),d=s(F.x,F.y);if(u?(F.idle=0,F.state=d?"crouch":"walk"):(F.idle+=e,d?F.state="crouch":F.idle>.8?F.state="sit":F.state="idle"),F.blinkTimer-=e,F.blinkTimer>0||(F.blink>.5?(F.blink=0,F.blinkTimer=.1):(F.blink=1,F.db?(F.db=0,F.blinkTimer=1.8+2.2*Math.random()):.25>Math.random()&&"walk"!==F.state?(F.db=1,F.blinkTimer=.2):F.blinkTimer=1.8+2.2*Math.random())),(t||a)&&(F.fpTimer-=e,0>=F.fpTimer)){const e=Math.hypot(t,a)||1,l=t/e,n=a/e,o=F.pawParity?1:-1,i=F.x-6*l+3*-n*o,r=F.y-6*n+3*l*o;if(D.push({x:i,y:r,life:1}),F.fpTimer=.14,F.pawParity^=1,ie&&ae){const e=ae.currentTime;if((t||a)&&e-Te>.25){const t=s(F.x,F.y);Se.footstep(t),Te=e}}}for(let t=D.length-1;t>=0;t--)D[t].life-=.35*e,D[t].life>0||D.splice(t,1);for(const t of W)if(t.t){if(t.cycle-=e,0>=t.cycle){t.anim=1,t.cycle=1.8+2.8*Math.random(),.2>Math.random()&&(t.dir=0===t.dir?Math.PI:0);for(let e=0;3>e;e++){const e=(0===t.dir?1:-1)*(3.5+Math.random()),l=1*Math.random()-.5;j.push({x:t.x+e,y:t.y+l,vy:-20-15*Math.random(),life:.9})}}t.anim>0&&(t.anim=Math.max(0,t.anim-1.5*e))}for(let t=j.length-1;t>=0;t--){const l=j[t];l.y+=l.vy*e,l.life-=.7*e,l.life>0&&l.y>=0||j.splice(t,1)}if(X-=e,0>=X){for(let e=0;3>e;e++){const e=Math.random()*v,t=-10-40*Math.random(),l=220+80*Math.random(),a=-60-40*Math.random();N.push({x:e,y:t,vx:a,vy:l,len:10+8*Math.random()})}X=.05/.3}for(let t=N.length-1;t>=0;t--){const l=N[t];l.x+=l.vx*e,l.y+=l.vy*e,l.y>k-18?(Y.push({x:l.x,y:k-18,life:1}),N.splice(t,1)):(-20>l.x||l.x>v+20||l.y>k+20)&&N.splice(t,1)}for(let t=Y.length-1;t>=0;t--)Y[t].life-=1.8*e,Y[t].life>0||Y.splice(t,1);for(const e of $)e.x+=e.dx,e.y+=e.dy,e.x<-e.r?e.x=v+e.r:e.x>v+e.r&&(e.x=-e.r),e.y<-e.r?e.y=k+e.r:e.y>k+e.r&&(e.y=-e.r);for(const t of B)t.angle+=t.dir*t.sweep*e,t.angle>1&&(t.angle=1,t.dir=-1),-1>t.angle&&(t.angle=-1,t.dir=1);const y=s(F.x,F.y);let g=0;for(const e of G)if(f(F.x,F.y,e.x+(e.offX||0),e.y+(e.offY||0),0,e.fov,e.range)){g=1;break}if(!g)for(const e of B)if(f(F.x,F.y,e.x,e.y,e.angle,e.fov,e.range)){g=1;break}g&&!y&&(!z&&ie&&Se.alert(),z=1);for(const e of W)e.t&&8>Math.hypot(F.x-e.x,F.y-e.y)&&(e.t=0,Q++,ie&&Se.collect());if(Q!==H||le||(ie&&Se.door(),le=1),Q===H&&r(F.x,F.y,O)&&!J&&!_){const e=LEVELS.length-1;I===e?(_=1,J=0,ie&&!ne&&(Se.success(),ne=1),n(),V.current=Math.min(V.unlocked,e),l()):(J=1,ie&&!ne&&(Se.success(),ne=1),null==Z&&(Z=te+5),n(),V.current=Math.min(V.unlocked,LEVELS.length-1),l())}})(a),(()=>{const e=LEVELS.length-1;if(V.unlocked>e&&(V.unlocked=e),I>V.unlocked&&(I=V.unlocked),V.current!==I&&(V.current=I,l()),U)return void(()=>{w.style.opacity="0",C.style.opacity="0",y(),x.clearRect(0,0,v,k);const e=x.createLinearGradient(0,0,0,k);e.addColorStop(0,"#0f1420"),e.addColorStop(1,"#0b0e17"),x.fillStyle=e,x.fillRect(0,0,v,k);const t=x.createRadialGradient(v/2,k/2,20,v/2,k/2,.7*Math.max(v,k));t.addColorStop(0,"rgba(0,0,0,0)"),t.addColorStop(1,"rgba(0,0,0,0.55)"),x.fillStyle=t,x.fillRect(0,0,v,k),x.textAlign="center",x.fillStyle="#dbe0ea",x.font="bold 28px system-ui, sans-serif",x.fillText("ðŸ¾ Shadow Alley ðŸ¾",v/2,72),x.save(),x.translate(v/2,100),x.fillStyle="#0b0d12",x.beginPath(),x.ellipse(0,8,22,12,0,0,2*Math.PI),x.fill(),x.beginPath(),x.arc(14,2,6,0,2*Math.PI),x.fill(),x.beginPath(),x.moveTo(10.5,-1.5),x.lineTo(12.5,-6.5),x.lineTo(14,-1.5),x.closePath(),x.moveTo(17.5,-1.5),x.lineTo(15.5,-6.5),x.lineTo(14,-1.5),x.closePath(),x.fill(),x.beginPath(),x.moveTo(-18,6),x.quadraticCurveTo(-28,-2,-12,-6),x.strokeStyle="#0b0d12",x.lineWidth=3,x.stroke(),x.restore(),x.fillStyle="#b7c3d6",x.font="13px system-ui, sans-serif";const l=["The city never sleeps. Rain falls, lamps flicker, and dogs guard the alleys.","You are a lone black cat, hungry and unseen.","Sneak through the night, gather fish to survive,","and escape through the glowing door before the light finds you."];let a=170;for(const e of l)x.fillText(e,v/2,a),a+=18;x.fillStyle="#5fd08a",x.font="bold 14px system-ui, sans-serif",x.fillText("Press Enter or Space to begin",v/2,k-36),x.textAlign="left"})();x.clearRect(0,0,v,k);const t=x.createLinearGradient(0,0,0,k);t.addColorStop(0,"#0f1420"),t.addColorStop(1,"#0b0e17"),x.fillStyle=t,x.fillRect(0,0,v,k),x.fillStyle="rgba(0,0,0,0.0)",x.fillRect(0,0,v,k),x.fillStyle="#0b0d12";for(const e of E)x.fillRect(e.x,e.y,e.w,e.h);for(const e of q)S(e);const a=Q===H;((e,t,l,a,n)=>{const o=e+l/2,i=t+a/2;if(x.save(),x.fillStyle="#0b0d12",x.fillRect(e,t,l,a),x.fillStyle="#141a22",x.fillRect(e+1,t+1,l-2,a-2),n){const n=2,r=e+n,c=t+n,s=l-2*n,f=a-2*n;x.fillStyle="#0a0f14",x.fillRect(r,c,s,f);const h=x.createRadialGradient(o,i,2,o,i,Math.max(l,a));h.addColorStop(0,"rgba(95,208,138,0.35)"),h.addColorStop(1,"rgba(95,208,138,0)"),x.fillStyle=h,x.fillRect(e-8,t-8,l+16,a+16),x.fillStyle="rgba(95,208,138,0.22)",x.beginPath();const u=o-.25*s,d=o+.25*s;x.moveTo(u,t+a),x.lineTo(d,t+a),x.lineTo(d+4,t+a+5),x.lineTo(u-4,t+a+5),x.closePath(),x.fill(),x.fillStyle="#23323b",x.strokeStyle="rgba(200,210,230,0.1)",x.lineWidth=1,x.beginPath();const y=r+.15*s,g=c+1;x.moveTo(y,g),x.lineTo(y+.55*s,g+.1*f),x.lineTo(y+.55*s,g+f-1),x.lineTo(y,g+f-2),x.closePath(),x.fill(),x.stroke();const m=.5*(Math.sin(3*te)+1),p=Math.max(1.5,3+3*m);x.fillStyle="#5fd08a",x.fillRect(o-p/2,c+2,p,f-4),x.strokeStyle="rgba(95,208,138,0.35)",x.lineWidth=1,x.strokeRect(e+.5,t+.5,l-1,a-1)}else{const n=2,o=e+n,i=t+n,r=l-2*n,c=a-2*n;x.fillStyle="#2a2f3a",x.fillRect(o,i,r,c),x.strokeStyle="rgba(200,210,230,0.12)",x.lineWidth=1,x.beginPath(),x.moveTo(o+.5*r,i+2),x.lineTo(o+.5*r,i+c-2),x.stroke(),x.beginPath(),x.moveTo(o+2,i+.35*c),x.lineTo(o+r-2,i+.35*c),x.moveTo(o+2,i+.7*c),x.lineTo(o+r-2,i+.7*c),x.stroke(),x.fillStyle="#c7cedd",x.beginPath(),x.arc(o+1.5,i+.25*c,.8,0,2*Math.PI),x.arc(o+1.5,i+.55*c,.8,0,2*Math.PI),x.fill(),x.beginPath(),x.arc(o+r-2.2,i+.5*c,1,0,2*Math.PI),x.fill(),x.strokeStyle="rgba(95,208,138,0.35)",x.lineWidth=1,x.strokeRect(e+.5,t+.5,l-1,a-1)}x.restore()})(O.x,O.y,O.w,O.h,a);for(const e of $){const t=x.createRadialGradient(e.x,e.y,0,e.x,e.y,e.r);t.addColorStop(0,`rgba(30,35,50,${e.a})`),t.addColorStop(1,"rgba(30,35,50,0)"),x.fillStyle=t,x.fillRect(0,0,v,k)}for(const e of G)m(e,1);for(const e of B)m(e,0);for(const e of G)T(e);for(const e of B)b(e);for(const e of j)x.save(),x.globalAlpha=.25*Math.max(0,e.life),x.fillStyle="#bcd4ff",x.beginPath(),x.ellipse(e.x,e.y,1.2,1.2,0,0,2*Math.PI),x.fill(),x.restore();for(const e of W)e.t&&p(e);for(const e of Y)x.save(),x.globalAlpha=.2*Math.max(0,e.life),x.strokeStyle="#8fa3c2",x.lineWidth=1,x.beginPath(),x.ellipse(e.x,e.y+1,4.5*(1-.6*e.life),1.2,0,0,2*Math.PI),x.stroke(),x.restore();for(const e of D){let t=.18*Math.max(0,e.life);h(e.x,e.y)&&(t*=1.8),x.save(),x.globalAlpha=t,x.fillStyle="#7b8aa1",x.beginPath(),x.ellipse(e.x,e.y+2,3.2,1.4,0,0,2*Math.PI),x.fill(),x.restore()}const n=s(F.x,F.y);((e,t,l,a,n,o,i)=>{function r(e,t){const n=Math.max(.12,t);x.fillStyle=a?"rgba(255,230,120,0.25)":"#ffe678";const o=s+("R"===l?1.2:-1.2);x.beginPath(),x.ellipse(o-1.5,f-.5+(e||0),.9,.9*n,0,0,2*Math.PI),x.ellipse(o+1.5,f-.5+(e||0),.9,.9*n,0,0,2*Math.PI),x.fill()}function c(){x.strokeStyle=a?"rgba(200,210,230,0.25)":"rgba(200,210,230,0.55)",x.lineWidth=1,x.beginPath(),x.moveTo(s-4,f),x.lineTo(s-8,f-1),x.moveTo(s-4,f+2),x.lineTo(s-8,f+2),x.moveTo(s+4,f),x.lineTo(s+8,f-1),x.moveTo(s+4,f+2),x.lineTo(s+8,f+2),x.stroke()}x.save(),x.globalAlpha=a?.7:1;const s=e+("R"===l?5:-5),f=t-6;if("sit"===o)x.strokeStyle="#11131a",x.lineWidth=2,x.beginPath(),x.arc(e-("R"===l?6:-6),t+6,6,.2*Math.PI,1.6*Math.PI),x.stroke(),x.fillStyle="#0b0d12",x.beginPath(),x.ellipse(e,t+2,7,9,0,0,2*Math.PI),x.fill(),x.beginPath(),x.arc(s,f-2,4,0,2*Math.PI),x.fill(),x.beginPath(),x.moveTo(s-3,f-4),x.lineTo(s-1,f-8),x.lineTo(s,f-4),x.closePath(),x.moveTo(s+3,f-4),x.lineTo(s+1,f-8),x.lineTo(s,f-4),x.closePath(),x.fill(),x.fillStyle="#0c0e14",x.beginPath(),x.arc(e-3,t+8,1.2,0,2*Math.PI),x.arc(e+3,t+8,1.2,0,2*Math.PI),x.fill(),r(0,i),c();else if("crouch"===o){const a=2*Math.sin(n*Math.PI)*("R"===l?1:-1);x.fillStyle="#0b0d12",x.beginPath(),x.ellipse(e,t+3,9,4.5,0,0,2*Math.PI),x.fill(),x.beginPath(),x.arc(e+("R"===l?6:-6),t-3,3.6,0,2*Math.PI),x.fill();const o=e+("R"===l?6:-6),s=t-3;x.beginPath(),x.moveTo(o-3,s-1),x.lineTo(o-1,s-4),x.lineTo(o,s-1),x.closePath(),x.moveTo(o+3,s-1),x.lineTo(o+1,s-4),x.lineTo(o,s-1),x.closePath(),x.fill(),x.strokeStyle="#11131a",x.lineWidth=2,x.beginPath();const f=e-("R"===l?10:-10),h=t+5;x.moveTo(f,h),x.bezierCurveTo(f-4,h-1+a,f-8,h+1+a,f-2,h+2+a),x.stroke();const u=.6*Math.sin(2*n);x.fillStyle="#0c0e14",x.beginPath(),x.arc(e-3,t+6-u,1,0,2*Math.PI),x.arc(e+3,t+6+u,1,0,2*Math.PI),x.arc(e-1,t+5+u,1,0,2*Math.PI),x.arc(e+1,t+5-u,1,0,2*Math.PI),x.fill(),r(.8,i),c()}else{const a=3*Math.sin(n*Math.PI)*("R"===l?1:-1);x.fillStyle="#0b0d12",x.beginPath(),x.ellipse(e,t+1,8,6,0,0,2*Math.PI),x.fill(),x.beginPath(),x.arc(s,f,4,0,2*Math.PI),x.fill(),x.beginPath(),x.moveTo(s-3,f-2),x.lineTo(s-1,f-6),x.lineTo(s,f-2),x.closePath(),x.moveTo(s+3,f-2),x.lineTo(s+1,f-6),x.lineTo(s,f-2),x.closePath(),x.fill(),x.strokeStyle="#11131a",x.lineWidth=2,x.beginPath();const o=e-("R"===l?9:-9),h=t+1;x.moveTo(o,h),x.bezierCurveTo(o-4,h-2+a,o-6,h-6+a,o-2,h-8+a),x.stroke();const u=1.2*Math.sin(2*n);x.fillStyle="#0c0e14",x.beginPath(),x.arc(e-3,t+6-u,1,0,2*Math.PI),x.arc(e+3,t+6+u,1,0,2*Math.PI),x.arc(e-1,t+5+u,1,0,2*Math.PI),x.arc(e+1,t+5-u,1,0,2*Math.PI),x.fill(),r(0,i),c()}x.restore()})(F.x,F.y,F.dir,n,F.step,F.state,F.blink),x.save(),x.strokeStyle="rgba(170,190,220,0.35)",x.lineWidth=.5,x.beginPath();for(const e of N)x.moveTo(e.x,e.y),x.lineTo(e.x-.03*e.vx,e.y-.03*e.vy-e.len);x.stroke(),x.restore();const o=document.getElementById("fishCount"),i=document.getElementById("levelCount"),r=document.getElementById("doorState");o&&(o.textContent=`${Q}/${H}`),i&&(i.textContent=`${I+1}/${LEVELS.length}`),r&&(r.textContent=a?"Door open":"Door closed");const c=document.getElementById("tutorial");c&&TIPS[I]&&""!==TIPS[I].trim()?(c.innerHTML="<strong>Level "+(I+1)+": </strong>"+TIPS[I],c.style.opacity=1):(c.innerHTML="",c.style.opacity=0),z?(y(),M("#ffd166","Discovered!","R to Restart")):J?(y(),M("#5fd08a","Well Done!","All fish collected â€“ continuing in 5s (Press N for instant)")):_&&(y(),M("#9ec5ff","Thanks for playing!","Press R to play again from Level 1"))})(),requestAnimationFrame(e)})</script> 