let treasureSpritesheet=null,playerSpritesheet=null;function loadSprites(){treasureSpritesheet=loadSprite('/items.png'),playerSpritesheet=loadSprite('/players.png')}function loadSprite(a){let b=new Image;return b.src=a,b}function getColorForPlayer(a){return 0===a?'#FF0000':1===a?'#00AA00':2===a?'#0000FF':3===a?'#FFBB00':void 0}function drawPiece(a,b,c,d){let e=Renderer.tileSize;switch(a.save(),a.translate(b+e/2,c+e/2),a.fillStyle='#CCCCCC',a.fillRect(-e/2,-e/2,e,e),a.fillStyle='#372900',a.rotate(d.rotation*Math.PI/2),d.type){case SPAWN:case CORNER:a.fillRect(-e/2,-e/2,e,e/3),a.fillRect(-e/2,-e/2,e/3,e),a.fillRect(e/6,e/6,e/3,e/3);break;case STRAIGHT:a.fillRect(-e/2,-e/2,e/3,e),a.fillRect(e/6,-e/2,e/3,e);break;case TRIPLE:a.fillRect(-e/2,-e/2,e/3,e/3),a.fillRect(e/6,-e/2,e/3,e/3),a.fillRect(-e/2,e/6,e,e/3);}a.rotate(-d.rotation*Math.PI/2),d.type==SPAWN&&(a.fillStyle=getColorForPlayer(d.rotation),a.beginPath(),a.arc(0,0,e/8,0,2*Math.PI),a.fill()),0<=d.treasure&&a.drawImage(treasureSpritesheet,16*d.treasure,0,16,16,-e/8,-e/8,e/4,e/4),a.strokeStyle='#FFFFFF',a.strokeRect(-e/2,-e/2,e,e),a.restore()}function drawMap(a,b,c){for(let d=0;d<Game.rules.size;d++)for(let e=0;e<Game.rules.size;e++)drawPiece(a,b+d*Renderer.tileSize,c+e*Renderer.tileSize,Game.map[d][e])}function drawPlayers(a){let b=Renderer.tileSize;for(let c=0;c<Game.playerPos.length;c++)a.save(),a.translate(Game.playerPos[c].x*b+b/2+Renderer.mapOffset,Game.playerPos[c].y*b+b/2+Renderer.mapOffset),a.translate(2*(c%2)*b/3,2*Math.floor(c/2)*b/3),a.drawImage(playerSpritesheet,16*(c+1),0,16,16,-b/2,-b/2,b/3,b/3),a.restore()}function drawGoals(a){let b=Renderer.tileSize;a.save(),a.translate(b*Game.rules.size+3*Renderer.mapOffset,Renderer.mapOffset+2*b);let c=Game.goals.filter(d=>!1===d.found);if(0===c.length)a.font=b/5+'px Calibri',a.fillText('All goals found!',-12,0),a.fillText('Go back to spawn!',-22,20);else{a.font=b/5+'px Calibri',a.fillText('Your goals :',0,0);for(let d=0;d<c.length;d++){let e=3*(d%3)*b/8,f=3*Math.floor(d/3)*b/8+b/5;a.drawImage(treasureSpritesheet,16*c[d].id,0,16,16,e,f,b/4,b/4)}}a.restore()}function drawButtons(a){a.save();let b=null;for(let c=0;c<UI.buttons.length;c++)b=UI.buttons[c],a.font=b.font,a.fillStyle=b.background,a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=b.foreground,a.fillText(b.text,b.x+b.width/2-a.measureText(b.text).width/2,b.y+b.height/2+5);a.restore()}function renderGame(a){let b=canvas.getBoundingClientRect();a.clearRect(0,0,b.width,b.height),drawMap(a,Renderer.mapOffset,Renderer.mapOffset),a.font=Renderer.tileSize/5+'px Calibri',a.fillText('Next piece :',Renderer.tileSize*Game.rules.size+3*Renderer.mapOffset,Renderer.mapOffset-16+4),drawPiece(a,Renderer.tileSize*Game.rules.size+3*Renderer.mapOffset,Renderer.mapOffset,Game.movingPiece),drawGoals(a),drawPlayers(a),drawButtons(a)}