<style>body,html{width:100vw;height:100vh;margin:0;padding:0;background-color:#0a1a2f}#d1{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center}#d2{max-width:100vw;max-height:100vh;aspect-ratio:48/27}#canvas{width:100%;height:100%}</style><div id="d1"><div id="d2"><canvas id="canvas"></canvas></div></div><script>!function(){const t=function(){var t,i,s,h,e,r=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*2**((t-128)/12)},n=function(t,i,s){var h,e,r,n,l,f,c=a[t.t[0]],g=t.t[1],d=t.t[3]/32,u=a[t.t[4]],O=t.t[5],w=t.t[8]/32,E=t.t[9],y=t.t[10]*t.t[10]*4,p=t.t[11]*t.t[11]*4,m=t.t[12]*t.t[12]*4,v=1/m,R=-t.t[13]/16,M=t.t[14],T=s*2**(2-t.t[15]),A=new Int32Array(y+p+m),S=0,G=0;for(h=0,e=0;h<y+p+m;h++,e++)e>=0&&(e-=T,l=o(i+(15&(M=M>>8|(255&M)<<4))+t.t[2]-128),f=o(i+(15&M)+t.t[6]-128)*(1+8e-4*t.t[7])),r=1,h<y?r=h/y:h>=y+p&&(r=(1-(r=(h-y-p)*v))*3**(R*r)),n=c(S+=l*r**d)*g,n+=u(G+=f*r**w)*O,E&&(n+=(2*Math.random()-1)*E),A[h]=80*n*r|0;return A},a=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.s=function(r){t=r,i=r.i,s=0,h=r.h*r.o*(i+1)*2,e=new Int32Array(h)},this.l=function(){var o,l,f,c,g,d,u,O,w,E,y,p,m,v,R=new Int32Array(h),M=t.u[s],T=t.h,A=t.o,S=0,G=0,x=!1,U=[];for(f=0;f<=i;++f)for(u=M.p[f],c=0;c<A;++c){var b=u?M.c[u-1].f[c]:0;b&&(M.t[b-1]=M.c[u-1].f[c+A]||0,b<17&&(U=[]));var I=a[M.t[16]],V=M.t[17]/512,k=2**(M.t[18]-9)/T,C=M.t[19],H=M.t[20],F=43.23529*M.t[21]*3.141592/44100,L=1-M.t[22]/255,Y=1e-5*M.t[23],D=M.t[24]/32,P=M.t[25]/512,Z=6.283184*2**(M.t[26]-9)/T,J=M.t[27]/255,N=M.t[28]*T&-2;for(y=(f*A+c)*T,g=0;g<4;++g)if(d=u?M.c[u-1].n[c+g*A]:0){U[d]||(U[d]=n(M,d,T));var j=U[d];for(l=0,o=2*y;l<j.length;l++,o+=2)R[o]+=j[l]}for(l=0;l<T;l++)(E=R[O=2*(y+l)])||x?(p=F,C&&(p*=I(k*O)*V+.5),G+=(p=1.5*Math.sin(p))*(m=L*(E-G)-(S+=p*G)),E=3==H?G:1==H?m:S,Y&&(E=(E*=Y)<1?E>-1?r(.25*E):-1:1,E/=Y),x=(E*=D)*E>1e-5,v=E*(1-(w=Math.sin(Z*O)*P+.5)),E*=w):v=0,O>=N&&(v+=R[O-N+1]*J,E+=R[O-N]*J),R[O]=0|v,R[O+1]=0|E,e[O]+=0|v,e[O+1]+=0|E}return++s/t.v},this.M=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var r=i.getChannelData(s),o=s;o<h;o+=2)r[o>>1]=e[o]/65536;return i},this.T=function(){var t=44+2*h-8,i=t-36,s=new Uint8Array(44+2*h);s.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var r=0,o=44;r<h;++r){var n=e[r];n=n<-32767?-32767:n>32767?32767:n,s[o++]=255&n,s[o++]=n>>8&255}return s},this.getData=function(t,i){for(var s=2*Math.floor(44100*t),h=new Array(i),r=0;r<2*i;r+=1){var o=s+r;h[r]=t>0&&o<e.length?e[o]/32768:0}return h}},i={u:[{t:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,127,127,,,,,,127,127,,,,,,127,127,,,,,,127,127],f:[]}]},{t:[0,255,116,85,0,255,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,136,15,0,32,0,0,66,6],p:[,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[,,,,,139,,,,,,,139,,,,,,,139,,,,,,,139],f:[]}]},{t:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,93,4],p:[,,3,3,3,3,3,2,3,2,6,3,2,3,6,3,2,3,6,3,2,3,6,3,5,7],c:[{n:[],f:[]},{n:[132,,132,,132,,,132,,,,,,,127,,139,,127,,,127,,,127,,,,135,,135,,135,,,135,,131,,127,,,130,,130,,130,,,130,,,130,,,,139,,139,,139,,,139,,135,,131,,,134,,134,,134,,,134,,,134,,,,,,,,,,,140,,,,135,,129,,,,,,,,135,,,138,,135],f:[]},{n:[127,,127,,127,,,127,,,,,,,127,,139,,127,,,127,,,127,,,,130,,130,,130,,,130,,,,,,,130,,130,,130,,,130,,,130,,,,134,,134,,134,,,134,,,,,,,134,,134,,134,,,134,,,134,,,,,,,,,,,135,,,,,,,,,,,,,,135,,,138,,135],f:[]},{n:[127,,127,,127,,,127,,,,139,127,,127,,139,,127,,,127,,,133,,133,,130,,130,,130,,,130,,,,,130,,130,,130,,130,,,130,,139,136,,136,,134,,134,,134,,,134,,,,,134,,134,,134,,134,,,134,,,140,,140,,,,,,,,,135,,,,,137,,,,,,,,,135,,,141,,,137],f:[]},{n:[127,,127,,127,,,133,,133,,130,,,127,,,,127,,,,,,,,,,130,,132,,130,,,136,,136,,133,,,130,,130,,,,,,,,,,,,134,,134,,134,,139,,,140,,137,,,134,,134,,,,,,,,,,,,,,,,,,,141,,,,,,135,,,,,,,,135,,,138],f:[]},{n:[127,,127,,127,,,133,,133,,130,,,127,,139,,127,,,127,,,127,,,,130,,132,,130,,,136,,136,,133,,,130,,130,,130,,,130,,,130,,,,134,,134,,134,,139,,,140,,137,,,134,,134,,134,,,134,,,134,,,,,,,,,,,141,,,,,,135,,,,,,,,135,,,138,,135],f:[]},{n:[127,,127,,127,,,127,,127,,127,,,,,,,,,,,,,,,,,130,,134,,130,,,130,,130,,130,,,,,,,,,,,,,,,,,,,,,,,,,,135,,138],f:[]}]},{t:[2,40,140,64,0,0,140,0,0,192,7,21,0,0,0,0,0,0,0,0,3,161,192,5,27,0,7,25,1],p:[,,,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[127,,127,,127,,,127,,127,,127,,,127,,127,,127,,,127,,127,,127],f:[]}]},{t:[2,192,128,0,2,192,140,18,0,0,27,115,138,0,0,0,0,91,6,1,2,8,92,21,32,148,5,85,8],p:[2,3,2,3,,,,,,,,,,,,2,3,2,3,2,3,2,3,2,3,2,3],c:[{n:[],f:[]},{n:[,,,,,,,127,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]},{n:[,,,,,,,127,,,,,,,,,,,,,,,,,,,,,,,,,,,,130],f:[]}]}],h:10023,o:28,i:26,v:5},s=[{t:[0,0,140,0,0,0,140,0,0,81,4,10,20,37,0,0,0,187,5,0,1,239,135,0,32,108,5,9,4],p:[2],c:[{n:[],f:[]},{n:[151],f:[]}]},{t:[0,255,152,0,0,255,152,12,0,0,2,0,61,0,0,0,0,0,0,0,2,255,0,0,24,47,8,69,2],p:[2],c:[{n:[],f:[]},{n:[139],f:[]}]},{t:[3,146,140,0,1,224,128,3,0,0,16,13,3,0,0,0,3,179,5,0,2,124,135,11,32,150,3,28,6],p:[2],c:[{n:[],f:[]},{n:[146,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[]}]},{t:[3,130,121,64,2,117,109,0,32,0,28,24,60,0,0,0,0,0,0,0,2,255,0,2,32,83,5,92,1],p:[2],c:[{n:[],f:[]},{n:[139],f:[]}]},{t:[0,0,140,0,0,0,140,0,0,255,113,75,57,0,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[2],c:[{n:[],f:[]},{n:[139,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142],f:[]}]},{t:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,14,0,10,32,0,0,0,0],p:[2],c:[{n:[],f:[]},{n:[127,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,127,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[]}]}],h={s(){h.S=!1,h.C=!1},R(){h.S||(h.O=new AudioContext,h.A=h.O.createGain(),h.A.connect(h.O.destination),h.S=!0)},k(){if(!h.m){let t=s.map(t=>({u:[t],h:3120,o:32,i:0,v:1}));h.click=this.L(t[0]),h.N=this.L(t[1]),h.I=this.L(t[2]),h.U=this.L(t[3]),h.F=this.L(t[4]),h.D=this.L(t[5]),h.H=this.L(i),h.C=!0,h.e(h.H,h.O.currentTime+.1,!0),h.m=!0}},E(){h.C},e(t,i,s){if(!h.C)return;if(!t)return;let e=h.O.createBufferSource();e.buffer=t.buffer,e.loop=s||!1,e.connect(t.P),e.start(i||h.O.currentTime)},g(){h.C&&h.A.gain.linearRampToValueAtTime(0,h.O.currentTime+1)},b(){h.C&&h.A.gain.linearRampToValueAtTime(1,h.O.currentTime+1)},L(i){let s=new t;for(s.s(i);1!==s.l(););let e=h.O.createGain();e.connect(h.A);let r=s.M(h.O);return{W:s,P:e,buffer:r}}},e=["SANITY","INFLUENCE","WOOD","MEAT","TORCHES","STONE"],r=10,o=[{G:39,V:70},{G:10,V:58},{G:3,V:28},{G:22,V:3},{G:57,V:3},{G:76,V:28},{G:69,V:58}],n=["#0a1a2f","#04373b","#1a644c","#40985c","#d1cb95"];function a(t,i,s){return t<i?i:t>s?s:t}function l(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{z:s,O:h}}const f={B:[[0,0,24,36]],button:[[0,36,9,9],[9,36,9,9],[18,36,9,9]],K:[[0,45,270,12]],Y:[[0,57,8,8],[8,57,8,8],[16,57,8,8],[24,57,8,8]],j:[[0,65,101,14]],J:[[0,79,1,1],[1,79,1,1],[2,79,1,1],[3,79,1,1],[4,79,1,1]],$:[[0,80,90,1]],_:[[0,81,9,16],[9,81,9,16],[18,81,9,16],[27,81,9,16]],X:[[0,97,3,5],[3,97,3,5],[6,97,3,5],[9,97,3,5]],q:[[0,102,17,16],[17,102,17,16],[34,102,17,16],[51,102,17,16],[68,102,17,16],[85,102,17,16],[102,102,17,16],[119,102,17,16],[136,102,17,16],[153,102,17,16]],Z:[[0,118,11,22],[11,118,11,22],[22,118,11,22],[33,118,11,22],[44,118,11,22],[55,118,11,22],[66,118,11,22],[77,118,11,22],[88,118,11,22],[99,118,11,22]],tt:[[0,140,9,9],[9,140,9,9],[18,140,9,9],[27,140,9,9],[36,140,9,9],[45,140,9,9]],I:[[0,149,3,5],[3,149,3,5],[6,149,3,5],[9,149,3,5]],it:[[0,154,320,150]],st:[[0,304,320,150]],ht:[[0,454,320,150]]},c={s(){c.z=document.getElementById("canvas"),c.O=c.z.getContext("2d"),c.Q()},Q(){let t=window.devicePixelRatio,i=c.z.clientWidth,s=c.z.clientHeight;if(i!==c.clientWidth||s!==c.clientHeight){c.width=320,c.height=180,c.clientWidth=i,c.clientHeight=s;let h=Math.ceil(i*t/320);c.z.width=320*h,c.z.height=180*h,c.scale=h,c.O.imageSmoothingEnabled=!1,c.O.webkitImageSmoothingEnabled=!1}c.z.style.cursor="none"}},g={et(t){let i=new Image;i.onload=()=>{g.at=i,t()},i.onerror=()=>{t()},i.src="sprites.png"},s(){g.font=u(f.K[0]),g.J=f.J.map(u),g.B=d(f.B),g.button=d(f.button),g.X=d(f.X),g.j=d(f.j),g.$=d(f.$),g.Y=d(f.Y),g.I=d(f.I),g.q=d(f.q),g.q[1]=O(p(g.q[0].rt,n[3])),g._=d(f._,{pt:{x:4,y:10}}),g.nt=[u(f.it[0]),u(f.st[0]),u(f.ht[0])];for(let t=0;t<3;t++)g.nt[t].rt=y(g.nt[t].rt,30,n[t]);g.tt=d(f.tt,{pt:{x:4,y:4}}),g.Z=d(f.Z,{pt:{x:5,y:21}});const t=g.Z.length;g.Z[1].rt=E(g.Z[0].rt,g.Z[1].rt,11,20),g.Z[7].rt=E(g.Z[6].rt,g.Z[7].rt,11,20),g.Z[9].rt=E(g.Z[8].rt,g.Z[9].rt,11,20);for(let i=0;i<t;i++)g.Z[i+t]=O(w(g.Z[i].rt),{pt:{x:5,y:21}});g.Z[2].pt=g.Z[3].pt=g.Z[5].pt={x:16,y:21},g.Z[2+t].pt=g.Z[3+t].pt=g.Z[5+t].pt={x:-6,y:21}},ot(t,i,s,h){t.drawImage(i.rt,s-i.pt.x,h-i.pt.y)},ct(t,i,s){let{G:h,V:e}=this.lt(t,i);s?(c.O.save(),c.O.translate(h+t.pt.x,e+t.pt.y),c.O.rotate(s),c.O.drawImage(t.rt,-t.pt.x,-t.pt.y),c.O.restore()):c.O.drawImage(t.rt,h,e)},lt:(t,i)=>({G:i.G-t.pt.x,V:i.V-t.pt.y})};function d(t,i){return t.map(t=>u(t,i))}function u(t,i){return O(function(t,i,s,h){const e=g.at,r=l(s,h);return r.O.drawImage(e,t,i,s,h,0,0,s,h),r.z}(...t),i)}function O(t,i){return"object"!=typeof i&&(i={}),i.pt||(i.pt={x:0,y:0}),{rt:t,...i}}function w(t){let i=l(t.width,t.height);return i.O.translate(t.width,0),i.O.scale(-1,1),i.O.drawImage(t,0,0),i.z}function E(t,i,s,h){let e=l(i.width,i.height);return e.O.drawImage(i,0,0),e.O.drawImage(t,0,0,s,h,0,0,s,h),e.z}function y(t,i,s){let h=l(320,180);return h.O.drawImage(t,0,0),h.O.fillStyle=s,h.O.fillRect(0,180-i,320,i),h.z}function p(t,i){let s=l(t.width,t.height);return s.O.fillStyle=i,s.O.fillRect(0,0,t.width,t.height),s.O.globalCompositeOperation="destination-in",s.O.drawImage(t,0,0),s.z}const m={10:0,32:3,33:3,39:2,40:3,41:3,44:3,46:3,47:6,73:2,77:6,84:6,86:6,87:6,88:6,89:6,91:4,109:6,111:6,1108:10,1114:10,1069:6,1083:6,1067:10},v={},R={s(){R.ut=g.font.rt,R.mt=n.map(t=>p(R.ut,t)),v[1108]=g.button[0],v[1114]=g.button[0],v[1069]=g.button[0],v[1083]=g.button[0],v[1067]=g.button[0]},ft(t,i,s,h,e=1,r=R.ut){for(let o of this.dt(i,e)){let i=r;v[o.c]&&(t.drawImage(v[o.c].rt,s+o.G,h+o.V-Math.floor(v[o.c].rt.height/2)+2),i=R.mt[0],o.c-=1e3,o.G+=2);let n=6*(o.c-32);t.drawImage(i,n%270,6*(n/270|0),5,5,s+o.G,h+o.V,5*e,5*e)}},wt(t,i,s,h,e,r=1,o=R.ut,n){const a=this.vt(i,e,r);for(let i=0;i<a.length;i++)this.ft(t,a[i],s,h+7*i*r,r,o,n)},vt(t,i,s=1){const h=[];let e="";const r=t.split(" ");for(;r.length>0;)this.vi(e+" "+r[0],s).w>i&&(h.push(e),e=""),e=(e.length>0?e+" ":"")+r.shift();return e.length>0&&h.push(e),h},vi(t,i=1){let s=0,h=0;for(let e of this.dt(t,i))s=Math.max(s,e.G+(m[e.c]||5)*i),h=e.V+7*i;return{w:s,Mt:h}},*dt(t,i=1){let s=0,h=0;for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);10!==r?(92===r&&(e++,r=1e3+t.charCodeAt(e)),yield{c:r,G:s,V:h},s+=(m[r]||5)*i):(s=0,h+=7*i)}}},M={s(){M.Tt=[],window.addEventListener("keydown",t=>{h.R(),M.Tt[t.code]=!0}),window.addEventListener("keyup",t=>{M.Tt[t.code]=!1}),M.is()},is(){for(let t of T.St)M.Tt[t]=!1}},T={St:["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Escape","Space","KeyV","KeyH","KeyS","KeyF","KeyC"],s(){this.os={},this.released={},this.Tt={},M.s()},E(){for(let t of T.St){let i=M.Tt[t];this.os[t]=!this.Tt[t]&&i,this.released[t]=this.Tt[t]&&!i,this.Tt[t]=i}}};class A{constructor(){this.gt=-1,this.d=60,this.Et={G:320*Math.random(),V:200*Math.random()},this.yt=Math.floor(3*Math.random())+1,this.alpha=1}E(){++this.gt===this.d&&(this.Ct=!0),this.gt>36&&(this.alpha-=.02),this.Et.V+=.1,Math.random()<.05&&(this.Et.G+=.5)}draw(){c.O.globalAlpha=this.alpha,c.O.drawImage(g.J[this.yt-1].rt,Math.floor(this.Et.G),Math.floor(this.Et.V)),c.O.globalAlpha=1}}class S{constructor(t){this.gt=-1,this.d=30,this.Z=t}E(){++this.gt===this.d&&(B.Ot.Rt([10]),this.Ct=!0),this.gt>=24&&this.gt<=27&&this.Z.At(),24===this.gt&&h.e(h.U),this.Z.Et.V-=.2}draw(){let t=this.Z.Et.G,i=Math.floor(this.Z.Et.V);if(this.gt>=0&&this.gt<15){let s=this.gt%3-1;g.ct(g.Z[0],{G:t+s,V:i})}else this.gt>=15&&this.gt<=25&&(g.ct(g.Z[0],{G:t,V:i}),g.ct(g.Z[0],{G:t-1,V:i}),g.ct(g.Z[0],{G:t+1,V:i}))}}class G{constructor(t,i,s,h){this.G=t,this.V=i,this.xt=s,this.as=h,this.visible=!1,this.active=!1}E(){}draw(){if(this.visible){const t=this.active?0:2,i=this.active?4:2,s=this.active?0:2;c.O.drawImage(g.button[t].rt,this.G,this.V),R.ft(c.O,this.xt,this.G+2,this.V+2,1,R.mt[s]),R.ft(c.O,this.as.toUpperCase(),this.G+11,this.V+2,1,R.mt[i])}}}class x{constructor(t){this.gt=-1,this.kt=t}bt(){B.Ot.bt(this.Lt)?this.Nt=!0:(B.Ot.Rt([-1]),h.e(h.D))}It(){this.Nt&&B.Ot.Rt(this.Rt)}E(){if(this.gt++,this.gt<this.kt[0].Ut)return this.value=this.kt[0].Ft,void(this.Dt=this.kt[0].Ht-this.kt[0].Ft>=0?1:0);if(this.gt>=this.kt[this.kt.length-1].Pt)return this.value=this.kt[this.kt.length-1].Ht,this.Dt=this.kt[this.kt.length-1].Ht-this.kt[this.kt.length-1].Ft>=0?1:0,void(this.finished=!0);for(let t=0;t<this.kt.length;t++)if(this.gt>=this.kt[t].Ut&&this.gt<this.kt[t].Pt){if(1===t&&!this.Wt&&(this.Wt=!0,this.bt(),!this.Nt)){this.gt=this.kt[2].Ut;continue}void 0===this.kt[t].Ft&&(this.kt[t].Ft=this.kt[t-1].Ht),void 0===this.kt[t].Ht&&(this.kt[t].Ht=this.kt[t].Ft),this.kt[t].Gt&&(this.kt[t].Ht+=Math.floor(Math.random()*this.kt[t].Gt-this.kt[t].Gt/2),this.kt[t].Gt=void 0),this.value=(this.kt[t].Ht-this.kt[t].Ft)*(this.gt-this.kt[t].Ut)/(this.kt[t].Pt-this.kt[t].Ut)+this.kt[t].Ft,this.Dt=this.kt[t].Ht-this.kt[t].Ft>=0?1:0;break}}}const U=[[],[149,149,149,149,149,149,149,149,149,148,148,148,148,148,148,147,147,147,146,146,146,145,145,144,144,144,143,143,142,141,141,141,140,140,140,139,139,139,139,139,138,138,138,138,138,138,137,137,137,137,137,137,137,137,136,136,136,135,135,135,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,136,136,136,137,137,137,138,139,139,140,140,140,140,141,141,141,141,141,141,142,142,143,143,143,143,144,144,144,144,144,144,144,144,144,144,144,145,145,146,145,145,145,145,145,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,145,146,146,147,147,148,148,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,148,148,148,148,148,148,148,148,148,148,148,148,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,148,148,149,149,149,149,150,150,150,150,151,151,152,152,152,153,153,153,154,154,154,154,154,154,153,153,153,153,152,152,152,152,151,151,151,151,151,151,150,150,150,150,150,150,150,150,150,150,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149],[126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,127,128,128,129,129,129,130,130,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,133,133,133,133,133,134,134,135,136,136,137,138,138,139,139,139,140,140,140,140,139,139,139,139,139,139,138,138,138,138,138,137,137,137,137,137,137,137,137,137,137,137,137,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,139,139,139,139,140,140,141,141,141,142,142,142,143,143,143,143,143,144,144,144,144,144,144,144,144,144,144,144,144,144,144,143,143,143,143,143,143,143,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,143,143,143,143,143,143,143,144,144,144,144,144,144,145,145,145,145,145,145,145,146,145,145,145,145,144,144,144,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,144,144,144,144,144,144,144,144,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,130,130,130,129,129,129,129,128,128,127,127,127,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,118,110,103,102,102,102,101,101,101,100,100,100,99,99,99,98,98,98,97,97,97,97,96,96,96,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,103,111,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,120,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121]];class b{constructor(t){var i;this.gt=-1,this.d=30,this.angle=Math.random()*Math.PI+Math.PI,this.Vt=(i=this.angle,{x:Math.cos(i),y:Math.sin(i),Bt:1}),this.Bt=50+25*Math.random(),this.a=Math.random()*Math.PI*2,this.Kt=.1,this.Et={G:t.G,V:t.V-12},this.Et.G+=3*this.Vt.x,this.Et.V+=3*this.Vt.y,this.ys=Math.floor(6*Math.random())}E(){++this.gt===this.d&&(this.Ct=!0),this.Et.G+=this.Bt/this.d*this.Vt.x,this.Et.V+=this.Bt/this.d*this.Vt.y,this.Vt.x*=.95,this.Vt.y*=.95,this.Vt.y+=.05,this.a+=this.Kt}draw(){g.ct(g.tt[this.ys],this.Et,this.a)}}const I=0,V=1,k=2,C=3,H=4,F=5;class L extends x{constructor(t){super([{Ut:0,Pt:120,Ft:t,Ht:0}]),this.ys=0,this.yt=1,this.Lt=[],this.Rt=[]}}const Y={[V]:class extends x{constructor(){super([{Ut:0,Pt:120,Ft:0,Ht:140,Gt:15},{Ut:120,Pt:180,Ft:void 0,Ht:140,Gt:15},{Ut:180,Pt:300,Ft:void 0,Ht:0}]),this.yt=1,this.ys=0,this.Lt=[0,0,0,1],this.Rt=[0,0,B.Ot.Jt.jt.Yt?7:5]}E(){super.E();const t=this.gt>130&&this.gt<170?Math.floor(this.gt/10)%2:this.Dt;this.ys=Math.floor((this.gt+1)/8)%2+t*r,this.$t=this.gt>60&&this.gt<210?2+t*r:void 0}},[k]:class extends x{constructor(){super([{Ut:0,Pt:120,Ft:0,Ht:-76,Gt:20},{Ut:120,Pt:180,Ft:void 0,Ht:-76,Gt:20},{Ut:180,Pt:300,Ft:void 0,Ht:0}]),this.yt=1,this.ys=0,this.Lt=[],this.Rt=[0,0,0,B.Ot.Jt._t.Yt?7:5]}E(){super.E();const t=this.gt>140&&this.gt<160?Math.floor(this.gt/10)%2:this.Dt;this.ys=Math.floor((this.gt+1)/8)%2+t*r,this.$t=this.gt>60&&this.gt<210?3+t*r:void 0}},[C]:class extends x{constructor(){super([{Ut:0,Pt:120,Ft:0,Ht:47},{Ut:120,Pt:180,Ft:47,Ht:47},{Ut:180,Pt:300,Ft:47,Ht:0}]),this.yt=2,this.ys=0,this.Lt=[0,0,2,3],this.Rt=[0,0,0,0,B.Ot.Jt.zt.Yt?2:1]}E(){super.E();const t=this.gt>140&&this.gt<160?Math.floor(this.gt/10)%2:this.Dt;this.ys=Math.floor((this.gt+1)/8)%2+6+t*r}},[H]:class extends x{constructor(){super([{Ut:0,Pt:120,Ft:0,Ht:-141},{Ut:120,Pt:180,Ft:-141,Ht:-141},{Ut:180,Pt:300,Ft:-141,Ht:0}]),this.yt=1,this.ys=0,this.Lt=[0,0,0,1,1],this.Rt=[0,0,0,0,0,B.Ot.Jt.Xt.Yt?7:5]}E(){super.E();const t=this.gt>140&&this.gt<160?Math.floor(this.gt/10)%2:this.Dt;this.ys=Math.floor((this.gt+1)/8)%2+t*r,this.$t=this.gt>60&&this.gt<210?5+t*r:void 0}},[F]:class extends x{constructor(){super([{Ut:0,Pt:120,Ft:135,Ht:70,Gt:15},{Ut:120,Pt:180,Ft:void 0,Ht:void 0},{Ut:180,Pt:300,Ft:void 0,Ht:135}]),this.yt=3,this.ys=0,this.Lt=[0,0,3,3,1,3],this.Rt=[B.Ot.Jt.qt.Yt?2:1]}E(){super.E();const t=this.gt>120&&this.gt<180?0:this.Dt;this.ys=Math.floor((this.gt+1)/8)%2+t*r+8}},[I]:class extends x{constructor(){super([{Ut:0,Pt:30,Ft:0,Ht:0}]),this.ys=0,this.yt=1,this.Lt=[],this.Rt=[]}}};class D{static Qt=["","WOODCUTTER","BUTCHER","TALLOWER","STONEMASON","CANTOR"];constructor(t){this.Zt=t,this.gt=0,this.Et={G:0,V:0}}E(){this.ti||(this.ti=new Y[this.Zt]),this.ti.E(),this.yt=this.ti.yt,this.Et.G=160+this.ti.value,this.Et.V=U[this.yt][Math.floor(this.Et.G)]-32+1,this.ys=this.ti.ys||0,this.$t=this.ti.$t,this.ti.finished&&(this.ti.It(),this.ti=void 0)}draw(t=0){g.ct(g.Z[this.ys],{G:this.Et.G,V:this.Et.V+t}),this.$t>-1&&g.ct(g.Z[this.$t],{G:this.Et.G,V:this.Et.V+t})}ii(){return new Y[this.Zt]}At(){B.Ot.Rs.push(new b(this.Et)),B.Ot.Rs.push(new b(this.Et)),B.Ot.Rs.push(new b(this.Et)),B.Ot.Rs.push(new b(this.Et)),B.Ot.Rs.push(new b(this.Et))}}class P{constructor(){this.gt=-1,this.d=15,this.ys=3,this.yt=1}E(){++this.gt===this.d&&(this.Ct=!0),2===this.gt?this.ys=0:(6===this.gt||8===this.gt||10===this.gt)&&this.ys++}draw(){c.O.drawImage(g.I[this.ys].rt,170,50)}}class Z{constructor(t,i){this.frames=t,this.si=i,this.hi=[],this.ei=[];var s=t/2;for(let t=0;t<=s;t++)this.hi.push(2*Math.random()-1),this.ei.push(2*Math.random()-1);this.ys=-1}E(){if(this.ys++,this.ys>=this.frames)return this.x=0,this.y=0,!1;let t=this.ys/2,i=0|t,s=i+1,h=1-this.ys/this.frames;return this.x=this.si*h*(this.hi[i]+(t-i)*(this.hi[s]-this.hi[i])),this.y=this.si*h*(this.ei[i]+(t-i)*(this.ei[s]-this.ei[i])),!0}}class J{constructor(t){this.Jt=t,this.gt=0;let i=B.Ot.ri||Object.values(this.Jt)[0];this.Et={x:i.x,y:i.y}}E(){B.Ot.E(!1),this.gt++,this.ni=Math.floor(3*Math.cos(this.gt/8)),B.Ot.ri=this.Et,T.os.ArrowRight&&this.move(1,0),T.os.ArrowLeft&&this.move(-1,0),T.os.ArrowUp&&this.move(0,-1),T.os.ArrowDown&&this.move(0,1),T.os.Space&&(B.Ot.oi(B.Ot.ai(this.Et.x,this.Et.y))?h.e(h.I):h.e(h.D)),T.os.Escape&&B.ci.pop()}draw(){c.O.fillStyle="rgba(0,0,0,0.72)",c.O.fillRect(0,0,c.width,c.height);let t=23*-this.Et.x,i=19*-this.Et.y,s=180;for(let h of Object.values(this.Jt))if(h&&h.visible&&Math.abs(h.x-this.Et.x)<=2&&Math.abs(h.y-this.Et.y)<=2){let r=h.Yt?1:0;if(c.O.drawImage(g.q[r].rt,t+69+23*h.x,i+81+19*h.y),h.li&&c.O.drawImage(g.q[h.li].rt,t+69+23*h.x,i+81+19*h.y),h.x==this.Et.x&&h.y==this.Et.y){if(c.O.drawImage(g.q[2].rt,t+69+23*h.x,i+81+19*h.y),R.ft(c.O,h.Os.toUpperCase(),s,40,1,R.mt[4]),R.wt(c.O,h.As.toUpperCase(),s,50,132,1,R.mt[3]),h.Yt)R.ft(c.O,"UNLOCKED",s,80,1,R.mt[4]);else{let t=B.Ot.ui(h.fi)?4:2,i=[];for(let t=0;t<h.fi.length;t++)h.fi[t]&&i.push(h.fi[t]+" "+e[t]);R.ft(c.O,"UNLOCK:",s,80,1,R.mt[3]),R.wt(c.O,i.join("\n"),236,80,76,1,R.mt[t])}let r=h.di?"PER TURN:":"PER USE:";R.ft(c.O,r,s,110,1,R.mt[3]),R.wt(c.O,(h.di||h.pi).toUpperCase(),236,110,76,1,R.mt[4])}}const h="ARROWS TO MOVE   SPACE TO UNLOCK   \\E\\S\\C BACK",r=R.vi(h,1).w;R.ft(c.O,h,(c.width-r)/2,170,1,R.mt[4])}move(t,i){h.e(h.click),B.Ot.ai(this.Et.x+t,this.Et.y+i)?.visible&&(this.Et.x+=t,this.Et.y+=i)}}class N{constructor(t,i){if(this.wi=t,this.stats=i,this.Mi=[["FREEDOM","NO",0],["SEALS LIT",String(i.Ti),1e3*i.Ti],["WOOD GATHERED",String(i.Si),a(i.Si,0,1e3)],["MEAT BUTCHERED",String(i.gi),a(i.gi,0,1e3)],["TORCHES CRAFTED",String(i.Ei),a(i.Ei,0,1e3)],["STONE MINED",String(i.yi),a(i.yi,0,1e3)],["TIME",String(i.Ci),a(i.Ci,0,1e3)]],t){this.Os="VICTORY",this.as=["FREEDOM RINGS OUT, NOT JUST FOR ULTHAR,","BUT THE ENTIRE PLANET.",""],this.Mi[0][1]="YES",this.Mi[0][2]=7e3;for(let t=2;t<7;t++)this.Mi[t][2]=1e3-this.Mi[t][2]}else this.Os="GAME OVER",this.as=["THE LAST SPARK OF SANITY FADES IN ULTHAR, AND WITH IT","ANY HOPE OF FREEDOM FOR YOU AND YOUR KIN.",""];this.gt=0,this.Ri=0,this.Oi=7;for(let t=0;t<7;t++)this.Ri+=this.Mi[t][2]}E(){this.gt++,T.os.Space&&(h.e(h.click),B.ci.pop(),B.ci.push(new $)),15===this.gt&&h.e(h.click)}draw(){c.O.fillStyle=n[0],c.O.fillRect(0,0,c.width,c.height);const t=R.vi(this.Os,2).w;R.ft(c.O,this.Os,(c.width-t)/2,10,2,R.mt[4]);let i=0;for(i=0;i<this.as.length;i++){let t=R.vi(this.as[i],1).w;R.ft(c.O,this.as[i],(c.width-t)/2,32+10*i,1,R.mt[4])}i+=.5;for(let t=0;t<14;t++){let s=Math.floor(t/2),h=t%2;if(0===h&&R.ft(c.O,this.Mi[s][0],70,32+10*i,1,R.mt[3]),1===h){let t=R.vi(this.Mi[s][1],1).w;R.ft(c.O,this.Mi[s][1],250-t,32+10*i,1,R.mt[4]),i++}}i=11,R.ft(c.O,"FINAL SCORE",70,32+10*i,1,R.mt[3]);let s=R.vi(String(this.Ri),1).w;if(R.ft(c.O,String(this.Ri),250-s,32+10*i,1,R.mt[4]),this.gt>15){let t="PRESS SPACE TO PLAY AGAIN",i=R.vi(t,1).w;R.ft(c.O,t,160-i/2,165,1,R.mt[4],R.mt[1])}}}function j(t,i,s){t.Hi&&!i||(t.Hi=[0,1,2,3,4,5,6,7,8].map(t=>s*(12*Math.random()-6)),t.Pi=[0,1,2,3,4,5,6,7,8].map(t=>1-s*Math.random()));for(let i=0;i<9;i++){let s=4*i;c.O.globalAlpha=t.Pi[i],c.O.drawImage(g.B[0].rt,0,s,24,4,160+t.Hi[i],43+s,24,4)}c.O.globalAlpha=1}class ${constructor(){B.Ot=this,this.Rs=[],this.Wi=[],this.Gi=[100,1,0,0,0,0],this.Vi=[0,1,0,0,0,0],this.Bi=[0,1,0,0,0,0],this.gt=0,this.Ki=0,this.Ti=0,this.Us=[new G(5,3,"V","RECRUIT VILLAGER"),new G(5,15,"S","SACRIFICE VILLAGER"),new G(5,27,"F","LIGHT FREEDOM"),new G(275,156,"C","CODEX"),new G(275,168,"H","HELP")],this.Us[3].active=!0,this.Us[4].visible=!1,this.Us[4].active=!0,this.Yi=1,this.ji=[1],this.Ji=[2],this.$i=[],this._i=[[],[],[],[],[],[],[],[]];let t=new D(0);t.ti=new L(-50),this.$i.push(t),t=new D(0),t.ti=new L(80),this.$i.push(t),this.Jt={Ai:{Os:"Woodcutters",As:"Recruit villagers to gather wood.",di:"-1 Meat\n+5 Wood",fi:[],x:4,y:4,li:3,d:!0,xi:!0,G:!0},ki:{Os:"Butchers",As:"Recruit villagers to gather meat.",di:"-1 Meat\n+5 Meat",fi:[0,0,10],x:4,y:5,li:4,d:!0,r:!0},mi:{Os:"Tallowers",As:"Recruit villagers to render fat and make torches.",di:"-3 Meat\n-2 Wood\n+1 Torch",fi:[0,0,10,5],x:4,y:6,li:5,d:!0,xi:!0},bi:{Os:"Stonemasons",As:"Recruit villagers to gather stone.",di:"-1 Meat\n-1 Torch\n+5 Stone",fi:[0,0,15,15],x:4,y:7,li:6,d:!0,r:!0},Li:{Os:"Cantors",As:"Soothe the old ones with song and sacrifice.",fi:[0,0,40,30],di:"-3 Wood\n-3 Meat\n-1 Torch\n-3 Stone\n+1 Sanity",x:4,y:8,li:7,xi:!0},Ni:{Os:"Sacrificial Lamb",As:"Sacrifice villagers to temporarily increase sanity. Long cooldown.",fi:[0,0,20,20,5,10],pi:"-1 Villager\n+10 Sanity",x:3,y:4,li:8,xi:!0,G:!0},Ii:{Os:"Repeat Offender",As:"Shorten sacrifice cooldown.",fi:[0,0,30,5,5,30],pi:"-40% Cooldown",x:3,y:3,li:8},Ui:{Os:"Resolute",As:"The village is more resilient.",fi:[0,0,0,0,20],di:"Reduce all sanity drain by 20%",x:2,y:4,li:7,d:!0},Fi:{Os:"Resolute+",As:"The village is even more resilient.",fi:[0,0,0,0,40],di:"Reduce all sanity drain by 40%",x:2,y:5,li:7},Di:{Os:"The Ritual",As:"Unlock Freedom. Increases sanity drain.",fi:[0,0,5,5,20,5],pi:"-5 Wood\n-5 Meat\n-20 Torches\n-5 Stone",x:4,y:3,li:9},jt:{Os:"Screaming Trees",As:"Woodcutters bring back 40% more wood.",di:"+2 Wood",fi:[0,0,20,0,0,20],x:6,y:7,li:3},_t:{Os:"Organ Harvest",As:"Butchers bring back 40% more meat.",di:"+2 Meat",fi:[0,0,20,0,0,20],x:5,y:5,li:4},Xt:{Os:"Stone Cold",As:"Stonemasons bring back 40% more stone.",di:"+2 Stone",fi:[0,0,20,0,0,20],x:5,y:7,li:6,r:!0},zt:{Os:"Hallowed",As:"Tallower torch production is doubled.",di:"+1 Torch",fi:[0,0,30,30],x:3,y:6,li:5},qt:{Os:"Chorus",As:"Cantor sanity gain is doubled.",di:"+1 Sanity",fi:[0,0,30,30,30,30],x:3,y:8,li:7}},this.zi(this.Jt.Ai)}E(t=!0){if(this.ji=[1],this.Ji=[2,3],this.Jt.ki.Yt&&this.ji.push(2),this.Jt.mi.Yt&&(this.ji.push(3),this.Ji.push(4)),this.Jt.bi.Yt&&(this.ji.push(4),this.Ji.push(5)),this.Jt.Li.Yt&&this.ji.push(5),t&&(T.os.KeyV&&this.Xi(),T.os.KeyS&&this.qi(),T.os.KeyF&&this.Qi(),T.os.ArrowDown&&this.Zi(1),T.os.ArrowUp&&this.Zi(-1),T.os.ArrowRight&&this.ts(this.Yi),T.os.ArrowLeft&&this.ss(this.Yi),T.os.KeyC&&B.ci.push(new J(this.Jt))),this.gt++,this.hs||(this.hs=this.gt+12),this.gt>=this.hs){if(this.Ki>0){let t=.2+.15*this.Ti;this.Jt.Fi?t*=.6:this.Jt.Ui&&(t*=.8),this.Gi[0]-=t}this.Gi[1]+=.2,this.hs=this.gt+12}this.es||(this.es=this.gt+3);for(let t=2;t<this.Vi.length;t++)this.Vi[t]>this.Gi[t]?this.Vi[t]--:this.Vi[t]<this.Gi[t]&&this.Vi[t]++;1===this.gt&&h.e(h.F),36===this.gt&&(this.rs(new Z(6,6)),h.e(h.U)),this.gt>=36&&this.gt<=38&&(this.$i[0].At(),this.$i[1].At()),38===this.gt&&(this.$i=[],this.Gi[3]+=10),60===this.gt&&(this.Us[0].visible=!0),this.Jt.Ni.Yt&&(this.Us[1].visible=!0),this.Jt.Di.Yt&&(this.Us[2].visible=!0),this.Gi[1]>=this.ns()&&!this.Us[0].active&&(this.Us[0].active=!0,this.Us[3].visible=!0,h.e(h.N)),this.gt>=this.es&&this.Jt.Ni.Yt&&!this.Us[1].active&&(this.Us[1].active=!0,h.e(h.N)),this.Us[2].active=this.ui([0,0,5,5,20,5]);for(const t of this.$i)t.E();if(this.gt>35){for(const t of this.Rs)t.E();this.Rs=this.Rs.filter(t=>!t.Ct)}this.Rs.length<33&&this.Rs.push(new A),7===this.Ti&&this.cs(!0),this.Gi[0]<=0&&this.cs(!1);for(let t=0;t<this.Wi.length;t++)this.Wi[t].E()||(this.Wi.splice(t,1),t--)}draw(){let t=0,i=0;this.Wi.forEach(s=>{t+=s.x,i+=s.y}),c.O.translate(t,i);let s=this.gt>36?0:285-285*this.gt/36;c.O.fillStyle=n[3],c.O.fillRect(0,0,c.width,c.height),c.O.drawImage(g.nt[2].rt,0,Math.floor(0+.8*s*.8));for(let t of this.Rs)3===t.yt&&t.draw();for(let t of this.$i)3===t.yt&&t.draw();c.O.drawImage(g.nt[1].rt,0,Math.floor(0+.8*s));for(let t of this.Rs)2===t.yt&&t.draw();for(let t of this.$i)2===t.yt&&t.draw();this.Jt.Di.Yt&&this.ls(),c.O.drawImage(g.nt[0].rt,0,Math.floor(0+s));let h=this.Jt.Di.Yt?.1+.9*this.Ti/7:0;j(this,this.gt%(9-this.Ti)==0,h);for(let t of this.Rs)1!==t.yt&&t.yt||t.draw();for(let t of this.$i)1===t.yt&&t.draw(Math.floor(s));if(this.Jt.Di.Yt){let t=this.Ti+"/7",i=R.vi(t).w;R.ft(c.O,t,170-i/2,99,1,R.mt[4])}if(this.gt>40){if(B.us===this)for(const t of this.Us)t.draw();this.fs(),this.ds(),this.ps(),this.ws(),this.vs()}}ps(){let t=Math.floor(this.Gi[0]/100*70);c.O.fillStyle=n[0],c.O.fillRect(309,-1,7,72),c.O.fillStyle=n[2],c.O.fillRect(310,0,5,70),c.O.fillStyle=n[4],c.O.fillRect(310,70-t,5,t)}fs(){if(!this.Us[0].visible)return;if(this.Us[0].active)return;let t=Math.floor(73*Math.min(this.Gi[1]/this.ns(),1));c.O.drawImage(g.$[0].rt,0,0,t,1,16,11,t,1)}ds(){if(!this.es)return;if(!this.Us[1].visible)return;if(this.Us[1].active)return;let t=this.es,i=this.es-900,s=Math.floor(79*Math.min((this.gt-i)/(t-i),1));c.O.drawImage(g.$[0].rt,0,0,s,1,16,23,s,1)}ws(){let t=0;for(let i=0;i<this.ji.length;i++){this.Yi===this.ji[i]&&(t=i);const s=this.Yi===this.ji[i]?R.mt[3]:R.mt[2],h=String(this._i[this.ji[i]].length),e=R.vi(h).w;R.ft(c.O,D.Qt[this.ji[i]],12,124+10*i,1,s),R.ft(c.O,h,99-e,124+10*i,1,s)}const i=this._i[this.Yi].length>0?0:2,s=this._i[0].length>0?1:3;c.O.drawImage(g.j[0].rt,7,120+10*t),c.O.drawImage(g.X[i].rt,84,124+10*t),c.O.drawImage(g.X[s].rt,101,124+10*t)}vs(){const t=[0,0,0,2,3,1];for(let i=0;i<this.Ji.length;i++){let s=this.Ji[i],h=String(this.Vi[s]),r=R.vi(h,1).w;c.O.drawImage(g.Y[t[s]].rt,190,131+12*i-1),R.ft(c.O,e[s],200,131+12*i,1,R.mt[4]),R.ft(c.O,h,250-r,131+12*i,1,R.mt[4])}}ls(){let t=17+Math.floor(2*Math.sin(this.gt/12));c.O.strokeStyle=n[1],c.O.beginPath();for(let i=0;i<7;i++)for(let s=0;s<7;s++)s-i!==1&&i-s!==1&&s-i!==6&&i-s!==6&&(c.O.moveTo(129+o[i].G+.5,t+o[i].V+.5),c.O.lineTo(129+o[s].G+.5,t+o[s].V+.5));c.O.stroke();for(let i=0;i<7;i++){let s=(3*i+3)%7,h=i<this.Ti?Math.floor(this.gt/6+i)%3:3;g.ot(c.O,g._[h],129+o[s].G,t+o[s].V)}}rs(t){this.Wi.push(t)}Zi(t){let i=this.ji.indexOf(this.Yi);i=(i+t+this.ji.length)%this.ji.length,this.Yi=this.ji[i]}Xi(){const t=this.ns();if(this.Gi[1]>=t){this.Gi[1]-=t,this.Us[0].active=!1;const i=new D(this.Yi||1);this.$i.push(i),this._i[i.Zt].push(i),this.Ki++,this.Rs.push(new P),h.e(h.I)}else this.rs(new Z(4,4)),h.e(h.D)}ts(){if(this._i[0].length>0){const t=this._i[0].pop();t.Zt=this.Yi,this._i[this.Yi].push(t),h.e(h.click)}else this.rs(new Z(4,4)),h.e(h.D)}ss(){if(this._i[this.Yi].length>0){const t=this._i[this.Yi].pop();t.Zt=0,this._i[0].push(t),h.e(h.click)}else this.rs(new Z(4,4)),h.e(h.D)}qi(){let t=[...this._i[0],...this._i[this.Yi]];if(t.length>0&&this.gt>=this.es){t.sort((t,i)=>(i.ti?.gt||0)-(t.ti?.gt||0));let i=t[0];this._i[0]=this._i[0].filter(t=>t!=i),this._i[this.Yi]=this._i[this.Yi].filter(t=>t!=i),this.$i=this.$i.filter(t=>t!=i),this.Rs.push(new S(i)),this.Rs.push(new P),h.e(h.I),this.es=this.gt+60*(this.Jt.Ii.Yt?9:15),this.Us[1].active=!1}else this.rs(new Z(4,4)),h.e(h.D)}Qi(){this.bt([0,0,5,5,20,5])?(h.e(h.I),this.Ti++):(this.rs(new Z(4,4)),h.e(h.D))}ns(){return Math.floor(3*Math.pow(1.24,this.$i.length))}cs(t){const i={Ci:Math.floor(this.gt/60),Ti:this.Ti,Si:this.Bi[2],gi:this.Bi[3],Ei:this.Bi[4],yi:this.Bi[5]};B.ci.pop(),B.ci.push(new N(t,i))}ai(t,i){return Object.values(this.Jt).find(s=>s.x===t&&s.y===i)}zi(t){t.visible=!0,t.Yt=!0,t.r&&(this.ai(t.x+1,t.y).visible=!0),t.xi&&(this.ai(t.x-1,t.y).visible=!0),t.G&&(this.ai(t.x,t.y-1).visible=!0),t.d&&(this.ai(t.x,t.y+1).visible=!0),this.Ms=t}oi(t){return!(t.Yt||!this.bt(t.fi)||(this.zi(t),0))}bt(t){if(!this.ui(t))return!1;for(let i=0;i<t.length;i++)t[i]&&(this.Gi[i]-=t[i]);return!0}ui(t){for(let i=0;i<t.length;i++)if(t[i]&&this.Gi[i]<t[i])return!1;return!0}Rt(t){for(let i=0;i<t.length;i++)t[i]&&(this.Gi[i]=a(this.Gi[i]+t[i],0,0===i?100:1e4),this.Bi[i]+=t[i])}}class W{constructor(){this.gt=0,this.Ts=-1,this.Rs=[]}E(){if(this.gt++,this.Ts>=0&&this.Ts++,1===this.Ts&&h.k(),this.Ts>20){B.ci.pop();const t=new $;B.ci.push(t),t.Rs=this.Rs}T.os.Space&&(this.Ts=0),this.Rs.length<33&&this.Rs.push(new A);for(let t of this.Rs)t.E();this.Rs=this.Rs.filter(t=>!t.Ct)}draw(){c.O.fillStyle=n[0],c.O.fillRect(0,0,c.width,c.height),c.O.globalAlpha=Math.min(this.gt/20,1),c.O.fillStyle=n[3],c.O.fillRect(0,0,c.width,c.height),c.O.globalAlpha=1;for(let t of this.Rs)t.draw();if(this.gt>30){let t=Math.max(1-this.gt/54,0);j(this,this.gt%3==0,t)}if(this.gt>40){let t="ASHES OF ULTHAR",i=R.vi(t,2).w;R.ft(c.O,t,168-i/2,13-3*this.Ts,2,R.mt[4],R.mt[1])}if(this.gt>48&&this.Ts<0){let t="PRESS SPACE TO PLAY",i=R.vi(t,1).w;R.ft(c.O,t,168-i/2,150,1,R.mt[4],R.mt[1])}}}const B=new class{s(){g.et(()=>{c.s(),g.s(),R.s(),T.s(),h.s(),window.addEventListener("blur",()=>this.g()),window.addEventListener("focus",()=>this.b()),this.is(),this.start()})}is(){this.Ss=0,this.ci=[new W]}start(){this.ys=0,this.gs=[0],this.E(),window.requestAnimationFrame(t=>this.Es(t))}Es(t){let i=t-this.Ss-1e3/42;i>=0&&(this.ys++,this.Ss=t-i,t-this.Ss>5e3/42&&(this.Ss=t),c.Q(),this.E(),this.draw(c.O)),window.requestAnimationFrame(t=>this.Es(t))}E(){this.xs||(T.E(),this.us=this.ci[this.ci.length-1],this.us.E(),h.E())}draw(){c.O.setTransform(1,0,0,1,0,0),c.O.scale(c.scale,c.scale);for(let t=0;t<this.ci.length;t++)this.ci[t].draw()}g(){this.xs||(this.xs=!0,h.g())}b(){this.xs&&(this.xs=!1,h.b())}};B.s()}()</script>