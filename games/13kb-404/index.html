<!doctype html><title>13kb-404 - js13kGames 2020</title><meta name=viewport content="width=device-width"><style>body{background-color:#fff;margin:0}canvas{display:block}#VRButton{color:#00f!important;background-color:#fff!important;bottom:40px!important;border-radius:0!important;opacity:1!important}</style><body><script type=module>import{CylinderBufferGeometry as H,BufferAttribute as k,Mesh as l,IcosahedronBufferGeometry as e,MeshNormalMaterial as n,Group as c,MeshBasicMaterial as u,BackSide as p,MultiplyBlending as w,Float32BufferAttribute as Q,BufferGeometry as f,CircleBufferGeometry as T,InstancedMesh as B,Raycaster as o,Object3D as j,Scene as F,Color as U,PerspectiveCamera as V,AdditiveBlending as K,AudioListener as N,AudioLoader as Y,Audio as i,WebGLRenderer as J,Vector3 as t,Line as X,LineBasicMaterial as $}from"/2020/webxr/three.js";function _(){function G(e){return Math.sin(6.283184*e)}function O(e){return.003959503758*Math.pow(2,(e-128)/12)}var Z,H,k,Q,T,B=[G,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){return(e=e%1*4)<2?e-1:3-e}];this.init=function(e){H=(Z=e).endPattern,k=0,Q=e.rowLen*e.patternLen*(H+1)*2,T=new Int32Array(Q)},this.generate=function(){for(var e,n,t,o,a,r,i,s=new Int32Array(Q),d=Z.songData[k],S=Z.rowLen,l=Z.patternLen,c=0,u=0,p=!1,w=[],f=0;f<=H;++f)for(t=d.p[f],e=0;e<l;++e){for(var y=t?d.c[t-1].f[e]:0,h=(y&&(d.i[y-1]=d.c[t-1].f[e+l]||0,y<16)&&(w=[]),B[d.i[15]]),g=d.i[16]/512,m=Math.pow(2,d.i[17]-9)/S,A=d.i[18],v=d.i[19],M=43.23529*d.i[20]*3.141592/44100,b=1-d.i[21]/255,x=1e-5*d.i[22],I=d.i[23]/32,R=d.i[24]/512,E=6.283184*Math.pow(2,d.i[25]-9)/S,L=d.i[26]/255,W=d.i[27]*S&-2,D=(f*l+e)*S,P=0;P<4;++P)if(n=t?d.c[t-1].n[e+P*l]:0){w[n]||(w[n]=function(e,n){for(var t,o,a,r,i,s=B[e.i[0]],d=e.i[1],l=e.i[3],c=B[e.i[4]],u=e.i[5],p=e.i[8],w=e.i[9],f=e.i[10]*e.i[10]*4,y=e.i[11]*e.i[11]*4,h=e.i[12]*e.i[12]*4,g=1/h,m=e.i[13],A=S*Math.pow(2,2-e.i[14]),v=new Int32Array(f+y+h),M=0,b=0,x=0,I=0;x<f+y+h;x++,I++)0<=I&&(I-=A,r=O(n+(15&(m=m>>8|(255&m)<<4))+e.i[2]-128),i=O(n+(15&m)+e.i[6]-128)*(1+8e-4*e.i[7])),t=1,x<f?t=x/f:f+y<=x&&(t-=(x-f-y)*g),o=r,l&&(o*=t*t),a=s(M+=o)*d,o=i,p&&(o*=t*t),a+=c(b+=o)*u,w&&(a+=(2*Math.random()-1)*w),v[x]=80*a*t|0;return v}(d,n));for(var q=w[n],z=0,C=2*D;z<q.length;z++,C+=2)s[C]+=q[z]}for(z=0;z<S;z++)(a=s[o=2*(D+z)])||p?(r=M,A&&(r*=h(m*o)*g+.5),u+=(r=1.5*Math.sin(r))*(r=b*(a-u)-(c+=r*u)),a=3==v?u:1==v?r:c,x&&(a=(a*=x)<1?-1<a?G(.25*a):-1:1,a/=x),p=1e-5<(a*=I)*a,i=a*(1-(r=Math.sin(E*o)*R+.5)),a*=r):i=0,W<=o&&(i+=s[o-W+1]*L,a+=s[o-W]*L),s[o]=0|i,s[1+o]=0|a,T[o]+=0|i,T[1+o]+=0|a}return++k/Z.numChannels},this.createWave=function(){var e=44+2*Q-8,n=e-36,t=new Uint8Array(44+2*Q);t.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255]);for(var o=0,a=44;o<Q;++o){var r=T[o];t[a++]=255&(r=r<-32767?-32767:32767<r?32767:r),t[a++]=r>>8&255}return t},this.getData=function(e,n){for(var t=2*Math.floor(44100*e),o=new Array(n),a=0;a<2*n;a+=1){var r=t+a;o[a]=0<e&&r<T.length?T[r]/32768:0}return o}}var e1={songData:[{i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1],c:[{n:[147,,,,,,147,,147,,,,,,147,,,,147,,,,,,147,,,147,,,,,135,,,,,,135,,135,,,,,,135,,,,135,,,,,,135,,,135,,,,,123,,,,,,123,,123,,,,,,123,,,,123,,,,,,123,,,123,,,,,111,,,,,,111,,111,,,,,,111,,,,111,,,,,,111,,,111],f:[]}]},{i:[3,0,128,1,3,68,128,0,1,25,4,4,40,0,0,1,55,4,0,2,67,115,124,188,67,6,39,1],p:[1,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139],f:[]}]},{i:[0,192,128,0,0,192,140,18,0,0,107,115,138,3,1,0,136,5,0,2,8,92,21,32,29,5,85,8],p:[1,2,3,2],c:[{n:[151],f:[]},{n:[152],f:[]},{n:[154],f:[]}]},{i:[3,163,128,0,3,154,128,9,0,0,15,5,31,0,0,0,0,0,0,2,255,193,0,32,47,3,146,2],p:[1,1,1,1],c:[{n:[111,111,111,111,123,123,123,123,111,111,111,111,123,123,123,123,111,111,111,111,123,123,123,123,111,111,111,111,123,123,123,123],f:[]}]},{i:[2,40,128,0,3,80,128,0,0,0,5,6,58,0,0,0,195,6,0,2,64,68,0,33,164,6,121,6],p:[1,1,1,1],c:[{n:[99,,,,,,,,111,,,,,,,,99,,,,,,,,111,,,,,,,,111,,,,,,,,123,,,,,,,,111,,,,,,,,123,,,,,,,,123,,,,,,,,135,,,,,,,,123,,,,,,,,135],f:[]}]},{i:[2,100,116,1,2,99,128,3,1,0,47,47,60,124,2,0,139,4,0,3,62,160,3,32,198,4,121,5],p:[],c:[]},{i:[1,91,128,0,1,95,128,12,0,0,12,0,25,0,0,0,255,8,1,3,24,157,0,32,83,3,130,4],p:[],c:[]},{i:[0,158,128,0,1,152,116,14,0,0,11,22,11,0,0,0,69,3,1,3,88,106,0,24,77,6,31,4],p:[1,2,3,2],c:[{n:[147,,151,147,,151,147,,151,147,,151,147,,151,147,,151,147,,151,147,,151,147,,151,147,,151,147],f:[]},{n:[151,,154,151,,154,151,,154,151,,154,151,,154,151,,154,151,,154,151,,154,151,,154,151,,154,151],f:[]},{n:[154,,151,154,,151,154,,151,154,,151,154,,151,154,,151,154,,151,154,,151,154,,151,154,,151,154],f:[]}]}],rowLen:5513,patternLen:32,endPattern:3,numChannels:8},n1={songData:[{i:[2,100,116,1,2,99,128,3,1,0,47,47,60,124,2,0,139,4,0,3,62,160,3,32,198,4,121,5],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},t1={songData:[{i:[1,91,128,0,1,95,128,12,0,0,12,0,25,0,0,0,255,8,1,3,24,157,0,32,83,3,130,4],p:[1,1,1,1],c:[{n:[152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,147,152,151,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139,135,140,139],f:[]}]}],rowLen:5513,patternLen:32,endPattern:3,numChannels:1},o1={songData:[{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[1],c:[{n:[151],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1};function a1(){const o=new _;return{generate:async function(e){return o.init(e),new Promise(function(n,e){const t=setInterval(function(){var e;1==1<=o.generate()&&(clearInterval(t),e=o.createWave(),e=new Blob([e],{type:"audio/wav"}),n(URL.createObjectURL(e)))},0)})}}}function s(n,t){var e=new H(.5,.5,.5,5).translate(0,.25,0),o=e.attributes.position.array,a=new Float32Array(o.length);for(let e=0;e<o.length;e+=3)a[e+0]=a[e+1]=a[e+2]=0<o[e+1]?n:t;return e.setAttribute("color",new k(a,3)),e}const r1=new Image,i1=(r1.src="data:image/gif;base64,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",[0,0,1,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1]),s1=[0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,0],d1=[0,0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0],l1=[0,0,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,1],c1=[0,0,0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0],u1=[1,0,0,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1],p1=new s(10,1),w1=new l(new e(.25),new n);function f1(t){const e=new c,o=new l(p1,new u({color:16720418,vertexColors:!0,side:p,blending:w,transparent:!0})),a=(o.scale.y=2,e.add(o),new l(p1,new u({color:2237183,vertexColors:!0,side:p,blending:w,transparent:!0}))),r=(a.scale.y=2,e.add(a),new c);e.add(r);var n=document.createElement("canvas"),i=(n.width=64,n.height=64,t%4),s=(t=Math.floor(t/4),(n=n.getContext("2d")).drawImage(r1,64*-i,64*-t),n.getImageData(0,0,64,64).data),d=[];for(let e=0,n=0;e<s.length;e+=4,n++){const l=n%64,c=Math.floor(n/64),u=y(s,e);if(0<u&&(h(d,i1,l,c),h(d,s1,l,c),0===y(s,e-4)&&h(d,c1,l,c),0===y(s,e+4)&&h(d,u1,l,c),0===y(s,e-256)&&h(d,d1,l,c),0===y(s,e+256)&&h(d,l1,l,c),16711680===u&&o.position.set(.5+l,.01,c+.5),255===u&&a.position.set(.5+l,.01,c+.5),65280===u)){const t=w1.clone();t.position.set(.5+l,1,c+.5),r.add(t)}}return i=new Q(d,3),(t=new f).setAttribute("position",i),t.computeVertexNormals(),n=new u,(i=new l(t,n)).scale.y=2.25,e.add(i),{group:e,update:function(){for(let e=0;e<r.children.length;e++){var n=r.children[e];n.rotation.x+=.01,n.rotation.y+=.01}o.rotation.y+=.02,a.rotation.y+=.02}}}function y(e,n){return e[n+0]<<16|e[n+1]<<8|e[n+2]}function h(n,t,o,a){for(let e=0;e<18;e+=3)n.push(t[e+0]+o,t[e+1],t[e+2]+a)}const a=new B(new T(.2,5).translate(0,0,.01),new u({color:16711680,depthWrite:!1}),1e3),y1=(a.count=0,a.renderOrder=1,new c),r=new function(){let n=0;return{mesh:a,add:function(e){a.setMatrixAt(n++,e),a.instanceMatrix.needsUpdate=!0,1e3<n&&(n=0),a.count<n&&(a.count=n)},reset:function(){a.count=0,n=0}}},d=(y1.add(r.mesh),new o),g=new j;function h1(){let n;return{setMap:function(e){n=e,r.reset()},group:y1,shoot:function(e){if(d.ray.origin.setFromMatrixPosition(e.matrixWorld),d.ray.direction.set(0,0,-1).applyQuaternion(e.quaternion).applyQuaternion(e.parent.quaternion),0<(e=d.intersectObject(n.group.children[3])).length){const n=e[0];g.position.set(0,0,0),g.lookAt(n.face.normal),g.rotation.z=Math.random()*Math.PI,g.position.copy(n.point),g.updateMatrix(),r.add(g.matrix)}}}}let m,A,v,M,b,x,I,S,R,E,L,W,D,P,q,z,C,G=1,O=!0;function Z(e){void 0!==R&&A.remove(R.group),!0===O&&(e=0),R=new f1(e),A.add(R.group);const n=R.group.children;if(E=n[0],L=n[1],W=n[2],!0===O){const e=R.group.children[3],n=(e.scale.y=.5,e.geometry.center(),e.clone());n.material=new u({color:187}),n.position.y=-2,R.group.add(n),E.visible=!1,L.position.set(0,-3,0),L.scale.setScalar(70)}M.position.copy(E.position),M.rotation.set(0,Math.PI,0),S.setMap(R)}function g1(){m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight)}function m1(e){O=!1,Z(G),P.play()}function A1(e){O=!0,Z(G),P.stop()}function v1(e){var n=e.target;n.userData.gamepad=e.data.gamepad,n.userData.handedness=e.data.handedness,"right"===e.data.handedness&&((e=new f).setFromPoints([new t(0,0,0),new t(0,0,-1)]),(e=new X(e,new $({color:255}))).scale.z=2,n.add(e))}!async function(){(A=new F).background=new U(16777215),M=new c,A.add(M),(m=new V(70,window.innerWidth/window.innerHeight,.1,100)).position.set(0,1.6,0),M.add(m);var a,r,e=new u({color:255,vertexColors:!0,side:p,depthTest:!1,blending:K,transparent:!0}),n=((e=new l(new s(0,1),e)).rotation.x=-Math.PI/2,e.scale.y=5,m.add(e),D=new N,m.add(D),e=new Y,new a1);function t(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}(P=new i(D)).setBuffer(await e.loadAsync(await n.generate(e1))),P.setLoop(!0),m.add(P),(q=new i(D)).setBuffer(await e.loadAsync(await n.generate(n1))),m.add(q),(z=new i(D)).setBuffer(await e.loadAsync(await n.generate(t1))),m.add(z),(C=new i(D)).setBuffer(await e.loadAsync(await n.generate(o1))),m.add(C),S=new h1,A.add(S.group),Z(G),(v=new J({antialias:!0})).setAnimationLoop(x1),v.setPixelRatio(window.devicePixelRatio),v.setSize(window.innerWidth,window.innerHeight),v.xr.enabled=!0,v.xr.addEventListener("sessionstart",m1),v.xr.addEventListener("sessionend",A1),document.body.appendChild(v.domElement),document.body.appendChild((a=v,"xr"in navigator?((r=document.createElement("button")).id="VRButton",r.style.display="none",t(r),navigator.xr.isSessionSupported("immersive-vr").then(function(e){function n(e){e.addEventListener("end",t),a.xr.setSession(e),r.textContent="EXIT VR",o=e}function t(){o.removeEventListener("end",t),r.textContent="ENTER VR",o=null}var o;e?(o=null,r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===o?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking"]}).then(n):o.end()}):(r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED")}),r):(e=document.createElement("a"),!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",t(e),e))),window.addEventListener("resize",g1,!1),(b=v.xr.getController(0)).addEventListener("connected",v1),M.add(b),(x=v.xr.getController(1)).addEventListener("connected",v1),M.add(x),I=new o}();let M1=0;function b1(e){var n=e.userData.gamepad;switch(e.userData.handedness){case"left":var t=Math.sign(-Math.round(n.axes[2])),o=(M1!==t&&(M.rotateY(t*(Math.PI/8)),M1=t),t=.03*n.axes[3],Math.sin(t));I.ray.origin.copy(M.position),I.ray.direction.set(0,0,o).applyQuaternion(M.quaternion),0<(o=I.intersectObject(R.group.children[3])).length&&o[0].distance>1+t&&M.translateZ(t);break;case"right":n.buttons[0].pressed?(S.shoot(e),!1===z.isPlaying&&z.play()):!0===z.isPlaying&&z.stop()}}function x1(){if(!0===O){var e=performance.now()/5e3;R.group.rotation.x=Math.sin(e)/4,R.group.rotation.y=Math.PI,R.group.rotation.z=Math.cos(1.1234*e)/4,m.position.y=50,m.position.z=2,m.rotation.x=-Math.PI/2}else{b1(b),b1(x),M.position.distanceTo(L.position)<1&&(q.play(),Z(++G%16));for(let e=0;e<W.children.length;e++){var n=W.children[e];!0===n.visible&&M.position.distanceTo(n.position)<1.5&&(C.play(),n.visible=!1)}R.update()}v.render(A,m)}</script>