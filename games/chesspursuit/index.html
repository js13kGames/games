<!doctype html><title>Chesspursuit - js13kGames 2015</title><style>body{background-color:#000;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}body,canvas,html{margin:0;padding:0}canvas,svg{display:block;position:absolute;top:0;left:0}svg{overflow:hidden}#root{cursor:pointer}.help{box-sizing:border-box;font-size:14px;padding:8px;color:#999;font-family:sans-serif;text-align:center;position:absolute;left:0;bottom:0;width:100%}</style><div class=help>Use arrow keys or mouse to move around.<br>You can use the 'return' key to pause the game (but that's cheating !).<br>You don't need to really know the <a href=https://en.wikipedia.org/wiki/Chess#Movement>chess rules</a> to play, but that could definitely help!</div><script>function e(){this.B=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01),(e=this.b+this.c+this.e)<.18&&(this.b*=e=.18/e,this.c*=e,this.e*=e)}}var t,i=new function(){var K,U,O,G,H,W,V,_,J,Z,$,ee;this.A=new e,this.reset=function(){var e=this.A;G=100/(e.f*e.f+.001),H=100/(e.g*e.g+.001),W=1-e.h*e.h*e.h*.01,V=-e.i*e.i*e.i*1e-6,e.a||($=.5-e.n/2,ee=5e-5*-e.o),_=1+e.l*e.l*(0<e.l?-.9:10),J=0,Z=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.D=function(){this.reset();var e=this.A;return 3*(((K=e.b*e.b*1e5)+(U=e.c*e.c*1e5)+(O=e.e*e.e*1e5+12))/3|0)},this.C=function(e,t){for(var i,r,l,n,o=1!=(k=this.A).s||k.v,a=k.v*k.v*.1,p=1+3e-4*k.w,s=k.s*k.s*k.s*.1,c=1+1e-4*k.t,f=1!=k.s,h=k.x*k.x,d=k.g,u=k.q||k.r,y=k.r*k.r*k.r*.2,z=k.q*k.q*(k.q<0?-1020:1020),L=k.p?32+((1-k.p)*(1-k.p)*2e4|0):0,B=k.d,m=k.j/2,D=k.k*k.k*.01,v=k.a,w=K,Y=1/K,j=1/U,q=1/O,k=1-(.8<(k=5/(1+k.u*k.u*20)*(.01+s))?.8:k),g=!1,b=0,x=0,C=0,S=0,E=0,N=0,A=0,T=0,M=0,I=0,P=Array(1024),R=Array(32),Q=P.length;Q--;)P[Q]=0;for(Q=R.length;Q--;)R[Q]=2*Math.random()-1;for(Q=0;Q<t;Q++){if(g)return Q;if(L&&++M>=L&&(M=0,this.reset()),Z&&++J>=Z&&(Z=0,G*=_),(G*=W+=V)>H&&(G=H,0<d)&&(g=!0),r=G,0<m&&(I+=D,r*=1+Math.sin(I)*m),(r|=0)<8&&(r=8),v||(($+=ee)<0?$=0:.5<$&&($=.5)),++x>w)switch(x=0,++b){case 1:w=U;break;case 2:w=O}switch(b){case 0:C=x*Y;break;case 1:C=1+2*(1-x*j)*B;break;case 2:C=1-x*q;break;case 3:g=!(C=0)}u&&((l=0|(z+=y))<0?l=-l:1023<l&&(l=1023)),o&&p&&((a*=p)<1e-5?a=1e-5:.1<a&&(a=.1));for(var X=0,F=8;F--;){if(++A>=r&&(A%=r,3==v))for(i=R.length;i--;)R[i]=2*Math.random()-1;switch(v){case 0:n=A/r<$?.5:-.5;break;case 1:n=1-A/r*2;break;case 2:n=.225*(((n=1.27323954*(n=6.28318531*(.5<(n=A/r)?n-1:n))+.405284735*n*n*(n<0?1:-1))<0?-1:1)*n*n-n)+n;break;case 3:n=R[Math.abs(32*A/r|0)]}o&&(i=N,(s*=c)<0?s=0:.1<s&&(s=.1),E=f?(E+(n-N)*s)*k:(N=n,0),n=S=(S+((N+=E)-i))*(1-a)),u&&(P[T%1024]=n,n+=P[(T-l+1024)%1024],T++),X+=n}e[Q]=1<=(X=.125*X*C*h)?32767:X<=-1?-32768:32767*X|0}return t}};window.jsfxr=function(e){i.A.B(e);var t=i.D();e=new Uint8Array(4*((t+1)/2|0)+44),t=2*i.C(new Uint16Array(e.buffer,44),t),(r=new Uint32Array(e.buffer,0,44))[0]=1179011410,r[1]=36+t,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=t,t+=44;for(var r=0,l="data:audio/wav;base64,";r<t;r+=3){var n=e[r]<<16|e[r+1]<<8|e[r+2];l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&n]}return l},function(){function e(){this.sounds={}}e.prototype.add=function(l,n,e){this.sounds[l]=[],e.forEach(function(e,t){this.sounds[l].push({tick:0,count:n,pool:[]});for(var i=0;i<n;i++){var r=new Audio;r.src=jsfxr(e),this.sounds[l][t].pool.push(r)}},this)},e.prototype.play=function(e){(e=1<(e=this.sounds[e]).length?e[Math.floor(Math.random()*e.length)]:e[0]).pool[e.tick].play(),e.tick<e.count-1?e.tick++:e.tick=0},(t=new e).add("check",1,[[2,,.1747,,.1291,.6731,.2,-.2999,,,,,,.4368,.1862,,.28,,1,,,.1596,,.5]]),t.add("move",5,[[3,,.0316,,.1483,.5871,,-.6609,,,,,,,,,,,1,,,.0227,,.25]]),t.add("capture",5,[[0,,.3065,,.2516,.36,,.1584,,,,,,.1149,,,,,1,,,.2188,,.25]]),t.add("checkmate",1,[[1,,.2402,,.3917,.2242,,.1535,,,,,,,,.5609,,,1,,,,,.5]])}(),window.onload=function(){function L(f){function e(){var e=N.ceil(2.5);me.push(h+e);for(var t=0;t<5;t++){if(Q[h]=[],t==e)for(var i=0;i<M;i++)Q[h][i]={checkPoint:!0};h++}}function t(){for(var e,t,i,r=Array.prototype.slice.call(arguments),l="object"==typeof r[0]?r.shift():{},n=f<me.length,o=h,a=r.length-1;0<=a;a--){if((t=r[a]).length>M)throw new Error;if(Q[h]=[],n&&""!==t)for(i=0;i<t.length;i++){var p,s=t.charAt(i);" "!==s&&"."!==s&&(p=m(s=s.toLowerCase(),h,i),l.showThreat==s&&(e=Q[h][i]),l.intro)&&(p.piece.intro=!0)}h++}if(e)for(e.piece.showThreat=!0,a=o;a<h;a++)for(t=Q[a],i=0;i<M;i++){var c=v(a,i);c&&c.piece==e.piece&&(Q[a][i]||(Q[a][i]={}),Q[a][i].showThreat=!0)}}if(Q)for(var i in Q)if(Q[i])for(var r in Q[i])(r=Q[i][r])&&r.piece&&J(r.piece);Q=[],me=[0];var h=0;t({intro:!0},"","","",xe?"  reqr":"",xe?"   kk":"","","","","","","","kkkkkkkk"),t({showThreat:"p"},"","","    p","","","","",""),t("  pppp","  pppp","","  p","","     p",""," p"),t("","pppppp","","  pppppp","","pppppp","",""),t("","pp   ppp","  p p","   p","","","",""),t("","   pp","p p  p p"," p    p","","","",""),t("","    ppp","     p","ppp"," p   ppp","      p","",""),e(),t({showThreat:"r"},"","   p","","   r","","   p","",""),t("","","r"," r","  r","   r","    r","     r","pppppp"),t("","","","       p","    rp r","","","pp","r   p  p","p"),t("","p     r","r     p","r    p","","   p","   p","p  ppppp",""),e(),t({showThreat:"b"},"","","","","...b","","","",""),t(""," p p p","b b b b","","","","","",""),t("","r.p..p.r","p......p","","b      b","pp....pp","",""),t("","r"," r  p..b","     ..r","....p","...p","..p","pp.....p"),e(),t({showThreat:"k"},"","","   k","","","","",""),t("p","r.....p","","","......kk","","pkk",""),t("p   pppp","r    b r","   p b p","","",""," k","","",""),e(),t({showThreat:"l"},"","","","   l","","","",""),t("l.llllll","l.l....l","..l.llll",".ll.l   ","l...l l ","l.lll l ","l.    l ","lllllll "),t(" p  pll"," l p   l","lpl p p ","     lp","ll ll l"," l  l","",""),t("","  r","  llk","     .","   l ..","   p  pb","  . .  l","  p  l","","","","",""),e(),t("","c","","","","",""),te=h,0===f?(z=m(Se,5,4).piece,R=2):(R=me[f],z=m(Se,R,3).piece,R-=4)}function m(e,t,i){var r={shape:null,type:e,row:t,col:i,showThreat:!1};if(Q[t]||(Q[t]=[]),Q[t][i]||(Q[t][i]={}),Q[t][i].piece=r,e==Me)for(var l=0;l<M;l++)3!=l&&4!=l&&(Q[t][l]||(Q[t][l]={}),Q[t][l].wall=!0);return Q[t][i]}function q(e,i){var r=z.col,l=z.row,n=(i<0?i=0:M<=i&&(i=M-1),N.floor(R)),o=X-2;if(e<n?e=n:o<=e&&(e=o),(i!=r||e!=l)&&(n=Q[l][r],Q[e]||(Q[e]=[]),(o=Q[e][i])||(Q[e][i]=o={}),!o.wall)){var a=v(e,i);if(a)t.play("check"),z.invalid=!0,z.invalidCol=i,z.invalidRow=e,z.threateningPiece=a.piece,i=r,e=l;else{if(z.invalid=!1,o.piece){var p=o.piece;if(we.push(p),p.removedTime=P,p.justRemoved=!0,p.showThreat)for(var s=p.row-M;s<p.row+M;s++){var c=Q[s];if(c)for(var f=p.col-M;f<p.col+M;f++)c[f]&&(c[f].showThreat=!1)}t.play("capture")}else t.play("move");n.piece=null,o.piece=z}z.oldCol=r,z.oldRow=l,z.anim=!0,z.animStartTime=P,z.col=i,z.row=e,te<=e&&K(!0,!0)}}function v(e,t){var i,r,l,n;if(i=o(e,t,Te))return i;if(i=o(e+1,t-1,Ee)||o(e+1,t+1,Ee))return i;for(l=t-1;0<=l;l--)if((n=o(e,l))&&n.piece){if(n.piece.type==Ne)return n;break}for(l=t+1;l<=M;l++)if((n=o(e,l))&&n.piece){if(n.piece.type==Ne)return n;break}for(r=e+1;r<=e+M;r++)if((n=o(r,t))&&n.piece){if(n.piece.type==Ne)return n;break}for(r=e-1;e-M<=r;r--)if((n=o(r,t))&&n.piece){if(n.piece.type==Ne)return n;break}for(l=t-1,r=e-1;0<=l;l--,r--)if((n=o(r,l))&&n.piece){if(n.piece.type==Ae)return n;break}for(l=t+1,r=e-1;l<M;l++,r--)if((n=o(r,l))&&n.piece){if(n.piece.type==Ae)return n;break}for(l=t-1,r=e+1;0<=l;l--,r++)if((n=o(r,l))&&n.piece){if(n.piece.type==Ae)return n;break}for(l=t+1,r=e+1;l<M;l++,r++)if((n=o(r,l))&&n.piece){if(n.piece.type==Ae)return n;break}return o(e+2,t-1,c)||o(e-2,t-1,c)||o(e+2,t+1,c)||o(e-2,t+1,c)||o(e+1,t-2,c)||o(e-1,t-2,c)||o(e+1,t+2,c)||o(e-1,t+2,c)}function o(e,t,i){if((e=(e=Q[e])&&e[t])&&e.piece&&(!i||e.piece.type==i))return e}function F(){if(window.stb&&stb(),ue)0!==j.space&&!Y.click||(K(!1),j.space=-1);else{(xe?(0<=D&&(0===j.space||Y.click)&&(j.space=-1,O()),function(){var e,t,i,r,l=Q[8][3].piece,n=z,o=(P=Date.now(),!ie);if(o){if(ie=P,E)for(var a=0;a<E.length;a++){var p=E[a];if(p.e)for(var s in p.to)p.e[s]=p.to[s]}E=[],l&&(l.talking=!1,l.talkingStarTime=P),n.talking=!1,n.talkingStarTime=P}if(-1==D)pe.style.opacity=0,ce.style.opacity=0,B=0,U(),x=null,D=0;else if(0!==D)if(1==D)o&&(Z(!0,["Surrender Black King !","Your army is defeated, and your Queen is mine !"]),l.talking=!0);else if(2==D){if(o)for($(),t=0;t<M;t++)k((i=Q[0][t]).piece,{row:2,col:t+(t%2==0?1:-1)},.1*t,.5)}else if(3==D)o&&(Z(!0,["You thought I'd only bring two knights to battle ?","You are surrounded,","admit defeat now and I shall be merciful."]),l.talking=!0);else if(4==D)o&&(Z(!1,["Never !"]),n.talking=!0);else if(5==D)o&&(Z(!0,["As you wish...","I am taking the prisoner back to the castle.","Knights, capture him, I want him alive."]),l.talking=!0);else if(6==D){if(o){for($(),t=2;t<=5;t++)(i=Q[8][t])&&(k(i.piece,{row:9},0,.5),k(i.piece,{row:10},1,.5));k(Q[7][3].piece,{row:8,col:1},.5,.5),k(Q[7][3].piece,{row:10,col:2},1.5,.5),k(Q[7][4].piece,{row:8,col:6},.5,.5),k(Q[7][4].piece,{row:10,col:5},1.5,.5)}}else if(7==D){if(o)for(Z(!1,['It looks like our roles are <tspan fill="red" font-family="impact">REVERSED<animate attributeType="CSS" attributeName="fill" from="red" to="orange" dur="0.5s" repeatCount="indefinite"/></tspan> my Queen.',"Today, it is my turn to protect you !"]),n.talking=!0,e=1;e<2*M;e++)if(r=Q[e])for(t=0;t<M;t++)(i=r[t])&&i.piece&&i.piece.intro&&(J(i.piece),r[t]={})}else 8==D&&(o&&($(),ke.style.display="none"),1<(Ce=(P-ie)/4e3)?D=9:(Ce=N.sin(Ce*ne/2),(B=(Ce-.2)/.6)<0?B=0:1<B&&(B=1),pe.style.opacity=B,.8<Ce&&(be.style.opacity=(1-Ce)/.2,ce.style.opacity=1-be.style.opacity)));o&&(E.length?(ke.style.opacity=0,l=E[0].e==C&&E[0].to._y==Oe,o=(n=E[E.length-1]).du+n.de,l?k(ke.style,{opacity:1},o+2,.1):1<D&&D<8&&E.push({cb:O,de:0,du:o})):ke.style.opacity=1);for(var c,f=(P-ie)*fe,h=0;h<E.length;h++){var d=E[h];if(!(f<=d.de))if(d.de+d.du<=f)d.cb&&(d.cb(),d.cb=null);else if(d.e){if(!d.from)for(c in d.from={},d.to)d.from[c]=d.e[c];var u=N.sin((f-d.de)/d.du*ne/2);for(c in d.to)d.e[c]=d.from[c]*(1-u)+d.to[c]*u}}C.setAttributeNS(null,"y",C._y),9==D&&(xe=!1,B=1,be.style.display="none",pe.style.opacity=1,ce.style.opacity=1,ke.style.display="none",$(),z.talking=!1),x=P}):(function(){if(!(X<=0||z.invalid||xe)){var e,t=0,i=0;if(!Ie&&(6!=j.down&&0!==j.down||(i=-1),6!=j.up&&0!==j.up||(i=1),6!=j.left&&0!==j.left||(t=-1),(t=6!=j.right&&0!==j.right?t:1)||i)&&(t?(j.up<=6&&0<j.up&&(i=1),j.down<=6&&0<j.down&&(i=-1)):(j.left<=6&&0<j.left&&(t=-1),j.right<=6&&0<j.right&&(t=1)),q(z.row+i,z.col+t),Ie=!0),Ie){var r=!0;for(e in Je)if(Je[e]){r=!1;break}Ie=!r}for(e in j)1<=j[e]?j[e]++:-1<j[e]&&j[e]--;!z.anim&&0<Y.x&&Y.x<T&&A<Y.y&&Y.y<500?(H(Y.x/T,(Y.y-A)/T),Re=N.floor(H.res.x*M),Pe=N.floor(H.res.y*M+R),1<(t=Re-z.col)?t=1:t<-1&&(t=-1),1<(i=Pe-z.row)?i=1:i<-1&&(i=-1),Pe=z.row+i,Re=z.col+t,Y.click&&(t||i)&&q(Pe,Re)):Pe=Re=-1}}(),U))();for(var e,t,i,r,l,n,o=X-ae-5;o<=X;o++)if(t=Q[o])for(var a=0;a<M;a++)t[a]&&t[a].piece&&(g((i=t[a].piece).row,i.col,i),i.talking&&(r=-N.abs(N.sin((P-i.talkingStarTime)*ne/800))*oe*.2,i.y+=r),G(i),i.y>z.y)&&(!e||e.y>i.y)&&(e=i);for(z.anim&&((l=z.invalid?fe*(P-z.animStartTime)/.5:fe*(P-z.animStartTime)/.05)<0||1<=l?(z.anim=!1,z.invalid&&z.threateningPiece&&(z.threateningPiece.shape.style.filter="none"),z.invalid=!1):(l=N.sin(l*ne*.5),z.invalid?(g(z.row,z.col),n=.4*(l<.5?l:1-l)*oe,n=N.sin(6*l*ne)*n,z.x+=n,G(z),z.threateningPiece.shape.style.filter="url(#ef)"):(g(z.oldRow,z.oldCol),z.opacity=l*z.opacity+(1-l)*g.res.opacity,z.scale=l*z.scale+(1-l)*g.res.scale,z.x=l*z.x+(1-l)*g.res.x,z.y=l*z.y+(1-l)*g.res.y,G(z)))),w=0,f=we.length;w<f;w++){var p=we[w],s=(P-p.removedTime)/1e3;1<s?(J(p),we[w]=we[f-1],f--,w--,we=we.slice(0,f)):(p.justRemoved&&(p.justRemoved=!1,p.removedX=p.x,p.removedY=p.y),p.x=p.x<200?p.removedX-s*T:p.removedX+s*T,p.y=p.removedY-N.sin(s*ne)*T*.4,G(p))}z.anim&&z.invalid?((S=S||{onTop:!0,type:"ct"}).shape||(_(S),S.row=z.invalidRow,S.col=z.invalidCol),g(z.invalidRow,z.invalidCol,S),S.scale=1,S.y-=l*S.scale*oe*.2,S.opacity=l<.8?1:1-(l-.8)/(1-.8),G(S)):S&&S.shape&&J(S),e&&e.shape&&z.shape&&z.shape.nextSibling!=e.shape&&He.insertBefore(z.shape,e.shape),I.save(),I.translate(0,A),I.fillStyle=Qe,I.beginPath(),I.rect(0,0,T,T),I.fill(),I.clip();for(var c,f,h,d=N.floor(R),u=-(R-N.floor(R)),y={},L={},m={},v={},w=-1;w<ae;w++)for(c=0;c<M;c++)b(c/M,(w+u)/M,y),b(c/M,(w+1+u)/M,v),b((c+1)/M,(w+1+u)/M,m),b((c+1)/M,(w+u)/M,L),I.beginPath(),I.moveTo(y.x*T,y.y*T),I.lineTo(L.x*T,L.y*T),I.lineTo(m.x*T,m.y*T),I.lineTo(v.x*T,v.y*T),I.closePath(),I.lineWidth=1,I.fillStyle=-1!=Pe&&-1!=Re&&w+d==Pe&&c==Re?"#794":(w+c+d)%2==0?"#D1DBBD":"#3E606F",I.fill(),(t=Q[w+d])&&t[c]&&((h=t[c]).showThreat&&(I.fillStyle="rgba("+Be+",0.5)",I.fill()),h.checkPoint)&&(I.fillStyle="rgba(93, 255, 182, 0.56)",I.fill()),z.invalid&&z.invalidCol==c&&z.invalidRow==w+d&&(I.fillStyle="rgba("+Be+","+1.5*(l<.5?l:1-l)+")",I.fill());I.restore()}Y.click=!1,window.ste&&ste(),ve&&requestAnimationFrame(F)}function K(e,t){if(t)ue=!(ve=!1),he.style.display="block";else if(e!=ue)if(ue=e)de.style.display="block";else{de.style.display="none";for(var i=me.length-1,r=0;r<me.length;r++)if(R<me[r]){0<r&&(i=r-1);break}L(i),x=null,X=-1}}function U(){if(P=Date.now(),x&&(R+=Le*(P-x)*fe),z.row<R-.9){if(ye)if(v(z.row+1,z.col)){if(v(z.row+1,z.col+1)&&v(z.row+1,z.col-1))return K(!0);q(z.row+1,z.col+1)}else q(z.row+1,z.col);else K(!0);t.play("checkmate")}var e=N.floor(R)+ae;if(!x||X<e){for(var i,r,l=e-ae-5;X-ae-5<l;l--)if(i=Q[l])for(r=0;r<M;r++)i[r]&&i[r].piece&&J(i[r].piece);for(l=X+1;l<=e;l++)if(i=Q[l])for(r=0;r<M;r++){var n=M/2;r%2==0?n+=r/2:n-=(r+1)/2,i[n]&&i[n].piece&&_(i[n].piece)}X=e}x=P}function O(){D++,ie=null}function k(e,t,i,r){E.push({e:e,to:t,de:i||0,du:r})}function g(e,t,i){return i=i||g.res,b((t+.5)/M,(e-R+.5)/M),t=1,b.res.y<-.02?t=0:b.res.y<.02&&(t=1-(.02-b.res.y)/.04),i.opacity=t,i.x=b.res.x*T,i.y=b.res.y*T+A,i.scale=b.res.scaleX,i}function G(e){e.shape&&(e.shape.style.opacity=e.opacity,0<e.scale)&&e.shape.setAttributeNS(null,"transform","scale("+e.scale+") translate("+e.x/e.scale+","+e.y/e.scale+")")}function b(e,t,i){return(i=i||b.res).y=w(t,De,Ye,je),i.scaleX=w(t,qe,Fe,Ke),i.scaleY=i.scaleX,i.x=(1-i.scaleX)/2+e*i.scaleX,xe&&(i.x=B*i.x+(1-B)*e,i.y=B*i.y+(1-B)*(1-t),i.scaleX=B*i.scaleX+(1-B),i.scaleY=i.scaleX),i}function H(e,t,i){(i=i||H.res).y=(r=De,(-Ye-N.sqrt(Ye*Ye-4*r*(je-t)))/(2*r));var r,t=w(i.y,qe,Fe,Ke);return i.x=(e-(1-t)/2)/t,i}function w(e,t,i,r){return t*e*e+i*e+r}function W(e,t,i){var r=s.createElement("canvas");return i&&(r.id=i),r.width=e,r.height=t,r}function V(e){return e.getContext("2d")}function _(e){var t;if(We[e.type]||(We[e.type]=[]),t=We[e.type].length?We[e.type].pop():Ue(e.type),He.firstChild&&!e.onTop?He.insertBefore(t,He.firstChild):He.appendChild(t),e.shape)throw new Error;(e.shape=t).style.filter="none"}function J(e){e.shape&&(We[e.type].push(e.shape),He.removeChild(e.shape),e.shape=null)}function Z(e,t){l(re,e?"White King :":"Black King :");for(var i="",r=0;r<t.length;r++)i+='<tspan x="10" '+(0===r?"":'dy="1.2em"')+">"+t[r]+"</tspan>";l(le,i),k(C,{_y:Oe},0,.5)}function $(){k(C,{_y:Ge},0,.5)}function l(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);Ve.innerHTML="<svg>"+e+"</svg>",Array.prototype.slice.call(Ve.childNodes[0].childNodes).forEach(function(e){t.appendChild(e)})}function a(e,t){if(t)for(var i in t)e.setAttributeNS(null,i,t[i])}function p(e,t,i,r){var l={};void 0!==t&&(l.fill=t),void 0!==i&&(l.stroke=i),void 0!==r&&(l.strokeWidth=r),a(e,l)}function ee(e,t){var i=(t=t||window.e).keyCode;(t=_e[t.charCode&&!i?t.charCode:i])&&Je[t]!==e&&(Je[t]=e,void 0===j[t]&&(j[t]=-1),e?j[t]<1&&(j[t]=1):0<j[t]&&(j[t]=0))}var x,te,ie,C,re,le,S,E,e=window,s=e.document,i=s.body,r=null,N=e.Math,ne=N.PI,A=100,T=400,M=8,oe=T/M,ae=2*M+3,I=V(e=W(T,T,"bg")),pe=W(T,T,"shadow"),se=V(pe),ce=W(T,800,"sky"),n=V(ce),P=0,fe=.001,he=null,de=null,ue=!1,ye=!1,R=0,Le=1,Q=null,me=null,X=-1,ve=!0,we=[],z=null,ke=null,ge=null,be=null,xe=!0,B=0,Ce=0,D=-1,Se="h",Ee="p",Ne="r",Ae="b",c="k",Te="l",Me="c",Ie=!1,Y={},Pe=-1,Re=-1,Qe="#193441",Xe="#eee",ze="#555",Be="255,0,0",De=(g.res={},3/16),Ye=-.875,je=1,qe=-.15625,Fe=0,Ke=1;b.res={},H.res={};var Ue,Oe,Ge,He=null,We={},Ve=s.createElement("div"),_e={37:"left",65:"left",81:"left",38:"up",90:"up",87:"up",83:"down",40:"down",39:"right",68:"right",32:"space",27:"esc",13:"enter"},Je={},j={};s.onkeyup=function(e){xe||!Je.enter||ue||(ve=!ve,ge.style.display=ve?"none":"block",ve&&(x=Date.now(),F())),ee(!1,e)},s.onkeydown=function(e){ee(!0,e)},s.onmousedown=function(e){Y.click=!0,s.onmousemove(e)},s.onmousemove=function(e){Y.x=e.clientX-r.offsetLeft,Y.y=e.clientY},(r=s.createElement("div")).id="root",i.appendChild(r),(i=r.style).position="absolute",i.left="50%",i.top="0",i.marginLeft="-200px ",r.appendChild(e),e.width=T,e.height=500,ce.width=T,ce.height=108;var f,Ze,$e,et,tt,h=n;h.clearRect(0,0,T,T),h.save(),h.fillStyle="#FF8601",h.beginPath(),h.rect(0,0,T,A),h.fill(),h.clip(),h.fillStyle="#FFE7CA",h.beginPath(),h.arc(200,130,100,0,ne,!0),h.fill(),h.restore(),h.beginPath(),h.fillStyle="rgb(10,20,25)";for(var it=[0,.7,.1,.3,.2,1,.3,.5,.35,.8,.42,.5,.55,.9,.7,.45,.8,1.1,.88,.4,1,.8],rt=0;rt<it.length;rt+=2){var lt=it[rt]*T,nt=A-40*it[rt+1];0===rt?h.moveTo(lt,nt):h.lineTo(lt,nt)}function ot(e,t){return u(["M",[e,t],"L",[e+1,t],"L",[e+.5,t-3],"L",[e,t]])}function d(e,t,i){var r=s.createElementNS(f,"g");r.setAttributeNS(null,"id",e),i||r.appendChild((p((a(i=s.createElementNS(f,"ellipse"),{cx:y(5-et),cy:y(8-tt),rx:y(3.1),ry:y(1.8)}),e=i),"rgba(0,0,0,0.2)","none"),e));for(var l=0;l<t.length;l++){var n=t[l];n.getAttributeNS(null,"x")||(n.setAttributeNS(null,"x",-oe/2),n.setAttributeNS(null,"y",-oe)),r.appendChild(n)}return $e.appendChild(r),r}function at(e,t,i){var r=s.createElementNS(f,"circle");return a(r,{cx:y(e-et),cy:y(t-tt),r:y(i)}),r}function u(e,t){var i=s.createElementNS(f,"path");return i.setAttributeNS(null,"d",function(e){for(var t="",i=0;i<e.length;i++){var r=e[i];t+=("object"==typeof r?y(r[0]-et)+","+y(r[1]-tt):r)+" "}return t}(e)),t&&a(i,t),i}function y(e){return.1*N.round(oe*e)}h.lineTo(T,A),h.lineTo(0,A),h.fill(),h.restore(),h.save(),h.translate(0,A),(i=h.createLinearGradient(0,0,0,8)).addColorStop(0,(e="rgba(10,20,25,")+"1)"),i.addColorStop(1,e+"0)"),h.fillStyle=i,h.fillRect(0,0,T,8),h.restore(),r.appendChild(ce),Ue=function(e,t){var i=s.createElementNS(f,"use");return a(i,t),i.setAttributeNS(Ze,"xlink:href","#"+e),i.setAttribute("xmlns:xlink",Ze),i},f="http://www.w3.org/2000/svg",Ze="http://www.w3.org/1999/xlink",(n=s.createElementNS(f,"svg")).setAttribute("xmlns",f),n.setAttributeNS(null,"viewBox","0 0 400 500"),n.setAttributeNS(null,"width",400),n.setAttributeNS(null,"height",500),r.appendChild(n),$e=s.createElementNS(f,"defs"),n.appendChild($e),He=s.createElementNS(f,"g"),n.appendChild(He),be=s.createElementNS(f,"g"),n.appendChild(be),a(e=s.createElementNS(f,"rect"),{x:0,y:0,width:"100%",height:A,fill:Qe,stroke:"#000"}),be.appendChild(e),a(e=s.createElementNS(f,"text"),{x:"50%",y:"60","font-size":"48px",fill:"orange",stroke:"red","stroke-width":"2px","text-anchor":"middle","font-family":"Impact"}),l(e,'CHESS<tspan style="font-style:italic;">PURSUIT</tspan>'),be.appendChild(e),(e=s.createElementNS(f,"filter")).setAttributeNS(null,"id","ef"),a(e,{x:"0",y:"0",width:"100%",height:"100%","color-interpolation-filters":"sRGB"}),l(e,'<feFlood flood-color="rgba(255,0,0,0.3)" result="COLOR"></feFlood><feComposite operator="atop" in="COLOR" in2="SourceGraphic"></feComposite>'),$e.appendChild(e),(e=s.createElementNS(f,"text")).setAttributeNS(null,"id","ct"),a(e,{x:"-40","font-size":"28",fill:"red",stroke:"black","stroke-width":"1","font-family":"Impact"}),l(e,"CHECK"),$e.appendChild(e),(de=s.createElementNS(f,"g")).style.display="none",n.appendChild(de),a(e=s.createElementNS(f,"rect"),{x:0,y:0,width:"100%",height:"100%",fill:"rgba(0,0,0,0.5)"}),de.appendChild(e),a(e=s.createElementNS(f,"text"),{x:"50%",y:"50%","font-size":"48px",fill:"orange",stroke:"red","stroke-width":"2px","text-anchor":"middle","font-family":"Impact"}),l(e,"CHECKMATE !"),de.appendChild(e),a(e=s.createElementNS(f,"text"),{x:"50%",y:"60%","font-size":"22px",fill:"white",stroke:"black","stroke-width":"1px","text-anchor":"middle","font-family":"Impact"}),l(e,'<tspan x="50%">Press <tspan style="fill:orange;">SPACE</tspan> or <tspan style="fill:orange;">CLICK</tspan></tspan><tspan x="50%" dy="1.5em">to restart from the last checkpoint.</tspan>'),de.appendChild(e),Ge=500,Oe=386,(C=s.createElementNS(f,"svg"))._y=Ge,a(C,{x:6,y:Ge,width:388,height:108}),n.appendChild(C),a(e=s.createElementNS(f,"rect"),{width:"100%",height:"100%",fill:"rgba(0,0,0,0.8)",stroke:"#fff","stroke-width":2}),C.appendChild(e),a(re=s.createElementNS(f,"text"),{x:10,y:20,"font-size":"18px",fill:"#fff","text-anchor":"left","font-family":"Impact"}),C.appendChild(re),a(le=s.createElementNS(f,"text"),{x:10,y:40,"font-size":"16px",fill:"#fff","text-anchor":"left","font-family":"sans-serif"}),C.appendChild(le),a(ke=s.createElementNS(f,"text"),{x:"50%",y:490,"font-size":"22px",fill:"white",stroke:"black","stroke-width":"1px","text-anchor":"middle","font-family":"Impact"}),l(ke,'Press <tspan style="fill:orange;">SPACE</tspan> or <tspan style="fill:orange;">CLICK</tspan>'),n.appendChild(ke),a(ge=s.createElementNS(f,"text"),{x:"50%",y:"50%","font-size":"32px",fill:"orange",stroke:"black","stroke-width":"1px","text-anchor":"middle","font-family":"Impact"}),l(ge,"PAUSED"),ge.style.display="none",n.appendChild(ge),(he=s.createElementNS(f,"g")).style.display="none",n.appendChild(he),a(e=s.createElementNS(f,"rect"),{x:0,y:0,width:"100%",height:"100%",fill:"rgba(0,0,0,0.5)"}),he.appendChild(e),a(e=s.createElementNS(f,"text"),{x:"50%",y:"50%","font-size":"48px",fill:"#5f7",stroke:"black","stroke-width":"2px","text-anchor":"middle","font-family":"Impact"}),l(e,"YOU WIN !"),he.appendChild(e),a(e=s.createElementNS(f,"text"),{x:"50%",y:"60%","font-size":"22px",fill:"white",stroke:"black","stroke-width":"1px","text-anchor":"middle","font-family":"Impact"}),l(e,"Alas, your Queen is in another castle..."),he.appendChild(e),p(d(Ee,[u(["M",[2,tt=8],"Q",[et=5,10],[8,8],"L",[5,3],"L",[2,8]]),at(5,3,2)]),Xe,ze,0),p(d("e",[u(["M",[4.6,1.4],"L",[5.4,1.4],"L",[5.4,-.6],"L",[6.4,-.6],"L",[6.4,-1.4],"L",[5.4,-1.4],"L",[5.4,-2.4],"L",[4.6,-2.4],"L",[4.6,-1.4],"L",[3.6,-1.4],"L",[3.6,-.6],"L",[4.6,-.6],"L",[4.6,1.4]]),u(["M",[2,8],"Q",[5,10],[8,8],"L",[6,3],"L",[7,1],"Q",[5,0],[3,1],"L",[4,3],"L",[2,8]])]),Xe,ze,0),p(d(c,[u(["M",[2,8],"Q",[5,10],[8,8],"L",[7,6],"Q",[8,3],[7,0],"L",[6,1],"L",[5,1],"L",[2,4],"L",[3,5],"L",[5,4],"L",[2,8]])]),Xe,ze,0),p(d(Ne,[u(["M",[2,8],"Q",[5,10],[8,8],"L",[6.5,3],"L",[8,2],"L",[8,0],"L",[7,0],"L",[7,1],"L",[6,1],"L",[6,0],"L",[4,0],"L",[4,1],"L",[3,1],"L",[3,0],"L",[2,0],"L",[2,2],"L",[3.5,3],"L",[2,8]])]),Xe,ze,0),p(d(Ae,[u(["M",[2,8],"Q",[5,10],[8,8],"L",[6,4],"Q",[8,1.1],[5,0],"Q",[2,1.1],[4,4],"L",[2,8]]),at(5,0,.7),u(["M",[3.8,.8],"L",[4.4,2.5]],{"stroke-width":2})]),Xe,ze,0),p(d("w",[u(["M",[2,8],"Q",[5,10],[8,8],"L",[8.5,6],"L",[7,7],"L",[7,5],"L",[6,6],"L",[5,4.5],"L",[4,6],"L",[3,5],"L",[3,7],"L",[1.5,6],"L",[2,8]])]),Xe,ze,0),p(d(Te,[ot(2,9.5),ot(5,9),ot(8,10),ot(7,8),ot(4,7.5),ot(1,8.5)],!0),Xe,ze,0),p(d(Se,[u(["M",[4.6,1.4],"L",[5.4,1.4],"L",[5.4,-.6],"L",[6.4,-.6],"L",[6.4,-1.4],"L",[5.4,-1.4],"L",[5.4,-2.4],"L",[4.6,-2.4],"L",[4.6,-1.4],"L",[3.6,-1.4],"L",[3.6,-.6],"L",[4.6,-.6],"L",[4.6,1.4]]),u(["M",[2,8],"Q",[5,10],[8,8],"L",[6,3],"L",[7,1],"Q",[5,0],[3,1],"L",[4,3],"L",[2,8]])]),"#002","#333",0),p(d("q",[at(5,.4,.6),u(["M",[2,8],"Q",[5,10],[8,8],"L",[6,3],"L",[7.5,1],"L",[5.8,1.5],"L",[5,.8],"L",[4.2,1.5],"L",[2.5,1],"L",[4,3],"L",[2,8]])]),"#002","#333",0),et=2.5,p(d(Me,[u(["M",[25,30],"L",[tt=50,30],"L",[50,5],"L",[45,5],"L",[45,10],"L",[40,10],"L",[40,5],"L",[35,5],"L",[35,10],"L",[30,10],"L",[30,5],"L",[25,5],"L",[25,30]]),u(["M",[0,50],"L",[0,50],"L",[27.5,50],"L",[27.5,35],"L",[47.5,35],"L",[47.5,50],"L",[75,50],"L",[75,20],"L",[70,20],"L",[70,25],"L",[65,25],"L",[65,20],"L",[60,20],"L",[60,25],"L",[55,25],"L",[55,20],"L",[50,20],"L",[50,25],"L",[45,25],"L",[45,20],"L",[40,20],"L",[40,25],"L",[35,25],"L",[35,20],"L",[30,20],"L",[30,25],"L",[25,25],"L",[25,20],"L",[20,20],"L",[20,25],"L",[15,25],"L",[15,20],"L",[10,20],"L",[10,25],"L",[5,25],"L",[5,20],"L",[0,20],"L",[0,50]])],!0),Xe,ze,0),(e=(i=se).createLinearGradient(0,0,0,T)).addColorStop(0,(n="rgba(10,20,25,")+"0)"),e.addColorStop(.2,n+"0)"),e.addColorStop(1,n+"0.5)"),i.fillStyle=e,i.fillRect(0,0,T,T),i.restore(),pe.style.top="100px",pe.style.pointerEvents="none",r.appendChild(pe),L(0),F()}</script>