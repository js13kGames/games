function Obj(a){"object"!=typeof a&&(a={name:"",x:0,y:0,r:100}),"number"!=typeof a.x&&(a.x=0),"number"!=typeof a.y&&(a.y=0),this.name=a.name,this.pos=new Coords(a.x,a.y),this.vel=new Coords(0,0),this.acc=new Coords(0,0),this.force=new Coords(0,0),this.impulse=new Coords(0,0),this.radius=a.r,this.fireArea=0,this.earthArea=0,this.airArea=0,this.waterArea=0,this.fireSize=0,this.earthSize=0,this.waterSize=0,this.airSize=0,this.structure=0,this.mass=0,this.color={r:80,g:70,b:50},this.isMassAbsorbing=!1,this.isPlasma=!1,this.isImmovable=!1,this.isEdgeLooping=!1,this.isEdgeBound=!1,this.elasticity=.9,this.groundFriction=.5,this.waterFriction=.9,this.airFriction=.95,this.plasmaFriction=.9,this.illumination=0,this.luminosity=0,this.density=1,this.heat=0,this.collisionHeat=0,this.isFrozen=!1,this.isBoiling=!1,this.colliding=[],this.isGrounded=!1,this.life=0,this.evolution=0,this.trail=[],this.maxTrail=12}function Galaxy(a){this.rings=a,this.systems=[],this.generate()}function System(a,b,c){this.galaxy=a,this.name=b+"-"+c,this.ring=b,this.radius=4e3+randInt(4e3),this.center=new Coords(0,0),this.sun=null,this.planets=[],this.generate()}function Sun(a){Obj.call(this,a),this.isImmovable=!0,this.isEdgeBound=!0,this.isPlasma=!0,this.isMassAbsorbing=!0,this.color.r=255,this.color.g=150,this.generate(),this.fireArea=this.earthArea}function Planet(a){Obj.call(this,a),this.isImmovable=!0,this.isEdgeBound=!0,this.isMassAbsorbing=!0,this.color={r:100,g:100,b:100},this.jumpFuel=0,this.generate()}function Ship(a){a={name:"ship",x:0,y:0},Obj.call(this,a),this.isShip=!0,this.isEdgeBound=!0,this.jumpFuel=100,this.isElementScanOn=!1,this.isThermoScanOn=!1,this.isEngineOn=!0}Obj.prototype.hotThreshold=900,Obj.prototype.absorbEarthRate=.01,Obj.prototype.absorbWaterRate=.2,Obj.prototype.absorbAirRate=.4,Obj.prototype.bigG=.5,Obj.prototype.absorbEarth=function(a){if(this.isMassAbsorbing&&a.isMassAbsorbing){var b=this.absorbEarthRate;b*=this.isPlasma?10:this.mass/a.mass,b=Math.min(a.earthArea,b),this.earthArea+=b,a.earthArea-=b}},Obj.prototype.absorbWater=function(a){if(a.waterArea>0){var b=a.isFrozen?this.absorbEarthRate:this.absorbWaterRate;b*=this.mass/a.mass,b=Math.min(a.waterArea,b),this.waterArea+=b,a.waterArea-=b}},Obj.prototype.absorbAir=function(a){if(a.airArea>0){var b=this.absorbAirRate*(this.mass/a.mass);b=Math.min(a.airArea,b),this.airArea+=b,a.airArea-=b}},Obj.prototype.setup=function(){this.setMass(),this.setRadiusSizes(),this.structure=this.mass},Obj.prototype.setMass=function(){return this.mass=(this.fireArea+this.earthArea)*this.density+this.waterArea/2+this.airArea/4,this},Obj.prototype.setAreaBySize=function(a,b){this[a+"Area"]=Math.PI*Math.pow(b,2)},Obj.prototype.setRadiusSizes=function(){var a=this;a.fireSize=Math.sqrt(a.fireArea/Math.PI);var b=this.fireArea+a.earthArea;return a.earthSize=Math.sqrt(b/Math.PI),a.waterArea>0?(b+=a.waterArea,a.waterSize=Math.sqrt(b/Math.PI)):a.waterSize=0,a.airArea>0?(b+=a.airArea,a.airSize=Math.sqrt(b/Math.PI)):a.airSize=0,"undefined"==typeof a.radius&&(a.radius=a.earthSize),this},Obj.prototype.setNewCollisionVels=function(a,b){var c=this;if(c.mass<=0||a.mass<=0)return!1;var e=(c.mass*c.vel.getMagnitude()+a.mass*a.vel.getMagnitude(),c.pos.getUnitVector(a.pos)),f=c.vel.getDot(e),g=a.vel.getDot(e),h=2*(f-g)/(c.mass+a.mass);return c.vel.add(e.getMultiply(-1*h*a.mass)),c.vel.multiply(b),a.vel.add(e.getMultiply(h*c.mass)),c.vel.multiply(b),!0},Obj.prototype.physicsOneObject=function(a){var b=this;if(a.mass>0){var d,e,c=b.pos.getDistance(a.pos),f=c-b.earthSize-a.earthSize,g=c-b.waterSize-a.waterSize,h=c-b.airSize-a.airSize,i=3e3;if(a.isPlasma&&f<=i){var j=1-f/i;b.illumination+=j,b.heat+=1e3*j}if(b.mass>=a.mass&&!a.isPlasma||b.isPlasma&&!a.isPlasma?(d=b,e=a):(d=a,e=b),Math.round(f)<=0){d.absorbEarth(e),d.absorbWater(e),d.absorbAir(e),b.collisionHeat+=10,b.colliding.push(a);var k=f/1;a.isPlasma||b.isPlasma?(b.vel.multiply(b.plasmaFriction),b.structure-=1.5):(b.mass<=a.mass?b.pos.add(b.pos.getUnitVector(a.pos).multiply(k)):a.pos.add(a.pos.getUnitVector(b.pos).multiply(k)),b.setMass().setRadiusSizes(),b.setNewCollisionVels(a,b.elasticity),b.applyFriction(a,"ground")),b.damageLife(b.life/100),a.damageLife(a.life/100)}else b.applyGravityForce(a),Math.round(g)<=0?(b.applyFriction(a,"water"),d.absorbWater(e),d.absorbAir(e)):Math.round(h)<=0&&(b.applyFriction(a,"air"),d.absorbAir(e))}},Obj.prototype.applyGravityForce=function(a){var b=this,c=b.pos.getDistance(a.pos),d=b.pos.getUnitVector(a.pos),e=b.bigG*b.mass*a.mass,f=Math.pow(c,2),g=0==f?0:e/f;d.multiply(g),b.force.add(d)},Obj.prototype.applyFriction=function(a,b){var c=this;c.vel.multiply((c[b+"Friction"]+a[b+"Friction"])/2)},Obj.prototype.physics=function(a){var c,b=this;b.setMass().setRadiusSizes(),b.colliding=[],b.collisionHeat>0&&(b.collisionHeat-=10),b.isPlasma?(b.heat=1e3,b.illumination=1):(b.heat=0,b.illumination=0);for(var d=0;d<a.length;d++)c=a[d],b.physicsOneObject(c);if(b.illumination>1&&(b.illumination=1),b.heat>b.hotThreshold){b.isFrozen=!1,b.isBoiling=!0;var e=Math.min(b.waterArea,10);b.waterArea-=e,b.airArea+=e;var e=Math.min(b.waterArea,2);b.airArea-=e,b.damageLife(100)}else b.heat<=0?(b.isFrozen=!0,b.isBoiling=!1):(b.isFrozen=!1,b.isBoiling=!1);if(b.isImmovable)b.force.clear(),b.acc.clear(),b.vel.clear();else if(b.mass>0){b.force.add(b.impulse);var f=new Coords(b.force.x/b.mass,b.force.y/b.mass);b.acc.add(f),b.vel.add(b.acc),b.pos.add(b.vel),b.acc.clear(),b.force.clear()}b.isGrounded=b.colliding.length>0&&b.vel.getMagnitude()<.5},Obj.prototype.damageLife=function(a){var b=this;b.life>0&&(b.life-=Math.min(b.life,rand(a))),this.life<=0&&(b.life=0,b.evolution-=1,b.evolution<0&&(b.evolution=0))},Obj.prototype.checkLife=function(){var a=this;a.earthArea>1e3&&a.waterArea>1e3&&a.airArea>1e3&&a.heat>0?a.evolution<100?a.evolution++:a.life+=rand(5):a.damageLife(5)},Obj.prototype.getColorString=function(a){var b=this,c=Math.max(b.illumination,.35),d=[];switch(a){case"earth":case"fire":d=[b.color.r,b.color.g,b.color.b];break;case"water":d=[0,100,255];break;case"air":d=[230,200,240]}if(b.isFrozen)"water"==a&&(d=[200,200,255]);else if(b.isBoiling){var e=b.heat-b.hotThreshold;d[0]+=e/2}b.collisionHeat>0&&(d[0]+=50);var f="rgb("+Math.min(Math.floor(d[0]*c),255)+","+Math.min(Math.floor(d[1]*c),255)+","+Math.min(Math.floor(d[2]*c),255)+")";return f},Obj.prototype.setTrail=function(){this.trail.push(this.pos.getCopy()),this.trail.length>this.maxTrail&&this.trail.splice(0,1)},Obj.prototype.drawTrail=function(a,b,c){function e(e){var f=d.trail[e].x*b+c.x,g=d.trail[e].y*b+c.y,h=d.maxTrail-e,i=d.radius;i*=0==h?.1:.9/h+.1,i*=b,a.beginPath(),a.arc(f,g,i,0,PI2,!0),a.closePath(),a.fill()}var d=this;a.save(),a.beginPath(),a.globalAlpha=.1,a.fillStyle="#aaa";for(var f=0;f<d.trail.length-1;f++)e(f);a.closePath(),a.fill(),a.restore()},Galaxy.prototype.generate=function(){for(var a=7,b=this.rings.length-1;b>=0;b--)a++,a>8&&(a=1),this.systems.push(new System(this,this.rings[b],a))},System.prototype.generate=function(){function k(){return rand(b/20)+10}var e,h,i,a=this,b=a.radius/2,c="Z"==a.ring?2:randInt(10),d=["I","II","III","IV","V","VI","VII","VII","IX","X"],f=100+randInt(80),g=2*k();a.sun=new Sun({name:a.name+" sun",x:0,y:0,r:g});for(var l=0;l<c;l++)g+=rand(b/c)+b/50,h=rand(PI2),i=new Coords(0,0),i.setPolar(g,h),e=new Planet({name:a.name+"-"+d[l],x:i.x,y:i.y,r:k()}),e.jumpFuel=Math.ceil(f/c),console.log(e.name,Math.ceil(f/c),g),a.planets.push(e)},Sun.prototype=new Obj,Sun.prototype.generate=function(){this.setAreaBySize("earth",this.radius),this.setup()},Planet.prototype=new Obj,Planet.prototype.generate=function(){this.setAreaBySize("earth",this.radius),this.setup()},Ship.prototype=new Obj,Ship.prototype.propulsion=function(a){return!!this.isEngineOn&&(a.multiply(600+this.mass/2),void this.force.add(a))},Ship.prototype.toggleEngine=function(){return this.isEngineOn=!this.isEngineOn,this.isEngineOn?"Engine On":"Engine Off"},Ship.prototype.draw=function(a,b,c){var d=this.pos.x*b+c.x,e=this.pos.y*b+c.y,f=this.radius*b,g=1.5*f,h=.8*f,i=a;this.drawTrail(i,b,c),i.save(),i.globalAlpha=1,i.fillStyle="#f44",i.lineWidth=.05*f,i.beginPath(),i.moveTo(d,e+.1*f),i.lineTo(d+g,e),i.bezierCurveTo(d+.5*f,e+1.1*f,d-.5*f,e+1.1*f,d-g,e),i.lineTo(d-g,e),i.closePath(),i.fill(),i.save(),i.fillStyle="#fff",i.globalAlpha=1,i.beginPath();var j=.2*f;i.moveTo(d-j,e+j),i.quadraticCurveTo(d-2.5*j,e+.6*j,d-1.5*j,e),i.bezierCurveTo(d-3.2*j,e-4*j,d-1.31*j,e-4.1*j,d-j,e-.2*j),i.quadraticCurveTo(d,e-.4*j,d+j,e-.2*j),i.bezierCurveTo(d+1.31*j,e-4.1*j,d+3.2*j,e-4*j,d+1.5*j,e),i.quadraticCurveTo(d+2.5*j,e+.6*j,d+j,e+j),i.quadraticCurveTo(d,e+1.4*j,d-j,e+j),i.closePath(),i.fill(),i.fillStyle="#000",i.beginPath(),i.arc(d-.9*j,e+.4*j,.3*j,0,Math.PI,!0),i.arc(d+.9*j,e+.4*j,.3*j,0,Math.PI,!0),i.closePath(),i.fill(),i.restore(),i.fillStyle="#aff",i.strokeStyle="#366",i.globalAlpha=.5,i.beginPath(),i.arc(d,e-.2*j,.5*f,0,PI2,!0),i.closePath(),i.fill(),i.stroke(),i.fillStyle="#cfc",i.strokeStyle="#f44",i.lineWidth=.2*f,i.globalAlpha=.25,i.beginPath(),i.moveTo(d-f,e),i.bezierCurveTo(d-3*j,e-1.3*f,d+3*j,e-1.3*f,d+f,e),i.quadraticCurveTo(d,e+h,d-f,e),i.closePath(),i.fill(),i.globalAlpha=1,i.stroke(),i.restore()},Ship.prototype.harvestPlanet=function(a){if("object"!=typeof a){if(!(this.colliding.length>0))return"Not grounded on a planet";a=this.colliding[0]}var b=Math.min(10,a.jumpFuel);return 0==b?"No fuel left on this planet":isNaN(b)?"No fuel":(a.jumpFuel-=b,this.jumpFuel+=b,"Harvesting +"+b+" Fuel")},Ship.prototype.repair=function(){if(this.isEngineOn)return"Cannot repair while engine is on";var a=randInt(9)+1;return this.structure+=a,this.structure=Math.min(this.structure,this.mass),"Repairing +"+a+" Hull"};var PI2=2*Math.PI;g={galaxy:null,maxEnts:240,ents:[],stars:[],bgStars:[],particles:[],terra:null,intId:0,iteration:0,endIter:53e6,timeBetweenIntervals:30,intId2:0,timeBetweenIntervals2:1e3,size:null,halfSize:null,player:null,canvasElt:null,introElt:null,hudElt:null,isWon:!1,isObjectInfoOn:!1,isSplash:!0,playerSystemIndex:0,zoomLevel:5,HOME:"Terra",ZOOM_LEVELS:[.05,.1,.2,.3,.5,1,2,3,5,8,13,21,34],gebi:function(a){return document.getElementById(a)}},g.getCurrentSystem=function(){return this.galaxy.systems[this.playerSystemIndex]},g.draw=function(){var a=this,b=ctx;b.save(),b.clearRect(0,0,a.size.x,a.size.y);var f,g,l,m,c=a.getCurrentSystem(),h=a.ents.length,n=null,o=0,p=a.getZoomMultiplier(),q=-1*a.player.pos.x*p+a.halfSize.x,r=-1*a.player.pos.y*p+a.halfSize.y,s=-.3*a.player.pos.x*p+a.halfSize.x,t=-.3*a.player.pos.y*p+a.halfSize.y,u=-.1*a.player.pos.x*p+a.halfSize.x,v=-.1*a.player.pos.y*p+a.halfSize.y,w=new Coords(q,r);for(b.shadowOffsetX=0,b.shadowOffsetY=0,g=0;g<a.stars.length;g++)a.drawStar(a.stars[g],s,t);for(g=0;g<a.bgStars.length;g++)a.drawStar(a.bgStars[g],u,v);for(b.save(),b.strokeStyle="#7777ff",b.globalAlpha=.2,g=0;g<c.planets.length;g++)b.beginPath(),b.arc(q,r,a.getCurrentSystem().center.getDistance(c.planets[g].pos)*p,0,PI2,!0),b.shadowColor="#eee",b.shadowBlur=30*p,b.stroke(),a.isObjectInfoOn&&(b.beginPath(),b.strokeStyle="#7777ff",b.moveTo(a.halfSize.x,a.halfSize.y),b.lineTo(c.planets[g].pos.x*p+q,c.planets[g].pos.y*p+r),b.stroke());for(b.restore(),a.isObjectInfoOn&&(b.save(),b.strokeStyle="#aa7733",b.globalAlpha=.2,b.beginPath(),b.moveTo(a.halfSize.x,a.halfSize.y),b.lineTo(q,r),b.stroke(),b.restore()),b.save(),g=h-1;g>=0;g--)f=a.ents[g],"function"==typeof f.draw?f.draw(b,p,w):f.isPlasma&&f.earthSize>0?(a.drawSun(f,p,w),n=f.pos.getDistance(a.player.pos),o++):f.isPlasma||(l=f.pos.x*p+q,m=f.pos.y*p+r,f.earthSize>0&&a.drawCircle(l,m,f.earthSize*p,1,f.getColorString("earth")),f.waterSize>0&&a.drawCircle(l,m,f.waterSize*p,.7,f.getColorString("water")),f.airSize>0&&a.drawCircle(l,m,f.airSize*p,.3,f.getColorString("air"))),f.mass>10&&a.drawText(f,l,m);b.restore(),b.save(),b.beginPath(),b.globalAlpha=.1,b.setLineDash([5,15]),b.strokeStyle="#ee77aa",b.arc(q,r,a.getCurrentSystem().radius*p,0,PI2,!0);var x=2*c.radius*p;b.rect(w.x-c.radius*p,w.y-c.radius*p,x,x),b.stroke(),b.restore()},g.drawStar=function(a,b,c){var d=a.pos.x*this.getZoomMultiplier()+b,e=a.pos.y*this.getZoomMultiplier()+c,f=rand(1)<.002;ctx.save(),ctx.shadowColor="#ffff00",ctx.shadowBlur=f?randInt(80):70,ctx.beginPath(),ctx.moveTo(d,e),ctx.arc(d,e,a.size,0,PI2,!0),ctx.fillStyle=f?"#fff":"#aa8",ctx.fill(),ctx.closePath(),ctx.restore()},g.drawSun=function(a,b,c){var d=a.pos.x*b+c.x,e=a.pos.y*b+c.y;ctx.save(),ctx.fillStyle=a.getColorString("fire"),ctx.shadowColor="#ffff00",ctx.shadowBlur=30,ctx.beginPath(),ctx.moveTo(d,e),ctx.arc(d,e,a.earthSize*b,0,PI2,!0),ctx.closePath(),ctx.fill(),ctx.restore()},g.drawCircle=function(a,b,c,d,e){ctx.save(),ctx.beginPath(),ctx.moveTo(a,b),ctx.globalAlpha=d,ctx.arc(a,b,c,0,PI2,!0),ctx.fillStyle=e,ctx.shadowColor="#000",ctx.shadowBlur=-30,ctx.fill(),ctx.restore()},g.drawText=function(a,b,c){var d=Math.round;if(ctx.save(),ctx.font="14px Verdana",this.player.isElementScanOn){var e=b+a.earthSize+8;ctx.fillStyle="#ccc",ctx.fillText(d(a.earthArea)+"e",e,c-12),ctx.fillText(d(a.waterArea)+"w",e,c),ctx.fillText(d(a.airArea)+"a",e,c+12)}this.player.isThermoScanOn&&(a.isFrozen?ctx.fillStyle="#33a":a.isBoiling?ctx.fillStyle="#a33":ctx.fillStyle="#ec3",ctx.fillText(""+d(a.heat)+"Â°",b-10,c+a.earthSize+24)),ctx.restore()},g.zoom=function(a){var b=this;b.zoomLevel=Math.max(Math.min(b.zoomLevel+a,b.ZOOM_LEVELS.length-1),0)},g.getZoomMultiplier=function(){return this.ZOOM_LEVELS[this.zoomLevel]},g.jump=function(a){var b=this,c=100;b.player.jumpFuel<c?b.hud.addMessage("Not enough jump fuel"):"A"==b.getCurrentSystem().ring?b.hud.addMessage("You're at the final system in the galaxy"):(b.switchSystem(a),b.hud.renderSystemName(),b.player.pos.x=b.getCurrentSystem().radius*-.7,b.player.vel.clear(),b.player.acc.clear(),b.player.jumpFuel-=c)},g.switchSystem=function(a){var b=this;"number"==typeof a?b.playerSystemIndex=a:b.playerSystemIndex+=1,b.spawnSystem()},g.hud={messages:[],timer:0,addMessage:function(a){return a!==!1&&(this.messages.push({text:a,timestamp:new Date}),void this.renderMessages())},renderAll:function(){this.renderMessages(),this.renderSystemName(),this.renderStats()},renderMessages:function(){for(var a=this,b="",c=new Date,d=0;d<a.messages.length;d++)c-a.messages[d].timestamp<6e3&&(b+="<li>"+a.messages[d].text+"</li>");g.gebi("hud-messages").innerHTML=b},renderSystemName:function(){g.gebi("hud-system-name").innerHTML=g.getCurrentSystem().name},renderStats:function(){g.gebi("jump-fuel-amount").innerHTML=Math.ceil(g.player.jumpFuel),g.gebi("hull-amount").innerHTML=Math.round(100*g.player.structure/g.player.mass)},start:function(){var a=this;a.stop(),a.timer=setInterval(function(){a.renderAll()},500)},stop:function(){clearInterval(this.timer)}},g.makeGalaxy=function(){var a=this;a.galaxy=new Galaxy(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]),a.terra=a.galaxy.systems[a.galaxy.systems.length-1],a.terra.name="The Terran System",a.terra.planets[0].name=a.HOME,a.spawnSystem(),console.log("Made galaxy",a.galaxy,"\ncurrent system",a.getCurrentSystem(),"\nwith entities",a.ents)},g.spawnSystem=function(){var a=this;a.ents=[a.player],a.stars=[],a.bgStars=[],a.makeStars(a.getCurrentSystem().radius/20,a.stars),a.makeStars(a.getCurrentSystem().radius/10,a.bgStars),a.ents.push(a.getCurrentSystem().sun),a.ents=a.ents.concat(a.getCurrentSystem().planets),a.makeAsteroids(3)},g.makeAsteroid=function(a,b,c,d){var e=this;"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=rand(8)+1);var f=Math.max(e.size.x,e.size.y);b+=randAround(f),c+=randAround(f);var g=new Obj({name:a,x:b,y:c});return g.isMassAbsorbing=!0,g.isEdgeLooping=!0,g.vel.x=randAround(20),g.vel.y=randAround(20),g.setAreaBySize("earth",d),rand(1)<.2&&(g.waterArea=rand(300)+100),rand(1)<.25&&(g.airArea=rand(300)+100),g.setup(),e.ents.push(g),g},g.makeAsteroids=function(a){if(this.ents.length+a<=this.maxEnts)for(var b=0;b<a;b++)this.makeAsteroid("O"+b,this.player.pos.x,this.player.pos.y)},g.makeSun=function(a,b,c){var d=this.makeAsteroid(a,b,c);d.pos.x=rand(this.getCurrentSystem().radius),d.pos.y=rand(this.getCurrentSystem().radius),d.isPlasma=!0,d.color.r=255,d.color.g=150,d.fireArea=d.earthArea},g.makeStar=function(a){var b=this.getCurrentSystem().radius,c={pos:new Coords(randAround(b),randAround(b)),size:Math.floor(rand(2))+1};a.push(c)},g.makeStars=function(a,b){for(var c=0;c<a;c++)this.makeStar(b)},g.makePlayerShip=function(a){var b=this,c=new Ship({name:a,x:0,y:0});c.color={r:50,g:190,b:50},c.isMassAbsorbing=!1,c.earthArea=200,c.luminosity=.2,c.density=1.5,c.setup(),b.player=c,b.ents.push(c)},g.moment=function(){var c,d,e,a=this,b=a.getCurrentSystem();for(d=0;d<a.ents.length;d++)c=a.ents.slice(0),c.splice(d,1),e=a.ents[d],e.physics(c),a.checkEdges(b,e),e.setTrail();a.draw(),a.checkGameOver(),a.checkVictory()},g.checkEdges=function(a,b){var c=a.radius,d=c*-1;b.pos.getDistance(a.center)>c&&(b.isEdgeLooping&&(b.pos.x<d?b.pos.x+=2*c:b.pos.x>c&&(b.pos.x+=2*d),b.pos.y<d?b.pos.y+=2*c:b.pos.y>c&&(b.pos.y+=2*d)),b.isEdgeBound&&(b.pos.x>c?(b.pos.x=c,b.vel.clear()):b.pos.x<d&&(b.pos.x=d,b.vel.clear()),b.pos.y>c?(b.pos.y=c,b.vel.clear()):b.pos.y<d&&(b.pos.y=d,b.vel.clear())))},g.reclaimEnts=function(){for(var a=0;a<this.ents.length;a++)this.ents[a].mass<=0&&this.ents.splice(a,1)},g.checkGameOver=function(){var a=this;(a.player.mass<=0||a.player.structure<=0)&&(this.stop(),this.gebi("gameover").style.display="block")},g.checkVictory=function(){var a=this;!a.isWon&&a.player.colliding.length>0&&a.player.colliding[0].name==a.HOME&&(a.isWon=!0,a.stop(),a.gebi("victory").style.display="block")},g.start=function(){var a=this;a.intId=window.setInterval(function(){a.iteration++,a.iteration<a.endIter?a.moment():a.stop()},this.timeBetweenIntervals),a.intId2=window.setInterval(function(){a.reclaimEnts(),a.checkGameOver(),a.checkVictory()},this.timeBetweenIntervals2)},g.stop=function(){console.log("Stopped"),clearInterval(this.intId),clearInterval(this.intId2),this.intId=0},g.setup=function(){var a=this;a.canvasElt=document.getElementById("s"),a.introElt=document.getElementById("intro"),a.splashElt=document.getElementById("splash"),a.hudElt=document.getElementById("hud"),a.isSplash=!0,a.splashElt.style.display="block",a.setupScreen(),window.ctx=a.canvasElt.getContext("2d"),ctx.font="14px Verdana",ctx.fillStyle="red",ctx.strokeStyle="yellow",ctx.save(),console.log(a.canvasElt,a.size,a.halfSize),a.setupEvents(),a.makePlayerShip("player"),a.makeGalaxy(),a.jump(0),a.hud.start()},g.setupScreen=function(){var a=this,b=window,c=document,d=c.documentElement,e=c.getElementsByTagName("body")[0],f=b.innerWidth||d.clientWidth||e.clientWidth,g=b.innerHeight||d.clientHeight||e.clientHeight;f-=20,g-=20,a.size=new Coords(f,g),a.halfSize=new Coords(f/2,g/2),a.canvasElt.style.width=f+"px",a.canvasElt.style.height=g+"px",a.canvasElt.width=f,a.canvasElt.height=g},g.action=function(a){var b=this;switch(console.log(a),a){case"e":b.player.isElementScanOn=!b.player.isElementScanOn;break;case"t":b.player.isThermoScanOn=!b.player.isThermoScanOn;break;case"+":b.zoom(1);break;case"-":b.zoom(-1);break;case"j":b.jump();break;case"r":b.hud.addMessage(b.player.repair());break;case"o":b.isObjectInfoOn=!b.isObjectInfoOn;break;case"m":b.hud.addMessage(b.player.harvestPlanet());break;case"n":b.hud.addMessage(b.player.toggleEngine());break;case"x":b.makeAsteroids(10);break;case"p":b.intId?b.stop():b.start();break;case"enter":case"esc":case"h":b.intId?(b.stop(),b.introElt.style.display="block",b.hudElt.style.display="none"):(b.start(),b.introElt.style.display="none",b.hudElt.style.display="block")}b.intId&&(b.gebi("victory").style.display="none",b.gebi("gameover").style.display="none")},g.setupEvents=function(){var a=this,b=function(){a.isSplash=!1,a.splashElt.style.display="none",a.introElt.style.display="block"};document.getElementById("enter").addEventListener("click",function(b){a.action("enter")}),a.splashElt.addEventListener("click",function(a){b()}),document.addEventListener("keydown",function(c){if(c.pd=c.preventDefault,a.isSplash)return b(),!1;switch(c.keyCode){case 37:case 65:a.player.propulsion(new Coords(-1,0)),c.pd();break;case 38:case 87:a.player.propulsion(new Coords(0,-1)),c.pd();break;case 39:case 68:a.player.propulsion(new Coords(1,0)),c.pd();break;case 40:case 83:a.player.propulsion(new Coords(0,1)),c.pd();break;case 32:case 77:a.action("m");break;case 78:a.action("n");break;case 88:a.action("x");break;case 82:a.action("r");break;case 187:a.action("+");break;case 189:a.action("-");break;case 74:a.action("j");break;case 69:a.action("e");break;case 84:a.action("t");break;case 72:a.action("h");break;case 79:a.action("o");break;case 80:a.action("p");break;case 27:a.action("esc");break;case 13:a.action("enter");break;case 81:break;default:console.log(c.keyCode),console.log(g.player)}},!1),window.onresize=function(b){a.setupScreen()}},g.setup(),g.draw(),console.log(g),galaxy=g.galaxy,systems=g.galaxy.systems;