<!doctype html><title>Cubi - js13kGames 2012</title><meta name=viewport content="width=device-width"><style>body{font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:12px;margin:4px;padding:0}table{border-collapse:collapse;border:1px solid #000;box-shadow:0 0 5px 0 #000}#meta-data{background:#000;box-shadow:0 0 5px 0 #000;color:#fff;padding:5px}#meta-data span{padding:0 5px}#meta-data span:not(:last-child){border-right:1px solid #fff}#force-next-wave{cursor:pointer}#force-next-wave.disabled{cursor:not-allowed;color:#aaa}table td{padding:0;position:relative}table td,table td:after{height:28px;width:24px}table .inaccessable,table .tower{background:url('data:image/gif;base64,R0lGODdhGAAcAKIAAFB/kleMnmOYpnSntHSntIu7xgAAAAAAACwAAAAAGAAcAAADkjhapSrQwRCdtVDQOsT9WXZ53fdw40OBpUlqlfi4AbXN1ypFMjrVIVKHB3hpAkVeSoHEHV9LlXAAlCxaqhtTSGqMqjtPxTsFN3jgTsBiHmY36bQzzZExWs+UEiOGgbh8Q3JuJxgnG1yAgXlhYjV8IX8hcRMAA3eFjUEiDVqBhDign1NOU154H48cp1ipYiZhkEIJADs=')}table .monster,table .path{background:url('data:image/gif;base64,R0lGODdhGAAcAMQAADNYdlpaWlpaWmhsaHh4eD9jgkNzilZ7m1eMnmOYpnWotHWotIyMjIiMlKCkn7i4uIu7xprHzabQ1czMzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAGAAcAAAF/6AiQsFABA5RGEZBDAxBMGItJuWZru0by7ZaIBeIFY4AnyyACA5NJxksNihKi4qE4gnNyV6l1DKQwJWgr0F1+PyBmefvlxFzOB7oqzovV0r7AX1faDByeTBsaE9+g2xDVIo+JmpfgRN2Yn6UDAMOVDEBD24FJlYydA6FSigyAEegaXuUslViAAcFoJ50vAy7BJ6qt0m1cm1Sn60uaw+Vk7FUfVWdPzmcvdGOqG6ByYO7npmCyN/Y5nSOZ2q75wwNvIEPdnSn2A0OCDO9ARNuS9gJIog4oA+duCXsGEiIgCDBAQgzSrACQDFJEToNIkhQ0EQBBAQmGLAqcACXDlQebxdoQUBkBwsXrHw1zGKjpYqXJ2L40iIiBAA7') no-repeat}table .monster:after,table .tower:after{content:'';display:block}table .monster:after{background:url('data:image/gif;base64,R0lGODdhDwATALMAAAEBARcXFy0tLUJCQlVVVWdnZ3d3d4eHh5eXl8PDw9fX1wAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAAPABMAAASAcElAK5V4AVN6J0M1IQqCHKgRFoAGHIqSJGcR3AFFFAjnEQIEiFLYFQeCgfKApAgAhUGCmWxWDqwgp2JoaVgU7AUQmiRa5Ofk4AUg0MJ2d4SOtlkTQ+5FaIcoAQkqAEAXAgoDfS92CAVzbokUHH1ReBtKFkQDlhYZUJteGZ6dohEAOw==') no-repeat 4px 5px}table .beast:after{background:url('data:image/gif;base64,R0lGODdhEAAJALMAAAICAhoaGkVFRVdXV2lpaXl5eYmJiZmZmaioqLe3t9LS0gAAAAEAAAABAAAAAAAAACH5BAEAAAsALAAAAAAQAAkAAAREcMk5QwCALsyxUgeBSUDyIciBnAVSYISpJGhaBEMxYMJBGwaEgTAQCAYXwOBwGAwIBMONQxK8OgWRZqMlAboU6kQ8iQAAOw==') no-repeat 4px 9px}table .scout-lite:after{background:url('data:image/gif;base64,R0lGODdhCgAHALMAAAICAhoaGjAwMEVFRVdXV2lpaXl5eZmZmbe3t8XFxe3t7QAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAAKAAcAAAQkcC1Aq5zkDLqnUIeQGAJBFYcGBMNBBSgiIwUwDYVhFJ1UWYsIADs=') no-repeat 6px 10px}table .scout-mid:after{background:url('data:image/gif;base64,R0lGODdhCwAIALMAAAQEBBQUFCQkJDU1NUVFRVZWVnZ2doeHh6ioqLi4uPr6+gAAAKBjP4//fwAA0GM/jyH5BAEAAAsALAAAAAALAAgAAAQpcC0ApLX00C2pCMARIEYFEMIQBoSCUASQAMNAFDGs1UTcEZpNBTO8LCIAOw==') no-repeat 4px 9px}table .scout-heavy:after{background:url('data:image/gif;base64,R0lGODdhEAANALMAAAEBAS0tLVVVVWdnZ3d3d4eHh5eXl6amprW1tcPDw9DQ0AAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAAQAA0AAARbcC1AK5AYg0GKRwKVTYNBEUNahJcEmFOgJIKCrCJwXFRCBYLCAaHo8QBFQtFCGbQAPksGekQgBgcDq7KLCb6DgtVgevGAXwGCQMiVmmzCwdlylcgFmmg0YdYzEQA7') no-repeat 4px 7px}table .amphibian-lite:after{background:url('data:image/gif;base64,R0lGODdhGAAcAMQAAAEBARcXFwArAC0tLQNGAAVVAQxiABZvAH9MN0JCQlVVVWdnZ3d3dy6XCjSlIj+zO03BU1TPWQCYh4Lee4eHh5eXlwAAAAAAAPB0fQoBAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABYALAAAAAAYABwAAAW3oCWOZGmeaKqubOu+cCyLQB0Awf3WVUX9jIClRkzhBomEQqEEDBQMxkJXskUej0MEAol4I5NJZAEgAZgDiMNRUD/Wjy44Uh4BGIr0mrAm55JICnU0aAOGhklOSktQCWYDf0mLA4pJChRTVYZRnAwJToELeYN2A6KMgjg5kDUnTguLTAASRK1GqbW0RSoADlgNBUQEDVikJgANXmJLBAIOXsZVBgdrDkQFBgYI0VW1drsz4eLj5DMhADs=') no-repeat}table .tank-lite:after{background:url('data:image/gif;base64,R0lGODdhEgAMALMAAAICAhoaGjAwMEVFRVdXV2lpaXl5eYmJiZmZmaioqMXFxQAAAKBjP4//fwAA0GM/jyH5BAEAAAsALAAAAAASAAwAAARicEkJap2YWsWLsAAGDIphEENRGAWSEKEGmFxNBOAmDOSR1AmEoldBEA5Cn0uAszQRFtRASqh+NAGBQJF4BQaIg2EQiw66iEGg0C2VCYjCLUAPEFgHMmXHq2erVTEyOU0XExEAOw==') no-repeat 3px 8px}table .tank-lite-2:after{background:url('data:image/gif;base64,R0lGODdhEgAMALMAAAEBARcXFy0tLUJCQlVVVXd3d4eHh5eXl6ampsPDw9TU1AAAAGVkVmFsdWVfTWVudSH5BAEAAAsALAAAAAASAAwAAARfcEkJap2YWpVSERaAAYNXEENRJEQQvqrCJTJyJKVRKcKQIwqEwGUhHgiGm8HGIr4OFtSAULvligJBEEEQOgFfFMLmmxIIIArhcAq43QSVYSBaAHq+d0BwPtc1L2AhGBEAOw==') no-repeat 3px 7px}table .tank-mid:after{background:url('data:image/gif;base64,R0lGODdhEQANALMAAAICAhoaGjAwMEVFRVdXV2lpaXl5eYmJiZmZmaioqMXFxQAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAARAA0AAARqcC1AqwUyg5GQH4jgKZi0GcpxJIRCBBdVbMPaKp0ypJWRCLZEAFYhFgICIEtIIBwEBiKgkAoGDAeFASjbJRI6RWClKEQpgkGTsD0ECgW1YbZZs4EC+GCPqa/beXECJRN2W1t6hCYxFhkLEQA7') no-repeat 3px 7px}table .tank-laser:after{background:url('data:image/gif;base64,R0lGODdhEgAMALMAAAICAhoaGjAwMEVFRVdXV2lpaXl5eYmJiZmZmaioqLe3twAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAASAAwAAARccMkJql130lOKMQB2hFRFIALgWUolAQcBEEkQdAACJHtVILLTYQgawGY+IEAwaDaXKqiKY2Q6AQFA1cchpCyVbOVbOBgIA4HNxvQKvoS1DYx9z7XyPNseovvpCxEAOw==') no-repeat 3px 7px}table .tank-heavy:after{background:url('data:image/gif;base64,R0lGODdhDwAPALMAAAICAhoaGjAwMEVFRVdXV2lpaXl5eYmJiZmZmaioqLe3twAAAAAAAABiAHIAYQByACH5BAEAAAsALAAAAAAPAA8AAARlcIkJqrVLFgOMB0h4EMACkIaCGORVAkd3HMawjUgcBGfhCwMCSVjhAAcDgat0BEyUiSgikKnsLBsP64VMErTawiuBWLpMSEBgGBgAki/KYJoITAtKE0Xt7CvjfzxKgyUmZhcZCxEAOw==') no-repeat 4px 6px}table .mech-lite:after{background:url('data:image/gif;base64,R0lGODdhEQATALMAAAEBAS0tLUJCQlVVVWdnZ3d3d4eHh5eXl6amprW1tcPDwwAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAARABMAAARjcMm5gKWYAiQKyBogKGNwZQCBFEpAEucEeEZxCAcxzJ+UfoDBzbCreCqJXgWQVAIMlqTmKEMAnQBFLCaDWqAgWXOjBAWBsLBPW2GrAQegNPyVU1GGOBJsTuiZaXRScGVmVxkRADs=') no-repeat 3px 4px}table .mech-mid:after{background:url('data:image/gif;base64,R0lGODdhEgAQALMAAAEBAS0tLUJCQlVVVWdnZ3d3d4eHh5eXl6amprW1tdDQ0AAAAAAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAASABAAAARpcMkFKpg4S2CS/df2DQNRGIZQEEZFHS0wgByKVoGgHErQirTA4TAQDBKKkAYQGJwQgUJBmWE6DVASFWMJeJlbbkEAOBGUtItl6JkAEIl40i2NWYpSaqVE6BMGRFNLMmlhFAM/GoofihMRADs=') no-repeat 4px 6px}.menu .turret:before,table .turret:after{background:transparent url('data:image/gif;base64,R0lGODdhGAAcAMQAAAkJCgkJCgAKFwAXKAAjOAIuRg49VBRGYSBUbTFheTtphRdC3iJV5El2kGSNp1aX8YSnvKbD0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABIALAAAAAAYABwAAAXAoCSOZGmeaKquLAm8QGsCxmEQsSwCwoEghkFOBhggEj+hDlAYKBrIAY6IIDSg1SmLiSg4HIrqQasCICAGCCQ88A1TsAQkAhW+iIq5A6FswQo1QQUwK2YIB4A3AgMFjW8lZgkNiI0EjQgKiI8jAAkKEQYFcgkJBQgOpJs7T2gGcj8GZ1CqEjAwn2G2d3AMD0wCAjgPC7SQLwiLCoR+xAnJAMREL3YGy1sJ1S8CscWQBg4RCnIKg0sHWA3VOju66+4hADs=') no-repeat}.menu .rocket:before,table .rocket:after{background:transparent url('data:image/gif;base64,R0lGODdhGAAcAMQAAAoKCh0dHSMRADgdADIyMkFBQVRUVGlpaWlpaXl9eYmJiZubm62xrsPDw9TU1Ofn5/f7+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABEALAAAAAAYABwAAAX8YCSOwzCeUYmuQ2GuqfHCrQzHNm3YZW8Ou9mpRvgxCATFrxBkGQqHX+JA/R2YQtwhIUVGU4prTtQ6KJSpxcGAHigSWNL1sFj8Ho367/3MDeYKDT0LU1wlhAcEXylzCQ1ViQZRBAUNCQYEXGRiBwyQXgOUj2tojGtQVKlUmEw7YTN/qlGxJX1miyQ+QDJ/Rbo3oQYJELOWBUhZucdMDy4Dj16+LFGYBJglYZRKuHJAy76ndH/JtE/HJdadf2NyZmW8qLEB5AUFgbo9VAQA5FdQDg0avEllIECTaYlQpTqmyMUNUy4oFQgAAAo7GlV0rUlGo4QAEQJ6PBxJMkIIADs=') no-repeat}.menu .ultra:before,table .ultra:after{background:transparent url('data:image/gif;base64,R0lGODdhFgAaAMQAAAoKCgkjMy4HIxwuQS09SzxLVEIJKFkRLWoXIkFBQU9YZVxlcWZmZml1fX2FiaNVHJico621uNrh4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABMALAAAAAAWABoAAAX/4CSOImCeZEqeAuMqCqqWUBQBDOTETRHPE4ADQsQlhIXCAgAUOoYOkyOpZM6EOqKNqlg2sYtFo0Eg+ExXxbFQk0gaCgIgcVzNXcdxBDIGCBJqaAANfgwRPA1EfS10AHICfHd5QzqECQxHZSaVc2tUAwVzMRAEAyYNEYsAbRI6J4mlpw6phKutDUMCg0QEAae4tBG3Y1CoBb2/qG5uY82zEQulvgAKzlo22HvHAwHTBGLNtSeOSQPc3l3NfgcICAeO5ubdJgEL6X4JD/oPBvTd3CbMhYnRToK+CO4A/DPHROEAGADYIUTwIGE8UyMAgIpx4EDFdgd0/bOS8YQBA+7YFR3oJ+OKAAEnUZ4kCUTEy5svaY4IAQA7') no-repeat}table .level-1:before,table .level-2:before,table .level-3:before{content:'I';display:block;position:absolute;font-weight:700;font-family:Arial;font-size:10px;color:#ff0}table .level-2:before{content:'II'}table .level-3:before{content:'III'}table .selected:before{content:'';height:24px;width:20px;display:block;border:2px solid #ff0}.pop-up{background-color:rgba(10,10,10,.8);background-size:16px 16px;position:absolute;top:20px;left:20px;border-radius:5px;padding:10px;box-shadow:0 0 10px 0 #000;opacity:.95;color:#fff;font-size:14px;z-index:10}.menu{margin:0;padding:0;list-style-type:none}.menu li{color:#fff;line-height:32px;height:32px;vertical-align:top;cursor:pointer;white-space:nowrap}.menu .nested{height:auto;line-height:0;border-top:1px dashed #888}.menu>li{padding:0 5px 0 10px}.menu li ul{list-style-type:none;padding:0;margin:0}.menu>li:not(.nested):hover{background:#151515;border-radius:5px}.menu li:not(.nested):before{content:'';display:inline-block;height:32px;width:24px;margin-left:4px;position:relative;left:-10px;float:left}.menu .upgrade:before{background:transparent url('data:image/gif;base64,R0lGODlhGAAcAKEDAACgAADPAAD/AP///yH5BAEAAAMALAAAAAAYABwAAAJXnI+py+0PE4gNhEllEDcfK4RdBoYiBpXmmW7rOjLqa8ZagON1jqMfAAS6asFgZQjzyZAvm2JG4yg/PGZ1WhQ2s1ME1On4dpdbknW8EJur4AoX6InL544CADs=') center right no-repeat}.menu .sell:before{background:transparent url('data:image/gif;base64,R0lGODlhGAAcAKEDAIwAAMUAAP8AAP///yH5BAEAAAMALAAAAAAYABwAAAJVnI+py+0PQZMPBJosXlbcHHgb0gniUZ6gyX6p+a2sGM6x8nqzyuT2yKntbhUhDNgztpCy3dGRUxJJ0ijQOsA2b6kpKjTteKlITWQCSavX7Lb7DV8UAAA7') center right no-repeat}.menu .stats-range:before{background:transparent url('data:image/gif;base64,R0lGODdhEgAOAKIAAAEBATAwMC5MZz1bdEtngHOInKu1wwAAACwAAAAAEgAOAAADZ0iyRFZKDDNYECDPAbDO3QUEATViJCqiBjFepSETFaAU0CI4ijJAHQDFUwpkiIWgQVRypV4YTCHAKaEI0+dtI2gtCq2LSwrgAAoeibEcJDALVdJrbGP+Bk+qwTZoRHY5FRsvIIWGhQkAOw==') center right no-repeat;left:-12px!important}.menu .stats-damage:before{background:transparent url('data:image/gif;base64,R0lGODdhCwAMAKIAAAEBASBAWjJQalx2jXOInKy1xQAAAAAAACH5BAEAAAYALAAAAAALAAwAAAM8aBrQodCJIEB4rIQiCiCA0QyA5oHAUBQDSFANe1lNPUzWXAtCS7SkkEVFILAaCgBvwGRARL0BIxSpIQ0JADs=') center right no-repeat;left:-18px!important}.menu .stats-frequency:before{background:transparent url('data:image/gif;base64,R0lGODdhCQAJAKIAAAAAAEtngFx2jZ+ru9fZ6AAAAAAAAAAAACH5BAEAAAUALAAAAAAJAAkAAAMaWLoAy2SI0hSQAcRJ3R3BYzmjSG3iFYSpkwAAOw==') center right no-repeat;left:-20px!important}.range{position:absolute;background:orange;border-radius:50%;opacity:.5;border:2px solid #ff0}.bullet{transition:all .25s linear;position:absolute;height:5px;width:5px;background:#000;opacity:.9;border-radius:50%}.explosion{position:absolute;top:0;left:0;width:20px;height:21px;animation-timing-function:step-start;background:transparent url('data:image/gif;base64,R0lGODdhtQAVAKIAAFwPAHsgAJovAKo9ANdQAOheAOqVAAAAACH5BAEAAAcALAAAAAC1ABUAAAP/eLrc/jDKSau9OOvNc/ggWIXBBXwAYIVd674PmU4BQRSFYRTEUEYfnA0kmJwEAtAMQgqkfrSFUgWrMlJUCTYwsAmWDm5OR94RoI0PWUhAoq+AwUDgTYIZKKQelQ1zBwd6dn1heFiECndpFFsBX4hXTlw2Xk4xN2WZZ35jOkI6SQ1YAl1ydVhhAAJCpnMfMZMEB3Jzg7CADidvI1pHpEiKC76mZm2WeHSdmWZoIARlOJ2hwo5IOazAimLXPW1uuwc5sgc9c4HTeOBSx1WqpLTAEKo2A8o8c1l/z8tlm+ur/XCsmZZCT70dO949arAqyYcbPmYheVCgiAKICmpRpAGJ/4MvSnLs5Jr0aU0PdjVs8IPmr1oXaPYIClrFgwcdAyIZuJHiKtxECrgyQigwAd2Lairp4RuJyYwnIV+kNF255se2fU87FYjoi84AHTa2ev3ypoSIV+TkWKFgEcaRg2ZosUuUjMwNHp6m1VBGdYdZlSbD3u0RypejMXQwGQsWQFxZdRcNrLXijlS0cj2vJOMm5JreqX1x/MUKFlO0PQcK6vFMKq+TPn8N+CNX4dm4yS4+vLvXzZiobbxl3/3Ml180szVhBib1Y14bekj2uQKDtoY5coQd4mEQNOM3KbgpuKQ32GhqR13CDvR9IGVfT7L/RnvKEkfE9klr0bP/vX0Nyf/+LUAPFz/hB+ADPmiU0W0SQNGRCdWQYhp7wqhiilZtZPYBXCtdU4BZAuwAlUCliWhVegbZ5o0xJ3rBAH+/sJNYW+EsEKODakWRyAtdJTZdLptpFRJa7XG4zBiiKRCibHJc48lBH1qlEBJd3EPlTv6FZNEzW8GDkpaREeWdUVxwdEUFDyoQ4R6QHHFXTZWgtJdxSN4XCJPqsZKDCGquCdJMUOimkWI+8IHMoOIEZV57BToQ1Zm9GKGLofKckB4lDp2AR5X2IDmbfxKaRksPijwRHWG6mUfEqag68lg12BGGAYM7hjdFmuellJ0kfrwpoohnPJbEhLU8Kspb0z3hBxFNWs617JiLAgFZeCaoNsiDD0VzWbCwHNalGw9a+5ou3RakRAZYXsAntR0cgmufjW1LJBOrOpuLKoeM4Oq66k7bzrvsitcEBiwEbPDBCQAAOw==')}.explosion.small{width:10px;height:11px;background-position:-80px 0;background-size:90px;animation-duration:.2s;animation-name:explosion-small}.explosion.mid{background-position:-160px 0;animation-name:explosion-mid;animation-duration:.4s}.explosion.big{height:40px;width:40px;background-position:-320px 0;background-size:362px;animation-name:explosion-big;animation-duration:1s}@keyframes explosion-small{0%{background-position:0 0}12.5%{background-position:-10px 0}25%{background-position:-20px 0}37.5%{background-position:-30px 0}50%{background-position:-40px 0}62.5%{background-position:-50px 0}75%{background-position:-60px 0}87.5%{background-position:-70px 0}100%{background-position:-80px 0}}@keyframes explosion-mid{0%{background-position:0 0}12.5%{background-position:-20px 0}25%{background-position:-40px 0}37.5%{background-position:-60px 0}50%{background-position:-80px 0}62.5%{background-position:-100px 0}75%{background-position:-120px 0}87.5%{background-position:-140px 0}100%{background-position:-160px 0}}@keyframes explosion-big{0%{background-position:0 0}12.5%{background-position:-40px 0}25%{background-position:-80px 0}37.5%{background-position:-120px 0}50%{background-position:-160px 0}62.5%{background-position:-200px 0}75%{background-position:-240px 0}87.5%{background-position:-280px 0}100%{background-position:-320px 0}}ul.game-over{list-style-type:none;margin:0;padding:0}ul.game-over li:first-child{font-size:18px;border-bottom:1px dashed #888}ul.game-over li{line-height:28px}ul.game-over li:last-child{border-top:1px dashed #888}ul.game-over a{color:#fff;margin-top:5px;display:block}</style><body><script>(function(){function e(e,t){return[].slice.call((t||document).querySelectorAll(e))}if(window.addEventListener){var t=window.StyleFix={link:function(e){try{if("stylesheet"!==e.rel||e.hasAttribute("data-noprefix"))return}catch(e){return}var n,i=e.href||e.getAttribute("data-href"),s=i.replace(/[^\/]+$/,""),o=e.parentNode,r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&n()},n=function(){var n=r.responseText;if(n&&e.parentNode&&(!r.status||r.status<400||r.status>600)){if(n=t.fix(n,!0,e),s){n=n.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,(function(e,t,n){return/^([a-z]{3,10}:|\/|#)/i.test(n)?e:'url("'+s+n+'")'}));var i=s.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");n=n.replace(RegExp("\\b(behavior:\\s*?url\\('?\"?)"+i,"gi"),"$1")}var a=document.createElement("style");a.textContent=n,a.media=e.media,a.disabled=e.disabled,a.setAttribute("data-href",e.getAttribute("href")),o.insertBefore(a,e),o.removeChild(e),a.media=e.media}};try{r.open("GET",i),r.send(null)}catch(e){"undefined"!=typeof XDomainRequest&&((r=new XDomainRequest).onerror=r.onprogress=function(){},r.onload=n,r.open("GET",i),r.send(null))}e.setAttribute("data-inprogress","")},styleElement:function(e){if(!e.hasAttribute("data-noprefix")){var n=e.disabled;e.textContent=t.fix(e.textContent,!0,e),e.disabled=n}},styleAttribute:function(e){var n=e.getAttribute("style");n=t.fix(n,!1,e),e.setAttribute("style",n)},process:function(){e('link[rel="stylesheet"]:not([data-inprogress])').forEach(StyleFix.link),e("style").forEach(StyleFix.styleElement),e("[style]").forEach(StyleFix.styleAttribute)},register:function(e,n){(t.fixers=t.fixers||[]).splice(void 0===n?t.fixers.length:n,0,e)},fix:function(e,n,i){for(var s=0;s<t.fixers.length;s++)e=t.fixers[s](e,n,i)||e;return e},camelCase:function(e){return e.replace(/-([a-z])/g,(function(e,t){return t.toUpperCase()})).replace("-","")},deCamelCase:function(e){return e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()}))}};setTimeout((function(){e('link[rel="stylesheet"]').forEach(StyleFix.link)}),10),document.addEventListener("DOMContentLoaded",StyleFix.process,!1)}})(),function(e){function t(e,t,i,s,o){if((e=n[e]).length){var r=RegExp(t+"("+e.join("|")+")"+i,"gi");o=o.replace(r,s)}return o}if(window.StyleFix&&window.getComputedStyle){var n=window.PrefixFree={prefixCSS:function(e,i,s){var o=n.prefix;if(n.functions.indexOf("linear-gradient")>-1&&(e=e.replace(/(\s|:|,)(repeating-)?linear-gradient\(\s*(-?\d*\.?\d*)deg/gi,(function(e,t,n,i){return t+(n||"")+"linear-gradient("+(90-i)+"deg"}))),e=t("functions","(\\s|:|,)","\\s*\\(","$1"+o+"$2(",e),e=t("keywords","(\\s|:)","(\\s|;|\\}|$)","$1"+o+"$2$3",e),e=t("properties","(^|\\{|\\s|;)","\\s*:","$1"+o+"$2:",e),n.properties.length){var r=RegExp("\\b("+n.properties.join("|")+")(?!:)","gi");e=t("valueProperties","\\b",":(.+?);",(function(e){return e.replace(r,o+"$1")}),e)}return i&&(e=t("selectors","","\\b",n.prefixSelector,e),e=t("atrules","@","\\b","@"+o+"$1",e)),e=(e=e.replace(RegExp("-"+o,"g"),"-")).replace(/-\*-(?=[a-z]+)/gi,n.prefix)},property:function(e){return(n.properties.indexOf(e)?n.prefix:"")+e},value:function(e,i){return e=t("functions","(^|\\s|,)","\\s*\\(","$1"+n.prefix+"$2(",e),e=t("keywords","(^|\\s)","(\\s|$)","$1"+n.prefix+"$2$3",e)},prefixSelector:function(e){return e.replace(/^:{1,2}/,(function(e){return e+n.prefix}))},prefixProperty:function(e,t){var i=n.prefix+e;return t?StyleFix.camelCase(i):i}};(function(){var e={},t=[],i=getComputedStyle(document.documentElement,null),s=document.createElement("div").style,o=function(n){if("-"===n.charAt(0)){t.push(n);var i=n.split("-"),s=i[1];for(e[s]=++e[s]||1;i.length>3;){i.pop();var o=i.join("-");r(o)&&-1===t.indexOf(o)&&t.push(o)}}},r=function(e){return StyleFix.camelCase(e)in s};if(i.length>0)for(var a=0;a<i.length;a++)o(i[a]);else for(var l in i)o(StyleFix.deCamelCase(l));var c={uses:0};for(var h in e){var d=e[h];c.uses<d&&(c={prefix:h,uses:d})}n.prefix="-"+c.prefix+"-",n.Prefix=StyleFix.camelCase(n.prefix),n.properties=[];for(a=0;a<t.length;a++){if(0===(l=t[a]).indexOf(n.prefix)){var p=l.slice(n.prefix.length);r(p)||n.properties.push(p)}}"Ms"==n.Prefix&&!("transform"in s)&&!("MsTransform"in s)&&"msTransform"in s&&n.properties.push("transform","transform-origin"),n.properties.sort()})(),function(){function e(e,t){return s[t]="",s[t]=e,!!s[t]}var t={"linear-gradient":{property:"backgroundImage",params:"red, teal"},calc:{property:"width",params:"1px + 5%"},element:{property:"backgroundImage",params:"#foo"},"cross-fade":{property:"backgroundImage",params:"url(a.png), url(b.png), 50%"}};t["repeating-linear-gradient"]=t["repeating-radial-gradient"]=t["radial-gradient"]=t["linear-gradient"];var i={initial:"color","zoom-in":"cursor","zoom-out":"cursor",box:"display",flexbox:"display","inline-flexbox":"display",flex:"display","inline-flex":"display"};n.functions=[],n.keywords=[];var s=document.createElement("div").style;for(var o in t){var r=t[o],a=r.property,l=o+"("+r.params+")";!e(l,a)&&e(n.prefix+l,a)&&n.functions.push(o)}for(var c in i){!e(c,a=i[c])&&e(n.prefix+c,a)&&n.keywords.push(c)}}(),function(){function t(e){return o.textContent=e+"{}",!!o.sheet.cssRules.length}var i={":read-only":null,":read-write":null,":any-link":null,"::selection":null},s={keyframes:"name",viewport:null,document:'regexp(".")'};n.selectors=[],n.atrules=[];var o=e.appendChild(document.createElement("style"));for(var r in i){!t(l=r+(i[r]?"("+i[r]+")":""))&&t(n.prefixSelector(l))&&n.selectors.push(r)}for(var a in s){var l;!t("@"+(l=a+" "+(s[a]||"")))&&t("@"+n.prefix+l)&&n.atrules.push(a)}e.removeChild(o)}(),n.valueProperties=["transition","transition-property"],e.className+=" "+n.prefix,StyleFix.register(n.prefixCSS)}}(document.documentElement),Function.prototype.bind=Function.prototype.bind||function(e){var t=[].slice,n=t.call(arguments,1),i=this,s=function(){},o=function(){return i.apply(this instanceof s?this:e||{},n.concat(t.call(arguments)))};return o.prototype=this.prototype,o},Utils={needsReducedLayout:function(){return-1!==document.body.className.indexOf("reduced")},merge:function(e,t){var n={},i=null;for(i in e)n[i]=e[i];for(i in t)n[i]=t[i];return n},addObserverMethodsToClass:function(e){e.prototype.initListeners=function(){void 0===this.listeners&&(this.listeners={})},e.prototype.on=function(e,t){this.initListeners(),this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)},e.prototype.off=function(e,t){this.initListeners(),this.listeners[e]=this.listeners[e].filter((function(e){return e!=t}))},e.prototype.fire=function(e,t){this.initListeners(),t=t||[],(t=Array.isArray(t)?t:[t]).unshift(this),(this.listeners[e]||[]).forEach(function(e){e.apply(this,t)}.bind(this))}},interpolate:function(e,t){var n=e;for(var i in t)n=n.replace(new RegExp("%{"+i+"}","g"),t[i]);return n},createDomNode:function(e,t){var n=document.createElement(e),i=null;if((t||{}).hasOwnProperty("value")&&(i=t.value,delete t.value),null!==i&&n.appendChild(document.createTextNode(i)),void 0!==t)for(var s in t)-1!==s.indexOf("-")?n.setAttribute(s,t[s]):n[s]=t[s];return n}},NodeList.prototype.forEach=Array.prototype.forEach,function(){window.currentPopUp=null;var e=function(e){this.dom=document.createElement("div"),this.dom.className="pop-up",this.content=e};Utils.addObserverMethodsToClass(e),e.notify=function(t,n){n=n||{};var i=new e(t);i.render(),n.sticky||setTimeout((function(){window.currentPopUp===i&&i.close()}),2e3)},e.prototype.setContent=function(e){this.content=e},e.prototype.render=function(e){e=e||{},"string"==typeof this.content&&(this.content=document.createTextNode(this.content)),this.dom.appendChild(this.content),window.currentPopUp&&window.currentPopUp.close(),this.setPosition(e),document.body.appendChild(this.dom),window.currentPopUp=this,t.call(this)},e.prototype.setPosition=function(e){(e=e||{}).left&&(this.dom.style.left=e.left+"px"),e.top&&(this.dom.style.top=e.top+"px")},e.prototype.close=function(){document.body.removeChild(this.dom),window.currentPopUp=null};var t=function(){var e=document.querySelector("table"),t=document.querySelector(".selected, .with-range"),n=this.dom.offsetWidth,i=this.dom.offsetHeight,s=e.offsetLeft,o=s+e.offsetWidth-n,r=e.offsetTop,a=r+e.offsetHeight-i,l={};t&&t.offsetLeft>o&&t.offsetLeft<o+n&&(o=t.offsetLeft-n-10),o<s&&(o=s),this.dom.offsetLeft<s&&(l.left=s),this.dom.offsetLeft>o&&(l.left=o),this.dom.offsetTop<r&&(l.top=r),this.dom.offsetTop>a&&(l.top=a),(l.top||l.left)&&this.setPosition(l)};window.PopUp=e}(),function(){var e=function(e){this.game=e};e.prototype.init=function(){i.call(this),s.call(this),t.call(this)};var t=function(){this.game.on("rendered",function(){p.call(this)}.bind(this))},n=function(e){e.on("spawned",function(){13!==e.round&&p.call(this,e)}.bind(this)),e.on("monster:spawned",function(e,t){var n=null;this.game.player.on("killed",(function(){clearInterval(n)})),this.game.player.on("won",(function(){clearInterval(n)})),t.on("killed",function(){clearInterval(n),this.game.player.earn(t.options.revenue),this.game.player.recordStat("killedMonsters",1)}.bind(this)),t.on("goal:reached",function(){this.game.player.hurt()}.bind(this)),t.on("move",function(){n&&clearInterval(n),n=setInterval(function(){this.game.player.isDead()?clearInterval(n):this.game.towers.forEach((function(e){e.checkDistanceTo(t)}))}.bind(this),100)}.bind(this))}.bind(this)),this.game.player.on("killed",function(){e.stop()}.bind(this)),this.game.player.on("won",function(){e.stop()}.bind(this));var t=function(){-1===(document.getElementById("wave-duration").className||"").indexOf("disabled")&&e.forceSpawn()};this.game.on("wave:spawn",t),e.on("spawned",function(){this.game.off("wave:spawn",t)}.bind(this)),e.on("timer:disabled",function(){this.game.disableForcedSpawn()}.bind(this)),e.on("timer:enabled",function(){this.game.enableForcedSpawn()}.bind(this)),13===e.round&&e.on("cleared",function(){this.game.player.fire("won")}.bind(this))},i=function(){this.game.player.on("killed",function(){a.call(this,"Oh my gosh, you died!")}.bind(this)),this.game.player.on("won",function(){a.call(this,"Woot woot! You've won the match!")}.bind(this))},s=function(){this.game.grid.cells.forEach(function(e){e.forEach(function(e){e.on("click",function(){switch(c.call(this),e.type){case GridCell.TYPES.INACCESSABLE:o.call(this,e);break;case GridCell.TYPES.TOWER:r.call(this,e)}}.bind(this))}.bind(this))}.bind(this))},o=function(e){d.call(this,e),l.call(this)},r=function(e){l.call(this);var t=this.game.getTowerByGridCell(e),n=new TowerMetaMenu(t,this.game.player);t.renderRange(),n.render(),n.on("tower:sold",function(e,t){l.call(this),this.game.towers=this.game.towers.filter((function(e){return e!==t})),h()}.bind(this))},a=function(e){var t=Utils.createDomNode("ul",{className:"game-over"});t.appendChild(Utils.createDomNode("li",{value:e})),t.appendChild(Utils.createDomNode("li")),t.appendChild(Utils.createDomNode("li",{value:"Spent money: "+this.game.player.stats.spentMoney+"$"})),t.appendChild(Utils.createDomNode("li",{value:"Earned money: "+this.game.player.stats.earnedMoney+"$"})),t.appendChild(Utils.createDomNode("li",{value:"Killed monsters: "+this.game.player.stats.killedMonsters})),t.appendChild(Utils.createDomNode("li",{value:"Upgraded towers: "+this.game.player.stats.upgradedTowers}));var n=Utils.createDomNode("li");n.appendChild(Utils.createDomNode("a",{value:"Restart the game!",href:"#",onclick:function(){window.location.reload()}})),t.appendChild(n),PopUp.notify(t,{sticky:!0})},l=function(){this.game.towers.forEach((function(e){e.removeRange()}))},c=function(){var e=document.querySelector(".selected");e&&(e.className=e.className.split(" ").filter((function(e){return"selected"!=e})))},h=function(){window.currentPopUp&&window.currentPopUp.close()},d=function(e){h(),e.hasClassName("tower")||new TowerMenu(e).render().on("select",function(t,n){if(this.game.player.canBuy(n)){var i=new Tower(n,e).render();i.on("upgraded",function(){this.game.player.recordStat("upgradedTowers",1)}.bind(this)),this.game.player.buy(n),this.game.towers.push(i),e.fire("click")}else PopUp.notify("Too expensive!")}.bind(this))},p=function(e){var t=1;void 0!==e&&(t=e.round+1),n.call(this,new Wave(t,this.game.grid.path).spawn(13))};window.EventManager=e}(),function(){var e=function(e,t,n){this.rows=e,this.cols=t,this.canvas=n,this.container=document.createElement("table"),this.path=[],this.cells=[]};e.prototype.render=function(){t.call(this),this.path=n.call(this),this.path.forEach((function(e){e.setType(GridCell.TYPES.PATH)}))};var t=function(){for(var e=0;e<this.rows;e++){for(var t=document.createElement("tr"),n=[],i=0;i<this.cols;i++){var s=new GridCell(this);n.push(s),t.appendChild(s.getElement())}this.container.appendChild(t),this.cells.push(n)}this.canvas.appendChild(this.container)},n=function(){var e=i.call(this),t=[],n=this;return e.forEach((function(e,i){e.forEach((function(e){var o=s.call(n,i,e);t.push(o)}))})),t},i=function(){for(var e=[],t=null,n=0;n<this.cols;n++){var i=[],s=null!==t?t:~~(Math.random()*this.rows),o=~~(Math.random()*this.rows);if(n%2==0)i.push(s),t=s;else{if(s===o)i.push(s);else{for(var r=s;r!==o;s>o?r--:r++)i.push(r);i.push(r)}t=o}e.push(i)}return e},s=function(e,t){return this.container.querySelectorAll("tr")[t].querySelectorAll("td")[e].cell};window.Grid=e}(),function(){var e=function(t,n){var i=this;this.grid=t,this.type=e.TYPES.INACCESSABLE,this.dom=document.createElement("td"),this.dom.cell=this,this.dom.onclick=function(){i.fire("click")},this.setType(this.type)};Utils.addObserverMethodsToClass(e),e.TYPES={INACCESSABLE:"inaccessable",ACCESSABLE:"accessable",PATH:"path",MONSTER:"monster",TOWER:"tower"},e.prototype.getElement=function(){return this.dom},e.prototype.setType=function(e,t){this.type=e,this.dom.className=[this.type].concat(t||[]).join(" ")},e.prototype.addClassName=function(e){this.dom.className=this.dom.className.split(" ").concat([e]).join(" ")},e.prototype.removeClassName=function(e){this.dom.className=this.dom.className.split(" ").filter((function(t){return e!==t})).join(" ")},e.prototype.hasClassName=function(e){return-1!==this.dom.className.split(" ").indexOf(e)},e.prototype.getCoordinates=function(){var e=this.coordinates,t=this;return e||this.grid.cells.forEach((function(n,i){n.forEach((function(n,s){t===n&&(e=this.coordinates={x:i,y:s})}))})),e},window.GridCell=e}(),function(){var e=function(e,t){this.type=t,this.options=this.getStats(),this.health=this.options.health,this.path=e,this.pathIndex=0,this.cell=null,this.intervalId=null,this.hasTriggeredKilledEvent=!1};Utils.addObserverMethodsToClass(e),e.TYPES=[{name:"beast",health:20,count:10,speed:500,revenue:40},{name:"scout-lite",health:30,count:50,speed:400,revenue:100},{name:"amphibian-lite",health:90,count:20,speed:300,revenue:100},{name:"scout-mid",health:70,count:50,speed:300,revenue:60},{name:"mech-lite",health:500,count:30,speed:500,revenue:200},{name:"mech-mid",health:1e3,count:25,speed:600,revenue:300},{name:"mech-heavy",health:1500,count:20,speed:800,revenue:400},{name:"scout-heavy",health:100,count:100,speed:200,revenue:150},{name:"tank-lite",health:5e3,count:30,speed:400,revenue:1e3},{name:"tank-lite-2",health:1e4,count:20,speed:400,revenue:1500},{name:"tank-mid",health:15e3,count:10,speed:350,revenue:2e3},{name:"tank-laser",health:2e4,count:10,speed:500,revenue:2e3},{name:"tank-heavy",health:3e4,count:5,speed:600,revenue:5e3}],e.prototype.getStats=function(){return e.TYPES.filter(function(e){return this.type===e.name}.bind(this))[0]},e.prototype.stop=function(){clearInterval(this.intervalId)},e.prototype.move=function(){n.call(this,this.path[this.pathIndex]),this.pathIndex++,this.cell?this.fire("move"):this.fire("goal:reached")},e.prototype.getPosition=function(){return this.cell&&this.cell.getCoordinates()},e.prototype.hurt=function(e){this.health-=e,this.health<=0&&this.die()},e.prototype.die=function(){this.hasTriggeredKilledEvent||(this.stop(),this.cell.setType(GridCell.TYPES.PATH),this.fire("killed"),this.hasTriggeredKilledEvent=!0)},e.prototype.isDead=function(){return this.health<=0};var t=function(){return e.TYPES.filter(function(e){return this.type===e.name}.bind(this))[0].name},n=function(e){this.cell&&this.cell.setType(GridCell.TYPES.PATH),e&&e.setType(GridCell.TYPES.MONSTER,[t.call(this)]),this.cell=e};window.Monster=e}(),function(){var e=function(e,t){this.life=13,this.cash=1e3,this.dom=t,this.canvas=document.querySelectorAll(e)[0],this.stats={spentMoney:0,earnedMoney:0,killedMonsters:0,upgradedTowers:0}};Utils.addObserverMethodsToClass(e),e.prototype.isDead=function(){return 0===this.life},e.prototype.render=function(){null===this.dom.parentNode&&this.canvas.appendChild(this.dom),t.call(this),n.call(this)},e.prototype.recordStat=function(e,t){this.stats[e]+=t},e.prototype.canBuy=function(e,t){return t=void 0===t?0:t,this.cash>=window.Tower.TYPES[e].costs[t]},e.prototype.buy=function(e,t){t=void 0===t?0:t;var n=window.Tower.TYPES[e].costs[t];this.cash-=n,this.recordStat("spentMoney",n),this.render()},e.prototype.earn=function(e){this.cash+=e,this.recordStat("earnedMoney",e),this.render()},e.prototype.sell=function(e){this.earn(e.getPrice()/2)},e.prototype.hurt=function(){this.life--,this.render(),0===this.life&&this.fire("killed")},e.prototype.heal=function(){this.life++,this.render()};var t=function(){var e=document.getElementById("life");e||((e=document.createElement("span")).id="life",this.dom.appendChild(e)),e.innerHTML="HP: "+this.life.toString()+"|13"},n=function(){var e=document.getElementById("cash"),t=Utils.needsReducedLayout()?"$%{cash}":"Cash: %{cash}$";e||((e=document.createElement("span")).id="cash",this.dom.appendChild(e)),e.innerHTML=Utils.interpolate(t,{cash:this.cash})};window.Player=e}(),function(){var e=function(e,t){this.type=e,this.level=0,this.cell=t,this.lastShot=null,this.range=null};Utils.addObserverMethodsToClass(e),e.TYPES={TURRET:{name:"Turret",explosion:"small",explosionOffset:-6,costs:[50,100,200],damages:[3,5,7],ranges:[1,1.5,2],frequencies:[300,225,150]},ROCKET:{name:"Rocket Tower",explosion:"mid",explosionOffset:-12,costs:[200,400,600],damages:[200,300,400],ranges:[5,7,9],frequencies:[3e3,2e3,1e3]},ULTRA:{name:"Ultra Tower",explosion:"big",explosionOffset:-20,costs:[5e3,7500,1e4],damages:[99999,99999,99999],ranges:[3,8,13],frequencies:[1e4,7500,5e3]}},e.prototype.getStats=function(){var e={damage:this.getDamage(),range:this.getRange(),frequency:this.getFrequency()/1e3};return e.damagePerSecond=Math.ceil(1/e.frequency*(1/e.frequency)*e.damage),e},e.prototype.upgrade=function(){this.level++,this.cell.setType(GridCell.TYPES.TOWER,n.call(this)),this.fire("upgraded")},e.prototype.render=function(){return this.cell.setType(GridCell.TYPES.TOWER,n.call(this)),this},e.prototype.getPrice=function(){return e.TYPES[this.type].costs[this.level]},e.prototype.getRange=function(){return e.TYPES[this.type].ranges[this.level]},e.prototype.getFrequency=function(){return e.TYPES[this.type].frequencies[this.level]},e.prototype.getDamage=function(){return e.TYPES[this.type].damages[this.level]},e.prototype.getExplosion=function(){return e.TYPES[this.type].explosion},e.prototype.getExplosionOffset=function(){return e.TYPES[this.type].explosionOffset},e.prototype.checkDistanceTo=function(e){var t=e.cell&&e.cell.dom;t&&(this.pointIsInRange({x:t.offsetLeft+t.offsetWidth/2,y:t.offsetTop+t.offsetHeight/2})&&this.canShoot()&&(this.shoot(e),this.lastShot=+new Date))},e.prototype.pointIsInRange=function(e){var n=this.getRange()*this.cell.dom.offsetHeight,i=t.call(this).x,s=t.call(this).y;return Math.abs(i-e.x)<n&&Math.abs(s-e.y)<n&&Math.pow(i-e.x,2)+Math.pow(s-e.y,2)<=n*n},e.prototype.canShoot=function(){return!this.lastShot||+new Date-this.lastShot>=this.getFrequency()},e.prototype.shoot=function(e){var t=document.createElement("div"),n=Utils.createDomNode("div",{className:"explosion "+this.getExplosion()}),i=document.body;e.cell.dom.offsetLeft,e.cell.dom.offsetTop;t.className="bullet "+this.type,t.style.left=this.cell.dom.offsetLeft+this.cell.dom.offsetWidth/2+"px",t.style.top=this.cell.dom.offsetTop+this.cell.dom.offsetHeight/2+"px",i.appendChild(t),setTimeout(function(){t.style.left=e.cell.dom.offsetLeft+e.cell.dom.offsetWidth/2+"px",t.style.top=e.cell.dom.offsetTop+e.cell.dom.offsetHeight/2+"px"}.bind(this),10),setTimeout(function(){i.removeChild(t),e.hurt(this.getDamage()),n.style.left=parseInt(t.style.left,10)+this.getExplosionOffset()+"px",n.style.top=parseInt(t.style.top,10)+this.getExplosionOffset()+"px",i.appendChild(n),setTimeout((function(){i.removeChild(n)}),"ultra"===this.type?1e3:400)}.bind(this),240)},e.prototype.renderRange=function(){var e=document.createElement("div"),n=this.cell.dom;n.offsetHeight;e.className="range",e.style.width=e.style.height=2*this.getRange()*n.offsetHeight+"px";var i=t.call(this).x-parseInt(e.style.width,10)/2-2,s=t.call(this).y-parseInt(e.style.height,10)/2-2;e.style.left=i+"px",e.style.top=s+"px",this.range=e,this.range.onclick=function(){this.removeRange(),this.cell.removeClassName("with-range"),window.currentPopUp&&window.currentPopUp.close()}.bind(this),document.body.appendChild(e),this.cell.addClassName("with-range")},e.prototype.removeRange=function(){var e=document.body;this.range&&e.removeChild(this.range),this.range=null},e.prototype.destroy=function(){n.call(this).forEach(function(e){this.cell.removeClassName(e)}.bind(this))};var t=function(){return{x:this.cell.dom.offsetLeft+this.cell.dom.offsetWidth/2,y:this.cell.dom.offsetTop+this.cell.dom.offsetHeight/2}},n=function(){return[this.type.toLowerCase().replace(/ /,"-"),"level-"+(this.level+1)]};window.Tower=e}(),function(){var e=function(e){this.cell=e,this.popUp=new PopUp};Utils.addObserverMethodsToClass(e),e.prototype.render=function(){document.getElementById("tower-menu");var e=this.cell.dom.offsetLeft+40,n=this.cell.dom.offsetTop-30;return this.cell.addClassName("selected"),this.popUp.setContent(t.call(this)),this.popUp.render({left:e,top:n}),this},e.prototype.remove=function(){this.popUp.close(),this.cell.removeClassName("selected")};var t=function(){var e=Utils.createDomNode("ul",{id:"tower-menu",className:"menu"});for(var t in Tower.TYPES)n.call(this,t,e);return e},n=function(e,t){var n=this,i=Tower.TYPES[e],s=Utils.needsReducedLayout()?"%{costs}$":"%{name} (%{costs}$)",o=Utils.interpolate(s,{name:i.name,costs:i.costs[0]});t.appendChild(Utils.createDomNode("li",{value:o,"data-tower-type":e,className:e.toLowerCase(),onclick:function(){n.fire("select",this.getAttribute("data-tower-type"))}}))};window.TowerMenu=e}(),function(){var e=function(e,t){this.tower=e,this.player=t,this.popUp=new PopUp};Utils.addObserverMethodsToClass(e),e.prototype.render=function(){var e=document.createElement("ul"),s=this.tower.cell.dom.offsetLeft+40,o=this.tower.cell.dom.offsetTop-30;e.className="menu",e.appendChild(t.call(this)),e.appendChild(i.call(this)),e.appendChild(n.call(this)),this.popUp.setContent(e),this.popUp.render({left:s,top:o})},e.prototype.clear=function(){this.popUp.close()};var t=function(){var t=document.createElement("li"),n=this.tower.level+1,i=Tower.TYPES[this.tower.type].costs[n],s=Utils.needsReducedLayout()?"Level %{level}: %{costs}$":"Upgrade to Level %{level} (%{costs}$)";return 3===n?(s=Utils.needsReducedLayout()?"Level %{level}: reached":"Max level %{level} reached",s=Utils.interpolate(s,{level:n,costs:i})):t.onclick=function(){this.player.canBuy(this.tower.type,n)?(this.player.buy(this.tower.type,n),this.tower.upgrade(),this.tower.removeRange(),this.tower.renderRange(),this.clear(),new e(this.tower,this.player).render()):(this.tower.removeRange(),PopUp.notify("Too expensive!")),s=Utils.interpolate(s,{level:n+1,costs:i})}.bind(this),t.appendChild(document.createTextNode(Utils.interpolate(s,{level:n+1,costs:i}))),t.className="upgrade",t},n=function(){for(var e=["%{range}","%{damage} (%{damagePerSecond}dmg/s)","1 shot/%{frequency}s"],t=this.tower.getStats(),n=document.createElement("li"),i=document.createElement("ul"),s=0,o=e.length;s<o;++s){var r=document.createElement("li");r.innerHTML=Utils.interpolate(e[s],t),r.className="stats-"+e[s].match(/%\{(.*?)\}/)[1],i.appendChild(r)}return n.appendChild(i),n.className="nested",n},i=function(){var e=document.createElement("li"),t=this.tower.level,n=Tower.TYPES[this.tower.type].costs[t]/2,i=Utils.interpolate("Sell: %{costs}$",{costs:n});return e.appendChild(document.createTextNode(i)),e.onclick=function(){this.player.sell(this.tower),this.tower.cell.setType(GridCell.TYPES.INACCESSABLE),this.tower.destroy(),this.fire("tower:sold",this.tower)}.bind(this),e.className="sell",e};window.TowerMetaMenu=e}(),function(){var e=function(e,t){this.round=e,this.path=t,this.speed=Monster.TYPES[this.round-1].speed,this.monstersToSpawn=Monster.TYPES[this.round-1].count,this.spawnedMonsters=0,this.monsters=[],this.meta=document.getElementById("meta-data"),this.moveIntervalId=null,this.updateTimerIntervalId=null,this.spawnTimeoutId=null,this.spawnTimeoutIds=[]};Utils.addObserverMethodsToClass(e),e.prototype.spawn=function(e){return n.call(this,e),this.spawnTimeoutId=setTimeout(function(){r.call(this)}.bind(this),1e3*e),this},e.prototype.stop=function(){this.spawnTimeoutIds.forEach((function(e){clearTimeout(e)})),clearInterval(this.moveIntervalId),clearInterval(this.spawnTimeoutId),clearInterval(this.updateTimerIntervalId)},e.prototype.forceSpawn=function(){clearTimeout(this.spawnTimeoutId),clearInterval(this.updateTimerIntervalId),s.call(this,0),r.call(this)};var t=function(){this.monsters.forEach((function(e){e.move()}))},n=function(e){var t=+new Date;this.updateTimerIntervalId=setInterval(function(){var n=+new Date,i=Math.ceil(Math.abs(t-n)/1e3);i>e?clearInterval(this.updateTimerIntervalId):s.call(this,e-i)}.bind(this),100)},i=function(){var e=document.getElementById("wave-duration");return e||((e=document.createElement("span")).id="wave-duration",this.meta.appendChild(e)),e},s=function(e){var t=i.call(this),n=Utils.needsReducedLayout()?"#%{wave}: %{seconds}s":"Wave #%{wave} starts in %{seconds}s";0===e?(o.call(this,"disabled"),this.fire("timer:disabled")):(o.call(this,""),this.fire("timer:enabled")),t.innerHTML=Utils.interpolate(n,{wave:this.round,seconds:e})},o=function(e){e=Array.isArray(e)?e:[e],i.call(this).className=e.join(" ")},r=function(){for(var e=0,n=this.monstersToSpawn;e<n;e++)this.spawnTimeoutIds.push(setTimeout(a.bind(this),this.speed*e));this.on("monster:spawned",t.bind(this)),this.on("spawned",function(){this.moveIntervalId=setInterval(t.bind(this),this.speed)}.bind(this))},a=function(){var e=new Monster(this.path,Monster.TYPES[this.round-1].name),t=function(){this.monsters=this.monsters.filter((function(t){return t!==e})),0===this.monsters.length&&this.spawnedMonsters===this.monstersToSpawn&&this.fire("cleared")};e.on("killed",t.bind(this)),e.on("goal:reached",t.bind(this)),this.monsters.push(e),this.fire("monster:spawned",[e]),this.spawnedMonsters=this.spawnedMonsters+1,this.spawnedMonsters===this.monstersToSpawn&&this.fire("spawned")};window.Wave=e}(),function(){var e=function(e,t){this.options=Utils.merge({rows:10,cols:10},t||{}),this.canvas=document.querySelector(e),this.meta=Utils.createDomNode("div",{id:"meta-data"}),this.grid=new Grid(this.options.rows,this.options.cols,this.canvas),this.player=new Player(e,this.meta),this.eventManager=new EventManager(this),this.towers=[]};Utils.addObserverMethodsToClass(e),e.prototype.render=function(e){return this.grid.render(),this.player.render(),document.body.appendChild(this.meta),n.call(this),this.eventManager.init(),this.fire("rendered"),this},e.prototype.getTowerByGridCell=function(e){var t=this.towers.filter((function(t){return t.cell===e}));return 1===t.length?t[0]:null},e.prototype.disableForcedSpawn=function(){t.call(this).className="disabled"},e.prototype.enableForcedSpawn=function(){t.call(this).className=""};var t=function(){var e=document.getElementById("force-next-wave");return e||(e=this.meta.appendChild(Utils.createDomNode("span",{id:"force-next-wave"}))),e},n=function(){var e=t.call(this),n=Utils.needsReducedLayout()?"Next wave":"Force next wave";e.innerHTML=n,e.onclick=function(){this.fire("wave:spawn")}.bind(this)};window.Game=e}();var readyStateCheckInterval=setInterval((function(){if("complete"===document.readyState){clearInterval(readyStateCheckInterval);var e=window,t=document,n=t.documentElement,i=t.getElementsByTagName("body")[0],s=~~(((e.innerWidth||n.clientWidth||i.clientWidth)-8-2)/24),o=~~(((e.innerHeight||n.clientHeight||i.clientHeight)-24-8-2)/28);s<20&&(document.body.className=document.body.className.split(" ").concat(["reduced"]).join(" ")),game=new Game("body",{cols:s,rows:o}).render(),document.getElementById("meta-data").style.width=document.querySelector("table").offsetWidth-10+"px"}}),10)</script>