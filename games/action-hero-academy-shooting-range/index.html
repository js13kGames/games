<!doctype html><title>Action Hero Academy Shooting Range</title><script src=/2019/webxr/aframe.js></script><body><a-scene><a-entity position="0 1.6 0" camera look-controls=reverseMouseDrag:true><a-box color=black scale="1 .5 .1" position="0 -3 0" id=mask></a-box></a-entity><a-entity id=world rotation="0 0 0"><a-entity id=left-hand laser-controls="hand: left" oculus-touch-controls="hand: left" raycaster=objects:.target><a-text align=center color=#fff position="-.01 -.005 -.06" value=Grab rotation="-125 0 0" width=1 class=tutorial-grab></a-text><a-text align=center color=#fff position="-.01 .02 -.02" value=Drop rotation="-125 0 0" width=1 class=tutorial-drop opacity=.5></a-text><a-text align=center color=#fff position="-.01 -.12 -.07" value=Shoot rotation="0 -90 40 " width=1 class=tutorial-shoot opacity=.5></a-text></a-entity><a-entity id=right-hand laser-controls="hand: right" oculus-touch-controls="hand: right" raycaster=objects:.target><a-text align=center color=#fff position="-.01 -.005 -.06" value=Grab rotation="-125 0 0" width=1 class=tutorial-grab></a-text><a-text align=center color=#fff position="-.01 .02 -.02" value=Drop rotation="-125 0 0" width=1 class=tutorial-drop opacity=.5></a-text><a-text align=center color=#fff position="-.01 -.12 -.07" value=Shoot rotation="0 -90 40 " width=1 class=tutorial-shoot opacity=.5></a-text></a-entity><a-plane color=#2D3748 height=10 position="0 0 1" rotation="-90 0 0" width=10></a-plane><a-plane color=#2D3748 height=10 position="0 3 1" rotation="90 0 0" width=10></a-plane><a-plane color=#2D3748 height=3 position=" 0 1.5 -4  " rotation="0   0 0" width=10></a-plane><a-plane color=#2D3748 height=3 position=" 5 1.5  1  " rotation="0 -90 0" width=10></a-plane><a-plane color=#2D3748 height=3 position=" 0 1.5  6  " rotation="0 180 0" width=10></a-plane><a-text align=center color=#718096 position=" 0 1.5  5.9" value="" rotation="0 180 0" width=10 id=wall-hint height=3 wrapcount=20></a-text><a-plane color=#2D3748 height=3 position="-5 1.5  1" rotation="0  90 0" width=10></a-plane><a-box color=#2D3748 scale="10 1 .1" position="0 .5 .5"></a-box><a-box color=#2D3748 scale=".1 3 3.1" position=" 1.5 1.5 -1"></a-box><a-entity id=tutorial-btn visible><a-box color=#000 scale=".2 .5 1" position="1.5 1.5 -1" id=tutorial-box class="spin-control target" data-rotation=0></a-box><a-text align=center color=#777 position="1.4 1.5 -1" value=Tutorial rotation="0 -90 0"></a-text></a-entity><a-box color=#2D3748 scale=".1 3 3.1" position="-1.5 1.5 -1"></a-box><a-entity id=high-poster visible><a-box color=#fff scale=".12 1.5 1" position="-1.5 1.5 -1.5"></a-box><a-text align=center color=#000 position="-1.44 1.9 -1.5" value="Action Hero\nof the Month:\nYOU" rotation="0 90 0" width=3></a-text><a-text align=center color=#000 position="-1.44 1.4 -1.5" value=0 rotation="0 90 0" width=10 id=high-score></a-text></a-entity><a-entity position="   0 1.60     0" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-entity position="   0 2.95 -1.25" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-entity position=" 1.5 2.95  4.50" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-entity position="-1.5 2.95  4.50" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-entity position=" 1.5 2.95  1.50" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-entity position="-1.5 2.95  1.50" light="type: point; intensity: 0.2; decay: 1"></a-entity><a-box color=#000 scale="1 1 .2" position="0 1.5 -4"></a-box><a-cylinder class="spin-control target" color=#fff data-rotation=180 id=start-btn rotation="90 0 0" scale=".4 .5 .4" position="0 1.5 -4"></a-cylinder><a-text align=center color=#000 position="0 1.5 -3.7" value=ON></a-text><a-box color=#000 scale="1.8 .3 .8" position="0 0 0" id=reset-btn class="spin-control target" data-rotation=0></a-box><a-text align=center color=#fff position="0 .2 0" value=OFF rotation="-90 180 0"></a-text><a-entity position="0 5 3" id=victory-mount><a-box color=#000 scale="1 1 .2"></a-box><a-cylinder class="spin-control target" color=#fff data-rotation=0 id=victory-btn rotation="90 0 0" scale=".4 .5 .4"></a-cylinder><a-text align=center color=#000 position="0 0 -.3" value=WIN rotation="0 180 0"></a-text></a-entity><a-entity id=range></a-entity><a-box color=#744210 scale="1.5 .05 1.5" position="0 .95 -1.25" rotation="0 0 0"></a-box><a-text align=center color=#fff position="0 1 -1.25" value="something's\ngone\nwrong" rotation="-90 0 0" width=1.4 id=table-text height=1.5></a-text><a-text align=center color=#fff position="0 2.5 -3" value=Hello! id=log visible></a-text></a-entity></a-scene><script>const context=new(window.AudioContext||window.webkitAudioContext);var VOICE_COUNT=10;function WhiteNoiseScript(){this.node=context.createScriptProcessor(1024,1,2),this.node.onaudioprocess=this.process}function WhiteNoiseGenerated(t){for(var e=5*context.sampleRate,o=context.createBuffer(1,e,context.sampleRate),n=o.getChannelData(0),i=0;i<e;i++)n[i]=2*Math.random()-1;this.node=context.createBufferSource(),this.node.buffer=o,this.node.loop=!0,this.node[this.node.start?"start":"noteOn"](0)}function Envelope(){this.node=context.createGain(),this.node.gain.value=0}function ProceduralSample(){this.voices=[],this.voiceIndex=0,this.noise=new WhiteNoiseGenerated,this.onLoaded()}WhiteNoiseScript.prototype.process=function(t){for(var e=t.outputBuffer.getChannelData(0),o=t.outputBuffer.getChannelData(1),n=0;n<e.length;n++)e[n]=2*Math.random()-1,o[n]=e[n]},WhiteNoiseScript.prototype.connect=function(t){this.node.connect(t)},WhiteNoiseGenerated.prototype.connect=function(t){this.node.connect(t)},Envelope.prototype.addEventToQueue=function(){this.node.gain.linearRampToValueAtTime(0,context.currentTime),this.node.gain.linearRampToValueAtTime(1,context.currentTime+.001),this.node.gain.linearRampToValueAtTime(.3,context.currentTime+.101),this.node.gain.linearRampToValueAtTime(0,context.currentTime+.5)},Envelope.prototype.connect=function(t){this.node.connect(t)},ProceduralSample.prototype.shoot=function(){this.voiceIndex=(this.voiceIndex+1)%VOICE_COUNT,this.voices[this.voiceIndex].addEventToQueue()},ProceduralSample.prototype.onLoaded=function(){var t=context.createBiquadFilter();t.type=0,t.Q.value=1,t.frequency.value=800;for(var e=0;e<VOICE_COUNT;e++){var o=new Envelope;this.noise.connect(o.node),o.connect(t),this.voices.push(o)}var n=context.createGain();n.gain.value=5,t.connect(n),n.connect(context.destination)};const GameContainer=function(){const t=document.querySelector("a-scene"),e=document.getElementById("range"),o=document.getElementById("wall-hint"),n=document.getElementById("world");let i=[];const a=new ProceduralSample,r=document.getElementById("log");function s(t){r.setAttribute("value",t)}function l(){document.getElementById("tutorial-btn").setAttribute("visible",!0)}let c=0;function u(){c=localStorage.getItem("endless-highscore"),document.getElementById("high-score").setAttribute("value",c),document.getElementById("high-poster").setAttribute("visible",!0)}let d=0;function h(e){s(e);var o=Array.from(arguments).slice(1);if(0===o.length)t.dispatchEvent(new Event(e));else{var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,o),t.dispatchEvent(n)}}function m(e,o){t.addEventListener(e,(function(t){o.apply(null,t.detail)}),!1)}function p(t){for(let e in t)document.getElementById(e).setAttribute("value",t[e])}function b(t){const e=t===1/0?ENDLESS_MODE:f[t];p(e.text),e.onload()}function g(){for(let t of U)t&&t.parentNode&&t.parentNode.removeChild(t);U=[]}localStorage.getItem("endless-unlocked")&&(d=1/0,l(),u()),m("level-start",(function(){try{if(O.object3D.position.y=j,B=j,P=j,d===1/0){for(let t=0;t<5;t++)T({});q=S+0,D=S+0,ENDLESS_MODE.onstart(),s(q)}else f[d].onstart()}catch(t){s(t)}})),m("level-reset",(function(){d<1/0&&(document.getElementById("high-poster").setAttribute("visible",!1),document.getElementById("tutorial-btn").setAttribute("visible",!1)),g();for(let t of i)n.removeChild(t);i=[],v={},d>0&&F("red",-.5),d>1&&F("blue",.5),d>2&&F("yellow"),b(d)})),m("level-end",(function(){d+=1,d===1/0?(ENDLESS_MODE.onend(R),R>=c&&localStorage.setItem("endless-highscore",R),R=0,u(),M=0,setTimeout((t=>{n.object3D.rotation.y=0}),500)):d===f.length?(d=1/0,localStorage.setItem("endless-unlocked","booya"),l(),b(d)):d<1/0&&b(d)})),m("target-destroyed",(function(){R+=1,d<1/0&&0===e.querySelectorAll(".target").length&&(P=1.6)}));const f=[];let v={};function y(t){function e(t){try{const e=function(t,e){try{const n=t.object3D.getWorldPosition();function o(t){return"true"===t.dataset.held?(s("held "+t.id),1/0):t.object3D.getWorldPosition().distanceTo(n)}let i=e[0],a=o(e[0]);for(let r=1;r<e.length;r++){const l=o(e[r]);l<a&&(i=e[r],a=l)}return a>1/4?null:i}catch(c){s(c)}}(t,i);if(null===e)return;e.object3D.matrix.copy(new THREE.Matrix4),e.object3D.matrix.decompose(e.object3D.position,e.object3D.quaternion,e.object3D.scale),t.object3D.add(e.object3D),e.dataset.held=!0,v[t.id]=e,t.setAttribute("line","opacity:1;color:"+e.getAttribute("color"))}catch(t){s(t)}}function o(t){try{const e=v[t.id],o=e.object3D;o.matrix.premultiply(t.object3D.matrixWorld),o.matrix.premultiply(n.object3D.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale),n.object3D.add(o),v[t.id]=null,e.dataset.held=!1,t.setAttribute("line","opacity:0;color:purple")}catch(t){s(t)}}function r(t){v[t.id]?o(t):e(t)}!function(t){const e=t.querySelector(".tutorial-shoot").cloneNode();e.setAttribute("rotation","0 90 -40"),t.appendChild(e);let o=t.querySelector(".tutorial-grab"),n=t.querySelector(".tutorial-drop"),i=t.querySelectorAll(".tutorial-shoot"),a=!1;function r(){try{i.forEach((e=>e.setAttribute("opacity",v[t.id]?.5:1))),o?(t.removeChild(o),o=!1,n.setAttribute("opacity",1)):n?(t.removeChild(n),n=null,a&&t.removeEventListener(this,r)):a&&t.removeEventListener(this,r)}catch(t){s(t)}}t.addEventListener("abuttondown",r.bind("abuttondown"),{passive:!0}),t.addEventListener("xbuttondown",r.bind("xbuttondown"),{passive:!0}),t.addEventListener("triggerdown",(function e(){v[t.id]&&(i.forEach((e=>t.removeChild(e))),t.removeEventListener("triggerdown",e),a=!0)}),{passive:!0})}(t),t.addEventListener("abuttondown",(e=>r(t)),{passive:!0}),t.addEventListener("xbuttondown",(e=>r(t)),{passive:!0}),t.addEventListener("gripdown",(o=>e(t)),{passive:!0}),t.addEventListener("gripup",(e=>o(t)),{passive:!0}),t.addEventListener("triggerdown",(e=>function(t){v[t.id]&&a.shoot()}(t)),{passive:!0})}const E=["black","blue","yellow","green","red","purple","orange","white"];function x(t){return E.indexOf(t)}function w(t,e){const o=x(t),n=x(e);return E[(o|n)^n]}function A(t){if("tutorial-box"===t.id)t.addEventListener("mousedown",(()=>{d=0,h("level-reset"),s("tutorial")}),{passive:!0});else if(t.classList.contains("spin-control"))t.addEventListener("mousedown",(()=>{("start-btn"!==t.id||v[event.detail.cursorEl.id])&&(M=t.dataset.rotation/360*2*Math.PI,setTimeout((e=>{n.object3D.rotation.y=t.dataset.rotation/360*2*Math.PI}),500)),"start-btn"===t.id&&v[event.detail.cursorEl.id]?h("level-start"):"reset-btn"===t.id?h("level-reset"):"victory-btn"===t.id&&h("level-end")}),{passive:!0});else{if(void 0===t.getAttribute("color"))return;t.addEventListener("mousedown",(e=>{const o=w(t.getAttribute("color"),v[e.detail.cursorEl.id].getAttribute("color"));"black"===o?(t.parentNode.removeChild(t),h("target-destroyed")):t.setAttribute("color",o)}),{passive:!0})}}function T(t){const o=document.createElement("a-cylinder");if(o.className="target",void 0===t.color){const e=Math.floor(Math.random()*(E.length-1))+1;t.color=E[e]}if(o.setAttribute("color",t.color),o.setAttribute("scale",".25 .05 .25"),void 0===t.position){const t=6*Math.random()-3,e=Math.random()+1.5,n=3*Math.random()+2;o.setAttribute("position",t+" "+e+" "+n)}else o.setAttribute("position",t.position);return o.setAttribute("rotation","90 0 0"),A(o),U.push(o),e.appendChild(o),o}function C(){N.object3D.position.y=.5*Math.abs(Math.cos(k)),N.object3D.position.z=-.5*Math.abs(Math.sin(k))+.2,N.object3D.rotation.x=Math.abs(Math.cos(k))*Math.PI/2}function L(t){const e=Math.floor(t/60);return(t=Math.floor(t%60*1e3)/1e3)<10?"0"+e+":0"+t:"0"+e+":".slice(0,t.length-4)+t}let I=0,D=0;const G=Date.now();let S=0,k=0,M=0;const N=document.getElementById("mask"),O=document.getElementById("victory-mount"),j=5;let B=j,W=0,P=j,q=0,R=0,U=[];function Y(){requestAnimationFrame(Y),S=Date.now()-G;const t=(S-I)/1e3;try{if(q){const t=30-Math.round(S-q)/1e3;if(t<=0)q=!1,o.setAttribute("value","0:00.000"),g(),h("level-end");else{s(L(t)),o.setAttribute("value",L(t));const e=2500;S-D>e&&(T({}),D+=e)}}}catch(t){s(t)}P<j&&(B<P?W*=-.6:(W-=t/10,W*=.99),B+=W,O.object3D.position.y=B),k>M&&(k-=Math.min(t*Math.PI,k-M),C()),k<M&&(k+=Math.min(t*Math.PI,M-k),C()),I=S}function F(t,e){const o=document.createElement("a-entity");o.className="gun",o.id=t+"-gun",o.setAttribute("position",(e||0)+" 1 -.6"),o.setAttribute("rotation","0 0 90"),o.setAttribute("color",t);const a=document.createElement("a-box");a.setAttribute("position","-.01 -.05 -.05"),a.setAttribute("rotation","50 0 0"),a.setAttribute("scale",".03 .2 .05"),a.setAttribute("color",t);const r=document.createElement("a-box");r.setAttribute("position","-.01  -.05 .05"),r.setAttribute("rotation","-50 0 0"),r.setAttribute("scale",".03 .12 .05"),r.setAttribute("color",t),o.appendChild(a),o.appendChild(r),n.appendChild(o),i.push(o)}return m("levels-set",(function(){b(d),d===1/0&&h("level-reset"),document.querySelectorAll("[oculus-touch-controls]").forEach(y),document.querySelectorAll(".target").forEach(A),requestAnimationFrame(Y)})),{listen:m,log:s,makeGun:F,makeTarget:T,setLevels:function(t){f.splice(0,f.length),f.push(...t),h("levels-set")},setText:p}}(),ENDLESS_MODE={text:{},onload:function(){GameContainer.setText({"table-text":"It's time for CHALLENGE MODE!\n\nCongratulations. Only the finest gun floaters and backwards shooters make it to this point.\n\nRemember!\n- Float the guns where you can find them -\n- White targets need all the colors -\n- Shoot the floor to exit quickly -\n\nYou'll have 30 seconds to shoot as many targets as you can. Get set up, take a deep breath, and LET'S DO THIS!"})},onend:function(t){GameContainer.setText({"table-text":"Awesome shooting!\n\nYou shot "+t+" targets!\n\nShoot the ON button when you're ready to go again and THANK YOU FOR PLAYING!"})}};GameContainer.setLevels([{text:{"table-text":"Welcome to Action Hero Training Week!\n\nToday's lesson is aiming and shooting behind your back. One day, you WILL be chasing a creepy and mysterious enemy through a mirror maze.\nAfter today, you'll be prepared.\n\nThe rear-view helmet you're wearing can be activated by shooting the ON button up there.\n\nWith a gun, of course.\n\nThere is an emergency OFF button at your feet but you'll need to restart that lesson. Good luck."},onload:function(){GameContainer.makeGun("red")},onstart:function(){GameContainer.makeTarget({color:"red",position:"0 2 2"}),GameContainer.setText({"wall-hint":"Achievement Unlocked\nEyes in the Back of Your Head"})}},{text:{"table-text":"Easy as pie.\n\nYou were so good that we've decided to give you DUAL WIELDING.\n\nJust like a video game."},onload:function(){GameContainer.makeGun("blue")},onstart:function(){GameContainer.makeTarget({color:"red",position:"-2 2 2"}),GameContainer.makeTarget({color:"purple",position:"0 2 2"}),GameContainer.makeTarget({color:"blue",position:"2 2 2"}),GameContainer.setText({"wall-hint":"RED + BLUE = PURPLE"})}},{text:{"table-text":"You know what. Let's do this.\n\nTRIPLE. WIELDING.\n\nLuckily the guns stay in the air exactly where you drop them so it's just a matter of remembering where you put them!\n\nPut this YELLOW gun where you'll know where to grab it then activate your helmet."},onload:function(){GameContainer.makeGun("yellow")},onstart:function(){const t=["red","orange","yellow","green","blue","purple"];let e=[0,2,0];const o=2*Math.PI/t.length;for(let n in t)e[0]=Math.cos(o*n),e[2]=Math.sin(o*n)+3,GameContainer.makeTarget({color:t[n],position:e.join(" ")});GameContainer.setText({"wall-hint":"Remember your finger painting"})}},{text:{"table-text":"One last thing before we test your skills: you're going to have to shoot WHITE targets with all the guns.\n\nThere's one behind you now. Give it a shot.\n\n(literally)"},onload:function(){},onstart:function(){GameContainer.makeTarget({color:"white",position:"0 2 2"}),GameContainer.setText({"wall-hint":"Look out! It's that one guy."})}}])</script>