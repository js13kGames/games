function e(...e){return t.play(...e)}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={volume:.3,sampleRate:44100,audioContext:new AudioContext,play:function(...e){return this.playSamples([this.buildSamples(...e)])},playSamples:function(e,t=1,a=1,n=0,o=!1){const i=e.length,r=e[0].length,l=this.audioContext.createBuffer(i,r,this.sampleRate),s=this.audioContext.createBufferSource();e.forEach((e,t)=>l.getChannelData(t).set(e)),s.buffer=l,s.playbackRate.value=a,s.loop=o;const c=this.audioContext.createGain();c.gain.value=this.volume*t,c.connect(this.audioContext.destination);const h=new StereoPannerNode(this.audioContext,{pan:n});return s.connect(h).connect(c),s.start(),s},buildSamples:function(e=1,t=.05,a=220,n=0,o=0,i=.1,r=0,l=1,s=0,c=0,h=0,u=0,f=0,p=0,d=0,g=0,m=0,w=1,y=0,x=0,A=0){let v,M,C=2*Math.PI,S=e=>e<0?-1:1,O=this.sampleRate,T=s*=500*C/O/O,b=a*=(1+2*t*Math.random()-t)*C/O,E=[],R=0,I=0,k=0,L=1,P=0,B=0,N=0,U=C*Math.abs(A)*2/O,H=Math.cos(U),_=Math.sin(U)/2/2,W=1+_,D=-2*H/W,F=(1-_)/W,X=(1+S(A)*H)/2/W,Q=-(S(A)+H)/W,K=X,Y=0,j=0,G=0,V=0;for(n=n*O+9,y*=O,o*=O,i*=O,m*=O,c*=500*C/O**3,d*=C/O,h*=C/O,u*=O,f=f*O|0,e*=this.volume,M=n+y+o+i+m|0;k<M;E[k++]=N*e)++B%(100*g|0)||(N=r?r>1?r>2?r>3?Math.sin(R**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/C%2+2)%2:1-4*Math.abs(Math.round(R/C)-R/C):Math.sin(R),N=(f?1-x+x*Math.sin(C*k/f):1)*S(N)*Math.abs(N)**l*(k<n?k/n:k<n+y?1-(k-n)/y*(1-w):k<n+y+o?w:k<M-m?(M-k-m)/i*w:0),N=m?N/2+(m>k?0:(k<M-m?1:(M-k)/m)*E[k-m|0]/2/e):N,A&&(N=V=K*Y+Q*(Y=j)+X*(j=N)-F*G-D*(G=V))),v=(a+=s+=c)*Math.cos(d*I++),R+=v+v*p*Math.sin(k**5),L&&++L>u&&(a+=h,b+=h,L=0),!f||++P%f||(a=b,s=T,L=L||1);return E},getNote:function(e=0,t=440){return t*2**(e/12)}},a=[,,497,.05,.04,.11,1,1.6,,,100,.1,,1,,,,.4,.03],n=[,0,261.6256,.02,.2,.08,,1.9,,,350,.07,.22,,,.1,.08,.9,.23],o=[1.1,,522,.01,.01,.01,1,4.9,,-36,,,,,,,,.71,.02,,-1073],i=[,,305,.01,.02,.26,1,.5,,,286,.08,,,,,,.93,.01],r=[3.1,,94,.03,.01,.13,4,1.6,,,,,.03,.3,,.3,.12,.42,.01,.4],l=new function(){var e,t,a,n,o,i=function(e){return Math.sin(6.283184*e)},r=function(e){return.003959503758*2**((e-128)/12)},l=function(e,t,a){var n,o,i,l,c,h,u=s[e.i[0]],f=e.i[1],p=e.i[3]/32,d=s[e.i[4]],g=e.i[5],m=e.i[8]/32,w=e.i[9],y=e.i[10]*e.i[10]*4,x=e.i[11]*e.i[11]*4,A=e.i[12]*e.i[12]*4,v=1/A,M=-e.i[13]/16,C=e.i[14],S=a*2**(2-e.i[15]),O=new Int32Array(y+x+A),T=0,b=0;for(n=0,o=0;n<y+x+A;n++,o++)o>=0&&(o-=S,c=r(t+(15&(C=C>>8|(255&C)<<4))+e.i[2]-128),h=r(t+(15&C)+e.i[6]-128)*(1+8e-4*e.i[7])),i=1,n<y?i=n/y:n>=y+x&&(i=(1-(i=(n-y-x)*v))*3**(M*i)),l=u(T+=c*i**p)*f,l+=d(b+=h*i**m)*g,w&&(l+=(2*Math.random()-1)*w),O[n]=80*l*i|0;return O},s=[i,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return t<2?t-1:3-t}];this.init=function(i){e=i,t=i.endPattern,a=0,n=i.rowLen*i.patternLen*(t+1)*2,o=new Int32Array(n)},this.generate=function(){var r,c,h,u,f,p,d,g,m,w,y,x,A,v,M=new Int32Array(n),C=e.songData[a],S=e.rowLen,O=e.patternLen,T=0,b=0,E=!1,R=[];for(h=0;h<=t;++h)for(d=C.p[h],u=0;u<O;++u){var I=d?C.c[d-1].f[u]:0;I&&(C.i[I-1]=C.c[d-1].f[u+O]||0,I<17&&(R=[]));var k=s[C.i[16]],L=C.i[17]/512,P=2**(C.i[18]-9)/S,B=C.i[19],N=C.i[20],U=43.23529*C.i[21]*3.141592/44100,H=1-C.i[22]/255,_=1e-5*C.i[23],W=C.i[24]/32,D=C.i[25]/512,F=6.283184*2**(C.i[26]-9)/S,X=C.i[27]/255,Q=C.i[28]*S&-2;for(y=(h*O+u)*S,f=0;f<4;++f)if(p=d?C.c[d-1].n[u+f*O]:0){R[p]||(R[p]=l(C,p,S));var K=R[p];for(c=0,r=2*y;c<K.length;c++,r+=2)M[r]+=K[c]}for(c=0;c<S;c++)(w=M[g=2*(y+c)])||E?(x=U,B&&(x*=k(P*g)*L+.5),b+=(x=1.5*Math.sin(x))*(A=H*(w-b)-(T+=x*b)),w=3==N?b:1==N?A:T,_&&(w=(w*=_)<1?w>-1?i(.25*w):-1:1,w/=_),E=(w*=W)*w>1e-5,v=w*(1-(m=Math.sin(F*g)*D+.5)),w*=m):v=0,g>=Q&&(v+=M[g-Q+1]*X,w+=M[g-Q]*X),M[g]=0|v,M[g+1]=0|w,o[g]+=0|v,o[g+1]+=0|w}return++a/e.numChannels},this.createAudioBuffer=function(e){for(var t=e.createBuffer(2,n/2,44100),a=0;a<2;a++)for(var i=t.getChannelData(a),r=a;r<n;r+=2)i[r>>1]=o[r]/65536;return t},this.createWave=function(){var e=44+2*n-8,t=e-36,a=new Uint8Array(44+2*n);a.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,r=44;i<n;++i){var l=o[i];l=l<-32767?-32767:l>32767?32767:l,a[r++]=255&l,a[r++]=l>>8&255}return a},this.getData=function(e,t){for(var a=2*Math.floor(44100*e),n=new Array(t),i=0;i<2*t;i+=1){var r=a+i;n[i]=e>0&&r<o.length?o[r]/32768:0}return n}};let s=!1;l.init({songData:[{i:[1,15,164,0,1,127,128,15,0,36,0,28,87,0,0,0,0,64,1,1,2,38,128,1,3,255,2,212,8],p:[1,1,2,2,3,1,3,1,1,1,2,2,3,1,3,1,1,1,2,2,3,1,3,1,1,2,2,3,1,3,1,1],c:[{n:[135,147,142,149,147,140],f:[]},{n:[130,147,152,149,144,154],f:[]},{n:[135,147,142,149,147,140,,,,,,,161,156,151,135,,,,,,,,,138,150,145,157,131,143,135,147],f:[]}]},{i:[0,105,128,0,0,255,128,33,0,7,7,20,39,0,0,0,0,0,0,0,2,41,0,0,8,0,6,0,0],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,99,,,99,,,,,,,,,111,,,,99,,,99],f:[]}]},{i:[1,55,128,0,1,81,128,0,0,0,52,6,0,0,0,0,0,243,10,1,2,135,0,0,3,147,6,230,4],p:[,,,,,,,,,,1,,,,2,,3,4,1,5,6,7,2,8,3,4,1,,,2],c:[{n:[137],f:[]},{n:[,,135],f:[]},{n:[159],f:[]},{n:[157],f:[]},{n:[152],f:[]},{n:[154],f:[]},{n:[149],f:[]},{n:[147],f:[]}]}],rowLen:6615,patternLen:32,endPattern:31,numChannels:3}),setInterval(function(){if(!s&&(s=l.generate()>=1,s)){const e=l.createWave();c.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"}))}},0);const c=document.createElement("audio");c.autoplay=!0,c.loop=!0;const h=document.body;h.appendChild(c),h.addEventListener("click",function e(){c.play(),h.removeEventListener("click",e)});const u=document.getElementById("canvas-main"),f=u.getContext("2d"),p=document.getElementById("canvas-aux"),d=p.getContext("2d"),g=document.getElementById("canvas-bg"),m=g.getContext("2d");function w(e){e.imageSmoothingEnabled=!1}w(f),w(d),w(m);let y={x:0,y:0};function x(e,t){const a=t.getBoundingClientRect(),n=e.clientX-a.left,o=e.clientY-a.top;return{x:n*(t.width/a.width),y:o*(t.height/a.height)}}u.addEventListener("click",e=>{if(void 0!==Xe&&!Xe)return;const t=x(e,u);if(y.x=t.x,y.y=t.y,le&&ve(),M)M=!1;else if("playing"===_&&oe.pounceSelecting&&Q.length>0){for(let e=0;e<Q.length;e++){const t=Q[e];if(y.x>=t.x&&y.x<=t.x+t.w&&y.y>=t.y&&y.y<=t.y+t.h)return void(j.pounce>0&&(Me(e),j.pounce--,oe.pounceSelecting=!1,me()))}oe.pounceSelecting=!1}else U.forEach(e=>{e.clickable&&e.x&&e.y&&e.w&&e.h&&y.x>=e.x&&y.x<=e.x+e.w&&y.y>=e.y&&y.y<=e.y+e.h&&e.onClick&&e.onClick()}),"title"===_?fe():"gameOver"===_&&Se()});let A=null,v={x:0,y:0},M=!1;const C={pounce:["POUNCE","Replace a combo card","with top deck card."],purr:["PURR","Peek next top deck card."],hiss:["HISS","Redeal hand. Next combo","Less 20pct score."],scratch:["SCRATCH","Burn top 3 cards.","Next draw favors black."]};function S(e,t,a){return e&&t>=e.x&&t<=e.x+e.w&&a>=e.y&&a<=e.y+e.h}u.addEventListener("pointerdown",e=>{const t=x(e,u);v={x:t.x,y:t.y}}),p.addEventListener("pointerdown",e=>{const t=x(e,p);v={x:t.x,y:t.y};const a=Object.entries(G);for(const[n,o]of a)if(o&&S(o,t.x,t.y)&&j[n]>0&&"playing"===_)return void(A=setTimeout(()=>{M=!0,Ae(n)},550))}),p.addEventListener("pointermove",t=>{const a=x(t,p);if(A){const e=a.x-v.x,t=a.y-v.y;e*e+t*t>36&&(clearTimeout(A),A=null)}if("mouse"===t.pointerType&&"playing"===_){let t=null;for(const[e,n]of Object.entries(G))if(n&&S(n,a.x,a.y)&&j[e]>0){t=e;break}t?le&&ce&&se===t||(e(...o),Ae(t,!0)):le&&ce&&ve()}}),["pointerup","pointercancel","pointerleave"].forEach(e=>{p.addEventListener(e,()=>{A&&(clearTimeout(A),A=null),"pointerleave"===e&&ce&&ve()})}),p.addEventListener("click",t=>{if(void 0!==Xe&&!Xe)return;const a=x(t,p);if(y.x=a.x,y.y=a.y,le&&ve(),M)return void(M=!1);if("playing"!==_)return;const n=Object.entries(G);for(const[o,r]of n)if(r&&S(r,a.x,a.y)){j[o]>0&&"function"==typeof r.onClick&&(e(...i),r.onClick());break}}),u.addEventListener("pointermove",e=>{if(!A)return;const t=x(e,u),a=t.x-v.x,n=t.y-v.y;a*a+n*n>36&&(clearTimeout(A),A=null)}),["pointerup","pointercancel","pointerleave"].forEach(e=>{u.addEventListener(e,()=>{A&&(clearTimeout(A),A=null)})});const O=5,T=7,b=1;let E=null,R=null,I=0,k=0;function L(e,t,a,n="#fff",o=1,i=f){let r=function(e){if(!e)return-1;const t=e.toUpperCase();return t>="A"&&t<="Z"?t.charCodeAt(0)-65:e>="0"&&e<="9"?e.charCodeAt(0)-48+26:"♠"===e?36:"♣"===e?37:"♥"===e?38:"♦"===e?39:-1}(e),l=(O+b)*o;if(r<0)return t+l;let s=O,c=T,h=s*o,u=c*o,p=r*O;return E&&I===h&&k===u?R.clearRect(0,0,I,k):(I=h,k=u,E=document.createElement("canvas"),E.width=h,E.height=u,R=E.getContext("2d"),R.imageSmoothingEnabled=!1),R.globalCompositeOperation="source-over",R.drawImage($,p,0,s,c,0,0,h,u),R.globalCompositeOperation="source-in",R.fillStyle=n,R.fillRect(0,0,h,u),i.imageSmoothingEnabled=!1,i.drawImage(E,t,a),t+l}function P(e,t,a,n="#fff",o=1,i="left",r=f){let l=t;const s=(O+b)*o,c=T*o;"center"===i&&(l=t-e.length*s/2,a-=c/2);let h=l;for(let u=0;u<e.length;u++){const t=e[u];" "===t?h+=s:h=L(t,h,a,n,o,r)}return h}let B=0,N=0,U=[],H=[],_="title",W=0,D=parseInt(localStorage.getItem("pokerHighScore")||"0"),F=52,X=[],Q=[],K=[],Y={x:0,y:0},j={pounce:1,purr:1,hiss:1,scratch:1},G={pounce:null,purr:null,hiss:null,scratch:null},V=[],q=null,z=null,Z=null;const J=new Image;J.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAAgCAMAAACFKlUGAAAAAXNSR0IArs4c6QAAAGBQTFRFAAAAAAAARSg8Zjkxj1Y733Em2aBm7sOa+/I2meVQar4wN5RuS2kvUkskMjw5Pz90MGCCW27hY5v/X83ky9v8////m623hH6HaWpqWVZSdkKKrDIy2Vdj13u6j5dKim8wtyWnpgAAACB0Uk5TAP////////////////////////////////////////+Smq12AAABHklEQVRoge2XURLCIAwFm0Nw/6uqY6v9kGwkBBgmq9Of10lwS1N7HPsgH9ry7UlBQA9BW7tzC5LruylOQWIQJLfjirnOCEFyHdbMdYYI0mfY7FwnXhAOsXF5i6UUBMQLmn4Lufy4H/NmQ/G5voea5zRsUMrt91h0zte4vkSNfQS15kC4ILqAs3MiBQE+QX/4qT0HJ+dICgJSEJCCgBQE+ATt/xRztwdB0vOP4o9zqL6hv4p7g6Ig+R61ZVjyX2dRfVt/rXMKgs7Bgo73e7S+QLwBpP42TvUt/fXOPkEwoW0TwCKoVsQ74YAOgkwt6BRHEarvWvzdQFvehdDiXuD3lwF+1hb0GrNSnyLlzEvkCpb2A5Tn5/xGEbw9w2mw8wDnxwaoYr9KsgAAAABJRU5ErkJggg==";const $=new Image;$.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAHCAMAAAB6OPLNAAAAAXNSR0IArs4c6QAAAAxQTFRFAAAAAAAA/////yYAuArq7gAAAAR0Uk5TAP///7MtQIgAAADxSURBVDiNnVRRFoMwDIL7X3qzNgTyrB/W59bahASKAiSvm+gZNe5n+O+t2TXW3z3XjE8oaKhI8x/VKLCdVpj3GhbXwWOcimC2WskLbe92y6dWlXnYNSVGtV1DPXtaUyqZZxHkzNgYkaq5UN6JdGb0ARNjd40OrxBSbNRxH+SwDWzZRNpkCvAToTPklhONIk+YBLRLD1CMBM+sUFBhPHd9tv9+Ig8eYe4yAGgCW9q40g8ujTR341m8vZFpsoMpPhPxpROR+rnhzs37SeMkhIRwK9hXq7QpWIW0TU2yfjllhmEKOxgRSVX9IyZFAlnMpFeNH7O/AmScoPDlAAAAAElFTkSuQmCC";const ee=32,te={wag0:0,wag1:1,wag2:2,pawMove0:3,pawMove1:4,paw:6,pawClaw:7,scratch:8};function ae(){return J&&J.naturalWidth>0?Math.floor(J.naturalWidth/ee):0}function ne(e){const t=ae();return t?Math.max(0,Math.min(t-1,e)):0}let oe={pounceSelecting:!1},ie=1,re=!1,le=null,se=null,ce=!1;const he=["♠","♥","♦","♣"],ue=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],fe=()=>{H=[],_="playing",W=0,K=(()=>{const e=[];he.forEach(t=>{ue.forEach(a=>{e.push({suit:t,value:a})})});for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})(),F=52,X=[],Q=[],ie=1,re=!1,j={pounce:1,purr:1,hiss:1,scratch:1},Y.x=u.width/2-20,Y.y=u.height/2-30,pe(),function(){const e=Math.floor((p.width-134)/2),t=p.height-38-4,a=t+16+6;["pounce","purr","hiss","scratch"].forEach(e=>{const t=G[e];if(t){const a=V.indexOf(t);a>-1&&V.splice(a,1),G[e]=null}}),G.pounce=Pe(e+0,t,64,16,"POUND 1",()=>{"playing"===_&&(j.pounce<=0||0!==Q.length&&(oe.pounceSelecting=!0,Ce("POUNCE: PICK A CARD",u.width/2,u.height-10,"#ff0")))}),G.pounce.context=d,G.pounce.isAbilityButton=!0,G.purr=Pe(e+70,t,64,16,"PURR 1",()=>{"playing"===_&&(j.purr<=0||(function(){if(0===K.length)return void Ce("NO CARDS",u.width/2,Y.y-8,"#f00");const e=K[K.length-1],t=ke(Y.x+46,Y.y-10,e.suit,e.value);t.alpha=.9,t.clickable=!1,U.push(t),Ce("PURR",Y.x+66,Y.y-20,"#0f0"),t.moveTo(t.x,t.y-20,1400,"easeOut",e=>{e.fadeTo(0,700,"easeOut",()=>{const t=U.indexOf(e);t>-1&&U.splice(t,1)})})}(),j.purr--,me()))}),G.purr.context=d,G.purr.isAbilityButton=!0,G.hiss=Pe(e+0,a,64,16,"HISS 1",()=>{"playing"===_&&(j.hiss<=0||(ie=.8,Ce("HISS LESS 20PCT NEXT",u.width/2,Y.y+80,"#f80"),He.spawnAt(Y.x+20,Y.y+30,10,{colors:["#f80","#f44"],speed:120,life:900}),pe(),j.hiss--,me()))}),G.hiss.context=d,G.hiss.isAbilityButton=!0,G.scratch=Pe(e+70,a,64,16,"SCRT 1",()=>{"playing"===_&&(j.scratch<=0||(function(){const e=Y.x,t=Y.y,a=Math.floor(e+-28),n=Math.floor(t+-18),o=Ne(a,-96,96,96,{claws:!0});U.push(o),q&&q.pawUp&&q.pawUp(700),o.moveTo(a,n,250,"easeIn",()=>{o.scaleTo(.9,80,"easeIn",()=>o.scaleTo(1,120,"easeOut"));const a=Ee({x:e+2,y:t+2,w:36,h:56,t:0,alpha:1,clickable:!1,update:(e,t)=>{e.t+=t;const a=Math.max(0,3e3-e.t);if(e.alpha=a<600?a/600:1,e.t>=3e3)return!1},render:e=>{if(0===ae())return;f.save(),f.globalAlpha=e.alpha;const t=ne(te.scratch)*ee;f.drawImage(J,t,0,ee,ee,e.x,e.y,e.w,e.h),f.restore()}});U.push(a);const n=U.indexOf(o);n>-1&&(U.splice(n,1),U.push(o));let i=0;for(let e=0;e<3&&0!==K.length;e++)K.pop(),i++;i>0&&(F-=i,re=!0,Ce(`SCRATCH -${i}`,Y.x+20,Y.y-20,"#ff0"),He.spawnAt(Y.x+20,Y.y+30,12,{colors:["#ff0","#f00"],speed:150,life:1e3})),setTimeout(()=>{o.moveTo(o.x,-80,250,"easeOut").fadeTo(0,250,"easeOut",()=>{const e=U.indexOf(o);e>-1&&U.splice(e,1)})},120)})}(),j.scratch--,me()))}),G.scratch.context=d,G.scratch.isAbilityButton=!0,V.push(G.pounce,G.purr,G.hiss,G.scratch),me(),we()}(),function(){if(Z)return V.includes(Z)||V.push(Z),void(Z.y=Math.min(p.height-10,q?q.y+q.h+8:p.height-20));Z=Ee({x:0,y:Math.min(p.height-10,q?q.y+q.h+18:p.height-20),alpha:1,clickable:!1,context:d,isHudScore:!0,update:(e,t)=>{e.updateAnimations(t)},render:e=>{const t=e.context||d;P(`SCORE ${W}`,Math.floor(p.width/2),e.y,"#fff",2,"center",t)}}),V.push(Z)}(),le&&ve()},pe=()=>{X.forEach(e=>{const t=U.indexOf(e);t>-1&&U.splice(t,1)}),X=[];for(let t=0;t<5;t++)if(K.length>0){const n=K.pop();F--;const o=ke(Y.x,Y.y,n.suit,n.value);o.onClick=()=>de(o),o.clickable=!0;const i=u.width/2+50*(t-2)-20,r=u.height-80;setTimeout(()=>{e(...a),o.moveTo(i,r,400,"easeOut",()=>{})},100*t),X.push(o),U.push(o)}},de=t=>{if("playing"!==_||Q.length>=5)return;const n=X.indexOf(t);if(n>-1){const o=n;X.splice(n,1),Q.push(t),t.clickable=!1;const i=u.width/2+50*(Q.length-1-2)-20,r=10;e(...a),t.moveTo(i,r,300,"easeOut",()=>{5===Q.length?(ge(o),setTimeout(()=>be(),500)):ge(o)}),He.spawnAt(t.x+t.w/2,t.y+t.h/2,5,{colors:["#ff0","#ffa500"],speed:60,spread:20,life:800})}},ge=t=>{if(K.length>0){if(re){for(let e=K.length-1;e>=Math.max(0,K.length-5);e--){const t=K[e].suit;if("♠"===t||"♣"===t){const[t]=K.splice(e,1);K.push(t);break}}re=!1}const n=K.pop();F--,Te(t,()=>{const t=ke(Y.x,Y.y,n.suit,n.value);t.onClick=()=>de(t),t.clickable=!0,X.push(t),U.push(t);const o=u.width/2+100-20,i=u.height-80;e(...a),t.moveTo(o,i,400,"easeOut",()=>{}).scaleTo(1.1,150,"easeOut",()=>{t.scaleTo(1,150,"easeOut")}).rotateTo(Math.PI/10,200,"easeOut",e=>{e.rotateTo(0,200,"easeOut")}),He.spawnAt(t.x+t.w/2,t.y+t.h/2,3,{colors:["#fff","#ff0"],speed:40,spread:15,life:600})})}else Te(),X.length,Q.length};function me(){const e=(e,t,a)=>{e&&(e.text=`${t} ${a}`,e.alpha=a>0?1:.5,e.cacheImage())};e(G.pounce,"POUNCE ",j.pounce),e(G.purr,"PURR   ",j.purr),e(G.hiss,"HISS   ",j.hiss),e(G.scratch,"SCRATCH",j.scratch)}function we(){if(q)return V.includes(q)||V.push(q),void ye();const e=Math.floor((p.width-96)/2),t=Math.floor((p.height-96)/2)-8;q=function(e,t,a=32){return Ee({x:e,y:t,w:a,h:a,scale:1,alpha:1,rotation:0,clickable:!1,context:d,_wagging:!1,_wagElapsed:0,_wagDuration:0,_wagSpeed:120,_pawAnimating:!1,_pawElapsed:0,_pawDuration:0,_pawSpeed:120,wag:function(e=1e3){return this._wagging=!0,this._wagElapsed=0,this._wagDuration=e,this},pawUp:function(e=500){return this._pawAnimating=!0,this._pawElapsed=0,this._pawDuration=e,this},update:(e,t)=>{e.updateAnimations(t),e._wagging&&(e._wagElapsed+=t,e._wagElapsed>=e._wagDuration&&(e._wagging=!1)),e._pawAnimating&&(e._pawElapsed+=t,e._pawElapsed>=e._pawDuration&&(e._pawAnimating=!1))},render:e=>{const t=e.context||d;if(0===ae())return;let a;if(t.save(),t.globalAlpha=e.alpha,e._pawAnimating){const t=Math.floor(e._pawElapsed/e._pawSpeed)%4;a=ne([te.pawMove0,te.pawMove1,te.pawMove0,te.wag1][t])}else if(e._wagging){const t=[te.wag0,te.wag1,te.wag2,te.wag1];a=ne(t[Math.floor(e._wagElapsed/e._wagSpeed)%t.length])}else a=ne(te.wag1);const n=32*a;t.drawImage(J,n,0,32,32,e.x,e.y,e.w,e.h),t.restore()}})}(e,t,96),q.context=d,V.push(q),xe()}function ye(){if(!q)return;const e=q.w;q.x=Math.floor((p.width-e)/2),q.y=Math.floor((p.height-e)/2)-8,z&&(z.y=Math.max(4,q.y-18)),Z&&(Z.y=Math.min(p.height-10,q.y+q.h+8))}function xe(){if(z)return V.includes(z)||V.push(z),void(z.y=Math.max(4,q?q.y-18:12));z=Ee({x:0,y:Math.max(4,q?q.y-18:12),text:"POKER",scale:5,alpha:1,rotation:0,clickable:!1,context:d,update:(e,t)=>{e.updateAnimations(t)},render:e=>{const t=e.context||d;P(e.text,t.canvas.width/2+1,e.y-29,"#000",e.scale,"center",t),P(e.text,t.canvas.width/2,e.y-30,"#ff0",e.scale,"center",t),P("MYSTERIO",t.canvas.width/2+1,e.y+11,"#000",3,"center",t),P("MYSTERIO",t.canvas.width/2,e.y+10,"#f00",3,"center",t),"title"===_&&(P("Game by Marco Fernandes",t.canvas.width/2,e.y+130,"#fff",1,"center",t),P("Music by Esa Ruoho",t.canvas.width/2,e.y+140,"#fff",1,"center",t),P("Tap to start",t.canvas.width/2,e.y+180,"#fff",2,"center",t))}}),V.push(z)}function Ae(e,t=!1){ve();const a=C[e]||[e.toUpperCase()],n=6*Math.max(...a.map(e=>e.length)),o=Math.min(p.width-12,n+12),i=10*a.length+12,r=Math.floor((p.width-o)/2),l=Math.max(4,p.height-38-i-6);le=Be(r,l,o,i,a),le.context=d,V.push(le),se=e,ce=!!t}function ve(){if(!le)return;let e=U.indexOf(le);e>-1&&U.splice(e,1),e=V.indexOf(le),e>-1&&V.splice(e,1),le=null,se=null,ce=!1}function Me(e){if(e<0||e>=Q.length)return;if(0===K.length)return void Ce("NO CARDS",u.width/2,Y.y-8,"#f00");const t=Q[e],a=u.width/2+50*(e-2)-20,n=Math.floor(a+-28),o=Math.floor(-8),i=Ne(n,-96,96,96);U.push(i),i.moveTo(n,o,250,"easeIn",()=>{i.scaleTo(.9,80,"easeIn",()=>i.scaleTo(1,120,"easeOut")),He.spawnAt(a+20,40,12,{colors:["#000","#444"],speed:120,life:500}),t.moveTo(-60,t.y-10,250,"easeIn",()=>{const e=U.indexOf(t);e>-1&&U.splice(e,1)}).fadeTo(0,250,"easeIn");const n=K.pop();F--;const o=ke(Y.x,Y.y,n.suit,n.value);o.clickable=!1,U.push(o);const r=U.indexOf(i);r>-1&&(U.splice(r,1),U.push(i)),o.scale=.8,o.moveTo(a,10,300,"easeIn").scaleTo(1,200,"easeOut"),Q[e]=o,setTimeout(()=>{i.moveTo(i.x,-80,250,"easeOut").fadeTo(0,250,"easeOut",()=>{const e=U.indexOf(i);e>-1&&U.splice(e,1)})},120)}),q&&q.pawUp&&q.pawUp(600)}function Ce(e,t,a,n="#fff"){const o=Le(t-3*e.length,a,e,n,1,"left");U.push(o),o.moveTo(o.x,o.y-6,1e3,"easeOut",e=>{e.fadeTo(0,1e3,"easeOut",()=>{const t=U.indexOf(e);t>-1&&U.splice(t,1)})})}function Se(){_="title",U=[],H=[],le&&ve(),V=[],q=null,z=null,we(),xe(),function(){H=[];const e=[{x:u.width/2-60,y:u.height/2-30},{x:u.width/2+60,y:u.height/2-30},{x:u.width/2,y:u.height/2+10}],t=[40,48,56],a=[.0012,.001,9e-4];let n=0;for(let o=0;o<e.length;o++)for(let i=0;i<2;i++){const r=he[(2*o+i)%he.length],l=ue[3*n%ue.length],s=Math.random()*Math.PI*2,c=Oe(e[o].x,e[o].y,t[o],a[o]*(i?-1:1),s,r,l);H.push(c),n++}}()}function Oe(e,t,a,n,o,i,r){const l=e+a*Math.cos(o)-20,s=t+a*Math.sin(o)-30,c=ke(l,s,i,r);c.clickable=!1,c.alpha=.95,c.orbit={cx:e,cy:t,r:a,a:o,v:n};const h=c.update;return c.update=(e,t)=>{e.orbit.a+=e.orbit.v*t;const a=e.orbit.cx+e.orbit.r*Math.cos(e.orbit.a)-e.w/2,n=e.orbit.cy+e.orbit.r*Math.sin(e.orbit.a)-e.h/2;e.x=a,e.y=n,e.rotation=.25*Math.sin(3*e.orbit.a),e.scale=1+.03*Math.sin(2*e.orbit.a),h&&h(e,t)},c}const Te=(e,t=null)=>{let a=0,n=0;X.forEach((e,o)=>{const i=u.width/2+50*(o-2)-20,r=u.height-80;Math.abs(e.x-i)>5&&(n++,setTimeout(()=>{e.moveTo(i,r,400,"easeOut",()=>{a++,t&&a===n&&t()}).rotateTo(-Math.PI/10,200,"easeOut",e=>{e.rotateTo(0,200,"easeOut")})},100*o))}),0===n&&t&&t()},be=()=>{if(5!==Q.length)return;_="evaluating";const t=(e=>{const t={A:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13},a={},n={};e.forEach(e=>{a[e.value]=(a[e.value]||0)+1,n[e.suit]=(n[e.suit]||0)+1});const o=Object.values(a).sort((e,t)=>t-e),i=5===Object.values(n)[0],r=e.map(e=>t[e.value]).sort((e,t)=>e-t),l=r.every((e,t)=>0===t||e===r[t-1]+1)||"1,10,11,12,13"===r.join(",");return l&&i?{name:"Royal Flush",score:1e3}:i?{name:"Flush",score:500}:l?{name:"Straight",score:400}:4===o[0]?{name:"Four of a Kind",score:800}:3===o[0]&&2===o[1]?{name:"Full House",score:700}:3===o[0]?{name:"Three of a Kind",score:300}:2===o[0]&&2===o[1]?{name:"Two Pair",score:200}:2===o[0]?{name:"Pair",score:100}:{name:"High Card",score:10}})(Q),o=Math.max(0,Math.round(t.score*(ie||1)));W+=o,ie=1,t.name.length;const i=Le(u.width/2,u.height/2,`${t.name}!`,"#ff0",1,"center"),l=Le(u.width/2,20,`+${o}`,"#0f0",1,"center");if(U.push(i,l),i.rotation=Math.PI/2,i.scale=1,e(...n),i.scaleTo(3,750,"easeOut").rotateTo(0,750,"easeOut",e=>{setTimeout(()=>{e.fadeTo(0,300,"easeOut").scaleTo(10,300,"easeOut",()=>{const e=U.indexOf(i);e>-1&&U.splice(e,1)})},500)}),l.scaleTo(3,0,"easeOut"),l.moveTo(0,u.height/2,2e3,"easeOut").fadeTo(0,1e3,"easeOut",()=>{const e=U.indexOf(l);e>-1&&U.splice(e,1)}),q&&q.wag&&q.wag(800),t.score>=500){q&&q.wag&&q.wag(1200);for(let t=0;t<7;t++)setTimeout(()=>{He.burst(u.width/2+200*(Math.random()-.5),u.height/2+100*(Math.random()-.5),20,{colors:["#ff0","#f0f","#0ff","#f00","#0f0"],speed:150,spread:50,life:2e3}),e(...r)},300*t)}setTimeout(()=>{Q.forEach((t,n)=>{setTimeout(()=>{e(...a),t.moveTo(296,t.y+10*n,400,"easeIn",()=>{const e=U.indexOf(t);e>-1&&U.splice(e,1)}).rotateTo(Math.PI/6,200,"easeOut",e=>{e.rotateTo(0,200,"easeOut")})},100*n)}),Q=[],setTimeout(()=>{X.length+K.length>=5?_="playing":(_="gameOver",le&&ve(),W>D&&(D=W,localStorage.setItem("pokerHighScore",D.toString())))},1e3)},2e3)},Ee=e=>(e.animations=[],e._imageCache=null,e.cacheImage=()=>{if(!e.renderToCache)return;const t=document.createElement("canvas"),a=t.getContext("2d");a.imageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.oImageSmoothingEnabled=!1,t.width=e.cacheWidth||e.w||64,t.height=e.cacheHeight||e.h||64,e.renderToCache(e,a),e._imageCache=t},e.moveTo=(t,a,n,o="linear",i=null)=>(e.animations.push({type:"move",startX:e.x,startY:e.y,targetX:t,targetY:a,duration:n,elapsed:0,easing:o,onComplete:i}),e),e.scaleTo=(t,a,n="linear",o=null)=>(e.animations.push({type:"scale",startScale:e.scale||1,targetScale:t,duration:a,elapsed:0,easing:n,onComplete:o}),e),e.rotateTo=(t,a,n="linear",o=null)=>(e.animations.push({type:"rotate",startRotation:e.rotation||0,targetRotation:t,duration:a,elapsed:0,easing:n,onComplete:o}),e),e.fadeTo=(t,a,n="linear",o=null)=>(e.animations.push({type:"fade",startAlpha:e.alpha||1,targetAlpha:t,duration:a,elapsed:0,easing:n,onComplete:o}),e),e.updateAnimations=t=>{for(let a=e.animations.length-1;a>=0;a--){const n=e.animations[a];n.elapsed+=t;const o=Math.min(n.elapsed/n.duration,1),i=Ie(o,n.easing);switch(n.type){case"move":e.x=Re(n.startX,n.targetX,i),e.y=Re(n.startY,n.targetY,i);break;case"scale":e.scale=Re(n.startScale,n.targetScale,i);break;case"rotate":e.rotation=Re(n.startRotation,n.targetRotation,i);break;case"fade":e.alpha=Re(n.startAlpha,n.targetAlpha,i)}o>=1&&(n.onComplete&&"function"==typeof n.onComplete&&n.onComplete(e,n),e.animations.splice(a,1))}},e.renderCached=t=>{const a=e.context||f;e._imageCache?(a.save(),a.globalAlpha=e.alpha||1,a.translate(e.x+(e.w||e.cacheWidth||64)/2,e.y+(e.h||e.cacheHeight||64)/2),a.scale(e.scale||1,e.scale||1),a.rotate(e.rotation||0),a.drawImage(e._imageCache,-(e.w||e.cacheWidth||64)/2,-(e.h||e.cacheHeight||64)/2),a.restore()):t(e)},e),Re=(e,t,a)=>e+(t-e)*a,Ie=(e,t)=>{switch(t){case"easeIn":return e*e;case"easeOut":return e*(2-e);default:return e}},ke=(e,t,a,n)=>{const o=Ee({x:e,y:t,suit:a,value:n,w:40,h:60,vx:0,vy:0,scale:1,alpha:1,rotation:0,cacheWidth:40,cacheHeight:60,renderToCache:(e,t)=>{t.fillStyle="#333",t.fillRect(0,0,e.w,e.h),t.fillStyle="#fff",t.fillRect(2,2,e.w-4,e.h-4);const a="♥"===e.suit||"♦"===e.suit?"#f00":"#000";P(e.value,5,5,a,2,"left",t),P(e.suit,15,25,a,2,"left",t)},update:(e,t)=>{e.x+=e.vx*t*.1,e.y+=e.vy*t*.1,e.vx*=.95,e.vy*=.95,e.updateAnimations(t)},render:e=>{e.renderCached(e=>{f.save(),f.globalAlpha=e.alpha,f.translate(e.x+e.w/2,e.y+e.h/2),f.scale(e.scale,e.scale),f.rotate(e.rotation),f.translate(-e.w/2,-e.h/2),f.fillStyle="#333",f.fillRect(0,0,e.w,e.h),f.fillStyle="#fff",f.fillRect(2,2,e.w-4,e.h-4),P(e.value,5,5,"#000",1),P(e.suit,5,15,"♥"===e.suit||"♦"===e.suit?"#f00":"#000",1),f.restore()})}});return o.cacheImage(),o},Le=(e,t,a,n="#fff",o=1,i="left")=>{const r=(O+b)*o,l=a.length*r,s=T*o;let c=l,h=0;"right"===i&&(c=2*l,h=l);const u=Ee({x:e,y:t,text:a,color:n,scale:o,alpha:1,rotation:0,alignment:i,w:l,h:s,cacheWidth:c,cacheHeight:s,renderToCache:(e,t)=>{let a=0;"right"===i&&(a=c/2-h),P(e.text,a,0,e.color,o,"left",t)},update:(e,t)=>{e.updateAnimations(t)},render:e=>{e.renderCached(e=>{f.save(),f.globalAlpha=e.alpha,f.translate(e.x,e.y),f.scale(e.scale,e.scale),f.rotate(e.rotation);let t=0;"center"===e.alignment?t=-e.text.length*(O+b)*.5:"right"===e.alignment&&(t=-e.text.length*(O+b)),P(e.text,t,0,e.color,1,"left"),f.restore()})}});return u.cacheImage(),u},Pe=(e,t,a,n,o,i)=>{const r=Ee({x:e,y:t,w:a,h:n,text:o,onClick:i,pressed:!1,clickable:!0,scale:1,alpha:1,rotation:0,cacheWidth:a,cacheHeight:n,renderToCache:(e,t)=>{t.fillStyle=e.pressed?"#666":"#999",t.fillRect(0,0,e.w,e.h),t.fillStyle="#fff",t.fillRect(2,2,e.w-4,e.h-4),P(e.text,e.w/2,e.h/2,"#000",1,"center",t)},update:(e,t)=>{e.updateAnimations(t)},render:e=>{e.renderCached(e=>{f.save(),f.globalAlpha=e.alpha,f.translate(e.x+e.w/2,e.y+e.h/2),f.scale(e.scale,e.scale),f.rotate(e.rotation),f.translate(-e.w/2,-e.h/2),f.fillStyle=e.pressed?"#666":"#999",f.fillRect(0,0,e.w,e.h),f.fillStyle="#fff",f.fillRect(2,2,e.w-4,e.h-4);const t=(e.w-6*e.text.length)/2;P(e.text,t,10,"#000",1),f.restore()})}});return r.cacheImage(),r},Be=(e,t,a,n,o)=>{const i=Ee({x:e,y:t,w:a,h:n,lines:o,alpha:1,scale:1,rotation:0,cacheWidth:a,cacheHeight:n,clickable:!0,onClick:()=>ve(),renderToCache:(e,t)=>{t.fillStyle="#222",t.fillRect(0,0,e.w,e.h),t.strokeStyle="#fff",t.lineWidth=2,t.strokeRect(0,0,e.w,e.h);for(let a=0;a<e.lines.length;a++){const n=e.lines[a];P(n,Math.floor((e.w-6*n.length)/2),6+10*a+1,"#ff0",1,"left",t)}},update:(e,t)=>{e.updateAnimations(t)},render:e=>{e.renderCached(e=>{f.save(),f.globalAlpha=e.alpha,f.translate(e.x+e.w/2,e.y+e.h/2),f.scale(e.scale,e.scale),f.rotate(e.rotation),f.translate(-e.w/2,-e.h/2),f.fillStyle="#222",f.fillRect(0,0,e.w,e.h),f.strokeStyle="#fff",f.lineWidth=2,f.strokeRect(0,0,e.w,e.h);for(let t=0;t<e.lines.length;t++){const a=e.lines[t];P(a,Math.floor((e.w-6*a.length)/2),6+10*t+1,"#ff0",1)}f.restore()})}});return i.cacheImage(),i};function Ne(e,t,a=96,n=96,o={claws:!1}){return Ee({x:e,y:t,w:a,h:n,alpha:1,scale:1,rotation:0,clickable:!1,update:(e,t)=>{e.updateAnimations(t)},render:e=>{f.save(),f.globalAlpha=e.alpha;const t=o&&o.claws;if(ae()>te.pawClaw){const a=ne(t?te.pawClaw:te.paw)*ee;f.drawImage(J,a,0,ee,ee,e.x,e.y,e.w,e.h)}f.restore()}})}const Ue={particles:[],get:()=>Ue.particles.pop(),put:e=>{e.life=e.maxLife,Ue.particles.push(e)}},He={lastSpawnTime:0,spawnInterval:20,spawn:(e,t,a,n,o,i=2e3)=>{let r=Ue.get();return r||(r=((e,t,a,n,o="#ff0",i=1e3)=>({x:0,y:0,vx:0,vy:0,color:o,life:i,maxLife:i,update:(e,t)=>(e.x+=e.vx*t*.01,e.y+=e.vy*t*.01,e.vy+=1*t*.01,e.vx*=.99,e.life-=t,e.life>0),render:e=>{const t=e.life/e.maxLife,a=Math.max(1,4*t);f.globalAlpha=t,f.fillStyle=e.color,f.fillRect(e.x-a/2,e.y-a/2,a,a),f.globalAlpha=1}}))(0,0,0,0,"#fff",i)),r.x=e,r.y=t,r.vx=a,r.vy=n,r.color=o,r.life=r.maxLife=i,U.push(r),r},spawnAt:(e,t,a=1,n={})=>{const o=[];for(let i=0;i<a;i++){const a=He.spawn(e+(Math.random()-.5)*(n.spread||20),t+(Math.random()-.5)*(n.spread||20),(Math.random()-.5)*(n.speed||100),(Math.random()-.5)*(n.speed||100),n.colors?n.colors[Math.floor(Math.random()*n.colors.length)]:"#ff0",n.life||2e3);o.push(a)}return o},burst:(e,t,a=10,n={})=>He.spawnAt(e,t,a,{spread:n.spread||30,speed:n.speed||150,colors:n.colors||["#ff0","#f0f","#0ff","#f00","#0f0"],life:n.life||1500}),update:(e,t)=>{}},_e=(e,t)=>{for(let a=e.length-1;a>=0;a--){const n=e[a];!1===n.update(n,t)&&(void 0!==n.maxLife&&Ue.put(n),e.splice(a,1))}},We=e=>{e.forEach(e=>e.render(e))};function De(e){const t=e-B;B=e,function(e){N+=e,_e("title"===_?H:U,e),_e(V,e),He.update(e,N)}(t),function(){if(function(e){if(g){let t,a,n,o,i=0|g.width,r=0|g.height,l=m.getImageData(0,0,i,r),s=l.data,c=16e-5*e;for(a=0;a<r;a++)for(t=0;t<i;t++)n=4*(a*i+t),o=.5*((Math.sin(t/i*12.566)+Math.sin(3.14159*(a/r*4-1.2*c))+Math.sin(3.14159*(3*(t/i+a/r)+.7*c)))/(3*(Math.cos(3*c)+2))+1),o=(7*o+.5|0)/7,s[n]=5+15*o|0,s[n+1]=40+80*o|0,s[n+2]=28+58*o|0,s[n+3]=255;m.putImageData(l,0,0)}}(N),f.clearRect(0,0,u.width,u.height),d.clearRect(0,0,p.width,p.height),"title"===_)We(H);else if("gameOver"===_)P("GAME OVER",u.width/2,u.height/2-28,"#f00",3,"center"),P(`FINAL SCORE ${W}`,u.width/2,u.height/2+2,"#fff",2,"center"),W===D&&P("NEW HIGH SCORE!",u.width/2,u.height/2+28,"#ff0",2,"center"),P("TAP TO CONTINUE",u.width/2,u.height/2+56,"#0f0",1,"center");else{if(F>0){f.fillStyle="#333",f.fillRect(Y.x,Y.y,40,60),f.fillStyle="#666",f.fillRect(Y.x+2,Y.y+2,36,56);const e=Y.x+20,t=Y.y+30;P(`${F}`.toString(),e,t,"#fff",2,"center")}"playing"===_&&oe.pounceSelecting&&P("SELECT A COMBO CARD",u.width/2,10,"#ff0",1,"center")}"playing"===_||"evaluating"===_?(We(U),We(V)):("title"===_||"gameOver"===_)&&V.forEach(e=>{e.isAbilityButton||e.isHudScore||e.render(e)})}(),requestAnimationFrame(De)}function Fe(){let e=matchMedia("(orientation: portrait)").matches,t=e?1:2,a=e?2:1,n=Math.min(innerWidth/(256*t),innerHeight/(240*a)),o=256*n+"px",i=240*n+"px";u.style.width=p.style.width=o,u.style.height=p.style.height=i,ye()}window.addEventListener("resize",Fe),window.addEventListener("orientationchange",Fe),Fe();let Xe=!1;!async function(){await function(){const e=e=>new Promise(t=>{if(e.complete&&e.naturalWidth>0)return t();const a=()=>t();e.addEventListener("load",a,{once:!0}),e.addEventListener("error",a,{once:!0})});return Promise.all([e(J),e($)])}(),Xe=!0,Se(),requestAnimationFrame(De)}();
