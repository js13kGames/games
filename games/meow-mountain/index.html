<!doctype html><title>Meow Mountain - js13kGames 2025</title><link rel="shortcut icon" type=image/x-icon><style>canvas{height:100%;width:100%;position:absolute;image-rendering:pixelated;object-fit:contain}body,html{margin:0;display:flex;justify-content:center;align-items:center;height:100%;background:#13282b}#c1{background-size:2px 2px}</style><canvas height=540 id=c1 width=960></canvas><canvas height=540 id=c2 width=960></canvas><canvas height=540 id=c3 width=960></canvas><canvas height=540 id=c4 width=960></canvas><script>function t(t,s,i=0,h=0){K.push({t:t,time:s,i:s+h,repeat:i})}function s(t){for(let s=K.length-1;s>=0;s--){const i=K[s];if(!i)return;i.i-=t,i.i>0||(i.t(),i.repeat-- >0?i.i=i.time:K.splice(s,1))}}function i(t,s){for(const i of["x","y"])if(t[i]!==t.h[i]){const h=t.h[i]-t[i],e=Math.sign(h)*t.speed*s/1e3;Math.abs(h)>Math.abs(e)?t[i]+=e:t[i]=t.h[i]}else t.o[i]=0,t[i]=Math.round(t[i])}let h;const e=new class{constructor(){this.l=!1,this.u=!1,this.M=!1,this.p=!1,this.m=!1,this.U=!1,this.k=!1,this.P=new Map,this.v={l:this.l,u:this.u,m:this.m,U:this.U},document.addEventListener("keydown",t=>this.A(t,!0)),document.addEventListener("keyup",t=>this.A(t,!1)),this.C=new DOMPoint}j(){this.v.l=this.l,this.v.u=this.u,this.v.m=this.m,this.v.U=this.U;const t=navigator.getGamepads()[0],s=this.P.get("KeyA")||this.P.get("KeyQ")||this.P.get("ArrowLeft")?-1:0,i=this.P.get("KeyD")||this.P.get("ArrowRight")?1:0,h=this.P.get("KeyW")||this.P.get("KeyZ")||this.P.get("ArrowUp")?-1:0,e=this.P.get("KeyS")||this.P.get("ArrowDown")?1:0;this.C.x=s+i||t?.axes[0]||0,this.C.y=h+e||t?.axes[1]||0,this.l=0>this.C.y,this.u=this.C.y>0,this.M=0>this.C.x,this.p=this.C.x>0,this.k=0!==this.C.x||0!==this.C.y,this.m=!!this.P.get("Enter"),this.U=!!this.P.get("Space")}A(t,s){this.P.set(t.code,s)}},n=t=>t.getContext("2d"),a=(t,s)=>{const i=((t,s)=>{const i=document.createElement("canvas");return t&&(i.width=t),s&&(i.height=s),i})(t,s);return[i,n(i)]},o=(t,s,i,h)=>128>h?[0,0,0,0]:[51*Math.round(t/51),51*Math.round(s/51),51*Math.round(i/51),255],r=(t,s=10)=>{const i=Math.floor(1.25*s),h=Math.floor(.25*s/2),[e,n]=a(i,i);n.font=s+"px sans-serif",n.textBaseline="top",n.clearRect(0,0,i,i),n.translate(-1,0),n.fillText(t,h,h);const r=n.getImageData(0,0,i,i).data,c=n.createImageData(i,i),l=c.data;for(let t=0;r.length>t;t+=4){const[s,i,h,e]=o(r[t],r[t+1],r[t+2],r[t+3]);l[t]=s,l[t+1]=i,l[t+2]=h,l[t+3]=e}const[u,d]=a(i,i);d.putImageData(c,0,0);const f=new Image;return f.src=u.toDataURL(),f},c=(t,s)=>{const i=["#000000",...s],h=i.length>4?2:i.length>2?3:6,e=6/h,n=(1<<e)-1,a=document.createElement("canvas"),o=Math.sqrt(t.length*h);a.setAttribute("width",""+o),a.setAttribute("height",""+o);const r=a.getContext("2d"),c=r.createImageData(o,o),l=c.data;let u=0;[...t].map(t=>{const s=t.charCodeAt(0);for(let t=0;h>t;t++){const h=s>>t*e&n,a=(i[h]||"#000000").replace("#",""),o=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16),d=h?255:0;l[u]=o,l[u+1]=r,l[u+2]=c,l[u+3]=d,u+=4}}),r.putImageData(c,0,0);const d=new Image;return d.src=a.toDataURL(),d};class l{constructor(t){this.B=t,this.T={},this.I=16;for(const[s,i]of Object.entries(t.data))this.T[s]=i.map(s=>c(s,t.palette));this.I=t.size}}const u="#7daf84",d="#4c8568",f="#396a50",p="#b4ecf3",m="#86bec6",g="#4e9ca6",y="#2f6269",x="#255056",w="#1f4347",M="#13282b",P="#e0b8d3",k="#714162",U="#996a8a",b="#f2daab",v="#e6a386",S="#13282b",E="#fffef9",I={size:10,frames:4,palette:[S],data:{0:["@@@`@PJbcxpO|AQ@@","@@@`@DJbcxpO|AQ@@","@@@@h@nag|pG|AQ@@","@@@@@@z`SxxO|AQ@@"],1:["@@@`@DJbcxpO|AR@@","@@@P@HJdCy`OpC`@@","@@@@@DJbCy`OxCR@@","@@@H@DJbcxpO|AA@@"],2:["@@@@@@@`ZxyO~@B@@","@@@@@@J`_|xG~@E@@","@@@@@@@`ZxyO~PB@@","@@@@@@J`CxG~@D@@"],3:["@@@@AHJdCy`OxCb@@","@@@@@@jcC`C@@@@@","@@@@@@@@@x|oxG@@@","@@@@@@@@@@@N~yC@"],4:["@@@`@DJbcxpO|AQ@@","@@@@@BPhHN|Ka@@@","@@@D@BEqQ\\xG~`P@@","@@@P@DJbcxpO|AQ@@"],5:["@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@","@`@H@F`Wy_~GsPD@@","@`@H@B`Qy_~GwPD@@"],6:["@@@@@@@@@h~_~K@@@","@@@@@@@`Bx~_~E@@@","@@@@@@@`Bx}o~A@@@","@@@@@@@@@h|~C@@@"]}},R={size:8,frames:4,palette:[P,M],data:{0:["PUAUUQVVTUEUUajj`@B@`@","@@@TUPUUdeEUUQUUhjJH`@","PUAUUQVVTUEUUajj`@BH@@","@@@TUPUUdeEUUQUUhjJH`@"],1:["@@@TUPUUTfEiiQUUhjJH`@","@@@UETUEeYQZZTUEjjBBH@"]}},C={palette:[g,y,x],data:"@@@@@@@DD@@@`e@@@@jB@@@hJ@@@@O@@@@}A@@@xK@@@`o@@@p~N@@T{{E@TmoWAPUUUE@WUUu@|C@C@"},j={palette:[g,y,x],data:"@PUE@@`UUB@@VUI@@xo@@poC@@kjN@@l{@@p~C@@kjN@@|o@@p{~C@@{O@@|k@@pC@@|C@@@@@@@"},A={palette:[f,u,"#b3d7ad"],data:"@@@@@@@UU@@@yF@@yoA@i~oZ@djjjAPjjjF@ijjZ@TjjZAPfiYF@eYYV@PYZV@@PUE@@@UU@@@PU@@@@@@@@"},Y={palette:[y,p,g],data:"@@T@@@@dF@@@djA@@tk_@@tG@P_@P}E@]]@Twu]APw}]G@u]]W@P]_W@@PUE@@@UU@@@PU@@@@@@@@"},X={palette:[d,f,u],data:"@U@T@PyEUSqmu}uMn_wuW{w]_WK^}mwmh}m_gPwuwmB]_WWBwu}]Oxnww~c~m_]OX_{]mP}mow@Vvj\\B`bB`B@"},O={palette:[x,g,y],data:"PU@@@PjVUU@YyGdjWU]PkAm^UUGt_PWUUuA}GTUUUUpjjjjC[_ZUNlk}ypvgVgCkjZ_N|}}@"};"ðŸ”¥,ðŸ€,ðŸŒ¼,ðŸ“,ðŸŒ·,ðŸŒ¹,ðŸ‘»,ðŸ¥š,ðŸŽ".split(",").map(t=>r(t));class z{static initialize(){z.O=new l(I),z.W=new l(R),z.D=((t=k)=>{const[s,i]=a(16,16);i.clearRect(0,0,16,16),i.fillStyle=t,i.fillRect(0,0,1,1),i.fillRect(1,0,1,1),i.fillRect(0,1,1,1),i.fillRect(14,0,1,1),i.fillRect(15,0,1,1),i.fillRect(15,1,1,1),i.fillRect(0,14,1,1),i.fillRect(0,15,1,1),i.fillRect(1,15,1,1),i.fillRect(15,14,1,1),i.fillRect(14,15,1,1),i.fillRect(15,15,1,1);const h=new Image;return h.src=s.toDataURL(),h})(),z.oak=c(A.data,A.palette),z.spruce=c(Y.data,Y.palette),z.house=c(O.data,O.palette),z.S=c(X.data,X.palette),z.statue=c(C.data,C.palette),z._=c(j.data,j.palette)}}const T="6v7ic,6trd0,6to3o,6nvic,55eyo,2np50,2jcjo,3ugt8,34ao,7k,glc,1,opzc,3xdeu,3sapz,8rhfz,8ri26,1bzky,9j1ny,3ws2u,9dv9k,3xb1i,3xbmu,2t8g,2t8s,26ndv,ajmo,fl5ug,3x7nm,n75t,54br,59u0e,53if,rlev,4jrb,1yjk4,4eav,55q95,18zsz,mi3r,574tl,1aedd,ljn9,a1bd,4f1i,a1fs,549t,53ig,5832,1dwsh,6iw6,6ix0,cbsa,6gix,6fk4,aky7,7mbws,cvtyq,deehh,2sfi3".split(","),B={},Q="]",F=t=>{if("0"===t)return{G:"0".repeat(25),H:0,J:5};const s=(parseInt(t,36).toString(2)+"").padStart(25,"0");let i=5,h=-1;for(let t=0;5>t;t++)for(let e=0;5>e;e++)"1"===s[5*e+t]&&(i=Math.min(i,t),h=Math.max(h,t));return{G:s,H:i,J:i>h?1:h-i+1}},N=(t,s,i,h,e,n=0)=>{for(let a=-e;e>=a;a++){const o=a/e,r=Math.round(h*Math.sqrt(1-o*o));if(r>0){const h=Math.round(n*Math.abs(a));t.rect(0>a?s-r+h:s-r-h,i+a,2*r,1)}}};class V{constructor(){this.N=0,this.V=0,this.F=0,this.K=0,this.zoom=1,this.$=0,this.Z=0,this.R=1,this.L=.08,this.Y=n(c1),this.q=n(c2),this.X=n(c3),this.tt=n(c4),z.initialize(),this.st(),window.addEventListener("resize",()=>this.st()),window.addEventListener("orientationchange",()=>this.st())}st(){this.N=1200,this.V=900;const t=[this.Y,this.q,this.X,this.tt];for(const s of t)s.canvas.width=1200,s.canvas.height=900,s.imageSmoothingEnabled=!1}it(t,s,i,h,e,n,a){t.save(),t.beginPath(),N(t,s,i,h,e),N(t,s,i,h-a,e-a),t.clip("evenodd"),t.beginPath(),t.fillStyle=n,t.fillRect(s-h,i-e,2*h,2*e),t.fill(),t.restore()}ht(t,s,i,h,e=0,n=0,o=2,r=1,c){((t,s,i,h,e=E,n=0,o=0,r=2,c=1)=>{i=Math.round(i),h=Math.round(h),s||(s=" ");const l=c*r,u=s.replace("!","@").toUpperCase().split("");let d=0;const f=[];u.forEach((t,s)=>{const i=(h=" "===t?"0":T[t.charCodeAt(0)-35],F(h).J*r);var h;f.push({char:t,x:d,J:i}),d+=i+(u.length-1>s?l:0)});const p=5*r,m=0===n?0:1===n?Math.round(d/2):d,g=0===o?0:1===o?Math.round(p/2):p;f.forEach(({char:s,x:n,J:o})=>{if(" "===s)return;const c=((t,s,i)=>{const h=`${t.charCodeAt(0)}-${i}-${s}`;return B[h]||(B[h]=((t,s,i)=>{const h=" "===t?"0":T[t.charCodeAt(0)-35],{G:e,H:n,J:o}=F(h),r=o*s,c=5*s,[l,u]=a(r,c),[d,f,p,m]=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(t,s,i,h,e)=>"#"+s+s+i+i+h+h+e+e).substring(1).match(/.{2}/g).map(t=>parseInt(t,16)),g=`rgba(${d}, ${f}, ${p}, ${(m||255)/255})`;return e.split("").forEach((t,i)=>{if("0"!==t){const t=i%5,h=Math.floor(i/5);if(n>t)return;const e=t-n;u.fillStyle=g,u.fillRect(e*s,h*s,s,s)}}),l})(t,s,i)),B[h]})(s,r,e);t.drawImage(c,0,0,o,p,i-m+n,h-g,o,p)})})(c||this.Y,t,s,i,h,e,n,o,r)}static drawImage(t,s,i,h,e,n,a){e&&(t.save(),t.scale(-1,1),i=-i-(n??s.width)),t.drawImage(s,i,h,n??s.width,a??s.height),e&&t.restore()}et(t,s,i,h,e,n){V.drawImage(this.Y,t,s,i,h,e,n)}ot(t,s,i=1,h=!1){this.$=t,this.Z=s,this.R=i,this.Y.setTransform(this.zoom,0,0,this.zoom,this.N/2-32-this.F*this.zoom,this.V/2-64-this.K*this.zoom),h&&(this.F=t,this.K=s,this.zoom=i)}nt(){this.F+=(this.$-this.F)*this.L,this.K+=(this.Z-this.K)*this.L,this.zoom+=(this.R-this.zoom)*this.L}rt(){this.Y.setTransform(1,0,0,1,0,0)}clear(){this.rt(),this.Y.clearRect(0,0,this.N,this.V),this.Y.fillStyle=d,this.Y.fillRect(0,0,this.N,this.V),this.q.clearRect(0,0,this.N,this.V),this.X.clearRect(0,0,this.N,this.V)}ct(t,s,i=7){return{x:this.N/2-32+(t-this.F)*i,y:this.V/2-64+(s-this.K)*i}}}const D=new V;let K=[];const J=12,L=11,W=20,_=[[[69,100,3],[76,113,4],[89,114,5],[104,86,3],[99,59,3],[85,46,2],[86,28,2],[74,38,2],[60,39,2],[48,30,2],[46,43,2],[38,61,3],[50,73,4],[38,84,3],[46,123,3],[36,133,2],[48,141,3],[94,133,4],[113,109,5],[122,74,6],[113,56,.9]],[[45,49,.9],[71,51,.9]],[[119,54,1],[129,29,1]]],H=[{x:64,y:88,r:6},{x:75,y:88,r:6},{x:69,y:95,r:6},{x:129,y:28,r:10},{x:71,y:51,r:3}],q={lt:{x:76,y:84,name:"heart"},ut:{x:129,y:19,name:"moon"},ft:{x:49,y:29,name:"ear"},eye:{x:71,y:50,name:"eye"},dt:{x:35,y:131,name:"foot"},wt:{x:114,y:56,name:"tail"}};class G{constructor(t,s,i,h,e,n=0,a=!1){this.Mt=t,this.x=s,this.y=i,this.type=h,this.animation=e,this.speed=n,this.yt=a,this.xt=0,this.gt=0,this.Ut=150,this.bt=!0,this.o={x:0,y:0},this.kt=Math.ceil(s/J),this.Pt=Math.ceil(i/L),this.xt=Math.random()*this.Ut,this.h={x:this.x,y:this.y}}vt(t,s){this.kt=t,this.Pt=s,this.x=t*J,this.y=s*L,this.h={x:this.x,y:this.y}}update(t){(this.bt||this.gt!==this.Mt.T[this.animation].length-1)&&(this.xt+=t,this.gt=Math.floor(this.xt/this.Ut)%this.Mt.T[this.animation].length)}At(t){i(this,t),0!==this.o.x&&(this.yt=0>this.o.x)}draw(){const t=this.Mt.T[this.animation];t[this.gt]&&D.et(t[this.gt],this.x-(this.Mt.I-J)/2,this.y-(this.Mt.I-L)/2,this.yt)}}const Z=(t,s)=>{document.addEventListener(t+"",t=>{s(t.detail)})},$=(t,s)=>{document.dispatchEvent(new CustomEvent(t+"",{detail:s}))},tt=(t,s,i,h)=>{const e=[];let n,a=Math.abs(i-t),o=i>t?1:-1,r=-Math.abs(h-s),c=h>s?1:-1,l=a+r;for(;e.push([t,s]),t!==i||s!==h;)n=2*l,r>n||(l+=r,t+=o),n>a||(l+=a,s+=c);return e};class st{constructor(t,s,i,h,e=Math.PI/2,n=12,a=0,o=0,r=300,c=16,l=0,u=1,d=!0){this.Ct=t,this.jt=h,this.Et=e,this.radius=n,this.offset=a,this.Bt=o,this.speed=r,this.Tt=c,this.It=l,this.Ot=u,this.active=d,this.cx=s+6,this.cy=i+5.5;const f=((t,s,i,h)=>{const e=[];for(let n=0;5>n;n++){const a=2*Math.PI*(2*n%5)/5-Math.PI/2+i;e.push([Math.round(t+h*Math.cos(a)),Math.round(s+h*Math.sin(a))])}return e})(this.cx,this.cy,e,n);this.Wt=[];for(let t=0;5>t;t++){const[s,i]=f[t],[h,e]=f[(t+1)%5];this.Wt.push(...tt(s,i,h,e))}this.Dt=this.Wt.length*this.Ot*1e3/this.speed}update(t){if(!this.active)return;const s=Math.floor(this.Bt/1e3*this.speed)%this.Wt.length;if(this.offset>s&&(this.It++,this.It>=this.Ot))return this.active=!1,void this.jt();this.offset=s,this.Bt+=t}draw(){if(!this.active)return;this.Ct.fillStyle=E;const t=Math.min(this.Tt,this.offset);for(let s=0;t>s;s++){const t=(this.offset-s+this.Wt.length)%this.Wt.length,[i,h]=this.Wt[t];this.Ct.fillRect(i,h,1,1)}}isActive(){return this.active}}const it=(t,s,i,h=!1)=>{for(let e=-1;1>=e;e++)for(let n=-1;1>=n;n++)(h||0!==e||0!==n)&&i(t+n,s+e)};let ht=null;const et=t=>{ht||(ht=new AudioContext);const s=ht.createBuffer(1,96e3,48e3),i=s.getChannelData(0);for(let s=96e3;s--;)i[s]=t(s);const h=ht.createBufferSource();h.buffer=s,h.connect(ht.destination),h.start()},nt=(t=1)=>et(s=>{const i=2e3*t;return s>i?0:.15*(2*Math.random()-1)*Math.sin(Math.PI*s/i)}),at=t=>et(s=>Math.sin(s/(20-t)+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9);class ot extends G{constructor(s,i,h,e){super(z.O,s*J,i*L,"cat",6,80),this.map=h,this.St=e,this.type="cat",this._t=!0,this.zt=!1,this.Gt=!1,this.Ht=!1,this.Jt=null,this.Qt=0,this.Ut=600,this.map.Nt={kt:s+1,Pt:i},Z(7,()=>{this.vt(q.lt.x,q.lt.y+1)}),Z(6,()=>{this._t=!1,this.Ut=150}),Z(12,()=>{this.Gt=!0,this.Ut=75,t(()=>{this.Ut=150,this.Gt=!1},600)}),Z(18,()=>{this.animation=3,this.xt=0,this.Ut=600,this.bt=!1})}update(s){if(super.update(s),3===this.animation)return;2==this.animation?(this.Qt-=s,this.Qt>0||(nt(),this.Qt=200)):this.Qt=0;const i=this.map.grid[this.Pt][this.kt].Vt;if(!this.Ht&&i?(this.Ht=!0,$(10,i)):this.Ht&&!i&&(this.Ht=!1),!this.St.Ft){if(this.Gt&&!this.Kt())this.animation=5;else if(this._t)this.animation=6;else if(this.zt)this.animation=4;else{if(super.At(s),!this.o.y&&e.C.y){const t=this.Pt+e.C.y;this.map.grid[t][this.kt].content||(this.animation=2,this.o.y=e.C.y,this.h.y+=e.C.y*L,this.Pt=t),this.map.Nt={kt:this.kt,Pt:this.Pt+e.C.y}}if(!this.o.x&&e.C.x){this.yt=e.M;const t=this.kt+e.C.x;this.map.grid[this.Pt][t].content||(this.animation=2,this.o.x=e.C.x,this.h.x+=e.C.x*J,this.kt=t),this.map.Nt={kt:this.kt+e.C.x,Pt:this.Pt}}this.o.x||this.o.y||(this.animation=0),this.zt||this.$t(),this.zt||!e.U||e.v.U||(this.zt=!0,this.xt=0,!this.Jt&&this.Kt()?this.Jt=new st(D.Y,this.x,this.y,()=>{this.Jt=null,this.Zt(),this.zt=!1,et(t=>t>29e3?0:.2*(t>17400?Math.pow(.9999,t-17400):1)*Math.sin(t/(30-5*Math.sin(5*Math.round(5*t/29e3)))+Math.random())*(8e3-t%6e3)/5e3)}):(t(()=>this.Rt(),500),t(()=>{this.zt=!1},5*this.Ut)))}this.Jt?.update(s)}}Zt(){it(this.kt,this.Pt,(t,s)=>{const i=this.map.grid[s][t];"spirit"===i.content?.type&&i.content.Lt(5)})}Kt(){let t=0;return it(this.kt,this.Pt,(s,i)=>{const h=this.map.grid[i][s];"spirit"===h.content?.type&&t++}),t>=3}draw(){super.draw(),this.Jt?.draw()}$t(){const t=this.map.Yt();if(t?.content)return;const s=[{kt:this.kt+1,Pt:this.Pt},{kt:this.kt-1,Pt:this.Pt},{kt:this.kt,Pt:this.Pt+1},{kt:this.kt,Pt:this.Pt-1}];let i=null,h=null;for(const t of s){const s=this.map.grid[t.Pt][t.kt];if(!s.content)continue;const e=s.content.type;if("spirit"===e){i=t;break}"statue"!==e&&"obelisk"!==e||h||(h=t)}i?this.map.Nt=i:h&&(this.map.Nt=h)}Rt(){const t=this.map.Yt();t.content&&"spirit"===t.content.type?(t.content.Lt(1),et(t=>{if(t>1e4)return 0;const s=5*Math.sin(5*Math.round(5*t/1e4));return.2*Math.pow(.998,t/10)*Math.sin(t/(40-s)+Math.random())*(8e3-t%6e3)/5e3})):t.content&&"field"===t.content.type&&(t.content=null,nt(3))}}class rt{constructor(t,s,i,h){this.qt=t,this.x=s,this.y=i,this.type=h,this.kt=Math.ceil(s/J),this.Pt=Math.ceil(i/L),this.offsetX=s-Math.round((t.width-J)/2),this.offsetY=i-Math.round((t.height-L)/2)}draw(){D.et(this.qt,this.offsetX,this.offsetY)}}class ct extends rt{constructor(t,s,i){super(z[i],t,s,i),this.x=t,this.y=s,this.Xt={top:!1,bottom:!1,left:!1,right:!1}}ts(t){this.Xt=t}draw(){this.Xt.right&&D.et(this.qt,Math.round(this.offsetX+6),this.offsetY-5.5),super.draw()}}class lt{constructor(t=47){this.ss=t}next(){return this.ss=(9301*this.ss+49297)%233280,this.ss/233280}range(t,s){return t+this.next()*(s-t)}}class ut extends rt{constructor(t,s){super(z.house,t*J,s*L,"house")}}class dt extends G{constructor(t,s,i){super(z.W,t*J,s*L,"villager",0,10),this.map=i,this.hs=null,this.es=0,this.ns=1e3,this.rs=!1}update(t){super.update(t),this.es+=t,this.cs()?(this.rs||this.ns>this.es||(this.es=0,this.rs=!0),t>this.es%(this.ns/5)&&$(15),this.animation=1,this.Ut=50):(this.rs=!1,this.Ut=150,this.ns>this.es||(this.ls(),this.es=0),this.At(t))}ls(){const t=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}];if(this.hs&&.8>Math.random()){const t=this.kt+this.hs.x,s=this.Pt+this.hs.y;if(this.us(t,s))return this.kt=t,this.Pt=s,this.h={x:t*J,y:s*L},this.hs=this.hs,void(this.animation=0)}for(let s=0;10>s;s++){const s=t[Math.floor(4*Math.random())],i=this.kt+s.x,h=this.Pt+s.y;if(this.us(i,h))return this.kt=i,this.Pt=h,this.h={x:i*J,y:h*L},this.hs=s,void(this.animation=0)}}us(t,s){return null===this.map.grid[s][t].content}cs(){if(!this.hs)return!1;for(let t=1;2>=t;t++){const s=this.kt+this.hs.x*t,i=this.Pt+this.hs.y*t,h=this.map.grid[i]?.[s];if("cat"===h?.content?.type)return!0}return!1}}class ft extends rt{constructor(t,s){super(z.S,t*J,s*L,"field")}}class pt{constructor(t,s,i,h,e){this.name=t,this.fs=s,this.radius=i,this.ds=h,this.ws=e,this.Ms=[],this.ps=[],this.ys=[],this.fs=s,this.radius=i}xs(t,s){let i,h;do{const s=t.range(0,2*Math.PI),e=t.range(1,this.radius-1);i=Math.round(this.fs.x+Math.cos(s)*e),h=Math.round(this.fs.y+Math.sin(s)*e)}while(0>i||0>h||s.some(t=>t.x===i&&t.y===h));return{x:i,y:h}}gs(t){for(let s=0;this.ds>s;s++){const s=this.xs(t,this.Ms);this.Ms.push(new ut(s.x+s.x%2,s.y+s.y%2))}return this.Ms}Us(t){const s=this.ds;for(let i=0;s>i;i++){const s=this.xs(t,this.ps);for(let t=0;2>t;t++)for(let i=0;2>i;i++)this.ps.push(new ft(s.x+t,s.y+i))}return this.ps}bs(t,s){for(let i=0;this.ws>i;i++){const i=this.xs(t,this.ps);this.ys.push(new dt(i.x,i.y,s))}return this.ys}}class mt{constructor(t,s,i,h){this.icon=t,this.kt=s,this.Pt=i,this.type=h,this.x=Math.round(this.kt*J+(J-this.icon.width)/2),this.y=Math.round(this.Pt*L+(L-this.icon.height)/2)}draw(){D.et(this.icon,this.x,this.y)}}const gt=[{x:0,y:-1},{x:0,y:1},{x:1,y:0},{x:-1,y:0}],yt=(t,s)=>`${t},${s}`,xt=(t,s,i)=>{const h=[];let e=i;for(;e!=s;)h.unshift(e),e=t[yt(e.kt,e.Pt)];return h.unshift(s),h},wt=[m,g,U,k],Mt=(t,s,i,h,e=wt)=>{const n=Math.ceil(12*Math.max(0,Math.min(1,t/s))),a=i,o=h-5;D.Y.fillStyle=e[0],D.Y.fillRect(a,o,n,1),D.Y.fillStyle=e[1],D.Y.fillRect(a,o+1,n,1),D.Y.fillStyle=e[2],D.Y.fillRect(a+n,o,12-n,1),D.Y.fillStyle=e[3],D.Y.fillRect(a+n,o+1,12-n,1)},Pt=["â˜ï¸","ðŸ¥¨","ðŸŒµ","ðŸ§šðŸ»â€â™€ï¸","ðŸ¦€","ðŸ‘»","ðŸ‘¹","ðŸ§¿","ðŸ’€"].reduce((t,s,i)=>(t[s]={icon:r(s),type:s,level:Math.ceil(i/2)},t),{});class kt extends mt{constructor(t,s,i,h){super(Pt[i].icon,t,s,"spirit"),this.Ut=2e3,this.xt=0,this.opacity=0,this.ks=9,this.es=0,this.ns=600,this.o={x:0,y:0},this.speed=20,this.Ps=!1,this.vs=!1,this.state=0,this.As=0,this.Cs=1e3,this.js=null,this.Es=0,this.Bs=0,this.species=Pt[i],this.map=h,this.h={x:this.x,y:this.y},this.Ts=Math.round(Math.pow(1.5,this.species.level+1)),this.Is=this.Ts}update(t){if(this.Is>0)switch(this.xt+=t*Math.pow(this.species.level+.5,2),1>this.opacity&&(this.opacity+=t/this.Ut),this.Ut>this.xt||(this.xt-=this.Ut),this.state){case 0:case 1:i(this,t);const s=this.Os();s&&(this.es+=t,this.ns>this.es||(this.Ws(s),this.es=0));break;case 2:case 3:case 4:this.Ds(t)}}Ds(t){this.As+=t;const s=this.As/this.Cs;if(!this.js)return void(this.state=0);const i=this.js.kt-this.kt,h=this.js.Pt-this.Pt;if(.7>s){2!==this.state&&(this.state=2);const t=s/.7;this.Es=-i*t*3,this.Bs=-h*t*3}else if(.73>s){3!==this.state&&(this.state=3);const t=(s-.7)/.03;this.Es=i*(J*t-3),this.Bs=h*(J*t-3)}else if(1>s){if(4!==this.state){this.state=4;const t=this.map.grid[this.js.Pt][this.js.kt];"cat"===t.content?.type&&$(12,this.species.level)}const t=(s-.73)/.27;this.Es=3*i*(1-t),this.Bs=3*h*(1-t)}else this.state=0,this.As=0,this.js=null,this.Es=0,this.Bs=0}Os(){for(let t=-this.ks;this.ks>=t;t++)for(let s=-this.ks;this.ks>=s;s++){const i=this.kt+t,h=this.Pt+s,e=this.map.grid[h][i];if("cat"===e.content?.type)return{kt:i,Pt:h}}return null}Ws(t){const s=((t,s,i,h=100)=>{let e=h;const n=[s],a=new Set,o={};for(;0!==n.length&&e--;){const h=n.shift();if(h.kt===i.kt&&h.Pt===i.Pt)return xt(o,s,i);gt.map(({x:s,y:i})=>t[h.Pt+i][h.kt+s]).forEach(t=>{a.has(t)||(a.add(t),(null===t.content||t.x==i.kt&&t.y==i.Pt)&&(o[yt(t.x,t.y)]=h,n.push({kt:t.x,Pt:t.y})))})}})(this.map.grid,{kt:this.kt,Pt:this.Pt},t);if(s&&s.length>2){this.state=1;const t=s[1];h=t.Pt,(i=this).h.x=t.kt*J,i.h.y=h*L,this.kt=t.kt,this.Pt=t.Pt,this.h.x=t.kt*J,this.h.y=t.Pt*L}else 2===s?.length&&(this.state=2,this.js=s[1],this.As=0);var i,h}draw(){const t=Math.sin(this.xt/this.Ut*2*Math.PI);D.Y.save(),D.Y.globalAlpha=this.opacity,D.Y.fillStyle=`rgba(0,0,0,${Math.round(2+1*t)/10})`,D.Y.fillRect(this.x+3+this.Es,this.y+8.25+this.Bs,this.icon.width-6,3.75),this.Ts>this.Is&&Mt(this.Is,this.Ts,this.x,this.y),D.Y.save(),this.vs&&(D.Y.filter="sepia(1) saturate(2) hue-rotate(260deg) brightness(0.7)"),D.Y.translate(this.Es,this.Bs+Math.round(2*(t-1))),super.draw(),D.Y.restore(),D.Y.restore()}Lt(s=1){return this.Is-=s,this.vs=!0,t(()=>{this.vs=!1},150),this.Is>0||t(()=>{(()=>{const t=~(1e3*Math.random());et(s=>Math.sin(s/(10+s/8e3-s/12e3)&t+5*Math.sin(s/2e3))*Math.exp(-s/4e3)*(s/96e3)*9)})(),this.Ps=!0},1500),0>=this.Is}}class Ut extends rt{constructor(t,s,i,h,e){super(z.statue,t*J,s*L,"statue"),this.map=i,this.St=h,this.name=e,this.Ss=[],this._s=4,this.zs=0,this.Gs=1e3,this.Hs=.1,this.Js=10,this.Qs=0,this.state=Ut.Vs.Ns,this.xt=0,this.Fs=1500,this.Ks=0,this.$s=!1,this.Zs=0,this.Ut=800}update(t){if(this.xt+=t,this.zs+=t,this.state!==Ut.Vs.Ns||W>this.Qs?this.state===Ut.Vs.Rs&&(this.Ks+=t,this.Ks>this.Fs&&(this.state=Ut.Vs.Ls)):(this.state=Ut.Vs.Rs,this.$s=!1,this.Zs=0),this.zs>=this.Gs&&(this.zs=0,Math.random()<this.Hs))if(this.Ss.length<this._s+this.St.Ys())this.qs();else if(this.Ss.length>0){const t=this.Ss.filter(t=>t.Is===t.Ts)[Math.round(Math.random()*this.Ss.length-1)];t&&(t.Ps=!0,this.qs())}this.Ss=this.Ss.filter(t=>!t.Ps)}draw(){super.draw(),this.Qs>0&&W>this.Qs&&Mt(this.Qs,W,this.x,this.y,[b,v,w,M]),this.state===Ut.Vs.Ls&&this.Xs()}ti(){this.state===Ut.Vs.Rs&&this.si()}Xs(){D.Y.fillStyle=P;for(let t=0;5>t;t++){const s=(this.xt+.5*this.Ut*t)/this.Ut,i=2*t*Math.PI/3,h=3,e=Math.cos(i)*h,n=Math.sin(i)*h,a=6*Math.sin(s),o=3*Math.sin(2*s),r=a*Math.cos(i)-o*Math.sin(i),c=a*Math.sin(i)+o*Math.cos(i);D.Y.fillRect(Math.round(this.x+6+e+r),Math.round(this.y+L/3+n+c),1,1)}}si(){const t=3*this.Ks/this.Fs%1,s=c2.width/D.zoom,i=c2.height/D.zoom;D.it(D.Y,this.x+6,this.y+5.5,s*t,i*t,E,8),50>this.Ks-this.Zs||(this.map.ii(this.kt,this.Pt,this.Ks/this.Fs*20,!0,.05,1),this.Zs=this.Ks),this.$s||(this.Ss.forEach(t=>t.Lt(t.Is)),this.$s=!0)}qs(){const t=[],s=Math.round(this.St.Ys()+this.Js);for(let i=-s;s>=i;i++)for(let h=-s;s>=h;h++){const s=this.kt+i,e=this.Pt+h;null===this.map.grid[e][s].content&&t.push({x:s,y:e})}if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],i=Object.values(Pt).filter(t=>t.level<this.St.Ys());if(0===i.length)return;const h=i[Math.floor(Math.random()*i.length)],e=new kt(s.x,s.y,h.type,this.map);this.Ss.push(e),this.map.set(s.x,s.y,e)}}}Ut.Vs={Ns:0,Rs:1,Ls:2};class bt{constructor(t,s,i){this.hi=t,this.ei=s,this.St=i,this.oi=[],this.Nt={kt:0,Pt:0},this.ai=new lt,this.grid=Array.from({length:s},(s,i)=>Array.from({length:t},(t,s)=>{const h=s-70,e=i-90;let n;n=Math.sqrt(h*h+e*e)>40?.2>this.ai.next()?"spruce":"oak":.9>this.ai.next()?"spruce":"oak";const a=new ct(s*J-2,i*L-2.5,n);return{x:s,y:i,content:a}})),this.oi=[new pt("Heart Peak",{x:70,y:90},12,1,0),new pt("Pine Rest",{x:99,y:100},6,2,3),new pt("Oak Branch",{x:42,y:51},4,3,4),new pt("Cat Foot",{x:48,y:140},5,4,5),new pt("Black Tail",{x:113,y:107},4,5,8),new pt("Moon Town",{x:129,y:29},8,12,25)];for(const t of _)for(let s=0;t.length-1>s;s++)this.ni({x:t[s][0],y:t[s][1]},{x:t[s+1][0],y:t[s+1][1]},t[s][2]);for(const t of H)this.ii(t.x,t.y,t.r);for(let i=0;s>i;i++)for(let s=0;t>s;s++){const t=this.grid[i][s];t.content instanceof ct&&t.content.ts({top:this.grid[i-1]?.[s]?.content instanceof ct,bottom:this.grid[i+1]?.[s]?.content instanceof ct,left:this.grid[i]?.[s-1]?.content instanceof ct,right:this.grid[i]?.[s+1]?.content instanceof ct})}for(const t of this.oi){t.Us(this.ai).forEach(t=>{this.grid[t.Pt][t.kt].content=t}),t.gs(this.ai).forEach(t=>{this.grid[t.Pt][t.kt].content=t}),t.bs(this.ai,this).forEach(t=>{this.grid[t.Pt][t.kt].content=t});const{x:s,y:i}=t.fs,h=t.radius;for(let e=i-h;i+h>=e;e++)for(let n=s-h;s+h>=n;n++){const a=n-s,o=e-i;a*a+o*o>h*h||(this.grid[e][n].Vt=t)}}this.ri(1);for(const t of Object.values(q)){const{x:s,y:i,name:h}=t,e=new Ut(s,i,this,this.St,`cat ${h} altar`);s===q.lt.x&&(e._s=0),it(s,i,(t,s)=>{this.grid[s][t].content=new ft(t,s)}),this.grid[i][s].content=e}Z(17,()=>{this.set(64,89,new kt(64,89,"â˜ï¸",this))})}Yt(){return this.grid[this.Nt.Pt][this.Nt.kt]}ci(t,s){(this.grid[s][t].content instanceof ct||this.grid[s][t].content instanceof ft)&&(this.grid[s][t].content=null)}ri(t){const s=this.oi[0],{x:i,y:h}=s.fs;for(let s=h-12;h+12>=s;s++)for(let h=i-12;i+12>=h;h++){const i=this.grid[s][h];i.content||this.ai.next()>t?i.content instanceof ft&&this.ai.next()>t&&(i.content=null):i.content=new ft(i.x,i.y)}const e=[[61,86,2],[69,88,.9],[75,89,.9],[76,84,.9]];for(let t=0;e.length-1>t;t++)this.ni({x:e[t][0],y:e[t][1]},{x:e[t+1][0],y:e[t+1][1]},e[t][2])}ni(t,s,i){const h=Math.abs(s.x-t.x),e=Math.abs(s.y-t.y),n=s.x>t.x?1:-1,a=s.y>t.y?1:-1;let o=h-e,r=t.x,c=t.y;const l=i/2;for(;;){const t=1>i?0:1.2,u=Math.ceil(this.ai.range(-t,t)),d=Math.ceil(this.ai.range(-t,t));for(let t=-l;l>=t;t++)for(let s=-l;l>=s;s++){const h=Math.ceil(r+t+u),e=Math.ceil(c+s+d);this.ci(h,e),1>i?this.ai.next()>.5?this.ci(h+1,e):(this.grid[e][h].content=new ft(h,e),this.grid[e][h+1].content=new ft(h,e)):this.ai.next()>.1&&(this.ai.next()>.05?this.ci(h,e):this.grid[e][h].content=new ft(h,e))}if(r===s.x&&c===s.y)break;const f=2*o;f>-e&&(o-=e,r+=n),h>f&&(o+=h,c+=a)}}ii(t,s,i,h=!1,e=0,n=1){for(let a=0;this.ei>a;a++)for(let o=0;this.hi>o;o++){const r=o-t,c=a-s,l=Math.sqrt(r*r+c*c),u=i+this.ai.range(-i,i)/6;if(l>=u*e&&u>=l){const t=Math.min(1,(u-l)/2+.7)*n;this.ai.next()<t&&(!h||h&&this.grid[a][o].content instanceof ft)&&(this.grid[a][o].content=null)}}}set(t,s,i){this.grid[s]&&this.grid[s][t]&&(this.grid[s][t].content=i)}update(t){for(const s of this.grid)for(const i of s)i.content&&(i.content.update?.(t),i.x==i.content.kt&&i.y==i.content.Pt||(this.grid[i.content.Pt][i.content.kt].content=i.content,i.content=null),i.content&&i?.content?.Ps&&this.set(i.content.kt,i.content.Pt,null))}draw(t,s){const i=D.zoom,h=D.N/i/2+50,e=D.V/i/2+50,n=[];for(const i of this.grid)for(const a of i){const i=a.x*J,o=a.y*L,r=i-t,c=o-s;r*r+c*c>5625||(a.li=!0),a.y===this.Nt.Pt&&a.x===this.Nt.kt&&a.content&&"oak"!==a.content.type&&"spruce"!==a.content.type&&D.et(z.D,i-2,o-2.5),Math.abs(r)>h||Math.abs(c)>e||(a?.content?.draw(),a?.content?.ti&&n.push(a?.content))}n.forEach(t=>t.ti())}}const vt=(t,s,i)=>s+-(Math.cos(Math.PI*t)-1)/2*i,St={oak:u,spruce:g,house:x,field:b,statue:M,unseen:w,default:v};class Et{constructor(t){this.map=t,this.ui=0,this.updateInterval=100}update(t){this.ui+=t}draw(t){if(this.updateInterval>this.ui)return;this.ui=0;const s=D.tt,i=160,h=s.canvas.width-i-10,e=s.canvas.height-i-10;s.clearRect(h,e,i,i);for(let t=0;i>t;t++)for(let n=0;i>n;n++){const i=this.map.grid[t][n];s.fillStyle=i.li?St[i.content?.type||"default"]??St.default:St.unseen,s.fillRect(h+n,e+t,1,1)}t.kt>=0&&i>t.kt&&t.Pt>=0&&i>t.Pt&&(s.fillStyle=k,s.beginPath(),s.arc(h+t.kt,e+t.Pt,2,0,2*Math.PI),s.fill())}}class It{constructor(){this.fi=null,Z(3,t=>{this.fi=t}),Z(2,()=>{this.fi=null})}draw(){if(this.fi){const t=160,s=10,i=c3.width-t-3*s,h=s,e=c3.height-t-s;D.X.fillStyle=P,D.X.fillRect(h,e,i,t),this.fi.split("\n").forEach((t,i)=>{D.ht(t,h+2*s,e+2*s+40*i,">"===t[0]?k:S,0,0,5,1,D.X)}),D.ht("press (space) to continue",h+i-s,e+t-s,k,2,2,5,1,D.X)}}}class Rt{constructor(t,s,i,h){this.map=t,this.di=s,this.actions=i,this.St=h,this.wi=!1,this.Mi=!1,this.pi=!1,this.yi="",this.mi=0,this.xi=new Et(t),this.gi=new It,Z(9,()=>{this.Mi=!0}),Z(14,()=>{this.pi=!0}),Z(10,t=>{this.yi=t.name,this.mi=3e3}),Z(15,()=>{this.wi=!0})}update(t){this.xi.update(t),this.mi-=t}draw(){this.Mi&&this.Ui(),this.pi&&this.bi(),this.ki(),this.wi&&this.Pi(),this.Ai(),this.Ci(),this.Mi&&this.xi.draw(this.di),this.gi.draw()}Ai(){const t=this.actions.actions;if(!t||!t[0].enabled)return;const s=Math.round((D.X.canvas.width-(120*t.length+10*(t.length-1)))/2),i=D.X.canvas.height-120-10;t.forEach(({type:t,color:h,ji:e},n)=>{const a=s+130*n;D.X.fillStyle=P,D.X.fillRect(a,i,120,120),D.ht(e,a+60,i+30,h,1,1,7,1,D.X),D.ht(t,a+60,i+95,S,1,1,3,1,D.X)})}Ui(){const t=Math.floor(this.St.Ei),s=Math.floor(9-this.St.Ei),i=9-t-s,h=this.St.Ei-t,e="#".repeat(t)+(h>.3?"$":"%").repeat(i)+"&".repeat(s),n=5*(6*e.length+1);D.X.fillStyle=P,D.X.fillRect(16,16,n,35),D.ht(e,21,21,k,0,0,5,1,D.X)}bi(){let t=c3.width-16;const s=this.St.Bi,i=this.St.Ti-this.St.Bi,h=6-this.St.Ti;D.X.fillStyle=b,D.X.fillRect(t-185+5,16,185,35);let e=Q.repeat(s);t-=30*e.length,D.ht(e,t+5,21,g,0,0,5,1,D.X),e=Q.repeat(i),t-=30*e.length,D.ht(e,t+5,21,y,0,0,5,1,D.X),e=Q.repeat(h),t-=30*e.length,D.ht(e,t+5,21,v,0,0,5,1,D.X)}ki(){this.St.Ii.filter(t=>t.time>0).forEach((t,s)=>{const{label:i,time:h}=t,e=61+70*s;let n=0;h>4800?n=-526*(1-vt((5e3-h)/200,0,1)):200>h&&(n=-526*(1-vt(h/200,0,1)));const a=16+n;D.X.fillStyle=k,D.X.fillRect(a,e,510,65),D.ht("NEW GOAL",a+3+5,e+5,E,0,0,4,1,D.X),D.ht(i,a+3+5+20,35+e+5,S,0,0,3,1,D.X)})}Pi(){const t=Math.round(c3.width/2-115);D.X.fillStyle=P,D.X.fillRect(t,16,230,62),D.X.fillStyle=w,D.X.fillRect(t+5,21,220,25),D.X.fillStyle=this.St.Oi>.9?k:g,D.X.fillRect(t+5,21,3*Math.round(220*this.St.Oi/3),25),D.ht("superstition",c3.width/2,54,w,1,0,3,1,D.X)}Ci(){if(this.mi>0){const t=this.mi,s=vt(Math.max(0,Math.min(1,Math.min(t/150,(3e3-t)/150))),0,1);D.X.globalAlpha=s,this.Wi("^^ "+this.yi,170),D.X.globalAlpha=1}if(this.map.Nt){const t=this.map.Yt();t?.content?.name&&this.Wi(t.content.name,c3.height-170)}}Wi(t,s){D.X.fillStyle=U,D.X.fillRect(c3.width/2-175+4,s-18-4,342,43),D.X.fillStyle=v,D.X.fillRect(c3.width/2-175,s-18,350,35),D.ht(t,c3.width/2,s,k,1,1,3,1,D.X)}}class Ct extends rt{constructor(t){super(z._,828,968,"obelisk"),this.name="barrier obelisk",this.Qs=0,this.map=t,this.map.set(this.kt,this.Pt,this)}draw(){super.draw(),this.Qs>0&&Mt(this.Qs,W,this.x,this.y,[b,v,w,M])}Di(){W*(this.map.St.Bi/6)>this.Qs?(this.Qs++,at(2*this.Qs-10)):(at(-10),$(14)),this.Qs===W&&$(19)}}const jt=[{type:"scratch",color:k,enabled:!1,ji:"\\"},{type:"teleport",color:g,enabled:!0,ji:"["},{type:"repair",color:u,enabled:!0,ji:Q},{type:"sleep",color:v,enabled:!0,ji:"z"}];class At{constructor(t,s){this.actions=[],this.map=t,this.di=s,Z(9,()=>{this.actions[0].enabled=!0})}update(){const t=this.map.Yt(),s=this.Si(t),i=this._i(t),h=this.zi(t),n=this.Gi(t);if(this.actions=[n?jt[0]:s?jt[1]:i?jt[2]:h?jt[3]:jt[0]],e.U&&!e.v.U)switch(!0){case n:break;case s:$(7);break;case i:this.Hi(t);break;case h:$(11)}}Hi(s){$(8);const i=s.content;W>i.Qs&&(i instanceof Ut?(i.Qs++,at(i.Qs),W>i.Qs||t(()=>{$(13,this.map.St.Ti)},4e3)):i instanceof Ct&&i.Di())}_i(t){const s=t.content,i=s?.type;return("statue"===i||"obelisk"===i)&&W>s.Qs}Si(t){return t.content instanceof Ut&&this.di.kt!=q.lt.x&&t.content.state===Ut.Vs.Ls}zi(t){return t.content==this.map.oi[0].Ms[0]}Gi(t){return t.content instanceof kt||t.content instanceof ft}}class Yt{constructor(){this.Ft=!1,this.Ei=9,this.Ti=0,this.Bi=0,this.Oi=0,this.Ii=[],this.Ji=!1,this.Qi=!1,Z(15,()=>{this.Oi=Math.min(1,this.Oi+.01)}),Z(4,()=>{this.Ft=!0}),Z(5,t=>{this.Ft=!1,t.Ii&&t.Ii.forEach(t=>{this.Ii.push({label:t,time:5e3})})}),Z(12,t=>{this.Ei-=(t+1)/3,this.Ei=Math.round(3*this.Ei)/3,this.Ei=Math.round(10*this.Ei)/10,et(t=>{const s=1e4;if(t>s)return 0;const i=(s-t)/s;return((2*Math.random()-1)*Math.sin(.003*t)*.6+Math.sin(t/(15+8*Math.sin(t/500)))*Math.exp(-t/2e3)*.4)*i*i*.3}),this.Ei>0||(this.Ei=0,$(18))}),Z(13,()=>{this.Ti++,this.Bi=this.Ti,this.Ni()}),Z(11,()=>{this.Ni()})}Ni(){let s=0;for(let i=Math.floor(this.Ei)+1;9>=i;i++)t(()=>{this.Ei=i,et(t=>{const s=6e3;if(t>s)return 0;var i=(s-t)/s;return.5*Math.sin(.01*t*Math.sin(.007*t+Math.sin(t/1200))+Math.sin(t/800))*i*i})},500+800*s++)}update(t){this.Ii.forEach(s=>s.time-=t)}Ys(){return 4*this.Oi+this.Ti}}class Xt{constructor(t){this.Vi=t,this.Fi=null,this.Ki=0,this.isActive=!1,this.$i=!1,this.currentState=null,this.Zi="",this.Ri=0,this.Li=0,this.Yi=20,this.qi=2,Z(1,t=>{this.Xi(t)})}Xi(t){this.Vi[t]&&(this.Fi=t,this.currentState=t,this.Ki=0,this.isActive=!0,this.$i=!1,this.th())}update(t){if(!this.isActive||!this.Fi)return;const s=e.P.get("Space"),i=s&&!this.$i;if(this.$i=s||!1,0===this.qi){this.Li+=t;const s=Math.floor(this.Li/1e3*this.Yi);this.Zi.length>s?s>this.Ri&&(this.Ri=s,this.sh()):(this.Ri=this.Zi.length,this.qi=1,this.sh())}i&&this.ih()}ih(){if(this.Fi){if(0===this.qi)return this.Ri=this.Zi.length,this.qi=1,void this.sh();1===this.qi&&(this.Vi[this.Fi].hh.length-1>this.Ki?(this.Ki++,this.th()):this.eh())}}sh(){const t=this.Zi.substring(0,this.Ri);$(3,t)}th(){if(!this.Fi)return;const t=this.Vi[this.Fi];t.oh=!0,this.Zi=t.hh[this.Ki],this.Ri=0,this.Li=0,this.qi=0,this.sh()}eh(){if(!this.Fi)return;const t=this.Fi;this.isActive=!1,this.Fi=null,this.currentState=null,this.Ki=0,$(2,t)}}const Ot={1:{hh:["Zzzzz...","Yawwwn...","How long was i sleeping?..."]},2:{hh:["Evil spirits?","Has the magic barrier failed\nwhile I slept??","This one seems weak.","I'll exorcise it and then\ngo check the barrier","> Use (space) to attack"],Ii:["find magic barrier obelisk"]},3:{hh:["I have no magic power left!","My magic comes from villagers\nworshiping me...","Something must be wrong with\nthe cat altar."],Ii:["repair the cat altar"]},5:{hh:["I don't have enough magic!","Something must be wrong with\nthe cat altars in the valley"]},4:{hh:["My magic has increased a little.","But the other altars...\nthey must be damaged too."],Ii:["repair all 5 temples","restore the forest magic barrier"]},7:{hh:["Villagers are very supersticious.","I should not let them see me,\nthat will empower the evil spirits."]},6:{hh:["I have restore my full magic power","Now I am able to restore the\nmagic barrier again."],Ii:["restore the forest magic barrier"]},8:{hh:["The barrier is restored.\nTime for a well deserved nap..."]}};class zt{constructor(){this.ah=new Xt(Ot),Z(2,s=>{$(5,Ot[s]),1===s&&($(6),$(17),D.L=.08,t(()=>{$(1,2)},3e3)),2===s&&$(9),8===s&&$(20)}),Z(1,()=>{$(4)}),Z(14,()=>{$(1,Ot[3].oh?5:3)}),Z(13,t=>{$(1,6>t?4:6)}),Z(15,()=>{Ot[7].oh||$(1,7)}),Z(19,()=>{$(1,8)}),t(()=>this.ah.Xi(1),1e3)}update(t){this.ah.update(t)}}const Tt=new class{constructor(){this.startTime=0,this.nh=!1}async start(){this.nh||(this.rh=new(window.AudioContext||window.webkitAudioContext),await this.rh.resume(),await this.rh.audioWorklet.addModule("music-worklet.js"),this.uh=new AudioWorkletNode(this.rh,"mp"),this.uh.connect(this.rh.destination),this.nh=!0)}fh(){this.uh?.port.postMessage(0)}pause(){this.uh?.port.postMessage(1)}unpause(){this.uh?.port.postMessage(2)}stop(){this.nh&&(this.uh?.disconnect(),this.nh=!1)}};class Bt{constructor(){this.dh=!0}wh(){Tt.stop(),D.tt.clearRect(0,0,c4.width,c4.height)}Mh(){this.dh&&Tt.start(),Z(9,()=>{Tt.fh()}),Z(21,()=>{Tt.pause()}),Z(22,()=>{Tt.unpause()}),Z(18,()=>{t(()=>h.ph(Ft),3e3)}),Z(20,()=>{t(()=>h.ph(Ft),3e3)}),this.St=new Yt,this.map=new bt(160,160,this.St),this.O=new ot(60,85,this.map,this.St),this.actions=new At(this.map,this.O),this.yh=new Rt(this.map,this.O,this.actions,this.St),this.ah=new zt,this.map.set(this.O.kt,this.O.Pt,this.O),new Ct(this.map),D.ot(this.O.x,this.O.y,20,!0),D.L=.01}mh(t){D.ot(this.O.x,this.O.y,5+(9-this.St.Ei)/9),D.nt(),!this.St.Ft&&this.St.Ei>0?(this.actions.update(),this.map.update(t),this.yh.update(t),this.St.update(t)):this.St.Ft&&this.O.update(t),this.ah.update(t),s(t),this.St.Ei>0&&!this.St.Qi?(this.map.draw(this.O.x,this.O.y),this.yh.draw()):(this.St.Ei>0&&this.yh.draw(),this.O.update(t),this.O.draw()),D.rt()}}const Qt=new lt(0),Ft=new class{constructor(){this.xh=0,this.gh=!1}mh(t){this.xh+=t,(()=>{const t=[x,y,g,m,p],s=Math.ceil(c2.height/t.length),i=c2.width/32;for(let h=0;32>h;h++){const e=10*Math.round(16*Math.sin(1-8*Math.PI*h/32)/10);t.forEach((t,n)=>{D.Y.fillStyle=t,D.Y.fillRect(i*h,e+s*n-20,Math.ceil(c2.width/32),s)})}const h=c2.width/22,e=c2.height/2/22,n=z.oak,a=z.spruce;if(n){for(let t=0;h+32>=t;t++)for(let s=e*(1.2-Math.cos(t/h*2*Math.PI));s>0;s--){const i=5*Math.sin(12*Math.PI*(s/e));D.et(.2+Qt.next()>s/e?n:a,22*t+i-16,c2.height-(22*s+.7*Qt.next())/2,!1,32,32)}Qt.ss=0}})();const s=D.q.canvas.width/2;D.ht("Meow Mountain",s,100,p,1,0,15),D.ht("Press Enter to start",s,230,E,1,0,4),D.ht("Press F to toggle fullscreen",s,280,x,1,0,4),this.Uh()}Uh(){e.m&&!e.v.m&&h.ph(new Bt);const t=!!e.P.get("KeyF");t&&!this.gh&&(document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()),this.gh=t}};document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='85'%3EðŸ’œ%3C/text%3E%3C/svg%3E";let Nt=0,Vt=!1;window.addEventListener("blur",()=>{$(21),Vt=!0}),window.addEventListener("focus",()=>{$(22),Vt=!1}),h=new class{constructor(t,...s){this.currentState=t,this.currentState.Mh?.(...s)}ph(t,...s){this.currentState.wh?.(),this.currentState=t,this.currentState.Mh?.(...s)}getState(){return this.currentState}}(Ft,...[]),setInterval(t=>{if(Vt)return;let i=(t=performance.now())-Nt;if(Nt=t,i>1e3)return;D.clear();const n=h.getState();e.j(),n.mh(i),s(i)},16)</script>