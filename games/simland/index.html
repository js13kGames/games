<title>SimLand - js13kGames 2012</title><style>body{background:#666;color:#eee;font-family:"Liberation Sans",Arial,"Droid Sans",sans-serif;font-size:12px;padding:0;margin:0}#land{margin:auto;position:relative}.ctrlBoxBorder{position:fixed;top:0;right:0;background:#999;border-left:1px solid #ccc;border-bottom:1px solid #ccc;border-bottom-left-radius:8px;min-width:24px;min-height:24px;text-shadow:1px 1px 0 #000}.ctrlBoxBorder:hover{background:rgba(127,127,127,.8)}.ctrlBox{display:none;padding:5px 12px}.ctrlBoxBorder:hover .ctrlBox{display:block}.ctrlBox .opt{padding:8px 0}.buildOptsBoxBorder{position:fixed;top:0;left:0;background:#999;border-right:1px solid #ccc;border-bottom:1px solid #ccc;border-bottom-right-radius:8px;min-width:24px;min-height:24px;text-shadow:1px 1px 0 #000}.buildOptsBoxBorder:hover{background:rgba(127,127,127,.8)}.buildOptsBox{display:none;padding:6px}.buildOptsBoxBorder:hover .buildOptsBox{display:block}.buildOptsBox div{cursor:pointer;padding:3px 5px;margin:1px 0;border-radius:3px}.buildOptsBox div:hover{background:rgba(255,255,255,.3)}.buildOptsBox div.selected{background:rgba(0,100,200,.4)}.buildOptsBox div.selected:hover{background:rgba(50,200,255,.4)}.infoBox{position:fixed;bottom:18px;left:0;background:rgba(100,100,100,.8);border-top:1px solid #ccc;border-right:1px solid #ccc;border-top-right-radius:8px;text-shadow:1px 1px 0 #000;padding:2px 5px}.showInfoBox-false .infoBox{display:none}.status{position:fixed;bottom:0;left:0;background:#555;border-top:1px solid #ccc;border-right:1px solid #ccc;border-top-right-radius:8px;text-shadow:1px 1px 0 #000;padding:2px 5px;font-size:11px}.status div{display:inline-block}#happiness span{position:relative;top:1px;font-size:16px;line-height:14px;font-weight:400}.visibleLand{background:#bbb}.landDimention{position:absolute;margin:auto;transform:matrix(1,-.6,1,.6,0,0)}.s{width:20px;height:20px;display:inline-block;position:relative}.s.odd{background:#bbb}.s.even{background:#aaa}.eventCatcher .s:hover{background:rgba(255,200,0,.3);outline:2px solid rgba(255,220,0,.6)}.s.hover .piece{outline:2px solid rgba(255,220,0,.9)}.objOpacity-translucent .gameObj{opacity:.7}.objOpacity-glass .gameObj{opacity:.3}.blackBlock{position:fixed;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.5);text-align:center}.window{display:inline-block;margin-top:5%;min-height:20%;max-height:60%;overflow:auto;background:#eee;color:#444;padding:0 20px 15px 20px;position:relative;text-align:left;border:4px solid #ddd;border-radius:7px;box-shadow:inset 0 0 60px #888,3px 3px 20px #000}.window .title{color:#888;margin:0 0 10px 0;text-align:center;text-shadow:1px 1px 0 #fff}.windowClose{position:absolute;top:1px;right:2px;cursor:pointer;font-size:18px;line-height:18px;color:#c44}.windowClose:hover{color:#e33}.powerPlantSelect .option,.pubServSelect .option{border:1px solid #aaa;background:#ddd;padding:5px;margin:5px 0;cursor:pointer}.powerPlantSelect .option:hover,.pubServSelect .option:hover{background:#ccc}.pubServSelect .option{width:130px;float:left;margin:0}.pubServSelect .option:nth-child(2n){float:none;margin:5px 0 5px 147px}.sadnessReport h2{text-align:center;margin:0}.sadnessReport .date{text-align:right;font-size:11px}.sadnessReport .face{text-align:center;font-size:30px;line-height:30px}.sadnessReport li,.sadnessReport ul{margin:0;padding:0 0 0 5px;font-size:14px}.sadnessReport li{padding:3px 0;font-family:"Arial Narrow","Liberation Sans Narrow","Handset Condensed","DejaVu Sans Semi-Condensed",sans-serif}.sadnessReport .btAutoShow{text-align:right}.gameover{position:fixed;top:50%;left:50%;margin-left:-75px;font-size:30px;font-weight:700;color:#ddd;text-shadow:0 0 10px #000}.s.odd.grass,.s.odd.tree{background:#8c5}.s.even.grass,.s.even.tree{background:#7b5}.displaySquareType-color .s.sport{background:#89a}.sport .piece{background:#aaa url(sport.png);height:14px;margin-top:3px}.building .piece{position:absolute}.building .face1{width:30px;height:14px;bottom:3px;left:3px;transform-origin:bottom left;transform:matrix(1,-1,0,1,0,0);background:#e00 url(building-face1.png);border-top-right-radius:2px}.building .face2{width:30px;height:14px;bottom:3px;left:3px;transform-origin:bottom left;transform:matrix(1,-1,-1,0,0,0);background:#c00 url(building-face2.png);border-top-right-radius:2px}.building .top{width:14px;height:14px;top:-26px;left:32px;background:#e66}.tree1{width:0;height:0;border-left:6px solid #080;border-top:10px solid transparent;transform:matrix(1,.6,-1.3,1,8,-3)}.tree2{width:0;height:0;border-left:6px solid #070;border-top:10px solid transparent;transform:matrix(1,.6,-1.3,1,17,-7)}.tree3{width:0;height:0;border-left:6px solid #090;border-top:10px solid transparent;transform:matrix(1,.6,-1.3,1,9,-14)}.road .piece{background:#555;width:50%;height:50%;position:absolute;display:none}.road .piece.north{top:5px;left:0;width:75%;border-radius:0 5px 5px 0}.road .piece.south{top:5px;right:0;width:75%;border-radius:5px 0 0 5px}.road .piece.west{top:0;left:5px;height:75%;border-radius:0 0 5px 5px}.road .piece.east{bottom:0;left:5px;height:75%;border-radius:5px 5px 0 0}.road .connNorth .piece.north{display:block}.road .connSouth .piece.south{display:block}.road .connWest .piece.west,.road .noConn .piece.west{display:block}.road .connEast .piece.east,.road .noConn .piece.east{display:block}.displaySquareType-color .s.country,.displaySquareType-color .s.farm,.displaySquareType-color .s.silo{background:#6d0}.displaySquareType-color .s.odd.country,.displaySquareType-color .s.odd.farm,.displaySquareType-color .s.odd.silo{background:#6fdf0f}.farm .piece{width:18px;height:18px;border:1px solid #840;position:absolute}.farm .fence1{background:#6d0}.farm .fence2{border:1px dotted #840;top:-1px;left:1px}.farm .fence3{border:1px dotted #840;top:-2px;left:2px}.farm .fence4{top:-3px;left:3px}.silo .p1{width:30px;height:20px;position:absolute;border-radius:10px;background:#888;transform:matrix(.6,-.6,.7,.6,-1,-3);box-shadow:inset -4px -2px 10px #444}.silo .p2{width:20px;height:20px;position:absolute;right:-1px;background:#999;border-radius:10px}.displaySquareType-color .s.factory,.displaySquareType-color .s.industry{background:#e0d080}.displaySquareType-color .s.odd.factory,.displaySquareType-color .s.odd.industry{background:#ed8}.displaySquareType-color .s.powerCoal{background:#fe5}.factory .building .face1,.powerCoal .building .face1{width:13px;background-color:#aaa}.factory .building .face2,.powerCoal .building .face2{width:13px;background-color:#999}.factory .building .top,.powerCoal .building .top{line-height:14px;font-size:16px;text-align:center;top:-9px;left:15px;background-color:#777}.factory .building .chimney,.powerCoal .building .chimney{width:4px;height:10px;background:#999;border-radius:2px;transform:matrix(.6,.5,-1,1,6,-5)}.factory .building .smoke,.powerCoal .building .smoke{position:absolute;top:-14px;left:9px;color:transparent;text-shadow:0 0 3px #000,0 0 3px #000;animation-duration:3s;animation-name:smoke;animation-iteration-count:infinite}@keyframes smoke{0%{opacity:.2;letter-spacing:-3px}20%{opacity:1}100%{opacity:.1;letter-spacing:3px}}.powerCoal .building .face1,.powerCoal .building .face2{background-image:none;font-size:18px;line-height:14px;color:#fff;text-shadow:1px 2px 0 #888}.powerCoal .building .face2{color:#ddd;text-shadow:-1px -1px 0 #777}.displaySquareType-color .s.house,.displaySquareType-color .s.resid{background:#69b}.displaySquareType-color .s.odd.house,.displaySquareType-color .s.odd.resid{background:#70a0c0}.house .building{background:#0b0;border:1px solid #090;width:12px;height:12px;position:absolute;top:3px;left:3px}.house .building .face1{background:#ddd url(home-face1.png) no-repeat;bottom:2px;left:2px;width:6px;height:10px}.house .building .face2{background:#ccc url(home-face2.png);bottom:2px;left:2px;width:6px;height:10px}.house .building .top{width:10px;height:10px;text-align:center;top:auto;bottom:7px;left:7px;background:#ddd}.house .building .roof1{background:#640;position:absolute;top:0;left:0;width:10px;height:6px;transform:matrix(1,0,.5,.5,1,-2)}.house .building .roof2{background:#860;position:absolute;top:0;left:0;width:10px;height:6px;transform:matrix(1,0,.4,-1.2,1.5,3)}.displaySquareType-color .s.commerce,.displaySquareType-color .s.shopping{background:#60c090}.displaySquareType-color .s.odd.commerce,.displaySquareType-color .s.odd.shopping{background:#6c9}.shopping .building .face1{background-color:#bbb;width:21px}.shopping .building .face2{background-color:#aaa;width:21px}.shopping .building .top{line-height:14px;font-size:14px;text-align:center;top:-17px;left:23px;color:#090;background-color:#ccc}.displaySquareType-color .s.hospital{background:#c77}.hospital .building .face1{background-color:#eaeaea;width:17px}.hospital .building .face2{background-color:#e0e0e0;width:17px}.hospital .building .top{line-height:14px;font-size:14px;text-align:center;top:-13px;left:19px;color:#d00;background-color:#f6f6f6}.displaySquareType-color .s.school{background:#c77}.school .building .face1{background-color:#8ac;width:13px}.school .building .face2{background-color:#79b;width:13px}.school .building .top{background-color:#9bd;line-height:10px;font-size:10px;text-align:center;top:-9px;left:15px;color:#222}.school .top span{display:block;transform:matrix(.4,0,-.4,.55,-2.5,5)}.displaySquareType-color .s.police{background:#c77}.police .building .face1{width:13px}.police .building .face2{width:13px}.police .building .top{line-height:14px;font-size:16px;text-align:center;top:-9px;left:15px;color:#fd0}.displaySquareType-color .s.powerWind{background:#fe5}.powerWind .basis{width:22px;height:5px;background:#bbb;border-radius:3px;transform:matrix(1,-1,.7,.5,7,-1);position:relative}.powerWind .helix1,.powerWind .helix2,.powerWind .helix3{background:#ddd;width:12px;height:3px;border-radius:3px;position:absolute;top:-2px;left:0;transform-origin:center left}.powerWind .helix2{transform:rotate(120deg)}.powerWind .helix3{transform:rotate(240deg)}.powerWind .helixGroup{position:absolute;top:2px;right:2px;transform-origin:center left;animation-duration:5s;animation-name:helixSpin;animation-timing-function:linear;animation-iteration-count:infinite}@keyframes helixSpin{from{transform:rotate(0)}to{transform:rotate(360deg)}}</style><div id=land></div><script>function u(e,t){var o=document.createElement(e);for(att in t)"p"==att?t.p.appendChild(o):"t"==att?o.innerHTML=t.t:o.setAttribute(att,t[att]);return o}function p(e){return e.sort(function(){return Math.random()-.5})}function h(e){return Math.round(100*e)/100}function n(e){return h(e).toString().replace(/(\...).*/,"$1")}c=null,console=console||{log:function(){}},months="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),this.SimLand=function(e,t){this.landSize=t,this.date=[2e3,0],this.monthSecsDelay=10,this.money=1e3,this.taxes={individual:.2,commerce:5,industry:7,farming:2},this.cache={},this.g=10,this.f=20,this.autoShowSadnessReport=!0,this.baseEl=document.getElementById(e),this.baseEl.style.width=40*t+"px",this.baseEl.style.height=24*t+50+"px",this.landEl=u("div",{class:"visibleLand landDimention",p:this.baseEl}),this.eventCatcher=u("div",{class:"eventCatcher landDimention",p:this.baseEl,style:"z-index:"+(t+10)}),this.landEl.style.width=this.eventCatcher.style.width=20*t+"px",this.landEl.style.height=this.eventCatcher.style.height=20*t+"px",this.landEl.style.left=this.eventCatcher.style.left=10*t+"px",this.landEl.style.top=this.eventCatcher.style.top=2*t+50+"px",this.s=[];for(var o=0;o<t;o++){this.s[o]=[];for(var i=0;i<t;i++)this.s[o][i]=new y(this,o,i),Math.random()<.4&&this.s[o][i].add("tree",!0)}var a=this,e=u("div",{class:"ctrlBoxBorder",p:a.baseEl.parentNode,style:"z-index:"+(a.landSize+20)}),e=u("div",{class:"ctrlBox",p:e}),s="opacity-bt-"+Math.random()+"-",n=u("div",{class:"opt gameObjOpacity",p:e,t:'Objects opacity:<br><input type="radio" name="'+s+'GOO" id="'+s+'GOO-O" value="opaque" '+(d='onclick="this.parentNode.setObjOpct(this.value)"')+' checked><label for="'+s+'GOO-O">Opaque</label><input type="radio" name="'+s+'GOO" id="'+s+'GOO-T" value="translucent" '+d+'><label for="'+s+'GOO-T">Translucent</label><input type="radio" name="'+s+'GOO" id="'+s+'GOO-G" value="glass" '+d+'><label for="'+s+'GOO-G">Glass</label>'}),n=(a.baseEl.className+=" objOpacity-opaque",n.setObjOpct=function(e){a.baseEl.className=a.baseEl.className.replace(/objOpacity-[^ ]+/,"objOpacity-"+e)},u("div",{class:"opt squareTypeView",p:e,t:'Display square type:<br><input type="radio" name="'+s+'DST" id="'+s+'DST-N" value="none" '+(d='onclick="this.parentNode.setDisplayType(this.value)"')+'><label for="'+s+'DST-N">None</label><input type="radio" name="'+s+'DST" id="'+s+'DST-C" value="color" '+d+' checked><label for="'+s+'DST-C">Square color</label>'}));a.baseEl.className+=" displaySquareType-color",n.setDisplayType=function(e){a.baseEl.className=a.baseEl.className.replace(/displaySquareType-[^ ]+/,"displaySquareType-"+e)},u("div",{class:"opt gameMonthDelay",p:e,t:'Game speed:<br><input type="radio" name="'+s+'GMD" id="'+s+'GMD-1" value="30" '+(d='onclick="this.parentNode.setDelay(this.value)"')+'><label for="'+s+'GMD-1">Turtle</label><input type="radio" name="'+s+'GMD" id="'+s+'GMD-2" value="10" '+d+' checked><label for="'+s+'GMD-2">Lhama</label><input type="radio" name="'+s+'GMD" id="'+s+'GMD-3" value="3" '+d+'><label for="'+s+'GMD-3">Puma</label>'}).setDelay=function(e){a.monthSecsDelay=parseInt(e),clearTimeout(a.ticTimeout),a.ticTimeout=setTimeout(function(){a.tic()},1e3*a.monthSecsDelay)},u("div",{class:"opt showInfoBox",p:e,t:'<input type="checkbox" id="'+s+'SIB" onclick="this.parentNode.setShowInfoBox(this.checked)" checked><label for="'+s+'SIB">Show Info Box</label>'}).setShowInfoBox=function(e){a.infoBox.style.display=e?"block":"none"};var r,n=u("div",{class:"bt openTaxes",p:e}),d=(u("button",{p:n,t:"Open taxes dialog"}).onclick=function(){var t,o,i,s=a;u("div",{p:t=f("Set Taxes"),t:'Individual: <input size="3">'}),u("div",{p:t,t:'Commerce: <input size="3">'}),u("div",{p:t,t:'Industry: <input size="3">'}),u("div",{p:t,t:'Farming: <input size="3">'}),o=t.getElementsByTagName("input"),i={},o[0].value=i.individual=s.taxes.individual,o[1].value=i.commerce=s.taxes.commerce,o[2].value=i.industry=s.taxes.industry,o[3].value=i.farming=s.taxes.farming,u("button",{p:t,t:"Ok",style:"font-weight:bold"}).onclick=function(){for(var e in s.taxes.individual=parseFloat(o[0].value),s.taxes.commerce=parseFloat(o[1].value),s.taxes.industry=parseFloat(o[2].value),s.taxes.farming=parseFloat(o[3].value),s.taxes)isNaN(s.taxes[e])&&(s.taxes[e]=i[e],alert("The new "+e+" value was not a number. Restoring original."));t.close()},u("button",{p:t,t:"Cancel"}).onclick=function(){t.close()}},u("div",{class:"bt openSadnessReport",p:e})),l=(u("button",{p:d,t:"Open (happy|sad)ness report"}).onclick=function(){a.displaySadnessReport()},a.buildOptsBox=u("div",{class:"buildOptsBoxBorder",p:a.baseEl.parentNode,style:"z-index:"+(a.landSize+20)})),l=u("div",{class:"buildOptsBox",p:l});for(r in m){var c,p=m[r];p.p||(c="",p.cost&&(c+=" - Cost: $"+p.cost),c=u("div",{p:l,title:p.hint+c,t:p.fName}),(p.menuItem=c).toolName=r,c.onclick=function(){a.setTool(this.toolName)})}a.infoBox=u("div",{class:"infoBox",p:a.baseEl.parentNode,style:"z-index:"+(a.landSize+15),t:"No info"}),a.baseEl.onmouseover=function(){a.infoBox.innerHTML="Nothing"},a.statusBox=u("div",{class:"status",p:a.baseEl.parentNode,style:"z-index:"+(a.landSize+25),t:"No status"}),this.setTool("pointer"),s=this,n=Math.floor(t/2),e=Math.floor(t/2),s.s[n-1][e].add("road",!0),s.s[n][e].add("road",!0),s.s[n+1][e].add("road",!0),s.s[n-1][e-1].add("farm",!0),s.s[n][e-1].add("house",!0).dwellers=5,s.s[n+1][e-1].add("house",!0).dwellers=5,s.s[n-1][e-2].add("house",!0).dwellers=5,s.s[n][e-2].add("house",!0).dwellers=5,s.s[n+1][e-2].add("house",!0).dwellers=5,s.s[n-1][e+1].add("factory",!0),s.s[n][e+1].add("shopping",!0),s.s[n+1][e+1].add("powerCoal",!0),this.cache={},this.updateStatus();var h=this;this.ticTimeout=setTimeout(function(){h.tic()},1e3*this.monthSecsDelay)},SimLand.prototype.tic=function(){try{this.date[1]++,11<this.date[1]&&(this.date[1]=0,this.date[0]++),this.collectTaxes();for(var e=0;e<this.landSize;e++)for(var t=0;t<this.landSize;t++){var o=this.s[e][t],i=this.calcProductionFor(o);this.money-=i.consumption.money,this.g+=i.goods-i.consumption.goods,this.f+=i.food-i.consumption.food}this.g=Math.round(9*this.g)/10,this.f=Math.round(8*this.f)/10,this.g<0&&(this.g=0),this.f<0&&(this.f=0),this.privateInitiativeNewBuildings(),this.bornAndDie(),this.moveDwellers(),this.somethingWasDestroyed()}catch(e){}this.cache={},this.updateStatus();var s=this;return 0==this.calcHappiness()?this.sadGameOver():0==this.countPopulation()?this.popGameOver():(this.ticTimeout=setTimeout(function(){s.tic()},1e3*this.monthSecsDelay),void(this.calcHappiness()<.25&&this.autoShowSadnessReport&&this.displaySadnessReport()))},SimLand.prototype.moveDwellers=function(){var e=this.getSquareByType("house").sort(function(e,t){return e.dwellers-t.dwellers});e[0].dwellers++,e[e.length-1].dwellers--},SimLand.prototype.somethingWasDestroyed=function(){var t,e,o=(this.date[0]-2005)/100;.5<o&&(o=.5),Math.random()<o&&(t=this.buildings(),this.getSquareByType("road").forEach(function(e){t.push(e)}),o=p(t)[0])&&(e=m[o.type].fName,o.clear(!0),u("div",{p:f('"Shit happens"&trade;'),t:"<p><b>Oh my ...!!!</b></p><p>The "+e+" at lat "+o.getLat()+", lon "+o.getLon()+" was destructed.</p>"}))},SimLand.prototype.privateInitiativeNewBuildings=function(){(t=this.countPopulation())>5*(n=p(this.getSquareByType("house"))).length&&((e=p(this.getSquareByType("resid")))[0]&&e[0].add("house"),t>6*n.length)&&e[1]&&e[1].add("house",!0),t+this.calcRequiredGoodsOrFood()>this.f&&(n=p(this.getSquareByType("country")),e=Math.random()<.3?"silo":"farm",n[0]&&n[0].add(e),t>1.5*this.f)&&n[1]&&n[1].add(e,!0);var e,t=this.getSquareByType("shopping"),o=this,i=0,s=0;t.forEach(function(e){i+=o.calcWorkersFor(e),s+=m.shopping.employs}),.8<i/s&&((a=p(this.getSquareByType("commerce")))[0]&&a[0].add("shopping"),.9<i/s)&&a[1]&&a[1].add("shopping",!0);var a,n=this.calcRequiredGoods()+this.calcRequiredGoodsOrFood(),r=0,d=0,l=0;(o=this).getSquareByType("factory").forEach(function(e){r+=o.calcProductionFor(e).goods,d+=o.calcWorkersFor(e),l+=m.factory.employs}),.8<d/l&&r<n&&(a=p(this.getSquareByType("industry")))[0]&&a[0].add("factory",!0)},SimLand.prototype.bornAndDie=function(){var e=this.countPopulation(),t=this.getSquareByType("house"),o=this.getSquareByType("hospital").length/e,i=(.01<o&&(o=.01),this.calcPollution()),s=.003+o,a=(e<50&&(s*=3),e<100&&(s*=3),e<150&&(s*=2),e<200&&(s*=1.5),e<250&&(s*=1.5),e<300&&(s*=1.5),Math.round(e*s+Math.random())),n=Math.round(e*(.002-o+i/1e3)+.7*Math.random());e+a-n>10*t.length&&(a=10*t.length-e+n),p(t).forEach(function(e){1<e.dwellers&&0<n&&(e.dwellers--,n--)}),p(t).forEach(function(e){e.dwellers<10&&0<a&&(e.dwellers++,a--)})},SimLand.prototype.collectTaxes=function(){for(var e=0,t=0;t<this.landSize;t++)for(var o=0;o<this.landSize;o++){var i,s,a=this.s[t][o],n=m[a.type];n&&n.taxType&&(i=this.taxes[n.taxType],"individual"==n.taxType?e+=i*a.dwellers:"commerce"==n.taxType?e+=i*this.calcWorkersFor(a)/n.employs:(s=n.goods?"goods":"food",e+=i*this.calcProductionFor(a)[s]/n[s]))}e=h(e),this.money+=e},SimLand.prototype.calcWorkersFor=function(e){var t="workersFor-"+e.x+"-"+e.y;if(!this.cache[t]){for(var o,e=m[e.type],i=this.countPopulation(),s=0,a=0,n=0;n<this.landSize;n++)for(var r=0;r<this.landSize;r++){var d=this.s[n][r];(d=m[d.type])&&d.employs&&(s+=d.employs,d.priorityJob)&&(a+=d.employs)}s<.8*i?this.cache[t]=e.employs:(o=s-a,2*a<.8*i?e.priorityJob?this.cache[t]=e.employs:(n=.8*i-a,this.cache[t]=Math.floor(e.employs*(n/o))):this.cache[t]=Math.round(Math.random())+Math.round(e.employs*(i/s)))}return this.cache[t]},SimLand.prototype.calcRequiredPower=function(){if(!this.cache.requiredPower)for(var e=this.cache.requiredPower=0;e<this.landSize;e++)for(var t=0;t<this.landSize;t++){var o=this.s[e][t];(o=m[o.type])&&o.needPower&&(this.cache.requiredPower+=o.needPower)}return this.cache.requiredPower},SimLand.prototype.calcProducedPower=function(){if(!this.cache.producedPower)for(var e=this.cache.producedPower=0;e<this.landSize;e++)for(var t=0;t<this.landSize;t++){var o=this.s[e][t];(o=m[o.type])&&o.power&&(this.cache.producedPower+=o.power)}return this.cache.producedPower},SimLand.prototype.calcRequiredGoods=function(){if(!this.cache.requiredGoods)for(var e=this.cache.requiredGoods=0;e<this.landSize;e++)for(var t=0;t<this.landSize;t++){var o=this.s[e][t];(o=m[o.type])&&o.needGoods&&(this.cache.requiredGoods+=o.needGoods)}return this.cache.requiredGoods},SimLand.prototype.calcRequiredGoodsOrFood=function(){if(!this.cache.requiredGoodsOrFood)for(var e=this.cache.requiredGoodsOrFood=0;e<this.landSize;e++)for(var t=0;t<this.landSize;t++){var o=this.s[e][t];(o=m[o.type])&&o.needGoodsOrFood&&(this.cache.requiredGoodsOrFood+=o.needGoodsOrFood)}return this.cache.requiredGoodsOrFood},SimLand.prototype.calcProductionFor=function(e){var t="productionFor-"+e.x+"-"+e.y,o={food:0,goods:0,money:0};if(!this.cache[t]){var i,s,a="",n=m[e.type];if(!n||"tree"==n.type)return this.cache[t]={report:"",goods:0,food:0,consumption:o},this.cache[t];"house"==e.type?(c=this.countPopulation(),1<(d=this.f/c)&&(d=1),a+="Receiving "+(p=Math.round(e.dwellers*d*10)/10)+" food units, "+Math.round(100*d)+"% of the required.",o.food=p):a+="Employing "+(p=this.calcWorkersFor(e))+" workers, "+(i=Math.round(100*p/n.employs))+"% of the required.",n.needPower&&(e=this.calcRequiredPower(),p=this.calcProducedPower(),a+="<br>Receiving "+(s=100<(s=Math.round(100*p/e))?100:s)+"% of the required power.");var r,d,l,c,p=100,e=0,h=0;(n.needGoods||n.needGoodsOrFood)&&(r=n.needGoods?"needGoods":"needGoodsOrFood",l=this.calcRequiredGoods(),p=Math.round(100*this.g/l),o.goods=n[r]*p/100,p<3&&(p=3),p+=(100-p)/3,a+="<br>Receiving "+(p=n.needGoodsOrFood&&p<100&&(l=this.calcRequiredGoodsOrFood(),c=this.countPopulation(),(d=Math.round(100*(this.f-c)/l))<0&&(d=0),o.food=n.needGoodsOrFood*(d=100-p<d?100-p:d)/100,100<(p+=d=p<4&&d<3?3:d))?100:p)+"% of the required "+(n.needGoodsOrFood?"goods or food":"goods")+"."),n.goods&&(e=n.goods*(i*s*p)/1e5,a+="<br>Produceing "+(e=Math.round(e)/10)+" goods. ("+Math.round(100*e/n.goods)+"% of the potential)"),n.food&&(h=n.food*(i*s*p)/1e5,h=Math.round(h)/10,a+="<br>Produceing "+(h+=(100-Math.round(100*h/n.food))*n.food/200)+" food. ("+Math.round(100*h/n.food)+"% of the potential)"),n.maintenance&&(o.money=n.maintenance,a+="<br>Maintenance costs $"+n.maintenance),n.power&&(a+="<br>Power generation: "+n.power+"‚ö°"),n.pollution&&(a+="<br>Pollution: "+n.pollution+"uP"),this.cache[t]={report:a,goods:e,food:h,consumption:o}}return this.cache[t]};var m={pointer:{fName:"Pointer",hint:"Select and see things"},clear:{fName:"Clear",hint:"Destroy and clear square definition",cost:10},tree:{fName:"Trees",hint:"Plant trees",pollution:-15,desc:"So green, so clean...",cost:10},road:{fName:"Road",hint:"Connect places and enable transportation",cost:50,maintenance:.1,needPower:1},country:{fName:"Countryside",hint:"For food production",cost:5},power:{fName:"Power Plant",hint:"Select a kind of power generator"},resid:{fName:"Residential Area",hint:"Where to leave",cost:20},house:{fName:"House",hint:"Home, Sweet Home",p:"resid",pollution:10,needPower:1,lives:10,taxType:"individual"},commerce:{fName:"Commercial Area",hint:"Where to buy and trade",cost:20},shopping:{fName:"Shopping Center",hint:"Where to buy and trade",pollution:10,needPower:5,employs:20,serves:200,needGoodsOrFood:100,p:"commerce",taxType:"commerce"},industry:{fName:"Industrial Area",hint:"Where to produce",cost:20},factory:{fName:"Factory",hint:"Nothing is lost or created, all is transformed",pollution:100,needPower:10,employs:16,goods:100,needGoodsOrFood:100,p:"industry",taxType:"industry"},pubServ:{fName:"Public Service",hint:"Organize, protect and help people"},farm:{fName:"Farm",hint:"For food production",p:"country",pollution:1,needPower:5,needGoods:10,food:50,employs:2,taxType:"farming"},silo:{fName:"Silo",hint:"For food storage",p:"country",needPower:1,needGoods:5,food:50,employs:2,taxType:"farming"},hospital:{fName:"Hospital",hint:"Medical attention",p:"pubServ",cost:1e3,maintenance:10,pollution:50,needPower:1,employs:20,priorityJob:!0,serves:60,needGoods:150},school:{fName:"School",hint:"To grow up brains",p:"pubServ",cost:500,maintenance:10,pollution:20,needPower:1,employs:15,priorityJob:!0,serves:100,needGoods:100},police:{fName:"Police",hint:"Protect the people",p:"pubServ",cost:1e3,maintenance:5,pollution:30,needPower:1,employs:15,priorityJob:!0,needGoods:60},sport:{fName:"Sports Court",hint:"Heath and Fun",p:"pubServ",cost:100,maintenance:.1,needPower:1,employs:1,serves:100,needGoods:1},powerCoal:{fName:"Coal Power Plant",hint:"Cheap pollution plant",p:"power",cost:1e3,maintenance:8,pollution:500,power:100,employs:15,priorityJob:!0,needGoods:100},powerWind:{fName:"Wind Power Plant",hint:"Sustainable power plant",p:"power",cost:3e3,maintenance:3,pollution:1,power:50,employs:5,priorityJob:!0,needGoods:10}};for(type in m)m[type].employs&&(m[type].info=function(e){return e.game.calcProductionFor(e).report});function f(e,t){var o=u("div",{class:"blackBlock",p:document.body,style:"z-index:9999"}),i=u("div",{class:"window",p:o}),e=(u("h2",{class:"title",p:i,t:e}),u("div",{class:"windowClose",p:i,t:"‚úñ"}));return i.close=function(){document.body.removeChild(o),t&&t()},e.onclick=function(){i.close()},i}m.house.info=function(e){var t="There is "+e.dwellers+" persons living here.";return e.dwellers==m.house.lives&&(t+=" (Maximum!)"),t+("<br>"+e.game.calcProductionFor(e).report)},m.power.onSelect=function(e){var t,o=f("Select a Power Plant");for(t in o.className+=" powerPlantSelect",m){var i=m[t];"power"==i.p&&((i=u("div",{p:o,class:"option",t:"<b>"+i.fName+"</b> &nbsp; <small>($"+i.cost+")</small><br>"+i.hint+"<br>Generates "+i.power+"‚ö°"})).buildingName=t,i.onclick=function(){e.setTool(this.buildingName),o.close()})}},m.pubServ.onSelect=function(e){var t,o=f("Select a Public Service");for(t in o.className+=" pubServSelect",m){var i=m[t];"pubServ"==i.p&&((i=u("div",{p:o,class:"option",t:"<b>"+i.fName+"</b> &nbsp; <small>($"+i.cost+")</small><br>"+i.hint+"<br>Maintenance: $"+i.maintenance})).buildingName=t,i.onclick=function(){e.setTool(this.buildingName),o.close()})}};var o=null;function y(e,t,o){this.game=e,this.x=t,this.y=o,this.type="grass";var t=(t*e.landSize+o)%2==0?"odd":"even",t=this.visibleEl=u("div",{class:"s "+t,p:e.landEl,style:"z-index:"+(e.landSize-o)}),e=this.eventEl=u("div",{class:"s",p:e.eventCatcher,style:"z-index:"+(e.landSize-o)}),i=((t.gameSquare=e.gameSquare=this).classNameOrig=t.className,t.className+=" grass",this);e.onmouseover=function(e){i.onMouseOver(),e.stopPropagation()},e.onmouseout=function(){i.onMouseOut()},e.onclick=function(){i.onClick()}}SimLand.prototype.setTool=function(e){o&&(o.className="");var t=m[e].menuItem;(t=t||m[m[e].p].menuItem)&&((o=t).className="selected"),this.currentTool=e,this.updateStatus(),m[e].onSelect&&m[e].onSelect(this)},SimLand.prototype.updateStatus=function(){this.statusBox.innerHTML="Active tool: <b>"+m[this.currentTool].fName+"</b> &nbsp; &nbsp; Money: <b>$"+n(this.money)+"</b> &nbsp; &nbsp; Date: <b>"+this.date[0]+"/"+months[this.date[1]]+"</b> &nbsp; &nbsp; Population: <b>"+this.countPopulation()+"</b> &nbsp; &nbsp; Pollution: <b>"+this.calcPollution()+'</b> &nbsp; &nbsp; <div id="happiness">Happiness: <b>'+this.calcHappiness(!0)+"</b></div>"},SimLand.prototype.countPopulation=function(){var t;return this.cache.population||(this.cache.population=0,(t=this).getSquareByType("house").forEach(function(e){t.cache.population+=e.dwellers})),this.cache.population},SimLand.prototype.calcPollution=function(){if(!this.cache.pollution){for(var e=0,t=0;t<this.landSize;t++)for(var o=0;o<this.landSize;o++){var i=m[this.s[t][o].type];i&&i.pollution&&(e+=i.pollution)}this.cache.pollution=e<0?0:e}return this.cache.pollution},SimLand.prototype.buildings=function(){for(var e=[],t=0;t<this.landSize;t++)for(var o=0;o<this.landSize;o++){var i=m[this.s[t][o].type];i&&i.p&&e.push(this.s[t][o])}return e},SimLand.prototype.buildingsWhitoutRoad=function(){var o=0,i=this;return this.buildings().forEach(function(e){var t=!1;[[e.x-1,e.y],[e.x+1,e.y],[e.x,e.y-1],[e.x,e.y+1]].forEach(function(e){(e=i.s[e[0]]?i.s[e[0]][e[1]]:null)&&"road"==e.type&&(t=!0)}),t||o++}),o},SimLand.prototype.calcHappiness=function(e){if(!this.cache.happiness){this.sadnessReport=[];var t,o=h(this.calcPollution()/2e3),o=(this.sadnessReport.push(["pollution",o]),h(this.buildingsWhitoutRoad()/(2*this.buildings().length))),i=(0==this.buildings().length&&(o=0),this.sadnessReport.push(["transportation",o]),0);for(t in this.taxes)i+=this.taxes[t];var o=h((i-10)/20),o=(this.sadnessReport.push(["taxes",o]),this.countPopulation()),s=h((1-this.f/o)/2),s=(this.sadnessReport.push(["food production",s=s<0?0:s]),(1-this.g/o)/6),s=(o<150&&(s/=150-o),s=h(s=s<0?0:s),this.sadnessReport.push(["goods production",s]),this.getSquareByType("house").length),a=h((o/s-4)/30),s=(this.sadnessReport.push(["residential area size",a=0==s?.9:a]),(1-this.getSquareByType("hospital").length/(o/200))/1.5),a=(o<300&&(s/=300-o),(s=h(s))<0&&(s=0),this.sadnessReport.push(["health service",s]),(1-this.getSquareByType("school").length/(o/200))/2),s=(o<300&&(a/=300-o),(a=h(a))<0&&(a=0),this.sadnessReport.push(["educational level",a]),(1-this.getSquareByType("police").length/(o/(200-200*a)))/1.5),a=(o<300&&(s/=300-o),(s=h(s))<0&&(s=0),this.sadnessReport.push(["criminality level",s]),(1-this.getSquareByType("sport").length/(o/300))/2),a=(o<300&&(a/=300-o),a=h(a=a<0?0:a),this.sadnessReport.push(["sports promotion",a]),(s=this.getSquareByType("shopping")).length/(o/100)),n=this,r=0,d=0,s=(s.forEach(function(e){r+=n.calcWorkersFor(e),d+=m.shopping.employs}),(1-a/(d-r))/3),a=(o<200&&(s/=200-o),s=h(s=s<0?0:s),this.sadnessReport.push(["commerce options",s]),this.calcRequiredPower()),l=(o=h(o=(o=(1-this.calcProducedPower()/a)/2)<0?0:o),this.sadnessReport.push(["power production",o]),1);this.sadnessReport.forEach(function(e){l-=e[1]}),1<(l=(l=h(l))<0?0:l)&&(l=1),this.cache.happiness=l}return s=["üò´","üò°","üò†","üòû","üòê","üòå","üòä","üòÉ","üòÑ"],e?"faceOnly"==e?s[Math.round((s.length-1)*this.cache.happiness)]:this.cache.happiness+"<span>"+s[Math.round((s.length-1)*this.cache.happiness)]+"</span>":this.cache.happiness},SimLand.prototype.displaySadnessReport=function(){var e=this.sadnessReport.sort(function(e,t){return t[1]-e[1]}),t=this.calcHappiness(),o=this.calcHappiness("faceOnly"),i=(clearTimeout(this.ticTimeout),this),s=f(t<=.5?"Sadness Report":"Happiness Report",function(){i.gameover||(i.ticTimeout=setTimeout(function(){i.tic()},1e3*i.monthSecsDelay))}),a='<div class="date">'+this.date[0]+"/"+months[this.date[1]]+"</div>",t=(a=a+("üòê"==o?'<h2>The people is "poker faced"</h2>':.5<t?.8<=t?"<h2>The people is very happy!</h2>":"<h2>The people is happy</h2>":t<=.1?"<h2>The people want to kill you!</h2>":t<=.2?"<h2>The people is very sad!</h2>":"<h2>The people is sad</h2>")+'<div class="face">'+o+"</div><ul>",e.forEach(function(e){0==e[1]?a+="<li><b>There is no problem with "+e[0]+"!</b> üòÉ</li>":a+="<li><b>"+e[0]+"</b> is unacceptable for <b>"+n(100*e[1])+"%</b> of the people.</li>"}),u("div",{class:"sadnessReport",t:a+="</ul>",p:s})),o=u("div",{class:"btAutoShow",p:t}),s=u("input",{id:e="btAutoShow"+Math.random(),type:"checkbox",p:o});u("label",{t:"Auto show this report when sadness is critical",for:e,p:o}),s.checked=this.autoShowSadnessReport,s.onclick=function(){i.autoShowSadnessReport=this.checked}},SimLand.prototype.gameOver=function(e){this.setTool("pointer"),this.gameover=!0,this.buildOptsBox.style.display="none";var t=this,o=f("Game Over",function(){u("div",{class:"gameover",t:"Game Over",p:t.baseEl})});u("div",{class:"gameoverInfo",t:e,p:o})},SimLand.prototype.sadGameOver=function(){this.gameOver("<p>The people happiness become 0.</p><p>Your ass was kicked until your death.</p>")},SimLand.prototype.popGameOver=function(){this.gameOver("<p>All the people die.</p><p>Welcome to Zombie Town.</p>")},SimLand.prototype.getSquareByType=function(e){for(var t=[],o=0;o<this.landSize;o++)for(var i=0;i<this.landSize;i++)this.s[o][i].type==e&&t.push(this.s[o][i]);return t},y.prototype.getLat=function(){var e=Math.floor(this.x+1-this.game.landSize/2);return 0==e?"0.0&deg;":e<0?Math.abs(e/10)+"&deg; North":e/10+"&deg; South"},y.prototype.getLon=function(){var e=Math.floor(this.y+1-this.game.landSize/2);return 0==e?"0.0&deg;":e<0?Math.abs(e/10)+"&deg; West":e/10+"&deg; East"},y.prototype.onMouseOver=function(){this.visibleEl.className+=" hover";var e=this.type,t="Nothing to see here",o=m[this.type];o&&(t=o.desc||o.hint,e=o.fName,o.info)&&(t+="<div>"+o.info(this)+"</div>"),this.game.infoBox.innerHTML="<div>Location: Lat "+this.getLat()+", Lon "+this.getLon()+"</div><div>Type: <b>"+e+"</b></div><div>"+t+"</div><div>Global goods stock: "+this.game.g+"</div><div>Global food stock: "+this.game.f+"</div>"},y.prototype.onMouseOut=function(){this.visibleEl.className=this.classNameOrig+" "+this.type},y.prototype.onClick=function(){var e,t,o;"clear"!=this.game.currentTool?m[this.game.currentTool].add&&("grass"!=this.type&&"tree"!=this.type?(e=f("Replace building?"),t=m[this.type].fName,u("p",{p:e,t:'This place has a "'+t+'".<br>Do you want to destroy it?'}),o=this,u("button",{p:e,t:"Yes"}).onclick=function(){o.add(o.game.currentTool),e.close()},u("button",{p:e,t:"No"}).onclick=function(){e.close()}):this.add(this.game.currentTool)):this.clear()},y.prototype.clear=function(e){if(!e&&"grass"!=this.type){if(this.game.money<m.clear.cost)return alert("You can't pay for destruct and clear this area.\n($"+m.clear.cost+")"),!1;this.game.money-=m.clear.cost}for(this.type="grass",this.visibleEl.className=this.classNameOrig+" "+this.type;this.visibleEl.firstChild;)this.visibleEl.removeChild(this.visibleEl.firstChild);var e=this.game.s,t=this.x,o=this.y;return e[t-1]&&e[t-1][o]&&"road"==e[t-1][o].type&&m.road.update(e[t-1][o]),e[t+1]&&e[t+1][o]&&"road"==e[t+1][o].type&&m.road.update(e[t+1][o]),e[t][o-1]&&"road"==e[t][o-1].type&&m.road.update(e[t][o-1]),e[t][o+1]&&"road"==e[t][o+1].type&&m.road.update(e[t][o+1]),!0},y.prototype.add=function(e,t){if(e=m[e],this.clear(t)){if(!t&&e.cost){if(this.game.money<e.cost)return void alert("You can't pay for a "+e.fName+".\n($"+e.cost+")");this.game.money-=e.cost,this.game.updateStatus()}e.add(this),this.visibleEl.className=this.classNameOrig+" "+this.type}return this},m.tree.add=function(e){e.type="tree",e=u("div",{class:"gameObj tree",p:e.visibleEl}),u("div",{class:"piece tree1",p:e}),u("div",{class:"piece tree2",p:e}),u("div",{class:"piece tree3",p:e})},m.road.add=function(e){e.type="road";var t=u("div",{class:"gameObj",p:e.visibleEl}),t=(u("div",{class:"piece north",p:t}),u("div",{class:"piece south",p:t}),u("div",{class:"piece west",p:t}),u("div",{class:"piece east",p:t}),e.game.s),o=e.x,i=e.y;this.update(e),t[o-1]&&t[o-1][i]&&"road"==t[o-1][i].type&&this.update(t[o-1][i]),t[o+1]&&t[o+1][i]&&"road"==t[o+1][i].type&&this.update(t[o+1][i]),t[o][i-1]&&"road"==t[o][i-1].type&&this.update(t[o][i-1]),t[o][i+1]&&"road"==t[o][i+1].type&&this.update(t[o][i+1])},m.road.update=function(e){var t=e.game.s,o=e.x,i=e.y,s="gameObj";t[o-1]&&t[o-1][i]&&"road"==t[o-1][i].type&&(s+=" connWest"),t[o+1]&&t[o+1][i]&&"road"==t[o+1][i].type&&(s+=" connEast"),t[o][i-1]&&"road"==t[o][i-1].type&&(s+=" connNorth"),t[o][i+1]&&"road"==t[o][i+1].type&&(s+=" connSouth"),e.visibleEl.firstChild.className=s="gameObj"==s?"gameObj noConn":s},m.resid.add=function(e){e.type="resid"},m.country.add=function(e){e.type="country"},m.industry.add=function(e){e.type="industry"},m.commerce.add=function(e){e.type="commerce"},m.farm.add=function(e){e.type="farm",u("div",{class:"gameObj piece fence1",p:e.visibleEl}),u("div",{class:"gameObj piece fence2",p:e.visibleEl}),u("div",{class:"gameObj piece fence3",p:e.visibleEl}),u("div",{class:"gameObj piece fence4",p:e.visibleEl})},m.silo.add=function(e){e.type="silo",u("div",{class:"gameObj piece p1",p:e.visibleEl,t:'<div class="piece p2"></div>'})},addBaseBuilding=function(e,t){return e.type=t,{base:t=u("div",{class:"gameObj building",p:e.visibleEl}),face1:u("div",{class:"piece face1",p:t}),face2:u("div",{class:"piece face2",p:t}),top:u("div",{class:"piece top",p:t})}},m.factory.add=function(e){addBaseBuilding(e,"factory").top.innerHTML='<div class="piece chimney"></div><div class="smoke">...</div>'},m.house.add=function(e){e.dwellers=0,addBaseBuilding(e,"house").top.innerHTML='<div class="roof1"></div><div class="roof2"></div>'},m.shopping.add=function(e){addBaseBuilding(e,"shopping").top.innerHTML="$"},m.hospital.add=function(e){addBaseBuilding(e,"hospital").top.innerHTML="‚úö"},m.police.add=function(e){addBaseBuilding(e,"police").top.innerHTML="‚òÖ"},m.school.add=function(e){addBaseBuilding(e,"school").top.innerHTML="<span>School</span>"},m.powerCoal.add=function(e){(e=addBaseBuilding(e,"powerCoal")).top.innerHTML='<div class="piece chimney"></div><div class="smoke">...</div>',e.face1.innerHTML="‚åÅ",e.face2.innerHTML="‚åÅ"},m.powerWind.add=function(e){e.type="powerWind",e=u("div",{class:"gameObj building piece basis",p:e.visibleEl}),e=u("div",{class:"helixGroup",p:e}),u("div",{class:"piece helix1",p:e}),u("div",{class:"piece helix2",p:e}),u("div",{class:"piece helix3",p:e})},m.sport.add=function(e){e.type="sport",u("div",{class:"gameObj piece",p:e.visibleEl})},land=new SimLand("land",21)</script>