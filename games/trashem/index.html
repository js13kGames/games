<!doctype html><title>TRASH'em - js13kGames 2012</title><meta content="width=device-width" name=viewport><style>*{margin:0;padding:0}html{height:100%}body{background-color:#eee;height:100%;font-family:Verdana;font-size:100%}#wrapper{width:500px;height:100%;margin:0 auto;background:0 0}#game{margin-top:40px}h1{text-align:center;padding-top:20px}ul{list-style-type:none;margin:20px 0 0 75px}li{float:left;width:100px;margin-right:15px;padding:5px 3px;border:1px solid #999;background:#fff;text-align:center}li span{display:block;font-size:.7em}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}#desc{padding:20px 0}</style><div id=wrapper><h1>TRASH'em</h1><canvas height=500 id=game width=500></canvas><ul class=clearfix><li id=start>start <span>[enter]</span><li id=pauza>pause <span>[space]</span><li id=reset>reset <span>[escape]</span></ul><div id=desc><p>Be fast enough to clean the area before it get really crowded. Only few rules: simple move the colored boxes through the wall with the same color. You can use both mouse and touch-screens.<p>To get more points simple try to swipe simultanously.<br>It is only a draft: to be continued. Have fun!</div></div><script>function t(){this.list=[],this.listTrashing=[],this.clickedItem}t.prototype.usunWszystkie=function(){this.list.splice(0,this.list.length),this.listTrashing.splice(0,this.listTrashing.length),delete this.clickedItem},t.prototype.detectIsClicked=function(t,s,e,i,h,a){return e<t&&i<s&&t<e+h&&s<i+a},t.prototype.markClickedItems=function(t,s){var e,i=this.list;if(!1===d.isPrzesuwane)for(e=this.list.length,--e;0<=e;--e)if(void 0!==i[e]&&!i[e].slidingToTrash&&this.detectIsClicked(t,s,i[e].x,i[e].y,i[e].sizex,i[e].sizey)){i[e].trafiony=!0,this.clickedItem=e,d.isPrzesuwane=!0;break}},t.prototype.unmarkClickedItem=function(){d.STOS.list[d.STOS.clickedItem].trafiony=!1,delete d.STOS.clickedItem,d.isPrzesuwane=!1},t.prototype.trashItem=function(t){var s;this.list[t].toDel?("up"===(s=this.list[t].trashDir)?(d.trashes.trashTop.delUsuwany(),0===d.trashes.trashTop.usuwanych&&d.trashes.trashTop.generateTyp()):"right"===s?(d.trashes.trashRight.delUsuwany(),0===d.trashes.trashRight.usuwanych&&d.trashes.trashRight.generateTyp()):"down"===s?(d.trashes.trashBottom.delUsuwany(),0===d.trashes.trashBottom.usuwanych&&d.trashes.trashBottom.generateTyp()):"left"===s&&(d.trashes.trashLeft.delUsuwany(),0===d.trashes.trashLeft.usuwanych)&&d.trashes.trashLeft.generateTyp(),this.listTrashing.splice(this.listTrashing.indexOf(t),1),delete this.list[t]):this.list[t].slideToTrash(this.list[t].trashDir)},(Trash=function(){this.color,this.height,this.typ,this.x,this.y,this.usuwanych=0,this.width}).prototype.generateTyp=function(t){this.typ=void 0!==t?t:Math.floor(Math.random()*d.utils.typ.length),this.color=d.utils.typ[this.typ].color},Trash.prototype.setSizes=function(t,s,e,i){this.x=t,this.y=s,this.width=e,this.height=i},Trash.prototype.addUsuwany=function(){this.usuwanych=this.usuwanych+1},Trash.prototype.delUsuwany=function(){this.usuwanych=this.usuwanych-1},(Klocek=function(){this.x=0,this.y=0,this.sizex=0,this.sizey=0,this.toDel=!1,this.slidingToTrash=!1,this.trashDir,this.typ,this.trafiony=!1}).prototype.generate=function(){var t=d.utils.klocMaxSize,s=d.utils.klocMinSize;this.sizex=Math.ceil(Math.random()*t),this.sizex<s&&(this.sizex=s),this.sizey=Math.ceil(Math.random()*t),this.sizey<s&&(this.sizey=s),this.x=Math.floor(Math.random()*(d.utils.areaWidth-this.sizex)),this.y=Math.floor(Math.random()*(d.utils.areaHeight-this.sizey)),this.setTyp()},Klocek.prototype.setAsSlidingToTrash=function(t,s){this.slidingToTrash=1,this.trashDir=s,this.trafiony=!1,"up"===s?d.trashes.trashTop.addUsuwany():"right"===s?d.trashes.trashRight.addUsuwany():"down"===s?d.trashes.trashBottom.addUsuwany():"left"===s&&d.trashes.trashLeft.addUsuwany(),d.STOS.listTrashing.push(t),d.isPrzesuwane=!1,delete d.STOS.clickedItem},Klocek.prototype.setTyp=function(){this.typ=Math.floor(Math.random()*d.utils.typ.length),this.color=d.utils.typ[this.typ].color},Klocek.prototype.slideToTrash=function(t){"up"===t?(this.sizey=this.sizey-1,this.sizey<=0&&(this.toDel=!0)):"right"===t?(this.sizex=this.sizex-1,this.x=this.x+1,this.sizex<=1&&(this.toDel=!0)):"down"===t?(this.sizey=this.sizey-1,this.y=this.y+1,this.sizey<=1&&(this.toDel=!0)):"left"===t&&(this.sizex=this.sizex-1,this.sizex<=1)&&(this.toDel=!0),d.score.add()};var d=new function(){function i(t,s){u=s,0<=(c=t)&&0<=u&&c<=l.utils.areaWidth&&l.utils.areaHeight}var t,s,e,r,o,h=document.getElementById("game"),a=h.getContext("2d"),n=!1,l=this,c=0,u=0;this.isPrzesuwane=!1,this.trashes={},this.utils={canvasWidth:h.width,canvasHeight:h.height,canvasOffsetLeft:h.offsetLeft,canvasOffsetTop:h.offsetTop,klocMinSize:60,klocMaxSize:170,scrollLeft:document.body.scrollLeft||document.documentElement.scrollLeft,scrollTop:document.body.scrollTop||document.documentElement.scrollTop,trashBorder:20,areaX:20,areaY:20,areaX2:h.width-20,areaY2:h.height-20,areaWidth:h.width-40,areaHeight:h.height-40,trafionyRelease:60,typ:[{color:"rgb(245,184,0)"},{color:"rgb(50,50,50)"},{color:"rgb(64,118,165)"},{color:"rgb(187,43,48)"}]},this.score=(e=0,{add:function(){++e},get:function(){return e},bonus:function(t){e+=t},reset:function(){e=0},save:function(){}}),this.recount=function(){var t,s=this.STOS.listTrashing.length,e=this.STOS.clickedItem,i=this.STOS.list;for(--s;0<=s;--s)this.STOS.trashItem(this.STOS.listTrashing[s]);void 0!==e&&(t={x:c,y:u},i[e].x=t.x,i[e].y=t.y,(i[e].x<0||!t.isIn&&t.x<0)&&(i[e].typ===this.trashes.trashLeft.typ?(i[e].setAsSlidingToTrash(e,"left"),l.messages.checkBonus("left",i[e].x,i[e].y,i[e].sizex,i[e].sizey)):i[e].x=0),(i[e].x+i[e].sizex>this.utils.areaWidth||!t.isIn&&t.x>this.utils.areaWidth-i[e].sizex)&&(i[e].typ===this.trashes.trashRight.typ?(i[e].setAsSlidingToTrash(e,"right"),l.messages.checkBonus("right",i[e].x,i[e].y,i[e].sizex,i[e].sizey)):i[e].x=this.utils.areaWidth-i[e].sizex),(i[e].y<0||!t.isIn&&t.y<0)&&(i[e].typ===this.trashes.trashTop.typ?(i[e].setAsSlidingToTrash(e,"up"),l.messages.checkBonus("up",i[e].x,i[e].y,i[e].sizex,i[e].sizey)):i[e].y=0),i[e].y+i[e].sizey>this.utils.areaHeight||!t.isIn&&t.y>this.utils.areaHeight-i[e].sizey)&&(i[e].typ===this.trashes.trashBottom.typ?(i[e].setAsSlidingToTrash(e,"down"),l.messages.checkBonus("down",i[e].x,i[e].y,i[e].sizex,i[e].sizey)):i[e].y=this.utils.areaHeight-i[e].sizey),this.messages.persist()},this.redraw=function(){var t,s,e,i=this.STOS.list.length;for(a.clearRect(0,0,h.width,h.height),a.save(),a.translate(this.utils.trashBorder,this.utils.trashBorder),t=0;t<i;t++)void 0!==this.STOS.list[t]&&this.STOS.list[t]!==this.STOS.clickedItem&&(s=this.STOS.list[t],a.save(),a.fillStyle=s.color,!0===s.trafiony&&(a.lineJoin="round",a.strokeStyle="rgb(255,100,100)",a.lineWidth=5,a.strokeRect(s.x,s.y,s.sizex,s.sizey)),a.fillRect(s.x,s.y,s.sizex,s.sizey),a.restore());for(void 0!==this.STOS.clickedItem&&(a.save(),s=this.STOS.list[this.STOS.clickedItem],a.fillStyle=s.color,!0===s.trafiony&&(a.lineJoin="round",a.strokeStyle="rgb(255,100,100)",a.lineWidth=5,a.strokeRect(s.x,s.y,s.sizex,s.sizey)),a.fillRect(s.x,s.y,s.sizex,s.sizey),a.restore()),a.restore(),a.save(),a.fillStyle=this.trashes.trashTop.color,a.fillRect(this.trashes.trashTop.x,this.trashes.trashTop.y,this.trashes.trashTop.width,this.trashes.trashTop.height),a.restore(),a.save(),a.fillStyle=this.trashes.trashRight.color,a.fillRect(this.trashes.trashRight.x,this.trashes.trashRight.y,this.trashes.trashRight.width,this.trashes.trashRight.height),a.restore(),a.save(),a.fillStyle=this.trashes.trashBottom.color,a.fillRect(this.trashes.trashBottom.x,this.trashes.trashBottom.y,this.trashes.trashBottom.width,this.trashes.trashBottom.height),a.restore(),a.save(),a.fillStyle=this.trashes.trashLeft.color,a.fillRect(this.trashes.trashLeft.x,this.trashes.trashLeft.y,this.trashes.trashLeft.width,this.trashes.trashLeft.height),a.restore(),e=this.messages.lista.length,--e;0<=e;--e){switch(a.save(),a.fillStyle="#f00",a.font=" 20px sans-serif",a.textBaseline="bottom",this.messages.lista[e].dir){case"up":a.fillText(this.messages.lista[e].text,this.messages.lista[e].pos.x,this.messages.lista[e].duration/2);break;case"left":a.fillText(this.messages.lista[e].text,this.messages.lista[e].duration/2,this.messages.lista[e].pos.y);break;case"right":a.fillText(this.messages.lista[e].text,this.utils.canvasWidth-this.messages.lista[e].duration,this.messages.lista[e].pos.y);break;case"down":a.fillText(this.messages.lista[e].text,this.messages.lista[e].pos.x,this.utils.canvasHeight-this.messages.lista[e].duration/2)}a.restore()}a.save(),a.fillStyle="#555",a.font=" 15px sans-serif",a.textBaseline="bottom",a.fillText("score: "+this.score.get(),22,this.utils.canvasHeight-22),a.restore()},this.setPointerPos=function(t){var s,e;void 0===t.touches?(s=window.event?t.pageX:t.clientX+d.utils.scrollLeft,e=window.event?t.pageY:t.clientY+d.utils.scrollTop):(s=t.touches[0].pageX,e=t.touches[0].pageY,t.preventDefault()),i(s=(s-=d.utils.canvasOffsetLeft)-d.utils.areaX,e=(e-=d.utils.canvasOffsetTop)-d.utils.areaY)},this.clickDown=function(t){var s,e;n&&(void 0===t.touches?(s=window.event?t.pageX:t.clientX+d.utils.scrollLeft,e=window.event?t.pageY:t.clientY+d.utils.scrollTop):(s=t.touches[0].pageX,e=t.touches[0].pageY,t.preventDefault()),i(s=(s-=d.utils.canvasOffsetLeft)-d.utils.areaX,e=(e-=d.utils.canvasOffsetTop)-d.utils.areaY),0<s)&&s<d.utils.areaWidth&&0<e&&e<d.utils.areaHeight&&l.STOS.markClickedItems(s,e)},this.clickRelease=function(t){d.isPrzesuwane&&d.STOS.unmarkClickedItem()},this.messages=(o=100,{lista:r=[],checkBonus:function(t,s,e,i,h){var a=d.STOS.listTrashing.length;2===a?(r.push({typ:2,dir:t,pos:l.messages.setTextPos(t,s,e,i,h),duration:o,text:"+20"}),l.score.bonus(20)):3===a?(r.push({typ:3,dir:t,pos:l.messages.setTextPos(t,s,e,i,h),duration:o,text:"+60"}),l.score.bonus(60)):4===a?(r.push({typ:4,dir:t,pos:l.messages.setTextPos(t,s,e,i,h),duration:o,text:"+120"}),l.score.bonus(120)):5===a?(r.push({typ:4,dir:t,duration:o,text:"+300"}),l.score.bonus(300)):5<a&&(r.push({typ:4,dir:t,duration:o,text:"+1000"}),l.score.bonus(1e3))},persist:function(){var t=r.length;for(--t;0<=t;--t)--this.lista[t].duration<0&&this.lista.splice(t,1)},reset:function(){r.splice(0,r.length)},setTextPos:function(t,s,e,i,h){var a,r;switch(t){case"up":case"down":a=s+i/2,r=0;break;case"left":case"right":a=0,r=e+h/2}return{x:a,y:r}}}),this.loop=function(){l.recount(),l.redraw()},this.play=function(){n||(document.body.addEventListener("mousemove",l.setPointerPos,!1),h.addEventListener("mousedown",l.clickDown,!1),document.body.addEventListener("mouseup",l.clickRelease,!1),document.body.addEventListener("touchmove",l.setPointerPos,!1),h.addEventListener("touchstart",l.clickDown,!1),document.body.addEventListener("touchend",l.clickRelease,!1),this.trashes.trashTop=new Trash,this.trashes.trashTop.generateTyp(0),this.trashes.trashTop.setSizes(this.utils.trashBorder,0,this.utils.areaWidth,this.utils.trashBorder),this.trashes.trashRight=new Trash,this.trashes.trashRight.generateTyp(1),this.trashes.trashRight.setSizes(this.utils.areaX2,this.utils.areaY,this.utils.trashBorder,this.utils.areaHeight),this.trashes.trashBottom=new Trash,this.trashes.trashBottom.generateTyp(2),this.trashes.trashBottom.setSizes(this.utils.trashBorder,this.utils.areaX2,this.utils.areaWidth,this.utils.trashBorder),this.trashes.trashLeft=new Trash,this.trashes.trashLeft.generateTyp(3),this.trashes.trashLeft.setSizes(0,this.utils.trashBorder,this.utils.trashBorder,this.utils.areaWidth),t=setInterval(this.loop,1e3/30),s=setInterval(function(){(klocek=new Klocek).generate(),l.STOS.list.push(klocek)},1e3),n=!0)},this.stop=function(){n?(clearInterval(t),clearInterval(s),n=!n):l.play()},this.reset=function(){clearInterval(t),clearInterval(s),a.clearRect(0,0,h.width,h.height),l.STOS.usunWszystkie(),l.score.reset(),l.messages.reset(),n=!1},this.listen=function(){window.addEventListener("keydown",function(t){switch(t.keyCode){case 13:d.play();break;case 27:d.reset();break;case 32:d.stop()}},!1),document.getElementById("start").ontouchstart=function(){d.play()},document.getElementById("pauza").ontouchstart=function(){d.stop()},document.getElementById("reset").ontouchstart=function(){d.reset()},document.getElementById("start").onmousedown=function(){d.play()},document.getElementById("pauza").onmousedown=function(){d.stop()},document.getElementById("reset").onmousedown=function(){d.reset()}},this.paingBg=function(){a.clearRect(0,0,h.width,h.height),a.fillStyle="#ff8834",a.fillRect(30,40,80,120)}};d.listen(),d.STOS=new t</script>