<!doctype html><title>Stella Proelium - js13kGames 2021</title><meta name=viewport content="width=device-width"><style>body{margin:0;padding:0;overscroll-behavior:contain;background:#333;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}canvas{image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}canvas:not(#c):not(#ctrl){max-width:16px;display:none}#c{width:45%;min-width:320px;max-width:640px;display:block;height:auto;background:#000;margin:0 auto}#l{color:#fff;text-align:center}#ld{color:#fff;text-align:center}#ctrl{display:block;height:auto;margin:0 auto;background:#000}p{color:#fff}</style><canvas id=c></canvas><script>var f={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,1]],2:[[1,1,1],[0,0,1],[0,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,0],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],".":[[,,],[,,],[,,],[,,],[0,1,0]],"<":[[0,0,1],[0,1,0],[1,0,0],[0,1,0],[0,0,1]]};function c(e){e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1}function x(e,t,i={}){i.appendDOM=null!=i.appendDOM&&i.appendDOM;var n=document.createElement("canvas");return n.width=e,n.height=t,i.appendDOM&&document.body.appendChild(n),n}function w(e){return(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function ke(e,t,i,n){return Math.hypot(e-i,t-n)}function n(e){return e*Math.PI/180}function Me(e,t,i,n,r,a="#fff"){var s=[];n=n.toUpperCase();for(var l=0;l<n.length;l++)(o=f[n.charAt(l)])&&s.push(o);e.fillStyle=a;for(var h=t,l=0;l<s.length;l++){for(var o=s[l],d=i,g=0,y=0;y<o.length;y++){for(var m=o[y],p=0;p<m.length;p++)m[p]&&e.fillRect(h+p*r,d,r,r);g=Math.max(g,m.length*r),d+=r}h+=r+g}}function _(t,i,n){for(let e=0;e<1;e++)t.beginPath(),t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.lineTo(i[2].x,i[2].y),t.closePath(),t.fillStyle=n,t.fill()}function b(t,i,n,r,a=null,s=null,l=1){for(let e=0;e<1;e++){var h=void 0,[h,o,d,g,y,m=null,p=null,f=1]=[t,i,n,r,r,a,s,l];for(let e=0;e<1;e++)h.beginPath(),h.ellipse(o,d,g,y,0,0,2*Math.PI,!1),null!=m&&(h.fillStyle=m,h.fill()),null!=p&&(h.strokeStyle=p,h.lineWidth=f,h.stroke())}}function Ce(t,i,n,r,a,s=null,l=null,h=1){for(let e=0;e<1;e++)null!=s&&(t.fillStyle=s,t.fillRect(i,n,r,a)),null!=l&&(t.strokeStyle=l,t.lineWidth=h,t.strokeRect(0,0,r,a))}function Ie(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}let g=function(){var e={};function t(e,t,i){this.x=e,this.y=t,this.z=i}t.prototype.dot2=function(e,t){return this.x*e+this.y*t},g3=[new t(1,1,0),new t(-1,1,0),new t(1,-1,0),new t(-1,-1,0),new t(1,0,1),new t(-1,0,1),new t(1,0,-1),new t(-1,0,-1),new t(0,1,1),new t(0,-1,1),new t(0,1,-1),new t(0,-1,-1)];let n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];function r(e){return e*e*e*(e*(6*e-15)+10)}function a(e,t,i){return(1-i)*e+i*t}return perm=new Array(512),gP=new Array(512),e.seed=function(e){for(0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8),i=0;i<256;i++)v=0,v=1&i?n[i]^255&e:n[i]^e>>8&255,perm[i]=perm[i+256]=v,gP[i]=gP[i+256]=g3[v%12]},e.seed(0),e.perlin2=function(e,t){return X=Math.floor(e),Y=Math.floor(t),e-=X,t-=Y,X&=255,Y&=255,n00=gP[X+perm[Y]].dot2(e,t),n01=gP[X+perm[Y+1]].dot2(e,t-1),n10=gP[X+1+perm[Y]].dot2(e-1,t),n11=gP[X+1+perm[Y+1]].dot2(e-1,t-1),u=r(e),a(a(n00,n10,u),a(n01,n11,u),r(t))},e}();function Le(e,t,i){return e<t?t:i<e?i:e}function Pe(e){return e.x<-64||288<e.x||e.y<-64||352<e.y}function He(e,t){e.origin=null!=e.origin?e.origin:{x:0,y:0},t.origin=null!=t.origin?t.origin:{x:0,y:0};var i=e.x-e.origin.x,n=e.y-e.origin.y,r=t.x-t.origin.x,a=t.y-t.origin.y;return i<r+t.dw&&r<i+e.dw&&n<a+t.dh&&a<n+e.dh}function Ke(e,t){-1!=e.hp&&(0<e.hp-t.power?(e.hp-=t.power,e.showHit=!0):(0<e.hp&&e.onDestroy&&e.onDestroy(),e.hp=0,e.destr=!0))}function R(e,t,i,n){e.fillStyle=n,e.fillRect(t,i,1,1)}g.seed(451);class t{constructor(e){if(this.type=e.type,this.depth=null!=e.depth?e.depth:0,this.plyr=e.plyr,this.img=e.img,this.x=e.x,this.y=e.y,this.canCull=null==e.canCull||e.canCull,this.perceivedHeight=null!=e.perceivedHeight?e.perceivedHeight:32,this.frame=e.frame,this.showHitDelay=10,this.showHitTick=0,this.showHit=!1,this.imgs=e.imgs,this.vis=!0,this.isPlaying=null!=this.img&&!!this.img.anim,this.animDelay=e.animDelay,this.animTick=e.animTick,this.scaleX=null!=e.scaleX?e.scaleX:1,this.scaleY=null!=e.scaleY?e.scaleY:1,null!=e.scale&&(this.scaleX=e.scale,this.scaleY=e.scale),this.angle=0,this.groundProj=null!=e.groundProj&&e.groundProj,this.speed=e.speed,this.velX=null!=e.velX?e.velX:0,this.velY=null!=e.velY?e.velY:0,this.points=void 0!==e.points?e.points:0,this.life=null!=e.life?e.life:-1,this.hpInit=null!=e.hp?e.hp:-1,this.hp=this.hpInit,this.power=null!=e.power?e.power:0,this.isFriendly=null==e.isFriendly||e.isFriendly,this.destr=!1,this.w=0,this.h=0,(this.dyntex=null)!=this.img){if(null!=this.img.dynrender){if(this.img.dynrender&&(this.dyntex=this.img.dyntexes[Ie(0,this.img.dyntexes.length-1)],this.w=this.dyntex.canv.width,this.h=this.dyntex.canv.height,(this.dyntex.shadCanv=null)!=this.img.dynrender.hs)&&this.img.dynrender.hs){this.dyntex.shadCanv=x(this.img.dynrender.w,this.img.dynrender.h);var t=this.dyntex.shadCanv.getContext("2d"),i=this.dyntex.canv.getContext("2d").getImageData(0,0,this.img.dynrender.w,this.img.dynrender.h),n=i.data;for(let e=0;e<n.length;e+=4)0<n[e+3]&&(n[e]=0,n[e+1]=0,n[e+2]=0);t.putImageData(i,0,0)}}else this.w=this.img.el.width,this.h=this.img.el.height;this.img.anim&&(this.w=this.img.fw,this.h=this.img.fh)}this.dw=this.w*this.scaleX,this.dh=this.h*this.scaleY,this.origin=null!=e.origin?e.origin:{x:0,y:0},(this.shadow=null)!=this.dyntex&&null!=this.dyntex.shadCanv&&(this.shadow=Be({img:{fw:this.img.fw,fh:this.img.fh,anim:this.img.anim,el:this.dyntex.shadCanv},x:this.x,y:this.y,animTick:this.animTick,animDelay:this.animDelay,origin:{x:this.w/2,y:this.h/2},scaleX:.4*this.scaleX,scaleY:.4*this.scaleY}))}baseUpdate(){this.x+=this.velX,this.y+=this.velY,this.perceivedHeight<0&&(this.perceivedHeight=0),null!=this.shadow&&(this.shadow.x=this.x,this.shadow.y=this.y-1.5*this.perceivedHeight,this.shadow.angle=this.angle),this.showHit&&(this.showHitTick<this.showHitDelay?this.showHitTick++:(this.vis=!0,this.showHit=!1,this.showHitTick=0)),-1!=this.life&&(0<this.life?this.life--:this.destr=!0)}update(){this.baseUpdate()}baseRender(t){if(this.baseUpdate(),this.shadow&&this.shadow.update(),this.update&&this.update(),this.showHit&&(this.vis=!1),this.vis&&(this.shadow&&this.shadow.render(t),this.img)){t.translate(Math.round(this.x),Math.round(this.y)),t.scale(this.scaleX,this.scaleY),t.rotate(n(this.angle));let e=this.img.el;null!=this.img.dynrender&&this.img.dynrender&&(e=this.dyntex.canv),this.img.anim?(this.isPlaying&&(this.animTick<this.animDelay?this.animTick++:(this.frame<this.img.frames-1?this.frame++:this.frame=0,this.animTick=0)),t.drawImage(e,this.frame*this.img.fw,0,this.img.fw,this.img.fh,-this.origin.x,-this.origin.y,this.w,this.h)):t.drawImage(e,-this.origin.x,-this.origin.y,this.w,this.h),t.setTransform(1,0,0,1,0,0)}}render(e){this.baseRender(e)}}class o extends t{constructor(e){super(e),e.type="player"}}class Ee extends t{constructor(e){super(e)}}class Ae extends t{constructor(e){super(e),this.origin={x:8,y:8},this.hasCharged=!1}update(){this.angle+=10,this.y>this.plyr.y-64&&(this.velY=3,this.hasCharged||(this.x<this.plyr.x?this.velX=5:this.x>this.plyr.x&&(this.velX=-5),this.hasCharged=!0))}}class Oe extends t{constructor(e){super(e),this.maxChaseSpeed=3,this.chaseSpeed=.5}update(){var e,t;ke(this.x,this.y,this.plyr.x,this.plyr.y)<128&&(this.isPlaying=!0,this.chaseSpeed<this.maxChaseSpeed&&(this.chaseSpeed+=.01),e=this.plyr.x-this.x,t=this.plyr.y-this.y,t=Math.atan2(t,e),e=this.chaseSpeed*Math.cos(t),t=this.chaseSpeed*Math.sin(t),this.velX<e?this.velX+=.05:this.velX-=.05,this.velY<t?this.velY+=.05:this.velY-=.05)}}class Ne extends t{constructor(e){super(e),this.canShoot=!0}}class We extends t{constructor(e){super(e),this.buildings=[]}}class Xe extends t{constructor(e){super(e),this.state="move_forward",this.canSpawnGun=!1,this.hasSpawnedGun=!1,this.buildings=[]}update(){"move_forward"===this.state&&(this.y<72?this.velY=.15:(this.velY=0,this.canSpawnGun=!0))}}function Be(e){return new t(e)}window.addEventListener("DOMContentLoaded",()=>{let P=document.getElementById("c"),H=(P.width=224,P.height=288,P.getContext("2d")),e=(c(H),x(224,96)),t=(e.id="ctrl",e.getContext("2d")),K=void c(H),E=null,pe=10,A=0,O=0,d=[451,981,463,928,126,521],i=[],N=[],W=[],X=[],B=null,U=null,fe=null,j=null,F=0,n=3,J=n,ue=3,r=3,a=1,z=ue,V=z,q=0,ce=10,s=1,Q=s,Z=0,xe=30,$=!1,ee=0,te={x:Ie(0,P.width),y:Ie(128,200)},we=!1,ve=10,_e=!1,be=10,ie=[],ne=[],re=!0,ae=!1,Ye=!1,se=0,le=0,Re=0,De=["PLAY","HIGH SCORES"],he=0,Te=["BACK","CLEAR SCORES"],oe=0,Se=["BACK","CLEAR SCORES"],de=0,ge={pu_fireball:{life:300,callbacks:{pickup:()=>{z=r}}},pu_missile:{life:200,callbacks:{pickup:()=>{z=a}}}},ye={};function me(e){N.length=0,W.length=0,X.length=0,B=null,U=null,fe=null,j=null,F=0,n=3,r=1,a=1,V=z=ue=3,q=0,ce=10,Q=s=1,Z=0,xe=30,$=!1,ee=0,ie.length=0,ne.length=0,se=0,Re=0;for(let e=he=0;e<i.length;e++)clearTimeout(i[e]),i.splice(e,1),e--;switch(l(),e.type){case"soft":ae=!1,Ye=!1;break;case"hard":le=0,J=n,A=0,re=!0,ae=!1,Ye=!1}}function l(){for(let t=0;t<14;t++)for(let e=-1;e<18;e++)Ge(t,e,t,e);(B=new o({x:.5*P.width,y:.5*P.height,origin:{x:8,y:8},img:E.plyr,hp:1,animDelay:7})).onDestroy=()=>{if(1==O){let e=JSON.parse(localStorage.getItem("stella_proelium"));(e=null!=e&&null!=e?e:{}).highscores=null!=e.highscores?e.highscores:[],e.highscores.push(F),e.highscores.sort((e,t)=>t-e),localStorage.setItem("stella_proelium",JSON.stringify(e)),t=0<J?(J--,setTimeout(function(){me({type:"soft"})}.bind(this),3e3)):setTimeout(function(){O=0,me({type:"very hard"})}.bind(this),3e3)}else var t=setTimeout(function(){me({type:"soft"})}.bind(this),3e3);i.push(t)},(U=Be({x:B.x,y:B.y-48,origin:{x:8,y:8},frame:0,img:E.crosshair})).isPlaying=!1,fe=Be({x:16,y:P.height-40,img:E.pslot})}function Ge(n,r,e,t){g.seed(d[A]);var i,a,s,l,h,o=g.perlin2(e/pe,t/pe);switch(A){case 0:{let e=0,t=(o<-.01&&-.15<o?e=1:o<=-.15&&-.35<o?e=2:o<=-.3&&(e=3),null);if(-.4<o?(t=Be({img:E.gpl,x:16*n,y:16*r,frame:e})).isPlaying=!1:(t=Be({img:E.water,x:16*n,y:16*r,frame:e,animTick:Ie(0,60),animDelay:120})).isPlaying=!0,N.push(t),o<=-(.15+2e-6*le)&&-.151<=o&&re)if(50<Ie(0,100)){gaa=new Ne({plyr:B,type:"gaa",x:16*n,y:16*r,img:E.gaa,animTick:0,animDelay:7,depth:1,hp:1,points:75}),N.push(gaa);for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++)0!=t&&0!=e&&(i=Be({plyr:B,type:"garmor",x:16*n+16*t,y:16*r+16*e,img:E.garmor,depth:1,hp:1,points:150}),N.push(i))}else{let i=new We({plyr:B,type:"gaa_large_hub",x:n,y:r,img:E.gaa_large_hub,animTick:0,animDelay:7,depth:0});N.push(i),(h=Be({plyr:B,type:"gaa_large_dome",x:n+16,y:r+16,img:E.gaa_large_dome,depth:1,hp:1,points:1e3})).onDestroy=()=>{i.buildings.forEach(t=>{var e=Be({img:E.crater,x:t.x,y:t.y,frame:Ie(0,3),animTick:0,animDelay:30});N.push(e);for(let e=0;e<100;e++){var i=Be({img:E[(i=["smoke","fire"])[Ie(0,i.length-1)]],x:t.x+Ie(4,12),y:t.y+Ie(4,12),life:Ie(300,600)});W.push(i)}t.destr=!0})},i.buildings.push(h),N.push(h);for(let t=-2;t<=2;t++)for(let e=-2;e<=2;e++)(0==t&&0!=e||0==e&&0!=t)&&-1!=t&&1!=t&&-1!=e&&1!=e&&(s=new Ne({plyr:B,type:"gaa",x:n+16+16*t,y:r+16+16*e,img:E.gaa,animTick:0,animDelay:3,depth:1,hp:1,points:75}),i.buildings.push(s),N.push(s))}break}case 1:{let e=0,t=(o<-.01&&-.15<o?e=1:o<=-.15&&-.35<o?e=2:o<=-.3&&(e=3),null);if(-.4<o?(t=Be({img:E.molt,x:16*n,y:16*r,frame:e})).isPlaying=!1:t=Be({img:E.lava,x:16*n,y:16*r,frame:e,animTick:Ie(0,96),animDelay:96}),N.push(t),o<=-(.15+2e-6*le)&&-.151<=o&&re)if(50<Ie(0,100)){gaa=new Ne({plyr:B,type:"gaa_armored",x:16*n,y:16*r,img:E.gaa_armored,animTick:0,animDelay:7,depth:1,hp:1,points:75}),N.push(gaa);for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++)0!=t&&0!=e&&(a=Be({plyr:B,type:"garmor_strong",x:16*n+16*t,y:16*r+16*e,img:E.garmor_strong,depth:1,hp:1,points:150}),N.push(a))}else{let i=new We({plyr:B,type:"gaa_large_hub_armored",x:n,y:r,img:E.gaa_large_hub_armored,animTick:0,animDelay:7,depth:0,hp:2});N.push(i),(h=Be({plyr:B,type:"gaa_large_dome",x:n+16,y:r+16,img:E.gaa_large_dome,depth:1,hp:1,points:1e3})).onDestroy=()=>{i.buildings.forEach(t=>{var e=Be({img:E.crater,x:t.x,y:t.y,frame:Ie(0,3),animTick:0,animDelay:30});N.push(e);for(let e=0;e<100;e++){var i=Be({img:E[(i=["smoke","fire"])[Ie(0,i.length-1)]],x:t.x+Ie(4,12),y:t.y+Ie(4,12),life:Ie(300,600)});W.push(i)}t.destr=!0})},i.buildings.push(h),N.push(h);for(let t=-2;t<=2;t++)for(let e=-2;e<=2;e++)(0==t&&0!=e||0==e&&0!=t)&&-1!=t&&1!=t&&-1!=e&&1!=e&&(l=new Ne({plyr:B,type:"gaa_armored",x:n+16+16*t,y:r+16+16*e,img:E.gaa_armored,animTick:0,animDelay:3,depth:1,hp:1,points:75}),i.buildings.push(l),N.push(l))}break}case 2:h=Ie(0,3),(h=Be({img:E.stars,x:16*n,y:16*r,frame:h,animTick:Ie(0,500),animDelay:500})).isPlaying=!0,N.push(h)}}var h;window.addEventListener("keydown",e=>{if(!ye[e.code])switch(e.code){case"Enter":if(0==O)0==he?(O=1,me({type:"hard"})):1==he&&(O=2);else if(2==O)0==oe?O=0:1==oe&&(O=3);else if(3==O)if(0==de)O=2;else if(1==de){let e=JSON.parse(localStorage.getItem("stella_proelium"));(e=null!=e&&null!=e?e:{}).highscores=null!=e.highscores?e.highscores:[],e.highscores.length=0,localStorage.setItem("stella_proelium",JSON.stringify(e))}break;case"KeyW":0==O?0<=he-1?he--:he=De.length-1:2==O?0<=oe-1?oe--:oe=Te.length-1:3==O&&(de+1<Se.length?de++:de=0);break;case"KeyS":0==O?he+1<De.length?he++:he=0:2==O?oe+1<Te.length?oe++:oe=0:3==O&&(de+1<Se.length?de++:de=0)}ye[e.code]=!0}),window.addEventListener("keyup",e=>{ye[e.code]=!1}),h=function(){let e={hues:{BK:"#000000",WHT:"#ffffff",RD:"#883932",CYAN:"#67b6bd",MAG:"#8b3f96",GRN:"#55a049",PURP:"#40318d",LIME:"#bfce72",BWN:"#8b5429",DK_BWN:"#574200",CLAY:"#b86962",DK_GRY:"#505050",GRY:"#787878",LIME2:"#94e089",BLU:"#7869c4",LT_GRY:"#9f9f9f"}},h=e.hues,t=x(8*Object.keys(e.hues).length,8,{appendDOM:!0}).getContext("2d"),i=0;for(const h in e.hues)Ce(t,8*i,0,8,8,e.hues[h]),i++;var n,r={s16x16:{name:"s16x16",dynrender:{w:16,h:16,v:1,render:e=>{Ce(e,0,0,16,16,h.WHT)}}},plyr:{name:"plyr",dynrender:{w:16,h:16,v:1,hs:!0,ent:!0,render:e=>{_(e,[{x:8,y:1.6},{x:4,y:4},{x:8,y:8}],h.GRY),_(e,[{x:8,y:1.6},{x:12,y:4},{x:8,y:8}],h.LT_GRY),_(e,[{x:8,y:8},{x:0,y:12},{x:8,y:16}],h.GRY),_(e,[{x:8,y:8},{x:16,y:12},{x:8,y:16}],h.LT_GRY),_(e,[{x:8,y:0},{x:12,y:16},{x:4,y:16}],h.GRY),_(e,[{x:8,y:0},{x:12,y:16},{x:8.8,y:16}],h.LT_GRY),b(e,8,5.6,1.2,h.CYAN)}}},plzr:{name:"plzr",dynrender:{w:2,h:4,bg:h.CYAN,v:1,render:()=>{}}},fireball:{name:"fireball",frames:1,dynrender:{w:16,h:16,render:e=>{b(e,8,8,8,h.WHT,h.LIME,2)}}},bomb:{name:"bomb",dynrender:{w:2,h:4,bg:h.DK_GRY,v:1,hs:!0,render:()=>{}}},crosshair:{name:"crosshair",dynrender:{w:32,h:16,v:1,render:function(a){for(let r=0;r<2;r++)for(let n=16*r;n<16*r+16;n++)for(let i=0;i<16;i++){let e=16*r+8,t=!1;0!=r||n%15!=0&&i%15!=0||(t=!0),(t=(n==e-1||n==e)&&i%2==0||!(7!=i&&8!=i||7!=i&&8!=i||n%2!=0)||t)&&R(a,n,i,h.WHT)}}},frames:2,anim:!0,fw:16,fh:16},crater:{name:"crater",dynrender:{w:64,h:16,v:5,render:function(t){for(let e=0;e<4;e++)b(t,2*(e+.5)*8,8,8,h.BK,h.DK_GRY,1),b(t,2*(e+.5)*8,8,4,0==e||1==e?h.DK_GRY:h.RD);for(let e=0;e<80;e++)80<Ie(0,100)&&R(t,Ie(0,64),Ie(0,16),h.CLAY)}},frames:4,anim:!0,fw:16,fh:16},gpl:{name:"gpl",dynrender:{w:64,h:16,bg:h.DK_BWN,v:5,render:function(n){for(let i=0;i<64;i++)for(let t=0;t<16;t++)if(i<16){for(let e=0;e<Ie(0,1);e++){var r=Ie(2,5),a=Ie(2,3),s=i>.5*r&&i<64-.5*r?i+Ie(.5*r,16-.5*r):.5*r,l=t>.5*a&&t<16-.5*a?t+Ie(.5*a,16-.5*a):.5*a;n.fillStyle=h.DK_BWN,n.beginPath(),n.ellipse(s-1,l+1,r,a,Math.PI/4,0,2*Math.PI),n.fill(),n.fillStyle=h.GRN,n.beginPath(),n.ellipse(s,l,r,a,Math.PI/4,0,2*Math.PI),n.fill()}i%2==0&&t%2==1&&R(n,i,t,h.DK_BWN),i%4==0&&t%4==1&&3<Ie(0,10)&&R(n,i,t,h.LIME)}else 16<=i&&i<48?(R(n,i,t,h.GRN),1==Ie(0,500)&&R(n,i,t,h.LIME)):Ce(n,i,t,16,16,h.LIME)}},anim:!0,fw:16,fh:16},molt:{name:"molt",template:"gpl",dynrender:{palshift:[[h.DK_BWN,h.RD],[h.GRN,h.BK],[h.LIME,h.DK_GRY]]}},water:{name:"water",dynrender:{w:64,h:16,bg:h.PURP,v:1,render:function(t){for(let e=0;e<16;e++)R(t,Ie(0,64),Ie(0,16),h.CYAN)}},frames:4,anim:!0,fw:16,fh:16},lava:{name:"lava",template:"water",dynrender:{palshift:[[h.PURP,h.RD],[h.CYAN,h.LIME]]}},ice:{name:"ice",template:"water",dynrender:{palshift:[[h.PURP,h.CYAN]]}},stars:{name:"stars",template:"water",dynrender:{palshift:[[h.PURP,h.BK],[h.CYAN,h.LT_GRY]]}},drone:{name:"drone",dynrender:{w:32,h:16,v:1,hs:!0,ent:!0,render:function(t){for(let e=0;e<2;e++){b(t,2*(e+.5)*8,8,8,h.GRY,h.LT_GRY,1);var i=0==e?h.RD:h.CLAY,n=0==e?h.CLAY:h.LIME;b(t,2*(e+.5)*8,8,4,i),b(t,2*(e+.5)*8.8,7.2,.24,n)}}},anim:!0,frames:2,fw:16,fh:16},drone_armored:{name:"drone_armored",template:"drone",dynrender:{palshift:[[h.GRY,h.DK_GRY],[h.LT_GRY,h.GRY]]}},spinner:{name:"spinner",dynrender:{w:16,h:16,hs:!0,v:5,ent:!0,render:e=>{size=128;var t=Object.keys(h),t=h[t[t.length*Math.random()|0]];Ce(e,0,0,size,size,t)}}},garmor:{name:"garmor",dynrender:{w:16,h:16,v:1,bg:h.CYAN,ent:!0,render:e=>{_(e,[{x:0,y:0},{x:8,y:8},{x:0,y:16}],h.DK_GRY),_(e,[{x:16,y:0},{x:8,y:8},{x:16,y:16}],h.WHT)}}},garmor_strong:{name:"garmor_strong",template:"garmor",dynrender:{palshift:[[h.DK_GRY,h.BK],[h.GRY,h.BK],[h.CYAN,h.DK_GRY],[h.WHT,h.GRY]]}},gaa:{name:"gaa",anim:!0,fw:16,fh:16,frames:16,dynrender:{w:256,h:16,v:1,bg:h.CYAN,ent:!0,render:t=>{for(let e=0;e<16;e++)b(t,2*(e+.5)*8,8,8,h.WHT),0<e&&(b(t,2*(e+.5)*8,8,2*e,h.BK),b(t,2*(e+.5)*8,8,+e,h.RD))}}},gaa_armored:{name:"gaa_armored",template:"gaa",dynrender:{palshift:[[h.WHT,h.DK_GRY],[h.GRY,h.BK],[h.CYAN,h.BK],[h.RD,h.PURP]]}},gaa_bullet:{name:"gaa_bullet",anim:!0,fw:8,fh:8,frames:2,dynrender:{w:16,h:8,bg:h.CYAN,render:t=>{for(let e=0;e<2;e++)b(t,2*(e+.5)*4,4,4,0==e?h.WHT:h.LIME)}}},gaa_large_hub:{name:"gaa_large_hub",dynrender:{w:48,h:48,render:e=>{Ce(e,16,0,16,48,h.LT_GRY),Ce(e,0,16,48,16,h.LT_GRY),b(e,24,24,24,h.DK_GRY,h.BK,2),b(e,24.48,24.48,20,h.LT_GRY,h.GRY,4),b(e,24.96,24.96,12,h.WHT)}}},gaa_large_hub_armored:{name:"gaa_large_hub_armored",template:"gaa_large_hub",dynrender:{palshift:[[h.DK_GRY,h.BK],[h.GRY,h.DK_GRY],[h.LT_GRY,h.GRY],[h.WHT,h.LT_GRY]]}},gaa_large_dome:{name:"gaa_large_dome",dynrender:{w:16,h:16,render:e=>{b(e,8,8,8,h.CYAN,h.DK_GRY,1),b(e,9,9,3,h.WHT,h.LT_GRY,1)}}},big_baddie:{name:"big_baddie",dynrender:{w:112,h:124,render:e=>{_(e,[{x:0,y:16},{x:112,y:16},{x:56,y:124}],h.DK_GRY),Ce(e,28,0,16,16,h.BK),Ce(e,28,8,16,16,h.GRY),Ce(e,28,8,16,8,h.WHT),Ce(e,68,0,16,16,h.BK),Ce(e,68,8,16,16,h.LT_GRY),Ce(e,68,8,16,8,h.WHT),_(e,[{x:0,y:62},{x:56,y:0},{x:56,y:93}],h.GRY),_(e,[{x:112,y:62},{x:56,y:0},{x:56,y:93}],h.LT_GRY)}}},pu_fireball:{name:"pu_fireball",dynrender:{w:16,h:16,render:e=>{b(e,8,8,8,h.RD),b(e,8,8,16/3,h.CLAY),b(e,8,8,16/6,h.WHT)}}},pu_missile:{name:"pu_missile",dynrender:{w:16,h:16,render:e=>{Ce(e,4,8,4,16,h.LT_GRY)}}},smoke:{name:"smoke",template:"s16x16",dynrender:{palshift:[[h.WHT,h.GRY]]}},fire:{name:"fire",template:"s16x16",dynrender:{palshift:[[h.WHT,h.LIME]]}},pslot:{name:"pslot",dynrender:{w:24,h:24,render:e=>{Ce(e,0,0,24,24,null,h.WHT,4)}}}},a=["name"];for([n,p]of Object.entries(r)){var s=p;if(null!=s.template){let e=null;for(var[l,o]of Object.entries(r))o.name==s.template&&(e=Object.assign({},o));var d,g,y,m,p=s.dynrender;for([d,g]of Object.entries(e))a.includes(d)||(s[d]=g.valueOf());for([y,m]of Object.entries(p))s.dynrender[y]=m}s.dyntexes=[],s.dynrender.v=null!=s.dynrender.v?s.dynrender.v:1,s.dynrender.hues=Object.assign({},h);for(let e=0;e<s.dynrender.v;e++)s.dyntexes.push(function(e){let t=x(e.w,e.h,{appendDOM:!0}),i=t.getContext("2d",{willReadFrequently:!0});c(i),null!=e.bg&&(i.fillStyle=e.bg,i.fillRect(0,0,t.width,t.height)),e.render&&e.render(i);var n=[];for(const t in e.hues)n.push(e.hues[t]);var r=function(e,t){for(var i,n=0,r=e.length,a=0;a<r;a+=4)0<e[a+3]&&(i=w(t[function(e,t){for(var i=0,n=Number.MAX_VALUE,r=0;r<t.length;r++){var a=w(e),s=w(t[r]),l=0;(l=(l+=(a.r-s.r)*(a.r-s.r))+(a.g-s.g)*(a.g-s.g)+(a.b-s.b)*(a.b-s.b))<n&&(i=r,n=l)}return i}("#"+((1<<24)+(e[a]<<16)+(e[a+1]<<8)+e[a+2]).toString(16).slice(1),t)]),e[a]==i.r&&e[a+1]==i&&e[a+2]==i.b||(e[a]=i.r,e[a+1]=i.g,e[a+2]=i.b,e[a+3]=255,n++));return{data:e,amountReplaces:n}}(i.getImageData(0,0,t.width,t.height).data,n),r=new ImageData(r.data,t.width,t.height);if(i.putImageData(r,0,0),e.palshift){var a=i,s=e.palshift,l=(r=a.getImageData(0,0,e.w,e.h)).data;for(let t=0;t<l.length;t+=4)for(let e=0;e<s.length;e++){var h=w((o=s[e])[0]),o=w(o[1]);l[t]==h.r&&l[t+1]==h.g&&l[t+2]==h.b&&(l[t]=o.r,l[t+1]=o.g,l[t+2]=o.b)}a.putImageData(r,0,0)}return{canv:t}}(s.dynrender))}return e.imgs=r,e}(),K=h.hues,E=h.imgs,l(),Ce(t,0,0,e.width,e.height,K.LT_GRY),function e(){if($&&(0<ee?ee--:(delete j,j=null,z=ue,$=!1)),1==we&&(0<ve?ve--:(we=!1,ve=Ie(10,60))),1==_e&&(0<be?be--:(_e=!1,be=10)),0<B.hp){if(1==O&&(s=2*((ye.KeyA?-1:0)+(ye.KeyD?1:0)),l=2*((ye.KeyW?-1:0)+(ye.KeyS?1:0)),B.x+=s,B.y+=l),B.x=Le(B.x,0,P.width-8),B.y=Le(B.y,0,P.height-8),U.x=B.x,U.y=B.y-48,1!=O&&(s=te.x-B.x,l=te.y-B.y,l=Math.atan2(l,s),B.velX=.5*Math.cos(l),B.velY=.5*Math.sin(l),ke(B.x,B.y,te.x,te.y)<8)&&(te={x:Ie(0,P.width-16),y:Ie(128,200)}),0<V&&(ye.Space||we)&&q>=ce){let e=!0;if(null!=j&&"pu_fireball"==j.img.name){for(let e=-1;e<=1;e++){var t=1.5*e,t=Be({img:E.fireball,x:B.x-8,y:B.y,velX:t,velY:-2,power:3,animTick:0,animDelay:15});ne.push(t)}V-=3,e=!1}e&&(s=Be({img:E.plzr,x:B.x-2,y:B.y,scale:2,velY:-3,power:1}),ne.push(s),V--),q=0}q++,0<Q&&(ye.ShiftLeft||_e)&&Z>=xe&&(l=Be({img:E.bomb,x:B.x-2,y:B.y,scale:2,velY:-.75,groundProj:!0,power:1}),ne.push(l),Q--,Z=0),Z++}else U.vis=!1;if(U.frame=0<Q?0:1,se%64==0){for(let e=0;e<14;e++)Ge(e,-2,e,le);pe-=.1,--le<-100&&0==A&&(A=1),le<-200&&1==A&&(A=2),le<-210&&2==A&&(re=!1,ae=!0)}if(re){let e=120;if(1==A?e+=100:2==A&&(e+=200),se%e==0){var i=Ie(0,P.width-16),n=0==A?"drone":"drone_armored",r="drone"==n?1:3;for(let e=0;e<Ie(1,3);e++){var a=new Oe({plyr:B,type:n,x:i+Ie(-8,8),y:-32-Ie(-8,8),img:E[n],frame:0,hp:r,power:1,points:10});a.isPlaying=!1,a.velY=Ie(.5,1),a.velX=+Math.random()-.5,ie.push(a)}}var s;le<-30&&se%300==0&&((s=new Ae({plyr:B,type:"spinner",x:Ie(0,P.width),y:-32,img:E.spinner,hp:1,power:1,points:50})).angle+=1,s.velY=Ie(1.5,3),ie.push(s))}var l,h;ae&&!Ye&&(2===A&&((l=new Xe({plyr:B,type:"big_baddie",x:P.width/2,y:-144,origin:{x:56,y:72},img:E.big_baddie,hp:300,power:1,points:5e3,canCull:!1})).onDestroy=()=>{let e=JSON.parse(localStorage.getItem("stella_proelium"));(e=null!=e&&null!=e?e:{}).highscores=null!=e.highscores?e.highscores:[],e.highscores.push(F),e.highscores.sort((e,t)=>t-e),localStorage.setItem("stella_proelium",JSON.stringify(e)),O=0,me({type:"hard"})},ie.push(l)),ae=!1,Ye=!0);for(let e=0;e<N.length;e++)N[e].y+=.25;(Re+=.25)%.25==1&&(Re=0),se++,H.clearRect(0,0,P.width,P.height),Ce(H,0,0,P.width,P.height,K.RD);for(let e=0;e<N.length;e++){var o=N[e];0==o.depth&&o.render(H)}for(let e=0;e<N.length;e++){var d,g,y,m=N[e];1==m.depth&&("gaa"!=m.type&&"gaa_armored"!=m.type||(0==m.frame&&(m.canShoot=!0),2!=m.frame)||!m.canShoot||(d=Be({img:E.gaa_bullet,x:m.x+8,y:m.y+8,animTick:0,animDelay:10,isFriendly:!1,power:1}),g=B.x-d.x,y=B.y-d.y,y=Math.atan2(y,g),d.velX=.5*Math.cos(y),d.velY=.5*Math.sin(y),ne.push(d),m.canShoot=!1),m.render(H)),Pe(m)&&(m.destr=!0),m.destr&&(N.splice(e,1),e--)}for(let e=0;e<W.length;e++){var p=W[e];p.render(H),p.y-=p.speed,Pe(p)&&(p.destr=!0),p.destr&&(W.splice(e,1),e--)}for(let e=0;e<ne.length;e++){var f=ne[e];if(f.render(H),"bomb"==f.img.name)if(.3<f.scaleX)f.scaleX-=.03,f.scaleY-=.03,--f.perceivedHeight,f.x+=.006,f.velY+=.01;else{var u=[];for(let e=0;e<N.length;e++){var c=N[e],x={x:f.x-6,y:f.y-6,dw:12,dh:12};"stars"!=c.img.name&&He(x,c)&&1==c.depth&&(u.push(c),Ke(c,f),c.destr)&&(F+=c.points)}for(let e=0;e<u.length;e++){var w=u[e],v=Be({img:E.crater,x:w.x,y:w.y,frame:Ie(0,3),animTick:0,animDelay:30});N.push(v);for(let e=0;e<100;e++){var _=Be({img:E[(_=["smoke","fire"])[Ie(0,_.length-1)]],x:w.x+Ie(4,12),y:w.y+Ie(4,12),life:Ie(300,600)});W.push(_)}}f.destr=!0}Pe(f)&&(f.destr=!0),f.destr&&("plzr"!=f.img.name&&"fireball"!=f.img.name||V++,"bomb"==f.img.name&&Q++,ne.splice(e,1),e--)}for(let e=0;e<X.length;e++){var b=X[e];b.render(H),He(B,b)&&(h=b.img.name,null!=ge[h].callbacks&&null!=ge[h].callbacks.pickup&&ge[h].callbacks.pickup(),j=Be({img:E[h],x:16,y:P.height-40,scale:1.5}),$=!0,null!=ge[h].life&&(ee=ge[h].life),b.destr=!0),Pe(b)&&(b.destr=!0),b.destr&&(X.splice(e,1),e--)}U.render(H),B.render(H);for(let e=0;e<ie.length;e++){var Y,R,D,T=ie[e];if(T.render(H),"gaa"!=T.type&&"gaa_armored"!=T.type||(0==T.frame&&(T.canShoot=!0),2!=T.frame)||!T.canShoot||(Y=Be({img:E.gaa_bullet,x:T.x+8,y:T.y+8,animTick:0,animDelay:10,isFriendly:!1,power:1}),R=B.x-Y.x,D=B.y-Y.y,D=Math.atan2(D,R),Y.velX=.5*Math.cos(D),Y.velY=.5*Math.sin(D),ne.push(Y),T.canShoot=!1),"big_baddie"==T.type&&T.canSpawnGun&&!T.hasSpawnedGun){var S,G=T.x-24,k=T.y-24,M=new We({plyr:B,type:"gaa_large_hub_armored",x:G,y:k,img:E.gaa_large_hub_armored,animTick:0,animDelay:7,depth:0,hp:9999});ie.push(M);for(let t=-2;t<=2;t++)for(let e=-2;e<=2;e++)(0==t&&0!=e||0==e&&0!=t)&&-1!=t&&1!=t&&-1!=e&&1!=e&&(S=new Ne({plyr:B,type:"gaa_armored",x:16+G+16*t,y:16+k+16*e,img:E.gaa_armored,animTick:0,animDelay:3,depth:1,hp:9999,points:75}),M.buildings.push(S),ie.push(S));T.canSpawnGun=!1,T.hasSpawnedGun=!0}T.canCull&&Pe(T)&&(T.destr=!0);for(let e=0;e<ne.length;e++){var C,I=ne[e];if(I.isFriendly&&!I.groundProj&&He(I,T)){Ke(T,I);for(let e=0;e<50;e++){var L=Be({img:E[(L=["smoke","fire"])[Ie(0,L.length-1)]],x:T.x+Ie(0,8),y:T.y+Ie(0,8),life:Ie(1,5)});W.push(L)}T.destr&&(0<T.points&&(F+=T.points),970<Ie(0,1e3))&&((C=new Ee({img:E.pu_fireball,x:T.x,y:T.y,animTick:0,animDelay:6})).velY=.25,X.push(C)),I.destr=!0}I.isFriendly||He(B,I)&&(Ke(B,I),I.destr=!0)}1!=O&&ke(B.x,B.y,T.x,T.y)<64&&T.y<B.y&&(we=!0),He(B,T)&&Ke(B,T),T.destr&&(ie.splice(e,1),e--)}if(B.destr&&(B.vis=!1),0==O){Me(H,8,8,"STELLA",9),Me(H,12,64,"PROELIUM",6),Me(H,20,106,"DEVELOPED BY JARED YORK",2),Me(H,4,270,"MADE WITH <3 FOR JS13K 2021",2);for(let e=0;e<De.length;e++)Me(H,48,200+32*e,De[e],3),he==e&&Ce(H,48,218+32*e,200,2,K.WHT)}else if(1===O){if(j&&j.render(H),fe.render(H),$){let e=ee/ge[j.img.name].life,t=K.GRN;e<.4?t=K.CLAY:e<.6&&(t=K.LIME),Ce(H,j.x,j.y-8,j.dw,8,K.BK),Ce(H,j.x+2,j.y-6,Math.round(e*(j.dw-4)),4,t)}for(let e=0;e<J;e++)H.drawImage(E.plyr.dyntexes[0].shadCanv,16*e+2+8,34),H.drawImage(E.plyr.dyntexes[0].canv,16*e+2+8,32);Me(H,8,8,String(F),3)}else if(2==O){Me(H,28,24,"HIGH SCORES",4);let t=JSON.parse(localStorage.getItem("stella_proelium"));if((t=null!=t&&null!=t?t:{}).highscores=void 0!==t.highscores?t.highscores:[],0<t.highscores.length)for(let e=0;e<t.highscores.length;e++)e<5&&Me(H,28,64+20*e,e+1+". "+t.highscores[e],2);else Me(H,45,64,"NO HIGH SCORES YET",2);for(let e=0;e<Te.length;e++)Me(H,48,200+32*e,Te[e],3),oe==e&&Ce(H,48,218+32*e,200,2,K.WHT)}else if(3==O){Me(H,28,24,"ARE YOU SURE",4);for(let e=0;e<Se.length;e++)Me(H,48,200+32*e,Se[e],3),de==e&&Ce(H,48,218+32*e,200,2,K.WHT)}window.requestAnimationFrame(e)}()})</script>