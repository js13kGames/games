<!doctype html><title>Order of the Crimson Dot - js13kGames 2025</title><meta name=viewport content="width=device-width"><style>*{box-sizing:inherit;margin:0;padding:0}body{align-items:center;background:#000;color:#fff;display:flex;font:700 1em "Courier New",Courier,monospace;justify-content:center;min-height:100vh;overflow:hidden}canvas{background:#fff url(tile.webp);border:32px solid;border-color:#bbb #bbb #444 #444;cursor:url(pointer.webp),auto}canvas.storm{background:#000}div{position:relative}ul{color:#000;list-style:none;text-transform:uppercase}li{padding:0 32px;position:absolute;line-height:32px}li:first-child{top:0}li:nth-child(2){top:0;right:0}li:nth-child(3){bottom:0;color:#fff}li:last-child{bottom:0;color:#fff;right:0}li:last-child b{margin:0 .6em}li a{background:#fff;border:2px solid #000;border-radius:9px;display:inline-block;height:18px;margin:0 6px;overflow:hidden;position:relative;top:5px;width:120px}li a b,li a i{background:red;border:2px solid #fff;border-radius:6px;display:inline-block;height:14px;position:absolute;top:0;width:0}li a i{background:#000;border-right:0;color:#fff;font:normal 12px/14px sans-serif;overflow:hidden;text-align:center}#exhaust a b{background:#50b}</style><div><canvas></canvas><ul><li id=exhaust>Stamina<a><b></b></a><v>0%</v><li id=happiness><v>0%</v><a><b></b><i></i></a><t>Happiness</t><li>the <b id=level>kitten</b><li id=time><t></t><b>best</b><v>0:00</v></ul></div><script>let t=()=>{};function e(t,e){let{x:i,y:s,width:h,height:n}=function(t){let{x:e=0,y:i=0,width:s,height:h,radius:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,h=t.mapheight),n&&(s=2*n.x,h=2*n.y),t.anchor&&(e-=s*t.anchor.x,i-=h*t.anchor.y),s<0&&(e+=s,s*=-1),h<0&&(i+=h,h*=-1),{x:e,y:i,width:s,height:h}}(e);do{i-=e.sx||0,s-=e.sy||0}while(e=e.parent);let a=t.x-Math.max(i,Math.min(t.x,i+h)),o=t.y-Math.max(s,Math.min(t.y,s+n));return a*a+o*o<t.radius*t.radius}let i,s,h={};function n(t,e){h[t]=h[t]||[],h[t].push(e)}function a(t,...e){(h[t]||[]).map(t=>t(...e))}let o={get:(e,i)=>"_proxy"==i||t};function r(){return i}function c(){return s}class l{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:h}){let{width:n,height:a,spacing:o=0,margin:r=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:h,width:n,height:a,spacing:o,margin:r,isStopped:!1,_f:0,_a:0})}clone(){return new l(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}render({x:t,y:e,width:i=this.width,height:s=this.height,context:h=c()}){let n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,this.margin+a*this.width+(2*a+1)*this.spacing,this.margin+n*this.height+(2*n+1)*this.spacing,this.width,this.height,t,e,i,s)}}function d(){return new l(...arguments)}class u{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new u(this.x+t.x,this.y+t.y,this)}}function m(){return new u(...arguments)}class g{constructor(t){return this.init(t)}init(t={}){this.position=m(),this.velocity=m(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.velocity;this.position=this.position.add(e),this._pc()}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}_pc(){}}class p extends g{init({width:t=0,height:e=0,context:i=c(),render:s=this.draw,update:h=this.advance,anchor:a={x:0,y:0},rotation:o=0,drotation:r=0,scaleX:l=1,scaleY:d=1,...u}={}){super.init({width:t,height:e,context:i,anchor:a,rotation:o,drotation:r,scaleX:l,scaleY:d,...u}),this._di=!0,this._uw(),this._rf=s,this._uf=h,n("init",()=>{this.context??=c()})}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=2*this.radius);let s=-e*this.anchor.x,h=-i*this.anchor.y;(s||h)&&t.translate(s,h),this._rf(),(s||h)&&t.translate(-s,-h),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wrot:i=0,_wsx:s=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wsx=s*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=i+this.rotation;let{x:n,y:a}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},i);this._wx=n,this._wy=a}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class f extends p{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius)return this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),void this.context.fill();this.context.fillRect(0,0,this.width,this.height)}}}function x(){return new f(...arguments)}let w=/(\d+)(\w+)/;class _ extends p{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=c()?.font,...h}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...h}),this.context&&this._p(),n("init",()=>{this.font??=c().font,this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(w),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),!this._s.length&&this.text.includes("\n")){let i=0;e.map(e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map((s,h)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*h)})}}let v=new WeakMap,y={},T={},M={0:"left",1:"middle",2:"right"};function E(t,e){return parseFloat(t.getPropertyValue(e))||0}function S(t){let e=null!=t.button?M[t.button]:"left";T[e]=!0,O(t,"onDown")}function A(t){let e=null!=t.button?M[t.button]:"left";T[e]=!1,O(t,"onUp")}function R(t){O(t,"onOver")}function b(t){v.get(t.target)._oo=null,T={}}function L(t,i,s){let h=function(t){let i=t._lf.length?t._lf:t._cf;for(let s=i.length-1;s>=0;s--){let h=i[s];if(h.collidesWithPointer?h.collidesWithPointer(t):e(t,h))return h}}(t);h&&h[i]&&h[i](s),y[i]&&y[i](s,h),"onOver"==i&&(h!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(s),t._oo=h)}function O(t,e){t.preventDefault();let i=t.target,s=v.get(i),{scaleX:h,scaleY:n,offsetX:o,offsetY:r}=function(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),h="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],n=parseFloat(h[0]),a=parseFloat(h[3]),o=(E(i,"border-left-width")+E(i,"border-right-width"))*n,r=(E(i,"border-top-width")+E(i,"border-bottom-width"))*a,c=(E(i,"padding-left")+E(i,"padding-right"))*n,l=(E(i,"padding-top")+E(i,"padding-bottom"))*a;return{scaleX:(s.width-o-c)/e.width,scaleY:(s.height-r-l)/e.height,offsetX:s.left+(E(i,"border-left-width")+E(i,"padding-left"))*n,offsetY:s.top+(E(i,"border-top-width")+E(i,"padding-top"))*a}}(s);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:t,clientY:e,identifier:i})=>{let a=s.touches[i];a||(a=s.touches[i]={start:{x:(t-o)/h,y:(e-r)/n}},s.touches.length++),a.changed=!1}),Array.from(t.changedTouches).map(({clientX:i,clientY:c,identifier:l})=>{let d=s.touches[l];d.changed=!0,d.x=s.x=(i-o)/h,d.y=s.y=(c-r)/n,L(s,e,t),a("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[l],s.touches.length--,s.touches.length||a("touchEnd"))})):(s.x=(t.clientX-o)/h,s.y=(t.clientY-r)/n,L(s,e,t))}function H(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function I({fps:e=60,clearCanvas:i=!0,update:s=t,render:h,context:o=c(),blur:r=!1}={}){let l,d,u,m,g,p=0,f=1e3/e,x=1/e,w=i?H:t,_=!0;function v(){if(d=requestAnimationFrame(v),_&&(u=performance.now(),m=u-l,l=u,!(m>1e3))){for(p+=m;p>=f;)a("tick"),g.update(x),p-=f;w(g.context),g.render()}}return r||(window.addEventListener("focus",()=>{_=!0}),window.addEventListener("blur",()=>{_=!1})),n("init",()=>{g.context??=c()}),g={update:s,render:h,isStopped:!0,context:o,start(){this.isStopped&&(l=performance.now(),this.isStopped=!1,requestAnimationFrame(v))},stop(){this.isStopped=!0,cancelAnimationFrame(d)}},g}function P(t){if(+t==t)return t;let e=[],i=t.split(".."),s=+i[0],h=+i[1],n=s;if(s<h)for(;n<=h;n++)e.push(n);else for(;n>=h;n--)e.push(n);return e}class Y{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:h=0,animations:n}={}){this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:h},this._f=(t.width-h)/e|0,this.createAnimations(n)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:h,loop:n}=t[i];e=[],[].concat(s).map(t=>{e=e.concat(P(t))}),this.animations[i]=d({spriteSheet:this,frames:e,frameRate:h,loop:n,name:i})}}}const C=(t=1,e=.05,i=220,s=0,h=0,n=.1,a=0,o=1,r=0,c=0,l=0,d=0,u=0,m=0,g=0,p=0,f=0,x=1,w=0,_=0)=>{let v,y,T=2*Math.PI,M=r*=500*T/B**2,E=(0<g?1:-1)*T/4,S=i*=(1+2*e*Math.random()-e)*T/B,A=[],R=0,b=0,L=0,O=1,H=0,I=0,P=0;for(c*=500*T/B**3,g*=T/B,l*=T/B,d*=B,u=B*u|0,y=(s=99+B*s)+(w*=B)+(h*=B)+(n*=B)+(f*=B)|0;L<y;A[L++]=P)++I%(100*p|0)||(P=a?1<a?2<a?3<a?Math.sin((R%T)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/T%2+2)%2:1-4*Math.abs(Math.round(R/T)-R/T):Math.sin(R),P=(u?1-_+_*Math.sin(2*Math.PI*L/u):1)*(0<P?1:-1)*Math.abs(P)**o*t*N*(L<s?L/s:L<s+w?1-(L-s)/w*(1-x):L<s+w+h?x:L<y-f?(y-L-f)/n*x:0),P=f?P/2+(f>L?0:(L<y-f?1:(y-L)/f)*A[L-f|0]/2):P),v=(i+=r+=c)*Math.sin(b*g-E),R+=v-v*m*(1-1e9*(Math.sin(L)+1)%2),b+=v-v*m*(1-1e9*(Math.sin(L)**2+1)%2),O&&++O>d&&(i+=l,S+=l,O=0),!u||++H%u||(i=S,r=M,O=O||1);return A},N=.1,B=44100,D=new(window.AudioContext||webkitAudioContext);var k={eat:C(...[,,381,.06,.21,.24,1,.5,-3,-1,,,,,,,,.69,.21]),evolve:C(...[,,448,.02,.27,.15,,4,,-220,492,.15,,,,.1,,.79,.22]),explosion:C(...[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6]),song:((t,e,i,s=125)=>{let h,n,a,o,r,c,l,d,u,m,g,p,f,x,w=0,_=[],v=[],y=[],T=0,M=0,E=1,S={},A=B/s*60>>2;for(;E;T++)_=[E=d=p=0],i.map((s,R)=>{for(l=e[s][T]||[0,0,0],E|=!!e[s][T],x=p+(e[s][0].length-2-!d)*A,f=R==i.length-1,n=2,o=p;n<l.length+f;d=++n){for(r=l[n],u=n==l.length+f-1&&f||m!=(l[0]||0)|r|0,a=0;a<A&&d;a++>A-99&&u?g+=(g<1)/99:0)c=(1-g)*_[w++]/2||0,v[o]=(v[o]||0)-c*M+c,y[o]=(y[o++]||0)+c*M+c;r&&(g=r%1,M=l[1]||0,(r|=0)&&(_=S[[m=l[w=0]||0,r]]=S[[m,r]]||(h=[...t[m]],h[2]*=2**((r-12)/12),r>0?C(...h):[])))}p=x});return[v,y]})([[,0,31,,.15,.2,3,5],[.4,0,976,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.23],[,0,247,.01,.14,.15,2,,,,,,154.87,.3,,,.25],[3.5,0,84,,,,,.7,,,,.5,,6.7,1,.05],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1],[.9,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.3,0,124,.15,.2,.5,3]],[[[,,15,,,,15,,,,15,,,15,,,14,,12,,,,12,,,,12,,,12,,,10,,7,,,,7,,,,7,,,7,,,14,,7,,,,7,,,,10,,,12,,,14,,],[2,,,,,22,,,19,,,,,22,,,19,,,,,22,,,24,,,,,22,,,24,,,,,22,,,21,,,,,22,,,21,,,,,27,,,26,,,,,24,,,22,,],[4,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,1,13,,25,,],[5,,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13]],[[,,15,,,,15,,,,15,,,15,,,14,,12,,,,12,,,,12,,,12,,,10,,7,,,,7,,,,7,,,7,,,14,,7,,,,7,,,,10,,,12,,,14,,],[1,1,10,,15,,14,,15,,10,,15,,14,,15,,12,,15,,14,,15,,12,,15,,14,,15,,10,,15,,14,,15,,10,,15,,14,,15,,10,,15,,14,,15,,10,,15,,14,,15,,],[2,,,,,22,,,19,,,,,22,,,19,,,,,22,,,24,,,,,22,,,24,,,,,22,,,21,,,,,22,,,21,,,,,27,,,26,,,,,24,,,22,,],[3,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,],[4,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,1,13,,25,,],[5,-1,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13,,,13,13,,,13,13,,13,13,,,,13,13],[6,-.3,15,,,,,,,,,,,,17,,,,15,,,,,,,,,,,,17,,,,14,12,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[6,.3,19,,,,,,,,,,,,22,,,,19,,,,,,,,,,,,20,,,,17,15,14,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]],[0,0,1,1,1,1],118),zzfxP:(...t)=>{let e=D.createBufferSource(),i=D.createBuffer(t.length,t[0].length,B);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(D.destination),e.start(),e}};let U=null,X=1;const{canvas:F}=function(t,{contextless:e=!1}={}){return i=document.getElementById(t)||t||document.querySelector("canvas"),e&&(i=i||new Proxy({},o)),s=i.getContext("2d")||new Proxy({},o),s.imageSmoothingEnabled=!1,a("init"),{canvas:i,context:s}}(),W={asleep:{frameRate:2,frames:[6,7]},awakeleft:{frameRate:10,frames:[8,9,10,11]},awakeright:{frameRate:10,frames:[2,3,4,5]},eating:{frameRate:2,frames:[12,13]},exhaustedleft:{frameRate:5,frames:[8,9]},exhaustedright:{frameRate:5,frames:[2,3]},idle:{frameRate:5,frames:[0,1]}},V="lightning",$="storm",j="kitten",z="order",G=32,q=(t,e,i,s)=>{const h=t-i,n=e-s;return Math.sqrt(h*h+n*n)},K=(t,e,i)=>Math.max(e,Math.min(i,t)),J=(t,e=1)=>{t.context.imageSmoothingEnabled=!1,t.setScale(X*e),t.draw()},Q=t=>Math.floor(t/60)+":"+Math.floor(t%60).toString().padStart(2,"0"),Z={createSheet(t,e){this.sheets[t]=function(){return new Y(...arguments)}(e)},gameTime:0,intro:!0,muted:!1,over:!1,sheets:{}},tt=(t,e)=>`${t}\n\nPRESS ENTER TO ${e||"CONTINUE"}…`,et=function(){let t=null;return{start(){t?t.start():(t=k.zzfxP(...k.song),t.loop=!0)},stop(){t.stop(),t=null}}}(),it=(t,e,i)=>t.addEventListener(e,i),st=()=>{const t=64*X,e=F.width-Z.couch.width*X-t,i=F.height-Z.couch.height*X-t;Z.couch.x=t+Math.random()*e,Z.couch.y=t+Math.random()*i},ht=t=>document.querySelector(t),nt=(t,e,i,s=1)=>Math.max(0,t-e*s*i),at=(t,e={})=>{Z.scene.objects=[],e.animation||="idle",e.sheet||=z,Z.scene.objects.push(x({color:e.background||"#F00",render(){this.width=F.width,this.height=F.height/3,this.y=(F.height-this.height)/2,this.bottom=this.y+this.height,this.draw()},x:0})),Z.scene.objects.push(function(){return new _(...arguments)}({color:e.color||"#FFF",lineHeight:1.2,render(){const e=1===X?12:24,i=1.2*e,s=t.split("\n"),h=F.height/3,n=(F.height-h)/2,a=s.length*i;this.font=`bold ${e}px Courier New`,this.width=.5*F.width,this.x=.4*F.width,this.y=n+(h-a)/2,this.draw()},text:t,textAlign:"left"})),Z.scene.objects.push(x({animations:Z.sheets[e.sheet].animations,playing:!1,render(){this.y=Z.scene.objects[0].bottom-this.height*(6*X),J(this,6)},update(t){this.playing||this.playAnimation(e.animation),this.advance(t)}})),Z.scene.start()},ot=t=>{t.idleTimer=0,t.outsideRangeTimer=0},rt=t=>{F.classList.remove($,V),t&&F.classList.add(t)},ct=(t,e)=>(t-e*X)/2,lt=()=>{const t=Math.floor(window.innerWidth/704),e=Math.floor(.8*window.innerHeight/320);X=Math.max(Math.min(t,e),1),F.height=320*X,F.width=704*X},dt=t=>{k[t]&&k.zzfxP(k[t])},ut=t=>{const e="ootcdBest";let i=parseFloat(localStorage.getItem(e))||1/0;t&&t<i&&(i=t,localStorage.setItem(e,i)),i!==1/0&&(ht("#time t").innerHTML=Q(i))};var mt;!function({radius:t=5,canvas:e=r()}={}){let i=v.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},v.set(e,i)}e.addEventListener("mousedown",S),e.addEventListener("touchstart",S),e.addEventListener("mouseup",A),e.addEventListener("touchend",A),e.addEventListener("touchcancel",A),e.addEventListener("blur",b),e.addEventListener("mousemove",R),e.addEventListener("touchmove",R),i._t||(i._t=!0,n("tick",()=>{i._lf.length=0,i._cf.map(t=>{i._lf.push(t)}),i._cf.length=0}))}(),lt(),ut(),(mt=["cat.webp","couch.webp","food.webp","kitten.webp","order.webp"],new Promise((t,e)=>{const i={};Promise.all(mt.map(t=>new Promise(s=>{const h=new Image;h.onload=()=>{i[t.split(".")[0]]=h,s()},h.onerror=()=>e(new Error(`Failed to load: ${t}`)),h.src=`${t}`}))).then(()=>t(i)).catch(e)})).then(t=>{const e="asleep",i="awake",s="eating",h="exhausted",n="idle",a="seekingCouch",o=[j,"cat",$,z];Z.createSheet(j,{animations:W,frameHeight:G,frameWidth:G,image:t.kitten}),Z.createSheet("cat",{animations:W,frameHeight:G,frameWidth:G,image:t.cat}),Z.sheets.cat.animations.idle.frameRate=2,Z.sheets.storm=Z.sheets.cat,Z.createSheet(z,{animations:{ascended:{frameRate:2,frames:[2,3]},captured:{frameRate:0,frames:[4]},idle:{frameRate:2,frames:[0,1]}},frameHeight:G,frameWidth:G,image:t.order}),Z.couch=x({image:t.couch,render(){J(this)}}),st(),Z.food=x({image:t.food,isVisible:!1,render(){this.isVisible&&J(this)}}),Z.cat=x({animations:Z.sheets.kitten.animations,centerOn(t,e=0,i=0){const s=this.scaled(),h=t.height*X,n=t.width*X;this.x=t.x+(n-s.width)/2+e,this.y=t.y+(h-s.height)/2+i},current:{facing:null,state:null},distanceMoved:0,eatingTimer:0,evolutionLevel:0,evolutionTargetTime:20,evolutionTimer:0,evolve(){let t={},e=tt("SO… THE KITTEN HAS BECOME A CAT\nYOUR PAWS GROW SWIFT, YOUR EYES SHARP\nBUT THE CRIMSON DOT STILL ELUDES YOU…");Z.loop.stop(),this.evolutionLevel+=1,this.animations=Z.sheets[o[this.evolutionLevel]].animations,dt("evolve"),this.evolutionTargetTime=20*(this.evolutionLevel+1),this.happinessMeter-=25*this.evolutionLevel,st(),this.evolutionLevel>2?(Z.ascended=!0,rt(),e=tt("AT LAST, THE CRIMSON DOT IS YOURS!"),ut(Z.gameTime),t={animation:"captured",background:"#BBB",color:"#000"}):this.evolutionLevel>1&&(rt($),e=tt("IMPRESSIVE, BUT BEFORE YOU CAN ASCEND SMALL\nCREATURE, YOU MUST WEATHER THE STORM…")),at(e,t)},exhaustMeter:0,facingRight:!1,getAnimation(){let t=this.state===a?h:this.state;return t!==i&&t!==h||(t+=this.facingRight?"right":"left"),this.animations[t]},getEvolutionPercent(){return this.evolutionTargetTime>0?Math.min(100,Math.floor(this.evolutionTimer/this.evolutionTargetTime*100)).toFixed(0)+"%":"0%"},getStaminaPercent(){return Math.max(0,100-this.exhaustMeter/5)},happinessMeter:0,idleTimer:0,lastPointerX:0,lastPointerY:0,outsideRangeTimer:0,render(){J(this)},scaled(){return{height:this.height*X,width:this.width*X}},setMeter(t,e){ht(`#${t} b`).style.width=e,ht(`#${t} v`).innerHTML=e},sleep(t=!0){this.state=e,ot(this),this.sleepTimer=0,Z.food.isVisible=!1,t&&this.centerOn(Z.couch,0,0)},sleepTimer:0,startEating(){this.state=s,ot(this),this.eatingTimer=0,this.eatingSoundTimer=0,this.centerOn(Z.food,-10*X,-5*X),dt("eat")},startSeekingCouch(){this.state=a,ot(this)},state:i,update(t){const c=96*X,l=1+.1*this.evolutionLevel,d=32*X,u=192*X,m=4*X,g=function(t=r()){return v.get(t)}(),p=Math.abs(g.x-this.lastPointerX)>.5||Math.abs(g.y-this.lastPointerY)>.5,f=this.x,x=this.y,w=32*X,_=this.scaled(),y=g.x/2-this.x/2,T=g.y/2-this.y/2,M=q(g.x/2,g.y/2,this.x/2,this.y/2),E=M?y/M:0,S=M?T/M:0,A=M>m&&M<u&&this.state!==a&&this.state!==s,R=M>=u;if(this.currentAnimation=this.getAnimation(),this.advance(t),this.lastPointerX=g.x,this.lastPointerY=g.y,this.happinessMeter>=100&&(this.evolutionTimer+=t,this.evolutionTimer>=this.evolutionTargetTime&&(this.evolutionTimer=0,this.updateEvolutionDisplay("Happiness…",!0),this.evolve())),this.state===a){const t=Z.couch.x-this.x;0!==t&&(this.facingRight=t>0)}else 0!==y&&this.state!==s&&(this.facingRight=y>0);if(this.setMeter("happiness",`${this.happinessMeter.toFixed(0)}%`),this.setMeter("exhaust",`${this.getStaminaPercent().toFixed(0)}%`),this.happinessMeter>=100?this.updateEvolutionDisplay("Evolving…",!0):this.updateEvolutionDisplay("Happiness"),ht("#time v").innerHTML=Q(Z.gameTime),ht("#level").innerHTML=o[this.evolutionLevel],this.state===s)return this.eatingTimer+=t,this.happinessMeter=Math.min(100,this.happinessMeter+5*t),this.eatingTimer>=3&&(this.eatingSoundTimer=0,this.exhaustMeter=0,this.state=i,Z.food.isVisible=!1),this.eatingSoundTimer+=t,void(this.eatingSoundTimer>=1&&(dt("eat"),this.eatingSoundTimer=0));if(this.state===a){const e=Z.couch.x-this.x,i=Z.couch.y-this.y,s=q(Z.couch.x,Z.couch.y,this.x,this.y),h=1.625,n=s?e/s:0,a=s?i/s:0;return this.happinessMeter=Math.max(0,this.happinessMeter-t),s<=10?void this.sleep():(this.x=K(this.x+n*h,0,F.width-_.width),void(this.y=K(this.y+a*h,0,F.height-_.height)))}if(this.state===e)return this.sleepTimer+=t,this.happinessMeter=Math.max(0,this.happinessMeter-t),void(this.sleepTimer>=10&&(this.state=i,this.sleepTimer=0,this.happinessMeter=Math.max(0,.9*this.happinessMeter),this.exhaustMeter=Math.min(this.exhaustMeter,50*(this.evolutionLevel+1))));if(Z.food.isVisible&&this.state!==a&&q(Z.food.x,Z.food.y,this.x,this.y)<=d)this.startEating();else{if(!p||R?(this.idleTimer+=t,R?this.outsideRangeTimer+=t:this.outsideRangeTimer=0):A&&ot(this),this.state===h||this.state===n){if(this.state===n&&this.idleTimer>=10)return void this.sleep(!1);if(!(M<w&&p))return(this.idleTimer>=1||this.outsideRangeTimer>=1)&&(this.state=n),this.exhaustMeter>0&&(this.state===n?this.exhaustMeter=nt(this.exhaustMeter,5,t,1.5):this.exhaustMeter=nt(this.exhaustMeter,5,t)),void(this.state===n?this.happinessMeter=Math.max(0,this.happinessMeter-2*t):this.state===h&&(this.happinessMeter=Math.max(0,this.happinessMeter-4*t)));this.state=i,ot(this)}if(this.idleTimer>=1||this.outsideRangeTimer>=1)this.state=n;else{if(A){let i=.5;if(M<c){const t=M/c;i=(.5+4.5*(1-t*t))*l}if(this.x=K(this.x+E*i,0,F.width-_.width),this.y=K(this.y+S*i,0,F.height-_.height),this.state!==n&&this.state!==e){const e=q(this.x,this.y,f,x);this.exhaustMeter+=.1*e,p&&e>0&&(this.happinessMeter=Math.min(100,this.happinessMeter+6*t)),this.exhaustMeter>=500?this.startSeekingCouch():this.exhaustMeter>=433&&!Z.food.isVisible?(()=>{const t=G*X,e=F.width-Z.food.width*X-t,i=F.height-Z.food.height*X-t;let s,h,n,a=0;do{s=t+Math.random()*e,h=t+Math.random()*i,n=q(s,h,Z.couch.x,Z.couch.y),a+=1}while(n<128&&a<20);Z.food.x=s,Z.food.y=h,Z.food.isVisible=!0})():this.exhaustMeter>=333&&this.state!==h&&(this.state=h)}}this.state!==e&&this.exhaustMeter>0&&(this.exhaustMeter=nt(this.exhaustMeter,5,t))}}},updateEvolutionDisplay(t=null,e=!1){const i=ht("#happiness i");t&&(ht("#happiness t").innerHTML=t),e&&(i.style.width=this.getEvolutionPercent(),i.innerHTML=this.getEvolutionPercent())},x:ct(F.width,G*X),y:ct(F.height,G*X)}),Z.loop=I({render(){(2!==Z.cat.evolutionLevel||F.classList.contains(V))&&(Z.couch.render(),Z.food.isVisible&&Z.food.render()),Z.cat.render()},update(t){Z.gameTime+=t,Z.cat.update(t),2===Z.cat.evolutionLevel&&(Z.lightningTimer||=0,Z.lightningTimer-=t,Z.lightningTimer<=0&&(F.classList.contains(V)?(rt($),Z.lightningTimer=2+4*Math.random()):Math.random()<.33&&(rt(V),dt("explosion"),Z.lightningTimer=.83)))}}),Z.scene=I({render(){Z.scene.objects.forEach(t=>{t.render()})},update(){Z.scene.objects.forEach(t=>{t.update()})}}),at(tt("NOTHING MAKES THIS LITTLE KITTEN HAPPIER\nTHAN CHASING THE LITTLE RED DOT :)"),{background:"#BBB",color:"#000",sheet:j}),it(window,"resize",()=>{clearTimeout(U),U=setTimeout(()=>{lt(),Z.cat&&(Z.cat.x=ct(F.width,Z.cat.width),Z.cat.y=ct(F.height,Z.cat.height)),Z.couch&&st()},100)}),it(document,"keyup",t=>{const e=t.key;Z.scene.isStopped||Z.scene.stop(),"Escape"!==e&&"Enter"!==e||(Z.loop.isStopped?Z.intro?(Z.intro=!1,at(tt("A WISE OLD CAT APPEARS BEFORE YOU…\n“IT HAS BEEN EONS SINCE CATS HAVE CLASPED\nTHE CRIMSON DOT IN THEIR CLAWS… DO YOU\nHAVE WHAT IT TAKES TO JOIN THE ORDER?”","BEGIN"))):Z.ascended?(Z.ascended=!1,Z.intro=!0,Z.over=!0,at(tt(`YOU ASCENDED IN ${Q(Z.gameTime)}\nTHE ORDER WELCOMES YOU, BUT\nCHALLENGES YOU TO DO BETTER…`,"TRY AGAIN"),{animation:"ascended"})):(Z.over&&(Z.cat.animations=Z.sheets.kitten.animations,Z.cat.evolutionLevel=0,Z.cat.evolutionTargetTime=20,Z.cat.evolutionTimer=0,Z.cat.distanceMoved=0,Z.cat.exhaustMeter=0,Z.cat.happinessMeter=0,Z.cat.state=i,Z.food.isVisible=!1,Z.gameTime=0,Z.over=!1),Z.loop.start(),Z.muted||et.start()):(Z.loop.stop(),Z.muted||et.stop(),at(tt("GAME PAWSED"),{background:"#BBB",color:"#000",sheet:o[Z.cat.evolutionLevel]}))),"m"===e&&(Z.muted=!Z.muted,Z.muted?et.stop():et.start())})})</script>