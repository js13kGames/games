<!doctype html><meta content="width=device-width,user-scalable=no" name=viewport><title>Bellwoods - js13kGames 2018</title><meta content="An art game for mobile & desktop. Sail your kite through endless fields of color and sound, trying to discover new worlds." name=description><meta content=https://bellwoods.xyz/t.png property=og:image><style>#W,body,html,main{width:100%;height:100%;overflow:hidden}*{user-select:none}.K,.O{transition:opacity 3s cubic-bezier(.19,1,.22,1),transform 4s cubic-bezier(.19,1,.22,1);transform:translateY(0);opacity:1}.K{opacity:0;transform:translateY(-3px)}body{margin:0;background:#e29990;color:#fff;font-size:16px;-webkit-text-size-adjust:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing:.5px;font-weight:100}canvas,main{position:absolute;left:0;top:0}main{display:flex;justify-content:center;align-items:center;flex-direction:column}main>div{letter-spacing:2px;line-height:1.5;font-style:italic;font-weight:300;-webkit-font-smoothing:antialiased;font-size:14px}#X{border:0;width:40px;padding:0;margin-top:-15px;margin-bottom:3px;height:0;width:32px;height:72px}#X>*{transform:rotateZ(-65deg)}h1{line-height:1;letter-spacing:10px;font-size:50px;font-weight:100;margin-bottom:20px;margin-top:-40px}#I,#S,#mute{font-size:16px;cursor:pointer;-webkit-font-smoothing:initial;font-weight:400}#S{margin-top:60px;letter-spacing:1px;font-size:16px;padding:10px 20px;position:relative}#S:after{position:absolute;width:calc(100% - 36px);text-align:center;margin:auto;bottom:6px;left:18px;transform-origin:0 0;transform:scaleY(.8);height:2px;content:' ';background:#fff}#I{padding:0;margin:20px;font-size:11px;font-family:'Courier New',monospace;text-decoration:none;width:18px;height:18px;line-height:18px;text-align:center;border-radius:100%;border:1px solid #fff;position:absolute;bottom:0;left:0}#C{letter-spacing:0;color:#fff;max-width:300px;text-align:center;font-size:12px;line-height:1.5;-webkit-font-smoothing:antialiased;padding:0;position:absolute;font-style:normal;bottom:40px;opacity:1}#E,#R,#muteC{display:none}#E>div{max-width:70vw;text-align:center}#C>div:last-child{font-size:11px}#R{top:20px;-webkit-font-smoothing:antialiased;left:20px;font-weight:100}#R,#muteC{position:absolute}#muteC{bottom:10px;right:10px;padding:10px;cursor:pointer}#mute{position:relative;-webkit-touch-callout:none}#mute.OK:after{position:absolute;display:block;content:' ';background:#fff;width:calc(100% + 4px);height:2px;transform-origin:0 0;transform:scaleY(.75);left:-2px;top:calc(50% + 1px)}@media only screen and (max-width:350px){h1{font-size:42px;padding-bottom:2px}}@media only screen and (max-height:375px){h1{margin-top:-40px}#X{margin-top:-34px;margin-bottom:-16px}#S{margin-top:20px}#C{bottom:20px}}</style><body onload='window.W.style.opacity="",window.W.className="O"'><canvas id=canvas></canvas><div id=muteC><div id=mute>mute</div></div><div id=R></div><div id=W class=K style=opacity:0><main id=A><h1>bellwoods</h1><div id=X><svg height=72 viewBox="0 -6 70 82" width=32><g fill=none stroke=#fff><path d="M32,0 L46.4,21 L32,64 L17.6,21 Z" stroke-width=3px /><path d="M17.6,21 L46.4,21 M32,0 L32,64 M32,64 Q32,80 40,82" stroke-width=1px /></g></svg></div><div>over the tall grass</div><div>following birds, chasing wind</div><div>in search of color</div><p id=S>start<div id=C><div>Made by Matt DesLauriers</div><div>with the contribution of Mélissa Hernandez</div></div></main><main id=E></main></div><script>function t(t,e){var n=[];for(let o=0;o<t;o++)n.push(null==e?o:e);return n}function e(t,e){return e[0]=-t[2],e[1]=t[1],e[2]=t[0],e}function n(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function o(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function r(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(t,e,n=[]){return x.normalize(n,x.sub(n,t,e))}function a(t){return Math.sqrt(1- --t*t)}function l(t,e,n){return Math.max(e,Math.min(n,t))}function c(t){return l(t,0,1)}function h(t,e){return(t%e+e)%e}function u(t,e,n){return t*(1-n)+e*n}function d(t,e,n){var o=c((n-t)/(e-t));return o*o*(3-2*o)}function f(t,e,n,o){return u(t,e,1-Math.exp(-n*o))}function p(t,e,n,o,r=[]){for(let i=0;i<t.length;i++)r[i]=f(t[i],e[i],n,o);return r}function g(t,e=0,n){const o=(e=~~e%w)/w,r=v(o),i=r.next(),s=r.range()>.5?r.range(.25,.5):.5,a=Math.floor(r.range(0,4)),l=r.range(.1,.3),c=r.next()>.9,u=r.next()>.99?0:1;let d=r.next()>.9;const f=r.next()>.5?1:-1,p=r.next()>.8?f:0,g=r.range(.3375,.75),m=r.range(.3375,.75);let M,y;0===a?M=y=i:1===a?(M=i-l,y=i+l):2===a?(M=i+.5,y=i-.5):3===a&&(M=i+1/3,y=i-1/3,d=!0);let x=(c?r.range(0,.3):.65)*u,b=c?r.range(.2,.3):.75,k=n||[.5*(2*r.next()-1),.5*(2*r.next()-1)],T=t.depth>=15&&!A&&r.next()>.1,q=r.next()>.2;T&&(q=!1,A=!0,b=0);let E=[P(M,s*u,g),P(y,s*u,m)];p?E=[P(0,0,p>0?1:0)]:d&&(E=[E[Math.floor(r.next()*E.length)]]);let j=P(i+0,s*u,.5),C=P(i,x,b);const F=t.explored>=5&&r.next()<.025,S=F&&r.next()<.5;let I=["white","black"],z=I[0];return F&&(S&&I.reverse(),j=z=I[1],C=I[0],E=[I[1]]),n&&(q=!0,T=!1,z="white",E=["#50a0c5","#b5d3f1"],j="#c3776d",C="#e29990"),{first:n,flowers:q,empty:T,hash:r.next(),t:r.next()>.5,n:r.next(),e:r.next(),user:z,offset:k,id:e,seed:o,depth:0,random:r,o:Math.floor(1+3*r.next()),background:C,colors:E,lines:j,petal(t){const e=h(~~(t*this.colors.length),this.colors.length);return this.colors[e]}}}function m(n=q){const o={},r=[-.025,.095],i=["first-time flyer","little grasshopper","speedy sailor ","color scout","pathfinder","skipper","globetrotter","birdchaser","wayfarer","frequent flyer","world explorer","treetop surfer","golden eagle","wind catcher"];n%=T;let a=0;const l={current:null,exit:null,portals:[],butterflies:[],depth:0,enter(n){const l=this.current,c=n.world;if(this.current=c,this.portals=[],n.tail)this.portals=n.world.portals||[];else{o[c.id]=!0;const e=t(c.o).map(t=>{const e=g(this,c.id+1+t*c.o);return e.depth=(c.depth||0)+1,c.first&&(e.offset=r),e}),n=l?{tail:!0,explored:!1,world:l,offset:c.offset}:null,i=[];n&&i.push(n),e.forEach(t=>{i.push({tail:!1,explored:!1,world:t,offset:t.offset})}),c.portals=i,this.portals=i}n.explored||function(){const t=Math.min(~~Math.pow(a,1/1.53),i.length-1);window.R.textContent="— "+i[t],a++}();const h=Object.keys(o).length;this.explored=h,this.butterflies=this.portals.map(t=>function(){let t=!1,n=0,o=[];const r=[],i=[];let a=.1,l=0;const c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[0,0,0],f=5*Math.random();return{updated:!1,position:[0,0,0],direction:[0,0,0],wings:[[0,0,0],[0,0,0]],update(g,m,w,v,M){this.updated=!0;const y=s(g,w.target);y[1]*=0;const b=.5+.5*(.5*Math.sin(f+1*v)+.5);x.r(r,w.target,y,b),this.position=t?p(this.position,r,5,M,this.position):r.slice(),this.position[1]*=0,this.position[1]+=1,((n+=M)>a||!o.length)&&(n=0,a=.1*Math.random()+.1,function(t=1,e=[]){var n=Math.random()*Math.PI*2,o=2*Math.random()-1,r=Math.random(),i=n,s=Math.acos(o),a=t*Math.cbrt(r);e[0]=a*Math.sin(s)*Math.cos(i),e[1]=a*Math.sin(s)*Math.sin(i),e[2]=a*Math.cos(s)}(1,o),x.r(o,this.position,o,.5)),x.sub(i,o,this.position),x.scale(i,i,.003),x.add(c,c,i),x.scale(c,c,.95),x.add(this.position,this.position,c);const k=s(o,this.position),P=s(g,this.position);x.copy(h,d),x.r(h,h,k,.5),x.r(h,h,P,.5),h[1]*=0,x.normalize(h,h),p(this.direction,h,10,M,this.direction),x.normalize(this.direction,this.direction),e(this.direction,u),l=Math.sin(20*v+Math.cos(v)),x.r(this.wings[0],this.position,u,.035),x.r(this.wings[1],this.position,u,-.035),this.wings.forEach(t=>{t[1]+=l*(.035*1.5)}),t=!0}}}()),this.depth=c.depth,this.portals.forEach(t=>{t._updated=!1,t.world.id in o&&(t.explored=!0)})}},c=g(this,.05,r);return c.id=n,c.o=1,l.enter({world:c,explored:!1,tail:!1,offset:[0,0]}),l}const w=2147483647;var v=(t=.5)=>{function e(t){t%=1,n.set(~~(t*w)%w)}let n=function(){function t(t){for(var e=0;e<t.length;e++){var n=.02519603282416938*(i+=t.charCodeAt(e));n-=i=n>>>0,i=(n*=i)>>>0,i+=4294967296*(n-=i)}return 2.3283064365386963e-10*(i>>>0)}var e,n,o,r,i=4022871197,s=t(" "),a=t(" "),l=t(" "),c=i;return{next(){var t=2091639*e+2.3283064365386963e-10*r;return e=n,n=o,o=t-(r=0|t)},set(h){const u=String(h);e=n=o=0,r=1,i=c,(e=s-t(u))<0&&(e+=1),(n=a-t(u))<0&&(n+=1),(o=l-t(u))<0&&(o+=1)}}}();return e(t),{next:()=>n.next(),range(t,e){return this.next()*(e-t)+t},gauss(){return Math.sqrt(-2*Math.log(this.next()))*Math.cos(2*Math.PI*this.next())},shuffle(t,e){for(var n,o,r=t.length;r;)n=Math.floor(this.next()*r--),o=e[r],e[r]=e[n],e[n]=o;return e},set:e}},M=[0,0,0,0],y=[0,0,0];const x={normalize:function(t,e){var n=e[0],o=e[1],r=e[2],i=n*n+o*o+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},copy:i,scale:n,add:r,dot:o,length:function(t){var e=t[0],n=t[1],o=t[2];return Math.sqrt(e*e+n*n+o*o)},r:function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},sub:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}},b=function(){function t(t){!function(t){var e;for(e=0;e<256;e++)i[e]=e;for(e=0;e<255;e++){var n=e+~~(t()*(256-e)),o=i[e];i[e]=i[n],i[n]=o}}(v(t).next);for(var e=0;e<512;e++)s[e]=i[255&e],a[e]=s[e]%12*3}var e=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,o=2*n;const r=Math.random();var i=new Uint8Array(256),s=new Uint8Array(512),a=new Uint8Array(512),l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);return t(r),{l:t,h(t,r){var i,c,h=0,u=0,d=0,f=(t+r)*e,p=Math.floor(t+f),g=Math.floor(r+f),m=(p+g)*n,w=t-(p-m),v=r-(g-m);w>v?(i=1,c=0):(i=0,c=1);var M=w-i+n,y=v-c+n,x=w-1+o,b=v-1+o,k=255&p,P=255&g,A=.5-w*w-v*v,T=.5-M*M-y*y,q=.5-x*x-b*b;if(A>=0){var E=a[k+s[P]];h=A*A*A*A*(l[E]*w+l[E+1]*v)}if(T>=0){var j=a[k+i+s[P+c]];u=T*T*T*T*(l[j]*M+l[j+1]*y)}if(q>=0){var C=a[k+1+s[P+1]];d=q*q*q*q*(l[C]*x+l[C+1]*b)}return 70*(h+u+d)}}}(),k=(t,e,s,a,l)=>{var c=o(s,a);if(0!==c){var h=-(o(e,a)+l)/c;return h<0?null:(n(y,s,h),r(t,e,y))}return o(a,e)+l===0?i(t,e):null},P=(t,e,n)=>`hsl(${t=h(360*t,360).toFixed(5)}, ${e=(100*e).toFixed(5)}%, ${n=(100*n).toFixed(5)}%)`;let A;const T=2147483647,q=T*Math.random();var E=function(n,o){function r(){return I?1:z}function i(t,e,n){let r=!1,i=!1;const s=P.project(E.f,W);for(let a=0;a<g.portals.length;a++){const l=g.portals[a],c=T.getXZWorldPosition(l.offset);l._updated=!0,l._position=x.add(l._position||[],c,j);const h=P.project(l._position,L),u=l._position;g.butterflies[a].update(u,E,P,t,e);const d=s[0]-h[0],f=s[1]-h[1],p=4*R,m=d*d+f*f<p*p;n&&0===F&&!(O<D)&&m&&(S&&S===l||(O=0,g.enter(l),r=!0,I=!1,o.M(),F=1,C=0)),m&&(i=!0,S=l)}return i||(S=null),r}function h(){for(let t=0;t<B.length;t++)if(!B[t].active)return B[t];return null}const g=m();let w=g.current;const y=()=>{document.body.style.background=w.background,document.body.style.color=w.user};y();const P=function(){const t=[],e=[],n=[],o=[0,0,1,1],r=[],i=[0,-1,0];return{eye:[0,4,4],target:[0,0,0],set(s,a){const l=s/a;o[2]=s,o[3]=a,function(t,e,n){var o=1/Math.tan(e/2),r=1/-99.999;t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=100.001*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=.2*r,t[15]=0}(t,Math.PI/4,l),function(t,e,n,o){var r,i,s,a,l,c,h,u,d,f,p=e[0],g=e[1],m=e[2],w=o[0],v=o[1],M=o[2],y=n[0],x=n[1],b=n[2];Math.abs(p-y)<1e-6&&Math.abs(g-x)<1e-6&&Math.abs(m-b)<1e-6?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(h=p-y,u=g-x,d=m-b,r=v*(d*=f=1/Math.sqrt(h*h+u*u+d*d))-M*(u*=f),i=M*(h*=f)-w*d,s=w*u-v*h,(f=Math.sqrt(r*r+i*i+s*s))?(r*=f=1/f,i*=f,s*=f):r=i=s=0,a=u*s-d*i,l=d*r-h*s,c=h*i-u*r,(f=Math.sqrt(a*a+l*l+c*c))?(a*=f=1/f,l*=f,c*=f):a=l=c=0,t[0]=r,t[1]=a,t[2]=h,t[3]=0,t[4]=i,t[5]=l,t[6]=u,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*p+i*g+s*m),t[13]=-(a*p+l*g+c*m),t[14]=-(h*p+u*g+d*m),t[15]=1)}(e,this.eye,this.target,i),function(t,e,n){var o=e[0],r=e[1],i=e[2],s=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],w=e[14],v=e[15],M=n[0],y=n[1],x=n[2],b=n[3];t[0]=M*o+y*a+x*u+b*g,t[1]=M*r+y*l+x*d+b*m,t[2]=M*i+y*c+x*f+b*w,t[3]=M*s+y*h+x*p+b*v,M=n[4],y=n[5],x=n[6],b=n[7],t[4]=M*o+y*a+x*u+b*g,t[5]=M*r+y*l+x*d+b*m,t[6]=M*i+y*c+x*f+b*w,t[7]=M*s+y*h+x*p+b*v,M=n[8],y=n[9],x=n[10],b=n[11],t[8]=M*o+y*a+x*u+b*g,t[9]=M*r+y*l+x*d+b*m,t[10]=M*i+y*c+x*f+b*w,t[11]=M*s+y*h+x*p+b*v,M=n[12],y=n[13],x=n[14],b=n[15],t[12]=M*o+y*a+x*u+b*g,t[13]=M*r+y*l+x*d+b*m,t[14]=M*i+y*c+x*f+b*w,t[15]=M*s+y*h+x*p+b*v}(n,t,e),function(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],s=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],w=e[15],v=n*a-o*s,M=n*l-r*s,y=n*c-i*s,x=o*l-r*a,b=o*c-i*a,k=r*c-i*l,P=h*g-u*p,A=h*m-d*p,T=h*w-f*p,q=u*m-d*g,E=u*w-f*g,j=d*w-f*m,C=v*j-M*E+y*q+x*T-b*A+k*P;C&&(C=1/C,t[0]=(a*j-l*E+c*q)*C,t[1]=(r*E-o*j-i*q)*C,t[2]=(g*k-m*b+w*x)*C,t[3]=(d*b-u*k-f*x)*C,t[4]=(l*T-s*j-c*A)*C,t[5]=(n*j-r*T+i*A)*C,t[6]=(m*y-p*k-w*M)*C,t[7]=(h*k-d*y+f*M)*C,t[8]=(s*E-a*T+c*P)*C,t[9]=(o*T-n*E-i*P)*C,t[10]=(p*b-g*y+w*v)*C,t[11]=(u*y-h*b-f*v)*C,t[12]=(a*A-s*q-l*P)*C,t[13]=(n*q-o*A+r*P)*C,t[14]=(g*M-p*x-m*v)*C,t[15]=(h*x-u*M+d*v)*C)}(r,n)},unproject:(t,e=[])=>function(t,e,n,o){var r=n[0],i=n[1],s=n[2],a=n[3],l=e[0],c=e[1],h=e[2];return l-=r,c=a-c-1,c-=i,t[0]=2*l/s-1,t[1]=2*c/a-1,t[2]=2*h-1,function(t,e,n){var o=e[0],r=e[1],i=e[2],s=n[0],a=n[1],l=n[2],c=n[4],h=n[5],u=n[6],d=n[8],f=n[9],p=n[10],g=n[12],m=n[13],w=n[14],v=1/(o*n[3]+r*n[7]+i*n[11]+n[15]);return t[0]=(o*s+r*c+i*d+g)*v,t[1]=(o*a+r*h+i*f+m)*v,t[2]=(o*l+r*u+i*p+w)*v,t}(t,t,o)}(e,t,o,r),project:(t,e=[])=>function(t,e,n,o){var r=n[0],i=n[1],s=n[2],a=n[3];M[0]=e[0],M[1]=e[1],M[2]=e[2],M[3]=1,function(t,e,n){var o=e[0],r=e[1],i=e[2],s=e[3];t[0]=n[0]*o+n[4]*r+n[8]*i+n[12]*s,t[1]=n[1]*o+n[5]*r+n[9]*i+n[13]*s,t[2]=n[2]*o+n[6]*r+n[10]*i+n[14]*s,t[3]=n[3]*o+n[7]*r+n[11]*i+n[15]*s}(M,M,o);var l=M[3];return 0!==l&&(M[0]=M[0]/l,M[1]=M[1]/l,M[2]=M[2]/l),t[0]=r+s/2*M[0]+(0+s/2),t[1]=i+a/2*M[1]+(0+a/2),t[2]=.5*M[2]+.5,t[3]=0===l?0:1/l,t}(e,t,o,n)}}(),A=function(n,o,r){const i=[],s=[];var l=t(6).map(()=>[]),h=[];const u=(t,e)=>{n.beginPath(),n.arc(t[0],t[1],e,0,2*Math.PI)};return{_:u,point(t,e="red",r=4){const s=o.project(t,i);u(s,r),n.fillStyle=e,n.fill()},butterfly(t,e){t.updated&&(n.beginPath(),h[0]=t.wings[0],h[1]=t.position,h[2]=t.wings[1],h.forEach(t=>{t=o.project(t,i),n.lineTo(t[0],t[1])}),n.lineJoin="miter",n.lineCap="square",n.strokeStyle=r.flowering.user,n.lineWidth=2,n.globalAlpha=1,n.stroke())},portal(t,e,s,l,h){let d=l*h;if(d<=0)return;const f=o.target[0]-t[0],p=o.target[2]-t[2],g=f*f+p*p;if(g>4)return;n.lineJoin=n.lineCap="round",d*=a(1-c(Math.sqrt(g)-1)/1);const m=o.project(t,i);u(m,d),n.globalAlpha=1,n.fillStyle=s,n.fill(),n.strokeStyle=r.flowering.user,n.lineWidth=2,n.stroke(),e||(u(m,2*d),n.globalAlpha=.25,n.stroke())},kite(t,o,a,c,h,u){const d=r.flowering.user,f=o.kiteHeading,p=o.f,g=o.kiteLength,m=o.kiteWidth,w=e(f,s),v=x.r(l[2],p,w,-m),M=x.r(l[3],p,w,m),y=x.r(l[4],p,f,.5*g),b=[v,x.r(l[5],p,f,-g),M,y].map((e,n)=>t.project(e,l[n]));n.strokeStyle=d,n.lineWidth=1*u,n.lineJoin=n.lineCap="round",n.globalAlpha=1,n.beginPath();const k=b[0],P=b[2],A=b[1],T=b[3];for(let e=0;e<o.mousePoints.length;e++){const r=t.project(o.mousePoints[e].offset,i);n.lineTo(r[0],r[1])}o.mousePoints.length>2&&n.lineTo(A[0],A[1]),n.stroke(),n.beginPath(),n.moveTo(A[0],A[1]),n.lineTo(T[0],T[1]),n.moveTo(k[0],k[1]),n.lineTo(P[0],P[1]),n.stroke(),n.lineWidth=2*u,n.beginPath(),b.forEach(t=>n.lineTo(t[0],t[1])),n.closePath(),n.stroke()}}}(n,P,g),T=function(e){function n(t,e){let n=null;for(let o=0;o<t.length;o++){const r=t[o];if(r.d&&r.w===e)return r;r.d||(n=r)}return n}function o(t,e,n){return~~(t+e*n)}function r(t,e){return.5*b.h(t,e)+.5}let i,s;const a=[0,0,0],h=[0,0,0],f=[0,0],p=t(20).map(()=>({p:0,w:-1,v:[0,0,0],d:!1})),g=t(361).map(t=>{const e=Math.floor(t%19),n=Math.floor(t/19);return{velocity:[0,0,0],random:v(0),position:[0,0,0],head:[0,0,0],headProjected:[0,0,0,0],ground:[0,0,0],tileIndex:-1,drawnTileIndex:t,inView:!1,state:0,active:!1,brightness:0,drawX:e,drawY:n,hash:0,x:-1,y:-1,inside:!1}});let m,w=-1;const M={};return{worldSize:30,reset:function(t,e){m?m.set(t):m=v(t);const n=e.flowers&&m.next()>.9;M.frequency=n?.01:m.range(.25,.75),M.exp=m.range(1,4),M.height=m.range(.05,2),M.hasFlower=e.flowers?m.range(.1,.2):1,M.yscale=n?.25:1,i=m.range(7.5,8),s=~~(30*i),M.sparse=m.range(.05,.1)},pool:g,hitTile:-1,I(t,e=[]){return this.N(15*t[0],15*t[1],e)},m:t=>(t[0]=l(t[0],-15,15),t[2]=l(t[2],-15,15),t),getXZWorldPosition:(t,e=[])=>(e[0]=15*t[0],e[1]=0,e[2]=15*t[1],e),g(t,e){const n=M.frequency;let o=1*r(1*(t*=n),1*(e*=n))+.5*r(2*t,2*e)+.25*r(4*t,4*e)+.13*r(8*t,8*e)+.06*r(16*t,16*e)+.03*r(32*t,32*e);return o/=1.97,o=Math.pow(o,M.exp),o=Math.max(o,0),(o*=2)*M.yscale},N(t,e,n=[]){const o=this.g(t,e);return n[0]=t,n[1]=o,n[2]=e,n},mesh(t,r,l,m,v){const y=19/i*.5;for(let t=0;t<p.length;t++){const e=p[t];e.d&&(x.scale(e.v,e.v,.905),e.v[0]*e.v[0]+e.v[2]*e.v[2]<=.05*.05&&(e.d=!1))}!function(t,e=[]){const n=.5*t[0]+.5,o=.5*t[1]+.5,r=n*(s-1),i=o*(s-1);e[0]=r,e[1]=i}(t,f);let b=f[0],k=f[1];b=Math.floor(b),k=Math.floor(k);let P=-1,A=1/0;for(let t=0;t<19;t++)for(let i=0;i<19;i++){let f=b+(i-9),m=k+(t-9);const w=o(i,t,19),T=o(~~f,~~m,s),q=g[w],E=f/(s-1),j=m/(s-1);let C=15*(2*E-1),F=15*(2*j-1);this.N(C,F,q.position);const S=T/(s*s);q.random.set(S),q.hash=q.random.next(),q.inside=E>=0&&E<=1&&j>=0&&j<=1;const I=v;if(x.copy(a,h),q.inside){let t=q.hash*Math.PI*2;const e=.1,n=q.random.next(),o=e*Math.sqrt(n);let r=Math.cos(t),i=Math.sin(t);q.position[0]+=r*o,q.position[2]+=i*o,this.m(q.position);const s=1.5,c=I*q.random.next()*q.position[1],h=2;a[0]=Math.cos(l*s+E*r*h)*c,a[1]=Math.sin(l*s+E*i*h)*c}x.copy(q.head,q.position),x.copy(q.ground,q.position),q.ground[1]=0,q.inside&&x.r(q.head,q.position,a,.1),q.head[1]*=I;let z,W=q.head[0]-r[0],L=q.head[1]-r[1],D=q.head[2]-r[2],O=W*W+L*L+D*D;const R=n(p,T),_=O<=.25;_&&O<A&&(A=O,P=T),R&&(_&&(R.d||(R.v[0]=R.v[1]=R.v[2]=0,R.d=!0,R.w=T),R.w===T&&(R.v[0]+=1*W,R.v[1]+=1*L,R.v[2]+=1*D)),R.w===T&&x.r(q.head,q.head,R.v,.035)),W=q.position[0]-e.target[0],D=q.position[2]-e.target[2],z=Math.sqrt(W*W+D*D);let B=c((z+=Math.abs(q.random.gauss())*M.sparse)/y);B=d(.75,1,B),q.active=B<.925,q.state=1-c(B),q.alpha=q.random.next(),q.tileIndex=T;const G=.1+.5*Math.abs(q.random.gauss());q.radius=G*u(.25,4,q.state),q.hasFlower=q.random.next()>M.hasFlower,e.project(q.head,q.headProjected)}let T=-1;P!==w&&(-1!==P&&(T=P),w=P),this.hitTile=T}}}(P);b.l(w.seed),T.reset(w.seed,w);const q=function(t,e){const n=[0,0,0],o=[0,0,0],r=[0,0,0],i=[0,0,0],a=[0,0],h=e.I(a),u=h.slice(),d=2*Math.PI+10*Math.PI/180;let g=0,m=0;const w=.005/e.worldSize,v=20*w,M=[0,0,0],y=[0,0,0],b=[0,0,0],P=[0,0,0],A=[0,0,0],T=[0,1,0];let q=null,E=0;return{origin:a,velocity:r,direction:n,speed:0,worldPosition:u,mouseOnPlane:i,step(j,C,F,S,I,z){q=function(e,n,o=[]){P[0]=e[0],P[1]=e[1],P[2]=.5;const r=t.unproject(P,P),i=s(r,t.eye,A);return k(o,r,i,T,0)?o:null}(I,t.target,i),e.m(i);let W=0;if(q){x.sub(y,q,t.target),y[1]*=0;const e=x.length(y);0!==e&&(x.scale(y,y,1/e),W=c(e/.5))}E=f(E,W,3,S),p(n,y,10,S,n),p(o,y,.001,S,o);const L=60*S;z&&(x.scale(b,n,w*L*E),x.r(r,r,b,L)),p(r,M,5,S,r);const D=v;r[0]=l(r[0],-D,D),r[1]=l(r[1],-D,D),r[2]=l(r[2],-D,D),a[0]+=1*r[0],a[1]+=1*r[2],a[0]=l(a[0],-1,1),a[1]=l(a[1],-1,1),e.I(a,u),h[0]=u[0],h[1]=f(h[1],u[1],.5,S),h[2]=u[2],e.m(h),x.copy(t.target,h),g=f(g,I[0]/j*2-1,1,S),m=f(m,I[1]/C*.15,1,S);const O=x.length(r),R=Math.min(1,O/D);this.speed=f(this.speed,R,1,S);const _=d+.01*F+.1*g,B=j/C;let G=.9;B<.7?G*=1/Math.max(.6,B/.7):B>1.5&&(G/=Math.min(1.075,B/1.5));const $=(2.5+-.75*this.speed)*G,U=1+4*m;t.eye[0]=h[0]+Math.cos(_)*$,t.eye[1]=h[1]+($+U)*G,t.eye[2]=h[2]+Math.sin(_)*$}}}(P,T),E=function(t,e,n){const o=[],r=[0,0,0],i=[0,0,0],a=n.worldPosition.slice();a[0]=.25,a[1]=.5;let c=.5;const h=[0,0,0],u=[0,0,0],d=[0,0,0],g=[0,0,0],m=[0,0,0],w=[0,0,0],v=[0,0,0],M=[0,0,0],y=[0,0,0],b=[0,0,0];let k=0;const P=[0,0,0];let A=0,T=[0,0,0];const q=[0,0,0],E=[0,0,0],j=[0,0,0],C=[0,0,0];return{b:h,k:M,f:[0,0,0],kiteHeading:u,mousePoints:o,kiteLength:.175,kiteWidth:.07875,step(F,S,I,z,W,L){const D=n.mouseOnPlane,O=e.g(P[0],P[2]);x.copy(y,D)[1]=O,c=f(c,O,1,z),k=f(k,L?.1:.075,1,z);const R=x.copy(b,t.target);R[1]*=0;const _=x.sub(q,D,R),B=x.length(_);x.scale(_,_,1/(B||1)),x.scale(_,_,l(B,.05,1.5)),p(T,_,7,z,T),x.add(P,R,T);const G=.25*Math.sin(I),$=c+G+k;j[1]=$;const U=x.add(E,P,j);p(a,U,4,z,a);const V=a[0]-r[0],K=a[2]-r[2],X=V*V+K*K,H=D[0]-r[0],J=D[2]-r[2];let N=!1;if(H*H+J*J>=1e-4&&(x.copy(r,D),N=!0),A=f(A,N?1:0,1,z),X>=25e-6){x.copy(i,a),o.length>=7&&o.shift();const t=a.slice();if(o.push({offset:M.slice(),point:t,time:0,duration:.25}),o.length>=2){const e=x.copy(w,m);let n=0;for(let r=o.length-2;r>=0&&n<6;r--,n++){const n=s(t,o[r].point,E);x.add(e,e,n)}0!==n&&x.scale(e,e,1/n),x.normalize(e,e),x.copy(v,e),x.copy(d,v),d[1]*=0,x.normalize(d,d)}}x.copy(g,m),x.r(g,g,v,A),x.r(g,g,d,1-A),x.normalize(g,g),x.copy(h,a),p(u,g,20,z,u),x.normalize(u,u);for(let t=o.length-1;t>=0;t--){const e=o[t];e.time+=z,e.time>e.duration&&o.splice(t,1)}const Y=.55*this.kiteLength;x.r(this.f,h,u,Y),x.r(C,h,u,-Y/2),p(M,C,40,z,M)}}}(P,T,q),j=[0,1,0];let C=0,F=-1,S=null,I=!0;const z=.5,W=[],L=[];let D=1,O=D,R=1,_=0;const B=t(15).map(()=>({position:[],time:0,duration:.5,active:!1,index:-1}));return{render:function(t,e,i){let s=r();const l=Math.min(1,_/1);let u=1;0!==F&&(u=C/s,1===F&&(u=1-u),u=a(u)),n.clearRect(0,0,e,i),1===F&&(n.fillStyle=g.current.background,n.globalAlpha=1,n.fillRect(0,0,e,i));var d=c(1===F?1-(C-.5*s)/(.5*s):1);n.fillStyle=w.background,n.globalAlpha=a(d),n.fillRect(0,0,e,i),T.mesh(q.origin,E.f,t,0,u),w.empty||function(t){const e=1.5*t;n.lineWidth=e,n.lineCap="round";const r=w.lines;n.strokeStyle=r;const i=T.pool;for(let t=0;t<i.length;t++){const e=i[t];if(!1===e.active)continue;const o=e.headProjected,r=e.state*e.alpha;if(e.inside&&r>.01){n.globalAlpha=r;const t=e.ground,i=P.project(t,W);n.beginPath(),n.lineTo(o[0],o[1]),n.lineTo(i[0],i[1]),n.stroke()}}let s;n.globalAlpha=1;for(let e=0;e<i.length;e++){const a=i[e];if(!1===a.active)continue;const l=(a.inside?a.radius:1)*t,c=l>.001,u=a.inside?w.petal(a.hash):r;if(!w.empty&&c&&a.active&&a.inside&&a.tileIndex===T.hitTile){let t=h();t&&(x.copy(t.position,a.head),t.time=0,t.radius=l,t.color=a.hasFlower&&l>0?u:r,t.active=!0,o.A({flower:a.hasFlower}))}(c&&a.active&&a.hasFlower||!a.inside)&&(A._(a.headProjected,l),u!==s&&(n.fillStyle=u,s=u),n.fill())}}(u),n.lineWidth=l,n.globalAlpha=.5;for(let t=0;t<B.length;t++){const e=B[t];if(e.active){const t=Math.sin(e.time/e.duration*Math.PI)*e.radius*4;if(t>=1e-4){const o=P.project(e.position,W);n.strokeStyle=e.color,A._(o,t),n.stroke()}}}n.globalAlpha=1,A.kite(P,E,q,T,t,l),g.portals.forEach((t,e)=>{const n=g.butterflies[e],o=t._position;A.portal(o,t.explored,t.world.background,R,l),A.butterfly(n,t.world.background)})},step:function(t,e,n,s,a,l){_+=e;const c=Math.sqrt(n*n+s*s);R=Math.max(12,c/1280*16),o.F(w),P.set(n,s),g.flowering=w;const h=r();O+=e,0!==F&&(C+=e)>h&&(C=0,1===F?(F=-1,b.l(g.current.seed),T.reset(g.current.seed,g.current),w=g.current,y()):(I=!1,F=0)),q.step(n,s,t,e,a,l),E.step(n,s,t,e,a,l),B.forEach(t=>{t.active&&(t.time+=e,t.time>t.duration&&(t.active=!1))}),i(t,e,!0)&&i(t,e,!1)}}},j=440*Math.pow(Math.pow(2,1/12),-9),C={};"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){C[t]=e})});const F=performance&&performance.now?()=>performance.now():Date.now;!function(){function t(){f=window.innerWidth,p=window.innerHeight,r.width=f*a,r.height=p*a,r.style.width=`${f}px`,r.style.height=`${p}px`}function e(){t(),m&&n(m.elapsed)}function n(){g&&(i.save(),i.scale(a,a),g.render(m.elapsed,f,p),i.restore())}function o(t,e){g.step(t,e,f,p,w,M)}const r=window.canvas,i=r.getContext("2d",{alpha:!1,powerPreference:"high-performance"}),s=[1,1.25,2];let a,c,h=2;/firefox/i.test(navigator.userAgent)&&h--;const u=t=>{c=t,a=Math.min(window.devicePixelRatio,t)};u(s[h]);const d=function(){function t(t=0,e={}){const{portal:i,flower:s}=e;t=Math.max(t,0),T>A.length-1&&(T=0);const a=E.t?A[Math.floor(Math.random()*A.length)]:A[T++];let c=0;const h=E.hash>.5?-1:0;if(c=h,E.n>.75){const t=-1===h?1:0;c+=Math.random()>.5?t:0}const u=b[function(t,e){var n,o=Math.random()*e;for(n=0;n<t.length;n++){if(o<t[n])return n;o-=t[n]}return 0}(x,k)];E.e>.5?c=h+u:c+=u,c=l(c,-1,1),i&&(c=0);const d=i?1:0,f=((t,e)=>{const n=C[t],o=e;return j*Math.pow(Math.pow(2,1/12),n)*Math.pow(2,o)})(a,c),p=o.currentTime+t;M.forEach(({P:t,O:e,T:i,D:a=0,j:l,C:c,$:h})=>{if(h&&!s)return;const u=o.createOscillator();l*=n,c+=d,u.frequency.value=f,"string"==typeof e?u.type=e:e&&u.setPeriodicWave(e),u.start(p);const w=r();u.connect(w),g.forEach(t=>w.connect(t)),w.connect(m),w.gain.setValueAtTime(1e-4,p),w.gain.exponentialRampToValueAtTime(l,p+t),w.gain.setValueAtTime(l,p+t+i),w.gain.exponentialRampToValueAtTime(1e-4,p+t+i+c),u.stop(p+t+i+c)})}const e=v(Math.random()),n=1.75,o=new(window.AudioContext||window.webkitAudioContext),r=()=>o.createGain(),i=()=>o.createBiquadFilter();let s=0;const a=r();let c=!1;const h=t=>{t.preventDefault(),c=!c,window.mute.classList.toggle("OK"),a.gain.value=c?0:1};window.muteC.addEventListener("click",h,{passive:!1}),window.muteC.addEventListener("touchstart",h,{passive:!1}),a.connect(o.destination);const u="highpass",d=i();d.frequency.value=170,d.type=u;const f=i();f.frequency.value=5e3,f.type="lowpass",d.connect(f),f.connect(a);const p=d,g=[{G:1.275,q:1.5,z:.5,B:"bandpass",U:2e3},{G:.85,q:2,z:.25,B:u,U:500}].map(t=>{const e=function(t,e,n,o={}){var r=e(),i=e(),s=r.output=e(),a=t.createConvolver(),l=n();r.connect(i),a.connect(l),i.connect(a),l.connect(s),i.value=o.z;var c=o.G;l.frequency.value=o.U,l.type=o.B;const h=t.sampleRate,u=Math.max(1,Math.floor(h*c)),d=new Float32Array(u),f=new Float32Array(u);var p=o.q;let g=0,m=Math.min(2048,u);return s.gain.value=1e-4,setTimeout(function e(){for(let t=g;t<m;t++){var n=0===u?0:t/u,o=Math.pow(1-n,p)||0;d[t]=(2*Math.random()-1)*o,f[t]=(2*Math.random()-1)*o}if(m>=u-1){const e=t.createBuffer(2,u,h);e.getChannelData(0).set(d),e.getChannelData(1).set(f),a.buffer=e,s.gain.exponentialRampToValueAtTime(1,t.currentTime+.3)}else g=m,m=Math.min(m+2048,u),setTimeout(e,5)},5),r}(o,r,i,t);return e.output.connect(p),e}),m=r();m.gain.value=.1,m.connect(p);const w=(t,e)=>{var n=new Float32Array(t),r=new Float32Array(e||t);return o.createPeriodicWave(n,r)},M=[{O:w([0,0],[0,1]),j:.5,P:.0075,T:.0075,C:.85},{O:w([-1,0,0,0,0,0,0]),j:.25,P:.0075,T:.0075,C:.85},{$:!0,O:w([1,0,.05,1]),j:.1,P:.0075,T:.0075,C:.85}],y=[50,100,100],x=y.slice(),b=[-1,0,1],k=(t=>{let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e})(y),P=["C","F","G","A","D"];let A=P.slice(),T=0;const q=[];let E;return{F(n){n!==E&&(e.set(n.hash),n.hash,e.shuffle(P,A),e.shuffle(y,x),T=0,E=n);const r=o.currentTime;for(let n=0;n<q.length;n++){const o=q[n];o.played&&n!==q.length-1&&r-o.time>60/90*.2125*2&&(o.dead=!0),!o.played&&r>=o.time&&(t(o.time-r,o.opts),o.played=!0,++s%16==0&&e.shuffle(y,x))}for(let t=q.length-1;t>=0;t--)q[t].dead&&q.splice(t,1)},A(t={}){if(c)return;const e=o.currentTime,n=Math.round(e/(60/90*.2125))*(60/90*.2125);let r=!1;(0===q.length||n>q[q.length-1].time)&&(r=!0),r&&q.push({time:n,opts:t})},M(e=0,n=1){for(let o=0;o<n;o++)t(e+60/90*.2125*.85*o,{portal:!0})},K(){o.resume()}}}();let f,p,g,m;e(),g=E(i,d);const w=[f/2,p/2];let M=!1;m=function(t,e,n){function o(){requestAnimationFrame(o);const r=F(),u=Math.min(150,r-i)/1e3;if(i=r,s++,a+=u,(c+=u)>l){const t=a/s;c=s=a=0,n(t)}h.elapsed+=u,e(h.elapsed,u),t(h.elapsed)}let r=F(),i=r,s=0,a=0,l=5,c=0;const h={elapsed:0,start(){i=r=F(),o()},animate:o};return h}(n,o,function(e){let n=c;e>1/29?h=Math.min(h,0):e>.025&&(h=Math.min(h,1)),u(s[h]),n!==c&&t()}),o(0,1e-5),n(),r.style.display="none";let y=!1;const x=t=>{e(),window.muteC.style.display="block",window.W.style.display="none",window.R.style.display="block",y||(y=!0,t&&t.preventDefault(),d.K(),function(){function t(t){"mute"!==t.target.id&&(M=!0,d.K())}function n(){M=!1}const o={resize:e,mouseup:n,mousedown:t,touchend:n,touchstart:t};Object.keys(o).forEach(t=>{window.addEventListener(t,o[t])})}(),m.start(),r.style.display="")};window.S.addEventListener("click",x,{passive:!1}),window.S.addEventListener("touchend",d.K,{passive:!1}),window.S.addEventListener("touchstart",x,{passive:!1}),window.ondragstart=()=>!1,document.addEventListener("touchmove",t=>t.preventDefault(),{passive:!1}),window.addEventListener("mousemove",function(t){w[0]=t.clientX,w[1]=p-t.clientY-1}),window.addEventListener("touchmove",function(t){w[0]=t.changedTouches[0].clientX,w[1]=p-t.changedTouches[0].clientY-1})}()</script>