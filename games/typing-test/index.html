<!doctype html><meta name=viewport content="width=device-width"><title>Typing Test - js13kGames 2025</title><style>body,html{width:100vw;height:100vh;margin:0;overflow:hidden;display:grid;place-content:center;background-color:#bca48f}</style><canvas data-init-width=720 data-init-height=480></canvas><script>zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),i=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,i=220,s=0,r=0,h=.1,n=0,o=1,l=0,a=0,c=0,d=0,u=0,p=0,f=0,m=0,x=0,g=1,y=0,w=0)=>{let k,z,v=2*Math.PI,b=l*=500*v/zzfxR**2,T=(0<f?1:-1)*v/4,M=i*=(1+2*e*Math.random()-e)*v/zzfxR,R=[],S=0,C=0,W=0,L=1,P=0,D=0,I=0;for(s=99+zzfxR*s,y*=zzfxR,r*=zzfxR,h*=zzfxR,x*=zzfxR,a*=500*v/zzfxR**3,f*=v/zzfxR,c*=v/zzfxR,d*=zzfxR,u=zzfxR*u|0,z=s+y+r+h+x|0;W<z;R[W++]=I)++D%(100*m|0)||(I=n?1<n?2<n?3<n?Math.sin((S%v)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/v%2+2)%2:1-4*Math.abs(Math.round(S/v)-S/v):Math.sin(S),I=(u?1-w+w*Math.sin(2*Math.PI*W/u):1)*(0<I?1:-1)*Math.abs(I)**o*t*zzfxV*(W<s?W/s:W<s+y?1-(W-s)/y*(1-g):W<s+y+r?g:W<z-x?(z-W-x)/h*g:0),I=x?I/2+(x>W?0:(W<z-x?1:(z-W)/x)*R[W-x|0]/2):I),k=(i+=l+=a)*Math.sin(C*f-T),S+=k-k*p*(1-1e9*(Math.sin(W)+1)%2),C+=k-k*p*(1-1e9*(Math.sin(W)**2+1)%2),L&&++L>d&&(i+=c,M+=c,L=0),!u||++P%u||(i=M,l=b,L=L||1);return R},zzfxV=.1,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(t,e,i,s=125)=>{let r,h,n,o,l,a,c,d,u,p,f,m,x,g,y,w=0,k=[],z=[],v=[],b=0,T=0,M=1,R={},S=zzfxR/s*60>>2;for(;M;b++)k=[M=d=f=x=0],i.map((s,f)=>{for(c=e[s][b]||[0,0,0],M|=!!e[s][b],y=x+(e[s][0].length-2-!d)*S,g=f==i.length-1,h=2,o=x;h<c.length+g;d=++h){for(l=c[h],u=h==c.length+g-1&&g||p!=(c[0]||0)|l|0,n=0;n<S&&d;n++>S-99&&u?m+=(m<1)/99:0)a=(1-m)*k[w++]/2||0,z[o]=(z[o]||0)-a*T+a,v[o]=(v[o++]||0)+a*T+a;l&&(m=l%1,T=c[1]||0,(l|=0)&&(k=R[[p=c[w=0]||0,l]]=R[[p,l]]||(r=[...t[p]],r[2]*=2**((l-12)/12),l>0?zzfxG(...r):[])))}x=y});return[z,v]};var t,e,i=Array.from({length:25},(t,e)=>String.fromCharCode(65+e)),s=!0;function r(){let i=window.devicePixelRatio,s=t.dataset.initWidth,r=t.dataset.initHeight;t.width=s*i,t.height=r*i,e.scale(i,i),t.style.width=s+"px",t.style.height=r+"px";let h=window.innerWidth/s,n=window.innerHeight/r,o=Math.min(h,n);t.style.transform=`scale(${o})`,t.dataset.scale=o}function h(t){switch(t){case"bomb":return"üí£";case"rocket":return"üöÄ";case"snowflake":return"‚ùÑ"}}function n(t){return t[Math.floor(Math.random()*t.length)]}function o(t){return Math.random()<t}function l(t){return new Promise((e,i)=>{let s=new Image;s.src="data:image/svg+xml;charset=utf-8;base64,"+btoa(t),s.onload=()=>e(s),s.onerror=i})}var a=new Set,c=new Set;function d(){let t=!1,e=0,i=s=>{t&&(e>0?e-=s:(t=!1,a.delete(i)))};return{get isActive(){return t},get isTimeout(){return e<=0},get time(){return e},update(t){i(t)},start(s=0){e=s,t=!0,a.add(i)}}}function u(t=0,e=()=>{}){let i=d(),s=t=>{i.update(t),i.isTimeout&&(a.delete(s),e())};i.start(t),a.add(s)}function p(t=!1){let e=0,i=t=>{e+=t};return t&&a.add(i),{get now(){return e},get isPaused(){return!a.has(i)},stop(t=!1){a.delete(i),t&&(e=0)},start(){e=0,a.add(i)}}}function f(t,e,i){let s=t=>{t.save(),e(t),t.restore()};c.add(s),u(t,()=>{c.delete(s),i&&i()})}var m=!1,x="";function g(){return x}function y(){let t=m;return t&&(m=!1),t}var w=class t{x;y;constructor(t=0,e=0){this.x=t,this.y=e}add(t){return"number"==typeof t?(this.x+=t,this.y+=t):(this.x+=t.x,this.y+=t.y),this}sub(t,e=t){return"number"==typeof t?(this.x-=t,this.y-=e):(this.x-=t.x,this.y-=t.y),this}mult(t){return this.x*=t,this.y*=t,this}div(t){return this.x/=t,this.y/=t,this}set(t=0,e=0){this.x=t,this.y=e}dist(t){return t.clone().sub(this).mag()}directionTo(t){return t.clone().sub(this).normalize()}lerp(t,e=1){this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y}normalize(){let t=this.mag();return t>0&&this.div(t),this}mag(){return Math.hypot(this.x,this.y)}clone(){return new t(this.x,this.y)}toString(){return`${this.x}, ${this.y}`}},k=class{static name="Character";name="Character";ctx;img;width;halfWidth;pos=new w;letterIndex=0;isFrozen=!1;_score=0;constructor(t,e){this.ctx=t,this.img=e,this.width=this.img.width,this.halfWidth=this.width/2}set score(t){this._score=t,this._score<0&&(this._score=0)}get score(){return this._score}onRender(){this.ctx.drawImage(this.img,this.pos.x,this.pos.y)}},z=class t extends k{static name="player";name=t.name},v=class t extends k{static name="cat";name=t.name;predictTimer=d();level=0;_predictTimeSec=1;_predictChance=.5;_lastPredictResult=!1;constructor(t,e){super(t,e),this.levelUp([])}canPredict(){return!!this.predictTimer.isTimeout&&(this.predictTimer.start(this._predictTimeSec),!0)}predict(){return!!o(this._predictChance)}onRoundStart(){this.predictTimer.start(this._predictTimeSec)}levelUp(t){this.level++,this._predictTimeSec=Math.max(.5,1-.08*this.level),this._predictChance=Math.min(.95,.5+.07*this.level);let e=t.filter(t=>"player"===t).length,i=t.filter(t=>"cat"===t).length;3===e?(this._predictTimeSec=Math.max(.3,this._predictTimeSec-.1),this._predictChance=Math.min(1,this._predictChance+.1)):i>=2&&(this._predictTimeSec=Math.min(2,this._predictTimeSec+.1),this._predictChance=Math.max(.3,this._predictChance-.1))}onRender(){if(super.onRender(),!this.predictTimer.isActive)return;this.ctx.strokeStyle="#444",this.ctx.lineWidth=1.3;let t=(this._predictTimeSec-this.predictTimer.time/this._predictTimeSec)*(2*Math.PI);this.ctx.beginPath(),this.ctx.arc(this.pos.x+this.halfWidth,this.pos.y+3,5,0,t),this.ctx.stroke()}},b=class{ctx;width=0;height=0;char="";pos=new w;perk=this.getRandomPerk();isUsed=!1;_owners=new Set;isPlayerGuessedCorrect=null;constructor(t){this.ctx=t,this.char=n(i),this.ctx.font="2rem monospace";let e=this.ctx.measureText(this.char);this.width=e.width,this.height=e.actualBoundingBoxAscent}addOwner(t,e){this._owners.add(t),"player"===t.name&&(this.isPlayerGuessedCorrect=e)}get owners(){return this._owners}get score(){return!this.perk||this.isUsed?1:"bomb"===this.perk?-1:"rocket"===this.perk?0:1}get color(){return null===this.isPlayerGuessedCorrect?"#444":!0===this.isPlayerGuessedCorrect?"#688958":!1===this.isPlayerGuessedCorrect?"#E87461":void 0}getRandomPerk(){return o(.25)?"snowflake":o(.2)?"bomb":!!o(.1)&&"rocket"}render(t){if(this.ctx.font="1rem monospace",this.ctx.lineWidth=2,this.ctx.strokeStyle=this.ctx.fillStyle=this.color,this.ctx.fillText(this.char,this.pos.x,this.pos.y),this.ctx.strokeRect(t.x,t.y,t.width,t.height),this._owners.size>0){let t=this.pos.y+16;for(let e of this._owners)this.ctx.drawImage(e.img,this.pos.x+2,t,16,16),t+=24}if(!this.perk||this.isUsed)return;let e=this.pos.x+.6*this.width,i=this.pos.y-.75*this.height;"snowflake"===this.perk&&(this.ctx.fillStyle="#EEE",this.ctx.lineWidth=1,this.ctx.strokeText(h(this.perk),e,i)),this.ctx.fillText(h(this.perk),e,i)}},T=class{ctx;letters=[];boundingRect=new DOMRect;centerX=0;totalSize=0;letterBoxPadding=10;letterPadding=5;letterMaxW=0;letterMaxH=0;letterTurnIdx=0;constructor(t,e,i){this.ctx=t,this.centerX=e,this.boundingRect.y=i}get head(){return this.letters[this.letterTurnIdx]}get size(){return this.letters.length}get isCompleted(){return this.letterTurnIdx>=this.letters.length}generate(t=1){this.letters=Array.from({length:t},()=>new b(this.ctx)),this.letterMaxW=Math.max(...this.letters.map(t=>t.width)),this.letterMaxH=Math.max(...this.letters.map(t=>t.height));let e=this.letterMaxW+this.letterPadding+this.letterBoxPadding;this.boundingRect.width=this.letters.reduce((t,i)=>t+i.width+e,0),this.boundingRect.height=this.letterMaxH,this.boundingRect.x=this.centerX-(this.boundingRect.width-e)/2;let i=this.letters.length,s=this.boundingRect.x;for(let t=0;t<i;t++){let i=this.letters[t];i.pos.set(s,this.boundingRect.y),s+=i.width+e}this.letterTurnIdx=0}popHead(){return this.letters[this.letterTurnIdx++]}clear(){this.letters=[]}onRender(){let t=this.letterBoxPadding;for(let e of this.letters){let i=new DOMRect(e.pos.x-t,e.pos.y-this.boundingRect.height-t,this.letterMaxW+2*t,this.letterMaxH+2*t);e.render(i)}}},M=zzfxM([[1.8,0,72,,,.2,,4,-2,6,50,.15,,6],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[1.2,0,23,,,.2,3,4,,,3,.9,.05],[1.5,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,,,,,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,25,,,25,,25,25,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,]],[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,8,8,8,5,13],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,,,,,,,,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,13,13,13,13,13,13,13]],[[3,-1,13,13,13,8,13,,13,15,17,17,15,13,20,20,18,17,18,,,,17,,15,,,,17,,18,,22,22,22,,18,,,,25,25,25,,22,,,18,20,22,20,,,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,11,,23,,11,11,23,11,,11,23,11,11,11,23,,10,,22,,10,10,22,10,,10,22,10,10,6,8,10,20,25,20,20,25,20,,20,25,20,20,20,25,,20,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,15,13,,17,15,13,,15,,,,10,13,15,10,13,15,10,13,15,10,13,15,12,,,,,,8,15,,,,,17,15,13,8,13,,,,,,10,8,,20,20,20,20,20,20,20],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,15,,27,,15,15,27,15,,15,27,15,15,15,27,32,20,,32,,20,20,32,20,,20,32,20,20,20,32,,13,,25,,13,13,25,20,,20,32,20,20,20,32,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[2,-1,13,,25,25,13,,25,25,13,,25,25,13,,25,25,15,,27,27,15,,27,27,15,,27,27,15,,27,27,20,,32,32,20,,32,32,20,,32,32,20,,32,32,13,,25,25,13,,25,25,20,,32,32,20,,32,34],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,25,,,25,,,,25,25,25,25,25],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13,,13,13,13,13,13,13,13]]],[0,1,2,2,3,3,2,2,4,4,5,6,6,7,2,2,3],void 0),R={bomb:[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6],pickup:[3.5,,331,.01,.07,.07,1,.7,,,261,.07,,,,,,.67,.03,,542],falsepickup:[2,,251,.01,.05,,1,.7,.2,,50,,,.9,,.4,,.4,.08,,-1532],catpickup:[2,,447,.01,.01,.08,1,1.1,,-4,,,,,,,,.6,.04],rocket:[2.7,,541,.04,.22,.19,1,.9,-9,,,,,,,,,.52,.11,,898],snowflake:[1.1,,585,,.15,.29,1,.5,-5,333,312,.07,.18,,,,,.52,.23,.15],touch:[8,,150,.01,,.03,1,4.2,,,,,,.5,,,,.93,,.1]},S=!1;for(let[t,e]of Object.entries(R))R[t]=zzfxG(...e);function C(t,e=!1){let i=null;return i="bgmusic"===t?zzfxP(...M):zzfxP(R[t.toLowerCase()]),i&&e&&(i.loop=!0),{stop(){i.stop()},start(){i.start()}}}function W(){return S}var L=new Map;function P(t){return L.get(t)}L.set("player",{score:0,correct:0,scoreSize:0,passedLetters:0}),L.set("cat",{score:0,scoreSize:0});var D,I,_,A,E=class{ctx;W;H;BLOCK_WIDTH=.2;BLOCK_HEIGHT=.4;MAX_ROUND_SIZE=3;ROUND_COMPLETE_BREAK_SEC=3;letterSequence;player;cat;dialog;roundCompletedTimer=d();roundTime=p();roundData=[];levelTime=p();roundWinner=null;round=0;timeoutWarLetters=[];constructor(t,e,i){this.ctx=t,this.W=e,this.H=i,this.letterSequence=new T(this.ctx,.5*this.W,.25*this.H),requestAnimationFrame(()=>this.updateScore())}get level(){return this.cat.level}get levelLetterSize(){return Math.max(2,Math.min(this.level+1,10))}get isRoundCompleted(){return!this.isLetterRemain(this.player)&&!this.isLetterRemain(this.cat)}onUpdate(t){if(!this.dialog.isOpen&&(this.isRoundCompleted?this.clearStage(t):this.checkLetterPredicted(),this.timeoutWarLetters.length>0&&this.manageRocketAttack(t),this.roundCompletedTimer.isActive)){if(this.roundCompletedTimer.time>2||this.timeoutWarLetters.length>0)return;if(this.roundCompletedTimer.time<1)return void(this.timeoutWarLetters.length>0&&(this.timeoutWarLetters=[]));this.addRocket()}}addRocket(){let t=new b(this.ctx);t.perk=n(["rocket","snowflake","bomb"]),t.pos.set(this.cat.pos.x,this.cat.pos.y+32),this.timeoutWarLetters.push(t)}manageRocketAttack(t){for(let e of this.timeoutWarLetters)e.isUsed||(e.pos.dist(this.player.pos)<this.player.width&&(this.pickLetter(this.cat,e,!0),e.isUsed=!0),y()&&this.pickLetter(this.player,e,g()===e.char),e.pos.lerp(this.player.pos,1*t))}checkLetterPredicted(){let t=this.letterSequence.letters,e=null,i=!1,s=null;this.isLetterRemain(this.player)&&y()&&!this.player.isFrozen?(s=this.player,e=t[s.letterIndex],i=e.char===g()):this.isLetterRemain(this.cat)&&this.roundTime.now>1&&!this.cat.isFrozen&&this.cat.canPredict()&&(s=this.cat,e=t[s.letterIndex],i=this.cat.predict()),s&&this.pickLetter(s,e,i)}pickLetter(t,e,i){if(e.addOwner(t,i),t.letterIndex++,"player"===t.name){let t=P("player");t.passedLetters++,i&&t.correct++,C(i?"pickUp":"falsePickUp")}else C("catPickUp");if(i){if(t.score+=e.score,!e.perk||e.isUsed)return void this.updateScore();this.activatePerk(e,t)}}isLetterRemain(t){return t.letterIndex<this.letterSequence.size}activatePerk(t,e){let i=e.pos.x,s=e.pos.y;switch(t.isUsed=!0,t.perk){case"bomb":i+=35,s*=1.85;break;case"rocket":e=e===this.player?this.cat:this.player;break;case"snowflake":e.isFrozen=!0,i+=e.halfWidth,s+=e.halfWidth}switch("bomb"!==t.perk&&u(1,()=>C(t.perk)),t.perk){case"bomb":case"snowflake":let i=t.pos.x+.6*t.width,s=t.pos.y-.75*t.height,r=1;f(2,e=>{e.font=r+"rem monospace","snowflake"===t.perk&&(e.fillStyle="#EEE",e.strokeStyle="#444",e.lineWidth=1,e.strokeText(h(t.perk),i,s)),e.fillText(h(t.perk),i,s),r+=.04},()=>{e.isFrozen=!1,this.updateScore(),"bomb"===t.perk&&C(t.perk)});break;case"rocket":let n=t.pos.clone(),o=e.pos.clone().add(e.halfWidth);f(2,e=>{if(n.dist(o)<10)return;let i=n.directionTo(o).mult(4.8);n.add(i),e.font="2rem roboto",e.fillText(h(t.perk),n.x,n.y)},()=>{e.score--,this.updateScore()})}}clearStage(){this.roundTime.stop(),this.roundCompletedTimer.isActive?this.roundCompletedTimer.isTimeout?this.onStartRound():this.roundCompletedTimer.time<this.ROUND_COMPLETE_BREAK_SEC-2&&this.letterSequence.clear():this.onEndRound()}onEndRound(){this.round>this.MAX_ROUND_SIZE-1?(u(2,this.onLevelUp.bind(this)),this.round=0):this.roundCompletedTimer.start(this.ROUND_COMPLETE_BREAK_SEC);let t=this.letterSequence.letters[this.letterSequence.size-1];if(!t)return;let e=Array.from(t.owners.values())[0];this.roundData.length<this.MAX_ROUND_SIZE&&this.roundData.push(e.name),this.letterSequence.letters.reduce((t,i)=>t+(("player"===e.name?i.isPlayerGuessedCorrect:!i.isPlayerGuessedCorrect)?1:0),0)>=Math.floor(this.levelLetterSize/2)&&(this.roundWinner=e)}onStartRound(){let t=this.levelLetterSize;this.letterSequence.generate(t),this.roundWinner&&(this.roundWinner.score+=Math.floor(t/2),this.roundWinner=null,this.updateScore()),0===this.round&&this.levelTime.start(),this.round++,this.player.letterIndex=this.cat.letterIndex=0,this.timeoutWarLetters=[],this.cat.onRoundStart(),this.roundTime.start()}updateScore(){for(let t of[this.player,this.cat]){let e=t.name;this.ctx.font="1.2rem monospace",P(e).score=t.score,P(e).scoreSize=this.ctx.measureText(t.score).width}}onLevelUp(){this.levelTime.stop(!0),this.cat.levelUp(this.roundData),this.dialog.show(this.level),this.roundData=[],this.letterSequence.clear()}addBlock(t,e){let i=.5*this.H,s=this.W*this.BLOCK_WIDTH,r=this.H-this.H*this.BLOCK_HEIGHT,h=P(e),n=t-h.scoreSize/2+s/2;this.ctx.fillStyle="#CFAB8D",this.ctx.fillRect(t,i,s,r),this.ctx.fillStyle="#222",this.ctx.font="1.2rem monospace",this.ctx.fillText(h.score,n,i+r/2),this.ctx.fillStyle="#ECEEDF",this.ctx.fillRect(t,i,s,.15*r)}onRender(){this.ctx.fillStyle="#D9C4B0",this.ctx.fillRect(0,0,this.W,this.H),this.ctx.fillStyle="#444",this.ctx.textAlign="center",this.roundCompletedTimer.isActive&&this.roundCompletedTimer.time>0&&(this.ctx.font="1rem monospace",this.ctx.fillText("Ready: "+(this.roundCompletedTimer.time+1|0),.5*this.W,60)),this.ctx.font="1rem monospace",this.ctx.fillText(0|this.levelTime.now,.5*this.W,25),this.ctx.textAlign="left",this.ctx.fillText("Level: "+this.level,10,25),this.ctx.font="0.75rem monospace",this.ctx.fillText(`Round: ${this.round}/${this.MAX_ROUND_SIZE}`,10,45);let t=.15*this.W,e=this.W*this.BLOCK_WIDTH/2;this.addBlock(t,this.player.name),this.player.pos.set(t+e-this.player.halfWidth,.5*this.H-this.player.halfWidth);let i=.15*this.W+.5*this.W,s=this.W*this.BLOCK_WIDTH/2;if(this.addBlock(i,this.cat.name),this.cat.pos.set(i+s-this.cat.halfWidth,.5*this.H-this.cat.halfWidth),null!==this.roundWinner){let t=this.roundWinner.pos.clone(),e=Math.floor(this.levelLetterSize/2);this.ctx.font="1rem monospace",this.ctx.fillStyle="#444",this.ctx.fillText(`+${e}`,t.x,t.y)}this.letterSequence.onRender();for(let t of this.timeoutWarLetters){let e=this.letterSequence.letterBoxPadding,i=t.height+2*e,s=new DOMRect(t.pos.x-e,t.pos.y-(i-e),t.width+2*e,i);t.render(s)}if(!this.isLetterRemain(this.player))return;let r=this.letterSequence.letterPadding+this.letterSequence.letterBoxPadding+this.ctx.lineWidth,h=this.letterSequence.letters[this.player.letterIndex].width+r,n=this.letterSequence.boundingRect.x-.5*r+(h+r)*this.player.letterIndex,o=this.letterSequence.boundingRect.y+1.5*this.letterSequence.boundingRect.height,l=n+.5*h;this.ctx.fillStyle="#444",this.ctx.beginPath(),this.ctx.moveTo(l,o),this.ctx.lineTo(l-8,o+8),this.ctx.lineTo(l+8,o+8),this.ctx.fill()}},G=new Path2D("M3 9h4l5-5v16l-5-5H3z"),H=new Path2D("M3 9h4l5-5v16l-5-5H3zm13.59 3L14 9.41L15.41 8L18 10.59L20.59 8L22 9.41L19.41 12L22 14.59L20.59 16L18 13.41L15.41 16L14 14.59z"),N=[{title:"Welcome to The Research",level:1,contents:["Thank you for agreeing to participate in the speed-typing challenge","between a cat and a human.\n","Press the letter shown on the screen; regular letters earn 1 point.","Some letters have unique abilities and are triggered only once. You","earn points for each correct letter.\n","Some letters have abilities:","üí£: You lose 1 point.","üöÄ: You don‚Äôt gain a point, but your opponent loses 1 point.","‚ùÑ : You get 1 point, but you freeze for 2 seconds."]},{title:"Great Results!",level:2,contents:["See? I told you it‚Äôd be easy.\n","When you complete level 10, the research will be finished.","Each level consists of 5 rounds and the number of letters increases","with each level.\n","To find out which letter the opponent is on, look below the letter.","If the ability in the letter has not disappeared, your opponent has","pressed the wrong key on the keyboard.\n","Maybe the cat did it on purpose; it's a good idea to","press the wrong key when it sees a letter with a bomb on the screen."]},{title:"Antics",level:3,contents:["Cat Appears to Be Having Trouble Finding the Letters.","But it seems to be thinking faster and pressing the right keys","more and more.\n","If you finish the round the fastest and get at least half of the letters","correct, you get extra points equal to half of the letters on the screen."]},{title:"Furrowed Brows",level:4,contents:["The cat looks focused ‚Äî or is it devising a strategy?","We apologize for the words thrown by the cat.\n","How do you like our technology that shows a cat's thinking time?","When the thinking time is over, it tries to press the key,","but there is no guarantee that it is the right key.\n","(We had chosen a black cat to bring bad luck, but I guess the rumor is","false.)"]},{title:"Indigestion",level:5,contents:["The cat just climbed onto the keyboard... Could this work?","Was this its secret plan?"]},{title:"Purrfect",level:6,contents:["The cat seems to be getting the hang of this.\n","The cat's typing speed and accuracy keep increasing.","Score as many points as you can before the cat gets stronger.\n","Good luck!"]},{title:"You Got Very Close",level:7,contents:["Most of the level is done. There's no time to rest.","Can you grasp how important this research is?"]},{title:"You Can't Catch This Cat",level:8,contents:["The cat's out of control! It's starting to emit a noticeable heat","that scares us. Anyway, you must finish this."]},{title:"Nap? Not Today!",level:9,contents:["The cat isn't just breaking records in typing speed and accuracy","it's also setting records for not taking naps over a long time."]},{title:"The Final",level:10,contents:["Use all your strength ‚Äî this is the final stage.\n","You‚Äôll see your progress after you pass this level."]},{title:"Results",level:11,contents:["Thank you for your participation,","The research results are quite usele... I mean, useful."]}],B=class{PADDING=30;LINE_PADDING=15;isOpen=!1;msg=N[0];gameMusic=null;constructor(){this.isOpen=!0}show(t){this.msg=N[t-1],11===this.msg.level&&this.msg.contents.push(...this.generateGameResult()),this.isOpen=!0}hide(){this.isOpen=!1,this.playGameMusic()}playGameMusic(){this.gameMusic||W()?this.gameMusic&&W()&&(this.gameMusic.stop(),this.gameMusic=null):this.gameMusic=C("bgmusic",!0)}generateGameResult(){let t=["\n","Statistics:"],e=P("player"),i=(performance.now()/1e3/60).toFixed(1),s=e.passedLetters,r=e.correct,h=s-r;return t.push(`Playing time: ${i} minutes.`),t.push(`Your score: ${e.score}`),t.push(`Number of keys pressed: ${s}`),t.push(`Number of keys pressed correctly: ${r}`),t.push(`Number of keys pressed incorrectly: ${h}\n`),t.push(`Don't forget to share your score: ${e.score} (${r}/${h}/${s})`),t}onRender(t,e,i){let s=i-2*this.PADDING;t.fillStyle="rgba(217, 196, 176, 0.5)",t.fillRect(0,0,e,i),t.fillStyle="#A26769",t.fillRect(this.PADDING,this.PADDING,e-2*this.PADDING,s),t.save(),t.font="0.5rem monospace",t.fillStyle="#444",t.translate(e-1.75*this.PADDING,5),t.fill(W()?H:G),t.fillText("Toggle Game Music (press M key):",-160,15),t.restore(),t.font="1.5rem monospace",t.fillStyle="#ECE2D0",t.fillText(this.msg.title,1.5*this.PADDING,2.5*this.PADDING),t.font="0.9rem monospace";let r=e-4*this.PADDING,h=4*this.PADDING;for(let e=0;e<this.msg.contents.length;e++){let i=this.msg.contents[e];t.fillText(i,1.5*this.PADDING,h,r),h+=t.measureText(i).actualBoundingBoxAscent+this.LINE_PADDING,i.endsWith("\n")&&(h+=this.LINE_PADDING)}if(11!==this.msg.level&&(t.font="italic 0.7rem monospace",t.textAlign="right",t.fillText("[Press j to continue]",r+2*this.PADDING,s,r),y()))switch(C("touch"),g()){case"J":this.hide();break;case"M":S=!S,this.playGameMusic()}}},{W:O,H:U}=function(){t=document.getElementsByTagName("canvas")[0],r(e=t.getContext("2d",{alpha:!1}));let i=t.dataset.initWidth,h=t.dataset.initHeight;return window.addEventListener("blur",()=>s=!1),window.addEventListener("focus",()=>s=!0),window.addEventListener("resize",()=>r()),{W:i,H:h}}(),q=performance.now();function $(t){let i=(t-q)/1e3;q=t,s&&(function(t){(function(t){for(let e of Array.from(a))e(t)})(t),D.onUpdate(t)}(i),e.save(),e.shadowColor="rgba(0, 0, 0, 0.1)",e.shadowOffsetX=-4,e.shadowOffsetY=4,D.onRender(),I.onRender(),_.onRender(),A.isOpen&&A.onRender(e,O,U),function(t){for(let e of Array.from(c))e(t)}(e),e.restore()),requestAnimationFrame($)}window.onload=async function(){let i=await l('<svg xmlns="http://www.w3.org/2000/svg" stroke="#000" stroke-width=".5" viewBox="0 0 512 512" width="64" height="64"><path d="M256 0c-82 0-148 66-148 148v67h296v-67C404 66 338 0 256 0z" style="fill:#5a4146"/><path d="m256 0-27 2c69 13 121 73 121 146v67h54v-67C404 66 338 0 256 0z" style="opacity:.1;enable-background:new"/><path d="M130 176c-20 0-37 16-37 36 0 21 17 37 37 37h17v-73h-17zM382 176c20 0 37 16 37 36 0 21-17 37-37 37h-17v-73h17z" style="fill:#e6b273"/><path d="M431 512c-20-48-58-86-107-105H188c-48 19-87 57-107 105h350z" style="fill:#6ab2cc"/><path d="M294 398v-68h-76v68c-11 2-20 5-30 9a70 70 0 0 0 136 0c-10-4-19-7-30-9z" style="fill:#f0c087"/><path d="M218 330v57a159 159 0 0 0 76 0v-57h-76z" style="opacity:.1;enable-background:new"/><path d="M347 117c-13 0-23-10-23-23a23 23 0 0 1-45 0 23 23 0 0 1-46 0 23 23 0 0 1-45 0 23 23 0 0 1-41 14c-11 18-17 39-17 61v64a126 126 0 0 0 252 0v-64c0-22-6-43-17-61-4 5-11 9-18 9z" style="fill:#f0c087"/><path d="M256 293c-15 0-28-2-35-7a8 8 0 0 1 9-14c4 3 13 5 26 5s22-2 26-5a8 8 0 0 1 9 14c-7 5-20 7-35 7zM175 194a8 8 0 0 1-6-14c7-5 18-8 31-8s23 3 30 8a8 8 0 0 1-11 13c-2-3-10-5-19-5s-18 2-20 5l-5 1z" style="fill:#5a4146"/><circle cx="199.6" cy="213.6" r="13.8" style="fill:#353640"/><path d="m337 194-5-1c-2-3-10-5-20-5-9 0-17 2-19 5a8 8 0 0 1-11-13c7-5 18-8 30-8 13 0 24 3 31 8a8 8 0 0 1-6 14z" style="fill:#5a4146"/><circle cx="312.4" cy="213.6" r="13.8" style="fill:#353640"/></svg>'),s=await l('<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><path fill="#4c5359" d="M4.5 2.2c-3.5 2.2-3.4 25.5.8 33l26.1-16c-4-7.1-23.6-19-26.9-17"/><path fill="#f7a4a4" d="M9.5 11.3c-1.5.9-2.2 16.2.4 21l16.7-10.2c-2.4-4.6-15.7-11.6-17.1-10.8"/><path fill="#4c5359" d="M59.5 2.2c3.5 2.2 3.4 25.5-.7 33l-26.1-16c3.9-7.1 23.5-19 26.8-17"/><path fill="#f7a4a4" d="M54.5 11.3c1.5.9 2.2 16.2-.4 21L37.3 22.1c2.5-4.6 15.8-11.6 17.2-10.8"/><path fill="#4c5359" d="M31.8 13.1C4.7 13.1 2.2 32.5 2.2 43.5 2.2 48 15.4 62 31.8 62c16.4 0 29.6-14 29.6-18.5 0-11-2.5-30.4-29.6-30.4"/><path fill="#bfffab" d="M24.2 38.7s-3.1 4.8-8.8 3.3c-5.7-1.5-6-7.2-6-7.2s3.1-4.8 8.8-3.3a8 8 0 0 1 6 7.2"/><path fill="#93e67f" d="M23.6 36.2s-2.7 3-6.5 3c-4.1 0-6.5-5.9-6.5-5.9s2.7-3.1 7.6-1.9a7.3 7.3 0 0 1 5.4 4.8"/><path fill="#4c5359" d="M19.4 36.1c0 6.6-3.2 6.6-3.2 0 .1-6.6 3.2-6.6 3.2 0"/><path fill="#bfffab" d="M39.4 38.7s3.1 4.8 8.8 3.3c5.7-1.5 6-7.2 6-7.2s-3.1-4.8-8.8-3.3a8 8 0 0 0-6 7.2"/><path fill="#93e67f" d="M39.9 36.2s2.7 3 6.5 3c4.1 0 6.5-5.9 6.5-5.9s-2.7-3.1-7.6-1.9c-4.5 1.2-5.4 4.8-5.4 4.8"/><path fill="#4c5359" d="M44.1 36.1c0 6.6 3.2 6.6 3.2 0s-3.2-6.6-3.2 0"/><path fill="#fff" d="M40.4 44c-2.6-2-5.4-8.7-8.6-8.7S25.7 42 23.1 44c-4.1 3.2-15 6.8-15 6.8S19.7 61 31.7 61s23.6-10.2 23.6-10.2c.1 0-10.8-3.6-14.9-6.8"/><ellipse cx="31.8" cy="54.5" fill="#ff94a4" rx="1.7" ry="2.5"/><g fill="#4c5359"><path d="M40.2 53.1a6 6 0 0 1-3.1.8 5 5 0 0 1-2.9-1.1 4.2 4.2 0 0 1-1.6-2.6l-.8-4.5-.8 4.5c-.2 1-.8 1.9-1.6 2.6a5.2 5.2 0 0 1-6 .3 5 5 0 0 1-2.2-2.7 5.4 5.4 0 0 0 5.2 4.8c1.4.1 2.7-.3 3.8-1.1.6-.4 1.1-1 1.5-1.6a5.8 5.8 0 0 0 5.3 2.7c1.3-.1 2.6-.6 3.6-1.4 1-.9 1.7-2.1 1.7-3.4a4.7 4.7 0 0 1-2.1 2.7"/><path d="M35.8 44.8c-.8-1-3.3-1.1-4-1.1-.7 0-3.2.1-4 1.1-.6.7-.1 2.5 1.4 4 1 1 1.9 1.3 2.6 1.3.7 0 1.7-.3 2.6-1.3 1.5-1.6 2-3.3 1.4-4"/></g></svg>');document.body.addEventListener("keyup",()=>{m=!1}),document.body.addEventListener("keydown",t=>{let e=t.ctrlKey||t.metaKey||t.shiftKey||t.altKey;!t.code.startsWith("Key")||e||(x=t.code[3],m=!0)}),I=new z(e,i),_=new v(e,s),A=new B,(D=new E(e,O,U)).player=I,D.cat=_,D.dialog=A,t.focus(),requestAnimationFrame($)}</script>