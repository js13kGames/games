<!doctype html><style>body,html{margin:0;height:100%}body{text-align:center;background:#45484d;background:linear-gradient(to bottom,#45484d 0,#000 100%)}div#backdrop{margin:0 auto;background:#fff;overflow:auto;padding:10px 0 50px;width:900px;border-radius:10px}div#playarea{margin:0 auto;width:800px;height:600px}div#playarea canvas{width:800px;height:600px}</style><title>Forest Racer - js13kGames 2012</title><div id=backdrop><h2>Play in Chrome if you want working sound!</h2><div id=playarea><canvas height=384 id=retrobox width=512>Your browser does not appear to support HTML5 :(</canvas><audio id=engine preload=auto src=eng.wav></audio><audio id=explode preload=auto src=expl.wav></audio></div></div><script>function e(t){this.canMainCanvas=t,this.width=this.canMainCanvas.width,this.height=this.canMainCanvas.height,this.conCanvas=this.canMainCanvas.getContext("2d"),this.canBackground=document.createElement("canvas"),this.canBackground.width=this.width,this.canBackground.height=this.height,this.conBackground=this.canBackground.getContext("2d"),this.timeout=null,this.keys={left:78,right:77,up:65,down:90,start:83,debug:89},this.keysdown={},this.score=0,this.level=1,this.topscore=1e4,this.speed=.1,this.horizon=0,this.turnspeed=.3,this.treespeed=1,this.accelcounter=0,this.audcounter=0,this.linepos=0,this.gamemode=this.gamePreload,this.fr_target=30,this.fr_framems=1e3/this.fr_target,this.fr_count=0,this.fr_fps=0,this.fr_counter=0,this.fr_timer=0,this.confTreeWidth=8,this.confTreeHeight=50,this.confTreeGap=Math.floor(this.confTreeWidth/3),this.confTreeArea=this.confTreeWidth+this.confTreeGap,this.confLimit=15,this.confForestWidth=Math.floor(this.width/this.confTreeArea)+this.confLimit,this.confFramesPerLevel=1800,this.confMaxSpeed=.5,this.confMinSpeed=.05,this.confMaxLevel=13,this.confTreeCap=.1,this.confSize=8,this.confCrashSteps=5,this.confMountainHeight=7,this.confOverTime=5e3,this.confLineGap=this.confLimit/15,this.textTitle1="FOREST RACER",this.textTitle2="13 Levels of Tree Mayhem",this.textWait="PLEASE WAIT!!!",this.textStart="Press S to Start",this.textOver="GAME OVER",this.textCongrats="CONGRATULATIONS!!!",this.textHighScore="New High Score!!!",this.textInstructions1="A - Accelerate",this.textInstructions2="Z - Decelerate",this.textInstructions3="N - Steer Left",this.textInstructions4="M - Steer Right",this.textAuthor="Written by RobeesWorld.com",this.ptrRnd=0,this.ptrRndCrash=Math.floor(10*Math.random()),this.arrRnd=new Array;for(var e=0;e<100+4*this.confCrashSteps;e++)this.arrRnd.push(Math.random());this.debug=!1,this.createMedia(),this.bindEvents()}window.onload=function(){var t=document.getElementById("retrobox");t.getContext&&new e(t)},(new Image).src="tree.png",e.prototype.bindEvents=function(){var e=this;window.onkeydown=function(t){for(key in e.keys)t.keyCode==e.keys[key]&&(e.keysdown[key]=!0)},window.onkeyup=function(t){for(key in e.keys)t.keyCode==e.keys[key]&&(e.keysdown[key]=!1)},this.timeout=setTimeout(function(){e.processFrame()},this.fr_framems)},e.prototype.createMedia=function(){this.gradSunset=this.conCanvas.createLinearGradient(0,0,0,this.height/2),this.gradSunset.addColorStop(0,"#6102B7"),this.gradSunset.addColorStop(1,"#E37A1C"),this.gradFloor=this.conCanvas.createLinearGradient(0,this.height/2,0,this.height),this.gradFloor.addColorStop(0,"#0D2F0F"),this.gradFloor.addColorStop(1,"#1F6D23"),this.conBackground.fillStyle=this.gradSunset,this.conBackground.fillRect(0,0,this.width,this.height/2),this.conBackground.fillStyle=this.gradFloor,this.conBackground.fillRect(0,this.height/2,this.width,this.height/2),this.imgTree=new Image,this.imgTree.src="tree.png",this.audEngine=document.getElementById("engine"),this.explode=document.getElementById("explode"),this.canWorkCanvas=document.createElement("canvas"),this.canWorkCanvas.width=this.imgTree.width,this.canWorkCanvas.height=this.imgTree.height,this.conWorkCanvas=this.canWorkCanvas.getContext("2d"),this.conWorkCanvas.drawImage(this.imgTree,0,0),this.imdTree=this.conWorkCanvas.getImageData(0,0,this.imgTree.width,this.imgTree.height),this.imgScaledTrees={},this.conCanvas.drawImage(this.canBackground,0,0),this.drawMountains(),this.imdMountains=this.conCanvas.getImageData(0,Math.floor(this.height/2)-Math.floor(this.height/this.confMountainHeight),this.width,Math.floor(this.height/this.confMountainHeight))},e.prototype.getTree=function(t,e){var i=t+"x"+e;return this.imgScaledTrees[i]||(this.imgScaledTrees[i]=this.createTree(t,e)),this.imgScaledTrees[i]},e.prototype.createTree=function(t,e){for(var i=0,s=this.conCanvas.createImageData(t,e),h=this.imgTree.width/t,o=this.imgTree.height/e,a=0,n=0;a<e;a++,n+=o)for(var r=Math.floor(n)*this.imgTree.width*4,c=0,d=0;c<t;c++,d+=h){var f=r+4*Math.floor(d);s.data[i++]=this.imdTree.data[f++],s.data[i++]=this.imdTree.data[f++],s.data[i++]=this.imdTree.data[f++],s.data[i++]=this.imdTree.data[f]}var l=document.createElement("canvas");return l.width=t,l.height=e,l.getContext("2d").putImageData(s,0,0),(l={data:s,imageURL:l.toDataURL()}).image=new Image,l.image.src=l.imageURL,l},e.prototype.initGame=function(t){this.treeLine=[];for(var e=0;e<this.confLimit;e+=this.treespeed/t){var i={};i.pos=e,i.x=-Math.floor(this.confForestWidth/8),this.treeLine.unshift(i),(i={}).pos=e,i.x=-Math.floor(this.confForestWidth/5),this.treeLine.unshift(i),(i={}).pos=e,i.x=Math.floor(this.confForestWidth/8),this.treeLine.unshift(i),(i={}).pos=e,i.x=Math.floor(this.confForestWidth/5),this.treeLine.unshift(i)}this.crashed=!1,this.score=0,this.level=1,this.speed=.1,this.treespeed=1,this.accelcounter=0,this.ptrRndCrash=Math.floor(10*Math.random())},e.prototype.addTreeLine=function(){if(this.treeLine[this.treeLine.length-1].pos>this.treespeed)for(var t=0;t<3;t++){var e={pos:0};e.x=Math.floor(Math.random()*this.confForestWidth)-Math.floor(this.confForestWidth/2),this.treeLine.push(e)}},e.prototype.processFrame=function(){var t=new Date,e=this,i=(this.checkKeys(),this.gamemode.apply(this),t=new Date-t,this.fr_framems-t);i<1&&(i=1),this.fr_count++,this.debug&&(this.fr_timer+=this.fr_framems>t?this.fr_framems:t,1e3<this.fr_timer&&(this.fr_fps=this.fr_counter,this.fr_counter=0,this.fr_timer-=1e3),this.fr_counter++,this.drawDebug()),this.timeout=setTimeout(function(){e.processFrame()},i)},e.prototype.gamePreload=function(){var t;this.treeLine||this.initGame(1),this.treeLine.length?(this.drawBackdrop(),this.flashCounter||(this.flashCounter=new Date),500<(t=new Date)-this.flashCounter?1e3<t-this.flashCounter&&(this.flashCounter=new Date):(this.conCanvas.fillStyle="white",this.conCanvas.font="bold 30px Courier New, Courier, monospace",t=this.conCanvas.measureText(this.textWait),this.conCanvas.fillText(this.textWait,Math.floor((this.width-t.width)/2),Math.floor(this.height/2-7))),this.drawTrees(),this.moveTrees(),this.speed=Math.round(100*(this.speed+.01))/100):this.gamemode=this.gamePreStart},e.prototype.gamePreStart=function(){var t,e;this.keysdown.start?(this.initGame(2),this.gamemode=this.gameInGame):(this.drawBackdrop(),this.drawScores(),this.flashCounter||(this.flashCounter=new Date),this.conCanvas.fillStyle="white",this.conCanvas.font="bold 20px Courier New, Courier, monospace",t=this.conCanvas.measureText(this.textInstructions1),this.conCanvas.fillText(this.textInstructions1,Math.floor((this.width-t.width)/2),Math.floor(this.height/2+30)),t=this.conCanvas.measureText(this.textInstructions2),this.conCanvas.fillText(this.textInstructions2,Math.floor((this.width-t.width)/2),Math.floor(this.height/2+50)),t=this.conCanvas.measureText(this.textInstructions3),this.conCanvas.fillText(this.textInstructions3,Math.floor((this.width-t.width)/2),Math.floor(this.height/2+70)),t=this.conCanvas.measureText(this.textInstructions4),this.conCanvas.fillText(this.textInstructions4,Math.floor((this.width-t.width)/2),Math.floor(this.height/2+90)),t=this.conCanvas.measureText(this.textAuthor),this.conCanvas.fillText(this.textAuthor,Math.floor((this.width-t.width)/2),Math.floor(this.height/2+150)),t=this.conCanvas.measureText(this.textTitle1),this.conCanvas.fillText(this.textTitle1,Math.floor((this.width-t.width)/2),Math.floor(this.height/2-80)),t=this.conCanvas.measureText(this.textTitle2),this.conCanvas.fillText(this.textTitle2,Math.floor((this.width-t.width)/2),Math.floor(this.height/2-50)),500<(e=new Date)-this.flashCounter?1e3<e-this.flashCounter&&(this.flashCounter=new Date):(t=this.conCanvas.measureText(this.textStart),this.conCanvas.fillText(this.textStart,Math.floor((this.width-t.width)/2),Math.floor(this.height/2-10))))},e.prototype.gameInGame=function(){this.moveKeys(),this.moveThings(),this.playAudio(),this.drawBackdrop(),this.drawTrees(),this.drawScores(),this.addTreeLine()},e.prototype.gameOver=function(){var t,e,i;this.keysdown.start?(delete this.overtime,this.initGame(2),this.gamemode=this.gameInGame):(this.drawBackdrop(),this.drawTrees(),this.drawScores(),this.flashCounter||(this.flashCounter=new Date),this.overtime||(this.overtime=new Date),t=this.crashed?(this.drawCrash(),this.textOver):(this.moveTrees(),this.textCongrats),this.conCanvas.fillStyle="white",this.conCanvas.font="bold 20px Courier New, Courier, monospace",e=this.conCanvas.measureText(this.textStart),this.conCanvas.fillText(this.textStart,Math.floor((this.width-e.width)/2),Math.floor(this.height/2+20)),500<(i=new Date)-this.flashCounter?1e3<i-this.flashCounter&&(this.flashCounter=new Date):(e=this.conCanvas.measureText(t),this.conCanvas.fillText(t,Math.floor((this.width-e.width)/2),Math.floor(this.height/2-10)),this.score==this.topscore&&(e=this.conCanvas.measureText(this.textHighScore),this.conCanvas.fillText(this.textHighScore,Math.floor((this.width-e.width)/2),Math.floor(this.height/2+50)))),i-this.overtime>this.confOverTime&&(delete this.overtime,this.gamemode=this.gamePreStart))},e.prototype.checkKeys=function(){this.keysdown.debug&&(this.debug=!this.debug,this.keysdown.debug=!1)},e.prototype.moveKeys=function(){if(this.speed)if(this.keysdown.left){this.horizon--,this.horizon<0&&(this.horizon=this.width-1);for(var t=0,e=this.treeLine.length;t<e;t++)this.treeLine[t].x+=this.turnspeed}else if(this.keysdown.right)for(this.horizon++,this.horizon==this.width&&(this.horizon=0),t=0,e=this.treeLine.length;t<e;t++)this.treeLine[t].x-=this.turnspeed;this.keysdown.down?this.speed>this.confMinSpeed&&(this.speed=Math.round(100*(this.speed-.01))/100):this.keysdown.up&&this.speed<this.confMaxSpeed&&(this.speed=Math.round(100*(this.speed+.01))/100)},e.prototype.playAudio=function(){if(this.audcounter--,this.audcounter<0){this.audcounter=Math.floor(9*(this.confMaxSpeed-this.speed));try{this.audEngine.currentTime=0}catch(t){}this.audEngine.play()}},e.prototype.moveThings=function(){this.accelcounter++,this.accelcounter>this.confFramesPerLevel&&(this.level++,this.level>this.confMaxLevel?(this.score+=1e5,this.gamemode=this.gameOver,this.accelcounter=this.confFramesPerLevel):(this.accelcounter=0,this.treespeed>this.confTreeCap&&(this.treespeed=Math.round(100*(this.treespeed-.1))/100))),this.score+=100*this.speed,this.moveTrees()},e.prototype.moveTrees=function(){this.linepos=Math.round(100*(this.linepos+this.speed))/100,this.linepos>this.confLineGap&&(this.linepos=0);for(var t=0,e=this.treeLine.length;t<e;t++)this.treeLine[t].pos=Math.round(100*(this.treeLine[t].pos+this.speed))/100;for(t=this.treeLine.length-1;0<=t;t--)this.treeLine[t].pos>this.confLimit&&(Math.abs(this.treeLine[t].x)<this.confTreeWidth/7&&this.gamemode!=this.gameOver?(this.crashed=!0,this.speed=0,this.explode.play(),this.score>this.topscore&&(this.topscore=this.score),this.gamemode=this.gameOver):this.treeLine.splice(t,1))},e.prototype.drawBackdrop=function(){this.conCanvas.drawImage(this.canBackground,0,0),this.conCanvas.putImageData(this.imdMountains,this.horizon,Math.floor(this.height/2)-Math.floor(this.height/this.confMountainHeight)),0<this.horizon&&this.conCanvas.putImageData(this.imdMountains,this.horizon-this.width,Math.floor(this.height/2)-Math.floor(this.height/this.confMountainHeight));var t=this.linepos;for(this.conCanvas.strokeStyle="black",this.conCanvas.lineWidth=1;t<this.confLimit;){var e=Math.pow(t/10,6),e=Math.floor(this.height/2)+t*e;this.conCanvas.beginPath(),this.conCanvas.moveTo(0,e),this.conCanvas.lineTo(this.width,e),this.conCanvas.stroke(),t+=this.confLineGap}},e.prototype.drawTrees=function(){for(var t=this.treeLine.length-1;0<=t;t--){var e=Math.pow(this.treeLine[t].pos/10,6),i=this.treeLine[t].x*this.confTreeArea-this.confTreeGap,s=(i=(i*=e)+Math.floor(this.width/2),Math.floor(this.confTreeHeight/2)),h=(s*=e,s=Math.floor(this.height/2)-s,this.confTreeWidth),o=(h*=e,this.confTreeHeight);o*=e,i+=Math.floor(h%this.confSize/2),s+=Math.floor(o%this.confSize/2),h=Math.round(h/this.confSize)*this.confSize,o=Math.round(o/this.confSize)*this.confSize,h<this.confSize&&(h=this.confSize),o<this.confSize&&(o=this.confSize),(e=this.getTree(h,o))&&this.conCanvas.drawImage(e.image,i,s)}},e.prototype.drawScores=function(){this.conCanvas.fillStyle="white",this.conCanvas.font="bold 13px Courier New, Courier, monospace";var t="TOP SCORE: "+this.topscore,e=this.conCanvas.measureText(t);this.conCanvas.fillText(t,this.width-e.width-10,20),this.conCanvas.fillText("SCORE: "+this.score,10,20),t=Math.floor((this.width-24)/this.confFramesPerLevel*this.accelcounter),this.conCanvas.fillStyle="blue",this.conCanvas.strokeRect(10,30,this.width-20,20),this.conCanvas.fillRect(12,32,t,16),this.conCanvas.fillStyle="white",t="LEVEL: "+this.level,e=this.conCanvas.measureText(t),this.conCanvas.fillText(t,(this.width-e.width)/2,43)},e.prototype.drawMountains=function(){this.ptrRnd=0;var t=Math.floor(this.height/this.confMountainHeight),e=0,i=0,s=Math.floor(this.height/2);for(this.conCanvas.fillStyle="black";i=e,!((e=this.drawTriangle(e,s,t))>=this.width);)e-=Math.floor(t/2);this.ptrRnd-=3,e=-(this.width-i),this.drawTriangle(e,s,t)},e.prototype.drawTriangle=function(t,e,i){return this.conCanvas.beginPath(),this.conCanvas.moveTo(t,e),t+=Math.floor(i/2+this.arrRnd[this.ptrRnd++]*(i/2)),this.conCanvas.lineTo(t,e-Math.floor(i/2+this.arrRnd[this.ptrRnd++]*(i/2))),t+=Math.floor(i/2+this.arrRnd[this.ptrRnd++]*(i/2)),this.conCanvas.lineTo(t,e),this.conCanvas.fill(),t},e.prototype.drawCrash=function(){this.ptrRnd=this.ptrRndCrash,this.conCanvas.strokeStyle="rgba(255,255,255,0.7)",this.conCanvas.lineWidth=2,this.drawCrackLine(-1,-1),this.drawCrackLine(1,-1),this.drawCrackLine(-1,1),this.drawCrackLine(1,1)},e.prototype.drawCrackLine=function(t,e){var i=Math.floor(this.width/2),s=Math.floor(this.height/2),h=Math.floor(this.width/this.confCrashSteps);this.conCanvas.beginPath(),this.conCanvas.moveTo(i,s);for(var o=0;o<2*this.confCrashSteps;o++)i+=Math.floor(this.arrRnd[this.ptrRnd++]*h*t),s+=Math.floor(this.arrRnd[this.ptrRnd++]*h*e),this.conCanvas.lineTo(i,s);this.conCanvas.stroke()},e.prototype.drawDebug=function(){this.conCanvas.fillStyle="white",this.conCanvas.font="13px Courier New, Courier, monospace",this.conCanvas.fillText("Frame: "+this.fr_count,5,this.height-15),this.conCanvas.fillText("FPS: "+this.fr_fps+"/"+this.fr_target,this.width-90,this.height-15),this.conCanvas.fillText("Speed: "+this.speed+", Tree Speed: "+this.treespeed,5,this.height-30),this.conCanvas.fillText("Horizon: "+this.horizon,this.width-120,this.height-30),this.conCanvas.fillText("Keys Pressed: "+(this.keysdown.left?"LEFT ":"")+(this.keysdown.right?"RIGHT ":"")+(this.keysdown.up?"UP ":"")+(this.keysdown.down?"DOWN ":"")+(this.keysdown.start?"START":""),5,this.height-55)}</script>