<!doctype html><meta name=viewport content="width=device-width"><title>Tic Tac Woe - js13kGames 2022</title><style>*{margin:0;padding:0;font-family:"Lucida Console","Courier New",monospace}body,html{overflow:hidden}#info{position:absolute;bottom:10%;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:flex-end;flex-direction:column;row-gap:16px;background:rgba(11,11,11,.001);z-index:1}#info2{position:absolute;bottom:0;left:0;width:100%;height:100%;display:none;align-items:center;justify-content:flex-end;flex-direction:column;row-gap:16px;background:rgba(11,11,11,.001);z-index:1}h5{color:#111118}.button{border:none;padding:12px 32px;text-align:center;font-size:16px;transition-duration:.4s;cursor:pointer}.button2{background-color:#fff;color:#000;border:2px solid #111118}.button2:hover{background-color:#111118;color:#fff}.webgl{position:fixed;top:0;left:0;outline:0}#left,#right{position:fixed;display:none;width:5%;height:100%;top:0;background-color:#6b6b6b;z-index:2;cursor:pointer}#left{left:0}#right{right:0}#left:hover,#right:hover{background-color:#848484}</style><div id=info><button class="button button2">start</button></div><div id=info2><h5 class=landtext>game by Shauna Lynch</h5><h5 class=landtext><a href=https://www.lynchbyte.com/12_tictacwoe/license_tic_tac_woe>license MIT and CC BY-SA 4.0</a></h5><br></div><div id=left></div><div id=right></div><canvas class=webgl></canvas><script type=module>const e=new ye;class t{constructor(){const e=new se(ft.nodeSize,ft.nodeSize,ft.nodeSize);for(let t=0;t<ft.edgeQty;t++)for(let n=0;n<ft.edgeQty;n++)for(let o=0;o<ft.edgeQty;o++){const r=new Me(e,ft.matNode);r.position.set(-1*(ft.offset-t),-1*(ft.offset-n),ft.offset-o),r.name=`${t+1}${n+1}${o+1}`,ft.boardGrp.add(r),ft.nodesArr.push(r)}const t=new he(ft.stickDia/2,ft.stickDia/2,ft.stickLength,20,1),o=new be({color:ft.stickCol});n(t,o,new qe(0,0,0)),n(t,o,new qe(0,0,1.57)),n(t,o,new qe(1.57,0,0))}}function n(t,n,o){const r=new ge(t,n,ft.count);r.rotation.x=o.x,r.rotation.y=o.y,r.rotation.z=o.z,r.name="Mesh Sticks";let s=0;for(let t=0;t<ft.edgeQty;t++)for(let n=0;n<ft.edgeQty-1;n++)for(let o=0;o<ft.edgeQty;o++)e.setPosition(-1*(ft.offset-t),-1*(ft.offset-n-.5),ft.offset-o),r.setMatrixAt(s,e),s++;ft.boardGrp.add(r),ft.sticksArr.push(r)}function o(){if(Mt.remove(Dt),Mt.remove(Gt),Mt.add(Dt),Mt.add(Gt),"VR"===mt.mode){var e=new ve({color:15094391}),t=(new le).setFromPoints([new qe(0,0,0),new qe(0,0,-1)]),n=new Pe(t,e);n.name="line",n.scale.z=10,Dt.add(n.clone()),Gt.add(n.clone())}Dt.addEventListener("selectstart",U),Dt.addEventListener("selectend",V),Gt.addEventListener("selectstart",U),Gt.addEventListener("selectend",V)}function r(e){const t=new le,n=[],o=[],r=[],s=[],i=[],a=[],l=[];rt.length=0;const c=12;for(let t=0;t<2e3;t++){const d=Math.random()*c-6,h=Math.random()*c-6,p=Math.random()*c-6,u=1.1*Math.random()+.02,m={x:e.r,y:e.g,z:e.b};for(let e=0;e<4;e++)n.push(t),o.push(d,h,p),a.push(u,u),l.push(m.x,m.y,m.z);r.push(0,0,1,0,1,1,0,1),s.push(-1,-1,1,-1,1,1,-1,1);const f=4*t;i.push(f+0,f+1,f+2,f+2,f+3,f+0)}t.setIndex(i),t.setAttribute("index",new He(n,1)),t.setAttribute("position",new fe(o,3)),t.setAttribute("uv",new He(r,2)),t.setAttribute("offset",new fe(s,2)),t.setAttribute("size",new fe(a,2)),t.setAttribute("color",new fe(l,3));const d=new De({vertexShader:Ze,fragmentShader:Ve,transparent:!0,blending:Te,alphaTest:.01,depthWrite:!1,uniforms:{uTime:{value:0}}}),h=new Me(t,d);h.name="Dots",Mt.add(h),rt.push(h)}class s{constructor(e,t,n){const o=new Ae({color:t});let r=new Me(e,o);r.name=n,Mt.add(r),r.position.set(0,0,4),r.visible=!1}checkForDraw(){0==ft.nodesArr.length&&E(ut.gmMode[8])}check(e){1==mt.currentPlayer&&(wt.p1ClkClndMeshNameArr.length=0,e.forEach((e=>wt.p1ClkClndMeshNameArr.push(e.name))),i(wt.p1ClkClndMeshNameArr,wt.winsTotalP1)),2==mt.currentPlayer&&(gt.p2ClkClndMeshNameArr.length=0,e.forEach((e=>gt.p2ClkClndMeshNameArr.push(e.name))),i(gt.p2ClkClndMeshNameArr,gt.winsTotalP2))}}async function i(e,t){e.length<ft.level+2&&console.log("need 3 nodes");let n=[];n=m(e,3);let o=0,r=0;e:for await(let e of n){r+=1;for await(let n of t)if(o+=1,e.sort().toString()==n.sort().toString()){mt.gameOver=!0,a(e),E(ut.gmMode[6]);break e}}2==mt.currentPlayer&&document.addEventListener("click",Z),function(){if(0==ft.nodesArr.length)return;0==mt.gameOver&&(1==mt.currentPlayer?mt.currentPlayer=2:mt.currentPlayer=1,S(),1==mt.currentPlayer&&w(2),2==mt.currentPlayer&&(w(3),f(2e3).then((()=>{26==ft.nodesArr.length?O():1==gt.p2ClkClndMeshNameArr.length?j():function(e){let t=[],n=[];for(let o=0;o<e.length;o++){t=gt.winsTotalP2.flatMap((t=>t.some((t=>t==e[o]))?[t]:[]));for(let e=0;e<t.length;e++)n.push(t[e])}0==n.length&&j();e:for(let t=0;t<n.length;t++){let o=n[t].filter((t=>!e.includes(t)));if(1==o.length){let e=o[0],t=p(""+e),n=ft.nodesArr.findIndex((t=>t.name==""+e));g(t.position.x,t.position.y,t.position.z,n,t.name);break e}t==n.length-1&&j()}}(gt.p2ClkClndMeshNameArr)}))))}()}function a(e){const t=p(e[0]);let n;n=1==mt.currentPlayer?wt.colP1:gt.colP2;const o=p(e[2]),r=new xe(t.position,o.position),s=new Be(r,3,.02,8,!1),i=new be({color:n,side:ue,wireframe:!1}),a=new Pe(s,i);ft.boardGrp.add(a)}function l(){let e=p("go1 Pl");ht.pop(e),h("go1 Pl",Rt);let t=p("go Ex Pl");ht.pop(t),h("go Ex Pl",Rt)}function c(){let e=p("exit Pl");ht.pop(e),h("exit Pl",Rt);let t=p("replay Pl");void 0!==t&&ht.pop(t),h("replay Pl",Rt);let n=p("NxtLvl Pl");void 0!==n&&ht.pop(n),h("NxtLvl Pl",Rt)}function d(){for(;ft.boardGrp.children.length;)ft.boardGrp.remove(ft.boardGrp.children[0]);if(Mt.remove(ft.boardGrp),rt.length>0&&(h("Dots",Mt),rt[0].geometry.dispose(),rt[0].material.dispose()),ft.nodesArr.length=0,ft.sticksArr.length=0,wt.p1ClkClndMeshArr.length=0,wt.p1ClkClndMeshNameArr.length=0,wt.winsTotalP1.length=0,gt.p2ClkClndMeshArr.length=0,gt.p2ClkClndMeshNameArr.length=0,gt.winsTotalP2.length=0,Rt.remove(Lt),wt.winsTotalP1.length=0,gt.winsTotalP2.length=0,wt.winsTotalP1=Pt.map((function(e){return e.slice()})),gt.winsTotalP2=Pt.map((function(e){return e.slice()})),mt.gameOver=!1,document.addEventListener("click",Z),mt.level+=1,1==mt.ARtime)return Mt.add(Ot),Ot.visible=!0,Dt.addEventListener("select",Ft),void o();N(mt.mode)}function h(e,t){let n=Mt.getObjectByName(e);t.remove(n)}function p(e){return Mt.getObjectByName(e)}class u extends Me{constructor(e,t,n,o,r,s,i,a,l,c){super(),this.url=e,this.rotX=t,this.rotY=n,this.rotZ=o,this.posX=r,this.posY=s,this.posZ=i,this.name=a,this.imagePlace=l,this.parent=c;const d=st.load(e);void 0!==lt&&(d.offset.set(1/lt*l,0),d.repeat.set(1/lt,1));const h=new ke({map:d,side:2,transparent:!0}),p=new Ee(1,1,32,32),u=new Me(p,h);u.rotation.set(this.rotX,this.rotY,this.rotZ),u.position.set(this.posX,this.posY,this.posZ),u.name=this.name,c.add(u)}}function m(e,t=e.length){return t>e.length?[]:1==t?e.map((e=>[e])):e.flatMap((n=>m(e.filter((e=>e!==n)),t-1).map((e=>[n,...e]))))}function f(e){return new Promise((t=>setTimeout(t,e)))}function w(e){at.offset.set(1/lt*e,0),at.repeat.set(1/lt,1),Lt.material=new be({map:at,side:2,transparent:!0}),Lt.material.needsUpdate=!0}function g(e,t,n,o,r){let s;s=1==mt.currentPlayer?"Player1Mesh":"Player2Mesh";const i=p(s).clone();i.position.set(e,t,n),i.visible=!0,i.name=r,ft.boardGrp.add(i),1==mt.currentPlayer?wt.p1ClkClndMeshArr.push(i):gt.p2ClkClndMeshArr.push(i),1==mt.currentPlayer?vt(...[,,1675,,.06,.24,1,1.82,,,837,.06]):vt(...[2,.8,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22]),1==mt.currentPlayer?Ct.check(wt.p1ClkClndMeshArr):Et.check(gt.p2ClkClndMeshArr),ft.boardGrp.remove(ft.nodesArr[o]);let a;ft.nodesArr.splice(o,1);1==mt.currentPlayer?Ct.checkForDraw():Et.checkForDraw(),a=1==mt.currentPlayer?gt.winsTotalP2:wt.winsTotalP1;let l=a.flatMap((e=>e.some((e=>e==""+r))?[e]:[]));for(let e=0;e<a.length;e++)for(let t=0;t<l.length;t++)a[e]===l[t]&&a.splice(e,1)}function P(){const e=mt.level+1,t=27-e,n=[];for(var o=[];o.length<e;){var r=Math.floor(Math.random()*t)+1;-1===o.indexOf(r)&&o.push(r)}const s=new Me(new ze(.1,8,8),new ke({color:1710618,wireframe:!0}));for(let e=0;e<o.length;e++){let t=o[e];n.push(ft.nodesArr[t].name);const r=s.clone();ft.boardGrp.add(r),r.position.copy(ft.nodesArr[t].position)}let i=[],a=[];for(let e=0;e<n.length;e++){h(""+n[e],ft.boardGrp);const t=ft.nodesArr.findIndex((t=>t.name==""+n[e]));ft.nodesArr.splice(t,1);a=gt.winsTotalP2.flatMap((t=>t.some((t=>t==n[e]))?[]:[t])),gt.winsTotalP2=a.map((function(e){return e.slice()})),i=wt.winsTotalP1.flatMap((t=>t.some((t=>t==n[e]))?[]:[t])),wt.winsTotalP1=i.map((function(e){return e.slice()}))}}let v,x,y,M,b,A,k,T;const C=[];function E(e){switch(e){case"AA":new u(it,0,Math.PI/180*0,0,-1.25,-1.25,100,"Land Pl",0,Mt);const e=p("Land Pl");e.scale.set(.8,.8,.8),ct.push(e);let n=.3;for(let t=0;t<3;t++)for(let o=0;o<3;o++){const r=e.clone();r.position.set(1*o-1,1*t-1+n,-4),r.name="Landing Plane",Mt.add(r),ct.push(r)}const o=ct[3];at.offset.set(1/lt*1,0),at.repeat.set(1/lt,1),o.material=new ke({map:at,side:2,transparent:!0}),o.material.needsUpdate=!0;const s=new oe(ct[1]),i=new re;i.add(ct[3],ct[5]);const a=new oe(i),c=new oe(ct[2]),d=new oe(ct[4]),m=new oe(ct[9]),g=new oe(ct[6]),S=new oe(ct[8]);dt.push(s,a,c,d,m,g,S);const I=new qe(0,1,0),L=(new Se).setFromAxisAngle(I,0),R=(new Se).setFromAxisAngle(I,Math.PI),N=new Ie(".quaternion",[0,1,2],[L.x,L.y,L.z,L.w,R.x,R.y,R.z,R.w,L.x,L.y,L.z,L.w]),D=new qe(0,0,1),G=(new Se).setFromAxisAngle(D,0),z=(new Se).setFromAxisAngle(D,Math.PI),j=new Ie(".quaternion",[0,1,2],[G.x,G.y,G.z,G.w,z.x,z.y,z.z,z.w,G.x,G.y,G.z,G.w]),F=new Xe(".scale",[0,1,2],[.8,.8,.8,.1,.1,.1,.8,.8,.8]),B=new ne("Action",12,[N]),H=s.clipAction(B),W=new ne("Action",9,[N]),q=a.clipAction(W),X=new ne("Action",6,[N]),Q=c.clipAction(X),Y=new ne("Action",15,[j]),U=d.clipAction(Y),V=m.clipAction(Y),$=new ne("Action",18,[F]),_=g.clipAction($),J=S.clipAction($);f(250).then((()=>{H.play()})),f(750).then((()=>{q.play()})),Q.play(),f(2e3).then((()=>{U.play()})),f(6300).then((()=>{V.play()})),f(800).then((()=>{_.play()})),f(1200).then((()=>{J.play()}));break;case"BB":Mt.add(Rt),document.removeEventListener("click",jt);for(let e=0;e<ct.length;e++)h(ct[e].name,Mt);new u(it,0,Math.PI/180*0,0,0,1.25,.002,"Desktop Pl",6,Rt);v=p("Desktop Pl"),ht.push(v),async function(){if("xr"in navigator){const e=await navigator.xr.isSessionSupported("immersive-vr");if(e){new u(it,0,Math.PI/180*0,0,0,0,.002,"vr Pl",7,Rt);let e=p("vr Pl");ht.push(e)}if(!e){new u(it,0,Math.PI/180*0,0,0,0,.002,"vr Not Pl",9,Rt)}const t=await navigator.xr.isSessionSupported("immersive-ar");if(t){new u(it,0,Math.PI/180*0,0,0,-1.25,.002,"ar Pl",8,Rt);let e=p("ar Pl");ht.push(e)}if(!t){new u(it,0,Math.PI/180*0,0,0,-1.25,.002,"ar Not Pl",10,Rt)}}}();break;case"CC":!function(){let e=p("Desktop Pl");ht.pop(e),h("Desktop Pl",Rt);let t=p("vr Pl");ht.pop(t),h("vr Pl",Rt);let n=p("ar Pl");ht.pop(n),h("ar Pl",Rt),h("vr Not Pl",Rt),h("ar Not Pl",Rt);const o=document.getElementById("info2");o.parentNode.removeChild(o)}();new u(it,0,Math.PI/180*0,0,-1.25,0,.002,"go1 Pl",11,Rt),new u(it,0,Math.PI/180*0,0,1.25,0,.002,"go Ex Pl",12,Rt);x=p("go1 Pl"),ht.push(x),y=p("go Ex Pl"),ht.push(y);break;case"DD":!function(){l(),document.getElementById("left").style.display="block",document.getElementById("right").style.display="block",Rt.add(Lt);new t;Mt.add(ft.boardGrp),ft.boardGrp.position.set(0,0,-4),ft.boardGrp.rotation.set(Math.PI/180*5,0,0),mt.uiTime=!1,f(1e3).then((()=>{1==mt.Extreme?(P(),O()):vt(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07])}))}();break;case"EE":!function(){l(),vt(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07]),Rt.add(Lt);new t;Mt.add(ft.boardGrp),ft.boardGrp.position.set(0,-.25,-4),mt.uiTime=!1;new u(it,0,Math.PI/180*0,0,-3,-2,.002,"arw L Pl",13,Rt);k=p("arw L Pl"),C.push(k);new u(it,0,Math.PI/180*0,0,3,-2,.002,"arw R Pl",14,Rt);T=p("arw R Pl"),C.push(T),f(1e3).then((()=>{1==mt.Extreme&&(P(),O())}))}();break;case"FF":mt.mode="AR",l(),vt(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07]),Rt.add(Lt);break;case"GG":mt.gameOver=!0,mt.uiTime=!0;let K,ee=p("life"+mt.level);if(1==mt.currentPlayer){if(vt(...[,,80,.3,.4,.7,2,.1,-.73,3.42,-430,.09,.17,,,,.19]),r(wt.colP1),1==mt.Extreme){const e=p("Heart Pl").clone();Rt.add(e),e.position.copy(ee.position),e.translateZ(.001)}}else if(vt(...[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6]),r(gt.colP2),1==mt.Extreme){const e=p("RIP Pl").clone();Rt.add(e),e.position.copy(ee.position),e.translateZ(.001),mt.match+=1}void 0!==ee&&ee.scale.set(.001,.001,.001),K=1==mt.currentPlayer?2:3,w(K),f(2500).then((()=>{E(ut.gmMode[7])}));break;case"HH":document.addEventListener("click",Z);new u(it,0,Math.PI/180*0,0,-3,1,.002,"exit Pl",17,Rt);if(M=p("exit Pl"),ht.push(M),7===mt.level&&1==mt.Extreme){new u(it,0,Math.PI/180*0,0,-3,-.25,.002,"Game Over Plane",21,Rt)}else if(0==mt.Extreme){new u(it,0,Math.PI/180*0,0,-3,-.25,.002,"replay Pl",19,Rt);b=p("replay Pl"),ht.push(b)}else{new u(it,0,Math.PI/180*0,0,-3,-.25,.002,"NxtLvl Pl",20,Rt);A=p("NxtLvl Pl"),ht.push(A)}h("Stat Brd",Rt),h("Draw Plane",Rt);break;case"II":mt.gameOver,mt.uiTime=!0,h("Stat Brd",Rt);new u(it,0,Math.PI/180*0,0,-3,0,.002,"Draw Plane",18,Rt);if(vt(...[,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17]),1==mt.Extreme){let e=p("life"+mt.level);const t=p("Draw Pl2"),n=t.clone();n.clone(t),Rt.add(n),n.position.copy(e.position),n.translateZ(.001),mt.match+=1,void 0!==e&&e.scale.set(.001,.001,.001)}f(2500).then((()=>{E(ut.gmMode[7])}));break;default:console.log("dflt")}}function S(){1==mt.currentPlayer?Lt.position.set(-3,1.1,0):Lt.position.set(-3,-.7,0)}function I(e){if(0!=e.length&&e.length>0&&(document.removeEventListener("click",Z),0==mt.gameOver)){let t=e[0].object,n=ft.nodesArr.findIndex((t=>t===e[0].object));g(t.position.x,t.position.y,t.position.z,n,t.name)}}function L(e){if(0!=e.length&&e.length>0){switch(e[0].object.name){case"Desktop Pl":mt.mode="DT",async function(){await document.body.requestFullscreen();try{await screen.orientation.lock("landscape")}catch(e){console.log(e)}bt=70,At.fov=70,At.updateProjectionMatrix()}(),E(ut.gmMode[2]);break;case"vr Pl":mt.mode="VR",J("immersive-vr"),o(),function(){const e=new Ee(2,2,32,32),t=new De({vertexShader:_e,fragmentShader:Ke,transparent:!0}),n=new Me(e,t);n.rotation.set(Math.PI/180*-90,0,0),n.position.set(0,-1,0);const o=n.clone();Mt.add(n,o)}(),E(ut.gmMode[2]);break;case"ar Pl":mt.mode="AR",J("immersive-ar"),Mt.background=null,h("Sphere",Mt),o(),E(ut.gmMode[2]);break;case"go1 Pl":w(2),N(mt.mode),Mt.add(Tt);break;case"go Ex Pl":R(),Mt.add(Tt),function(){new u(it,0,Math.PI/180*0,0,-1.5,2.5,-.2,"life1",1,Rt);const e=p("life1");for(let t=0;t<6;t++){e.scale.set(.35,.35,.35);const n=e.clone();let o=.5;n.position.set(-1.5+o+t*o,2.5,-.2),n.name="life"+(t+2),n.material.opacity=.4,Rt.add(n)}const t=new Ee(.35,.35,32,32),n=at.clone();n.offset.set(1/lt*15,0),n.repeat.set(1/lt,1);const o=new Ae({map:n,side:2,transparent:!0}),r=new Me(t,o);r.position.set(0,0,100),Mt.add(r),r.name="Heart Pl";const s=at.clone();s.offset.set(1/lt*16,0),s.repeat.set(1/lt,1);const i=new Ae({map:s,side:2,transparent:!0}),a=new Me(t,i);a.position.set(0,0,100),Mt.add(a),a.name="RIP Pl";const l=at.clone();l.offset.set(1/lt*18,0),l.repeat.set(1/lt,1);const c=new Ae({map:l,side:2,transparent:!0}),d=new Me(t,c);d.position.set(0,0,100),Mt.add(d),d.name="Draw Pl2"}(),N(mt.mode);break;case"replay Pl":f(750).then((()=>{c(),mt.currentPlayer=1,d(),S(),w(2)}));break;case"NxtLvl Pl":f(750).then((()=>{c(),d()})),f(1e3).then((()=>{R()}));break;case"exit Pl":location.reload();break;default:console.log("dflt")}}}function R(){vt(...[,.9,1306,.8,.08,.02,1,,,,,,.48,,-.1,.11,.25]),mt.currentPlayer=2,mt.Extreme=!0,w(3),S()}function N(e){switch(e){case"DT":E(ut.gmMode[3]);break;case"VR":E(ut.gmMode[4]);break;case"AR":mt.ARtime=!0,E(ut.gmMode[5])}}const D=new be({color:new de(16767346)});function G(e){if(1==e.length)e[0].object.material.emissive.r=.6,e[0].object.material.emissive.g=.5;else for(let e=0;e<ht.length;e++)ht[e].material.emissive.r=0,ht[e].material.emissive.g=0}function z(e){if(1==e.length){e[0].object.material=D}else for(let e=0;e<ft.nodesArr.length;e++)ft.nodesArr[e].material=ft.matNode}function O(){const e=["111","113","131","133","311","313","331","333"];let t=[];t=ft.nodesArr.slice();const n=[];t.forEach((e=>n.push(e.name)));const o=n.filter((t=>-1!==e.indexOf(t)));let r=o[Math.floor(Math.random()*o.length)];const s=p(""+r);let i=ft.nodesArr.findIndex((e=>e.name==""+r));g(s.position.x,s.position.y,s.position.z,i,s.name)}function j(){let e,t,n,o,r,s=m(wt.p1ClkClndMeshNameArr,2);for(let i=0;i<s.length;i++){let a=wt.winsTotalP1.flatMap((e=>e.some((e=>e==s[i][0]))?[e]:[])).flatMap((e=>e.some((e=>e==s[i][1]))?[e]:[]));if(a.length>0){let l=a[0];t=s[i][0],n=s[i][1];const c=[t,n];if(o=l.filter((e=>!c.includes(e))),r=p(""+o),null==r)return void F();if(r.parent==ft.boardGrp){e=l;break}}}if(void 0!==e){const e=ft.nodesArr.findIndex((e=>e.name==""+o));g(r.position.x,r.position.y,r.position.z,e,r.name)}null==e&&function(e){let t=[],n=[];for(let o=0;o<e.length;o++){t=gt.winsTotalP2.flatMap((t=>t.some((t=>t==e[o]))?[t]:[]));for(let e=0;e<t.length;e++)n.push(t[e])}0==n.length&&F();for(let t=0;t<n.length;t++){let o=n[t].filter((t=>!e.includes(t)))[0],r=p(""+o),s=ft.nodesArr.findIndex((e=>e.name==""+o));return void g(r.position.x,r.position.y,r.position.z,s,r.name)}}(gt.p2ClkClndMeshNameArr)}function F(){let e=Math.floor(Math.random()*ft.nodesArr.length);const t=p(""+ft.nodesArr[e].name);g(t.position.x,t.position.y,t.position.z,e,t.name)}const B=new We(1,1),H=new Le,W=new Le,q=[],X=new ye;let Q;function Y(e){ft.boardGrp.rotateY(.025*e)}function Z(e){if(e.preventDefault(),B.x=e.clientX/window.innerWidth*2-1,B.y=-e.clientY/window.innerHeight*2+1,H.setFromCamera(B,At),1==mt.uiTime){L(H.intersectObjects(ht))}else{I(H.intersectObjects(ft.nodesArr))}}function U(e){var t=_(e.target);1==mt.uiTime?L(t):I(t)}function V(e){}function $(e){if(void 0!==e.userData.selected)return;let t=_(e);1==mt.uiTime?G(t):z(t)}function _(e){X.identity().extractRotation(e.matrixWorld),W.ray.origin.setFromMatrixPosition(e.matrixWorld),W.ray.direction.set(0,0,-1).applyMatrix4(X);const t=W.intersectObjects(C,!1);return t.length>0&&("arw L Pl"==t[0].object.name&&(Q=-1,Y(Q)),"arw R Pl"==t[0].object.name&&(Q=1,Y(Q))),1==mt.uiTime?W.intersectObjects(ht,!1):W.intersectObjects(ft.nodesArr,!1)}async function J(e){try{if("immersive-ar"==e){K(await navigator.xr.requestSession(e,{requiredFeatures:["hit-test"]}))}else{K(await navigator.xr.requestSession(e))}}catch(e){alert("Failed to start Web XR session.",e)}}async function K(e){e.addEventListener("end",ee),Nt.xr.setReferenceSpaceType("local"),await Nt.xr.setSession(e)}function ee(){console.log("xr End")}import{AmbientLight as te,AnimationClip as ne,AnimationMixer as oe,AnimationObjectGroup as re,BoxBufferGeometry as se,BoxGeometry as ie,BufferAttribute as ae,BufferGeometry as le,Clock as ce,Color as de,CylinderGeometry as he,DirectionalLight as pe,DoubleSide as ue,ExtrudeGeometry as me,Float32BufferAttribute as fe,Group as we,InstancedMesh as ge,Line as Pe,LineBasicMaterial as ve,LineCurve3 as xe,Matrix4 as ye,Mesh as Me,MeshBasicMaterial as be,MeshPhongMaterial as Ae,MeshStandardMaterial as ke,NormalBlending as Te,PerspectiveCamera as Ce,PlaneGeometry as Ee,Quaternion as Se,QuaternionKeyframeTrack as Ie,Raycaster as Le,RingGeometry as Re,Scene as Ne,ShaderMaterial as De,Shape as Ge,SphereGeometry as ze,sRGBEncoding as Oe,TextureLoader as je,TorusGeometry as Fe,TubeBufferGeometry as Be,Uint16BufferAttribute as He,Vector2 as We,Vector3 as qe,VectorKeyframeTrack as Xe,WebGLRenderer as Qe}from"/2022/webxr/three.js";const Ye=await fetch("m/sh/go/vert.glsl"),Ze=await Ye.text(),Ue=await fetch("m/sh/go/frag.glsl"),Ve=await Ue.text(),$e=await fetch("m/sh/fl/vert.glsl"),_e=await $e.text(),Je=await fetch("m/sh/fl/frag.glsl"),Ke=await Je.text(),et=await fetch("m/sh/sph/vert.glsl"),tt=await et.text(),nt=await fetch("m/sh/sph/frag.glsl"),ot=await nt.text(),rt=[],st=new je,it="m/all_ui_22.webp",at=st.load(it),lt=22,ct=[],dt=[],ht=[],pt=[],ut={gmMode:["AA","BB","CC","DD","EE","FF","GG","HH","II"]},mt={currentPlayer:1,uiTime:!0,gameOver:!1,ARtime:!1,Extreme:!1,mode:"DT",level:1},ft={boardGrp:new we,edgeQty:3,count:Math.pow(3,3),offset:1,matNode:new ke({color:new de(1315871),transparent:!0}),nodesArr:[],sticksArr:[],nodeSize:.1,stickLength:.8,stickDia:.01,stickCol:0},wt={p1ClkClndMeshArr:[],geoP1:new Fe(.19,.1,16,100),colP1:new de(4919815),p1ClkClndMeshNameArr:[],winsTotalP1:[]},gt={p2ClkClndMeshArr:[],geoP2:function(){const e=.2,t=.1,n=(new Ge).moveTo(0,e).lineTo(e,e).lineTo(e,0).lineTo(e+t,0).lineTo(e+t,e).lineTo(.5,e).lineTo(.5,e+t).lineTo(e+t,e+t).lineTo(e+t,.5).lineTo(e,.5).lineTo(e,e+t).lineTo(0,e+t),o=new me(n,{steps:4,depth:.1,bevelEnabled:!0,bevelThickness:.05,bevelSize:.02,bevelOffset:0,bevelSegments:4});return o.center(),o.rotateZ(Math.PI/4),o}(),colP2:new de(3027743),p2ClkClndMeshNameArr:[],winsTotalP2:[]},Pt=[],vt=(e=1,t=.05,n=220,o=0,r=0,s=.1,i=0,a=1,l=0,c=0,d=0,h=0,p=0,u=0,m=0,f=0,w=0,g=2*Math.PI,P=44100,v=(e=>2*e*Math.random()-e),x=(e=>0<e?1:-1),y=(l*=500*g/P**2),M=(n*=(1+v(t))*g/P),b=x(m)*g/4,A=[],k=0,T=0,C=0,E=1,S=0,I=0,L=0,R,N,D=xt.createBufferSource())=>{for(c*=500*g/P**3,R=(o=50+o*P|0)+(r=r*P|0)+(s=s*P|0)+(w=w*P|0),m*=g/P,d*=g/P,h*=P,p*=P;C<R;A[C++]=L)++I>100*f&&(I=0,L=k*n*Math.sin(T*m-b),L=i?1<i?2<i?3<i?x(Math.sin((L%g)**3)):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/g%2+2)%2:1-4*Math.abs(Math.round(L/g)-L/g):Math.sin(L),L=x(L)*Math.abs(L)**a,L*=.3*e*(C<o?C/o:C<o+r?1:C<R-w?1-(C-o-r)/s:0),L=w?L/2+(w>C?0:(C<R-w?1:(C-R)/w)*A[C-w]/2):L),k+=1+v(u),T+=1+v(u),n+=l+=c,E&&++E>h&&(M+=d,n+=d,E=0),p&&++S>p&&(n=M,l=y,S=1,E=E||1);(N=xt.createBuffer(1,A.length,P)).getChannelData(0).set(A),D.buffer=N,D.connect(xt.destination),D.start()},xt=new AudioContext,yt=new ce,Mt=new Ne;let bt;Mt.background=new de(12698307),bt=window.innerWidth<window.innerHeight?100:70;const At=new Ce(bt,window.innerWidth/window.innerHeight,.01,20);Mt.add(At);const kt=new te(16777215,.7);Mt.add(kt);const Tt=new pe(16777215,.65);Tt.position.set(.75,.75,1).normalize(),function(){const e=new ze(15,32,16),t=new De({vertexShader:tt,fragmentShader:ot,transparent:!0,side:2,uniforms:{uTime:{value:0}}}),n=new Me(e,t);n.name="Sphere",n.rotation.set(0,Math.PI/180*90,0),Mt.add(n),pt.push(n)}();const Ct=new s(wt.geoP1,wt.colP1,"Player1Mesh"),Et=new s(gt.geoP2,gt.colP2,"Player2Mesh");at.offset.set(1/lt*2,0),at.repeat.set(1/lt,1);const St=new be({map:at,side:2,transparent:!0}),It=new Ee(1,1,32,32),Lt=new Me(It,St);Lt.position.set(-3,1.1,.002),Lt.name="Stat Brd";const Rt=new Me(new Ee(.011,.011),new be({transparent:!0,opacity:0}));Rt.position.set(0,0,-4.1);const Nt=new Qe({antialias:!0,alpha:!0});Nt.setPixelRatio(Math.max(window.devicePixelRatio,1.5)),Nt.setSize(window.innerWidth,window.innerHeight),Nt.xr.enabled=!0,Nt.outputEncoding=Oe,document.body.appendChild(Nt.domElement);const Dt=Nt.xr.getController(0),Gt=Nt.xr.getController(1),zt={hitTestSource:null,hitTestSourceRequested:!1},Ot=new Me(new Re(.15,.2,32).rotateX(-Math.PI/2),new be);function jt(){const e=document.getElementById("info");null!==e&&e.parentNode.removeChild(e),f(750).then((()=>{E(ut.gmMode[1]);document.getElementById("info2").style.display="flex"}))}function Ft(){if(Ot.visible){new t;Mt.add(ft.boardGrp),ft.boardGrp.position.setFromMatrixPosition(Ot.matrix),ft.boardGrp.translateY(.5),ft.boardGrp.scale.set(.25,.25,.25),Rt.add(Lt),mt.uiTime=!1;var e=p("Reticle");if(Mt.remove(e),Dt.removeEventListener("select",Ft),1!=mt.Extreme)return;P(),O()}}Ot.matrixAutoUpdate=!1,Ot.visible=!1,Ot.name="Reticle",Mt.add(Ot),function(){const e=[],t=[],n=[];for(let o=1;o<ft.edgeQty+1;o++)for(let r=1;r<ft.edgeQty+1;r++)for(let s=1;s<ft.edgeQty+1;s++){let i=[],a=[],l=[];i.push(""+o+r+s),a.push(""+o+s+r),l.push(""+s+o+r),e.push(i),t.push(a),n.push(l)}for(let t=0;t<e.length;t+=3){const n=e.slice(t,t+3).flat();Pt.push(n)}for(let e=0;e<t.length;e+=3){const n=t.slice(e,e+3).flat();Pt.push(n)}for(let e=0;e<n.length;e+=3){const t=n.slice(e,e+3).flat();Pt.push(t)}const o=[];o.push(["111","221","331"].sort(),["311","221","131"].sort(),["112","222","332"].sort(),["312","222","132"].sort(),["113","223","333"].sort(),["313","223","133"].sort(),["111","212","313"].sort(),["311","212","113"].sort(),["121","222","323"].sort(),["321","222","123"].sort(),["131","232","333"].sort(),["331","232","133"].sort(),["111","122","133"].sort(),["113","122","131"].sort(),["211","222","233"].sort(),["213","222","231"].sort(),["311","322","333"].sort(),["313","322","331"].sort()),o.forEach((function(e){Pt.push(e)})),Pt.push(["111","222","333"].sort(),["311","222","133"].sort(),["131","222","313"].sort(),["331","222","113"].sort()),Pt.sort(),wt.winsTotalP1=Pt.map((function(e){return e.slice()})),gt.winsTotalP2=Pt.map((function(e){return e.slice()}))}(),E(ut.gmMode[0]),window.addEventListener("resize",(function(){if(1==mt.ARtime)return;bt=window.innerWidth<window.innerHeight?100:70;At.fov=bt,At.aspect=window.innerWidth/window.innerHeight,At.updateProjectionMatrix(),Nt.setSize(window.innerWidth,window.innerHeight)})),document.addEventListener("click",jt),document.addEventListener("mousemove",(function(e){if(e.preventDefault(),B.x=e.clientX/window.innerWidth*2-1,B.y=-e.clientY/window.innerHeight*2+1,null!=mt.currentPlayer){if(H.setFromCamera(B,At),1==mt.uiTime){G(H.intersectObjects(ht))}else{z(H.intersectObjects(ft.nodesArr))}e.clientX<.05*window.innerWidth&&(Q=-1,Y(Q)),e.clientX>.95*window.innerWidth&&(Q=1,Y(Q))}})),document.addEventListener("click",Z),Nt.xr.addEventListener("sessionstart",(function(e){console.log("XR sess start")})),Nt.xr.addEventListener("sessionend",(function(e){console.log("XR sess end")})),Dt.addEventListener("select",Ft),Nt.setAnimationLoop(Bt);function Bt(e,t){const n=yt.getDelta(),o=yt.getElapsedTime();pt.length>0&&(pt[0].material.uniforms.uTime.value=o),10==ct.length&&dt.forEach((e=>e.update(1*n))),1==mt.gameOver&&rt.length>0&&(rt[0].material.uniforms.uTime.value=600*o),!0!==mt.ARtime&&ft.boardGrp.rotateY(.025*n);let r=Nt.xr.getSession();null!==r&&(!function(){for(;q.length;)q.pop().material.emissive.g=0}(),$(Dt),r.inputSources.length>1&&$(Gt)),!0===mt.ARtime&&(!1===zt.hitTestSourceRequested&&async function(){const e=Nt.xr.getSession();if(null!==e){e.addEventListener("end",(()=>{zt.hitTestSourceRequested=!1,zt.hitTestSource=null}));const t=await e.requestReferenceSpace("viewer");zt.hitTestSource=await e.requestHitTestSource({space:t}),zt.hitTestSourceRequested=!0}}(),zt.hitTestSource&&function(e){if(null!==e){const t=e.getHitTestResults(zt.hitTestSource);if(t.length){const e=t[0].getPose(Nt.xr.getReferenceSpace());Ot.visible=!0,Ot.matrix.fromArray(e.transform.matrix)}else Ot.visible=!1}}(t)),Nt.render(Mt,At)}</script>