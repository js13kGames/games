<!doctype html><meta name=viewport content="width=device-width"><title>Lazy Claws - js13kGames 2025</title><style>body,html{background-color:#000;margin:0;padding:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center}#app{box-shadow:0 0 1px #000}</style><script></script><canvas width=768 height=576 id=app></canvas><script>zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),s=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map((t,e)=>s.getChannelData(e).set(t)),e.buffer=s,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,s=220,i=0,n=0,h=.1,r=0,o=1,a=0,l=0,c=0,d=0,f=0,p=0,u=0,w=0,m=0,g=1,x=0,y=0)=>{let b,v,M=2*Math.PI,z=a*=500*M/zzfxR**2,S=(0<u?1:-1)*M/4,P=s*=(1+2*e*Math.random()-e)*M/zzfxR,k=[],R=0,C=0,D=0,T=1,E=0,j=0,L=0;for(i=99+zzfxR*i,x*=zzfxR,n*=zzfxR,h*=zzfxR,m*=zzfxR,l*=500*M/zzfxR**3,u*=M/zzfxR,c*=M/zzfxR,d*=zzfxR,f=zzfxR*f|0,v=i+x+n+h+m|0;D<v;k[D++]=L)++j%(100*w|0)||(L=r?1<r?2<r?3<r?Math.sin((R%M)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/M%2+2)%2:1-4*Math.abs(Math.round(R/M)-R/M):Math.sin(R),L=(f?1-y+y*Math.sin(2*Math.PI*D/f):1)*(0<L?1:-1)*Math.abs(L)**o*t*zzfxV*(D<i?D/i:D<i+x?1-(D-i)/x*(1-g):D<i+x+n?g:D<v-m?(v-D-m)/h*g:0),L=m?L/2+(m>D?0:(D<v-m?1:(v-D)/m)*k[D-m|0]/2):L),b=(s+=a+=l)*Math.sin(C*u-S),R+=b-b*p*(1-1e9*(Math.sin(D)+1)%2),C+=b-b*p*(1-1e9*(Math.sin(D)**2+1)%2),T&&++T>d&&(s+=c,P+=c,T=0),!f||++E%f||(s=P,a=z,T=T||1);return k},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(t,e,s,i=125)=>{let n,h,r,o,a,l,c,d,f,p,u,w,m,g,x,y=0,b=[],v=[],M=[],z=0,S=0,P=1,k={},R=zzfxR/i*60>>2;for(;P;z++)b=[P=d=u=m=0],s.map((i,u)=>{for(c=e[i][z]||[0,0,0],P|=!!e[i][z],x=m+(e[i][0].length-2-!d)*R,g=u==s.length-1,h=2,o=m;h<c.length+g;d=++h){for(a=c[h],f=h==c.length+g-1&&g||p!=(c[0]||0)|a|0,r=0;r<R&&d;r++>R-99&&f?w+=(w<1)/99:0)l=(1-w)*b[y++]/2||0,v[o]=(v[o]||0)-l*S+l,M[o]=(M[o++]||0)+l*S+l;a&&(w=a%1,S=c[1]||0,(a|=0)&&(b=k[[p=c[y=0]||0,a]]=k[[p,a]]||(n=[...t[p]],n[2]*=2**((a-12)/12),a>0?zzfxG(...n):[])))}m=x});return[v,M]};const t=zzfxM(...[[[.25,0,,,,,3,0,,,320,,,4],[.25,0,137,.02,.2,.55,2,.41,,,.1],[.25,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.25,0,209,,.02,.25,3],[.25,0,800,,,.075,2,2,,,1e3,-.01,.02,4.8,-.3,,.065],[.25,0,219,,,,,1.1,,-.1,-50,-.05,-.01,1],[.25,0,52,,,.2,2,,,,.5,.01],[.25,0,22,,.07,.07,2,0,,,.5,.01]],[[[2,-1,20,,,,20,,,,20,,,,20,,,,20,,,,20,,,,20,,,,20,20,,20,20,,,,20,,,,20,,,,20,,,,20,,,,20,,,,20,20,,,20,20,20,20],[1,1,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,9,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,-1,13,13,16,8,16,13,20,16,8,4,8,16,13,20,25,13,13,13,16,8,16,13,20,16,8,4,8,16,13,20,25,13,9,9,16,9,4,9,21,16,21,25,23,21,28,25,23,21,9,9,21,16,4,21,13,16,21,4,9,9,33,28,25,21],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,],[4,-1,,,,34,,,,34,,,,34,,,,34,,,,30,,,,34,,,,34,,,15,,,,,34,,,,34,,,,34,,,,34,,,,34,,,,34,,,15,20,,,,,],[,1,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,22,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,22]],[[2,-1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[1,1,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,21,,,,,,,,,,,,,,,,,,,,,,,,25,,,,,,,,],[6,1,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,],[4,-1,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24,,24,24,24],[5,-1,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,,,,,,22,,,,]]],[0,0,1,1],,{instruments:["claps1","analogstring","bassdrum2","nice","hihat2","popsnare2","monobass","smash1"],patterns:["Pattern 0","Pattern 1"]}]);window.zzfxP(...t).loop=!0;class e{canvas;emitter;state=new Map;x=0;y=0;constructor(t,e){this.canvas=t,this.emitter=e}onKeyDown=t=>{this.state.set(t.code,!0)," "===t.key&&this.emitter.emit("space")};onKeyUp=t=>{this.state.set(t.code,!1)};onMouseMove=t=>{const e=this.canvas.getBoundingClientRect();this.x=t.clientX-e.left,this.y=t.clientY-e.top};onMouseDown=t=>{0===t.button?this.emitter.emit("mouseDownLeft"):2===t.button&&this.emitter.emit("mouseDownRight")};onMouseUp=t=>{0===t.button?this.emitter.emit("mouseUpLeft"):2===t.button&&this.emitter.emit("mouseUpRight")};onContextMenu=t=>{t.preventDefault()};init(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("contextmenu",this.onContextMenu),this.canvas.addEventListener("mousemove",this.onMouseMove)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("mousemove",this.onMouseMove)}}class s{listeners={};on(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),()=>{this.off(t,e)}}emit(t,...e){if(this.listeners[t])for(const s of this.listeners[t])s(...e)}off(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(t=>t!==e))}}class i{x;y;constructor(t,e){this.x=t,this.y=e}static radian(t){return new i(Math.sin(t),Math.cos(t)).norm()}static random(t){return new i(2*t.next()-1,2*t.next()-1).norm()}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}equal(t){return this.x===t.x&&this.y===t.y}empty(){return this.equal(new i(0,0))}scale(t){return new i(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}len(){return Math.hypot(this.x,this.y)}norm(){const t=this.len();return 0!==t?new i(this.x/t,this.y/t):new i(0,0)}normal(t){const e=t.sub(this);return new i(-e.y,e.x).norm()}dist(t){return this.sub(t).len()}clone(){return new i(this.x,this.y)}perpendicular(){return new i(-this.y,this.x)}negate(){return this.scale(-1)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new i(this.x*e-this.y*s,this.x*s+this.y*e)}}function n(t,e,s,i){const n=i.sub(s),h=t.sub(s),r=Math.max(0,Math.min(1,h.dot(n)/n.dot(n))),o=s.add(n.scale(r));return t.dist(o)<=e}function h(t,e,s){return t.dist(s)<=e}class r{p;d;game;speed;angle=0;c=0;constructor(t,e,s,i=4){this.p=t,this.d=e,this.game=s,this.speed=i}update(){const t=this.game.scene;if(!t)return;this.speed<1.5?this.speed*=.992:this.speed*=.9985;const e=this.p.add(this.d.scale(this.speed));let s=!1;for(const i of t.allEntities)for(const[t,r]of i.lines){if(n(e,4,t,r)){const e=t.normal(r);this.d=this.d.reflect(e).norm(),s=!0}if(h(e,4,t)||h(e,4,r)){const i=e.sub(t).norm();this.d=this.d.reflect(i).norm(),s=!0}}s?(this.speed>.25&&this.game.sound.playEffect("blip"),this.speed*=.95,this.p=this.p.add(this.d.scale(this.speed))):this.p=e,this.c+=1,10===this.c&&(this.c=0,this.speed>.5&&(this.angle=(this.angle+1)%4))}draw(t){const e=this.p.x,s=this.p.y;t.save(),t.translate(e,s+6+2),t.scale(1,.6);const i=t.createRadialGradient(0,0,0,0,0,12);i.addColorStop(0,"rgba(0,0,0,0.25)"),i.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=i,t.beginPath(),t.ellipse(0,0,12,4,0,0,2*Math.PI),t.fill(),t.restore();const n=this.angle*(Math.PI/2),h=2.5*Math.cos(n),r=2.5*Math.sin(n),o=t.createRadialGradient(e+h,s+r,0,e,s,6);o.addColorStop(0,"#ffffff"),o.addColorStop(.25,"#c67575ff"),o.addColorStop(.55,"#781f1fff"),o.addColorStop(1,"#bd2020ff"),t.fillStyle=o,t.beginPath(),t.arc(e,s,6,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255,255,255,0.85)",t.beginPath(),t.arc(e+h,s+r,1,0,2*Math.PI),t.fill()}}class o{game;ball;constructor(t){this.game=t,this.ball=new r(new i(734,46),new i(0,0),t,0)}draw(t){const e=(this.game.scene.timeLeft/1e3).toFixed(2);t.beginPath(),t.fillStyle="#000000",t.fillRect(700,0,60,60),t.font="16px monospace",t.fillStyle="#ffffff",t.fillText(`${e}s`,730,16),this.ball.draw(t),t.fillStyle="#ffffff",t.fillText(`${this.game.player?.balls??0}`,754,40),t.closePath()}}class a{p;w;h;s;hp;dir;game;constructor(t,e,s,n,h,r){this.p=t,this.w=e,this.h=s,this.s=n,this.hp=h,this.game=r,this.dir=new i(0,0)}wouldCollide(t){const e=this.game.scene;if(!e)return!1;for(const s of e.allEntities)if(s.intersect(t,Math.max(this.w,this.h)))return!0;return!1}update(t=!1){if(0===this.s)return;const e=this.dir.scale(this.s),s=this.p.add(new i(e.x,0)),n=this.p.add(new i(0,e.y)),h=this.p.add(e);if(t)if(this.wouldCollide(h)){let t=!1;this.wouldCollide(s)||(this.p=s,t=!0),this.wouldCollide(n)||(this.p=n,t=!0),t||(this.p=this.p)}else this.p=h;else this.wouldCollide(h)||(this.p=h)}}class l{g;c;i;f;sx;sy;w;h;timer;index;finished=!1;constructor(t,e,s,i,n,h,r,o){this.g=h??0,this.c=n??1,this.i=r??1/0,this.f=o??1===this.c,this.sx=t,this.sy=e,this.w=s,this.h=i,this.timer=0,this.index=0}get x(){return this.sx+this.index*(this.w+this.g)}get y(){return this.sy}reset(){this.timer=0,this.index=0,this.finished=!1}update(t){this.timer+=t,!(this.timer<this.i||this.finished)&&(this.timer=0,this.index=this.index+1,this.index>=this.c&&(this.f?(this.index=this.c-1,this.finished=!0):this.index=0))}}class c{resource;frames;localCanvas;localContext;hi=!1;vi=!1;rotation=0;type;frame;constructor(t,e){this.resource=t,this.frames={};for(const[t,s]of Object.entries(e))this.frames[t]=new l(...s);const s=Object.keys(e)[0];this.type=s,this.frame=this.frames[s],this.localCanvas=document.createElement("canvas"),this.localCanvas.width=this.frame.w,this.localCanvas.height=this.frame.h,this.localContext=this.localCanvas.getContext("2d",{alpha:!0}),this.localContext.imageSmoothingEnabled=!1}play(t){t!==this.type&&(this.type=t,this.frame=this.frames[t],this.frame.reset())}update(t){this.frame.update(t)}rotate(t){this.rotation=Math.atan2(t.y,t.x)}draw(t,e,s,i,n){if(!this.frame)return;const h=this.frame,r=i??h.w,o=n??h.h;this.localCanvas.width=r,this.localCanvas.height=o;const a=this.localContext;a.imageSmoothingEnabled=!1,a.clearRect(0,0,r,o),a.save(),a.translate(r/2|0,o/2|0),a.rotate(this.rotation),this.hi&&this.vi?a.scale(-1,-1):this.hi?a.scale(-1,1):this.vi&&a.scale(1,-1),a.drawImage(this.resource.img,h.x,h.y,h.w,h.h,-r/2|0,-o/2|0,r,o),a.restore(),t.drawImage(this.localCanvas,e-r/2|0,s-o/2|0)}}class d{c;sprite;game;balls=0;isAttacking=!1;constructor(t,e){this.game=e,this.c=new a(t,16,16,2.5,100,e),this.sprite=this.game.sprites.cat}init(){this.game.emitter.on("mouseDownLeft",this.attack),this.game.emitter.on("mouseDownRight",this.throw)}dispose(){this.game.emitter.off("mouseDownLeft",this.attack),this.game.emitter.off("mouseDownRight",this.throw)}attack=()=>{if(!this.isAttacking){this.sprite.play("attack"),this.game.sound.playEffect("hit"),this.isAttacking=!0;const t=this.game.scene?.rats??[];for(const e of t)this.c.p.dist(e.c.p)<30&&(e.c.hp-=25)}};throw=()=>{const t=this.game.scene;if(!t||0===this.balls)return;this.balls-=1,this.game.sound.playEffect("shoot");const e=this.game.control.y,s=this.game.control.x,n=new i(s,e).sub(this.c.p).norm();t.projectiles.push(new r(this.c.p,n,this.game))};update(t){this.updateDirection(),this.updateCharacter(t),this.c.update(!0)}updateDirection(){const t=this.game.control;let e=new i(0,0);t.state.get("KeyW")&&(e=e.add(new i(0,-1))),t.state.get("KeyS")&&(e=e.add(new i(0,1))),t.state.get("KeyA")&&(e=e.add(new i(-1,0))),t.state.get("KeyD")&&(e=e.add(new i(1,0))),this.c.dir=e.norm()}updateCharacter(t){const e=this.game.scene;if(!e)return;let s="idle";this.isAttacking?this.sprite.frame.finished?(this.isAttacking=!1,s=this.c.dir.empty()?"idle":"run"):s="attack":s=this.c.dir.empty()?"idle":"run",this.sprite.play(s),this.c.dir.x<0?this.sprite.hi=!0:this.c.dir.x>0&&(this.sprite.hi=!1);for(let t=0;t<e.projectiles.length;t++){const s=e.projectiles[t];s.p.dist(this.c.p)<=Math.max(2*this.c.w,2*this.c.h)&&s.speed<3&&(e.projectiles.splice(t,1),t-=1,this.game.sound.playEffect("pickup"),this.balls+=1)}this.sprite.update(t)}draw(t){const e=this.c.p;this.sprite.draw(t,e.x,e.y,4*this.sprite.frame.w,4*this.sprite.frame.h),this.game.scene?._debug&&(t.fillStyle="red",t.beginPath(),t.ellipse(e.x,e.y,3,3,Math.PI/4,0,360),t.fill(),t.closePath())}}class f{canvas;context;frameId=-1;fps_timestamp=-1;fps_interval;scene;constructor(t){this.canvas=t,this.context=this.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0});const e=window.devicePixelRatio,s=t.getBoundingClientRect();t.width=s.width*e,t.height=s.height*e,this.context.scale(e,e),t.style.width=`${s.width}px`,t.style.height=`${s.height}px`,this.context.imageSmoothingEnabled=!1,this.fps_interval=1e3/60}tick=()=>{this.frameId=requestAnimationFrame(this.tick);const t=Date.now(),e=t-this.fps_timestamp;e<this.fps_interval||(this.fps_timestamp=t-e%this.fps_interval,this.scene&&(this.scene.update(e),this.scene.draw(this.context)))};start(){this.tick()}}class p{sceneDraw;interactive;entities=[];objects2D=[];projectiles=[];rats=[];gameTime=0;timeLeft=0;t=-1;game;_debug=!1;constructor(t,e=!0,s=0){this.sceneDraw=t,this.gameTime=s,this.interactive=e}*gen(){for(const t of this.entities)yield t;for(const t of this.objects2D)t.entity&&(yield t.entity)}get allEntities(){return[...this.gen()]}update(t){const e=this.game;if(this.interactive&&e){if(this.timeLeft=(this.gameTime??0)-(Date.now()-e.startTime),this.timeLeft<=0)return void this.game?.setScene("gameover");0===this.rats.length&&-1===this.t&&(e.spentTime+=Date.now()-e.startTime,this.t=setTimeout(()=>{e.nextScene()},1e3)),this.game?.player?.update(t);for(const e of this.entities)e.update(t);for(const e of this.objects2D)e.update(t);for(const t of this.projectiles)t.update();for(let e=0;e<this.rats.length;e++)this.rats[e].update(t),this.rats[e].c.hp<=0&&(this.rats.splice(e,1),e-=1,this.game?.sound.playEffect("death"))}}draw(t){if(this.sceneDraw(t),this.interactive){this.game?.panel?.draw(t);for(const e of this.objects2D)e.draw(t);for(const e of this.projectiles)e.draw(t);for(const e of this.rats)e.draw(t);this.game?.player?.draw(t)}}}const u=32,w=768,m=576,g=384,x=288,y=t=>{t.font="16px monospace",t.fillStyle="#4d4343",t.fillText("[Press space to skip]",g,512)},b=(t,e,s=100)=>{const i=t.map(t=>function(t){const s=t.split(" "),i=[];let n="";for(const t of s)n.length+t.length+1>e?(i.push(n),n=t):n+=(0===n.length?"":" ")+t;return n&&i.push(n),i}(t));let n=0,h=0,r=0,o=!1,a=!1,l=0;return function(){if(o)return{done:!0,lines:i[i.length-1]};n+=.18;const e=t[h];r=Math.min(Math.floor(n),t[h].length);const c=function(t,e){let s=0;const i=[];for(const n of t){if(!(s+n.length<e-1)){i.push(n.substr(0,e-s));break}i.push(n),s+=n.length}return i}(i[h],r);return a&&(l+=1),r>=e.length&&!a&&(a=!0,l=0),a&&l===s&&(h++,n=0,r=0,a=!1,l=0),h>=t.length&&(o=!0),{done:o,lines:c}}};class v{p;vs;color;constructor(t,e,s={color:"#000"}){this.p=t,this.vs=e,this.color=s.color}static line(t,e,s){return new v(t,[e,s])}static square(t,e){const s=e/2|0;return new v(t,[new i(-s,-s),new i(s,-s),new i(s,s),new i(-s,s)])}static polygon(t,e,s="#fff"){return new v(t,e.map(([t,e])=>new i(t,e)),{color:s})}*gen(){for(let t=1;t<this.vs.length;t++)yield[this.vs[t-1].add(this.p),this.vs[t].add(this.p)];yield[this.vs[this.vs.length-1].add(this.p),this.vs[0].add(this.p)]}get lines(){return[...this.gen()]}rotate(t){const e=Math.atan2(t.y,t.x);for(let t=0;t<this.vs.length;t++)this.vs[t]=this.vs[t].rotate(e)}move(t){this.p=this.p.add(t)}static lineIntersect(t,e,s){const[i,n]=e,h=n.sub(i),r=t.sub(i),o=h.dot(h);if(0===o)return t.sub(i).len()<=s;const a=r.dot(h)/o,l=Math.max(0,Math.min(1,a)),c=i.add(h.scale(l));return t.sub(c).len()<=s}intersect(t,e=0){for(const s of this.lines)if(v.lineIntersect(t,s,e))return s;return null}draw(t){t.beginPath(),t.setLineDash([]),t.strokeStyle=this.color,t.lineWidth=1;const e=this.vs[0].add(this.p);t.moveTo(e.x,e.y);for(let e=0;e<this.vs.length;e++){const s=this.vs[e].add(this.p);t.lineTo(s.x,s.y)}t.lineTo(e.x,e.y),t.stroke()}update(t){}}class M{position;scale;entity;sprite;frame;finite;hb;hi;vi;constructor(t,e,s,n,h={}){if(this.position=new i(t[0],t[1]),this.sprite=s,this.scale=e,this.frame=n,this.hb=h.hb??!0,this.hi=h.hi??!1,this.vi=h.vi??!1,this.finite=this.sprite.frame.f,this.sprite.play(this.frame),this.hb){const t=this.width/2|0,e=this.height/2|0;this.entity=v.polygon(this.position,[[-t,-e],[t,-e],[t,e],[-t,e]],"red")}}get width(){return this.sprite.frame.w*this.scale}get height(){return this.sprite.frame.h*this.scale}update(t){this.finite||this.sprite.update(t)}draw(t){this.sprite.play(this.frame),this.sprite.hi=this.hi,this.sprite.vi=this.vi,this.sprite.draw(t,this.position.x,this.position.y,this.width,this.height)}}let z=2023;class S{seed;constructor(t){this.seed=t}static get(){return z=(z+1)%1e4,new S(z)}next(){this.seed=16807*this.seed%2147483647;const t=1e4*Math.sin(this.seed);return t-Math.floor(t)}}class P{game;c;c1=0;c2=0;sprite;random=S.get();state="run";constructor(t,e,s=2.8){this.game=e,this.c=new a(new i(t[0],t[1]),10,10,s,100,e),this.sprite=new c(e.resources.sprite,{run:[8,34,16,10,10,16,200,!1],death:[8,50,16,10,10,16,100,!0]}),this.c.dir=i.random(this.random),this.state="run",this.sprite.play("run")}update(t){const e=this.game.scene,s=this.game.player;if(!e||!s)return;const n=this.c.p.clone();if(this.c1+=1,150===this.c1&&(this.c.p.dist(s.c.p)<100?this.c.dir=s.c.p.sub(this.c.p).norm().negate():this.random.next()<.5&&(this.c.dir=i.random(this.random)),this.c1=0),"caught"===this.state&&(this.c2+=1),250===this.c2&&(this.state="run",this.sprite.play("run"),this.c2=0),"run"===this.state){for(this.c.update();this.c.p.equal(n);)this.c.dir=i.random(this.random),this.c.update();for(const t of e.projectiles){const e=t.p.dist(this.c.p);if("run"===this.state&&e<=16&&t.speed>2){this.state="caught",this.sprite.play("death"),this.game.sound.playEffect("stun"),this.c.hp-=10;break}}}this.c.dir.x<0?this.sprite.hi=!1:this.c.dir.x>0&&(this.sprite.hi=!0),this.sprite.update(t)}draw(t){const e=this.c.p.x,s=this.c.p.y;this.sprite.draw(t,e,s,32,20),t.beginPath(),t.fillStyle="red",t.rect(e-10,s-24,32,4),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="green",t.rect(e-10,s-24,this.c.hp/100*32,4),t.fill(),t.closePath(),this.game.scene?._debug&&(t.fillStyle="red",t.beginPath(),t.ellipse(this.c.p.x,this.c.p.y,3,3,Math.PI/4,0,360),t.fill(),t.closePath())}}const k=(t,e,s)=>{const i=e.sprites.furniture;t.objects2D=[new M([128,112],5,i,"kitchen",{hb:!1}),new M([264,152],5,i,"wash",{hb:!1}),new M([340,112],5,i,"fridge",{hb:!1}),new M([192,320],4,i,"table"),new M([96,2===s?512:472],4,i,"plant"),new M([576,176],4,i,"window",{hb:!1}),new M([640,176],4,i,"window",{hb:!1}),new M([168,352],4,i,"chair2"),new M([216,352],4,i,"chair2"),new M([448,192],4,i,"door",{hb:!1}),new M([608,296],4,i,"table"),new M([608,280],4,i,"tv",{hb:!1}),new M([584,448],4,i,"chair",{hb:!1}),new M([632,448],4,i,"chair",{hb:!1}),new M([g,0===s?464:480],4,i,"stable")],s>0&&t.objects2D.push(new M([g,472],2,i,"lamp",{hb:!1}),new M([712,512],2,i,"plant2",{hb:!0}))},R=(t,e,s)=>{const n=new p(t=>{t.fillStyle="#b0b897",t.fillRect(u,192,704,352),t.fillStyle="#545046",t.beginPath(),t.rect(0,0,u,m),t.rect(0,0,g,u),t.rect(g,0,u,64),t.rect(0,544,w,m),t.rect(g,64,g,u),t.rect(736,64,u,512),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#6e6244",t.rect(u,u,352,160),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#445216",t.rect(g,96,352,160),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#a6b379";for(let e=0;e<22;e++)t.rect(g+e*u/2,96,8,164);t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#ffffff",t.rect(u,192,352,8),t.rect(u,192,8,352),t.rect(u,536,704,8),t.rect(376,192,8,72),t.rect(376,256,352,8),t.rect(728,256,8,x),t.fill(),t.closePath()},!0,e);return n.entities=[v.polygon(new i(384,360),[[-344,-160],[-8,-160],[-8,-96],[344,-96],[344,176],[-344,176]],"red"),v.polygon(new i(608,448),[[-50,-25],[50,-25],[50,25],[-50,25]],"red")],s(n),n},C=(t,e,s)=>{const i=b([`level ${s}`],24);let n=-1;return new p(s=>{s.fillStyle="#000000",s.fillRect(0,0,w,m);const{lines:h,done:r}=i();r&&-1===n&&(n=setTimeout(()=>{t.order===e&&t.nextScene()},1e3)),s.fillStyle="#fff",s.textBaseline="top",s.textAlign="center",s.font="24px monospace",s.fillText(h[0],g,256),y(s)},!1)};class D{musicNode;effects={hit:[,,348,.01,.04,.07,,.3,-6,-14,,,,.9,,.1,,.51,.02,,107],stun:[1.5,,152,,.08,.17,1,.2,-2,,,,,.6,,.2,.08,.92,.02],shoot:[,,79,.01,.04,.06,1,.6,19,-38,,,,,,,,.63,.07],pickup:[,,398,.02,.02,.07,1,1.2,,,208,.06,,,,,,.83,.03],jump:[,,399,.03,.04,,1,2,4,,,,,,,,,.68,.02],blip:[1.1,,207,.02,.02,.04,,1.6,,,267,.28,,.2,133,,,.71,.02],death:[2,,311,.01,.01,.07,,.5,1,14,,,,,,.2,.27,.78,.08,,414]};playEffect(t){window.zzfx(...this.effects[t]??[])}}const T=document.getElementById("app");if(!T)throw new Error;const E=new class{scenes={};resources={};sprites={};emitter=new s;control;renderer;player;sound=new D;panel;startTime=0;spentTime=0;scene;s="intro";sceneOrder=["intro","nextlevel0","level0","nextlevel1","level1","nextlevel2","level2","win"];constructor(t){this.renderer=new f(t),this.control=new e(t,this.emitter),this.scene=new p(()=>{},!1)}load(){return Promise.all(Object.values(this.resources).map(t=>t.load()))}get order(){return this.sceneOrder.indexOf(this.s)}nextScene(){if(-1===this.order)return;const t=this.order+1;t>=this.sceneOrder.length||this.setScene(this.sceneOrder[t])}init(){return this.player=new d(new i(384,288),this),this.player.init(),this.control.init(),this.panel=new o(this),this.scenes={intro:()=>(t=>{const e=b(["They say black cat brings bad luck","But today the black cat is unlucky","Fulfill your cat duties or face consequences!"],24,50);let s=-1;return new p(i=>{const{lines:n,done:h}=e();h&&-1===s&&(s=setTimeout(()=>{0===t.order&&t.nextScene()},3e3)),i.fillStyle="#000000",i.fillRect(0,0,w,m),i.strokeStyle="#ffffff",i.strokeRect(288,376,u,u),i.strokeRect(288,416,u,u),i.strokeRect(328,416,u,u),i.strokeRect(248,416,u,u),i.fillStyle="#fff",i.textBaseline="top",i.textAlign="center",i.font="14px monospace",i.fillText("W",304,384),i.fillText("S",304,424),i.fillText("A",264,424),i.fillText("D",344,424),i.strokeRect(434,358,30,50),i.strokeRect(464,358,30,50),i.strokeRect(434,358,60,125),i.fillText("Attack",424,333),i.fillText("Throw",504,333),i.fillStyle="#fff",i.textBaseline="top",i.textAlign="center",i.font="24px monospace";let r=0;for(const t of n)i.fillText(t,g,160+r),r+=u;y(i)},!1)})(this),level0:()=>{return t=this,R(0,9e4,e=>{k(e,t,0),e.projectiles=[new r(new i(56,516),new i(0,0),t,0)],e.rats=[new P([340,340],t,2.5),new P([340,340],t,2.1),new P([80,280],t,2.6),new P([80,280],t,2.8),new P([700,500],t,2.4),new P([700,500],t,2.2)];const s=t.player;return s&&(s.balls=1),e});var t},level1:()=>{return t=this,R(0,75e3,e=>{k(e,t,1),e.projectiles=[new r(new i(56,516),new i(0,0),t,0),new r(new i(700,290),new i(0,0),t,0),new r(new i(680,480),new i(0,0),t,0)],e.rats=[new P([340,340],t,2.5),new P([340,340],t,2.9),new P([340,340],t,3.1),new P([80,280],t,2.6),new P([80,280],t,2.4),new P([80,280],t,2.8),new P([700,400],t,2.1),new P([700,400],t,2.6)];const s=t.player;return s&&(s.c.p=new i(384,288),s.balls=0),e});var t},level2:()=>{return t=this,R(0,6e4,e=>{k(e,t,2),e.projectiles=[new r(new i(56,516),new i(0,0),t,0),new r(new i(700,290),new i(0,0),t,0),new r(new i(680,480),new i(0,0),t,0),new r(new i(56,226),new i(0,0),t,0)],e.rats=[new P([340,340],t,2.5),new P([340,340],t,2.9),new P([340,340],t,3.6),new P([340,340],t,3.1),new P([80,280],t,2.6),new P([80,280],t,2.4),new P([80,280],t,2.8),new P([80,280],t,3.5),new P([700,400],t,3.5),new P([700,400],t,3),new P([700,400],t,2.5),new P([700,400],t,2.8)];const s=t.player;return s&&(s.c.p=new i(384,288),s.balls=1),e});var t},nextlevel0:()=>C(this,1,1),nextlevel1:()=>C(this,3,2),nextlevel2:()=>C(this,5,3),gameover:()=>(t=>{const e=b(["You failed to fulfill your duties"],24),s=new p(s=>{if(s.fillStyle="#000000",s.fillRect(0,0,w,m),n=r?Math.max(0,n-2):Math.min(200,Math.max(5,n+2)),0===n&&(o=!0),s.fillStyle="#540d0d",s.beginPath(),s.ellipse(g,x,n,n,Math.PI/4,0,360),s.fill("evenodd"),s.closePath(),a.position.x>g?a.position=a.position.add(new i(-1,0)):(a.sprite.play("idle"),h||(h=!0,t.sound.playEffect("jump"))),h&&(l.position=l.position.add(new i(-1,-.5).scale(5))),l.position.x<100&&(r=!0),n>40&&(a.update(16),a.draw(s)),o){const{lines:t}=e();s.fillStyle="#861d1d",s.textBaseline="top",s.textAlign="center",s.font="24px monospace";let i=0;for(const e of t)s.fillText(e,g,256+i),i+=u;s.fill()}l.update(16),l.draw(s)},!1);let n=5,h=!1,r=!1,o=!1;const a=new M([518,x],3,t.sprites.granny,"run"),l=new M([334,x],4,t.sprites.cat,"idle");return s.objects2D=[a,l],s})(this),win:()=>(t=>{const e=b(["You did it!",`You finished your duties in ${(t.spentTime/1e3).toFixed(2)} seconds!`],24);let s=5;const i=new p(t=>{t.fillStyle="#000000",t.fillRect(0,0,w,m);const{lines:i}=e();s=Math.min(200,Math.max(5,s+2)),t.fillStyle="#540d0d",t.beginPath(),t.ellipse(g,x,s,s,Math.PI/4,0,360),t.fill("evenodd"),t.closePath(),t.fillStyle="#000000ff",t.textBaseline="top",t.textAlign="center",t.font="24px monospace";let h=0;for(const e of i)t.fillText(e,g,224+h),h+=u;n.update(16),n.draw(t)},!1),n=new M([g,388],10,t.sprites.cat,"idle");return i.objects2D=[n],i})(this)},this.setScene(this.s),this.emitter.on("space",()=>{const t=this.scene;t&&(t.interactive||this.nextScene())}),Promise.resolve()}setScene(t){this.s=t,this.scene=this.scenes[this.s](),this.scene.game=this,this.renderer.scene=this.scene,this.scene.interactive&&(this.startTime=Date.now())}}(T),j=new class{source;loaded=!1;img;constructor(t){this.source=t,this.img=new Image}load(){return new Promise((t,e)=>{this.img.onload=()=>{this.loaded=!0,t()},this.img.onerror=t=>{e(t)},this.img.src=this.source})}}("s.png");E.resources={sprite:j},E.sprites={furniture:new c(j,{fridge:[103,0,15,32],wash:[216,0,16,16],kitchen:[0,61,39,32],table:[55,61,32,16],plant:[180,0,8,12],plant2:[264,0,8,14],window:[188,0,16,32],chair:[64,0,13,13],chair2:[77,0,10,15],door:[87,0,16,32],tv:[232,0,32,16],stable:[39,61,16,15],lamp:[203,0,12,16]}),cat:new c(j,{idle:[2,0,10,6,4,6,250,!1],run:[2,6,10,7,4,6,200,!1],attack:[2,13,12,7,4,4,100,!0]}),granny:new c(j,{idle:[118,0,14,15,1,2,250,!1],run:[118,0,14,15,4,2,200,!1]})},E.load().then(()=>E.init()).then(()=>E.renderer.start())</script>