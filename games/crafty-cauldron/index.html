<!doctype html><meta name=viewport content="width=device-width"><title>Crafty Cauldron - js13kGames 2025</title><style>body{padding:0;margin:0;background:linear-gradient(#273245,#0b0d0a,#0b0d0a);color:#fff;font-family:Georgia,serif}b{font-size:inherit;font-weight:400;display:block;position:relative}i{font-style:normal}#viewport{width:100vw;height:100vh;overflow:hidden;perspective:60vmin;box-sizing:border-box;z-index:1}#camera,#scene{transform-style:preserve-3d}#camera{--cam-x:0px;--cam-y:0px;--cam-z:0px;--cam-rot-x:60deg;width:0;height:0;position:relative;left:50vw;top:50vh;will-change:transform;transform:translate3d(var(--cam-x),var(--cam-y),var(--cam-z))}#scene{--scene-x:0px;--scene-y:0px;--scene-z:-70px;transform-origin:0 0;transform:rotateX(var(--cam-rot-x)) translate3d(var(--scene-x),var(--scene-y),var(--scene-z));position:relative;box-sizing:border-box}#ground{--g-w:9px;--g-h:9px;width:var(--g-w);height:var(--g-h);position:relative;left:calc(-.5 * var(--g-w));top:calc(-.5 * var(--g-h));background-color:#282720;background-image:linear-gradient(#0b0d0a22,#383730,#383730,#383730);background-size:100% 100%;image-rendering:pixelated;box-sizing:border-box}#shadows{width:100%;height:100%}.thing{display:none;--x:200px;--y:100px;--z:0px;--w:70px;--h:70px;--rot-x:calc(-1 * var(--cam-rot-x));--rot-z:0deg;width:var(--w);height:var(--h);position:fixed;top:calc(-1 * var(--h));left:calc(-.5 * var(--w));transform:translate3d(var(--x),var(--y),var(--z)) rotateX(calc(var(--rot-x))) rotate(var(--rot-z));transition:all .15s ease-in-out;transform-origin:50% 100%;box-sizing:border-box;-webkit-user-select:none;user-select:none}.thing>img,.thing>svg{width:100%;height:100%}.thing:hover{filter:sepia(10%) brightness(120%)}.ill .eye{fill:#d4ea92}.info{position:absolute;padding:.5em;background:#0004;top:-2.5em;font-size:80%;white-space:nowrap;transition:all ease-in-out .5s;transform:scale(.5);opacity:0}.info.open{transform:scale(1);opacity:1}.witch{display:block;transition:none}.witch.invisible{opacity:.1;border-radius:var(--w);box-shadow:0 0 1em #fff6}.witch:hover{border:none}.cauldron{cursor:pointer}.grass{background-color:#665f57;--w:6px;--h:30px;box-shadow:0 0 1em #0006}.foot{--step:0;transform-origin:50% 0%;transform:translateY(calc(var(--step) * 1px)) rotate(calc(var(--step) * .5deg))}@keyframes bub1{0%{translate:0 0}50%{translate:10px -1px}to{translate:20px 0}}.bub1{animation:3s infinite alternate bub1}@keyframes bub2{0%{translate:0 0;r:0%;opacity:1}10%{translate:0 0;r:5px;opacity:1}90%{translate:0 -18px;r:4px;opacity:.8}98%{translate:0 -20px;r:0px;opacity:0}to{translate:0 0;opacity:0}}.bub2{animation:5s infinite linear bub2}@keyframes eye{48%{ry:5px}50%{ry:0}52%{ry:5px}}.eye{animation:8s infinite eye}@keyframes ill-eye{0%{ry:2px}48%{ry:2px}50%{ry:0}52%{ry:2px}to{ry:2px}}.ill .eye{animation:4s infinite ill-eye}@keyframes arms{0%{translate:0 0}to{translate:0 -1.5px}}.arms{animation:2s infinite alternate arms}.sickle{transition:all linear .2s;transform:translateY(10px);opacity:0}.harvesting .sickle{opacity:1;transform:translateY(0)}#pentacle{--p-size:300px;width:300px;height:300px;position:absolute;left:-150px;top:-150px;transform:translate(calc(var(--g-w)/ 2),calc(var(--g-h)/ 2))}#ui,#ui>b{position:fixed;z-index:2;-webkit-user-select:none;user-select:none;opacity:1}#ui{transition:all 2s ease-in-out}#news{top:10vh;width:50vw;left:25vw;text-align:center}#debug{top:0}#inv{bottom:5vmin;left:5vmin;min-width:50vw;max-width:90vw}#inv #items,#inv #mats{transition:all .5s ease-in-out;opacity:0;transform:translateY(50vh);max-height:0}#inv.open #items,#inv.open #mats{transform:translateY(0);opacity:1;max-height:20vh}#items{display:flex;gap:.5em;min-height:0;margin:.5em 0}#inv.open #items{min-height:7vmin}.item{width:7vmin;height:7vmin;margin-bottom:.5em;padding:1em .75em 1.5em;border:solid 1px #665f5744;cursor:pointer;background-color:#38373044;position:relative;box-shadow:.2em .5em .5em #0004}.item:hover{background-color:#383730;border-color:#dee6b8}.itemNum{position:absolute;bottom:-.5em;left:2em;padding:0 .6em;border:solid 1px #dee6b8;border-width:0 1px;color:#dee6b8;background:#383730}#mats>b{display:inline-block;padding:.3em .5em;background:#0004;margin:.2em;border-radius:1em}#craft{right:0;top:0;transition:all .7s ease-in-out;transform:scale(0);max-width:50vw;opacity:0}#cList{background:#0004;padding:1em;scrollbar-color:#dee6b8 #0b0d0a}#craft.open{top:5vmin;right:5vmin;opacity:1;transform:scale(1);max-height:60vh}#craft.open #cList{overflow-y:scroll}.recipe{padding:1em;cursor:not-allowed;background-color:#0003}.recipe.filled:hover{cursor:pointer;background-color:#0006}.item:active,.recipe:active{transform:scale(.95)}.req{display:inline-block;padding:.3em .5em;border-radius:1em}.reqUnfilled,.unfilled{opacity:.3;font-size:80%;border-color:#0b0d0a;background-color:transparent}#cTitle,#iTitle{text-transform:uppercase;font-family:Verdana,sans-serif;font-size:80%;font-weight:600;margin-bottom:1em;opacity:.4;letter-spacing:.2em}#iTitle{cursor:pointer}#fx{bottom:30vmin;top:5vmin;left:5vmin}#fx>b{width:4em;background:#383730aa;color:#b59766;background:#665f57aa;color:#0b0d0a;padding:.5em 1em .5em 2em;margin-bottom:1em;position:relative}.bar{position:absolute;left:0;top:0;height:100%;width:.5em;background:#273245}.bar>b{width:100%;height:100%;background:#b59766;display:block}#news>b:first-child{opacity:.2}#news>b:nth-child(2){opacity:.3}#news>b:nth-child(3){opacity:.4}#news>b:nth-child(4){opacity:.5}.splash #ui,.splash .info{opacity:0}.splash #ground,body.splash{background:#0b0d0a;background-image:none!important}.splash #pentG{stroke:#282720;fill:#383730}.splash .grass,.splash .plant,.splash .tree,.splash .villager{opacity:0}.splash .cauldron{width:110px;height:110px;margin:40px 0 0 -40px}#next,#splash{position:absolute;z-index:3;width:100%;text-align:center}#splash{transition:all 3s ease-in-out;transform:scale(0) translateY(-100vh)}#dialog,.splash #next,.splash #splash{transform:scale(1) translateY(0);font-size:calc(16px + 2vmin)}#splash{top:6vh}h1{margin:0;padding:0}#next{display:none}.splash #next{display:block;position:absolute;bottom:10vh;color:#d4ea92;text-shadow:3px 3px 0 #000,0 0 .2em #000}#s1,#s2{font-size:130%;font-weight:700;letter-spacing:.05em;color:#81ba78;text-shadow:0 0 1em #81ba78,5px 5px 0 #477a5a44}#s1:first-letter,#s2:first-letter{font-size:150%}#s1{margin-left:-30vw}#s2{margin-left:10vw;margin-top:-.3em}#sub{color:#665f57;letter-spacing:-.01em}#dialog{position:absolute;top:10vh;width:50vw;left:25vw;background:#dee6b8;padding:2em;border-radius:2em;display:none;z-index:3;color:#000}#dialog.on{display:block}#dialog:after{position:absolute;display:block;content:"";border:solid 1em #dee6b8;border-right-color:transparent;border-bottom-color:transparent;bottom:-1.8em;right:30%}</style><body id=body class=splash><main><b id=splash><h1><b id=s1>Crafty</b><b id=s2>Cauldron</b></h1><b id=sub>Chronicle of the Calming Cat Concotions</b> </b><b id=dialog><b id=d1>All I desire is a cozy life in this forest with some feline friends, but these villagers are so hostile towards my craft!</b> <b id=d2>If I can brew the ultimate cat concoction, this forest will purr in harmony.</b> </b><b id=next>[Enter] to Start</b><div id=viewport><div id=camera><div id=scene><div id=ground><svg id=pentacle viewBox="0 0 100 100"><g stroke=#0b0d0a77 stroke-width=6 fill=none id=pentG><circle cx=50 cy=50 r=45 /><path d="M 50,8 L 75,85 L 10,35 L 90,35 L 25,85 Z"/></g></svg></div></div></div></div><b id=ui><b id=debug></b> <b id=news></b> <b id=craft><b id=cTitle>Crafting [c]</b><b id=cList></b></b> <b id=inv><b id=iTitle>Inventory [Tab]</b><b id=mats></b><b id=items></b></b> <b id=fx></b></b></main><script>!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=window,t=document,o=e=>t.getElementById(e),s=(e,t)=>{(e.length?o(e):e).innerHTML=t},l=(e,t,o)=>e.classList.toggle(t,o),r=(e,t)=>{o(e).style.display=t?"block":"none"},n=(e="div")=>t.createElement(e),i="xyz".split(""),c=!0,a=!1,d=void 0,p=e.addEventListener,g={},y={},{random:f,floor:h,ceil:u,round:x,min:b,max:m,abs:w,PI:k,cos:$,sin:v}=Math,C=2*k,E=(e,t)=>".".repeat(e).split("").map(t),I=e=>parseInt(e,10),L=(e=1,t=0)=>t+f()*(e-t),M=(e,t)=>h(L(e,t)),S=e=>e[M(e.length)],H=(e,t=0,o=1)=>b(m(e,t),o),P=(e,t,o)=>w(t-e)<.1?t:e+(t-e)*o,R=(e,t)=>((e[0]-t[0])**2+(e[1]-t[1])**2)**.5,T=e=>Math.sqrt(((e,t)=>e[0]*t[0]+e[1]*t[1]+(e[2]||0*t[2]||0))(e,e)),j=(e,t)=>[e[0]*t,e[1]*t],D=(e,t)=>[t[0]-e[0],t[1]-e[1]],O=(e,t)=>[e*$(t),e*v(t)],A=(e,t,o,s,l,r,n="")=>`<line x1=${e} y1=${t} x2=${o} y2=${s} ${r?`stroke=${r}`:""} stroke-width=${l} class="${n}"/>`,F=(e,t=100,o=100)=>`<svg width=${t} height=${o} version="1.1" viewBox="0 0 ${t} ${o}" xmlns="http://www.w3.org/2000/svg">${e}</svg>`,N=(e="#665f57",t="#665f57")=>{let o="",s=95,l=50,r=1;const n=[];for(;n.length<=5&&s>0;){const e=.3*n.length;r+=L()>e?0:M(2,4),l+=M(-5,5),s-=M(8,15);const t=9-1.5*n.length,o=E(r,()=>l+M(-5*r,5*r));n.push([o,s,t])}return n.forEach(([s,l,r],i)=>{const[c=[50],a=95]=n[i-1]||[];s.forEach(n=>{let i=1/0,d=0;c.forEach(e=>{const t=w(e-n);t<i&&(d=e,i=t)});const p=s.length>1?e:t;o+=A(d,a,n,l+M(-3,3),r,p)})}),F(`<g fill=none stroke-linecap=round>${o}</g>`)},q=e=>{const t=n();s(t,e);const o=(new XMLSerializer).serializeToString(t.firstElementChild),l=new Blob([o],{type:"image/svg+xml;charset=utf-8"});return URL.createObjectURL(l)},z=(...e)=>q(N(...e)),B=e=>(e=>{const t=new Image;return t.src=q(e),t.outerHTML})(N(e)),W=()=>{const e=S(["#66403c","#665f57","#b59766"]);return F(`<g fill="${e}"><circle cx="40" cy="44" r="20"/><circle cx="60" cy="44" r="20"/><circle cx="50" cy="34" r="25"/></g><g stroke="#665f57" stroke-width="10" stroke-linecap="round"><line x1="43" y1="75" x2="43" y2="90" class=foot /><line x1="57" y1="75" x2="57" y2="90" class=foot /></g><polygon points="50,40  60,40 75,56 70,70 80,84  50,82  20,84 30,70 25,56 40,40" fill="#8f5450"/><g stroke="#0b0d0a" stroke-width="1" fill="#0b0d0a" stroke-linecap="round"><line x1="45" y1="40" x2="55" y2="40" stroke-width="35" stroke="#b1b8a9"/><ellipse cx=35 cy=40 rx=4 ry=4 class=eye /><ellipse cx=65 cy=40 rx=4 ry=4 class=eye /><path d="M 35 32 l 7 7 m 17 0 l 7 -7" stroke-width=3 stroke="${e}"/><polygon points="43,48 57,48 50,46"/><polygon points="46,43 54,43 50,39" fill="#82857b" stroke-width="0"/></g><g stroke="#b1b8a9" stroke-width="9" stroke-linecap="round"><line x1="28" y1="60" x2="20" y2="65"/><line x1="72" y1="60" x2="80" y2="65"/></g>`)},U=()=>{const e=S(["#8f5450","#665f57"]),t=S(["#8f5450","#5a7b85"]);return F(`<g fill="#82857b"><circle cx="40" cy=34 r=16 /><circle cx="60" cy=34 r=16 /></g><g stroke="#0b0d0a" stroke-width="10" stroke-linecap="round"><line x1="43" y1="75" x2="43" y2="90" class=foot /><line x1="57" y1="75" x2="57" y2="90" class=foot /></g><g fill="${e}" stroke-linecap="round"><polygon points="50,30  60,40 75,46 67,70 60,84  50,82  40,84 33,70 25,46 40,40"/><path d="M 35 70 h 30" stroke="#0b0d0a" stroke-width="3"/></g><g stroke="#0b0d0a" stroke-width="3" fill="#0b0d0a" stroke-linecap="round"><path d="M 50 10 l -20 10 v 20 l 10 10 h 20 l 10 -10 v-20" fill="#b1b8a9" stroke-width="0"/><g stroke-width=1><ellipse cx=37 cy=30 rx=4 ry=4 class=eye /><ellipse cx=63 cy=30 rx=4 ry=4 class=eye /></g><path d="M 37 22 l 7 7 m 13 0 l 7 -7" stroke="#383730"/><polygon points="50,42 55,40 57,43 50,41 43,43 45,40"/><polygon points="46,35 54,35 50,31" fill="${e}" stroke-width="0"/></g><path fill="${t}" d="M 50 0 l -10 5 l -5 7 h -10 l 2 5 h 45 l 2 -5 h -10 l -5 -7"/><g stroke="#b1b8a9" stroke-width="7" stroke-linecap="round"><line x1="28" y1="50" x2="20" y2="55"/><line x1="72" y1="50" x2="80" y2="55"/><circle cx="18" cy="53" r="1.4"/><circle cx="82" cy="53" r="1.4"/></g>${A(84,20,80,90,4,"#5f3430")}`)},Y=[[11,13,10],[56,55,48],[102,95,87],[130,133,123],[],[],[],[],[],[71,122,90],[],[],[],[],[],[64,41,47]],G=1e4,V=G/9,K=G/2,X=[{color:Y[0],plants:[0],veg:0,sink:.5,weight:.7},{color:Y[1],plants:[0,1],veg:1,weight:1.2},{color:Y[2],plants:[0,1,2,3],veg:.1,civ:1},{color:Y[9],plants:[0,3],veg:1},{color:Y[15],plants:[1,2],veg:1},{color:Y[3],plants:[0,1,2,3],veg:.1}].map((e,t)=>({...e,id:t})),J=[],Q=()=>[M(-K,K),M(-K,K)],Z=(e,t=10)=>[e[0]+M(-t,t),e[1]+M(-t,t)],_=(e=[0,0],t=a,o=a)=>{let s,l=1/0;return J.forEach(r=>{const n=(t?((e,t)=>w(e[0]-t[0])+w(e[1]+t[1]))(e,r.pos):R(e,r.pos))/(r.weight||1);n<l&&(o?o(r):c)&&(l=n,s=r)}),s},ee=(e,t=10)=>{const o=_(e,a,e=>e.civ);return o.pos?Z(o.pos,t):e};let te,oe,se=0,le=0,re=0,ne=a,ie=c,ce=1;const ae=10*K,de=[0,0,0,0,0,0,0,0,0,2,10,0,1401,0],pe=de.length,ge=[["G",["#477a5a","#81ba78"],["Toe of Frog","Sage","Thyme"]],["Y",["#b59766","#dee6b8"],["Catnip","Cattail","Eye of Newt"]],["R",["#8f5450","#40292f"],["Toadstool","Nightshade","Hemlock"]],["B",["#5a7b85","#95bdb2"],["Mugwort","Houndstongue","Rosemary","Bat Wings"]],["W",["#0b0d0a","#383730","#665f57","#66403c"],["Wood"]]],ye=[],fe=ge.map(()=>[]),he=[["Cat",[1,1],"ðŸˆâ€â¬›",60],["Reaper",[0,0],"ðŸª“",50],["Regrow",[0,1],"ðŸŒ±",5],["Wind Walker",[1,2],"ðŸ’¨",40],["Double Harvest",[0,0,0],"ðŸƒ",30],["Alter Roots",[0,2],"ðŸŒ¿",20],["Feline Plague",[0,1,2,3],"â˜£ï¸",60],["Detox",[0,3],"ðŸŒŠ",2],["Feather",[3,3],"â˜ï¸",30]],ue=[["Cat"],["x3 Sickle Dmg."],["Regrow Aura"],["Fast"],["Double Harvest"],["Alteration Aura"],["Cat-Contagious"],["Cleanse"],["Float"]],xe=[1],be={},me=new Int32Array(1150*pe),we=[],ke=[0,0,0],$e=[0,0,250],ve=["Collect materials from plants [e]..","Craft potions at the cauldron...","Get rid of all the hostile villagers to win."],Ce=e=>{ve.push(e),ve.splice(0,m(ve.length-5,0)),Ze()},Ee=(e,t,o)=>{const s={...e};return he[t][1].map(e=>{const t=Object.keys(s).filter(t=>ye[t].classId===e&&s[t]>=10),l=t[0],r=t.length&&l;return r&&(o&&o(l),delete s[l]),r})},Ie=(e,t)=>{const o={...we[e].mats};return Ee(o,t)},Le=e=>e.reduce((e,t)=>e+(t?0:1),0),Me=e=>e/10,Se=e=>10*e,He=(e=0,t=[0,0])=>{me.set(t.map(Se),e*pe)},Pe=(e,t=0)=>{me[e*pe+9]=t},Re=e=>me[e*pe+9],Te=e=>(e=>me.subarray(e*pe,e*pe+2))(e).map(Me),je=(e,t)=>{var o;return((null==(o=we[e].fx)?void 0:o[t])||0)>0},De=e=>me[e*pe+2]<=0,Oe=(e,t=1)=>{const o=e*pe;De(e)&&(me[o+2]+=1,me[o+5]+=280*(je(e,3)?1.5:1)*t)},Ae=(e,t=[0,0],o=0)=>{const s=e*pe,l=me.subarray(s+6,s+9),r=((e,t)=>[e[0]+t[0],e[1]+t[1]])(l,j((e=>j(e,1/T(e)))(t),o));r.push(l[2]),me.set(r,s+6)},Fe=(e,t=[0,0],o=0)=>{let s=o?we[e].sprintSpeed:we[e].walkSpeed;je(e,3)&&(s=5),Ae(e,t,s)},Ne=(e,t={})=>{me.set(de,e*pe);const{classes:l=[],html:r,src:i,alt:c}=t,a=n(i?"img":"div");a.id=`e${e}`,i&&(a.src=i),c&&(a.title=c),a.className=[...l,"thing"].join(" "),r&&s(a,r),o("scene").appendChild(a);const d={...t,i:e,elt:a,cooldown:0,hp:100,maxHp:100,rot:0};we.push(d)},qe=e=>{we[e].feet=[...we[e].elt.querySelectorAll(".foot")]},ze=(e,t)=>{we[e].lastHtml=we[e].html,s(we[e].elt,t),qe(e)},Be=(e,t)=>{we[e].isCat=t,t?ze(e,(()=>{const e="#0b0d0a",t="#d4ea92";return F(`<g stroke-linecap="round">${A(43,75,43,90,10,e,"foot")}${A(57,75,57,90,10,e,"foot")}${A(75,75,75,90,10,e,"foot")}${A(87,75,87,90,10,e,"foot")}</g><g stroke-linecap="round" stroke="#0b0d0a" fill="transparent"><line x1=50 y1=55 x2=80 y2=65 stroke-width="30"/><line x1=50 y1=40 x2=50 y2=60 stroke-width="35"/><line x1=45 y1=40 x2=55 y2=40 stroke-width="35"/><path d="M 90 60 C 90 60, 100 30, 80 10" stroke-width="6"/></g><g stroke-linecap="round" stroke-width="4" stroke="#0b0d0a" fill="#665f57"><polygon points="33,28 45,25 36,12"/><polygon points="55,25 67,28 64,12"/><g><g class="face"><g>${A(40,40,45,40,3,t)}${A(55,40,60,40,3,t)}</g><g stroke="#383730" stroke-width=10><line x1=42 y1=50 x2=45 y2=50 /><line x1=55 y1=50 x2=58 y2=50 /></g><polygon points="46,45 54,45 50,50" fill="#477a5a" stroke-width="0"/></g>`)})()):(e=>{ze(e,we[e].lastHtml)})(e)},We=(e,t=1)=>{we[e].ill=t,l(we[e].elt,"ill",we[e].ill)},Ue=(e,t,o,s)=>{Ye(e,`--${t}`,o,s)},Ye=(e,t,o,s)=>{const l=s||e.id;if(!l)throw new Error("no uid");be[l]||(be[l]={}),be[l][t]!==o&&(e.style.setProperty(t,o),be[l][t]=o)},Ge=(e,t)=>{we[e].isPlant&&(we[e].src=t.src,we[e].typeId=t.index,we[e].elt.src=t.src)},Ve=e=>{if(L()>.03)return;const t=(e=>{const t=[];for(let o=we.length-1;o>=0;o--)0===Re(o)&&(!e||e(o))&&t.push(o);return t})(e=>we[e].isPlant);if(!t.length)return;const o=t[0];He(o,Z(e,200)),Pe(o,2),we[o].hp=we[o].maxHp;const s=(e=>{const t=_(e),o=S(t.plants);return S(fe[o])})(e);Ge(o,s)},Ke=e=>{if(L()>.1)return;const t=we.filter((t,o)=>t.isPlant&&Re(o)?R(Te(o),e)<200:a);if(!t.length)return;const o=S(t);o.hp=o.maxHp,Ge(o.i,S(ye))},Xe=(e,t)=>{const o=e*pe,s=me.subarray(o,o+pe),l=t/15;s[0]+=s[3]*l,s[1]+=s[4]*l,s[2]=H(s[2]+s[5]*l,0,5e3),s[3]=H(.9*(s[3]+s[6]*l),-200,200),s[4]=H(.9*(s[4]+s[7]*l),-200,200),s[5]=H(.9*(s[5]+s[8]*l),-200,200),s[0]>ae||s[0]<-ae||s[1]>ae||s[1]<-ae?(s[6]=-s[0],s[7]=-s[1]):(s[6]=0,s[7]=0),s[8]=s[2]>=0?-10:0,je(e,8)&&(s[8]*=.1),s[13]=T(s.subarray(3,6)),me.set(s,o)},Je=()=>{const e=performance.now(),t=le?e-le:0;le=e;let n=[0,0];(g.a||g.arrowleft)&&(n[0]-=1),(g.d||g.arrowright)&&(n[0]+=1),(g.w||g.arrowup)&&(n[1]-=1),(g.s||g.arrowdown)&&(n[1]+=1),Fe(0,n,g.shift),g[" "]&&Oe(0),g.c&&(tt(),g.c=a),g.tab&&(ot(),g.tab=a),g.enter&&(ce=(ce+1)%4,l(o("body"),"splash",ce),l(o("dialog"),"on",ce>1),r("splash",1===ce),r("d1",2===ce),r("d2",3===ce),s("next","[Enter] to "+(2===ce?"Advance Dialog":"Start")),g.enter=a);const i=we[0],p=De(0),f=je(0,6),h=Te(0);let u,b,w,k,$=1/0;for(let e=we.length-1;e>=0;e--){if(w=we[e],w.cooldown>0&&(w.cooldown=m(w.cooldown-t,0)),u=Te(e),b=R(u,h),b<$&&e>0&&($=b,k=e),me[e*pe+12]=b,e>0&&b<61){const{maxRot:e=80}=w;w.rot=x((1-b/61)*(u[0]<h[0]?-e:e))}if(Xe(e,t),w.fx){const{fx:o}=w;je(e,2)&&Ve(u),je(e,5)&&Ke(u),Object.keys(w.fx).forEach(s=>{const l=I(s);o[l]<=0||(o[l]=m(o[l]-t,0),o[l]<=0&&(0===l||7===l)&&Be(e,a))})}if(w.target&&(R(u,w.target)>5?Fe(e,D(u,w.target)):w.target=a),w.push&&b<w.push&&p&&!i.isCat&&!w.isCat&&(n=L()<.3?D(u,h):D(h,[0,0]),Ae(0,n,2)),f&&b<62.5&&0===w.ill&&!w.isCat)We(e);else if(w.ill>1e4){Be(e,c),We(e,0);let t=0;const o=we.reduce((e,o)=>(o.isVillager&&t++,e+(o.isCat?1:0)),0);Ce(`${o} / ${t} villagers turned into cats!`),o>=t&&Ce("ðŸˆâ€â¬›ðŸ˜» You win! ðŸ˜¸ðŸˆâ€â¬›")}else w.ill>0&&(w.ill+=t);if("number"==typeof w.planCooldown&&(w.planCooldown<=0?(w.planCooldown=1e3+M(4e3),w.isCat?L()<.5&&(w.target=L()<.1?Z(h,50):Z(u,V)):w.sight&&b<w.sight&&!we[0].inCircle&&!i.isCat?(w.target=Z(h,50),w.planCooldown=800):L()<.5&&(w.target=L()<.5?Z(u,V):ee(u,V/2))):w.planCooldown-=t),w.inCircle!==d){const t=R(u,[0,0])<160,o=t&&!w.inCircle||!t&&w.inCircle;w.inCircle=t,t||(ne=a),0===e&&o&&lt()}}(g.e||y.down)&&$<61?(((e,t)=>{const o=we[0];if(o.cooldown>0)return;const s=we[t];if(s.hp<=0||s.typeId===d)return;o.cooldown=800;const l=M(50)*(je(0,1)?3:1);s.hp-=l;let r=m(1,x(l/10));Oe(t),Oe(0,.6),s.hp<=0&&((e=>{Pe(e),we[e].elt.remove()})(t),r+=2),r*=je(0,4)?2:1,o.mats[s.typeId]=(o.mats[s.typeId]||0)+r,lt(),Ce("Harvested "+r+" "+ye[s.typeId].name)})(0,k),l(i.elt,"harvesting",c)):(0!==n[0]||0!==n[1])&&l(i.elt,"harvesting",a),setTimeout(Je,16)},Qe=(e,t,o)=>{s(e,t.map(o).join(""))},Ze=()=>Qe("news",ve,e=>`<b>${e}</b>`),_e=()=>{l(o("inv"),"open",ie),Qe("items",we[0].items,(e,t)=>{if(!e)return"";const[o,s,l,r,n]=e||[];return`<b class=item data-itemid="${t}">${r} x${n} ${he[s][2]}</b>`}),Qe("mats",Object.entries(we[0].mats),([e,t])=>{const o=ye[e];return`<b style="color: ${o.color}">${t} ${o.name}</b>`})},et=()=>{l(o("cTip"),"open",we[0].inCircle&&!ne),l(o("craft"),"open",we[0].inCircle&&ne),Qe("cList",he,([e,t],o)=>{const s=Ie(0,o);return`<b data-potionid="${o}" class="recipe ${Le(s)?"un":""}filled">${t.map((e,t)=>{const[o,l]=ge[e];return`<span class="req req${s[t]?"F":"Unf"}illed" style="background-color: ${l[0]}">10 ${o}</span>`}).join(" + ")}&rarr; <i class=rName>${xe[o]?e:"????"}</i></b>`})},tt=()=>{ne=!ne,et()},ot=()=>{ie=!ie,_e()},st=()=>{Qe("fx",Object.entries(we[0].fx),([e,t])=>{if(t<=0)return"";const[o]=ue[e];return`<b>${o}<b>${u(t/1e3)} sec</b><b class=bar><b style="height: ${H(u(t/600),0,100)}%"></b></b></b>`})},lt=()=>{_e(),et(),st()},rt=(e,t)=>{const o=e*pe;if(!Re(e))return;const{elt:s,rot:l,feet:r,fx:n}=we[e];for(Ye(s,"display",me[o+12]>1400?"none":"block"),se=0;se<3;se++)Ue(s,i[se],`${Me(me[o+se])}px`,`${e}-${i[se]}`);if(Ue(s,"rot-z",`${l}deg`,`${e}-rot-z`),r){const s=me[o+13],l=v(t*(s/2e3)),n=[2*l,-2*l];r.forEach((t,o)=>Ue(t,"step",n[o%2],e+"-"+o+"step"))}n&&st()},nt=e=>{re<1150&&(re+=60);for(let t=0;t<re;t++)rt(t,e);const t=e=>{$e[e]=1*-x(Me(me[e])/1)};ce||(t(0),t(1));for(let e=0;e<3;e++)ke[e]!==$e[e]&&(ke[e]=P(ke[e],$e[e],1),Ue(2===e?te:oe,(2===e?"cam-":"scene-")+i[e],`${ke[e]}px`));requestAnimationFrame(nt)};p("DOMContentLoaded",()=>{te=o("camera"),oe=o("scene"),(()=>{const e=o("ground");let t;for(["g-w","g-h"].forEach(t=>Ue(e,t,`${G}px`)),J.push({pos:[0,0],...X[1],weight:1.5}),t=0;t<20;t++)J.push({...X[3],pos:O(K,L(C))});for(t=0;t<20;t++)J.push({...X[2],pos:O(G/4,L(C)),weight:.7});for(t=0;t<20;t++)J.push({...S(X),pos:Q()});((e=.5)=>{const t=n("canvas"),s=t.getContext("2d"),l=G*e;s.imageSmoothingEnabled=a,t.width=l,t.height=l;const r=s.getImageData(0,0,t.width,t.height);for(let o=0;o<r.data.length;o+=4){const s=o/4,l=s%t.width,n=h(s/t.height),i=_([l/e-K,n/e-K],a);r.data.set(i.color,o),r.data[o+3]=M(100,200)}s.putImageData(r,0,0),o("ground").style.backgroundImage=`url(${t.toDataURL()})`})(.03)})();let e=0;Ne(e++,{classes:["witch"],html:F('<g fill="#30191f"><circle cx="40" cy="44" r="20"/><circle cx="60" cy="44" r="20"/></g><g stroke="#5a7b85" stroke-width="10" stroke-linecap="round"><line x1="43" y1="75" x2="43" y2="90" class=foot /><line x1="57" y1="75" x2="57" y2="90" class=foot /></g><g stroke="#0b0d0a" stroke-width="1" fill="#0b0d0a" stroke-linecap="round"><polygon points="50,50  60,50 65,56 67,70 80,84  50,82  20,84 33,70 35,56 40,50"/><line x1="45" y1="40" x2="55" y2="40" stroke-width="35" stroke="#81ba78"/><polygon points="10,30 90,30 80,23 70,23 54,10 60,0 46,10 30,23 20,23"/><circle cx="35" cy=47 r="4" fill="#61aa68" stroke-width="0"/><circle cx="65" cy=47 r="4" fill="#61aa68" stroke-width="0"/><ellipse cx="39" cy="40" rx=4 ry=6 class=eye /><ellipse cx="61" cy="40" rx=4 ry=6 class=eye /><g fill="#fff" stroke-width=0><circle cx="38" cy="38" r="1"/><circle cx="60" cy="38" r="1"/></g><polygon points="44,48 57,47 50,50"/><polygon points="46,45 54,45 50,41" fill="#477a5a" stroke-width="0"/></g><g stroke="#81ba78" stroke-width="6" stroke-linecap="round" class=arms><line x1="34" y1=60 x2="20" y2="65"/><line x1="66" y1=60 x2="80" y2="65"/><circle cx="20" cy="67" r="1.4"/><circle cx="80" cy="67" r="1.4"/><path d="M 5 50 a 10 13 0 1 1 14 14 l 5 8 l -2 2 l -7 -10 a 8 11 0 1 0 -9 -13 z"fill="#b1b8a9" stroke-width=0 class=sickle /></g>'),items:[],mats:{},fx:{},inCircle:0,walkSpeed:2,sprintSpeed:3}),He(0,[64,64]),qe(0),Ne(e++,{classes:["cauldron"],html:"<b class=info id=cTip>craft potions [c]</b>"+F(`<g fill="#0b0d0a" stroke-linecap="round"><ellipse cx=28 cy=80 rx=7 ry=20 /><ellipse cx=72 cy=80 rx=7 ry=20 /><ellipse cx=50 cy=60 rx=40 ry=30 /><ellipse cx=60 cy=60 rx=28 ry=26 fill="#111"/><ellipse cx=62 cy=60 rx=24 ry=22 fill="#222"/><ellipse cx=50 cy=30 rx=40 ry=12 /><ellipse cx=50 cy=30 rx=34 ry=6 fill="transparent" stroke="#222" stroke-width="5"/><ellipse cx=50 cy=29 rx=30 ry=6 fill="#0b0d0a"/><g fill="#477a5a"><ellipse cx=50 cy=31 rx=28 ry=3 />${A(20,10,36,30,4,"#66403c")}<circle cx=40 cy=28 r=5.5 class="bub1"/><circle cx=50 cy=28 class="bub2"/><circle cx=36 cy=29 class="bub2" style="animation-delay: 1s"/><circle cx=70 cy=28 class="bub2" style="animation-delay: 2s"  /></g>`),maxRot:10}),He(1,[0,0]);let t=0;ge.forEach((e,o)=>e[2].forEach(s=>ye.push({index:t++,name:s,html:B(e[1][0]),src:z(e[1][0]),classId:o,color:e[1][0]}))),ye.forEach(e=>fe[e.classId].push(e));const s=e=>{const t=Te(e),o=_(t);return(R(t,[0,0])<160||!o.veg||L()>o.veg)&&Pe(e,0),o};for(;e<500;e++){const t=Q(),o=_(t),l=S(o.plants),r=S(fe[l]);Ne(e,{alt:"plant",classes:["plant"],src:r.src,typeId:r.index,isPlant:c}),He(e,t),(!o.veg||L()>o.veg)&&Pe(e,0),s(e)}const l=[W(),W(),W(),U(),U(),U()];for(let t=0;t<100;t++)Ne(e,{alt:"villager",classes:["villager"],html:S(l),isVillager:c,target:null,planCooldown:M(1e4),sight:250,push:62.5,walkSpeed:3,sprintSpeed:3,ill:0}),He(e,Q()),qe(e),e++;for(let t=0;t<400;t++){Ne(e,{alt:"grass",classes:["grass"],html:"",isGrass:!0}),He(e,Q());const t=s(e);L()<.5&&(we[e].elt.style.backgroundColor=`rgb(${t.color.join(",")})`),e++}const r=["#0b0d0a","#383730","#665f57","#66403c"].map(e=>z(e,e));for(let t=0;t<150;t++)Ne(e,{alt:"tree",classes:["tree"],src:S(r)}),He(e,Q()),s(e),e++;onkeydown=onkeyup=e=>{g[e.key.toLowerCase()]="d"==e.type[3],"Tab"===e.key&&e.preventDefault()},onclick=e=>{const t=e.target.closest(".recipe"),o=e.target.closest(".item");e.target.closest("#iTitle")?ot():e.target.closest(".cauldron")?tt():t?(e=>{const t=I(e),o=Ie(0,t);if(Le(o))return;const{mats:s}=we[0];Ee(s,t,e=>{s[e]-=10});const l=he[t];xe[t]=1,((e,t,o)=>{const{items:s}=we[0],l=s.findIndex(e=>e&&0===e[0]&&e[1]===t);-1===l?s.push([0,t,"#fff",o,1]):s[l][4]+=1})(0,t,l[0]+" potion"),lt()})(I(t.dataset.potionid)):o&&(e=>{const{items:t}=we[0],o=t[e];if(!o)return;const[s,l,r,n,i]=o;o[4]-=1,o[4]<=0&&(t[e]=null),0===s&&(((e,t)=>{e.fx[t]=(e.fx[t]||0)+1e3*he[t][3],0===t?Be(0,c):7===t&&Object.keys(e.fx).forEach(t=>{const o=I(t);7!==o&&(e.fx[o]=0)})})(we[0],l),Ce(`You drink the ${n}`)),lt()})(I(o.dataset.itemid))},onmousedown=()=>{y.down=1},onmouseup=()=>{y.down=0},p("wheel",e=>{$e[2]=H($e[2]-e.deltaY/4,-2e3,350)}),Je(),nt(0),lt(),Ze()}),e.biomePoints=J,e.pEnts=me,e.ents=we,e.keys=g,e.mouse=y</script>