<title>Coup Ahoo - js13kGames 2024</title><style>body{margin:0;overflow:hidden;background:#000}</style><body><script>var t={d:(i,n)=>{for(var o in n)t.t(n,o)&&!t.t(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:n[o]})},t:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)},i=(t.d({},{i:()=>wt,h:()=>yt}),{o:[{u:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,3,69,3,1,1,23,167,0,32,77,6,25,6],v:[1,1,1,1,1,2,,,1,2],c:[{n:[144,,147,,151,,141,,141,,,,147,,146,,,,149,,152,,143,,143,,149,,151,,143],f:[]},{n:[144,,147,,151,,141,,141,,147,,151,,143,,,,149,,,,141,,,,143,,,,144],f:[]}]},{u:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,2,69,3,1,1,23,167,0,32,77,6,25,6],v:[,,1,1,,,1,1,1,2,1,2],c:[{n:[156,,,,,,153,,153,,,,151,,158,,,,,,,,155,,155,,,,,,155],f:[]},{n:[156,,,,,,153,,153,,,,151,,155,,,,146,,,,153,,,,155,,,,156],f:[]}]},{u:[1,192,128,0,2,210,128,20,0,0,5,4,37,0,0,0,0,0,0,0,2,255,0,0,32,47,3,146,2],v:[,,,,1,2,1,2,1,2,1,2],c:[{n:[108,,,,,,113,,,,,,115,,,,,,,,,,103,,,,,,108],f:[]},{n:[,,,,,,113,,,,,,115,,,,,,,,,,103],f:[]}]},{u:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],v:[,,1,2,1,2,1,2,1,2],c:[{n:[135,,,,,,,,,,135,,,,,,135,,,,,,,,,,135],f:[]},{n:[135,,,,,,,,,,135,,,,,,135],f:[]}]},{u:[0,160,128,64,0,160,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],v:[,,1,2,1,2,1,2,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]},{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,,,140],f:[]}]},{u:[0,0,140,0,0,0,140,0,0,81,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],v:[1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[135,,,,135,,,,135,,,,,,,,135,,135,,135,,135,,135,,,,135,,135],f:[]},{n:[135,,,,135,,,,135,,,,,,,,135,,135,,135,,135,,135,,,,,,135],f:[]}]},{u:[3,255,128,0,0,255,140,0,0,187,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],v:[,,1,2,1,2,1,2,1,2],c:[{n:[,,,,,,,,,111,,,,,,,,,,,,,,,,111],f:[]},{n:[,,,,,,,,,111,,,,,,,,,,,,,,,,,,111,,111],f:[]}]},{u:[2,40,140,64,0,0,140,0,0,255,5,0,67,104,0,0,0,0,0,0,3,161,192,0,32,0,0,52,1],v:[,1,,,,1,,,,1,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,123,123,,,123,123],f:[]}]}],l:5513,m:32,M:11,T:8}),n=function(){function R(t){return Math.sin(6.283184*t)}function I(t){return.003959503758*Math.pow(2,(t-128)/12)}var z,L,W,H,D,N=[R,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){return(t=t%1*4)<2?t-1:3-t}];this.init=function(t){L=(z=t).M,W=0,H=t.l*t.m*(L+1)*2,D=new Int32Array(H)},this.p=function(){for(var t,i,n,o,e,s,r,h=new Int32Array(H),u=z.o[W],c=z.l,a=z.m,f=0,p=0,l=!1,y=[],v=0;v<=L;++v)for(n=u.v[v],t=0;t<a;++t){for(var d=N[u.u[16]],m=u.u[17]/512,g=Math.pow(2,u.u[18]-9)/c,T=u.u[19],w=u.u[20],x=43.23529*u.u[21]*3.141592/44100,b=1-u.u[22]/255,_=1e-5*u.u[23],S=u.u[24]/32,O=u.u[25]/512,M=6.283184*Math.pow(2,u.u[26]-9)/c,A=u.u[27]/255,P=u.u[28]*c&-2,E=(v*a+t)*c,k=0;k<4;++k)if(i=n?u.c[n-1].n[t+k*a]:0){y[i]||(y[i]=function(t,i){for(var n,o,e,s,r=N[t.u[0]],h=t.u[1],u=t.u[3]/32,c=N[t.u[4]],a=t.u[5],f=t.u[8]/32,p=t.u[9],l=t.u[10]*t.u[10]*4,y=t.u[11]*t.u[11]*4,v=t.u[12]*t.u[12]*4,d=1/v,m=-t.u[13]/16,g=t.u[14],T=(Math.pow(2,2-t.u[15]),new Int32Array(l+y+v)),w=0,x=0,b=0,_=0;b<l+y+v;b++,_++)0<=_&&(e=I(i+(15&g)+t.u[2]-128),s=I(i+(15&g)+t.u[6]-128)*(1+8e-4*t.u[7])),n=1,b<l?n=b/l:l+y<=b&&(n=(1-(n=(b-l-y)*d))*Math.pow(3,m*n)),o=r(w+=e*Math.pow(n,u))*h,o+=c(x+=s*Math.pow(n,f))*a,p&&(o+=(2*Math.random()-1)*p),T[b]=80*o*n|0;return T}(u,i));for(var j=y[i],C=0,U=2*E;C<j.length;C++,U+=2)h[U]+=j[C]}for(C=0;C<c;C++)(e=h[o=2*(E+C)])||l?(s=x,T&&(s*=d(g*o)*m+.5),p+=(s=1.5*Math.sin(s))*(s=b*(e-p)-(f+=s*p)),e=3==w?p:1==w?s:f,_&&(e=(e*=_)<1?-1<e?R(.25*e):-1:1,e/=_),l=1e-5<(e*=S)*e,r=e*(1-(s=Math.sin(M*o)*O+.5)),e*=s):r=0,P<=o&&(r+=h[o-P+1]*A,e+=h[o-P]*A),h[o]=0|r,h[1+o]=0|e,D[o]+=0|r,D[1+o]+=0|e}return++W/z.T},this.O=function(t){for(var i=t.createBuffer(2,H/2,44100),n=0;n<2;n++)for(var o=i.getChannelData(n),e=n;e<H;e+=2)o[e>>1]=D[e]/65536;return i},this._=function(){var t=44+2*H-8,i=t-36,n=new Uint8Array(44+2*H);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var o=0,e=44;o<H;++o){var s=D[o];n[e++]=255&(s=s<-32767?-32767:32767<s?32767:s),n[e++]=s>>8&255}return n},this.getData=function(t,i){for(var n=2*Math.floor(44100*t),o=new Array(i),e=0;e<2*i;e+=1){var s=n+e;o[e]=0<t&&s<D.length?D[s]/32768:0}return o}};function s(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return r.play.apply(r,t)}var h,r={volume:.3,sampleRate:44100,x:new AudioContext,play:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.j(this.g.apply(this,t))},j:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.x.createBuffer(t.length,t[0].length,this.sampleRate),o=this.x.createBufferSource();return t.map(function(t,i){return n.getChannelData(i).set(t)}),o.buffer=n,o.connect(this.x.destination),o.start(),o},g:function(t,i,n,o,e,s,r,h,u,c,a,f,p,l,y,v,d,m,g,T){void 0===t&&(t=1),void 0===i&&(i=.05),void 0===n&&(n=220),void 0===o&&(o=0),void 0===e&&(e=0),void 0===s&&(s=.1),void 0===r&&(r=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===c&&(c=0),void 0===a&&(a=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===l&&(l=0),void 0===y&&(y=0),void 0===v&&(v=0),void 0===d&&(d=0),void 0===m&&(m=1),void 0===g&&(g=0),void 0===T&&(T=0);var w,x,b=2*Math.PI,_=this.sampleRate,S=u*=500*b/_/_,O=n*=(1+2*i*Math.random()-i)*b/_,M=[],A=0,P=0,E=0,k=1,j=0,C=0,U=0;for(o=o*_+9,g*=_,e*=_,s*=_,d*=_,c*=500*b/Math.pow(_,3),y*=b/_,a*=b/_,f*=_,p=p*_|0,x=o+g+e+s+d|0;E<x;M[E++]=U)++C%(100*v|0)||(U=r?1<r?2<r?3<r?Math.sin(Math.pow(A%b,3)):Math.max(Math.min(Math.tan(A),1),-1):1-(2*A/b%2+2)%2:1-4*Math.abs(Math.round(A/b)-A/b):Math.sin(A),U=(p?1-T+T*Math.sin(b*E/p):1)*(0<U?1:-1)*Math.pow(Math.abs(U),h)*t*this.volume*(E<o?E/o:E<o+g?1-(E-o)/g*(1-m):E<o+g+e?m:E<x-d?(x-E-d)/s*m:0),U=d?U/2+(E<d?0:(E<x-d?1:(x-E)/d)*M[E-d|0]/2):U),A+=(w=(n+=u+=c)*Math.cos(y*P++))-w*l*(1-1e9*(Math.sin(E)+1)%2),k&&++k>f&&(n+=a,O+=a,k=0),!p||++j%p||(n=O,u=S,k=k||1);return M}},o=function(){function t(t){this.A=!1,this.S=document.createElement("audio"),t&&this.C()}return t.prototype.k=function(){var o,e,s=this;this.A||(this.A=!0,(o=new n).init(i),o.p(),this.loaded=!1,e=setInterval(function(){var t;!s.loaded&&(s.loaded=1<=o.p(),s.loaded)&&(t=o._(),s.S.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),s.S.loop=!0,s.S.volume=.7,s.S.L=!1,clearInterval(e))},5))},t.prototype.I=function(t){this.S.volume=t},t.prototype.R=function(){return this.S.playbackRate},t.prototype.H=function(t){t<.1?this.S.volume=0:this.S.playbackRate=t},t.prototype.D=function(){return this.muted},t.prototype.N=function(t){this.muted=t,this.muted?this.S.pause():this.S.play()},t.prototype.C=function(){this.N(!this.muted)},t.prototype.play=function(){var t=this,i=setInterval(function(){t.loaded&&(t.muted||t.S.play(),clearInterval(i))},5)},t.prototype.playEffect=function(t){this.muted||s.apply(void 0,t.map(function(t,i){return 0===i?.6*(null!=t?t:1):t}))},t.prototype.P=function(){this.playEffect([2.5,,321,.01,,.02,,.7,-62,-30,116,.15,,.6,35,,.04,.51,.03,,99])},t.prototype.U=function(){},t.prototype.W=function(){this.P(),this.playEffect([1.5,,419,.02,.03,.01,3,3.5,-49,5,283,.49,.09,,,,.04,.69,.02,.12,-1280])},t.prototype.Y=function(){this.playEffect([2,,419,.02,.03,.18,2,1.5,14,8,,,,,,.4,.17,.93,.19,,305])},t.prototype.q=function(){this.playEffect([1.5,,341,.02,.14,,3,2.8,-14,15,,,.07,,3.4,.4,.04,.64,.18,.2,99]),this.playEffect([2.5,,468,.01,.08,.11,4,2.8,,,,,.1,1.3,,.3,.04,.46,.08,.3])},t.prototype.B=function(){this.playEffect([.6,,528,.01,.05,.03,2,4.4,-47,22,77,.29,,,,,,.7,.03,.21,422]),this.playEffect([3.2,,291,,,.04,1,3.9,7,,26,.04,.1,.4,,,.16,.73,.01,.45,-1167])},t.prototype.F=function(){this.playEffect([1.4,,586,,.04,.01,4,.6,32,,-1,.03,,.4,,,.28,.72,.01,.31,-1408])},t.prototype.K=function(t){this.playEffect([t,,50,.09,.26,.62,4,2.7,6,,,,.06,1.2,,.1,,.46,.27,.03,1598])},t.prototype.G=function(){this.playEffect([.7,,312,.01,.01,.06,,2.6,,58,,,,,,.1,,.57,.09])},t.prototype.V=function(){this.playEffect([1,,252,.02,.02,.19,,1.7,,-50,,,,,,.1,.03,.91,.04])},t.prototype.J=function(){this.playEffect([2.2,,229,.03,.11,.5,,2.6,,,-186,.06,.03,,,,.12,.5,.17])},t.prototype.X=function(){var t=this;this.playEffect([.8,,35,.04,.08,.6,4,3.4,5,,,,,.3,,.1,,.37,.19,,1989]),setTimeout(function(){return t.playEffect([.7,,468,.06,.11,,,3.2,-8,,-61,.07,.05,,,,,.91,.14])},500)},t.prototype.Z=function(){this.playEffect([1.5,,525,.07,.12,.44,,1.2,,75,,,.05,.3,.9,,,,.26,.23,494])},t.prototype.warn=function(){this.Z(),this.playEffect([,,326,,.11,.45,1,.8,,-5,124,.07,.06,.2,33,,,.54,.14,,-1210])},t.prototype.$=function(){this.J(),this.playEffect([1.5,,444,.1,.13,.34,1,1.2,,,-128,.06,.02,,1,.1,,.56,.19])},t.prototype.tt=function(){this.playEffect([.5,,541,.03,.16,.35,1,1.5,3,1,,,.07,,.6,,,.89,.17]),this.playEffect([2.5,,93,.06,.01,.67,2,1.6,,3,,,,.5,,.6,.04,.32,.09])},t}(),u=function(t){return Math.min(Math.max(t,0),1)},e=function(t,i,n){return t+(t<i?Math.min(i-t,n):Math.max(i-t,-n))},f={x:0,y:0},c=function(t,i,n){return{x:t.x+i,y:t.y+n}},a=function(t){return t*t},v=function(t){return t<.5?2*t*t:-2*t*t+4*t-1},l=function(){function t(t){this.it=t,this.time=0,this.type="none",this.nt=function(t){return t<4/11?121*t*t/16:t<8/11?9.075*t*t-9.9*t+3.4:t<.9?4356/361*t*t-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}}return t.prototype.scale=function(t,i){this.type="scale";var n=this.it.scale;this.start={x:n.x,y:n.y},this.st(t,i)},t.prototype.move=function(t,i){this.type="move";var n=this.it.v;this.start={x:n.x,y:n.y},this.st(t,i)},t.prototype.ht=function(t){this.nt=t},t.prototype.st=function(t,i){this.target=t,this.duration=1e3*i,this.active=!0,this.startTime=-1},t.prototype.update=function(t){var i,n,o;this.startTime<0||"none"==this.type?this.startTime=t:this.active&&(this.time=u((t-this.startTime)/this.duration),this.start)&&this.target&&(t=this.start,i=this.target,n=this.time,void 0===(o=this.nt)&&(o=function(t){return t}),o={x:t.x+o(n)*(i.x-t.x),y:t.y+o(n)*(i.y-t.y)},"move"==this.type&&(this.it.v={x:o.x,y:o.y}),"scale"==this.type&&(this.it.scale={x:o.x,y:o.y}),"rotate"==this.type&&(this.it.rotation=o.x),this.active=this.time<1)},t.rt=function(i,n){void 0===n&&(n=1e3);for(var t=0;t<1;t+=.01)!function(t){setTimeout(function(){return i(t)},t*n)}(t)},t}(),d=function(){function t(t,i,n,o,e){this.ot=t,this.scale={x:1,y:1},this.d=0,this.rotation=0,this.ut=0,this.et=0,this.ft=0,this.ct=0,this.vt=.005,this.delta=0,this.v={x:i,y:n},this.s={x:o,y:e},this.lt=new l(this),this.ut=Math.random()}return t.prototype.update=function(t,i){this.delta=t-this.et,this.et=t,this.lt.update(t),this.ft=Math.sin(t*this.vt+this.ut),this.ct=Math.abs(this.ft)},t.prototype.dt=function(t){},t.prototype.yt=function(){return{x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y}},t.prototype.wt=function(t,i){void 0===i&&(i=0);var n=this.yt();return t.x>n.x-.5*this.s.x*this.scale.x-.5*i&&t.x<n.x+.5*this.s.x*this.scale.x+.5*i&&t.y>n.y-.5*this.s.y*this.scale.y-.5*i&&t.y<n.y+.5*this.s.y*this.scale.y+.5*i},t}(),y=(h=function(t,i){return(h=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}h(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),w=function(o){function t(t,i){void 0===i&&(i=0);var n=o.call(this,t,0,0,0,0)||this;return n.d=500,setTimeout(function(){return n.open()},i),n}return y(t,o),t.prototype.open=function(t){void 0===t&&(t=function(){}),this.lt.scale({x:0,y:0},.5),setTimeout(t,500)},t.prototype.close=function(t){void 0===t&&(t=function(){}),this.lt.scale({x:1,y:1},.4),setTimeout(t,500)},t.prototype.dt=function(t){t.fillStyle="#000",t.fillRect(0,0,yt*this.scale.x,wt),t.fillRect(yt-yt*this.scale.x,0,yt*this.scale.x,wt)},t}(d),m=function(t,i){return void 0===i&&(i=1),(t=void 0===t?0:t)+Math.random()*(i-t)},M=function(t,i){return t+Math.floor(Math.random()*(i-t+1))},b=function(t){return t[Math.floor(Math.random()*t.length)]},T=function(){return Math.random()<.5?1:-1},p=function(){function t(){this.offset=f,this.pan=f,this.shift=0,this.Mt=0,this.bt=0}return t.prototype.Tt=function(t,i,n){var o=this;void 0===n&&(n=0),this.Mt=t,this.bt=n/360*Math.PI,clearTimeout(this.Ot),this.Ot=setTimeout(function(){return o.reset()},1e3*i)},t.prototype.update=function(){this.offset={x:m(-this.Mt,this.Mt),y:m(-this.Mt,this.Mt)},this.rotation=m(-this.bt,this.bt)},t.prototype.reset=function(){this.Mt=0,this.bt=0},t}(),O=function(){function t(t){this.S=t,this.value=this.target=this.S.R(),this.disabled=["ipho","ipad","macin"].some(function(t){return navigator.userAgent.toLowerCase().includes(t)&&0<navigator.maxTouchPoints})}return t.prototype.update=function(t){var i;this.disabled||(i=this.target-this.value,Math.abs(i)<.01)||(this.value+=1e-4*Math.sign(i)*t*this.speed,this.S.H(this.value))},t.prototype._t=function(t,i){this.speed=i=void 0===i?1:i,this.value=t},t.prototype.xt=function(t,i){this.speed=i=void 0===i?1:i,this.target=t},t}(),_=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),x=function(o){function t(t,i){var n=o.call(this,null,0,0,0,0)||this;return n.S=t,n.canvas=i,n.jt=new p,n.gt=[],n.At=new O(t),n.Et=new w(n,400),n}return _(t,o),t.prototype.click=function(i){var t;null!=(t=this.St)&&t.Ct().forEach(function(t){t.visible&&t.wt(i)&&t.kt()})},t.prototype.Lt=function(t){this.gt=[t]},t.prototype.pressed=function(i){i.repeat||this.gt.forEach(function(t){return t(i)})},t.prototype.update=function(t,i){var n;o.prototype.update.call(this,t,i),null!=(n=this.St)&&n.update(t,i),this.jt.update(),this.Et.update(t,i),this.At.update(this.delta),i.It=!1},t.prototype.dt=function(t){var i;t.fillStyle="#5d9acf",t.fillRect(0,0,800,600),t.save(),t.rotate(this.jt.rotation),t.scale(this.jt.zoom,this.jt.zoom),t.translate(this.jt.offset.x-this.jt.pan.x+this.jt.shift,this.jt.offset.y+this.jt.pan.y),null!=(i=this.St)&&i.dt(t),t.restore(),this.Et.dt(t)},t.prototype.Rt=function(t){var i=this;this.Et.close(function(){i.St=t,i.Et.open()})},t}(d),j=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),g=function(t,i,n){if(n||2===arguments.length)for(var o,e=0,s=i.length;e<s;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))},A=function(e){function t(t,i,n,o){return void 0===o&&(o=[]),(t=e.call(this,t,i=void 0===i?0:i,n=void 0===n?0:n,0,0)||this).children=[],(i=t.children).push.apply(i,o),t}return j(t,e),t.prototype.update=function(i,n){e.prototype.update.call(this,i,n),this.children.forEach(function(t){return t.update(i,n)}),this.children.some(function(t){return t.Ht})&&(this.children=this.children.filter(function(t){return!t.Ht}))},t.prototype.dt=function(i){i.save(),g([],this.children,!0).sort(function(t,i){return t.d-i.d}).forEach(function(t){return t.dt(i)}),i.restore()},t.prototype.Dt=function(){return this.children},t.prototype.add=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];(t=this.children).push.apply(t,i)},t.prototype.Ct=function(){return[]},t}(d),E=["#e3e0bc","#c9c595","#edece1","#dbac86","#ebb7cc","#734e3b","#6e594f","#ede1e6"],S=["#a68b49","#7d572c","#633f15","#8c8465"],C=["#fff","#e92","#9d55d4","#a8edae","#6cd158","#d420b6","#333","#ff3","#f0ed92"],k=function(t,i,n,o,e){L(t,i,n,n,o,e)},L=function(t,i,n,o,e,s){t.beginPath(),t.fillStyle=e,t.ellipse(i.x,i.y,n,o,0,0,2*Math.PI),t.fill(),s&&(t.strokeStyle=s,t.stroke())},I=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),R=function(s){function t(t,i,n,o){return(t=s.call(this,t,i,n,o,o)||this).Nt=1,t.Pt=1,t.color="#000",t}return I(t,s),t.prototype.update=function(t,i){s.prototype.update.call(this,t,i),this.Nt=e(this.Nt,this.Pt,.075)},t.prototype.setColor=function(t){this.color=t},t.prototype.dt=function(t){L(t,this.v,this.s.x,this.s.y*this.Nt,this.color)},t.prototype.blink=function(t){var i=this;clearTimeout(this.Ot),this.Pt=0,this.Ot=setTimeout(function(){return i.open()},t)},t.prototype.open=function(){this.Pt=1},t}(d),H=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),D=function(){return(D=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},N={Ut:"red",Wt:10,width:1,Yt:100,qt:200,Bt:1,Ft:1,Kt:7,zt:0,color:"#000"},P=function(o){function t(t,i){var n=o.call(this,t,0,0,0,0)||this;return n.Nt=0,n.Pt=0,n.Gt=1,n.options=D({},N),n.Vt(i),n.blink(n.options.qt,n.options.Yt),n.left=new R(t,-50*n.options.width,0,n.options.Wt),n.right=new R(t,50*n.options.width,0,n.options.Wt),n}return H(t,o),t.prototype.Vt=function(t){var i;this.options=D(D({},this.options),t),null!=(i=this.left)&&i.setColor(t.color),null!=(i=this.right)&&i.setColor(t.color)},t.prototype.blink=function(t,i){var n=this;setTimeout(function(){return n.left.blink(t)},m(0,i)),setTimeout(function(){return n.right.blink(t)},m(0,i)),setTimeout(function(){return n.blink(t,i)},m(1e3,4e3))},t.prototype.update=function(t,i){o.prototype.update.call(this,t,i),this.Nt=e(this.Nt,this.Pt,.1),this.left.update(t,i),this.right.update(t,i),Math.random()<.002&&(this.Gt*=-1)},t.prototype.dt=function(t){L(t,{x:-65*this.options.width-this.options.zt,y:20},15*this.options.Bt,10*this.options.Bt,this.options.Ut),L(t,{x:65*this.options.width+this.options.zt,y:20},15*this.options.Bt,10*this.options.Bt,this.options.Ut),t.lineCap="round",t.lineJoin="round",t.lineWidth=this.options.Kt,t.strokeStyle=this.options.color,t.fillStyle=this.options.color,this.Jt&&(t.beginPath(),t.moveTo(-50*this.options.width+10,-5),t.lineTo(-50*this.options.width-20,-20),t.stroke(),t.beginPath(),t.moveTo(50*this.options.width-10,-5),t.lineTo(50*this.options.width+20,-20),t.stroke()),t.save(),t.scale(this.Gt,1),t.beginPath();var i=this.options.width*this.options.Ft,n=(t.moveTo(-40*i,20),this.Jt?-30:0);t.quadraticCurveTo(0,40-60*i*this.Nt+n,40*i,20),t.quadraticCurveTo(0,40+60*i*this.Nt+n,-40*i,20),t.stroke(),t.fill(),t.restore(),this.left.dt(t),this.right.dt(t)},t.prototype.Qt=function(t,i){var n=this;clearTimeout(this.Xt),this.Pt=t,this.Xt=setTimeout(function(){return n.Zt()},1e3*i)},t.prototype.Zt=function(){this.Pt=0},t}(d),U=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),W=function(r){function i(t,i,n,o,e,s){return(t=r.call(this,t,i,n,0,0)||this).$t=o,t.ti=e,t.ii=s,t.height=0,t.ni=0,t.si=0,t.face=new P(t.ot,{Ut:"#ed4ea3aa",width:.6,Ft:.7,Kt:11,zt:5,Bt:1.1}),t.hi=b(E),t.ri=Math.random()<.5?1:-1,t.vt=.005*(.8+.4*Math.random()),t}return U(i,r),i.prototype.oi=function(){switch(this.ui){case"cannoneer":return"He will allow you to make up to two shots every turn...";case"quartermaster":return"He will repair random cargo when you roll a blank...";case"navigator":return"He will allow you to reroll an extra time..."}},i.prototype.ei=function(){switch(this.ui){case"cannoneer":this.v={x:170,y:-170};break;case"quartermaster":this.v={x:-80,y:-100};break;case"navigator":this.v={x:0,y:-400}}},i.prototype.clone=function(){var t=new i(this.ot,0,0,this.$t,this.ti,null);return t.ui=this.ui,t.hi=this.hi,t.face.Jt=this.face.Jt,t.ei(),t},i.prototype.update=function(t,i){this.face.update(t,i),0<this.height&&(this.height=u(this.height-.0025*this.delta)),this.ni=Math.sin((1-this.height)*Math.PI),this.si=Math.sin(.005*t),r.prototype.update.call(this,t,i)},i.prototype.fi=function(t){var i=this;void 0===t&&(t=this.v),this.height=1,this.lt.move(t,.3),this.ot.S.G(),setTimeout(function(){return i.ot.S.V()},370)},i.prototype.Qt=function(){this.face.Qt(1.5,.175)},i.prototype.pose=function(t){t&&this.fi(),this.ci=t},i.prototype.dt=function(t){var i=this.ai&&this.face.Jt,i=(t.lineCap="round",t.save(),t.translate(this.v.x,this.v.y),this.ii||t.scale(.9,.9),i&&t.scale(1.3,1.3),t.translate(0,50*-this.ni-(this.ci?10:0)),i?-35:-45);this.vi(t,1,this.ci?i:0),this.vi(t,-1,0),t.translate(0,10*-this.ct),t.rotate(.05*this.si-(this.ci?.3:0)),t.beginPath(),t.moveTo(0,-40),t.lineTo(0,-90),t.lineWidth=50,t.strokeStyle="#000",t.stroke(),t.lineWidth=35,t.strokeStyle=this.hi,t.stroke(),t.translate(0,-20),this.li(t,1,this.ci?-30:10+10*this.ct),this.li(t,-1,0),t.translate(4,-50-5*this.ct),t.scale(.3,.3),t.globalCompositeOperation="multiply",this.face.dt(t),t.globalCompositeOperation="source-over",t.translate(-13,0),t.scale(4.5,4.5),t.translate(0,7*this.ct-18-20*u(this.ni-.5)),t.rotate(.5*u(this.ni-.75)),t.fillStyle=this.$t,t.lineWidth=6,t.beginPath(),t.translate(0,20-5*this.ct),t.scale(1.5*this.ri,1.5),this.ai?(t.scale(.75,.75),t.translate(0,-12),t.fillStyle="yellow",t.moveTo(-12,-10),t.lineTo(12,-10),t.lineTo(12,-25),t.lineTo(5,-19),t.lineTo(0,-27),t.lineTo(-5,-19),t.lineTo(-12,-25),t.closePath()):(t.translate(2,-1),t.moveTo(8,-15),t.bezierCurveTo(-12,-5,-12,-5,-20,-5-2*this.ct),t.bezierCurveTo(-10,-26,-3,2*this.ct-26,10,-18),t.stroke(),t.fill(),t.fillStyle=this.ti,t.beginPath(),t.moveTo(9,-17),t.bezierCurveTo(7,-25,7,-25,15-2*this.ct-this.si,-35),t.bezierCurveTo(15,-25,15,-25,9,-17)),t.stroke(),t.fill(),t.restore()},i.prototype.vi=function(t,i,n){t.strokeStyle="#000",t.lineWidth=7,t.beginPath(),t.lineJoin="round",t.moveTo(0,-30-10*this.ct);var o=20*u(this.ni-.5);t.quadraticCurveTo(30*i*(1+.2*this.ct)-.2*o*i,-30-5*this.ct+o-.2*o*i+n,22*i-o*i,o+n),t.stroke()},i.prototype.di=function(t,i,n,o,e){t.quadraticCurveTo(i,n,o,e),t.stroke(),k(t,{x:o,y:e},3,"#000")},i.prototype.li=function(t,i,n){t.save(),t.translate(22*i,10*this.ct-15),t.strokeStyle="#000",t.lineWidth=7,t.beginPath();var o=-15*this.ct;t.moveTo(0,o-15),i<0||!this.ii?this.di(t,20*i-5*this.si+-10*this.ni,1.2*o-20,15*i+5*this.si,o+-10*this.ni):this.di(t,20*i-10*this.si+3*this.ct,5+1.2*o+n,20*i,o-25+n),t.stroke(),0<i&&this.ii&&(t.translate(20*i,o-25+n),this.ci&&t.rotate(.2*-this.ct),t.beginPath(),t.moveTo(0,0),t.lineTo(0,50),t.lineWidth=12,t.stroke(),t.strokeStyle=this.ii,t.lineWidth=6,t.stroke()),t.restore()},i}(d),Y="Arial Black,HelveticaNeue-CondensedBlack,arial,sans-serif",q=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),B=function(h){function t(t,i,n,o,e,s,r){return(t=h.call(this,t,i,n,o,e)||this).yi=s,t.wi=r,t.ratio=1,t.start=-1,t}return q(t,h),t.prototype.update=function(t,i){this.Ht||this.yi<0||(this.v={x:this.v.x+this.wi.x,y:this.v.y+this.wi.y},this.ratio=1-(t-this.start)/(1e3*this.yi),this.start<0&&(this.start=t),t-this.start>1e3*this.yi&&(this.Ht=!0))},t}(d),F=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),K=function(h){function t(t,i,n,o,e,s,r){return void 0===e&&(e=1),void 0===s&&(s=0),void 0===r&&(r=40),(t=h.call(this,t,i,n,o,o,(.3+.1*Math.random())*e,f)||this).mi=o,t.Mi=s,t.alpha=r,t}return F(t,h),t.prototype.dt=function(t){var i=Math.max(0,Math.min(1-this.ratio,1)),n="#ffffff"+Math.round(i*this.alpha).toString(16).padStart(2,"0");k(t,this.v,i*this.mi,0<this.Mi?"#ffffff00":n),0<this.Mi&&(t.strokeStyle=n,t.lineWidth=this.Mi,t.stroke())},t}(B),z=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),G=function(c){function t(t,i,n,o,e,s,r,h){var u=this;return(u=c.call(this,t,i,n,o,e,s,r)||this).options=h,null!=(t=u.options)&&t.bi&&(u.d=u.options.bi),u}return z(t,c),t.prototype.update=function(t,i){var n;null!=(n=this.options)&&n.force&&(this.wi={x:this.wi.x+this.options.force.x,y:this.wi.y+this.options.force.y}),c.prototype.update.call(this,t,i)},t.prototype.dt=function(t){var i;t.fillStyle=null!=(i=null==(i=this.options)?void 0:i.color)?i:"#fff",t.fillRect(this.v.x-.5*this.s.x,this.v.y-.5*this.s.y,this.s.x,this.s.y)},t}(B),V=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),J=function(u){function t(t,i,n,o,e,s,r,h){return(t=u.call(this,t,o,e,0,0,s,r)||this).content=i,t.fontSize=n,t.options=h,t}return V(t,u),t.prototype.dt=function(t){t.save();var i=null!=(i=this.options)&&i.Ti?this.ratio:1;t.font="".concat(this.fontSize*i,"px ").concat(Y),t.fillStyle="#000",t.fillText(this.content,this.v.x+this.options.pi,this.v.y+this.options.pi),t.fillStyle="#fff",t.fillText(this.content,this.v.x,this.v.y),t.restore()},t.prototype.Oi=function(i){var t=null!=(t=this.options)&&t.Ti?this.ratio:1;return i.font="".concat(this.fontSize*t,"px ").concat(Y),Math.max.apply(Math,this.content.split("\n").map(function(t){return i.measureText(t).width}))},t}(B),Q=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),X=function(c){function t(t,i,n,o,e,s,r,h){return(t=c.call(this,t,i,n,o,e,-1,f,h)||this).frequency=s,t.amplitude=r,t.time=0,t.scale={x:1,y:1},t}return Q(t,c),t.prototype.update=function(t,i){c.prototype.update.call(this,t,i),this.lt.update(t),this.time=t},t.prototype.toggle=function(t){var i=this,n=(clearTimeout(this.Ot),this.Ot=setTimeout(function(){return i.content=t},t?0:200),t?1:0);this.lt.scale({x:n,y:n},.2)},t.prototype.dt=function(n){var t,o=this,i=(n.save(),n.rotate(null!=(i=null==(i=this.options)?void 0:i.angle)?i:0),this.ratio=u(this.scale.x),null!=(i=this.options)&&i.Ti?this.ratio:1),e=(n.textAlign="left",n.font="".concat(this.fontSize*i,"px ").concat(Y),null!=(i=null==(i=this.options)?void 0:i.spacing)?i:0),i=this.Oi(n),s="center"!==(null==(t=this.options)?void 0:t.align)&&null!=(t=this.options)&&t.align?0:.5*-i;"right"==(null==(t=this.options)?void 0:t.align)&&(s=-i),this.content.split("").forEach(function(t,i){n.fillStyle="#000",n.fillText(t,o.v.x+e*i+o.options.pi+s,o.v.y+o.options.pi+Math.sin(.005*o.time+i*o.frequency)*o.amplitude),n.fillStyle="#fff",n.fillText(t,o.v.x+e*i+s,o.v.y+Math.sin(.005*o.time+i*o.frequency)*o.amplitude),s+=n.measureText(t).width}),n.restore()},t}(J),Z=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype._i=function(t){return this.xi?this.color:t},i.prototype.ji=function(t,i){var n=this;void 0===t&&(t=.1),void 0===i&&(i="#fff"),this.xi=!0,this.color=i,setTimeout(function(){return n.xi=!1},1e3*t)},i}(d),tt=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),it=function(){return(it=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},nt=function(t,i,n){if(n||2===arguments.length)for(var o,e=0,s=i.length;e<s;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))},st=function(s){function t(t,i,n,o,e){return(n=s.call(this,t,n,550,0,0)||this).name=i,n.St=o,n.gi=e,n.Ai=[],n.Ei=[],n.Si=0,n.Ci=0,n.tt=0,n.ki=[],n.Li=["quartermaster","cannoneer","navigator"],n.Ii=0,n.vt=.005,n.Ri=[b(S),b(S),b(S),b(C),b(C)],n.message=new X(t,"",30,n.gi?300:-300,-200,.5,3,{pi:4,align:"center",Ti:!0}),n.Hi=new A(t),n.Di=n.Ni(70,-100,!0),n}return tt(t,s),t.prototype.Pi=function(){return this.Ai.length<10?3:this.Ai.length<20?4:this.Ai.length<30?5:6},t.prototype.pop=function(t,i,n){this.Hi.add(new J(this.ot,t,60,this.v.x+i*this.Ui(),this.v.y+n,1.2,{x:0,y:-2.5},{pi:4,Ti:!0}))},t.prototype.Wi=function(){var t,i=this.ki.find(function(t){return"quartermaster"==t.ui});i&&(t=b(this.Ai),i.fi(),t.Yi())},t.prototype.qi=function(){this.ki=[]},t.prototype.Ni=function(t,i,n){return new W(this.ot,t,i,this.Ri[4],this.Ri[3],(n=void 0!==n&&n)?b(S):null)},t.prototype.has=function(i){return this.ki.some(function(t){return t.ui==i})},t.prototype.Bi=function(){return b(this.Li)},t.prototype.Fi=function(i){this.Li=this.Li.filter(function(t){return t!==i.ui}),this.ki.push(i),this.Ki()},t.prototype.zi=function(t){var i=this;this.message.toggle(t),this.Di.Qt(),setTimeout(function(){return i.Di.Qt()},320),setTimeout(function(){return i.message.toggle("")},1e3)},t.prototype.Gi=function(){this.zi("UNLUCKY 13!"),this.ot.S.Z(),this.gi&&this.ot.At._t(.7,1.5)},t.prototype.Vi=function(){return 0===this.Ai.length},t.prototype.Ji=function(){this.Di.ai=!0},t.prototype.Qt=function(){this.Di.Qt()},t.prototype.Qi=function(t){t<=0?this.St.Xi():(this.tt=t,this.Ai.forEach(function(t){return t.Zi()}))},t.prototype.$i=function(i){var t=null!=(t=this.Ai.find(function(t){return t.tn()>i}))?t:nt([],this.Ai,!0).sort(function(t,i){return t.tn()-i.tn()})[0];if(t)return this.nn(t,i),i-t.tn()},t.prototype.Ui=function(){return this.gi?1:-1},t.prototype.nn=function(i,n){var o=this;i.mark(),setTimeout(function(){o.ot.At._t(o.gi?.85:1.21,o.gi?1:2),o.Qt(),o.ji(),o.ot.jt.Tt(20,.3,2),o.ot.S.q();var t=c(o.v,-50*o.Ui(),340-o.v.y);o.pulse(t.x+40,t.y-100,200),o.pop(n.toString(),i.v.x+25,i.v.y),i.$i(n)&&(o.Ai=o.Ai.filter(function(t){return t!=i}),o.sn()),o.Ci=1},500)},t.prototype.hn=function(){return nt([this.Di],this.ki,!0)},t.prototype.rn=function(){var t=this,i=(this.Di.Qt(),this.hn().forEach(function(t){return t.fi()}),setTimeout(function(){return t.Di.pose(!1)},300),this.Si=1,this.Ci=1,this.Ui()),n=c(this.v,300*i,320-this.v.y);this.on.Y(n,800*i),this.ot.jt.Tt(15,.2,1.25),this.pulse(n.x+40,n.y-20,80),this.ot.S.Y()},t.prototype.Y=function(t,i){var n,o=this,e=(void 0===i&&(i=!0),this.rn(),null==(n=this.un)?void 0:n.$i(t));setTimeout(function(){o.has("cannoneer")&&0<e&&i&&o.un.en(e)?o.Y(e,!1):o.St.Xi()},500)},t.prototype.en=function(t){return 1<this.Ai.length||this.fn()>t},t.prototype.pulse=function(t,i,n){this.ot.St.add(new K(this.ot,t,i,n,.15,0,150))},t.prototype.cn=function(t){this.Ai.push(t),t.v=this.an(this.Ai.length-1),this.sn()},t.prototype.vn=function(){return this.Ai.length},t.prototype.an=function(t){var i=this.Pi();return{x:-105*Math.floor(t/i)-180+20*Math.random(),y:t%i*-100-240}},t.prototype.sn=function(){var n=this;this.Ai.forEach(function(t,i){return t.move(n.an(i))}),this.Ki()},t.prototype.ln=function(){return 0<this.tt},t.prototype.dn=function(){return this.Ai.some(function(t){return t.yn()})},t.prototype.wn=function(){this.Ai.filter(function(t){return t.yn()}).forEach(function(t){return t.Zi(!0)})},t.prototype.update=function(i,n){var t,o=this;s.prototype.update.call(this,i,n),this.hn().forEach(function(t){return t.update(i,n)}),this.Hi.update(i,n),this.message.update(i,n),nt(nt([],this.Ai,!0),this.Ei,!0).forEach(function(t){return t.update(i,o.mn(n,o.ot.jt))}),0<this.Si&&(this.Si=Math.max(0,this.Si-.075)),0<this.Ci&&(this.Ci=Math.max(0,this.Ci-.05)),this.Mn&&this.Hi.add(new G(this.ot,this.v.x-550*Math.random(),500,10,10,.3,{x:(-2-5*Math.random())*this.Ui(),y:-4-3*Math.random()},{force:{x:0,y:.5},color:"#ffffffcc"})),n.It&&this.gi&&(t=this.Ai.find(function(t){return t.bn()}))&&(this.St.W(t),0<this.tt)&&(this.Ii++,this.un.rn(),this.nn(t,this.tt),this.tt=this.tt-t.tn(),this.un.has("cannoneer")&&0<this.tt&&this.Ii<2&&this.en(this.tt)?(this.St.info(),setTimeout(function(){o.ot.S.tt(),o.St.info("Another ".concat(o.tt," damage!"),"Choose cargo taking the hit...")},750)):(this.Ii=0,this.tt=0,this.Tn(),setTimeout(function(){return o.St.Xi()},500)))},t.prototype.pn=function(t){this.name=t},t.prototype.On=function(){return 0<this.Ai.length},t.prototype._n=function(t){var o=this;this.Ai.slice(0,t).forEach(function(t,i){var n=o.an(i);t.v=c(o.v,-n.x-50,n.y),o.remove(t),o.Ei.push(t),t.move(c(o.un.an(o.un.Ai.length+i),o.un.v.x+150,o.un.v.y),function(){o.un.cn(t),o.Ei=[]})}),this.ot.S.$(),this.sn()},t.prototype.remove=function(i){this.Ai=this.Ai.filter(function(t){return t!=i})},t.prototype.Tn=function(){this.Ai.forEach(function(t){return t.Zi(!1)})},t.prototype.mn=function(t,i,n,o){return void 0===n&&(n=0),void 0===o&&(o=0),it(it({},t),{x:t.x/i.zoom-400+i.shift+n,y:t.y/i.zoom-550-i.pan.y+o})},t.prototype.xn=function(){this.gi&&this.ot.S.$();var t=this.Ai.filter(function(t){return t.jn()});0<t.length&&b(t).gn()},t.prototype.X=function(){this.ot.S.X(),this.hn().forEach(function(t){return t.fi()}),this.lt.ht(a),this.lt.move(c(this.v,0,800/this.ot.jt.zoom),1.5)},t.prototype.pose=function(t){this.Di.pose(t)},t.prototype.fi=function(){this.hn().forEach(function(t){return t.fi()})},t.prototype.An=function(){return this.v.x+100*this.Ui()},t.prototype.dt=function(i){var t;this.hidden||(i.strokeStyle=this._i("#000"),i.save(),t=this.Ui(),i.translate(this.v.x-20*this.Ci*t,this.v.y-10*Math.cos(this.ft)),i.rotate(.02*this.ft-.05*this.Ci*t),i.scale(t,1),i.fillStyle=this._i(this.Ri[0]),i.beginPath(),i.rect(-10,-550,15,520),i.fill(),i.stroke(),i.fillStyle=this._i(this.Ri[3]),i.beginPath(),i.moveTo(-20,-520),i.quadraticCurveTo(-200-10*this.ft,-400,-300-10*this.ft,-180-10*this.ft),i.lineTo(-20,-180),i.closePath(),i.fill(),i.stroke(),this.Ai.filter(function(t){return!t.bn()}).forEach(function(t){return t.dt(i)}),this.Ai.filter(function(t){return t.bn()}).forEach(function(t){return t.dt(i)}),i.strokeStyle=this._i("#000"),i.save(),i.translate(160,0),i.rotate(-.1-.1*this.Si),this.En||(i.fillStyle=this._i("#666"),i.save(),i.rotate(.2*-this.Si),i.translate(190-10*this.Si,0),i.beginPath(),i.moveTo(0,-225),i.bezierCurveTo(-300,-250,-300,-150,0,-175),i.closePath(),i.fill(),i.stroke(),i.beginPath(),i.rect(-20,-230,20,60),i.fill(),i.stroke(),i.restore(),i.fillStyle=this._i(this.Ri[1]),i.beginPath(),i.moveTo(0,-150),i.bezierCurveTo(0,-230,70,-230,70,-150),i.closePath(),i.fill(),i.stroke(),k(i,{x:35,y:-190},8,this._i("#000"))),i.restore(),i.save(),i.scale(1.4,1.4),this.hn().forEach(function(t){return t.dt(i)}),i.restore(),i.fillStyle=this._i(this.Ri[2]),i.beginPath(),t=this.Sn(),i.moveTo(-200-t,-150),i.lineTo(-170-t,10),i.lineTo(180,10),i.lineTo(250,-160),i.closePath(),i.moveTo(-193-t,-110),i.lineTo(233,-120),i.moveTo(-190-t+7,-72),i.lineTo(213,-77),i.moveTo(-180-t+7,-30),i.lineTo(193,-30),!this.En&&this.has("navigator")&&(i.moveTo(-60,-535),i.lineTo(-80,-595),i.lineTo(80,-595),i.lineTo(60,-535),i.closePath(),i.moveTo(-70,-565),i.lineTo(70,-565)),i.fill(),i.stroke(),i.translate(-120,-100),i.scale(this.Ui(),1),i.lineWidth=12,i.lineJoin="round",i.fillStyle=this.Ri[4],i.font="40px ".concat(Y),i.textAlign="center",i.strokeText(this.name,0,0),i.fillText(this.name,0,0),this.message.dt(i),i.restore(),this.Hi.dt(i),this.Ei.forEach(function(t){return t.dt(i)}))},t.prototype.Ki=function(){var t,i=this.ki.find(function(t){return"quartermaster"==t.ui});i&&(t=this.Pi(),i.fi({x:-45-40*Math.max(Math.floor(this.Ai.length/t),1),y:-105-70*Math.min(t,this.Ai.length)}))},t.prototype.Cn=function(){this.Ai.forEach(function(t){return t.kn(!1)})},t.prototype.Ln=function(t){nt([],this.Ai,!0).sort(T).slice(0,t).forEach(function(t){return t.kn()})},t.prototype.fn=function(){return this.Ai.reduce(function(t,i){return t+i.tn()},0)},t.prototype.In=function(){return 13==this.fn()},t.prototype.Rn=function(){this.Ai.forEach(function(t){return t.Hn()}),this.Ki()},t.prototype.K=function(t){var i=this;void 0===t&&(t=1),this.Di.fi(),this.lt.ht(v),this.lt.move(c(this.v,2e3*t,0),6),setTimeout(function(){return i.Mn=!0},300),setTimeout(function(){return i.Mn=!1},5e3);for(var n=0;n<7;n++)setTimeout(function(){return i.ot.S.K(.1+.3*Math.random())},750*n)},t.prototype.Dn=function(){this.Ai=[]},t.prototype.Sn=function(){return 100*Math.floor(Math.max(this.has("navigator")?4:1,this.Ai.length-1)/this.Pi())},t}($),ht=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),rt=function(e){function t(t,i,n,o){return void 0===o&&(o=!1),(t=e.call(this,t,i,n,100,100)||this).Nn=o,t.Pn(),t.Un(),t.vt=.005,t}return ht(t,e),t.prototype.kn=function(t){this.Wn=t=void 0===t||t},t.prototype.yn=function(){return this.Wn},t.prototype.Zi=function(t){this.Yn=t=void 0===t||t},t.prototype.mark=function(t){this.qn=t=void 0===t||t},t.prototype.Pn=function(){this.value=this.Nn?M(0,2):M(1,6)},t.prototype.tn=function(){return this.value},t.prototype.Un=function(){this.rotation=Math.random()<.5?0:.5*Math.PI},t.prototype.F=function(t,i){var n=this;this.ot.S.B(),this.lt.move({x:t,y:i},.3),this.Bn=!0,setTimeout(function(){n.ot.S.F(),n.Bn=!1,n.Un()},300)},t.prototype.move=function(t,i){this.lt.move(t,.3),i&&setTimeout(i,300)},t.prototype.update=function(t,i){e.prototype.update.call(this,t,i),this.Fn=this.Yn&&this.wt(i,5),this.Bn&&(this.Pn(),this.rotation+=.1*t)},t.prototype.float=function(t){this.Kn=t},t.prototype.bn=function(){return this.Fn||this.qn},t.prototype.gn=function(){this.zn=!0,this.ji(.2,"#afe6ac")},t.prototype.jn=function(){return!this.zn&&!this.Wn},t.prototype.$i=function(t){return this.qn=!1,this.value=Math.max(0,this.value-Math.min(t,this.zn?1:t)),this.value<=0},t.prototype.Yi=function(){this.ji(.2,"#afe6ac"),this.value=Math.min(this.value+1,9)},t.prototype.Gn=function(t){(this.Fn||this.qn)&&(t.strokeStyle="#e92",t.strokeRect(-55,-55,110,110))},t.prototype.Hn=function(){this.F(this.v.x,this.v.y)},t.prototype.Vn=function(){return this.Kn?7*this.ft:0},t.prototype.Jn=function(){return(this.v.x-this.v.y)*(this.Fn?1:10)},t.prototype.dt=function(t){t.strokeStyle=this.xi?"#68ad65":"#000",t.save(),t.beginPath(),t.translate(this.v.x+50,this.v.y+50+this.Vn()+(this.Bn?-150*Math.sin(this.lt.time*Math.PI):0)),t.rotate(this.rotation),t.fillStyle=this.Wn?"#e92":"#fff",this.zn&&(t.fillStyle="#a9c5db"),(this.Fn||this.qn)&&(t.fillStyle="#f2e949"),this.xi&&(t.fillStyle=this._i("#fff")),t.rect(-50,-50,100,100),t.fill(),t.stroke(),t.closePath(),1!==this.value&&3!==this.value&&5!==this.value&&7!==this.value&&9!==this.value||this.Qn(t,0,0),1<this.value&&(this.Qn(t,-25,-25),this.Qn(t,25,25)),3<this.value&&(this.Qn(t,-25,25),this.Qn(t,25,-25)),5<this.value&&(this.Qn(t,0,-25),this.Qn(t,0,25)),7<this.value&&(this.Qn(t,25,0),this.Qn(t,-25,0)),this.Gn(t),t.restore()},t.prototype.Qn=function(t,i,n){t.fillStyle=this.xi?"#68ad65":"#000",this.Nn?(t.font="45px ".concat(Y),t.fillText("✦",.8*i-20,.8*n+15)):k(t,{x:i,y:n},this.Nn?12:8,t.fillStyle,"transparent")},t}($),ot=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ut=function(c){function t(t,i,n,o,e,s,r,h,u){return void 0===u&&(u=30),(t=c.call(this,t,n-.5*e,o-.5*s,e,s)||this).content=i,t.Xn=r,t.S=h,t.fontSize=u,t.visible=!0,t.Zn=5,t}return ot(t,c),t.prototype.kt=function(){this.S.P(),this.Xn()},t.prototype.$n=function(t){this.content=t},t.prototype.update=function(t,i){var n;this.visible&&(n=this.ts,this.ts=!i.ns&&this.wt(i),!n&&this.ts&&this.ss(),i.It||(this.pressed&&!i.ns&&this.ts&&this.Xn(),this.pressed=!1),this.ts)&&i.It&&!this.pressed&&!i.ns&&(this.pressed=!0)},t.prototype.dt=function(t){this.visible&&(t.save(),t.translate(0,this.ts?-5:0),t.fillStyle="#000",t.fillRect(this.v.x,this.v.y,this.s.x,this.s.y),t.fillStyle=this.ts?"#f2e949":"#fff",t.fillRect(this.v.x+this.Zn,this.v.y+this.Zn,this.s.x-2*this.Zn,this.s.y-2*this.Zn),t.font="".concat(this.fontSize,"px ").concat(Y),t.textAlign="center",t.fillStyle="#000",t.fillText(this.content,this.v.x+.5*this.s.x,this.v.y+.5*this.s.y+.3*this.fontSize),t.restore())},t.prototype.ss=function(){this.S.U()},t}(d),et=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ft=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return et(i,t),i.prototype.dt=function(t){this.visible&&k(t,this.v,20,"#333","#000")},i.prototype.Y=function(t,i){var n=this;this.visible=!0,this.lt.ht(a),this.v=t,this.lt.move(c(t,i,-100),.4),setTimeout(function(){return n.visible=!1},400)},i}(d),ct=function(){var o=function(t,i){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),at=function(){return(at=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},vt=function(t,i,n){if(n||2===arguments.length)for(var o,e=0,s=i.length;e<s;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))},lt=26,dt=function(s){function t(t){var i=s.call(this,t,0,0,[])||this;return i.Ai=[],i.hs=.75,i.rs=0,i.level=0,i.os=[],i.on=new ft(i.ot,100,100,0,0),i.us=new st(t,"14",0,i,!0),i.es=i.us,i.vt=.002,i.fs=new X(t,"Lets start by rolling for your cargo!",35,400,60,.2,3,{pi:4,align:"center",Ti:!0}),i.cs=new X(t,"",25,400,105,.2,3,{pi:3,align:"center",Ti:!0}),i.vs=new X(t,"~ COUP AHOO ~",80,400,150,.2,3,{pi:6,align:"center",Ti:!0}),i.action=new ut(t,"ROLL",690,360,200,55,function(){return i.ls()},t.S,20),i.ds=new ut(t,"",720,360,140,55,function(){return i.ys(!0)},t.S,20),i.ws=new ut(t,"",570,360,140,55,function(){return i.ys(!1)},t.S,20),i.ds.visible=!1,i.ws.visible=!1,i.Ms("ROLL",function(){i.bs(),setTimeout(function(){return i.Ts("ROLL","KEEP","Cast the dice once more?","",function(){i.Hn(),setTimeout(function(){i.ps(i.us),i.Os()},500)},function(){i.ps(i.us),i.Os()})},500)}),i._s=t.jt,i._s.zoom=i.hs,i._s.pan={x:-100,y:-20},i._s.shift=0,i.xs=Array.from(Array(50)).map(function(t,i){return{x:200*i-1e3,y:600*Math.random()-300,speed:Math.random(),scale:.75+1.3*Math.random()}}),t.Lt(function(t){"m"==t.key&&i.ot.S.C()}),i}return ct(t,s),t.prototype.js=function(){this.ot.At._t(.2),this.ot.At.xt(1,5),this.ot.S.I(.7),this.ot.Rt(new t(this.ot))},t.prototype.ys=function(t){this.info(),this.ds.visible=!1,this.ws.visible=!1,t&&this.gs(),t||this.As()},t.prototype.Hn=function(){this.es.Qt(),vt(vt([],this.Ai,!0),this.os,!0).forEach(function(t){return t.Hn()}),this.Es()},t.prototype.Ms=function(t,i){var n=this;clearTimeout(this.Ss),this.Ss=setTimeout(function(){n.action.visible=!0,n.action.$n(t),n.Cs=i},500)},t.prototype.Ts=function(t,i,n,o,e,s){clearTimeout(this.Ss),this.ds.$n(t),this.ws.$n(i),this.info(n,o),this.ds.visible=!0,this.ws.visible=!0,this.gs=e,this.As=s},t.prototype.ks=function(t,i,n,o){this.Ts("YEAH","NOPE",t,i,n,o)},t.prototype.ls=function(){this.info(),this.action.visible=!1,this.Cs&&this.Cs()},t.prototype.Ls=function(){var t=this;this.Is=!0,this.F(this.es.vn()),setTimeout(function(){return t.Rs("Would you like to roll again?","The total is ".concat(t.Hs(),"..."),function(){return t.Y()})},500)},t.prototype.Ds=function(t,i,n){this.es.has("navigator")&&!this.Ns?(this.Ns=!0,this.Rs(t,0<this.os.length?i:"The total is ".concat(this.Hs(),"..."),n)):(n(),this.Ai=[])},t.prototype.Rs=function(t,i,n){var o=this;if(!this.es.gi)return this.Hs()<this.Ai.length?(this.Hn(),void setTimeout(function(){return o.Ds(t,i,n)},750)):void n();this.Ts("ROLL","KEEP",t,i,function(){o.Hn(),setTimeout(function(){return o.Ds(t,i,n)},750)},function(){n(),o.Ai=[]})},t.prototype.Y=function(){var t=this.Hs();if(13==t&&this.es.Gi(),13!=t&&0!=t)return this.es.un.gi&&1<this.es.un.vn()?(this.ot.S.tt(),this.info("Incoming ".concat(t," damage!"),"Select cargo taking the hit..."),void this.us.Qi(t)):void this.es.Y(t);this.Xi()},t.prototype.bs=function(){var t=this;this.F(2,-80,-40),this.action.visible=!1,this.info(),setTimeout(function(){t.info("Cast the dice once more?"),t.ds.visible=!0,t.ws.visible=!0},500)},t.prototype.Xi=function(){var t=this;this.Ns=!1,this.Ai=[],this.info(),this.Ps?this.Os():this.Us.Vi()&&!this.Ps?(this.Ps=!0,this.Us.X(),this.es=this.us,this.Ws(),setTimeout(function(){t.ot.S.J(),t.Rs("Victory! Nicely done!","Would you like to reroll the loot?",function(){t.Os(),t.Ys()})},750)):(this.es=this.es.un,!this.es.In()||this.es.un.In()?(this.es.pose(!0),this.qs()):setTimeout(function(){t.es.Gi(),t.ot.S.Z(),setTimeout(function(){return t.Xi()},500)},500))},t.prototype.Ws=function(){var t=this.Us.v.x-100,i=Math.min(this.level+1,6);this.os=[];for(var n=0;n<i;n++){var o=new rt(this.ot,t,300);o.F(t+120*n-.5*(i-1)*120,420),o.float(!0),o.Zi(!0),this.os.push(o)}vt([],this.os,!0).sort(T).slice(0,this.Bs()).forEach(function(t){return t.kn()})},t.prototype.Bs=function(){return Math.min((this.level-1)/3+1,3)},t.prototype.Ys=function(){this.info("Don't be greedy!","You can only take one...")},t.prototype.info=function(t,i,n){var o=this;void 0===i&&(i=""),void 0===n&&(n=""),this.fs.toggle(t=void 0===t?"":t),setTimeout(function(){o.cs.toggle(i),o.vs.toggle(n)},150)},t.prototype.Os=function(){var t=this;this.Ms("SET SAIL",function(){return t.Fs()})},t.prototype.Hs=function(){return this.Ai.reduce(function(t,i){return t+i.tn()},0)},t.prototype.qs=function(){var t=this;this.es.on=this.on,this.es.Vi()?(this.us.pose(!1),this.Us.pose(!0),this.ot.At.xt(0,5),this.info("Down to Davy Jones' Locker...","","GAME OVER"),this.Ms("TRY AGAIN?",function(){return t.js()}),setTimeout(function(){return t.us.X()},100)):this.es.gi?(this.Ms("SHOOT",function(){return t.Ls()}),this.es.pose(!0)):setTimeout(function(){return t.Ls()},1e3)},t.prototype.Fs=function(){var i=this;clearTimeout(this.Ss),this.us.pose(!1),this.Ns=!1,this.us.Tn(),this.Ps=!1,this.Ks=!1,this.es=this.us,this.level++,this.hs=.75,this._s.shift=0,this._s.pan.y=-25,this.us.K(),this.us.Qt(),this.action.$n(""),this.action.visible=!1,this.os.forEach(function(t){return t.Zi(!1)}),setTimeout(function(){i.Us=new st(i.ot,i.zs(),2e3*(i.level-1)+3e3,i,!1),i.us.un=i.Us,i.Us.un=i.us;for(var t=0;t<1+.5*(i.level-1);t++)i.Us.cn(new rt(i.ot,0,0));i.Us.Ln(i.Bs()-1)},4e3),setTimeout(function(){return i.Gs()},5e3)},t.prototype.zs=function(){return this.level>lt?"∞ × ".concat(this.level-lt):this.level%2==0?b(["VND","MRC","GIT","POO","SIN","CSS","ASH","CAP"]):(13-.5*(this.level-1)).toString()},t.prototype.Gs=function(){var i=this;if(this.zoom(),this.os=[],this.level%2==0&&this.level<=lt){this.Us.En=!0;var n=this.us.dn();if(this.level===lt)this.Us.hidden=!0,setTimeout(function(){i.zoom(),i.us.Ji(),i.us.pn("WIN"),i.us.pose(!0),i.ot.S.J(),i.info("You've defeated the whole 13th fleet!","","THE END?"),i.Os()},1e3);else switch(M(0,4-(this.us.Bi()?0:1))){case 0:this.Us.Cn(),setTimeout(function(){var t;i.ot.S.$(),null!=(t=i.Us)&&t.fi(),i.Os(),i.info("Ahoy mate! Interested in trade?",n?"I'll give you fresh cargo for your spice...":"Looks like you don't have any spice though..."),n&&(i.us.wn(),i.Ks=!0)},1e3);break;case 1:setTimeout(function(){var t;i.ot.S.$(),null!=(t=i.Us)&&t.fi(),i.Ts("ROLL","KEEP","Hello there mate!","Would you like to reroll all your cargo?",function(){i.us.Rn(),i.Vs()},function(){return i.Js()})},1e3);break;case 2:this.Us.hidden=!0,this.Os(),this.info("Free cargo floating in the drink!","A vessel must have sunken here..."),this.Ws();break;case 3:this.Us.xn(),setTimeout(function(){var t;i.ot.S.$(),null!=(t=i.Us)&&t.fi(),i.ks("Ahoy! I could plate one of your cargo!","It'll only be able to receive 1 damage at a time....",function(){i.us.xn(),i.Vs()},function(){return i.Js()})},1e3);break;case 4:this.Us.Dn();var o=this.Us.Ni(-70,-100);o.ui=this.us.Bi(),this.Us.Fi(o),setTimeout(function(){var t;i.ot.S.$(),null!=(t=i.Us)&&t.fi(),i.ks("Oi! Want to hire this ".concat(o.ui,"?"),o.oi(),function(){i.Us.qi(),i.us.Fi(o.clone()),i.Vs()},function(){return i.Js()})},1e3)}}else 25==this.level&&this.Us.Ji(),25<=this.level&&this.Qs(2),13<this.level&&this.Qs(1),this.Us.Di.face.Jt=!0,setTimeout(function(){i.info("Man the cannons! Battle stations!","There's no parley in sight..."),i.Us.zi(b(["FILTHY RAT","HOW DARE YOU","YOU TRAITOR","LAND LUBBER"])),i.ot.S.warn()},1e3),setTimeout(function(){return i.qs()},2e3)},t.prototype.Qs=function(t){for(var i=0;i<t;i++){var n=this.Us.Ni(-70,-100);n.face.Jt=!0,n.ui=this.Us.Bi(),this.Us.Fi(n.clone())}},t.prototype.Vs=function(){var t=this;this.Us.Qt(),this.info("All aboard, you're good to go!","May that steer you true..."),setTimeout(function(){return t.Xs()},500)},t.prototype.Xs=function(){this.Us.K(-1),this.Os()},t.prototype.Js=function(){this.Us.Qt(),this.info("Aye, all set!","Fair winds on your voyage..."),this.Xs()},t.prototype.W=function(t){var i=this;this.Ks&&(this.ot.S.W(),t.Zi(!1),this.Us._n(t.tn()),this.us.remove(t),this.us.sn(),setTimeout(function(){i.us.dn()&&i.Us.On()||(i.Ks=!1,i.us.Tn(),i.Vs())},500))},t.prototype.zoom=function(){var t=null==(t=this.us)?void 0:t.Sn(),i=null!=(i=null==(i=this.Us)?void 0:i.Sn())?i:0,n=Math.max(t,i);this.hs=Math.min(750/(1500+t+i),.5),this._s.pan.y=220+n-100/this._s.zoom,this._s.shift=100-t+i*this.hs*.25},t.prototype.ps=function(n){var o=this;n.Qt(),this.ot.S.W(),this.Ai.forEach(function(t,i){return t.move(c(n.an(i+n.vn()),o.us.v.x,o.us.v.y),function(){return n.cn(t)})}),setTimeout(function(){o.Ai=[]},300)},t.prototype.F=function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.es.Qt();var o=0;this.Ai=[];for(var e=0;e<t;e++){0<e&&e%9==0&&o++;var s=this.es.An(),r=new rt(this.ot,s,800,this.Is);r.F(s+i+120*e-.5*Math.min(t-1,9)*120-1080*Math.floor(e/9),450+120*o+n),this.Ai.push(r)}this.Es()},t.prototype.Es=function(){var t=this;setTimeout(function(){t.Ai.some(function(t){return 0===t.tn()})&&t.es.Wi()},500)},t.prototype.Ct=function(){return[this.action,this.ds,this.ws]},t.prototype.update=function(i,n){var t,o,e=this;s.prototype.update.call(this,i,n),1e3<this.delta||(this.si=Math.sin(3e-4*i),this.Zs=Math.sin(7e-4*i),vt(vt(vt([this.on,this.us,this.Us],this.Ai,!0),[this.fs,this.cs,this.vs],!1),this.Ct(),!0).filter(function(t){return!!t}).forEach(function(t){return t.update(i,n)}),this.os.forEach(function(t){return t.update(i,e.$s)}),this.$s=at({},n),t=this.us.v.x-this._s.pan.x-400+2*this._s.shift,10<Math.abs(t)&&(this.rs+=Math.sign(t)),this._s.pan.x+=.05*this.rs*this.delta,this.rs*=.9,t=this.hs-this._s.zoom,.01<Math.abs(t)&&(this._s.zoom+=.0075*Math.sign(t)*.05*this.delta),0<this.os.length&&n.It&&(o=this.os.find(function(t){return t.bn()}))&&(this.Ys(),this.ot.S.W(),this.ds.visible=!1,this.ws.visible=!1,this.os.forEach(function(t){return t.Zi(!1)}),o.float(!1),o.move(c(this.us.an(this.us.vn()),this.us.v.x,this.us.v.y),function(){return e.us.cn(o)}),this.us.Qt(),setTimeout(function(){e.os=e.os.filter(function(t){return t!=o}),e.Os()},300)))},t.prototype.dt=function(i){var n=this,t=100*Math.floor(this._s.pan.x/100)-500-this._s.shift;i.strokeStyle="#0000ff11",i.lineWidth=45+10*this.ct,i.lineCap="round",i.setLineDash([0,35]);for(var o,e=0;e<60;e++)i.save(),i.translate(t+100*e-500,0),i.rotate(.25*Math.PI),i.beginPath(),i.moveTo(e,-2e3),i.lineTo(e,5e3),i.stroke(),i.restore();for(this.xs.forEach(function(t){i.lineWidth=100*t.scale,i.setLineDash([0,80*t.scale]),i.beginPath(),i.strokeStyle="#ffffff22",i.ellipse(t.x,t.y,140*t.scale,30*t.scale,0,0,2*Math.PI),i.stroke(),t.x-=t.speed*n.delta*.03,t.x<n._s.pan.x-1e3&&(t.x=n._s.pan.x+2500+1e3*Math.random())}),i.setLineDash([]),i.strokeStyle="#000",i.lineWidth=7,null!=(o=this.Us)&&o.dt(i),this.us.dt(i),this.on.dt(i),this.os.forEach(function(t){return t.dt(i)}),i.strokeStyle="#ffffffbb",i.fillStyle="#03fcf477",i.beginPath(),i.moveTo(3e3+t,2e3),i.lineTo(t,2e3),i.lineTo(t,500+5*this.ct),e=0;e<120;e++){var s=8*Math.sin(t+50*e+25*this.si)+8*Math.cos(t+25*e+12*this.Zs)+20;i.quadraticCurveTo(t+50*e-25,525-5*this.ct-s,t+50*e,500+7*this.ct-s)}i.fill(),i.stroke(),vt(vt([],this.Ai,!0),this.Dt(),!0).forEach(function(t){return t.dt(i)}),this.$s&&(o=new DOMPoint(this.$s.x,this.$s.y).matrixTransform(i.getTransform().inverse()),this.$s={x:o.x,y:o.y}),i.resetTransform(),vt([this.fs,this.cs,this.vs],this.Ct(),!0).forEach(function(t){return t.dt(i)})},t}(A),yt=800,wt=400,mt=document.createElement("canvas"),Mt=mt.getContext("2d"),bt={x:0,y:0},Tt=new o(!1),pt=(Tt.k(),Tt.play(),new x(Tt,mt)),Ot=(pt.St=new dt(pt),mt.id="game",mt.width=yt,mt.height=wt,document.body.appendChild(mt),1),_t=0,xt=0,jt=function(){Ot=Math.min(window.innerWidth/yt,window.innerHeight/wt),mt.style.transformOrigin="top left",_t=.5*(window.innerWidth-yt*Ot),xt=.5*(window.innerHeight-wt*Ot),mt.style.transform="translate(".concat(_t,"px,").concat(xt,"px) scale(").concat(Ot,")")},gt=(jt(),window.onresize=jt,!1),At=(document.onfullscreenchange=function(){return gt=!gt},document.onmousemove=function(t){bt.x=gt?(t.offsetX-_t)/Ot:t.offsetX,bt.y=gt?(t.offsetY-xt)/Ot:t.offsetY},document.onkeydown=function(t){Tt.play(),pt.pressed(t)},document.onmousedown=function(){Tt.play(),bt.It=!0,pt.click(bt)},function(t){requestAnimationFrame(At),Mt.resetTransform(),pt.update(t,bt),pt.dt(Mt)});requestAnimationFrame(At)</script>