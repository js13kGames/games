<!DOCTYPE html><html><title>Feast Night - js13kGames 2023</title><style type="text/css">.text {position:absolute;width: 100%;z-index: 1;font-size: 200%;font-family: consolas;color: orange;text-align:center;}mark{color:white;background:transparent;}</style><body><img src="data:image/png;base64,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" id=tileset hidden><div id="upper" class="text" style="bottom:5%;"></div><script>var e=function(){var e,t={create:function(t){t=t||{};var r=document.createElement("canvas");r.width=800,r.height=600,"alpha"in t||(t.alpha=!1);try{e=r.getContext("webgl",t)}catch(e){}try{e=e||r.getContext("experimental-webgl",t)}catch(e){}if(!e)throw new Error("WebGL not supported");return r.addEventListener("click",async()=>{await r.requestPointerLock()}),function(){e.MODELVIEW=1|a,e.PROJECTION=2|a;var t=new i,r=new i;e.modelviewMatrix=new i,e.projectionMatrix=new i;var o,n,s=[],u=[];e.matrixMode=function(t){switch(t){case e.MODELVIEW:o="modelviewMatrix",n=s;break;case e.PROJECTION:o="projectionMatrix",n=u;break;default:throw new Error("invalid matrix mode "+t)}},e.loadIdentity=function(){i.identity(e[o])},e.loadMatrix=function(t){for(var r=t.m,n=e[o].m,a=0;a<16;a++)n[a]=r[a]},e.multMatrix=function(t){e.loadMatrix(i.multiply(e[o],t,r))},e.perspective=function(r,o,n,a){e.multMatrix(i.perspective(r,o,n,a,t))},e.scale=function(r,o,n){e.multMatrix(i.scale(r,o,n,t))},e.translate=function(r,o,n){e.multMatrix(i.translate(r,o,n,t))},e.rotate=function(r,o,n,a){e.multMatrix(i.rotate(r,o,n,a,t))},e.pushMatrix=function(){n.push(Array.prototype.slice.call(e[o].m))},e.popMatrix=function(){var t=n.pop();e[o].m=new Float32Array(t)},e.matrixMode(e.MODELVIEW)}(),function(){var t=e,r=0,a=0,i={},s=!1,u=Object.prototype.hasOwnProperty;function l(){for(var e in i)if(u.call(i,e)&&i[e])return!0;return!1}function c(t){var o={};for(var n in t)"function"==typeof t[n]?o[n]=function(e){return function(){e.apply(t,arguments)}}(t[n]):o[n]=t[n];o.touches&&o.touches[0]?(o.x=o.touches[0].pageX,o.y=o.touches[0].pageY,o.mx=0,o.my=0):(o.x=o.pageX,o.y=o.pageY,o.mx=o.movementX,o.my=o.movementY),o.original=t;for(var i=e.canvas;i;i=i.offsetParent)o.x-=i.offsetLeft,o.y-=i.offsetTop;return s?(o.deltaX=o.x-r,o.deltaY=o.y-a):(o.deltaX=0,o.deltaY=0,s=!0),r=o.x,a=o.y,o.dragging=l(),o.preventDefault=function(){o.original.preventDefault()},o.stopPropagation=function(){o.original.stopPropagation()},o}function f(r){e=t,l()||(o(document,"mousemove",h),o(document,"mouseup",d),n(e.canvas,"mousemove",h),n(e.canvas,"mouseup",d)),i[r.which]=!0,r=c(r),e.onmousedown&&e.onmousedown(r),r.preventDefault()}function h(r){e=t,r=c(r),e.onmousemove&&e.onmousemove(r),r.preventDefault()}function d(r){e=t,i[r.which]=!1,l()||(n(document,"mousemove",h),n(document,"mouseup",d),n(document,"touchmove",h),n(document,"touchend",d),o(e.canvas,"mousemove",h),o(e.canvas,"mouseup",d),o(e.canvas,"touchmove",h),o(e.canvas,"touchend",d)),r=c(r),e.onmouseup&&e.onmouseup(r),r.preventDefault()}function m(){s=!1}o(e.canvas,"mousedown",f),o(e.canvas,"mousemove",h),o(e.canvas,"mouseup",d),o(e.canvas,"mouseover",m),o(e.canvas,"mouseout",m),o(e.canvas,"touchstart",f),o(e.canvas,"touchmove",h),o(e.canvas,"touchend",d),o(e.canvas,"touchcancel",d),o(document,"contextmenu",function(){i={},s=!1})}(),e.animate=function(){var t=(new Date).getTime(),r=e;!function o(){e=r;var n=(new Date).getTime();e.onupdate&&e.onupdate((n-t)/1e3),e.ondraw&&e.ondraw(),window.requestAnimationFrame(o),t=n}()},e.fullscreen=function(t){var r=(t=t||{}).paddingTop||0,n=t.paddingLeft||0,a=t.paddingRight||0,i=t.paddingBottom||0;function s(){e.canvas.width=window.innerWidth-n-a,e.canvas.height=window.innerHeight-r-i,e.viewport(0,0,e.canvas.width,e.canvas.height),!t.camera&&"camera"in t||(e.matrixMode(e.PROJECTION),e.loadIdentity(),e.perspective(t.fov||90,e.canvas.width/e.canvas.height,t.near||.01,t.far||1e3),e.matrixMode(e.MODELVIEW)),e.ondraw&&e.ondraw()}document.body.appendChild(e.canvas),document.body.style.overflow="hidden",e.canvas.style.position="absolute",e.canvas.style.left=n+"px",e.canvas.style.top=r+"px",o(window,"resize",s),s()},e},keys:{},Matrix:i,Buffer:s,Mesh:l,Shader:h,Texture:m,Vector:p};function r(e){return{32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[e]||(e>=65&&e<=90?String.fromCharCode(e):null)}function o(e,t,r){e.addEventListener(t,r)}function n(e,t,r){e.removeEventListener(t,r)}o(document,"keydown",function(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey){var o=r(e.keyCode);o&&(t.keys[o]=!0),t.keys[e.keyCode]=!0}}),o(document,"keyup",function(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey){var o=r(e.keyCode);o&&(t.keys[o]=!1),t.keys[e.keyCode]=!1}});var a=305397760;function i(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=new Float32Array(e)}function s(e,t){this.buffer=null,this.target=e,this.type=t,this.data=[]}function l(e){e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),"triangles"in e&&!e.triangles||this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")}function c(e,t,r){for(;null!=(result=e.exec(t));)r(result)}i.prototype={multiply:function(e){return i.multiply(this,e,new i)}},i.multiply=function(e,t,r){r=r||new i;var o=e.m,n=t.m,a=r.m;return a[0]=o[0]*n[0]+o[1]*n[4]+o[2]*n[8]+o[3]*n[12],a[1]=o[0]*n[1]+o[1]*n[5]+o[2]*n[9]+o[3]*n[13],a[2]=o[0]*n[2]+o[1]*n[6]+o[2]*n[10]+o[3]*n[14],a[3]=o[0]*n[3]+o[1]*n[7]+o[2]*n[11]+o[3]*n[15],a[4]=o[4]*n[0]+o[5]*n[4]+o[6]*n[8]+o[7]*n[12],a[5]=o[4]*n[1]+o[5]*n[5]+o[6]*n[9]+o[7]*n[13],a[6]=o[4]*n[2]+o[5]*n[6]+o[6]*n[10]+o[7]*n[14],a[7]=o[4]*n[3]+o[5]*n[7]+o[6]*n[11]+o[7]*n[15],a[8]=o[8]*n[0]+o[9]*n[4]+o[10]*n[8]+o[11]*n[12],a[9]=o[8]*n[1]+o[9]*n[5]+o[10]*n[9]+o[11]*n[13],a[10]=o[8]*n[2]+o[9]*n[6]+o[10]*n[10]+o[11]*n[14],a[11]=o[8]*n[3]+o[9]*n[7]+o[10]*n[11]+o[11]*n[15],a[12]=o[12]*n[0]+o[13]*n[4]+o[14]*n[8]+o[15]*n[12],a[13]=o[12]*n[1]+o[13]*n[5]+o[14]*n[9]+o[15]*n[13],a[14]=o[12]*n[2]+o[13]*n[6]+o[14]*n[10]+o[15]*n[14],a[15]=o[12]*n[3]+o[13]*n[7]+o[14]*n[11]+o[15]*n[15],r},i.identity=function(e){var t=(e=e||new i).m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},i.perspective=function(e,t,r,o,n){var a=Math.tan(e*Math.PI/360)*r,s=a*t;return i.frustum(-s,s,-a,a,r,o,n)},i.frustum=function(e,t,r,o,n,a,s){var u=(s=s||new i).m;return u[0]=2*n/(t-e),u[1]=0,u[2]=(t+e)/(t-e),u[3]=0,u[4]=0,u[5]=2*n/(o-r),u[6]=(o+r)/(o-r),u[7]=0,u[8]=0,u[9]=0,u[10]=-(a+n)/(a-n),u[11]=-2*a*n/(a-n),u[12]=0,u[13]=0,u[14]=-1,u[15]=0,s},i.scale=function(e,t,r,o){var n=(o=o||new i).m;return n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,o},i.translate=function(e,t,r,o){var n=(o=o||new i).m;return n[0]=1,n[1]=0,n[2]=0,n[3]=e,n[4]=0,n[5]=1,n[6]=0,n[7]=t,n[8]=0,n[9]=0,n[10]=1,n[11]=r,n[12]=0,n[13]=0,n[14]=0,n[15]=1,o},i.rotate=function(e,t,r,o,n){if(!e||!t&&!r&&!o)return i.identity(n);var a=(n=n||new i).m,s=Math.sqrt(t*t+r*r+o*o);e*=Math.PI/180,t/=s,r/=s,o/=s;var u=Math.cos(e),l=Math.sin(e),c=1-u;return a[0]=t*t*c+u,a[1]=t*r*c-o*l,a[2]=t*o*c+r*l,a[3]=0,a[4]=r*t*c+o*l,a[5]=r*r*c+u,a[6]=r*o*c-t*l,a[7]=0,a[8]=o*t*c-r*l,a[9]=o*r*c+t*l,a[10]=o*o*c+u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n},s.prototype={compile:function(t){for(var r=[],o=0;o<this.data.length;o+=1e4)r=Array.prototype.concat.apply(r,this.data.slice(o,o+1e4));var n=this.data.length?r.length/this.data.length:0;if(n!=Math.round(n))throw new Error("buffer elements not of consistent size, average size is "+n);this.buffer=this.buffer||e.createBuffer(),this.buffer.length=r.length,this.buffer.spacing=n,e.bindBuffer(this.target,this.buffer),e.bufferData(this.target,new this.type(r),t||35044)}},l.prototype={addVertexBuffer:function(e,t){(this.vertexBuffers[t]=new s(34962,Float32Array)).name=e,this[e]=[]},addIndexBuffer:function(e){this.indexBuffers[e]=new s(34963,Uint16Array),this[e]=[]},compile:function(){for(var e in this.vertexBuffers)(r=this.vertexBuffers[e]).data=this[r.name],r.compile();for(var t in this.indexBuffers){var r;(r=this.indexBuffers[t]).data=this[t],r.compile()}}},l.bd=function(e,t,r,o,n,a){var i=new l({coords:!0});return n=n||1,a=a||1,e/=128,t/=128,r/=128,o/=128,i.vertices=[[-1*n,-1*a,0],[1*n,-1*a,0],[-1*n,1*a,0],[1*n,1*a,0]],i.coords=[[e,t],[r,t],[e,o],[r,o]],i.triangles=[[0,1,2],[2,1,3]],i.compile(),i},l.bo=function(e,t){e=e||0;var r=new l({coords:!0}),o=t.includes("G"),n=t.includes("C"),a=t.includes("B"),i=t.includes("L"),s=t.includes("R"),c=t.includes("F"),f=(128-16*e)/128,h=f-.125;u=f,f=h,h=u,r.vertices=[],r.coords=[],r.triangles=[],o&&(r.vertices.push([-1,0,-1],[1,0,-1],[-1,0,1],[1,0,1]),r.coords.push([0,h],[.125,h],[0,f],[.125,f])),n&&(r.vertices.push([-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]),r.coords.push([.125,h],[.25,h],[.125,f],[.25,f])),a&&(r.vertices.push([-1,0,-1],[1,0,-1],[-1,1,-1],[1,1,-1]),r.coords.push([.25,h],[.5,h],[.25,f],[.5,f])),i&&(r.vertices.push([-1,0,-1],[-1,0,1],[-1,1,-1],[-1,1,1]),r.coords.push([.5,h],[.75,h],[.5,f],[.75,f])),s&&(r.vertices.push([1,0,-1],[1,0,1],[1,1,-1],[1,1,1]),r.coords.push([.75,h],[1,h],[.75,f],[1,f])),c&&(r.vertices.push([-1,0,1],[1,0,1],[-1,1,1],[1,1,1]),r.coords.push([1,h],[.75,h],[1,f],[.75,f]));for(var d=0,m=0;m<t.length;m++)d=4*m,r.triangles.push([0+d,1+d,2+d],[2+d,1+d,3+d]);return r.compile(),r};var f="LIGHTGL";function h(t,r){function o(e){var t=document.getElementById(e);return t?t.text:e}var n="    uniform mat4 gl_ModelViewProjectionMatrix;  ",a=n+"    attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;  ",i="    precision highp float;  "+n,s=(t=o(t))+(r=o(r)),u={};function l(e,t){var r={},o=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t);return t=o?o[1]+e+t.substr(o[1].length):e+t,c(/\bgl_\w+\b/g,e,function(e){e in r||(t=t.replace(new RegExp("\\b"+e+"\\b","g"),f+e),r[e]=!0)}),t}function h(t,r){var o=e.createShader(t);if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("compile error: "+e.getShaderInfoLog(o));return o}if(c(/\b(gl_[^;]*)\b;/g,n,function(e){var t=e[1];if(-1!=s.indexOf(t)){var r=t.replace(/[a-z_]/g,"");u[r]=f+t}}),-1!=s.indexOf("ftransform")&&(u.MVPM=f+"gl_ModelViewProjectionMatrix"),this.usedMatrices=u,t=l(a,t),r=l(i,r),this.program=e.createProgram(),e.attachShader(this.program,h(35633,t)),e.attachShader(this.program,h(35632,r)),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw new Error("link error: "+e.getProgramInfoLog(this.program));this.attributes={},this.uniformLocations={};var d={};c(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,t+r,function(e){d[e[2]]=1}),this.isSampler=d}function d(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t}function m(t,r,o){o=o||{},this.id=e.createTexture(),this.width=t,this.height=r,this.format=o.format||6408,this.type=o.type||5121;var n=o.filter||o.magFilter||9728,a=o.filter||o.minFilter||9728;e.bindTexture(3553,this.id),e.pixelStorei(37440,1),e.texParameteri(3553,10240,n),e.texParameteri(3553,10241,a),e.texParameteri(3553,10242,o.wrap||o.wrapS||33071),e.texParameteri(3553,10243,o.wrap||o.wrapT||33071),e.texImage2D(3553,0,this.format,t,r,0,this.format,this.type,o.data||null)}function p(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}return new i,new i,h.prototype={uniforms:function(t){for(var r in e.useProgram(this.program),t){var o=this.uniformLocations[r]||e.getUniformLocation(this.program,r);if(o){this.uniformLocations[r]=o;var n=t[r];if(n instanceof p?n=[n.x,n.y,n.z]:n instanceof i&&(n=n.m),a=n,"[object Array]"==(s=Object.prototype.toString.call(a))||"[object Float32Array]"==s)switch(n.length){case 1:e.uniform1fv(o,new Float32Array(n));break;case 2:e.uniform2fv(o,new Float32Array(n));break;case 3:e.uniform3fv(o,new Float32Array(n));break;case 4:e.uniform4fv(o,new Float32Array(n));break;case 9:e.uniformMatrix3fv(o,!1,new Float32Array([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]]));break;case 16:e.uniformMatrix4fv(o,!1,new Float32Array([n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]]));break;default:throw new Error("don't know how to load uniform \""+r+'" of length '+n.length)}else{if(!d(n))throw new Error('attempted to set uniform "'+r+'" to invalid value '+n);(this.isSampler[r]?e.uniform1i:e.uniform1f).call(e,o,n)}}}var a,s;return this},draw:function(t,r){this.drawBuffers(t.vertexBuffers,t.indexBuffers[r==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:r)},drawBuffers:function(t,r,o){var n=this.usedMatrices,a=e.modelviewMatrix,i=e.projectionMatrix,s=n.MVPM?i.multiply(a):null,u={};n.MVPM&&(u[n.MVPM]=s),this.uniforms(u);var l=0;for(var c in t){var h=t[c],d=this.attributes[c]||e.getAttribLocation(this.program,c.replace(/^(gl_.*)$/,f+"$1"));-1!=d&&h.buffer&&(this.attributes[c]=d,e.bindBuffer(34962,h.buffer),e.enableVertexAttribArray(d),e.vertexAttribPointer(d,h.buffer.spacing,5126,!1,0,0),l=h.buffer.length/h.buffer.spacing)}for(var c in this.attributes)c in t||e.disableVertexAttribArray(this.attributes[c]);return!l||r&&!r.buffer||(r?(e.bindBuffer(34963,r.buffer),e.drawElements(o,r.buffer.length,5123,0)):e.drawArrays(o,0,l)),this}},m.prototype={bind:function(t){e.activeTexture(33984+(t||0)),e.bindTexture(3553,this.id)}},m.fromImage=function(t,r){r=r||{};var o=new m(t.width,t.height,r);try{e.texImage2D(3553,0,o.format,o.format,o.type,t)}catch(e){console.log("no texture")}return o},p.prototype={add:function(e){return e instanceof p?new p(this.x+e.x,this.y+e.y,this.z+e.z):new p(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof p?new p(this.x-e.x,this.y-e.y,this.z-e.z):new p(this.x-e,this.y-e,this.z-e)}},t}();!function(){var t=e.create(),r=0,o=0,n=-1,a=new e.Vector(0,-.45,-1),i=angleY=0,s=0,u=0,l=[.26,.26],c=0,f=-7,h=0,d=0,m=!0,p=.016,v=0,y=0,x=!1,g=!1,b=null,w=null,M=0,E=0,I=0,k=10,S=!0,z=null,T=!1,A=0,D=e.Mesh.bo(0,"LRGCFB"),F=e.Mesh.bo(0,"F"),O=e.Mesh.bo(1,"C"),L=[],B=[e.Mesh.bd(64,0,79,31,.13,.3),e.Mesh.bd(0,0,15,31,.13,.3),e.Mesh.bd(16,0,31,31,.13,.3),e.Mesh.bd(32,0,47,31,.13,.3),e.Mesh.bd(48,0,63,31,.13,.3),e.Mesh.bd(80,0,95,31,.13,.3),e.Mesh.bd(96,0,111,31,.13,.3),e.Mesh.bd(112,0,128,31,.13,.3),e.Mesh.bd(0,80,15,95,.22,.22),e.Mesh.bd(32,80,63,96,1,.5),e.Mesh.bd(0,64,79,80,1,.3),e.Mesh.bd(112,64,128,95,.35,.7),e.Mesh.bd(96,64,112,95,.35,.7),e.Mesh.bd(80,63,95,79,.2,.2),e.Mesh.bd(64,96,96,112,1,.5),e.Mesh.bd(32,96,64,112,1,.5),e.Mesh.bo(1,"G"),e.Mesh.bo(2,"LC")];null===localStorage.getItem("_feast_night_runs_")?(A=0,localStorage.setItem("_feast_night_runs_","0")):A=parseInt(localStorage.getItem("_feast_night_runs_"));var P=0;mo=function(t,r,o,n,a,i,s,u,l,c,f,h){if(0==r&&++y>100)return null;var d={m:null!=t?B[t]:null,v:1,p:new e.Vector(o,n,a),d:new e.Vector(i,s,u),mn:new e.Vector(0,0,0),mx:new e.Vector(0,0,0),t:r,a:0,x:l,y:c,n:f,o:h,h:0,l:1,s:1,f:0};return L.push(d),d};var C=[["Is God with you, Father?","Good! I have a message<br>from his Son...","THEN YOU ARE MINE",2],["Does Hell exist?","It does, indeed","No? LET ME SHOW YOU",2],["Will you punish me for killing that little...?","I knew you'd fall with me...","BUT I DESERVE TO BE PUNISHED!",2],["SINNERS, THEY ARE ALL SINNERS!","Yes? Yes we are... ","Let's change that",4],["Come drink with me, father!","YES, THE BLOOD OF THE INNOCENT,<br>DRINK FATHER, DRINK!","Piss off!",3],["I saw gold... over there...<br>can we take it, Father?","Yes, YES! It's over there, it's...","No? But I'm tired of eating shit...",3],["Are...are you drunk Father? Like me?","I ~burp~ knew it!","~burp~",3],["Dance with me, Father!","Yes! Let's dance NOW","Boring!",3],["EAT FATHER, EAT EAT EAT!","Like it? Tastes like FLESH","FORGIVE ME FATHER, HE MADE ME DO IT!",3],["Will you go to Heaven?","Lying is a sin, Father!","Ha! I knew it!",3],["Do you repent, Father?","So you are truly a man of God...","Perhaps you should...",1],["Oh Father, I'm so drunk...<br>Can you help me?","God bless you Father!","Not even a priest helps me...",1],["All I wanted was to fly to the Sun...","We are much alike, Father. I like that","Does God forbid it, or men?",1],["Is God blue?","Nice!","No? But then why is the sky blue...?",1]],N="<br><br><mark>[press space]</mark>",R=[["Brother Doen!<br>Do you know what's your mission tonight?<br><br><mark>[NOD or SHAKE to answer]</mark>","Well then... good luck out there<br>Sin is everywhere, specially on a..."+N,"Help our people! Follow the Moon<br>and purify the souls of the Sinners this..."+N,0],["Wasn't expecting you so soon...<br>Do you know why are you here now?","DIES IRAE, BROTHER!<br>Now get out. PURIFY YOUR SOUL"+N,"Well, it's easy: save FIVE souls<br>and survive God's judgement"+N,0],["Did you meet God out there?","Don't you think that meeting God would<br>free you from this loop?","I bet you didn't. But I'm sure<br>you saw plenty of lost souls...like you",0],["What a glorious DIES IRAE!<br>Do you know what it is?","Then why you don't escape your Judgement?","Your Judgement, brother Doen!",0],["Aren't you a bit bored already?","THEN ESCAPE!<br>Go, save someone. FIVE souls!","Good thing, good thing!<br>I might even like you",0],["Do you know me, Brother Doen?","Ah! Are you sure?<br>Really sure?","Call me... Peter ~wink wink~",0],["Still here! What was it this time?<br>Demons? Wolves? Ale?","Demons out there?<br>It's just people!","None of those? Well, don't lose faith:<br>follow the moon, purify your soul...blah blah",0],["Once more: true purification comes<br>from loving and caring. Ok?","Good. Now get out there and<br>save FIVE souls!","~SIGH~",0],["Do you know how many were Judged already?","Then stop making me waste my time!<br>Save your Soul...or stay in hell FOREVER","A LOT OF THEM!<br>I cannot stay with you for eternity, Doen...",0],["Ten times. Do you know that?","Then escape already. Time's almost up, Doen","Ten times you failed your Judgement! ARGH!",0],["I'm sorry, Doen... but you failed<br>You will be trapped here now. Forever","Use your time wisely<br>and FREE YOURSELF. Goodbye, my friend","I never thought it would end like this. Goodbye, my friend",0]],_=!1;A>=11&&(A=10,_=!0);var V=mo(17,5,.2,-.2,-.18,0,0,0),Y=mo(null,4,0,0,0,.25,.25,.25),G=mo(8,1,1e5,.3,1e5,.25,.25,.25),H=mo(10,2,0,.5,0,0,0,0);priest=mo(0,0,0,.3,0,.015,.3,.05,R[A][0],R[A][1],R[A][2],R[A][3]),V.s=.07,V.v=Y.v=H.v=H.l=0,A++,_&&(A=12),localStorage.setItem("_feast_night_runs_",""+A),text=function(e){""!=e&&(M=0),document.getElementById("upper").innerHTML=e},ttc=function(e){document.getElementById("upper").style.color=e},rn=function(e,t){return Math.random()*(t-e+1)+e},clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},ow=function(){var e=0,t=[1,5,7,3,6,4,2],r=mo(16,2,0,0,0,0,0,0);for(mn=mo(15,2,0,2,-50,.5,.5,.5),ctl=mo(9,2,0,.75,-40,.5,.5,.5),r.s=100,mn.s=2,ctl.s=1.5,e=0;e<140;e++){var o=11;rn(0,100)<50&&o++,mo(o,3,rn(-3,-.5),.6,-.3*e,.015,.5,.015),mo(o,3,rn(.5,3),.6,-.3*e,.015,.5,.015),mo(o,3,rn(-6,-4),.6,4-.3*e,.015,.5,.015),mo(o,3,rn(4,6),.6,4-.3*e,.015,.5,.015),mo(13,2,rn(-3,-.25),.1,2-.3*e,.05,.2,.05),mo(13,2,rn(.25,3),.1,2-.3*e,0,0,0)}var n=0;for(e=t.length-1;e>=0;e--){var a=t.splice(Math.floor(Math.random()*t.length),1),i=C[n+Math.floor(rn(0,1))];mo(a[0],0,rn(-1.25,1.25),.3,-3*e-rn(0,1),.015,.3,.05,i[0],i[1],i[2],i[3]).over=2,n+=2}};var U=e.Texture.fromImage(tileset),W=new e.Shader("        varying vec2 coord;        varying vec4 pos;        void main() {            coord = gl_TexCoord.xy;            gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;            pos = gl_Position;        }        ","        uniform sampler2D texture;        uniform float factor;        uniform float over;        uniform vec2 sky;        varying vec2 coord;        varying vec4 pos;        float fogf(float d) {            const float LOG2 = -1.442695;            return 1.0 - clamp(exp2(d*d*LOG2), 0.0, 1.0);        }        void main() {            vec4 os = texture2D(texture, coord);            vec4 ms = texture2D(texture, coord + vec2(0.0, 0.25));            os = mix(os, ms, factor);            if(os.a < 0.8) discard;            float fog = fogf(gl_FragCoord.z/gl_FragCoord.w * 0.5);            float d = (1.0 / distance(vec4(0.0, 0.0, 0.0, 0.0), pos)) * (over - 1.0);            gl_FragColor = mix(os, vec4(sky.x, 0.26, sky.y, 1.0), fog) + (vec4(0.87, 0.46, 0.051, 1.0) * d);            if(os.r > 0.9 && os.g > 0.9) gl_FragColor = os;        }        ");zfx=function(){z=(e=1,t=.05,r=220,o=0,n=0,a=.1,i=0,s=1,u=0,l=0,c=0,f=0,h=0,d=0,m=0,p=0,v=0,y=1,x=0,g=0,b=Math,w=44100,M=2*b.PI,E=(u*=500*M/w/w),I=(r*=(1-t+2*t*b.random(t=[]))*M/w),k=0,S=0,z=0,T=1,A=0,D=0,F=0,O,L)=>{for(l*=500*M/w**3,m*=M/w,c*=M/w,f*=w,h=w*h|0,L=(o=w*o+9)+(x*=w)+(n*=w)+(a*=w)+(v*=w)|0;z<L;t[z++]=F)++D%(100*p|0)||(F=i?1<i?2<i?3<i?b.sin((k%M)**3):b.max(b.min(b.tan(k),1),-1):1-(2*k/M%2+2)%2:1-4*b.abs(b.round(k/M)-k/M):b.sin(k),F=(h?1-g+g*b.sin(M*z/h):1)*(0<F?1:-1)*b.abs(F)**s*.3*e*(z<o?z/o:z<o+x?1-(z-o)/x*(1-y):z<o+x+n?y:z<L-v?(L-z-v)/a*y:0),F=v?F/2+(v>z?0:(z<L-v?1:(L-z)/v)*t[z-v|0]/2):F),k+=(O=(r+=u+=l)*b.cos(m*S++))-O*d*(1-1e9*(b.sin(z)+1)%2),T&&++T>f&&(r+=c,I+=c,T=0),!h||++A%h||(r=I,u=E,T||=1);return(e=zzfxX.createBuffer(1,L,w)).getChannelData(0).set(t),(r=zzfxX.createBufferSource()).buffer=e,r.connect(zzfxX.destination),r.start(),r},zzfxX=new AudioContext,m=!1};const j=[[2.01,.3,111,,.08,.3,3,,-5,.6,,.01,.11,.2,-1,.3,.03,.74,.02],[2,.2,100,.01,.02,.02,,1.9,-7.4,,,,.07,1.5,,,.1,,.08,.47],[2,,528,.01,,.48,,.6,-11.6,,,,.32,4.2],[2,,11,,2,3,,,,,55,.22,.03,,22,,.15,,1],[2,.15,555,,,.02,,1.13,,,,,,.2,-131,,,,,.01],[2,,250,,.08,.06,1,.5,-4,-1,,,,.1,,,.04,.62,.08],[1.27,,5555,.01,.08,.08,4,2.57,,.1,-50,.02,.01,2,-1,,,.37,.08,.01],[1.94,,1,,2,2,1,1.08,1.5,-.4,,,,,33,.1,.06,.61,1,.46],[1.99,.1,1429,,.02,.2,,.73,,-2,25,.02,,,,,.07,.73,.04,.08],[2.01,,90,.01,.06,.06,,1.12,7.9,.7,,,.03,,,,.19,.83,.07],[2,,177,.12,.01,0,,2.48,,31,,,.07,,,,.2,.6,.01]];sfx=function(e){document.hasFocus()&&z(...j[e])};var K=0,X=0,J=[1,0,1,1,1,0,2,0,1,0,1,0,1,0,2,0];msx=function(e){document.hasFocus()&&(K+=e,!m&&K>.1&&(1==J[X]&&1==c&&sfx(5),K-=.1,++X>=J.length&&(X=0)))},t.onmousedown=function(e){if(!(A>11)){if(m)return text(""),zfx(),void(P=1);if(!(3!=P||0==c||k<.3)){k=0,G.p.x=-a.x,G.p.z=-a.z,G.v=1,G.a=3.14*angleY/180;for(var t=0;t<L.length;t++)L[t].l=1.8;V.p.z=-.12,sfx(0)}}},t.onmouseup=function(e){r=o=0},t.onmousemove=function(e){2==P||A>11||4==P||5==P||(i+=e.my*p*4,angleY+=e.mx*p*4,i=clamp(i,-90,90),x&&(Math.abs(e.mx)>Math.abs(e.my)?e.mx<0&&0!=n?(n=o=0,r++):e.mx>0&&1!=n&&(n=1,o=0,r++):e.my>0&&2!=n?(n=2,r=0,o++):e.my<0&&3!=n&&(n=3,r=0,o++),r>2&&q&&x?(say(0),r=o=0):o>2&&q&&x&&(say(1),r=o=0)))},usp=function(e,t){if(e.mn=e.p.subtract(e.d),e.mx=e.p.add(e.d),1==e.t?(e.p.x+=Math.sin(e.a)*t*10,e.p.z-=Math.cos(e.a)*t*10):0!=e.t&&3!=e.t||(e.a=Math.atan2(-a.x-e.p.x,-a.z-e.p.z)*(180/Math.PI)),0==e.t&&1==c){var r=.85*t;Math.abs(a.z+e.p.z)<1&&(-a.x>e.p.x?e.p.x+=r:e.p.x-=r),-a.z>e.p.z?e.p.z+=r:e.p.z-=r}},abab=function(e,t){return e.mn.x<=t.mx.x&&e.mx.x>=t.mn.x&&e.mn.y<=t.mx.y&&e.mx.y>=t.mn.y&&e.mx.z<=t.mx.z&&e.mx.z>=t.mn.z},gotofeast=function(){1==P&&(text(""),a.x=0,a.z=-1,i=angleY=0,P=2,H.v=1,T=!1,v=0,sfx(3))};var q=!1;askQuestion=function(){q||null==b||0!=b.h||(r=o=0,text(b.x),q=!0)},say=function(e){q&&x&&0==b.h&&(text(""),0==b.o&&(S=!1),setTimeout(()=>{2==b.o||3==b.o&&1==e||4==b.o&&0==e?(ttc("#F00"),s=1,w=b,sfx(7),setTimeout(()=>{text(""),u=0,c=1,V.v=1,s=0,w=null},"3000")):(E++,0!=b.o&&sfx(10)),1==e?text(b.y):text(b.n),0==b.o&&(T=!0,setTimeout(()=>{gotofeast()},"15000"))},"1000"),b.h++)},t.onupdate=function(t){if(p=t,v+=t,M+=t,!(A>11))if(M>2&&!x&&text(""),1==P&&T&&e.keys.SPACE)gotofeast();else if(2!=P&&S&&4!=P&&5!=P){1==c&&(f+=t),h+=t,k+=t,3==P&&(msx(t),V.p.z=clamp(V.p.z-.25*t,-.18,-.12));var r=side=strife=0,o=0;e.keys.W|e.keys.UP&&!x&&!g?r=1*-t:e.keys.S|e.keys.DOWN&&(r=1*t),e.keys.D|e.keys.RIGHT?(side=90,strife=-t):e.keys.A|e.keys.LEFT&&(side=-90,strife=-t),(0!=r||0!=side)&&h>.35&&(sfx(1),h=0);var n=3.14*(angleY+side)/180,l=3.14*angleY/180;a.x+=Math.sin(n)*strife,a.z-=Math.cos(n)*strife,a.x+=Math.sin(l)*r,a.z-=Math.cos(l)*r,1==P?(a.x=clamp(a.x,-.8,.8),a.z=clamp(a.z,-.8,.8)):3==P&&(a.x=clamp(a.x,-4,4),a.z=clamp(a.z,-1.2,39.8),a.z>38.8&&(P=5,v=0,a.x=0,a.z=-1,i=angleY=v=s=0)),Y.p.x=-a.x,Y.p.y=-a.y,Y.p.z=-a.z,x=g=!1,L.sort(function(e,t){return parseFloat(t.p.z)-parseFloat(-e.p.z)});var m=!1;for(null!=w&&1==s&&0==c&&(w.p.z-=.25*t),o=0;o<L.length;o++)if(usp(L[o],t),L[o].l=clamp(L[o].l-4*t,1,2),0==L[o].t){if(1==c&&f>2){for(var y=0;y<L.length;y++)0==L[y].t&&0==L[y].v&&(L[y].v=1,L[y].p.x+=rn(-4,4),L[y].p.z+=rn(-5,5),mo(3,0,rn(-4,4),.3,-a.z+rn(-5,5),.015,.3,.05));f=0}1==L[o].v&&(abab(L[o],Y)&&(0==c?(x=!0,null!=L[o].x&&(b=L[o],askQuestion())):1==c&&(m=!0,(d+=t)>.3&&(s=1,sfx(2),d>.5&&(P=4,a.x=0,a.z=-1,i=angleY=v=s=0)))),3==P&&0==L[o].t&&abab(L[o],G)&&(L[o].v=0,G.p.x=G.p.z=1e4,f=0,I++,sfx(9)))}else 3==L[o].t&&abab(L[o],Y)&&(g=!0);m||(d=0,u>.9&&(s=0)),x||(q=!1)}},dbu=function(e,r,o,n,a){t.pushMatrix(),t.translate(r,o,n),t.scale(a,a,a),W.uniforms({texture:0,factor:0,sky:l,over:1}),W.draw(e),t.popMatrix()},dbd=function(e){if(e.v>0){if(3==e.t&&Math.abs(a.z+e.p.z)>5)return;t.pushMatrix(),t.translate(e.p.x,e.p.y,e.p.z),1==e.t?t.rotate(Math.atan2(-a.x-e.p.x,-a.z-e.p.z)*(180/Math.PI),0,1,0):t.rotate(e.a,0,1,0),1!=e.s&&t.scale(e.s,e.s,e.s),0==e.t&&(e.f=u),W.uniforms({texture:0,factor:e.f,sky:l,over:e.l}),W.draw(e.m),t.popMatrix()}},glcb=function(){t.clearColor(0,0,0,1)},t.ondraw=function(){var r=0;if(t.clearColor(l[0],.26,l[1],1),t.clear(16640),t.loadIdentity(),U.bind(0),1==V.v&&(V.p.x+=15e-5*Math.sin(2.5*v),t.pushMatrix(),dbd(V),t.popMatrix()),1==s){var o=[-.1,.1,-.17,.15];t.rotate(i+o[Math.floor(Math.random()*o.length)],1,0,0),t.rotate(angleY+o[Math.floor(Math.random()*o.length)],0,1,0)}else t.rotate(i,1,0,0),t.rotate(angleY,0,1,0);if(t.translate(a.x,a.y,a.z),dbu(O,-a.x,-3.4,-a.z,5.1),0==P)glcb(),t.clear(16640),A<=11?text("<mark>[click to play]</mark>"):text("<mark>Brother Doen failed God's Judgment<br>This is all there is for him now<br>GAME OVER</mark>");else if(1==P)for(H.v=0,priest.v=1,dbu(D,0,0,0,1),r=1;r<L.length;r++)dbd(L[r]);else if(2==P)H.l=clamp(H.l+.5*p,0,3),glcb(),t.clear(16640),dbd(H),v>=3&&(P=3,S=!0,H.v=0,priest.v=0,ow());else if(3==P){if(priest.v=0,1==c){var n=2*p;u=clamp(u+n,0,1),l[0]=clamp(l[0]+n,.26,1),l[1]=clamp(l[1]-n,.18,.27),I>0&&(ttc("#d00"),text("["+I+"]"))}for(dbu(D,0,0,2.5,1),r=-4;r<6;r+=2)dbu(F,r,0,2.5,1);for(r=-4;r<6;r+=2)dbu(F,r,-.5,-41.1,1);for(r=0;r<L.length;r++)dbd(L[r])}else if(4==P)glcb(),t.clear(16640),S=!1,a.z=-1,priest.p.x=priest.p.z=a.x=0,priest.l=2,priest.a=0,u=1,priest.v=1,dbd(priest),v>1&&(ttc("#F42"),I<10?text("YOU 'PURIFIED' "+I+" SOULS<br>(BUT YOU NEED TO SAVE FIVE...)"):I<15?text("INTERESTING..."+I+" SOULS!<br>STILL NOT ENOUGH"):I<35?text("THAT'S AN A FOR EFFORT! "+I+" SOULS!<br>(you don't escape by killing people!)"):I<75?text(I+" SOULS ARE DANCING NOW<br>YOUR RANK IS 'S'!<br>(stop killing or you will become the new Devil!)"):(text(I+" SOULS MEANS YOU ARE THE NEW DEVIL!<br>Come here my Child. I knew you could do it <3"),v=0)),(v>7||e.keys.SPACE)&&location.reload();else if(5==P){t.clearColor(.7,.7,.7,1),t.clear(16640),S=!1,priest.p.x=priest.p.z=a.x=0,a.z=-1,priest.l=.1,priest.a=0,priest.v=1,dbd(priest);var f="<br><br>[press space]";v>1&&(ttc("#000"),I>0?(ttc("#F00"),text("You really thought that Hand Cannon would 'save souls'?<br>Go away"+f)):1==E?text("Reached the gate but saved none other than yourself<br>Don't deserve to reach Heaven... yet"+f):E>2&&E<6?text("You saved "+E+" souls, that's awesome!<br>But we need 5...<br>(Cannot play cards with less people)"+f):(text("Welcome to Heaven, Brother Doen<br>Enjoy your peace<br>And thank you for the souls you saved :)"),v=0)),(v>10||e.keys.SPACE)&&location.reload()}},t.enable(2929),t.enable(3042),t.blendFunc(770,771),t.fullscreen(),t.animate()}()</script></body></html>