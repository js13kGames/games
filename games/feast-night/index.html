<!doctype html><title>Feast Night - js13kGames 2023</title><style>.text{position:absolute;width:100%;z-index:1;font-size:200%;font-family:consolas;color:orange;text-align:center}mark{color:#fff;background:0 0}</style><img src="data:image/png;base64,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" id=tileset hidden><div id=upper class=text style=bottom:5%></div><script>o={create:function(e){e=e||{};var t,n,a,o,i,r,s,u,l,c,f,h,d=document.createElement("canvas");d.width=800,d.height=600,"alpha"in e||(e.alpha=!1);try{b=d.getContext("webgl",e)}catch(e){}try{b=b||d.getContext("experimental-webgl",e)}catch(e){}if(b)return d.addEventListener("click",async()=>{await d.requestPointerLock()}),b.MODELVIEW=1|N,b.PROJECTION=2|N,s=new E,u=new E,b.modelviewMatrix=new E,b.projectionMatrix=new E,f=[],h=[],b.matrixMode=function(e){switch(e){case b.MODELVIEW:l="modelviewMatrix",c=f;break;case b.PROJECTION:l="projectionMatrix",c=h;break;default:throw new Error("invalid matrix mode "+e)}},b.loadIdentity=function(){E.identity(b[l])},b.loadMatrix=function(e){for(var t=e.m,o=b[l].m,r=0;r<16;r++)o[r]=t[r]},b.multMatrix=function(e){b.loadMatrix(E.multiply(b[l],e,u))},b.perspective=function(e,t,o,r){b.multMatrix(E.perspective(e,t,o,r,s))},b.scale=function(e,t,o){b.multMatrix(E.scale(e,t,o,s))},b.translate=function(e,t,o){b.multMatrix(E.translate(e,t,o,s))},b.rotate=function(e,t,o,r){b.multMatrix(E.rotate(e,t,o,r,s))},b.pushMatrix=function(){c.push(Array.prototype.slice.call(b[l].m))},b.popMatrix=function(){var e=c.pop();b[l].m=new Float32Array(e)},b.matrixMode(b.MODELVIEW),t=b,a=n=0,i=!(o={}),r=Object.prototype.hasOwnProperty,w(b.canvas,"mousedown",y),w(b.canvas,"mousemove",x),w(b.canvas,"mouseup",g),w(b.canvas,"mouseover",v),w(b.canvas,"mouseout",v),w(b.canvas,"touchstart",y),w(b.canvas,"touchmove",x),w(b.canvas,"touchend",g),w(b.canvas,"touchcancel",g),w(document,"contextmenu",function(){i=!(o={})}),b.animate=function(){var o=(new Date).getTime(),r=b;!function e(){b=r;var t=(new Date).getTime();b.onupdate&&b.onupdate((t-o)/1e3),b.ondraw&&b.ondraw(),window.requestAnimationFrame(e),o=t}()},b.fullscreen=function(e){var t=(e=e||{}).paddingTop||0,o=e.paddingLeft||0,r=e.paddingRight||0,n=e.paddingBottom||0;function a(){b.canvas.width=window.innerWidth-o-r,b.canvas.height=window.innerHeight-t-n,b.viewport(0,0,b.canvas.width,b.canvas.height),!e.camera&&"camera"in e||(b.matrixMode(b.PROJECTION),b.loadIdentity(),b.perspective(e.fov||90,b.canvas.width/b.canvas.height,e.near||.01,e.far||1e3),b.matrixMode(b.MODELVIEW)),b.ondraw&&b.ondraw()}document.body.appendChild(b.canvas),document.body.style.overflow="hidden",b.canvas.style.position="absolute",b.canvas.style.left=o+"px",b.canvas.style.top=t+"px",w(window,"resize",a),a()},b;throw new Error("WebGL not supported");function m(){for(var e in o)if(r.call(o,e)&&o[e])return!0;return!1}function p(t){var e,o={};for(e in t)"function"==typeof t[e]?o[e]=function(e){return function(){e.apply(t,arguments)}}(t[e]):o[e]=t[e];o.touches&&o.touches[0]?(o.x=o.touches[0].pageX,o.y=o.touches[0].pageY,o.mx=0,o.my=0):(o.x=o.pageX,o.y=o.pageY,o.mx=o.movementX,o.my=o.movementY),o.original=t;for(var r=b.canvas;r;r=r.offsetParent)o.x-=r.offsetLeft,o.y-=r.offsetTop;return i?(o.deltaX=o.x-n,o.deltaY=o.y-a):(o.deltaX=0,i=!(o.deltaY=0)),n=o.x,a=o.y,o.dragging=m(),o.preventDefault=function(){o.original.preventDefault()},o.stopPropagation=function(){o.original.stopPropagation()},o}function y(e){b=t,m()||(w(document,"mousemove",x),w(document,"mouseup",g),M(b.canvas,"mousemove",x),M(b.canvas,"mouseup",g)),o[e.which]=!0,e=p(e),b.onmousedown&&b.onmousedown(e),e.preventDefault()}function x(e){b=t,e=p(e),b.onmousemove&&b.onmousemove(e),e.preventDefault()}function g(e){b=t,o[e.which]=!1,m()||(M(document,"mousemove",x),M(document,"mouseup",g),M(document,"touchmove",x),M(document,"touchend",g),w(b.canvas,"mousemove",x),w(b.canvas,"mouseup",g),w(b.canvas,"touchmove",x),w(b.canvas,"touchend",g)),e=p(e),b.onmouseup&&b.onmouseup(e),e.preventDefault()}function v(){i=!1}},keys:{},Matrix:E,Buffer:r,Mesh:d,Shader:V,Texture:Y,Vector:a},w(document,"keydown",function(e){var t;e.altKey||e.ctrlKey||e.metaKey||((t=R(e.keyCode))&&(o.keys[t]=!0),o.keys[e.keyCode]=!0)}),w(document,"keyup",function(e){var t;e.altKey||e.ctrlKey||e.metaKey||((t=R(e.keyCode))&&(o.keys[t]=!1),o.keys[e.keyCode]=!1)}),N=305397760,E.prototype={multiply:function(e){return E.multiply(this,e,new E)}},E.multiply=function(e,t,o){o=o||new E,e=e.m,t=t.m;var r=o.m;return r[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],r[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],r[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],r[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],r[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],r[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],r[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],r[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],r[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],r[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],r[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],r[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],r[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],r[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],r[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],r[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],o},E.identity=function(e){var t=(e=e||new E).m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},E.perspective=function(e,t,o,r,n){return e=Math.tan(e*Math.PI/360)*o,E.frustum(-(t*=e),t,-e,e,o,r,n)},E.frustum=function(e,t,o,r,n,a,i){var s=(i=i||new E).m;return s[0]=2*n/(t-e),s[1]=0,s[2]=(t+e)/(t-e),s[3]=0,s[4]=0,s[5]=2*n/(r-o),s[6]=(r+o)/(r-o),s[7]=0,s[8]=0,s[9]=0,s[10]=-(a+n)/(a-n),s[11]=-2*a*n/(a-n),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,i},E.scale=function(e,t,o,r){var n=(r=r||new E).m;return n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,r},E.translate=function(e,t,o,r){var n=(r=r||new E).m;return n[0]=1,n[1]=0,n[2]=0,n[3]=e,n[4]=0,n[5]=1,n[6]=0,n[7]=t,n[8]=0,n[9]=0,n[10]=1,n[11]=o,n[12]=0,n[13]=0,n[14]=0,n[15]=1,r},E.rotate=function(e,t,o,r,n){var a,i,s;return e&&(t||o||r)?(a=(n=n||new E).m,i=Math.sqrt(t*t+o*o+r*r),e*=Math.PI/180,t/=i,o/=i,r/=i,i=Math.cos(e),e=Math.sin(e),a[0]=t*t*(s=1-i)+i,a[1]=t*o*s-r*e,a[2]=t*r*s+o*e,a[3]=0,a[4]=o*t*s+r*e,a[5]=o*o*s+i,a[6]=o*r*s-t*e,a[7]=0,a[8]=r*t*s-o*e,a[9]=r*o*s+t*e,a[10]=r*r*s+i,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n):E.identity(n)},r.prototype={compile:function(e){for(var t=[],o=0;o<this.data.length;o+=1e4)t=Array.prototype.concat.apply(t,this.data.slice(o,o+1e4));var r=this.data.length?t.length/this.data.length:0;if(r!=Math.round(r))throw new Error("buffer elements not of consistent size, average size is "+r);this.buffer=this.buffer||b.createBuffer(),this.buffer.length=t.length,this.buffer.spacing=r,b.bindBuffer(this.target,this.buffer),b.bufferData(this.target,new this.type(t),e||35044)}},d.prototype={addVertexBuffer:function(e,t){(this.vertexBuffers[t]=new r(34962,Float32Array)).name=e,this[e]=[]},addIndexBuffer:function(e){this.indexBuffers[e]=new r(34963,Uint16Array),this[e]=[]},compile:function(){for(var e in this.vertexBuffers)(o=this.vertexBuffers[e]).data=this[o.name],o.compile();for(var t in this.indexBuffers){var o;(o=this.indexBuffers[t]).data=this[t],o.compile()}}},d.bd=function(e,t,o,r,n,a){var i=new d({coords:!0});return e/=128,t/=128,o/=128,r/=128,i.vertices=[[-1*(n=n||1),-1*(a=a||1),0],[+n,-1*a,0],[-1*n,+a,0],[+n,+a,0]],i.coords=[[e,t],[o,t],[e,r],[o,r]],i.triangles=[[0,1,2],[2,1,3]],i.compile(),i},d.bo=function(e,t){e=e||0;var o=new d({coords:!0}),r=t.includes("G"),n=t.includes("C"),a=t.includes("B"),i=t.includes("L"),s=t.includes("R"),l=t.includes("F"),c=(e=(u=(128-16*e)/128)-.125,u);o.vertices=[],o.coords=[],o.triangles=[],r&&(o.vertices.push([-1,0,-1],[1,0,-1],[-1,0,1],[1,0,1]),o.coords.push([0,c],[.125,c],[0,e],[.125,e])),n&&(o.vertices.push([-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]),o.coords.push([.125,c],[.25,c],[.125,e],[.25,e])),a&&(o.vertices.push([-1,0,-1],[1,0,-1],[-1,1,-1],[1,1,-1]),o.coords.push([.25,c],[.5,c],[.25,e],[.5,e])),i&&(o.vertices.push([-1,0,-1],[-1,0,1],[-1,1,-1],[-1,1,1]),o.coords.push([.5,c],[.75,c],[.5,e],[.75,e])),s&&(o.vertices.push([1,0,-1],[1,0,1],[1,1,-1],[1,1,1]),o.coords.push([.75,c],[1,c],[.75,e],[1,e])),l&&(o.vertices.push([-1,0,1],[1,0,1],[-1,1,1],[1,1,1]),o.coords.push([1,c],[.75,c],[1,e],[.75,e]));for(var f,h=0;h<t.length;h++)o.triangles.push([0+(f=4*h),1+f,2+f],[2+f,1+f,3+f]);return o.compile(),o},c="LIGHTGL",new E,new E,V.prototype={uniforms:function(e){for(var t in b.useProgram(this.program),e){var o=this.uniformLocations[t]||b.getUniformLocation(this.program,t);if(o){this.uniformLocations[t]=o;var r=e[t];if(r instanceof a?r=[r.x,r.y,r.z]:r instanceof E&&(r=r.m),n=r,"[object Array]"==(n=Object.prototype.toString.call(n))||"[object Float32Array]"==n)switch(r.length){case 1:b.uniform1fv(o,new Float32Array(r));break;case 2:b.uniform2fv(o,new Float32Array(r));break;case 3:b.uniform3fv(o,new Float32Array(r));break;case 4:b.uniform4fv(o,new Float32Array(r));break;case 9:b.uniformMatrix3fv(o,!1,new Float32Array([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]]));break;case 16:b.uniformMatrix4fv(o,!1,new Float32Array([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]]));break;default:throw new Error("don't know how to load uniform \""+t+'" of length '+r.length)}else{if(n=r,"[object Number]"!=(n=Object.prototype.toString.call(n))&&"[object Boolean]"!=n)throw new Error('attempted to set uniform "'+t+'" to invalid value '+r);(this.isSampler[t]?b.uniform1i:b.uniform1f).call(b,o,r)}}}var n;return this},draw:function(e,t){this.drawBuffers(e.vertexBuffers,e.indexBuffers[t==b.LINES?"lines":"triangles"],arguments.length<2?b.TRIANGLES:t)},drawBuffers:function(e,t,o){var r,n=this.usedMatrices,a=b.modelviewMatrix,i=b.projectionMatrix,s=(i=n.MVPM?i.multiply(a):null,a={},n.MVPM&&(a[n.MVPM]=i),this.uniforms(a),0);for(r in e){var u=e[r],l=this.attributes[r]||b.getAttribLocation(this.program,r.replace(/^(gl_.*)$/,c+"$1"));-1!=l&&u.buffer&&(this.attributes[r]=l,b.bindBuffer(34962,u.buffer),b.enableVertexAttribArray(l),b.vertexAttribPointer(l,u.buffer.spacing,5126,!1,0,0),s=u.buffer.length/u.buffer.spacing)}for(r in this.attributes)r in e||b.disableVertexAttribArray(this.attributes[r]);return!s||t&&!t.buffer||(t?(b.bindBuffer(34963,t.buffer),b.drawElements(o,t.buffer.length,5123,0)):b.drawArrays(o,0,s)),this}},Y.prototype={bind:function(e){b.activeTexture(33984+(e||0)),b.bindTexture(3553,this.id)}},Y.fromImage=function(e,t){t=new Y(e.width,e.height,t=t||{});try{b.texImage2D(3553,0,t.format,t.format,t.type,e)}catch(e){}return t},a.prototype={add:function(e){return e instanceof a?new a(this.x+e.x,this.y+e.y,this.z+e.z):new a(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof a?new a(this.x-e.x,this.y-e.y,this.z-e.z):new a(this.x-e,this.y-e,this.z-e)}};var b,o,N,c,h=o;function R(e){return{32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[e]||(65<=e&&e<=90?String.fromCharCode(e):null)}function w(e,t,o){e.addEventListener(t,o)}function M(e,t,o){e.removeEventListener(t,o)}function E(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=new Float32Array(e)}function r(e,t){this.buffer=null,this.target=e,this.type=t,this.data=[]}function d(e){e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),"triangles"in e&&!e.triangles||this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")}function _(e,t,o){for(;null!=(result=e.exec(t));)o(result)}function V(e,t){function o(e){var t=document.getElementById(e);return t?t.text:e}var r=(e=o(e))+(t=o(t)),n={};function a(e,t){var o={},r=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t);return t=r?r[1]+e+t.substr(r[1].length):e+t,_(/\bgl_\w+\b/g,e,function(e){e in o||(t=t.replace(new RegExp("\\b"+e+"\\b","g"),c+e),o[e]=!0)}),t}function i(e,t){if(e=b.createShader(e),b.shaderSource(e,t),b.compileShader(e),b.getShaderParameter(e,b.COMPILE_STATUS))return e;throw new Error("compile error: "+b.getShaderInfoLog(e))}if(_(/\b(gl_[^;]*)\b;/g,"    uniform mat4 gl_ModelViewProjectionMatrix;  ",function(e){var t;e=e[1],-1!=r.indexOf(e)&&(t=e.replace(/[a-z_]/g,""),n[t]=c+e)}),-1!=r.indexOf("ftransform")&&(n.MVPM=c+"gl_ModelViewProjectionMatrix"),this.usedMatrices=n,e=a("    uniform mat4 gl_ModelViewProjectionMatrix;      attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;  ",e),t=a("    precision highp float;      uniform mat4 gl_ModelViewProjectionMatrix;  ",t),this.program=b.createProgram(),b.attachShader(this.program,i(35633,e)),b.attachShader(this.program,i(35632,t)),b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error("link error: "+b.getProgramInfoLog(this.program));this.attributes={},this.uniformLocations={};var s={};_(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+t,function(e){s[e[2]]=1}),this.isSampler=s}function Y(e,t,o){o=o||{},this.id=b.createTexture(),this.width=e,this.height=t,this.format=o.format||6408,this.type=o.type||5121;var r=o.filter||o.magFilter||9728,n=o.filter||o.minFilter||9728;b.bindTexture(3553,this.id),b.pixelStorei(37440,1),b.texParameteri(3553,10240,r),b.texParameteri(3553,10241,n),b.texParameteri(3553,10242,o.wrap||o.wrapS||33071),b.texParameteri(3553,10243,o.wrap||o.wrapT||33071),b.texImage2D(3553,0,this.format,e,t,0,this.format,this.type,o.data||null)}function a(e,t,o){this.x=e||0,this.y=t||0,this.z=o||0}{var i=h.create(),t=0,n=0,s=-1,l=new h.Vector(0,-.45,-1),f=angleY=0,m=0,p=0,y=[.26,.26],x=0,G=-7,H=0,U=0,W=!0,g=.016,v=0,j=0,I=!1,K=!1,k=null,X=null,J=0,S=0,z=0,q=10,T=!0,$=null,Q=!1,A=0,Z=h.Mesh.bo(0,"LRGCFB"),ee=h.Mesh.bo(0,"F"),te=h.Mesh.bo(1,"C"),D=[],oe=[h.Mesh.bd(64,0,79,31,.13,.3),h.Mesh.bd(0,0,15,31,.13,.3),h.Mesh.bd(16,0,31,31,.13,.3),h.Mesh.bd(32,0,47,31,.13,.3),h.Mesh.bd(48,0,63,31,.13,.3),h.Mesh.bd(80,0,95,31,.13,.3),h.Mesh.bd(96,0,111,31,.13,.3),h.Mesh.bd(112,0,128,31,.13,.3),h.Mesh.bd(0,80,15,95,.22,.22),h.Mesh.bd(32,80,63,96,1,.5),h.Mesh.bd(0,64,79,80,1,.3),h.Mesh.bd(112,64,128,95,.35,.7),h.Mesh.bd(96,64,112,95,.35,.7),h.Mesh.bd(80,63,95,79,.2,.2),h.Mesh.bd(64,96,96,112,1,.5),h.Mesh.bd(32,96,64,112,1,.5),h.Mesh.bo(1,"G"),h.Mesh.bo(2,"LC")],F=(null===localStorage.getItem("_feast_night_runs_")?(A=0,localStorage.setItem("_feast_night_runs_","0")):A=parseInt(localStorage.getItem("_feast_night_runs_")),0),re=(mo=function(e,t,o,r,n,a,i,s,u,l,c,f){return 0==t&&100<++j?null:(e={m:null!=e?oe[e]:null,v:1,p:new h.Vector(o,r,n),d:new h.Vector(a,i,s),mn:new h.Vector(0,0,0),mx:new h.Vector(0,0,0),t:t,a:0,x:u,y:l,n:c,o:f,h:0,l:1,s:1,f:0},D.push(e),e)},[["Is God with you, Father?","Good! I have a message<br>from his Son...","THEN YOU ARE MINE",2],["Does Hell exist?","It does, indeed","No? LET ME SHOW YOU",2],["Will you punish me for killing that little...?","I knew you'd fall with me...","BUT I DESERVE TO BE PUNISHED!",2],["SINNERS, THEY ARE ALL SINNERS!","Yes? Yes we are... ","Let's change that",4],["Come drink with me, father!","YES, THE BLOOD OF THE INNOCENT,<br>DRINK FATHER, DRINK!","Piss off!",3],["I saw gold... over there...<br>can we take it, Father?","Yes, YES! It's over there, it's...","No? But I'm tired of eating shit...",3],["Are...are you drunk Father? Like me?","I ~burp~ knew it!","~burp~",3],["Dance with me, Father!","Yes! Let's dance NOW","Boring!",3],["EAT FATHER, EAT EAT EAT!","Like it? Tastes like FLESH","FORGIVE ME FATHER, HE MADE ME DO IT!",3],["Will you go to Heaven?","Lying is a sin, Father!","Ha! I knew it!",3],["Do you repent, Father?","So you are truly a man of God...","Perhaps you should...",1],["Oh Father, I'm so drunk...<br>Can you help me?","God bless you Father!","Not even a priest helps me...",1],["All I wanted was to fly to the Sun...","We are much alike, Father. I like that","Does God forbid it, or men?",1],["Is God blue?","Nice!","No? But then why is the sky blue...?",1]]),e=[["Brother Doen!<br>Do you know what's your mission tonight?<br><br><mark>[NOD or SHAKE to answer]</mark>","Well then... good luck out there<br>Sin is everywhere, specially on a..."+(e="<br><br><mark>[press space]</mark>"),"Help our people! Follow the Moon<br>and purify the souls of the Sinners this..."+e,0],["Wasn't expecting you so soon...<br>Do you know why are you here now?","DIES IRAE, BROTHER!<br>Now get out. PURIFY YOUR SOUL"+e,"Well, it's easy: save FIVE souls<br>and survive God's judgement"+e,0],["Did you meet God out there?","Don't you think that meeting God would<br>free you from this loop?","I bet you didn't. But I'm sure<br>you saw plenty of lost souls...like you",0],["What a glorious DIES IRAE!<br>Do you know what it is?","Then why you don't escape your Judgement?","Your Judgement, brother Doen!",0],["Aren't you a bit bored already?","THEN ESCAPE!<br>Go, save someone. FIVE souls!","Good thing, good thing!<br>I might even like you",0],["Do you know me, Brother Doen?","Ah! Are you sure?<br>Really sure?","Call me... Peter ~wink wink~",0],["Still here! What was it this time?<br>Demons? Wolves? Ale?","Demons out there?<br>It's just people!","None of those? Well, don't lose faith:<br>follow the moon, purify your soul...blah blah",0],["Once more: true purification comes<br>from loving and caring. Ok?","Good. Now get out there and<br>save FIVE souls!","~SIGH~",0],["Do you know how many were Judged already?","Then stop making me waste my time!<br>Save your Soul...or stay in hell FOREVER","A LOT OF THEM!<br>I cannot stay with you for eternity, Doen...",0],["Ten times. Do you know that?","Then escape already. Time's almost up, Doen","Ten times you failed your Judgement! ARGH!",0],["I'm sorry, Doen... but you failed<br>You will be trapped here now. Forever","Use your time wisely<br>and FREE YOURSELF. Goodbye, my friend","I never thought it would end like this. Goodbye, my friend",0]],ne=!1,O=(11<=A&&(A=10,ne=!0),mo(17,5,.2,-.2,-.18,0,0,0)),L=mo(null,4,0,0,0,.25,.25,.25),P=mo(8,1,1e5,.3,1e5,.25,.25,.25),B=mo(10,2,0,.5,0,0,0,0),ae=(priest=mo(0,0,0,.3,0,.015,.3,.05,e[A][0],e[A][1],e[A][2],e[A][3]),O.s=.07,O.v=L.v=B.v=B.l=0,A++,ne&&(A=12),localStorage.setItem("_feast_night_runs_",""+A),text=function(e){""!=e&&(J=0),document.getElementById("upper").innerHTML=e},ttc=function(e){document.getElementById("upper").style.color=e},rn=function(e,t){return Math.random()*(t-e+1)+e},clamp=function(e,t,o){return Math.min(Math.max(e,t),o)},ow=function(){var e=0,t=[1,5,7,3,6,4,2],o=mo(16,2,0,0,0,0,0,0);for(mn=mo(15,2,0,2,-50,.5,.5,.5),ctl=mo(9,2,0,.75,-40,.5,.5,.5),o.s=100,mn.s=2,ctl.s=1.5,e=0;e<140;e++){var r=11;rn(0,100)<50&&r++,mo(r,3,rn(-3,-.5),.6,-.3*e,.015,.5,.015),mo(r,3,rn(.5,3),.6,-.3*e,.015,.5,.015),mo(r,3,rn(-6,-4),.6,4-.3*e,.015,.5,.015),mo(r,3,rn(4,6),.6,4-.3*e,.015,.5,.015),mo(13,2,rn(-3,-.25),.1,2-.3*e,.05,.2,.05),mo(13,2,rn(.25,3),.1,2-.3*e,0,0,0)}for(var n=0,e=t.length-1;0<=e;e--){var a=t.splice(Math.floor(Math.random()*t.length),1),i=re[n+Math.floor(rn(0,1))];n+=mo(a[0],0,rn(-1.25,1.25),.3,-3*e-rn(0,1),.015,.3,.05,i[0],i[1],i[2],i[3]).over=2}},h.Texture.fromImage(tileset)),ie=new h.Shader("        varying vec2 coord;        varying vec4 pos;        void main() {            coord = gl_TexCoord.xy;            gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;            pos = gl_Position;        }        ","        uniform sampler2D texture;        uniform float factor;        uniform float over;        uniform vec2 sky;        varying vec2 coord;        varying vec4 pos;        float fogf(float d) {            const float LOG2 = -1.442695;            return 1.0 - clamp(exp2(d*d*LOG2), 0.0, 1.0);        }        void main() {            vec4 os = texture2D(texture, coord);            vec4 ms = texture2D(texture, coord + vec2(0.0, 0.25));            os = mix(os, ms, factor);            if(os.a < 0.8) discard;            float fog = fogf(gl_FragCoord.z/gl_FragCoord.w * 0.5);            float d = (1.0 / distance(vec4(0.0, 0.0, 0.0, 0.0), pos)) * (over - 1.0);            gl_FragColor = mix(os, vec4(sky.x, 0.26, sky.y, 1.0), fog) + (vec4(0.87, 0.46, 0.051, 1.0) * d);            if(os.r > 0.9 && os.g > 0.9) gl_FragColor = os;        }        ");zfx=function(){$=(e=1,t=.05,o=220,r=0,n=0,a=.1,i=0,s=1,u=0,l=0,c=0,f=0,h=0,d=0,m=0,p=0,y=0,x=1,g=0,v=0,b=Math,w=44100,M=2*b.PI,E=u*=500*M/w/w,I=o*=(1-t+2*t*b.random(t=[]))*M/w,k=0,S=0,z=0,T=1,A=0,D=0,F=0,O,L)=>{for(l*=500*M/w**3,m*=M/w,c*=M/w,f*=w,h=w*h|0,L=(r=w*r+9)+(g*=w)+(n*=w)+(a*=w)+(y*=w)|0;z<L;t[z++]=F)++D%(100*p|0)||(F=i?1<i?2<i?3<i?b.sin((k%M)**3):b.max(b.min(b.tan(k),1),-1):1-(2*k/M%2+2)%2:1-4*b.abs(b.round(k/M)-k/M):b.sin(k),F=(h?1-v+v*b.sin(M*z/h):1)*(0<F?1:-1)*b.abs(F)**s*.3*e*(z<r?z/r:z<r+g?1-(z-r)/g*(1-x):z<r+g+n?x:z<L-y?(L-z-y)/a*x:0),F=y?F/2+(z<y?0:(z<L-y?1:(L-z)/y)*t[z-y|0]/2):F),k+=(O=(o+=u+=l)*b.cos(m*S++))-O*d*(1-1e9*(b.sin(z)+1)%2),T&&++T>f&&(o+=c,I+=c,T=0),!h||++A%h||(o=I,u=E,T||=1);return(e=zzfxX.createBuffer(1,L,w)).getChannelData(0).set(t),(o=zzfxX.createBufferSource()).buffer=e,o.connect(zzfxX.destination),o.start(),o},zzfxX=new AudioContext,W=!1};const b=[[2.01,.3,111,,.08,.3,3,,-5,.6,,.01,.11,.2,-1,.3,.03,.74,.02],[2,.2,100,.01,.02,.02,,1.9,-7.4,,,,.07,1.5,,,.1,,.08,.47],[2,,528,.01,,.48,,.6,-11.6,,,,.32,4.2],[2,,11,,2,3,,,,,55,.22,.03,,22,,.15,,1],[2,.15,555,,,.02,,1.13,,,,,,.2,-131,,,,,.01],[2,,250,,.08,.06,1,.5,-4,-1,,,,.1,,,.04,.62,.08],[1.27,,5555,.01,.08,.08,4,2.57,,.1,-50,.02,.01,2,-1,,,.37,.08,.01],[1.94,,1,,2,2,1,1.08,1.5,-.4,,,,,33,.1,.06,.61,1,.46],[1.99,.1,1429,,.02,.2,,.73,,-2,25,.02,,,,,.07,.73,.04,.08],[2.01,,90,.01,.06,.06,,1.12,7.9,.7,,,.03,,,,.19,.83,.07],[2,,177,.12,.01,0,,2.48,,31,,,.07,,,,.2,.6,.01]];sfx=function(e){document.hasFocus()&&$(...b[e])};var se=0,ue=0,le=[1,0,1,1,1,0,2,0,1,0,1,0,1,0,2,0],C=(msx=function(e){document.hasFocus()&&(se+=e,!W)&&.1<se&&(1==le[ue]&&1==x&&sfx(5),se-=.1,++ue>=le.length)&&(ue=0)},i.onmousedown=function(e){if(!(11<A))if(W)text(""),zfx(),F=1;else if(!(3!=F||0==x||q<.3)){q=0,P.p.x=-l.x,P.p.z=-l.z,P.v=1,P.a=3.14*angleY/180;for(var t=0;t<D.length;t++)D[t].l=1.8;O.p.z=-.12,sfx(0)}},i.onmouseup=function(e){t=n=0},i.onmousemove=function(e){2==F||11<A||4==F||5==F||(f+=e.my*g*4,angleY+=e.mx*g*4,f=clamp(f,-90,90),I&&(Math.abs(e.mx)>Math.abs(e.my)?e.mx<0&&0!=s?(s=n=0,t++):0<e.mx&&1!=s&&(s=1,n=0,t++):0<e.my&&2!=s?(s=2,t=0,n++):e.my<0&&3!=s&&(s=3,t=0,n++),2<t&&C&&I?(say(0),t=n=0):2<n&&C&&I&&(say(1),t=n=0)))},usp=function(e,t){e.mn=e.p.subtract(e.d),e.mx=e.p.add(e.d),1==e.t?(e.p.x+=Math.sin(e.a)*t*10,e.p.z-=Math.cos(e.a)*t*10):0!=e.t&&3!=e.t||(e.a=Math.atan2(-l.x-e.p.x,-l.z-e.p.z)*(180/Math.PI)),0==e.t&&1==x&&(t*=.85,Math.abs(l.z+e.p.z)<1&&(-l.x>e.p.x?e.p.x+=t:e.p.x-=t),-l.z>e.p.z?e.p.z+=t:e.p.z-=t)},abab=function(e,t){return e.mn.x<=t.mx.x&&e.mx.x>=t.mn.x&&e.mn.y<=t.mx.y&&e.mx.y>=t.mn.y&&e.mx.z<=t.mx.z&&e.mx.z>=t.mn.z},!(gotofeast=function(){1==F&&(text(""),l.x=0,l.z=-1,f=angleY=0,F=2,B.v=1,Q=!1,v=0,sfx(3))}));askQuestion=function(){C||null==k||0!=k.h||(t=n=0,text(k.x),C=!0)},say=function(e){C&&I&&0==k.h&&(text(""),0==k.o&&(T=!1),setTimeout(()=>{2==k.o||3==k.o&&1==e||4==k.o&&0==e?(ttc("#F00"),m=1,X=k,sfx(7),setTimeout(()=>{text(""),p=0,x=1,O.v=1,m=0,X=null},"3000")):(S++,0!=k.o&&sfx(10)),1==e?text(k.y):text(k.n),0==k.o&&(Q=!0,setTimeout(()=>{gotofeast()},"15000"))},"1000"),k.h++)},i.onupdate=function(e){if(v+=g=e,J+=e,!(11<A))if(2<J&&!I&&text(""),1==F&&Q&&h.keys.SPACE)gotofeast();else if(2!=F&&T&&4!=F&&5!=F){1==x&&(G+=e),H+=e,q+=e,3==F&&(msx(e),O.p.z=clamp(O.p.z-.25*e,-.18,-.12));var t=side=strife=0,o=0,r=(h.keys.W|h.keys.UP&&!I&&!K?t=-e:h.keys.S|h.keys.DOWN&&(t=+e),h.keys.D|h.keys.RIGHT?(side=90,strife=-e):h.keys.A|h.keys.LEFT&&(side=-90,strife=-e),(0!=t||0!=side)&&.35<H&&(sfx(1),H=0),3.14*(angleY+side)/180),n=3.14*angleY/180,a=(l.x+=Math.sin(r)*strife,l.z-=Math.cos(r)*strife,l.x+=Math.sin(n)*t,l.z-=Math.cos(n)*t,1==F?(l.x=clamp(l.x,-.8,.8),l.z=clamp(l.z,-.8,.8)):3==F&&(l.x=clamp(l.x,-4,4),l.z=clamp(l.z,-1.2,39.8),38.8<l.z)&&(F=5,v=0,l.x=0,l.z=-1,f=angleY=v=m=0),L.p.x=-l.x,L.p.y=-l.y,L.p.z=-l.z,I=K=!1,D.sort(function(e,t){return parseFloat(t.p.z)-parseFloat(-e.p.z)}),!1);for(null!=X&&1==m&&0==x&&(X.p.z-=.25*e),o=0;o<D.length;o++)if(usp(D[o],e),D[o].l=clamp(D[o].l-4*e,1,2),0==D[o].t){if(1==x&&2<G){for(var i=0;i<D.length;i++)0==D[i].t&&0==D[i].v&&(D[i].v=1,D[i].p.x+=rn(-4,4),D[i].p.z+=rn(-5,5),mo(3,0,rn(-4,4),.3,-l.z+rn(-5,5),.015,.3,.05));G=0}1==D[o].v&&(abab(D[o],L)&&(0==x?(I=!0,null!=D[o].x&&(k=D[o],askQuestion())):1==x&&(a=!0,.3<(U+=e))&&(m=1,sfx(2),.5<U)&&(F=4,l.x=0,l.z=-1,f=angleY=v=m=0)),3==F)&&0==D[o].t&&abab(D[o],P)&&(D[o].v=0,P.p.x=P.p.z=1e4,G=0,z++,sfx(9))}else 3==D[o].t&&abab(D[o],L)&&(K=!0);a||(U=0,.9<p&&(m=0)),I||(C=!1)}},dbu=function(e,t,o,r,n){i.pushMatrix(),i.translate(t,o,r),i.scale(n,n,n),ie.uniforms({texture:0,factor:0,sky:y,over:1}),ie.draw(e),i.popMatrix()},dbd=function(e){0<e.v&&(3==e.t&&5<Math.abs(l.z+e.p.z)||(i.pushMatrix(),i.translate(e.p.x,e.p.y,e.p.z),1==e.t?i.rotate(Math.atan2(-l.x-e.p.x,-l.z-e.p.z)*(180/Math.PI),0,1,0):i.rotate(e.a,0,1,0),1!=e.s&&i.scale(e.s,e.s,e.s),0==e.t&&(e.f=p),ie.uniforms({texture:0,factor:e.f,sky:y,over:e.l}),ie.draw(e.m),i.popMatrix()))},glcb=function(){i.clearColor(0,0,0,1)},i.ondraw=function(){var e,t=0;if(i.clearColor(y[0],.26,y[1],1),i.clear(16640),i.loadIdentity(),ae.bind(0),1==O.v&&(O.p.x+=15e-5*Math.sin(2.5*v),i.pushMatrix(),dbd(O),i.popMatrix()),1==m?(i.rotate(f+(e=[-.1,.1,-.17,.15])[Math.floor(Math.random()*e.length)],1,0,0),i.rotate(angleY+e[Math.floor(Math.random()*e.length)],0,1,0)):(i.rotate(f,1,0,0),i.rotate(angleY,0,1,0)),i.translate(l.x,l.y,l.z),dbu(te,-l.x,-3.4,-l.z,5.1),0==F)glcb(),i.clear(16640),A<=11?text("<mark>[click to play]</mark>"):text("<mark>Brother Doen failed God's Judgment<br>This is all there is for him now<br>GAME OVER</mark>");else if(1==F)for(B.v=0,priest.v=1,dbu(Z,0,0,0,1),t=1;t<D.length;t++)dbd(D[t]);else if(2==F)B.l=clamp(B.l+.5*g,0,3),glcb(),i.clear(16640),dbd(B),3<=v&&(F=3,T=!0,B.v=0,priest.v=0,ow());else if(3==F){for(priest.v=0,1==x&&(e=2*g,p=clamp(p+e,0,1),y[0]=clamp(y[0]+e,.26,1),y[1]=clamp(y[1]-e,.18,.27),0<z)&&(ttc("#d00"),text("["+z+"]")),dbu(Z,0,0,2.5,1),t=-4;t<6;t+=2)dbu(ee,t,0,2.5,1);for(t=-4;t<6;t+=2)dbu(ee,t,-.5,-41.1,1);for(t=0;t<D.length;t++)dbd(D[t])}else 4==F?(glcb(),i.clear(16640),T=!1,l.z=-1,priest.p.x=priest.p.z=l.x=0,priest.l=2,priest.a=0,p=1,priest.v=1,dbd(priest),1<v&&(ttc("#F42"),z<10?text("YOU 'PURIFIED' "+z+" SOULS<br>(BUT YOU NEED TO SAVE FIVE...)"):z<15?text("INTERESTING..."+z+" SOULS!<br>STILL NOT ENOUGH"):z<35?text("THAT'S AN A FOR EFFORT! "+z+" SOULS!<br>(you don't escape by killing people!)"):z<75?text(z+" SOULS ARE DANCING NOW<br>YOUR RANK IS 'S'!<br>(stop killing or you will become the new Devil!)"):(text(z+" SOULS MEANS YOU ARE THE NEW DEVIL!<br>Come here my Child. I knew you could do it <3"),v=0)),(7<v||h.keys.SPACE)&&location.reload()):5==F&&(i.clearColor(.7,.7,.7,1),i.clear(16640),T=!1,priest.p.x=priest.p.z=l.x=0,l.z=-1,priest.l=.1,priest.a=0,priest.v=1,dbd(priest),e="<br><br>[press space]",1<v&&(ttc("#000"),0<z?(ttc("#F00"),text("You really thought that Hand Cannon would 'save souls'?<br>Go away"+e)):1==S?text("Reached the gate but saved none other than yourself<br>Don't deserve to reach Heaven... yet"+e):2<S&&S<6?text("You saved "+S+" souls, that's awesome!<br>But we need 5...<br>(Cannot play cards with less people)"+e):(text("Welcome to Heaven, Brother Doen<br>Enjoy your peace<br>And thank you for the souls you saved :)"),v=0)),10<v||h.keys.SPACE)&&location.reload()},i.enable(2929),i.enable(3042),i.blendFunc(770,771),i.fullscreen(),i.animate()}</script>