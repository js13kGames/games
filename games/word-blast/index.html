<title>Word Blast - js13kGames 2015</title><style>.hidden{display:none}body{margin:0;padding:0;font-family:Arial}canvas{position:absolute;top:0;left:0}#message-box{position:fixed;padding:20px;top:30%;left:50%;width:300px;margin-left:-150px;box-sizing:border-box;background:#fff;text-align:center;opacity:.9;border:10px solid #f3f3f3;border-radius:15px;z-index:1000}button{background:#588617;border:none;padding:15px 30px;color:#fff;cursor:pointer}button:HOVER{background:#71ad1e}</style><canvas class=canvas-bg1 id=bg1></canvas><canvas class=canvas-game id=c></canvas><canvas class=canvas-fg1 id=fg1></canvas><div id=lost class=hidden>You lost. Refresh to play again.</div><script>window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var H,wae=window.addEventListener,FPS=60,pi_by_180=Math.PI/180,epsilon=.1,c=null,ctx=null,bc=null,bc_ctx=null,objs=[],keys=[],last_time=0,debug=1,debug_color="#ffffff",stage=null,supportsLocalStorage=!1,shakeTime=0,shakeTimeMax=0,shakeIntensity=7,score=0,life=2,hs=0,PAUSE=!0,DisplayObject=function(){},p=DisplayObject.prototype;p.x=0,p.y=0,p.width=0,p.height=0,p.hitarea=null,p.scale_x=1,p.scale_y=1,p.rotation=0,p.alpha=1,p.visible=!0,p.hitTestPoint=null,p.draw=function(e){},p.update=function(e){};var Stage=function(){};function init(e){averagefps={x:0,y:0},W=window.innerWidth,H=window.innerHeight,(c=document.getElementById(e)).width=W,c.height=H,ctx=c.getContext("2d"),(bc=document.createElement("canvas")).width=c.width,bc.height=c.height,bc_ctx=bc.getContext("2d"),objs=[],(stage=new Stage).update=function(e){"function"==typeof onStageUpdated&&onStageUpdated(e)},addChild(stage);try{null!=window.localStorage&&(supportsLocalStorage=!0,(hs=window.localStorage.getItem(game_config.score_key))||(hs=0,localStorage.setItem(game_config.score_key,0)))}catch(e){supportsLocalStorage=!1}var t={x:5,y:15,fps:0,visible:!0,update:function(e){this.fps=Math.round(1/e),this.fps!==1/0&&(averagefps.x=(averagefps.x*averagefps.y+this.fps)/++averagefps.y)},draw:function(e){debug&&(e.font="12px Verdana",e.fillStyle="#F00",e.fillText(this.fps+" fps",0,0))}};addChild(t);var i={x:50,y:15,visible:!0,draw:function(e){debug&&(e.font="12px Verdana",e.fillStyle="#F00",e.fillText(objs.length+" Entities",0,0))}};addChild(i),game.init(),wae("keypress",onKeyPress),wae("keydown",onKeyDown),wae("keyup",onKeyUp),gameLoop()}function gameLoop(){window.requestAnimFrame(gameLoop),update(),draw()}function onKeyUp(e){keys[e.which]=!1}function onKeyDown(e){keys[e.which]=!0}function onKeyPress(e){({68:1,100:1})[e.which]||PAUSE&&e.which}function update(){var e=(new Date).getTime();last_time||(last_time=e);var t=(e-last_time)/1e3;last_time=e,shakeTime>0&&(shakeTime-=t);for(var i=objs.length;i--;){var s=objs[i];"function"==typeof s.update&&s.update(t)}}function draw(){clearScreen(bc_ctx,"#9CC5C9");var e=bc_ctx;if(shakeTime>0){var t=shakeTime/shakeTimeMax*shakeIntensity,i=random(-t,t),s=random(-t,t);e.save(),e.translate(i,s)}for(var n=0,a=objs.length;n<a;n++){var o=objs[n];"function"==typeof o.draw&&o.visible&&(e.save(),!isNaN(o.x)&&!isNaN(o.y)&&e.translate(o.x,o.y),!isNaN(o.scale_x)&&!isNaN(o.scale_y)&&e.scale(o.scale_x,o.scale_y),!isNaN(o.rotation)&&e.rotate(o.rotation*pi_by_180),!isNaN(o.alpha)&&(e.globalAlpha=o.alpha),o.draw(e),e.restore())}e.font="18px Verdana",e.fillStyle="#FF0",e.fillText("Score: "+score,20,H-30),e.fillText("Life: "+life,20,H-10),shakeTime>0&&e.restore(),clearScreen(ctx),ctx.drawImage(bc,0,0)}function clearScreen(e,t){e.clearRect(0,0,c.width,c.height)}function addChild(e){objs.push(e)}function removeChild(e){for(var t=objs.length;t--;)if(objs[t]===e){delete e,objs.splice(t,1);break}}function removeChildAt(e){objs[e]&&(delete objs[e],objs.splice(e,1))}function setChildIndex(e,t){for(var i=-1,s=objs.length;++i<s;)objs[i]===e&&i!=t&&(objs.splice(i,1),objs.splice(t,0,e))}function shake(e){shakeTimeMax=shakeTime=e}function random(e,t){return t||(t=e,e=0),e+~~(Math.random()*(t-e+1))}function resetScore(){score>hs&&(hs=score),score=0}function saveScore(){localStorage.setItem(game_config.score_key,hs)}function dist(e,t,i,s){var n=e-i,a=t-s;return Math.abs(Math.sqrt(n*n+a*a))}function J(){this.B=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;.01>this.c&&(this.c=.01),.18>(e=this.b+this.c+this.e)&&(e=.18/e,this.b*=e,this.c*=e,this.e*=e)}}var W=new function(){var e,t,i,s,n,a,o,r,h,c,l,d;this.A=new J,this.reset=function(){var e=this.A;s=100/(e.f*e.f+.001),n=100/(e.g*e.g+.001),a=1-.01*e.h*e.h*e.h,o=1e-6*-e.i*e.i*e.i,e.a||(l=.5-e.n/2,d=5e-5*-e.o),r=0<e.l?1-.9*e.l*e.l:1+10*e.l*e.l,h=0,c=1==e.m?0:2e4*(1-e.m)*(1-e.m)+32},this.D=function(){this.reset();var s=this.A;return e=1e5*s.b*s.b,t=1e5*s.c*s.c,i=1e5*s.e*s.e+10,e+t+i|0},this.C=function(f,p){var u=1!=(L=this.A).s||L.v,y=.1*L.v*L.v,w=1+3e-4*L.w,g=.1*L.s*L.s*L.s,v=1+1e-4*L.t,m=1!=L.s,b=L.x*L.x,x=L.g,_=L.q||L.r,k=.2*L.r*L.r*L.r,S=L.q*L.q*(0>L.q?-1020:1020),j=L.p?32+(2e4*(1-L.p)*(1-L.p)|0):0,C=L.d,W=L.j/2,T=.01*L.k*L.k,A=L.a,I=e,M=1/e,H=1/t,F=1/i;.8<(L=5/(1+20*L.u*L.u)*(.01+g))&&(L=.8);for(var P,D,q,R,N,L=1-L,U=!1,E=0,z=0,V=0,K=0,B=0,O=0,G=0,J=0,Q=0,X=0,Y=Array(1024),Z=Array(32),$=Y.length;$--;)Y[$]=0;for($=Z.length;$--;)Z[$]=2*Math.random()-1;for($=0;$<p;$++){if(U)return $;if(j&&++Q>=j&&(Q=0,this.reset()),c&&++h>=c&&(c=0,s*=r),(s*=a+=o)>n&&(s=n,0<x&&(U=!0)),D=s,0<W&&(X+=T,D*=1+Math.sin(X)*W),8>(D|=0)&&(D=8),A||(0>(l+=d)?l=0:.5<l&&(l=.5)),++z>I)switch(z=0,++E){case 1:I=t;break;case 2:I=i}switch(E){case 0:V=z*M;break;case 1:V=1+2*(1-z*H)*C;break;case 2:V=1-z*F;break;case 3:V=0,U=!0}_&&(0>(q=0|(S+=k))?q=-q:1023<q&&(q=1023)),u&&w&&(1e-5>(y*=w)?y=1e-5:.1<y&&(y=.1)),N=0;for(var ee=8;ee--;){if(++G>=D&&(G%=D,3==A))for(P=Z.length;P--;)Z[P]=2*Math.random()-1;switch(A){case 0:R=G/D<l?.5:-.5;break;case 1:R=1-G/D*2;break;case 2:R=0>(R=0>(R=.5<(R=G/D)?6.28318531*(R-1):6.28318531*R)?1.27323954*R+.405284735*R*R:1.27323954*R-.405284735*R*R)?.225*(R*-R-R)+R:.225*(R*R-R)+R;break;case 3:R=Z[Math.abs(32*G/D|0)]}u&&(P=O,0>(g*=v)?g=0:.1<g&&(g=.1),m?(B+=(R-O)*g,B*=L):(O=R,B=0),K+=(O+=B)-P,R=K*=1-y),_&&(Y[J%1024]=R,R+=Y[(J-q+1024)%1024],J++),N+=R}N=.125*N*V*b,f[$]=1<=N?32767:-1>=N?-32768:32767*N|0}return p}};window.jsfxr=function(e){W.A.B(e);var t=W.D();e=new Uint8Array(4*((t+1)/2|0)+44),t=2*W.C(new Uint16Array(e.buffer,44),t),(i=new Uint32Array(e.buffer,0,44))[0]=1179011410,i[1]=t+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=t,t+=44;for(var i=0,s="data:audio/wav;base64,";i<t;i+=3){var n=e[i]<<16|e[i+1]<<8|e[i+2];s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&n]}return i-=t,s.slice(0,s.length-i)+"==".slice(0,i)};var game=function(e){var t,i={},s={1:{width:10,height:10},2:{width:20,height:20},3:{width:35,height:35}},n=0,a=0,o=["type me","me too","collect coins","coins reverse words"],r=["amazing","poor","brilliant","crazy","horrible","fun"],h=["cat","elephant","concept","game","gamer","power"];function l(){this.type="player",this.speed_x=0,this.speed_y=0,this.max_speed=300,this.acceleration=2e3,this.friction=.93,this.width=25,this.height=15,this.color="#0f0",this.generateWordTime=2,this.wordGenerateInterval=3,this.reset=function(){this.x=W/2,this.y=H-100,this.speed_x=this.speed_y=0}}function d(e){e=e||{},this.type="word",this.level=e.level||3,this.x=random(100,W-400),this.y=random(0,5),this.width=s[this.level].width,this.height=s[this.level].height,this.isDead=!1,this.speed_y=60,this.value=a===o.length?r[random(r.length-1)]+" "+h[random(h.length-1)]:o[a++],this.isReversed=a===o.length?!!random(0,1):0,4===a&&(this.isReversed=!0),this.reversedValue=function(e){return e.split("").reverse().join("")}(this.value),this.correctIndex=0,this.hit=function(){}}function f(e,t,i){this.type="coin",this.x=e,this.y=t,this.width=2,this.height=2,this.speed=100+random(200,500),this.speed_x=~~(Math.cos(i*pi_by_180)*this.speed),this.speed_y=~~(Math.sin(i*pi_by_180)*this.speed),this.lifetime_sec=8,this.color="#ff0"}y("coin",[[2,,.0547,.5447,.1704,.5662,,,,,,,,,,,,,1,,,,,.5],[2,,.0236,.3286,.2658,.6069,,,,,,.2147,.5666,,,,,,1,,,,,.5],[2,,.0143,.5022,.26,.5323,,,,,,.3248,.5518,,,,,,1,,,,,.5]]),y("powerup",[[2,,.2307,,.4397,.3404,,.1526,,.0544,.4236,,,.3724,,,,,1,,,,,.5],[2,,.3894,,.3024,.4107,,.1792,,,,,,.0228,,.5141,,,1,,,,,.5]]),y("explosion",[[3,,.3708,.5822,.3851,.0584,,-.0268,,,,-.0749,.7624,,,,,,1,,,,,.5],[3,,.1669,.6956,.4757,.053,,.25,,,,.5472,.7599,,,.516,.3194,-.1415,1,,,,,.5],[3,,.1679,.6792,.4546,.1048,,-.3239,,,,-.3376,.6851,,,,,,1,,,,,.5]]),y("hit",[[0,,.0658,,.2198,.4852,,-.5898,,,,,,.4405,,,,,1,,,,,.5],[0,,.0444,,.1355,.2247,,-.3034,,,,,,.416,,,,,1,,,.1094,,.5],[3,,.0833,,.1753,.3698,,-.3655,,,,,,,,,,,1,,,,,.5],[1,,.0892,,.2721,.38,,-.379,,,,,,,,,,,1,,,.1896,,.5]]),y("button",[[0,.1696,.5004,.2598,.3914,.7047,,.0141,-5e-4,,,.6608,-.8497,-.1484,-.0163,.5521,.2529,-.5832,.6323,-.595,.9155,.2821,-.0615,.26]]),y("gameover",[[2,.18,.24,,.54,.34,,,,1,.31,,,,.8522,,,,.23,,,,,.49]]),l.prototype=new DisplayObject,l.prototype.draw=function(e){e.strokeStyle=this.color,e.lineWidth=3,e.lineWidth=7+3*Math.sin(pi_by_180*Date.now()/2),e.shadowBlur=5+10*Math.sin(pi_by_180*Date.now()/5),e.shadowColor=this.color,e.beginPath();var t=7+3*Math.sin(pi_by_180*Date.now()/2);e.arc(0,0,t,0,2*Math.PI,!1),e.stroke()},l.prototype.update=function(e){this.generateWordTime-=e,this.generateWordTime<0&&(objs.push(new d),this.generateWordTime=this.wordGenerateInterval),keys[37]?this.speed_x-=this.acceleration*e:keys[39]&&(this.speed_x+=this.acceleration*e),keys[38]?this.speed_y-=this.acceleration*e:keys[40]&&(this.speed_y+=this.acceleration*e),this.speed_x*=this.friction,this.speed_y*=this.friction,this.x+=this.speed_x*e,this.y+=this.speed_y*e,this.x>W&&(this.x=0),this.x<0&&(this.x=W),this.y<0&&(this.y=H),this.y>H&&(this.y=0)},d.prototype=new DisplayObject,d.prototype.draw=function(e){e.font="30px Verdana";var i=this.isReversed?"#FF0":"#F00",s=this.isReversed?"#F00":"#FF0";substrLen=this.isReversed?this.value.length-this.correctIndex:this.correctIndex,e.fillStyle=i,e.fillText(this.isReversed?this.reversedValue:this.value,0,0),e.fillStyle=s,e.fillText((this.isReversed?this.reversedValue:this.value).substr(0,substrLen),0,0),e.beginPath(),e.moveTo(10*this.value.length,0),e.lineTo(t.x-this.x,t.y-this.y);var n=.6*(1-dist(this.x,this.y,t.x,t.y)/H);e.strokeStyle="rgba(255, 255, 255, "+n+")",e.stroke(),e.beginPath()},d.prototype.update=function(e){this.y+=this.speed_y*e,this.x>W&&(this.x=0),this.x<0&&(this.x=W),this.y<0&&(this.y=H),this.y>H&&(w("explosion"),shake(3),--life||(PAUSE=1,document.querySelector("#lost").style.display="block"),removeChild(this))},d.prototype.checkCharacter=function(e){this.value[this.correctIndex]===e&&(this.correctIndex++," "===this.value[this.correctIndex]&&this.correctIndex++,w("hit"),this.correctIndex===this.value.length&&(function(e,t,i){for(var s=8;s--;)objs.push(new f(t,i,random(0,360)))}(0,this.x,this.y),w("explosion"),score++,shake(1),removeChild(this)))};var p=f.prototype=new DisplayObject;function u(e){for(var t,i=String.fromCharCode(e.which).toLowerCase(),s=objs.length;s--;)"word"===(t=objs[s]).type&&t.checkCharacter(i)}function y(e,t){i[e]=[],t.forEach((function(t){var s=new Audio;s.src=jsfxr(t),i[e].push(s)}))}function w(e){i[e]&&i[e][random(0,i[e].length-1)].play()}return p.friction=.9,p.draw=function(e){e.fillStyle="#ff0",e.shadowBlur=5+10*Math.sin(pi_by_180*Date.now()/5),e.shadowColor=this.color;var t=Math.sin(pi_by_180*Date.now()/5);e.save(),e.scale(t,1),e.beginPath(),e.arc(0,0,7,0,2*Math.PI,!1),e.fill(),e.restore()},p.update=function(e){this.lifetime_sec-=e,this.lifetime_sec<=0&&"taken"!==this.state&&removeChild(this),this.speed_x*=this.friction,this.speed_y*=this.friction,this.x+=this.speed_x*e,this.y+=this.speed_y*e;var i=dist(this.x,this.y,t.x,t.y);i<200&&(this.x+=.1*(t.x-this.x),this.y+=.1*(t.y-this.y),i<20&&(this.state="taken",w("coin"),n++,function(){if(n>9){for(var e=!1,t=0;t<objs.length;t++){var i=objs[t];if("word"===i.type&&i.isReversed){console.log(99,i),i.isReversed=!1,e=!0;break}}e&&(w("powerup"),n=0)}}(),removeChild(this)))},{init:function(){(function(){var e=document.querySelector("#bg1"),t=e.getContext("2d"),i=0,s=0;for(e.width=W,e.height=H,function(e,t,i,s,n,a){(a=a||ctx).beginPath(),a.fillStyle="hsl(0, 0%, 10%)",a.rect(0,0,s,n),a.fill()}(0,0,0,W,H,t),t.fillStyle="hsl(0, 0%, 20%)",t.beginPath();++i<150;)s=random(1,10),t.rect(random(W),random(H),s,s);t.fill()})(),function(){var e=document.querySelector("#fg1"),t=e.getContext("2d"),i=0,s=H/3;for(e.width=W,e.height=H,t.fillStyle="hsla(0, 0%, 20%, 0.4)",t.beginPath();++i<s;)t.rect(0,3*i,W,2);t.fill()}(),resetScore(),a=0,(t=new l).reset(),addChild(t),PAUSE=!1,wae("keypress",u)},resize:function(t){W=c.width=e.innerWidth,H=c.height=e.innerHeight}}}(window);function initialize(){init("c")}wae("load",initialize),wae("resize",game.resize),window.debug=0</script>