<!doctype html><title>44 Save All</title><canvas id=c></canvas><script>let ctx=c.getContext("2d");addEventListener("resize",resize),oncontextmenu=e=>e.preventDefault();let look_horizontal=0,look_vertical=0,player_x=0,player_z=0,speed=6,amount=999,world_size=5e3,mouse_x=c.width/2,mouse_y=c.height/2,people=5,flies=1e3,hover=[],things=[],key={up:!1,down:!1,left:!1,right:!1,space:!1},p=0,found=0,begin=!0,lose=!1,good=!1,win=!1,value=0;function random(e,t){return Math.round(Math.random()*(t-e)+e)}function forest(){for(let e=0;e<amount;e++)things.push({x:random(0,world_size)-world_size/2,z:random(0,world_size)-world_size/2,position:0,type:"tree"});for(let e=0;e<people;e++)things.push({x:things[e].x+10,z:things[e].z-10,position:0,type:"man",selected:!1});for(let e=0;e<flies;e++)things.push({x:random(0,world_size)-world_size/2,z:random(0,world_size)-world_size/2,position:0,type:"fly",offset:random(-10,10)});things.push({x:player_x,z:player_z+100,position:0,type:"base"})}function sort_forest(){things.sort(((e,t)=>t.position-e.position))}function resize(){c.width=innerWidth,c.height=innerHeight,mouse_x=c.width/2,mouse_y=c.height/2}function start(){document.body.style.background="#fff",document.body.style.margin=0,document.body.style.overflow="hidden",c.style.background="#8ff",forest(),resize()}function loop(){if(sort_forest(),value+=.04,ctx.fillStyle="#000",ctx.fillRect(0,0,c.width,c.height),!(lose||good||win||begin)){hover=[];for(let e of things){key.up&&(e.z-=speed*Math.cos(look_horizontal*Math.PI/180),e.x-=speed*Math.sin(look_horizontal*Math.PI/180)),key.down&&(e.z+=speed*Math.cos(look_horizontal*Math.PI/180),e.x+=speed*Math.sin(look_horizontal*Math.PI/180)),key.left&&(e.z-=speed*Math.sin(look_horizontal*Math.PI/180),e.x+=speed*Math.cos(look_horizontal*Math.PI/180)),key.right&&(e.z+=speed*Math.sin(look_horizontal*Math.PI/180),e.x-=speed*Math.cos(look_horizontal*Math.PI/180));let t=Math.cos(look_vertical*Math.PI/180)*(Math.sin(look_horizontal*Math.PI/180)*(e.x-player_x)+Math.cos(look_horizontal*Math.PI/180)*(e.z-player_z));if(e.position=t,t>0){ctx.save(),ctx.translate(c.width/2,c.height/2),ctx.scale(700/t,700/t);let o=Math.cos(look_horizontal*Math.PI/180)*(e.x-player_x)-Math.sin(look_horizontal*Math.PI/180)*(e.z-player_z),l=Math.sin(look_vertical*Math.PI/180)*t*5+45;if(l-=104,"base"==e.type&&e.draw&&(ctx.fillStyle="rgb("+5e4/t+", "+3e4/t+", "+1e4/t+")",ctx.fillRect(o-5,l,10,100),ctx.fillStyle="rgb(0, "+4e4/t+", 0)",ctx.fillRect(o-50,l,100,-100),ctx.fillStyle="#f00b",ctx.fillRect(o-5,l,10,100),ctx.fillRect(o-50,l,100,-100)),"man"==e.type){let i=5*Math.sin(2*value);ctx.fillStyle="rgb(0, "+3e4/t/2.5+", "+5e4/t/2.5+")",ctx.fillRect(o,l+50+i,20,50),ctx.fillStyle="#fff",ctx.fillRect(o+2,l+52+i,7,7),ctx.fillRect(o+11,l+52+i,7,7),ctx.fillStyle="#000",ctx.fillRect(o+5,l+65+i,10,3),ctx.fillRect(o+5,l+56+i,3,3),ctx.fillRect(o+12,l+56+i,3,3),(mouse_x-c.width/2)/(700/t)>o&&(mouse_x-c.width/2)/(700/t)<o+20&&(mouse_y-c.height/2)/(700/t)>l+50&&(mouse_y-c.height/2)/(700/t)<l+100&&t<300&&(hover.push(things.indexOf(e)),ctx.fillStyle="#fffb",ctx.fillRect(o,l+50+i,20,50))}"fly"==e.type&&(ctx.fillStyle="#ff0",ctx.fillRect(o+50*Math.sin(value+e.offset),l+50*Math.cos(value+e.offset),e.offset/2,e.offset/2),e.z+=e.offset/5),"tree"==e.type&&(ctx.fillStyle="rgb("+5e4/t+", "+3e4/t+", "+1e4/t+")",ctx.fillRect(o-5,l,10,100),ctx.fillStyle="rgb(0, "+4e4/t+", 0)",ctx.fillRect(o-50,l,100,-100),ctx.fillStyle="#0f09",ctx.fillRect(o+2.5,l+90,5,5),ctx.fillRect(o-8,l+95,5,5),ctx.fillRect(o+.3,l+80,5,5),ctx.fillRect(o+30,l+95,5,5),ctx.fillStyle="#0ff",ctx.fillRect(o+50,l+95,5,5)),ctx.restore()}if("man"==e.type&&e.selected)for(let t of things)if("base"==t.type){let o=t.x-e.x,l=t.z-e.z,i=Math.atan2(l,o);e.x+=Math.cos(i)*speed/1.3,e.z+=Math.sin(i)*speed/1.3,e.x>t.x-50-speed&&e.x<t.x+50+speed&&e.z>t.z-speed&&e.z<t.z+speed&&(lose=!0),player_x>t.x-100&&player_x<t.x+100&&player_z<t.z+100&&player_z>t.z-100&&(good=!0)}"base"!=e.type?(e.x<-world_size/2&&(e.x=world_size/2),e.x>world_size/2&&(e.x=-world_size/2),e.z<-world_size/2&&(e.z=world_size/2),e.z>world_size/2&&(e.z=-world_size/2)):e.x<-world_size/2||e.x>world_size/2||e.z<-world_size/2||e.z>world_size/2?e.draw=!1:e.draw=!0}ctx.fillStyle="#fff",ctx.fillRect(c.width/2-21,c.height/2-1,41,2),ctx.fillRect(c.width/2-1,c.height/2-21,2,41),ctx.fillStyle="#000",ctx.fillRect(c.width/2-20,c.height/2,41,2),ctx.fillStyle="#222",ctx.fillRect(c.width/2,c.height/2-20,2,41)}if(ctx.fillStyle="#fff",ctx.textAlign="left",ctx.font="3em arial",ctx.fillText(found+" / "+people+" found",0,42),begin&&(ctx.fillStyle="#fff",ctx.textAlign="center",ctx.font=c.width/100+"em monospace",ctx.fillText("44 Save All",c.width/2+50*Math.sin(value),c.height/2),ctx.font=c.width/200+"em monospace",ctx.fillText("Space to start",c.width/2,c.height/1.5),key.space&&(begin=!1)),lose&&(ctx.fillStyle="#fff",ctx.textAlign="center",ctx.font=c.width/100+"em monospace",ctx.fillText("LOSE",c.width/2,c.height/2),ctx.font=c.width/200+"em monospace",ctx.fillText("Space to restart",c.width/2,c.height/1.5),key.space&&(lose=!1,look_horizontal=0,look_vertical=0,p=0,found=0,things=[],ctx.textAlign="left",forest())),good)if(found<people){if(ctx.fillStyle="#fff",ctx.textAlign="center",ctx.font=c.width/100+"em monospace",ctx.fillText("Good!",c.width/2,c.height/2),ctx.font=c.width/200+"em monospace",ctx.fillText("Space to find more",c.width/2,c.height/1.5),key.space){for(let e of things)"man"==e.type&&e.selected&&things.splice(things.indexOf(e),1),"base"==e.type&&(e.z-=100);look_horizontal=0,look_vertical=0,good=!1,ctx.textAlign="left"}}else win=!0;win&&(ctx.fillStyle="#fff",ctx.textAlign="center",ctx.font=c.width/100+"em monospace",ctx.fillText("Well Done!",c.width/2+10*Math.sin(value),c.height/2),ctx.font=c.width/200+"em monospace",ctx.fillText("All the people were found!",c.width/2,c.height/1.5),ctx.fillText("Space to try again",c.width/2,c.height),key.space&&(win=!1,look_horizontal=0,look_vertical=0,p=0,found=0,things=[],ctx.textAlign="left",forest())),requestAnimationFrame(loop)}amount<people&&(alert("tree amount must be greater than people"),amount=999),onkeydown=e=>{"ArrowUp"==e.key&&(key.up=!0),"ArrowDown"==e.key&&(key.down=!0),"ArrowLeft"==e.key&&(key.left=!0),"ArrowRight"==e.key&&(key.right=!0)," "==e.key&&(key.space=!0)},onkeyup=e=>{"ArrowUp"==e.key&&(key.up=!1),"ArrowDown"==e.key&&(key.down=!1),"ArrowLeft"==e.key&&(key.left=!1),"ArrowRight"==e.key&&(key.right=!1)," "==e.key&&(key.space=!1)},onmousedown=()=>{c.requestPointerLock(),1==hover.length&&(things[hover[0]].selected=!0,found++),hover.length>1&&(things[hover[hover.length-1]].selected=!0,found++)},onmousemove=e=>{lose||good||win||begin||(look_horizontal+=e.movementX/9,look_vertical-=e.movementY/45)},start(),loop()</script>