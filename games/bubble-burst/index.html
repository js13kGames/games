<!doctype html><html><head><title>Bubble Burst - js13kGames 2024</title><style>body{height:100vh;padding:0;margin:0;overflow:hidden;background:#191919}canvas{background:0 0;width:100%;height:100%}body,canvas{touch-action:none;user-select:none}#b{background:linear-gradient(to bottom,#011133,#060e1a)}#b,#t{pointer-events:none}</style><meta content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no" name=viewport></head><body oncontextmenu=return!1 ondragstart=return!1><canvas id=b></canvas><canvas id=g></canvas><canvas id=t></canvas><script>var t=Object.defineProperty,e=(e,i,s)=>(i="symbol"!=typeof i?i+"":i)in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s;function i(t,e,i){return t*(1-i)+e*i}function s(t,e,i){return Math.min(Math.max(t,i),e)}let o,h,n=()=>{},a={};function r(t,e){a[t]=a[t]||[],a[t].push(e)}function l(t,e){a[t]=(a[t]||[]).filter(t=>t!=e)}function d(t,...e){(a[t]||[]).map(t=>t(...e))}let c={get:(t,e)=>"_proxy"==e||n};function p(){return h}function u(t,{contextless:e=!1}={}){if(o=document.getElementById(t)||t||document.querySelector("canvas"),o=e?o||new Proxy({},c):o)return(h=o.getContext("2d")||new Proxy({},c)).imageSmoothingEnabled=!1,d("init"),{canvas:o,context:h};throw Error("You must provide a canvas element for the game")}class x{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new x(this.x+t.x,this.y+t.y,this)}subtract(t){return new x(this.x-t.x,this.y-t.y,this)}scale(t){return new x(this.x*t,this.y*t)}normalize(t=this.length()||1){return new x(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?s(this._a,this._d,t):t}set y(t){this._y=this._c?s(this._b,this._e,t):t}}function y(){return new x(...arguments)}class g{constructor(t){return this.init(t)}init(t={}){this.position=y(),this.velocity=y(),this.acceleration=y(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration,i=(t&&(e=e.scale(t)),this.velocity=this.velocity.add(e),this.velocity);t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}_pc(){}}class f extends g{init({width:t=0,height:e=0,context:i=p(),render:s=this.draw,update:o=this.advance,children:h=[],anchor:n={x:0,y:0},opacity:a=1,rotation:l=0,drotation:d=0,ddrotation:c=0,scaleX:y=1,scaleY:u=1,...x}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:n,opacity:a,rotation:l,drotation:d,ddrotation:c,scaleX:y,scaleY:u,...x}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=o,r("init",()=>{this.context??(this.context=p())})}update(e){this._uf(e),this.children.map(t=>t.update&&t.update(e))}render(){var t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height,s=-(this.radius?i=2*this.radius:e)*this.anchor.x,o=-i*this.anchor.y;(s||o)&&t.translate(s,o),this.context.globalAlpha=this.opacity,this._rf(),(s||o)&&t.translate(-s,-o),this.children.map(t=>t.render&&t.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){var t,e,i,s,o,h;this._di&&({_wx:t=0,_wy:e=0,_wo:s=1,_wrot:i=0,_wsx:o=1,_wsy:h=1}=this.parent||{},{x:i,y:h}=(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=s*this.opacity,this._wsx=o*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*o,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=i+this.rotation,s={x:this._wx,y:this._wy},o=i,h=Math.sin(o),o=Math.cos(o),{x:s.x*o-s.y*h,y:s.x*h+s.y*o}),this._wx=i,this._wy=h,this._wx+=t,this._wy+=e)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(t=>{this.children.push(t),t.parent=this,t._pc=t._pc||n,t._pc()})}removeChild(...t){t.flat().map(t=>{var e,i=this.children;-1!=(e=i.indexOf(t))&&(i.splice(e,1),1)&&(t.parent=null,t._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=s(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}let v=/(\d+)(\w+)/;class m extends f{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(t=>null==(t=p())?void 0:t.font)(),...o}={}){super.init({text:t=""+t,textAlign:e,lineHeight:i,font:s,...o}),this.context&&this._p(),r("init",()=>{this.font??(this.font=p().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){var e;this._d=!0,this._f=t,this._fs=(t?{size:e=+(t=t.match(v))[1],unit:t[2],computed:e}:{computed:0}).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let o=this.context,t=[this.text];if(o.font=this.font,t=this.text.split("\n"),this._fw&&t.map(t=>{let e=t.split(" "),i=e.shift(),s=i;e.map(t=>{s+=" "+t,o.measureText(s).width>this._fw&&(this._s.push(i),s=t),i=s}),this._s.push(s)}),!this._s.length&&this.text.includes("\n")){let e=0;t.map(t=>{this._s.push(t),e=Math.max(e,o.measureText(t).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||o.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let i,s=void this.textAlign,o=this.context;s=this.textAlign||("rtl"==o.canvas.dir?"right":"left"),i="right"==s?this.width:"center"==s?this.width/2|0:0,this._s.map((t,e)=>{o.textBaseline="top",o.textAlign=s,o.fillStyle=this.color,o.font=this.font,this.strokeColor&&(o.strokeStyle=this.strokeColor,o.lineWidth=this.lineWidth??1,o.strokeText(t,i,this._fs*this.lineHeight*e)),o.fillText(t,i,this._fs*this.lineHeight*e)})}}function w(){return new m(...arguments)}function b(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}function P({fps:t=60,clearCanvas:e=!0,update:i=n,render:s,context:o=p(),blur:h=!1}={}){if(!s)throw Error("You must provide a render() function");let a,l,c,y,u,x=0,g=1e3/t,f=1/t,v=e?b:n,m=!0;function w(){if(l=requestAnimationFrame(w),m&&(c=performance.now(),y=c-a,a=c,!(1e3<y))){for(x+=y;x>=g;)d("tick"),u.update(f),x-=g;v(u.context),u.render()}}return h||(window.addEventListener("focus",()=>{m=!0}),window.addEventListener("blur",()=>{m=!1})),r("init",()=>{u.context??(u.context=p())}),u={update:i,render:s,isStopped:!0,context:o,start(){this.isStopped&&(a=performance.now(),this.isStopped=!1,requestAnimationFrame(w))},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:w,set _last(t){a=t}}}var _=(t=>(t.burstBalloon="b",t.up="u",t.down="d",t.play="p",t.web3="w",t.selectLevel="l",t.drag="dr",t.kill="k",t.bubbleParticle="bp",t))(_||{});const T=44100,C=new(window.AudioContext||webkitAudioContext),E=new(window.AudioContext||webkitAudioContext),S=(...t)=>k(E,M(...t)),k=(t,...e)=>{let i=t.createBufferSource(),s=t.createBuffer(e.length,e[0].length,T);return e.map((t,e)=>s.getChannelData(e).set(t)),i.buffer=s,i.connect(t.destination),i.start(),i},M=(t=1,e=.05,i=220,s=0,o=0,h=.1,n=0,a=1,r=0,l=0,d=0,c=0,p=0,y=0,u=0,x=0,g=0,f=1,v=0,m=0)=>{let w,b,_=2*Math.PI,P=r*=500*_/T**2,C=(0<u?1:-1)*_/4,S=i*=(1+2*e*Math.random()-e)*_/T,E=[],k=0,M=0,F=0,A=1,R=0,B=0,L=0;for(l*=500*_/T**3,u*=_/T,d*=_/T,c*=T,p=T*p|0,b=(s=99+T*s)+(v*=T)+(o*=T)+(h*=T)+(g*=T)|0;F<b;E[F++]=L)++B%(100*x|0)||(L=n?1<n?2<n?3<n?Math.sin((k%_)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/_%2+2)%2:1-4*Math.abs(Math.round(k/_)-k/_):Math.sin(k),L=(p?1-m+m*Math.sin(2*Math.PI*F/p):1)*(0<L?1:-1)*Math.abs(L)**a*t*.3*(F<s?F/s:F<s+v?1-(F-s)/v*(1-f):F<s+v+o?f:F<b-g?(b-F-g)/h*f:0),L=g?L/2+(g>F?0:(F<b-g?1:(b-F)/g)*E[F-g|0]/2):L),w=(i+=r+=l)*Math.sin(M*u-C),k+=w-w*y*(1-1e9*(Math.sin(F)+1)%2),M+=w-w*y*(1-1e9*(Math.sin(F)**2+1)%2),A&&++A>c&&(i+=d,S+=d,A=0),!p||++R%p||(i=S,r=P,A=A||1);return E};let R=C,F=null,L=Date.now(),A=Date.now();function I(){var t;F?R.resume():(t=((i,s,o,t=125)=>{let h,n,a,r,l,d,c,p,y,u,x,g,f,v,m=0,w=[],b=[],_=[],P=0,C=0,S=1,E={},k=T/t*60>>2;for(;S;P++)w=[S=p=g=0],o.map((t,e)=>{for(c=s[t][P]||[0,0,0],S|=!!s[t][P],v=g+(s[t][0].length-2-!p)*k,f=e==o.length-1,n=2,r=g;n<c.length+f;p=++n){for(l=c[n],y=n==c.length+f-1&&f||u!=(c[0]||0)|l,a=0;a<k&&p;a++>k-99&&y&&(x+=(x<1)/99))d=(1-x)*w[m++]/2||0,b[r]=(b[r]||0)-d*C+d,_[r]=(_[r++]||0)+d*C+d;l&&(x=l%1,C=c[1]||0,l|=0)&&(w=E[[u=c[m=0]||0,l]]=E[[u,l]]||((h=[...i[u]])[2]*=2**((l-12)/12),0<l?M(...h):[]))}g=v});return[b,_]})(...D),(F=k(C,...t)).loop=!0)}const D=[[[1,0,220,,1.12,.33,,1.2,,,,,,,.1,,,.55,.01],[.5,0,110,,.52,.9,,.4,,,,,,,.1,,,.32,.07,,-1045]],[[[,-1,,,,,,,10,,,,12,,,,10,,3,,,,,,8,,,,,,,,,,,,,,,,10,,,,12,,,,15,,20,,,,,,15,,,,,,,,,,],[1,1,8,,15,,20,,,,,,,,,,,,8,,15,,20,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,]],[[,-1,,,,,,,10,,,,11,,,,15,,10,,,,,,15,,,,,,,,,,,,,,,,10,,,,13,,,,15,,20,,,,,,27,,,,,,,,,,],[1,1,4,,11,,16,,,,,,,,,,,,4,,11,,16,,,,,,,,,,,,6,,13,,18,,,,,,,,,,,,6,,13,,18,,,,,,,,13,,,,]],[[,-1,,,13,,20,,22,,24,,25,,24,,22,,20,,,,15,,,,13,,,,13,,,,13,,,,,,8,,,,,,,,,,,,,,,,13,,,,13,,,,,,12,,15,,20,,,,,,,,,,,,,,,,,,13,,,,15,,,,,,],[1,1,8,,15,,,,,,,,,,17,,12,,6,,13,,18,,,,,,,,,,,,4,,11,,16,,20,,,,,,16,,20,,6,,13,,18,,,,,,,,13,,18,,8,,15,,20,,,,,,22,,,,20,,8,,15,,20,,,,,,,,,,,,]],[[,-1,,,,,,,,,29,,29,,25,,24,,20,,,,,,15,,,,,,,,,,,,,,,,,,27,,25,,24,,25,,24,,,,,,20,,,,,,,,,,,,,,,,,,29,,27,,25,,29,,27,,,,,,32,,,,,,,,,,,,,,,,,,25,,27,,25,,24,,,,,,20,,,,17,,,,,,,,],[1,1,25,,32,,25,,32,,,,,,,,,,24,,31,,24,,32,,,,,,,,,,22,,27,,34,,36,,,,,,,,,,20,,27,,32,,,,,,,,,,,,25,,32,,25,,32,,,,,,,,,,24,,31,,36,,32,,,,,,,,,,21,,32,,35,,,,,,,,,,35,,22,,34,,,,,,,,27,,34,,,,]]],[0,0,1,2,2,3,2],138,{title:"B",instruments:["m","b"],patterns:["Pattern 0","Pattern 1","Pattern 2","Pattern 3"]}];let B,j=!1,Y=0,G=0,H=0,X=0;function W(t){j=!0,Y=t.clientX*window.devicePixelRatio,G=t.clientY*window.devicePixelRatio,d(_.down,y(Y,G))}function U(t){d(_.up,y(t.clientX*window.devicePixelRatio,t.clientY*window.devicePixelRatio)),j=!1,I(),d(_.up,y(Y,G))}function O(t){j&&(H=t.clientX*window.devicePixelRatio,X=t.clientY*window.devicePixelRatio,Q())}function V(t){j=!0;var e=t.touches[0];return Y=e.clientX*window.devicePixelRatio,G=e.clientY*window.devicePixelRatio,d(_.down,y(Y,G)),t.preventDefault(),I(),!1}function q(t){t=t.changedTouches[0],d(_.up,y(t.clientX*window.devicePixelRatio,t.clientY*window.devicePixelRatio)),j=!1}function z(t){j&&(t=t.touches[0],H=t.clientX*window.devicePixelRatio,X=t.clientY*window.devicePixelRatio,Q())}function Q(){var t=H-Y,e=X-G;d(_.drag,{detail:{diffX:t,diffY:e}})}class N{constructor(t){e(this,"pos",y(0,0)),e(this,"canvas"),e(this,"lerpFactor",.04),e(this,"skipFrame",!1),this.canvas=t,this.pos=y(t.width,t.height)}setPosition(t){this.skipFrame=!0,this.pos=y(t)}follow(t,e={lerp:!0}){var s=t.x-this.canvas.width/2;t=t.y-this.canvas.height/2,this.skipFrame||(e.lerp?this.pos=y(i(this.pos.x,s,this.lerpFactor),i(this.pos.y,t,this.lerpFactor)):this.pos=y(s,t))}apply(t){t.setTransform(1,0,0,1,0,0),t.translate(-this.pos.x,-this.pos.y),this.skipFrame=!1}clear(t){t.clearRect(-1e3+this.pos.x,-1e3+this.pos.y,this.canvas.width+2e3,this.canvas.height+2e3)}}const J=y(0,0);class K{constructor(t){e(this,"mass",1),e(this,"velocity",y(0,0)),e(this,"force",y(J)),e(this,"pos",y(0,0)),e(this,"radius",.5),e(this,"baseSpeed",y(0,0)),this.pos=y(t)}applyForce(t){this.force=this.force.add(t)}setSpeed(t){this.baseSpeed=y(t),this.velocity=y(t)}update(){var t=y(this.force.x/this.mass,this.force.y/this.mass);this.velocity=this.velocity.add(t).add(this.baseSpeed),this.velocity.clamp(-8,-8,8,8),this.pos=this.pos.add(this.velocity),this.force=y(J)}render(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,5,0,2*Math.PI),t.fillStyle="#abc",t.fill()}}class ${constructor(t,i,s,o=.05){e(this,"p1"),e(this,"p2"),e(this,"length",1),e(this,"stiffness",.05),e(this,"damping",.5),e(this,"normalVector",y(0,0)),this.p1=t,this.p2=i,this.length=s,this.stiffness=o}hookesLaw(){var t=this.p2.pos.x-this.p1.pos.x,e=this.p2.pos.y-this.p1.pos.y,i=Math.sqrt(t*t+e*e),s=(this.normalVector=y(e,-t).normalize(),(i-this.length)*this.stiffness);this.p1.applyForce(y(t=t/i*s,e=e/i*s)),this.p2.applyForce(y(-t,-e)),i=this.p2.velocity.x-this.p1.velocity.x,s=this.p2.velocity.y-this.p1.velocity.y,t=i*this.damping,e=s*this.damping,this.p1.applyForce(y(t,e)),this.p2.applyForce(y(-t,-e))}update(){this.hookesLaw(),this.p1.update(),this.p2.update()}render(t,e,i={hideParticles:!1}){i.hideParticles||(e instanceof rt&&(t.beginPath(),t.moveTo(this.p1.pos.x,this.p1.pos.y),t.lineTo(this.p2.pos.x,this.p2.pos.y),t.strokeStyle="#abc",t.lineWidth=3,t.stroke()),this.p1.render(t),this.p2.render(t))}renderNormalVector(t){var e=(this.p1.pos.x+this.p2.pos.x)/2,i=(this.p1.pos.y+this.p2.pos.y)/2,s=e+20*this.normalVector.x,o=i+20*this.normalVector.y;t.beginPath(),t.moveTo(e,i),t.lineTo(s,o),t.stroke()}}function Z(t,e,i){let s=t.x,o=t.y,h=e.x,n=e.y,a=i.x,r=i.y;return n>r&&([h,a]=[a,h],[n,r]=[r,n]),o!==n&&o!==r||(o+=1e-4),!(o<n||o>r||s>Math.max(h,a)||!(s<Math.min(h,a)||(o-n)/(s-h)>=(r-n)/(a-h)))}function tt(t,e,i){i=i.subtract(e),t=t.subtract(e);var s=i.dot(i);return t=Math.max(0,Math.min(1,t.dot(i)/s)),e.add(i.scale(t))}function et(t,e,i,s,o){var h=o*o,n=h*o;return{x:.5*(2*e.x+(-t.x+i.x)*o+(2*t.x-5*e.x+4*i.x-s.x)*h+(3*e.x-t.x-3*i.x+s.x)*n),y:.5*(2*e.y+(-t.y+i.y)*o+(2*t.y-5*e.y+4*i.y-s.y)*h+(3*e.y-t.y-3*i.y+s.y)*n)}}function it(t,e,i){return t.distance(e)*t.distance(e)<=i*i}function st(t){return t*t*(3-2*t)}function ot(t){return t.reduce((t,e)=>t.add(e.pos),y(0,0)).scale(1/t.length)}let ht={r:50,g:150,b:155},nt={r:255,g:20,b:20};function at(t){t=Math.max(0,Math.min(t,13e4));var e=ht,i=nt;return t=(t-2e4)/11e4,`rgb(${Math.round(e.r+t*(i.r-e.r))}, ${Math.round(e.g+t*(i.g-e.g))}, ${Math.round(e.b+t*(i.b-e.b))})`}class rt{constructor(s,t={}){e(this,"pos"),e(this,"startPos"),e(this,"speed"),e(this,"path"),e(this,"particles",[]),e(this,"springs",[]),e(this,"maxHaltTime",3e3),e(this,"ellapsedHaltTime",this.maxHaltTime+1),e(this,"centerPoint",y(0,0)),e(this,"initialCenterPoint",y(0,0)),e(this,"direction",1),e(this,"stiffness",1),e(this,"gravity",y(0,0)),this.stiffness=t.stiffness||1,this.startPos=s[0],this.pos=s[0],this.gravity=null!=t&&t.gravity?y(t.gravity):y(0,0),this.path=t.path?y(t.path):y(0,0),this.speed=t.speed?y(t.speed):y(0,0),this.direction=t.direction||0,s.forEach(t=>{(t=new K(y(t))).setSpeed(this.speed.scale(this.direction)),this.particles.push(t)}),this.initialCenterPoint=ot(this.particles),s.forEach((t,e)=>{var i=(e+1)%s.length;t=t.distance(s[i]),this.springs.push(new $(this.particles[e],this.particles[i],t,this.stiffness))})}handlePathMovement(){var t;(this.path.x||this.path.y)&&(this.ellapsedHaltTime+=1e3/60,this.ellapsedHaltTime<=this.maxHaltTime?this.particles.forEach(t=>{t.setSpeed(y(0,0))}):((t=this.particles[0].pos.subtract(this.startPos)).x>=this.path.x&&t.y>=this.path.y&&1===this.direction?(this.ellapsedHaltTime=0,this.direction=-1):t.x<=-this.path.x&&t.y<=-this.path.y&&-1===this.direction&&(this.ellapsedHaltTime=0,this.direction=1),this.particles.forEach(t=>{t.setSpeed(this.speed.scale(this.direction))})))}update(){this.handlePathMovement(),this.particles.forEach(t=>{t.applyForce(this.gravity),t.update()}),(this.gravity.x||this.gravity.y)&&this.springs.forEach(t=>t.update()),this.centerPoint=ot(this.particles)}render(e){this.renderPath(e),this.particles.forEach(t=>{t.render(e)}),this.springs.forEach(t=>{t.render(e,this)}),this.renderRigidBody(e)}renderRigidBody(e){if(this.particles.length){e.save(),e.beginPath(),e.moveTo(this.particles[0].pos.x,this.particles[0].pos.y);for(let t=1;t<this.particles.length;t++)e.lineTo(this.particles[t].pos.x,this.particles[t].pos.y);e.closePath(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fill(),e.restore()}}renderPath(t){this.path&&(t.save(),t.beginPath(),t.strokeStyle=at(5e4),t.moveTo(this.initialCenterPoint.x-this.path.x,this.initialCenterPoint.y-this.path.y),t.lineTo(this.initialCenterPoint.x+this.path.x,this.initialCenterPoint.y-this.path.y),t.stroke(),t.restore())}}class lt{constructor(t,i,s){e(this,"state",""),e(this,"springs",[]),e(this,"particles",[]),e(this,"volume",0),e(this,"gasPressure",0),e(this,"centerPoint",y(0,0)),e(this,"balloonGravity",y(0,0)),e(this,"isStationairy",!1),e(this,"balloonType","p"),e(this,"text"),e(this,"lineWidth",10),e(this,"hideParticles",!1),e(this,"externalForce",y(0,0)),e(this,"isBalloon",!0),e(this,"hideText",!1),e(this,"ellapsedDeadTime",0),e(this,"timeToLive",0),e(this,"gasAmount",7e4),e(this,"R",.3),e(this,"T",3),this.hideText=(null==s?void 0:s.hideText)||!1,this.text=w({text:"",font:"32px Arial",color:"white",x:300,y:100,anchor:{x:.7,y:.2},context:t.getContext("2d")}),this.gasAmount=(null==s?void 0:s.gasAmount)||65e3,this.timeToLive=(null==s?void 0:s.timeToLive)||0,this.lineWidth=(null==s?void 0:s.lineWidth)||10,this.hideParticles=(null==s?void 0:s.hideParticles)||!1,this.balloonType=(null==s?void 0:s.balloonType)||"p";const o=(null==s?void 0:s.numParticles)||20,h=null!=s&&s.distance?5*(null==s?void 0:s.distance):50,n=(null==s?void 0:s.length)||10,a=(null==s?void 0:s.stiffness)||.08;this.isStationairy=(null==s?void 0:s.isStationairy)||!1;var r=2*Math.PI/o;for(let t=0;t<o;t++){const e=t*r,s=i.x+h*Math.cos(e),o=i.y+h*Math.sin(e);this.particles.push(new K(y(s,o)))}for(let t=0;t<o;t++){const e=(t+1)%o,i=new $(this.particles[t],this.particles[e],n,a);this.springs.push(i)}}calculateVolume(){let e=0,i=this.particles.length;for(let t=0;t<i;t++){var s=this.particles[t].pos,o=this.particles[(t+1)%i].pos;e+=s.x*o.y-o.x*s.y}return Math.abs(e)/2}calculateGasPressure(){return this.volume=this.calculateVolume(),this.gasAmount*this.R*this.T/this.volume}updateBalloonGravity(){this.timeToLive-=1e3/60;var t=Math.max(500,Math.min(this.gasAmount,13e4))/13e4*.2-.1;this.balloonGravity=y(.001,-t)}applyGasPressureForce(){const s=this.calculateGasPressure();this.springs.forEach(t=>{var e=t.p1,i=t.p2;t.length=this.gasAmount/5e3,t.length<1&&(t.length=1),"d"===this.balloonType?(e.applyForce(t.normalVector.scale(s).scale(.1)),i.applyForce(t.normalVector.scale(s).scale(-.1))):(e.applyForce(t.normalVector.scale(s)),i.applyForce(t.normalVector.scale(s).scale(-1)))})}update(){"d"===this.state?(this.ellapsedDeadTime+=1e3/60,this.ellapsedDeadTime<=2e3&&this.particles.forEach(t=>{t.applyForce(this.balloonGravity.add(this.externalForce)),t.update()})):(this.springs.forEach(t=>t.update()),this.particles.forEach(t=>{t.applyForce(this.balloonGravity.add(this.externalForce))})),this.centerPoint=ot(this.particles),this.handleGasInput(),this.updateBalloonGravity(),this.applyGasPressureForce();for(let e=0;e<this.particles.length;e++)for(let t=e+1;t<this.particles.length;t++){var i,s=this.particles[e],o=this.particles[t],h=s.pos.distance(o.pos);h<7.5&&(h=7.5-h,i=s.pos.subtract(o.pos).normalize(),s.pos=s.pos.add(i.scale(h/2)),o.pos=o.pos.subtract(i.scale(h/2)))}}handleGasInput(){this.isStationairy||"d"!==this.state&&(j?(A+150>Date.now()||(A=Date.now(),S(.2,void 0,513,void 0,void 0,.01,void 0,.5,void 0,void 0,-275,.08,void 0,void 0,void 0,void 0,.15,.87,.07,void 0,141)),this.gasAmount+=500):this.gasAmount-=500,this.gasAmount<1e4&&(this.gasAmount=1e4),130999<this.gasAmount)&&this.setState("d")}setState(t){"d"===(this.state=t)&&(S(1.9,void 0,346,.01,.04,.11,4,4.4,85,void 0,void 0,void 0,void 0,void 0,367,void 0,.32,.64,.16,void 0,-1094),d(_.burstBalloon,this),this.springs.length=0)}render(e){"d"!==this.state&&(this.springs.forEach(t=>t.render(e,this,{hideParticles:this.hideParticles})),this.renderOutline(e),this.renderGasAmount(y(this.centerPoint.x+10,this.centerPoint.y-10)),this.renderEnemyText(y(this.centerPoint.x+10,this.centerPoint.y-10)))}renderEnemyText(t){"e"===this.balloonType&&(this.text.text="XIII",this.text.color=at(13e4),this.text.x=t.x,this.text.y=t.y,this.text.render())}renderGasAmount(t){var e;this.hideText||(e=(this.gasAmount/13e4*13).toFixed(1),this.text.text=e,this.text.color=at(this.gasAmount),this.text.x=t.x,this.text.y=t.y,this.text.render())}renderOutline(e){e.beginPath(),e.moveTo(this.particles[0].pos.x,this.particles[0].pos.y),"d"===this.balloonType?e.strokeStyle="#fefefe66":"e"===this.balloonType?e.strokeStyle=at(13e4):"f"===this.balloonType?e.strokeStyle="#1c2":e.strokeStyle=at(this.gasAmount),e.lineWidth=this.lineWidth;var i=this.particles.map(t=>t.pos);for(let t=0;t<i.length;t++){var s=i[(t-1+i.length)%i.length],o=i[t],h=i[(t+1)%i.length],n=i[(t+2)%i.length];0===t&&e.moveTo(o.x,o.y);for(let t=0;t<1;t+=.1){var a=et(s,o,h,n,t);e.lineTo(a.x,a.y)}}e.closePath(),e.stroke()}}let dt=200,ct=200;function pt(){return{playerPos:y(200,-200),goalPos:y(2550,2550),objects:[{box:{pos:y(-500,0),width:1500,height:100}},{box:{pos:y(-500,-900),width:100,height:1e3}},{box:{pos:y(1e3,-900),width:100,height:1e3}},{box:{pos:y(-500,-900),width:1500,height:100}},{text:{pos:y(250,50),text:"Thank you for playing!"}},{box:{pos:y(350,-450),width:100,height:100}}]}}class ut{constructor(t){e(this,"alpha",0),e(this,"fadeDirection",1),e(this,"fadeSpeed",.01),e(this,"radius",70),this.pos=t}update(){this.alpha+=this.fadeDirection*this.fadeSpeed,.8<=this.alpha?(this.alpha=.8,this.fadeDirection=-1):this.alpha<=.1&&(this.alpha=.1,this.fadeDirection=1)}render(t){t.save(),t.globalAlpha=this.alpha,t.fillStyle="white",t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.fill(),t.restore()}checkIfGoalReached(t){if(it(t.centerPoint,this.pos,this.radius))return!0}}const xt="b-";function yt(t,e){try{localStorage.setItem(xt+t,e)}catch(t){}}function gt(t){let e=null;try{var i=localStorage.getItem(xt+t);i&&(e=JSON.parse(i))}catch(i){try{e=localStorage.getItem(xt+t)}catch(i){}}return e}class ft{constructor(t,i,s,o,h,n=40,a,c){e(this,"circlePos",y(0,0)),e(this,"circleRadius",0),e(this,"text"),e(this,"smallCircles",[]),e(this,"baseY"),e(this,"baseRadius",0),e(this,"time",0),e(this,"timeRadius",0),e(this,"duration",2e3),e(this,"direction",1),e(this,"directionRadius",1),e(this,"lineDashLength",100),e(this,"lineDashGap",50),e(this,"isDestroyed",!1),e(this,"isClicked",!1),e(this,"onUp",t=>{var e;if(!this.isClicked&&!this.isDestroyed&&(e=null==(e=this.canvas.getContext("2d"))?void 0:e.getTransform())&&it(y(t.x,t.y),this.circlePos.add(y(e.e,e.f)),this.circleRadius)){S(.4,void 0,23,void 0,.21,.02,4,3.1,void 0,26,void 0,void 0,void 0,void 0,75,void 0,.43,.81,.01,.46,-690);{let t=0;const i=setInterval(()=>{8<++t&&clearInterval(i),L+50>Date.now()||(L=Date.now(),S(void 0,1,7,.02,.01,.02,4,.5,void 0,void 0,1,.01,void 0,void 0,150,void 0,.21,void 0,.01))},150)}this.isClicked=!0,l(_.up,this.onUp),d(this.gameEvent,this.gameEventArgs),this.spawnSmallCircles()}}),this.canvas=t,this.gameEvent=a,this.gameEventArgs=c,this.circlePos=y(i,s),this.baseRadius=o,this.baseY=s,r(_.up,this.onUp),this.text=w({text:h,font:n+"px Arial",color:at(0),x:i,y:s,context:this.canvas.getContext("2d"),anchor:{x:.5,y:.5}})}update(){var t,e;this.isDestroyed||(this.time+=10*this.direction,this.timeRadius+=5*this.directionRadius,t=this.time%this.duration/this.duration,e=this.timeRadius%this.duration/this.duration,(.98<=t||t<=0)&&(this.direction*=-1),(.98<=e||e<=0)&&(this.directionRadius*=-1),t=st(t),e=st(e),this.circlePos.y=this.baseY+(10*t-3),this.circleRadius=this.baseRadius+(10*e-3),this.text.y=this.circlePos.y,this.smallCircles.forEach(t=>{t.update(),t.externalForce.x=2*(Math.random()-.5),t.externalForce.y-=.02}),this.isClicked&&(this.lineDashLength-=2,this.lineDashLength<=1&&(this.lineDashLength=1),this.lineDashGap+=5,this.baseRadius=1.01*this.baseRadius+4),this.smallCircles=this.smallCircles.filter(t=>-2e3<t.centerPoint.y))}render(e){this.isDestroyed||(this.baseRadius<=500&&(e.save(),e.beginPath(),e.arc(this.circlePos.x,this.circlePos.y,this.circleRadius,0,2*Math.PI),this.isClicked&&e.setLineDash([this.lineDashLength,this.lineDashGap]),e.strokeStyle=at(0),e.lineWidth=5,e.stroke(),e.setLineDash([]),e.restore()),this.isClicked||this.text.render(),this.smallCircles.forEach(t=>t.render(e)))}spawnSmallCircles(){for(let t=0;t<10;t++){var e=Math.random()*Math.PI*2,i=Math.random()*Math.PI,i=y(this.circlePos.x+Math.cos(i)*this.circleRadius,this.circlePos.y+Math.sin(e)*this.circleRadius),e=new lt(this.canvas,i,{gasAmount:5e3,length:1,distance:1,numParticles:10,stiffness:.2,lineWidth:2,hideParticles:!0,hideText:!0,isStationairy:!0});this.smallCircles.push(e)}}destroy(){this.isDestroyed=!0,l(_.up,this.onUp)}}class vt{constructor(t){e(this,"rigidBody"),e(this,"startPos"),e(this,"isSpike",!0),this.startPos=t,t=[y(0,0).add(t),y(25,50).add(t),y(-25,50).add(t)],this.rigidBody=new rt(t,{stiffness:.1,gravity:y(0,.01)})}update(){this.rigidBody.update()}render(e){if(this.particles.length){e.save(),e.beginPath(),e.moveTo(this.particles[0].pos.x,this.particles[0].pos.y);for(let t=1;t<this.particles.length;t++)e.lineTo(this.particles[t].pos.x,this.particles[t].pos.y);e.closePath(),e.fillStyle=at(13e4),e.fill(),e.restore(),this.rigidBody.render(e)}}get springs(){return this.rigidBody.springs}get particles(){return this.rigidBody.particles}}const mt=[function(){return{playerPos:y(0,0),goalPos:y(1550,80),objects:[{box:{pos:y(-500,160),width:2800,height:200}},{text:{pos:y(300,200),text:"⇨ Stick to floor and go ⇨"}},{text:{pos:y(1550,200),text:"Goal"}}]}},function(){return{playerPos:y(500,0),goalPos:y(1200,-400),objects:[{box:{pos:y(-500,160),width:2e3,height:200}},{box:{pos:y(1500,-1e3),width:300,height:2800}},{text:{pos:y(600,200),text:"⇨ Stick to floor to go ⇨"}},{text:{pos:y(1550,0),text:"Keep holding"}},{text:{pos:y(1200,200),text:"Hold to go ⇧"}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1800,1720),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{text:{pos:y(710,1750),text:"Hold to go ⇧"}},{text:{pos:y(980,1825),text:"Goal ⇨"}},{box:{pos:y(700,1650),width:200,height:150}},{box:{pos:y(-100,1800),width:2700,height:100}}]}},function(){return{playerPos:y(500,0),goalPos:y(0,-200),objects:[{box:{pos:y(-1e3,160),width:2e3,height:200}},{box:{pos:y(1e3,-1e3),width:300,height:2800}},{box:{pos:y(-1e3,-400),width:2e3,height:100}},{text:{pos:y(750,200),text:"Hold to go ⇧"}},{text:{pos:y(1050,0),text:"Keep holding"}},{text:{pos:y(600,-350),text:"⇦ Stick to ceiling to go ⇦"}}]}},function(){return{playerPos:y(150,280),goalPos:y(4650,820),objects:[{text:{pos:y(400,525),text:"⇨"}},{box:{pos:y(-100,500),width:1500,height:100}},{text:{pos:y(1200,525),text:"Falling is OK"}},{box:{pos:y(1750,700),width:1500,height:100}},{text:{pos:y(2700,725),text:"Don't be afraid"}},{box:{pos:y(3540,900),width:1800,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1400,950),objects:[{box:{pos:y(900,1450),width:350,height:350}},{box:{pos:y(900,850),width:350,height:350}},{box:{pos:y(0,650),width:2e3,height:200}},{box:{pos:y(700,1650),width:200,height:150}},{text:{pos:y(2020,200),text:"Up ⇧"}},{text:{pos:y(2020,1600),text:"Up ⇧"}},{text:{pos:y(2020,1e3),text:"Up ⇧"}},{text:{pos:y(1500,800),text:"⇦ Stick to ceiling to go Left ⇦"}},{box:{pos:y(2e3,-100),width:150,height:2e3}},{box:{pos:y(-100,-100),width:2250,height:100}},{box:{pos:y(-100,1800),width:2100,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1650,1e3),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{box:{pos:y(1900,850),width:350,height:350}},{box:{pos:y(-100,650),width:2e3,height:200}},{box:{pos:y(700,1650),width:200,height:150}},{box:{pos:y(1700,1650),width:200,height:150}},{box:{pos:y(-100,1800),width:2600,height:100}}]}},function(){return{playerPos:y(0,0),goalPos:y(1550,80),objects:[{box:{pos:y(-500,160),width:2800,height:200}},{text:{pos:y(100,200),text:"Some bubbles are friendly"}},{enemy:{pos:y(500,-20),options:{balloonType:"f"}}},{enemy:{pos:y(860,-50),options:{balloonType:"f"}}}]}},function(){return{playerPos:y(200,0),goalPos:y(1200,-400),objects:[{box:{pos:y(-500,160),width:2e3,height:200}},{box:{pos:y(1500,-1e3),width:200,height:2800}},{enemy:{pos:y(1200,-20),options:{balloonType:"e"}}},{enemy:{pos:y(860,-50),options:{balloonType:"f"}}},{text:{pos:y(200,200),text:"Some bubbles are dangerous"}},{text:{pos:y(200,250),text:"Use friends to take foes"}}]}},function(){return{playerPos:{x:0,y:0},goalPos:{x:2550,y:80},objects:[{box:{pos:{x:-500,y:160},width:1e3,height:100}},{box:{pos:{x:1e3,y:160},width:500,height:100,options:{path:{x:500,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:2e3,y:160},width:2e3,height:100}}]}},function(){return{playerPos:{x:0,y:0},goalPos:{x:2550,y:80},objects:[{box:{pos:{x:-500,y:160},width:1e3,height:100}},{box:{pos:{x:1e3,y:160},width:250,height:100,options:{path:{x:250,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:1550,y:160},width:250,height:100,options:{path:{x:250,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:{x:2100,y:160},width:2e3,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(2400,1720),objects:[{box:{pos:y(700,1600),width:dt,height:dt}},{box:{pos:y(900,1400),width:dt,height:400}},{box:{pos:y(1100,1200),width:dt,height:600}},{box:{pos:y(1300,1e3),width:dt,height:800}},{box:{pos:y(-100,1800),width:3400,height:100}}]}},function(){return{playerPos:y(0,0),goalPos:y(0,500),objects:[]}},function(){return{playerPos:y(150,1450),goalPos:y(2200,1720),objects:[{enemy:{pos:y(400,1600),options:{balloonType:"f"}}},{enemy:{pos:y(2e3,1750),options:{balloonType:"e"}}},{enemy:{pos:y(1e3,1e3),options:{balloonType:"e"}}},{box:{pos:y(700,1600),width:ct,height:ct}},{box:{pos:y(900,1400),width:ct,height:400}},{box:{pos:y(1100,1200),width:ct,height:600}},{box:{pos:y(1300,1e3),width:ct,height:800}},{box:{pos:y(-100,1800),width:3400,height:100}}]}},function(){return{playerPos:y(150,1450),goalPos:y(1800,1720),objects:[{box:{pos:y(1900,1450),width:350,height:350}},{text:{pos:y(710,1750),text:"Hold to go ⇧"}},{box:{pos:y(700,1650),width:200,height:150}},{enemy:{pos:y(1e3,1500),options:{balloonType:"f"}}},{spike:{pos:y(1025,1650)}},{spike:{pos:y(1100,1650)}},{box:{pos:y(-100,1800),width:2700,height:100}}]}},function(){return{playerPos:{x:100,y:1360},goalPos:{x:900,y:760},objects:[{box:{pos:{x:-600,y:1500},width:2e3,height:150}},{box:{pos:{x:1200,y:0},width:200,height:1500}},{box:{pos:{x:400,y:1060},width:800,height:50}}]}},function(){return{playerPos:{x:100,y:1360},goalPos:{x:750,y:520},objects:[{box:{pos:{x:-600,y:1500},width:2e3,height:150}},{box:{pos:{x:1200,y:0},width:200,height:1500}},{box:{pos:{x:400,y:1060},width:550,height:50}},{box:{pos:{x:400,y:660},width:550,height:50}}]}},function(){return{playerPos:{x:300,y:1200},goalPos:{x:1900,y:1e3},objects:[{box:{pos:{x:0,y:1400},width:1e3,height:150}},{box:{pos:{x:1300,y:1700},width:100,height:1500}},{spike:{pos:{x:1300,y:1600}}},{box:{pos:{x:1540,y:1700},width:100,height:1500}},{spike:{pos:{x:1540,y:1600}}},{box:{pos:{x:1650,y:1150},width:450,height:50}},{box:{pos:{x:1250,y:800},width:450,height:50}},{box:{pos:{x:1750,y:1500},width:900,height:150}},{enemy:{pos:{x:1150,y:1450},options:{balloonType:"f"}}},{enemy:{pos:{x:1400,y:1350},options:{balloonType:"f"}}},{enemy:{pos:{x:900,y:900},options:{balloonType:"e"}}}]}},function(){return{playerPos:{x:260,y:1300},goalPos:{x:2570,y:1080},objects:[{box:{pos:{x:0,y:1400},width:4300,height:175}},{box:{pos:{x:850,y:800},width:100,height:100}},{box:{pos:{x:1500,y:500},width:100,height:100}},{box:{pos:{x:1250,y:800},width:650,height:100}},{box:{pos:{x:2400,y:1250},width:100,height:150}},{box:{pos:{x:3060,y:1080},width:150,height:320}},{enemy:{pos:{x:1400,y:1350},options:{balloonType:"f"}}},{enemy:{pos:{x:2100,y:1100},options:{balloonType:"f"}}},{enemy:{pos:{x:2100,y:1100},options:{balloonType:"e"}}},{enemy:{pos:{x:-100,y:1200},options:{balloonType:"e"}}},{spike:{pos:{x:2250,y:1300}}},{spike:{pos:{x:2900,y:1300}}}]}},function(){return{playerPos:y(0,0),goalPos:y(2550,80),objects:[{box:{pos:y(-500,160),width:1500,height:100}},{spike:{pos:y(900,-500)}},{spike:{pos:y(800,-500)}},{spike:{pos:y(1900,-50)}},{spike:{pos:y(2150,-50)}},{box:{pos:y(1e3,-200),width:500,height:100,options:{path:{x:500,y:0},speed:{x:1.5,y:0},direction:-1}}},{box:{pos:y(1700,160),width:1500,height:100}}]}},pt,pt];function wt(a,r){let l=[],t=(mt.length-2)/2;null!=r&&r.bonusLevels.length&&(t=r.bonusLevels.length/2);for(let n=1;n<=t;n++)for(let h=1;h<=2;h++){let t=225*n-400,e=225*h-400,i=2*n,s=(1===h&&--i,13<=i&&(i+=1),"Level "+i),o=gt("complete-"+i);var d={levelId:i,levelData:null};null!=r&&r.bonusLevels.length&&(s="Bonus "+i,o=gt("complete-bonus-"+r.bonusLevels[i-1].levelId),d.levelData=r.bonusLevels[i-1]),o&&(i<10&&(s+="\n    ✔"),10<=i)&&(s+="\n     ✔"),d=new ft(a,t,e,75,s,30,_.play,d),l.push(d)}var e=w({text:"Drag screen to see more levels",font:"32px Arial",color:at(1e3),x:0,y:300,anchor:{x:.5,y:.5},context:a.getContext("2d")});return l.push(e),l}let bt,Pt;function _t(){Pt.forEach(t=>{var e=window.devicePixelRatio||1;t.width=window.innerWidth*e,t.height=window.innerHeight*e,t.style.position="absolute",t.style.left="0",t.style.top="0",(t=t.getContext("2d"))&&t.scale(e,e)})}let Tt=0,Ct=0;function Et(t,e){return t!==e&&(null==t?void 0:t.isBalloon)&&(null==e?void 0:e.isSpike)&&"d"!==(null==t?void 0:t.state)}let St=!1,kt=u("g").canvas,Mt=u("t").canvas,Rt=u("b").canvas,Ft="m",Lt="l";const At=new class{constructor(t){e(this,"targetY",-10),e(this,"lerpFactor",.09),e(this,"pos",y(0,0)),e(this,"state","fadein"),this.canvas=t,this.pos.y=t.height}getState(){return this.state}update(){this.pos.y-2>=this.targetY?this.pos.y=i(this.pos.y,this.targetY,this.lerpFactor):this.pos.y=i(this.pos.y,this.targetY-this.canvas.height,this.lerpFactor),this.handleState()}handleState(){"fadein"===this.state&&this.isFadeInComplete()?this.state="fadeout":"fadeout"===this.state&&this.isFadeOutComplete()&&(this.state="comeplete")}render(t){var{width:e,height:i}=this.canvas;t.save(),t.clearRect(0,0,e,i),t.fillStyle="black",t.fillRect(0,this.pos.y,e,i),t.restore()}isFadeInComplete(){return this.pos.y<=this.targetY}isFadeOutComplete(){return this.pos.y-2<=this.targetY-this.canvas.height}reset(){this.state="fadein",this.pos.y=this.canvas.height}}(Mt);let It,Dt,Bt,jt=[],Yt=1,Gt=null,Ht=!1,Xt=!1,Wt=!1;const Ut=[];let Ot=!1,Vt=[];const qt=[],zt=[],Qt=[],Nt=[],Jt=new ft(kt,0,-120,75,"Play",40,_.selectLevel,{}),Kt=(qt.push(Jt),new ft(kt,0,120,75,"Web3",40,_.web3,{}));function $t(){zt.length=0,wt(kt).forEach(t=>{zt.push(t)})}qt.push(Kt);let Zt=y(0,0),te=y(0,0);r(_.drag,({detail:t})=>{Zt=te.add(y(-t.diffX,0))}),r(_.burstBalloon,t=>{t.particles.forEach(t=>{Ut.push(t)})}),r(_.down,()=>{te=y(Zt)}),r(_.play,({levelId:t,levelData:e})=>{setTimeout(()=>{Yt=t,Gt=e,Lt="l",At.reset(),ie.start()},500)}),r(_.web3,()=>{!async function(){if(!St){r(_.selectLevel,()=>{var t;St=!0,null!=(t=document.getElementById("w"))&&t.remove(),null!=(t=document.getElementById("c"))&&t.remove(),null!=(t=document.getElementById("s"))&&t.remove(),null!=(t=document.getElementById("q"))&&t.remove()}),(u=document.createElement("div")).id="w",u.style.position="absolute",u.style.bottom="13vh",u.style.zIndex="99",u.style.height="0",u.style.width="100vw",u.style.display="flex",u.style.alignItems="flex-end",u.style.justifyContent="space-evenly",document.body.appendChild(u);let t=u,[e,i]=(u=t,a=document.createElement("div"),(l=document.createElement("div")).style.bottom="16vh",a.id="s",l.id="q",[a,l].forEach(t=>{t.style.color="#fff",t.style.display="flex",t.style.position="absolute",t.style.flexDirection="column",t.style.alignItems="center"}),d=document.createElement("div"),c=document.createElement("div"),p=document.createElement("div"),y=document.createElement("div"),p.textContent="Loading NPCs",y.textContent="Loading Bonus levels",a.appendChild(p),a.appendChild(d),l.appendChild(y),l.appendChild(c),[d,c].forEach(t=>{t.style.border="16px solid #fff",t.style.borderTop="16px solid #1aa",t.style.borderRadius="50%",t.style.width="75px",t.style.height="75px",t.style.animation="spin 2s linear infinite"}),(p=document.styleSheets[0]).insertRule("\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ",p.cssRules.length),u.appendChild(a),u.appendChild(l),[a,l]),[s,o,h,n]=(y=import(new URL("https://esm.sh/thirdweb@5.50.0")),d=import(new URL("https://esm.sh/thirdweb@5.50.0/chains")),c=import(new URL("https://esm.sh/thirdweb@5.50.0/extensions/erc721")),p=import(new URL("https://esm.sh/thirdweb@5.50.0/storage")),await Promise.all([y,d,c,p]));var a,l,d,c,p,y,u;St?(t.removeChild(e),t.removeChild(i)):(async function(t,e){var i=e.download({client:t,uri:"ipfs://QmaGn65fZnKw25fqYGNqpzpjsXmnLGUdRPs5cvFEkquNnQ"}),s=e.download({client:t,uri:"ipfs://QmPHsFPjchGU2J66gS9G5uQuPaCPmc8Rx6yzFWTYtyozFB"}),o=e.download({client:t,uri:"ipfs://QmckDTy8fDwUtWxbEHjdMjSmUS7VJV5u9zDF4jQVBfXS9P"});return e=e.download({client:t,uri:"ipfs://QmSmJq4vTHeQvdkWX1qcCQMUJJpxWc5jTTZQRPPimmBAKn"}),Promise.all([i,s,o,e])}(u=s.createThirdwebClient({clientId:"1208e5a68330be8540c30917e7065d4d"}),n).then(e=>async function(){var t=e.map(t=>fetch(t.url));await Promise.all(t).then(t=>Promise.all(t.map(t=>t.json()))).then(t=>{var e;(Vt=t).sort((t,e)=>t.levelId-e.levelId),t=kt,e=Vt,Qt.length=0,wt(t,{bonusLevels:e}).forEach(t=>Qt.push(t)),t=new ft(kt,0,120,75,"Bonus",40,_.selectLevel,{type:"b"}),qt.push(t)})}()).then(()=>{t.removeChild(i)}),async function(s,t,o){const h=document.createElement("div");if(h.id="c",h.style.position="absolute",h.style.bottom="10vh",h.style.zIndex="9",h.style.width="100vw",h.style.display="flex",h.style.alignItems="flex-end",h.style.justifyContent="center",h.style.color="#fff",h.innerHTML="",t=await t.getNFTs({contract:s,start:0,count:3}),!St){document.body.appendChild(h);const s=[];t.forEach(e=>{const i=document.createElement("img");i.src=null==(t=null==e?void 0:e.metadata)?void 0:t.image,i.width=1e3,i.height=1e3,i.style.width="10vw",i.style.height="auto",i.style.borderRadius="50%",i.style.animation="spin 5s linear infinite";var t=JSON.stringify({r:null==(t=e.metadata)?void 0:t.attributes[0].value,g:null==(t=e.metadata)?void 0:t.attributes[1].value,b:null==(t=e.metadata)?void 0:t.attributes[2].value});i.setAttribute("r",t),i.addEventListener("click",()=>{var t;for(let t=0;t<s.length;t++)s[t].style.border="none";i.style.border="2px solid #fff",h.innerHTML=`I, ${null==(t=e.metadata)?void 0:t.name}, give you `+(null==(t=e.metadata)?void 0:t.description),t=JSON.parse(i.getAttribute("r")),ht=t}),o.appendChild(i),s.push(i)})}}(s.getContract({client:u,address:"0xcA61C32f3912b3882fB488eBF44F8275f41faFf1",chain:o.avalanche}),h,t).then(()=>{t.removeChild(e)}))}}();var t=w({x:0,y:-250,color:at(1e3),text:"Web3 enabled\nFetching NPCs and bonus levels",font:"32px Arial",anchor:{x:.5,y:.5},textAlign:"center",context:kt.getContext("2d")});qt.push(t)}),r(_.selectLevel,({type:t})=>{setTimeout(()=>{Lt="b"===t?"b":"s",At.reset(),ie.start()},500)}),r(_.bubbleParticle,({pos:t})=>{var e;Nt.push(((e=new lt(e=kt,t,{gasAmount:500,length:1,distance:2,numParticles:5,stiffness:.1,lineWidth:4,hideParticles:!0,hideText:!0,isStationairy:!0,balloonType:"d",timeToLive:1e3+2e3*Math.random()})).externalForce.x=(Math.random()-.3)/8,e.externalForce.y-=.17,e))});const ee=P({update:function(){for(let t=Nt.length-1;0<=t;t--){var e=Nt[t];e.update(),e.timeToLive<=0&&Nt.splice(t,1)}if("m"===Ft)null!=Bt&&Bt.follow(y(0,0)),qt.forEach(t=>t.update());else if("s"===Ft)null!=Bt&&Bt.follow(Zt),zt.forEach(t=>t.update());else if("b"===Ft)null!=Bt&&Bt.follow(Zt),Qt.forEach(t=>t.update());else{jt.forEach(t=>t.update()),Ut.forEach(t=>t.update()),null!=Bt&&Bt.follow(null==It?void 0:It.centerPoint.add(y(200,-100)));{var a=[...jt,...Ut];Tt+=1e3/60;let n=null;for(let h=0;h<a.length;h++){let o=null;const r=a[h];r.particles&&r.particles.forEach(e=>{let i=0;for(let t=0;t<a.length;t++)if(h!==t){const h=a[t];if(!h.springs)continue;h.springs.forEach(t=>{(null!=r&&r.isBalloon||null!=r&&r.isSpike)&&Z(e.pos,t.p1.pos,t.p2.pos)&&i++,t=tt(e.pos,t.p1.pos,t.p2.pos),(!n||t.distance(e.pos)<n.distance(e.pos))&&(o=h,n=t)})}var t,s;i%2==1&&n&&((t=r)!==(s=o)&&null!=t&&t.isBalloon&&null!=s&&s.isBalloon&&"d"!==(null==t?void 0:t.state)&&"d"!==(null==s?void 0:s.state)&&("e"===(null==t?void 0:t.balloonType)||"e"===(null==s?void 0:s.balloonType))&&(null!=r&&r.setState("d"),null!=o)&&o.setState("d"),Et(r,o)&&null!=r&&r.setState("d"),Tt>Ct&&(Ct=50+200*Math.random(),Tt=0,d(_.bubbleParticle,{pos:n})),e.pos=y(n),e.velocity=e.velocity.scale(-1))})}}Xt||Wt||("d"===It.state&&(Wt=!0,jt.push(w({x:It.centerPoint.x,y:It.centerPoint.y,font:"32px Arial",text:"Bubble burst!",context:kt.getContext("2d")})),setTimeout(()=>{jt.length=0,Wt=!1,ee.stop(),he("l")},2e3)),Dt.checkIfGoalReached(It)&&!Xt&&(S(.9,void 0,579,.32,.03,.05,1,.8,void 0,24,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.84,.04,void 0,-1282),Xt=!0,Ut.length=0,setTimeout(()=>{jt.length=0,Xt=!1,Gt?(yt("complete-bonus-"+Yt,"true"),Gt=Vt.find(t=>t.levelId===Yt+1),Yt++,Gt||(Yt=mt.length)):(yt("complete-"+Yt,"true"),13==++Yt&&Yt++),ee.stop(),At.reset(),ie.start()},20)))}},render:function(){const e=kt.getContext("2d");var t,i;Bt.clear(e),Bt.apply(e),Nt.forEach(t=>t.render(e)),"m"===Ft?qt.forEach(t=>t.render(e)):"s"===Ft?zt.forEach(t=>t.render(e)):"b"===Ft?Qt.forEach(t=>t.render(e)):(t=Bt,i=Rt.getContext("2d"),oe(Rt,i,t),oe(Rt,i,t,{type:"h"}),jt.forEach(t=>t.render(e)),Ut.forEach(t=>t.render(e)))}}),ie=P({update:function(){null!=At&&At.update(),!Ot&&At.isFadeInComplete()?(Ot=!0,"s"===Lt?(Ft="s",qt.forEach(t=>{t&&t.destroy&&t.destroy()}),qt.length=0):"b"===Lt?(Ft="b",qt.forEach(t=>{t&&t.destroy&&t.destroy()}),qt.length=0):"l"===Lt&&(he("l"),zt.forEach(t=>{null!=t&&t.destroy&&t.destroy()}),Qt.forEach(t=>{null!=t&&t.destroy&&t.destroy()}))):At.isFadeOutComplete()&&(Ot=!1,null!=At&&At.reset(),ie.stop())},render:function(){var t=Mt.getContext("2d");null!=At&&At.render(t)}});let se=2e3;function oe(t,e,i,s){e.save();var{width:o,height:t}=t,h=e.createLinearGradient(0,t-200,0,t);e.setTransform(1,0,0,1,0,0),"h"===(null==s?void 0:s.type)?(h.addColorStop(0,"#010113"),h.addColorStop(1,"#060e1a"),e.translate(i.pos.x/-3,i.pos.y/-4)):(h.addColorStop(0,"#212133aa"),h.addColorStop(1,"#060e1a88"),e.translate(i.pos.x/-7,i.pos.y/-5)),e.fillStyle=h,e.beginPath(),e.moveTo(-se,600),e.fillRect(-se,580,o+2*se,t);for(let t=-se;t<=o+se;t+=50){var n="h"===(null==s?void 0:s.type)?20*Math.sin(.02*t)+150:20*Math.sin(.01*t)+260;e.lineTo(t,600-n)}e.lineTo(o+se,600),e.closePath(),e.fill(),e.restore()}async function he(t="m"){Ft=t,Ht||(e=[$t],Pt=[Rt,Mt,kt],window.addEventListener("resize",function(){bt&&clearTimeout(bt),bt=window.setTimeout(()=>{_t(),null!=e&&e.forEach(t=>t())},150)}),_t(),null!=e&&e.forEach(t=>t()),(B=kt).addEventListener("mousedown",W),B.addEventListener("mouseup",U),B.addEventListener("mousemove",O),B.addEventListener("touchstart",V,{passive:!1}),B.addEventListener("touchend",q),B.addEventListener("touchmove",z),Bt=new N(kt));var e,{player:t,goal:i,gameObjects:s}=function(h,t,e=1,i){const n=[];let s=mt[e-1]();return i&&(s=i),e=new lt(h,y(s.playerPos)),i=new ut(y(s.goalPos)),t.setPosition(e.centerPoint),s.objects.forEach(t=>{var e,i,s,o;if(t.box)n.push((e=t.box.pos,i=t.box.width,s=t.box.height,o=null==(o=t.box)?void 0:o.options,i=[y(e),y(e.x+i,e.y),y(e.x+i,e.y+s),y(e.x,e.y+s)],new rt(i,o)));else if(t.text){const e=w({x:t.text.pos.x,y:t.text.pos.y,text:t.text.text,font:"32px Arial",context:h.getContext("2d")});n.push(e)}else t.enemy?n.push(new lt(h,y(t.enemy.pos),{stiffness:.08,isStationairy:!0,hideText:!0,hideParticles:!0,...t.enemy.options})):t.spike&&n.push(new vt(y(t.spike.pos)))}),{player:e,goal:i,gameObjects:n}}(kt,Bt,Yt,Gt);It=t,Dt=i,(jt=s).splice(0,0,It),jt.splice(0,0,i),Ht=!0,ee.start()}he("m")</script>