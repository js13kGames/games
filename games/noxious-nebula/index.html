<!doctype html><meta name=viewport content="width=device-width"><title>Noxious Nebula</title><body style=margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-color:#000;color:#888;font-family:sans-serif><canvas width=950 height=600 style=background-color:#111213;max-width:100vw></canvas><a style="cursor:pointer;padding:4px 8px">mute</a><script>let e,i,t=()=>{},s={};function n(t,...e){(s[t]||[]).map((t=>t(...e)))}let a={get:(e,i)=>"_proxy"==i||t};function o(){return e}function r(){return i}function h(t,e){return Math.atan2(e.y-t.y,e.x-t.x)+Math.PI/2}function l(t,e,i){return{x:t.x+Math.sin(e)*i,y:t.y-Math.cos(e)*i}}function c(t,e){return(Math.random()*(e-t+1)|0)+t}function d(t,e){return[t,e]=[t,e].map((t=>u(t))),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function u(t){let{x:e=0,y:i=0,width:s,height:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,n=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=n*t.anchor.y),{x:e,y:i,width:s,height:n}}class p{constructor(t=0,e=0,i={}){this.x=t,this.y=e}add(t){return new p(this.x+t.x,this.y+t.y,this)}subtract(t){return new p(this.x-t.x,this.y-t.y,this)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}}function x(){return new p(...arguments)}class g extends class{constructor(t){return this.init(t)}init(t={}){this.position=x(),this.velocity=x(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.velocity;this.position=this.position.add(e),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=r(),render:s=this.draw,update:n=this.advance,children:a=[],anchor:o={x:0,y:0},...h}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:o,...h}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...e){e.flat().map((e=>{this.children.push(e),e.parent=this,e._pc=e._pc||t,e._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}}class y extends g{init({...t}={}){super.init({...t})}draw(){this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}let m=/(\d+)(\w+)/;class f extends g{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=r().font,...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(m),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=this.textAlign,e=this.context;this._s.map(((i,s)=>{e.textBaseline="top",e.textAlign=t,e.fillStyle=this.color,e.font=this.font,e.fillText(i,0,this._fs*this.lineHeight*s)}))}}function w(){return new f(...arguments)}let b=new WeakMap,v={},z={},_={0:"left",1:"middle",2:"right"};function P(t,e){let{x:i,y:s,width:n,height:a}=u(t);do{i-=t.sx||0,s-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(i,Math.min(e.x,i+n)),r=e.y-Math.max(s,Math.min(e.y,s+a));return o*o+r*r<e.radius*e.radius}function M(t,e){return parseFloat(t.getPropertyValue(e))||0}function k(t){let e=null!=t.button?_[t.button]:"left";z[e]=!0,R(t,"onDown")}function S(t){let e=null!=t.button?_[t.button]:"left";z[e]=!1,R(t,"onUp")}function E(t){R(t,"onOver")}function C(t){b.get(t.target)._oo=null,z={}}function O(t,e,i){let s=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):P(s,t))return s}}(t);s&&s[e]&&s[e](i),v[e]&&v[e](i,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function R(t,e){t.preventDefault();let i=t.target,s=b.get(i),{scaleX:a,scaleY:o,offsetX:r,offsetY:h}=function(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],a=parseFloat(n[0]),o=parseFloat(n[3]),r=(M(i,"border-left-width")+M(i,"border-right-width"))*a,h=(M(i,"border-top-width")+M(i,"border-bottom-width"))*o,l=(M(i,"padding-left")+M(i,"padding-right"))*a,c=(M(i,"padding-top")+M(i,"padding-bottom"))*o;return{scaleX:(s.width-r-l)/e.width,scaleY:(s.height-h-c)/e.height,offsetX:s.left+(M(i,"border-left-width")+M(i,"padding-left"))*a,offsetY:s.top+(M(i,"border-top-width")+M(i,"padding-top"))*o}}(s);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let n=s.touches[i];n||(n=s.touches[i]={start:{x:(t-r)/a,y:(e-h)/o}},s.touches.length++),n.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:l,identifier:c})=>{let d=s.touches[c];d.changed=!0,d.x=s.x=(i-r)/a,d.y=s.y=(l-h)/o,O(s,e,t),n("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[c],s.touches.length--,s.touches.length||n("touchEnd"))}))):(s.x=(t.clientX-r)/a,s.y=(t.clientY-h)/o,O(s,e,t))}function j(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:o(),i=b.get(e);t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))}))}function A(t,e){let i=t[0].toUpperCase()+t.substr(1);v["on"+i]=e}function D(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}class L{constructor({create:t,maxSize:e=1024}={}){this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function I(){return new L(...arguments)}const T={enemyExplode:[.4,,208,,.05,.01,4,1.68,,-.8,,,.01,,,.4,.15,.93,.01,.16],mineExplode:[.4,.5,902,.01,.01,.15,3,1.35,.8,.9,,,,1,,.5,,.42,.1],minePlaced:[,,210,.01,.01,0,,.15,,.3,54,.11,,,100,,.02,.47,,.2],mineNotPlaced:[1.13,,1996,.02,.01,.01,1,1.81,-.8,,14,.04,,,38,.1,,.11,.01],playerHit:[2,,1050,.01,.01,.02,3,1.06,-66,,,.15,,,,,.05,.82,.01,.03],pickup:[1,,10,,.01,.01,,1.76,92,-1,,,,.6,-6.7,,,.42,.01],playerCharge:[.1,0,10,1.5,,.2,1,0,.1],playerChargeFull:[,,145,,,.14,1,.74,,,595,.03,,,,,.01,,.02,.03],playerShoot:[2,,1182,,.01,0,1,.43,-84,50,,,,,,,.14,.94,.08,.01],playerBlast:[1.13,,125,.01,,.01,3,1.93,-5.8,.8,,,,,,,.04,,.1,.08],hitWall:[,,219,,,.09,,,-.1,-.1,-50,-.01,,-.1,-1,.1],shieldHit:[1.99,,44,.01,.01,.02,1,2.07,,,-183,.09,,.2,-1.6,,.03,,.02,.05],playerWin:[1.66,,441,.06,.26,.34,,1.11,,,83,.05,.02,,,.1,.11,.42,.23],nextLevel:[2.01,,307,,.29,.3,1,.96,3.6,.1,332,.16,.2,,29,,.15,.46,.15],playerDie:[,,176,,,.31,,.85,-1.8,,,,,.2,,.3,,.76,.08],enemyShoot:[1.19,,453,,.09,.02,1,.21,-3.2,,,,,,,.1,.07,.97,.09,.05],click:[,,1768,,.01,.01,,.2,14,39,,,,,.5,.3,,.31,.01]},H=(t,e=0)=>T[t]&&zzfx(e||T[t][0],...T[t].slice(1)),$=(t,e,i)=>{t.forEach((t=>e.forEach((e=>{d(t,e)&&i(t,e)}))))},N=(t,e)=>t.some((t=>e.some((e=>d(t,e)))));function B({x:t=0,y:e=0,ctx:i,r2:s,r1:n,c1:a,c2:o}){i.rect(t,e,2*s,2*s);var r=i.createRadialGradient(t+s,e+s,n,t+s,e+s,s);r.addColorStop(0,a),r.addColorStop(1,o),i.fillStyle=r,i.fill()}const Y=(t,e,i)=>t>i?t-2*i:t<e?t+2*Math.abs(e):t,F=(t,e)=>Math.sqrt(t*t+e*e),X=(t,e)=>Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y));let W=!0;window.addEventListener("focus",(()=>W=!0)),window.addEventListener("blur",(()=>W=!1));const q=(t,e)=>{let i=e/10;const s=()=>{if(W&&(i-=1),i<=0)return t();requestAnimationFrame(s)};requestAnimationFrame(s)},G={mineClickDuration:250,speed:4,size:35,maxMines:5,mineProximity:20,chargeRate:.25,maxCharge:30,mineRate:.2,health:100,shield:0,maxShield:0,shieldChargeRate:.1},U={homer:{color:"#f00",size:15,exhaust:!0,explodes:!0,maxSpeed:4.2,innerSize:3,speed:1,turnRate:.08,health:10,damage:10,separateAmount:30,value:5},big:{color:"#f00",exhaust:!0,explodes:!0,size:30,maxSpeed:2.8,speed:.5,turnRate:.04,health:50,damage:20,separateAmount:30,value:25},defender:{color:"#0f0",friction:.2,size:40,speed:4,turnRate:4,innerSize:10,health:15,damage:20,separateAmount:60,spikey:!0,collides:!0,exhaust:!1,explodes:!1,maxTargetDistance:200,minTargetDistance:100,value:25},absorber:{color:"#ff0",friction:.2,size:25,speed:5,turnRate:4,innerSize:10,health:25,damage:20,separateAmount:40,collides:!0,exhaust:!1,explodes:!1,maxTargetDistance:100,minTargetDistance:60,value:25},spike:{color:"#444",friction:.2,size:30,speed:4,health:50,damage:5,spikey:!0,collides:!0,exhaust:!1,explodes:!1,value:25}},V=[{waves:[{type:"homer",count:3,rate:2e3},{type:"homer",count:3,rate:1e3,delay:6e3},{type:"homer",count:6,rate:500,delay:9e3}]},{waves:[{type:"homer",count:30,rate:800}]},{waves:[{type:"defender",count:4,rate:1e3},{type:"homer",count:8,rate:1e3,delay:3e3}]},{waves:[{type:"absorber",count:4,rate:0}]},{waves:[{type:"defender",count:8,rate:1e3,delay:2e3,circular:!0},{type:"absorber",count:8,rate:0,circular:!0}]},{waves:[{type:"defender",count:4,rate:1e3},{type:"homer",count:15,rate:1e3,delay:1e3},{type:"absorber",count:4,rate:0}]},{waves:[{type:"defender",count:8,rate:1e3,circular:!0},{type:"homer",count:12,rate:1e3,delay:5e3},{type:"absorber",count:8,rate:0,circular:!0}]},{waves:[{type:"spike",count:8,rate:1e3}]},{waves:[{type:"defender",count:8,rate:1e3},{type:"homer",count:12,rate:1e3,delay:5e3},{type:"absorber",count:8,rate:0},{type:"spike",count:4,rate:1e3}]},{waves:[{type:"defender",count:12,rate:1e3},{type:"homer",count:12,rate:1e3,delay:5e3},{type:"absorber",count:12,rate:0},{type:"spike",count:8,rate:1e3},{type:"homer",count:12,rate:1e3,delay:1e4}]}],J={mine:{size:7,innerSize:6,triggerRadius:45,triggerDuration:300,explodeRadius:50,isMine:!0,damage:10},shot:{triggerRadius:1,angle:({sprite:t})=>t.angle-1.57,speed:({sprite:t})=>t.speed,size:({dur:t})=>t/250,health:({dur:t})=>t/80,damage:10},blast:{triggerRadius:45,ttl:30,explodeRadius:({dur:t})=>t/30,size:({dur:t})=>t/40,damage:({dur:t})=>t/200}},K=[{description:t=>"Repair your ship to full",key:"repair",label:"Repair",cost:[]},{description:t=>"Lay more mines at once",key:"mine_count",label:"More mines",cost:[50,100]},{description:t=>"Lay mines faster",key:"mine_speed",label:"Faster mines",cost:[50,100]},{description:t=>"Mines have larger explosions and do more damage",key:"mine_damage",label:"Bigger mines",cost:[200]},{description:t=>"Charge energy faster",key:"charge_speed",label:"Faster charge",cost:[250,500]},{description:t=>"Charge more energy before max, allowing more damage",key:"charge_max",label:"More charge",cost:[300,600]},{description:t=>"Provides shield which recharges over time.",key:"shield",label:"Shield",cost:[500]},{description:t=>"Fire one extra bullet when you fire a blast",key:"bullet_count",label:"Extra Blast",cost:[600,1200]}];var Q=Object.defineProperty,Z=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,it=(t,e,i)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;class st extends y{constructor(t){super(t)}addCharge(t){this.charge+=t,this.charge>=this.maxCharge&&(H("enemyShoot"),this.shoot(),this.charge=0)}takeDamage(t,e=!1){this.health<=0||(this.shield>0&&!e&&(t>this.shield?(t-=this.shield,this.shield=0):(this.shield-=t,t=0)),t>0&&(this.health-=t),this.health<=0&&this.die(),this.justDamaged=!0,setTimeout((()=>this.justDamaged=!1),100))}die(){this.ttl=0,this.opacity=this.isAlive()?1:0}update(){super.update()}render(){super.render()}}class nt extends st{constructor(t){super(((t,e)=>{for(var i in e||(e={}))tt.call(e,i)&&it(t,i,e[i]);if(Z)for(var i of Z(e))et.call(e,i)&&it(t,i,e[i]);return t})({anchor:{x:.5,y:.5}},t))}draw(){this.strobeTimer--;const t=.6*this.width,e=this.innerSize||t/2,i=this.width/2;this.context.lineWidth=3,this.context.strokeStyle="#222",this.context.fillStyle="#999",this.context.beginPath(),this.context.moveTo(i,i),this.context.arc(i,i,t,0,2*Math.PI),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.beginPath(),this.context.moveTo(i,i),this.context.fillStyle=this.color;const s=this.health/this.maxHealth*360;this.context.arc(i,i,t,at(-90),at(s-90)),this.context.closePath(),this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="#555",this.context.fillStyle="#111",this.context.beginPath(),this.context.arc(i,i,e,0,2*Math.PI),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.beginPath(),this.context.moveTo(i,i),this.context.fillStyle=this.isPlayer?"#0ff":"#a00";const n=(this.charge>0?this.charge:0)/this.maxCharge*360;if(this.context.arc(i,i,t/2,at(-90),at(n-90)),this.context.closePath(),this.context.fill(),"defender"===this.type&&(this.shield=this.maxShield||100),this.shield>0){this.context.beginPath(),this.context.lineWidth=3,this.context.strokeStyle="rgba(0,200,0,1)";const e=360*(this.shield/this.maxShield||100);this.context.arc(i,i,t+6,at(-90),at(e-90)),this.context.stroke()}}}function at(t){return Math.PI*t/180}var ot=Object.defineProperty,rt=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable,ct=(t,e,i)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,dt=(t,e)=>{for(var i in e||(e={}))ht.call(e,i)&&ct(t,i,e[i]);if(rt)for(var i of rt(e))lt.call(e,i)&&ct(t,i,e[i]);return t};class ut extends nt{constructor(t={}){super(t)}init(t){const e=U[t.type||"homer"];super.init(dt(dt({width:e.size,height:e.size,maxHealth:e.health,charge:0,maxCharge:30},e),t)),this.targetPos=this.target?{x:this.target.x,y:this.target.y}:null,this.angle=0,this.exhaustTimer=0}move(t){const{maxSpeed:e,speed:i,turnRate:s,friction:n,separateAmount:a,maxTargetDistance:o,minTargetDistance:r}=U[this.type];let d=this.x,u=this.y,p=1,x=this.angle;if(s){let e=h(this,t);x=Y(e-this.angle,-Math.PI,Math.PI),Math.abs(x)<s?this.angle=e:this.angle+=x>0?s:-s}else{const t=c(-100,100)/100;this.x>950-this.width&&(this.angle=Math.PI/-2+t),this.x<0&&(this.angle=Math.PI/2+t),this.y>600-this.width&&(this.angle=0+t),this.y<0&&(this.angle=Math.PI+t)}if(o){const e=X(this,t);e<o&&(p=0,r&&e<r&&(p=1,this.angle+=Math.PI))}this.angle=Y(this.angle,-Math.PI,Math.PI);const g=l(this.position,this.angle,i*p);if(this.dx+=g.x-this.position.x,this.dy+=g.y-this.position.y,n&&(this.dx*=n,this.dy*=n),a&&this.pool.getAliveObjects().forEach((t=>{t===this||t.type!==this.type||X(this,t)>a||(this.dx+=.02*(this.x-t.x),this.dy+=.02*(this.y-t.y))})),e){let t=e*(1-Math.abs(x)/Math.PI);const i=F(this.dx,this.dy);this.dx=this.dx/i*t,this.dy=this.dy/i*t}this.collides&&N([this],[this.target])&&(this.dx=0,this.dy=0,this.x=d,this.y=u)}draw(){"defender"===this.type&&this.getNearbyEnemies().forEach((t=>{this.context.lineWidth=3,this.context.strokeStyle="#0f0",this.context.beginPath(),this.context.moveTo(this.width/2,this.width/2);const e=t.position.subtract(this.position);this.context.lineTo(e.x+t.width/2,e.y+t.width/2),this.context.stroke()})),super.draw()}shoot(){for(let t=0;t<18;t++)this.bullets.spawn({x:this.x+this.size/2,y:this.y+this.size/2,angle:2*Math.PI/18*t-Math.PI,damage:10,speed:8,size:7,isEnemyBullet:!0})}getNearbyEnemies(){return this.pool.getAliveObjects().filter((t=>"defender"!==t.type&&t.position.distance(this)<150)).slice(0,1)}update(){if(super.update(),this.targetPos=this.target?{x:this.target.x,y:this.target.y}:null,this.targetPos&&this.move(this.targetPos),"defender"===this.type&&this.getNearbyEnemies().forEach((t=>{let e=t.maxShield||100;(!t.shield||t.shield<e)&&(t.shield=e)})),this.shield>0&&(this.shield-=1),this.exhaust&&this.exhaustTimer--<1){const t=U[this.type||"homer"].size;this.exhaustTimer=Math.floor(t/10),this.particles.spawn({x:this.x+t/2,y:this.y+t/2,size:t/3,ttl:10+Math.floor(t/1.2),opacity:.5})}}die(){const t=U[this.type||"homer"].size;H("enemyExplode"),this.pickups.spawn({x:this.x+t/2,y:this.y+t/2,value:this.value,target:this.target}),this.particles.spawn({x:this.x+t/2,y:this.y+t/2,size:t,ttl:20}),super.die()}}var pt=Object.defineProperty,xt=Object.defineProperties,gt=Object.getOwnPropertyDescriptors,yt=Object.getOwnPropertySymbols,mt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,wt=(t,e,i)=>e in t?pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,bt=(t,e)=>{for(var i in e||(e={}))mt.call(e,i)&&wt(t,i,e[i]);if(yt)for(var i of yt(e))ft.call(e,i)&&wt(t,i,e[i]);return t},vt=(t,e)=>xt(t,gt(e));class zt extends st{constructor(t={}){super(t)}init(t){super.init(t),this.opacity=1}takeDamage(t){super.takeDamage(t);const e=Math.max(this.health/this.maxHealth*this.originalSize,0);this.size=e,this.width=e,this.height=e}update(){if(super.update(),0!==this.dx&&0!==this.dy&&this.enemies){const t=this.enemies.pool.getAliveObjects().filter((t=>t.position.distance(this)<("absorber"===t.type?200:100))).sort(((t,e)=>t.position.distance(this)-e.position.distance(this)))[0];if(t){const e=l({x:0,y:0},h(this,t),this.position.distance(t.position)/("absorber"===t.type?10:50));this.dx+=e.x,this.dy+=e.y;const i=10,s=F(this.dx,this.dy);this.dx=this.dx/s*i,this.dy=this.dy/s*i}}(this.x<0||this.y<0||this.x>900||this.y>900)&&(this.ttl=0)}draw(){this.ttl&&(this.opacity-=1/this.ttl);const t=this.size;let e=120,i=120,s=120;this.isMine&&(e=10,i=150,s=250),(this.isEnemyBullet||this.isMine&&this.triggered)&&(e=250,i=0,s=0),this.isMine||this.isEnemyBullet||(s=250,i=250,e=0);let n=`rgba(${e},${i},${s},${this.opacity})`,a=`rgba(${e},${i},${s},0)`;B({x:this.width/2-t,y:this.width/2-t,ctx:this.context,r1:Math.max(0,this.innerSize||this.width/2),r2:Math.max(0,t),c1:n,c2:a}),this.isMine&&(this.context.beginPath(),this.context.fillStyle="#b00",this.context.arc(this.width/2,this.width/2,2,0,2*Math.PI),this.context.closePath(),this.context.fill())}}var _t=Object.defineProperty,Pt=Object.getOwnPropertySymbols,Mt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable,St=(t,e,i)=>e in t?_t(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;class Et extends st{constructor(t={}){super(((t,e)=>{for(var i in e||(e={}))Mt.call(e,i)&&St(t,i,e[i]);if(Pt)for(var i of Pt(e))kt.call(e,i)&&St(t,i,e[i]);return t})({},t))}update(){super.update(),this.opacity-=this.initialOpacity/this.ttl}draw(){B({ctx:this.context,x:-this.width,y:-this.width,r1:this.width/1.5,r2:this.width,c1:`rgba(255,255,255,${this.opacity})`,c2:"rgba(255,255,255,0)"})}}const Ct=({canvas:t,onPurchase:e,onNext:i,getPlayer:s})=>{let n=!1;const a=function(){return new y(...arguments)}({x:t.width/2-250,y:50,width:500,height:400,color:"#555"});let o=[],r=null;const h=w({x:t.width/2+150,y:90,text:"",color:"rgba(255,255,255,1)",font:"24px sans-serif",anchor:{x:.5,y:.5}});o.push(h);const l=w({x:t.width/2-150,y:90,text:"",color:"rgba(255,255,255,0)",font:"24px sans-serif",anchor:{x:.5,y:.5}});o.push(l);const c=w({x:t.width/2,y:140,text:"a description",color:"rgba(255,255,255,0)",font:"16px sans-serif",anchor:{x:.5,y:.5}});o.push(c);const d=w({x:t.width/2,y:420,text:"Purchase",color:"rgba(255,255,255,0)",font:"32px sans-serif",anchor:{x:.5,y:.5},onDown(){if("string"==typeof(null==r?void 0:r.upgrade.key)){let t=s();const i=Number(l.text.replace("Cost: $",""));if(t.sprite.money<i)return void H("mineNotPlaced");e(r.upgrade);const n=s().upgrades;"repair"!==r.key&&(r.count.text=n[r.upgrade.key]),t.sprite.money-=i,h.text=`Cash: $${t.sprite.money}`,K.find((t=>t.key===r.upgrade.key)).cost[n[r.upgrade.key]]||(r.count.color="rgba(255,255,255,0.5)",r.label.color="rgba(255,255,255,0.5)",l.text="",c.text="")}r=null,H("click"),o.forEach((t=>{t.isLabel&&"#ee9"===t.color&&(t.color="white")})),this.color="rgba(255,255,255,0)"}});j(d),o.push(d);const u=w({x:t.width/2+200,y:420,text:"Next",color:"white",font:"32px sans-serif",anchor:{x:.5,y:.5},onDown(){n=!1,t.requestPointerLock(),H("nextLevel"),i()}});j(u),o.push(u);const p=s().upgrades;return K.forEach(((e,i)=>{var n,a;const h=t.width/2-150+i%4*100,u=i>=4?350:250,x=()=>{const t=s().upgrades,i=e.key;let n=e.cost[t[i]];"repair"===i&&(n=100-s().sprite.health),n&&(H("click"),o.forEach((t=>{t.isLabel&&"#ee9"===t.color&&(t.color="white")})),d.color="white",r={upgrade:e,count:y,label:m},m.color="#ee9",y.color="#ee9",l.text=`Cost: $${n}`,l.color="rgba(255,255,255,1)",c.text=`${e.description(t[i])}`,c.color="rgba(255,255,255,1)")},g=(null==(n=K.find((t=>t.key===e.key)))?void 0:n.cost[p[e.key]])||"repair"===e.key?1:.5,y=w({x:h,y:u-30,text:"repair"===e.key?"-":null==(a=p[e.key])?void 0:a.toString(),color:`rgba(255,255,255,${g})`,font:"24px sans-serif",anchor:{x:.5,y:.5},isLabel:!0,onDown:x});o.push(y);const m=w({x:h,y:u,text:e.label,color:`rgba(255,255,255,${g})`,font:"14px sans-serif",anchor:{x:.5,y:.5},onDown:x,isLabel:!0});j(m),j(y),o.push(m)})),{update(){n&&a.update()},getActive:()=>n,setActive(t){n=t,n&&document.exitPointerLock(),h.text=`Cash: $${s().sprite.money}`},render(){n&&(a.render(),o.forEach((t=>t.render())))}}};class Ot extends y{constructor(t={}){super(t)}init(t){super.init(t),this.opacity=1}die(){this.ttl=0}update(t){if(super.update(t),this.opacity>0)if(this.position.distance(this.target.position)<50){const t=l(this.position,h(this,this.target),.5);this.dx=t.x-this.position.x,this.dy=t.y-this.position.y}else this.dx=0,this.dy=0}draw(){this.ttl&&(this.opacity-=1/this.ttl),this.context.fillStyle=`rgba(255,200,0,${this.opacity})`,this.context.beginPath(),this.context.arc(0,0,3.5,0,2*Math.PI),this.context.fill()}}const Rt=({canvas:t,onWin:e,onLose:i})=>{let s=(()=>{let t=I({create:()=>new zt,maxSize:50});return{pool:t,spawn(e){const{health:i,speed:s=0,angle:n=0,enemies:a,isEnemyBullet:o}=e;return t.get({x:e.x,y:e.y,anchor:{x:.5,y:.5},width:e.triggerRadius||e.size||0,height:e.triggerRadius||e.size||0,dx:s*Math.cos(n),dy:s*Math.sin(n),size:e.size||0,innerSize:e.innerSize,originalSize:e.size||0,explodeRadius:e.explodeRadius||0,triggerDuration:e.triggerDuration||0,isMine:e.isMine||0,ttl:e.ttl||1/0,triggered:!1,damage:e.damage,enemies:a,maxHealth:i,health:i,isEnemyBullet:o})}}})(),n=(()=>{let t=I({create:()=>new Et,maxSize:200});return{pool:t,spawn({x:e,y:i,size:s=1,ttl:n=50,opacity:a=1}){t.get({x:e,y:i,width:s,ttl:n,opacity:a,initialOpacity:a})}}})(),a=0,o=!1;const r=()=>{o=!1,y.sprite.health=100,V[a].waves.forEach((t=>g.spawn(y.sprite,t,t.delay||0))),s.pool.clear(),a++},d=t.width/2,u=t.height/2;let p,x=(({canvas:t})=>{const e=I({create:()=>new Ot});return{pool:e,spawn({x:t,y:i,value:s,target:n}){e.get({x:t,y:i,value:s,ttl:400,target:n})}}})({canvas:t}),g=(({canvas:t,particles:e,bullets:i,pickups:s})=>{let n=I({create:()=>new ut,maxSize:50}),a=0;return{pool:n,getRemaining:()=>a+n.getAliveObjects().length,spawn(o,r,h=0){let{type:d="homer",count:u=1,rate:p=0,circular:x,wall:g,dir:y}=r;a+=u,y=null!=y?y:c(0,3);for(let r=0;r<u;r++){let m,f;if(x){const{size:e}=U[d],i=l({x:t.width/2-e/2,y:t.height/2-e/2},-Math.PI+2*Math.PI/u*r,600);m=i.x,f=i.y}else{const e=50;g||(y=c(0,3)),m=-e,f=-e,y<2?(f=g?100*r:c(e,t.height-e),1===y&&(m=t.width+e)):(m=g?100*r:c(e,t.width-e),3===y&&(f=t.height+e))}q((()=>{n.get({x:m,y:f,ttl:1/0,target:o,pool:n,bullets:i,particles:e,pickups:s,type:d}),a--}),h+(g?0:r*p))}}}})({canvas:t,particles:n,bullets:s,pickups:x}),y=(({canvas:t,x:e,y:i,bullets:s,getStoreActive:n,enemies:a})=>{const{speed:o,maxCharge:r,size:l,maxMines:c,mineProximity:d,chargeRate:u,mineRate:p,health:x,shield:g,maxShield:y,shieldChargeRate:m}=G;let f=new nt({x:e,y:i,color:"#666",width:l,height:l,health:x,maxHealth:x,charge:-2,maxCharge:r,mineDuration:0,shield:g,maxShield:y});const w={};K.forEach((t=>{w[t.key]=0}));let b=!1;A("down",(()=>{n()||(b=!0,f.shouldPlayChargeSound=!0,f.shouldPlayChargeFullSound=!0)})),f.isPlayer=!0,A("up",(()=>{var e;if(b=!1,n())return;if(t!==document.pointerLockElement)return t.requestPointerLock();const i=Math.min(100*f.maxCharge,100*f.charge);f.charge=-2,null==(e=f.chargeSound)||e.stop();let o={x:f.x,y:f.y,enemies:a},r=i>250?f.speed>2?"shot":"blast":"mine";if(Object.entries(J[r]).forEach((([t,e])=>{o[t]="function"==typeof e?e({dur:i,sprite:f}):e})),"mine"===r){const t=s.pool.getAliveObjects().filter((t=>t.isMine));if(f.shouldPlayChargeSound=!1,w.mine_damage>0&&(o.explodeRadius*=1.8,o.damage*=1.8),t.length>=c*(w.mine_count+1)||t.some((t=>t.position.distance(f)<d))||f.mineDuration>0)return void H("mineNotPlaced");H("minePlaced"),f.mineDuration=10}"shot"===r&&(1===w.bullet_count&&(s.spawn(vt(bt({},o),{angle:o.angle-.15})),o.angle+=.15),2===w.bullet_count&&(s.spawn(vt(bt({},o),{angle:o.angle-.15})),s.spawn(vt(bt({},o),{angle:o.angle+.15}))));const h=s.spawn(o);"blast"===r&&(H("playerBlast"),setTimeout((()=>{h.triggered=!0,a.pool.getAliveObjects().filter((t=>X(t,h)<h.explodeRadius)).forEach((t=>{t.takeDamage(h.damage)}))}),50)),"shot"===r&&H("playerShoot",.5+f.charge/f.maxCharge)}));const v=t=>{let e=f.x,i=f.y;f.speed=F(t.movementX/o,t.movementY/o),f.speed>.2&&(f.angle=h(f,{x:f.x+t.movementX/o,y:f.y+t.movementY/o})),f.justDamaged||(f.x+=t.movementX/o,f.y+=t.movementY/o),N([f],a.pool.getAliveObjects().filter((t=>!t.spikey)))&&(f.x=e,f.y=i)},z=()=>{t===document.pointerLockElement?document.addEventListener("mousemove",v,!1):document.removeEventListener("mousemove",v,!1)};return document.addEventListener("pointerlockchange",z,!1),f.money=0,f.getMoney=t=>{f.money+=t},{sprite:f,upgrades:w,buyUpgrade(t){"repair"!==t.key?(w[t.key]+=1,f.maxCharge=r*(w.charge_max+1),f.maxShield=100*w.shield,f.shield=f.maxShield):f.health=100},update(){var e;f.update(),f.x<l/2&&(f.x=l/2),f.x>t.width-l/2&&(f.x=t.width-l/2),f.y<l/2&&(f.y=l/2),f.y>t.height-l/2&&(f.y=t.height-l/2),f.dx*=.7,f.dy*=.7,f.shield<f.maxShield&&(f.shield+=m),b&&(f.charge<f.maxCharge?(f.charge+=u*(w.charge_speed+1),f.shouldPlayChargeSound&&(f.shouldPlayChargeSound=!1,null==(e=f.chargeSound)||e.stop(),f.chargeSound=H("playerCharge"))):(f.shouldPlayChargeFullSound&&(f.shouldPlayChargeFullSound=!1,H("playerChargeFull")),f.charge=f.maxCharge)),f.mineDuration>0&&(f.mineDuration-=p*(w.mine_speed+1))},shutdown(){document.removeEventListener("pointerlockchange",z,!1)}}})({canvas:t,x:d,y:u,bullets:s,getStoreActive:()=>m.getActive(),enemies:g}),m=Ct({canvas:t,onNext:r,onPurchase:t=>y.buyUpgrade(t),getPlayer:()=>y});const f=()=>{p&&clearInterval(p),p=setInterval((()=>{g.getRemaining()>0||y.sprite.health<=0||o||(o=!0,clearInterval(p),q((()=>{if(!V[a])return e(y.sprite.money);H("playerWin"),m.setActive(!0),s.pool.clear()}),1e3))}),1e3)},w=(t,e)=>{if(t.isAlive()){if(e.explodes||e.spikey){const i=Y(h(t,e)+Math.PI,-Math.PI,Math.PI),s=l({x:t.dx,y:t.dy},i,20);t.dx=s.x,t.dy=s.y,e.explodes&&e.die(),H("playerHit"),t.takeDamage(e.damage)}f(),t.isAlive()||(H("playerDie"),i())}},b=(t,e)=>{t.die(),H("pickup"),e.getMoney(t.value)},v=(t,e)=>{t.die(),H("playerHit"),e.takeDamage(t.damage),e.isAlive()||(H("playerDie"),i())},z=(t,e)=>{t.triggered||t.isEnemyBullet||t.isMine&&t.position.distance(y.sprite.position)<100||(t.isMine&&(t.triggered=!0),setTimeout((()=>{t.explodeRadius?t.isMine&&(t.die(),H("mineExplode"),n.spawn({x:t.x,y:t.y,size:t.explodeRadius,opacity:.9,ttl:40}),g.pool.getAliveObjects().filter((e=>X(e,t)<t.explodeRadius)).forEach((e=>{"defender"===e.type?H("shieldHit"):setTimeout((()=>e.takeDamage(t.damage)),c(10,200))}))):"absorber"!==e.type?(t.takeDamage(e.health),e.takeDamage(t.damage,!0)):(e.addCharge(t.health),t.die()),f()}),t.triggerDuration))};return r(),{nextLevel:r,shutdown(){g.pool.clear(),s.pool.clear(),y.shutdown()},update(){y.update(),g.pool.update(),s.pool.update(),x.pool.update(),n.pool.update(),m.update(),$(s.pool.getAliveObjects(),g.pool.getAliveObjects(),z),$(s.pool.getAliveObjects().filter((t=>t.isEnemyBullet)),[y.sprite],v),$(x.pool.getAliveObjects(),[y.sprite],b),$([y.sprite],g.pool.getAliveObjects(),w)},render(){s.pool.render(),x.pool.render(),n.pool.render(),y.sprite.render(),g.pool.render(),m.render()}}},jt=({canvas:t,heading:e,description:i,texts:s,button1:n,button2:a})=>{const o=t.width,r=t.height;let h,l=0,c=w({text:e,textAlign:"center",font:"80px sans-serif",color:"#eee",x:o/2,y:r/2-200}),d=w({text:i||s[0],font:"18px sans-serif",textAlign:"center",lineHeight:1.5,color:"#999",x:o/2,y:r/2-80}),u=w({x:o/2,y:r/2+200,text:s?"Next":"Start",color:"#aaa",font:"40px sans-serif",anchor:{x:.5,y:.5},onDown:()=>{s&&l<s.length?(d.text=s[l++],l===s.length&&(u.text="Start")):n()}});return j(u),a&&(h=w({x:o/2,y:r/2+150,text:"Help",color:"#aaa",font:"40px sans-serif",anchor:{x:.5,y:.5},onDown:a}),j(h)),{shutdown(){},update(){},render(){c.render(),d.render(),u.render(),null==h||h.render()}}};zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),i=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,i=220,s=0,n=0,a=.1,o=0,r=1,h=0,l=0,c=0,d=0,u=0,p=0,x=0,g=0,y=0,m=1,f=0,w=0)=>{let b,v,z=2*Math.PI,_=h*=500*z/zzfxR**2,M=(0<x?1:-1)*z/4,P=i*=(1+2*e*Math.random()-e)*z/zzfxR,S=[],k=0,D=0,E=0,j=1,R=0,A=0,O=0;for(s=99+zzfxR*s,f*=zzfxR,n*=zzfxR,a*=zzfxR,y*=zzfxR,l*=500*z/zzfxR**3,x*=z/zzfxR,c*=z/zzfxR,d*=zzfxR,u=zzfxR*u|0,v=s+f+n+a+y|0;E<v;S[E++]=O)++A%(100*g|0)||(O=o?1<o?2<o?3<o?Math.sin((k%z)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/z%2+2)%2:1-4*Math.abs(Math.round(k/z)-k/z):Math.sin(k),O=(u?1-w+w*Math.sin(2*Math.PI*E/u):1)*(0<O?1:-1)*Math.abs(O)**r*t*zzfxV*(E<s?E/s:E<s+f?1-(E-s)/f*(1-m):E<s+f+n?m:E<v-y?(v-E-y)/a*m:0),O=y?O/2+(y>E?0:(E<v-y?1:(v-E)/y)*S[E-y|0]/2):O),b=(i+=h+=l)*Math.sin(D*x-M),k+=b-b*p*(1-1e9*(Math.sin(E)+1)%2),D+=b-b*p*(1-1e9*(Math.sin(E)**2+1)%2),j&&++j>d&&(i+=c,P+=c,j=0),!u||++R%u||(i=P,h=_,j=j||1);return S},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(t,e,i,s=125)=>{let n,a,o,r,h,l,c,d,u,p,x,g,y,m,f=0,w=[],b=[],v=[],z=0,_=0,M=1,P={},S=zzfxR/s*60>>2;for(;M;z++)w=[M=d=g=0],i.map(((s,k)=>{for(c=e[s][z]||[0,0,0],M|=!!e[s][z],m=g+(e[s][0].length-2-!d)*S,y=k==i.length-1,a=2,r=g;a<c.length+y;d=++a){for(h=c[a],u=a==c.length+y-1&&y||p!=(c[0]||0)|h|0,o=0;o<S&&d;o++>S-99&&u?x+=(x<1)/99:0)l=(1-x)*w[f++]/2||0,b[r]=(b[r]||0)-l*_+l,v[r]=(v[r++]||0)+l*_+l;h&&(x=h%1,_=c[1]||0,(h|=0)&&(w=P[[p=c[f=0]||0,h]]=P[[p,h]]||(n=[...t[p]],n[2]*=2**((h-12)/12),h>0?zzfxG(...n):[])))}g=m}));return[b,v]};const{canvas:At}=function(t,{contextless:s=!1}={}){return e=document.getElementById(t)||t||document.querySelector("canvas"),s&&(e=e||new Proxy({},a)),i=e.getContext("2d")||new Proxy({},a),i.imageSmoothingEnabled=!1,n("init"),{canvas:e,context:i}}();let Dt;!function({radius:t=5,canvas:e=o()}={}){let i=b.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},b.set(e,i)}var n,a;e.addEventListener("mousedown",k),e.addEventListener("touchstart",k),e.addEventListener("mouseup",S),e.addEventListener("touchend",S),e.addEventListener("touchcancel",S),e.addEventListener("blur",C),e.addEventListener("mousemove",E),e.addEventListener("touchmove",E),i._t||(i._t=!0,a=()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0},s[n="tick"]=s[n]||[],s[n].push(a))}();let Lt=zzfxP(...zzfxM(...[[[.2,0,386,,,.25,2],[2,0,800,,,.075,2,2,,,1e3,-.01,.02,4.8,-.3,,.065],[2,0,800,,,.075,2,2,,,1e3,-.01,.02,4.8,-.3,,.065],[2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.3,0,386,,,.25,2]],[[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[,-1,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[,1,,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,23.94,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,25.94,23.94,20.94,23.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94,23.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94,27.94,23.94,20.94],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,18,,18,,,,18,16,18,,18,,,,18,30,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,11,13,,13,,,,13,25,13,,13,,,,13,16],[,-1,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23],[5,1,25,,,,,,,,,,,,,,,,23,,,,,,,,,,,,,,,,20,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,18,,18,,,,18,16,18,,18,,,,18,30,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,11,13,,13,,,,13,25,13,,13,,,,13,16],[,-1,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23],[5,1,25,,,,,,,,,,,,,,25,27,32,,,,,,,,,,28,,,,25,27,,,,,,,,,,,,,,,27,23,20,,,,,,,,,,,,,,20,23],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,18,,18,,,,18,16,18,,18,,,,18,30,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,11,13,,13,,,,13,25,13,,13,,,,13,16],[,-1,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23],[5,1,25.5,,,28.5,,,25.5,,25.5,,,28.5,,,25.5,,32,,,,,,,,,,28,,,,27,,,,,,,,,,,,,,,,23.5,25.5,27,,,30,,,27,,,,,,,,,,],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,18,,18,,,,18,16,18,,18,,,,18,30,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,11,13,,13,,,,13,25,13,,13,,,,13,16],[,-1,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23,27,23,20,27,23,20,27,23,20,27,23,20,27,23,20,23],[5,1,25.5,,,28.5,,,25.5,,25.5,,,28.5,,,25.5,,32,,,,,,,,,,27,,,,25,,27,,,30,,,20,,,,,,,,.5,,22,,,18,,,20,,,,,,,,,,],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,14,,14,,,,14,13,14,,14,,,,14,15,16,,16,,,,16,15,16,,16,,,,16,15,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,16],[,-1,21,18,16,21,18,16,21,18,16,21,18,16,21,18,16,18,27,23,18,27,23,18,27,23,18,27,23,18,27,23,18,23,20,16,13,20,16,13,20,16,13,20,16,13,20,16,13,16,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23],[5,1,25,,,,,,,,,,,,28,,,,27,,,,,,,,,,25,,,23,,,25,,,,,,,,,,20,,,18,,,20,,,,,,,,,,,,,,,,],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]],[[1,-1,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,25,,25,25.75,,,25,25,25.5,,25,,,,,,],[4,1,14,,14,,,,14,13,14,,14,,,,14,15,16,,16,,,,16,15,16,,16,,,,16,15,18,,18,,,,18,16,18,,18,,,,18,16,13,,13,,,,13,11,13,,13,,,,13,16],[,-1,21,18,16,21,18,16,21,18,16,21,18,16,21,18,16,18,27,23,18,27,23,18,27,23,18,27,23,18,27,23,18,23,20,16,13,20,16,13,20,16,13,20,16,13,20,16,13,16,25,23,20,25,23,20,25,23,20,25,23,20,25,23,20,23],[5,1,25,,,,,,,,,,,,28,,,,27,,,,,,,,28,,,30,,,32,,,,,,,,,,,,,,,,,,32,,,30,,,25,,27,,,,,,,,],[3,-1,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,36,,,,,,36,,,,,,,,36,,36,,,,,],[2,-1,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25,25.75,25,25,,,,,25,25.75,,,,,,,25.75,25,25,25]]],[0,1,2,3,5,4,5,6],,]));Lt.loop=!0,document.getElementsByTagName("a")[0].addEventListener("click",(t=>{t.target.innerHTML="mute"===t.target.innerHTML?"unmute":"mute",Lt.playbackRate.value=1===Lt.playbackRate.value?0:1,window.zzfxV=0===window.zzfxV?.3:0}));const It=()=>{Dt&&Dt.shutdown(),Dt=jt({canvas:At,heading:"How to play",texts:["Your greatest foe has sent an army to\ndestroy your homeworld for resources.\n\nYou are one of the few survivors,\nProtect it at all costs!","Mouse controls your ship.\n\nClick to drop mines or hold to charge energy.\n\nRelease while moving to fire blasts\nor while still for a burst","You can only place a few mines at once to start\n\nMines won't explode if you are too close\n\nMines must be placed at least a few feet apart","Red enemies home in and explode\n\nGreen enemies shield themselves and nearby foes from mines, but not energy\n\nYellow enemies absorb blasts, but not mines and bursts"],button1:Tt})},Tt=()=>{Dt&&Dt.shutdown(),Dt=Rt({canvas:At,onWin:Ht,onLose:$t})},Ht=t=>{document.exitPointerLock(),Dt&&Dt.shutdown(),Dt=jt({canvas:At,heading:"Congratulations",description:`You cleaned out the Noxious Nebula!\nYour final cash total was: $${t}`,button1:Tt})},$t=()=>{document.exitPointerLock(),Dt&&Dt.shutdown(),Dt=jt({canvas:At,heading:"Game Over",description:"You died and sealed the fate of the Noxious Nebula.",button1:Tt})};Dt&&Dt.shutdown(),Dt=jt({canvas:At,heading:"Noxious Nebula",description:"Created by Daniel Whiffing\nOriginal concept by zauron.net",button1:Tt,button2:It}),function({fps:e=60,clearCanvas:i=!0,update:s=t,render:a,context:o=r(),blur:h=!1}={}){let l,c,d,u,p,x=0,g=1e3/e,y=1/e,m=i?D:t,f=!0;function w(){if(c=requestAnimationFrame(w),f&&(d=performance.now(),u=d-l,l=d,!(u>1e3))){for(n("tick"),x+=u;x>=g;)p.update(y),x-=g;m(o),p.render()}}return h||(window.addEventListener("focus",(()=>{f=!0})),window.addEventListener("blur",(()=>{f=!1}))),p={update:s,render:a,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(w)},stop(){this.isStopped=!0,cancelAnimationFrame(c)}},p}({update:(...t)=>Dt&&Dt.update(...t),render:(...t)=>Dt&&Dt.render(...t)}).start()</script>