<!doctype html><meta content="text/html; charset=utf-8" http-equiv=Content-type><title>js13k-2018</title><style>body,html{margin:0;padding:0;background-color:#111;height:100%;width:100%}body{display:grid}canvas{border:2px solid #000;place-self:center}canvas,img{image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:optimize-contrast;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor}</style><body><script type=text/javascript>!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(n,o,function(e){return t[e]}.bind(null,o));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAABsCAMAAAAIR4HNAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAqUExURUxpcT4wKVZBN7+YfIRpVurFq1V5bz1RS5Wtq8zf4f///0acvTp1jHbG5bd2XPoAAAABdFJOUwBA5thmAAAEVklEQVRYw8WYi7akKAxFw0tQ8f9/d3ICSFBvD3TPmubeVcXOIdTD8gQgsqrREnlvreFWIrNE1kvfeO8QmCay3OGuCyFAnCZOdBwLAQ/M00TGhePYQ9iPg2eaJyTuaQthS3twZp6IXEhbDCFuKbgVIo9PK835FQJLwK1SCXSYpuOIERcoxuNYIcaUNm4pFXEbKH3RduxM+55K23a+QvuOYaAkNGoVoHGijMKfDE1RXgHZR9XSrUl/2yJrxNNskod5uElieXtJtEqilX6M3CeetA6NMjLFWNjhh/LQah7/CgLxVZGh/ICrJITR/P25D02AyXGij7Xhl9GJv/AfNb6cxJfzuq7z5AdcXk8nGojemhC3+nNgyvmUodw4rmjUCt2J55Uz5SZm1qhPM2icSJyZWyJ6uc3DdzpC15d2oQPfqGKGmIsIR8JQ7z80j2nY5XwdWk1TUPIo2/I8aPDFXJ5bnpE3YO+7h8Q/n5o4Kg1jqM7Xo5L31EqwJ/5JCehtllAC8EHkX2x+ksjoKe08caKx97+ZJ/nCTJ2xlLA5IgnUv9LmiFTmGpE3d/MrBHf+PWoBZfNz9J+VgNvmj38pD2z6YwkoLq+papxY6gMIJaC79fFLOnZF9LD51Chq068lYI+dHiUgJd/qQy0IXatOXj5lSazOzsgWVQpA1JWkUHHyNunD5vlb/sn0sWLQIxlzocyXFwbX6Vda9U6083ZZIU8vzY8j2Z8zPHew+Xzat2aR2MuDv4rNX765Hrw727dmkVcGiCG3+iCGXEqAydm8tRJtJYAnwNviB8zk611arHfUatS0TNNs3pTSoe160LrJl+JBzeaV96tRShvKw98oAffuAAY2TXjDzpnm1PMk71xYQgtEvLQPQAktEIWNtwTOGqzzzQJRiAl7FwdcIarr+lAW2/NEZU8AWCNmaRUWqCyZfo+ork+XibhQHLPEntkR9j7S9oO2HUMm7F0lwvp/0Lay/fgURfkxMUqmEls/uOL89KHxBUE5OHqAa55rkktSMehDQ2LZS/j7Ze6u81dxeXprbOwxnvHiUFsSeH+PlB2COO9L81Y2Ac3J+V6+rntLQDWvrXq1xneyJKoV8S1amLcMMS8N/oracSrx3oTUcwztwH2DUncOvqve3q9upKscWGkl/sgzo3cPeWNEj3j4Pn0Y/rv97yXADNI80b1Mt20BPEfUWOrJAqGii6fjlCcskFSrYCx75r6FBUImPJ2dNsWwQnLSEuoRzwrBY52r7r5ELeDcMv2NEoAF/gxh46A12nV92AbSWpLzoEMnarfeRu9WJGdDWvtIlOX5U3OvxKRRdhz9G1caB0XribD9ngjy7kPzTjSViLPBGzLo+tYu0ElqrL/adWUX917ZvNbY1bkgnP1QBPWgWT5W7Od9nvPQLpQHZbRqYLm9sXq3T42lE1uLrwrQMm234VOXDt+OmLq3+sGolX0rzdRjnWGxb/0PNq+1t6mv14B/AFegTYq+zEYiAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAUCAMAAABPqWaPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAASUExURUxpcQ0+fUyEyQtMnsl2EfeUHR+CbzMAAAABdFJOUwBA5thmAAAAbElEQVQoz6XNUQ7AIAgD0DLa+195AtGwbC5Z1h8UTR9gzwGOXeC7YN/26riLXuVxZF3ujtl/R0prOvLpxK8xxvKbg0pzfDmKdGcc0yGnE7M7vawcLGNRaA7E3IpHOAon2o1WD+TFwWrLZ8vdCaRsA4jTzJ1QAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAMAAAAGyf7hAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAASUExURUxpcQ0+fUyEyQtMnsl2EfeUHR+CbzMAAAABdFJOUwBA5thmAAAAdUlEQVQoz3WRQQKAIAgEF1n//+WEICXqMJcRcRFgKBoyVBwNpsqW06DAeKRDB+XqTfTkBsye61aCIeiSKWdEcYjy0JIAiuRdZfbMGBIlfJfWU98yg/OUU5wd6ZSQI1KrpP6P+Yxb/5MGmoS+15EHdUcx7tfeL6PIA4gyzWx9AAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJUExURXJycomJiaGhoRPbEr8AAABZSURBVDjL3ZLRCgAQEASH//9oSVxonVKKe1umu21bYj9h1MTQzaR/ANgCEADk//wAYgPUE4gTLmAmOcihOLEZNY/3AQ1g2YkNuAA1fOkBB2gVWXi4mKTXhwR+aQPi+Tn8/gAAAABJRU5ErkJggg=="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAMAAAC+LeqSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAkUExURTdJUEhganyltwxEi0HHbUZ7fkGjd0dKenA+iUyEya47mtJBSMHEd0QAAAB2SURBVCjPzY/RDoAgCEVBJUz//3+7qRQ2t3rsPDA5Q/QSGUwOBiiBKLQD85sEt1zBC6jfC4Pe9Z+gxD1Gsu6a3OPXyWnn6vWBbCltMmc/XbMuppgUn/05aTuB/D+75lqzztk1l1oLrIupJtVnhwT3pO0E+t/sBxbuBMBY7MvJAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAMAAAAm/38fAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAeUExURTdJUEhgakWOg3ylt0lJfl5IhkHHbUFyda47mtJBQXMhvRwAAABrSURBVCjPrZCLCoAgDEVnzs39/w93pxXlIyE6iBd28LERTQmFPufiQoEng/tVW6HWizmEVqHMCbjxKhaKIthQN4OBiETRhYgbTtksLwR4CJD4/fHxd5cNfpjVcOo9tQ000iaF82CTv56YsAN88QPQpMK+nQAAAABJRU5ErkJggg=="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAQElEQVQYlWNgQAJC/Dz/GfABmAIMhUL8PP+F+Hn+u5vr/3c31/+P1SSYJLIiIX6e/xi6YRir/Ri6iXIgLp/AAADihSbRbPpTbgAAAABJRU5ErkJggg=="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANUlEQVQYlWNgQANC/Dz/0cVQJPAqcDfX/+9urv9fiJ/nP1whjAOThGEME9AV4DWFMoeiiwEA4oUm0XYCLf0AAAAASUVORK5CYII="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAARklEQVQYlWNgQAPGxkb/0cUYGBgYGIT4ef4TVGBsbPTf3Vz/vxA/z3+YBgZjYyO4BAxjNQWbIrhCmJEwCbjxuHxAUAEyAABxsSnVi80rJgAAAABJRU5ErkJggg=="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAM0lEQVQokWNggAJjY6P/+DADMoAJINPYxHAqxmcQTtNwitHHhkHoJJJsIDnikE0jJmkAAAXNhY3/wgl4AAAAAElFTkSuQmCC"},function(t,e,i){t.exports=function(){var t,e,i,n,o,r=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},s=function(t,e,i){var n,o,r,s,c,l,u,p=h[t.i[0]],d=t.i[1],A=t.i[3],f=h[t.i[4]],g=t.i[5],w=t.i[8],y=t.i[9],m=t.i[10]*t.i[10]*4,x=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,k=1/v,S=t.i[13],B=i*Math.pow(2,2-t.i[14]),b=new Int32Array(m+x+v),C=0,E=0;for(n=0,o=0;n<m+x+v;n++,o++)o>=0&&(o-=B,l=a(e+(15&(S=S>>8|(255&S)<<4))+t.i[2]-128),u=a(e+(15&S)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,n<m?r=n/m:n>=m+x&&(r-=(n-m-x)*k),s=l,A&&(s*=r*r),c=p(C+=s)*d,s=u,w&&(s*=r*r),c+=f(E+=s)*g,y&&(c+=(2*Math.random()-1)*y),b[n]=80*c*r|0;return b},h=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(r){t=r,e=r.endPattern,i=0,n=r.rowLen*r.patternLen*(e+1)*2,o=new Int32Array(n)},this.generate=function(){var a,c,l,u,p,d,A,f,g,w,y,m,x,v,k=new Int32Array(n),S=t.songData[i],B=t.rowLen,b=t.patternLen,C=0,E=0,M=!1,R=[];for(l=0;l<=e;++l)for(A=S.p[l],u=0;u<b;++u){var T=A?S.c[A-1].f[u]:0;T&&(S.i[T-1]=S.c[A-1].f[u+b]||0,T<16&&(R=[]));var U=h[S.i[15]],P=S.i[16]/512,I=Math.pow(2,S.i[17]-9)/B,O=S.i[18],L=S.i[19],G=43.23529*S.i[20]*3.141592/44100,H=1-S.i[21]/255,W=1e-5*S.i[22],Q=S.i[23]/32,D=S.i[24]/512,J=6.283184*Math.pow(2,S.i[25]-9)/B,V=S.i[26]/255,z=S.i[27]*B&-2;for(y=(l*b+u)*B,p=0;p<4;++p)if(d=A?S.c[A-1].n[u+p*b]:0){R[d]||(R[d]=s(S,d,B));var N=R[d];for(c=0,a=2*y;c<N.length;c++,a+=2)k[a]+=N[c]}for(c=0;c<B;c++)(w=k[f=2*(y+c)])||M?(m=G,O&&(m*=U(I*f)*P+.5),E+=(m=1.5*Math.sin(m))*(x=H*(w-E)-(C+=m*E)),w=3==L?E:1==L?x:C,W&&(w=(w*=W)<1?w>-1?r(.25*w):-1:1,w/=W),M=(w*=Q)*w>1e-5,v=w*(1-(g=Math.sin(J*f)*D+.5)),w*=g):v=0,f>=z&&(v+=k[f-z+1]*V,w+=k[f-z]*V),k[f]=0|v,k[f+1]=0|w,o[f]+=0|v,o[f+1]+=0|w}return++i/t.numChannels},this.createWave=function(){var t=44+2*n-8,e=t-36,i=new Uint8Array(44+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,a=44;r<n;++r){var s=o[r];s=s<-32767?-32767:s>32767?32767:s,i[a++]=255&s,i[a++]=s>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),n=new Array(e),r=0;r<2*e;r+=1){var a=i+r;n[r]=t>0&&a<o.length?o[a]/32768:0}return n}}},function(t,e,i){function n(t,e){return{assignedKeys:e,pressed:!1,lastChange:0,actionName:t}}function o(t){return t.key}function r(t){switch(t.button){case 0:return"LMB";case 2:return"RMB";default:return"MB"}}function a(t,e){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var n=i.getContext("2d");return n.imageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.drawImage(t,e.x,e.y,e.width,e.height,0,0,i.width,i.height),c(),i}function s(t,e){var i=new Image;return i.onload=function(){return c(e)},i.src=t,i}function h(t,e,i){return{x:i.width*t,y:i.height*e,width:i.width,height:i.height}}function c(t){m++,t&&t(),m===y&&window.dispatchEvent(x)}function l(t,e,i,n,o){t.font="bold "+n+"px monospace";var r=e.reduce(function(t,e){return{key:t.key.length>e.key.length?t.key:e.key,value:t.value.length>e.value.length?t.value:e.value}},{key:"",value:""}),a=t.measureText(r.key).width,s=t.measureText(r.value).width,h=t.measureText(":").width,c=h,l=i,p=new it(i.x+a+c,l.y),d=new it(p.x+c+h+s,l.y);e.forEach(function(e,i){t.textAlign="left",u(t,e.key,l.x,l.y+o*i),u(t,":",p.x,p.y+o*i),t.textAlign="right",u(t,e.value,d.x,d.y+o*i)})}function u(t,e,i,n){t.fillText(e,i,n)}function p(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.height+t.y>e.y}function d(t){return t.x/ye.width*2-1}function A(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}i.r(e);var f,g=function(){function t(t){this.bindings={moveUp:n("moveUp",["w","W","z","Z","ArrowUp"]),moveDown:n("moveDown",["s","S","ArrowDown"]),moveLeft:n("moveLeft",["a","A","q","Q","ArrowLeft"]),moveRight:n("moveRight",["d","D","ArrowRight"]),jump:n("jump",[" ","RMB"]),attack:n("attack",["Shift","LMB"])},this.canvas=t,this.initKeyboard(),this.initMouse()}return t.prototype.update=function(){this.resetMouseMovement()},t.prototype.updateInput=function(t,e){for(var i in this.bindings)this.bindings.hasOwnProperty(i)&&this.bindings[i].assignedKeys.includes(t)&&(this.bindings[i].pressed=e,this.bindings[i].lastChange=Date.now())},t.prototype.initKeyboard=function(){var t=this;window.addEventListener("keydown",function(e){t.canvas.requestPointerLock();var i=o(e);e.repeat||t.updateInput(i,!0)}),window.addEventListener("keyup",function(e){var i=o(e);t.updateInput(i,!1)})},t.prototype.initMouse=function(){var t=this;this.canvas.oncontextmenu=function(){return!1},this.canvas.addEventListener("mousedown",function(e){t.canvas.requestPointerLock();var i=r(e);t.updateInput(i,!0)}),this.canvas.addEventListener("mouseup",function(e){var i=r(e);t.updateInput(i,!1)})},t.prototype.resetMouseMovement=function(){this.updateInput("MML",0),this.updateInput("MMR",0)},t}(),w=function(){function t(){}return t.provideGameInput=function(e){t.gameInput=e},t.getGameInput=function(){return t.gameInput},t}(),y=23,m=0,x=new Event("imagesReady"),v=i(0),k={width:14,height:27},S=["down","up","left","right"],B={up:[],down:[],left:[],right:[]},b=s(v,function(){S.forEach(function(t,e){for(var i=0;i<4;i++)B[t].push(a(b,h(i,e,k)))})}),C=B,E=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e=t.getAABB({roundPositions:!0});this.drawShadow(t,e),this.drawCharacter(t,M,e)},t.prototype.drawCharacter=function(t,e,i){var n=t.forward.direction(),o=t.velocity.length()<.05?0:t.distanceTraveled/25%4|0;this.context.drawImage(C[n][o],t.position.x-e.width/2,t.position.y-e.height+i.height/2-t.positionZ,e.width,e.height)},t.prototype.drawShadow=function(t,e){this.context.beginPath(),this.context.ellipse(0|t.position.x,t.position.y+e.height/2-e.height/2|0,0|e.width,e.width/1.5|0,0,0,2*Math.PI),this.context.fillStyle="rgba(0,0,0,0.2)",this.context.fill()},t}(),M={width:2*k.width,height:2*k.height},R=i(1),T=i(2),U={width:20,height:4},P={width:4,height:20},I={horizontal:[],vertical:[]},O=s(R,function(){for(var t=0;t<5;t++)I.horizontal.push(a(O,h(0,t,U)))}),L=s(T,function(){for(var t=0;t<5;t++)I.vertical.push(a(L,h(t,0,P)))}),G=I,H=i(3),W={width:16,height:16},Q=[],D=s(H,function(){for(var t=0;t<2;t++)for(var e=0;e<2;e++)Q.push(a(D,h(t,e,W)))}),J=Q,V=i(4),z=i(5),N={width:20,height:12},j={width:8,height:23},F={horizontal:[],vertical:[]},K=s(V,function(){for(var t=0;t<3;t++)F.horizontal.push(a(K,h(0,t,N)))}),Y=s(z,function(){for(var t=0;t<3;t++)F.vertical.push(a(Y,h(t,0,j)))});!function(t){t[t.Off=0]="Off",t[t.Green=1]="Green",t[t.Red=2]="Red"}(f||(f={}));var X=F,Z=i(6),_=i(7),q=i(8),$=i(9),tt={alive:[s(Z),s(_)],dead:s(q)},et={character:C,insect:tt,flyswat:s($),computer:X,cable:G,floor:J},it=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.addVector=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t}(),nt=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e=t.flyswat.getAABB();this.renderCrosshair(e),this.renderFlyswat(t,e,t.flyswat.isHitting)},t.prototype.renderCrosshair=function(t){this.context.fillStyle="rgba(0,0,0,0.15)",this.context.fillRect(t.x,t.y,t.width,t.height)},t.prototype.renderFlyswat=function(t,e,i){var n=function(t){var e=new it(0,20);switch(t.forward.direction()){case"up":e.x=10;break;case"right":e.x=0;break;case"down":e.x=-10;break;case"left":e.x=0}return new it(t.position.x+e.x,t.position.y-M.height/2-t.positionZ+e.y)}(t.player),o=i?0:-ot-t.player.positionZ;this.context.lineWidth=2,this.context.strokeStyle="#120f0c",this.context.beginPath(),this.context.moveTo(n.x,n.y),this.context.lineTo(t.flyswat.position.x,t.flyswat.position.y+o),this.context.stroke(),this.context.drawImage(et.flyswat,e.x,e.y+o,e.width,e.height)},t}(),ot=20,rt=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e=this;t.insects.forEach(function(t){var i=t.getAABB();t.isAlive?(e.context.drawImage(et.insect.alive[t.animationFrame],i.x,i.y,i.width,i.height),t.wantsToBite&&(e.context.fillStyle="rgba(255,0,0,0.9)",e.context.beginPath(),e.context.arc(t.position.x,t.position.y,at,0,2*Math.PI),e.context.fill())):(e.context.globalAlpha=.6,e.context.drawImage(et.insect.dead,i.x,i.y,i.width,i.height),e.context.globalAlpha=1)})},t}(),at=2,st=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e=this;t.cables.forEach(function(i){var n=i.getAABB(),o=4*(1-i.health/i.maxHealth)|0,r=i.angle,a="horizontal"===r?{x:n.x,y:n.y-ht,width:ct.width,height:ct.height+ht}:{x:n.x-ht,y:n.y,width:ct.height+ht,height:ct.width};e.context.drawImage(et.cable[r][o],0|a.x,0|a.y,0|a.width,0|a.height);var s=Math.min((t.tick-i.lastDamageTick)/lt,1);e.context.fillStyle="rgba(255,0,0,"+(1-s)/2+")",e.context.fillRect(0|a.x,0|a.y,0|a.width,0|a.height)})},t}(),ht=1,ct={width:50,height:8},lt=100,ut=function(){function t(t){this.context=t}return t.prototype.render=function(t){this.drawInfoBox(),this.context.font="bold 36px monospace",this.context.textAlign="left",this.context.fillStyle="#fff",this.context.lineWidth=1,this.context.fillText("Score: "+t.score,At,dt),this.context.fillText("Hit streak: x"+t.flyswat.hitStreak,gt,ft),this.context.fillText("High score: "+t.game.highScore,yt,wt)},t.prototype.drawInfoBox=function(){this.context.fillStyle="#8aa",this.context.strokeStyle="#000",this.context.lineWidth=4,this.context.fillRect(0,0,Lt.width,pt),this.context.beginPath(),this.context.moveTo(0,pt),this.context.lineTo(Lt.width,pt),this.context.stroke()},t}(),pt=120,dt=45,At=60,ft=45,gt=400,wt=95,yt=60,mt=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e=this;t.computers.forEach(function(t){var i=t.getAABB({roundPositions:!0}),n="left"===t.facingDirection||"right"===t.facingDirection?"vertical":"horizontal",o=t.world.tick/5%2==0&&Math.random()<.3,r=t.isConnected?o?f.Off:f.Green:f.Red;e.context.drawImage(et.computer[n][r],t.position.x-xt[n].width/2,t.position.y-xt[n].height+i.height/2,xt[n].width,xt[n].height),e.drawStatusLight(t,n,o)})},t.prototype.drawStatusLight=function(t,e,i){var n=t.isConnected?i?"transparent":"rgba(0,255,0,0.2)":"rgba(255, 0,0,0.2)",o=this.context.createRadialGradient(t.position.x,t.position.y+kt[e],1,t.position.x,t.position.y+kt[e],vt);o.addColorStop(0,n),o.addColorStop(1,"transparent"),this.context.fillStyle=o,this.context.fillRect(t.position.x-vt,t.position.y-vt+kt[e],2*vt,2*vt)},t}(),xt={horizontal:{width:40,height:24},vertical:{width:16,height:46}},vt=50,kt={horizontal:-5,vertical:-15},St=function(){function t(t){this.context=t}return t.prototype.render=function(t){var e={x:0,y:Lt.height/2-Bt/2+bt,width:Lt.width,height:Bt};this.drawInfoBox(e),this.context.fillStyle="#fff",this.context.lineWidth=1,this.drawHeader(e),this.drawSummary(e,t),this.drawScores(e,t),this.drawStats(e,t)},t.prototype.drawInfoBox=function(t){this.context.fillStyle="rgba(136, 170, 170, 0.5)",this.context.strokeStyle="#000",this.context.lineWidth=4,this.context.fillRect(t.x,t.y,t.width,t.height),this.context.strokeRect(t.x,t.y,t.width,t.height)},t.prototype.drawScores=function(t,e){var i=[{key:"SCORE",value:e.score+""},{key:"HIGH SCORE",value:e.game.highScore+""}];l(this.context,i,new it(t.x+Mt,t.y+Et),32,48)},t.prototype.drawStats=function(t,e){var i=[{key:"BEST HIT STREAK",value:"x"+e.flyswat.highestHitStreak},{key:"FLYSWATTER HITS",value:""+e.flyswat.timesHit},{key:"FLYSWATTER ACCURACY",value:~~(e.flyswat.timesHit/e.flyswat.timesUsed*100)+"%"},{key:"JUMPS",value:""+e.player.timesJumped},{key:"CABLE TREADS",value:""+e.cableTreads},{key:"CABLE BUG BITES",value:""+e.cableBites},{key:"STEPS TRAVELED",value:""+~~(e.player.distanceTraveled/40)}];l(this.context,i,new it(t.x+Tt,t.y+Rt),24,24)},t.prototype.drawSummary=function(t,e){this.context.font="bold 32px monospace",this.context.textAlign="center",this.context.fillText("CONNECTION KEPT INTACT FOR: "+~~(e.ticksSurvivedFor/e.game.ticksPerSecond)+" SECONDS",Lt.width/2,t.y+t.height-Ct/2)},t.prototype.drawHeader=function(t){this.context.font="bold 42px monospace",this.context.textAlign="center",this.context.fillText("GAME OVER",Lt.width/2,t.y+Ct)},t}(),Bt=300,bt=50,Ct=42,Et=2.1*Ct,Mt=30,Rt=Et-5,Tt=400,Ut=function(){function t(t){this.context=t}return t.prototype.render=function(t){t.tick%5==0&&(this.context.fillStyle="#8aa",this.context.fillRect(0,0,Lt.width,Lt.height),this.context.textAlign="center",this.context.font="bold 52px monospace",this.drawTitleText("Ｓｅｒｖｉｃｅ Ｐｒｏｖｉｄｅｒ",Lt.width/2,Lt.height/4),t.tick>Ee&&(this.context.font="bold 42px monospace",this.context.strokeStyle="#000",this.context.fillStyle="rgba(255,255,255,0.8)",this.context.lineWidth=1,this.context.fillText("Press spacebar to start.",Lt.width/2,4*Lt.height/5),this.context.strokeText("Press spacebar to start.",Lt.width/2,4*Lt.height/5)),this.drawControls())},t.prototype.drawTitleText=function(t,e,i){Math.random()<.9&&(this.context.lineWidth=6,this.context.strokeStyle=Math.random()<.9?"rgba(0,255,0,0.5)":"rgba(255,0,0,0.5)",this.context.strokeText(t,e+Math.random()*Pt-Pt/2,i+Math.random()*Pt-Pt/2)),this.context.lineWidth=3,this.context.strokeStyle="#000",this.context.strokeText(t,e,i)},t.prototype.drawControls=function(){this.context.fillStyle="#fff";var t=new it(170,.5*Lt.height);this.context.font="bold 24px monospace",this.context.fillText("Controls:",232,t.y-42),l(this.context,[{key:"Movement",value:"WASD, ZQSD, arrows"},{key:"Jump",value:"spacebar, RMB"},{key:"Use flyswatter",value:"shift, LMB"}],t,24,32)},t}(),Pt=3,It=function(){function t(t){this.context=t}return t.prototype.render=function(t){this.context.drawImage(this.floorSpprite?this.floorSpprite:this.getFloorSprite(t),t.walkingArea.x,t.walkingArea.y)},t.prototype.getFloorSprite=function(t){var e=document.createElement("canvas");e.width=t.walkingArea.width,e.height=t.walkingArea.height;var i=e.getContext("2d");i.imageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1;for(var n=t.walkingArea.width/Ot.width+1,o=t.walkingArea.height/Ot.height+1,r=0;r<n;r++)for(var a=0;a<o;a++)i.drawImage(et.floor[Math.random()<.6?1:4*Math.random()|0],r*Ot.width,a*Ot.height,Ot.width,Ot.height);return this.floorSpprite=e,e},t}(),Ot={width:50,height:50},Lt={width:800,height:600},Gt=function(){function t(t){this.game=t,this.createCanvas(),this.attachCanvas(),this.mainCharacterRenderer=new E(this.context),this.flyswatRenderer=new nt(this.context),this.insectsRenderer=new rt(this.context),this.cablesRenderer=new st(this.context),this.computersRenderer=new mt(this.context),this.scoreRenderer=new ut(this.context),this.gameOverRenderer=new St(this.context),this.splashScreenRenderer=new Ut(this.context),this.floorRenderer=new It(this.context)}return t.prototype.render=function(t){var e,i;t.game.state!==_t.SplashScreen?(this.clearCanvas(),this.setHitShakeEffect(t),this.floorRenderer.render(t),this.renderWalls(t.roomWalls),this.cablesRenderer.render(t),this.computersRenderer.render(t),this.insectsRenderer.render(t),this.scoreRenderer.render(t),e=t.player,"up"===(i=e.forward.direction())||"left"===i?(this.flyswatRenderer.render(t),this.mainCharacterRenderer.render(t.player)):(this.mainCharacterRenderer.render(t.player),this.flyswatRenderer.render(t)),this.game.state===_t.GameOver&&this.gameOverRenderer.render(t)):this.splashScreenRenderer.render(t.game)},t.prototype.renderWalls=function(t){var e=this;this.context.fillStyle="#000",t.forEach(function(t){e.context.fillRect(t.x,t.y,t.width,t.height)})},t.prototype.setHitShakeEffect=function(t){function e(){return(Math.random()*i-i/2)*o}var i=10,n=t.tick-t.flyswat.lastHit,o=1-Math.min(n,10)/10;this.context.translate(e(),e())},t.prototype.clearCanvas=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#466",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=Lt.width,this.canvas.height=Lt.height,this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1},t.prototype.attachCanvas=function(){document.body.appendChild(this.canvas)},t}(),Ht=function(){function t(){this.gameInput=w.getGameInput()}return t.prototype.update=function(t){t.world.game.state===_t.Gameplay&&(this.gameInput.bindings.attack.pressed&&t.attack(),t.isInMidAir()||(this.gameInput.bindings.moveUp.pressed&&t.moveUp(),this.gameInput.bindings.moveDown.pressed&&t.moveDown(),this.gameInput.bindings.moveLeft.pressed&&t.moveLeft(),this.gameInput.bindings.moveRight.pressed&&t.moveRight(),this.gameInput.bindings.jump.pressed&&t.jump()))},t}(),Wt=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.multiply=function(e){return new t(this.x*e,this.y*e)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalized=function(){var e=this.length();return new t(this.x/e,this.y/e)},t.prototype.rotate=function(e){var i=Math.cos(e),n=Math.sin(e);return new t(this.x*i-this.y*n,this.x*n+this.y*i)},t.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0?2*Math.PI+t:t},t.prototype.direction=function(){var t=this.angle()/(2*Math.PI),e=Math.round(4*t)%4;return Qt[e]},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t}(),Qt=["right","down","left","up"],Dt=function(){function t(t){this.world=t.world,this.position=t.position,this.collisionMask=t.collisionMask}return t.prototype.getAABB=function(t){void 0===t&&(t={});var e=t.targetPosition?t.targetPosition:this.position;return t.roundPositions?{x:Math.round(e.x-this.collisionMask.width/2),y:Math.round(e.y-this.collisionMask.height/2),width:this.collisionMask.width,height:this.collisionMask.height}:{x:e.x-this.collisionMask.width/2,y:e.y-this.collisionMask.height/2,width:this.collisionMask.width,height:this.collisionMask.height}},t}(),Jt={songData:[{i:[0,112,116,1,0,107,129,0,1,0,4,13,35,0,0,0,0,0,0,2,14,0,10,109,0,0,35,0],p:[,,,1,1,2,1,2,1,2,1,2],c:[{n:[123,,,,,,,,,,123,,,,,,123,,,,,,,,,,123],f:[]},{n:[123,,,,,,,,,,123,,,,,,123,,,,,,,,,,123,,,,123],f:[]}]},{i:[0,121,128,1,0,124,128,0,1,97,4,6,29,0,0,0,64,7,1,3,76,97,0,120,20,0,0,2],p:[,,,,1,2,1,2,1,2,1,2],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,111,,,,,,,,111,,,,,,,,111,,,,,,,,111],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,111,,,,,,,,111,,,,,,,,111,,,,,,,,111],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,29,4,7,20,0,0,0,224,8,0,1,239,140,141,13,0,6,21,2],p:[,,,,,,,,1,1,1,1,1,1,1,1],c:[{n:[123,,123,,123,,123,,123,,123,,123,,123,,123,,123,,123,,123,123,123,,123,,123,,123],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,53,0,1,51,0,0,0,0,0,0,1,255,101,106,4,39,3,88,3],p:[,,,,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,123,,,,,,,,123,,,,123,,,,123,,,,,,,,,,,,123],f:[,,24,,,,,,,,24,,,,24,,,,24,,,,,,,,,,,,24,,,,7,,,,,,,,5,,,,4,,,,8,,,,,,,,,,,,4]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[3,25,128,0,3,68,128,2,0,0,0,6,40,0,0,0,0,0,1,2,27,117,27,84,127,4,103,4],p:[1,2,3,4,5,5,6,7,5,5,6,7,3,4,3,2],c:[{n:[111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123],f:[21,6,21,,,,,,21,,,,,,,,21,,,,,,,,21,,,,,,,,55,,7,,,,,,9,,,,,,,,10,,,,,,,,12]},{n:[111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123],f:[,6,21,,,,,,21,,,,,,,,21,,,,,,,,21,,,,,,,,,15,14,,,,,,16,,,,,,,,18,,,,,,,,21]},{n:[111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123],f:[,6,21,,,,,,21,,,,,,,,21,,,,,,,,21,,,,,,,,,33,24,,,,,,27,,,,,,,,32,,,,,,,,35]},{n:[111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123],f:[21,6,21,,,,,,,,21,,21,,,,21,,21,,,,,,,,21,,21,,,,2,48,40,,,,,,,,2,,40,,,,2,,40,,,,,,,,3,,40]},{n:[111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123,,111,,123],f:[21,21,6,,,,,,,,21,21,,,,,21,21,,,,,,,,,21,21,,,,,2,53,71,,,,,,,,2,53,,,,,2,53,,,,,,,,,2,53]},{n:[113,,128,,113,,128,,113,,128,,113,,128,,113,,128,,113,,128,,113,,128,,113,,128],f:[21,21,6,,,,,,,,21,21,,,,,21,21,,,,,,,,,21,21,,,,,2,53,71,,,,,,,,2,53,,,,,2,53,,,,,,,,,2,53]},{n:[115,,130,,115,,130,,115,,130,,115,,130,,115,,130,,115,,130,,116,,132,,116,,134],f:[21,21,6,,,,,,,,21,21,,,,,21,21,,,,,,,,,21,21,,,,,2,53,71,,,,,,,,2,53,,,,,2,53,,,,,,,,,2,53]}]}],rowLen:4134,patternLen:32,endPattern:15,numChannels:6},Vt={songData:[{i:[2,0,128,0,2,33,112,0,0,179,0,12,31,0,0,1,255,16,1,2,135,53,3,60,0,6,61,1],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},zt={songData:[{i:[2,0,128,0,3,0,128,0,0,36,0,8,35,0,0,1,202,9,1,3,55,0,255,25,0,6,0,0],p:[1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},Nt={songData:[{i:[0,55,128,0,3,55,128,0,0,17,0,8,21,0,0,0,117,3,1,3,55,0,255,75,0,6,0,0],p:[1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},jt=i(10),Ft=function(){function t(){this.sounds={},this.soundsData=[{name:Kt.GameplayMusic,data:Jt},{name:Kt.Hit,data:Vt},{name:Kt.Bite,data:zt},{name:Kt.Jump,data:Nt}],this.prepareSounds()}return t.prototype.prepareSounds=function(){var t=this;this.soundsData.forEach(function(e){var i=new jt;i.init(e.data);var n=!1;setInterval(function(){if(!n&&(n=1===i.generate())){var o=i.createWave().buffer;Yt.decodeAudioData(o,function(i){t.sounds[e.name]=i})}},0)})},t.prototype.playSound=function(t,e){void 0===e&&(e={});var i=Yt.createBufferSource(),n=Yt.createGain(),o=Yt.createStereoPanner();i.buffer=this.sounds[t],i.connect(o),o.connect(n),n.connect(Xt),i.playbackRate.value=e.playbackRate||1,i.loop=e.loop||!1,n.gain.value=e.volume||.5,o.pan.value=e.pan||0,i.start()},t}(),Kt={GameplayMusic:"GameplayMusic",Hit:"Hit",Bite:"Bite",Jump:"Jump"},Yt=new AudioContext,Xt=Yt.createGain();Xt.connect(Yt.destination);var Zt,_t,qt=(Zt=function(t,e){return(Zt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Zt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),$t=function(t){function e(e){var i=t.call(this,{world:e,position:new it(ye.width/2,ye.height/2),collisionMask:{width:16,height:16}})||this;return i.inputManager=new Ht,i.inputVelocity=new Wt(0,0),i.velocity=new Wt(0,0),i.position=new it(ye.width/2,ye.height/2),i.forward=new Wt(0,1),i.positionZ=0,i.velocityZ=0,i.distanceTraveled=0,i.timesJumped=0,i}return qt(e,t),e.prototype.update=function(){var t=this;this.inputVelocity=this.inputVelocity.multiply(0),this.inputManager.update(this),this.velocity=this.velocity.add(this.inputVelocity),this.isInMidAir()||(this.velocity=this.velocity.multiply(ee)),this.velocityZ-=ie;var e=this.position.addVector(this.velocity),i=new it(e.x,this.position.y),n=new it(this.position.x,e.y);this.world.roomWalls.forEach(function(e){p(t.getAABB({targetPosition:i}),e)&&(t.velocity.x=0),p(t.getAABB({targetPosition:n}),e)&&(t.velocity.y=0)}),0===this.velocity.x&&0===this.velocity.y||(this.forward=this.velocity.normalized()),this.position=this.position.addVector(this.velocity),this.positionZ<0&&(this.positionZ=0,this.velocityZ=0),this.world.game.state===_t.Gameplay&&(this.distanceTraveled+=this.isInMidAir()?this.velocity.length()/2:this.velocity.length()),this.isInMidAir()||this.world.cables.forEach(function(e){p(t.getAABB(),e.getAABB())&&t.fallOverCable(e)}),this.positionZ+=this.velocityZ},e.prototype.moveUp=function(){this.inputVelocity=this.inputVelocity.add(new Wt(0,-te))},e.prototype.moveDown=function(){this.inputVelocity=this.inputVelocity.add(new Wt(0,te))},e.prototype.moveLeft=function(){this.inputVelocity=this.inputVelocity.add(new Wt(-te,0))},e.prototype.moveRight=function(){this.inputVelocity=this.inputVelocity.add(new Wt(te,0))},e.prototype.jump=function(){!this.isInMidAir()&&this.world.tick>10&&0===this.velocityZ&&(this.world.game.soundPlayer.playSound(Kt.Jump,{pan:d(this.position)}),this.timesJumped++,this.velocityZ=ne)},e.prototype.isInMidAir=function(){return this.positionZ>0},e.prototype.attack=function(){this.world.flyswat.hit()},e.prototype.fallOverCable=function(t){t.getSteppedOnByMainCharacter(),this.velocity=this.forward.multiply(1.5),this.velocityZ=ne/2},e}(Dt),te=.4,ee=.9,ie=.1,ne=2,oe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),re=function(t){function e(e){var i=t.call(this,{world:e,position:e.player.position,collisionMask:{width:1.5*e.player.collisionMask.width,height:1.5*e.player.collisionMask.height}})||this;return i.hitCooldown=60,i.lastHit=0,i.isHitting=!1,i.hitStreak=0,i.highestHitStreak=0,i.timesUsed=0,i.timesHit=0,i}return oe(e,t),e.prototype.update=function(){this.position=this.world.player.position.addVector(this.world.player.forward.multiply(3*this.world.player.collisionMask.width)),this.world.tick-this.lastHit>10&&(this.isHitting=!1)},e.prototype.hit=function(){var t=this;if(this.world.tick-this.lastHit>this.hitCooldown){this.timesUsed++,this.world.game.soundPlayer.playSound(Kt.Hit,{pan:d(this.position)});var e=!1;this.isHitting=!0,this.world.insects.forEach(function(i){p(i.getAABB(),t.getAABB())&&(i.kill(),e=!0,t.timesHit++)}),this.lastHit=this.world.tick,e||this.resetHitStreak(),this.hitCooldown=e?30:60}},e.prototype.increaseHitStreak=function(){this.hitStreak+=1,this.highestHitStreak=this.hitStreak>this.highestHitStreak?this.hitStreak:this.highestHitStreak},e.prototype.resetHitStreak=function(){this.hitStreak=0},e.prototype.addKillScore=function(){this.world.score+=ae+se*(this.hitStreak-1)},e}(Dt),ae=10,se=5,he=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ce=function(t){function e(e){var i=this,n={width:12,height:12};return(i=t.call(this,{world:e,position:new it(Math.random()*(e.walkingArea.width-n.width)+(e.walkingArea.x+n.width/2),Math.random()*(e.walkingArea.height-n.height)+(e.walkingArea.y+n.height/2)),collisionMask:n})||this).isAlive=!0,i.velocity=new Wt(0,0),i.forward=new Wt(1,0),i.ticksSinceMoveChange=0,i.wantsToMove=!1,i.ticksToMoveChange=i.getRandomTicksToMoveChange(),i.animationFrame=0,i.isBiting=!1,i.lastBite=0,i.wantsToBite=!1,i.ticksToBiteState=480,i}return he(e,t),e.prototype.update=function(){var t=this;if(this.isAlive){this.ticksToBiteState--,this.ticksToBiteState<0&&(this.wantsToBite=!0),this.ticksSinceMoveChange++,this.ticksSinceMoveChange>this.ticksToMoveChange&&(this.ticksSinceMoveChange=0,this.wantsToMove=!this.wantsToMove,this.ticksToMoveChange=this.getRandomTicksToMoveChange(),this.forward=this.getRandomDirection().normalized()),this.velocity=this.forward.multiply(1);var e=this.position.addVector(this.velocity),i=new it(e.x,this.position.y),n=new it(this.position.x,e.y);this.wantsToMove&&!this.isBiting&&(this.world.roomWalls.forEach(function(e){p(t.getAABB({targetPosition:i}),e)&&(t.velocity.x=0),p(t.getAABB({targetPosition:n}),e)&&(t.velocity.y=0)}),this.position=this.position.addVector(this.velocity),this.world.tick%5==0&&(this.animationFrame=(this.animationFrame+1)%le)),this.wantsToBite&&(this.world.cables.forEach(function(i){!t.isBiting&&p(t.getAABB({targetPosition:e}),i.getAABB())&&t.biteCable(i)}),this.world.tick-this.lastBite>ue&&(this.isBiting=!1))}},e.prototype.kill=function(){this.isAlive&&(this.isAlive=!1,this.velocity=this.velocity.multiply(0),this.world.flyswat.increaseHitStreak(),this.world.flyswat.addKillScore(),this.world.spawnInsect())},e.prototype.biteCable=function(t){t.getBitten(),this.isBiting=!0,this.lastBite=this.world.tick},e.prototype.getRandomDirection=function(){return this.forward.rotate(Math.random()*Math.PI*2)},e.prototype.getRandomTicksToMoveChange=function(){return 120*Math.random()},e}(Dt),le=2,ue=120,pe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),de=function(t){function e(e){var i=t.call(this,{world:e.world,position:e.position,collisionMask:{width:"vertical"===e.angle?Ae:e.length,height:"horizontal"===e.angle?Ae:e.length}})||this;return i.maxHealth=100,i.health=i.maxHealth,i.computers=e.computers,i.angle=e.angle,i.lastDamageTick=-9999,i}return pe(e,t),e.prototype.update=function(){this.health<=0&&this.disconnectComputers()},e.prototype.getBitten=function(){this.health-=10,this.health<0&&(this.health=0),this.lastDamageTick=this.world.tick,this.world.game.state===_t.Gameplay&&this.world.cableBites++,this.world.game.soundPlayer.playSound(Kt.Bite,{pan:d(this.position),volume:1})},e.prototype.getSteppedOnByMainCharacter=function(){this.health-=25,this.health<0&&(this.health=0),this.lastDamageTick=this.world.tick,this.world.game.state===_t.Gameplay&&this.world.cableTreads++,this.world.game.soundPlayer.playSound(Kt.Bite,{pan:d(this.position),volume:1})},e.prototype.disconnectComputers=function(){this.computers.forEach(function(t){t.isConnected=!1}),this.world.game.setState(_t.GameOver)},e}(Dt),Ae=6,fe=function(){function t(t){this.world=t}return t.prototype.createCables=function(t,e){if(t.length<2||2!==e.length)return[];for(var i,n,o=[],r=1;r<t.length;r++){var a=t[r-1],s=t[r],h=(n=s,new it(((i=a).x+n.x)/2,(i.y+n.y)/2)),c=a.x===s.x;o.push(new de({world:this.world,position:this.getWalkingAreaPoint(h),angle:c?"vertical":"horizontal",length:A(a,s),computers:e}))}return o},t.prototype.getWalkingAreaPoint=function(t){return new it(t.x+this.world.walkingArea.x,t.y+this.world.walkingArea.y)},t}(),ge=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),we=function(t){function e(e,i,n){var o=t.call(this,{world:e,position:i,collisionMask:{width:32,height:32}})||this;return o.isConnected=!0,o.facingDirection=n,o}return ge(e,t),e}(Dt),ye=Lt,me=function(){function t(t){this.game=t,this.tick=0,this.ticksSurvivedFor=0,this.player=new $t(this),this.flyswat=new re(this),this.walkingArea=this.getWallkingArea(),this.roomWalls=this.getRoomWalls(),this.insects=[],this.cables=[],this.computers=[],this.score=0,this.cableBites=0,this.cableTreads=0;for(var e=0;e<4;e++)this.spawnInsect();this.spawnCables()}return t.prototype.update=function(){this.tick++,this.insects.forEach(function(t){t.update()}),this.player.update(),this.flyswat.update(),this.cables.forEach(function(t){t.update()}),this.game.state!==_t.GameOver&&(this.ticksSurvivedFor=this.tick)},t.prototype.spawnInsect=function(){this.insects.push(new ce(this))},t.prototype.spawnCables=function(){var t,e,i=new fe(this),n=[new we(this,this.getWalkingAreaPoint(new it(0,200)),"right"),new we(this,this.getWalkingAreaPoint(new it(300,-5)),"down")],o=i.createCables([new it(0,200),new it(50,200),new it(100,200),new it(100,150),new it(150,150),new it(150,100),new it(200,100),new it(250,100),new it(300,100),new it(300,50),new it(300,0)],n),r=[new we(this,this.getWalkingAreaPoint(new it(200,-5)),"down"),new we(this,this.getWalkingAreaPoint(new it(300,395)),"up")],a=i.createCables([new it(200,0),new it(200,50),new it(200,100),new it(200,150),new it(200,200),new it(250,200),new it(250,250),new it(250,300),new it(250,350),new it(300,350),new it(300,400)],r),s=[new we(this,this.getWalkingAreaPoint(new it(200,395)),"up"),new we(this,this.getWalkingAreaPoint(new it(650,150)),"left")],h=i.createCables([new it(200,400),new it(200,350),new it(200,300),new it(250,300),new it(300,300),new it(350,300),new it(400,300),new it(400,250),new it(450,250),new it(450,200),new it(450,150),new it(500,150),new it(550,150),new it(600,150),new it(650,150)],s),c=[new we(this,this.getWalkingAreaPoint(new it(600,395)),"up"),new we(this,this.getWalkingAreaPoint(new it(0,300)),"right")],l=i.createCables([new it(600,400),new it(600,350),new it(550,350),new it(500,350),new it(450,350),new it(400,350),new it(350,350),new it(350,300),new it(350,250),new it(300,250),new it(250,250),new it(200,250),new it(150,250),new it(100,250),new it(100,300),new it(50,300),new it(0,300)],c),u=[new we(this,this.getWalkingAreaPoint(new it(500,-5)),"down"),new we(this,this.getWalkingAreaPoint(new it(650,250)),"left")],p=i.createCables([new it(500,0),new it(500,50),new it(500,100),new it(500,150),new it(500,200),new it(500,250),new it(550,250),new it(600,250),new it(650,250)],u);(t=this.cables).push.apply(t,o.concat(a,h,l,p)),(e=this.computers).push.apply(e,n.concat(r,s,c,u))},t.prototype.getWallkingArea=function(){return{x:ke+xe,y:ve+xe,width:ye.width-ke-Se-2*xe,height:ye.height-ve-Be-2*xe}},t.prototype.getRoomWalls=function(){return[{x:ke,y:ve,width:xe,height:ye.height-ve-Be},{x:ke,y:ve,width:ye.width-ke-Se,height:xe},{x:ye.width-Se-xe,y:ve,width:xe,height:ye.height-ve-Be},{x:ke,y:ye.height-Be-xe,width:ye.width-ke-Se,height:xe}]},t.prototype.getWalkingAreaPoint=function(t){return new it(t.x+this.walkingArea.x,t.y+this.walkingArea.y)},t}(),xe=20,ve=150,ke=55,Se=ke,Be=10,be=function(){function t(){var t=this;this.ticksPerSecond=60,this.tickTime=1e3/this.ticksPerSecond,this.lastTickTime=0,this.currentUpdateLag=0,this.maxUpdateLag=500,this.gameRenderer=new Gt(this),this.gameInput=new g(this.gameRenderer.canvas),w.provideGameInput(this.gameInput),this.tick=0,this.state=_t.SplashScreen,this.lastStateChange=0,this.soundPlayer=new Ft,this.world=new me(this),this.highScore=this.loadHighScore(),this.requestNextFrame(),window.addEventListener("imagesReady",function(){t.playMusic()})}return t.prototype.restartWorld=function(){this.updateHighScore(this.world.score),this.setState(_t.Gameplay),this.world=new me(this)},t.prototype.setState=function(t){this.state!==t&&(this.state=t,this.lastStateChange=this.tick)},t.prototype.updateHighScore=function(t){t>this.highScore&&(this.highScore=t,window.localStorage.setItem(Me,t.toString()))},t.prototype.requestNextFrame=function(){var t=this;window.requestAnimationFrame(function(e){t.gameLoop(e)})},t.prototype.gameLoop=function(t){var e=Math.min(this.maxUpdateLag,t-this.lastTickTime);for(this.currentUpdateLag+=e;this.currentUpdateLag>this.tickTime;)this.currentUpdateLag-=this.tickTime,this.update(this.tickTime/1e3);this.render(),this.lastTickTime=t,this.requestNextFrame()},t.prototype.update=function(t){this.tick++,this.state!==_t.SplashScreen?(this.world.update(),this.gameInput.update(),this.state===_t.GameOver&&this.tick-this.lastStateChange>Ce&&(this.gameInput.bindings.attack.pressed||this.gameInput.bindings.jump.pressed)&&this.restartWorld()):this.tick-this.lastStateChange>Ee&&(this.gameInput.bindings.attack.pressed||this.gameInput.bindings.jump.pressed)&&this.restartWorld()},t.prototype.render=function(){this.gameRenderer.render(this.world)},t.prototype.loadHighScore=function(){var t=window.localStorage.getItem(Me);return t?parseInt(t):0},t.prototype.playMusic=function(){var t=this;addEventListener("keypress",function(){window.setTimeout(function(){t.soundPlayer.playSound(Kt.GameplayMusic,{loop:!0})},1e3)},{once:!0})},t}();!function(t){t[t.SplashScreen=0]="SplashScreen",t[t.Gameplay=1]="Gameplay",t[t.GameOver=2]="GameOver"}(_t||(_t={}));var Ce=90,Ee=90,Me="SERVICE_PROVIDER:highScore";new be}]);</script>