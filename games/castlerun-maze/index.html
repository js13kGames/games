<!doctype html><html lang=en-US><style>body{margin:0;background-color:#000;height:100%;width:100%;overflow:hidden}</style><script>var temp;function playGame(){this.canvas=document.getElementsByTagName("canvas").item(0),this.ctx=canvas.getContext("2d"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.clean=function(){ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(0,0,canvas.width,canvas.height)},clean(),t=new function(){var t=[],i=[];function s(t,i){this.row=i,this.column=t,this.raster=20,this.draw=function(t){ctx.lineWidth=1,ctx.beginPath(),ctx.fillStyle="rgb(220,220,0)",ctx.strokeStyle="rgba(250,250,250,0.9)",ctx.shadowColor="rgba(250,250,250,0.9)",ctx.shadowBlur=5,ctx.arc(canvas.width/this.raster*(this.column+.5),canvas.height/this.raster*(this.row+.5)+t*canvas.height,canvas.height/this.raster/5,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()},this.at_position=function(t,i){return this.row==i&&this.column==t}}function e(t,i){this.row=i,this.column=t,this.raster=20,this.color=Math.floor(120*Math.random()),this.draw=function(t){ctx.fillStyle="rgba("+this.color+","+this.color+","+this.color+", .9)",ctx.strokeStyle="rgba(120,220,120, .9)",ctx.lineWidth=2,ctx.shadowBlur=0,ctx.shadowColor="rgba(250,250,250,0.0)",ctx.beginPath(),ctx.roundRect(canvas.width/this.raster*this.column,canvas.height/this.raster*this.row+t*canvas.height,canvas.width/this.raster,canvas.height/this.raster,10),ctx.fill(),ctx.stroke()},this.at_position=function(t,i){return this.row==i&&this.column==t}}this.offset=0,this.current_level=0,this.score=0,this.raster=20,this.muted=!1,this.player=new function(t){this.x=Math.floor(t/2),this.y=0,this.draw=function(i){cx=canvas.width/t*(this.x+.5),cy=canvas.height/t*(this.y+.5)+i*canvas.height,dx=canvas.width/t*.075,dy=-canvas.height/t*.15,ctx.fillStyle="rgb(250,220,220)",ctx.shadowColor="rgba(250,250,250,0.0)",ctx.strokeStyle="rgba(100,100,100,0.9)",ctx.shadowBlur=0,ctx.lineWidth=0,ctx.beginPath(),ctx.arc(cx,cy,1.5*dx,0,2*Math.PI,!1),ctx.fill(),ctx.fillStyle="rgb(220,220,0)",ctx.shadowBlur=5,ctx.shadowColor="rgb(250,250,250)",ctx.beginPath(),ctx.moveTo(cx,cy),ctx.lineTo(cx+2*dx,cy),ctx.lineTo(cx+2*dx,cy+2*dy),ctx.lineTo(cx+2*dx,cy+2*dy),ctx.lineTo(cx+1*dx,cy+1*dy),ctx.lineTo(cx+0*dx,cy+2*dy),ctx.lineTo(cx-1*dx,cy+1*dy),ctx.lineTo(cx-2*dx,cy+2*dy),ctx.lineTo(cx-2*dx,cy+0*dy),ctx.lineTo(cx-0*dx,cy+0*dy),ctx.fill()}}(this.raster),this.show_stats=function(){ctx.shadowBlur=0,ctx.lineWidth=0,ctx.shadowColor="rgb(250,250,250)",ctx.fillStyle="rgba(0,0,0,0.5)",ctx.fillRect(canvas.width-canvas.width/this.raster*4,canvas.height-canvas.height/this.raster*1.5,canvas.width,2*this.raster),ctx.font=Math.floor(canvas.height/this.raster/2)+"px Arial",ctx.fillStyle="rgb(255,255,255)",ctx.shadowBlur=5,ctx.shadowColor="rgb(250,250,250)",ctx.fillText("Score: "+this.score+" Level: "+this.current_level,canvas.width-canvas.width/this.raster*3,canvas.height-canvas.height/this.raster*1)},this.pathway_point=new function(t){this.x=Math.floor(t/2),this.y=0,this.set_point=function(t,i){this.x=t,this.y=i}}(this.raster),this.add_path=function(t){x=this.pathway_point.x,y=this.pathway_point.y;for(var i=0;i<this.raster;i++)this.remove_block(x,y),y-=1,dx=Math.floor(3*Math.random())-1,(x+dx<0||x+dx>this.raster)&&(dx=0),x+=dx,this.remove_block(x,y-1);this.remove_block(x,y),this.pathway_point.set_point(x,y)},this.find_block=function(i,s){var e=null;return t.forEach((t=>{t.at_position(i,s)&&(e=t)})),e},this.remove_beneath=function(s){t=t.filter((t=>t.row<-(s-2)*this.raster)),i=i.filter((t=>t.row<-(s-2)*this.raster))},this.remove_block=function(i,s){var e;null!=(e=this.find_block(i,s))&&t.splice(t.indexOf(e),1)},this.init_blocks=function(){t=[],this.add_blocks(0)},this.add_coins=function(t){for(var e=0;e<20;e++)x=Math.floor(Math.random()*this.raster),y=Math.floor(Math.random()*this.raster)-t*this.raster,null==this.find_block(x,y)&&i.push(new s(x,y))},this.add_blocks=function(i){for(var s=0;s<200;s++)x=Math.floor(Math.random()*this.raster),y=Math.floor(Math.random()*this.raster)-i*this.raster,null==this.find_block(x,y)&&t.push(new e(x,y));this.add_path(i)},this.draw_blocks=function(){t.forEach((t=>t.draw(this.offset)))},this.draw_coins=function(){i.forEach((t=>t.draw(this.offset)))},this.collect_coin=function(t,s){coin=i.find((i=>i.row==s&&i.column==t)),null!=coin&&(i=i.filter((i=>!(i.row==s&&i.column==t))),this.score++,this.play_success())},this.mute_dialog=function(){confirm("Enable sound effects?")?this.muted=!1:this.muted=!0},this.play_success=function(){if(!this.muted){let t=new window.AudioContext,i=t.createOscillator();i.type="square",i.frequency.value=1555,i.connect(t.destination),i.start(),i.stop(t.currentTime+.2)}},this.obstacle=function(i,s){var e=0;return t.forEach((t=>{t.at_position(i,s)&&e++})),(i<0||i>=this.raster)&&e++,e>0},this.draw_field=function(){this.draw_blocks(),this.draw_coins(),this.player.draw(this.offset),this.show_stats()},this.refresh=function(){clean(),this.draw_field()},this.update_offset=function(){this.current_level<20?this.offset=this.offset+.001+this.current_level/2e3:this.offset=this.offset+.001+.01,this.offset>this.current_level&&(this.current_level=this.current_level+1,this.add_blocks(this.current_level),this.add_coins(this.current_level),this.remove_beneath(this.current_level)),this.player.y/this.raster+this.offset>1&&this.finish_game()},this.finish_game=function(){alert("Game finished! Score: "+this.score),clearInterval(this.refresh_interval),clearInterval(this.update_interval)},this.start_moving=function(){this.refresh_interval=setInterval(this.refresh.bind(this),50),this.update_interval=setInterval(this.update_offset.bind(this),50)},this.move_player=function(t){var i=0,s=0;"37"==t.keyCode&&(i=-1),"38"==t.keyCode&&(s=-1),"39"==t.keyCode&&(i=1),"40"==t.keyCode&&(s=1),this.obstacle(this.player.x+i,this.player.y+s)||(this.player.x+=i,this.player.y+=s,this.collect_coin(this.player.x,this.player.y))},document.onkeydown=this.move_player.bind(this)},t.mute_dialog(),t.draw_blocks(),t.draw_coins(),t.start_moving()}window.onload=playGame</script><title>Castle Run</title><canvas width=800 height=600></canvas>