<!doctypehtml><meta content="width=device-width"name=viewport><title>How it started - js13kGames 2024</title><style>*{margin:0;padding:0}body{overflow:hidden}</style><canvas id=root></canvas><script>var s,e,t;(t=s=s||{}).PROGRESS="progress",t.LORE="lore";class i{static NAMASPACE="howItStarted_";static SET_DATA(t,s){window.localStorage.setItem(i.NAMASPACE+t,s)}static GET_DATA(t){return window.localStorage.getItem(i.NAMASPACE+t)}}class h{canvas;ctx;finishCallback;constructor(t,s,e){this.canvas=t,this.ctx=s,this.finishCallback=e}init(){this.setEvents()}setEvents(){}deleteEvents(){}staticUpdate(){this.setMask(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.setBG()}setMask(){}setBG(){this.ctx.fillStyle="#FFFFFA",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}update(t){this.setBG()}}class a extends h{size=36;title=["Thanks for playing the game!","Hope you had fun :).","Good luck!"];staticUpdate(){super.staticUpdate()}init(){setTimeout(()=>{this.finishCallback()},1e4)}update(t){super.update(t),this.ctx.font=`bold ${this.size}px Courier New`;const e=this.canvas.width/2;this.ctx.fillStyle="#008080",this.title.forEach((t,s)=>{this.ctx.fillText(t,e,this.canvas.height/3+s*this.size*2)})}}const r=(t,s)=>new Path2D(`M${t},${s} h75 m0,50 h-75 m7.5,0 v-50 m15,0 v50 m15,0 v-50 m15,0 v50 m15,0 v-50`);async function x(s){return new Promise(t=>{setTimeout(()=>{t()},s)})}function p(t,s){return t=Math.ceil(t),s=Math.floor(s),Math.floor(Math.random()*(s-t+1)+t)}function u(){return[1,-1][p(0,1)]}function n(t,s,e,i,h){return s=i-(t=t.measureText(s)).alphabeticBaseline,{left:e-t.width/2+h/12,top:s+(i=t.ideographicBaseline-h/12),width:t.width-h/6,height:-i}}function y(t,s){var e=t.x<s.x?1:-1,i=t.y<s.y?1:-1,h=Math.abs(t.x-s.x);return t=Math.abs(t.y-s.y),s={x:1,y:1},t<h?s.y=t/h:s.x=h/t,s.x*=e,s.y*=i,s}function m(t,s,e){return Math.abs(t.x-s.x)<=e&&Math.abs(t.y-s.y)<=e}class o{ctx;x;y;width;height;constructor(t,s,e,i,h){this.ctx=t,this.x=s,this.y=e,this.width=i,this.height=h}getPositionCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}isCollisionWithObject(t){return this.x+this.width>=t.x&&this.x<=t.x+t.width&&this.y+this.height>=t.y&&this.y<=t.y+t.height}}class c extends o{content;constructor(t,s,e,i,h,a){super(t,s,e,i,h),this.content=a}setFontStyle(){this.ctx.font=`bold ${this.width}px Courier New`}getHitArea(){return this.setFontStyle(),n(this.ctx,this.content,this.x,this.y,this.width)}}class l extends c{isBombDropped=!1;bombVelocity=13;texts=["A journey starts with one step","Don't forget to be awesome","You've never let me down","You have such a big heart","Don't give up, you can do this","You're making a big change","You're so brave","Small progress is still progress","One step at a time, you're almost there","Good Luck","Your advertisement can be here",""];gameObjects=[];callback;init(t,s){this.callback=t,s?(this.x=s.x,this.y=s.y):(t=p(300,this.ctx.canvas.width-300),s=p(100,this.ctx.canvas.height-100),this.x=t,this.y=s)}showInteractHint(){var t,s;1<+this.content||this.isProgressFinished||(t=this.getHitArea().height,t=this.y-1.4*t,s="#008080",this.ctx.save(),this.ctx.font="bold 36px Courier New",this.ctx.fillStyle=s,this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.arc(this.x,t,18,0,2*Math.PI),this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillText("E",this.x,t),this.ctx.restore())}prisonBarsDelta=0;isDead=!1;draw(){this.ctx.save(),this.ctx.fillStyle="#36454F",this.ctx.font=`bold ${this.width}px Courier New`,this.ctx.fillText(String(this.content),this.x,this.y);let{left:t,top:s}=this.getHitArea(),e=t;this.isProgressFinished&&(e-=this.prisonBarsDelta);var i,h,a,o=r(e,s);this.ctx.lineWidth=2,this.ctx.stroke(o),this.isProgressFinished||this.drawProgressBar(),this.isDead&&(this.ctx.strokeStyle="#CA2C92",{left:o,top:i,width:h,height:a}=n(this.ctx,"12",this.x,this.y,this.width),o=new Path2D(`M${o},${i} l${h},${a} m0,${-a} l${-h},`+a),this.ctx.lineWidth=4,this.ctx.stroke(o)),this.ctx.restore()}openPrisonBars(){this.prisonBarsDelta+=2;let{width:t,height:s}=this.getHitArea();this.prisonBarsDelta>=t&&(this.gameObjects=[],this.gameObjects.push(()=>{this.ctx.save(),this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#36454F",this.ctx.fillText(this.texts[+this.content-1],this.x,this.y-s),this.ctx.restore()}),this.callback())}progress=100;drawProgressBar(){var t=this.prisonBarsMetrics.width/2,s=this.x-t/2,e=this.y-this.prisonBarsMetrics.height/2-15;this.ctx.strokeRect(s,e,t,10),this.ctx.fillRect(s,e,this.progress*t/100,10)}isProgressFinished=!1;doProgress(){this.isProgressFinished||(this.progress--,this.progress<=0&&(this.isProgressFinished=!0,this.gameObjects.push(()=>{this.openPrisonBars()})))}prisonBarsMetrics={width:75,height:50};getHitArea(){return{left:this.x-this.prisonBarsMetrics.width/2,top:this.y-this.prisonBarsMetrics.height/2,width:this.prisonBarsMetrics.width,height:this.prisonBarsMetrics.height}}render(){this.gameObjects.forEach(t=>t()),this.draw()}}class d extends h{gameObjects=[];gameObjectIndexesForSave=[];positiveEmojis=["(* ^ ω ^)","(*￣▽￣)b","ヽ(・∀・)ﾉ","╰(▔∀▔)╯","(─‿‿─)","<(￣︶￣)>","☆*:.｡.o(≧▽≦)o.｡.:*☆","٩(◕‿◕｡)۶","(￣ω￣)","( • ⩊ • )","(≧◡≦)","\\(★ω★)/","°˖✧◝(⁰▿⁰)◜✧˖°","٩(｡•́‿•̀｡)۶","⸜( *ˊᵕˋ* )⸝","(￣▽￣*)ゞ","(ง ื▿ ื)ว"];negativeEmojis=["┌∩┐(◣_◢)┌∩┐","Σ(▼□▼メ","٩(╬ʘ益ʘ╬)۶","(ﾉಥ益ಥ)ﾉ","(｡•́︿•̀｡)","(っ˘̩╭╮˘̩)っ","(︶︹︺)","←~(Ψ▼ｰ▼)∈","ヾ(`ヘ´)ﾉﾞ","(・`ω´・)","(҂ `з´ )","↑_(ΦwΦ)Ψ","୧((#Φ益Φ#))୨","ψ( ` ∇ ´ )ψ","(ಥ﹏ಥ)","＼(º □ º l|l)/","(っ•﹏•)っ ✴==≡눈٩(`皿´҂)ง"];init(){super.init(),this.steps[this.currentStep]()}setEvents(){this.keydownHandler=this.keydownHandler.bind(this),document.addEventListener("keydown",this.keydownHandler)}deleteEvents(){document.removeEventListener("keydown",this.keydownHandler)}isAllowSkipAll;keydownHandler(s){if("Escape"===s.code&&this.isAllowSkipAll&&this.finish(),("Enter"===s.code||"Space"===s.code)&&this.isSkip)if(this.isSkip=!1,this.isLastStep())this.finish();else{const s=[];this.gameObjectIndexesForSave.forEach(t=>{s.push(this.gameObjects[t])}),this.gameObjects=[...s],this.gameObjectIndexesForSave=[];for(let t=0;t<s.length;t++)this.gameObjectIndexesForSave.push(t);this.currentStep++,this.steps[this.currentStep]()}}finish(){this.deleteEvents(),this.finishCallback()}isLastStep(){return this.currentStep===this.steps.length-1}setMask(){this.ctx.clip(new Path2D(`M0,50 h${this.canvas.width} v${this.canvas.height-100} h-${this.canvas.width} z`))}currentStep=0;async waitSkip(t){await x(t),this.isSkip=!0}getCenterPos(){return{cX:this.canvas.width/2,cY:this.canvas.height/2.5}}steps=[];setStoryText(t){this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#36454F",this.ctx.fillText(t,this.canvas.width/2,this.canvas.height-this.canvas.height/4),this.setSkipText()}isSkip=!1;setSkipText(){this.isSkip&&(this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#e6b800",this.ctx.fillText("[Press Space or Enter to skip]",this.canvas.width/2,this.canvas.height-this.canvas.height/4+48)),this.setSkipAllText()}setSkipAllText(){this.isAllowSkipAll=!0,this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#008080",this.ctx.fillText("[Press ESC to skip all]",this.canvas.width/2,this.canvas.height-this.canvas.height/4+96)}update(t){super.update(t),this.gameObjects.forEach(t=>t())}}class b extends d{prisioner;fontSize=100;steps=[async()=>{this.gameObjects.push(()=>this.setStoryText("")),this.prisioner=new l(this.ctx,void 0,void 0,this.fontSize/2,this.fontSize/2,"12"),this.prisioner.texts[11]="I believed in you",this.gameObjects.push(()=>{this.prisioner.init(()=>{},{x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/3}),this.prisioner.render()}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.waitSkip(500)},async()=>{this.gameObjects.push(()=>{this.ctx.fillStyle="#36454F",this.ctx.font="bold 100px Courier New";var t=n(this.ctx,"0",this.prisioner.x,this.prisioner.y,100).height;this.ctx.fillText("0",this.prisioner.x,this.prisioner.y+1.5*t),this.prisioner.doProgress()}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),await x(3e3),this.gameObjects.push(()=>this.setStoryText("0 saved all the members of the round table and now can face 13")),this.waitSkip(1e3)},async()=>{this.prisioner.texts[11]="",this.gameObjects.push(()=>{this.setStoryText("however, at the most unexpected moment, 13 appeared")}),this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.font="bold 100px Courier New",this.ctx.fillStyle="#CA2C92",this.ctx.fillText("13",t+this.canvas.width/4,s)}),this.waitSkip(1e3)},async()=>{let e=!0;this.gameObjects.push(()=>{this.ctx.font="bold 100px Courier New",this.ctx.fillStyle="#CA2C92";var t=e?p(-4,4):0,s=e?p(-4,4):0;this.ctx.fillText("13",this.prisioner.x+1.5*this.prisioner.getHitArea().width+t,this.prisioner.y+s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),await x(1e3),e=!1,this.prisioner.isDead=!0,this.gameObjects.push(()=>{this.setStoryText("and destroyed 12 before their union with the round table")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("end?")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("13 won?")}),this.waitSkip(1e3)},async()=>{x(500).then(()=>{this.gameObjects.push(()=>{this.setStoryText("when it seemed there was no hope, they came")})});const t=[],c=[56,72,84,49,26,15,31,64,-5,-21,35,44,-89,156,99];for(let n=0;n<c.length;n++){const l=p(100,this.ctx.canvas.width/2-100)*u(),d=p(100,this.ctx.canvas.height/2-200)*u();let a=0,o=0;const x=p(3,5);let r=!0;t.push(new Promise(h=>{setTimeout(()=>{this.gameObjects.push(()=>{if(r){let{cX:t,cY:s}=this.getCenterPos(),e=t+l,i=s+d;if(this.isMoveTo12){const c=y({x:e,y:i},{x:this.prisioner.x,y:this.prisioner.y});a+=c.x*x,o+=c.y*x,e+=a,i+=o,m({x:e,y:i},{x:this.prisioner.x,y:this.prisioner.y},x)&&(r=!1,e=this.prisioner.x,i=this.prisioner.y,h())}this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#36454F",this.ctx.fillText(String(c[n]),e,i)}}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1)},100*n)}))}Promise.all(t).then(()=>{this.isMoveTo12=!1,this.prisioner.isDead=!1}),this.waitSkip(2e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("they did not have the power of the members of the round table")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("and could not replace 12")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("12 was the youngest member of the round table")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("he was cheerful, kind and happy to everyone")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("so when 12 needed help, they didn't care about power 13, they wanted to save 12")}),this.waitSkip(1e3)},async()=>{this.isMoveTo12=!0,x(500).then(()=>{this.gameObjects.push(()=>{this.setStoryText("they united with him and gave hope")})}),this.waitSkip(3e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("and the round table with all its members united with 0")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("the final battle began")}),this.waitSkip(1e3)}];isMoveTo12=!1;setSkipAllText(){1<+i.GET_DATA(s.LORE)&&super.setSkipAllText()}}class g extends d{bgGameObjects=[];fly=!1;step=0;offsetVisibleZone=200;isNotVisible(t,s){return t<=-this.offsetVisibleZone||t>=this.canvas.width+this.offsetVisibleZone||s<=-this.offsetVisibleZone||s>=this.canvas.height+this.offsetVisibleZone}steps=[async()=>{this.gameObjects.push(()=>this.setStoryText("From the beginning there was nothing")),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("and then it took shape")}),this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.fillStyle="#36454F",this.ctx.font="bold 100px Courier New",this.ctx.fillText("0",t,s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("everything appeared")}),await x(500),this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),t=(this.ctx.save(),this.ctx.translate(t+15,s-75),this.ctx.rotate(-Math.PI/2),new Path2D("M0,0 v80 h15 v-80 h-15 m0,0 h-5 v-10 h25 v10 h-5 m5,-5 h10 v5 h10 v-30 h-10 v25 m0,-20 h-45 v-5 h-10 v30 h10 v-25 m0,20 h10"));this.ctx.lineWidth=2,this.ctx.stroke(t),this.ctx.restore()}),await x(500),await new Promise(t=>{for(let h=1;h<=21;h++)setTimeout(()=>{this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),e=(this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#36454F",this.ctx.measureText(String(10*h))),i=10<=h?9*(~~e.width-~~this.ctx.measureText("10").width):0;this.ctx.fillText(String(h).replace("21","..."),t+15+h*e.width-i,s),this.ctx.fillText(String(-h).replace("-21","..."),t-15-h*e.width+i,s)}),21===h&&t()},100*h)}),this.waitSkip(500)},async()=>{this.gameObjects.push(()=>{this.setStoryText("0 shared his power from 1st to 12th and they formed a round table led by 0")}),await new Promise(s=>{for(let h=1,t=210;h<=12;h++,t+=30)setTimeout(()=>{let i=-t*(Math.PI/180);this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),e=(this.ctx.fillStyle="#36454F",this.ctx.font="bold 50px Courier New",this.fly?this.step:0),t=t+(150+e*h)*Math.sin(i),s=s+(150+e*h)*Math.cos(i);this.isNotVisible(t,s)||this.ctx.fillText(String(h),t,s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),12===h&&setTimeout(()=>{this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.beginPath(),this.ctx.arc(t,s,150-this.ctx.measureText("1").width,0,2*Math.PI),this.ctx.lineWidth=2,this.ctx.stroke()}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),s()},150)},150*h)}),this.waitSkip(500)},async()=>{this.gameObjects.push(()=>{this.setStoryText("everything was in harmony")});for(let t=0;t<this.positiveEmojis.length;t++){const s=p(16,this.canvas.width-16),e=p(66,this.canvas.height-16-50);this.bgGameObjects.push(()=>{this.ctx.fillStyle="#36454F",this.ctx.font="bold 16px Courier New",this.ctx.fillText(this.positiveEmojis[t],s,e)})}this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("until 13 envied the power of twelve")});let h=!0;this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),e=(this.ctx.font="bold 50px Courier New",this.ctx.fillStyle="#CA2C92",h?p(-4,4):0),i=h?p(-4,4):0;this.ctx.fillText("13",t+this.canvas.width/4+e,s+i)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.waitSkip(1e3),await x(1e3),h=!1},async()=>{this.gameObjects.push(()=>{this.setStoryText("and then tricked and imprisoned the members of the round table")}),await x(500),await new Promise(t=>{for(let h=1,a=210;h<=12;h++,a+=30)setTimeout(()=>{this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),e=-a*(Math.PI/180),i=this.fly?this.step*h:0,t=t+(150+i)*Math.sin(e)-37.5,s=s+(150+i)*Math.cos(e)-25;this.isNotVisible(t,s)||(i=r(t,s),this.ctx.lineWidth=2,this.ctx.stroke(i))}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),12===h&&t()},150*h)}),this.waitSkip(500)},async()=>{this.gameObjects.push(()=>{this.setStoryText("and separated them")}),this.fly=!0,await x(3e3),this.waitSkip(0)},async()=>{this.gameObjects.push(()=>{this.setStoryText("0 lost his power and was unable to stop 13")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("there was only hope for unification with all the members of the round table")}),this.gameObjectIndexesForSave.splice(0,1),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("so 0 disappeared in their search")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("and chaos began, led by 13")}),this.bgGameObjects=[];for(let t=0;t<this.negativeEmojis.length;t++){const s=p(16,this.canvas.width-16),e=p(66,this.canvas.height-16-50);this.bgGameObjects.push(()=>{this.ctx.fillStyle="#36454F",this.ctx.font="bold 16px Courier New",this.ctx.fillText(this.negativeEmojis[t],s,e)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1)}this.waitSkip(1e3)}];update(t){super.update(t),this.bgGameObjects.forEach(t=>t()),this.gameObjects.forEach(t=>t()),this.fly&&this.step<=1e3&&(this.step+=3)}setSkipAllText(){0<+i.GET_DATA(s.LORE)&&super.setSkipAllText()}}class v extends d{steps=[async()=>{this.gameObjects.push(()=>{this.setStoryText("In the confrontation between 0 and 13 - 0 got the victory")}),this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.fillStyle="#36454F",this.ctx.font="bold 100px Courier New",this.ctx.fillText("0",t,s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.font="bold 50px Courier New",this.ctx.fillStyle="#CA2C92",this.ctx.fillText("13",t+this.canvas.width/4,s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("although 13 did a lot of damage")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("0 did not leave him")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("moreover, he invited him to the round table")}),this.waitSkip(1e3),this.gameObjectIndexesForSave.splice(1,1)},async()=>{this.gameObjects.push(()=>{this.setStoryText("now there are 13 of them")}),await new Promise(s=>{for(let i=1,t=360/13*7;i<=13;i++,t+=360/13)setTimeout(()=>{let e=-t*(Math.PI/180);this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),t=(this.ctx.fillStyle="#36454F",this.ctx.font="bold 50px Courier New",t+150*Math.sin(e)),s=s+150*Math.cos(e);this.ctx.fillText(String(i),t,s)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),13===i&&setTimeout(()=>{this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos();this.ctx.beginPath(),this.ctx.arc(t,s,150-this.ctx.measureText("1").width,0,2*Math.PI),this.ctx.lineWidth=2,this.ctx.stroke()}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),s()},150)},150*i)}),this.waitSkip(500),this.waitSkip(1e4)},async()=>{this.gameObjects.push(()=>{this.setStoryText("everything was in harmony again")});for(let t=0;t<this.positiveEmojis.length;t++){const s=p(16,this.canvas.width-16),e=p(66,this.canvas.height-16-50);this.gameObjects.push(()=>{this.ctx.fillStyle="#36454F",this.ctx.font="bold 16px Courier New",this.ctx.fillText(this.positiveEmojis[t],s,e)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1)}this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("wait a minute...")}),this.waitSkip(1e3)},async()=>{this.gameObjects.push(()=>{this.setStoryText("WTF?")});let h=!0;this.gameObjects.push(()=>{var{cX:t,cY:s}=this.getCenterPos(),e=(this.ctx.font="bold 50px Courier New",this.ctx.fillStyle="#CA2C92",h?p(-4,4):0),i=h?p(-4,4):0;this.ctx.fillText("14",t+this.canvas.width/4+e,s+i)}),this.gameObjectIndexesForSave.push(this.gameObjects.length-1),this.waitSkip(1e3),await x(2e3),h=!1}];setSkipAllText(){2<+i.GET_DATA(s.LORE)&&super.setSkipAllText()}}class w extends h{data;constructor(t,s,e,i){super(t,s,e),this.data=i,this.colors=new Array(this.data.items.length).fill(this.baseColor)}hitAreas=[];baseColor="#36454F";hoverColor="#CA2C92";colors;size=36;setEvents(){this.mouseMoveHandler=this.mouseMoveHandler.bind(this),this.mouseDownHandler=this.mouseDownHandler.bind(this),document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mousedown",this.mouseDownHandler)}deleteEvents(){document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mousedown",this.mouseDownHandler)}mouseMoveHandler(e){e.button||(this.canvas.style.cursor="",this.hitAreas.forEach((t,s)=>{this.data.interactive[s]&&(this.colors[s]=this.baseColor,this.isPointInArea({x:e.clientX,y:e.clientY},t))&&(this.canvas.style.cursor="pointer",this.colors[s]=this.hoverColor)}))}mouseDownHandler(e){e.button||this.hitAreas.forEach((t,s)=>{this.data.interactive[s]&&this.isPointInArea({x:e.clientX,y:e.clientY},t)&&(this.canvas.style.cursor="",this.deleteEvents(),this.finishCallback(),this.data.callbacks[s]())})}isPointInArea(t,s){var{left:s,top:e,width:i,height:h}=s;return t.x>=s&&t.x<=s+i&&e<=t.y&&t.y<=e+h}update(t){super.update(t),this.ctx.font=`bold ${this.size}px Courier New`;const e=this.canvas.width/2;this.data.title&&(this.ctx.fillStyle="#008080",this.data.title.forEach((t,s)=>{this.ctx.fillText(t,e,this.canvas.height/3+48*s)})),this.hitAreas=[],this.data.items.forEach((t,s)=>{this.data.interactive[s]||(this.ctx.globalAlpha=.5),this.ctx.fillStyle=this.colors[s],s=this.canvas.height/(this.data.title?2:3)+72*s,this.ctx.fillText(t,e,s),this.ctx.globalAlpha=1,this.hitAreas.push(n(this.ctx,t,e,s,this.size))})}}class S extends h{popup;staticUpdate(){super.staticUpdate(),this.popup?.staticUpdate()}init(){var t=+i.GET_DATA(s.PROGRESS),t={items:[`Continue (${Math.round(t/13*100)}%)`,"Start new game","Options"],interactive:[!!i.GET_DATA(s.PROGRESS),!0,!0],callbacks:[()=>{this.finishCallback(e.WORLD)},()=>{i.SET_DATA(s.PROGRESS,""),this.finishCallback()},()=>{this.finishCallback(e.OPTIONS)}]};this.popup=new w(this.ctx.canvas,this.ctx,()=>{},t),this.staticUpdate(),this.popup.init()}update(t){super.update(t),this.popup?.update(t)}}class f extends h{setEvents(){this.keydownHandler=this.keydownHandler.bind(this),document.addEventListener("keydown",this.keydownHandler)}deleteEvents(){document.removeEventListener("keydown",this.keydownHandler)}keydownHandler(t){"Enter"!==t.code&&"Space"!==t.code||(this.deleteEvents(),this.finishCallback())}size=36;title=["Movement - [WASD / Arrow Keys]","Interaction - [E]","Attack - [LMB (left mouse button)]","Skip - [Space / Enter]","Skip all - [ESC]"];update(t){super.update(t),this.ctx.font=`bold ${this.size}px Courier New`;const e=this.canvas.width/2;this.ctx.fillStyle="#008080",this.title.forEach((t,s)=>{this.ctx.fillText(t,e,this.canvas.height/6+s*this.size*2)}),this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#e6b800",this.ctx.fillText("[Press Space or Enter to skip]",this.canvas.width/2,this.canvas.height-this.canvas.height/4+48)}}class O extends o{isBombDropped=!1;bombVelocity=13;gameObjects=[];callback;isSkipRender=!1;isDamage;moveTo;init(t,s){this.moveTo=t,this.callback=s}isMove=!0;async move(){var t;this.isMove&&(t=y({x:this.x,y:this.y},this.moveTo),this.x+=t.x*this.bombVelocity,this.y+=t.y*this.bombVelocity,m({x:this.x,y:this.y},this.moveTo,this.bombVelocity))&&(this.x=this.moveTo.x,this.y=this.moveTo.y,this.isMove=!1,await this.preExplode(),await this.explode(),await this.explosionParticles(40),setTimeout(()=>{this.isSkipRender=!0,this.callback()},0))}async preExplode(){this.gameObjects.push(()=>{var s=[];for(let t=0;t<2;t++)s.push(p(-2,2));this.x+=s[0],this.y+=s[1]}),await x(p(750,2200)),this.gameObjects.pop()}explodeVelocity=50;explodeRadius=0;maxR=130;async explode(){return new Promise(t=>{this.gameObjects.push(()=>{this.explodeRadius+=this.explodeVelocity,Math.abs(this.maxR-this.explodeRadius)<=this.explodeVelocity&&(this.explodeRadius=this.maxR,t()),this.ctx.save(),this.ctx.fillStyle="#36454F",this.ctx.strokeStyle="#36454F",this.ctx.globalAlpha=.05,this.ctx.fillRect(this.x-this.explodeRadius,this.y-this.explodeRadius,2*this.explodeRadius,2*this.explodeRadius),this.ctx.globalAlpha=1,this.ctx.strokeRect(this.x-this.explodeRadius,this.y-this.explodeRadius,2*this.explodeRadius,2*this.explodeRadius),this.ctx.restore()})})}explosionParticles(s){var e=[];for(let t=0;t<s;t++)e.push(new Promise(s=>{let e=this.x,i=this.y;const h=p(5,15),a=p(5,15);let o=!0;const r=p(15,25),n={x:e+p(0,this.explodeRadius)*u(),y:i+p(0,this.explodeRadius)*u()},c=p(1,9)/10;this.gameObjects.push(()=>{var t;this.ctx.save(),this.ctx.fillStyle="#36454F",this.ctx.globalAlpha=c,this.ctx.fillRect(e-h/2,i-a/2,h,a),this.ctx.globalAlpha=1,this.ctx.restore(),o&&(t=y({x:e,y:i},n),e+=t.x*r,i+=t.y*r,m({x:e,y:i},n,r))&&(e=n.x,i=n.y,o=!1,s())})}));return e.push(new Promise(t=>{this.gameObjects.push(()=>{this.shakeWorld()}),x(250).then(()=>{this.clearShakeWorld(),t()})})),Promise.all(e)}draw(){var t,s,e;this.ctx.lineWidth=2,this.ctx.strokeStyle="#36454F",t=this.x,s=this.y,(e=new Path2D(`M${t},${s-20+2} m-10,0 v-10 h20 v10 m-10,-10 q0,-15 30,-15 l-5,-5 l5,5 v-5 v5 h5 h-5 l5,5 l-5,-5 v5 v-5 l-5,5`)).moveTo(t+20,s),e.arc(t,s,20,0,2*Math.PI),e.moveTo(t+10,s),e.arc(t,s,10,0,2*Math.PI),this.ctx.stroke(e)}getHitArea(){var t={left:this.x-this.explodeRadius,top:this.y-this.explodeRadius,width:2*this.explodeRadius,height:2*this.explodeRadius};return this.isSkipRender&&(t.width=0),t}render(){this.isSkipRender||(this.gameObjects.forEach(t=>t()),this.draw(),this.move())}isSkake=!0;shakeWorld(){var t,s;this.isSkake&&(t=p(-8,8),s=p(-8,8),this.ctx.translate(t,s))}clearShakeWorld(){this.isSkake=!1,this.ctx.setTransform(1,0,0,1,0,0)}}class T extends c{velocity=16;moveTo;bombs=[];isBossMode;setBerserkMode(){this.bombCount=p(4,8),this.bombRadius=400}isStopRender;init(t){this.isBossMode=t,this.setMoveTo()}render(t){this.isStopRender||this.move(),this.draw(),this.bombs.forEach(t=>t.render())}isDead;draw(){var t,s,e,i;this.ctx.fillStyle="#CA2C92",this.setFontStyle(),this.ctx.fillText(this.content,this.x,this.y),this.isDead&&(this.ctx.save(),this.ctx.strokeStyle="#36454F",{left:i,top:t,width:s,height:e}=this.getHitArea(),i=new Path2D(`M${i},${t} l${s},${e} m0,${-e} l${-s},`+e),this.ctx.lineWidth=4,this.ctx.stroke(i),this.ctx.restore())}isMoveStop=!0;move(){if(!this.isMoveStop)if(this.x===this.moveTo.x&&this.y===this.moveTo.y)this.isMoveStop=!0,setTimeout(()=>{this.setMoveTo(),this.isDropBombs=!1},500);else{let t,s,e=Math.abs(this.x-this.moveTo.x),i=Math.abs(this.y-this.moveTo.y);e<this.velocity?t=e:(h=Math.abs(this.startMovePos.x-this.moveTo.x))/3<e&&e<2*h/3?(t=this.velocity/5,this.dropBombs()):t=this.velocity,i<this.velocity?s=i:(e=Math.abs(this.startMovePos.y-this.moveTo.y))/3<i&&i<2*e/3?(s=this.velocity/5,this.dropBombs()):s=this.velocity;var h=y({x:this.x,y:this.y},this.moveTo);this.x+=h.x*t,this.y+=h.y*s}}startMovePos;setMoveTo(){var{width:t,height:s}=this.getHitArea();this.startMovePos={x:this.x,y:this.y},this.moveTo={x:p(t/2,this.ctx.canvas.width-t/2),y:p(s/2+s/12,this.ctx.canvas.height-s/2+s/12)},this.isMoveStop=!1}bombCount=2;bombRadius=150;isDropBombs=!1;async dropBombs(){if(this.isBossMode&&!this.isDropBombs){this.isDropBombs=!0;var s=[];for(let t=0;t<this.bombCount;t++)await x(100*t),s.push(new Promise(t=>{var s=new O(this.ctx,this.x,this.y,0,0);this.bombs.push(s),s.init({x:p(this.x-this.bombRadius,this.x+this.bombRadius),y:p(this.y-this.bombRadius,this.y+this.bombRadius)},()=>{t()})}));await Promise.all(s),this.bombs=this.bombs.filter(t=>!t.isSkipRender)}}}class k extends o{getHitArea(){return{left:this.x-this.width,top:this.y-this.height,width:2*this.width,height:2*this.height}}positionMovement;step;velocity;id;isDamage;color;constructor(t,s,e,i,h,a=5){var{x:o,y:r}=s.start;super(t,o,r,a,a),this.id=e,this.color=h,this.positionMovement=this.correctPositionMovement(s),this.x=s.start.x,this.y=s.start.y,this.step=y(this.positionMovement.start,this.positionMovement.end),this.velocity=i}correctPositionMovement({start:t,end:s}){return{start:t,end:{x:s.x-this.width/2,y:s.y-this.height/2}}}render(){this.draw(),this.move()}draw(){this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.arc(this.x,this.y,this.width,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()}move(){this.x+=this.step.x*this.velocity,this.y+=this.step.y*this.velocity}}class j extends c{velocity=8;isBossMode;init(t){(this.isBossMode=t)&&(this.isShowInteractHint=!0),this.setEvents()}isStopRender;setEvents(){this.keydownHandler=this.keydownHandler.bind(this),this.keyupHandler=this.keyupHandler.bind(this),this.mousedownHandler=this.mousedownHandler.bind(this),document.addEventListener("keydown",this.keydownHandler),document.addEventListener("keyup",this.keyupHandler),document.addEventListener("mousedown",this.mousedownHandler)}deleteEvents(){document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("keyup",this.keyupHandler),document.removeEventListener("mousedown",this.mousedownHandler)}keysPressed=[];keydownHandler(t){this.isStopRender||(this.keysPressed.push(t.code),this.keysPressed=[...new Set(this.keysPressed)])}keyupHandler(t){this.isStopRender||this.deletePressedKey(t.code)}mousedownHandler(t){var s,e;this.isStopRender||t.button||!this.isBossMode||(this.isShowInteractHint=!1,{top:s,height:e}=this.getHitArea(),this.attack({x:this.x,y:s+e/2},{x:t.clientX,y:t.clientY},16))}deletePressedKey(s){var t=this.keysPressed.findIndex(t=>t===s);-1<t&&this.keysPressed.splice(t,1)}bulletObjects=[];attack(t,s,e){t=new k(this.ctx,{start:t,end:s},this.bulletObjects.length,e,"#36454F"),this.bulletObjects.push(t)}destroyBulletObject(s){this.bulletObjects.splice(this.bulletObjects.findIndex(t=>t.id===s),1)}render(t){this.isStopRender||this.move(),this.bulletObjects.forEach(t=>t.render()),this.draw()}isDead;draw(){var t,s,e,i;this.ctx.fillStyle="#36454F",this.setFontStyle(),this.ctx.fillText(this.content,this.x,this.y),this.isDead&&(this.ctx.save(),this.ctx.strokeStyle="#CA2C92",{left:i,top:t,width:s,height:e}=this.getHitArea(),i=new Path2D(`M${i},${t} l${s},${e} m0,${-e} l${-s},`+e),this.ctx.lineWidth=4,this.ctx.stroke(i),this.ctx.restore()),this.showInteractHint()}move(){let s=0,e=0;this.keysPressed.forEach(t=>{"ArrowUp"!==t&&"KeyW"!==t||e--,"ArrowRight"!==t&&"KeyD"!==t||s++,"ArrowDown"!==t&&"KeyS"!==t||e++,"ArrowLeft"!==t&&"KeyA"!==t||s--});var t=s*this.velocity*1,i=e*this.velocity*1,t={x:this.x+t,y:this.y+i};this.isWorldCollision({x:t.x,y:this.y})||(this.x=t.x),this.isWorldCollision({x:this.x,y:t.y})||(this.y=t.y)}isInteraction(){return this.keysPressed.includes("KeyE")}isShowInteractHint;showInteractHint(){var t,s;this.isShowInteractHint&&(t=this.getHitArea().height,t=this.y-1.4*t,s="#008080",this.ctx.save(),this.ctx.font="bold 24px Courier New",this.ctx.fillStyle=s,this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.arc(this.x,t,24,0,2*Math.PI),this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillText("LMB",this.x,t),this.ctx.restore())}isWorldCollision(t){this.setFontStyle();var{left:t,top:s,width:e,height:i}=n(this.ctx,this.content,t.x,t.y,this.width);return t<0||s<0||t+e>this.ctx.canvas.width||s+i>this.ctx.canvas.height}isCollisionWithObject(t,s=this){var{left:s,top:e,width:i,height:h}=s.getHitArea(),a=t.getHitArea();return!(t instanceof O&&(!a.width||!a.height))&&s+i>=a.left&&s<=a.left+a.width&&e+h>=a.top&&e<=a.top+a.height}}class E extends o{color;constructor(t,s,e,i,h,a){super(t,s,e,i,h),this.color=a}getHitArea(){throw new Error("Method not implemented.")}render(){this.draw()}progress=100;draw(){this.ctx.save(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.strokeRect(this.x,this.y,this.width,this.height),this.ctx.fillRect(this.x,this.y,this.progress*this.width/100,this.height),this.ctx.restore()}isProgressFinished=!1;doProgress(t){this.isProgressFinished||(this.progress-=t,this.progress<=0&&(this.isProgressFinished=!0))}}class A extends h{fontSize=100;gameObjects=[];player;enemy;prisionerObjects=[];progressBarObjects=[];isBossLevel;init(){super.init();var t=+i.GET_DATA(s.PROGRESS);t&&(this.prisionersStatus.current=1+t,t>=this.prisionersStatus.max)&&(this.isBossLevel=!0),this.player=new j(this.ctx,this.canvas.width/2,this.canvas.height/2,this.fontSize,this.fontSize,"0"),this.player.init(this.isBossLevel),this.enemy=new T(this.ctx,2*this.player.x,2*this.player.y,this.fontSize,this.fontSize,"13"),this.enemy.init(this.isBossLevel),this.isBossLevel?this.progressBarObjects.push(new E(this.ctx,20,50,250,20,"#008080"),new E(this.ctx,this.canvas.width-274,50,250,20,"#008080")):this.showPrisoner()}prisionersStatus={current:1,max:12};showPrisoner(){setTimeout(()=>{var t=new l(this.ctx,void 0,void 0,this.fontSize/2,this.fontSize/2,String(this.prisionersStatus.current));t.init(()=>{this.prisionersStatus.current+1>this.prisionersStatus.max&&(this.isStopRender=!0,this.player.isStopRender=!0,this.enemy.isStopRender=!0),i.SET_DATA(s.PROGRESS,String(this.prisionersStatus.current)),setTimeout(()=>{this.prisionerObjects=[],this.prisionersStatus.current++,this.prisionersStatus.current<=this.prisionersStatus.max?setTimeout(()=>{this.showPrisoner()},2e3):this.finishCallback()},3e3)}),this.prisionerObjects.push(t)},0)}isStopRender=!1;popup;async setResult(t=!1){if(this.isStopRender=!0,this.player.isStopRender=!0,this.player.isDead=!t,this.enemy.isDead=t,this.enemy.isStopRender=!0,await x(2e3),t)this.battleFinishAnimation(),i.SET_DATA(s.PROGRESS,"13"),this.finishCallback(e.OUTRO);else{const s={title:["Everything was a little different,","let me show you how it really was"],items:["Repeat","Back to menu"],interactive:[!0,!0],callbacks:[()=>{this.finishCallback(e.WORLD)},()=>{this.finishCallback(e.MENU)}]};this.popup=new w(this.ctx.canvas,this.ctx,()=>{},s),this.popup.staticUpdate(),this.popup.init()}}battleFinishAnimation(){}update(t){super.update(t),this.draw(),this.prisionerObjects.forEach(t=>t.render()),this.progressBarObjects.forEach((t,s)=>{s&&(t.x=this.canvas.width-274),t.render()}),this.player.render(),this.enemy.render(),this.popup?.update(t),this.isStopRender||this.detectCollisions(),this.gameObjects.forEach(t=>t())}draw(){this.isBossLevel?this.progressBarObjects.forEach((t,s)=>{this.drawBossStatus(s)}):this.drawStatus()}drawStatus(){this.ctx.save(),this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#008080";var{current:t,max:s}=this.prisionersStatus,{left:s,width:e,height:i}=n(this.ctx,t=`Rescued: ${t-1}/`+s,0,0,24);this.ctx.fillText(t,s+e+24,i+24),this.ctx.restore()}drawBossStatus(t){this.ctx.save(),this.ctx.font="bold 24px Courier New",this.ctx.fillStyle="#008080";let s=t?`Thirteen: ${this.progressBarObjects[t].progress}/100`:`Zero:					${this.progressBarObjects[t].progress}/100`,{left:e,width:i,height:h}=n(this.ctx,s,0,0,24),a=e+i+24;t&&(a=this.canvas.width-150),this.ctx.fillText(s,a,h+24),this.ctx.restore()}detectCollisions(){this.player.isCollisionWithObject(this.enemy)&&!this.isBossLevel&&this.setResult(!1);for(let t=0;t<this.player.bulletObjects.length;t++){var s;this.player.isCollisionWithObject(this.enemy,this.player.bulletObjects[t])&&!this.player.bulletObjects[t].isDamage&&(this.player.bulletObjects[t].isDamage=!0,this.player.destroyBulletObject(this.player.bulletObjects[t].id),s=this.progressBarObjects[1].progress<=50?(this.enemy.setBerserkMode(),1):5,this.progressBarObjects[1].doProgress(s),this.progressBarObjects[1].progress<=0)&&this.setResult(!0)}for(let t=0;t<this.enemy.bombs.length;t++)this.player.isCollisionWithObject(this.enemy.bombs[t])&&!this.enemy.bombs[t].isDamage&&(this.enemy.bombs[t].isDamage=!0,this.progressBarObjects[0].doProgress(25),this.progressBarObjects[0].progress<=0)&&this.setResult(!1);for(let t=0;t<this.prisionerObjects.length;t++)if(this.player.isCollisionWithObject(this.prisionerObjects[t])){this.prisionerObjects[t].showInteractHint(),this.player.isInteraction()&&this.prisionerObjects[t].doProgress();break}}}(t=e=e||{})[t.MENU=0]="MENU",t[t.INTRO=1]="INTRO",t[t.WORLD=2]="WORLD",t[t.CULMINATION=3]="CULMINATION",t[t.OUTRO=4]="OUTRO",t[t.GRATITUDE=5]="GRATITUDE",t[t.OPTIONS=6]="OPTIONS",new class{canvas;ctx;scenes=[];activeSceneIndex=-1;constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{willReadFrequently:!1,alpha:!1}),i.GET_DATA(s.PROGRESS)??i.SET_DATA(s.PROGRESS,""),this.nextScene(),this.resize(),this.setEvents(),this.render(0)}nextScene(t){this.scenes.splice(this.activeSceneIndex,1),this.activeSceneIndex=t??this.activeSceneIndex+1,this.scenes=[],this.scenes=[this.sceneFactory()],this.resize(),this.scenes[0].init()}sceneFactory(){switch(this.activeSceneIndex){case e.MENU:return new S(this.canvas,this.ctx,t=>{this.nextScene(t)});case e.INTRO:return new g(this.canvas,this.ctx,()=>{i.GET_DATA(s.LORE)??i.SET_DATA(s.LORE,"1"),this.nextScene()});case e.WORLD:return new A(this.canvas,this.ctx,t=>{this.nextScene(t)});case e.CULMINATION:return new b(this.canvas,this.ctx,()=>{+i.GET_DATA(s.LORE)<2&&i.SET_DATA(s.LORE,"2"),this.nextScene(e.WORLD)});case e.OUTRO:return new v(this.canvas,this.ctx,()=>{+i.GET_DATA(s.LORE)<3&&i.SET_DATA(s.LORE,"3"),this.nextScene()});case e.GRATITUDE:return new a(this.canvas,this.ctx,()=>{this.nextScene(e.MENU)});case e.OPTIONS:return new f(this.canvas,this.ctx,()=>{this.nextScene(e.MENU)})}}setEvents(){window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("contextmenu",t=>t.preventDefault())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.scenes.forEach(t=>t.staticUpdate())}render(s){requestAnimationFrame(this.render.bind(this)),this.scenes.forEach(t=>t.update(s))}}(document.getElementById("root"))</script>