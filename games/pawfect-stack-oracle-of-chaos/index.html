<title>Pawfect Stack - Oracle of Chaos - js13kGames 2025</title><meta name=viewport content="width=device-width"><style>body{--sw:64px;--sh:208px;font-family:monospace;background-color:#feebc9;image-rendering:pixelated;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px;margin:8px;min-width:768px;min-height:700px}main{width:768px;height:700px;box-sizing:border-box;border:4px solid #331c1a;background-color:#f0e4d7;display:flex;flex-shrink:0;align-items:stretch;justify-content:stretch;overflow:hidden;border-radius:3px;user-select:none}main>section{width:100%;position:relative;display:none;flex-direction:column;overflow:hidden}[data-cs=_1] #_24,body:not([data-cs]) #_24{display:none}#_24{font-size:1rem;font-weight:700;color:inherit;display:flex;justify-content:center;flex-direction:column;align-items:center}#_24 label{cursor:pointer}#_24 input{cursor:pointer;margin:0;position:relative;top:2px}#_1 h1,#_1 h2{color:transparent;user-select:none;width:335px;height:210px;overflow:hidden;background-image:url("data:image/png;base64,UklGRm4BAABXRUJQVlA4TGIBAAAvQkAKEB8gJCBTsg3uEQgQniR60iemIeTQ/5DS5j8A6Z8FchvbjiOLsygEzaTTIcyiJ6KfQ2s25vDxkmi1IX8WvnhEyOwoCFkP1xBbAn4EEf2fgAO1bucT0Z7u57jn9B90tG7puuu0p+03J+X0zceUorKeNd6cNOo3x+/KuOKo59VbHHhMb9dSojjwMVFt1K/EemZajXHsayNTatxJx5H3nJVVY6I41HhQ1h+uHCvfPacKMafGDfzdxzRwImXl1Lpv/u71Wp8eHO2+6XY1h4IMSBHKCObRPBlmAAVUEHCRpgMuNYPYLDcTcJnFKrBlVS5ZSoG3GbaEm0mKz0IGD4IhuAlE1/4ZvOsQKosHkaF1T4ZK2eQrofLoDoSQhYCad09UtgX3JFvMlnDTSa6JEWyRm0lKyJIli82wWZoJqBAMYjOaboUihAIxj/bJ4AsKMgoCAh4PWVra3DqiptvUuCdyOwE=");background-size:contain;margin:auto}#_1 h2{width:360px;height:75px;background-image:url("data:image/png;base64,UklGRvgAAABXRUJQVlA4TOsAAAAvdwAGEBcgEEiS2x9kIYFscn+MQJtAIAl22a3mP+BfAeQ2kiRHAz1lyvhTCaj+OrqskBPVe7zOFKbSzWkJaKwDEf2fgGXTxHW5a+rha85xm7PO0j+3sAIjrSx3OKWFyQRKYc3S6YnCwBozLKxs18h04gPCp4jGxh4nrzMpeY0+ISjSzhU1IDU4s3cIAt17VDDDvTJH9hKiwjLCK1FPkIPHC+aVzsH5mdx7VLC7nSpjRHbgE4HPsB7cRasUpTiTfAA2SJO1wZnnnbXsCU8YUtIuEbSykoTYFZ95DCDT9G3OOutrzvE+57BsM9YFAA==");background-size:contain;background-repeat:no-repeat;margin-top:4px;transform:translateX(200%);border:4px solid #331c1a;background-color:#331c1a;border-radius:25px;animation:k1 .5s cubic-bezier(.175,.885,.32,1.275) forwards;animation-delay:.5s}@keyframes k1{0%{transform:translateX(200%)}100%{transform:translateX(0)}}#_1 ._3{margin-top:90px}#_1 .p{font-size:2rem;text-align:center;margin-top:96px}#_1 a{position:absolute;inset:0;display:flex;justify-content:center;align-items:flex-end;padding-bottom:150px}#_1 a,#_1 a:hover,#_23,._8 a{color:inherit;text-decoration:none;font-weight:700;text-transform:uppercase;transition:transform .2s ease}#_23:hover,a:hover{transform:scale(1.05)}._8 a{color:#fff;text-decoration:underline}._8 a:hover{text-decoration:none}#_23{border:0;color:inherit;background:0 0;font-size:1.2rem;cursor:pointer;text-decoration:underline}._0,._0:visited{font-weight:700;text-decoration:none;color:#feebc9;font-size:1rem;position:absolute;top:8px;right:8px}._0:hover{text-decoration:underline}._12{border:16px solid #000}#_3{display:flex;flex-direction:row;align-items:flex-end;padding:64px;justify-content:space-around;background-color:#3a2520;background-image:conic-gradient(from 135deg,#ffffff0d 0 25%,transparent 0 50%,#0000000d 0 75%,transparent 0);background-size:190px 192px}._8{background:#000;color:#feebc9;width:100%;flex:1;margin-top:auto;border:8px solid #feebc9;box-sizing:border-box;font-size:2.3rem;padding:64px;cursor:pointer;position:relative;z-index:101}._8:not(._4)::after{content:"";display:block;position:absolute;right:16px;bottom:24px;border:24px solid transparent;border-left-color:#feebc9;pointer-events:none;animation:k2 1s steps(1) infinite}._8.end::after{border-color:#feebc9;right:40px}._8._4{cursor:default}@keyframes k2{0%,60%{opacity:1}100%,61%{opacity:0}}.c{animation:k0 1s steps(2) infinite}@keyframes k0{from{background-position:var(--x) var(--y)}to{background-position:var(--tx) var(--ty)}}._10,._11,._9{width:128px;height:128px;background-size:calc(var(--sw) * 8) calc(var(--sh) * 8)}#_16>div._2,._10,._11,._9,div.s{background-image:url("./s.png")}._10.left,._11.left,._9.left{transform:scaleX(-1)}._10{--x:-0;--y:-1152px;--tx:-256px;--ty:-1152px}#_6 ._10{transform:scale(.75);position:absolute;bottom:0}._9{--x:-0;--y:-1408px;--tx:-256px;--ty:-1408px}._11{z-index:110;--x:-256px;--y:-1408px;--tx:-512px;--ty:-1408px}._11._1{--x:-256px;--y:-1536px;--tx:-512px;--ty:-1536px}.c._17{--tx:var(--x);--ty:calc(var(--y) - 256px)}.c._7{--tx:var(--x);--ty:var(--y)}._10._18{--x:-128px;--y:-1280px}._9.r{animation:k0 1s steps(2) infinite,k3 2s ease-in-out infinite alternate,k4 2.4s ease-in-out infinite alternate;transform-origin:50% 70%;z-index:105;position:relative}@keyframes k3{0%,100%,50%{bottom:0}25%{bottom:4px}75%{bottom:-3px}}@keyframes k4{from{filter:drop-shadow(0 0 0 transparent)}to{filter:drop-shadow(0 0 12px #feebc9)}}#_5,._12{background:#331c1a}#_5 ._8{font-size:1rem;padding:0 24px;cursor:default;display:flex;align-items:center;overflow:hidden;position:relative}#_18{width:50%;border-right:8px solid #feebc9;padding-right:8px;height:100%;display:flex;align-items:center}._15 #_18{width:100%;border-right:none}#_5 ._8._15:not(._16)::after{display:block;right:8px;bottom:12px;border-width:12px}._15 #_18+#_19{display:none}#_19{flex:1;padding-left:8px;display:flex;justify-content:space-evenly;align-items:center;position:relative;align-self:stretch}#_19 canvas{cursor:pointer;padding:2px;border:1px dashed transparent}#_19 canvas:hover{border-color:#feebc9}#_19 span{position:absolute;left:2px;top:0;background:#000}#_5 ._8::after{display:none}#_12{margin:0 auto;padding:48px;position:relative;overflow:hidden}#_16{position:relative;border-collapse:collapse;background:#331c1a;display:grid;margin:auto;grid-template-columns:repeat(10,48px);grid-template-rows:repeat(10,48px);column-gap:0;row-gap:0}#_12 .cat{z-index:0}#_13{position:absolute;top:12px;left:0;z-index:10;right:0;text-align:center;font-size:1rem}#_13 b{background-color:#613531;color:#feebc9}#_12>canvas{position:absolute;left:0;top:0;z-index:2}#_12Canvas{z-index:0!important}#_12._20>canvas{pointer-events:none}#_16>div{border:1px solid #feebc933;position:relative;overflow:hidden}#_16>div._2,div.s{background-color:#331c1a;border-color:#331c1a;background-size:calc(var(--sw) * 3) calc(var(--sh) * 3);background-position:var(--bx,0) var(--by,-240px)}div._2.v1{--bx:-48px;--by:-240px}#_17,#_6{position:absolute;right:16px;display:flex;flex-direction:column;gap:16px;justify-content:center;align-items:center;top:16px;color:#feebc9;font-size:1.2rem;font-weight:700}#_6{right:auto;left:16px;justify-content:flex-start;height:560px;min-width:63px}dl{font-size:.9rem}dt{font-weight:700}dd{font-weight:400;margin-left:16px;margin-bottom:24px}div.s{width:48px;height:48px;border:1px dashed #feebc9;cursor:pointer;position:relative}div.s._13{opacity:.5;pointer-events:none}#_12 div.s{position:fixed;left:0;top:0;border-style:solid;pointer-events:none;z-index:100}#_17>div._19,#_17>div:hover{border-style:solid}#_17>div._19{background-image:none}#_17>div._19:before{content:"X";position:absolute;left:0;right:0;text-align:center;font-size:2rem;top:3px}#_17>div:after{content:attr(data-cost);width:16px;height:16px;display:block;position:absolute;right:-20px;line-height:16px;padding:1px}div.Rotaleftus:after{transform:scaleX(-1);right:50px!important}#_20{position:absolute;left:0;top:0;right:0;bottom:0;color:#feebc9;font-size:2rem;text-align:center;z-index:1000;display:none}#_20>div{background-color:#331c1a;border-style:solid;border-width:4px 0;padding:16px 0}#_20>div *{margin:8px;padding:0}#_20.v{display:flex;flex-direction:column;align-items:center;justify-content:center}[data-cs=_1] main{background-image:conic-gradient(from 45deg,#66bfc3 0 50%,#205d61 0 100%)}div.Move,div.Pushtoright,div.Pushtoright:before{transform:scaleX(-1)}div.Pushtoleft,div.Pushtoright{--bx:-144px;--by:-240px}div.Move{--bx:-144px;--by:-576px}._14 #_17 .s:not(:first-of-type){pointer-events:none;border:0}._14 #_19 canvas{display:none}._14 #_17 .s:not(:first-of-type):before,._14 #_19:before{content:"";display:block;position:absolute;width:48px;height:48px;background-image:url("./s.png");background-size:calc(var(--sw) * 3) calc(var(--sh) * 3);background-position:0 -96px;background-color:#331c1a}._14 #_19:before{background-color:#000}.l #_17>div:after,.r #_17>div:after{display:none}.l #_17>div.s:not(._19),.r #_17>div.s:not(._19){opacity:.3;pointer-events:none}.l #_12 canvas,.r #_12 canvas{cursor:pointer}.l #_12 ._5,.l #_12 .cat,.r #_12 ._6,.r #_12 .cat{pointer-events:none}</style><link id=_0 rel=icon href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAo0lEQVR4AZyQ0QmDUAxFbccoXULEQZzUQURcQlxDPR+RS16MPEsPTXOTE/Hb3Hy6/2/3UdS7FbCsC1qTGamAIRaBOiIVTMt47Wh9Nc+iEHANziz8koGFhWBetw8w0LdDY5ep6ZEBNRQCmnrBFumDZvwPBVwABhR6oL1QoANa++tkVQIWPNUC/xTVAp4AifFKgMRIBf6N25L+pgIGkWQ8CpBkHAAAAP//mbFzkQAAAAZJREFUAwA4Kk0hv5lZAAAAAABJRU5ErkJggg=="><style>body[data-cs="_1"] section#_1,body[data-cs="_2"] section#_2,body[data-cs="_5"] section#_5{display:flex}</style><body data-cs=_1><main><section id=_1><div class=_3><h1>Pawfect Stack</h1><h2>Oracle of Chaos</h2></div><p class=p><a href=#_2>Click to start</a></section><section id=_2 class=_12><div id=_3></div><div class=_8></div><a id=_4 class=_0 href=#_5>Skip</a></section><section id=_5><div id=_6><div id=_7><span>Goals</span><dl><dt>Items<dd><span id=_8>0</span>/<span id=_9>10</span><dt>Magic<dd><span id=_10>0</span>/<span id=_11>100</span></dl></div><div class="c _10"></div></div><div id=_12><div id=_13><b>Level <span id=_13Index></span>/3</b></div><canvas id=_12Canvas width=576 height=576></canvas><div id=_16></div></div><div id=_17></div><div class=_8><div id=_18></div><div id=_19></div></div><aside id=_20><div><h2 id=_21></h2><p id=_22></p><button id=_23></button></div></aside></section></main><p class=p id=_24><label><input id=_25 type=checkbox> Enable sounds</label><br><a id=_26 href=#>Reset save</a></p><script>let e=document,t=Math,n=Promise,a=e.body;!function(){let r=[],l={},i=()=>{};function o(e,t={}){l=t,location.hash=e}let s=[["Potion","A small object highly concentrated in magic, but fragile.",4,[[1]],[32,0],0],["Cauldron","The classic tool in any wizard's kit.",6,[[1,1],[1,1]],[16,16],0],["Candle","A source of light and warmth, often used in magical rituals.",3,[[1],[1]],[48,0],0],["Dead Fish","",0,[[1,1],[1,0]],[0,0],1],["Hat","An old hat still highly concentrated in magic.",5,[[0,1],[1,1]],[32,32],0],["Broom","Perfect for wizards on the move, this magic broom is very bulky.",7,[[1,0],[1,1],[0,1]],[32,80],0],["Dried Plant","This thirsty plant needs water and has lost much of its magic.",1,[[1]],[0,112],0],["Dead Mouse","",0,[[1,1]],[0,48],1],["Magic Wand","A very powerful magical tool... and bulky!",6,[[1,1,1,1]],[0,64],0],["Ball of Wool","",0,[[1]],[32,128],1],["Dead Snake","",0,[[0,1],[1,1],[1,0]],[32,128],1],["Grimoires","If they're put next to other grimoires, their magic increases.",2,[[1]],[0,128],0],["Grimalkin","",0,[[1]],[32,176],2]],c="./s.png",u=0;function f(e,n=3,a=null,r=!1,l=[]){let i=16*n,o=e[7],s=o.getContext("2d"),u=new Image;u.src=c;let f=e[3][0].length*i,d=e[3].length*i;f!==o.width&&d!==o.height&&(o.width=f,o.height=d),u.onload=()=>{s.imageSmoothingEnabled=!1;let n=(e[8]??0)%360,o=e[3],c=o.length,f=o[0].length;function d(e,t,n){return 90===n?[f-1-t,e]:180===n?[c-1-e,f-1-t]:270===n?[t,c-1-e]:[e,t]}for(let h=0;h<c;h++)for(let c=0;c<f;c++)if(1===o[h][c]){let o=c*i,f=h*i;s.clearRect(o,f,i,i),l.find(e=>e[1]===c&&e[0]===h)?(s.fillStyle="#ff000099",s.fillRect(o,f,i,i)):a&&(s.fillStyle=a,s.fillRect(o,f,i,i));let[m,g]=d(h,c,n);s.save(),s.translate(o+i/2,f+i/2),s.rotate(n*t.PI/180),s.drawImage(u,e[4][0]+(r?0:16*g),e[4][1]+(r?0:16*m),16,16,-i/2,-i/2,i,i),s.restore()}}}function d(e){return e&&s.findIndex(t=>t[0]===e[0])}function h(e){let n=e[3].reduce((e,t)=>e+t.reduce((e,t)=>e+t,0),0);e[7].style.zIndex=t.max(1,10-n)}function m(e){let n=[...e[t.floor(t.random()*e.length)]];return n[6]=++u,n}function g(t){let n=(t=>e.getElementById(t))("i"+t);return n?._0}function p(e,t,n,a){let r=e[3],l=[];for(let e=0;e<r.length;e++)for(let i=0;i<r[e].length;i++)r[e][i]&&(a+e<0||a+e>=t.length||n+i<0||n+i>=t[0].length||0!==t[a+e][n+i])&&l.push([e,i]);return l}function _(e,t,n,a){let r=e[3],l=t.map(e=>[...e]);for(let t=0;t<r.length;t++)for(let i=0;i<r[t].length;i++)r[t][i]&&(l[a+t][n+i]=e[6]);return l}function y(e,t){let n=t.map(e=>[...e]);for(let t=0;t<n.length;t++)for(let a=0;a<n[t].length;a++)n[t][a]===e&&(n[t][a]=0);return n}function v(e,t){let n=new Set;for(let a=0;a<t.length;a++)for(let r=0;r<t[a].length;r++)if(t[a][r]===e)for(let l=a+1;l<t.length;l++){let a=t[l][r];if(a!==e){if(!a||a<1)break;n.add(a);break}}return Array.from(n)}let w=(()=>{let e=()=>Array.from({length:10},()=>Array(10).fill(0)),t=e();t[0][9]=-1,t[0][0]=-1,t[8][4]=-1,t[8][5]=-1,t[9][3]=-1,t[9][4]=-1,t[9][5]=-1,t[9][6]=-1;let n=e();n[0][4]=-1,n[0][5]=-1,n[1][4]=-1,n[1][5]=-1,n[2][4]=-1,n[2][5]=-1,n[4][0]=-1,n[4][9]=-1,n[5][0]=-1,n[5][9]=-1,n[7][4]=-1,n[7][5]=-1,n[8][4]=-1,n[8][5]=-1,n[9][4]=-1,n[9][5]=-1;let a=e();return a[0][9]=-1,a[0][0]=-1,a[2][1]=-1,a[2][2]=-1,a[2][7]=-1,a[2][8]=-1,a[4][4]=-1,a[4][5]=-1,a[5][4]=-1,a[5][5]=-1,a[7][1]=-1,a[7][2]=-1,a[7][7]=-1,a[7][8]=-1,a[9][9]=-1,a[9][0]=-1,[t,n,a]})(),L=[15,18,20],T=[40,40,40],M="pawfect-stack-storage";function b(){let e=localStorage.getItem(M);try{return JSON.parse(e)||{}}catch(e){return{}}}let k,x={},E=()=>x,A=(e,t)=>{return n=k(x,e,t),x=n,void function(e,t){!function(e){localStorage.setItem(M,JSON.stringify(e))}({...b(),state:t})}(0,x);var n},S={m:!0,b:null,s:0,order:0,chaos:0};function C(e=S,t,n){switch(t){case"_0":return{...e,b:n,s:0};case"_1":return{...e,b:n};case"_2":return{...e,s:e.s+n};case"toggleMuteSounds":return{...e,m:n};case"_3":return{...e,chaos:n};default:return e}}let H=()=>E().b;function I(e){let t=[];return e.forEach((e,n)=>{t[n]=[],e.forEach((e,a)=>{let r=g(e),l=!!r&&11===d(r);t[n][a]=l?1:0})}),t}function P(e,t,n,a){let r=e.length,l=r?e[0].length:0,i=[[1,0],[-1,0],[0,1],[0,-1]],o=[[t,n]];a[t][n]=!0;let s=0;for(;o.length;){let[t,n]=o.pop();s++;for(let[s,c]of i){let i=t+s,u=n+c;i>=0&&i<r&&u>=0&&u<l&&!a[i][u]&&1===e[i][u]&&(a[i][u]=!0,o.push([i,u]))}}return s}let N=()=>{let e=H(),t=new Set;return e.forEach(e=>{e.forEach(e=>{e>0&&t.add(e)})}),Array.from(t)},O=()=>N().filter(e=>{let t=g(e);return t?.[5]<2}).length,R=()=>E().m;function X(){return N().reduce((e,t)=>{let n=g(t);return e+(11===d(n)?0:n?.[2]??0)},0)-(E().s??0)+(()=>{let e=I(H()),t=0,n=e.length,a=n?e[0].length:0,r=Array.from({length:n},()=>Array(a).fill(!1));for(let l=0;l<n;l++)for(let n=0;n<a;n++)if(1===e[l][n]&&!r[l][n]){let a=P(e,l,n,r);t+=a*(a+1)}return t})()}function q(e){if(R())return;let t=new AudioContext,n=t.createBuffer(1,96e3,48e3),a=n.getChannelData(0);for(let t=96e3;t--;)a[t]=e(t);let r=t.createBufferSource();r.buffer=n,r.connect(t.destination),r.start()}function V(){if(R())return;let e=1.05946,n=[13,,13,,10,,13,,6,,10,,13,,,,2,13,10,,13,,6,,8,,6,,5,,,,10,,10,,11,,10,,8,,6,,5,,2,13,10,,8,,6,,5,,6,,8,,10,,,,];V.ctx||(V.ctx=new AudioContext);let a=V.ctx,r=t.max(a.currentTime+.03,0),l=a.createGain();l.gain.value=.85,l.connect(a.destination),n.forEach((n,i)=>{let o=r+.25*i,s=o+.24;if(n){let r=a.createOscillator(),i=a.createGain();r.type="square",r.frequency.setValueAtTime(440*t.pow(e,13-n),o),i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.9,o+.01),i.gain.exponentialRampToValueAtTime(1e-4,s),r.connect(i),i.connect(l),r.start(o),r.stop(s+.01)}if(i%2==0){let n=i%4==0?13:6,r=a.createOscillator(),c=a.createGain();r.type="triangle",r.frequency.setValueAtTime(440*t.pow(e,13-n-12),o),c.gain.setValueAtTime(0,o),c.gain.linearRampToValueAtTime(.6,o+.01),c.gain.exponentialRampToValueAtTime(1e-4,s),r.connect(c),c.connect(l),r.start(o),r.stop(s+.01)}}),clearTimeout(V.timer),V.timer=setTimeout(()=>{"suspended"===a.state&&a.resume(),V()},.25*n.length*1e3)}function $(){q(e=>{if(e>24e3)return null;let n=(e<240?e/240:1)*t.exp(-e/5e3),a=.6*(2*t.random()-1),r=[3e3,4200,5600,7200],l=0;for(let n of r)l+=t.sin(2*t.PI*e*n/48e3)*t.exp(-e/7200);return(.4*a+.2*l)*n})}function j(){q(e=>{let n=48e3;if(e>12e3)return null;let a=t.exp(-e/4e3);return(t.sin(2*t.PI*e*600/n)+.4*t.sin(2*t.PI*e*900/n)+.2*t.sin(2*t.PI*e*(600+e/60)/n))*a*.8})}function B(e){e[7].addEventListener("mouseenter",()=>{e._1||(e.hover=!0,f(e,3,"#fff3"))}),e[7].addEventListener("mouseleave",()=>{e._1||(e.hover=!1,f(e,3,"#331c1a"))})}function D(e,t,n){e[7].onmouseenter=()=>{if(e[10])return;let n=_18.innerHTML,a=e[0],r=e[1];_18.innerHTML=`<span><b>${a}</b>: ${r} ${t?`<i>(${t}: <b>${e[2]??0}</b>)</i>`:""}</span>`,e[7].onmouseleave=()=>{e[10]?e[10]=!1:_18.innerHTML=n}},e[7].onclick=n}function G(e){return new n(t=>{let n=e[7];e[4]=[32,112],e._1=!0,f(e,3,null,!0),n.inert=!0,n.onmouseleave=null,setTimeout(()=>{n.dispatchEvent(new MouseEvent("mouseleave")),n.remove(),A("_1",y(e[6],H())),t()},333)})}async function Y(){let e=!1;do{let t=N();e=!1,await n.all(t.map(async t=>{let a=g(t),r=a[7],[l,i]=a[9],o=!1,s=l,c=y(a[6],H());for(;!o;)s++,o=p(a,c,i,s).length>0;let u=s-l-1,f=u>0;e=e||f;let h=l+u;if(a[9]=[h,i],A("_1",_(a,c,i,h)),!u)return;let m=v(a[6],H());await new n(e=>{let t=0,n=()=>{t++,r.style.top=Number(r.style.top.replace("px",""))+48+"px",t<u?setTimeout(n,300):0===d(a)?($(),G(a).then(e)):e()};setTimeout(n,300)}),f&&await n.all(m.map(e=>{let t=g(e);return new n(e=>{0===d(t)?($(),G(t).then(e)):e()})}))}))}while(e);_8.innerHTML=O(),_10.innerHTML=X()}function W(e,t){e.classList.add("_17"),e.classList.remove("_7"),t.classList.add("_7"),t.classList.remove("_17")}let z=0,J=0;function F(){return O()>=z}function U(){return X()>=J}let K=null,Q=null;function Z(n,a){K=n,Q=a,_20.classList.remove("v"),_16.innerHTML="<div></div>".repeat(100),function(){[..._12.querySelectorAll("canvas")].forEach(e=>{e!==_12Canvas&&e.remove()}),_12Canvas.width=576,_12Canvas.height=576;let t=_12Canvas.getContext("2d"),n=new Image;n.src=c,n.onload=()=>{let a=e.createElement("canvas");a.width=96,a.height=48;let r=a.getContext("2d");r.imageSmoothingEnabled=!1,r.drawImage(n,0,80,32,16,0,0,96,48);let l=t.createPattern(a,"repeat");t.clearRect(0,0,_12Canvas.width,_12Canvas.height),t.setTransform(1,0,0,1,0,0),t.fillStyle=l,t.fillRect(0,0,_12Canvas.width,_12Canvas.height)}}(),_13Index.innerHTML=n+1;let[r,l,i]=((e=0)=>[w[e],L[e],T[e]])(n);r?(_8.innerHTML=0,_10.innerHTML=0,_9.innerHTML=l,_11.innerHTML=i,z=l,J=i,r.flat().forEach((e,n)=>{-1===e&&(_16.children[n].className=`_2 v${t.floor(2*t.random())}`)}),A("_0",r),a(n)):o("_2",{end:!0})}function ee(e,n){return[t.floor(e/n),e%n]}let te=()=>new n(t=>{setTimeout(()=>{e.addEventListener("click",t,{once:!0})},1)}),ne=(e,t)=>new n(n=>{setTimeout(()=>{addEventListener(e,e=>{t?.(e),n(e)},{once:!0})},1)}),ae=(e,t=[],n=[])=>{_18.innerHTML=e,_18.parentNode.classList.add(...t),_18.parentNode.classList.remove(...n)},re=e=>t=>{t.ci=e};function le(){let e=N(),t=H();e.forEach(e=>{let n=g(e);if(!n)return;let a=n[7],[r,l]=n[9],i=y(e,t);a.classList.toggle("_5",0!==p(n,i,l-1,r).length),a.classList.toggle("_6",0!==p(n,i,l+1,r).length)})}function ie(t){t[7]=e.createElement("canvas"),t[7].className="c"+d(t),t[7].id="i"+t[6],t[7]._0=t}function oe(){let e={...m(s.filter(e=>1===e[5]))};e[1]="A gift from me to Mia. It's a bit bulky, but I'm sure she'll love it!",ie(e),f(e,2),_19.append(e[7]),D(e,"magic",async()=>{_19.inert=!0,await e[7].animate([{transform:"translateY(0)"},{transform:"translateY(-300px)"}],{duration:333,easing:"ease-in"}).finished,Le(e,()=>{F()||oe()}),dispatchEvent(new CustomEvent("_0",{detail:e}))})}async function se(e,t=-1){let n=e._0,[a,r]=n[9],l=r+t;n[9][1]=l,e.style.left=48*(l+1)+"px";let i=H(),o=y(n[6],i);return A("_1",_(n,o,l,a)),j(),await Y().then(le),!0}let ce,ue=[()=>{Le(fe(),()=>{a.classList.remove("_14"),_19.inert=!1,ye=!0}),_19.inert=!0},e=>{we(e,"l",async e=>{await se(e),await ve()})},e=>{we(e,"r",async e=>{await se(e,1),await ve()})}];function fe(){return fe.c||(fe.c=(e=>{let t;D(e),B(e);let n=()=>{clearTimeout(t),e[4]=[32===e[4][0]?48:32,e.run?192:176],t=setTimeout(n,e.run?333:1e3),e.s||f(e,3,e.run?null:e.hover?"#fff3":"#331c1a")};return n(),e.animate=n,e})(function(){let t=[...s.find(e=>2===e[5])];return t[6]=++u,t[1]="That's me! Mia can't place items where I am.",t[7]=e.createElement("canvas"),t[7].id="i"+t[6],t[7].className="cat",t[7].style.zIndex=1,t[7]._0=t,h(t),t}())),fe.c}function de({clientX:e,clientY:t}){ce.style.transform=`translate(${e+8}px, ${t+8}px)`}async function he(e,n,a,r){return e[9]=[n,a],e[7].onclick=null,e[7].style.left=48*(a+1)+"px",e[7].style.top=48*(n+1)+"px",f(e,3,"#331c1a"),_12.append(e[7]),h(e),B(e),A("_1",_(e,H(),a,n)),j(),await Y().then(le),e[10]=!r,[_17,_19,_12].forEach(t=>{t.addEventListener("mouseenter",()=>{e[10]=!1},{once:!0})}),11===d(e)&&Object.defineProperty(e,"2",{get:()=>(e=>{let t=H(),n=I(t),a=null;for(let n=0;n<t.length&&!a;n++)for(let r=0;r<(t[n]||[]).length;r++)if(t[n][r]===e){a=[n,r];break}if(!a)return 0;let[r,l]=a,i=n.length,o=i?n[0].length:0;return P(n,r,l,Array.from({length:i},()=>Array(o).fill(!1)))+1})(e[6])}),!!F()&&(((e,n)=>{_21.innerHTML=e?"Congratulations!":"Oops...",_22.innerHTML=n,_23.innerHTML=e?"Next":"Retry";let a=K+1;e&&A("_3",a),_23.onclick=()=>Z(e?a:K,Q),_20.classList.add("v"),e?(()=>{if(R())return;let e=new AudioContext,n=e.createGain();n.connect(e.destination),[[13,0],[17,.12],[20,.24],[25,.36],[13,.48],[17,.48],[20,.48]].forEach(([a,r])=>{let l=e.createOscillator(),i=e.createGain();l.type="square",l.frequency.setValueAtTime(440*t.pow(1.05946,13-a),r),i.gain.setValueAtTime(1,r),i.gain.exponentialRampToValueAtTime(.001,r+.25),l.connect(i),i.connect(n),l.start(r),l.stop(r+.3)})})():(()=>{if(R())return;let e=new AudioContext,n=e.createGain();n.connect(e.destination),[[19,0],[17,.12],[15,.24],[13,.36],[21,.6]].forEach(([a,r])=>{let l=e.createOscillator(),i=e.createGain();l.type="square",l.frequency.setValueAtTime(440*t.pow(1.05946,13-a),r),i.gain.setValueAtTime(1,r),i.gain.exponentialRampToValueAtTime(.001,r+.4),l.connect(i),i.connect(n),l.start(r),l.stop(r+.5)})})()})(!U(),U()?"Mia managed to reach her magic goal despite your efforts to stop her...":"You prevented Mia from reaching the required magic concentration, well done!"),!0)}async function me(){let e=t.floor(2*t.random())?m([s[0],s[0],s[0],s[6],s[6],s[11]]):m(s.filter(e=>0===e[5]));ie(e);let n=function(e){let n=H(),a=[];for(let t=0;t<n.length;t++)for(let r=0;r<n[t].length;r++)0===p(e,n,r,t).length&&a.push([t,r]);if(0===a.length)return!1;if(0===d(e)){let e=a.filter(([e,t])=>e===n.length-1||0!==n[e+1][t]);if(e.length>0)return e[0]}else if(6===d(e)){let e=a.filter(([e,t])=>[[e-1,t-1],[e-1,t],[e,t-1],[e-1,t],[e,t-1]].some(([e,t])=>e>=0&&t>=0&&e<n.length&&t<n[0].length&&0===n[e][t]));if(e.length>0)return e[t.floor(t.random()*e.length)]}if(11===d(e)){let e=a.map(([e,t])=>{let a=0;for(let r=e-1;r<=e+1;r++)for(let e=t-1;e<=t+1;e++)if(r>=0&&e>=0&&r<n.length&&e<n[0].length){let t=n[r][e];0!==t&&11===d(g(t))&&a++}return[e,t,a]});if(e.sort((e,t)=>t[2]-e[2]),e.length>0)return[e[0][0],e[0][1]]}return a[t.floor(t.random()*a.length)]}(e);if(!n)return me();_18.innerHTML=`Mia has placed a new item: ${e[0]}!`,D(e,"magic"),await he(e,n[0],n[1],!0)}let ge=async()=>{let e=fe();e.run=!0,e.animate(),e[7].inert=!0,a.classList.add("_14"),_18.innerHTML="Mia has cast a Hydravo on myself, run!!!",A("_1",y(e[6],H())),q(e=>{let n=32e3;if(e>n)return null;let a,r=5760,l=(e<1440?e/1440:1)*t.exp(-e/11e3)*(e<n-r?1:1-(e-(n-r))/r),i=1200,o=t.pow(2,20/1200);if(e<i)a=880*(1+e/i*(o-1));else{let n=880,r=(e-i)/30800,l=t.pow(r,1.8);a=880*o*t.pow(n/(880*o),l)}let s=2*t.PI*e*a/48e3,c=(t.sin(s)+t.sin(2*s)*(.4*t.exp(-e/4800))+t.sin(3*s)*(.22*t.exp(-e/(.07*48e3)))+.015*(2*t.random()-1)*t.exp(-e/960))*l*.9;return t.tanh(1.3*c)}),e[7].animate([{transform:"translate(0, 0)"},{transform:"translate(450px, -100px)"}],{duration:1500,easing:"ease-in"}).finished.then(()=>{e.run=!1,e[7].inert=!1,e[7].remove()}),await Y().then(le)};async function pe(){let e=N(),n=[];if(e.forEach(e=>{let t=g(e);1!==t?.[5]||t?.[10]||n.push(t)}),0===n.length)return!1;let a=n[t.floor(t.random()*n.length)];return _18.innerHTML=`Mia has cast a Ejectum on a ${a[0]}.`,await G(a),q(e=>t.sin(e%400/400*2*t.PI)*t.exp(-e/8e3)*2.2),await Y().then(le),!0}let _e=async()=>{let n=H(),a=[];for(let e=0;e<n.length;e++)for(let t=0;t<n[e].length;t++){let r=n[e][t];if(r>0){let e=g(r);6===d(e)&&a.push(e[7])}}if(0===a.length)return!1;let r=a[t.floor(t.random()*a.length)];_18.innerHTML="Mia has cast Hydravo on a dried plant, making it bloom!";let[l,i]=function(t,n){let a,r=(n,a,r,l)=>["Carnivorous Plant","By watering the dried plant, it"+n,a,r,l,0,t._0[6],e.createElement("canvas")],l=r(" has fully grown and regained all its magic!",9,[[1,1],[0,1]],[0,96]),i=r(" has grown a bit and regained some of its magic.",6,[[1],[1]],[16,96]),o=r(" tried to grow but something blocked it...",3,[[1]],[16,112]),s=y(t._0[6],n);t.dispatchEvent(new MouseEvent("mouseleave")),[[l,[-1,-1]],[i,[-1,-0]],[o,[0,0]]].some(([e,[n,r]])=>(e[7]._0=e,e[9]=[...t._0[9]],e[9][0]+=n,e[9][1]+=r,!p(e,s,e[9][1],e[9][0]).length&&(a=e,!0)));let c=_(a,s,a[9][1],a[9][0]);return t.replaceWith(a[7]),a[7].id=t.id,a[7].style.left=48*(a[9][1]+1)+"px",a[7].style.top=48*(a[9][0]+1)+"px",[c,a]}(r,n);return q(e=>(2*t.random()-1)*t.sin(e/50)*t.exp(-e/5e3)),B(i),D(i,"magic"),h(i),A("_1",l),f(i,3),_10.innerHTML=X(),!0},ye=!1;async function ve(e){let n=[me,ye?_e:ge,pe,_e,me,me],a=n[e??t.floor(t.random()*n.length)],r=await a();if(ye=!1,!1===r)return me()}function we(e,t,n){let r=!1;function l(){a.classList.remove(t),a.removeEventListener("mousemove",de),a.removeEventListener("click",i),e[7].classList.remove("_19"),ce?.remove()}async function i(e){if(!a.classList.contains(t)||r)return;r=!0;let{tagName:i}=e.target;if(e.target._0&&"CANVAS"===i&&!1!==await n(e.target))return l(),void(_19.inert=!1);r=!1}if(a.classList.contains(t))return l(),void(_19.inert=!1);ce=e[7].cloneNode();let{left:o,top:s}=e[7].getBoundingClientRect();_12.append(ce),de({clientX:o,clientY:s}),a.classList.add(t),a.addEventListener("mousemove",de),a.addEventListener("click",i),e[7].classList.add("_19"),_19.inert=!0}function Le(e,t){f(e,3);let n=e[7];n.style.left="240px",n.style.top="240px",n.style.zIndex=100,_12.append(n),_17.inert=!0,e.s=!0;let a=!1;_12.classList.add("_20"),_16.onmousemove=t=>{_19.inert=2===e[5];let r=Array.prototype.indexOf.call(t.target.parentNode.children,t.target),l=_16.getBoundingClientRect(),i=t.target.getBoundingClientRect(),o=n.style.left,s=n.style.top;if(n.style.left=i.left-l.left+48+"px",n.style.top=i.top-l.top+48+"px",o===n.style.left&&s===n.style.top)return;let[c,u]=ee(r,10);e[9]=[c,u],n.getContext("2d").clearRect(0,0,n.width,n.height);let d=p(e,H(),u,c);a=0===d.length,_16.style.cursor=a?"grabbing":"not-allowed",f(e,3,"#fff3",!1,d)},_16.onclick=async n=>{if(!a)return;_19.inert=!0,_12.classList.remove("_20"),_19.onmouseenter=null,_16.onclick=null,_16.onmousemove=null,_16.style.cursor="default";let r=Array.prototype.indexOf.call(n.target.parentNode.children,n.target),[l,i]=ee(r,10);e.s=!1;let o=await he(e,l,i);if(t?.(),!o){_19.inert=!1,_17.inert=!1;let t=new CustomEvent("_1",{detail:e});dispatchEvent(t),ve(t.ci)}},_19.onmouseenter=1===e[5]?null:()=>{_19.onmouseenter=null,async function(e){_12.classList.remove("_20"),_16.onclick=null,_16.onmousemove=null,_16.style.cursor="default",_17.inert=!1,e.s=!1,await e[7].animate([{transform:"translateY(0)"},{transform:"translateY(300px)"}],{duration:333,easing:"ease-in"}).finished,f(e,2),e[7].style.removeProperty("left"),e[7].style.removeProperty("top"),_19.append(e[7])}(e)}}var Te={f:["0000100001","0000110011","0000111111","0000121121","001112112111","0000112111","0001111111100011","0000011110000001","0000011111000001","0000011111000001","0000011111100001","0000011111111111","0000011111111111","0000001111111111"],async l(e,t,a){e.classList.remove("end"),_3.innerHTML='<div class="_9 c"></div><div class="_10 c"></div><div class="_11 c"></div>';let r=_3.querySelector("._9"),l=_3.querySelector("._10"),i=_3.querySelector("._11");if(a){i.style.opacity=0;let a=["Master! Grimalkin keeps bothering me!","Don't worry, you did a great job despite him! The concentration of magic in the cellar is just enough! Hehehe...","What's happening, Master?"],o=E().order>=3;o?a.push("Meow!*<br>*<i>(The Master used Mia to accumulate magic, become overpowered and dominate the world!)","Meow...*<br>*<i>(I tried everything to prevent Mia from helping him without her knowing...)","Meow!!!*<br>*<i>(Attack! We must stop him!)","","Master... ? Are you alright? Grimalkin jumped on you... That won't help with your allergy to his fur!"):a.push("Meow...*<br>*<i>(Oh no, it's too late!)");let s=-1;return new n(()=>{let n=()=>{switch(s++,e.innerHTML=a[s],s){case 0:l.classList.add("left"),t(l,r);break;case 1:t(r,l);break;case 2:r.classList.add("_7","r"),r.classList.remove("_17"),l.classList.add("_18");break;case 3:i.classList.add("_1"),i.style.opacity=1,i.animate([{transform:"translateX(100%) scaleX(-1)"},{transform:"translateX(0) scaleX(-1)"}],{duration:1200,easing:"linear",fill:"forwards"}).finished.then(()=>{i.classList.remove("_1")});break;case 6:i.classList.add("_1"),i.style.animationDuration="333ms",i.animate([{transform:"translateX(0) scaleX(-1)"},{transform:"translateX(-300%) scaleX(-1)"}],{duration:600,easing:"linear",fill:"forwards"}).finished.then(()=>{r.classList.remove("r"),i.classList.remove("_1"),i.style.removeProperty("animationDuration"),r.animate([{transform:"translateX(0) rotate(0)"},{transform:"translateX(-300%) rotate(360deg"}],{duration:600,easing:"ease-in",fill:"forwards"})})}let c=s===a.length-1;e.onclick=c?()=>{e.classList.add("_4"),e.innerHTML=o?"You've finished BOTH <b>Pawfect Stack</b> games! Thank you so much, I hope you enjoyed the experience! :D":'You\'ve finished <b>Pawfect Stack: Oracle of Chaos</b>! To discover the true ending, also complete <a target="_parent" href="https://js13kgames.com/2025/games/pawfect-stack-oracle-of-order"><b>Pawfect Stack: Oracle of Order</b></a>!'}:n,c&&e.classList.add("end")};n()})}let o=["Meow!","My pet human asked his apprentice to tidy up the cellar.","The cellar is MY territory! And I can't let anyone set foot in it!!!","The little witch doesn't seem very skilled, but she's ambitious...","It's just you and me now, Mia!","Meow!!"],s=-1;function c(){_3.style.removeProperty("transform")}return new n(n=>{let a=()=>{switch(s++,e.innerHTML=o[s],s){case 0:l.classList.add("left"),i.classList.add("left"),t(r,l),r.style.display="none";break;case 1:l.classList.remove("left","_7"),l.animate([{transform:"translateX(0)"},{transform:"translateX(500%)"}],{duration:3e3,easing:"linear",fill:"forwards"});break;case 2:case 4:_3.style.transform="scale(1.5) translateX(-120px)";break;case 3:c();break;case 5:c(),i.classList.add("_1"),i.animate([{transform:"translateX(0)"},{transform:"translateX(400%)"}],{duration:3e3,easing:"linear",fill:"forwards"}).finished.then(n)}let u=s===o.length-1;e.onclick=u?n:a,u&&e.classList.add("end")};a()})},s:function(t){_19.inert=!1,_17.inert=!1,_19.innerHTML="<span>Reserve</span>",me(),oe(),oe(),oe(),_17.innerHTML="",_17.append(e.createTextNode("Tricks")),[["Move","Place me wherever you want in the cave to disturb Mia."],["Push to left","Push an object to the left"],["Push to right","Push an object to the right"]].forEach((t,n)=>{let a=e.createElement("div");a.className=`${t[0].replaceAll(" ","")} s`,_17.append(a),t[7]=a,D(t,"",()=>{ue[n](t)})}),async function(e){if(0===e){_17.style.display="none",_7.style.display="none";let e,t=_17.querySelectorAll(".s");t.forEach(e=>{e.style.display="none"}),ae("Mia has already place an item in the cellar... We have to stop her!",["_15"]),await te(),_17.style.removeProperty("display"),t[0].style.removeProperty("display"),ae('I have to be in the cellar: click on the "Move" trick on the upper right and place me in the cellar.',["_16"]);do{let t=await ne("_1",re(0));e=t?.detail}while(2!==e?.[5]);_7.style.removeProperty("display"),_17.inert=!0,ae("The game ends when the required number of items is in the cellar; we win if Mia's magic goal is NOT reached. See at the top left of the screen!",[],["_16"]),await te(),ae('She has already placed two items and her magic score increases... What if we send her a little "gift"? Click to see my own items!',["_15"]),await te(),ae("My reserve is on the right. Click on an item to select it. It'll be sent to the cellar and will bother Mia!",[],["_15"]);let{detail:n}=await ne("_0");ae(`${n[0]}? Ok then! It's appeared in the cellar. Move it with your mouse and click to place it. Caution: gravity will affect it!`,["_15","_16"]),await ne("_1",re(1)),_17.inert=!1,ae('Hydravo! Mia has cast a water spell on me and I had to run away! When this happens, please use the "move" trick to make me come back...'),await ne("_1",re(2)),t.forEach(e=>{e.style.removeProperty("display")}),ae('Thanks! I have other tricks up my sleeve... but Mia too! She has cast her Ejectum spell and our "gift" has disappeared...',[],["_16"]),await te(),ae("Now you know everything you need to know to prevent Mia from tidying the cellar properly!"),await te()}else a.classList.add("_14");ae("Stop Mia from tidying the cellar properly!",[],["_15"])}(t)}};let Me=Te;(()=>{!function(e,t){k=e,x=t}(C,b().state||S),function(t){!function(t){let n=e.createElement("canvas");n.width=16,n.height=16;let a=n.getContext("2d"),r=["transparent","#331c1a","#FEEBC9"];t.forEach((e,t)=>{e.split("").forEach((e,n)=>{a.fillStyle=r[e],a.fillRect(n+2,t,1,1)})}),_0.href=n.toDataURL()}(t),_25.checked=!R(),_25.onchange=e=>function(e){A("toggleMuteSounds",e),e?(V.ctx&&(V.ctx.close(),V.ctx=null),clearTimeout(V.timer),V.timer=null):V()}(!e.currentTarget.checked),_26.onclick=e=>{confirm("Are you sure you want to reset the game save?")?A("_3",0):e.preventDefault()}}(Me.f);let t=!1;!function(t){i=t;let n=[];for(let t of e.querySelectorAll("section[id]"))r.push(t.id),n.push(`body[data-cs="${t.id}"] section#${t.id}`);function s(){!function(e){let t=function(e){return r.includes(e)}(e)?e:"_1";t!==a.dataset.cs&&(a.dataset.cs&&(a.dataset.prevSection=a.dataset.cs),!1!==i({nextSection:t,cs:a.dataset.prevSection,vars:l})?a.dataset.cs=t:history.forward())}(location.hash.substring(1))}e.head.insertAdjacentHTML("beforeend",`<style>${n.join(",")+"{display:flex;}"}</style>`),addEventListener("hashchange",s),a.addEventListener("click",e=>{"A"===e.target.tagName.toUpperCase()&&(l=JSON.parse(JSON.stringify(e.target.dataset)))}),o("_1"),s()}(async({cs:n,nextSection:a,vars:r})=>{t||"_1"!==n||(t=!0,V()),"_2"===a&&(await async function(t,n){n&&_4.remove(),await t(e.querySelector("#_3 + ._8"),W,n)}(Me.l,r.end),o("_5")),"_5"===a&&Z(E().chaos??0,Me.s)})})()}()</script>