<!doctype html><title>13-Bricks - js13kGames 2012</title><style>.bg{background-color:#000}canvas.one{background-color:#000}</style><body class=bg><div width=680 height=600 id=canvasWrapper align=center><canvas width=680 height=600 id=stage class=one></canvas></div><script>var S,C,f,e,v,m=190,b=80,y=18,O=10,o=new Object,N=36,V=!1,G=!1,c=!1,q=new Array,U=0,H=5,Y=!1,d=!1,s=0,X=0,z=2,E=0,K=0,Q=new Image,A=!1,J=!1,Z="",R=0,P=!1,$=0,tt=1500,et=0,ot=0,rt=0,at=0,h=(ShapeStateEnum={ADD:0,CLEAR:1,BRICK:2,MOVE_DOWN:3,MOVE_LEFT:4,MOVE_RIGHT:5,ROTATE:6,NONE:7},MoveStateEnum={OUT_OF_COLS:0,OUT_OF_ROWS:1,CAN_MOVE:2,CANNOT_MOVE:3},new Object),p=(h.pat=new Array,h.pat[0]=[[1,1],[1,1]],h.currPat=0,h.pivotRow=0,h.pivotCol=0,h.isFalling=!0,h.row=0,h.col=0,new Object),r=(p.pat=new Array,p.pat[0]=[[2,1,0],[0,1,1]],p.pat[1]=[[0,1],[2,1],[1,0]],p.currPat=0,p.pivotRow=0,p.pivotCol=0,p.isFalling=!0,p.row=0,p.col=0,new Object),a=(r.pat=new Array,r.pat[0]=[[0,1,1],[1,1,0]],r.pat[1]=[[1,0],[1,1],[0,1]],r.currPat=0,r.pivotRow=0,r.pivotCol=0,r.isFalling=!0,r.row=0,r.col=0,new Object),g=(a.pat=new Array,a.pat[0]=[[0,1],[0,1],[1,1]],a.pat[1]=[[1,1,1],[0,0,1]],a.pat[2]=[[1,1],[1,0],[1,0]],a.pat[3]=[[1,0,0],[1,1,1]],a.currPat=0,a.pivotRow=0,a.pivotCol=0,a.isFalling=!0,a.row=0,a.col=0,new Object),u=(g.pat=new Array,g.pat[0]=[[1,0],[1,0],[1,1]],g.pat[1]=[[0,0,1],[1,1,1]],g.pat[2]=[[1,1],[0,1],[0,1]],g.pat[3]=[[1,1,1],[1,0,0]],g.currPat=0,g.pivotRow=0,g.pivotCol=0,g.isFalling=!0,g.row=0,g.col=0,new Object),l=(u.pat=new Array,u.pat[0]=[[2,1,1,1]],u.pat[1]=[[2],[1],[1],[1]],u.currPat=0,u.pivotRow=0,u.pivotCol=0,u.isFalling=!0,u.row=0,u.col=0,new Object),n=(l.pat=new Array,l.pat[0]=[[1,1,1],[0,1,0]],l.pat[1]=[[1,0],[1,1],[1,0]],l.pat[2]=[[0,1,0],[1,1,1]],l.pat[3]=[[0,1],[1,1],[0,1]],l.currPat=0,l.pivotRow=0,l.pivotCol=0,l.isFalling=!0,l.row=0,l.col=0,new Object),w=(n.pat=new Array,n.pat[0]=[[1]],n.currPat=0,n.pivotRow=0,n.pivotCol=0,n.isFalling=!0,n.row=0,n.col=0,new Object),M=(w.pat=new Array,w.pat[0]=[[1,1]],w.pat[1]=[[1],[1]],w.currPat=0,w.pivotRow=0,w.pivotCol=0,w.isFalling=!0,w.row=0,w.col=0,new Object),T=(M.pat=new Array,M.pat[0]=[[1,1,1]],M.pat[1]=[[1],[1],[1]],M.currPat=0,M.pivotRow=0,M.pivotCol=0,M.isFalling=!0,M.row=0,M.col=0,new Object),F=(T.pat=new Array,T.pat[0]=[[1,0],[1,1]],T.pat[1]=[[0,1],[1,1]],T.pat[2]=[[1,1],[0,1]],T.pat[3]=[[1,1],[1,0]],T.currPat=0,T.pivotRow=0,T.pivotCol=0,T.isFalling=!0,T.row=0,T.col=0,new Object),I=(F.pat=new Array,F.pat[0]=[[0,1,0],[1,1,1],[0,1,0]],F.currPat=0,F.pivotRow=0,F.pivotCol=0,F.isFalling=!0,F.row=0,F.col=0,new Object),it=(I.pat=new Array,I.pat[0]=[[1,0,1],[1,1,1]],I.pat[1]=[[1,1],[0,1],[1,1]],I.pat[2]=[[1,1,1],[1,0,1]],I.pat[3]=[[1,1],[1,0],[1,1]],I.currPat=0,I.pivotRow=0,I.pivotCol=0,I.isFalling=!0,I.row=0,I.col=0);function lt(t,e){return+new Date-e>t}function t(){for(v=e=null,c=G=V=!(N=36),d=Y=!(H=5),z=2,Z="",P=J=A=!(K=1),at=rt=ot=et=$=R=E=X=s=U=0,Bt(),i=0;i<y;i++)for(q[i]=!1,j=0;j<O;j++)f[i][j].isBricked=!1,f[i][j].isOccupied=!1}function nt(t){if(!0!==P)switch(function(){for(i=0;i<W.length;i++)!0===W[i].enabled&&W[i].gameState===s&&(W[i].state=0)}(),t.keyCode){case 87:case 38:c||d||(dt(ShapeStateEnum.ROTATE),st(ShapeStateEnum.ROTATE));break;case 83:case 40:c||d||(dt(ShapeStateEnum.MOVE_DOWN),st(ShapeStateEnum.MOVE_DOWN));break;case 65:case 37:c||d||(dt(ShapeStateEnum.MOVE_LEFT),st(ShapeStateEnum.MOVE_LEFT));break;case 68:case 39:if(c||d)return;dt(ShapeStateEnum.MOVE_RIGHT),st(ShapeStateEnum.MOVE_RIGHT)}}function ct(){if(!c)if(n=+new Date,fps=0!=n-it?1e3/(n-it):60,it=n,n=fps,Math.ceil(n*(z/25)),0===s)lt(150,ot)&&(ot=+new Date,360<(X+=10)&&(X=0),C.fillStyle="#000",C.fillRect(0,0,S.width,S.height),a=X,l="#222233",C.save(),C.translate(450,190),C.rotate((35+a)*Math.PI/180),x(p,0,0,30,30,l),C.restore(),C.save(),C.translate(540,190),C.rotate((90+a)*Math.PI/180),x(u,0,0,20,20,l),C.restore(),C.save(),C.translate(450,320),C.rotate((15+a)*Math.PI/180),x(I,0,0,30,30,l),C.restore(),C.save(),C.translate(580,270),C.rotate((215+a)*Math.PI/180),x(g,0,0,30,30,l),C.restore(),C.save(),C.translate(610,320),C.rotate((76+a)*Math.PI/180),x(h,0,0,30,30,l),C.restore(),C.save(),C.translate(450,190),C.rotate(35*Math.PI/180),x(p,0,0,30,30,"#feff34"),C.restore(),C.save(),C.translate(540,190),C.rotate(90*Math.PI/180),x(u,0,0,20,20,"#cdfe30"),C.restore(),C.save(),C.translate(450,320),C.rotate(15*Math.PI/180),x(I,0,0,30,30,"#0362d0"),C.restore(),C.save(),C.translate(580,270),C.rotate(215*Math.PI/180),x(g,0,0,30,30,"#23ffcc"),C.restore(),C.save(),C.translate(610,320),C.rotate(76*Math.PI/180),x(h,0,0,30,30,"#df0000"),C.restore(),C.drawImage(Q,94,64),ft(20,200,380,160,"rgba(56,56,76,0.5)",Ft,"#f6f5cc",17,!1),ft(20,430,380,110,"rgba(56,56,76,0.5)",It,"#f6f5cc",17,!1),C.strokeStyle="#070",C.strokeRect(0,0,S.width,S.height),kt());else if(!d&&!0!==Y)if(!0!==P)if(!0===V){var t=q;for(i=0;i<t.length;i++)if(!0===t[i]){var e=0;for(j=0;j<O&&!(!0===f[i][j].isBricked&&(e++,f[i][j].isOccupied=!1,f[i][j].isBricked=!1,2<=e));j++);if(0===e){G=!(V=!1);break}}_()}else if(!0===G){var o=q;for(i=o.length-1;0<i;i--)if(!0===o[i]&&0!==i){var r=-1;for(k=i;0<=k;k--)if(!1===o[k]){r=k;break}if(0<=r){for(j=0;j<O;j++)!0===f[r][j].isBricked&&(f[i][j].isBricked=f[r][j].isBricked,f[r][j].isBricked=!1,f[i][j].isOccupied=f[r][j].isOccupied,f[r][j].isOccupied=!1,f[i][j].colorStyle=f[r][j].colorStyle,f[r][j].colorStyle=-1);o[i]=!1,o[r]=!0}}G=!1,J&&(A=!(J=!1)),_()}else!0!==A?(Math.ceil(n*(N/25)),lt(tt,et)&&(et=+new Date,dt(ShapeStateEnum.MOVE_DOWN),st(ShapeStateEnum.MOVE_DOWN)),q=function(t){var e=new Array,o=0,r=0;for(i=0;i<18;i++){for(j=r=0;j<10;j++)!0===t[i][j].isBricked&&r++;r===O?(++U>=H&&(K++,J=!(U=0),(tt-=100)<100)&&(tt=100),e[i]=!0,P=!0,o++):e[i]=!1}return 1===o?E+=250:2===o?E=E+250+500:3===o?E=E+250+1e3:4===o&&(E=E+250+2e3),e}(f),!0===function(){for(j=0;j<O;j++)if(!0===f[0][j].isBricked)return!0;return!1}()&&(c=!0,s=3,Ct(),mt("GAME OVER","Your score is: "+E),kt())):lt(100,rt)&&_();else _();var a,l,n}function dt(t){Y=!0,null!==o&&null!==e?(gt(e,o),t===ShapeStateEnum.MOVE_DOWN?e.row+=1:t===ShapeStateEnum.MOVE_LEFT?(--e.col,e.col<0&&(e.col+=1)):t===ShapeStateEnum.MOVE_RIGHT?(e.col+=1,e.col+e.pat[e.currPat][0].length>O&&--e.col):t===ShapeStateEnum.ROTATE&&(t=e.pat.length,e.currPat=(e.currPat+1)%t,e.col+e.pat[e.currPat][0].length>O&&(e.col=O-e.pat[e.currPat][0].length),e.row+e.pat[e.currPat].length>y&&(e.row=y-e.pat[e.currPat].length),e.col<0)&&(e.col=0)):pt()}function st(t){(t=function(t,e){if(null===t)return MoveStateEnum.CANNOT_MOVE;aGridCellRow=t.row,aGridCellCol=t.col;for(var o=t.pat[t.currPat],r=0;r<o.length;r++)for(var a=o[r],i=0;i<a.length;i++)if(0<o[r][i]){if(gridPosRow=aGridCellRow+(r-t.pivotRow),gridPosCol=aGridCellCol+(i-t.pivotCol),gridPosRow<0||gridPosRow>=y)return MoveStateEnum.OUT_OF_ROWS;if(gridPosCol<0||gridPosCol>=O)return MoveStateEnum.OUT_OF_COLS;if(!0===f[gridPosRow][gridPosCol].isBricked)return e===ShapeStateEnum.MOVE_DOWN?MoveStateEnum.OUT_OF_ROWS:MoveStateEnum.CANNOT_MOVE}return MoveStateEnum.CAN_MOVE}(e,t))===MoveStateEnum.CAN_MOVE?(D(o,o.row,o.col,ShapeStateEnum.CLEAR),D(e,e.row,e.col,ShapeStateEnum.ADD)):t===MoveStateEnum.OUT_OF_ROWS?(D(o,o.row,o.col,ShapeStateEnum.BRICK),e=null,pt(),D(e,e.row,e.col,ShapeStateEnum.ADD)):t===MoveStateEnum.OUT_OF_COLS?(D(o,o.row,o.col,ShapeStateEnum.CLEAR),D(o,o.row,o.col,ShapeStateEnum.ADD)):t===MoveStateEnum.CANNOT_MOVE&&(gt(o,e),D(o,o.row,o.col,ShapeStateEnum.CLEAR),D(o,o.row,o.col,ShapeStateEnum.ADD)),Y=!1,_()}function _(){C.clearRect(0,0,S.width,S.height);var t,e,o,r,a,l,n=m,c=b,d=480/18;for(m=n,b=c,C.fillStyle="#888899",C.fillRect(m-4,b-4,308,490),C.fillStyle="#222222",C.fillRect(m,b,300,484),i=0;i<18;i++)for(j=0;j<10;j++){var s=n+30*j,h=c+d*i;C.lineWidth=.5,C.strokeStyle="#333333",C.strokeRect(s,h,30,d)}for(i=0;i<18;i++)for(j=0;j<10;j++)s=n+30*j,h=c+d*i,!0!==f[i][j].isBricked&&!0!==f[i][j].isOccupied||(t=s,e=h,o=d,r=f[i][j].colorStyle,ut("rgba(0,0,0,0.5)"),o=C.createLinearGradient(t+1,e+1,t+30,e+o),0===r?(o.addColorStop(0,"rgba(228,125,125,1)"),o.addColorStop(.75,"rgba(118,20,20,1)"),o.addColorStop(1,"rgba(118,15,15,0.8)")):1===r?(o.addColorStop(0,"rgba(125,228,125,1)"),o.addColorStop(.75,"rgba(25,128,25,1)"),o.addColorStop(1,"rgba(25,128,25,0.8)")):2===r?(o.addColorStop(0,"rgba(125,125,228,1)"),o.addColorStop(.75,"rgba(45,45,148,1)"),o.addColorStop(1,"rgba(45,45,148,0.8)")):3===r?(o.addColorStop(0,"rgba(228,125,125,1)"),o.addColorStop(.75,"rgba(128,25,25,1)"),o.addColorStop(1,"rgba(128,25,25,0.8)")):4===r?(o.addColorStop(0,"rgba(125,228,228,1)"),o.addColorStop(.75,"rgba(28,125,125,1)"),o.addColorStop(1,"rgba(28,125,125,0.8)")):5===r?(o.addColorStop(0,"#dfd43e"),o.addColorStop(.75,"rgba(130,125,28,1)"),o.addColorStop(1,"rgba(130,125,28,0.8)")):6===r?(o.addColorStop(0,"rgba(230,125,230,1)"),o.addColorStop(.75,"rgba(125,28,125,1)"),o.addColorStop(1,"rgba(125,28,125,0.8)")):(o.addColorStop(0,"rgba(200,200,125,1)"),o.addColorStop(.75,"rgba(128,125,125,1)"),o.addColorStop(1,"rgba(128,125,125,0.8)")),C.lineWidth=.5,C.fillStyle=o,C.fillRect(t,e,30,30),C.lineWidth=.5,C.strokeStyle="#220000",C.strokeRect(t,e,30,30),wt());for(St(m-8,b-8,316,500,20,"#555555",12,!0,!0,"rgba(170,170,170,1)","rgba(85,85,85,1)"),C.save(),C.scale(.6,.6),C.drawImage(Q,314,4),C.scale(1,1),C.restore(),kt(),vt(5,80,125,30,"Level","rgba(250,250,250,1)",K,"rgba(0,0,0,1)",!1),vt(5,170,125,30,"Score","rgba(250,250,250,1)",E,"rgba(0,0,0,1)",!1),vt(535,80,125,100,"Next","rgba(250,250,250,1)","","rgba(0,0,0,1)",!0),vt(5,250,125,100,"Your Best","rgba(250,250,250,1)","","rgba(0,0,0,1)",!0),i=0;i<xt.length;i++)B(10,276+20*i,i+1+". "+xt[i],"Bold 16px Arial","rgba(250,250,250,1)",!1,!1,"start");if(x(v,565,100,20,20,"#aaaaaa"),!0===P&&lt(2,at)){at=+new Date;var p=q;if(!1!==P)if(3<++$)P=!1,V=!($=0),ct();else{var g=480/y;for(i=0;i<p.length;i++)if(!0===p[i])for(j=0;j<O;j++){var u=m,w=b+g*i;C.fillStyle="rgba(200,200,200,"+$/20+")",C.fillRect(u,w,300,g)}}}!0===A&&(Z="Level Up!",rt=+new Date,R++,a=Z,1!=!A)&&(10<R?(R=0,A=!1):(l=1,l=(l=4<R?1-R/10:l).toFixed(1),B(m+150,b+240,a,"Bold 25px Arial","rgba(250, 250, 250, "+l+")",!1,!1,"center")))}function ht(){var t=K<3?Math.floor(7*Math.random()):Math.floor(13*Math.random()),e=Math.floor(7*Math.random());return 0===t?(p.colorStyle=e,p):1===t?(u.colorStyle=e,u):2===t?(l.colorStyle=e,l):3===t?(r.colorStyle=e,r):4===t?(g.colorStyle=e,g):5===t?(a.colorStyle=e,a):6===t?(h.colorStyle=e,h):7===t?(n.colorStyle=e,n):8===t?(w.colorStyle=e,w):9===t?(M.colorStyle=e,M):10===t?(T.colorStyle=e,T):11===t?(F.colorStyle=e,F):12===t?(I.colorStyle=e,I):(p.colorStyle=e,p)}function pt(){null===v&&(v=ht()),e=v,v=ht(),e.row=0,randGridCol=Math.floor(Math.random()*(O-e.pat[e.currPat][0].length)),e.col=randGridCol,gt(e,o)}function gt(t,e){e.currPat=t.currPat,e.pat=t.pat,e.colorStyle=t.colorStyle,e.pivotRow=t.pivotRow,e.pivotCol=t.pivotCol,e.isFalling=t.isFalling,e.row=t.row,e.col=t.col}function D(t,e,o,r){if(null!==t)for(var a=t.pat[t.currPat],i=0;i<a.length;i++)for(var l=a[i],n=0;n<l.length;n++)0<a[i][n]&&(gridPosRow=e+(i-t.pivotRow),gridPosCol=o+(n-t.pivotCol),0<=gridPosRow)&&gridPosRow<y&&0<=gridPosCol&&gridPosCol<O&&(r===ShapeStateEnum.BRICK?(f[gridPosRow][gridPosCol].isBricked=!0,f[gridPosRow][gridPosCol].colorStyle=t.colorStyle):r===ShapeStateEnum.ADD?(f[gridPosRow][gridPosCol].isOccupied=!0,f[gridPosRow][gridPosCol].colorStyle=t.colorStyle):r===ShapeStateEnum.CLEAR&&(f[gridPosRow][gridPosCol].isOccupied=!1,f[gridPosRow][gridPosCol].colorStyle=-1))}function x(t,e,o,r,a,i){if(null!==t)for(var l=t.pat[0],n=e,c=o,d=0;d<l.length;d++){for(var s=l[d],h=0;h<s.length;h++)0<l[d][h]&&(p=n,g=c,u=r,C.fillStyle=i,C.fillRect(p,g,u,u),C.lineWidth=.5,C.strokeStyle="#114411",C.strokeRect(p,g,u,u),C.lineWidth=1),n+=r;n=e,c+=a}var p,g,u}function B(t,e,o,r,a,i,l,n){i?ut("rgba(0,0,0,0.5)"):wt(),C.font=r,C.fillStyle=a,C.textAlign=n,C.fillText(o,t,e),l&&(C.lineWidth=1,C.strokeStyle="rgba(228,228,245,1)",C.strokeText(o,t,e)),wt()}function ut(t){C.shadowBlur=8,C.shadowOffsetX=3,C.shadowOffsetY=3,C.shadowColor=t}function wt(){C.shadowBlur=0,C.shadowOffsetX=0,C.shadowOffsetY=0,C.shadowColor="rgba(0,0,0,0)"}function St(t,e,o,r,a,i,l,n,c,d,s){void 0===a&&(a=5),n&&ut("rgba(130,130,130,0.5)"),(n=C.createLinearGradient(t,e,t+o,e+r)).addColorStop(0,d),n.addColorStop(1,s),C.beginPath(),C.strokeStyle=c?n:i,C.lineWidth=l,C.moveTo(t+a,e),C.lineTo(t+o-a,e),C.quadraticCurveTo(t+o,e,t+o,e+a),C.lineTo(t+o,e+r-a),C.quadraticCurveTo(t+o,e+r,t+o-a,e+r),C.lineTo(t+a,e+r),C.quadraticCurveTo(t,e+r,t,e+r-a),C.lineTo(t,e+a),C.quadraticCurveTo(t,e,t+a,e),C.closePath(),C.stroke(),C.lineWidth=.5,wt()}function ft(t,e,o,r,a,l,n,c,d){var s,h=c,p=(c=C.measureText(l).width/l.length,Math.floor((o-10)/Math.ceil(c))),g=-1,u=0,w=0,S=0,f=!1,v=d?"Bold":"";for(null!==a&&(C.fillStyle=a,C.fillRect(t,e,o,r)),i=0;i<l.length;i++)w++,f=!1," "!==l.charAt(i)&&"\n"!==l.charAt(i)&&"\r"!==l.charAt(i)&&"\t"!==l.charAt(i)||(g=i,"\n"!==l.charAt(i)&&"\r"!==l.charAt(i))||(f=!0),(p<w||i===l.length-1||f)&&(s=l.substring(0,i),0<(g=i===l.length-1?l.length:g)&&(s=l.substring(u,g),u=g+1),B(t+5,e+h*++S,s,v+" "+h+"px Arial",n,!1,!1,"start"),w=0)}function vt(t,e,o,r,a,i,l,n,c){var d,s,h,p;c?St(t,e,o,r,2,"#000",5,!1,!0,"rgba(210,210,210,1)","rgba(85,85,85,1)"):(c=t,d=e,s=o,h=r,p=!1,C.beginPath(),(p=C.createLinearGradient(c+s/2,d,c+s/2,d+h)).addColorStop(0,"rgba(210,210,210,1)"),p.addColorStop(1,"rgba(85,85,85,1)"),C.fillStyle=p,C.lineWidth=1,C.moveTo(c+2,d),C.lineTo(c+s-2,d),C.quadraticCurveTo(c+s,d,c+s,d+2),C.lineTo(c+s,d+h-2),C.quadraticCurveTo(c+s,d+h,c+s-2,d+h),C.lineTo(c+2,d+h),C.quadraticCurveTo(c,d+h,c,d+h-2),C.lineTo(c,d+2),C.quadraticCurveTo(c,d,c+2,d),C.closePath(),C.fill(),C.lineWidth=.5),B(t+2,e-2-5,a,"Bold 18px Arial",i,!1,!1,"start"),B(t+o/2,e+r/2+4,l,"Bold 18px Arial",n,!1,!1,"center")}function Ct(){C.fillStyle="rgba(120,120,190,0.65)",C.fillRect(0,0,S.width,S.height)}function mt(t,e){ut();var o=S.width,r=S.height/4+50,a=((a=C.createLinearGradient(0,S.height/2-r/2,o,r)).addColorStop(0,"#223"),a.addColorStop(.4,"#bbb"),a.addColorStop(.6,"#bbb"),a.addColorStop(1,"#223"),C.fillStyle=a,C.fillRect(0,S.height/2-r/2,o,r),wt(),B(S.width/2,S.height/2-r/2+20,""+t,"Bold 18px Arial","#800",!1,!1,"center"),500),o=160;C.measureText(e).width<a&&(a=300,o=100),ft(S.width/2-o,S.height/2-r/2+30,a,150,null,e,"#339",14,!1)}function bt(t){t=Ot(t.clientX,t.clientY);var e=W,o=t.x,r=t.y,a=-1;for(i=0;i<e.length;i++)!0===e[i].enabled&&e[i].gameState===s&&(e[i].state=0,o>e[i].x)&&o<e[i].x+e[i].w&&r>e[i].y&&r<e[i].y+e[i].h&&(document.getElementById("canvasWrapper").style.cursor="pointer",e[i].state=1,a=i);a<0&&(document.getElementById("canvasWrapper").style.cursor="default"),kt()}function yt(t){t=Ot(t.clientX,t.clientY),function(t,e,o){for(i=0;i<t.length;i++)if(!0===t[i].enabled&&t[i].gameState===s&&e>t[i].x&&e<t[i].x+t[i].w&&o>t[i].y&&o<t[i].y+t[i].h)return t[i].state=0,t[i].hitFunction(),i}(W,t.x,t.y),kt()}function Ot(t,e){var o=S.getBoundingClientRect();return{x:t-o.left*(S.width/o.width),y:e-o.top*(S.height/o.height)}}var W=new Array;function Et(){d=!0,s=2,Ct(),mt("GAME PAUSED","")}function At(){d=!0,s=2,Ct(),mt("HELP","Move/rotate and place falling shapes to complete horizontal lines with no gaps.\nThis will clear that line and you will score points\n\nMove Left: Left Arrow / A\nMove Right: Right Arrow / D\nMove Down: Down Arrow / S\nRotate Shape:  Up Arrow / W")}function Rt(){d=!1,s=1,_()}function Pt(){s=4,d=!0,Ct(),mt("CONFIRM","Do you want to exit the game?")}function Mt(){s=1,_()}function Tt(){Dt(E),t(),s=1,ct()}function jt(){Dt(E),t(),ct()}function L(t,e,o,r,a,i,l,n,c,d){var s=new Object;s.x=e,s.y=o,s.w=r,s.h=a,s.text=i,s.textColor=n,s.color=l,s.visible=!0,s.enabled=!0,s.state=0,s.gameState=d,s.hitFunction=c,t[t.length]=s}function kt(){for(i=0;i<W.length;i++)!0===W[i].enabled&&W[i].gameState===s&&(t=W[i].x,e=W[i].y,o=W[i].w,r=W[i].h,a=W[i].state,l=W[i].text,n=void 0,n=C.createLinearGradient(t+o/2,e,t+o/2,e+r),0===a?(n.addColorStop(0,"rgba(250,250,250,0.15)"),n.addColorStop(.5,"rgba(250,250,250,0.5)")):(n.addColorStop(0,"rgba(250,250,250,0.8)"),n.addColorStop(.4,"rgba(250,250,250,0.05)"),n.addColorStop(.9,"rgba(250,250,250,0.8)")),n.addColorStop(1,"rgba(0,0,0,0.05)"),C.strokeStyle="#ddd",C.fillStyle=0===a?"#fdd638":"#fdb02a",C.fillRect(t,e,o,r),B(t+o/2,e+r/2+4,l,"Bold 20px Arial","#000",!1,!1,"center"),C.lineWidth=2,C.strokeRect(t,e,o,r),0===a?(C.beginPath(),C.lineWidth=3,C.strokeStyle="rgba(250,250,250,0.75)",C.moveTo(t+2,e+2),C.lineTo(t+2,e+r-2),C.lineTo(t+2,e+2),C.lineTo(t+o-2,e+2),C.stroke(),C.closePath(),C.beginPath(),C.lineWidth=3,C.strokeStyle="rgba(2,2,2,0.75)"):(C.beginPath(),C.lineWidth=3,C.strokeStyle="rgba(2,2,2,0.75)",C.moveTo(t+2,e+2),C.lineTo(t+2,e+r-2),C.lineTo(t+2,e+2),C.lineTo(t+o-2,e+2),C.stroke(),C.closePath(),C.beginPath(),C.lineWidth=3,C.strokeStyle="rgba(250,250,250,0.75)"),C.moveTo(t+o-2,e+2),C.lineTo(t+o-2,e+r-2),C.lineTo(t+2,e+r-2),C.stroke(),C.closePath(),wt());var t,e,o,r,a,l,n}var Ft="How to play? \n\nMove/rotate and place random falling shapes to complete horizontal lines with no gaps.\nThis will clear that line and you will score points.\n\nDon't let the shapes stack to the top",It="Controls:\n\n Move Left:  Left Arrow / A \n Move Right:  Right Arrow / D\n Move Down:  Down Arrow / S\n Rotate Shape:  Up Arrow / W";function _t(){return"undefined"!=typeof localStorage}function Dt(t){if(_t()){for(var e=0,o=0,r=!0,a=0;a<localStorage.length;a++){var i=localStorage.getItem(""+a);parseInt(t,10)===parseInt(i,10)&&(r=!1),(0===a||parseInt(e,10)>parseInt(i,10))&&(e=i,o=a)}localStorage.length<3&&r?localStorage.setItem(localStorage.length,t):parseInt(t,10)>parseInt(e,10)&&r&&(3===localStorage.length&&localStorage.removeItem(o),localStorage.setItem(o,t))}}var xt=new Array;function Bt(){if(_t()){for(var t=0;t<localStorage.length;t++)xt[t]=localStorage.getItem(""+t);xt.sort(function(t,e){return e-t})}}document.createElement("canvas").getContext?(S=document.getElementById("stage"),C=S.getContext("2d"),Q.src="headImg.png",Q.onload=function(){s=0,c=!1,v=null,Bt(),f=function(){var t,e=new Array(18);for(i=0;i<18;i++)for(e[i]=new Array(10),j=0;j<10;j++)e[i][j]=(t=void 0,(t=new Object).isOccupied=!1,t.isBricked=!1,t.colorStyle=-1,t.block=null,t);return e}(),N=36,U=0,K=1,pt(),L(W,S.width-230,S.height-150,160,80,"Start Game","red","red",Mt,0),L(W,S.width-140,S.height-200,110,40,"Help","red","red",At,1),L(W,S.width-140,S.height-150,110,40,"Pause","red","red",Et,1),L(W,S.width-140,S.height-100,110,40,"Exit Game","red","red",Pt,1),L(W,S.width/2-55,S.height/2+50,110,40,"Resume","red","red",Rt,2),L(W,S.width/2-120,S.height/2+20,150,40,"Play Again","red","red",Tt,3),L(W,S.width/2+50,S.height/2+20,60,40,"Quit","red","red",jt,3),L(W,S.width/2-60,S.height/2+20,50,40,"Yes","red","red",jt,4),L(W,S.width/2+20,S.height/2+20,50,40,"No","red","red",Rt,4),window.addEventListener("keydown",nt,!0),S.onmousemove=bt,S.onmousedown=yt;for(var l=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var o=(new Date).getTime(),r=Math.max(0,16-(o-l)),a=window.setTimeout(function(){t(o+r)},r);return l=o+r,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),function t(){requestAnimationFrame(t),ct()}()}):document.getElementById("canvasWrapper").innerHTML="Your browser does not support the HTML5 Canvas element"</script>