<!DOCTYPE html>
<html>
    <head>
        <title>Get Back From Robot City</title>
        <script src=/2019/webxr/aframe.js></script>
        <script>AFRAME.registerComponent("geometry-merger",{init:function(){let e=this;this.geometry=new THREE.Geometry,this.mesh=new THREE.Mesh(this.geometry),this.el.setObject3D("mesh",this.mesh),this.faceIndex={},this.vertexIndex={},this.el.object3D.traverse(function(t){"Mesh"===t.type&&t!==e.mesh&&(e.faceIndex[t.parent.uuid]=[e.geometry.faces.length,e.geometry.faces.length+t.geometry.faces.length-1],e.vertexIndex[t.parent.uuid]=[e.geometry.vertices.length,e.geometry.vertices.length+t.geometry.vertices.length-1],t.parent.updateMatrix(),e.geometry.merge(t.geometry,t.parent.matrix),t.parent.remove(t))})}});</script>
        <script>let player,difficulty=1,PLAYER_HEALTH=100;AFRAME.registerComponent("player",{init:function(){player=this.el.object3D}}),AFRAME.registerComponent("playagain",{init:function(){this.el.addEventListener("click",function(){window.location.reload()})}});const SETTINGS_INTERACT_TOLERANCE=1.1;let ground;AFRAME.registerComponent("difficulty",{init:function(){let t=this;this.trigger=function(){3===difficulty?difficulty=1:difficulty++,t.el.object3D.position.x=1===difficulty?.1:2===difficulty?.8:1.5},this.el.addEventListener("click",function(i){t.trigger()})}}),AFRAME.registerComponent("bgmusic",{init:function(){let t=this;this.trigger=function(){bgMusicOn=!bgMusicOn,bgMusicOn?(t.el.object3D.position.x=1.8,audio_bgMusic.readyState>0&&audio_bgMusic.play()):(t.el.object3D.position.x=2.8,audio_bgMusic.readyState>0&&audio_bgMusic.pause())},this.el.addEventListener("click",function(i){t.trigger()})}}),AFRAME.registerComponent("ground",{init:function(){let t=this;ground=this.el,this.el.addEventListener("click",function(t){t.detail.intersection.distance<MAX_TELEPORT_DISTANCE&&(camera.object3D.position.x=t.detail.intersection.point.x,camera.object3D.position.z=t.detail.intersection.point.z)}),this.teleportSymbol=document.querySelector("#teleport-symbol").object3D,this.el.addEventListener("raycaster-intersected",i=>{t.intersected=!0}),this.el.addEventListener("raycaster-intersected-cleared",i=>{t.intersected=!1,t.teleportSymbol.visible=!1}),this.tick=AFRAME.utils.throttleTick(this.tick,100,this)},tick:function(){this.intersected&&(this.distance=raycaster.getIntersection(this.el).distance,this.distance<MAX_TELEPORT_DISTANCE?this.teleportSymbol.visible=!0:this.teleportSymbol.visible=!1)}});const PICKUP_TOLERANCE=1;AFRAME.registerComponent("medikit",{init:function(){this.minX=this.el.object3D.position.x-1,this.maxX=this.el.object3D.position.x+1,this.minZ=this.el.object3D.position.z-1,this.maxZ=this.el.object3D.position.z+1,this.active=!0,this.tick=AFRAME.utils.throttleTick(this.tick,500,this)},tick:function(){this.active&&player&&player.position.x+PLAYER_RADIUS>this.minX&&player.position.x-PLAYER_RADIUS<this.maxX&&player.position.z+PLAYER_RADIUS>this.minZ&&player.position.z-PLAYER_RADIUS<this.maxZ&&(audioPickup.play(),(PLAYER_HEALTH+=3==difficulty?5:10)>100&&(PLAYER_HEALTH=100),updateHUD(),this.el.remove(),this.active=!1)}}),AFRAME.registerComponent("keycard",{init:function(){this.vector=new THREE.Vector3,this.active=!0,this.tick=AFRAME.utils.throttleTick(this.tick,500,this)},tick:function(){this.active&&(this.minX||(this.vector.setFromMatrixPosition(this.el.object3D.matrixWorld),0!==this.vector.x&&(this.minX=this.vector.x-1,this.maxX=this.vector.x+1,this.minZ=this.vector.z-1,this.maxZ=this.vector.z+1)),player&&player.position.x>this.minX&&player.position.x<this.maxX&&player.position.z>this.minZ&&player.position.z<this.maxZ&&(hasKeycard=!0,audioPickup.play(),this.el.remove(),this.active=!1,updateHUD()))}}),AFRAME.registerComponent("computer",{init:function(){this.vector=new THREE.Vector3,this.active=!0,this.tick=AFRAME.utils.throttleTick(this.tick,500,this),this.firstTime=!0},tick:function(){if(this.active&&(this.minX||(this.vector.setFromMatrixPosition(this.el.object3D.matrixWorld),0!==this.vector.x&&(this.minX=this.vector.x-2,this.maxX=this.vector.x+2,this.minZ=this.vector.z-2,this.maxZ=this.vector.z+2)),player&&player.position.x>this.minX&&player.position.x<this.maxX&&player.position.z>this.minZ&&player.position.z<this.maxZ&&(this.firstTime&&(updateComputer(),this.firstTime=!1),hasKeycard))){for(updateComputer(),this.active=!1,this.length=collisionObjects.length,this.i=0;this.i<this.length;this.i++)if(collisionObjects[this.i].gateway){collisionObjects.splice(this.i,1);break}document.querySelector("#gateway").remove()}}}),AFRAME.registerComponent("teleporter",{init:function(){this.vector=new THREE.Vector3,this.tick=AFRAME.utils.throttleTick(this.tick,1e3,this)},tick:function(){hasKeycard&&(this.minX||(this.vector.setFromMatrixPosition(this.el.object3D.matrixWorld),0!==this.vector.x&&(this.minX=this.vector.x-2,this.maxX=this.vector.x+2,this.minZ=this.vector.z-2,this.maxZ=this.vector.z+2)),player&&player.position.x>this.minX&&player.position.x<this.maxX&&player.position.z>this.minZ&&player.position.z<this.maxZ&&endGame())}});const SPEED=.1;AFRAME.registerComponent("key-controls",{init:function(){this.camera=document.querySelector("a-camera").object3D;let t=this;document.body.addEventListener("keydown",function(i){"w"===i.key.toLowerCase()||"ArrowUp"===i.key?t.up=!0:"s"===i.key.toLowerCase()||"ArrowDown"===i.key?t.down=!0:"a"===i.key.toLowerCase()||"ArrowLeft"===i.key?t.left=!0:"d"!==i.key.toLowerCase()&&"ArrowRight"!==i.key||(t.right=!0)}),document.body.addEventListener("keyup",function(i){"w"===i.key.toLowerCase()||"ArrowUp"===i.key?t.up=!1:"s"===i.key.toLowerCase()||"ArrowDown"===i.key?t.down=!1:"a"===i.key.toLowerCase()||"ArrowLeft"===i.key?t.left=!1:"d"!==i.key.toLowerCase()&&"ArrowRight"!==i.key||(t.right=!1)})},tick:function(){this.up&&(this.el.object3D.position.x-=.1*Math.sin(this.camera.rotation.y),this.el.object3D.position.z-=.1*Math.cos(this.camera.rotation.y)),this.down&&(this.el.object3D.position.x+=.1*Math.sin(this.camera.rotation.y),this.el.object3D.position.z+=.1*Math.cos(this.camera.rotation.y)),this.left&&(this.el.object3D.position.x-=.1*Math.sin(this.camera.rotation.y+Math.PI/2),this.el.object3D.position.z-=.1*Math.cos(this.camera.rotation.y+Math.PI/2)),this.right&&(this.el.object3D.position.x+=.1*Math.sin(this.camera.rotation.y+Math.PI/2),this.el.object3D.position.z+=.1*Math.cos(this.camera.rotation.y+Math.PI/2))}}),AFRAME.registerComponent("alt-movement",{init:function(){let t=this;this.camera=document.querySelector("a-camera").object3D,this.el.addEventListener("buttondown",function(i){0===i.detail.id&&(t.moving=!0)}),this.el.addEventListener("buttonup",function(i){0===i.detail.id&&(t.moving=!1)})},tick:function(){this.moving&&(player.position.x-=.2*Math.sin(this.camera.rotation.y),player.position.z-=.2*Math.cos(this.camera.rotation.y))}});const PLAYER_RADIUS=.7;let collisionObjects=[];AFRAME.registerComponent("collision-obj",{init:function(){collisionObjects.push(this.el.object3D)}}),AFRAME.registerComponent("gateway",{init:function(){this.el.object3D.gateway=!0,collisionObjects.push(this.el.object3D)}}),AFRAME.registerComponent("collision-cam",{init:function(){this.camera=this.el.object3D,this.vector=new THREE.Vector3},tick:function(){for(this.collision=!1,this.i=0;this.i<collisionObjects.length;this.i++)collisionObjects[this.i].minX||(this.vector.setFromMatrixPosition(collisionObjects[this.i].matrixWorld),this.scaleX=0===collisionObjects[this.i].rotation.y||collisionObjects[this.i].rotation.y===Math.PI?collisionObjects[this.i].scale.x:collisionObjects[this.i].scale.z,this.scaleZ=0===collisionObjects[this.i].rotation.y||collisionObjects[this.i].rotation.y===Math.PI?collisionObjects[this.i].scale.z:collisionObjects[this.i].scale.x,collisionObjects[this.i].minX=this.vector.x-this.scaleX/2,collisionObjects[this.i].maxX=this.vector.x+this.scaleX/2,collisionObjects[this.i].minZ=this.vector.z-this.scaleZ/2,collisionObjects[this.i].maxZ=this.vector.z+this.scaleZ/2),this.camera.position.x+PLAYER_RADIUS>collisionObjects[this.i].minX&&this.camera.position.x-PLAYER_RADIUS<collisionObjects[this.i].maxX&&this.camera.position.z+PLAYER_RADIUS>collisionObjects[this.i].minZ&&this.camera.position.z-PLAYER_RADIUS<collisionObjects[this.i].maxZ&&(this.collision=!0,collisionObjects[this.i].gateway&&(PLAYER_HEALTH-=1,updateHUD(),PLAYER_HEALTH<=0&&endGame()));this.collision&&this.lastGoodPos?(this.camera.position.x=this.lastGoodPos.x,this.camera.position.z=this.lastGoodPos.z):this.lastGoodPos={x:this.camera.position.x,z:this.camera.position.z}}});</script>
        <script>!function(){const t={asset:{version:"2.0"},scenes:[{name:"Scene",nodes:[0]}],nodes:[{mesh:0,name:"Cube.001"}],meshes:[{name:"Cube.002",primitives:[{attributes:{POSITION:0},indices:1}]}],accessors:[{bufferView:0,componentType:5126,count:72,max:[.7519344091415405,1.2578765153884888,.817348837852478],min:[-.026826277375221252,1.0526292324066162,-.828311562538147],type:"VEC3"},{bufferView:1,componentType:5123,count:108,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:864,byteOffset:0},{buffer:0,byteLength:216,byteOffset:864}],buffers:[{byteLength:1080,uri:"data:application/octet-stream;base64,ALsXOmeZmz+6252+J6FzPsSRjj/kl0S/ntiHPqFRjT/Uvj+/yMLbvIvZnD/Zjae+ntiHPqFRjT/Uvj+/MFs2P7L8hz+O0VO/Nl89P4+8hj9/+E6/J6FzPsSRjj/kl0S/tA+APlO6kj+P0kS/0F9RPPbBnz8QUZ6+vheOPi96kT+A+T+/cKFvvBkCoT8vA6i+vheOPi96kT+A+T+/ALsXOmeZmz+6252+ntiHPqFRjT/Uvj+/0F9RPPbBnz8QUZ6+yMLbvIvZnD/Zjae+tA+APlO6kj+P0kS/J6FzPsSRjj/kl0S/cKFvvBkCoT8vA6i+MFs2P7L8hz+O0VO/xn5APx3lij8qM0+/Nl89P4+8hj9/+E6/wHo5P0EljD86DFS/wHo5P0EljD86DFS/vheOPi96kT+A+T+/xn5APx3lij8qM0+/tA+APlO6kj+P0kS/xn5APx3lij8qM0+/ntiHPqFRjT/Uvj+/Nl89P4+8hj9/+E6/vheOPi96kT+A+T+/J6FzPsSRjj/kl0S/wHo5P0EljD86DFS/MFs2P7L8hz+O0VO/tA+APlO6kj+P0kS/J6FzPsSRjj9wyUE/ALsXOmaZmz/SPpg+ntiHPqBRjT9g8Dw/yMLbvIrZnD/x8KE+MFs2P7L8hz8aA1E/ntiHPqBRjT9g8Dw/Nl89P468hj8LKkw/J6FzPsSRjj9wyUE/0F9RPPbBnz8otJg+tA+APlK6kj8bBEI/vheOPi56kT8MKz0/cKFvvBgCoT9HZqI+ALsXOmaZmz/SPpg+vheOPi56kT8MKz0/ntiHPqBRjT9g8Dw/0F9RPPbBnz8otJg+tA+APlK6kj8bBEI/yMLbvIrZnD/x8KE+J6FzPsSRjj9wyUE/cKFvvBgCoT9HZqI+xn5APxzlij+2ZEw/MFs2P7L8hz8aA1E/Nl89P468hj8LKkw/wHo5P0AljD/GPVE/vheOPi56kT8MKz0/wHo5P0AljD/GPVE/xn5APxzlij+2ZEw/tA+APlK6kj8bBEI/ntiHPqBRjT9g8Dw/xn5APxzlij+2ZEw/Nl89P468hj8LKkw/vheOPi56kT8MKz0/wHo5P0AljD/GPVE/J6FzPsSRjj9wyUE/MFs2P7L8hz8aA1E/tA+APlK6kj8bBEI/AAABAAIAAAADAAEABAAFAAYABAAHAAUACAAJAAoACwAJAAgADAANAA4ADwANAAwAEAARABIAEAATABEAFAAVABYAFwAVABQAGAAZABoAGwAZABgAHAAdAB4AHwAdABwAIAAhACIAIAAjACEAJAAlACYAJwAlACQAKAApACoAKwApACgALAAtAC4ALAAvAC0AMAAxADIAMAAzADEANAA1ADYANwA1ADQAOAA5ADoAOAA7ADkAPAA9AD4APAA/AD0AQABBAEIAQABDAEEARABFAEYARwBFAEQA"}]};AFRAME.registerComponent("robot",{schema:{xPos:{type:"number",default:0},zPos:{type:"number",default:0}},init:function(){this.container=document.createElement("a-entity"),this.container.object3D.position.x=-4,this.container.object3D.position.z=-4,this.container.setAttribute("animation","property: object3D.position.x; from: -4; to: 4; dir: alternate; dur: 12000; loop: true"),this.container.setAttribute("animation__2","property: object3D.position.z; from: -4; to: 4; dir: alternate; dur: 12000; loop: true");let e=document.createElement("a-entity");e.setAttribute("geometry","primitive: box"),e.object3D.scale.y=2,e.object3D.position.y=1,e.className="interact",e.object3D.visible=!1,this.container.appendChild(e),this.ring=document.createElement("a-entity"),this.ring.setAttribute("mixin","robot-ring"),this.container.appendChild(this.ring);let i=document.createElement("a-entity");i.setAttribute("mixin","metal"),i.setAttribute("geometry-merger",""),this.container.appendChild(i);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: cone; segmentsRadial: 8; segmentsHeight: 1; radiusBottom: 0.5; radiusTop: 0.3; height: 1.2; buffer: false"),o.object3D.position.y=.9,i.appendChild(o);let s=document.createElement("a-entity");s.setAttribute("geometry","primitive: cylinder; segmentsRadial: 4; segmentsHeight: 1; radius: 0.05; height: 0.2; openEnded: true; buffer: false"),s.object3D.position.y=1.6,s.object3D.rotation.x=Math.PI,i.appendChild(s);let n=document.createElement("a-entity");n.setAttribute("gltf-model",URL.createObjectURL(new Blob([JSON.stringify(t)]))),n.object3D.rotation.y=1.5*Math.PI,n.object3D.rotation.x=.1*Math.PI,n.object3D.position.y=.2,n.object3D.position.z=-.5,n.setAttribute("mixin","metal"),this.container.appendChild(n);let a=document.createElement("a-entity");a.setAttribute("geometry","primitive: sphere; radius: 0.4; segmentsWidth: 8; segmentsHeight: 4; phiLength: 180; buffer: false"),a.object3D.rotation.x=1.5*Math.PI,a.object3D.position.y=1.55,i.appendChild(a);let r=document.createElement("a-entity");r.setAttribute("geometry","primitive: circle; radius: 0.4; segments: 8; buffer: false"),r.object3D.position.y=1.55,r.object3D.rotation.x=.5*Math.PI,i.appendChild(r),this.mergeRobotEyes=document.createElement("a-entity"),this.mergeRobotEyes.object3D.rotation.x=1.5*Math.PI,this.mergeRobotEyes.object3D.position.y=1.7,this.mergeRobotEyes.setAttribute("mixin","robot-eyes"),this.mergeRobotEyes.setAttribute("geometry-merger",""),this.container.appendChild(this.mergeRobotEyes);let A=document.createElement("a-entity");A.setAttribute("geometry","primitive: cylinder; segmentsRadial: 6; segmentsHeight: 1; radius: 0.06; height: 0.15; buffer: false"),A.object3D.position.x=-.12,A.object3D.position.y=-.25,this.mergeRobotEyes.appendChild(A);let c=document.createElement("a-entity");c.setAttribute("geometry","primitive: cylinder; segmentsRadial: 6; segmentsHeight: 1; radius: 0.06; height: 0.15; buffer: false"),c.object3D.position.x=.12,c.object3D.position.y=-.25,this.mergeRobotEyes.appendChild(c),this.laser1=document.createElement("a-entity"),this.laser1.object3D.visible=!1,this.mergeRobotEyes.appendChild(this.laser1),this.laser2=document.createElement("a-entity"),this.laser2.object3D.visible=!1,this.mergeRobotEyes.appendChild(this.laser2),this.el.appendChild(this.container),this.robotPos=new THREE.Vector3,this.vector=new THREE.Vector3,this.active=!0;let h=this;e.addEventListener("click",function(t){h.audio2Set&&h.mergeRobotEyes.components.sound.playSound(),h.container.components.animation.pauseAnimation(),h.container.components.animation__2.pauseAnimation(),h.container.object3D.rotation.x=Math.PI/2,h.container.object3D.position.y=.4,h.ring.object3D.visible=!1,h.active=!1,window.setTimeout(function(){let t=chooseRobotLocation(h.data.xPos+"-"+h.data.zPos);h.data.xPos=t.x,h.data.zPos=t.z,h.el.object3D.position.x=t.x*TILE_SIZE-GRID_SIZE*TILE_SIZE*.5+.5*TILE_SIZE,h.el.object3D.position.z=t.z*TILE_SIZE-GRID_SIZE*TILE_SIZE*.5+.5*TILE_SIZE,h.container.object3D.rotation.x=0,h.container.object3D.position.y=0,h.container.components.animation.resumeAnimation(),h.container.components.animation__2.resumeAnimation(),h.ring.object3D.visible=!0,h.active=!0},1===difficulty?2e4:2===difficulty?18e3:16e3)}),this.tick=AFRAME.utils.throttleTick(this.tick,3e3,this)},tick:function(){if(this.active&&(this.audio1Set||4===audioRobotLaser.readyState&&(this.el.setAttribute("sound","src: #audio-robot-laser"),this.audio1Set=!0),this.audio2Set||4===audioShootRobot.readyState&&(this.mergeRobotEyes.setAttribute("sound","src: #audio-shoot-robot"),this.audio2Set=!0),this.robotPos.setFromMatrixPosition(this.container.object3D.matrixWorld),this.distance=Math.hypot(this.robotPos.x-player.position.x,this.robotPos.z-player.position.z),this.distance<20)){for(this.angle=Math.atan2(player.position.x-this.robotPos.x,player.position.z-this.robotPos.z),this.lineOfSight=!0,this.i=.3;this.i<this.distance;this.i+=.3){for(this.checkPointX=this.robotPos.x+this.i*Math.sin(this.angle),this.checkPointZ=this.robotPos.z+this.i*Math.cos(this.angle),this.ii=0;this.ii<collisionObjects.length;this.ii++)if(this.vector.setFromMatrixPosition(collisionObjects[this.ii].matrixWorld),this.minX=this.vector.x-collisionObjects[this.ii].scale.x/2-.1,this.maxX=this.vector.x+collisionObjects[this.ii].scale.x/2+.1,this.minZ=this.vector.z-collisionObjects[this.ii].scale.z/2-.1,this.maxZ=this.vector.z+collisionObjects[this.ii].scale.z/2+.1,this.checkPointX>this.minX&&this.checkPointX<this.maxX&&this.checkPointZ>this.minZ&&this.checkPointZ<this.maxZ){this.lineOfSight=!1;break}if(!this.lineOfSight)break}if(this.lineOfSight){this.container.object3D.rotation.y=this.angle;let t=this;window.setTimeout(function(){t.laser1.setAttribute("line","start: 0.13, 0.22, 0.05; end: 0.1 "+(-1*t.distance+.5)+" -0.5; color: red"),t.laser1.object3D.visible=!0,t.laser2.setAttribute("line","start: -0.13, 0.22, 0.05; end: -0.1 "+(-1*t.distance+.5)+" -0.5; color: red"),t.laser2.object3D.visible=!0,t.audio1Set&&t.el.components.sound.playSound(),window.setTimeout(function(){playerShot.visible=!0,window.setTimeout(function(){playerShot.visible=!1},250)},150),window.setTimeout(function(){t.laser1.object3D.visible=!1,t.laser2.object3D.visible=!1},250),1===difficulty?PLAYER_HEALTH-=5:PLAYER_HEALTH-=10,updateHUD(),PLAYER_HEALTH<=0&&endGame()},250)}}}})}();</script>
        <script>AFRAME.registerComponent("star-system",{schema:{radius:{type:"number",default:300,min:0},depth:{type:"number",default:300,min:0},count:{type:"number",default:1e4,min:0}},init:function(){const t=new THREE.Geometry;for(;t.vertices.length<this.data.count;)t.vertices.push(this.randomVectorBetweenSpheres(this.data.radius,this.data.depth));const e=new THREE.PointsMaterial(Object.assign({},{color:"#FFF",size:1,fog:!1}));this.el.setObject3D("particle-system",new THREE.Points(t,e))},randomVectorBetweenSpheres:function(t,e){const n=Math.floor(Math.random()*(t+e-t+1)+t);return this.randomSphereSurfaceVector(n)},randomSphereSurfaceVector:function(t){const e=Math.PI*Math.random(),n=Math.acos(2*Math.random()-1),a=t*Math.sin(n)*Math.cos(e),r=t*Math.sin(n)*Math.sin(e),s=t*Math.cos(n);return new THREE.Vector3(a,r,s)}});</script>
        <script>const GRID_SIZE=6,TILE_SIZE=10;let chooseRobotLocation;AFRAME.registerComponent("generate-level",{init:function(){"use strict";let t=[];!function(){let e,o,i;chooseRobotLocation=function(c){for(e=!1,c&&t.splice(t.indexOf(c),1);!e;)o=Math.floor(6*Math.random()),i=Math.floor(6*Math.random()),-1===t.indexOf(o+"-"+i)&&(e=!0);return t.push(o+"-"+i),{x:o,z:i}}}();let e=[],o=[];const i=function(t){let i,c,s,n=!1;for(;!n;)if(i=Math.floor(6*Math.random()),c=Math.floor(6*Math.random()),-1===e.indexOf(i+"-"+c)&&(0===t?s=i+"-"+(c+1):1===t?s=i-1+"-"+c:2===t?s=i+"-"+(c-1):3===t&&(s=i+1+"-"+c),-1===e.indexOf(s))){let t=!0,e=-1;o.forEach(function(o,n){o.space===i+"-"+c&&(t=!1),o.space===s&&(3===o.timesUsed?t=!1:e=n)}),t&&(n=!0,-1===e?o.push({space:s,timesUsed:1}):o[e].timesUsed++)}return e.push(i+"-"+c),{x:i,z:c}};let c=document.createElement("a-entity"),s=document.createElement("a-entity");for(let e=0;e<12;e++){let o;0===e?2===(o=Math.floor(3*Math.random()))&&(o=3):o=Math.floor(4*Math.random());let n=i(o);const a=10*n.x-30+5,b=10*n.z-30+5;if(0===e){let e=document.querySelector("#camera").object3D;e.position.x=a,e.position.z=b,t.push(n.x+"-"+n.z);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: plane; width: 6; height: 3"),o.setAttribute("material","src: #welcomescreen; shader: flat"),o.object3D.position.x=a,o.object3D.position.y=1.9,o.object3D.position.z=b-5+.3+.1,SCENE.appendChild(o);let i=document.createElement("a-entity");i.setAttribute("mixin","settings-control"),i.className="interact",i.setAttribute("difficulty",""),i.object3D.position.x=.1,i.object3D.position.y=-1.31,i.object3D.position.z=.01,o.appendChild(i);let c=document.createElement("a-entity");c.setAttribute("mixin","settings-control"),c.className="interact",c.setAttribute("bgmusic",""),c.object3D.position.x=1.8,c.object3D.position.y=-1.31,c.object3D.position.z=.01,o.appendChild(c)}else if(1===e){t.push(n.x+"-"+n.z);let e=document.createElement("a-entity");e.setAttribute("geometry","primitive: cylinder; height: 1; radius: 0.5; segmentsRadial: 6; segmentsHeight: 1; buffer: false"),e.object3D.position.x=a,e.object3D.position.y=.5,e.object3D.position.z=b,c.appendChild(e);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: box"),o.object3D.scale.x=.15,o.object3D.scale.y=.25,o.object3D.scale.z=.03,o.setAttribute("material","color: blue; shader: flat"),SCENE.appendChild(o),o.object3D.position.x=a,o.object3D.position.y=1.2,o.object3D.position.z=b,o.setAttribute("keycard",""),o.setAttribute("animation","property: object3D.rotation.y; to: 360; loop: true; easing: linear; dur: 2000")}else if(2===e){t.push(n.x+"-"+n.z);let e=document.createElement("a-entity");e.setAttribute("geometry","primitive: plane"),e.setAttribute("material","src: #mat-computer; shader: flat"),e.object3D.position.y=1.5,e.setAttribute("computer",""),e.setAttribute("id","computer"),SCENE.appendChild(e),0===o?(e.object3D.position.x=a-3*.8,e.object3D.position.z=b+5+.01):1===o?(e.object3D.rotation.y=1.5*Math.PI,e.object3D.position.x=a-5-.01,e.object3D.position.z=b-3*.8):2===o?(e.object3D.rotation.y=Math.PI,e.object3D.position.x=a+3*.8,e.object3D.position.z=b-5-.01):3===o&&(e.object3D.rotation.y=Math.PI/2,e.object3D.position.x=a+5+.01,e.object3D.position.z=b+3*.8);let i=document.createElement("a-entity");i.setAttribute("geometry","primitive: box; width: "+3*1.2+"; depth: 0.25; height: 3"),i.setAttribute("material","src: #mat-gateway; shader: flat; transparent: true"),i.setAttribute("id","gateway"),i.className="interact",i.object3D.position.y=1.5,SCENE.appendChild(i),0===o?(i.object3D.position.x=a-3*.07,i.object3D.position.z=b+5-.15):1===o?(i.object3D.rotation.y=1.5*Math.PI,i.object3D.position.x=a-5+.15,i.object3D.position.z=b-.24):2===o?(i.object3D.rotation.y=Math.PI,i.object3D.position.x=a+.24,i.object3D.position.z=b-5+.15):3===o&&(i.object3D.rotation.y=Math.PI/2,i.object3D.position.x=a+5-.15,i.object3D.position.z=b+3*.1),i.setAttribute("gateway","");let c=document.createElement("a-entity");c.setAttribute("mixin","teleporter"),c.object3D.position.x=a,c.object3D.position.z=b,1===o?c.object3D.rotation.y=1.5*Math.PI:2===o?c.object3D.rotation.y=Math.PI:3===o&&(c.object3D.rotation.y=.5*Math.PI),c.setAttribute("teleporter","");let s=document.createElement("a-entity");s.setAttribute("geometry","primitive: cylinder; segmentsHeight: 1; segmentsRadial: 25; radius: 1.5; height: 0.2; buffer: false"),s.object3D.position.y=.1,s.setAttribute("mixin","teleporter"),c.appendChild(s);let l=document.createElement("a-entity");l.setAttribute("geometry","primitive: cylinder; segmentsHeight: 1; segmentsRadial: 25; radius: 1.2; height: 0.2; buffer: false"),l.object3D.position.y=.3,l.setAttribute("mixin","teleporter"),c.appendChild(l);let r=document.createElement("a-entity");r.setAttribute("geometry","primitive: cylinder; segmentsHeight: 1; segmentsRadial: 25; radius: 0.9; height: 3"),r.setAttribute("material","opacity: 0.5; shader: flat; color: blue; transparent: true"),r.setAttribute("animation","property: components.material.material.opacity; from: 0.4; to: 0.2; dur: 1500; loop: true; dir: alternate"),r.object3D.position.x=a,r.object3D.position.y=1.9,r.object3D.position.z=b,SCENE.appendChild(r);let p=document.createElement("a-entity");p.setAttribute("geometry","primitive: cylinder; segmentsHeight: 1; segmentsRadial: 25; radius: 1.2; height: 0.2; buffer: false"),p.object3D.position.y=3.5,p.setAttribute("mixin","teleporter"),c.appendChild(p);let j=document.createElement("a-entity");j.setAttribute("geometry","primitive: ring; radiusInner: 2; radiusOuter: 2.3; segmentsTheta: 12; segmentsPhi: 1; buffer: false"),j.object3D.position.y=1.9,j.setAttribute("mixin","teleporter"),c.appendChild(j),c.setAttribute("geometry-merger",""),SCENE.appendChild(c)}else if(Math.floor(3*Math.random())>0){let t=document.createElement("a-entity");t.setAttribute("geometry","primitive: box; buffer: false"),t.object3D.scale.x=.4,t.object3D.scale.y=.4,t.object3D.scale.z=.4,t.setAttribute("material","src: #medikit"),t.setAttribute("medikit",""),t.object3D.position.x=a,t.object3D.position.y=.2,t.object3D.position.z=b,SCENE.appendChild(t)}let l=3.5,r=document.createElement("a-entity");r.setAttribute("geometry","primitive: box; buffer: false"),r.object3D.position.y=1.5,r.setAttribute("collision-obj",""),c.appendChild(r);let p=document.createElement("a-entity");p.setAttribute("geometry","primitive: box; buffer: false"),p.object3D.position.y=1.5,p.setAttribute("collision-obj",""),c.appendChild(p);let j=document.createElement("a-entity");j.setAttribute("geometry","primitive: box; buffer: false"),j.object3D.position.y=1.5,j.setAttribute("collision-obj",""),c.appendChild(j);let D=document.createElement("a-entity");D.setAttribute("geometry","primitive: box; buffer: false"),D.object3D.position.y=1.5,D.setAttribute("collision-obj",""),c.appendChild(D);let m=document.createElement("a-entity");m.setAttribute("geometry","primitive: box; buffer: false"),m.object3D.position.y=1.5,m.setAttribute("collision-obj",""),c.appendChild(m),0===o||2===o?(r.object3D.scale.x=l,r.object3D.scale.y=3,r.object3D.scale.z=.3,r.object3D.position.x=a-l/2-1.5,p.object3D.scale.x=l,p.object3D.scale.y=3,p.object3D.scale.z=.3,p.object3D.position.x=a+l/2+1.5,D.object3D.scale.x=.3,D.object3D.scale.y=3,D.object3D.scale.z=10,D.object3D.position.x=a-5+.15,D.object3D.position.z=b,m.object3D.scale.x=.3,m.object3D.scale.y=3,m.object3D.scale.z=10,m.object3D.position.x=a+5-.15,m.object3D.position.z=b,j.object3D.scale.x=10,j.object3D.scale.y=3,j.object3D.scale.z=.3,j.object3D.position.x=a):(r.object3D.scale.x=.3,r.object3D.scale.y=3,r.object3D.scale.z=l,r.object3D.position.z=b-l/2-1.5,p.object3D.scale.x=.3,p.object3D.scale.y=3,p.object3D.scale.z=l,p.object3D.position.z=b+l/2+1.5,D.object3D.scale.x=10,D.object3D.scale.y=3,D.object3D.scale.z=.3,D.object3D.position.x=a,D.object3D.position.z=b+5-.15,m.object3D.scale.x=10,m.object3D.scale.y=3,m.object3D.scale.z=.3,m.object3D.position.x=a,m.object3D.position.z=b-5+.15,j.object3D.scale.x=.3,j.object3D.scale.y=3,j.object3D.scale.z=10,j.object3D.position.z=b),0===o?(r.object3D.position.z=b+5-.15,p.object3D.position.z=b+5-.15,j.object3D.position.z=b-5+.15):1===o?(r.object3D.position.x=a-5+.15,p.object3D.position.x=a-5+.15,j.object3D.position.x=a+5-.15):2===o?(r.object3D.position.z=b-5+.15,p.object3D.position.z=b-5+.15,j.object3D.position.z=b+5-.15):3===o&&(r.object3D.position.x=a+5-.15,p.object3D.position.x=a+5-.15,j.object3D.position.x=a-5+.15);let y=Math.floor(9*Math.random())+2,d=document.createElement("a-entity");d.setAttribute("geometry","primitive: box; buffer: false;"),d.object3D.scale.x=10/6,d.object3D.scale.y=3*y,d.object3D.scale.z=.3,d.object3D.position.x=a+5-10/12,d.object3D.position.y=3*y/2+3,d.object3D.position.z=b+5-.15,c.appendChild(d);let u=document.createElement("a-entity");u.setAttribute("geometry","primitive: box; buffer: false"),u.object3D.scale.x=10/6,u.object3D.scale.y=3*y,u.object3D.scale.z=.3,u.object3D.position.x=a,u.object3D.position.y=3*y/2+3,u.object3D.position.z=b+5-.15,c.appendChild(u);let x=document.createElement("a-entity");x.setAttribute("geometry","primitive: box; buffer: false"),x.object3D.scale.x=10/6,x.object3D.scale.y=3*y,x.object3D.scale.z=.3,x.object3D.position.x=a+-5+10/12,x.object3D.position.y=3*y/2+3,x.object3D.position.z=b+5-.15,c.appendChild(x);let f=document.createElement("a-entity");f.setAttribute("geometry","primitive: box; buffer: false"),f.object3D.scale.x=.3,f.object3D.scale.y=3*y,f.object3D.scale.z=10/6,f.object3D.position.x=a+5-.15,f.object3D.position.y=3*y/2+3,f.object3D.position.z=b+5-10/12,c.appendChild(f);let h=document.createElement("a-entity");h.setAttribute("geometry","primitive: box; buffer: false"),h.object3D.scale.x=.3,h.object3D.scale.y=3*y,h.object3D.scale.z=10/6,h.object3D.position.x=a+5-.15,h.object3D.position.y=3*y/2+3,h.object3D.position.z=b,c.appendChild(h);let z=document.createElement("a-entity");z.setAttribute("geometry","primitive: box; buffer: false"),z.object3D.scale.x=.3,z.object3D.scale.y=3*y,z.object3D.scale.z=10/6,z.object3D.position.x=a+5-.15,z.object3D.position.y=3*y/2+3,z.object3D.position.z=b+-5+10/12,c.appendChild(z);let A=document.createElement("a-entity");A.setAttribute("geometry","primitive: box; buffer: false"),A.object3D.scale.x=10/6,A.object3D.scale.y=3*y,A.object3D.scale.z=.3,A.object3D.position.x=a+5-10/12,A.object3D.position.y=3*y/2+3,A.object3D.position.z=b+-5+.15,c.appendChild(A);let g=document.createElement("a-entity");g.setAttribute("geometry","primitive: box; buffer: false"),g.object3D.scale.x=10/6,g.object3D.scale.y=3*y,g.object3D.scale.z=.3,g.object3D.position.x=a,g.object3D.position.y=3*y/2+3,g.object3D.position.z=b+-5+.15,c.appendChild(g);let E=document.createElement("a-entity");E.setAttribute("geometry","primitive: box; buffer: false"),E.object3D.scale.x=10/6,E.object3D.scale.y=3*y,E.object3D.scale.z=.3,E.object3D.position.x=a+-5+10/12,E.object3D.position.y=3*y/2+3,E.object3D.position.z=b+-5+.15,c.appendChild(E);let C=document.createElement("a-entity");C.setAttribute("geometry","primitive: box; buffer: false"),C.object3D.scale.x=.3,C.object3D.scale.y=3*y,C.object3D.scale.z=10/6,C.object3D.position.x=a+-5+.15,C.object3D.position.y=3*y/2+3,C.object3D.position.z=b+5-10/12,c.appendChild(C);let v=document.createElement("a-entity");v.setAttribute("geometry","primitive: box; buffer: false"),v.object3D.scale.x=.3,v.object3D.scale.y=3*y,v.object3D.scale.z=10/6,v.object3D.position.x=a+-5+.15,v.object3D.position.y=3*y/2+3,v.object3D.position.z=b,c.appendChild(v);let M=document.createElement("a-entity");M.setAttribute("geometry","primitive: box; buffer: false"),M.object3D.scale.x=.3,M.object3D.scale.y=3*y,M.object3D.scale.z=10/6,M.object3D.position.x=a+-5+.15,M.object3D.position.y=3*y/2+3,M.object3D.position.z=b+-5+10/12,c.appendChild(M);for(let t=0;t<=y;t++){let e=document.createElement("a-entity");e.setAttribute("geometry","primitive: box; buffer: false"),e.object3D.scale.x=10,e.object3D.scale.y=.75,e.object3D.scale.z=.3,e.object3D.position.x=a,e.object3D.position.y=3.375+3*t,e.object3D.position.z=b+5-.15,c.appendChild(e);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: box; buffer: false"),o.object3D.scale.x=.3,o.object3D.scale.y=.75,o.object3D.scale.z=10,o.object3D.position.x=a+5-.15,o.object3D.position.y=3.375+3*t,o.object3D.position.z=b,c.appendChild(o);let i=document.createElement("a-entity");i.setAttribute("geometry","primitive: box; buffer: false"),i.object3D.scale.x=10,i.object3D.scale.y=.75,i.object3D.scale.z=.3,i.object3D.position.x=a,i.object3D.position.y=3.375+3*t,i.object3D.position.z=b+-5+.15,c.appendChild(i);let s=document.createElement("a-entity");s.setAttribute("geometry","primitive: box; buffer: false"),s.object3D.scale.x=.3,s.object3D.scale.y=.75,s.object3D.scale.z=10,s.object3D.position.x=a+-5+.15,s.object3D.position.y=3.375+3*t,s.object3D.position.z=b,c.appendChild(s)}let I=document.createElement("a-entity");I.setAttribute("geometry","primitive: box; buffer: false"),I.object3D.scale.x=10,I.object3D.scale.y=.75,I.object3D.scale.z=10,I.object3D.position.x=a,I.object3D.position.y=3*y+3+3/8,I.object3D.position.z=b,c.appendChild(I);let w=document.createElement("a-entity");w.setAttribute("mixin","windows"),w.object3D.scale.x=9.7,w.object3D.scale.y=3*y,w.object3D.position.x=a,w.object3D.position.y=3+3*y*.5,w.object3D.position.z=b+5-.15,s.appendChild(w);let P=document.createElement("a-entity");P.setAttribute("mixin","windows"),P.object3D.scale.x=9.7,P.object3D.scale.y=3*y,P.object3D.position.x=a,P.object3D.position.y=3+3*y*.5,P.object3D.position.z=b+5-.15,P.object3D.rotation.y=Math.PI,s.appendChild(P);let N=document.createElement("a-entity");N.setAttribute("mixin","windows"),N.object3D.scale.x=9.7,N.object3D.scale.y=3*y,N.object3D.position.x=a-5+.15,N.object3D.position.y=3+3*y*.5,N.object3D.position.z=b,N.object3D.rotation.y=.5*Math.PI,s.appendChild(N);let S=document.createElement("a-entity");S.setAttribute("mixin","windows"),S.object3D.scale.x=9.7,S.object3D.scale.y=3*y,S.object3D.position.x=a-5+.15,S.object3D.position.y=3+3*y*.5,S.object3D.position.z=b,S.object3D.rotation.y=1.5*Math.PI,s.appendChild(S);let R=document.createElement("a-entity");R.setAttribute("mixin","windows"),R.object3D.scale.x=9.7,R.object3D.scale.y=3*y,R.object3D.position.x=a,R.object3D.position.y=3+3*y*.5,R.object3D.position.z=b-5+.15,s.appendChild(R);let H=document.createElement("a-entity");H.setAttribute("mixin","windows"),H.object3D.scale.x=9.7,H.object3D.scale.y=3*y,H.object3D.position.x=a,H.object3D.position.y=3+3*y*.5,H.object3D.position.z=b-5+.15,H.object3D.rotation.y=Math.PI,s.appendChild(H);let O=document.createElement("a-entity");O.setAttribute("mixin","windows"),O.object3D.scale.x=9.7,O.object3D.scale.y=3*y,O.object3D.position.x=a+5-.15,O.object3D.position.y=3+3*y*.5,O.object3D.position.z=b,O.object3D.rotation.y=.5*Math.PI,s.appendChild(O);let k=document.createElement("a-entity");k.setAttribute("mixin","windows"),k.object3D.scale.x=9.7,k.object3D.scale.y=3*y,k.object3D.position.x=a+5-.15,k.object3D.position.y=3+3*y*.5,k.object3D.position.z=b,k.object3D.rotation.y=1.5*Math.PI,s.appendChild(k)}for(let t=0;t<13;t++){const t=chooseRobotLocation();let e=document.createElement("a-entity");e.object3D.position.x=10*t.x-30+5,e.object3D.position.z=10*t.z-30+5,e.setAttribute("robot","xPos: "+t.x+"; zPos: "+t.z),SCENE.appendChild(e)}!function(){let t=document.createElement("a-entity");t.setAttribute("geometry","primitive: plane; buffer: false"),t.object3D.scale.x=70,t.object3D.scale.y=3,t.object3D.scale.z=.3,t.object3D.position.y=1.5,t.object3D.position.z=35,t.object3D.rotation.y=Math.PI,t.setAttribute("collision-obj",""),c.appendChild(t);let e=document.createElement("a-entity");e.setAttribute("geometry","primitive: plane; buffer: false"),e.object3D.scale.x=70,e.object3D.scale.y=3,e.object3D.scale.z=.3,e.object3D.position.y=1.5,e.object3D.position.x=-35,e.object3D.rotation.y=.5*Math.PI,e.setAttribute("collision-obj",""),c.appendChild(e);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: plane; buffer: false"),o.object3D.scale.x=70,o.object3D.scale.y=3,o.object3D.scale.z=.3,o.object3D.position.y=1.5,o.object3D.position.z=-35,o.setAttribute("collision-obj",""),c.appendChild(o);let i=document.createElement("a-entity");i.setAttribute("geometry","primitive: plane; buffer: false"),i.object3D.scale.x=70,i.object3D.scale.y=3,i.object3D.scale.z=.3,i.object3D.position.y=1.5,i.object3D.position.x=35,i.object3D.rotation.y=1.5*Math.PI,i.setAttribute("collision-obj",""),c.appendChild(i)}(),SCENE.appendChild(c),c.setAttribute("geometry-merger",""),c.setAttribute("material","color: #eee; src: #skyscraper"),c.className="interact",s.setAttribute("geometry-merger",""),s.setAttribute("material","shader: flat; color: #699; fog: false;"),SCENE.appendChild(s)}});</script>
        <script>let bgMusicOn=!0,audio_bgMusic=document.createElement("audio"),audioShoot=document.createElement("audio"),audioPickup=document.createElement("audio");!function(){function e(){var e=function(){var e,t,n,o,a,i=function(e){return Math.sin(6.283184*e)},c=[i,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){return 2>(e=e%1*4)?e-1:3-e}];this.init=function(i){e=i,t=i.endPattern,n=0,o=i.rowLen*i.patternLen*(t+1)*2,a=new Int32Array(o)},this.generate=function(){var r,u,p,d,s,f,l=new Int32Array(o),w=e.songData[n],m=e.rowLen,b=e.patternLen,v=0,L=0,h=!1,g=[];for(u=0;u<=t;++u){var R=w.p[u];for(p=0;p<b;++p){(s=R?w.c[R-1].f[p]:0)&&(w.i[s-1]=w.c[R-1].f[p+b]||0,16>s&&(g=[]));var M=c[w.i[15]],x=w.i[16]/512,k=Math.pow(2,w.i[17]-9)/m,S=w.i[18],T=w.i[19],y=135.82764118168*w.i[20]/44100,A=1-w.i[21]/255,P=1e-5*w.i[22],U=w.i[23]/32,O=w.i[24]/512,C=6.283184*Math.pow(2,w.i[25]-9)/m,_=w.i[26]/255,j=w.i[27]*m&-2;for(s=(u*b+p)*m,d=0;4>d;++d)if(r=R?w.c[R-1].n[p+d*b]:0){if(!g[r]){var D,W,B=g,E=r,I=f=void 0,K=w,F=r,q=c[K.i[0]],z=K.i[1],G=K.i[3],H=c[K.i[4]],J=K.i[5],N=K.i[8],Q=K.i[9],V=K.i[10]*K.i[10]*4,X=K.i[11]*K.i[11]*4,Y=K.i[12]*K.i[12]*4,Z=1/Y,$=K.i[13],ee=m*Math.pow(2,2-K.i[14]),te=new Int32Array(V+X+Y),ne=0,oe=0;for(D=W=0;W<V+X+Y;W++,D++){0<=D&&($=$>>8|(255&$)<<4,D-=ee,I=.003959503758*Math.pow(2,(F+(15&$)+K.i[2]-128-128)/12),f=.003959503758*Math.pow(2,(F+(15&$)+K.i[6]-128-128)/12)*(1+8e-4*K.i[7]));var ae=1;W<V?ae=W/V:W>=V+X&&(ae-=(W-V-X)*Z);var ie=I;G&&(ie*=ae*ae);var ce=q(ne+=ie)*z;ie=f,N&&(ie*=ae*ae),ce+=H(oe+=ie)*J,Q&&(ce+=(2*Math.random()-1)*Q),te[W]=80*ce*ae|0}B[E]=te}for(E=g[r],r=0,B=2*s;r<E.length;r++,B+=2)l[B]+=E[r]}for(r=0;r<m;r++)(B=l[d=2*(s+r)])||h?(h=y,S&&(h*=M(k*d)*x+.5),L+=(h=1.5*Math.sin(h))*(B=A*(B-L)-(v+=h*L)),B=3==T?L:1==T?B:v,P&&(B=1>(B*=P)?-1<B?i(.25*B):-1:1,B/=P),h=1e-5<(B*=U)*B,f=B*(1-(E=Math.sin(C*d)*O+.5)),B*=E):f=0,d>=j&&(f+=l[d-j+1]*_,B+=l[d-j]*_),l[d]=0|f,l[d+1]=0|B,a[d]+=0|f,a[d+1]+=0|B}}return++n/e.numChannels},this.createWave=function(){var e=44+2*o-8,t=e-36,n=new Uint8Array(44+2*o);for(n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]),e=0,t=44;e<o;++e){var i=a[e];i=-32767>i?-32767:32767<i?32767:i,n[t++]=255&i,n[t++]=i>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),o=Array(t),i=0;i<2*t;i+=1){var c=n+i;o[i]=0<e&&c<a.length?a[c]/32768:0}return o}};let t=new e;t.init({songData:[{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],p:[1,1,1,2,1,1,1,2,3],c:[{n:[122,,,,,,,,117,,,,,,,,118,,,,,,,,115],f:[]},{n:[146,,,,,,134,,,,,,122,,,,,,122,,122,,122,,122,,122,,122,,122],f:[]},{n:[110],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[,1,1,,,,1],c:[{n:[,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[0,255,116,1,0,255,120,0,1,127,4,6,35,0,0,0,0,0,0,2,14,0,10,32,0,0,0,0],p:[,,,,1,1,1,1,1,1],c:[{n:[135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],p:[,,,,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,,1,1,1,1,1,1],c:[{n:[,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[0,214,104,1,0,204,104,0,1,229,4,40,21,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[,,,,,,,,1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:9,numChannels:8});let n=new e;n.init({songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[],c:[]},{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[],c:[]},{i:[3,29,140,0,1,24,128,3,0,56,73,24,28,0,0,3,40,5,1,2,124,0,11,124,150,3,24,0],p:[],c:[]},{i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,0,0,2,255,0,0,32,47,3,146,2],p:[1],c:[{n:[116,116],f:[]}]}],rowLen:5513,patternLen:12,endPattern:0,numChannels:4});let o=new e;o.init({songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[],c:[]},{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[1],c:[{n:[147,,,,,135],f:[]}]}],rowLen:5513,patternLen:14,endPattern:0,numChannels:2});let a=new e;a.init({songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[],c:[]},{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[],c:[]},{i:[3,29,140,0,1,24,128,3,0,56,73,24,28,0,0,3,40,5,1,2,124,0,11,124,150,3,24,0],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146],f:[]}]}],rowLen:5513,patternLen:8,endPattern:0,numChannels:3});let i=new e;i.init({songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[2],c:[{n:[147,,,,,135],f:[]},{n:[147,159],f:[]}]}],rowLen:5513,patternLen:6,endPattern:0,numChannels:1});let c={bgMusic:{completed:!1},fxShoot:{completed:!1},fxShootRobot:{completed:!1},fxRobotLaser:{completed:!1},fxPickup:{completed:!1}};for(completedTracks=0,TOTAL_TRACKS=5;completedTracks<TOTAL_TRACKS;)!c.bgMusic.completed&&t.generate()>=1&&(c.bgMusic.wave=new Blob([t.createWave()]),c.bgMusic.completed=!0,completedTracks++),!c.fxShoot.completed&&n.generate()>=1&&(c.fxShoot.wave=new Blob([n.createWave()]),c.fxShoot.completed=!0,completedTracks++),!c.fxShootRobot.completed&&o.generate()>=1&&(c.fxShootRobot.wave=new Blob([o.createWave()]),c.fxShootRobot.completed=!0,completedTracks++),!c.fxRobotLaser.completed&&a.generate()>=1&&(c.fxRobotLaser.wave=new Blob([a.createWave()]),c.fxRobotLaser.completed=!0,completedTracks++),!c.fxPickup.completed&&i.generate()>=1&&(c.fxPickup.wave=new Blob([i.createWave()]),c.fxPickup.completed=!0,completedTracks++),completedTracks===TOTAL_TRACKS&&postMessage(c)}AFRAME.registerComponent("audio",{init:function(){window!=self&&e(),new Worker(URL.createObjectURL(new Blob(["("+e.toString()+")()"],{type:"text/javascript"}))).onmessage=function(e){audio_bgMusic.setAttribute("loop",!0),audio_bgMusic.src=URL.createObjectURL(e.data.bgMusic.wave,{type:"audio/wav"}),audio_bgMusic.volume=.4;let t=!0;document.body.addEventListener("click",function(){t&&(t=!1,bgMusicOn&&audio_bgMusic.play())}),document.body.addEventListener("keydown",function(){t&&(t=!1,bgMusicOn&&audio_bgMusic.play())}),audioShoot.src=URL.createObjectURL(e.data.fxShoot.wave,{type:"audio/wav"}),audioShoot.volume=.05,audioShootRobot.src=URL.createObjectURL(e.data.fxShootRobot.wave,{type:"audio/wav"}),audioRobotLaser.src=URL.createObjectURL(e.data.fxRobotLaser.wave,{type:"audio/wav"}),audioPickup.src=URL.createObjectURL(e.data.fxPickup.wave,{type:"audio/wav"})}}})}();</script>
    </head>
    <body>

        <a-scene star-system="count: 250" background="color: #057" fog="type: exponential; density: 0.1; color: #10454A" audio generate-level>

            <a-assets>
                <canvas id="groundmat"></canvas>
                <canvas id="skyscraper"></canvas>
                <canvas id="medikit"></canvas>
                <canvas id="welcomescreen"></canvas>
                <canvas id="hud"></canvas>
                <canvas id="mat-gateway"></canvas>
                <canvas id="mat-computer"></canvas>
                <canvas id="mat-endgame"></canvas>
                <canvas id="mat-playagain"></canvas>
                <canvas id="mat-credits"></canvas>
                <canvas id="mat-teleport-symbol"></canvas>
                
                <audio id="audio-robot-laser" src crossorigin="anonymous"></audio>
                <audio id="audio-shoot-robot" src crossorigin="anonymous"></audio>
                
                <a-mixin id="laser-mtl" material="color: red; opacity: 0.4; shader: flat"></a-mixin>
                <a-mixin id="metal" material="color: #aaa; emissive: #333"></a-mixin>
                <a-mixin id="teleporter" material="color: #888; metalness: 1"></a-mixin>
                <a-mixin id="robot-eyes" material="color: #f00; fog: false"></a-mixin>
                <a-mixin id="robot-ring" geometry="primitive: circle; radius: 0.6; segments: 8" material="shader: flat; color: #699; transparent: true; opacity: 0.3; fog: false" rotation="270 0 0" position="0 0.1 0"></a-mixin>
                <a-mixin id="windows" geometry="primitive: plane; buffer: false" material="shader: flat; color: #699; fog: false"></a-mixin>
                <a-mixin id="settings-control" geometry="primitive: plane" material="shader: flat; color: yellow" scale="0.15 0.15 0.15"></a-mixin>
            </a-assets>
            
            <a-entity id="game"></a-entity>
            
            <a-plane id="ground" class="interact" rotation="-90 0 0" width="80" height="80" material="src: #groundmat; roughness: 1; color: #ddd; repeat: 9 9"></a-plane>

            <a-entity light="type: ambient; intensity: 0.2;"></a-entity>
            <a-entity light="type: directional; intensity: 0.5; color: #078" position="50 30 50"></a-entity>
            
            <a-entity id="camera" key-controls player>
                <a-camera wasd-controls="enabled: false;" look-controls="pointerLockEnabled: true">
                    <a-entity id="player-shot" geometry="primitive: plane; width: 6; height: 3" position="0 0 -0.5" material="color: #f00; shader: flat; opacity: 0.3" visible="false"></a-entity>
                    <a-entity id="cursor" cursor="fuse: false" raycaster="objects: .interact; far: 40" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.03; radiusOuter: 0.034; segments-theta: 12; segments-phi: 1" material="color: black; shader: flat">
                        <a-entity class="line" line="start: -0.05 0 0; end: -0.006 0 0; color: black" line__2="start: 0.05 0 0; end: 0.006 0 0; color: black"></a-entity>
                        <a-entity class="line" line="start: 0 -0.05 0; end: 0 -0.006 0; color: black" line__2="start: 0 0.05 0; end: 0 0.006 0; color: black"></a-entity>
                    </a-entity>
                    <a-entity geometry="primitive: plane" id="hud-display" scale="0.008 0.004 0" material="src: #hud; shader: flat; transparent: true" position="0 0.006 -0.01"></a-entity>
                </a-camera>
                <a-entity id="controller" laser-controls raycaster="objects: .interact; far: 50" alt-movement>
                    
                    <a-entity id="teleport-symbol" geometry="primitive: plane; width: 0.15; height: 0.15" position="0 0 -0.5" visible="false" material="src: #mat-teleport-symbol; transparent: true; shader: flat"></a-entity>
                </a-entity>
            </a-entity>

        </a-scene>
            
        

        <script>let updateComputer;!function(){let t=document.querySelector("#groundmat");t.width=16,t.height=16;let e=t.getContext("2d");e.fillStyle="#10454A",e.fillRect(0,0,t.width,t.height),e.fillStyle="#111",e.fillRect(1,1,t.width-1,t.height-1)}(),function(){let t=document.querySelector("#medikit");t.width=8,t.height=8;let e=t.getContext("2d");e.fillStyle="#FFF",e.fillRect(0,0,8,8),e.fillStyle="#F00",e.fillRect(3,1,2,6),e.fillRect(1,3,6,2)}(),function(){let t=document.querySelector("#skyscraper");t.width=128,t.height=64;let e,l=t.getContext("2d");for(let i=0;i<t.width;i++)for(let o=0;o<t.height;o++)e=205+Math.floor(30*Math.random()),l.fillStyle="rgb("+e+","+e+","+e+")",l.fillRect(i,o,1,1)}(),function(){let t=document.querySelector("#welcomescreen");t.width=512,t.height=256;let e=t.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,t.width,t.height),e.fillStyle="#222",e.fillRect(2,2,t.width-4,t.height-4),e.font="italic 13.5px Arial",e.textAlign="center",e.fillStyle="#EED",e.fillText("What is this place? A teleporter experiment you were part of went very wrong.",t.width/2,20),e.fillText("There are robots everywhere, and they are trying to attack you. You must:",t.width/2,40),e.font="bold 15px Arial",e.fillText("GET BACK FROM ROBOT CITY",t.width/2,63),e.font="italic 13.5px Arial",e.fillText("They took the teleporter, but it must be around here somewhere. You are armed",t.width/2,84),e.fillText("with a laser blaster, which should help against the robots while you search for it.",t.width/2,104),e.font="bold 12px Arial",e.textAlign="left",e.fillText("VR CONTROLS:",10,130),e.fillText("DESKTOP CONTROLS:",t.width/2+10,130),e.font="12px Arial",e.fillRect(10,146,3,3),e.fillText("Press the touch-sensitive button to move",18,153),e.fillRect(10,173,3,3),e.fillText("OR Select a nearby point to teleport there",18,179),e.fillRect(10,197,3,3),e.fillText("Press the trigger to shoot",18,203),e.fillRect(10,221,3,3),e.fillText("Move next to objects to pick up / interact",18,227),e.fillRect(t.width/2+10,146,3,3),e.fillText("Arrow keys to move (or WASD)",t.width/2+18,153),e.fillRect(t.width/2+10,173,3,3),e.fillText("Left mouse click to shoot",t.width/2+18,179),e.fillRect(t.width/2+10,198,3,3),e.fillText("Walk up to objects to pick up / interact",t.width/2+18,203),e.font="8px Arial",e.fillText("Easy",258,230),e.fillText("Medium",310,230),e.fillText("Difficult",364,230),e.fillRect(258,240,130,1),e.fillRect(258,235,1,10),e.fillRect(322,235,1,10),e.fillRect(388,235,1,10),e.fillText("Music On",410,230),e.fillText("Music Off",460,230),e.fillRect(410,240,85,1),e.fillRect(410,235,1,10),e.fillRect(495,235,1,10)}(),function(){let t=document.querySelector("#mat-gateway");t.width=8,t.height=8;let e=t.getContext("2d");e.fillStyle="#00F",e.fillRect(2,0,1,t.height),e.fillRect(4,0,1,t.height),e.fillRect(6,0,1,t.height),e.fillRect(0,2,t.width,1),e.fillRect(0,5,t.width,1)}();let hasKeycard=!1;!function(){let t=document.querySelector("#mat-computer");t.width=128,t.height=128;let e=t.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,t.width,t.height),e.fillStyle="#EEE",e.fillRect(2,2,t.width-4,t.height/2),e.fillStyle="#EEE";for(let t=0;t<5;t++)for(let l=0;l<10;l++)e.fillRect(12*l+6,10*t+74,8,7);updateComputer=function(){e.font="10px Arial",hasKeycard?(e.fillStyle="#0A0",e.fillText("Access Granted...",6,40)):(e.fillStyle="#000",e.fillText("You need a keycard to get",6,15),e.fillText("through this door...",6,25)),document.querySelector("#computer").object3D.children[0].material.map.needsUpdate=!0}}();const endGame=function(){!function(){let t=document.querySelector("#mat-endgame");t.width=256,t.height=128;let e=t.getContext("2d");e.clearRect(0,0,t.width,t.height),e.fillStyle="#FFF",e.textAlign="center",PLAYER_HEALTH<=0?(e.font="bold 28px Arial",e.fillText("GAME OVER!",t.width/2,30),e.font="13px Arial",e.fillText("You were shot too many times",t.width/2,50)):(e.font="bold 28px Arial",e.fillText("WELL DONE!",t.width/2,30),e.font="13px Arial",e.fillText("You managed to Get Back From Robot City",t.width/2,50))}(),function(){let t=document.querySelector("#mat-credits");t.width=256,t.height=128;let e=t.getContext("2d");e.clearRect(0,0,t.width,t.height),e.fillStyle="#FFF",e.textAlign="center",e.font="bold 17px Arial",e.fillText("GET BACK FROM ROBOT CITY",t.width/2,20),e.font="11px Arial",e.fillText("Created by:",t.width/2,40),e.fillText("Thanks to:",t.width/2,77),e.font="14px Arial",e.fillText("Kevin Etchells",t.width/2,55),e.fillText("Caleb & Beth",t.width/2,93),e.fillText("Paul S",t.width/2,109),e.fillText("Craig W",t.width/2,125)}();let t=document.querySelector("a-scene"),e=document.createElement("a-entity"),l=document.createElement("a-entity"),i=document.createElement("a-entity");i.setAttribute("geometry","primitive: plane; width: 6; height: 3; buffer: false"),i.object3D.position.y=2,i.object3D.position.z=-6.2,e.appendChild(i);let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: plane; width: 6; height: 3; buffer: false"),o.object3D.position.x=-6.2,o.object3D.position.y=2,o.object3D.rotation.y=.5*Math.PI,l.appendChild(o);let r=document.createElement("a-entity");r.setAttribute("geometry","primitive: plane; width: 6; height: 3; buffer: false"),r.object3D.position.y=2,r.object3D.position.z=6.2,r.object3D.rotation.y=Math.PI,e.appendChild(r);let a=document.createElement("a-entity");a.setAttribute("geometry","primitive: plane; width: 6; height: 3; buffer: false"),a.object3D.position.x=6.2,a.object3D.position.y=2,a.object3D.rotation.y=1.5*Math.PI,l.appendChild(a),e.setAttribute("geometry-merger",""),l.setAttribute("geometry-merger",""),e.setAttribute("material","src: #mat-endgame; shader: flat; transparent: true; fog: false"),l.setAttribute("material","src: #mat-credits; shader: flat; transparent: true; fog: false"),t.appendChild(e),t.appendChild(l);let n=document.createElement("a-entity");n.setAttribute("geometry","primitive: plane; width: 1.8; height: 0.9"),n.setAttribute("material","src: #mat-playagain; shader: flat; fog: false"),n.object3D.position.y=1.2,n.object3D.position.z=-6.1,n.className="interact",n.setAttribute("playagain",""),n.setAttribute("animation","property: components.material.material.opacity; from: 1; to: 0.7; dur: 1500; loop: true; dir: alternate"),t.appendChild(n);let h=document.createElement("a-entity");h.setAttribute("geometry","primitive: plane; width: 1.8; height: 0.9"),h.setAttribute("material","src: #mat-playagain; shader: flat; fog: false"),h.object3D.position.y=1.2,h.object3D.position.z=6.1,h.object3D.rotation.y=Math.PI,h.className="interact",h.setAttribute("playagain",""),h.setAttribute("animation","property: components.material.material.opacity; from: 1; to: 0.7; dur: 1500; loop: true; dir: alternate"),t.appendChild(h),document.querySelector("#hud-display").remove(),SCENE.remove(),collisionObjects=[],player.position.x=0,player.position.z=0};let updateHUD;!function(){let t=document.querySelector("#mat-playagain");t.width=64,t.height=32;let e=t.getContext("2d");e.textAlign="center",e.fillStyle="#F00",e.fillRect(0,0,t.width,t.height),e.fillStyle="#FFF",e.font="10px Arial",e.fillText("Play Again",t.width/2,20)}(),function(){let t=document.querySelector("#hud-display"),e=document.querySelector("#hud");e.width=256,e.height=128;let l=e.getContext("2d");(updateHUD=function(){t&&(l.clearRect(0,0,e.width,e.height),l.fillStyle="#FFF",l.textAlign="center",l.font="14px Arial",l.fillText("HEALTH",70,15),l.fillText("KEYCARD",200,15),l.font="32px Arial",l.fillText(PLAYER_HEALTH,70,45),l.fillText(hasKeycard?"YES":"NO",200,45),t.object3D.children[0].material.map.needsUpdate=!0)})()}(),function(){let t=document.querySelector("#mat-teleport-symbol");t.width=32,t.height=32;let e=t.getContext("2d"),l=new Image;l.onload=function(){e.drawImage(l,0,0,t.width,t.height)},l.src="feet.png"}();</script>
        <script>const MAX_TELEPORT_DISTANCE=12;let SCENE=document.querySelector("#game"),camera=document.querySelector("#camera"),raycaster=document.querySelector("#controller").components.raycaster,audioRobotLaser=document.querySelector("#audio-robot-laser"),audioShootRobot=document.querySelector("#audio-shoot-robot"),playerShot=document.querySelector("#player-shot").object3D;document.querySelector("#controller").addEventListener("controllerconnected",function(){document.querySelector("#ground").setAttribute("ground",""),cursor&&(cursor.remove(),cursor=void 0);let o=document.querySelector("#hud-display");o.object3D.position.y=.15,o.object3D.position.z=-.5,o.object3D.scale.x=.16,o.object3D.scale.y=.08}),window.setTimeout(function(){camera.setAttribute("collision-cam","")},500);let cursor=document.querySelector("#cursor");!function(){let o=document.querySelector("#controller"),e=cursor.querySelectorAll(".line");document.addEventListener("mousedown",function(t){cursor?(audioShoot.readyState>=3&&(audioShoot.currentTime=0,audioShoot.play()),cursor.setAttribute("material","color: green; shader: flat"),e[0].object3D.children[0].material.color.g=1,e[0].object3D.children[1].material.color.g=1,e[1].object3D.children[0].material.color.g=1,e[1].object3D.children[1].material.color.g=1,window.setTimeout(function(){cursor&&(cursor.setAttribute("material","color: black; shader: flat"),e[0].object3D.children[0].material.color.g=0,e[0].object3D.children[1].material.color.g=0,e[1].object3D.children[0].material.color.g=0,e[1].object3D.children[1].material.color.g=0)},500)):(raycaster.getIntersection(ground)&&t.detail.intersection.distance<12?o.components.line.data.color="#0F0":(o.components.line.data.color="#F00",audioShoot.readyState>=3&&(audioShoot.currentTime=0,audioShoot.play())),window.setTimeout(function(){o.components.line.data.color="#74BEC1"},500))})}();</script>

    </body>
</html>
