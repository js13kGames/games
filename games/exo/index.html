<!doctype html><style>body{margin:0;overflow:hidden;user-select:none}</style><canvas id=c></canvas><script>!function(){var e,t,n=document.getElementById("c"),a=n.getContext("2d",{alpha:!1}),o=!1,r=!1,i=!1,l=!1,c=Math.PI,h=2*c,u=(e=0,t=[],{update:function(n){if(t.push(n),60<t.length){var a=0,o=1e3,r=0;t.shift(),t.forEach((function(e){a+=e,o=Math.min(o,e),r=Math.max(r,e)})),e=~~(a/60)+", "+~~o+" - "+~~r}},get Aa(){return e}});function f(e,t){var n=0;return{type:0,level:t,update:function(){if(!n--){n=2;var t=p.v(e,1e3);if(t&&.1<=We.i){We.i-=.1;var a=.5<Math.random(),o=a?2e3:se(e,t),i=de(e,t);e.ga=i,w.create(e.x,e.y,i,o,"#0F0"),a||(t.l-=2),.7<Math.random()&&r&&P[~~(Math.random()*P.length)].play()}}}}}function s(e,t){var n=120,o=0;return{type:3,level:t,update:function(){if(0>=n--&&30<=We.i&&p.v(e,400)){o=0,n=120,We.i-=30;for(var t=p.P.length;t--;){var a=p.P[t];400>se(a,e)&&p.ra(a,0,.05,100)}}400>o&&(o+=20)},g:function(){400>o&&(a.save(),a.beginPath(),a.strokeStyle="#c6e2ff",a.translate(e.x,e.y/A.c),a.scale(1,1/A.c),a.arc(0,0,o,0,h),a.stroke(),a.restore())}}}function d(e,t){var n=null,o=null,r=null;return{type:1,level:t,update:function(){if(.1<=We.i){if(n=p.v(e,1e3)){We.i-=.1,r=de(e,n),null==o&&(o=r),o+=.01*Math.sign(ge(r-o+c)-c);for(var t=p.P.length;t--;){var a=p.P[t],i=ge(o-de(e,a)+c)-c;1e3>se(a,e)&&.1>Math.abs(i)&&(a.l-=.5)}}}else n=null},g:function(){if(n){a.beginPath(),a.lineWidth=6+3*Math.sin(performance.now()/5);var t=a.createRadialGradient(e.x,e.y/A.c,100,e.x,e.y/A.c,1e3);t.addColorStop(0,"#FF0"),t.addColorStop(1,"rgba(0,0,0,0)"),a.strokeStyle=t,a.moveTo(e.x,e.y/A.c),a.lineTo(e.x-1e3*Math.cos(o),(e.y-1e3*Math.sin(o))/A.c),a.stroke()}}}}function g(e,t){function n(e){return e+20*Math.sin(e+performance.now()/100)}var o=[];return{type:4,level:t,update:function(){var t=p.P.length;o.length=0;var n=p.v(e,300);if(n)for(;t--&&.01<=We.i;){We.i-=.01;var a=p.P[t];if(300>=se(n,a)&&(n=a,o.push(a),a.l-=.1),10<o.length)break}},g:function(){if(o[0]){a.beginPath(),a.strokeStyle="#0FF",a.lineWidth=1;var t=o.length,r=o[t-1];a.moveTo(r.x,r.y/A.c);var i=r.x;for(r=r.y;t--;){var l=o[t],c=l.x;l=l.y,a.lineTo(n(i+(c-i)/2),n(r+(l-r)/2)/A.c),a.lineTo(n(c),n(l)/A.c),i=c,r=l}a.lineTo(e.x,e.y/A.c),a.stroke()}}}}function m(e,t){var n=20;return{type:2,level:t,update:function(){if(!n--){n=20;var t=p.v(e,1500);t&&.1<=We.i&&(T.create(e.x,e.y,de(e,t),se(e,t),"#00B"),We.i-=.1)}}}}for(var v=function(){function e(e){for(var n=[],a=0;a<t.length;a++)t[a].X===e&&n.push(t[a]);return n}var t=[];return{o:function(){t[0]={X:4,name:"Lasers",K:null,L:f},t[1]={X:4,name:"Beam",K:null,L:d},t[2]={X:4,name:"Rockets",K:null,L:m},t[3]={X:4,name:"EMP",K:null,L:s},t[4]={X:4,name:"Lightning",K:null,L:g}},La:e,get:function(n){if(!n.H)return[];var a=[];return e(n.type).forEach((function(e){var o=n.H,r=t[e],i=o.type===e?o.level+1:1;a.push({K:r.K,text:r.name+" (Level "+i+")",Ba:tt.na.bind(null,n,e,i),Ha:"Upgrading level "+o.level+" "+o.type+", to level "+i+" "+e})})),a},L:function(e){return t[e].L}}}(),y=function(){function e(){r=o=n=t=null,u=i=!1}var t,n,o,r,i=!1,l=0,c=0,u=!1;return{get da(){return i},va:function(e,n,a){i=!0,t=e,l=n,c=a},update:function(){if(n)if(b.la){if(b.update(),u){var a=de({x:b.B,y:b.C},n);switch(t){case 2:var i=tt.Fa(n,o,a);break;case 3:i=tt.Z(n,o,a);break;case 4:i=tt.xa(n,o,a),tt.na(i,l,1)}i.update(),We.M-=c,c=0,e(),k.complete(4)}}else{a=b.B;var h=b.C;i={x:a,y:h},a=tt.v(a,h),o=(o=se(n,i))>r?r:o,o=100*Math.round(o/100),u=70<=se(a,i)}else(n=ye(!0))&&(r=20*n.size)},g:function(){n&&(a.lineWidth=3,a.globalAlpha=.5,a.strokeStyle=u?"#0F0":"#F00",a.beginPath(),a.arc(n.x,n.y,o,0,h),a.stroke())},o:e}}(),p=function(){var e,t,n=[],o=[],r=[];return{P:o,o:function(){e=100*Math.ceil(2*et.size/100),t=e/100,n.length=0;for(var a=t*t;a--;)n.push([]);o.length=0},create:function(e,t,n){o.push({x:e,y:t,z:20*Math.random(),R:n,l:10,target:null,qa:10*Math.random(),J:[],w:null})},update:function(){for(var a=o.length;0<a--;){var i=o[a],l=i.x,h=i.y;for(l=n[(h=~~((h+e/2)/100))*t+(l=~~((l+e/2)/100))],i.w!==l&&(null!==i.w&&(i.w[i.w.indexOf(i)]=i.w[i.w.length-1],i.w.length--),i.w=l,l.push(i)),r.length=0,r[0]=5,r[1]=500,l=i.J.length;l--;)h=i.J[l],r[h.type]*=h.value,0>=h.time--&&(i.J[l]=i.J[i.J.length-1],i.J.length--);l={x:i.x,y:i.y},h=999999;for(var u=tt.h[0],f=tt.h.length;f--;){var s=tt.h[f];(1<s.type||We.f===s)&&s.I&&((s=se(tt.h[f],l))<h&&(h=s,u=f))}for(i.target=tt.h[u],i.target&&(i.R+=.01*(ge(de(i,i.target)-i.R+c)-c),i.x-=r[0]*Math.cos(i.R),i.y-=r[0]*Math.sin(i.R),0>=i.qa--&&(i.qa=10,(l=se(i,i.target))<r[1]&&(h=.5<Math.random(),w.create(i.x,i.y,de(i,i.target),h?2e3:l,"#F00"),h||(i.target.l-=.2)))),0>=i.l&&(l=a,x.create(o[l].x,o[l].y),o[l]=o[o.length-1],o.length--),u=(h=i.w).length;u--;)if(i!==(l=h[u])&&200>fe(i,l)){h=(i.x-l.x)/4,u=(i.y-l.y)/4,i.x+=h,i.y+=u,l.x-=h,l.y-=u;break}}},g:function(){for(var e=-O.width/2,t=-O.height/2,n=o.length;n--;){var r=o[n];a.save(),a.translate(r.x,r.y/A.c-r.z*A.c),a.scale(2,2/A.c),a.rotate(r.R),a.drawImage(O,e,t),a.restore()}},v:function(e,t){for(var n=null,a=o.length;a--;){var r=o[a],i=se(e,r);i<t&&(n=r,t=i)}return n},ra:function(e,t,n,a){e.J.push({type:t,value:n,time:a})}}}(),x={create:function(e,t){for(var n=50;n--;)w.create(e,t,Math.random()*h,200,"#FF0",5+5*Math.random())}},w=function(){var e={};return{create:function(t,n,a,o,r,i){!e[r]&&(e[r]=[]),e[r].push({x:t,y:n,s:a,G:o-50,fa:i||50})},update:function(){for(var t in e)for(var n=e[t],a=n.length;a--;){var o=n[a];o.G-=o.fa,0>=o.G?((o=n)[a]=o[o.length-1],--o.length):(o.x-=Math.cos(o.s)*o.fa,o.y-=Math.sin(o.s)*o.fa)}},g:function(){for(var t in a.globalAlpha=1,a.lineWidth=1,e){a.strokeStyle=t,a.beginPath();for(var n=e[t].length;n--;){var o=e[t][n],r=o.x+10*Math.cos(o.s),i=o.y/A.c+10*Math.sin(o.s);a.moveTo(o.x,o.y/A.c),a.lineTo(r,i)}a.stroke()}},clear:function(){e={}}}}(),b=function(){function e(e,n,o,r){return t>e&&t<e+o&&a>n&&a<n+r}var t=0,a=0,o=0,r=0,i=0,l=!1,c=!1,h=!1;return window.addEventListener("mousemove",(function(e){var i=n.getBoundingClientRect();t=e.clientX-i.left,a=e.clientY-i.top,o=(t+A.x-n.width/2)/A.zoom,r=(a+A.y-n.height/2)*A.c/A.zoom}),!1),window.addEventListener("mousedown",(function(){h=l=!0}),!1),window.addEventListener("mouseup",(function(){h=!1,A.ia||(c=!0)}),!1),window.addEventListener("wheel",(function(e){i=Math.sign(e.deltaY)}),!1),{update:function(){c=l=!1,i=0},ka:e,ta:function(t,n,a,o){return l&&e(t,n,a,o)},get x(){return t},get y(){return a},get B(){return o},get C(){return r},get click(){return l},get la(){return c},get ya(){return h},get ma(){return i}}}(),T=function(){var e={};return{create:function(t,n,a,o,r){e[r]||(e[r]=[]),e[r].push({x:t,y:n,T:a,G:o-20})},update:function(){for(var t in e)for(var n=e[t],a=n.length;a--;){var o=n[a],r=p.v(o,500),i=r?se(o,r):30;0>=o.G--||30>i?(e[t].splice(a,1),x.create(o.x,o.y),r&&(r.l-=10)):(r&&(o.T+=.05*(ge(de(o,r)-o.T+c)-c)),o.x-=20*Math.cos(o.T),o.y-=20*Math.sin(o.T))}},g:function(){var t,n=te.width/2,o=te.height/2;for(t in e)for(var r=e[t],i=r.length;i--;){var l=r[i];a.save(),a.translate(l.x,l.y/A.c),a.rotate(l.T),a.drawImage(te,n,o),a.restore()}}}}(),F=function(){function e(e,n){var a=document.createElement("LI"),o=document.createElement("LABEL"),r=document.createElement("INPUT");o.textContent=e,r.type="checkbox",a.appendChild(r),a.appendChild(o),t.appendChild(a),r.onclick=function(){S.set(e,r.checked),n.call(r)},"true"===S.get(e,"true")&&(r.checked=!0,n.call(r,!0))}var t=document.createElement("UL"),n=t.style;return n.position="absolute",n.right="0px",n.bottom="0px",n.color="#FFF",n.margin="16px",n.listStyle="none",n.fontFamily="monospace",document.body.appendChild(t),{o:function(){e("tutorial",(function(){l=this.checked})),e("music",(function(e){o=this.checked,e||Be(Le)})),e("sfx",(function(){r=this.checked})),e("voice",(function(){i=this.checked}))}}}(),S={set:function(e,t){try{window.localStorage.setItem(e,t)}catch(e){console.warn(e)}},get:function(e,t){try{return window.localStorage.getItem(e)||t}catch(e){return console.warn(e),t}}},M={Y:function(){for(var e=[],t=tt.Ia(me(60,100,50),100,0,0),n=2+~~(3*Math.random()),a=1e3,o=0;o<n;o++){var r=20+~~(30*Math.random()),i=tt.f(me(-1,39,62),r,t,a,.003,Math.random()*h);e.push(i),a+=100*~~((500+~~(500*Math.random()))/100);for(var l=~~(3*Math.random()),c=200,u=0;u<l;u++)tt.f(me(-1,39,62),~~(.1*r+Math.random()*r*.3),i,c,.01,Math.random()*h),c+=100}return We.create(e[0]),tt.Z(e[0],100,.33*h),tt.Z(e[0],100,.66*h),tt.Z(e[0],100,.99*h),{size:a}}},k=function(){function e(){t[h]&&(u=t[h].text,(r=!0===t[h].end)&&S.set("tutorial",!1),we(u,!0))}var t=[{text:"Welcome to Exo... You are the commander of a long forgotten expedition to a distant star. Many hundreds of years ago you and your people set out to inhabit the galaxy. Upon reaching your destination, you were able to establish a base on a nearby planet. Not long after, you find yourself under seige from mysterious forces. Are they aliens, or maybe your own race, hundreds of years ahead of you in technology, catching up to you... Either way, this is your home now... Defend it.",event:0,G:0},{text:"You can move your view of the star system around by clicking and dragging anywhere on-screen. YOu can also use the W, A, S and D, or the arrow keys.",event:1},{text:"You can also zoom in and out with your mouse wheel.",event:3},{text:"The SPACEBAR can be used to pause and un-pause the game. Try it now.",event:2},{text:"To survive in this star system, you will have to build to gather resources and defend yourself.",event:2},{text:"At the top of your screen is general information. From left to right. The structural status of your base, when this hits 0 you are no more. The number of enemy waves you have survived. Seconds until the next wave. Your stored minerals. And your stored energy.",event:2},{text:"At the bottom of your screen are your construction options. Satellites are use to generate energy from the sun and relay connection to your main base. Mining stations gather minerals from planets. The rest are just weapons of destruction.",event:2},{text:"Try constructing something now. Select one of the icons. Select the star or a planet to build station in orbit of. Then select the orbit distance.",event:4},{text:"Satellites and stations can only function with a connection to your main base. Anything not connected is considered offline, and will do nothing. However, when offline, they will be undetectable by enemy ships.",event:4},{text:"To extend your functional range, you will have to build multiple satellites to relay the signal. Anything close enough to your base is already online, new satellites may have to be constructed around other celestial bodies. The connection is shown with green lines branching out from your base.",event:4},{text:"That's as much as I can help you. My programmers thought it wise not to provide me with information on your weapon systems. You will have to work that out yourself.",event:4},{text:"Good luck...",event:4,end:!0}],o=!1,r=!1,i=60,c=[],h=0,u="";return{get text(){return u},get end(){return r},start:function(){l?(at=2,o=!0,e()):r=!0},update:function(){if(""!==u){var a=t[h];void 0!==a.G&&0>=a.G--&&(c[a.event]=!0),!0===c[a.event]&&b.ta(20,n.height/2-20-100,500,200)&&(h++,u="",i=60)}else o&&0>=i--&&e()},g:function(){if(""!==u){a.fillStyle="rgba(0,0,0,0.5)",a.strokeStyle="#FFF",a.lineWidth=2,a.beginPath(),a.rect(20,n.height/2-20-100,500,200),a.fill(),a.stroke(),a.fillStyle="#FFF",a.textAlign="left",a.textBaseline="top";for(var e=n.height/2-96-16,o=u.split(" "),r="",i=0;i<o.length;i++){var l=r+o[i]+" ";484<a.measureText(l).width&&0<i?(a.fillText(r,28,e),r=o[i]+" ",e+=20):r=l}a.fillText(r,28,e),!0===c[t[h].event]&&(a.textAlign="center",a.font="small-caps 600 12px monospace",a.fillText("click to continue...",270,n.height/2+55))}},complete:function(e){c[e]=!0}}}(),A=function(){function e(){a.setTransform(1,0,0,1,0,0)}var t=0,o=0,r=0,i=0,l=0,c=0,h=0,u=0,f=1,s=1,d=2,g=!1,m={};return window.addEventListener("keydown",(function(e){m[e.key.toUpperCase()]=!0}),!1),window.addEventListener("keyup",(function(e){m[e.key.toUpperCase()]=!1}),!1),{get x(){return t},get y(){return o},get zoom(){return f},get c(){return d},get ia(){return g},o:function(){t=We.f.x,o=We.f.y/2,r=We.f.x,i=We.f.y/2,s=f=1,d=2},clear:function(){e(),a.clearRect(0,0,n.width,n.height)},reset:e,position:function(){a.setTransform(f,0,0,f,-t+n.width/2,-o+n.height/2)},update:function(){0!==b.ma&&(s=ve(s-.1*b.ma,.1,2)),d=Math.min(f-.1+1,2),(m.ARROWUP||m.W)&&(i-=50),(m.ARROWDOWN||m.S)&&(i+=50),(m.ARROWLEFT||m.A)&&(r-=50),(m.ARROWRIGHT||m.D)&&(r+=50),b.click&&(l=t,c=o,h=b.x,u=b.y);var e=5<Math.abs(h-b.x),n=5<Math.abs(u-b.y);0!==h&&b.ya&&(g||e||n)?(g=!0,r=l+(h-b.x),i=c+(u-b.y),k.complete(1)):(g&&(h=0),g=!1),e=f,e=(f+=.001>Math.abs(f-s)?0:(s-f)/5)-e,.001<Math.abs(e)&&(t+=b.B*e,o+=b.C*e,r+=b.B*e,i+=b.C*e,k.complete(3)),t+=.001>Math.abs(t-r)?0:(r-t)/5,o+=.001>Math.abs(o-i)?0:(i-o)/5}}}(),C=[2,10,116,1,3,0,164,255,0,0,0,0,64,0,0,0,0,6,0,2,255,0,0,28,0,0,0,6],P=[],R=40;R--;)P[R]={ea:[{b:C,p:[1],m:[{n:[206-R],a:[]}]}],aa:5513,$:2,ba:0,ca:1};var E={ea:[{b:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],m:[{n:[163],a:[]}]}],aa:5513,$:1,ba:0,ca:1},I=document.createElement("CANVAS"),L=I.getContext("2d");I.width=40,I.height=40,L.fillStyle="#FFF",L.strokeStyle="#FFF",L.lineWidth=4,L.fillRect(0,31,40,5),L.fillRect(6,36,28,5),L.beginPath(),L.moveTo(10,31),L.lineTo(15,26),L.lineTo(25,26),L.lineTo(30,31),L.fill(),L.beginPath(),L.moveTo(21,26),L.lineTo(21,21),L.stroke(),L.lineWidth=2,L.beginPath(),L.moveTo(21,19),L.lineTo(21,0),L.stroke();var B=document.createElement("CANVAS"),W=B.getContext("2d");B.width=100,B.height=100,W.translate(50,50),W.fillStyle="#444",W.moveTo(-20,0),W.lineTo(0,50),W.lineTo(20,0),W.fill(),W.fillStyle="#a33",W.beginPath(),W.scale(1,.5),W.arc(0,0,40,0,h),W.fill(),W.fillStyle="#222",W.beginPath(),W.arc(0,-5,35,0,h),W.fill();var N=document.createElement("CANVAS"),z=N.getContext("2d");N.width=100,N.height=100,z.translate(50,50),z.fillStyle="#444",z.beginPath(),z.arc(0,0,15,0,h),z.fill(),z.lineWidth=5,z.strokeStyle="#666",z.beginPath(),z.moveTo(0,-6),z.lineTo(-30,-6),z.moveTo(0,6),z.lineTo(-30,6),z.stroke();var V=document.createElement("CANVAS"),j=V.getContext("2d");V.width=40,V.height=40,j.fillStyle="#FFF",j.strokeStyle="#FFF",j.lineWidth=2,j.fillRect(0,31,40,5),j.fillRect(6,36,28,5),j.beginPath(),j.rect(19,20,2,10),j.arc(20,20,5,0,h),j.fill(),j.beginPath(),j.arc(20,20,18,0,h),j.stroke();var O,U=document.createElement("CANVAS"),G=U.getContext("2d");U.width=8,U.height=8,G.fillStyle="#F00",G.moveTo(0,4),G.lineTo(8,0),G.lineTo(6,4),G.lineTo(8,8),G.fill(),O=U;var H=document.createElement("CANVAS"),Y=H.getContext("2d");H.width=40,H.height=40,Y.fillStyle="#FFF",Y.strokeStyle="#FFF",Y.lineWidth=2,Y.fillRect(0,31,40,5),Y.fillRect(6,36,28,5),Y.beginPath(),Y.moveTo(10,31),Y.lineTo(15,26),Y.lineTo(25,26),Y.lineTo(30,31),Y.fill(),Y.beginPath(),Y.moveTo(17,26),Y.lineTo(14,21),Y.moveTo(23,26),Y.lineTo(20,21),Y.moveTo(5,6),Y.lineTo(2,1),Y.moveTo(16,13),Y.lineTo(13,8),Y.stroke();var D=document.createElement("CANVAS"),J=D.getContext("2d");D.width=40,D.height=40,J.fillStyle="#FFF",J.strokeStyle="#FFF",J.lineWidth=1,J.fillRect(0,31,40,5),J.fillRect(6,36,28,5),J.beginPath(),J.rect(19,20,2,10),J.arc(20,20,5,0,h),J.fill(),J.beginPath(),J.moveTo(20,20),J.lineTo(0,20),J.moveTo(20,20),J.lineTo(40,20),J.moveTo(20,20),J.lineTo(20,0),J.moveTo(20,20),J.lineTo(0,0),J.moveTo(20,20),J.lineTo(40,0),J.stroke();var K=document.createElement("CANVAS"),X=K.getContext("2d");K.width=40,K.height=40,X.fillStyle="#FFF",X.strokeStyle="#FFF",X.lineWidth=2,X.fillRect(-4,-4,48,9),X.fillRect(2,5,4,4),X.fillRect(34,5,4,4),X.fillRect(12,5,16,8),X.fillRect(18,5,4,24),X.beginPath(),X.moveTo(12,23),X.lineTo(20,29),X.lineTo(28,23),X.stroke(),X.beginPath(),X.arc(20,70,40,0,h),X.stroke();var q=document.createElement("CANVAS"),Z=q.getContext("2d");q.width=20,q.height=140,Z.fillStyle="#ddd",Z.fillRect(8,50,4,40),Z.fillStyle="#b33",Z.fillRect(2,30,15,30),Z.fillRect(2,80,15,30),Z.fillStyle="#9badb7",Z.fillRect(2,65,17,10),Z.fillRect(0,66,2,8);var $=document.createElement("CANVAS"),Q=$.getContext("2d");$.width=128,$.height=64,Q.lineWidth=2,Q.fillStyle="rgba(255,0,0,0.2)",Q.strokeStyle="#F00",Q.arc(32,32,30,0,h),Q.stroke(),Q.fill(),Q.beginPath(),Q.fillStyle="rgba(0,255,0,0.2)",Q.strokeStyle="#0F0",Q.arc(96,32,30,0,h),Q.stroke(),Q.fill();var _=document.createElement("CANVAS"),ee=_.getContext("2d");_.width=160,_.height=80,ee.fillStyle="#FFF",ee.fillRect(10,10,20,60),ee.fillRect(50,10,20,60),ee.moveTo(90,10),ee.lineTo(150,40),ee.lineTo(90,70),ee.fill();var te,ne=document.createElement("CANVAS"),ae=ne.getContext("2d");ne.width=16,ne.height=8,ae.fillStyle="#0F0",ae.moveTo(0,4),ae.lineTo(16,0),ae.lineTo(16,8),ae.fill(),te=ne;var oe=document.createElement("CANVAS"),re=oe.getContext("2d");oe.width=40,oe.height=40,re.fillStyle="#FFF",re.strokeStyle="#FFF",re.lineWidth=4,re.fillRect(0,31,40,5),re.fillRect(6,36,28,5),re.beginPath(),re.moveTo(10,31),re.lineTo(17,22),re.lineTo(17,12),re.lineTo(20,2),re.lineTo(23,12),re.lineTo(23,22),re.lineTo(30,31),re.lineTo(15,24),re.lineTo(25,24),re.fill();var ie=document.createElement("CANVAS"),le=ie.getContext("2d");ie.width=40,ie.height=40,le.fillStyle="#FFF",le.strokeStyle="#FFF",le.lineWidth=2,le.translate(20,20),le.rotate(c/4),le.fillRect(-9,-4,8,8),le.fillRect(-7,-8,4,16),le.fillRect(-12,8,14,24),le.fillRect(-12,-32,14,24),le.beginPath(),le.arc(30,0,20,0,h),le.stroke();var ce=document.createElement("CANVAS"),he=ce.getContext("2d");function ue(e,t){return function(){e(),t()}}function fe(e,t){var n=e.x-t.x;return n*n+(e=e.y-t.y)*e}function se(e,t){return Math.sqrt(fe(e,t))}function de(e,t){return Math.atan2(e.y-t.y,e.x-t.x)}function ge(e){return e-Math.floor(e/h)*h}function me(e,t,n){return"hsl("+(0>e?360*Math.random():e)+","+(0>t?100*Math.random():t)+"%,"+(0>n?100*Math.random():n)+"%)"}function ve(e,t,n){return e>n?n:e<t?t:e}function ye(e){var t=null;if(b.la){Ne.oa(null);var n=tt.v(b.B,b.C);se(n,{x:b.B,y:b.C})<ot&&!b.target&&!b.ia&&(we(n.name),!e||1!=n.type&&0!=n.type?y.da||Ne.oa(n,b):t=n,r&&E.play())}return t}ce.width=20,ce.height=140,he.fillStyle="#dddddd",he.fillRect(8,50,4,40),he.fillStyle="#639bff",he.fillRect(2,0,15,60),he.fillRect(2,80,15,60),he.fillStyle="#9badb7",he.fillRect(2,65,17,10),he.fillRect(0,66,2,8);var pe=window.speechSynthesis,xe=!1;function we(e,t){t||Ne.sa(e,240),xe&&i&&(pe.cancel(),e.split(". ").forEach((function(e){(e=new SpeechSynthesisUtterance(e+".")).rate=1,e.pitch=.1,e.lang="en",pe.speak(e)})))}function be(){function e(e){return Math.sin(6.283184*e)}var t,n,a,o,r,i=[e,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){return 2>(e=e%1*4)?e-1:3-e}];this.o=function(e){t=e,n=e.ba,a=0,o=e.aa*e.$*(n+1)*2,r=new Int32Array(o)},this.Y=function(){var l,c,h,u,f,s,d=new Int32Array(o),g=t.ea[a],m=t.aa,v=t.$,y=0,p=0,x=!1,w=[];for(c=0;c<=n;++c){var b=g.p[c];for(h=0;h<v;++h){(f=b?g.m[b-1].a[h]:0)&&(g.b[f-1]=g.m[b-1].a[h+v]||0,16>f&&(w=[]));var T=i[g.b[15]],F=g.b[16]/512,S=Math.pow(2,g.b[17]-9)/m,M=g.b[18],k=g.b[19],A=135.82764118168*g.b[20]/44100,C=1-g.b[21]/255,P=1e-5*g.b[22],R=g.b[23]/32,E=g.b[24]/512,I=6.283184*Math.pow(2,g.b[25]-9)/m,L=g.b[26]/255,B=g.b[27]*m&-2;for(f=(c*v+h)*m,u=0;4>u;++u)if(l=b?g.m[b-1].n[h+u*v]:0){if(!w[l]){var W,N,z=w,V=l,j=s=void 0,O=g,U=l,G=i[O.b[0]],H=O.b[1],Y=O.b[3],D=i[O.b[4]],J=O.b[5],K=O.b[8],X=O.b[9],q=O.b[10]*O.b[10]*4,Z=O.b[11]*O.b[11]*4,$=O.b[12]*O.b[12]*4,Q=1/$,_=O.b[13],ee=m*Math.pow(2,2-O.b[14]),te=new Int32Array(q+Z+$),ne=0,ae=0;for(W=N=0;N<q+Z+$;N++,W++){0<=W&&(_=_>>8|(255&_)<<4,W-=ee,j=.003959503758*Math.pow(2,(U+(15&_)+O.b[2]-128-128)/12),s=.003959503758*Math.pow(2,(U+(15&_)+O.b[6]-128-128)/12)*(1+8e-4*O.b[7]));var oe=1;N<q?oe=N/q:N>=q+Z&&(oe-=(N-q-Z)*Q);var re=j;Y&&(re*=oe*oe);var ie=G(ne+=re)*H;re=s,K&&(re*=oe*oe),ie+=D(ae+=re)*J,X&&(ie+=(2*Math.random()-1)*X),te[N]=80*ie*oe|0}z[V]=te}for(V=w[l],l=0,z=2*f;l<V.length;l++,z+=2)d[z]+=V[l]}for(l=0;l<m;l++)(z=d[u=2*(f+l)])||x?(x=A,M&&(x*=T(S*u)*F+.5),p+=(x=1.5*Math.sin(x))*(z=C*(z-p)-(y+=x*p)),z=3==k?p:1==k?z:y,P&&(z=1>(z*=P)?-1<z?e(.25*z):-1:1,z/=P),x=1e-5<(z*=R)*z,s=z*(1-(V=Math.sin(I*u)*E+.5)),z*=V):s=0,u>=B&&(s+=d[u-B+1]*L,z+=d[u-B]*L),d[u]=0|s,d[u+1]=0|z,r[u]+=0|s,r[u+1]+=0|z}}return++a/t.ca},this.ha=function(){var e=44+2*o-8,t=e-36,n=new Uint8Array(44+2*o);for(n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]),e=0,t=44;e<o;++e){var a=r[e];a=-32767>a?-32767:32767<a?32767:a,n[t++]=255&a,n[t++]=a>>8&255}return n}}pe&&(xe=!0,0>=pe.getVoices().length&&(pe.onvoiceschanged=function(){pe.getVoices()}));var Te=function(){var e,t,n,a,o=["enemies, approaching","we are under attack","enemy, in-bound","hostiles detected"];return{o:function(){e=0,a=30,n=60*(t=60)},update:function(){if(k.end&&!n--){for(var r=et.size,i=a;i--;){var l=Math.random()*h;p.create(Math.cos(l)*r,Math.sin(l)*r,l)}e++,t=Math.max(t-2,2),a+=30,n=60*t,we(o[~~(Math.random()*o.length)])}},get Ja(){return n},get wa(){return e}}}(),Fe=!0,Se=[],Me=!0,ke=[];E=Re(E);for(var Ae=0;Ae<P.length;Ae++)P[Ae]=Re(P[Ae]);var Ce,Pe=new be;function Re(e){var t=new be;return t.V=new Audio,t.U=!0,t.o(e),ke.push(t),t.V}Pe.V=new Audio,Pe.U=!0,Pe.o({ea:[{b:[2,0,92,0,3,255,92,0,0,0,5,6,58,0,0,0,0,0,1,2,135,0,0,32,147,6,121,6],p:[,,,,1,1,1,1,1,1,1,1],m:[{n:[144,,144,,144,144,,144,,,144,,144,144,,142,144,,144,,144,144,,144,,,144,,144,144,,149,,,,142,,,,,,,,,,,,,,,,142],a:[]}]},{b:[0,0,140,0,0,7,99,1,0,17,0,11,32,0,0,2,127,6,0,2,34,52,4,53,108,5,8,2],p:[,,,2,2,,,2,2,2],m:[{n:[],a:[]},{n:[142,,142,142,142,142,,142,,,142,142,142,142,,,142,,142,142,142,142,,142,,,142,142,142,142,142],a:[]}]},{b:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[],m:[]},{b:[0,147,116,1,0,97,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,4,,4,4,4,,,4,,,4,4],m:[{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[,,,137,139,,,,,,,137,139,137,,,,,,137,139,,,,,,,137,139,139,,139],a:[]}]},{b:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],m:[]},{b:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],m:[]},{b:[0,43,128,0,0,43,128,12,0,0,12,0,72,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[11],m:[{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[139,,,,151,,,,149,,,,,,,,139,,,,151,,,,149],a:[]}]},{b:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,12],m:[{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[140,,,,154,,,,152,,,,,,,,140,,,,154,,,,152],a:[]}]},{b:[2,192,128,0,2,146,140,18,0,0,121,127,120,0,0,0,0,0,0,2,5,0,0,32,0,0,0,0],p:[13,13,13,13,,13],m:[{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[140,,,,,,,,,,,,,,,,137],a:[]}]},{b:[2,97,116,0,3,80,106,4,0,0,127,127,127,3,2,2,44,15,1,2,5,44,48,41,147,4,12,0],p:[,,14,21,,,,,14,21,14,21],m:[{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[142,,,,,,,,,,,,,,,,144],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[],a:[]},{n:[146,,,,,,,,,,,,,,,,148],a:[]}]}],aa:11025,$:32,ba:12,ca:10}),Se.push(Pe),Ce=Pe.V;var Ee=0,Ie=0,Le=Ce;function Be(e){null!==e&&(o?(Le=e,e.Ca||(e.Ca=!0,e.addEventListener("ended",(function(){this.currentTime=0,Be(e)}),!1)),Le.play(),e.volume=.5):Le&&Le.pause())}var We=function(){var e,t,n,a,o,r,i;return{create:function(l){e=l,t=100,n=.025,a=.05,o=501,r=50,i=10},get f(){return e},get l(){return t},get Da(){return n},get za(){return a},get ua(){return o},get M(){return r},get i(){return i},set M(e){r=e},set i(e){i=e}}}(),Ne=function(){function e(e,t,n){var a=tt.F(e,t);return n?We.M>=a:(we("Select an area to build the "+tt.getName(e,t)),y.va(e,t,a),!1)}var t,o={x:0,y:0},r=[],i="",l=[];return{pa:function(){var i=n.width/2,l=n.height;t=function(){var e=n.width/2-213,t=n.height-128-120,o=[],r={x:e,y:t,target:null,update:function(){null!==r.target&&o.forEach((function(e){e.update()}))},g:function(){if(null!==r.target){a.fillStyle="rgba(0,0,0,0.5)",a.strokeStyle="#FFF",a.lineWidth=2,a.fillRect(e,t,426,120),a.strokeRect(e,t,426,120),a.fillStyle="#fff",a.textAlign="left",a.textBaseline="top",a.font="16px monospace",a.fillText((We.f===r.target?"Base":"")+r.target.name,e+120,t+16);var n=r.target.cache,i=Math.max(n.width,n.height)/104;a.drawImage(n,e+8+52-n.width/i/2,t+8+52-n.height/i/2,n.width/i,n.height/i),o.forEach((function(e){e.g()}))}},Ea:function(n,a){r.x=e=n,r.y=t=a},Ka:function(e){o.length=0;var t=128;e.forEach((function(e){o.push(ze(r,t,60,e.text,e.K,e.Ba,e.Ha)),t+=60}))}};return r}(),r=[t,ze(o,i-24-180,l-64,"Satellite ("+tt.F(2,void 0)+" minerals)",ie,e.bind(null,2,void 0)),ze(o,i-24-120,l-64,"Mining Station ("+tt.F(3,void 0)+" minerals)",K,e.bind(null,3,void 0)),ze(o,i-24-60,l-64,"Laser Platform ("+tt.F(4,0)+" minerals)",H,e.bind(null,4,0)),ze(o,i-24,l-64,"Beam Platform ("+tt.F(4,1)+" minerals)",I,e.bind(null,4,1)),ze(o,i+36,l-64,"Rocket Platform ("+tt.F(4,2)+" minerals)",oe,e.bind(null,4,2)),ze(o,i+96,l-64,"EMP Platform ("+tt.F(4,3)+" minerals)",V,e.bind(null,4,3)),ze(o,i+156,l-64,"Lighting Platform ("+tt.F(4,4)+" minerals)",D,e.bind(null,4,4))]},update:function(){i="",r.forEach((function(e){e.update()}));for(var e=l.length;e--;)l[e].time--||l.splice(e,1)},g:function(){r.forEach((function(e){e.g()}));var e=n.width/2,t=ve(n.width/1920,.5,1);a.globalAlpha=1,a.fillStyle="#FFF",a.textAlign="center",a.textBaseline="middle",a.font="700 48px monospace",a.fillText(~~(Te.Ja/60),n.width/2,96),a.font="small-caps 700 24px monospace",a.fillText("next wave in",e,48),a.fillText("minerals",e+300*t,48),a.fillText(~~We.M,e+300*t,80),a.fillText("energy",e+600*t,48),a.fillText(~~We.i,e+600*t,80),a.fillText("survived",e-300*t,48),a.fillText(Te.wa+" waves",e-300*t,80),a.fillText("base status",e-600*t,48),a.fillText(~~We.f.l+"%",e-600*t,80),a.font="small-caps 700 16px monospace",a.fillText(i,e,n.height-96),a.textAlign="left",a.textBaseline="bottom";var o=20;l.forEach((function(e){a.fillText('"'+e.text+'"',20,n.height-o),o+=20})),k.g(),a.textAlign="left",a.textBaseline="bottom",a.font="small-caps 500 12px monospace",a.fillText("FPS: "+u.Aa,10,26),a.drawImage(_,2===at?0:80,0,80,80,n.width-90,30,60,60)},sa:function(e,t){l.push({text:e,time:t})},oa:function(e,n){t.target=e,void 0!==n&&t.Ea(n.x,n.y)},Ga:function(e){i=e}}}();function ze(e,t,n,o,r,i,l){return{update:function(){b.ka(e.x+t,e.y+n,48,48)&&(Ne.Ga(o),b.click&&i&&i(!0)&&(i(),l&&we(l)))},g:function(){a.globalAlpha=i&&!i(!0)?.2:1,a.fillStyle="rgba(0,0,0,0.5)",a.strokeStyle="#FFF",a.lineWidth=2,a.fillRect(e.x+t,e.y+n,48,48),a.strokeRect(e.x+t,e.y+n,48,48),r&&a.drawImage(r,e.x+t+4,e.y+n+4)}}}function Ve(){n.width=window.innerWidth,n.height=window.innerHeight,a.clearRect(0,0,n.width,n.height),void 0!==tt&&Ne.pa()}function je(e){var t=e.j;if(t){var n=t.f.O;n||(n=t.f.O=[]);var a=Math.floor(4*A.zoom);if(!(n=n[a])){n=document.createElement("CANVAS");var o=0;tt.h.forEach((function(e){e.j&&e.j.f===t.f&&(o=Math.max(o,e.j.u+40))})),n.width=o/2,n.height=o/2,t.f.O[a]=n,n.ja=[]}if(!n.ja[e.id]){a=2*(.2+a/4);var r=n.getContext("2d");r.setLineDash([5/a,5/a]),r.beginPath(),r.lineWidth=2/a,r.strokeStyle=e.color,r.globalAlpha=1,r.arc(0,0,t.u/2,0,h/4,!1),r.stroke(),r.setLineDash([]),n.ja[e.id]=!0}}}Ve(),window.addEventListener("resize",Ve,!1);var Oe=[],Ue=[];function Ge(e,t){e.I=!0,t&&(Oe.length=0,Ue.length=0),t=[],Ue.push(e);for(var n=tt.h.length;n--;){var a=tt.h[n],o=0<=Ue.indexOf(a);!(e===a||o||e!==We.f&&2!==e.type||2!==a.type&&3!==a.type&&4!==a.type)&&se(e,a)<=We.ua&&(Oe.push(e,a),t.push(a),Ue.push(a))}return t.forEach((function(e){Ge(e)})),Oe}function He(){for(var e=tt.h.length;e--;)tt.h[e].I=!1;e=Ge(We.f,!0),a.globalAlpha=ve(.2/A.zoom,.2,.4),a.lineWidth=ve(1/A.zoom,2,5),a.strokeStyle="#0F0",a.beginPath();for(var t=75*(A.c-1),n=0;n<e.length;n+=2){var o=e[n],r=e[n+1],i=o.y/A.c,l=r.y/A.c;a.moveTo(o.x,i),a.bezierCurveTo(o.x,i-t,r.x,l-t,r.x,l)}a.stroke()}var Ye=document.createElement("CANVAS");Ye.width=512,Ye.height=512;var De=Ye.getContext("2d");De.shadowBlur=1,De.globalAlpha=.5;for(var Je=300;Je--;){var Ke=512*Math.random(),Xe=512*Math.random(),qe=me(-1,100,90);De.fillStyle=qe,De.shadowColor=qe,De.beginPath(),De.arc(Ke,Xe,.5,0,2*Math.PI),De.fill()}var Ze=a.createPattern(Ye,"repeat");var $e=document.createElement("CANVAS"),Qe=$e.getContext("2d",{alpha:!1});$e.width=128,$e.height=128,Qe.beginPath();var _e=Qe.createRadialGradient(64,64,0,64,64,64);_e.addColorStop(0,"#234"),_e.addColorStop(.1,"#123"),_e.addColorStop(1,"#000"),Qe.fillStyle=_e,Qe.fillRect(0,0,128,128);var et,tt=function(){function e(e,t,a,o,r,i,l,c){void 0===c&&(c=0);var h={name:"",type:0};return h.x=a,h.y=o,h.color=e,h.size=t,h.id=n.length.toString(),h.l=100,h.H=null,h.Ma=[],h.I=!1,h.ga=0,r&&(r.O=null,h.j={f:r,u:i,N:l/2,s:c},h.j.N/=h.j.u/100),h.update=function(){if(0>=h.l&&(n[n.indexOf(h)]=n[n.length-1],--n.length,h.j&&(h.j.f.O=null)),h.j){var e=h.j;e.s+=e.N,h.x=e.u*Math.cos(e.s)+e.f.x,h.y=e.u*Math.sin(e.s)+e.f.y}h.I&&h.H&&h.H.update()},h.g=function(){h.H&&h.H.g&&h.H.g()},n.push(h),h}function t(e,t,n){t=v.L(t),e.H=t(e,n)}var n=[];return v.o(),{h:n,Ia:function(t,n,a,o){return(t=e(t,n,a,o,null,null,null,null)).name="The Sun",t.type=0,t},f:function(t,n,a,o,r,i){return t=e(t,n,0,0,a,o,r,i),1===a.type?(t.name="Moon",t.type=5):(t.name="Planet",t.type=1,t.j.N/=t.j.u/1e4),t},Fa:function(t,n,a){var o=e(me(160,100,50),2,0,0,t,n,.01,a);return o.name="Satellite",o.type=2,o.cache=ce,o.update=ue(o.update,(function(){k.end&&o.I&&(We.i+=We.za*ve(1-n/500,.1,1))})),o},Z:function(t,n,a){var o=e(me(212,100,97),2,0,0,t,n,.01,a);return o.name="Mining Station",o.type=3,o.cache=q,o.update=ue(o.update,(function(){k.end&&o.I&&(We.M+=We.Da*ve(1-n/500,.1,1))})),o},xa:function(n,a,o){return(n=e(me(33,100,50),2,0,0,n,a,.01,o)).name="Defense Platform",n.type=4,n.cache=B,t(n,0,1),n},na:t,F:function(e,t){switch(e){case 2:return 30;case 3:return 50;case 4:switch(t){case 0:return 100;case 1:return 150;case 2:return 200;case 3:return 250;case 4:return 300}}return 0},getName:function(e,t){switch(e){case 2:return"Satellite";case 3:return"Mining Station";case 4:switch(t){case 0:return"Laser Platform";case 1:return"Beam Platform";case 2:return"Rocket Platform";case 3:return"EMP Platform";case 4:return"Lightning Platform"}}return""},v:function(e,t){e={x:e,y:t},t=999999;for(var a=n[0],o=n.length;o--;){var r=se(n[o],e);r<t&&(t=r,a=o)}return n[a]}}}(),nt=function(){var e=!1,t=!1,o=!1;return{update:function(){if(t)if(Fe){for(var a=0;a<Se.length;a++){var r=Se[a];if(r.U=r.Y(),1<=r.U){Ee+=1;var i=r.ha();i=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),r.V.src=i}}Ee>=Se.length&&(Fe=!1)}else if(Me){for(a=0;a<ke.length;a++)(r=ke[a]).U=1<=r.Y(),r.U&&(Ie+=1,i=r.ha(),i=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),r.V.src=i);Ie>=ke.length&&(Me=!1)}else e||(e=!0,Be(Ce),we("Welcome to Exo")),b.click&&Ce.pause&&Be(Ce),o=!1,b.ka(n.width/2-200,n.height/2+64-70,400,140)&&(o=!0,b.click&&(at=1,rt()));else t=!0},g:function(){var e=n.width/2,t=n.height/2;a.fillStyle="#FFF",a.textAlign="center",a.textBaseline="middle",a.shadowColor="#FFF",a.shadowBlur=50+2*Math.sin(performance.now()/100),a.font="small-caps 700 256px monospace",a.fillText("X",e,t-64),a.fillText("e o",e,t-90),a.shadowBlur=0,a.font="small-caps 700 32px monospace",Fe?a.fillText("Loading music...",e,t+64):Me?a.fillText("Loading sounds...",e,t+64):(a.globalAlpha=o?1:.5,a.fillText("click here to play!",e,t+64),a.globalAlpha=1),a.font="small-caps 700 16px monospace",a.fillText("Created by",e,n.height-148),a.fillText("ai Doge & Jack Oatley",e,n.height-128),a.fillText("with music by Francis Fonye",e,n.height-108),a.fillText("for #js13k",e,n.height-88),a.fillText("made with; Atom & SoundBox",e,n.height-48),a.fillText("works best in Chrome, quality in other browsers will vary!",e,n.height-28)}}}(),at=0,ot=64;function rt(){tt.h.length=0,et=M.Y(),tt.h.forEach((function(e){e.update()})),A.o(),y.o(),w.clear(),Te.o(),p.o(),k.start(),Ne.pa()}window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),F.o(),document.addEventListener("keypress",(function(e){" "===e.key&&(k.complete(2),at=2===at?1:2)}));var it=performance.now(),lt=1e3/60,ct=0;function ht(e){0===at?nt.update():(-1===tt.h.indexOf(We.f)&&(at=0,rt()),A.update(),Ne.update(),k.update(),y.da&&y.update(),1===at&&(ye(),tt.h.forEach((function(e){e.update()})),Te.update(),p.update(),w.update(),T.update())),b.update(),--e&&ht(e)}!function e(t){requestAnimationFrame(e);var o=it+lt;u.update(1/((t-ct)/1e3)),ct=t,t>o&&(ht(Math.min(Math.floor((t-it)/lt),60)),function(){if(A.clear(),a.drawImage($e,Math.floor(.5*n.width-A.x-2048),Math.floor(.5*n.height-A.y-2048),4096,4096),function(){var e=performance.now()/2e3;a.beginPath(),a.rect(0,0,n.width,n.height),a.fillStyle=Ze,a.translate(.5*n.width,.5*n.height+500*A.c),a.scale(.5,.5),a.translate(-A.x/25,-A.y/25),a.rotate(e/200),a.fill(),a.rotate(-e/200),a.scale(2,2),a.translate(-A.x/50,-A.y/50),a.fill()}(),0===at)A.reset(),nt.g();else{A.position(),tt.h.forEach((function(e){e.g()})),a.globalAlpha=1,function(){a.beginPath(),a.globalAlpha=.3,a.strokeStyle="#BDF",a.lineWidth=2/A.zoom;for(var e=tt.h.length;e--;){var t=tt.h[e].j;if(t){a.save();var n=1/A.c;a.transform(1,0,0,n,t.f.x,t.f.y*n),n=t.s-t.N*t.u,a.moveTo(Math.cos(n)*t.u,Math.sin(n)*t.u),a.arc(0,0,t.u,n,t.s,0>t.N),a.restore()}}a.stroke()}(),function(){a.globalAlpha=1;for(var e=tt.h.length;e--;){var t=tt.h[e];t.j&&je(t);var n=Math.floor(4*A.zoom);t.O&&t.O[n]&&(a.globalAlpha=.3,n=t.O[n],a.save(),a.translate(t.x,t.y/A.c),a.scale(2,2/A.c),a.drawImage(n,0,0,n.width,n.height),a.scale(-1,1),a.drawImage(n,0,0),a.scale(1,-1),a.drawImage(n,0,0),a.scale(-1,1),a.drawImage(n,0,0),a.restore()),a.fillStyle=t.I?"#0F0":"#F00",a.beginPath(),a.arc(t.x,t.y/A.c-30,3,0,h),a.fill()}}(),function(){a.globalAlpha=1;for(var e=tt.h.length;e--;){var t=tt.h[e],n=t.x,o=t.y/A.c;if(2===t.type){var r=de(t,tt.h[0]);a.save(),a.translate(n,o),a.rotate(r),a.scale(.3,.3),a.drawImage(ce,-ce.width/2,-ce.height/2)}else if(3===t.type)t.I&&(a.strokeStyle="#B33",a.lineWidth=1+Math.abs(Math.sin(performance.now()/100)),a.beginPath(),a.moveTo(n,o),a.lineTo(t.j.f.x,t.j.f.y/A.c),a.stroke()),r=de(t,t.j.f),a.save(),a.translate(n,o),a.rotate(r),a.scale(.3,.3),a.drawImage(q,-ce.width/2,-ce.height/2);else if(4===t.type)a.save(),a.translate(n,o),a.scale(.5,.5),a.drawImage(B,-B.width/2,-B.height/2+10),a.scale(1.2,.7),a.rotate(t.ga),a.drawImage(N,-N.width/2,-N.height/2);else{var i=0===t.type;if(!t.cache){var l=i?"#FFF":t.color,c=i?50:10;r=t.size+c;var u=0,f=t.cache=document.createElement("CANVAS");if(f.width=2*r,f.height=2*r,f=t.cache.getContext("2d"),i&&(u=1e3,f.shadowOffsetY=u),f.beginPath(),f.fillStyle=l,f.shadowColor=t.color,f.shadowBlur=c,f.arc(r,r-u,t.size,0,h,!1),f.fill(),i&&(f.beginPath(),f.shadowColor="#FFF",f.shadowBlur=5,f.arc(r,r-u,t.size-5,0,h,!1),f.fill()),!i)for(c=l=t.size,f.beginPath(),f.arc(r,r,t.size,0,2*Math.PI,!1),f.clip();l&&0<c;)f.beginPath(),f.globalAlpha=.05,f.fillStyle="#000",f.shadowColor="#000",f.shadowBlur=10,f.save(),f.transform(1,0,0,1,r-c/2+(t.size-c)/2,r),f.arc(0,0,2*c,-h/4,h/4),f.fill(),f.restore(),c-=Math.max(t.size/20,1),l-=Math.max(t.size/20,1)}r=de(t,tt.h[0]),a.save(),a.translate(n,o),a.rotate(r),i&&(n=1+.01*Math.sin(performance.now()/30),a.scale(n,n)),a.drawImage(t.cache,-t.cache.width/2,-t.cache.height/2)}a.restore()}}(),p.g(),He(),w.g(),T.g();var e=tt.v(b.B,b.C);a.scale(1,1/A.c),se(e,{x:b.B,y:b.C})<ot&&(a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(b.B,b.C),a.strokeStyle="#FFF",a.stroke(),a.beginPath(),a.arc(e.x,e.y,30,0,h),a.lineWidth=3,a.stroke()),y.da&&y.g(),a.setTransform(1,0,0,1,n.width/2,n.height/2),A.reset(),Ne.g()}}(),it=t)}(it)}()</script>