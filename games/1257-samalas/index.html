<!doctype html><meta name=viewport content="width=device-width,shrink-to-fit=no"><meta name=theme-color content=#000><title>1257 Samalas</title><script src=/2023/webxr/three.js></script><style>body{margin:0;background:#000}canvas{display:block}.b{border:5px solid #fff;border-image:linear-gradient(45deg,#266F56,#C52F34) 1}.u{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);margin-right:-33%;font-family:Courier,monospace;font-size:1.3em;color:#fff;background:rgba(0,0,0,.6);padding:1em;box-sizing:border-box;overflow:auto;text-align:center}.c{display:block;margin:0 auto;font-size:1em;padding:1em 2em;margin-top:1em;border:1px solid #fff;background:rgba(0,0,0,.5);color:#fff;cursor:pointer}#i{display:none}#d{font-size:1.3em}#p{display:none}h1{margin-top:0}</style><div id=s class="b u"><h1>1257 Samalas</h1><p>The eruption of Lombok's volcano in 1257 unleashed more than just ash; it awoke an ancient AI, Abyssus, buried deep within.<p>As the AI's consciousness spread, so did the effects of the eruption, causing an ice age that lasted over 700 years.<p>You have been sent back in time to restore balance with the aid of sacred Banyan trees.</p><button id=x class=c>Continue</button></div><div id=i class="b u"><h1>1257 Samalas</h1><p>Drag and drop from one island to another.<p>In VR, point at an island with your controller, press and hold the trigger, then point to another one and release.<p>Difficulty</p><select id=d><option value=0>Easy<option value=1>So so<option value=2>Hard<option value=3>Don't do it</select> <button id=b class=c>Play</button></div><div id=p class="b u">Paused</div><script>!function(){var t={34:function(t){t.exports="void main(){vec2 A=gl_FragCoord.xy/resolution.xy;vec4 B=texture2D(tP,A);vec4 C=texture2D(tV,A);gl_FragColor=vec4(B.x,B.w,C.x,C.w);}"},883:function(t){t.exports="#define A  (1.0/60.0)\nvoid main(){vec2 B=gl_FragCoord.xy/resolution.xy;vec4 C=texture2D(tP,B);vec3 D=C.xyz;float E=C.w;vec4 F=texture2D(tV,B);vec3 G=F.xyz;float H=F.w;if(H==0.){G=vec3(0.);}if(E>0.5){D+=G*A;}gl_FragColor=vec4(D,E);}"},118:function(t){t.exports="#define A  (1.0/60.0)\nuniform float d;float B=0.45;const float C=resolution.x;const float D=resolution.y;bool E(float F,float G){return abs(F-G)<0.01;}void main(){float H=100.*(d+1.);vec2 I=gl_FragCoord.xy/resolution.xy;float J=I.y*resolution.x+I.x;vec4 K=texture2D(tP,I);vec3 L=K.xyz;float M=K.w;vec4 N=texture2D(tV,I);vec3 O=N.xyz;float P=N.w;if(P>0.){vec3 Q=vec3(0.);for(float R=0.;R<D;R++){for(float S=0.;S<C;S++){vec2 T=vec2(S+0.5,R+0.5)/resolution.xy;vec4 U=texture2D(tP,T);vec3 V=U.xyz;vec4 W=texture2D(tV,T);vec3 X=W.xyz;float Y=W.w;float Z=T.y*resolution.x+T.x;if(J==Z){continue;}if(Y==0.){continue;}vec3 a=V-L;float distance=length(a);if(distance==0.){continue;}float b=U.w;float c=max(distance*distance,0.0001);if(distance<.5&&E(M,0.6)&&E(Z,P)){O=vec3(0);gl_FragColor=vec4(O,-P);return;}if(E(M,0.6)&&E(b,0.6)){float d=(-0.1)/(c*c);Q+=d*normalize(a);}else if(E(M,0.6)&&E(Z,P)){float e=H*Y/distance;Q+=e*normalize(a);}else if(E(M,0.6)&&E(b,0.1)){float f=-0.5*H*Y/(c*c*c);Q+=f*normalize(a);}}}O+=A*Q;if(length(O)>0.){O=normalize(O)*min(length(O),1.5*(d+1.));}}else{gl_FragColor=vec4(0);return;}gl_FragColor=vec4(O,P);}"},68:function(t){t.exports="varying vec4 vColor;varying vec4 vPosition;varying vec4 vVelocity;void main(){float A=vPosition.z/10.;gl_FragColor=vec4(vColor.xyz*0.7+0.3*abs(vVelocity.xyz)*(1.-A),1.);}"},79:function(t){t.exports="uniform sampler2D tP;uniform sampler2D tV;uniform vec3 pC;uniform vec3 eC;attribute vec2 dtUv;varying vec4 vColor;varying vec4 vPosition;varying vec4 vVelocity;bool A(float B,float C,float D){return abs(B-C)<D;}mat3 E(vec3 F){vec3 G=vec3(0.,-1.,0.);vec3 H=normalize(cross(G,F));vec3 I=cross(F,H);return mat3(H,I,F);}void main(){vec4 J=texture2D(tP,dtUv);vec3 K=J.xyz;vec4 L=texture2D(tV,dtUv);vec3 M=L.xyz;float N=L.w;if(A(J.w,0.600,0.0001)){vColor=vec4(pC,1.);}else if(A(J.w,0.601,0.0001)){vColor=vec4(eC,1.);}else{vColor=vec4(1.,1.,0.,0.);}vVelocity=L;vec3 O=mat3(modelMatrix)*position;mat3 P=E(normalize(M));O=P*O;O+=K;vec4 Q=modelViewMatrix*(vec4(position,1.)+vec4(K,1.));gl_Position=projectionMatrix*viewMatrix*vec4(O,1.);vPosition=gl_Position;}"},751:function(t){t.exports="uniform sampler2D t;uniform sampler2D m;varying float l;varying vec3 c;varying vec2 u;varying float i;uniform float time;void main(){int A=int(floor(mod(u.x*l,128.)));vec2 B=vec2(float(A)/float(128.),i/float(1024.));float C=texture2D(m,B).r*255.;vec2 D;float E=0.125;float F=(45./512.)/1.;float G=floor(C/8.);float H=mod(C,8.);float I=(u.x*F*l);float J=(-u.y*0.10+0.11);D.x=(H*F)+mod(I,F);D.y=(1.-G*E)-mod(J,E);vec4 K=texture2D(t,D);if(K.a<0.2){discard;};gl_FragColor=(K)*vec4(c,1.);}"},449:function(t){t.exports="attribute float length;attribute float instance;varying vec2 u;varying vec3 c;varying float l;varying float i;void main(){u=uv;l=length;\n#ifdef USE_INSTANCING_COLOR\nc=instanceColor;\n#endif\ni=instance;gl_Position=projectionMatrix*modelViewMatrix*instanceMatrix*vec4(position,1.);}"},286:function(t,e,n){"use strict";t.exports=n.p+"1257-samalas/waveProcessor.js"}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.m=t,n.n=function(t){var e=t&&t.i?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.b=document.baseURI||self.location.href,function(){"use strict";class t{constructor(t){this.h=t,this.l=null}v(){return function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){if(null===this.l){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};try{if(!navigator.xr)throw new Error("!WebXR");const e=yield navigator.xr.requestSession("immersive-vr",t);yield this.h.xr.setSession(e),this.l=e}catch(t){}}else this.l.end()}))}T(){this.l&&(this.l.end(),this.l=null)}}var e=n(449),i=n.n(e),o=n(751),r=n.n(o);class s{constructor(t,e,n){this.R=t||" ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.,!?",this.H=e||128,this.M=n||1024,this._=this.P(),this.O=[],this.S=[],this.I=0,this.V=new THREE.InstancedBufferAttribute(new Float32Array(this.M),1),this.k=new THREE.InstancedBufferAttribute(new Float32Array(this.M),1),this.H=128,this.L=new Uint8Array(this.H*this.M),this.N=new THREE.DataTexture(this.L,this.H,this.M,THREE.RedFormat),this.U=[],this.K=[],this.W=new THREE.Object3D,this.J=new THREE.Quaternion,this.Y=new THREE.Quaternion,this.j=0;const o=new THREE.ShaderMaterial({uniforms:{t:{value:this._},m:{value:this.N},time:{value:0}},vertexShader:i(),fragmentShader:r(),depthWrite:!1,depthTest:!1});o.transparent=!0,o.side=THREE.DoubleSide,o.vertexColors=!0;const s=new THREE.PlaneGeometry(1,.1);s.setAttribute("length",this.V),s.setAttribute("instance",this.k),this.instancedMesh=new THREE.InstancedMesh(s,o,this.M),this.instancedMesh.frustumCulled=!1,this.instancedMesh.onBeforeRender=(t,e,n,i,o,r)=>{if(n.matrixWorld.decompose(this.W.position,this.W.quaternion,this.W.scale),this.U.length>0)for(let t=0;t<this.U.length;t++)this.O[this.U[t]].quaternion.copy(this.W.quaternion),this.updateMatrix(this.U[t])}}P(){const t=document.createElement("canvas");t.width=1024,t.height=1024;const e=t.getContext("2d");if(!e)throw new Error;function n(t,e,n,i){t.font="128px monospace",t.strokeStyle="black",t.lineWidth=2,t.lineJoin="miter",t.miterLimit=2,t.strokeText(e,n,i),t.fillStyle="white",t.fillText(e,n,i)}e.textAlign="center",e.textBaseline="bottom",e.fillStyle="white",e.strokeStyle="black";for(let t=0;t<this.R.length;t++){const i=t%8*90+45,o=128*Math.floor(t/8)+128;n(e,this.R[t],i,o)}const i=new THREE.Texture(t);return i.needsUpdate=!0,i}Z(t,e){for(let n=0;n<e.length;n++){const i=this.R.indexOf(e[n].toUpperCase());-1!==i&&(this.L[t*this.H+n]=i)}this.V.setX(t,e.length),this.V.needsUpdate=!0;const n=this.S[t]||1;this.setScale(t,e.length*n/10/(128/90),1*n,1*n),this.N.needsUpdate=!0,this.instancedMesh.material.uniforms.time.value=performance.now()/1e3,this.instancedMesh.material.needsUpdate=!0}X(t,e,n,i){const o=this.I;return this.I>=this.M?null:(this.I++,this.instancedMesh.count=this.I,this.O[o]=new THREE.Object3D,this.Z(o,t),this.k.setX(o,o),this.k.needsUpdate=!0,e&&this.setColor(o,e),n&&this.U.push(o),i&&this.K.push(o),{setPosition:(t,e,n)=>{this.setPosition(o,t,e,n)},updateText:(t,e)=>{this.Z(o,t),e&&this.setColor(o,e)},setScale:t=>{this.S[o]=t},instancedMesh:this.instancedMesh,q:o})}setColor(t,e){this.instancedMesh.setColorAt(t,e),this.instancedMesh.instanceColor&&(this.instancedMesh.instanceColor.needsUpdate=!0)}setScale(t,e,n,i){this.O[t].scale.set(e,n,i),this.updateMatrix(t)}setPosition(t,e,n,i){this.O[t].position.set(e,n,i),this.updateMatrix(t)}$(t,e,n,i){this.O[t].rotation.set(e,n,i),this.updateMatrix(t)}updateMatrix(t,e){e?this.O[t].matrix.copy(e):this.O[t].updateMatrix(),this.instancedMesh.setMatrixAt(t,this.O[t].matrix),this.instancedMesh.instanceMatrix.needsUpdate=!0}}var a=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t,e,n){this.tt=[],this.nt=0;const i=THREE.FloatType,o=new THREE.Scene,r=new THREE.Camera;r.position.z=1;const s={passThruTexture:{value:null}},c=h("uniform sampler2D passThruTexture; void main(){vec2 uv = gl_FragCoord.xy/resolution.xy;gl_FragColor=texture2D(passThruTexture,uv);}",s),l=new THREE.Mesh(new THREE.PlaneGeometry(2,2),c);function u(n){n.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}function h(t,e){e=e||{};const n=new THREE.ShaderMaterial({name:"GPUComputationShader",uniforms:e,vertexShader:"void main(){gl_Position=vec4(position,1.0);}",fragmentShader:t});return u(n),n}o.add(l),this.et=function(t,e,n,i){const o={name:t,initialValueTexture:n,material:h(e),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,buffer:i};return this.tt.push(o),o},this.it=function(t,e){t.dependencies=e},this.init=function(){if(!1===n.capabilities.isWebGL2&&!1===n.extensions.has("OES_texture_float"))return"!OES_texture_float";if(0===n.capabilities.maxVertexTextures)return"!vertexShaderTex";for(let n=0;n<this.tt.length;n++){const i=this.tt[n];i.renderTargets[0]=this.ot(t,e,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.ot(t,e,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.st(i.initialValueTexture,i.renderTargets[0]),this.st(i.initialValueTexture,i.renderTargets[1]);const o=i.material,r=o.uniforms;if(null!==i.dependencies)for(let t=0;t<i.dependencies.length;t++){const e=i.dependencies[t];if(e.name!==i.name){let t=!1;for(let n=0;n<this.tt.length;n++)if(e.name===this.tt[n].name){t=!0;break}if(!t)return"!var="+i.name+", dep="+e.name}r[e.name]={value:null},o.fragmentShader="\nuniform sampler2D "+e.name+";\n"+o.fragmentShader}}return this.nt=0,null},this.ct=function(t){const e=this.nt,n=0===this.nt?1:0;for(let i=0,o=this.tt.length;i<o;i++){const o=this.tt[i];if(null!==o.dependencies){const t=o.material.uniforms;for(let n=0,i=o.dependencies.length;n<i;n++){const i=o.dependencies[n];t[i.name].value=i.renderTargets[e].texture}}o.buffer&&t&&t[o.name]?this.rt(o.material,o.renderTargets[n],o.buffer,t[o.name]):this.rt(o.material,o.renderTargets[n])}this.nt=n},this.ht=function(t){return t.renderTargets[this.nt]},this.ut=u,this.ot=function(n,o,r,s,a,c){return n=n||t,o=o||e,r=r||THREE.ClampToEdgeWrapping,s=s||THREE.ClampToEdgeWrapping,a=a||THREE.NearestFilter,c=c||THREE.NearestFilter,new THREE.WebGLRenderTarget(n,o,{wrapS:r,wrapT:s,minFilter:a,magFilter:c,format:THREE.RGBAFormat,type:i,depthBuffer:!1})},this.createTexture=function(){const n=new Float32Array(t*e*4),i=new THREE.DataTexture(n,t,e,THREE.RGBAFormat,THREE.FloatType);return i.needsUpdate=!0,i},this.st=function(t,e){s.passThruTexture.value=t,this.rt(c,e),s.passThruTexture.value=null},this.rt=function(t,e,i,s){const a=n.getRenderTarget(),u=n.xr.enabled;n.xr.enabled=!1,l.material=t,n.setRenderTarget(e),n.render(o,r),i&&(null==s?void 0:s.length)&&this.lt(i).then((()=>{for(let t=0;t<s.length;t++)s[t](i)})),l.material=c,n.xr.enabled=u,n.setRenderTarget(a)},this.lt=function(i){return a(this,void 0,void 0,(function*(){const o=n.getContext(),r=t,s=e;if(!(o instanceof WebGL2RenderingContext))return;const c=yield function(t,e,n,i,o,r,s,c){return a(this,void 0,void 0,(function*(){const e=t.createBuffer();return t.bindBuffer(t.PIXEL_PACK_BUFFER,e),t.bufferData(t.PIXEL_PACK_BUFFER,c.byteLength,t.STREAM_READ),t.readPixels(0,0,i,o,r,s,0),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),yield function(t,e,n,i,o,r,s){return a(this,void 0,void 0,(function*(){const i=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),yield function(t,e,n,i){return new Promise(((n,i)=>{!function o(){const r=t.clientWaitSync(e,0,0);r!==t.WAIT_FAILED?r!==t.TIMEOUT_EXPIRED?n():setTimeout(o,10):i()}()}))}(t,i),t.deleteSync(i),t.bindBuffer(e,n),t.getBufferSubData(e,0,o,undefined,undefined),t.bindBuffer(e,null)}))}(t,t.PIXEL_PACK_BUFFER,e,0,c),t.deleteBuffer(e),c}))}(o,0,0,r,s,o.RGBA,o.FLOAT,i);return c}))}}}var l=n(118),u=n.n(l),h=n(883),d=n.n(h),f=n(34),p=n.n(f),m=n(79),E=n.n(m),v=n(68),T=n.n(v);const w=new Event({type:"change"}),M=new Event({type:"start"}),x={type:"end"},y=new THREE.Ray,g=new THREE.Plane,R=Math.cos(70*THREE.MathUtils.DEG2RAD),H=new THREE.Vector3,b=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0)),C=b.clone().invert(),P=new THREE.Vector3,S=new THREE.Quaternion,I=new THREE.Vector3,A=2*Math.PI;let D;const F={ft:-1,Et:0,wt:1,vt:3,Tt:4,dt:5,Rt:6};let O=F.ft;const V=1e-6,B=new THREE.Spherical,L=new THREE.Spherical;let q=1;const U=new THREE.Vector2,_=new THREE.Vector2,G=new THREE.Vector2,k=new THREE.Vector2,W=new THREE.Vector2,z=new THREE.Vector2,Y=new THREE.Vector3,X=new THREE.Vector2;let j=!1;const N=[],K={};class Q extends THREE.EventDispatcher{constructor(t,e){super(),this.Ht=t,this.Mt=e,this.Mt.style.touchAction="none",this.enabled=!0,this.yt=new THREE.Vector3,this.xt=0,this.gt=100,this.Ct=0,this._t=Math.PI,this.Dt=-1/0,this.Ft=1/0,this.Pt=!1,this.At=.05,this.bt=!0,this.Ot=1,this.St=!0,this.It=1,this.Vt=!1,this.autoRotate=!1,this.kt=1.5,this.zt={Bt:THREE.MOUSE.ROTATE},this.Lt={Gt:THREE.TOUCH.ROTATE,Nt:THREE.TOUCH.DOLLY_PAN},this.Ut=this.yt.clone(),this.Kt=this.Ht.position.clone(),this.Wt=null,this.Mt.addEventListener("contextmenu",ht),this.Mt.addEventListener("pointerdown",at),this.Mt.addEventListener("pointercancel",lt),this.Mt.addEventListener("wheel",ut,{passive:!1}),D=this,this.update()}update(t=null){const e=this.Ht.position;H.copy(e).sub(this.yt),H.applyQuaternion(b),B.setFromVector3(H),this.autoRotate&&O===F.ft&&Z(function(t){return null!==t?2*Math.PI/60*D.kt*t:2*Math.PI/60/60*D.kt}(t)),this.Pt?(B.theta+=L.theta*this.At,B.phi+=L.phi*this.At):(B.theta+=L.theta,B.phi+=L.phi);let n=this.Dt,i=this.Ft;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=A:n>Math.PI&&(n-=A),i<-Math.PI?i+=A:i>Math.PI&&(i-=A),B.theta=n<=i?Math.max(n,Math.min(i,B.theta)):B.theta>(n+i)/2?Math.max(n,B.theta):Math.min(i,B.theta)),B.phi=Math.max(this.Ct,Math.min(this._t,B.phi)),B.makeSafe(),this.Vt&&j?B.radius=et(B.radius):B.radius=et(B.radius*q),H.setFromSpherical(B),H.applyQuaternion(C),e.copy(this.yt).add(H),this.Ht.lookAt(this.yt),L.set(0,0,0);let o=!1;if(this.Vt&&j){let t=null;if(this.Ht.isPerspectiveCamera){const e=H.length();t=et(e*q);const n=e-t;this.Ht.position.Jt(Y,n),this.Ht.updateMatrixWorld()}else this.Vt=!1;null!==t&&(y.origin.copy(this.Ht.position),y.direction.set(0,0,-1).Yt(this.Ht.matrix),Math.abs(this.Ht.jt.dot(y.direction))<R?this.Ht.lookAt(this.yt):(g.Qt(this.Ht.jt,this.yt),y.Zt(g,this.yt)))}if(q=1,j=!1,o||P.distanceToSquared(this.Ht.position)>V||8*(1-S.dot(this.Ht.quaternion))>V||I.distanceToSquared(this.yt)>0)return this.dispatchEvent(w),P.copy(this.Ht.position),S.copy(this.Ht.quaternion),I.copy(this.yt),o=!1,!0}}function J(){return Math.pow(.95,D.Ot)}function Z(t){L.theta-=t}function $(t){L.phi-=t}function tt(t){D.Ht.isPerspectiveCamera?q/=t:D.bt=!1}function et(t){return Math.max(D.xt,Math.min(D.gt,t))}function nt(t){U.set(t.clientX,t.clientY)}function it(){if(1===N.length)U.set(N[0].pageX,N[0].pageY);else{const t=.5*(N[0].pageX+N[1].pageX),e=.5*(N[0].pageY+N[1].pageY);U.set(t,e)}}function ot(){const t=N[0].pageX-N[1].pageX,e=N[0].pageY-N[1].pageY,n=Math.sqrt(t*t+e*e);k.set(0,n)}function rt(t){if(1==N.length)_.set(t.pageX,t.pageY);else{const e=ft(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);_.set(n,i)}G.subVectors(_,U).multiplyScalar(D.It);const e=D.Mt;Z(2*Math.PI*G.x/e.clientHeight),$(2*Math.PI*G.y/e.clientHeight),U.copy(_)}function st(t){const e=ft(t),n=t.pageX-e.x,i=t.pageY-e.y,o=Math.sqrt(n*n+i*i);W.set(0,o),z.set(0,Math.pow(W.y/k.y,D.Ot)),tt(z.y),k.copy(W)}function at(t){!1!==D.enabled&&(0===N.length&&(D.Mt.setPointerCapture(t.pointerId),D.Mt.addEventListener("pointermove",ct),D.Mt.addEventListener("pointerup",lt)),function(t){N.push(t)}(t),"touch"===t.pointerType?function(t){switch(dt(t),N.length){case 1:if(D.Lt.Gt===THREE.TOUCH.ROTATE){if(!1===D.St)return;it(),O=F.vt}else O=F.ft;break;case 2:switch(D.Lt.Nt){case THREE.TOUCH.DOLLY_PAN:if(!1===D.bt)return;D.bt&&ot(),O=F.dt;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===D.bt&&!1===D.St)return;D.bt&&ot(),D.St&&it(),O=F.Rt;break;default:O=F.ft}break;default:O=F.ft}O!==F.ft&&D.dispatchEvent(M)}(t):function(t){let e;switch(e=0===t.button?D.zt.Bt:-1,e){case THREE.MOUSE.ROTATE:if(!1===D.St)return;nt(t),O=F.Et;break;case THREE.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===D.St)return;nt(t),O=F.Et}break;default:O=F.ft}O!==F.ft&&D.dispatchEvent(M)}(t))}function ct(t){!1!==D.enabled&&("touch"===t.pointerType?function(t){switch(dt(t),O){case F.vt:if(!1===D.St)return;rt(t);break;case F.dt:if(!1===D.bt)return;!function(t){D.bt&&st(t)}(t);break;case F.Rt:if(!1===D.bt&&!1===D.St)return;!function(t){D.bt&&st(t),D.St&&rt(t)}(t);break;default:O=F.ft}}(t):function(t){if(O===F.Et){if(!1===D.St)return;!function(t){_.set(t.clientX,t.clientY),G.subVectors(_,U).multiplyScalar(D.It);const e=D.Mt;Z(2*Math.PI*G.x/e.clientHeight),$(2*Math.PI*G.y/e.clientHeight),U.copy(_)}(t)}}(t))}function lt(t){!function(t){delete K[t.pointerId];for(let e=0;e<N.length;e++)if(N[e].pointerId==t.pointerId)return void N.splice(e,1)}(t),0===N.length&&(D.Mt.releasePointerCapture(t.pointerId),D.Mt.removeEventListener("pointermove",ct),D.Mt.removeEventListener("pointerup",lt)),D.dispatchEvent(x),O=F.ft}function ut(t){!1!==D.enabled&&!1!==D.bt&&O===F.ft&&(t.preventDefault(),D.dispatchEvent(M),function(t){var e;!function(t){if(!D.Vt)return;j=!0;const e=D.Mt.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,o=e.width,r=e.height;X.x=n/o*2-1,X.y=-i/r*2+1}(t),t.deltaY<0?(e=J(),D.Ht.isPerspectiveCamera?q*=e:D.bt=!1):t.deltaY>0&&tt(J())}(t),D.dispatchEvent(x))}function ht(t){!1!==D.enabled&&t.preventDefault()}function dt(t){let e=K[t.pointerId];void 0===e&&(e=new THREE.Vector2,K[t.pointerId]=e),e.set(t.pageX,t.pageY)}function ft(t){const e=t.pointerId===N[0].pointerId?N[1]:N[0];return K[e.pointerId]}const pt=(t,e)=>{const n=[];for(let i=0;i<44100*e;i++){const o=(t,e,n,i)=>Math.sin(t/e*6.28*n+i),r=(t,e)=>Math.sin(t/44100*e*6.28+Math.pow(o(t,44100,e,0),3)+.75*o(t,44100,e,.25)+.1*o(t,44100,e,.5));n[i]=i<88?i/88.2*r(i,t):Math.pow(1-(i-88.2)/(44100*(e-.002)),Math.pow(.5*Math.log(1e4*t/44100),2))*r(i,t)}return n},mt=new window.AudioContext,Et=Date.now(),vt=t=>{const e=mt.createBufferSource(),n=mt.createBuffer(1,t.length,44100);return n.getChannelData(0).set(t),e.buffer=n,e},Tt=[609,653,705,822,887,954,1050].map((t=>t/8)),wt=[];for(let t=-1;t<3;t++)wt.push(...Tt.map((e=>vt(pt(e*Math.pow(2,t),.05)))));let Mt=0;function xt(t,e,n){setTimeout((()=>{const i=n[t][Mt++%n[t].length];if(!n[t].some((t=>t.isPlaying))){i.position.copy(e);const n=wt[6+("p"===t?19:6)];n.buffer&&i.setBuffer(n.buffer),i.play()}}),50-(Date.now()-Et)%50)}const yt=(t,e,n)=>{const i=.96,o=(1e3+(t+2*Math.sin(e)+e*n))/n;return[.2+.3*(1+Math.sin(2*Math.PI*.1*o)),(2.6+1/i*Math.atan(i*Math.sin(Math.PI/5*o-1)/(1-i*Math.cos(Math.PI/5*o-1))))/1-3*Math.abs(Math.sin(Math.PI/10*o-Math.PI))]};class gt{constructor(){this.Xt=!1,this.qt=new AudioContext,this.$t=this.qt.sampleRate;const t=this.qt.createConvolver();t.buffer=this.tn(2,2),t.connect(this.qt.destination);const e=this.qt.createBiquadFilter();e.type="lowpass",e.Q.value=1,this.nn=0,this.en={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88};for(const t in this.en)this.en[t+"'"]=2*this.en[t];this.on=["A","E","D","E","","D","E","D","C","B","C","B","","C","G","A"],this.sn=[1,.125,.125,.75,.25,.25,.25,.25,1,.125,.125,.75,.5,.75,.75,1],this.cn=[[.75,.75,.25,.25,.125,.125,.75,1],[.25,.75,.25,.75,.25,.75,.25,.75],[.5,.5,.5,.5,.5,.5,.5,.5],[.125,.25,.375,.75,.375,.25,.125,1.75]],this.rn=0,this.an=new Array(2).fill(0).map((()=>{const e=this.qt.createOscillator();e.type="triangle";const n=this.qt.createGain();return n.gain.value=0,e.connect(n),n.connect(t),e.start(this.qt.currentTime),e.detune.value=1,{hn:e,gain:n}})),this.init()}init(){return function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){yield this.qt.audioWorklet.addModule(new URL(n(286),n.b));const t=new AudioWorkletNode(this.qt,"waveProcessor");t.port.postMessage(yt.toString());const e=this.qt.createBiquadFilter();e.type="lowpass",e.Q.value=1,t.connect(e),e.connect(this.qt.destination),setInterval((()=>{e.frequency.exponentialRampToValueAtTime(300+400*yt(0,this.qt.currentTime+.1,this.qt.sampleRate)[1],this.qt.currentTime+.1)}),100)}))}tn(t,e){const n=this.$t*t,i=this.qt.createBuffer(2,n,this.$t),o=i.getChannelData(0),r=i.getChannelData(1);for(let t=0;t<n;t++)o[t]=(100*Math.random()-1)*Math.pow(1-t/n,e),r[t]=(100*Math.random()-1)*Math.pow(1-t/n,e);return i}un(){const t=this.qt.createOscillator(),e=this.qt.createGain();t.type="sine",t.frequency.setValueAtTime(80,this.qt.currentTime),e.gain.setValueAtTime(.8,this.qt.currentTime),t.frequency.exponentialRampToValueAtTime(30,this.qt.currentTime+.2),e.gain.exponentialRampToValueAtTime(.001,this.qt.currentTime+.5);const n=this.qt.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(300,this.qt.currentTime),t.connect(e),e.connect(n),n.connect(this.qt.destination),t.start(this.qt.currentTime),t.stop(this.qt.currentTime+.5),this.ln((()=>this.un()),2e3,this.qt.currentTime+1)}fn(t,e){const n={1:0,2:4,3:7,4:12},i=Object.keys(this.en).indexOf(t);if(-1===i)return[];const o=[];for(let t=0;t<e.length;t++){const r=n[parseInt(e[t])];if(void 0===r)return[];const s=i+r;o.push(Object.keys(this.en)[s])}return o||[]}En(){if(0===this.nn||this.nn%48!=0){const t=Object.keys(this.en)[Math.floor(12*Math.random())],e=["12132124","34121234","34132312","12314321"][Math.floor(4*Math.random())],n=this.fn(t,e),i=this.cn[Math.floor(Math.random()*this.cn.length)];this.ln((()=>this.wn(n,i)),2e3)}else this.nn%48==0&&this.nn>0&&this.ln((()=>this.wn(this.on,this.sn)),2e3)}wn(t,e){let n=0;for(let i=0;i<t.length;i++){const o=1e3*e[i];setTimeout((()=>this.vn(this.en[t[i]],o*(1+.05*Math.random()))),n),n+=o}setTimeout((()=>this.En()),n)}vn(t,e){if(this.nn++,!t)return;const{hn:n,gain:i}=this.an[this.rn],o=.01,r=e/1e3/3.5,s=e/1e3/3.5,a=this.qt.currentTime;i.gain.setValueAtTime(0,this.qt.currentTime),n.frequency.setTargetAtTime(t/2,this.qt.currentTime,o),i.gain.linearRampToValueAtTime(.8,a+o),i.gain.linearRampToValueAtTime(.8,a+o+r),i.gain.linearRampToValueAtTime(0,a+o+r+s),this.rn=(this.rn+1)%2}ln(t,e=2e3,n=0){const i=this.qt.currentTime,o=1e3*(Math.ceil(1e3*i/e)*e/1e3-i);o>1986&&n<i?t():setTimeout((()=>{t()}),o)}start(){this.Xt||(this.Xt=!0,this.En(),setTimeout((()=>{this.ln((()=>this.un()),2e3)}),4e3))}}var Rt=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};let Ht=null,bt=null;const Ct=[];let Pt;const St=64,It=4096;let At;const Dt=[],Ft=[];let Ot,Vt,Bt,Lt,qt,Ut,_t,Gt=!1,kt=!1,Wt=0;const zt=new Float32Array(4*It),Yt=new Float32Array(4*It),Xt=new Float32Array(4*It),jt={},Nt=[];let Kt=!1;const Qt={p:0,e:0},Jt=[];let Zt=0,$t=null,te=0;class ee extends THREE.Group{constructor(){super(...arguments),this.u={}}}function ne(){Vt=new c(St,St,Ot);const t=Vt.createTexture(),e=Vt.createTexture(),n=Vt.createTexture();!function(t,e){const n=t.image.data,i=e.image.data;for(let t=0,e=n.length;t<e;t+=4)t<256?(n[t+0]=Dt[t/4].position.x,n[t+1]=Dt[t/4].position.y,n[t+2]=Dt[t/4].position.z,n[t+3]=.1,i[t+3]=1):(n[t+0]=-3,n[t+1]=Math.random(),n[t+2]=0,n[t+3]=99,i[t+0]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0)}(t,e),Bt=Vt.et("tV",u(),e,Yt),Bt.material.uniforms.d={value:3},Lt=Vt.et("tP",d(),t,Xt),qt=Vt.et("tA",p(),n,zt),Vt.it(Bt,[Lt,Bt]),Vt.it(Lt,[Lt,Bt]),Vt.it(qt,[Lt,Bt]),Vt.init()}Rt(void 0,void 0,void 0,(function*(){var e;const n=new THREE.Scene;n.background=new THREE.Color(5263440);const i=new THREE.Color(65433),o=new THREE.Color(12922676),r=new THREE.Color(16753920),a=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,200);a.position.set(0,6,-10),_t=new THREE.Object3D,_t.add(a),n.add(_t);const c=function(t,e,n){const i=document.createElement("canvas");i.width=16,i.height=256;const o=i.getContext("2d");if(!o)throw new Error;const r=o.createLinearGradient(0,0,i.width,i.height);r.addColorStop(.5,"#000833"),r.addColorStop(.51,"#03123B"),r.addColorStop(1,"#03123B"),o.fillStyle=r,o.fillRect(0,0,i.width,i.height);const s=new THREE.Texture(i);return s.needsUpdate=!0,s}(),l=new THREE.MeshBasicMaterial({map:c,side:THREE.BackSide,depthWrite:!1}),u=new THREE.IcosahedronGeometry(100,3),h=new THREE.Mesh(u,l);n.add(h);const d=new THREE.DirectionalLight(16777215,1.1);d.position.set(0,1,1),n.add(d);const f=new THREE.AmbientLight(16777215,1);n.add(f),Ot=new THREE.WebGLRenderer({antialias:!0,Tn:"high-performance"}),Ot.xr.enabled=!0;const p=new t(Ot);Ot.setPixelRatio(window.devicePixelRatio),Ot.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(Ot.domElement);const m=new Q(a,Ot.domElement);m.autoRotate=!0;const v=()=>{const t=window.innerWidth,e=window.innerHeight;Ot.setSize(t,e),a.aspect=t/e,a.updateProjectionMatrix()};window.addEventListener("resize",(function(){v()}));const w=new THREE.BoxGeometry(.1,1,.1),M=new THREE.MeshBasicMaterial({color:i}),x=new THREE.Mesh(w,M);x.visible=!1,n.add(x);const y=new THREE.SphereGeometry(1,32,32,0,2*Math.PI,0,Math.PI/2);y.translate(0,.5,0);const g=new THREE.CylinderGeometry(0,.5,1,4,1);g.translate(0,.5,0);const R="vec3 transformed = vec3(position);transformed.x += sin(position.y * 10.0 + time + float(gl_InstanceID)) * 0.1;transformed.z += cos(position.y * 10.0 + time + float(gl_InstanceID)) * 0.1;",H=new THREE.MeshStandardMaterial({color:65280,side:THREE.DoubleSide});H.onBeforeCompile=t=>{t.uniforms.time={value:0},t.vertexShader="uniform float time;\n"+t.vertexShader,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",R),H.userData.dn=t};const b=new THREE.MeshStandardMaterial({color:9127187,side:THREE.DoubleSide}),C=new THREE.BufferGeometry,P=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);C.setIndex([0,1,2,2,3,0]),C.setAttribute("position",new THREE.BufferAttribute(P,3)),C.translate(0,1,0),C.computeVertexNormals(),C.rotateY(Math.PI);const S=new THREE.MeshStandardMaterial({color:9127187,side:THREE.DoubleSide});S.onBeforeCompile=t=>{t.uniforms.time={value:0},t.vertexShader="uniform float time;\n"+t.vertexShader,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",R),S.userData.dn=t};const I=new THREE.InstancedMesh(y,H,64),A=new THREE.InstancedMesh(g,b,64),D=new THREE.InstancedMesh(C,S,512),F=new THREE.Group,O=.3,V=new THREE.AudioListener;a.add(V);const B=t=>{const e=new THREE.PositionalAudio(t);return e.setRefDistance(20),e.setVolume(.5),n.add(e),e},L={p:[1,2,3,4].map((()=>B(V))),e:[1,2,3,4].map((()=>B(V)))};function q(t,e,n){const i=t*Math.sin(e)*Math.cos(n),o=t*Math.sin(e)*Math.sin(n),r=t*Math.cos(e);return new THREE.Vector3(i,o,r)}function U(t,e,n,i,o,r,s,a=0,c=1){const l=F,u=Jt[e],h=new THREE.Object3D;h.position.set(0,.05,0),l.parent=h,h.parent=u;const d=O;for(let f=0;f<8;f++){const p=1===c?e:8*e+f;"r"===t?l.matrix.copy(u.u.r[f]):l.matrix.copy(u.u[t]),l.matrix.decompose(l.position,l.quaternion,l.scale),u.setRotationFromAxisAngle(new THREE.Vector3(1,0,0),a),h.scale.set(n*d*o,n*d*r,n*d*s),l.updateWorldMatrix(!0,!0),i.setMatrixAt(p,l.matrixWorld),i.instanceMatrix.needsUpdate=!0}}function _(t,e,n){U("c",t,e,I,1,1,1,n),U("t",t,e,A,1,1,1,n),U("r",t,e,D,.03,.3,1,n,8)}const G=(1+Math.sqrt(5))/2;for(let t=0;t<64;t++){const e=q(5,Math.acos(1-2*(t+.5)/64),2*Math.PI*(t%G)/G),r=at(0===t?0:63===t?1:void 0);n.add(r);const s=new THREE.MeshBasicMaterial;Dt.push(r),r.position.copy(e);const a=new THREE.Mesh(new THREE.SphereGeometry(r.u.size/10),s);a.position.copy(r.position.clone()),Ft.push(a),r.u.Rn=a,a.visible=!1,n.add(a);const c=new ee;c.position.copy(r.position),Jt.push(c);const l=new THREE.Object3D;I.setMatrixAt(t,l.matrix),c.u.c=l.matrix.clone(),A.setMatrixAt(t,l.matrix),c.u.t=l.matrix.clone();const u=1.5;c.u.r=[];for(let e=0;e<8;e++)l.matrix.identity().decompose(l.position,l.quaternion,l.scale),l.position.x+=Math.random()*u*30-.5*u*30,l.position.z+=Math.random()*u-.5*u,l.updateMatrix(),c.u.r.push(l.matrix.clone()),D.setMatrixAt(8*t+e,l.matrix);r.u.Hn=t,0===t?(r.u.Mn="p",r.u.color=i,r.u.mn=100,_(t,1),r.u.scale=1):63===t?(r.u.Mn="e",r.u.mn=100,r.u.color=o,_(t,0)):(r.u.color=new THREE.Color(16777215),_(t,0)),N(r,r.u.color)}n.add(I),n.add(A),n.add(D),ne(),function(){const t=new THREE.CylinderGeometry(.2,0,.9,4,1);t.scale(.3,.3,.3),t.rotateX(-Math.PI/2);const e=new THREE.InstancedBufferGeometry;e.index=t.index,e.attributes.position=t.attributes.position,e.attributes.uv=t.attributes.uv,e.instanceCount=It;const r=new Float32Array(8192);let s=0;for(let t=0;t<St;t++)for(let e=0;e<St;e++)r[s++]=e/63,r[s++]=t/63;e.setAttribute("dtUv",new THREE.InstancedBufferAttribute(r,2)),At={tP:{value:null},tV:{value:null},eC:{value:o},pC:{value:i}};const a=new THREE.ShaderMaterial({uniforms:At,vertexShader:E(),fragmentShader:T(),side:THREE.DoubleSide}),c=new THREE.InstancedMesh(e,a,It);c.frustumCulled=!1,n.add(c)}(),Ut=new s,n.add(Ut.instancedMesh);const k=yield null===(e=navigator.xr)||void 0===e?void 0:e.isSessionSupported("immersive-vr"),W=k?"Play in VR":"Play";function z(t){const e=Ct[t],n=new THREE.Matrix4;e.updateMatrixWorld(),n.identity().extractRotation(e.matrixWorld);const i=new THREE.Raycaster;return i.camera=a,i.ray.origin.setFromMatrixPosition(e.matrixWorld),i.ray.direction.set(0,0,-1).applyMatrix4(n),i.intersectObjects(Ft)}function Y(t,e){if(t.length>0){null==e||e.preventDefault();const n=Ft.indexOf(t[0].object),i=Dt[n];i&&N(i,r),Ht&&i!==Ht&&(N(i,Ht.u.color),function(t,e,n){const i=(new THREE.Vector3).subVectors(n,e).length(),o=(new THREE.Vector3).addVectors(e,n).multiplyScalar(.5);t.rotation.set(0,0,0),t.scale.set(1,1,1);const r=new THREE.Matrix4;r.lookAt(e,n,new THREE.Vector3(0,1,0));const s=(new THREE.Matrix4).makeRotationX(Math.PI/2);r.multiply(s),t.applyMatrix4(r),t.scale.setY(i),t.position.copy(o),t.visible=!0}(x,Ht.position,i.position)),bt!==i&&(bt&&N(bt,bt.u.color),bt=i)}else x.visible=!1,bt&&N(bt,bt.u.color)}function X(t,e){if(t.length>0){null==e||e.preventDefault();const n=Dt[Ft.indexOf(t[0].object)];"p"===n.u.Mn&&(m.enabled=!1,Ht=n,Gt=!0)}}function j(t,e){t.length>0&&(bt=Dt[Ft.indexOf(t[0].object)],Ht&&bt!==Ht&&ht(Ht,bt)),m.enabled=!0,Ht&&N(Ht,Ht.u.color),bt&&N(bt,bt.u.color),Ht=null,bt=null,Gt=!1,x.visible=!1}function N(t,e){t.traverse((t=>{if(t instanceof THREE.Mesh){const n=t.material;n.emissive.copy(e),n.color.copy(e),n.emissiveIntensity=.1}}))}function K(t,e){const n=t.u.size;("p"===t.u.Mn||"e"===t.u.Mn)&&(t.u.mn+=n*e*.001),function(t,e){const n=Math.min(1,e/100);t.u.pn?(t.u.pn.updateText(e.toString(),new THREE.Color(t.u.color.r*n,t.u.color.g*n,t.u.color.b*n)),t.u.pn.setScale(Math.min(1+e/100,2))):(t.u.pn=function(t,e=!1,n=!1){return Ut.X(t,new THREE.Color(4095),e,n)}(e.toString(),!0),t.u.pn.setPosition(t.position.x,t.position.y+.2,t.position.z)),"p"===t.u.Mn&&_(t.u.Hn,Math.min(1,e/100))}(t,Math.floor(t.u.mn))}function J(t,e){jt[t]||(jt[t]=[]),jt[t].push(e)}function Z(t,e){if(!jt[t])return;const n=jt[t].indexOf(e);n>-1&&jt[t].splice(n,1)}J("tA",(t=>{!function(t){if(Kt)return;Qt.e=0,Qt.p=0;for(let e=0;e<t.length;e+=4)if(t[e+3]<0){const n=Dt[Math.floor((-t[e+3]-.5)*St)],r=t[e+1]<.6005?"p":"e";n&&(xt(r,n.position,L),n.u.Mn&&n.u.Mn===r?n.u.mn+=1:(n.u.mn-=1,n.u.mn<=0&&(n.u.mn=1,n.u.Mn=r,n.u.color="p"===r?i:o,N(n,n.u.color),n.u.yn+="p"===r?Math.PI:-Math.PI,n.u.yn=n.u.yn%(2*Math.PI)))),Nt.push(e)}else t[e+3]>0&&(t[e+1]<.6005&&t[e+1]>.5995?Qt.p++:t[e+1]>.6005&&t[e+1]<.6015&&Qt.e++);const e=Dt.map((t=>t.u.Mn)),n=e.every((t=>[null,"p"].includes(t)))&&0===Qt.e,r=e.every((t=>[null,"e"].includes(t)))&&0===Qt.p;let s;n?s="Victory!":r&&(s="You lose. Darkness has fallen."),s&&(kt=!1,Ot.xr.isPresenting&&(p.T(),v()),document.getElementById("p").innerHTML=s,ct())}(t),function(){const t=Date.now();for(const e of Dt)K(e,e.u.Mn?t-Pt:0);Pt=t}()})),Ot.setAnimationLoop((function(t){m.update();const e=t-Wt;if(Wt=t,function(){const t=Ot.xr.getSession(),e=Date.now();if(t){const n=t.inputSources;for(let t=0;t<n.length;t++){const i=n[t].gamepad;if(i){const t=i.axes;t[2]>.5&&e-te>250?(_t.rotateY(-Math.PI/4),te=e):t[2]<-.5&&e-te>250&&(te=e,_t.rotateY(Math.PI/4)),Ut.j=_t.rotation.y}}}}(),kt){Pt=Pt||Date.now(),Vt.ct(jt);const t=Vt.ht(Lt).texture,n=Vt.ht(Bt).texture;At.tP.value=t,At.tV.value=n,function(){if(!Ct[0])return[];let t=[];t=null===$t?[...z(0),...z(1)]:z($t),Y(t)}();for(const t of Dt){const n=e/1200,i=t.u.yn-t.rotation.x;if(Math.abs(i)>.01){const e=0===t.u.yn;t.rotation.x+=i*n;const o=((("p"===t.u.Mn?1:0)^+e)-t.u.xn.morphTargetInfluences[0])*n;t.u.xn.morphTargetInfluences[0]+=o,t.u.xn.morphTargetInfluences[0]=Math.min(Math.max(t.u.xn.morphTargetInfluences[0],0),1),"p"===t.u.Mn?t.u.scale=(1-Math.abs(i/Math.PI))*t.u.mn/100:"e"===t.u.Mn&&(t.u.scale=0),t.u.scale=Math.min(Math.max(t.u.scale,0),1),_(t.u.Hn,t.u.scale,t.rotation.x+t.u.yn)}}}H.userData.dn&&(H.userData.dn.uniforms.time.value+=.03),S.userData.dn&&(S.userData.dn.uniforms.time.value+=.03),Ot.render(n,a)}));const $=new THREE.Raycaster,tt=new THREE.Vector2;function et(t){return{x:t.clientX,y:t.clientY}}function nt(t){const e=t instanceof TouchEvent?et(t.touches[0]):et(t);tt.x=e.x/window.innerWidth*2-1,tt.y=-e.y/window.innerHeight*2+1,$.setFromCamera(tt,a),X($.intersectObjects(Ft),t)}function it(t){if(!Gt)return;const e=t instanceof TouchEvent?et(t.touches[0]):et(t);tt.x=e.x/window.innerWidth*2-1,tt.y=-e.y/window.innerHeight*2+1,$.setFromCamera(tt,a),Y($.intersectObjects(Ft))}function ot(t){if(!Gt)return;const e=t instanceof TouchEvent?et(t.changedTouches[0]):et(t);tt.x=e.x/window.innerWidth*2-1,tt.y=-e.y/window.innerHeight*2+1,$.setFromCamera(tt,a),j($.intersectObjects(Ft))}function rt(t){X(z(t)),$t=t}function st(t){bt=null,j(z(t)),$t=null}function at(t=.5){const e=new ee,n=1+2*Math.random(),o=3+4*Math.random(),r=new THREE.CylinderGeometry(o,n,1,24),s=new THREE.CylinderGeometry(n,o,1,24);r.morphAttributes.position=[],r.morphAttributes.normal=[],r.morphAttributes.position[0]=s.attributes.position,r.morphAttributes.normal[0]=s.attributes.normal;const a=new THREE.MeshStandardMaterial({color:i}),c=new THREE.Mesh(r,a);return c.morphTargetInfluences[0]=t,c.position.set(0,0,0),e.add(c),r.computeBoundingSphere(),e.u=e.userData,e.u.size=r.boundingSphere?r.boundingSphere.radius:0,e.u.mn=Math.floor(Math.random()*e.u.size*10),e.u.Mn=null,e.u.scale=0,e.u.yn=0,e.u.xn=c,e.scale.set(.1,.1,.1),e}function ct(){Pt=Date.now();const t=kt?"none":"block";document.getElementById("p").style.display=t}window.addEventListener("mousedown",nt,!1),window.addEventListener("mousemove",it,!1),window.addEventListener("mouseup",ot,!1),window.addEventListener("touchstart",nt,!1),window.addEventListener("touchmove",it,!1),window.addEventListener("touchend",ot,!1);const lt=document.getElementById("x");null==lt||lt.addEventListener("click",(()=>{document.getElementById("s").style.display="none",document.getElementById("i").style.display="block"}));const ut=document.getElementById("b");function ht(t,e){!function(t,e,n,i){const o=(Dt.indexOf(n)+.5)/St+.5,r=Vt.createTexture(),s=Vt.createTexture(),a=e.position;let c=0;const l=[],u=t=>{r.image.data.set(t);const n=r.image.data;for(let t=0;t<l.length;t++){const e=l[t];"p"===i?(n[e]=a.x+.1*(Math.random()-.5),n[e+1]=a.y-.1*(Math.random()-.5),n[e+2]=a.z+.1*(Math.random()-.5),n[e+3]=.6):(n[e]=a.x+.1*(Math.random()-.5),n[e+1]=a.y+.5*Math.random(),n[e+2]=a.z+.1*(Math.random()-.5),n[e+3]=.601)}Z("tP",u),r.needsUpdate=!0;const o=Vt.ht(Lt);Vt.st(r,o),s.needsUpdate=!0;const c=Vt.ht(Bt);Vt.st(s,c),e.u.mn-=e.u.mn/2,l.length=0,Kt=!1},h=e=>{Kt=!0,s.image.data.set(e);const n=s.image.data;for(let e=0;e<n.length&&!(Qt[i]+c>=1984)&&(0===n[e+3]&&(n[e]=0,n[e+1]=0,n[e+2]=0,n[e+3]=o,c++,l.push(e)),!(c>t-1));e+=4);Math.floor(t),Z("tV",h),J("tP",u)};J("tV",h)}(t.u.mn/2,t,e,t.u.Mn)}ut&&(ut.innerHTML=W,ut.addEventListener("click",(function(){var t;return Rt(this,void 0,void 0,(function*(){Zt=parseInt(document.getElementById("d").value),Bt.material.uniforms.d.value=Zt,k&&(yield p.v(),function(){for(let t=0;t<2;t++){const e=Ot.xr.getController(t);_t.add(e);const n=new THREE.BoxGeometry(.025,.025,.2),o=new THREE.MeshStandardMaterial({color:i}),r=new THREE.Mesh(n,o);e.add(r),Ct.push(e),e.addEventListener("selectstart",(()=>rt(t))),e.addEventListener("selectend",(()=>st(t)))}}()),(new gt).start(),null===(t=document.getElementById("i"))||void 0===t||t.remove(),m.autoRotate=!1,kt=!0,window.onblur=()=>{kt=!1,ct()},window.onfocus=()=>{kt=!0,ct()},document.addEventListener("keydown",(t=>{"p"===t.key&&(kt=!kt),ct()})),window.scene=n,setInterval((()=>{const t=Dt.filter((t=>"e"===t.u.Mn)),e=Dt.filter((e=>!t.includes(e))),n=e.sort(((t,e)=>e.u.size/(e.u.mn+1)-t.u.size/(t.u.mn+1))),i=t[Math.floor(Math.random()*t.length)],o=Math.random()<Zt/3?n[0]:e[Math.floor(Math.random()*e.length)];i&&o&&i!==o&&ht(i,o)}),5e3-1e3*Zt)}))})))}))}()}()</script>