<!doctype html><title>Get the Pigeon - js13kGames 2018</title><meta name=viewport content="width=device-width,user-scalable=no"><script src=/2018/webxr/aframe.js></script><style>body{margin:0;padding:0;font-family:"Liberation Sans",Arial,sans;font-size:2vw;text-align:center}#debugGEl{position:absolute;top:0;bottom:0;left:0;right:0}#intro{position:absolute;z-index:10;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);padding:0 10vw}.box{border:1vw solid #e80;background:rgba(255,255,255,.6);box-shadow:0 0 10vw #000,inset 0 0 20vw rgba(0,0,0,.5);padding:4vw;text-align:left;border-radius:10vw}.box h1{margin:0;text-align:center;font-size:6vw;color:#e70;text-shadow:0 0 4vw #ff0;text-decoration:underline}#btStart{border:3px solid #fc6;padding:1vw 2vw;border-radius:1vw;background:#f90;font-size:5vw;font-weight:700;color:#620;text-shadow:1px 1px 0 #ffc800;box-shadow:0 0 3vw #000,inset 0 0 3vw rgba(8,3,0,.5)}.red{color:#c00}.a-enter-vr-button{z-index:5}</style><section id=intro><div class=box><header><h1>      Get the Pigeon!      </h1></header><article><p>You know... We need that <b class=red>red</b> magnetic pigeon. Unhappily we only have that old plane and you must fly offline. At least you have this "fishing pole" like with a magnet "fishhook". You need do nothing but to pilot. I will hold out the "fishing pole".<p>Will not to be easy to get near enought to catch that pigeon, so try to <b>enjoy the nature</b>, the montains are green this season... fly between balloons, try to see the iris of a <b>dragoon</b>... It will not flame you, however, care on to do not crash the plane on its hard scales.<div align=center><button id=btStart onclick=start(10)>Start!</button></div></article></div></section><a-scene background="color: #6AE" fog="type: linear; far: 850; color: #6AE"><a-assets id=assets><canvas id=cSky></canvas><canvas id=cGround></canvas><canvas id=cCloud></canvas><canvas id=cTree></canvas><canvas id=cMountain></canvas><canvas id=cEye></canvas></a-assets><a-entity id=drago position="0 150 -10" color=#C00><a-sphere id=dragoHead class=solid position="0 0 1.8" radius=1.8 color=#C00><a-cone position="0 0 1.8" rotation="90 0 0" color=#C00 radius-bottom=1.65 radius-top=.6 height=2.2></a-cone><a-sphere id=eyeLeft position="1.6 .3 .6" rotation="0 -40 0" radius=.3 src=#cEye draw-canvas=cEye></a-sphere><a-sphere id=eyeRight position="-1.6 .3 .6" rotation="0 40 180" radius=.3 src=#cEye draw-canvas=cEye></a-sphere><a-cone position="1.5 1.6 -1.2" rotation="-60 -17 0" color=#E80 radius-bottom=.4 radius-top=0 height=3></a-cone><a-cone position="-1.5 1.6 -1.2" rotation="-60 17 0" color=#E80 radius-bottom=.4 radius-top=0 height=3></a-cone></a-sphere><a-entity id=dragBody></a-entity></a-entity><a-entity id=plane position="0 80 700" rotation="0 0 0"><a-camera id=cam far=800 position="0 .3 0" look-controls="enabled: false" active rotation="0 0 0" active=false><a-text id=info anchor=center color=#E80 width=2 value="Press Start" position=".8 0 -.5"></a-text><a-plane id=elice position="0 -.3 -.4" color=#DDD rotation="0 0 0" height=.8 width=.08><a-animation dur=800 repeat=indefinite easing=linear loop=true attribute=rotation from="0 0 0" to="0 0 360"></a-animation><a-triangle color=#DDD opacity=0.5 vertex-a=".04 .4 0" vertex-b=".04 0 0" vertex-c=".2 .35 0"></a-triangle><a-triangle color=#DDD opacity=0.5 vertex-a="-.04 0 0" vertex-b="-.2 -.35 0" vertex-c="-.04 -.4 0"></a-triangle></a-plane><a-cylinder id=planeBody position="0 -.3 -.2" radius=.2 height=.3 rotation="90 0 0" color=#F80><a-cylinder id=arm position=".15 -.1 -.3" rotation="35 -40 0" radius=.01 height=.5 color=#888><a-sphere id=armEnd radius=.015 color=#888 position="0 -.25 0"></a-sphere></a-cylinder></a-cylinder></a-camera></a-entity><a-sphere id=catcher radius=.02 color=#555 line="start: 0 0 0; end: 0 0 0; color: #444"></a-sphere><a-box id=ground position="0 -1 0" rotation="-90 0 0" width=2400 height=2400 deep=2 src=#cGround repeat="100 100" material="side: double" color=#280></a-box></a-scene><script>"use strict";var startTime,started=!1,maxPlaneY=200,skyColor="#6AE";const scene=cam.sceneEl,deg360=2*Math.PI,deg180=Math.PI,deg90=Math.PI/2,deg45=Math.PI/4,oneTurn=deg360,halfTurn=deg180,quarterTurn=deg90;var alphaPingeon,thePingeon,armEndRealPos,g={x:1,y:0,z:0},fps=30,thePingeonWasCatched=!1;const sin=Math.sin,cos=Math.cos,abs=Math.abs,round=Math.round,dbgXYZ=o=>`x:${round(10*o.x)/10}, y:${round(10*o.y)/10}, z:${round(10*o.z)/10}`,xyzDo=o=>["x","y","z"].forEach((e=>o(e)));function rnd(o,e){return void 0!==e&&null!=e||(e=o,o=0),Math.random()*(e-o)+o}const rRnd=(o,e)=>Math.round(rnd(o,e));function roundDec(o,e){var t=10**e;return Math.round(o*t)/t}function debugXYZ(o,e,t=3){console.log(o+` x:${roundDec(e.x,t)} y:${roundDec(e.y,t)} z:${roundDec(e.z,t)}`)}window.mk=function(o,e,t){var i=document.createElement("a-"+o);for(var n in e)i.setAttribute(n,e[n]);return t?t.appendChild(i):scene.appendChild(i),i},HTMLElement.prototype.mk=function(o,e){return mk(o,e,this)},HTMLElement.prototype.selfRemove=function(){this.parentNode.removeChild(this)};var boidsCenter,boids=window.boids=[],pingeonCounter=0,logThePingeon=(...o)=>console.log("ThePingeon",...o);function mkPingeon(o,e,t,i="#DDD"){var n=mk("sphere",{position:`${o} ${e} ${t}`,radius:.3,color:i});return n.mk("sphere",{position:"0 .3 0",radius:.18,color:i}),n.mk("cone",{position:"0 .5 0","radius-bottom":.1,"radius-top":0,height:.2,color:"#E80"}),n.mk("sphere",{position:"-.3 0 0",scale:"1 1 .3",radius:.25,color:i}).mk("animation",{dur:400,repeat:"indefinite",easing:"linear",loop:"true",direction:"alternate",attribute:"rotation",from:"0 -30 0",to:"0 30 0"}),n.mk("sphere",{position:".3 0 0",scale:"1 1 .3",radius:.25,color:i}).mk("animation",{dur:400,repeat:"indefinite",easing:"linear",loop:"true",direction:"alternate",attribute:"rotation",from:"0 30 0",to:"0 -30 0"}),n.mk("sphere",{position:"0 -.3 0",scale:"1 1 .3",radius:.2,color:i}),n.id="pingeon"+pingeonCounter++,boids.push(n),n.distTo={},n.vecTo={},n.pos=n.object3D.position,n.rotation=n.object3D.rotation,n.rotation.order="ZYX",n.rotation.x=-deg90,n.rotation.y=deg45,n.scale=1,n.will=n.rotation.clone(),n.nearest=null,n.speedMult=1,n}(()=>{new THREE.Vector3(0,1,0);window.boidTic=function(o){if(o%4==0){boidsCenter=new THREE.Vector3;for(var e,t=0;e=boids[t];t++){for(var i,n=t+1;i=boids[n];n++){var r=e.pos.distanceTo(i.pos);e.distTo[i.id]=i.distTo[e.id]=r,(!e.nearest||e.nearest.distTo[e.id]>r)&&(e.nearest=i),(!i.nearest||i.nearest.distTo[i.id]>r)&&(i.nearest=e),e.vecTo[i.id]=i.pos.clone().sub(e.pos),i.vecTo[e.id]=e.pos.clone().sub(i.pos)}boidsCenter.add(e.pos)}xyzDo((o=>boidsCenter[o]=(boidsCenter[o]/boids.length+2*alphaPingeon.pos[o])/3));for(var a=0;p=boids[a];a++){if(p.speedMult=(9*p.speedMult+1)/10,p.distToCenter=p.pos.distanceTo(boidsCenter),p.vecToCenter=boidsCenter.clone().sub(p.pos),p.pos.x<-550)p.will.y=-deg90;else if(p.pos.x>550)p.will.y=+deg90;else if(p.pos.z<-550)p.will.y=p.will.y<0?-deg180:deg180;else if(p.pos.z>550)p.will.y=p.will.y<deg180?0:deg360;else if(p.pos.y<75)p.will.x=.2-deg90;else if(p.pos.y>120)p.will.x=-deg90-.2;else if(p.nearest.distTo[p.id]<.5){var s=p.nearest.pos;s.x>p.pos.x&&(p.will.y+=.05),s.x<p.pos.x&&(p.will.y-=.05),s.y>p.pos.y&&(p.will.x-=.05),s.y<p.pos.y&&(p.will.x+=.05)}else if(p.distToCenter>8){var l=(new THREE.Vector2(p.vecToCenter.x,-p.vecToCenter.z).angle()-deg90)%deg360,d=p.will.y%deg360,c=abs(d-l)%deg360;(c=Math.min(c,deg360-c))>deg90&&Math.random()<.666?p.speedMult=.3:abs(boidsCenter.x-p.pos.x)>abs(boidsCenter.z-p.pos.z)?(boidsCenter.x>p.pos.x&&(p.will.y=-deg90),boidsCenter.x<p.pos.x&&(p.will.y=+deg90)):(boidsCenter.z>p.pos.z&&(p.will.y=p.will.y<0?-deg180:deg180),boidsCenter.z<p.pos.z&&(p.will.y=p.will.y<deg180?0:deg360)),boidsCenter.y>p.pos.y&&(p.will.x=(p.will.x+deg45)/2),boidsCenter.y<p.pos.y&&(p.will.x=(p.will.x-deg45)/2)}else o%120==0?(p.will.y+=rnd(-deg90,deg90),p.will.x+=rnd(-.2,.2)-deg90):p.will.copy(p.nearest.will);p.will.x>-deg45&&(p.will.x=-deg45),p.will.x<-deg90-deg45&&(p.will.x=-deg90-deg45),p.will.y=p.will.y%360,p.will.z*=.05}}var p,u=7/fps;for(a=0;p=boids[a];a++)if(thePingeonWasCatched&&p==thePingeon){if(thePingeon.scale>.12){thePingeon.scale-=.04,thePingeon.scale<.12&&(thePingeon.scale=.12);let o=thePingeon.scale;thePingeon.setAttribute("scale",`${o} ${o} ${o}`)}xyzDo((o=>{abs(p.pos[o]-armEndRealPos[o])<.5?p.pos[o]=armEndRealPos[o]:p.pos[o]=(4*p.pos[o]+armEndRealPos[o])/5}))}else{xyzDo((o=>p.rotation[o]=(9*p.rotation[o]+p.will[o])/10));var g=new THREE.Vector3(0,u*p.speedMult,0).applyEuler(p.rotation);xyzDo((o=>{p.pos[o]+=g[o]}))}}})(),(()=>{var o,e="#C00";var t=0;(()=>{var t=cEye.width=128,i=cEye.height=32,n=cEye.getContext("2d");for(n.fillStyle="#FA0",n.fillRect(0,0,t,i),n.fillStyle="#C60",n.fillRect(t/2-10,0,20,i),n.fillStyle="#A40",o=0;o<i;o+=2)n.fillRect(t/2-10,o,20,1);n.fillStyle="#000",n.fillRect(t/2-4,0,8,i),n.fillStyle=e,n.fillRect(2*t/3,0,t/3,i)})();var i=[];for(o=0;o<9;o++)i.push(dragBody.mk("sphere",{position:"0 0 -"+1.2*o,radius:1.4,class:"solid",color:e}));var n=9*1.2;for(o=1;o<=18;o++){let t=1.4-2.8*o/48.6;i.push(dragBody.mk("sphere",{position:`0 0 -${n}`,radius:t,class:"solid",id:`dTail${o}`,color:e})),n+=t-.1}var r=i[1],a=i[26];a.mk("cone",{position:"0 0 .15",rotation:"90 0 0",scale:"1 1 .1","radius-bottom":.6,"radius-top":0,height:.9,color:e}),a.mk("cone",{position:"0 0 -.9",rotation:"-90 0 0",scale:"1 1 .1","radius-bottom":.6,"radius-top":0,height:1.2,color:e});var s=r.mk("cone",{position:"1.7 0 0",rotation:"0 0 90",scale:".1 1 1","radius-bottom":2,"radius-top":0,height:2,color:e});s.mk("cone",{position:"0 -1.5 0",rotation:"0 0 180",scale:"1 1 1","radius-bottom":2,"radius-top":0,height:1,color:e});var l=r.mk("cone",{position:"-1.7 0 0",rotation:"0 0 -90",scale:".1 1 1","radius-bottom":2,"radius-top":0,height:2,color:e});l.mk("cone",{position:"0 -1.5 0",rotation:"0 0 180",scale:"1 1 1","radius-bottom":2,"radius-top":0,height:1,color:e});const d=(o,e,t=sin)=>t((e/8-o)/1.35);window.dragoTic=function(o){t+=.017/fps,drago.object3D.position.x=500*cos(t),drago.object3D.position.z=500*sin(t),drago.object3D.rotation.y=-t,i.forEach(((e,t)=>{e.object3D.position.y=.666*d(t,o)})),dragoHead.object3D.position.y=1.2*d(-1,o),dragoHead.object3D.rotation.x=.3*-d(0,o,cos),a.object3D.rotation.x=-d(26,o,cos);var e=-d(1,o,cos);s.object3D.rotation.z=deg90+.8*e,s.object3D.position.y=.6*e,l.object3D.rotation.z=-deg90-.8*e,l.object3D.position.y=.6*e,"undefined"!=typeof camDrago&&(camDrago.object3D.position.x=drago.object3D.position.x-10,camDrago.object3D.position.z=drago.object3D.position.z)}})(),(()=>{var o=[];function e(e,t,i){var n=mk("entity",{id:"balloon"+o.length,position:"0 150 0",class:"solid",radius:30,"data-colide-type":"a-sphere"}),r={radius:35,position:"0 5 0",scale:".5 1 1"};n.mk("sphere",{...r,rotation:"0 0   0",color:e}),n.mk("sphere",{...r,rotation:"0 30  0",color:t}),n.mk("sphere",{...r,rotation:"0 60  0",color:e}),n.mk("sphere",{...r,rotation:"0 90  0",color:t}),n.mk("sphere",{...r,rotation:"0 120 0",color:e}),n.mk("sphere",{...r,rotation:"0 150 0",color:t}),n.mk("cylinder",{radius:1.5,height:2,position:"0 -35 0",color:"#740"});var a=n.object3D.rotation;setInterval((()=>a.y+=.005),100),n.object3D.position.ang=i,o.push(n.object3D.position)}e("#80C","#608",0),e("#EB0","#7B0",deg90),e("#C06","#804",deg180),e("#06C","#008",-deg90),window.balloonTic=function(e){o.forEach((o=>{o.ang+=.006/fps,o.x=750*cos(o.ang),o.z=750*sin(o.ang)}))}})(),(()=>{var o=0,e=new THREE.Euler(0,0,0),t=new THREE.Vector3(0,0,.01),i=1;function n(o,e,t){o.array[e+0]=t.x,o.array[e+1]=t.y,o.array[e+2]=t.z,o.needsUpdate=!0}plane.rotation=plane.object3D.rotation,plane.pos=plane.object3D.position,arm.pos=arm.object3D.position,armEnd.pos=armEnd.object3D.position,catcher.pos=catcher.object3D.position,setTimeout((()=>{catcher.line=catcher.getObject3D("line").geometry.attributes.position,catcher.lineMaterial=catcher.getObject3D("line").material,catcher.lineMaterial.linewidth=10}),10),window.planeTic=r=>{if(started){if(plane.dead)return function(){(i*=.95)<.001&&(i=0);(c+=.2/fps)<3&&(c<2?(l.setAttribute("radius",1.1*c),l.setAttribute("opacity",1-.8*c),d.setAttribute("radius",.8*c),d.setAttribute("opacity",1-.5*c)):(console.log("Remove explosion"),c=3,d.selfRemove(),l.selfRemove()));planeBody.object3D.rotation.y+=-i/5,plane.pos.y>-.4&&(plane.pos.y-=.5,plane.pos.y<-.4&&(plane.pos.y=-.4));cam.object3D.rotation.z/=1.01,plane.rotation.x/=1.01,Math.abs(planeBody.object3D.position.x)>.5&&(planeBody.object3D.position.x/=1.1);planeBody.object3D.position.z>-1&&(planeBody.object3D.position.z-=.01);planeBody.object3D.position.y>-.4&&(planeBody.object3D.position.y-=.01);if(e.x<-quarterTurn/2){var o=1.1+(quarterTurn+e.x);cam.object3D.position.y-=i/o,elice.object3D.position.y+=i/o,planeBody.object3D.position.y+=i/o}e.x>-.1&&(cam.object3D.position.y+=i/14,elice.object3D.position.y-=i/14,planeBody.object3D.position.y-=i/14);t=new THREE.Vector3(0,0,i).applyEuler(e),xyzDo((o=>{cam.object3D.position[o]+=3*t[o],elice.object3D.position[o]-=1.5*t[o],planeBody.object3D.position[o]-=1.5*t[o]}))}();i=10/fps;var p=function(){g.x>10&&(g.x=10),g.x<-10&&(g.x=-10),g.y>10&&(g.y=10),g.y<-10&&(g.y=-10),g.z>10&&(g.z=10),g.z<-10&&(g.z=-10);var o={up:g.z/10,down:g.z/10*-1,left:g.y/10*-1,right:g.y/10,normal:g.x/10,upsideDown:g.x/10*-1},e={name:"normal",val:0};for(var t in o)o[t]>e.val&&(e={name:t,val:o[t]});return o.bigger=e.name,o}();plane.rotation.x=p.up*-quarterTurn,plane.rotation.y=o,cam.object3D.rotation.z=p.left*quarterTurn;var u=sin(-cam.object3D.rotation.z);0!=u&&(o+=u/-60),e=new THREE.Euler(p.up*-quarterTurn,o,0,"ZYX"),t=new THREE.Vector3(0,0,i).applyEuler(e),plane.pos.sub(t),plane.pos.y>maxPlaneY-3&&(plane.pos.y>maxPlaneY?(plane.pos.y=maxPlaneY,scene.setAttribute("fog","color","red"),scene.setAttribute("background","color","red")):(scene.setAttribute("fog","color",skyColor),scene.setAttribute("background","color",skyColor)));var h=(armEndRealPos=s(armEnd)).distanceTo(thePingeon.pos);thePingeonWasCatched?(arm.pos.x>.05&&(arm.pos.x-=.01),arm.pos.y<.2&&(arm.pos.y+=.01),arm.pos.z<-.1&&(arm.pos.z+=.01)):h>80?(arm.pos.y<.4&&(arm.pos.y+=.01),arm.pos.z<0&&(arm.pos.z+=.01)):(arm.pos.y>-.1&&(arm.pos.y-=.01),arm.pos.z>-.3&&(arm.pos.z-=.01));var y=(new THREE.Vector3).copy(thePingeon.pos).sub(armEndRealPos);if(h>2.5)y.normalize().multiplyScalar(.1);else if(!thePingeonWasCatched){thePingeonWasCatched=!0,alphaPingeon=boids[0],catcher.setAttribute("radius",.31);let o=Math.round((Date.now()-startTime)/1e3),e=o%60,t=(o-e)/60;for(e=e.toString();e.length<2;)e="0"+e;info.setAttribute("width",2),info.setAttribute("value",`You did it!\nin ${t}:${e} minutes`)}catcher.pos.copy(y.clone().add(armEndRealPos)),n(catcher.line,0,{x:0,y:0,z:0}),n(catcher.line,3,y.negate()),a()}};var r=[];function a(){for(var o,e=0;o=r[e];e++){var t=(o.dataset.colideType||o.tagName).split("-")[1];if((i=o).realPos=s(i),a[t.toLowerCase()](o))return p(o)}var i;if(plane.pos.y<0)return p(ground)}function s(o){for(var e=o,t=new THREE.Vector3;e!=scene;)t.applyEuler(e.object3D.rotation),t.add(e.object3D.position),e=e.parentNode;return t}window.updateSolidList=()=>r=document.querySelectorAll(".solid"),a.sphere=function(o){return o.r=o.r||parseFloat(o.getAttribute("radius")),plane.pos.distanceTo(o.realPos)<o.r},a.cylinder=function(o){o.r=o.r||parseFloat(o.getAttribute("radius")),o.h=o.h||parseFloat(o.getAttribute("height"));var{elX:e,elY:t,elZ:i}=o.realPos,{planeX:n,planeY:r,planeZ:a}=plane.pos;return(n-e)**2+(a-i)**2==o.r**2&&r<o.h/2};var l,d,c=.1;function p(o){plane.dead=!0,console.log(`plane hit ${o.tagName} ${o.id}`);plane.pos;l=planeBody.mk("sphere",{radius:.02,color:"#F00"}),d=l.mk("sphere",{radius:.01,color:"#F60"}),i=.08,function(){for(;elice.firstElementChild;)elice.firstElementChild.selfRemove();planeBody.mk("sphere",{position:"0 .2 -.11",radius:.18,color:"#F60"}),planeBody.mk("cone",{position:"0 .65 0","radius-bottom":.2,"radius-top":.08,height:1,color:"#F80"}),planeBody.mk("cone",{position:"-.6 .3 .05",scale:".4 1 1",rotation:"90 0 90","radius-bottom":.2,"radius-top":.1,height:1,color:"#F60"}),planeBody.mk("cone",{position:".6 .3 .05",scale:".4 1 1",rotation:"90 0 -90","radius-bottom":.2,"radius-top":.1,height:1,color:"#F60"}),planeBody.mk("cone",{position:"0 1.06 -.2",scale:".2 1 1",rotation:"-70 0 0","radius-bottom":.15,"radius-top":.05,height:.3,color:"#F60"})}()}})(),(()=>{var o,e,t,i={};for(window.start=function(o=10){intro.style.display="none",info.setAttribute("position","2.4 0 -.5"),info.setAttribute("width",5),info.setAttribute("value",o),0==o?(started=!0,startTime=Date.now(),info.setAttribute("position",".8 0 -.5"),info.setAttribute("width",2),info.setAttribute("value","")):setTimeout((()=>start(--o)),1e3)},(()=>{var o=cGround.width=128,e=cGround.height=128,t=cGround.getContext("2d");t.fillStyle="#170",t.fillRect(0,0,o,e),t.fillStyle="#280",t.fillRect(0,0,o/2,e/2),t.fillRect(o/2,e/2,o,e)})(),(()=>{var o=cCloud.width=64,e=cCloud.height=64,t=cCloud.getContext("2d");t.fillStyle="rgba(255,255,255,0.1)",t.fillRect(0,0,o,e),t.fillStyle="#FFF",t.fillRect(0,0,o/2,e/2),t.fillRect(o/2,e/2,o,e)})(),(()=>{var o=cTree.width=8,e=cTree.height=32,t=cTree.getContext("2d");t.fillStyle="#280",t.fillRect(0,0,o,e),t.fillStyle="#170",t.fillRect(0,e/2,o,e)})(),(()=>{var o=cMountain.width=8,e=cMountain.height=128,t=cMountain.getContext("2d");t.fillStyle="#280",t.fillRect(0,0,o,e),t.fillStyle="#170",t.fillRect(0,e/2,o,e)})(),t=0;t<30;t++)mkPingeon(rnd(10)+200,rnd(95,105),rnd(10)+500);(thePingeon=alphaPingeon=mkPingeon(205,100,500,"#D00")).id="thePingeon";var n=[];for(t=0;t<8;t++){var r=mk("plane",{position:`${rnd(-1500,1500)} ${maxPlaneY+rnd(-60,30)} ${rnd(-1200,1200)}`,width:rnd(400,600),height:rnd(400,600),rotation:"-90 0 0",color:"#FFF",opacity:.5,material:"side: double",src:"#cCloud",repeat:"15 15"});r.pos=r.object3D.position,r.w=parseInt(r.getAttribute("width")),r.speed=rnd(5,8),n.push(r)}var a=(o,e,t,i)=>{var n=`#${rRnd(0,4).toString(16)}${rRnd(7,10).toString(16)}0`;mk("sphere",{class:"solid",position:`${o} ${i} ${e}`,radius:t,src:"#cMountain",repeat:"1 12",color:n}),i>0&&mk("cylinder",{class:"solid",position:`${o} ${i-maxPlaneY} ${e}`,radius:t,height:2*maxPlaneY,src:"#cMountain",repeat:"1 12",color:n})},s=oneTurn/33;for(t=0;t<oneTurn;t+=s)a(o=1200*sin(t),e=1200*cos(t),rnd(110,140),rnd(maxPlaneY,2*maxPlaneY));for(t=0;t<oneTurn;t+=s)a(o=1e3*sin(t+s/2),e=1e3*cos(t+s/2),rnd(100,150),rnd(-100,.8*maxPlaneY));var l=[];function d(o,e,t,i=200){var n=mk("cone",{position:`${o} ${-t/2} ${e}`,"radius-bottom":10,"radius-top":0,height:t,src:"#cTree",repeat:"1 5",color:p});return n.mk("animation",{dur:i,easing:"linear",attribute:"position",from:`${o} ${-t/2} ${e}`,to:`${o} ${t/2} ${e}`}),n.x=o,n.z=e,n.h=t,l.push(n),n}var c=850;for(o=-850;o<c;o+=20)for(e=-850;e<c;e+=20)if(Math.random()<.02&&o**2+e**2<722500){var p=`#${rRnd(0,1).toString(16)}${rRnd(6,8).toString(16)}${rRnd(0,2).toString(16)}`,u=rnd(35,50);d(o,e,u)}l=l.sort(((o,e)=>rnd(-1,1))),setInterval((()=>{if(fps<22&&l.length>80&&function(o){if(o){var e=rnd(360);o.mk("animation",{dur:1e3,easing:"linear",attribute:"rotation",from:`0 ${e} 0`,to:`0 ${e} 90`}),o.mk("animation",{dur:1e3,easing:"linear",attribute:"position",from:`${o.x} ${o.h/2} ${o.z}`,to:`${o.x} 5 ${o.z}`}),setTimeout((()=>o.mk("animation",{dur:1500,easing:"linear",attribute:"position",from:`${o.x} 5 ${o.z}`,to:`${o.x} -7 ${o.z}`})),1500),setTimeout((()=>o.selfRemove()),3e3)}}(l.shift()),fps>25&&l.length<700){for(var o=1700;o**2+e**2>722500;)o=rnd(-850,c),e=rnd(-850,c);d(o,e,rnd(35,50),1e4)}}),500),window.addEventListener("devicemotion",(o=>{var e=event.accelerationIncludingGravity;window.g={x:e.x,y:e.y,z:e.z}}),!0);var h=Date.now(),y=0;if(setInterval((function(){if(++y%10==0){var o=(Date.now()-h)/10;h=Date.now(),fps=1e3/o,y%(10*Math.round(fps/2))==0&&console.log("FPS",Math.round(10*fps)/10)}g.x<10&&(g.x+=.2),i.ARROWLEFT&&(g.y-=.2,g.x/=1.2),i.ARROWRIGHT&&(g.y+=.2,g.x/=1.2),i.ARROWUP&&(g.z+=.3,g.x/=1.2),i.ARROWDOWN&&(g.z-=.3,g.x/=1.2),abs(g.y)>0&&(g.y-=g.y/100),abs(g.z)>0&&(g.z-=g.z/100),planeTic(y),boidTic(y),dragoTic(y),balloonTic(y),n.forEach((o=>{o.pos.x+=o.speed/fps,o.pos.x>1200+o.w&&(o.pos.x=-1200-o.w,o.pos.z=rnd(-1200,1200))}))}),30),"undefined"!=typeof camDebug){var m=camDebug.object3D.position;setInterval((()=>{xyzDo((o=>m[o]=(4*m[o]+thePingeon.object3D.position[o])/5)),m.y=thePingeon.object3D.position.y+40}),30)}document.addEventListener("keydown",(o=>{i[o.key.toUpperCase()]=!0,o.stopPropagation()})),document.addEventListener("keyup",(o=>{i[o.key.toUpperCase()]=!1,o.stopPropagation()})),window.updateSolidList()})()</script>