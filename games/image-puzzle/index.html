<!doctype html><meta name=viewport content="width=device-width"><title>Image Puzzle - js13kGames 2012</title><style>#uploadContainer{width:300px;height:300px;margin:20px auto;border:3px dashed #ccc;text-align:center;background-color:#4d6c81;color:#fff}#mainContent{margin:20px auto}.gameBoard{width:500px;margin:20px auto}#source_holder{width:500px;height:500px;background-size:500px 500px;clear:both;float:left}#helpText{clear:both;font-weight:700;color:#4d6c81}.button{width:100px;height:30px;text-align:center;margin-bottom:5px;cursor:pointer;line-height:30px;margin-right:10px;background-color:#4d6c81;color:#fff;border-radius:5px;float:left}#slider{clear:both}.hide{display:none}.show{display:block}.floatleft{float:left}.floatRight{float:right}.tile{width:125px;height:125px;background-size:500px 500px}.timeCount{font-weight:700;color:#4d6c81;height:30px;width:100px;line-height:30px}.onHover{-webkit-transform:scale(1.1);-o-transform:scale(1.1);-moz-transform:scale(1.1)}.tile.tile00{background-position:0 0}.tile.tile01{background-position:-125px 0}.tile.tile02{background-position:-250px 0}.tile.tile03{background-position:-375px 0}.tile.tile10{background-position:0 -125px}.tile.tile11{background-position:-125px -125px}.tile.tile12{background-position:-250px -125px}.tile.tile13{background-position:-375px -125px}.tile.tile20{background-position:0 -250px}.tile.tile21{background-position:-125px -250px}.tile.tile22{background-position:-250px -250px}.tile.tile23{background-position:-375px -250px}.tile.tile30{background-position:0 -375px}.tile.tile31{background-position:-125px -375px}.tile.tile32{background-position:-250px -375px}.tile.tile33{background:#666!important}.buddy_drag_clone{position:fixed;border:1px solid #dcdcdc;z-index:200012;cursor:pointer}</style><div id=mainContent class=hide><div class=gameBoard><div id=source class=button onclick='slider.helpclick("source")'>Source</div><div id=game onclick='slider.helpclick("game")' class=button>Game</div><div id=shuffle onclick='slider.helpclick("shuffle")' class=button>Shuffle</div><span id=timeElapsed class="floatRight timeCount"></span></div><div class=gameBoard><div id=source_holder class=hide></div><div id=slider></div><div id=previewDrag></div></div><div id=helpText><br>Cool!! Your image is turned into puzzle.<ol><li>Solve the puzzle by rearranging the jumbled tiles into the image you have uploaded.<li>Grey colored tile is an open space.<li>Finding legally movable tile is very simple, Any tile which has open space in its row or column can be legally moved. In desktop browsers it will be highlighted on hovering the mouse.<li>To move tile/tiles just simply click/drag/tap on it. Upon doing so the tile/tiles will slide it to an open space.</ol></div></div><div id=uploadContainer><br><br><div id=dragContainer><br><br>Drop an image here from your machine<br>(Or)<br><input type=file id=imageholder><br><br><br><br>500x500 image is preferrable. Don't you have?<br>No problem!! We will shrink it for you :)</div></div><script>var a,s,d,D,e,c,i={m:{},v:{},c:{},logLevel:4};i.isIE=-1!=navigator.appName.indexOf("Microsoft"),i.userAgent=navigator.userAgent.toLowerCase(),(-1<i.userAgent.search("iphone")||-1<i.userAgent.search("ipad")||-1<i.userAgent.search("android"))&&(i.isMobile=!0),i.timerDiv="",i.helpclick=function(e){i.v.puzzle&&i.v.puzzle.layoutmanager(e)},i.log=function(e,t){},i.initGame=function(){i.v.puzzle=new i.v.Box,i.v.puzzle.paintPuzzle()},i.generateGame=function(){for(var e=i,t=["tile00","tile01","tile02","tile03","tile10","tile11","tile12","tile13","tile20","tile21","tile22","tile23","tile30","tile31","tile32","tile33"],a=0;a<e.c.sliderSize;a++)for(var o=0;o<e.c.sliderSize;o++){var n=Math.floor(Math.random()*t.length),l=t[n];i.log("len "+t.length+" - tile="+l,"info"),t.splice(n,1),(e.m.state[a][o]=l)==e.m.emptyTile&&(e.m.emptyRef.x=a,e.m.emptyRef.y=o)}},i.readFileAsDataURL=function(e){var t=new FileReader;t.onload=function(e){i.log(e.target,"info"),document.getElementById("source_holder").style.backgroundImage="url("+e.target.result+")";var t=document.styleSheets[0],a=[];t.cssRules?a=t.cssRules:t.rules&&(a=t.rules);for(var o=0;o<a.length;o++)if(".tile"==a[o].selectorText.toLowerCase()){a[o].style.backgroundImage="url('"+e.target.result+"')",i.uploadContainer.className="hide",document.getElementById("mainContent").className="",i.initGame(),setInterval(function(){i.m.timeElapsed++;var e=i.m.timeElapsed,t=Math.floor(e/3600),e=e%3600,a=Math.floor(e/60),e=Math.ceil(e%60);i.timerDiv.innerHTML=(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)+":"+(e<10?"0"+e:e)},1e3);break}},i.log(e,"info"),t.readAsDataURL(e)},i.attachDragNDrop=function(){var e=document.getElementById("dragContainer");i.holder=e,i.uploadContainer=document.getElementById("uploadContainer"),document.getElementById("imageholder").onchange=function(){i.readFileAsDataURL(this.files[0])},void 0===window.FileReader&&(i.uploadContainer.innerHTML="Your browser is not HTML5  File API compatible, Please use latest version of your browser or other browser."),e.ondragover=function(){return!(this.className="hover")},e.ondragend=function(){return this.className="",!1},e.ondrop=function(e){return this.className="",e.preventDefault(),e=e.dataTransfer.files[0],i.readFileAsDataURL(e),!1}},window,(c=i).c.sliderSize=4,c.c.isMovelLegal=function(e,t){var a={isLegal:!1};return c.m.emptyRef.x===e&&c.m.emptyRef.y!==t?a={isLegal:!0,direction:"y",displacement:c.m.emptyRef.y-t}:c.m.emptyRef.y===t&&c.m.emptyRef.x!==e&&(a={isLegal:!0,direction:"x",displacement:c.m.emptyRef.x-e}),a},c.c.swap=function(e,t,a){for(var o=a<0?-1*a:a,n={x:c.m.emptyRef.x,y:c.m.emptyRef.y},l=0,i=tempx=c.m.emptyRef.x,r=tempy=c.m.emptyRef.y;l<=o;l++)c.m.state[tempx][tempy]=c.m.state[i][r],tempx=i,tempy=r,"y"===t?r=a<0?r+1:r-1:i=a<0?i+1:i-1;c.m.emptyRef.x=e.x,c.m.emptyRef.y=e.y,c.m.state[e.x][e.y]=c.m.emptyTile,c.v.puzzle.swapTiles(n,t,a),c.m.state.join()===c.m.solution.join()&&alert("Great!! You won the game and the elapsed time is "+c.timerDiv.innerHTML)},window,(e=i).m.emptyTile="tile33",e.m.tileSize=125,e.m.emptyRef={x:1,y:0},e.m.state=[["tile11","tile02","tile21","tile32"],["tile33","tile13","tile12","tile30"],["tile31","tile10","tile23","tile03"],["tile22","tile20","tile01","tile00"]],e.m.solution=[["tile00","tile01","tile02","tile03"],["tile10","tile11","tile12","tile13"],["tile20","tile21","tile22","tile23"],["tile30","tile31","tile32","tile33"]],e.m.timeElapsed=0,window,(D=i).v.Box=function(){this.placeHolder=D.v.getEl("slider"),this.sourceHolder=D.v.getEl("source_holder");var w=this.placeHolder.offsetLeft,x=this.placeHolder.offsetTop,b=(this.previewDrag=D.v.getEl("previewDrag"),this.isDragged=!1,this),H=(this.paintPuzzle=function(){b.placeHolder.innerHTML="",b.previewDrag.innerHTML="";for(var e=document.createDocumentFragment(),t=0;t<D.c.sliderSize;t++)for(var a=0;a<D.c.sliderSize;a++){var o=D.v.createEl("div",{id:"box"+t+a,className:"tile "+D.m.state[t][a]+" floatleft"});D.v.addHandler(o,"mouseover",function(t,a,o){return function(){var e=D.c.isMovelLegal(a,o);0!=b.isDragged||!0!==e.isLegal||D.isMobile||D.v.addClass(t,"onHover")}}(o,t,a)),D.v.addHandler(o,"mouseout",function(e){return function(){D.v.removeClass(e,"onHover")}}(o)),D.v.addHandler(o,"click",function(t,a){return function(){var e;D.log("isDragged="+b.isDragged,"info"),!b.isDragged||D.isMobile?!0===(e=D.c.isMovelLegal(t,a)).isLegal&&(D.v.removeClass(o,"onHover"),D.c.swap({x:t,y:a},e.direction,e.displacement)):b.isDragged=!1}}(t,a)),b.makeDraggable(o,{x:t,y:a}),e.appendChild(o)}b.placeHolder.appendChild(e)},this.swapTiles=function(e,t,a){b.previewDrag.innerHTML="";for(var o=a<0?-1*a:a,n=0,l=e.x,i=e.y;n<=o;n++)D.v.getEl("box"+l+i).className="tile "+D.m.state[l][i]+" floatleft","y"===t?i=a<0?i+1:i-1:l=a<0?l+1:l-1},this.makeDraggable=function(e,c){var u,m=null,v=0,f={},g=0,p=0,h=0,y=0;new D.v.Drag(e,function(e,t,a,o){if("mousedown"==e)D.v.removeClass(o,"onHover");else if("dragstart"==e){m=D.v.createEl("div",{className:"buddy_drag_clone"}),f.displacement;var n=c.x,l=c.y,i=f.displacement<0?-1*f.displacement:f.displacement,o=document.getElementById("box"+c.x+c.y),r=document.getElementById("box"+D.m.emptyRef.x+D.m.emptyRef.y);"y"===f.direction?(m.style.width=i*D.m.tileSize+"px",g=o.offsetTop,h=g+o.offsetHeight,p=(f.displacement<0?(n=D.m.emptyRef.x,l=D.m.emptyRef.y+1,y=o.offsetLeft+o.offsetWidth,r):(y=r.offsetLeft+r.offsetWidth,o)).offsetLeft):(m.style.width=D.m.tileSize+"px",p=o.offsetLeft,y=p+o.offsetWidth,g=(f.displacement<0?(n=D.m.emptyRef.x+1,l=D.m.emptyRef.y,h=o.offsetTop+o.offsetHeight,r):(h=r.offsetTop+r.offsetHeight,o)).offsetTop),D.log("lowx ="+g+" upperx="+h+" lowy="+p+" uppery="+y);for(var s=0;s<i;s++){var d=D.v.createEl("div",{className:"tile "+D.m.state[n][l]+" floatleft"});m.appendChild(d),"y"===f.direction?l++:n++}b.previewDrag.appendChild(m),v=H({x:M(c.x),y:M(c.y)},{x:M(D.m.emptyRef.x),y:M(D.m.emptyRef.y)})}else"drag"==e?t.lastX>=p&&t.lastX<=y&&g<=t.lastY&&t.lastY<=h?(b.isDragged=!0,m.style.left=t.clientX+5+"px",m.style.top=t.clientY+5+"px",m.style.visibility="visible"):m.style.visibility="hidden":"dragend"==e?(a.droppedOnMySelf||(b.isDragged=!1),u=H({x:M(c.x),y:M(c.y)},{x:t.lastY-x,y:t.lastX-w}),D.log("actual ="+v+" draggedDistance="+u),v/2<u&&"visible"==m.style.visibility?(D.log("Drag criteria is obeyed"),!(b.isDragged=!1)===(r=D.c.isMovelLegal(c.x,c.y)).isLegal&&D.c.swap({x:c.x,y:c.y},r.direction,r.displacement)):b.previewDrag.removeChild(m)):"dragcancel"==e&&b.previewDrag.removeChild(m)},document,c,function(){return(f=D.c.isMovelLegal(c.x,c.y)).isLegal})},this.layoutmanager=function(e){switch(e){case"source":D.v.removeClass(b.sourceHolder,"hide"),D.v.addClass(b.placeHolder,"hide");break;case"game":D.v.removeClass(b.placeHolder,"hide"),D.v.addClass(b.sourceHolder,"hide");break;case"shuffle":confirm("You will lose current game state. Are you sure?")&&(D.generateGame(),D.initGame())}},function(e,t){var a=t.y,t=t.x,o=e.y,e=e.x;return distance=Math.sqrt((o-a)*(o-a)+(e-t)*(e-t)),D.log("empty x="+a+" empty y="+t),D.log("source x="+o+" source y="+e),distance<0?-1*distance:distance}),M=function(e){return e*D.m.tileSize+D.m.tileSize/2};D.log("offsetLeft="+w+" offsetTop="+x)},s=window,(d=i).v.Drag=function(a,e,t,o,n){function l(e){return(e.touches&&e.touches.length?e.touches[0].target:e.target||e.srcElement).id}function i(e){var t=[];return e.touches&&e.touches.length?(t[0]=e.touches[0].pageX,t[1]=e.touches[0].pageY,t[2]=e.touches[0].clientX,t[3]=e.touches[0].clientY):(t[0]=e.pageX,t[1]=e.pageY,t[2]=e.clientX,t[3]=e.clientY),t}var r=this;this.callback=e,this.ele=a,this.doc=t||s.document,this.dragStarted=!1,this.mouseIsDown=!1,this.dragSourceId=null,this.dropTargetId=null,this.dragData=o,this.dragThreshold=5,this.touchHandler=function(e){if(1<e.changedTouches.length)return!1;switch(e.type){case"touchstart":r.onMouseDown(e);break;case"touchmove":r.onMouseMove(e);break;case"touchend":r.onMouseUp(e);break;case"touchcancel":r.onMouseUp(e,!0)}},this.onMouseDown=function(e){var t=i(e=window.event||e);if(r.startX=r.lastX=t[0],r.startY=r.lastY=t[1],"touchstart"===e.type)d.v.removeHandler(a,"mousedown",r.onMouseDown),d.v.addHandler(a,"touchmove",r.touchHandler),d.v.addHandler(a,"touchend",r.touchHandler),d.v.addHandler(document.body,"touchcancel",r.touchHandler);else{if(1!=(e.which||e.button))return;if(r.mouseIsDown)return;r.mouseIsDown=!0,d.v.addHandler(r.doc,"mousemove",r.onMouseMove),d.v.addHandler(r.doc,"mouseup",r.onMouseUp),d.v.addHandler(r.doc,"blur",r.onMouseUp),d.v.cancelEvent(e),d.v.stopEventPropogation(e)}r.targetEle=(t=e).touches&&t.touches.length?t.touches[0].target:t.target||t.srcElement,r.doCallback("mousedown")},this.onMouseUp=function(e,t){r.mouseIsDown=!1,"touchend"===(e=window.event||e).type||"touchcancel"===e.type?(d.v.removeHandler(a,"touchmove",r.touchHandler),d.v.removeHandler(a,"touchend",r.touchHandler),d.v.removeHandler(document.body,"touchcancel",r.touchHandler)):(d.v.removeHandler(r.doc,"mousemove",r.onMouseMove),d.v.removeHandler(r.doc,"mouseup",r.onMouseUp),d.v.removeHandler(r.doc,"blur",r.onMouseUp),d.v.cancelEvent(e),d.v.stopEventPropogation(e)),r.dropTargetId=l(e),r.dragStarted&&(t?r.doCallback("dragcancel"):r.doCallback("dragend",{droppedEleId:r.dropTargetId,droppedOnMySelf:r.dragSourceId===r.dropTargetId})),r.dragStarted=!1},this.onMouseMove=function(e){var t,a=i(e=window.event||e);if(r.lastX=a[0],r.lastY=a[1],r.clientX=a[2],r.clientY=a[3],d.isIE&&0==e.button&&!window.performance)return r.onMouseUp();if(r.dragStarted||(t=Math.max(Math.abs(r.startX-r.lastX),Math.abs(r.startY-r.lastY))),!r.dragStarted&&t>=r.dragThreshold)r.dragStarted=!0,r.doCallback("dragstart"),r.dragSourceId=l(e);else if(!r.dragStarted)return d.v.cancelEvent(e);"mousemove"===e.type&&(d.v.cancelEvent(e),d.v.stopEventPropogation(e)),r.doCallback("drag")},this.doCallback=function(e,t){r.callback&&"function"==typeof r.callback&&r.callback.call(r.ele,e,{startX:r.startX,lastX:r.lastX,startY:r.startY,lastY:r.lastY,clientX:r.clientX,clientY:r.clientY},t,r.targetEle)},d.v.addHandler(a,"mousedown",function(e){n()&&r.onMouseDown(e)}),d.v.addHandler(a,"touchstart",function(e){n()&&r.onMouseDown(e)}),d.v.addHandler(document.body,"touchmove",function(e){e.preventDefault()})},e=window,(a=i).v.addHandler=window.addEventListener?function(e,t,a){e.addEventListener(t,a,!1)}:window.attachEvent?function(e,t,a){e.attachEvent("on"+t,a)}:void 0,a.v.removeHandler=window.removeEventListener?function(e,t,a){e.removeEventListener(t,a,!1)}:window.attachEvent?function(e,t,a){e.detachEvent("on"+t,a)}:void 0,a.v.createEl=function(e,t){return"string"!=typeof e?null:(e=document.createElement(e),t&&(t.id&&(e.id=t.id),t.className&&(e.className=t.className),t.class&&(e.className=t.class),t.title&&(e.title=t.title),t.type&&(e.type=t.type),t.value&&(e.value=t.value),t.cssText&&(e.cssText=t.cssText),t.alt&&(e.alt=t.alt),t.src&&(e.src=t.src),t.html&&(e.innerHTML=t.html),t.align&&(e.align=t.align),t.text&&p.View.text(e,t.text),t.name&&(e.name=t.name),t.tabIndex)&&(e.tabIndex=t.tabIndex),e)},a.v.stopEventPropogation=function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&(e.cancelBubble=!0)},a.v.cancelEvent=function(e){"function"==typeof e.preventDefault?e.preventDefault():e.returnValue=!1},a.v.getEl=function(e){return document.getElementById(e)},a.v.hasClass=function(e,t){if(e)return e.classList?e.classList.contains(t):-1<(" "+e.className+" ").indexOf(" "+t+" ")},a.v.addClass=function(e,t){if(e)return e.classList?e.classList.add(t):void(a.v.hasClass(e,t)||(e.className=a.v.getTrimString(e.className+" "+t)))},a.v.setClass=function(e,t){e.className=t},a.v.removeClass=function(e,t){if(e)return e.classList?e.classList.remove(t):void(a.v.hasClass(e,t)&&(e.className=a.v.getTrimString(e.className.replace(new RegExp("(^|\\s)"+t+"(\\s|$)")," "))))},a.v.getTrimString=function(e){return e?e.replace(/^\s+|\s+$/g,""):""},a.v.addHandler(e,"load",function(){a.timerDiv=a.v.getEl("timeElapsed"),"ontouchstart"in document.documentElement||!a.isMobile||alert("Your mobile web browser is not HTML5 touch compatible, Dragging feature wouldn't work"),a.attachDragNDrop()})</script>