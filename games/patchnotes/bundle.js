function bitStreamer(a,b,c,d,e){this.x=a,this.y=b,this.lastX=this.x,this.lastY=this.y,this.orientation=c,this.velocity=d,this.lifeTime=e,this.currentTime=0,this.text=game.common.randInt(0,2),this.isActive=!0,this.update=function(a){this.lastX=this.x,this.lastY=this.y,this.currentTime+=a,this.currentTime>=this.lifeTime&&(this.isActive=!1)},this.draw=function(){var a=game.common.hex2rgb("#FF0000");a[0]=Math.floor(a[0]*(this.lifeTime-this.currentTime)/this.lifeTime),a=game.common.rgb2hex(a[0],a[1],a[2]),draw.drawText(this.x,this.y,this.text,a)}}function bomb(a,b,c,d,e,f,g,h,i){this.x=a,this.y=b,this.orientation=c,this.velocity=d,this.lifeTime=e,this.currentTime=0,this.flicker=e/1.1,this.currentFlicker=0,this.playerSafe=g,this.enemySafe=h,this.type=f,this.state="FIRED",this.color=i,this.fill=!0,this.update=function(a){if(this.currentTime+=a,this.currentFlicker+=a,this.currentFlicker>=a&&(this.fill=!this.fill,this.currentFlicker=0),this.currentTime>this.lifeTime&&(this.state="EXPLODED"),"EXPLODED"==this.state){this.isActive=!1;for(var b=0;b<40;b++)game.currentSector.bulletManager.addBullet(new bullet(this.x+game.common.randInt(-5,5),this.y+game.common.randInt(-5,5),game.common.randInt(0,360),20,1.5,1,this.playerSafe,!1,this.color))}else this.x+=this.velocity*Math.cos(toRad(this.orientation))*a,this.y+=this.velocity*Math.sin(toRad(this.orientation))*a},this.draw=function(){draw.drawCircle(this.x,this.y,1,this.color,this.fill)}}function bullet(a,b,c,d,e,f,g,h,i){this.x=a,this.y=b,this.orientation=c,this.velocity=d,this.elevation=f,this.lifeTime=e,this.currentTime=0,this.playerSafe=g,this.enemySafe=h,this.color=i,i=game.common.hex2rgb(i);for(var j=0;j<i.length;j++)i[j]/=3;this.lowColor=game.common.rgb2hex(i[0],i[1],i[2]),this.isActive=!0,this.update=function(a){if(this.x+=this.velocity*Math.cos(toRad(this.orientation))*a,this.y+=this.velocity*Math.sin(toRad(this.orientation))*a,this.isActive){for(var b=0;b<game.currentSector.enemyManager.enemies.length;b++)this.isActive&&pointInRectangle(this,game.currentSector.enemyManager.enemies[b])&&this.playerSafe&&(game.currentSector.enemyManager.enemies[b].onHit(10),this.isActive=!1);for(var b=0;b<game.currentSector.pillars.length;b++)pointInRectangle(this,game.currentSector.pillars[b])&&(0==this.elevation?this.isActive=!1:1==this.elevation&&1==game.currentSector.pillars[b].elevation&&(this.isActive=!1));for(var b=0;b<game.players.length;b++)this.playerSafe||pointInRectangle(this,game.players[b])&&(0==this.elevation?0==game.players[b].getElevation()&&(this.isActive=!1,game.players[b].onHit(10)):1==this.elevation&&(this.isActive=!1,game.players[b].onHit(10)));this.currentTime+=a,this.currentTime>this.lifeTime&&(this.isActive=!1)}},this.draw=function(){this.isActive&&(this.elevation<game.players[0].getElevation()?draw.drawCircle(this.x,this.y,.5,this.lowColor):draw.drawCircle(this.x,this.y,.5,this.color))}}function bulletManager(){this.bullets=[],this.addBullet=function(a){this.bullets.push(a)},this.update=function(a){for(var b=0;b<this.bullets.length;b++){var c=this.bullets[b];c.update(a),0==c.isActive&&(this.bullets.splice(b,1),b--)}},this.draw=function(){for(var a=0;a<this.bullets.length;a++)this.bullets[a].draw()}}function chaseBoss(a,b,c,d){this.x=a,this.y=b,this.originY=a,this.originY=b,this.width=5,this.height=5,this.orientation=90,this.velocity=45,this.maxHealth=100,this.health=1e3,this.shotElevation=c,this.weapon=d,this.isHit=!1,this.movementState="FOLLOW",this.state="",this.switchTime=3,this.currentSwitchTime=0,this.shotTime=.2,this.currentShotTime=0,this.target=game.players[0],this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y+this.height/2},this.bottom=function(){return this.y-this.height/2},this.update=function(a){if(this.currentShotTime+=a,this.currentSwitchTime+=a,this.currentSwitchTime>this.switchTime&&("FOLLOW"==this.movementState?this.movementState="CHASE":this.movementState="FOLLOW",this.currentSwitchTime=0),"FOLLOW"==this.movementState){this.shoot();var b=this.target.y-this.y,c=this.target.x-this.x,d=b/c,e=toDeg(Math.atan(d));c<0&&(e+=180),this.orientation=e+180;var f=this.x,g=this.y;this.x-=this.velocity*Math.cos(toRad(this.orientation))*a,this.y-=this.velocity*Math.sin(toRad(this.orientation))*a;for(var h=0;h<game.currentSector.pillars.length;h++){var i=game.currentSector.pillars[h];pointInRectangle(this,i)&&(i.elevation==-1&&(this.currentLife-=this.maxLife,this.isAlive=!1),(f<i.left()&&this.x>i.left()||f>i.right()&&this.x<i.right())&&(this.x=f),(g<i.bottom()&&this.y>i.bottom()||g>i.top()&&this.y<i.top())&&(this.y=g))}}else{var b=this.target.y-this.y,c=this.target.x-this.x,d=b/c,e=toDeg(Math.atan(d));c<0&&(e+=180),this.orientation=e+180,this.orientation+=180,this.currentShotTime>this.shotTime&&(game.currentSector.bulletManager.addBullet(new bomb(this.x,this.y,this.orientation,this.velocity/2,1,"EXPLODE",!1,!1,"#00AAAA")),this.currentShotTime=0);var f=this.x,g=this.y;this.x-=this.velocity*Math.cos(toRad(this.orientation))*a,this.y-=this.velocity*Math.sin(toRad(this.orientation))*a;for(var h=0;h<game.currentSector.pillars.length;h++){var i=game.currentSector.pillars[h];pointInRectangle(this,i)&&(i.elevation==-1&&(this.currentLife-=this.maxLife,this.isAlive=!1),(f<i.left()&&this.x>i.left()||f>i.right()&&this.x<i.right())&&(this.x=f),(g<i.bottom()&&this.y>i.bottom()||g>i.top()&&this.y<i.top())&&(this.y=g))}}},this.onHit=function(a){this.health-=a,this.health<=0&&(this.state="DEAD")},this.shoot=function(){var a=this.target.futureY(.1)-this.y,b=this.target.futureX(.1)-this.x,c=a/b,d=toDeg(Math.atan(c));b<0&&(d+=180);var e=new rocket(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,20,4,this.shotElevation,!1,!0,"#FF0000"),e=new bullet(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,25,3,this.shotElevation,!1,!0,"#FF0000");game.currentSector.bulletManager.addBullet(e)},this.draw=function(){"DEAD"!=this.state&&draw.drawChaseBot(this.x,this.y,this.width,this.height,this.orientation)}}function chaseBot(a,b,c,d){this.x=a,this.y=b,this.originY=a,this.originY=b,this.width=5,this.height=5,this.orientation=90,this.velocity=45,this.maxHealth=100,this.health=100,this.shotElevation=c,this.weapon=d,this.isHit=!1,this.movementState="FOLLOW",this.state="",this.switchTime=3,this.currentSwitchTime=0,this.shotTime=1,this.currentShotTime=0,this.target=game.players[0],this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y+this.height/2},this.bottom=function(){return this.y-this.height/2},this.update=function(a){if(this.currentShotTime+=a,this.currentShotTime>this.shotTime&&(this.shoot(),this.currentShotTime=0),this.currentSwitchTime+=a,this.currentSwitchTime>this.switchTime&&("FOLLOW"==this.movementState?this.movementState="CHASE":this.movementState="FOLLOW",this.currentSwitchTime=0),"FOLLOW"==this.movementState){var b=this.target.y-this.y,c=this.target.x-this.x,d=b/c,e=toDeg(Math.atan(d));c<0&&(e+=180),this.orientation=e+180;var f=this.x,g=this.y;this.x-=this.velocity*Math.cos(toRad(this.orientation))*a,this.y-=this.velocity*Math.sin(toRad(this.orientation))*a;for(var h=0;h<game.currentSector.pillars.length;h++){var i=game.currentSector.pillars[h];pointInRectangle(this,i)&&(i.elevation==-1&&(this.currentLife-=this.maxLife,this.isAlive=!1),(f<i.left()&&this.x>i.left()||f>i.right()&&this.x<i.right())&&(this.x=f),(g<i.bottom()&&this.y>i.bottom()||g>i.top()&&this.y<i.top())&&(this.y=g))}}else{var b=this.target.y-this.y,c=this.target.x-this.x,d=b/c,e=toDeg(Math.atan(d));c<0&&(e+=180),this.orientation=e+180,this.orientation+=180;var f=this.x,g=this.y;this.x-=this.velocity*Math.cos(toRad(this.orientation))*a,this.y-=this.velocity*Math.sin(toRad(this.orientation))*a;for(var h=0;h<game.currentSector.pillars.length;h++){var i=game.currentSector.pillars[h];pointInRectangle(this,i)&&(i.elevation==-1&&(this.currentLife-=this.maxLife,this.isAlive=!1),(f<i.left()&&this.x>i.left()||f>i.right()&&this.x<i.right())&&(this.x=f),(g<i.bottom()&&this.y>i.bottom()||g>i.top()&&this.y<i.top())&&(this.y=g))}}},this.onHit=function(a){this.health-=a,this.health<=0&&(this.state="DEAD")},this.shoot=function(){var a=this.target.futureY(.1)-this.y,b=this.target.futureX(.1)-this.x,c=a/b,d=toDeg(Math.atan(c));if(b<0&&(d+=180),"ROCKET"==this.weapon)var e=new rocket(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,20,4,this.shotElevation,!1,!0,"#FF0000");else if("BULLET"==this.weapon)var e=new bullet(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,25,3,this.shotElevation,!1,!0,"#FF0000");game.currentSector.bulletManager.addBullet(e)},this.draw=function(){"DEAD"!=this.state&&draw.drawChaseBot(this.x,this.y,this.width,this.height,this.orientation)}}function commonLib(){this.convertGameCoordToArrayCoord=function(a){return a+Math.floor(game.dimensions/2)},this.convertArrayCoordToGameCoord=function(a){return a-Math.floor(game.dimensions/2)},this.rgb2hex=function(a,b,c){var d=c|b<<8|a<<16;return"#"+(16777216+d).toString(16).slice(1)},this.hex2rgb=function(a){return r=a.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i),r?r.slice(1,4).map(function(a){return parseInt(a,16)}):(r=a.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i),r?r.slice(1,4).map(function(a){return 17*parseInt(a,16)}):null)},this.randInt=function(a,b){return Math.floor(Math.random()*(b-a)+a)}}function controlsMenu(){this.stockControls={Common:{SWITCH:75,CAMERA:67},Ship:{ACCEL:87,DECEL:83,TURNRIGHT:68,TURNLEFT:65,SHOOT:73,SPECIAL:16},Bot:{ACCEL:87,DECEL:83,TURNLEFT:74,TURNRIGHT:76,STRAFELEFT:65,STRAFERIGHT:68,SHOOT:73,SPECIAL:16}},this.reverseControls={Common:{SWITCH:75,CAMERA:67},Ship:{ACCEL:83,DECEL:87,TURNRIGHT:68,TURNLEFT:65,SHOOT:73,SPECIAL:16},Bot:{ACCEL:87,DECEL:83,TURNLEFT:65,TURNRIGHT:68,STRAFELEFT:74,STRAFERIGHT:76,SHOOT:73,SPECIAL:16}},this.customControls={Common:{SWITCH:75,CAMERA:67},Ship:{ACCEL:83,DECEL:87,TURNRIGHT:68,TURNLEFT:65,SHOOT:73,SPECIAL:16},Bot:{ACCEL:87,DECEL:83,TURNLEFT:65,TURNRIGHT:68,STRAFELEFT:74,STRAFERIGHT:76,SHOOT:73,SPECIAL:16}},this.controlsTimer=.5,this.currentControlsTimer=this.controlsTimer,this.controlsChoice=0,this.controlTypes=["REGULAR","REVERSE","CUSTOM1"],this.update=function(a){this.currentControlsTimer-=a,this.currentControlsTimer<0&&game.keys[39]&&(this.controlsChoice++,this.controlsChoice%=this.controlTypes.length,"REGULAR"==this.controlsChoice?game.KeyBinds=this.stockControls:"REVERSE"==this.controlsChoice?game.KeyBinds=this.reverseControls:"CUSTOM1"==this.controlsChoice?game.KeyBinds=this.customControls:game.KeyBinds=this.stockControls,this.currentControlsTimer=this.controlsTimer)},this.draw=function(a){draw.drawControlsMenu()}}function coordinate(a,b){this.x=a,this.y=b,this.width=1,this.height=3,this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y-this.height/2},this.bottom=function(){return this.y+this.height/2},this.draw=function(){draw.drawText(this.x,this.y,this.x+","+this.y)},this.update=function(){}}function enemyManager(a,b){this.enemies=[],this.addEnemy=function(a){this.enemies.push(a)},this.update=function(a){for(var b=0;b<this.enemies.length;b++){var c=this.enemies[b];"DEAD"==c.state&&(this.enemies.splice(b,1),b--),c.update(a)}},this.draw=function(){for(var a=0;a<this.enemies.length;a++)this.enemies[a].draw()}}function equipMenu(){this.controlsTimer=.5,this.currentControlsTimer=this.controlsTimer,this.controlsChoice=0,this.controlTypes=["REGULAR","REVERSE","CUSTOM1"],this.update=function(a){this.currentControlsTimer-=a,this.currentControlsTimer<0&&game.keys[39]&&(this.controlsChoice++,this.controlsChoice%=this.controlTypes.length,"REGULAR"==this.controlsChoice?game.KeyBinds=this.stockControls:"REVERSE"==this.controlsChoice?game.KeyBinds=this.reverseControls:"CUSTOM1"==this.controlsChoice?game.KeyBinds=this.customControls:game.KeyBinds=this.stockControls,this.currentControlsTimer=this.controlsTimer)},this.draw=function(a){draw.drawControlsMenu()}}function switchWeapon(a){game.selectedWeapon++,game.selectedWeapon%=2}function keyDown(a){game.keys[a.keyCode]=!0}function keyUp(a){game.keys[a.keyCode]=!1}function gameObject(){this.gameWidth=200,this.gameHeight=3*this.gameWidth/4,this.sectorHeight=400,this.sectorWidth=400,this.dimensions=5;var b={Background:"#000000",Ship:"#00FF00",HighBlue:"#0000FF",MidBlue:"#000099",LowBlue:"#000044",HighGreen:"#00FF00",MidGreen:"#009900",LowGreen:"#004400"},c={Common:{SWITCH:32,CAMERA:67},Ship:{ACCEL:87,DECEL:83,TURNRIGHT:68,TURNLEFT:65,SHOOT:73,SECONDARY:75,SPECIAL:16},Bot:{ACCEL:87,DECEL:83,TURNLEFT:74,TURNRIGHT:76,STRAFELEFT:65,STRAFERIGHT:68,SHOOT:73,SECONDARY:75,SPECIAL:16}};this.controlsMenu=new controlsMenu,this.mapMenu=new mapMenu,this.KeyBinds=c,this.menuTimerMax=1,this.menuTimer=this.menuTimerMax,this.screen="GAME",this.colors=b,this.Canvas=document.getElementById("gameCanvas"),this.ctx=this.Canvas.getContext("2d"),this.isMobile=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},this.draw=function(){"MENU"==this.screen?(draw.drawControlsMenu(),this.controlsMenu.draw()):"GAME"==this.screen?draw.drawGame():"EQUIP"==this.screen?draw.drawEquipmentMenu():"MAP"==this.screen?draw.drawMapMenu():"TITLE"==this.screen&&draw.drawTitleMenu()},this.bossDefeated=function(){this.bossRoomCount--,0==this.bossRoomCount&&alert("You Defeated the Four Show Stoppers, but can you clear the board? Aim for all safe nodes!")},this.update=function(a){this.menuTimer-=a,game.keys[66]?this.menuTimer<0&&("MENU"==this.screen?this.screen="GAME":this.screen="MENU",this.menuTimer=this.menuTimerMax):game.keys[78]?this.menuTimer<0&&("EQUIP"==this.screen?this.screen="GAME":this.screen="EQUIP",this.menuTimer=this.menuTimerMax):game.keys[77]&&this.menuTimer<0&&("MAP"==this.screen?this.screen="GAME":this.screen="MAP",this.menuTimer=this.menuTimerMax),"GAME"==this.screen?this.updateGame(a):"MENU"==this.screen?this.updateControlsMenu(a):"MAP"==this.screen?this.updateMapMenu(a):"EQUIP"==this.screen?this.updateEquipmentMenu(a):"TITLE"==this.screen&&this.updateTitleMenu(a)},this.updateEquipmentMenu=function(a){},this.updateMapMenu=function(a){this.mapMenu.update(a)},this.updateControlsMenu=function(a){this.controlsMenu.update(a)},this.updateTitleMenu=function(a){this.titleMenu.update(a)},this.updateGame=function(a){for(var b=0;b<game.players.length;b++)game.players[b].update(a);this.currentSector.update(a)},this.gravity=0,this.level=0,this.score=0,this.clicks=[],this.keys=[],this.buttons=[],this.meters=[],this.players=[],this.boxes=[],this.coordinates=[],this.bossRooms=[],this.currentSector=new worldSector(0,0),this.sectors=[],this.streamers=[],this.drawType="player",this.common=new commonLib,this.loadSector=function(a,b){(a<-2||a>2||b<-2||b>2)&&(a=0,b=0,game.players[0].x=0,game.players[0].y=0),this.currentSector=this.getSector(a,b),void 0==this.currentSector&&(this.sectors[a+Math.floor(this.dimensions/2)][b+Math.floor(this.dimensions/2)]=new worldSector(a,b,this.sectorWidth,this.sectorHeight),this.currentSector=this.sectors[a+Math.floor(this.dimensions/2)][b+Math.floor(this.dimensions/2)],this.currentSector.generate())},this.getSector=function(a,b){return this.sectors[a+Math.floor(this.dimensions/2)][b+Math.floor(this.dimensions/2)]},this.meterTypes={Level:0},this.init=function(){this.players.push(new player(0,0));for(var a=0;a<200;a+=25)this.coordinates.push(new coordinate(-a,a)),this.coordinates.push(new coordinate(a,a)),this.coordinates.push(new coordinate(-a,-a)),this.coordinates.push(new coordinate(a,-a));for(var a=0;a<5;a++){this.sectors.push([]);for(var b=0;b<5;b++)this.sectors[a].push(void 0)}this.bossRooms.push([-1,1]),this.bossRooms.push([-1,-1]),this.bossRooms.push([1,1]),this.bossRooms.push([1,-1]),this.bossRoomCount=4,this.currentSector.enemyManager.addEnemy(new followBot(this.players[0].x+30,this.players[0].y+60,1,"BOMB")),this.sectors[2][2]=new worldSector(0,0,this.sectorWidth,this.sectorHeight),this.sectors[2][2].generate(),this.sectors[2][3]=new worldSector(0,1,this.sectorWidth,this.sectorHeight),this.sectors[2][2].pillars.push(new pillar(20,-100,100,100,-1)),this.sectors[2][2].pillars.push(new pillar(70,40,5,100,0)),this.sectors[2][2].pillars.push(new pillar(-70,40,5,100,0)),this.sectors[2][2].pillars.push(new pillar(90,40,5,100,1)),this.sectors[2][2].pillars.push(new pillar(-90,40,5,100,1)),this.sectors[2][3].pillars.push(new pillar(70,440,5,100,0)),this.sectors[2][3].pillars.push(new pillar(-70,440,5,100,0)),this.sectors[2][3].pillars.push(new pillar(90,440,5,100,1)),this.sectors[2][3].pillars.push(new pillar(-90,440,5,100,1)),this.sectors[2][3].enemyManager.addEnemy(new chaseBot(-10,260,0,"BULLET")),this.currentSector=this.sectors[2][2],this.meters.push(new meter(this.gameWidth/2,this.gameHeight-17.5,this.meterTypes.Level)),this.lastTime=Date.now(),this.nowTime=this.lastTime},this.levelUp=function(){this.currentLevelTimer=0}}function playerFloorHit(a,b){var c=!1,d=!1;return(a.bottom()>b.top()&&a.bottom()<b.bottom()||a.top()<b.bottom()&&a.top()>b.top())&&(c=!0),(a.left()<b.right()&&a.left()>b.left()||a.right()>b.left()&&a.right()<b.right())&&(d=!0),c&&d}function pointInRectangle(a,b){return a.x>=b.left()&&a.x<=b.right()&&a.y>=b.bottom()&&a.y<=b.top()}function pointInRectangleX(a,b){return a.x>=b.left()&&a.x<=b.right()&&a.y>=b.bottom()&&a.y<=b.top()}function pointInRectangleY(a,b){return a.y>=b.bottom()&&a.y<=b.top()&&a.x>=b.left()&&a.x<=b.right()}function rectangleHitCircle(a,b){}function rectangleHitRectangle(a,a){a.printSides()}function circleHitCircle(a,a){}function mouseHitButton(a,b,c){var d=distance(a,b,c.x,c.y);return d<c.radius}function distance(a,b,c,d){return Math.sqrt((d-b)*(d-b)+(c-a)*(c-a))}function animLoop(){game.nowTime=Date.now();var a=(game.nowTime-game.lastTime)/1e3;game.update(a),game.draw(),requestAnimFrame(animLoop),game.lastTime=game.nowTime}function mapMenu(){this.switchTimer=.5,this.currentSwitchTimer=this.switchTimer,this.selectedSectionX=2,this.selectedSectionY=2,this.load=function(){this.selectedSectionX=game.currentSector.x-Math.floor(game.dimensions/2),this.selectedSectionY=game.currentSector.y-Math.floor(game.dimensions/2)},this.update=function(a){this.currentSwitchTimer-=a,this.currentSwitchTimer<0&&(game.keys[39]?(this.selectedSectionX++,this.selectedSectionX+=game.dimensions,this.selectedSectionX%=game.dimensions,this.currentSwitchTimer=this.switchTimer):game.keys[37]?(this.selectedSectionX--,this.selectedSectionX+=game.dimensions,this.selectedSectionX%=game.dimensions,this.currentSwitchTimer=this.switchTimer):game.keys[38]?(this.selectedSectionY++,this.selectedSectionY+=game.dimensions,this.selectedSectionY%=game.dimensions,this.currentSwitchTimer=this.switchTimer):game.keys[40]?(this.selectedSectionY--,this.selectedSectionY+=game.dimensions,this.selectedSectionY%=game.dimensions,this.currentSwitchTimer=this.switchTimer):game.keys[13]&&(void 0!=game.getSector(this.selectedSectionX-Math.floor(game.dimensions/2),this.selectedSectionY-Math.floor(game.dimensions/2))&&0==game.getSector(this.selectedSectionX-Math.floor(game.dimensions/2),this.selectedSectionY-Math.floor(game.dimensions/2)).level&&(game.currentSector=game.getSector(this.selectedSectionX-Math.floor(game.dimensions/2),this.selectedSectionY-Math.floor(game.dimensions/2)),game.players[0].x=400*game.currentSector.x,game.players[0].y=400*game.currentSector.y,game.screen="GAME"),this.currentSwitchTimer=this.switchTimer))},this.draw=function(a){draw.drawMapMenu()}}function meter(a,b,c){this.x=a,this.y=b,this.type=c,this.orientations={Horizontal:0,Vertical:1},this.type==game.meterTypes.Level&&(this.width=40,this.height=2,this.currentLevel=game.currentLevelTimer,this.maxLevel=10,this.orientation=this.orientations.Horizontal),this.update=function(a){this.type==game.meterTypes.Level&&(this.currentLevel+=a,this.currentLevel>this.maxLevel&&(this.currentLevel=0))},this.draw=function(){if(this.type==game.meterTypes.Life)var a=game.colors.Ship;else var a="#000000";this.orientation==this.orientations.Vertical?(draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000"),draw.drawFilledRectCentered(this.x,this.y,this.width,this.height*(this.currentLevel/this.maxLevel),a)):this.orientation==this.orientations.Horizontal&&(draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000"),draw.drawFilledRectCentered(this.x,this.y,this.width*(1-this.currentLevel/this.maxLevel),this.height,a))}}function pillar(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.elevation=e,this.addStreamerTimer=.3,this.currentAddStreamerTimer=0,this.streamers=[],this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y+this.height/2},this.bottom=function(){return this.y-this.height/2},this.update=function(a){if(this.elevation==-1){if(this.currentAddStreamerTimer+=a,this.currentAddStreamerTimer>this.addStreamerTimer)for(var b=0;b<5;b++){var c=game.common.randInt(this.x-this.width/2,this.x+this.width/2),d=game.common.randInt(this.y-this.height/2,this.y+this.height/2);this.streamers.push(new bitStreamer(c,d,0,0,2)),this.currentAddStreamerTimer=0}for(var c=0;c<this.streamers.length;c++)this.streamers[c].update(a),0==this.streamers[c].isActive&&(this.streamers.splice(c,1),c--)}},this.draw=function(){if(1==this.elevation)"ship"==game.players[0].state&&draw.drawRectCentered(this.x,this.y,this.width,this.height,"#009900",!0),"bot"==game.players[0].state&&draw.drawRectCentered(this.x,this.y,this.width,this.height,"#00FF00",!0);else if(0==this.elevation)"ship"==game.players[0].state&&draw.drawRectCentered(this.x,this.y,this.width,this.height,"#002200",!0),"bot"==game.players[0].state&&draw.drawRectCentered(this.x,this.y,this.width,this.height,"#00AA00",!0);else if(this.elevation==-1){if("ship"==game.players[0].state){draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000",!0);for(var a=0;a<this.streamers.length;a++)this.streamers[a].draw()}if("bot"==game.players[0].state){draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000",!0);for(var a=0;a<this.streamers.length;a++)this.streamers[a].draw()}}}}function player(a,b){this.x=a,this.y=b,this.oldX=a,this.oldY=b,this.velX=0,this.velY=0,this.velStrafe=0,this.velocity=0,this.width=1,this.height=3,this.accel=40,this.moveSpeed=40,this.shotType="MACHINEGUN",this.lifeState="ALIVE",this.dyingTimer=2,this.maxLife=100,this.currentLife=100,this.lifeRegen=2,this.maxEnergy=100,this.currentEnergy=100,this.energyRegen=1,this.shotSpeed=20,this.shipWeapons=[],this.shipSpecialWeapons=[],this.shipSpecialMovements=[],this.botWeapons=[],this.botSpecialWeapons=[],this.botSpecialMovements=[],this.swapCooldown=1,this.swapCooldownCurrent=0,this.cameraCooldown=.25,this.cameraCooldownCurrent=0,this.shotCooldown=.2,this.shotCooldownCurrent=0,this.orientation=90,this.heading=this.orientation,this.dyingTimer=2,this.currentDyingTimer=0,this.isAlive=!0,this.state="ship",this.getElevation=function(){return"ship"==this.state?this.highFlying?2:1:"bot"==this.state?0:void 0},this.onHit=function(a){this.currentLife-=a},this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y+this.height/2},this.bottom=function(){return this.y-this.height/2},this.printSides=function(){console.log("Player Right: "+this.right()+" Left: "+this.left()+" Top"+this.top()+" Bottom"+this.bottom())},this.draw=function(){this.isAlive&&draw.drawPlayerRect(game.gameWidth/2,game.gameHeight/2,this.width,this.height,this.orientation)},this.update=function(a){if("ALIVE"==this.lifeState)if(this.currentLife<=0)this.isAlive=!1,this.lifeState="DYING";else{this.swapCooldownCurrent-=a,this.cameraCooldownCurrent-=a,this.shotCooldownCurrent-=a,game.keys[game.KeyBinds.Common.SWITCH]&&this.swapCooldownCurrent<=0&&("bot"==this.state?(this.state="ship",this.shotType="MACHINEGUN"):"ship"==this.state&&(this.state="bot",this.shotType="SHOTGUN"),this.swapCooldownCurrent=this.swapCooldown),game.keys[game.KeyBinds.Common.CAMERA]&&this.cameraCooldownCurrent<=0&&("camera"==game.drawType?game.drawType="player":"player"==game.drawType&&(draw=new drawCameraCentricObject(this.x,this.y),game.drawType="camera"),this.cameraCooldownCurrent=this.cameraCooldown),"player"==game.drawType&&(draw.cameraX=this.x,draw.cameraY=this.y),"ship"==this.state&&(game.keys[game.KeyBinds.Ship.SHOOT]&&this.shotCooldownCurrent<=0&&this.shoot(this.shotType),game.keys[game.KeyBinds.Bot.SECONDARY]&&this.shotCooldownCurrent<=0&&this.shoot("BOMB"),this.velStrafe/=1.3,game.keys[game.KeyBinds.Ship.TURNLEFT]&&(this.orientation+=4),game.keys[game.KeyBinds.Ship.TURNRIGHT]&&(this.orientation-=4),game.keys[game.KeyBinds.Ship.ACCEL]&&(game.keys[game.KeyBinds.Ship.DECEL]||(this.velocity+=2*this.accel*a),this.velocity>2*this.moveSpeed&&(this.velocity=2*this.moveSpeed)),game.keys[game.KeyBinds.Ship.DECEL]&&(this.velocity+=-this.accel*a,this.velocity<2*-this.moveSpeed&&(this.velocity=2*-this.moveSpeed)),this.velocity<10&&(this.velocity+=this.accel*a),game.keys[game.KeyBinds.Ship.SPECIAL]||(this.heading=this.orientation)),"bot"==this.state&&(game.keys[game.KeyBinds.Bot.SHOOT]&&this.shotCooldownCurrent<=0&&this.shoot(this.shotType),game.keys[game.KeyBinds.Bot.SECONDARY]&&this.shotCooldownCurrent<=0&&this.shoot("WHIP"),game.keys[game.KeyBinds.Bot.SPECIAL]&&this.shotCooldownCurrent<=0&&this.shoot("BLOCK"),game.keys[game.KeyBinds.Bot.STRAFELEFT]?(this.velStrafe+=50*-this.accel*a,this.velocity/=2,this.velStrafe<-this.moveSpeed&&(this.velStrafe=-this.moveSpeed)):game.keys[game.KeyBinds.Bot.STRAFERIGHT]?(this.velStrafe+=50*this.accel*a,this.velocity/=2,this.velStrafe>this.moveSpeed&&(this.velStrafe=this.moveSpeed)):this.velStrafe/=2,game.keys[game.KeyBinds.Bot.TURNLEFT]?this.orientation+=5:game.keys[game.KeyBinds.Bot.TURNRIGHT]&&(this.orientation-=5),game.keys[game.KeyBinds.Bot.ACCEL]?(this.velocity+=20*this.accel*a,this.velocity>this.moveSpeed&&(this.velocity=this.moveSpeed)):game.keys[game.KeyBinds.Bot.DECEL]?(this.velocity+=20*-this.accel*a,this.velocity<-this.moveSpeed&&(this.velocity=-this.moveSpeed)):this.velocity/=1.1,this.orientation<0?this.orientation+=360:this.orientation>360&&(this.orientation-=360),this.heading=this.orientation),this.updateState(a),oldX=this.x,oldY=this.y,this.x+=this.velocity*Math.cos(toRad(this.heading))*a+this.velStrafe*Math.cos(toRad(this.heading-90))*a,this.y+=this.velocity*Math.sin(toRad(this.heading))*a+this.velStrafe*Math.sin(toRad(this.heading-90))*a;for(var b=0;b<game.currentSector.pillars.length;b++){var c=game.currentSector.pillars[b];pointInRectangle(this,c)&&("ship"==this.state?1==c.elevation&&(this.currentLife-=this.maxLife,this.isAlive=!1):"bot"==this.state&&(c.elevation==-1&&(this.currentLife-=this.maxLife,this.isAlive=!1),(oldX<c.left()&&this.x>c.left()||oldX>c.right()&&this.x<c.right())&&(this.x=oldX),(oldY<c.bottom()&&this.y>c.bottom()||oldY>c.top()&&this.y<c.top())&&(this.y=oldY)))}this.getSectorY()==game.currentSector.y&&this.getSectorX()==game.currentSector.x||game.loadSector(this.getSectorX(),this.getSectorY())}else"DYING"==this.lifeState?(this.shoot("DEATH"),this.currentDyingTimer+=a,this.currentDyingTimer>=this.dyingTimer&&(this.lifeState="DEAD",this.currentDyingTimer=0)):"DEAD"==this.lifeState&&(this.currentLife=this.maxLife,this.currentEnergy=this.maxEnergy,this.x=0,this.y=0,this.velocity=0,this.state="ship",this.lifeState="ALIVE",this.isAlive=!0)},this.futureX=function(a){return this.x+(this.x-this.oldX)*a},this.futureY=function(a){return this.y+(this.y-this.oldY)*a},this.getSectorX=function(){return Math.floor((this.x+game.sectorWidth/2)/game.sectorWidth)},this.getSectorY=function(){return Math.floor((this.y+game.sectorHeight/2)/game.sectorHeight)},this.updateState=function(a){},this.shoot=function(a){"SHOTGUN"==a?(game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,40,.8,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation-7,40,.8,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+7,40,.8,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation-14,40,.8,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+14,40,.8,0,!0,!0,"#00AAAA")),this.shotCooldownCurrent=2*this.shotCooldown):"MACHINEGUN"==a?(game.currentSector.bulletManager.addBullet(new bullet(this.x+1*Math.cos(toRad(this.heading-90)),this.y+1*Math.sin(toRad(this.heading-90)),this.orientation,100,1,1,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x-1*Math.cos(toRad(this.heading-90)),this.y-1*Math.sin(toRad(this.heading-90)),this.orientation,100,1,1,!0,!0,"#00AAAA")),this.shotCooldownCurrent=this.shotCooldown/2):"WHIP"==a?(game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,200,.2,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,200,.2,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,200,.2,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,200,.2,0,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation,200,.2,0,!0,!0,"#00AAAA")),this.shotCooldownCurrent=this.shotCooldown/3):"BOMB"==a?(game.currentSector.bulletManager.addBullet(new bomb(this.x,this.y,this.orientation,this.velocity/2,1,"EXPLODE",!0,!0,"#00AAAA")),this.shotCooldownCurrent=2*this.shotCooldown):"BLOCK"==a?(game.currentSector.pillars.push(new pillar(this.x+1*Math.cos(toRad(this.heading-90)),this.y+1*Math.sin(toRad(this.heading-90)),10,10,1)),this.shotCooldownCurrent=2*this.shotCooldown):"DEATH"==a&&(game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+45,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+90,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+135,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+180,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+225,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+270,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+315,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+360,10,.7,2,!0,!0,"#00AAAA")),game.currentSector.bulletManager.addBullet(new bullet(this.x,this.y,this.orientation+405,10,.7,2,!0,!0,"#00AAAA")))}}function rocket(a,b,c,d,e,f,g,h,i){this.x=a,this.y=b,this.orientation=c,this.velocity=10,this.elevation=f,this.lifeTime=e,this.currentTime=0,this.playerSafe=g,this.enemySafe=h,this.target=game.players[0],this.state="FIRED",this.homeTimer=.25,this.currentHomeTimer=0,this.isActive=!0,this.update=function(a){if(this.currentHomeTimer+=a,this.velocity+=10*a,this.currentHomeTimer>this.homeTimer){var b=this.target.y-this.y,c=this.target.x-this.x,d=b/c,e=toDeg(Math.atan(d));c<0&&(e+=180),this.orientation=e,this.currentHomeTimer=0}if(this.x+=this.velocity*Math.cos(toRad(this.orientation))*a,this.y+=this.velocity*Math.sin(toRad(this.orientation))*a,this.isActive){for(var f=0;f<game.currentSector.enemyManager.enemies.length;f++)this.isActive&&pointInRectangle(this,game.currentSector.enemyManager.enemies[f])&&(game.currentSector.enemyManager.enemies[f].onHit(10),
this.isActive=!1);for(var f=0;f<game.currentSector.pillars.length;f++)pointInRectangle(this,game.currentSector.pillars[f])&&(0==this.elevation?this.isActive=!1:1==this.elevation&&1==game.currentSector.pillars[f].elevation&&(this.isActive=!1));for(var f=0;f<game.players.length;f++)this.playerSafe||pointInRectangle(this,game.players[f])&&(0==this.elevation?0==game.players[f].getElevation()&&(console.log("HIT"),this.isActive=!1,game.players[f].onHit(10)):1==this.elevation&&(console.log("HIT"),this.isActive=!1,game.players[f].onHit(10)));this.currentTime+=a,this.currentTime>this.lifeTime&&(this.isActive=!1)}},this.draw=function(){this.isActive&&draw.drawRectRotatedCentered(this.x,this.y,.5,2,this.orientation,"#FF0000",!0)}}function resizeGame(){var a=document.getElementById("gameArea"),b=4/3,c=window.innerWidth,d=window.innerHeight,e=c/d;e>b?(c=d*b,a.style.height=d+"px",a.style.width=c+"px"):(d=c/b,a.style.width=c+"px",a.style.height=d+"px"),a.style.marginTop=-d/2+"px",a.style.marginLeft=-c/2+"px";var f=document.getElementById("gameCanvas");f.width=c,f.height=d}function gameXToCanvasX(a){return a/game.gameWidth*gameCanvas.width}function gameYToCanvasY(a){return a/game.gameHeight*gameCanvas.height}function canvasXToGameX(a){return a*gameCanvas.width/game.gameWidth}function canvasYToGameY(a){return a*gameCanvas.height/game.gameHeight}function mapMenu(){this.switchTimer=.5,this.currentSwitchTimer=this.switchTimer,this.selectedSectionX=2,this.selectedSectionY=2,this.update=function(a){},this.draw=function(a){draw.drawTitleMenu()}}function worldSector(a,b,c,d){this.x=a,this.y=b,this.pillars=[],this.bulletManager=new bulletManager,this.enemyManager=new enemyManager,this.height=d,this.width=c,this.level=1,this.bossRoom=!1,this.update=function(a){for(var b=0;b<this.pillars.length;b++)this.pillars[b].update(a);this.bulletManager.update(a),this.enemyManager.update(a),0==this.enemyManager.enemies.length&&(this.level=0,this.bossRoom&&(game.bossDefeated(),this.bossRoom=!1))},this.generate=function(){if(Math.abs(this.x)+Math.abs(this.y)>2){for(var a=0;a<game.common.randInt(0,5);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new followBot(this.relativeX(b),this.relativeY(c),1,"BULLET"))}for(var a=0;a<game.common.randInt(0,2);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new followBot(this.relativeX(100),this.relativeY(0),1,"ROCKET",!0))}for(var a=0;a<game.common.randInt(0,2);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new chaseBot(this.relativeX(b),this.relativeY(c),1,"BULLET"))}for(var a=0;a<game.common.randInt(0,5);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new chaseBoss(this.relativeX(0),this.relativeY(0),1,"ROCKET"))}for(var a=0;a<20;a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new followBot(this.relativeX(b),this.relativeY(c),1,"BULLET"))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=game.common.randInt(20,80),e=5,f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=5,e=game.common.randInt(20,80),f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}}if(0==this.x&&0==this.y&&this.enemyManager.addEnemy(new followBot(this.relativeX(0),this.relativeY(100),1,"BOMB")),this.x<0&&this.y>=0)if(this.x==game.bossRooms[0][0]&&this.y==game.bossRooms[0][1])this.bossRoom=!0,this.enemyManager.addEnemy(new followBot(this.relativeX(0),this.relativeY(0),1,"ROCKET"));else{for(var a=0;a<10;a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new chaseBot(this.relativeX(b),this.relativeY(c),1,"ROCKET"))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=game.common.randInt(20,80),e=5,f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=5,e=game.common.randInt(20,80),f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}}if(this.x<=0&&this.y<0)if(this.x==game.bossRooms[1][0]&&this.y==game.bossRooms[1][1]){this.bossRoom=!0,this.enemyManager.addEnemy(new followBot(this.relativeX(100),this.relativeY(0),1,"ROCKET",!0)),this.enemyManager.addEnemy(new followBot(this.relativeX(-100),this.relativeY(0),1,"ROCKET",!0));for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=game.common.randInt(20,80),e=5,f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=5,e=game.common.randInt(20,80),f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}}else{for(var a=0;a<20;a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new followBot(this.relativeX(b),this.relativeY(c),1,"BULLET"))}for(var a=0;a<game.common.randInt(1*Math.abs(b+c),2*Math.abs(b+c));a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=game.common.randInt(20,40),e=game.common.randInt(20,40),f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,-1))}}if(this.x>=0&&this.y>0)if(this.x==game.bossRooms[2][0]&&this.y==game.bossRooms[2][1])this.bossRoom=!0,this.enemyManager.addEnemy(new chaseBoss(this.relativeX(0),this.relativeY(0),1,"ROCKET"));else for(var a=0;a<20;a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new chaseBot(this.relativeX(b),this.relativeY(c),1,"ROCKET"))}if(this.x>0&&this.y<=0)if(this.x==game.bossRooms[3][0]&&this.y==game.bossRooms[3][1])this.bossRoom=!0,this.enemyManager.addEnemy(new followBot(this.relativeX(0),this.relativeY(0),1,"ROCKET",!0));else{for(var a=0;a<20;a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200;this.enemyManager.addEnemy(new followBot(this.relativeX(b),this.relativeY(c),1,"BULLET"))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=game.common.randInt(20,80),e=5,f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}for(var a=0;a<game.common.randInt(6,20);a++){var b=Math.floor(400*Math.random())-200,c=Math.floor(400*Math.random())-200,d=5,e=game.common.randInt(20,80),f=game.common.randInt(0,2);this.pillars.push(new pillar(this.relativeX(b),this.relativeY(c),d,e,f))}}},this.relativeX=function(a){return a+400*this.x},this.relativeY=function(a){return a+400*this.y},this.draw=function(){}}function followBot(a,b,c,d,e){this.x=a,this.y=b,this.width=5,this.height=5,this.orientation=90,this.velocity=15,this.maxHealth=100,this.health=100,this.shotElevation=c,this.weapon=d,this.isHit=!1,this.movementState="RUN",this.state="",this.switchTime=5,this.currentSwitchTime=0,this.shotTime=1,this.currentShotTime=0,this.boss=e,e&&(this.maxHealth*=10,this.health*=10),this.target=game.players[0],this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y+this.height/2},this.bottom=function(){return this.y-this.height/2},this.update=function(a){this.currentShotTime+=a,this.currentShotTime>this.shotTime&&(this.shoot(),this.currentShotTime=0),this.currentSwitchTime+=a,this.currentSwitchTime>this.switchTime&&(this.movementState="FOLLOW"),this.currentSwitchTime>2*this.switchTime&&(this.movementState="RUN",this.currentSwitchTime=0),"RUN"==this.movementState&&(this.x+=this.velocity*Math.cos(toRad(this.orientation))*a,this.y+=this.velocity*Math.sin(toRad(this.orientation))*a,this.boss&&this.shoot()),"FOLLOW"==this.movementState&&(this.x-=this.velocity*Math.cos(toRad(this.orientation))*a,this.y-=this.velocity*Math.sin(toRad(this.orientation))*a,this.boss&&this.shoot())},this.onHit=function(a){this.health-=a,this.health<=0&&(this.state="DEAD")},this.shoot=function(){var a=this.target.y-this.y,b=this.target.x-this.x,c=a/b,d=toDeg(Math.atan(c));if(b<0&&(d+=180),"ROCKET"==this.weapon)var e=new rocket(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,5,3,this.shotElevation,!1,!0,"#FF0000");else if("BULLET"==this.weapon)var e=new bullet(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,10,5,this.shotElevation,!1,!0,"#FF0000");else if("BOMB"==this.weapon)var e=new bomb(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,10,3,"PATCH",!1,!0,"#FF0000");else if(this.boss){var e=new bullet(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d,10,5,this.shotElevation,!1,!1,"#FF0000");game.currentSector.bulletManager.addBullet(e);var e=new bullet(this.x+15*Math.cos(toRad(d)),this.y+15*Math.sin(toRad(d)),d+180,10,5,this.shotElevation,!1,!1,"#FF0000")}game.currentSector.bulletManager.addBullet(e)},this.draw=function(){"DEAD"!=this.state&&(draw.drawRectCentered(this.x,this.y,this.width,this.height,"#FF0000"),draw.drawRect(this.x-this.width/2,this.y-.8*this.height,this.width,.5),draw.drawRect(this.x-this.width/2,this.y-.8*this.height,this.width*(this.health/this.maxHealth),.5,"#FF0000",!0))}}function drawCameraCentricObject(a,b){this.cameraX=a,this.cameraY=b,this.drawGame=function(){var a=document.getElementById("gameCanvas"),b=a.getContext("2d");draw.drawBackgroundRect(game.gameWidth/2,game.gameHeight/2,game.gameWidth,game.gameHeight,game.colors.Background),this.drawGrid();for(var c=0;c<game.currentSector.pillars.length;c++)game.currentSector.pillars[c].draw();game.currentSector.bulletManager.draw(),game.currentSector.enemyManager.draw();for(var d=0;d<game.coordinates.length;d++);for(var c=0;c<game.players.length;c++)game.players[c].draw();b.beginPath(),b.fillStyle="#000000",b.rect(0,a.height-gameYToCanvasY(20),a.width,a.height),b.stroke(),b.fill(),b.font=gameXToCanvasX(3).toString()+"px Consolas",draw.drawInfoText(10,15,"Life: "+game.players[0].currentLife),draw.drawInfoText(10,12,"Sector: "+game.currentSector.x+" , "+game.currentSector.y),draw.drawInfoText(10,9,"Level: "+game.currentSector.level),draw.drawInfoText(10,6,"Enemies: "+game.currentSector.enemyManager.enemies.length),draw.drawInfoText(10,3,"Bosses Left: "+game.bossRoomCount),draw.drawInfoText(40,15,"Controls: "),draw.drawInfoText(40,12,"Move(Ship): WASD"),draw.drawInfoText(40,9,"Move(Bot): WASD + J/L"),draw.drawInfoText(40,6,"Shoot: I Secondary: K "),draw.drawInfoText(40,3,"Transform: Space"),draw.drawInfoText(80,15,"Controls: "),draw.drawInfoText(80,12,"Special Move: Shift"),draw.drawInfoText(80,9,"Map: M"),draw.drawText(50,-25,"Fly Over Low(Dark) Pillars"),draw.drawText(80,0,"Crash into high ones as a plane :("),draw.drawText(-90,-25,"Transform(Space) to ground mode to use both as cover!"),draw.drawText(-90,-55,"Fly over unpatched nodes, but don't try to ride across them as a bot!"),draw.drawText(-20,-10,"If you die, you will respawn here!"),draw.drawText(-20,10,"Dodge bright bullets!"),draw.drawText(-20,40,"Fly over dark bullets as a plane  or dodge them as the walker!"),draw.drawText(-20,62,"I for primary weapon, K for secondary!"),draw.drawText(-40,82,"Press shift to access your special!"),draw.drawText(-40,100,"Take out all enemies in a zone to make it safe!"),draw.drawText(-40,220,"Once a zone is clear, you can teleport to it by accessing the map(m), selecting a blue zone, and pressing enter!"),draw.drawText(-40,240,"Clear the four bosses, located at 1:1, 1:-1, -1:1, and -1:-1 to beat the game! Try -1:1 first!"),b.closePath()},this.drawControlsMenu=function(){var a=document.getElementById("gameCanvas"),b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),draw.drawBackgroundRect(game.gameWidth/2,game.gameHeight/2,game.gameWidth,game.gameHeight,game.colors.Background),draw.drawInfoText(10,game.gameHeight-10,game.controlsMenu.controlTypes[game.controlsMenu.controlsChoice]);var c=1;draw.drawInfoText(15,game.gameHeight-10-5*c,"Common"),c++;for(var d in game.KeyBinds.Common)draw.drawInfoText(20,game.gameHeight-10-5*c,d),c++;draw.drawInfoText(15,game.gameHeight-10-5*c,"Ship"),c++;for(var d in game.KeyBinds.Ship)draw.drawInfoText(20,game.gameHeight-10-5*c,d),c++;draw.drawInfoText(15,game.gameHeight-10-5*c,"Bot"),c++;for(var d in game.KeyBinds.Bot)draw.drawInfoText(20,game.gameHeight-10-5*c,d),c++},this.drawEquipmentMenu=function(){var a=document.getElementById("gameCanvas"),b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),draw.drawBackgroundRect(game.gameWidth/2,game.gameHeight/2,game.gameWidth,game.gameHeight,game.colors.Background)},this.drawMapMenu=function(){var a=document.getElementById("gameCanvas"),b=a.getContext("2d");this.cameraX=0,this.cameraY=0,b.clearRect(0,0,a.width,a.height),draw.drawBackgroundRect(game.gameWidth/2,game.gameHeight/2,game.gameWidth,game.gameHeight,game.colors.Background);var c=game.mapMenu.selectedSectionX,d=game.mapMenu.selectedSectionY,e=game.currentSector.x+Math.floor(game.dimensions/2),f=game.currentSector.y+Math.floor(game.dimensions/2);draw.drawRectCentered(20*c-10*game.dimensions,20*d-10*game.dimensions,20,20,"#FFFFFF",!0);var g="#000000",g="#000000";draw.drawRectCentered(20*e-10*game.dimensions,20*f-10*game.dimensions,19,19,"#00FF00",!0);for(var h=0;h<game.dimensions;h++)for(var i=0;i<game.dimensions;i++)topColor="#0000FF",g="#000088",void 0==game.sectors[h][i]?g="#444444":game.sectors[h][i].level>0&&(topColor="#FF0000",g="#880000"),game.selectedX==h&&game.selectedY==i&&(topColor="#00FF00"),draw.drawRectCentered(20*h-10*game.dimensions,20*i-10*game.dimensions,18,18,topColor,!0),draw.drawRectCentered(20*h-10*game.dimensions,20*i-10*game.dimensions,14,14,g,!0)},this.drawGrid=function(){var a=game.ctx;a.strokeStyle="#00FF00",a.fillStyle="#00FF00";for(var b=-game.currentSector.height/40;b<=game.currentSector.height/40;b++)a.beginPath(),a.moveTo(gameXToCanvasX(-game.currentSector.width/2+game.gameWidth/2-this.cameraX+400*game.currentSector.x),gameYToCanvasY(20*b+game.gameHeight/2+this.cameraY-400*game.currentSector.y)),a.lineTo(gameXToCanvasX(game.currentSector.width/2+game.gameWidth/2-this.cameraX+400*game.currentSector.x),gameYToCanvasY(20*b+game.gameHeight/2+this.cameraY-400*game.currentSector.y)),a.stroke(),a.closePath();for(var b=-game.currentSector.width/40;b<=game.currentSector.width/40;b++)a.beginPath(),a.moveTo(gameXToCanvasX(20*b+game.gameWidth/2-this.cameraX+400*game.currentSector.x),gameYToCanvasY(-game.currentSector.height/2+game.gameHeight/2+this.cameraY-400*game.currentSector.y)),a.lineTo(gameXToCanvasX(20*b+game.gameWidth/2-this.cameraX+400*game.currentSector.x),gameYToCanvasY(game.currentSector.height/2+game.gameHeight/2+this.cameraY-400*game.currentSector.y)),a.stroke(),a.closePath()},this.drawRect=function(a,b,c,d){var f=(document.getElementById("gameCanvas"),game.ctx);f.rect(gameXToCanvasX(a),gameYToCanvasY(b),gameXToCanvasX(c),gameYToCanvasY(d)),f.stroke()},this.drawPlayerRect=function(a,b,c,d,e){var g=(document.getElementById("gameCanvas"),game.ctx),h=game.players[0];g.save(),g.fillStyle="#00AAAA",g.strokeStyle="#00AAAA",g.style="#00AAAA",g.translate(gameXToCanvasX(game.players[0].x+game.gameWidth/2-this.cameraX),gameYToCanvasY(-game.players[0].y+game.gameHeight/2+this.cameraY)),g.rotate(toRad(-e+90)),"ship"==h.state&&(g.beginPath(),g.moveTo(gameXToCanvasX(0),gameYToCanvasY(-2)),g.lineTo(gameXToCanvasX(-.5),gameYToCanvasY(2)),g.lineTo(gameXToCanvasX(.5),gameYToCanvasY(2)),g.strokeStyle="#00AAAA",g.stroke(),g.fill(),g.closePath(),g.beginPath(),g.moveTo(gameXToCanvasX(0),gameYToCanvasY(-1)),g.lineTo(gameXToCanvasX(-1),gameYToCanvasY(1)),g.lineTo(gameXToCanvasX(1),gameYToCanvasY(1)),g.fill(),g.strokeStyle="#00AAAA",g.stroke(),g.closePath()),"bot"==h.state&&(g.rect(gameXToCanvasX(-h.width/2-h.width),gameYToCanvasY(-h.height/2),gameXToCanvasX(c/2),gameYToCanvasY(d)),g.rect(gameXToCanvasX(h.width),gameYToCanvasY(-h.height/2),gameXToCanvasX(c/2),gameYToCanvasY(d)),g.rect(gameXToCanvasX(-h.height/2),gameYToCanvasY(h.height/8),gameXToCanvasX(h.height),gameYToCanvasY(h.width/2)),g.strokeStyle="#00AAAA",g.fill()),g.restore()},this.drawChaseBot=function(a,b,c,d,e){var g=(document.getElementById("gameCanvas"),game.ctx);game.players[0];g.save(),g.fillStyle="#FF0000",g.strokeStyle="#FF0000",g.style="#FF0000",g.translate(gameXToCanvasX(a+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b+game.gameHeight/2+this.cameraY)),g.rotate(toRad(-e-90)),g.beginPath(),g.moveTo(gameXToCanvasX(0),gameYToCanvasY(-2)),g.lineTo(gameXToCanvasX(-.5),gameYToCanvasY(2)),g.lineTo(gameXToCanvasX(.5),gameYToCanvasY(2)),g.strokeStyle="#FF0000",g.stroke(),g.fill(),g.closePath(),g.beginPath(),g.moveTo(gameXToCanvasX(0),gameYToCanvasY(-1)),g.lineTo(gameXToCanvasX(-1),gameYToCanvasY(1)),g.lineTo(gameXToCanvasX(1),gameYToCanvasY(1)),g.fill(),g.strokeStyle="#FF0000",g.stroke(),g.closePath(),g.restore()},this.drawRectCentered=function(a,b,c,d,e,f){var g=document.getElementById("gameCanvas"),h=g.getContext("2d");h.save(),h.beginPath(),h.fillStyle=e,h.rect(gameXToCanvasX(a-c/2+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b-d/2+game.gameHeight/2+this.cameraY),gameXToCanvasX(c),gameYToCanvasY(d)),h.stroke(),f&&h.fill(),h.closePath(),h.restore()},this.drawRectRotatedCentered=function(a,b,c,d,e,f,g){var h=document.getElementById("gameCanvas"),i=h.getContext("2d");i.save(),i.translate(gameXToCanvasX(a+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b+game.gameHeight/2+this.cameraY)),i.rotate(toRad(-e+90)),i.translate(gameXToCanvasX(-a-game.gameWidth/2+this.cameraX),gameYToCanvasY(b-game.gameHeight/2-this.cameraY)),i.beginPath(),i.fillStyle=f,i.rect(gameXToCanvasX(a-c/2+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b-d/2+game.gameHeight/2+this.cameraY),gameXToCanvasX(c),gameYToCanvasY(d)),i.stroke(),g&&i.fill(),i.closePath(),i.restore()},this.drawRect=function(a,b,c,d,e,f){var g=document.getElementById("gameCanvas"),h=g.getContext("2d");h.save(),h.beginPath(),h.rect(gameXToCanvasX(a+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b+game.gameHeight/2+this.cameraY),gameXToCanvasX(c),gameYToCanvasY(d)),h.stroke(),f&&h.fill(),h.closePath(),h.restore()},this.drawBackgroundRect=function(a,b,c,d,e){var f=document.getElementById("gameCanvas"),g=f.getContext("2d");g.save(),g.beginPath(),g.fillStyle="#000000",g.rect(gameXToCanvasX(a-c/2),gameYToCanvasY(b-d/2),gameXToCanvasX(c),gameYToCanvasY(d)),g.stroke(),g.fill(),g.closePath(),g.restore()},this.drawCircle=function(a,b,c,d,e){var f=game.ctx;f.beginPath(),f.save(),f.strokeStyle=d,f.lineWidth=2,f.arc(gameXToCanvasX(a+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b+game.gameHeight/2+this.cameraY),gameXToCanvasX(c),0,2*Math.PI,!1),e&&(f.fillStyle=d,f.fill()),f.stroke(),f.restore()},this.drawFilledCircle=function(a,b,c,d){var e=game.ctx;e.save(),e.beginPath(),e.fillStyle=d,e.arc(gameXToCanvasX(a),gameYToCanvasY(b),gameXToCanvasX(c),0,2*Math.PI,!1),e.fill(),e.stroke(),e.restore()},this.drawText=function(a,b,c,d){var e=game.ctx;e.save(),e.beginPath(),e.fillStyle="#00FF00",void 0!=d&&(e.fillStyle=d),e.fillText(c,gameXToCanvasX(a+game.gameWidth/2-this.cameraX),gameYToCanvasY(-b+game.gameHeight/2+this.cameraY)),e.stroke(),e.restore()},this.drawInfoText=function(a,b,c){var d=game.ctx;d.save(),d.beginPath(),d.fillStyle="#00FF00",d.fillText(c,gameXToCanvasX(a),gameYToCanvasY(game.gameHeight-b)),d.stroke(),d.restore()},this.drawColoredText=function(a,b,c,d){var e=game.ctx;e.save(),e.beginPath(),e.fillStyle=d,e.fillText(c,gameXToCanvasX(a),gameYToCanvasY(game.gameHeight-b)),e.stroke(),e.restore()}}function toRad(a){return a*Math.PI/180}function toDeg(a){return a/Math.PI*180}window.addEventListener("resize",resizeGame,!1),window.addEventListener("orientationchange",resizeGame,!1),window.addEventListener("keydown",keyDown,!1),window.addEventListener("keyup",keyUp,!1),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,5)}}(),game=new gameObject,game.init(),draw=new drawCameraCentricObject,resizeGame(),animLoop();