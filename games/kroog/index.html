<!doctype html><style>body{background:#000;margin:0;width:100%;height:100%;overflow:hidden;position:absolute}</style><title>KROOG - js13kGames 2012</title><canvas height=100% id=canvasBg style=position:absolute width=100%></canvas><canvas height=100% id=canvas1 style=position:absolute width=100%></canvas><script>function ne(){this.A=function(e){e=e.split(","),this.t=parseInt(e[0])||0,this.c=parseFloat(e[1])||0,this.a=parseFloat(e[2])||0,this.C=parseFloat(e[3])||0,this.e=parseFloat(e[4])||0,this.r=parseFloat(e[5])||0,this.l=parseFloat(e[6])||0,this.n=parseFloat(e[7])||0,this.j=parseFloat(e[8])||0,this.F=parseFloat(e[9])||0,this.s=parseFloat(e[10])||0,this.d=parseFloat(e[11])||0,this.i=parseFloat(e[12])||0,this.B=parseFloat(e[13])||0,this.u=parseFloat(e[14])||0,this.m=parseFloat(e[15])||0,this.g=parseFloat(e[16])||0,this.h=parseFloat(e[17])||0,this.f=parseFloat(e[18])||0,this.z=parseFloat(e[19])||0,this.p=parseFloat(e[20])||0,this.k=parseFloat(e[21])||0,this.w=parseFloat(e[22])||0,this.q=parseFloat(e[23])||0}}function e(){var l,N,o,s,r,d,h,t,c,v,X,Y,D,Q,f,p,u,w,x,U,j,z,g,K,y,V,J,b,m,Z,T,S,A,P,$,k,M,C,R,F,_,E,I,ee,q,ae,H,W,te,B,L,G,ie,O;this.o=new ne,this.b,this.reset=function(e){var a=this.o;if(u=100/(a.r*a.r+.001),x=100/(a.l*a.l+.001),U=1-.01*a.n*a.n*a.n,j=1e-6*-a.j*a.j*a.j,0==a.t&&(m=.5-.5*a.B,Z=5e-5*-a.u),V=0<a.d?1-.9*a.d*a.d:1+10*a.d*a.d,J=0,b=1==a.i?0:2e4*(1-a.i)*(1-a.i)+32,e){for(a.G=!1,N=a.q*a.q,o=a.t,a.a<.01&&(a.a=.01),(e=a.c+a.a+a.e)<.18&&(a.c*=e=.18/e,a.a*=e,a.e*=e),Q=a.C,f=0,z=a.l,R=1!=a.f||0!=a.k,E=F=0,I=.1*a.f*a.f*a.f,ee=1+1e-4*a.z,q=1-(.8<(q=5/(1+20*a.p*a.p)*(.01+I))?.8:q),ae=1!=a.f,H=0,W=.1*a.k*a.k,te=1+3e-4*a.w,g=0,K=.01*a.s*a.s,y=.5*a.F,d=r=s=0,c=1e5*a.a*a.a,v=1e5*a.e*a.e+10,h=t=1e5*a.c*a.c,this.b=t+c+v,X=1/t,Y=1/c,D=1/v,A=0!=a.g||0!=a.h,P=1020*a.g*a.g,a.g<0&&(P=-P),$=.2*a.h*a.h*a.h,M=0,C=C||Array(1024),B=B||Array(32),e=0;e<1024;e++)C[e]=0;for(e=0;e<32;e++)B[e]=2*Math.random()-1;S=(T=0)==a.m?0:parseInt(2e4*(1-a.m)*(1-a.m))+32}},this.D=function(e,a){l=!1;for(var t=O=ie=0;t<a;t++){if(l)return t;if(0!=S&&++T>=S&&(T=0,this.reset(!1)),0!=b&&++J>=b&&(b=0,u*=V),(u*=U+=j)>x&&(u=x,0<z)&&(l=!0),w=u,0<y&&(g+=K,w=u*(1+Math.sin(g)*y)),(w=parseInt(w))<8&&(w=8),0==o&&((m+=Z)<0?m=0:.5<m&&(m=.5)),++d>h)switch(d=0,++r){case 1:h=c;break;case 2:h=v}switch(r){case 0:s=d*X;break;case 1:s=1+2*(1-d*Y)*Q;break;case 2:s=1-d*D;break;case 3:l=!(s=0)}A&&(P+=$,(k=parseInt(P))<0?k=-k:1023<k&&(k=1023)),R&&0!=te&&((W*=te)<1e-5?W=1e-5:.1<W&&(W=.1));for(var i=L=0;i<8;i++){if(++f>=w&&(f-=w,3==o))for(var n=0;n<32;n++)B[n]=2*Math.random()-1;switch(o){case 0:G=f/w<m?.5:-.5;break;case 1:G=1-f/w*2;break;case 2:G=(G=(p=.5<(p=f/w)?6.28318531*(p-1):6.28318531*p)<0?1.27323954*p+.405284735*p*p:1.27323954*p-.405284735*p*p)<0?.225*(G*-G-G)+G:.225*(G*G-G)+G;break;case 3:G=B[Math.abs(parseInt(32*f/parseInt(w)))]}R&&(_=F,(I*=ee)<0?I=0:.1<I&&(I=.1),E=ae?(E+(G-F)*I)*q:(F=G,0),H+=(F+=E)-_,G=H*=1-W),A&&(C[1023&M]=G,G+=C[M-k+1024&1023],M=M+1&1023),L+=G}1<(L*=.125*N*s)?L=1:L<-1&&(L=-1),O=(O+L)/++ie,ie=0,e[t]=parseInt(32e3*O),O=0}return a}}e.prototype.v=function(e){var a=new Uint8Array([82,73,70,70,0,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,2,0,16,0,100,97,116,97,0,0,0,0]),t=(this.o.A(e),this.reset(!0),this.b=parseInt(this.b),e=new Uint16Array(this.b),this.D(e,this.b)),i=2*t,n=new Uint32Array(a.buffer);return n[1]=36+i,n[10]=i,a=new Blob([a.buffer,e.subarray(0,t-1).buffer],{type:"audio/wav"}),(window.URL||window.webkitURL).createObjectURL(a)},(window.SfxrSynth=e).prototype.getWave=e.prototype.v;var n,a,l,p,o,s,r,m=document.getElementById("canvas1").getContext("2d"),T=(m.canvas.width=document.body.offsetWidth,m.canvas.height=document.body.offsetHeight,document.getElementById("canvasBg").getContext("2d"));T.canvas.width=document.body.offsetWidth,T.canvas.height=document.body.offsetHeight;for(var u=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var a=(new Date).getTime(),t=Math.max(0,16-(a-u)),i=window.setTimeout(function(){e(a+t)},t);return u=a+t,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),("Microsoft Internet Explorer"==navigator.appName||navigator.userAgent.match(/AppleWebKit/)||window.opera)&&!navigator.userAgent.match(/Chrome/)||(n=new SfxrSynth,(a=new Audio).src=n.getWave("2,,0.1173,,0.08,0.56,,0.32,,,,,,0.5406,,,,,0.4,,,0.1,,1"),(l=new Audio).src=n.getWave("2,0.27,1,,1,0.29,,0.06,,,,,,0.5092,,,,,1,,,,,0.6"),(p=new Audio).src=n.getWave("2,0.06,0.31,0.3329,0.4142,0.5103,,,,,,0.5606,0.5871,,,,,0.6799,0.77,,,,,1"),(o=new Audio).src=n.getWave("2,0.06,0.31,0.3329,0.4142,0.5103,,,,,,-0.2199,0.5871,,,,,0.6799,0.77,,,,,1"),(s=new Audio).src=n.getWave("2,0.05,0.068,0.3554,0.3162,0.59,,,,,,0.3799,0.7,,,,,,0.99,,,,,1.3"),(r=new Audio).src=n.getWave("2,0.06,0.17,0.3329,0.46,0.55,,,,,,0.5606,0.5871,,,,,0.6799,0.77,,,,,0.7"));var S,A,P={speed:200,x:1,y:1,expanding:!1},k={allPieces:[],minQuant:2},M={allPieces:[],minQuant:2},d=1,C=0,R=0,F=0,E=0,I=1,q=1,h=[],H="menu",c=!1,W=!1,B=[],w=null,x=!1,g=m.canvas.width/2-120,y=m.canvas.height/2,L=[],G=0,O=0,N=!0,X=1;function D(e){var a,t;(e.layerX||e.layerX)&&(a=e.layerX,t=e.layerY),a-=m.canvas.offsetLeft,t-=m.canvas.offsetTop,x=g<=a&&a<=g+250&&t<=y&&y-30<=t?(document.body.style.cursor="pointer",!0):(document.body.style.cursor="",!1)}function b(){I=1,E=0,H="menu",k.minQuant=2,M.minQuant=2,R=0,w=null,f(),U()}function Q(){m.canvas.width=document.body.offsetWidth,m.canvas.height=document.body.offsetHeight,T.canvas.width=m.canvas.width,T.canvas.height=m.canvas.height,g=m.canvas.width/2-120,y=m.canvas.height/3.2+265,Z()}function U(){1!==I&&(N=N&&!1),F=C=0,P.radius=20,P.x=m.canvas.width/2,P.y=m.canvas.height/2,P.expanding=!1,k.allPieces.length=0,d=q=M.allPieces.length=0,W=!1,L.length=0,V(k),V(M),P.colorstop1="transparent",P.colorstop2="#ffffff"}function j(e,a){for(var t=0;t<e.length;t++)87 in h?(e[t].speedX=e[t].maxSpeedX,e[t].speedY=e[t].maxSpeedY,1===X&&X++):83 in h&&(e[t].speedX=-e[t].maxSpeedX,e[t].speedY=-e[t].maxSpeedY,1===X)&&X++,e[t].x+=e[t].speedX*a,e[t].y+=e[t].speedY*a,P.expanding?e[t].alpha<1&&(e[t].alpha+=.01):(e[t].alpha=.65,v(e[t],.05))}function v(e,a){e.radius<e.newRadius&&!e.expanded&&!e.expanding?e.radius+=a:e.newRadius<=e.radius&&!e.expanded&&!e.expanding&&(e.expanded=!0),e.newRadius-3<e.radius&&e.expanded&&!e.expanding?e.radius-=a:e.radius<=e.newRadius-3&&(e.radius=e.newRadius-3,e.expanded=!1)}function z(e){for(var a=0;a<e.length;a++)e[a].speedX=e[a].maxSpeedX/30,e[a].speedY=e[a].maxSpeedY/30}function K(){if(P.x-P.radius<5){if(P.x+=P.radius-P.x+5,P.expanding)return 1}else if(P.x+P.radius>m.canvas.width-5&&(P.x=m.canvas.width-P.radius-5,P.expanding))return 1;return P.y-P.radius<5?(P.y+=P.radius-P.y+5,P.expanding):P.y+P.radius>m.canvas.height-5&&(P.y=m.canvas.height-P.radius-5,P.expanding)}function V(e){for(var a=J(e.minQuant,.5*m.canvas.height/100+e.minQuant),t=1;t<=a;t++){var i,n,l,o,s,r=20*Math.random()+0-10,d=20*Math.random()+0-10,h=30*r,c=30*d,v=J(2*m.canvas.height/100+10*I/100,6*m.canvas.height/100+I),f=v+3,p=(s=e===k?(i=1,0===(n=J(0,5*m.canvas.height/100-e.allPieces.length))?(n="bonusspecial",l=Math.round(50*v/m.canvas.height),o=C*l,"*"+l):1===n&&3<I?(n="minusMinReq",o=0,"-"+(l=Math.round(50*v/m.canvas.height))+"req"):(n="normal",l=0,o=Math.round(100*v/m.canvas.height))):(n="normal",null),v+Math.random()*(m.canvas.width-2*v)),u=v+Math.random()*(m.canvas.height-2*v);entity={speedX:r,speedY:d,maxSpeedX:h,maxSpeedY:c,x:p,y:u,radius:v,newRadius:f,worth:o,type:n,note:s,special:l,quantityWorth:i},e.allPieces.push(entity)}q=Math.round(40*k.allPieces.length/100)}function f(){bgGradStop1="#"+("00000"+(16777216*Math.random()|0).toString(13)).substr(-6),bgGradStop2="#"+("00000"+(16777216*Math.random()|0).toString(13)).substr(-6)}function J(e,a,t){return e+=Math.random()*(a-e),void 0===t?Math.round(e):e.toFixed(t)}function Y(e,a,t,i,n){return e=i*(Math.PI/180),{x:a+n*Math.cos(e),y:t+n*Math.sin(e)}}function Z(){if((A=T.createRadialGradient(T.canvas.width/2,T.canvas.height/2,0,T.canvas.width/2,T.canvas.height/2,T.canvas.width/2)).addColorStop(0,bgGradStop1),A.addColorStop(1,bgGradStop2),T.fillStyle=A,T.fillRect(0,0,T.canvas.width,T.canvas.height),m.clearRect(0,0,m.canvas.width,m.canvas.height),"menu"===H){m.fillStyle="white",m.font="bold 110px Helvetica",m.textAlign="center",m.textBaseline="top",B="KROOG",S=m.canvas.height/20,m.fillText(B,m.canvas.width/2,S),m.save(),m.beginPath(),m.fillStyle="rgba(25, 133, 255, 1)",m.arc(m.canvas.width/2,S+150,30,0,2*Math.PI,!0),m.fill(),m.fillStyle="rgba(255, 255, 255, 0.6)",m.font="25px Helvetica",m.textBaseline="middle",m.textAlign="center",m.fillText(3,m.canvas.width/2,S+150),m.strokeStyle="rgba(255,255,255,0.6)",m.moveTo(m.canvas.width/1.95,S+150),m.lineTo(m.canvas.width/1.95+30,S+150),m.moveTo(m.canvas.width/2.1,S+120),m.lineTo(m.canvas.width/2.1-20,S+120),m.lineTo(m.canvas.width/2.1-20,S+180),m.lineTo(m.canvas.width/2.1,S+180),m.moveTo(m.canvas.width/2.1-20,S+150),m.lineTo(m.canvas.width/2.1-50,S+150),m.stroke(),m.closePath(),m.font="13px Helvetica",m.textAlign="left",m.fillText("Points for this bubble!",m.canvas.width/1.95+33,S+150),m.textAlign="right",m.fillText("EXPAND TO EAT ME!",m.canvas.width/2.1-52,S+150),m.restore(),m.save();var e=20*Math.PI/180;m.beginPath();for(var a=0;a<14;a++){m.strokeStyle="rgba(172, 21, 1,1)",m.lineWidth=3;var t=Y(0,m.canvas.width/2,S+225,e,20);m.moveTo(t.x,t.y),t=Y(0,m.canvas.width/2,S+225,e,30),m.lineTo(t.x,t.y),m.stroke(),e+=26}m.lineWidth=1,m.fillStyle="rgba(255, 48, 0, 1)",m.beginPath(),m.arc(m.canvas.width/2,S+225,20,0,2*Math.PI,!0),m.fill(),m.strokeStyle="rgba(255,255,255,0.6)",m.moveTo(m.canvas.width/1.95,S+225),m.lineTo(m.canvas.width/1.95+30,S+225),m.moveTo(m.canvas.width/2.1,S+195),m.lineTo(m.canvas.width/2.1-20,S+195),m.lineTo(m.canvas.width/2.1-20,S+255),m.lineTo(m.canvas.width/2.1,S+255),m.moveTo(m.canvas.width/2.1-20,S+225),m.lineTo(m.canvas.width/2.1-50,S+225),m.stroke(),m.fillStyle="rgba(255,255,255,0.6)",m.font="13px Helvetica",m.textBaseline="middle",m.textAlign="left",m.fillText("No bonus points! Only doom!",m.canvas.width/1.95+33,S+225),m.textAlign="right",m.fillText("AVOID AT ALL COSTS!",m.canvas.width/2.1-52,S+225),m.restore(),m.save(),m.beginPath(),m.fillStyle="rgba(255, 162, 0, 1)",m.arc(m.canvas.width/2,S+290,20,0,2*Math.PI,!0),m.fill(),m.fillStyle="rgba(255, 255, 255, 0.6)",m.font="25px Helvetica",m.textBaseline="middle",m.textAlign="center",m.fillText("*2",m.canvas.width/2,S+290),m.strokeStyle="rgba(255,255,255,0.6)",m.moveTo(m.canvas.width/1.935,S+290),m.lineTo(m.canvas.width/1.935+30,S+290),m.moveTo(m.canvas.width/2.1,S+270),m.lineTo(m.canvas.width/2.1-20,S+270),m.lineTo(m.canvas.width/2.1-20,S+310),m.lineTo(m.canvas.width/2.1,S+310),m.moveTo(m.canvas.width/2.1-20,S+290),m.lineTo(m.canvas.width/2.1-50,S+290),m.stroke(),m.closePath(),m.font="13px Helvetica",m.textAlign="left",m.fillText("Special bonus. Always good!",m.canvas.width/1.95+33,S+290),m.textAlign="right",m.fillText("RARE GOLDEN BUBBLE!",m.canvas.width/2.1-52,S+290),m.restore(),$(S+330,.65)}else if("game"===H){T.fillStyle="rgba(255,0,0,1)",O=G=0,T.beginPath();for(var i=0;i<T.canvas.width/30;i++)T.moveTo(G,O),T.lineTo(G+10,O+7),T.lineTo(G+20,O),G+=30;for(G=0,O=m.canvas.height,i=0;i<T.canvas.width/30;i++)T.moveTo(G,O),T.lineTo(G+10,O-7),T.lineTo(G+20,O),G+=30;for(i=O=G=0;i<T.canvas.height/30;i++)T.moveTo(G,O),T.lineTo(G+7,O+10),T.lineTo(G,O+20),O+=30;for(G=m.canvas.width,i=O=0;i<T.canvas.height/30;i++)T.moveTo(G,O),T.lineTo(G-7,O+10),T.lineTo(G,O+20),O+=30;T.fill(),m.save(),m.shadowBlur=15,m.shadowColor="white",(v=m.createRadialGradient(P.x,P.y,0,P.x,P.y,P.radius)).addColorStop(.25,P.colorstop1),v.addColorStop(.9,P.colorstop2),m.fillStyle=v,m.beginPath(),m.arc(P.x,P.y,P.radius,0,2*Math.PI,!0),m.closePath(),m.fill(),m.restore(),m.strokeStyle="#ffffff",m.stroke(),m.fillStyle="rgba(255, 255, 255, 1)",m.font="21px Helvetica",m.textBaseline="middle",m.textAlign="center",m.fillText(C+"/"+q,P.x,P.y),m.textBaseline="top",m.textAlign="left",m.fillStyle="rgba(255,255,255,0.9)",m.font="bold 17px tahoma",m.fillText("Collect at least "+q+" blue bubbles!",10,7),m.fillStyle="rgba(255,255,255,0.6)",m.fillText("ENTER to view controls",10,27),m.textAlign="right",m.fillStyle="rgba(255,255,255,0.9)",m.fillText("Level: "+I,m.canvas.width-10,7),m.fillText("Level Score: "+F,m.canvas.width-10,27),m.fillStyle="rgba(255,255,255, 0.5)",m.font="17px Helvetica",m.textBaseline="middle",m.textAlign="center",m.lineWidth=1;for(var n=0;n<k.allPieces.length;n++){var l=k.allPieces[n],o=(m.save(),m.createRadialGradient(k.allPieces[n].x-5,l.y+5,0,l.x-5,l.y+5,l.radius));"normal"===l.type?(o.addColorStop(0,"rgba(25, 133, 255,"+l.alpha+")"),o.addColorStop(.75,"rgba(2, 91, 191,"+l.alpha+")"),o.addColorStop(1,"rgba(5, 79, 162,"+l.alpha+")"),m.strokeStyle="rgba(2, 32, 86,"+l.alpha+")"):"bonusspecial"!==l.type&&"minusMinReq"!==l.type||(o.addColorStop(0,"rgba(255, 204, 0,"+l.alpha+")"),o.addColorStop(.75,"rgba(233, 186, 0,"+l.alpha+")"),o.addColorStop(1,"rgba(204, 135, 0,"+l.alpha+")"),m.strokeStyle="rgba(171, 121, 0,"+l.alpha+")"),m.fillStyle=o,m.beginPath(),m.arc(l.x,l.y,l.radius,0,2*Math.PI,!0),m.fill(),m.stroke(),m.restore(),m.fillText(l.note,l.x,l.y)}m.lineWidth=3;var s=20*Math.PI/180;for(m.strokeStyle="rgba(126,0,0,1)",n=0;n<M.allPieces.length;n++){for(m.beginPath(),l=M.allPieces[n],o=0;o<14;o++){var r=Y(0,l.x,l.y,s,l.radius);m.moveTo(r.x,r.y),r=Y(0,l.x,l.y,s,l.radius+10),m.lineTo(r.x,r.y),m.stroke(),s+=26}m.save(),m.lineWidth=1,m.beginPath(),(o=m.createRadialGradient(l.x-5,l.y+5,0,l.x-5,l.y+5,l.radius)).addColorStop(0,"rgba(255, 48, 0,"+l.alpha+")"),o.addColorStop(.75,"rgba(201, 24, 0,"+l.alpha+")"),o.addColorStop(1,"rgba(172, 21, 1,"+l.alpha+")"),m.fillStyle=o,m.arc(l.x,l.y,l.radius,0,2*Math.PI,!0),m.fill(),m.stroke(),m.restore()}m.font="normal 18px Helvetica";for(var d=0;d<L.length;d++){var h=L[d];0<h.alpha?(m.fillStyle="rgba(255,255,255,"+h.alpha+")",--h.y,h.alpha-=.01,0<k.allPieces.length?"bonusspecial"===h.type?(m.fillText("+"+h.worth+" points!",h.x,h.y),m.fillText("+"+h.quantityWorth+" collected!",h.x,h.y+20)):"minusMinReq"===h.type?m.fillText("-"+h.special+" bubbles required!",h.x,h.y):"note"===h.type?m.fillText("Press SPACE again to finish level!",h.x,h.y):m.fillText("+"+h.worth+" points!",h.x,h.y):m.fillText("+"+h.worth+" points! (x2 CLEAR BONUS!)",h.x,h.y)):L.splice(d,1)}if(N){var c=m.canvas.height/8;switch(T.fillStyle="rgba(0,0,0,0.5)",T.fillRect(m.canvas.width/2-295,c-73,600,145),T.fill(),T.textAlign="center",T.font="bold 35px Helvetica",T.fillStyle="rgba(255,255,255,0.9)",X){case 1:T.fillText("Hold W/S to fast forward/rewind",m.canvas.width/2,c-10),T.font="bold 23px Helvetica",T.fillText("(Get a feel for the movement)",m.canvas.width/2,28+c);break;case 2:T.fillText("Move with the ARROW KEYS",m.canvas.width/2,c-10),T.font="bold 22px Helvetica",T.fillText("Find the best location to pick up blue bubbles",m.canvas.width/2,18+c),T.font="bold 14px Helvetica",T.fillText("(Don't worry, spiky bubbles don't become deadly until you start expanding)",m.canvas.width/2,41+c);break;case 3:T.fillText("When ready, press SPACE",m.canvas.width/2,c-15),T.font="bold 23px Helvetica",T.fillText("To start expanding and collecting bubbles",m.canvas.width/2,13+c),T.font="bold 15px Helvetica",T.fillText("You can't move while expanding, but you CAN fast forward/rewind",m.canvas.width/2,36+c);break;case 4:T.font="bold 34px Helvetica",T.fillText("Press SPACE again to finish level!",m.canvas.width/2,c-15),T.font="bold 25px Helvetica",T.fillText("Before you run into an edge or spiky bubble",m.canvas.width/2,13+c),T.font="bold 20px Helvetica",T.fillText("If you haven't collected enough bubbles, the level restarts!",m.canvas.width/2,36+c)}}}else{var v,f,p,u,w,x;"finished"===H?(m.font="bold 55px Helvetica",m.textAlign="center",m.fillStyle="white",m.textBaseline="top",S=m.canvas.height/3.2,m.fillText("LEVEL COMPLETE",m.canvas.width/2,S)):"gameover"===H&&(m.textAlign="center",m.fillStyle="white",m.textBaseline="top",m.canvas.addEventListener("mousemove",D,!1),m.font="bold 55px Helvetica",S=m.canvas.height/3.2,m.fillText("GAME OVER",m.canvas.width/2,S),v=m.canvas.width/2-110,f=S+240,u=Math.PI/180*15,w=Math.PI/180*130,m.fillStyle="#00aced",m.strokeStyle="#00aced",m.beginPath(),m.arc(v,f,25,u,w,!1),v+=15,f+=2,w=2*Math.PI,m.arc(v,f,10,0,w,!1),m.fill(),v-=32,f-=5,u=Math.PI/180*15,m.arc(v,f,22,u,Math.PI/180*95,!1),m.moveTo(37+v,f-4),m.lineTo(45+v,f-7),m.lineTo(37+v,1+f),m.lineTo(48+v,f),m.lineTo(37+v,8+f),m.fill(),p=2+v,u=f-5,w=7+v,x=3+f,m.moveTo(20+v,8+f),m.quadraticCurveTo(w,x,p,u),m.quadraticCurveTo(w-3,5+x,7+p,13+u),m.quadraticCurveTo(w-3,5+x,p-3,7+u),m.quadraticCurveTo(w-5,8+x,3+p,15+u),m.quadraticCurveTo(w-6,10+x,p-4,14+u),m.quadraticCurveTo(w-5,15+x,10+p,23+u),m.stroke(),m.fill(),m.closePath())}if("finished"===H||"gameover"===H){m.textBaseline="top",m.fillStyle="white",m.font="normal 14px tahoma",m.textAlign="left",m.textBaseline="top",m.lineWidth=1;var g=0,y=m.canvas.width/10;switch(H){case"finished":y=m.canvas.width/2,g=S+100,m.textAlign="center",m.font="normal 19px tahoma",B=["Collected "+C+" blue bubbles","-----------------------------","Total Score: "+E,"-----------------------------","Next Level:  "+I,"","SPACE to start next level"];break;case"gameover":y=m.canvas.width/2,g=S+100,m.font="bold 22px tahoma",m.textAlign="center",m.fillText("FINAL SCORE: "+E,m.canvas.width/2,g),m.font="normal 19px tahoma",B=["","-----------------------------","Total Collected:  "+R,"Level Reached: "+I,"-----------------------------","SPACE to play again","","   Tweet your score!"]}for(var b=0;b<B.length;b++)m.fillText(B[b],y,g),g+=20}W&&$(m.canvas.height/3.5,1)}function $(e,a){m.fillStyle="rgba(255,255,255,0.5)",m.textBaseline="middle",m.textAlign="center",m.font="bold 25px Helvetica",W?(m.save(),m.fillStyle="rgba(0,0,0,0.9)",m.fillRect(m.canvas.width/2-175,e-15,460,315),m.restore(),m.fillText("ENTER to close",m.canvas.width/2,e+270)):m.fillText("SPACE to START",m.canvas.width/2,e+270),m.font="15px Helvetica",m.fillText("Move",m.canvas.width/2-67,e+110),m.fillText("Fast Forward Bubbles",m.canvas.width/2+193,e+23),m.fillText("Rewind Bubbles",m.canvas.width/2+173,e+73),m.fillText("Press ONCE to START EXPANDING",m.canvas.width/2,e+205),m.fillText("Press AGAIN to FINISH LEVEL before you die",m.canvas.width/2,e+220),m.fillText("Double tap to RETRY level",m.canvas.width/2,e+235),m.fillStyle="rgba(255,255,255,"+a+")",m.fillRect(m.canvas.width/2-90,e,45,45),m.fillRect(m.canvas.width/2-140,e+50,45,45),m.fillRect(m.canvas.width/2-90,e+50,45,45),m.fillRect(m.canvas.width/2-40,e+50,45,45),m.fillRect(m.canvas.width/2+40,e,45,45),m.fillRect(m.canvas.width/2+50,e+50,45,45),m.fillRect(m.canvas.width/2-140,e+141,275,45),m.strokeStyle="rgba(255,255,255,0.5)",m.strokeRect(m.canvas.width/2-145,e+136,285,55),m.beginPath(),m.moveTo(m.canvas.width/2+85,e+23),m.lineTo(m.canvas.width/2+120,e+23),m.moveTo(m.canvas.width/2+95,e+73),m.lineTo(m.canvas.width/2+120,e+73),m.stroke(),m.fillStyle="rgba(73,73,73,1)",m.font="20px Helvetica",m.fillText("^",m.canvas.width/2-68,e+25),m.fillText("<",m.canvas.width/2-118,e+73),m.fillText("v",m.canvas.width/2-67,e+73),m.fillText(">",m.canvas.width/2-17,e+73),m.fillText("W",m.canvas.width/2+63,e+25),m.fillText("S",m.canvas.width/2+73,e+73),m.fillText("SPACE",m.canvas.width/2,e+165)}addEventListener("keydown",function(e){h[e.keyCode]=!0},!1),addEventListener("keyup",function(e){delete h[e.keyCode],32===e.keyCode&&P.expanding?c=!0:(87===e.keyCode&&"game"===H||83===e.keyCode&&"game"===H)&&(z(k.allPieces),z(M.allPieces))},!1),document.body.onclick=function(){"gameover"===H&&x&&(window.location=w.toString())},document.body.onkeypress=function(e){if(13===(e="number"==typeof e.which?e.which:e.keyCode)&&"menu"!==H&&(W=!W),32===e&&.9<=m.globalAlpha&&"game"!==H)switch(H){case"menu":n&&a.play(),P.expanding=!1,f(),H="game",d=0;break;case"finished":n&&a.play(),f(),U(),H="game";break;case"gameover":n&&a.play(),b()}else 32!==e||"game"!==H||P.expanding?32===e&&"game"===H&&c&&(P.expanding=!1,q<=C?(f(),R+=C,I+=1,E+=F,k.minQuant=k.allPieces.length+C,M.minQuant=Math.floor(k.minQuant/1.5),H="finished",n&&p.play(),d=0):(n&&o.play(),U(),N=N&&!1),n)&&(l.currentTime=0,l.pause()):(n&&l.play(),P.expanding=!0,3===X?X=4:N=!1,c=!1,L.push({x:P.x,y:P.y,alpha:1,type:"note"}))},b();var _=Date.now();Q(),window.addEventListener("resize",Q,!1),requestAnimationFrame(function e(){var a,t=Date.now(),i=t-_;requestAnimationFrame(e),i/=1e3,d<=1&&(d+=.05,m.globalAlpha=d),"game"===H&&(a=i,!P.expanding&&(38 in h&&(P.y-=P.speed*a,2===X)&&X++,40 in h&&(P.y+=P.speed*a,2===X)&&X++,37 in h&&(P.x-=P.speed*a,2===X)&&X++,39 in h)&&(P.x+=P.speed*a,2===X&&X++),P.expanding&&(P.radius+=20*a,function(){for(var e=0;e<k.allPieces.length;e++){var a=k.allPieces[e],t=(v(a,.05),Math.sqrt(Math.pow(a.x-P.x,2)+Math.pow(a.y-P.y,2)));t<a.radius+P.radius?.1<a.alpha?a.alpha-=.1:(1===k.allPieces.length&&"normal"===a.type?(n&&r.play(),a.worth*=2):"bonusspecial"===a.type?(n&&(r.currentTime=0,r.play()),a.worth=F*a.special,a.quantityWorth=C*a.special):"minusMinReq"===a.type?(n&&(r.currentTime=0,r.play()),a.worth=0,a.quantityWorth=0,q-=a.special):n&&(s.currentTime=0,s.play()),F+=a.worth,L.push({x:a.x,y:a.y,worth:a.worth,quantityWorth:a.quantityWorth,alpha:1,type:a.type,special:a.special}),k.allPieces.splice(e,1),C+=a.quantityWorth,q<=C&&(P.colorstop1=bgGradStop2,P.colorstop2=bgGradStop1)):t<a.radius+P.radius+10&&(a.x=P.x<a.x?a.x-.15:a.x+.15,a.y=P.y<a.y?a.y-.15:a.y+.15)}}(),function(){for(var e=0;e<M.allPieces.length;e++){var a=M.allPieces[e],t=Math.sqrt(Math.pow(M.allPieces[e].x-P.x,2)+Math.pow(M.allPieces[e].y-P.y,2));if(t<a.radius+P.radius+10)return 1;t<a.radius+P.radius+50?v(a,.3):v(a,.05)}}()||K())&&(n&&(l.currentTime=0,l.pause()),d=0,n&&o.play(),H="gameover",E+=F,f(),w="https://twitter.com/intent/tweet?&text=I+just+reached+"+E+"+points+over+"+I+"+levels+in+KROOG!+-+http://liza.io/KROOG+(cc+@Lazer)"),v(P,.05),j(k.allPieces,i),j(M.allPieces,i),K()),Z(),_=t})</script>