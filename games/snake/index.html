<!doctype html><title>Snake - js13kGames 2012</title><style>#cvs{display:block;margin:auto;border:1px solid}</style><canvas id=cvs></canvas><script>function c(e,t){t=c.resolve(e,t||"/");var n,i=c.modules[t];if(i)return(n=c.cache[t])?n.exports:i();throw new Error("Failed to resolve module "+e+", tried "+t)}var r;c.paths=[],c.modules={},c.cache={},c.extensions=[".js",".coffee",".json"],c._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},c.resolve=function(e,t){if(t=t||"/",c._core[e])return e;var o=c.modules.path();if(t=o.resolve("/",t)||"/",e.match(/^(?:\.\.?\/|\/)/)){var n=h(o.resolve(t,e))||a(o.resolve(t,e));if(n)return n}if(n=function(e,s){for(var t=function(){for(var e,t="/"===s?[""]:o.normalize(s).split("/"),n=[],i=t.length-1;0<=i;i--)"node_modules"!==t[i]&&(e=t.slice(0,i+1).join("/")+"/node_modules",n.push(e));return n}(),n=0;n<t.length;n++){var i=t[n];if(r=h(i+"/"+e))return r;if(i=a(i+"/"+e))return i}var r=h(e);if(r)return r}(e,t))return n;throw new Error("Cannot find module '"+e+"'");function h(e){if(e=o.normalize(e),c.modules[e])return e;for(var t=0;t<c.extensions.length;t++){var n=c.extensions[t];if(c.modules[e+n])return e+n}}function a(e){e=e.replace(/\/+$/,"");var t=o.normalize(e+"/package.json");if(c.modules[t]){var n,i=(t=c.modules[t]()).browserify;if("object"==typeof i&&i.main){if(n=h(o.resolve(e,i.main)))return n}else if("string"==typeof i){if(n=h(o.resolve(e,i)))return n}else if(t.main&&(n=h(o.resolve(e,t.main))))return n}return h(e+"/index")}},c.alias=function(e,t){var n=c.modules.path(),i=null;try{i=c.resolve(e+"/package.json","/")}catch(t){i=c.resolve(e,"/")}for(var s=n.dirname(i),r=(Object.keys||function(e){var t,n=[];for(t in e)n.push(t);return n})(c.modules),o=0;o<r.length;o++){var h,a=r[o];a.slice(0,s.length+1)===s+"/"?(h=a.slice(s.length),c.modules[t+h]=c.modules[s+h]):a===s&&(c.modules[t]=c.modules[s])}},r={},(c.define=function(e,t){function n(e){var t=c(e,i);return(e=c.cache[c.resolve(e,i)])&&null===e.parent&&(e.parent=s),t}c.modules.__browserify_process&&(r=c.modules.__browserify_process());var i=c._core[e]?"":c.modules.path().dirname(e),s=(n.resolve=function(e){return c.resolve(e,i)},n.modules=c.modules,n.define=c.define,n.cache=c.cache,{id:e,filename:e,exports:{},loaded:!1,parent:null});c.modules[e]=function(){return c.cache[e]=s,t.call(s.exports,n,s,s.exports,i,e,r),s.loaded=!0,s.exports}})("path",function(e,t,n,i,s,r){function o(e,t){for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}function h(e,t){for(var n=0,i=e.length;0<=i;i--){var s=e[i];"."==s?e.splice(i,1):".."===s?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;)e.unshift("..");return e}var a=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){for(var e="",t=!1,n=arguments.length;-1<=n&&!t;n--){var i=0<=n?arguments[n]:r.cwd();"string"==typeof i&&i&&(e=i+"/"+e,t="/"===i.charAt(0))}return(t?"/":"")+h(o(e.split("/"),function(e){return e}),!t).join("/")||"."},n.normalize=function(e){var t="/"===e.charAt(0),n="/"===e.slice(-1);return(e=(e=h(o(e.split("/"),function(e){return e}),!t).join("/"))||t?e:".")&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(o(e,function(e,t){return e&&"string"==typeof e}).join("/"))},n.dirname=function(e){return(e=a.exec(e)[1]||"")?1===e.length?e:e.substring(0,e.length-1):"."},n.basename=function(e,t){return e=a.exec(e)[2]||"",t&&e.substr(-1*t.length)===t?e.substr(0,e.length-t.length):e},n.extname=function(e){return a.exec(e)[3]||""}}),c.define("__browserify_process",function(t,e,n,i,s,r){var o,h,a,c;(r=e.exports={}).nextTick=(e="undefined"!=typeof window&&window.setImmediate,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener,e?window.setImmediate:c?(a=[],window.addEventListener("message",function(e){e.source===window&&"browserify-tick"===e.data&&(e.stopPropagation(),0<a.length)&&a.shift()()},!0),function(e){a.push(e),window.postMessage("browserify-tick","*")}):function(e){setTimeout(e,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(e){if("evals"===e)return t("vm");throw new Error("No such module. (Possibly not yet loaded)")},h="/",r.cwd=function(){return h},r.chdir=function(e){o=o||t("path"),h=o.resolve(e,h)}}),c.define("/Game.js",function(t,e,n,i,s,r){var o,h=t("./Snake.js"),a=t("./Food.js");function c(e){this.score=0,this.ctx=e,this.thickness=5}c.prototype={constructor:c,start:function(){o=this;var e=t("events").EventEmitter;this.evt=new e,this.keyCodes={37:"left",38:"top",39:"right",40:"bottom"},this.food=new a(this.ctx,this),this.snake=new h(this.ctx,this),this.evt.on("I ate some food",function(){o.score++,o.food.clear(),o.food=new a(o.ctx,o)}),this.keyEvt=window.addEventListener("keydown",this.handleKeys)},stop:function(e){var t=this.ctx.canvas;window.cancelAnimationFrame(e),window.removeEventListener(this.keyEvt),this.ctx.clearRect(0,0,t.width,t.height),alert("Game over! You got "+this.score+" points!"),this.restart()},restart:function(){var e=document.createElement("button");e.textContent="Restart the game",e.addEventListener("click",function(){this.parentNode.removeChild(this),o.start()},!1),document.body.appendChild(e)},handleKeys:function(e){o.keyCodes[e.keyCode]&&o.snake.move(o.keyCodes[e.keyCode])}},e.exports=c}),c.define("/Snake.js",function(e,t,n,i,s,r){function o(e,t){this.ctx=e,this.length=30,this.speed=1,this.direction="right",this.game=t,this.pos=this.build(),this.drawFirst(),this.draw()}o.prototype={constructor:o,build:function(){for(var e=[],t=0;t<this.length;t++)e.push({x:this.ctx.canvas.width/2+t,y:this.ctx.canvas.height/2,dir:this.direction});return e},drawFirst:function(){var e=this.pos,t=this.ctx,n=this.game.thickness;e.forEach(function(e){t.fillRect(e.x,e.y,n,n)},this)},move:function(e){("left"===this.direction&&"right"===e||"right"===this.direction&&"left"===e||"top"===this.direction&&"bottom"===e||"bottom"===this.direction&&"top"===e)&&this.game.stop(this.reqID),this.direction=e},draw:function(){var e,t,n=this.ctx,i=(this.game.board,this.direction),s=this.game.thickness,r=this.pos,o=(this.game.food,this.reqID=window.requestAnimationFrame(this.draw.bind(this)),{top:function(){e=r[r.length-1].x,t=r[r.length-1].y-this.speed},right:function(){e=r[r.length-1].x+this.speed,t=r[r.length-1].y},bottom:function(){e=r[r.length-1].x,t=r[r.length-1].y+this.speed},left:function(){e=r[r.length-1].x-this.speed,t=r[r.length-1].y}}[i].call(this),r.push({x:e,y:t,dir:i}),i=r[r.length-1],n.fillRect(i.x,i.y,s,s),r.shift());n.clearRect(o.x-this.speed,o.y-this.speed,s+this.speed+1,s+this.speed+1),this.detectFood(),(i.x<1||i.x>n.canvas.width-1||i.y<1||i.y>n.canvas.height-1)&&this.game.stop(this.reqID)},detectFood:function(){var e=this.pos,t=e[e.length-1],n=this.game.food,i=this.game.evt;if(t.x>=n.x-3&&t.x<=n.x+8&&n.y-3<=t.y&&t.y<=n.y+8){i.emit("I ate some food"),this.length+=10,this.speed+=.2;for(var s=0;s<10;s++)switch(e[0].dir){case"top":e.unshift({x:e[0].x,y:e[0].y+s+this.speed,dir:"top"});break;case"right":e.unshift({x:e[0]-s-this.speed,y:e[0],dir:"right"});break;case"bottom":e.unshift({x:e[0],y:e[0]-s-this.speed,dir:"right"});break;case"left":e.unshift({x:e[0]+s+this.speed,y:e[0],dir:"right"})}}}},t.exports=o}),c.define("/Food.js",function(e,t,n,i,s,r){function o(e,t){this.ctx=e,this.game=t,this.draw()}o.prototype={constructor:o,draw:function(){var e=this.ctx,t=e.canvas,n=this.game.thickness;this.x=Math.random()*(t.width-5)+1,this.y=Math.random()*(t.height-5)+1,e.fillRect(this.x,this.y,n,n)},clear:function(){var e=this.ctx,t=this.game.thickness;e.clearRect(this.x-1,this.y-1,t+3,t+3)}},t.exports=o}),c.define("events",function(e,t,n,i,s,r){r.EventEmitter||(r.EventEmitter=function(){}),n=n.EventEmitter=r.EventEmitter;var o="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},n.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(this._events){var t=this._events[e];if(t){if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0}if(o(t)){for(var n=Array.prototype.slice.call(arguments,1),i=t.slice(),s=0,r=i.length;s<r;s++)i[s].apply(this,n);return!0}}}return!1},n.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");var n;return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?o(this._events[e])?(this._events[e].warned||(n=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0),this._events[e].push(t)):this._events[e]=[this._events[e],t]:this._events[e]=t,this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,n){var i=this;return i.on(t,function e(){i.removeListener(t,e),n.apply(this,arguments)}),this},n.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(this._events&&this._events[e]){var n=this._events[e];if(o(n)){var i=n.indexOf(t);if(i<0)return this;n.splice(i,1),0==n.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e]}return this},n.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},n.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),c.define("/main.js",function(e,t,n,i,s,r){var o=document.getElementById("cvs"),h=o.getContext("2d");o.width=300,o.height=300,new(e("./Game.js"))(h).start()}),c("/main.js")</script>