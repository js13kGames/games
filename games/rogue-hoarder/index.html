<!doctype html><meta name=viewport content="width=device-width"><link rel="shortcut icon" href=#><style>body,html{font-family:sans-serif;height:100%;margin:0;padding:0;width:100%}body{background:#fff}.container{box-sizing:border-box;height:100%;margin:0 auto;padding:1em;width:720px}#game{position:relative}#a,#game{height:480px;width:720px}#a{background:#c96;position:absolute}#h{align-content:start;display:flex;flex-direction:row;flex-flow:wrap}#end,#h,#m,#p,#t,#td{padding:12px;position:absolute}#end,#m,#p,#t,#td{box-sizing:border-box;color:#fff;height:100%;width:100%}#end{align-content:center;flex-direction:column;justify-content:center;text-align:center}#end,#m{background:rgba(0,0,0,.5)}#m{height:40px;right:0;text-align:right;width:200px}#ex-note{color:gold;display:none}#dList,#list,#tList{align-items:center;display:flex;flex-direction:row;flex-flow:wrap}#dList>div,#tList>div,.card{font-size:13px;text-align:center}.card{background:#fff;border:1px solid #000;box-sizing:border-box;color:#000;display:flex;flex-direction:column;height:65px;justify-content:center;margin:1px;user-select:none;width:50px}#hBtn{width:100px}.card.hd{border:3px solid #000}.card i{font-size:20px;font-style:normal}.c-0{background:#e55}.c-1{background:#ff8}.c-2{background:#8e8}.c-3{background:#9ff}.c-i1{background:#fff}#h .card{height:40px;margin-right:2px;width:30px}.card.out{animation:slideIn 1s ease-out both reverse}.card.in{animation:slideIn 1s ease-out both}@keyframes slideIn{0%{opacity:0;transform:scale(1.6) translate(10px,30px) rotate(40deg)}to{opacity:1;transform:none}}</style><div class=container><h3>Rogue-Hoarder-13k</h3><p>By Dickson Chui (vicksonzero)<br>- Use WASD, ZQSD, or Arrow keys to move.<br>- Press J or K to attack<br>- S (while on ground) to block with shield<p><a href=https://github.com/vicksonzero/rogue-hoarder>Source code here</a> | <a href=https://vicksonzero.itch.io/rogue-hoarder>Comment here</a><div id=game><canvas id=a width=480 height=320></canvas><div id=h></div><div id=m></div><div id=p><h1>Paused</h1><p>Click the cards to sort them, with least important ones on the right:<p id=ex-note>Not enough space. The right most item will be destroyed.<div id=list></div><p>Press &lt;Space> to resume</div><div id=t><h1>Trade</h1><p>Click the cards to sell them<div id=tList></div><p>Press &lt;Space> to resume</div><div id=end></div><div id=td><h1>Witch doctor</h1><p>Sacrifice points to buy slots<div id=dList></div><div><div id=hBtn class=card onclick='trade("d")'>Buy slot with <span></span>pts</div></div><p>Press &lt;Space> to resume</div></div></div><script>!function(e){var t={};function n(i){if(t[i])return t[i].exports;var l=t[i]={i:i,l:!1,exports:{}};return e[i].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(i,l,function(t){return e[t]}.bind(null,l));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n(1),n(2)},function(e,t){const n=()=>{if(z=!z)J=-1e3,console.log("trade_type",pe),f.style.display="_"==pe||"f"==pe?"block":"none",s.style.display="t"==pe?"block":"none",a.style.display="d"==pe?"block":"none",l.style.display="none",c.style.display=he.length==fe?"none":"block",he.forEach((e=>e.nw=0)),Ae();else{if(he.length>fe){const e=he.pop();De(e),de=[e]}J=0,je(),Ae(),f.style.display="none",s.style.display="none",a.style.display="none",l.style.display="flex"}},i=document.querySelector("canvas"),l=document.querySelector("#h"),o=document.querySelector("#m"),c=document.querySelector("#ex-note"),s=document.querySelector("#t"),r=document.querySelector("#tList"),a=document.querySelector("#td"),h=document.querySelector("#dList"),d=document.querySelector("#list"),f=document.querySelector("#p"),y=document.querySelector("#end"),p=i.getContext("2d");f.style.display="none",s.style.display="none",a.style.display="none",y.style.display="none",p.imageSmoothingEnabled=!1,l.onclick=n;const w=document.createElement("canvas"),u=w.getContext("2d"),m=document.createElement("canvas"),g=m.getContext("2d"),x=["111111111111111111111111111111111111111111111111111111111111111111111111111111","100000000000000001000000000000000000000000000000000001000000000000000000000001","10000000000000000100000000000000000000000000000000000100000000D000000000000001","100000000000000001000000000020000000000000000000000001111111111100000000000001","100000000000000001000000011111110011000001000000000001000000000000000000000001","1000000000000000010D0000000000010000001000000010000001000000000000300000000001","100000000200000D01111100000000010000000000010000000000000000000001111000000001","100000011111111111000000000000010000000000000000011100000000000000000000000001","1000000000000000010000002000000100000000000000000000000000000000000000www2www1","100000000000000001000111111000010333000000000000000000020000000000000111111111","100001110000000001000000000000011111100000000000000011111100000000000000000001","1000000000000000010w2wwww2w000010000000000302030000010000000000000000000000001","100000000000000001111111111100010000000011111111100010000033002000000000000001","101100000000000000000100000000010000000000000000000110001111111111100000000001","100000000000000000000100000000010000000000000000000110000000000100000000000001","100020000000w2wwww000100000000010www2w0000000000001110000000000100000000000001","111111100001111111100100000002011111111000000000111111000000000100000100000001","100000000000000000000100000111110000000000000000000010000000000100000000000001","1000000011000000000001000000000100000000000D0000000210000000000111100000020001","100000000000000000000100000000010000000001111100011110010000000111000001111001","10000000330www2w00000101111000011112000000000000000010000000000100000111111001","1000001111111111100001000000000111111133000000002000133w2ww0000100000100000001","100000000000001110000100000000011111111111100111111111111110000100001100000001","100000000000000110000100000111110000000000000000000000001000000100011100000001","100010000000000010000000000000010000000000000003000000001000000110000100000001","1000100000000020133wwww3320000010000000000001111110000001000000110200100000001","111110000001111111111111111000010000000000000001000000001000000011111100000001","100010000000000010000000000000010000020000000001000000001330000000000100D03001","100011000000000010000000000000000000111111000001001110011111000000000111111001","100000001000000010000000000000000000000000000001000000000001000000000000000001","100000001000000000000000000203330000000000000201000000000000000000000000000201","100000001020000000000000111111111110000000001111111000000000000000000000001111","100011111111100000000000000000010000000000000000001000000000000000020000000001","1000000010000000000w2ww0000000010000000300000000001000000001110333111100000001","100000001000000000011110000000010000111111000000001001110001111111111111111001","100000001000000000011110000000010000000000000000001000000001000000000100000001","111100111000013320011110000000010000000000000000001000000001000000000100000001","10000000100001111111111000000001ww2www0D0ww2www0001111001111000000000111110001","100000001000000000000000000000011111111111111110000000000001000000000000000001","100001001000000000000000002000000000000000000000000200000001000000000000000001","100001331020000000000000011110000000000000000000011111111001000000100000011111","100011111111100000000000000000000000111100000000000000000001000000000000000001","100000000000000000000000000000000000000000000000000000000001000000000000000001","100000000000000000000000000000011100000001111001111000000001000D00000100000001","100020000000000000000000000000000000000000000000000001100001111110000000000001","1111111111000000wwww2ww0000000000000000000000000000000000001000000000000010001","10000000000000001111111000000ww2ww00000000000000000000000111000000000000000001","100000000000000111111111000001111100000000000000000000000000000www00www0000001","10000000000011111111111133331111111110330003111113www2wwwwwwwww11133111ww2www1","111111111111111111111111111111111111111111111111111111111111111111111111111111"],v=["1111111111111111111111111111111111111111111111","1000000000000000000000000000000000000000000001","1000000000000000000000000000000000000000000001","1000000000000000n000000000000000000000000n0001","100000000n001111100000000000000000000001111111","10000n0111000000000000000000000000n00000000001","10011111000000000000000n0000n00001111000000001","1000000000000000000001111111111000000000000001","11000000000000001110000000000000000000n0000001","1100000000000000000000000000000000001111100001","1110000000000000000000000000000000000000000000","11100000000n0002n000111300wwwwwwnwww000000000D","1111111111111111111111111111111111111111111111"],M=["James","John","William","Thomas","Daniel","Sarah","Jessica","Michelle","Amanda","Sharon"],b=["#FF7","#247","#19F","#F67","#0DA","#A17","#AEF","#8AA","#322","#996"],S=[{n:"",i:""},{n:"life",i:"ü§ç"},{n:"love",i:"‚ù§Ô∏è"},{n:"health",i:"üëç"},{n:"mind",i:"üí≠"},{n:"run",i:"ü¶∂"},{n:"jump",i:"üêá"},{n:"hands",i:"üñê"},{n:"sight",i:"üëÄ"},{n:"hear",i:"üëÇ"},{n:"family",i:"üè†"},{n:"friends",i:"üë®üèª‚Äçü§ù‚Äçüë®üèª"},{n:"kidney",i:"üì±"},{n:"color",i:"üé®"},{n:"speech",i:"üëÑ"},{n:"",rq:0,i:""},{n:"",rq:0,i:""},{n:"strength",i:"üí™"},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"",i:""},{n:"sword",i:"üó°",c:100},{n:"wand",i:"‚ú®",c:300},{n:"shield",i:"üõ°",c:60},{n:"armor",i:"üë∑",c:200},{n:"elem helmet",i:"üß¢",c:400},{n:"potion",i:"üíä",c:400},{n:"flower",i:"üåπ",c:5},{n:"torch",i:"üî¶",c:800},{n:"compass",i:"üß≠",c:1e3},{n:"map",i:"üó∫Ô∏è",c:2e3},{n:"glasses",i:"üëì",c:2e3},{n:"treasure",i:"üéÅ",c:100},{n:"sprint",i:"üèÉ‚Äç‚ôÇÔ∏è",c:100},{n:"climb",i:"üßó‚Äç‚ôÇÔ∏è",c:100}],$=[[2,1],[5,6,7,8,9,10,11],[12,13,14,17,4],[15,16]],k=[[35,36],[30,30,30,32,32,32,33,31],[31,37,38,42,43],[39,40],[41]];for(let e=0;e<$.length;e++){const t=$[e];for(const n of t)S[n].t=e}const T=[{n:"Rat",d:2,hp:2,w:.6,h:.5,sp:.05,b:"wmp"},{n:"Bat",d:2,hp:2,w:.65,h:.65,sp:.035,b:"fmp"},{n:"Bee",d:3,hp:3,w:.5,h:.5,sp:.035,b:"fsp"},{n:"Skeleton",d:4,hp:5,w:.6,h:.9,sp:.05,b:"wmla"},{n:"Spider",d:4,hp:5,w:.85,h:.5,sp:.05,b:"hm"},{n:"Troll",d:8,hp:10,w:.8,h:1.5,sp:.05,b:"wma"},{n:"Minotaur",d:10,hp:15,w:.8,h:1.5,sp:.05,b:"wmpa"},{n:"Wisp",d:3,hp:5,w:.8,h:1.5,sp:.05,b:"fspe"},{n:"Snake",d:4,hp:3,w:.8,h:.9,sp:.03,b:"wspv"},{n:"Golem",d:14,hp:25,w:1.2,h:1.6,sp:.01,b:"wmpy"}];let E=!0,R=!0,A=!0,D=!0,j=!0,q=!0,H=!0,L=!0,P=!0,I=!0,F=!0,_=!1,O=!1,B=!1,Y=!1,W=!1,C=!1,G="h",J=1e3,z=!1,N="h"==G?v:x,K=N[0].length,Q=N.length,V=[],Z=0,U={x:10,y:2,w:.6,h:1,fc:1,type:"hero",vx:0,vy:0,gd:1,inv:0},X=.012,ee=1,te=0,ne=0,ie=0,le=1,oe=0,ce=0,se=0,re=0,ae=3,he=[3,0,33,0].map((e=>S[e])),de=[],fe=he.length,ye=[],pe="s",we=500,ue=15,me=3,ge=0,xe=!1,ve=!0,Me=0,be=0,Se=Number(localStorage.getItem("dicksonmd.RogueHoarder.HighScore")),$e=[{n:"Trader",t:"t",i:0,lv:.1,c:b.splice(~~(Math.random()*b.length),1)[0]},{n:"Witch Doctor",t:"d",i:0,lv:.1,c:"#333"}],ke=0,Te=0;const Ee=e=>{if(Me>=30)return void Re();K=(N="h"==(G=e)?v:x)[0].length,Q=N.length,V=[],ge=~~(Math.random()*Xe.length),"d"==G?(U.x=9,U.y=5):(Me++,ve&&(me+=1.5),ue+=me,$e.length<4&&(2==Me||Math.random()<.2)&&$e.push({n:M.splice(~~(Math.random()*M.length),1)[0],t:"f",i:0,lv:0,c:b.splice(~~(Math.random()*b.length),1)[0]}),$e.forEach((e=>{e.i=0,e.lv+=.1})),U.x=4,U.y=7);const t=[],n=[],i=[],l=[],o=[];for(let e=0;e<Q;e++)for(let c=0;c<K;c++){const s=N[e][c];"D"==s&&n.push({x:c,y:e}),"3"==s&&i.push({x:c,y:e}),"2"==s&&l.push({x:c,y:e}),"T"==s&&t.push({x:c,y:e}),"n"==s&&o.push({x:c,y:e})}if("d"==G){const{x:e,y:t}=n.splice(~~(Math.random()*n.length),1)[0];U.x=e,U.y=t}for(let e=0;n.length&&e<2;e++){const{x:e,y:t}=n.splice(~~(Math.random()*n.length),1)[0];V.push({type:"D",x:e+.1,y:t-.6,w:.8,h:1.6,fc:1})}V.push({type:"D",x:5.1,y:47.4,w:.8,h:1.6,fc:1});for(let e=0;i.length&&e<10;e++){const{x:e,y:t}=i.splice(~~(Math.random()*i.length),1)[0];V.push({type:"3",x:e+.3,y:t+.4,w:.6,h:.6,fc:1})}"d"==G&&(V=V.concat(Le(l,10)));for(let e=0;("d"==G||1==Me)&&l.length&&e<10;e++){const{x:e,y:t}=l.splice(~~(Math.random()*l.length),1)[0],n=Je([0,0,0,0,0,1,1,1,1,1,2,2,4,4,4]),i=1==Me&&"h"==G?30:Je(k[n]),o=S[i];"treasure"==o.n&&(o.c=~~(100*Math.pow(Me,1.5))),V.push({type:"T",x:e+.3,y:t+.4,w:.6,h:.6,fc:1,vy:.1,item:o})}"h"==G&&Me>1&&$e.forEach((e=>{if(!o.length)return;const{x:t,y:n}=o.splice(~~(Math.random()*o.length),1)[0];V.push({type:"n",x:t+.3,y:n,w:.6,h:1,fc:1,vy:.1,npc:e})})),J=2e3},Re=()=>{xe=!0,Se=Math.max(be,Se);const e=16*Z/1e3;localStorage.setItem("dicksonmd.RogueHoarder.HighScore",""+Se),y.innerHTML=`<div><h1>Game Over</h1><p>You have survived ${Me-1} nights,<br>and gained ${be}pts</p><p>At the cost of ${ye.map((e=>e.i)).join(", ")}</p><p>Play time: ${~~(e/60)}:${~~(e%60)}<br>High score: ${Se}</p><p>&lt;Refresh the webpage to restart&gt;</p></div>`,y.style.display="flex"},Ae=()=>{d.innerHTML=he.slice(0,fe).map((({n:e,i:t,t:n,nw:i,hd:l},o)=>`<div class="card c-${n} ${l?"hd":""}" data-c=${o} onclick="prioritize(${o})"><i>${t}</i>${e}</div>`)).join("")+"<div>‚ÜêüíÄ</div>"+(he.length<=fe?"":`<div class="card c-${he[fe].t}" data-c=${fe}><i>${he[fe].i}</i>${he[fe].n}</div><div>‚Üíüóë</div>`),r.innerHTML=he.slice(0,fe).map((({n:e,i:t,t:n,nw:i,hd:l,c:o},c)=>`<div><div class="card c-${n} ${l?"hd":""}" data-c=${c} onclick="trade('s',${c})"><i>${t}</i>${e}</div><p>${o?o+"pts":"--"}</p></div>`)).join(""),r.innerHTML+=de.map((({i:e,t:t,nw:n},i)=>`<div class="card c-${t} out" data-c=${i}><i>${e}</i></div>`)).join(""),h.innerHTML=he.slice(0,fe).map((({n:e,i:t,t:n,nw:i,hd:l,c:o},c)=>`<div><div class="card c-${n} ${l?"hd":""}" data-c=${c}><i>${t}</i>${e}</div></div>`)).join(""),document.querySelector("#hBtn span").innerHTML=we+"pts",l.innerHTML=he.map((({i:e,t:t,nw:n,hd:i},l)=>`<div class="card c-${t} ${n?"in":""}  ${i?"hd":""}" data-c=${l}><i>${e}</i></div>`)).join(""),l.innerHTML+=de.map((({i:e,t:t,nw:n},i)=>`<div class="card c-${t} out" data-c=${i}><i>${e}</i></div>`)).join(""),o.innerHTML=`Score: ${be}`,de=[]},De=e=>{console.log("lost item",e.n,S.findIndex((t=>t.n==e.n))),""!=e.n&&S.findIndex((t=>t.n==e.n))<30&&ye.push(e)},je=()=>{console.log("updateAbilityList");const e=ae;if(3==ae&&he.filter((e=>"health"==e.n)).length<=0)ae=2;else if(2==ae&&he.filter((e=>2==e.t)).length<=1)ae=1;else if(1==ae&&he.filter((e=>1==e.t)).length<=3)ae=0;else if(0==ae&&he.every((e=>"life"!=e.n)))return void Re();e!=ae&&($[ae].forEach((e=>{he.unshift({...S[e],nw:1})})),fe=he.length);const t=I,n=C,i=D;R=ae>=2||he.some((e=>"run"==e.n)),E=ae>=2||he.some((e=>"jump"==e.n)),A=ae>=2||he.some((e=>"hands"==e.n)),D=ae>=2||he.some((e=>"sight"==e.n)),j=ae>=2||he.some((e=>"hear"==e.n)),q=ae>=2||he.some((e=>"family"==e.n)),H=ae>=2||he.some((e=>"friends"==e.n)),L=ae>=3||he.some((e=>"mind"==e.n)),P=ae>=3||he.some((e=>"strength"==e.n)),I=ae>=3||he.some((e=>"color"==e.n)),F=ae>=3||he.some((e=>"speech"==e.n)),_=he.some((e=>"sprint"==e.n)),O=he.some((e=>"climb"==e.n)),W=he.some((e=>"shield"==e.n)),C=he.some((e=>"torch"==e.n)),t==I&&n==C&&i==D||qe(),He()},qe=()=>{i.width=C?720:480,i.height=C?480:320,i.style.filter=`grayscale(${I?0:1}) brightness(${D?1:.16})`},He=()=>{let e,t=he.filter((e=>["sword","wand"].includes(e.n)))||[];t.forEach((e=>{e.hd=0})),e=t.pop(),B=e&&"sword"==e.n,Y=e&&"wand"==e.n,e&&(e.hd=1),(t=he.filter((e=>["armor"].includes(e.n)))||[]).forEach((e=>{e.hd=0})),(e=t.pop())&&(e.hd=1)},Le=(e,t)=>{let n,i=[],l="h"==G?4:ue;const o=[0,0,0,1,1];l>30&&o.push(1,2);for(let t=0;e.length&&l>0;t++){const{x:t,y:c}=e[~~(Math.random()*e.length)],s=T[Je(o)],{w:r,h:a}=s,h=t+(1-r)/2,d=c+1-a-(s.b.includes("f")?1:0),f=(l-=s.d)>40?Je(["","","","","","","","","","F","W","E"]):"";l-=""==f?0:3,n={...s,maxHp:s.hp,el:f,sx:h,sy:d,dx:h,dy:d,ai:0,tg:0},i.push({type:"E",x:h,y:d,w:r,h:a,fc:1,vx:0,vy:0,gd:1,inv:0,enemy:n})}return console.log("spawnEnemy difficulty:",ue),console.log("spawnEnemy spawned:",i.length),i},Pe=(e,t,n,i=1)=>{V.push({...e,type:"F",fc:i,eff:{c:t,hp:30,s:n}})},Ie=()=>{he.forEach((e=>e.nw=0));const e=he.slice().reverse().findIndex((e=>"armor"==e.n)),t=(e>-1?he.length-e:he.length)-1,n=he[t];De(n),de=[n],"armor"==n.n?(he.splice(t,1,{n:"",i:"",rq:1}),Pe(U,"#AAA",1)):(he.splice(t,1),Pe(U,"red",.7),ve=!1),fe=he.length,U.inv=Z+120,je(),Ae()},Fe=(e,t)=>{const n=_e(t,e);t.vx=.3*Math.sign(n[0]),t.vy=-.2,t.gd=0},_e=(e,t)=>{const n=e.x+e.w/2,i=e.y+e.h/2;return[n-(t.x+t.w/2),i-(t.y+t.h/2)]},Oe=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Be=e=>[U.x+U.fc*(1-Math.max(0,e-Z)/15*.5-.1*(U.fc+1)),U.y+.43,.8,.2],Ye=(e,t,n,i)=>{const l=i&&_e(i,n),o=i&&Oe(l),c="s"==t?.1:.6;V.push({x:n.x+n.w/2-.3,y:n.y+.45*n.h-c/2,fc:1,w:.6,h:c,type:"M",vx:i?l[0]/o*.1:.2*n.fc,vy:i?l[1]/o*.1:0,m:{c:e,s:t}})},We=(e,t,n,i)=>{e.x+=t,e.x=t<=0?Math.max(e.x,0):Math.min(K-e.w,e.x);const l=t<=0?e.x:e.x+e.w,o=+n[~~e.y][~~l],c=+n[~~(e.y+e.h-.1)][~~l];return 1!=o&&1!=c||(e.x=t<=0?Math.ceil(e.x):~~(e.x+e.w)-e.w,i&&i()),e},Ce=(e,t,n,i)=>{e.y+=t,e.y=t<=0?Math.max(e.y,0):Math.min(Q-e.h,e.y);const l=t<=0?e.y:e.y+e.h,o=+n[~~l][~~e.x],c=+n[~~l][~~(e.x+e.w-.1)];return 1!=o&&1!=c||(e.y=t<=0?Math.ceil(e.y):~~(e.y+e.h)-e.h,i&&i()),e},Ge=e=>{const{x:t,y:n}=e,{dx:i,dy:l,sp:o}=e.enemy,c=i-t;e.x+=Math.sign(c)*Math.min(Math.abs(c),o)+e.vx,e.vx-=Math.sign(e.vx)*Math.min(Math.abs(e.vx),.02);const s=l-n;e.y+=Math.sign(s)*Math.min(Math.abs(s),o)},Je=e=>ze(e)[0],ze=e=>{const t=[],n=e.slice();for(;n.length;)t.push(n.splice(~~(Math.random()*n.length),1)[0]);return t},Ne=e=>{he.forEach((e=>e.nw=0));const t=he.findIndex((e=>""==e.n));t<0?(he.push({...e,nw:1}),n()):(he[t]={...e,nw:1},je(),Ae())},Ke=e=>F?e:Array(e.length).fill("?").join(""),Qe=(e,t,n,i,l,o,c)=>{e.beginPath(),e.fillStyle=o,e.rect(32*(t-i/2),32*(n-l/2),32*i,32*l),e.fill(),c&&(e.strokeStyle=c,e.stroke())},Ve=(e,t,n)=>{e.width=32*n[0].length,e.height=32*n.length,n.forEach(((e,i)=>e.split("").forEach(((l,o)=>{"1"==l&&(t.fillStyle="#831",t.fillRect(32*o,32*i,32,32),i>1&&"1"!=n[i-1][o]&&(t.fillStyle="#454",t.fillRect(32*o,32*i,32,8))),("w"==l||"w"!=l&&"w"==e[o-1]&&"w"==e[o+1])&&(t.fillStyle="#0B0",t.fillRect(32*o,32*i+6,32,26))}))))},Ze=["Long time no see!","How is it going?","Don't overwork yourself","Good day","I used to be an adventurer like you","Got some'in interesting to sell?","Take care of yourself to go further"],Ue=["Spending time with friends help you recover","Potions cannot no longer heal you","You can sell treasure to the trader to get score","You can visit the Witch Doctor to recover health","You can hold Jump to jump higher","You can hold the down button to use your shield","You can double tap forward to sprint with your shoes"].map((e=>"Tips: "+e)),Xe=ze([...Ze,...Ze,...Ue]),et={u:0,d:0,l:0,r:0,a:0,c1:0,c2:0},tt=e=>{const t=e.keyCode,i=e.type,l={87:"u",90:"u",38:"u",83:"d",40:"d",65:"l",81:"l",37:"l",68:"r",39:"r",74:"a",75:"a",48:"c1",32:"s",8:"b"};l[t]&&(et[l[t]]=+(i[3]<"u"),et.c1&&"c1"==l[t]&&(C=!C,qe(),et.c1=0),et.s&&"s"==l[t]&&(xe||n(),et.s=0),e.preventDefault(),e.stopPropagation())};window.addEventListener("keydown",tt),window.addEventListener("keyup",tt),Ve(w,u,x),Ve(m,g,v),Ee("h"),je(),Ae(),window.prioritize=e=>{const t=he.splice(e,1)[0];he.push(t),Ae()},window.trade=(e,t)=>{pe=e;const n=he[t];if(console.log("trade",e,n),"s"==e){if(!n.c)return;const e=he[t];S.findIndex((t=>t.n==e.n))<30&&ye.push(e),de=[e],be+=e.c+("treasure"!=e.n?0:~~(Math.random()*e.c*.5)),he.splice(t,1,{n:"",i:"",rq:1})}if("d"==e){if(be<we)return;he.push({n:"",i:"",rq:1,nw:1}),fe=he.length,be-=we,we=~~(1.5*we)}je(),Ae()},setInterval((()=>{if(xe)return;if(Z++,i.width^=0,U.vy+=X,U.vy>0&&(X=.018),U.vy>.2&&(U.vy=.2),U.vx-=Math.sign(U.vx)*Math.min(Math.abs(U.vx),.02),U.y=Ce(U,U.vy,N,(()=>{U.vy>0&&(U.gd=Z+5,U.vy=0,X=.012),U.vy<0&&(U.vy=0)})).y,0!=J)et.l=0,et.r=0,et.u=0,et.d=0;else{const e=et.l?-1:et.r?1:0,t=!P&&he.some((e=>"armor"==e.n)),n=re||!R||t;_&&!te&&e&&(0==ne?ne=Z+30:ne>Z&&(ie=1,ne=0),te=1),ne>0&&ne<=Z&&(ne=0),te&&!e&&(te=0,ie=0),U.fc=e||U.fc,!n&&ie&&U.gd>Z&&Z%8==0&&Pe({x:U.x+U.w/2,y:U.y+U.h-.3,w:.4,h:.4,fc:1,type:""},"#aaa",.5),We(U,e*(n?.05:ie?.2:.1)+U.vx,N,(()=>{O&&(U.vy=-.07)})),et.u&&U.vy>=0&&U.gd>=Z&&ee&&(U.vy=E?-.315:-.25,X=.012,ee=0),et.u||(ee=1,U.vy<0&&(U.vy<-.15&&(U.vy=-.15),X=.018)),et.a&&B&&!re&&Z>=le&&(oe=Z+15,le=Z+50),le>Z+20&&!et.a&&(le=Z+20),et.a&&Y&&!re&&Z>=ce&&(Ye("pink","m",U),se=Z+15,ce=Z+50),ce>Z+20&&!et.a&&(ce=Z+20),et.d&&W&&oe<Z&&se<Z&&(re=1),!et.d&&re&&(re=0);const i=V.filter((e=>"n"==e.type&&e.npc.i>-1)),l=i.map((e=>({...e,dist:Oe(_e(e,U))}))).reduce(((e,t)=>!e||t.dist<e.dist?t:e),null);if(l&&l.dist<1){const{npc:e}=l,t=e.i;pe=e.t,i.forEach((({npc:e})=>e.i=0)),e.i=0==t?Z+("t"==e.t||"d"==e.t?0:300):t}else i.forEach((({npc:e})=>e.i=0)),pe="_";i.forEach((e=>{const{npc:t}=e;if(e.fc=U.x>e.x?1:-1,"t"!=t.t&&"d"!=t.t&&t.i>0&&t.i<Z){console.log("npc action",t),he.forEach((e=>e.nw=0));const e=he.findIndex((e=>"flower"==e.n));if(console.log("flowerIndex",e),t.lv<1&&e>-1){const n=he[e];he.splice(e,1,{n:"",i:"",rq:1}),de=[n],t.lv+=.2}t.lv+=.2,t.i=(e=>ye.length?Math.random()>.8*Math.min(1,e.lv)?0:(Ne(ye.splice(~~(Math.random()*ye.length),1)[0]),1):0)(t)?-2:-1,je(),Ae()}}));for(let e=0;e<V.length;e++){const t=V[e],{type:n,x:i,y:l,w:o,h:c}=t,s=Be(oe),r=oe>Z&&s[0]<i+o&&s[0]+s[2]>i&&s[1]<l+c&&s[1]+s[3]>l;if("M"==n){const n=()=>{Pe(t,t.m.c,1),V.splice(e,1),e--};i+o+t.vx>K?n():(We(t,t.vx,N,n),Ce(t,t.vy,N,n))}if("E"==n){const e=1,n=t.enemy,o=_e(t,U),c=Oe(o);n.tg=+(c<6),n.tg&&n.ai-Z>50&&(n.ai=Z+50),Z>=n.ai&&([...n.b].forEach((s=>{"w"==s&&(n.tg?(n.dx=U.x+2*Math.sign(o[0]),n.dy=l):(n.dx=i+Math.random()*e*2-e,n.dy=l)),"f"==s&&(n.tg?(n.dx=U.x+o[0]/c*2,n.dy=U.y+o[1]/c*2-.5):(n.dx=i+Math.random()*e*2-e,n.dy=l+Math.random()*e*2-e)),"m"==s&&(n.b.includes("w")?o[0]<3&&(n.dx=U.x,t.gd&&(t.vy=n.b.includes("l")?-.25:-.1,t.gd=0)):c<4&&(n.dx=U.x,n.dy=U.y)),"s"==s&&c<4&&Ye("#007","s",t,U)})),t.enemy.ai=Z+(t.enemy.tg?~~(40*Math.random()+40):~~(320*Math.random()+80)))}if("E"==n){const{b:n,dx:s,sp:a,tg:h}=t.enemy,d=V.findIndex((e=>"M"==e.type&&"m"==e.m.s&&e.x<i+o&&e.x+e.w>i&&e.y<l+c&&e.y+e.h>l));if((d>-1||r)&&t.inv<Z&&(t.enemy.hp-=1,t.inv=Z+40,Pe({...t,w:o/2},"#b3e",1,0),Fe(U,t),d>-1&&(V.splice(d,1),d<e&&e--),t.enemy.hp<=0)){he.forEach((e=>e.nw=0)),be+=5*t.enemy.d,Ae(),Pe(t,"#b3e",2,0),Pe(t,"#888",2.5),V.splice(e,1),e--;continue}if(n.includes("f")&&Ge(t),n.includes("w")){t.fc=s==i?t.fc:Math.sign(s-i),t.gd&&"1"==N[~~l][~~(i+o/2+t.fc*o)]&&(t.vy=-.18,t.gd=0);const e=Math.sign(s-i)*Math.min(Math.abs(s-i),a)+t.vx;t.vx-=Math.sign(t.vx)*Math.min(Math.abs(t.vx),.02),We(t,e,N),t.vy+=.012,t.gd=0,Ce(t,t.vy,N,(()=>{t.vy>0&&(t.gd=1),t.vy=0}))}h&&(t.fc=U.x>i?1:-1)}if("F"==n&&t.eff.hp--<0)V.splice(e,1),e--;else if("3"==n&&r)Pe(t,"#A02",3),Pe(t,"red",2.2,0),V.splice(e,1),e--;else if(U.x<i+o&&U.x+U.w>i&&U.y<l+c&&U.y+U.h>l){if("D"==n&&Ee("h"==G?"d":"h"),U.inv<Z){if("3"==n){const n=U.fc>0&&U.x<i||U.fc<0&&U.x>i;re&&n||(Ie(),V.splice(e,1),e--),Fe(t,U)}if("M"==n&&"s"==t.m.s){const n=U.fc>0&&U.x<i||U.fc<0&&U.x>i;re&&n||(Ie(),Fe(t,U)),Pe(t,t.m.c,1),V.splice(e,1),e--}if("E"==n){const{b:e,dx:n,sp:l,tg:o}=t.enemy,c=U.fc>0&&U.x<i||U.fc<0&&U.x>i;e.includes("m")&&(re&&c?Fe(U,t):(Ie(),Fe(t,U)))}}if("T"==n){const{item:t}=V[e];Ne(t),V.splice(e,1),e--}}}}const e=C?10.75:7,t=C?7.5:5;if(ke=Math.max(0,Math.min(U.x-e,K-e-e-1)),Te=Math.max(0,Math.min(U.y-t,Q-t-t)),p.drawImage("d"==G?w:m,32*ke,32*Te,i.width,i.height,0,0,i.width,i.height),V.forEach((e=>{const{type:t,x:n,y:i,w:l,h:o,fc:c}=e;if("D"==t&&(p.fillStyle="brown",p.fillRect(32*(n-ke),32*(i-Te),32*l,32*o),p.fillStyle="black",p.fillRect(32*(n-ke)+4,32*(i-Te)+6,32*l-8,32*o-8)),"n"==t){const{i:t,n:s,t:r,lv:a,c:h}=e.npc,d=n+l/2-ke,f=i+o/2-Te,y="t"==r||"d"==r?"Press <Space> to trade":Ke(Xe[((e,t)=>[...e].reduce(((e,t)=>e+t.charCodeAt(0)),0)+t)(s,ge)%Xe.length]),w=he.some((e=>"flower"==e.n));p.fillStyle="#ffe",p.fillStyle="gold",p.fillRect(32*(n+.25*l-ke),32*(i-Te),.2*l*32,32*o),p.fillRect(32*(n+.55*l-ke),32*(i-Te),.2*l*32,32*o),Qe(p,d-.2*c,f+.09,.3*l,.1*o,"gold"),Qe(p,d+.2*c,f+.09,.3*l,.1*o,"gold"),Qe(p,d,f,.52*l,.65*o,h),p.fillStyle="gold",p.fillRect(32*(n-ke),32*(i-Te),32*l,o/2*32),Qe(p,d+.15*c,f-.3,.07*l,.2*o,"black"),Qe(p,d+.05*c,f-.3,.07*l,.2*o,"black"),p.fillStyle="#000",p.textAlign="center",("_"==pe||t>0)&&p.fillText(t>0?y:t<-1?Ke("Here, take this with you."):s,32*d,32*(i-.7-Te)),(t<=0||a<1||~~(Z/30)%2)&&p.fillText("t"==r||"d"==r?"":[...Array(Math.min(5,~~(5*a)+(t>0?~~(Z/30)%2*(w?2:1):0)))].fill("‚ù§Ô∏è").join(""),32*d,32*(i-.3-Te))}if("3"==t&&(p.fillStyle="red",p.fillRect(32*(n-ke),32*(i-Te),32*l,32*o)),"F"==t){const t=n+l/2-ke,s=i+o/2-Te,r=l*e.eff.hp/30,a=l*e.eff.s*(1-e.eff.hp/30);Qe(p,t-a,s-a*c,r,r,e.eff.c,!1),Qe(p,t-a*c,s+a,r,r,e.eff.c,!1),Qe(p,t+a*c,s-a,r,r,e.eff.c,!1),Qe(p,t+a,s+a*c,r,r,e.eff.c,!1)}if("M"==t&&(p.save(),p.translate(32*(n+l/2-ke),32*(i+o/2-Te)),"s"==e.m.s&&p.rotate(Math.atan2(e.vy,e.vx)),p.fillStyle=e.m.c,p.fillRect(-l/2*32,-o/2*32,32*l,32*o),p.restore()),"E"==t){const{n:t,d:s,hp:r,sp:a,b:h,dx:d,dy:f,tg:y}=e.enemy,w=n+l/2-ke,u=i+o/2-Te;let m;if(e.inv<Z||~~(Z/4)%2==0)switch(t){case"Rat":Qe(p,w,u,l,o,"gray",!1),Qe(p,w+c*l/2,u-.5*o,l/4*3,o/2,"gray",!1),Qe(p,w+c*l*.3,u-.8*o,l/4,.4*o,"gray",!1),Qe(p,w-c*l,u+.35*o,l,o/4,"brown",!1);break;case"Bat":Qe(p,w-.1,u-.2*o,.15*l,.6*o,"#222",!1),Qe(p,w+.1,u-.2*o,.15*l,.6*o,"#222",!1),Qe(p,w,u+.1*o,.7*l,.7*o,"navy",!1),p.fillStyle="navy",m=Math.ceil(Z/10)%2==0?1:0,p.fillRect(32*(w-.7*l/2-.7*l),32*(u-.8*o*m),.7*l*32,o*(.4+.4*m)*32),p.fillRect(32*(w+.7*l/2),32*(u-.8*o*m),.7*l*32,o*(.4+.4*m)*32),Qe(p,w-.1,u+.3*o,.1*l,.2*o,"#fff",!1),Qe(p,w+.1,u+.3*o,.1*l,.2*o,"#fff",!1);break;case"Bee":Qe(p,w+.4*l*c,u-.1*o,.5*l,.1*o,"#222",!1),Qe(p,w-l/2*c,u+.2,.5*l,.1*o,"#222",!1),Qe(p,w,u+.3*o,l,.7*o,"#eb3",!1),m=Math.ceil(Z/4)%2==0?1:0,Qe(p,w-.1,u+.3*o,.1*l,.7*o,"#222",!1),Qe(p,w+.1,u+.3*o,.1*l,.7*o,"#222",!1),Qe(p,w,u-(.1+.2*m)/2,.5*l,o*(.2+.4*m),"#ccc")}p.fillStyle="black",p.textAlign="center",p.fillText(""+(y?"!!":""),32*w,32*(i-.2-Te-.3))}if("T"==t){const{item:t}=e,c="treasure"==t.n?`${t.c}pts?`:t.n;p.fillStyle="orange",p.strokeStyle="black 2px solid",p.fillRect(32*(n-ke),32*(i-Te),32*l,32*o-1),p.strokeRect(32*(n-ke),32*(i-Te),32*l,32*o-1),p.strokeRect(32*(n-ke),32*(i-Te),32*l,o/3*32),p.fillStyle="black",p.textAlign="center",p.fillText(Ke(c),32*(n+l/2-ke),32*(i-.2-Te))}})),U.inv<Z||~~(Z/4)%2==0){const{x:e,y:t,w:n,h:i,gd:l,fc:o}=U,c=e+n/2-ke,s=t+i/2-Te,r=et.l||et.r,a=~~(Z/10)%2==0;Qe(p,c+.095*o,s+.25,.2*n,i*(l<Z||r&&!a?.35:.5),"gold"),Qe(p,c-.095*o,s+.25,.2*n,i*(l<Z?.5:r&&a?.35:.5),"gold"),Qe(p,c-.2*o,s+.02,.3*n,.1*i,"gold"),oe<Z&&se<Z&&!re&&Qe(p,c+.2*o,s+.02,.3*n,.1*i,"gold"),Qe(p,c,s,.52*n,.65*i,he.some((e=>"armor"==e.n))?"gray":"gold"),Qe(p,c,s-.3,.9*n,.5*i,"gold"),Qe(p,c+.15*o,s-.3,.07*n,.2*i,"black"),Qe(p,c+.05*o,s-.3,.07*n,.2*i,"black")}if(re&&(p.fillStyle="brown",p.fillRect(32*(U.x-ke+(U.fc+1)/2*U.w-.1),32*(U.y-Te+.2),6.4,19.2)),se>Z){p.fillStyle="brown";const e=Be(Z+12);p.fillRect(32*(e[0]-ke),32*(e[1]-Te),32*e[2],32*e[3])}if(oe>Z){p.fillStyle="silver";const e=Be(oe);p.fillRect(32*(e[0]-ke),32*(e[1]-Te),32*e[2],32*e[3])}"h"==G&&Me<2&&(p.textAlign="left",p.fillStyle="black",p.fillText("‚Üê Your Inventory Space is also your HP.",32*(3-ke),32*(4-Te)),p.fillText("     The right most item is lost if you take damage.",32*(3-ke),32*(4.5-Te)),p.fillText("Press J or K to attack",32*(17-ke),32*(10-Te)),p.fillText("Press ‚Üì to shield (if equipped)",32*(27-ke),32*(10-Te)),p.fillText("Go through the cave to enter dungeon ‚Üí",32*(39-ke),32*(11-Te)),p.fillText("Press <Space> to rearrange your life priorities",32*(35-ke),32*(8-Te)),p.textAlign="center",p.fillText("By vicksonzero",32*(7.5-ke),32*(8.5-Te)),p.fillText(`High Score: ${Se}`,32*(7.5-ke),32*(9.5-Te)),p.fillText(`Press ${["WASD","ZQSD","‚Üë‚Üê‚Üì‚Üí"][~~(Z/150)%3]} to move and jump`,32*(7.5-ke),32*(11-Te)),p.font=p.font.replace(/\d+px/,"48px"),p.fillText("Rogue-Hoarder",32*(7.5-ke),32*(8-Te)),p.font=p.font.replace(/\d+px/,"12px")),z?(J<-300&&(J+=8),p.fillStyle=`rgba(0,0,0,${(1+J/1e3).toFixed(1)})`,p.fillRect(0,0,i.width,i.height)):J>0&&(p.fillStyle=`rgba(0,0,0,${(J/1e3).toFixed(1)})`,p.fillRect(0,0,i.width,i.height),p.fillStyle="white",p.textAlign="center",p.font="32px Arial",p.fillText("h"==G?"Village":"Dungeon",i.width/2,i.height/2),p.font="16px Arial",p.fillText("h"==G?`Day ${Me}`:`Night ${Me}`,i.width/2,i.height/2+32),(J-=16)<=0&&(J=0))}),16)},function(e,t,n){}])</script>