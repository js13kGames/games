<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=no"><meta name=theme-color content=#000><style>:root{--a:linear-gradient(to top,#000428,#004e92);--b:#000;--c:#000000d6;--e:#4074b5;--i:#fff;--p-a:linear-gradient(to bottom,#f6e6b4 0%,#ed9017 100%);--p-b:#08143a;--s-c:#08457b;--tu:#062d53}*{margin:0;padding:0}body,html{overscroll-behavior-x:none;background:var(--b);font-family:Arial;overflow:hidden;position:fixed;-webkit-user-select:none;user-select:none;color:var(--i)}div{box-sizing:border-box}.df{display:flex}.df.a{align-items:center}.df.c{justify-content:center}.df.s{justify-content:space-around}.df.f{flex-direction:column}.wi{width:100%}.he{height:100%}.pr{position:relative}.pa{position:absolute}#root{height:var(--h);overflow:hidden;width:var(--w)}#render{background:var(--i);width:var(--w)}#ov{background:var(--c);font-size:8em;z-index:2}bo{overflow:hidden;cursor:pointer;width:var(--w);height:var(--w);background:#005695;-webkit-tap-highlight-color:transparent;background-image:linear-gradient(45deg,var(--s-c) 25%,transparent 26%,transparent 75%,var(--s-c) 75%,var(--s-c)),linear-gradient(45deg,var(--s-c) 25%,transparent 26%,transparent 75%,var(--s-c) 75%,var(--s-c));background-size:calc(var(--db) * 2) calc(var(--db) * 2);background-position:0 0,var(--db) var(--db)}bo.d{pointer-events:none}bo.o,bo.w{filter:brightness(.6)}bo.w:before{content:"‚è≥";background:var(--b);padding:10px;position:absolute;z-index:1;bottom:0}bo:active{cursor:grabbing}.it{font-size:2.7em;height:var(--db);pointer-events:none;transition:all .2s cubic-bezier(.86,-.02,.45,1.35);width:var(--db);opacity:1;box-shadow:none}.it.h{transform:scale(2.5)}.it.h::after{content:"üí•";height:100%;left:0;position:absolute;text-align:center;top:0;width:100%}.it.v{transform:none;transition:none}.extra{pointer-events:none;width:var(--db);height:var(--db);text-align:center;font-weight:700;font-size:17px;transform:scale(0);opacity:0;transition:all .3s ease-out;text-shadow:2px 2px 0 var(--e),2px -2px 0 var(--e),-2px 2px 0 var(--e),-2px -2px 0 var(--e),2px 0 0 var(--e),0 2px 0 var(--e),-2px 0 0 var(--e),0 -2px 0 var(--e)}.extra.s{opacity:1;transform:scale(1)}.extra.h{opacity:0;transform:scale(0)}.ba{background:var(--a)}top{height:calc(var(--h) - var(--w) - 20px)}.sc{top:20px}.scn{width:190px;height:65px;background:var(--tu);border-radius:10px;padding:10px}.scv{width:50%;border-radius:15px;font-size:23px;font-weight:700}.scv:not(:last-child){margin-right:10px}.sci{background:var(--tu);border-radius:10px;padding:8px}.scin{width:25px;height:25px;border-radius:50%;border:3px solid var(--i);font-size:13px;font-weight:700;opacity:.2}.scin.ac{background:#feae13;opacity:1}.tu{bottom:0;height:110px;background:linear-gradient(to top,#004e92,#000428)}.tu::after,.tu:before{content:"üßü‚Äç‚ôÇÔ∏è";position:absolute;font-size:105px;top:-120px;left:3%}.tu::after{content:"üßü‚Äç‚ôÄÔ∏è";right:3%;left:unset}.tun{margin:15px 0 5px}.tuna{text-align:center;width:100px;height:43px;border-radius:10px;border:3px solid var(--i)}.tup{padding:10px}.bp{height:25px;background:var(--p-b)}.bp::-moz-progress-bar{background:var(--p-a)}.bp::-webkit-progress-value{background:var(--p-a)}.bp::-webkit-progress-bar{background:var(--p-b)}#tupl{left:0;top:13px;text-align:center;text-shadow:1px 1px 1px var(--b)}.tuni{width:25px;height:25px;border:2px solid var(--i);border-radius:50%;margin:5px}.mB{cursor:pointer;font-size:16px;font-weight:600;border-radius:8px;padding:14px 24px;border:none;background:linear-gradient(to right,#e61e4d 0,#e31c5f 50%,#d70466);color:var(--i)}.lg{padding:20px}.lg h1{font-size:50px;font-weight:700;margin:20px;text-shadow:0 -1px 4px var(--i),0 -2px 10px #ff0,0 -10px 20px #ff8000,0 -18px 40px red;width:50%;text-align:center}.mBs{width:60%}.mBs .mB{margin-bottom:15px;height:55px}#back,#bso{cursor:pointer;position:absolute;left:15px;top:15px;font-size:2em;z-index:1;background:0 0;border:none}#bso{left:unset;right:15px}#msb{padding:10px;background:var(--c);font-size:2em;z-index:2;bottom:200px;pointer-events:none;display:none;text-align:center}#msb.sh{display:block}modal{top:0;left:0;z-index:100}modal.hide{pointer-events:none;visibility:hidden}modal.show{visibility:visible}.ms,.mw{left:0;position:absolute;top:0}.ms{background:var(--c)}.mw{z-index:1}.mc{border-radius:5px;overflow:hidden;width:71%;background:var(--i);overflow:hidden}.txt{color:#8f9cb5;padding:20px;flex-direction:column}.mb button{width:100%;border:none;height:50px;background:#fc7169;cursor:pointer;color:var(--i);font-weight:700}.mb button:nth-child(2){background:#b6bece}.wnuse{position:absolute;top:0}#nuse{margin:30px;width:40%}fieldset{border-radius:10px;border:3px solid var(--i);padding:20px;margin:30px 0}fieldset form{display:flex}#code{border-radius:10px;border:none;font-size:30px;margin-right:10px;text-align:center;width:65%}.sop{width:80%}.sop span{font-size:8.5em}.sop h2{font-size:25px;margin:25px;font-weight:700}.ab{width:85%;margin:10px;text-align:center;font-size:20px}a{color:var(--i);font-weight:700}a:visited{color:var(--i)}.eg h2{font-size:50px}.eg span{font-size:5em;margin:25px}.egp{border-radius:10px;border:3px solid var(--i);margin-bottom:70px;padding:10px;width:80%}.egu{text-align:center}.egn{font-size:20px}.egu{font-size:50px;font-weight:700}#sh{margin-bottom:20px}</style><link rel=icon type=image/png href=icon.png><link rel=manifest href=m.json><title>Death Match</title><body class="df a c wi he"><div id=root class=pr></div><script src=/socket.io.js></script><script src=shared.js></script><script>let zzfx,zzfxV,zzfxX,zzfxR;zzfxV=.3,zzfx=(e=1,t=.05,o=220,n=0,i=0,s=.1,a=0,r=1,l=0,c=0,d=0,f=0,h=0,v=0,p=0,m=0,u=0,b=1,g=0,w=0)=>{let $,x,y=2*Math.PI,z=l*=500*y/zzfxR**2,E=(0<p?1:-1)*y/4,I=o*=(1+2*t*Math.random()-t)*y/zzfxR,R=[],k=0,S=0,T=0,M=1,L=0,H=0,O=0;for(c*=500*y/zzfxR**3,p*=y/zzfxR,d*=y/zzfxR,f*=zzfxR,h=zzfxR*h|0,x=(n=99+zzfxR*n)+(g*=zzfxR)+(i*=zzfxR)+(s*=zzfxR)+(u*=zzfxR)|0;T<x;R[T++]=O)++H%(100*m|0)||(O=a?1<a?2<a?3<a?Math.sin((k%y)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/y%2+2)%2:1-4*Math.abs(Math.round(k/y)-k/y):Math.sin(k),O=(h?1-w+w*Math.sin(2*Math.PI*T/h):1)*(0<O?1:-1)*Math.abs(O)**r*e*zzfxV*(T<n?T/n:T<n+g?1-(T-n)/g*(1-b):T<n+g+i?b:T<x-u?(x-T-u)/s*b:0),O=u?O/2+(u>T?0:(T<x-u?1:(x-T)/u)*R[T-u|0]/2):O),k+=($=(o+=l+=c)*Math.sin(S*p-E))-$*v*(1-1e9*(Math.sin(T)+1)%2),S+=$-$*v*(1-1e9*(Math.sin(T)**2+1)%2),M&&++M>f&&(o+=d,I+=d,M=0),!h||++L%h||(o=I,l=z,M=M||1);return(e=zzfxX.createBuffer(1,x,zzfxR)).getChannelData(0).set(R),(o=zzfxX.createBufferSource()).buffer=e,o.connect(zzfxX.destination),o.start(),o},zzfxX=new(window.AudioContext||webkitAudioContext),zzfxR=44100,(()=>{const e="DM",t={b:"#1e90ff",r:"#e91e63"},o={b:[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6],c:[,.1,75,.03,.08,.17,1,1.88,7.83,,,,,.4],t:[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],l:[,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],w:[,,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14]},n=document.querySelector.bind(document),i=document.querySelectorAll.bind(document);n("html").style.cssText+=`--h: ${HEIGHT}px; --w: ${WIDTH}px; --db: ${CELL}px`;const s=(e,t)=>{e&&(e.innerHTML=t)},a=e=>Object.keys(e),r=e=>new Promise((t=>setTimeout(t,e))),l=e=>JSON.parse(JSON.stringify(e));let c,d=!1;const f=e=>/^\d+$/.test(e)&&5===e.length,h=()=>localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):{},v=(t,o)=>{const n=h();var i;n[t]=o,i=n,localStorage.setItem(e,JSON.stringify(i))},p=(e="",t)=>h()[e]||t,m=()=>[...["name","token"].map((e=>p(e,"")))],u=(e,t)=>{var o;return{cls:()=>clearTimeout(o),fn:()=>{clearTimeout(o),o=setTimeout(e,t)}}},b=(e,t,o,n={})=>{e&&e.addEventListener(t,o,n)},g=(e,t)=>{if(e)for(let o in t)e.style[o]=t[o]},w=(e,t)=>{if(e)for(let o of t.split(" "))return e.classList.contains(o)},$=(e,t,o="add")=>{e&&t.split(" ").forEach((t=>{e.classList[o](t)}))},x=e=>a(e).length?`style='${a(e).map((t=>`${t}:${e[t]}`)).join(";")}'`:"",y=(e=[])=>{const t=[];for(let o=0;o<e.length;o++){let n=!1;for(let i=0;i<t.length;i++){let s=0;for(let n=0;n<t[i].length;n++)s+=+(t[i][n]===e[o][n]);if(s===e[o].length){n=!0;break}}n||t.push(e[o])}return t};let z="yes"===p("sound","yes");const E=(e="")=>z&&zzfx(...o[e]),I=(e,t)=>{const{base:o=100,inc:n=-1,int:i=250}=t||{};let s,a=o;const r=()=>{s&&(clearInterval(s),s=null)},l=()=>{r(),s=setInterval((()=>{a+=n,a<=0&&r(),e(a,s)}),i)};return{tick:l,start:()=>{r(),a=o,l()},pause:r,change:e=>a=e}},R=(e=2,t)=>new Array(e).fill(null).map(((e,o)=>t(o,(e=>e)))).join(""),k={show({txt:e,icon:t="",yes:o="OK",no:i="NO",cb:s,timer:a=0}){n(".txt").innerHTML=(t?`<p ${x({"font-size":"3rem"})}>${t}</p>`:"")+e,R(2,(e=>{g(n(`modal #btn${e+1}`),{display:(e?i:o)?"block":"none"}),n(`modal #btn${e+1}`).textContent=e?i:o})),this.change(),this.interval&&clearTimeout(this.interval),a&&(this.interval=setTimeout((()=>{this.hide()}),a)),this.callback=s},change(e=!0){$(n("modal"),"hide",e?"remove":"add"),$(n("modal"),"show",e?"add":"remove")},hide(){this.change(!1),this.interval&&clearTimeout(this.interval)},render:()=>`<modal class="hide wi he pa"><div class="ms wi he"></div><div class="df a c mw wi he"><div class=mc><div class="df a wi he txt"></div><div class="df mb wi he">${R(2,(e=>`<button id=btn${e+1}></button>`))}</div></div></div></modal>`,events(){i("modal button").forEach((e=>b(e,"click",(e=>{this.hide(),this.callback&&this.callback("btn1"===e.target.id)}))))}},S=({BOARD:e=newBoard(),typeGame:o=1,users:i={},room:a="",level:f=0,maxRounds:h=5})=>{const p=["üíÄ","üéÉ","üßõ‚Äç‚ôÇÔ∏è","üß†","üëπ","üß®","ü™ì","üöÄ","üí£"];let S=0;const T=i.users.findIndex((e=>e[1]===m()[1])),M=[T,T?0:1],L=["one","two"].map(((e,n)=>({[e]:{p:0,m:2,c:t[i.users[M[n]][2]],n:i.users[M[n]][0],t:i.users[M[n]][1],so:3===o&&i?.users?.[M?.[n]]?.[3]||""}}))).reduce(((e,t)=>({...e,...t})),{});let H=0,O=i.turn===L.one.t?"one":"two";const A=O;let C=I(((e,t)=>{n("bo")?e>10?(H=e,n("progress").value=e):3===o?(Y(!0,!0),"one"===O&&c.emit("action",{room:a,type:"turn"})):P():clearInterval(t)}));const Z=()=>{for(let e=1;e<=2;e++)for(let t=0;t<2;t++){const{m:o,c:i}=L[1===e?"one":"two"];g(n(`#mov-${e}-${t}`),{background:o>t?i:"none"})}},N=(e="",t=!1)=>{$(n("#msb"),"sh",t?"add":"remove"),s(n("#msb"),e)},P=async(e=!1)=>{if(n("bo")&&C){if(O=e?O:"one"===O?"two":"one",Y(!0,!0),C?.pause(),n("progress").value=100,O===A&&(S++,S<=h)){for(let e=1;e<=h;e++)$(n(`#in-${e}`),"ac",e===S?"add":"remove");L.one.m=L.two.m=2,Z(),N(S<h?`Round ${S}`:"FINAL ROUND",!0),await r(1e3)}if(S<=h){E("t");const e=("one"===O?"Your":"Opponent's")+"  Turn";s(n("#tupl"),e),N(e,!0),await r(1e3),N();const t=1!==o&&"two"===O;Y(t,t),C?.start(),2===o&&"two"===O&&G()}else 3===o&&"one"===O&&c.emit("action",{room:a,type:"end"}),await r(500),ne("EndGame")}},{fn:G,cls:W}=u((()=>{if("one"===O||!n("bo")||!C)return;const t=isValidBoard(e).values,o=["three","dynamite","axe","rocket","four","bomb"],i=1===(2===f?rnd(0,1)?1:3:f)?[0,1,2,3,4,5]:H<=30?[5,3,2,1,4,0]:[4,5,3,2,1,0],s={};for(let e=0;e<i.length;e++)if(0!==t[o[i[e]]].length){s.type=o[i[e]],s.value=t[o[i[e]]];break}const a=rnd(0,s.value.length-1);if(["three","four"].includes(s.type)){const t=rnd(0,s.value[a].length-1),o="three"===s.type?[2,3]:[1,2],n=rnd(0,s.value[a][t][o[1]].length-1),i=s.value[a][t][o[0]],r=s.value[a][t][o[1]][n];_([e[i[0]][i[1]],e[r[0]][r[1]]])}["dynamite","axe","rocket","bomb"].includes(s.type)&&q(e[s.value[a].i][s.value[a].c])}),100*[25,15,7][f-1]),Y=(e=!1,t=!1)=>$(n("bo"),"d"+(t||w(n("bo"),"o")?" o":""),e||t?"add":"remove"),j=(e=[])=>{const t=(t=0,o=0,n=0,i=!0)=>{const s=[[t,o]];for(let a=0;a<2;a++){let r=1;for(;;){const l=r*(a?1:-1),c=i?t:t+l,d=i?o+l:o;if(!(d>=0&&d<SIZE&&c>=0&&c<SIZE&&e[c][d].v===n))break;s.push([c,d]),r++}}return s},o=(t=0,o=0,n=0)=>[[t,o],...[[[t+1,o],[t+1,o+1],[t,o+1]],[[t-1,o],[t-1,o+1],[t,o+1]],[[t-1,o],[t-1,o-1],[t,o-1]],[[t+1,o],[t+1,o-1],[t,o-1]]].find((t=>t.every((t=>e?.[t[0]]?.[t[1]]?.v===n))))||[]],n=[];for(let i=0;i<SIZE;i++)for(let s=0;s<SIZE;s++){const a=[i,s],r=t(i,s,e[i][s].v),l=t(i,s,e[i][s].v,!1),c=o(i,s,e[i][s].v),d=4===c.length,f=r.length>=4,h=l.length>=4,v=r.length>=3&&l.length>=3?9:f?7:h?8:d?6:0,p=y([...r.length>=3?r:[],...l.length>=3?l:[],...c.length>=3?c:[]]);n.push({itemsRemove:p,position:a,prize:v})}const i=n.map((e=>e.prize?e:[])).filter((e=>0!==e.length));let s=[];for(let e=0;e<i.length;e++){const t=i[e].itemsRemove;s.push([e]);for(let o=0;o<i.length;o++)if(o!==e){const e=i[o].position;0!==(t.find((t=>t[0]===e[0]&&t[1]===e[1]))||[]).length&&s[s.length-1].push(o)}}s=y(s.map((e=>e.sort())));const a=[];for(let e=0;e<s.length;e++)for(let t=0;t<s.length;t++)t!==e&&s[e].every((e=>s[t].includes(e)))&&a.push(e);s=s.filter(((e,t)=>!a.includes(t)));const r=[];for(let e=0;e<s.length;e++){const t=rnd(0,s[e].length-1),o=i[s[e][t]];r.push([o.position,o.prize])}return{itemsRemove:y(n.map((e=>e.itemsRemove)).flat().filter((e=>!(0!==(r?.find((t=>t?.[0]?.[0]===e[0]&&t?.[0]?.[1]===e[1]))||[]).length)))),prizes:r}},V=(e=[],t=[],o=[])=>{let n=[[e[0][0],e[0][1]]];if(6===e[1]){const o=[[-1,0],[-1,-1],[0,-1],[1,-1],[1,0],[-1,1],[0,1],[1,1]];for(let i=0;i<o.length;i++){const s=e[0][0]+o[i][0],a=e[0][1]+o[i][1];t?.[s]?.[a]&&n.push([s,a])}}if(7===e[1]||8===e[1]){const o=e[0][8===e[1]?1:0];for(let i=0;i<SIZE;i++){const s=7===e[1]?o:i,a=7===e[1]?i:o;t?.[s]?.[a]&&n.push([s,a])}}if(9===e[1]){const o=e[0][0]-2,i=e[0][1]-2;for(let e=o;e<o+5;e++)for(let o=i;o<i+5;o++)t?.[e]?.[o]&&n.push([e,o])}n=y(n);let i=[];for(let s=0;s<n.length;s++){const a=n[s],r=t[a[0]][a[1]].v;if(U(r)){const n=a[0]===e[0][0]&&a[1]===e[0][1];let s=!1;if(!n)for(let e=0;e<o.length;e++){const t=o[e][0];if(t[0]===a[0]&&t[1]===a[1]){s=!0;break}}n||s||i.push(V([a,r],t,[...o,e]))}}return n=y([...n,...i.flat()]),n},X=(e=[],t=!1)=>{for(let o=0;o<2;o++)g(n(`#t-${e[o].i}`),{left:`${e[t?o:+!o].l}px`,top:`${e[t?o:+!o].t}px`})},F=async(e=0,t=0)=>{const o=document.createElement("div"),i=`ex-${rnd(1,1e3)}`;o.innerHTML="EXTRA MOVE!",o.className="df a c pa extra";const s=[[-1,-1],[1,-1],[1,1],[-1,1]];for(let n=0;n<s.length;n++){const i=e+s[n][0],a=t+s[n][1];if(i>=0&&i<SIZE&&a>=0&&a<SIZE){o.style.left=Math.round(CELL*a)+"px",o.style.top=Math.round(CELL*i)+"px";break}}o.setAttribute("id",i),n("bo")&&(n("bo").appendChild(o),await r(10),$(n(`#${i}`),"s"),await r(1e3),$(n(`#${i}`),"h"),await r(500),n(`#${i}`)?.remove())},J=async(t=[],i=[],l=[],d=[],f={})=>{const h=3!==o||"one"===O;C?.pause();for(let e=0;e<l.length;e++)t[l[e][0][0]][l[e][0][1]].v=l[e][1],s(n(`#t-${t[l[e][0][0]][l[e][0][1]].i}`),p[l[e][1]-1]),U(l[e][1])&&0!==d.length&&(F(l[e][0][0],l[e][0][1]),L[O].m++,Z());const v=[];for(let e=0;e<i.length;e++){const{i:o=0}=t[i[e][0]][i[e][1]];v.push(o),$(n(`#t-${o}`),"h"),t[i[e][0]][i[e][1]].v=0}L[O].p+=i.length,s(n("#scv-"+("one"===O?1:2)),L[O].p),E("b");const u=h?newBoard(new Array(MAX).fill(null).map(((e,o)=>[o+1,eBoard(t,o+1).length])).sort(((e,t)=>t[1]-e[1])).slice(0,1).filter((e=>e[1]>=4)).map((e=>e?.[0]))):[];if(h)for(let e=0;e<SIZE;e++)for(let o=0;o<SIZE;o++)if(o+1<SIZE&&t[o][e].v&&!t?.[o+1]?.[e]?.v)for(let n=o;n>=0;n--)n+1<SIZE&&t?.[n]?.[e]?.v&&(t[n+1][e].v=t[n][e].v,t[n+1][e].i=t[n][e].i,t[n][e].v=0);const b=h?[]:f.spaces;if(h)for(let e=0;e<SIZE;e++){let o=0;for(let n=0;n<SIZE;n++)o+=+!t[n][e].v;b.push(o)}const x=h?[]:f.positionsItemsRemove;if(h){const e=[];let o=0;for(let n=0;n<SIZE;n++)for(let i=0;i<SIZE;i++)t[n][i].v||(t[n][i].v=u[n][i].v,t[n][i].i=v[o],e.push([n,i]),x.push({i:v[o],l:Math.round(CELL*i),t:Math.round(CELL*(b[i]-n)*-1)}),o++);if(!isValidBoard(t).isValid){const o=e[rnd(0,e.length-1)];t[o[0]][o[1]].v=rnd(7,9)}}3===o&&"one"===O&&c.emit("action",{room:a,itemsRemove:i,prizes:l,move:d,onlineMoves:{positionsItemsRemove:x,copyBoard:t,spaces:b},type:"move",player:L[O].t}),await r(100);for(let e=0;e<x.length;e++)$(n(`#t-${x[e].i}`),"v"),g(n(`#t-${x[e].i}`),{left:`${x[e].l}px`,top:`${x[e].t}px`});await r(100);for(let e=0;e<x.length;e++)$(n(`#t-${x[e].i}`),"h","remove");await r(100),h||(t=f.copyBoard);for(let e=0;e<SIZE;e++)for(let o=0;o<SIZE;o++)if(t[e][o].v){const i=n(`#t-${t[e][o].i}`);w(i,"v")&&($(i,"v","remove"),s(i,p[t[e][o].v-1])),w(i,"h")&&$(i,"h","remove"),g(i,{left:`${t[e][o].l}px`,top:`${t[e][o].t}px`})}if(e=t,3!==o){await r(200);const{itemsRemove:t=[],prizes:n=[]}=j(e);0!==t.length?J(e,t,n):0===L[O].m?(C?.pause(),P()):(C?.tick(),(1===o||o>1&&"one"===O)&&Y(),2===o&&"two"===O&&G())}else"two"===O?c.emit("action",{room:a,type:"ack",player:m()[1]}):(Y(!0,!0),$(n("bo"),"w"))},U=e=>[6,7,8,9].includes(e),q=(t={})=>{U(t?.v)&&(L[O].m--,Z(),J(e,V([[t.p.i,t.p.c],t.v],e)))},_=async(t=[])=>{Y(!0),X(t);const o=l(e),n=[];for(let e=0;e<2;e++){const i=t[e].p.i,s=t[e].p.c,a=t[+!e].v,r=t[+!e].i;o[i][s]={...o[i][s],v:a,i:r},U(a)&&n.push([[i,s],a])}await r(200);let{itemsRemove:i=[],prizes:s=[]}=j(o);if(0!==n.length){for(let e=0;e<n.length;e++)i=y([...i,...V(n[e],o)]);i=i.filter((e=>!(0!==(s?.find((t=>t?.[0]?.[0]===e[0]&&t?.[0]?.[1]===e[1]))||[]).length)))}0!==i.length?(L[O].m--,Z(),J(o,i,s,t)):(X(t,!0),Y())};s(n("#render"),`<div class="ba df f wi he"><div class="df a c wi pa" id=msb></div><div class="df a c wi he pa" id=ov></div><button id=back>‚¨ÖÔ∏è</button><button id=bso>${z?"üîà":"üîá"}</button><top class="wi pr"><div class="sc df a c f wi pa"><div class=scn><div class="df wi he">${R(2,(e=>`<div class="scv df a c" id=scv-${e+1} ${x({background:L[e?"two":"one"].c})}>0</div>`))}</div><div class="sci wi df a s">${R(h,(e=>`<div class="scin df a c" id=in-${e+1}>${e+1}</div>`))}</div></div></div>${(()=>{const e=(e="",t=1)=>`<div class="tuna df a c" id="na-${t}" ${x({background:L[1===t?"one":"two"].c})}>${e}</div>`;return`<div class="tu wi pa"><div class="tun df a s wi">${e(L.one.n)}<div class=df>${R(2,(e=>{return`<div class=df>${t=e+1,R(2,(e=>`<div class=tuni id=mov-${t}-${2===t?+!e:e} ${x({background:L[1===t?"one":"two"].c})}></div>`))}</div>`;var t}))}</div>${e(L.two.n,2)}</div><div class="tup pr wi"><progress class="bp wi pr" value="100" max="100"></progress><div class="wi pa" id="tupl"></div></div></div>`})()}</top><bo class=pr>${e.map((e=>e.map((e=>`<div class="it df a c pa" id="t-${e.i}" ${x({left:`${e.l}px`,top:`${e.t}px`})}>${p[e.v-1]}</div>`)).join(""))).join("")}</bo></div>`);const K=({x:t=0,y:o=0})=>{for(let n=0;n<SIZE;n++)for(let i=0;i<SIZE;i++){const{l:s,t:a}=e[n][i];if(t>=s&&t<=s+CELL&&o>=a&&o<=a+CELL)return e[n][i]}},Q=e=>{const{left:t,top:o}=e.target.getBoundingClientRect(),n=["touchstart","touchmove"].includes(e.type)?e.touches[0]||e.changedTouches[0]:e;return{x:Math.floor(n.pageX-t),y:Math.floor(n.pageY-o)}};let ee={};const te={start:e=>{(1===o||o>1&&"one"===O)&&(ee.start=Q(e))},move:t=>{if(ee.start&&!ee.end){const o=Q(t),n=K(ee.start),i=K(o),s=((e={x:0,y:0},t={x:0,y:0})=>{const o=180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI;return[["left",o<-170||o>170],["right",o>-10&&o<10],["bottom",o<-67.5&&o>-112.5],["top",o>67.5&&o<112.5]].filter((e=>e[1]))?.[0]?.[0]||""})(ee.start,o);if(n.i!==i?.i&&s){const t={left:[n.p.i,n.p.c+1],right:[n.p.i,n.p.c-1],bottom:[n.p.i+1,n.p.c],top:[n.p.i-1,n.p.c]}[s];e?.[t[0]]?.[t[1]]?(ee.end=o,_([n,e[t[0]][t[1]]])):(q(K(ee.start)),ee={})}}},end:()=>{ee?.start&&!ee?.end&&q(K(ee.start)),ee={}}};((e,t)=>{for(let o of t)e.addEventListener(o[0],o[1],!!o[0].includes("touch")&&{passive:!0})})(n("bo"),[[["mousedown","touchstart"],"start"],[["mousemove","touchmove"],"move"],[["mouseup","touchend","mouseleave"],"end"]].map((e=>e[0].map((t=>[t,te[e[1]]])))).flat()),E("c"),s(n("#ov"),3);const oe=I((e=>{s(n("#ov"),e),E("c"),0===e&&(n("#ov").remove(),P(!0))}),{base:3,int:1e3});oe.start();const ne=(e="Lobby")=>{3===o&&B(),W(),oe.pause(),C?.pause(),C=null,D(e,L)};b(n("#back"),"click",(()=>k.show({icon:"‚ö†Ô∏è",txt:"<p>Do you want to exit the game?</p>",cb(e){e&&ne()}}))),b(n("#bso"),"click",(()=>{z=!z,v("sound",z?"yes":"no"),s(n("#bso"),z?"üîà":"üîá")})),3===o&&d&&c&&C&&c.on("action",(async t=>{if("leave"===t.type)return k.show({icon:"üò¢",txt:`<h2 ${x({"margin-bottom":"10px"})}>Partner offline</h2>`,no:"",timer:3e3}),ne();if("turn"===t.type)return C?.pause(),P();if("next"===t.type)return C?.change(t.counterTimer),C?.tick();if(t.player!==m()[1]){if("move"===t.type){let o=l(e);if(0!==t.move.length){X(t.move);for(let e=0;e<2;e++){const n=t.move[e].p.i,i=t.move[e].p.c,s=t.move[+!e].v,a=t.move[+!e].i;o[n][i]={...o[n][i],v:s,i:a}}await r(200)}L[O].m--,Z(),J(o,t.itemsRemove,t.prizes,t.move,t.onlineMoves)}if("ack"===t.type){C?.tick(),$(n("bo"),"w","remove");const{itemsRemove:t,prizes:o}=j(e);0!==t.length?J(e,t,o):0===L[O].m?c.emit("action",{room:a,type:"turn"}):"one"===O&&(c.emit("action",{room:a,type:"next",counterTimer:H}),Y())}}}))},T=(e=[])=>`<div class="df a c f mBs">${e.map(((e,t)=>`<button id=el-${t} class="mB wi">${e}</button>`)).join("")}</div>`,M=e=>i(".mBs > button").forEach((t=>b(t,"click",(t=>e(+t.target.id.split("-")[1]))))),L=e=>{const t={tie:["IT'S A TIE!","üëª"],win:["YOU WIN!","üèÜ"],lose:["YOU LOST!","‚ò†Ô∏è"]},o=e.one.p,i=e.two.p,a=o===i?"tie":o>i?"win":"lose";E(o===i||o>i?"w":"l"),s(n("#render"),`<div class="ba df f a wi he"><div class="eg df a c f wi he"><div class="lg df a c f"><h1>DEATH MATCH</h1></div><h2>${t[a][0]}</h2><span>${t[a][1]}</span><div class="egp df a c">${R(2,(t=>`<div class="egu wi"><div class=egn>${e[t?"two":"one"].n}</div><div class=egu ${x({color:e[t?"two":"one"].c})}>${e[t?"two":"one"].p}</div></div>`))}</div><button class=mB id=cancel>HOME</button></div></div>`),b(n("#cancel"),"click",(()=>D()))},H=()=>{s(n("#render"),`<div class="ba df f a wi he"><div class="df a c f wi he"><button id=back>‚¨ÖÔ∏è</button><div class="lg df a c f"><h1>DEATH MATCH</h1></div>${T(["EASY","MEDIUM","HARD"])}</div></div>`),M((e=>{D("Game",{typeGame:2,level:e+1,users:setOrder([m(),["Bot","bot"]])})})),b(n("#back"),"click",(()=>D()))},O=()=>{s(n("#render"),`<div class="ba df f a wi he"><div class="df a c f wi he"><div class="wnuse wi df a c"><button class="mB pr" id=nuse>${m()[0]}</button></div><div class="lg df a c f"><h1>DEATH MATCH</h1></div>${T(["TWO PLAYERS","VS BOT","PLAY WITH FRIENDS","PLAY ONLINE"])}<p class=ab><a href=https://twitter.com/ostjh target=_blank rel="noopener noreferrer">Jorge Rubiano</a></p></div></div>`),b(n("#nuse"),"click",(()=>{const e=(t=prompt("Your name",m()[0]))?t.replace(/<\/?[^>]+(>|$)/g,""):"";var t;if(e){const t=e.length>10?e.substring(0,10)+"...":e;n("#nuse").textContent=t,v("name",t)}})),M((e=>{if(0===e)return D("Game",{users:setOrder([m(),["Guest","guest"]])});D(["Difficulty","PlayFriends","SearchOpponent"][e-1])}))},A=(e={})=>{s(n("#render"),`<div class="ba df f a wi he"><div class="df a c f wi he"><div class="lg df a c f"><h1>DEATH MATCH</h1></div>${e.createRoom?`<div ${x({width:"90%"})}><fieldset class="df a c f"><legend>Play with Friends</legend><code ${x({"font-size":"50px","font-weight":"bold","margin-bottom":"10px"})}>${e.friendRoom}</code><button id=sh class=mB>Copy Code</button></fieldset></div>`:'<div class="sop df a c f"><span>üßü</span><h2>FINDING OPPONENT...</h2></div>'}<button class=mB id=cancel>Cancel</button></div></div>`),b(n("#cancel"),"click",(()=>{D(),B()})),e.createRoom&&b(n("#sh"),"click",(()=>{((e="")=>{navigator.clipboard.writeText(e)})(`${location.href}?room=${e.friendRoom}`),k.show({icon:"üìã",txt:"<h2>Copied url</h2>",no:"",timer:3e3})})),Z(e)},C=()=>{s(n("#render"),`<div class="ba df f a wi he"><div class="df a c f wi he"><button id=back>‚¨ÖÔ∏è</button><div class="lg df a c f"><h1>DEATH MATCH</h1></div>${[{legend:"Room code",html:"<form><input type=tel id=code autocomplete=off maxlength=5><button type=submit class=mB>JOIN</button></form>"},{legend:"Private room",html:"<button class=mB>CREATE</button>"}].map(((e,t)=>`<div id=f-${t} ${x({width:"80%"})}><fieldset class="df a c"><legend>${e.legend}</legend>${e.html}</fieldset></div>${0===t?"<h2>OR</h2>":""}`)).join("")}</div></div>`),b(n("#back"),"click",(()=>D())),b(n("form"),"submit",(e=>{e.preventDefault();const t=n("#code").value;f(t)?D("SearchOpponent",{friendRoom:t,type:"friend"}):k.show({icon:"‚ö†Ô∏è",txt:"<h2>Invalid code (Max 5)</h2>",no:""})})),b(n("#f-1 button"),"click",(()=>D("SearchOpponent",{createRoom:!0,friendRoom:rnd(1e4,99999),type:"friend"})))},D=(e="Lobby",t={})=>{({Game:S,EndGame:L,Lobby:O,SearchOpponent:A,PlayFriends:C,Difficulty:H})[e](t)},B=()=>{d&&c&&(d=!1,c.disconnect())},Z=(e={})=>{c=io({path:location.pathname+"io",upgrade:!1,transports:["websocket"]}),d=!0;const t=(e="")=>k.show({icon:"‚ö†Ô∏è",txt:`<h2>${e}</h2>`,no:"",timer:4e3});c.on("connect",(()=>{const[o,n]=m();c.emit("nU",{...e,player:{name:o,token:n}},(e=>{e&&(t(e),B(),D())}))})),c.on("connect_error",(()=>{D(),B(),t("Server error!")})),c.on("sG",(e=>D("Game",e)))},{fn:N}=u((()=>g(n("#render"),{transform:window.innerWidth<WIDTH||window.innerHeight<HEIGHT?`scale(${Math.min(window.innerWidth/WIDTH,window.innerHeight/HEIGHT)}) translate(${window.innerWidth<WIDTH?Math.round((window.innerWidth-WIDTH)/2):0}px, 0)`:"none"})),50);a(h()).length||[["name",`Zombie ${rnd(100,1e3)}`],["token",guid()]].forEach((e=>v(e[0],e[1]))),s(n("#root"),`${k.render()}<div id=render class="df c wi he"></div>`),k.events(),b(document,"contextmenu",(e=>e.preventDefault())),b(window,"resize",N);const P={s:"Lobby",p:{}},G=((e="")=>new URLSearchParams(location.search).get(e))("room");G&&(f(G)&&(P.s="SearchOpponent",P.p={friendRoom:G,type:"friend"}),history.replaceState({},document.title,location.protocol+"//"+location.host+location.pathname)),D(P.s,P.p),N()})()</script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")</script>