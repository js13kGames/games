<!DOCTYPE html><head><title>Wendol Village - js13kGames 2024</title><meta name=viewport content=width=device-width,height=device-height,maximum-scale=1></head><body><script>let P=Math.PI;function K(t,i=0,e=1){return t<i?i:e<t?e:t}function W(t,i,e){return e-i?K((t-i)/(e-i)):0}function G(t=1,i=0){return i+Math.random()*(t-i)}function j(t,i=0){return Math.floor(G(t,i))}function f(t=0,i){return"number"==typeof t?new e(t,null==i?t:i):new e(t.x,t.y)}function a(t,i){return new e(t.x-i.x,t.y-i.y)}function B(t,i){return new e(t.x/i.x,t.y/i.y)}function U(t,i){return(t.x-i.x)**2+(t.y-i.y)**2}function V(t,i=1){var e=t.length();return i<e?t.scale(i/e):t}function Y(t=0,i=1){var e=f();return e.x=i*Math.sin(t),e.y=i*Math.cos(t),e}function J(t,i){return 0<=t.x&&0<=t.y&&t.x<i.x&&t.y<i.y}class e{constructor(t=0,i=0){this.x=t,this.y=i}U(){return new e(this.x,this.y)}add(t){return new e(this.x+t.x,this.y+t.y)}multiply(t){return new e(this.x*t.x,this.y*t.y)}scale(t){return new e(this.x*t,this.y*t)}length(){return(this.x**2+this.y**2)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new e(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(t);return t=Math.sin(t),new e(this.x*i-this.y*t,this.x*t+this.y*i)}direction(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new e(Math.floor(this.x),Math.floor(this.y))}}function k(t){return(255*K(t.r)|0)+(255*K(t.$)<<8)+(255*K(t.b)<<16)+(255*K(t.a)<<24)}class l{constructor(t=1,i=1,e=1,s=1){this.r=t,this.$=i,this.b=e,this.a=s}U(){return new l(this.r,this.$,this.b,this.a)}scale(t,i=t){return new l(this.r*t,this.$*t,this.b*t,this.a*i)}}function X(t){t.time=void 0}function n(t){return null!=t.time}function Z(t){return n(t)?W(t.time-H,t.h,0):0}class ${constructor(t){this.time=null==t?void 0:H+t,this.h=t}set(t=0){this.time=H+t,this.h=t}active(){return H<=this.time}get(){return n(this)?H-this.time:0}valueOf(){return this.get()}}let d=f(),v=32,q=f(1920,1200),Q=f(),_=f(12);class tt{constructor(t=f(),i=f(1),e,s=0,h,n=0){this.g=t.U(),this.size=i,this.m=e,this.angle=s,this.color=h,this.D=!1,this.H=n,Rt.push(this)}update(){}M(){x(this.g,this.size,this.m,this.color,this.angle,this.D)}B(){this.Z||(this.Z=1)}}let u,it,et,st,c=f(),ht=[];function g(t=f(),i=_,e=0){var s;return"number"==typeof i&&(i=f(i)),"number"==typeof t&&(t=f(t%(s=ht[e].size.x/i.x|0)*i.x,(t/s|0)*i.y)),new nt(t,i,e)}class nt{constructor(t=f(),i=_,e=0){this.g=t,this.size=i,this.h=e}offset(t){return new nt(this.g.add(t),this.size,this.h)}}class rt{constructor(t){this.size=f(t.width,t.height);var i=E.createTexture();E.bindTexture(3553,i),t&&E.texImage2D(3553,0,6408,6408,5121,t),E.texParameteri(3553,10241,9728),E.texParameteri(3553,10240,9728),this.ca=i,this.h=B(f(.1),this.size)}}function m(t){return new e((t.x-c.x/2+.5)/v+d.x,(t.y-c.y/2+.5)/-v+d.y)}function ot(t){return new e((t.x-d.x)*v+c.x/2-.5,(t.y-d.y)*-v+c.y/2-.5)}function x(t,i=f(1),e,s=new l,h=0,n){var r,o,a,d,u=new l(0,0,0,0),c=e&&ht[e.h];c?(r=e.g.x/c.size.x,o=e.g.y/c.size.y,a=e.size.x/c.size.x,e=e.size.y/c.size.y,d=c.h,(c=c.ca)!=pt&&(St(),E.bindTexture(3553,pt=c)),It(t.x,t.y,n?-i.x:i.x,i.y,h,r+d.x,o+d.y,r-d.x+a,o-d.y+e,k(s),k(u))):It(t.x,t.y,i.x,i.y,h,0,0,0,0,0,k(s))}function y(t,i,e){x(t,i,void 0,e,void 0,!1)}function at(t,i,e=1){{var l=ot(i).floor(),c=e*v|0,g=vi;let o=g.j,a=(o.save(),o.imageSmoothingEnabled=!1,g.i),d=a.add(g.m).scale(c),u=g.h.width/g.i.x|0;(t+"").split("\n").forEach((i,e)=>{var s=i.length*a.x*c/2|0;for(let t=i.length;t--;){var h=(n=((h=i[t].charCodeAt(0))<32||127<h?127:h)-32)%u,n=n/u|0,r=l.add(f(t,e).multiply(d));o.drawImage(g.h,h*a.x,n*a.y,a.x,a.y,r.x-s,r.y,a.x*c,a.y*c)}}),o.restore()}}class i{constructor(){this.h=mi,this.i=f(6),this.m=f(1),this.j=st}}let p=f(),dt=f(),w=[[]];function ut(t){var i;return u?(i=u.getBoundingClientRect(),f(u.width,u.height).multiply(f(W(t.x,i.left,i.right),W(t.y,i.top,i.bottom)))):f()}onmousedown=t=>{w[0][t.button]=3,dt=ut(t),t.button&&t.preventDefault()},onmouseup=t=>w[0][t.button]=2&w[0][t.button]|4,onmousemove=t=>dt=ut(t),oncontextmenu=()=>!1;let ct=void 0!==window.ontouchstart;if(ct){let e;onmousedown=onmouseup=()=>0,ontouchstart=ontouchmove=ontouchend=t=>{o&&"running"!=o.state&&r(0);var i=t.touches.length;return i?(dt=ut(f(t.touches[0].clientX,t.touches[0].clientY)),e||(w[0][0]=3)):e&&(w[0][0]=2&w[0][0]|4),e=i,document.hasFocus()&&t.preventDefault(),!0}}function t(t,i=1){t.i&&(t.source=ft(t.i,i,+t.h*G(-1,1)+1,void 0,!0,t.sampleRate))}class lt extends class{constructor(){this.h=0}stop(){this.source&&this.source.stop(),this.source=void 0}}{constructor(){var t=pi;super(),this.h=0,this.i=((e,s,h,t=125)=>{let n,r,o,a,f,d,u,l,c,g,v,x,m,p=0,y,w=[],E=[],b=[],T=0,M=0,H=1,I={},S=44100/t*60>>2;for(;H;T++)w=[H=l=x=0],h.forEach((t,i)=>{for(u=s[t][T]||[0,0,0],H|=s[t][T]&&1,y=x+(s[t][0].length-2-(l?0:1))*S,m=i==h.length-1,n=2,o=x;n<u.length+m;l=++n){for(f=u[n],c=n==u.length+m-1&&m||g!=(u[0]||0)||0|f,r=0;r<S&&l;r++>S-99&&c&&v<1&&(v+=1/99))d=(1-v)*w[p++]/2||0,E[o]=(E[o]||0)-d*M+d,b[o]=(b[o++]||0)+d*M+d;f&&(v=f%1,M=u[1]||0,f|=0)&&(w=I[[g=u[p=0]||0,f]]=I[[g,f]]||((a=[...e[g]])[2]*=2**((f-12)/12),0<f?vt(...a):[]))}x=y});return[E,b]})(...t),this.sampleRate=44100}}let o=new AudioContext,gt=!1;function ft(t,i=1,s=1,h=0,n=!1,r=44100){var e=gt;if(!(gt="running"!=o.state)||(o.resume(),!e)){let e=o.createBuffer(t.length,t[0].length,r);return r=o.createBufferSource(),t.forEach((t,i)=>e.getChannelData(i).set(t)),r.buffer=e,r.playbackRate.value=s,r.loop=n,(t=o.createGain()).gain.value=.5*i,t.connect(o.destination),r.connect(new StereoPannerNode(o,{pan:K(h,-1,1)})).connect(t),r.start(),r}}function r(...t){ft([vt(...t)])}function vt(t=1,i=.05,e=220,s=0,h=0,n=.1,r=0,o=1,a=0,f=0,d=0,u=0,l=0,c=0,g=0,v=0,x=0,m=1,p=0,y=0,w=0){var E=2*P,L=a*=500*E/44100/44100;i=e*=G(1+i,1-i)*E/44100;let b=[],T=0,j=0,M=0,H=1,W=0,U=0,I=0,S=E*Math.abs(w)*2/44100,A=Math.cos(S),O=Math.sin(S)/2/2,R=1+O,D=(S=-2*A/R,O=(1-O)/R,(1+Math.sign(w)*A)/2/R),B=-(Math.sign(w)+A)/R,C=0,z=0,N=0,F=0;for(f*=500*E/44100**3,g*=E/44100,d*=E/44100,u*=44100,l=44100*l|0,t*=.5,R=(s=44100*s+9)+(p*=44100)+(h*=44100)+(n*=44100)+(x*=44100)|0;M<R;b[M++]=I*t)++U%(100*v|0)||(I=r?1<r?2<r?3<r?Math.sin(T**3):K(Math.tan(T),1,-1):1-(2*T/E%2+2)%2:1-4*Math.abs(Math.round(T/E)-T/E):Math.sin(T),I=(l?1-y+y*Math.sin(E*M/l):1)*Math.sign(I)*Math.abs(I)**o*(M<s?M/s:M<s+p?1-(M-s)/p*(1-m):M<s+p+h?m:M<R-x?(R-M-x)/n*m:0),I=x?I/2+(x>M?0:(M<R-x?1:(R-M)/x)*b[M-x|0]/2/t):I,w&&(I=F=D*C+B*(C=z)+D*(z=I)-O*N-S*(N=F))),A=(e+=a+=f)*Math.cos(g*j++),T+=A+A*c*Math.sin(M**5),H&&++H>u&&(e+=d,i+=d,H=0),!l||++W%l||(e=i,a=L,H=H||1);return b}class mt{constructor(t,i=0){var e=new l;this.h=t,this.direction=i,this.color=e}}class xt extends tt{constructor(t=f()){var i=f(1);for(super(f(-.5),t,g(),0,void 0,0),this.h=document.createElement("canvas"),this.i=this.h.getContext("2d"),this.scale=i,this.data=[],t=Math.abs((t=this.size).x*t.y);t--;)this.data.push(new mt)}update(){}M(){var t=ot(this.g.add(f(0,this.size.y*this.scale.y)));it.drawImage(this.h,t.x,t.y,v*this.size.x*this.scale.x,v*this.size.y*this.scale.y)}}let s,E,yt,pt,wt,Et,T,Tt,M,Mt,Ht;function At(){E.viewport(0,0,s.width=u.width,s.height=u.height),E.clear(16384),E.useProgram(yt),E.activeTexture(33984),E.bindTexture(3553,pt=ht[0].ca);let o=Mt=Ht=0,t=(t,i,e,s)=>{t=E.getAttribLocation(yt,t);var h=e&&44,n=e&&1,r=1==e;E.enableVertexAttribArray(t),E.vertexAttribPointer(t,s,i,r,h,o),E.vertexAttribDivisor(t,n),o+=s*e};E.bindBuffer(34962,Et),t("g",5126,0,2),E.bindBuffer(34962,wt),E.bufferData(34962,44e4,35048),t("p",5126,4,4),t("u",5126,4,4),t("c",5121,1,4),t("a",5121,1,4),t("r",5126,4,1),t=B(f(2*v),c);var i=a(f(-1),d.multiply(t));E.uniformMatrix4fv(E.getUniformLocation(yt,"m"),!1,new Float32Array([t.x,0,0,0,0,t.y,0,0,1,1,1,1,i.x,i.y,0,0]))}function bt(t,i){return i=E.createShader(i),E.shaderSource(i,t),E.compileShader(i),i}function St(){var t;M&&(t=Ht?1:771,E.blendFuncSeparate(770,t,1,t),E.enable(3042),E.bufferSubData(34962,0,T),E.drawArraysInstanced(5,0,4,M),M=0,Ht=Mt)}function Ot(t=!1){var i=it;(M||t)&&(St(),t)&&i.drawImage(s,0,0)}function It(t,i,e,s,h,n,r,o,a,f,d=0){(1e4<=M||Ht!=Mt)&&St();var u=11*M;T[u++]=t,T[u++]=i,T[u++]=e,T[u++]=s,T[u++]=n,T[u++]=r,T[u++]=o,T[u++]=a,Tt[u++]=f,Tt[u++]=d,T[u]=h,M++}let Rt=[],Dt=0,H=0,zt=0,A=0;function Nt(){function r(t=0){var i,e=t-zt;for(zt=t,A=Math.min(A+=e,50),o(),t=0,A<0&&-9<A&&(t=A,A=0);0<=A;A-=1e3/60){H=Dt++/60,ct||document.hasFocus()||(w=[[]]),p=m(dt),a(),s=void 0;for(var s of Rt)s.Z||s.update();Rt=Rt.filter(t=>!t.Z),h=n=void 0;for(var h of w)for(var n in h)h[n]&=1}A+=t,c=f(u.width,u.height),it.imageSmoothingEnabled=!1,At(),Rt.sort((t,i)=>t.H-i.H);for(i of Rt)i.Z||i.M();d(),Ot(),requestAnimationFrame(r)}function o(){var t,i;Q.x?(u.width=Q.x,u.height=Q.y,t=innerWidth/innerHeight,i=u.width/u.height,(s||u).style.width=u.style.width=et.style.width=t<i?"100%":"",(s||u).style.height=u.style.height=et.style.height=t<i?"":"100%"):(u.width=Math.min(innerWidth,q.x),u.height=Math.min(innerHeight,q.y)),et.width=u.width,et.height=u.height,c=f(u.width,u.height)}var t,i=Ct,a=Ft,d=ki;document.body.style.cssText="margin:0;overflow:hidden;background:#5b6ee1;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none",document.body.appendChild(u=document.createElement("canvas")),it=u.getContext("2d"),s=document.createElement("canvas"),E=s.getContext("webgl2"),document.body.appendChild(s),t=E.createProgram(),E.attachShader(t,bt("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",35633)),E.attachShader(t,bt("#version 300 es\nprecision highp float;in vec2 v;in vec4 d,e;uniform sampler2D s;out vec4 c;void main(){c=texture(s,v)*d+e;}",35632)),E.linkProgram(t),yt=t,t=new ArrayBuffer(44e4),T=new Float32Array(t),Tt=new Uint32Array(t),wt=E.createBuffer(),Et=E.createBuffer(),t=new Float32Array([M=0,0,1,0,0,1,1,1]),E.bindBuffer(34962,Et),E.bufferData(34962,t,35044),document.body.appendChild(et=document.createElement("canvas")),st=et.getContext("2d"),(s||u).style.cssText=u.style.cssText=et.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",o();let e=new Image;e.onerror=e.onload=()=>{ht[0]=new rt(e),i(),r()},e.src="t.png"}function Ct(){vi=new i,new zi,Qt.push(new Yi(128,g(12),g(f(72,72),24),()=>{for(let t=0;t<b.length;t++){var i,e=b[t];e.selected&&(b.splice(b.indexOf(e),1),(i=new Bi(e.g)).v=e.v,b.push(i),e.B(),I=0)}}),new Yi(256,g(14),g(f(0,24),24),()=>{for(let t=0;t<b.length;t++){var i,e=b[t];e.selected&&(b.splice(b.indexOf(e),1),(i=new Gi(e.g)).v=e.v,b.push(i),e.B(),I=0)}}));var t=Math.min(128,Math.round(128*innerWidth/900));_t.push(new Pi(t,g(50),6,4,()=>{h("HOUSE IS LIVING SPACE"),I=Yt}),new Pi(2*t,g(f(24,96),f(24)),6,4,()=>{h("FARM IS FOR FOOD"),I=Jt}),new Pi(3*t,g(51),2,1,()=>{h("WALL IS FOR PROTECTION"),I=kt}),new Pi(4*t,g(f(0,96),f(24)),6,10,()=>{h("PUT WORKERS INTO\nBARRACKS TO TRAIN"),I=Vt})),ti.push(new Ki(()=>{ei-=5*b.length,b.push(new Ri(jt.add(f(G(-1,1),-1)))),li(.5<G()?"hi":"hello?")})),ii.push(new Vi(innerWidth-t,innerHeight-192,g(90),5,()=>{z-=5,ei+=10,r(.9,void 0,588,void 0,.03,.14,void 0,3.9,void 0,-1,650,.05,.04,void 0,void 0,void 0,.08,.84,.3),h("FOOD CREATED")}),new Vi(innerWidth-t,innerHeight-(192+t),g(91),8,()=>{z-=8;for(var t=0;t<b.length;t++){var i=b[t];i.o<i.G&&(se(i.g,_i),i.o=Math.min(i.G,i.o+2))}for(t=0;t<O.length;t++)(i=O[t]).o<i.G&&(se(i.g,_i),i.o=Math.min(i.G,i.o+2));r(void 0,void 0,244,void 0,.05,.32,void 0,1.7,-2,void 0,421,.09,.02,void 0,void 0,void 0,void 0,.8,.15),h("FRIENDS ARE HEALED")}),new Vi(innerWidth-t,innerHeight-(192+2*t),g(89),10,()=>{z-=10;for(let t=0;t<S.length;t++)se(S[t].g,qi),S[t].O(1);r(.7,void 0,530,.01,.14,.13,void 0,.3,-10,void 0,void 0,void 0,void 0,void 0,32,void 0,.03,.3,.1,void 0,346),h("ENEMIES ARE SICKENED")}),new Vi(innerWidth-t,innerHeight-(192+3*t),g(88),20,()=>{z-=20;for(let t=0;t<S.length;t++)se(S[t].g,Qi),S[t].O(S.length<2?4:2);r(2.8,void 0,48,void 0,.23,.73,4,1.9,void 0,-4,void 0,void 0,.21,.2,void 0,.5,.41,.36,.07,.29),h("ENEMIES ARE SMITED")})),ui=d=jt,v=Math.min(60,60*innerWidth/700),C=0,xi=new $(150)}function Ft(){if(fi==Ti&&S.length?(Ti.source.stop(),t(Mi,1),fi=Mi):fi!=Mi||S.length||(Mi.source.stop(),t(Ti,1),fi=Ti),I==Bt)w[0]&&1&w[0][0]&&(w=[[]],setTimeout(location.reload.bind(location),2));else if(I!=Ut)if(12<C&&!S.length)I=Ut,oi=2*v,ai=v/2,di=-v/100;else{var i,e;for(5<I?w[0]&&1&w[0][0]&&(w=[[]],Di(p)||(i=Math.round(p.x),e=Math.round(p.y),I==Vt?O.push(new Ni(f(i,e))):I==Jt?O.push(new Ci(f(i,e))):I==kt?(R-=2,--D,O.push(new bi(f(i,e),f(1),g(51)))):Lt(f(i,e))),I=0):(()=>{if(w[0]&&2&w[0][2]&&(I=0,b.forEach(t=>{t.selected=!1}),ui=p.U(),w=[[]]),w[0]&&2&w[0][0]){if(w=[[]],yi=!0,fi&&Ti.source||(t(Ti,.6),fi=Ti),h=m(f(innerWidth-Ji,innerHeight-Ji)),n=p.x-(h.x-1.5),h=p.y-(h.y-1.5),0<n&&n<=3&&0<h&&h<=3&&(ui=f(12*n,12*h),1))return;for(var i=0;I==Pt&&i<Qt.length;i++)if(Qt[i].S(p.x,p.y))return;for(i=0;I==Kt&&i<_t.length;i++)if(_t[i].S(p.x,p.y))return;for(i=0;I==Gt&&i<ti.length;i++)if(ti[i].S(p.x,p.y))return;for(i=0;i<ii.length;i++)if(ii[i].S(p.x,p.y))return;var e=!(i=[]);for(let t=0;t<b.length;t++){var s=b[t];s.selected&&i.push(s),e||(e=s.S(p.x,p.y))&&!s.selected&&(s.selected=!0,I=s.I?0:s.v&&s.v instanceof Ni?Pt:Kt)}if(e)return i.forEach(t=>{t.selected=!1});if(e=F[Math.max(0,Math.min(35,Math.round(p.y)))][Math.max(0,Math.min(35,Math.round(p.x)))])return e.J&&e.J(i);i.length||(N.N=p),i.forEach(t=>{L(t,"move",{g:p}),t.selected=!0,t.l=void 0})}var h,n;N.N&&(w[0]&&4&w[0][0]?(b.forEach(t=>{t.selected=t.g.x>Math.min(N.N.x,p.x)&&t.g.y>Math.min(N.N.y,p.y)&&t.g.x<Math.max(N.N.x,p.x)&&t.g.y<Math.max(N.N.y,p.y)}),delete N.N):(i=a(p,N.N),y(a(p,i.multiply(f(.5))),i,new l(1,1,1,.2))))})(),i=0;i<Zi.length;i++)(e=Zi[i]).object.g=e.object.g.add(V(a(e.target.g,e.origin),.1)),a(e.object.g,e.target.g).length()<.1&&(e.target.O(1),r(void 0,.03,405,void 0,void 0,0,3,.1,8,void 0,void 0,void 0,void 0,.1,27,.4,.04,.44,.01),e.object.B(),Zi.splice(Zi.indexOf(e),1));if(n(xi)&&H>xi.time){for(li("The"+(i=Xt[C]).C+" warrior, "+i.name+" approaches",2,1,1),e=0;e<i.A.length;e+=2){var s=g(94+8*j(0,4)),h=void 0;let t=9<C?4:3;0==e&&(s=g(i.R||6),h=f(i.ga||1.2),t+=12==C?12:Math.floor(C/2)),(s=new Ui(f(i.A[e],i.A[e+1]),h,s,t)).i=jt,S.push(s)}h=i.A[0],i=i.A[1],qt.g=f(20<h?33:h<5?2:18,20<i?33:i<5?2:18),C<12?xi.set(90):X(xi),C++}Wt(b),Wt(S),d!=ui&&((h=a(ui,d)).length()<.2&&(ui=d),d=d.add(V(h,h.length()/10)))}}function Lt(t){return(t=new bi(t,f(1),g(50))).ba=2,t.h=t.g.add(f(.3,.5)),R-=6,D-=4,O.push(t),t}function Wt(s){if(1<s.length){var h,n=Dt%s.length;for(let e=0;e<s.length;e++)if(e!=n){let t=s[n],i=s[e];e<n&&(h=t,t=i,i=h),(h=a(i.g,t.g)).length()<.8&&(t.v||(t.g=a(t.g,V(h,.002))),i.v||(i.g=i.g.add(V(h,.002))))}}}speechSynthesis.onvoiceschanged=function(){hi=speechSynthesis.getVoices()};{let i=new Image;i.onload=function(){var s=document.createElement("canvas");s.height=i.height;let t=s.getContext("2d");t.drawImage(i,0,0),s=t.getImageData(0,144,36,36).data,F=[];for(var h=0;h<36;h++){F[35-h]=[];for(let e=0;e<36;e++){let t=4*(36*h+e),i=0;0==s[3+t]||91==s[t]&&110==s[1+t]&&225==s[2+t]||34==s[t]&&32==s[1+t]&&52==s[2+t]?i="w":75==s[t]&&105==s[1+t]&&47==s[2+t]?i="t":155==s[t]&&173==s[1+t]&&183==s[2+t]&&(i="s"),F[35-h][e]=i}}h=t.getImageData(0,180,96,24),(s=document.createElement("canvas")).height=24,s.width=96,(t=s.getContext("2d")).putImageData(h,0,0),(mi=document.createElement("img")).src=s.toDataURL("image/png"),Nt()},i.src="t.png"}var jt=f(15),Bt=1,Ut=2,Gt=3,Pt=4,Kt=5,Vt=6,Yt=7,Jt=8,kt=9,Xt=[{C:"FIRST",name:"HALTAF THE YOUNG",R:102,from:"NORTHEAST",A:[32,32]},{C:"SECOND",name:"HYGLAK THE COMBATIVE",from:"EAST",A:[32,18,30,17]},{C:"THIRD",name:"HALGA THE WISE",R:118,from:"SOUTHEAST",A:[32,3,30,4,32,4]},{C:"FOURTH",name:"HELFDANE THE FAT",R:110,from:"SOUTH",A:[18,3,17,4,19,4]},{C:"FIFTH",name:"EDGTHO THE SILENT",R:102,from:"SOUTHWEST",A:[3,3,4,4,5,4,6,6]},{C:"SIXTH",name:"RAGNAR THE GRIM",R:94,from:"WEST",A:[3,18,4,19,5,20,6,21]},{C:"SEVENTH",name:"RETHEL THE ARCHER",from:"NORTHWEST",A:[3,32,4,30,5,31,6,30]},{C:"EIGTH",name:"HERGER THE JOYOUS",from:"NORTH",A:[18,32,19,30,18,31,19,31]},{C:"NINTH",name:"WEATH THE MUSICAL",from:"NORTHEAST",A:[32,32,30,30,32,30,31,31,32,31]},{C:"TENTH",name:"SKELD THE WARY",from:"EAST",A:[32,18,30,17,32,17,32,19,30,18]},{C:"ELEVENTH",name:"RONETH THE QUICK",from:"SOUTHEAST",A:[32,3,30,4,32,4,31,4,31,3]},{C:"TWELFTH",name:"EBEN FADLUN",R:108,from:"SOUTH",A:[18,3,17,4,19,4,18,4,17,5]},{C:"THIRTEENTH",name:"BEOWULF THE KING",R:116,from:"SOUTHWEST",A:[3,3,4,4,5,4,4,19,5,20,6,21,17,4,19,4,18,4,17,5]}],Zt=[],$t=[],b=[],S=[],O=[],qt=void 0,Qt=[],_t=[],ti=[],ii=[],I=0,R=24,D=16,ei=5,z=5,si={},hi=[],ni=new $,ri="",oi=0,ai=0,di=0,ui=d;function ci(){let i=0;for(let t=0;t<O.length;t++){var e=O[t];i+=e.L?0:e.ba}return i}function li(t,i,e,s){t=t.toLowerCase();var h=window.speechSynthesis||speechSynthesis,n=si[t]||new SpeechSynthesisUtterance(t);if(si[t]=n,i=(i=i||47)>hi.length-1?j(0,hi.length):i,(t=h.getVoices()).length){for(n.voice=t[i],i=0;"en"!=n.voice.lang.substr(0,2);)n.voice=t[i++];n.pitch=e||1.5,n.volume=.5,n.rate=s||2,h.cancel(),h.speak(n)}}function h(t){ri=t,ni=new $(3)}function gi(t,i,e){if(i<e){var s=a(t,f(e/24,0));for(y(t,f((e+2)/12,.25),new l(0,0,0)),y(t,f(e/12,1/12),new l(.7,.2,.2)),t=0;t<i;t++)y(s,f(1/12),new l(.4,.7,.2)),s.x+=1/12}}var fi=!1;let N={N:void 0};var vi,mi,C,xi,F,yi,pi=[[[.3,0,400],[.1,0,220,,.33,,2]],[[[,,3,,,,,,3,,15,,,,,,3,,,,,,,,3,,15,,,,,,,,2,,,,,,2,,14,,,,,,2,,,,,,,,2,,14,,,,,,,,],[1,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,22,,20,,17,,,,,,,,,,,,,,,,,,,,,,,,,,]],[,[1,,17,,,,20,,,,20,,,,20,,,,,,,,,,,,,,,,,,,,17,,,,18,,17,,,,,,18,,,,17,,,,,,18,,17,,,,15,,,,]]],[0,0,1,1],116],wi=pi[1][0],Ei=pi[1][1],Ti=(Ei[0]=wi[0],new lt),Mi=(pi[0].reverse(),wi.splice(1),Ei.splice(1),pi[3]=160,new lt);class Hi{constructor(t,i,e,s){this.x=t,this.y=i,this.g=f(t,i),this.K=e,this.i=this.D=this.F=this.u=this.j=this.m=0,this.T=s}S(t,i){return(t=t>this.g.x-1&&t<this.g.x+1&&i>this.g.y-1&&i<this.g.y+1)&&!this.h()?h("NEED\n"+(this.m?this.m+" WOOD\n":"")+(this.j?this.j+" STONE\n":"")+(this.u?this.u+" FOOD\n":"")+(this.F?this.F+" WORKER\n":"")+(this.D?this.D+" MANA\n":"")+(this.i?this.i+" LIVING SPACE":"")):t&&this.T(),t}h(){var i;if(i=R>=this.m&&D>=this.j&&ei>=this.u&&z>=this.D){for(let t=i=0;t<b.length;t++)b[t].I||i++;i=i>=this.F}return i&&ci()-b.length>=(this.i||-1e3)}V(){var t=new l(1,1,1,this.h()?1:.5);this.g=m(f(this.x,innerHeight-this.y)),x(m(f(this.x,innerHeight-this.y)),f(2),g(f(0,72),f(24,24)),t),x(m(f(this.x,innerHeight-this.y)),f(this.K.size.x/12,this.K.size.y/12),this.K,t)}}function Ai(t,i){if(t.L=Math.max(0,t.L-i),t.L<=0)return t.m=t.u,t.size=t.j,t.H=-t.g.y,!0}class bi extends tt{constructor(t,i,e){for(super(t,f(1),g(58)),this.H=-1e4,this.ba=0,this.G=this.o=6,this.g=t,this.u=e,this.j=i,(F[t.y][t.x]=this).L=10,t=this.h=0;t<b.length;t++)(i=b[t]).selected&&L(i,"build",this)}J(i){if(this.L){for(let t=0;t<i.length;t++)L(i[t],"build",this);return!0}}O(t){this.o-=t,(this.o<=0||this.L)&&this.B()}B(){var t=O.indexOf(this);-1!=t&&O.splice(t,1),F[Math.round(this.g.y)][Math.round(this.g.x)]=0,super.B()}M(){super.M(),gi(a(this.g,f(0,1)),this.o,this.G)}update(){!this.L&&this.h&&Math.random()<.05&&se(this.h,ie,1)}}function Si(t,i){var e=t.g.add(f(0,t.step?-.25:-2/12+t.F));x(t.v?t.g.add(f(0,.5)):e,f(2),g(i,24),void 0,(t.D?1:-1)*t.j/(12*P),t.D)}function Oi(i,e,s,t){let h=1/0,n;for(let t=0;t<e.length;t++){var r=e[t],o=U(i.g,r.g)**.5;o<s&&o<h&&(n=r,h=o)}n&&t(n)}class Ii extends tt{constructor(t,i,e){super(t,i,e),this.i=t,this.G=this.o=3,this.speed=1/48,this.u=0,this.fa=g(e.g.add(f(12,0),e.size)),this.s=this.l=void 0,this.h=new $,this.F=this.j=0,this.I=void 0}O(t){this.o-=t,se(this.g,$i),this.o<=0&&this.B()}B(){var t=this instanceof Ri?b:S,i=t.indexOf(this);-1!=i&&t.splice(i,1),super.B()}M(){let t=this.g.add(f(0,this.step?1/12:this.F));this.v&&(t=this.g.add(f(0,8/12))),this.step=Math.floor(this.u/10)%2,x(t,this.size,this.step?this.fa:this.m,void 0,void 0,this.D);let i;"chop"==this.l||"axe"==this.I?i=f(24):"mine"==this.l?i=f(48,24):"build"==this.l?i=f(72,24):"farm"==this.l?i=f(48,72):"sword"==this.I?i=f(72,48):"spear"==this.I?i=f(0,24):"bow"==this.I&&(i=f(72)),i&&Si(this,i),this.v||gi(a(this.g,f(0,8/12)),this.o,this.G)}}function L(t,i,e){t.v=void 0,X(t.h),X(t.X),t.K&&(t.m=t.K,delete t.K),t.l=i,t.i=(e||t).g,t.j=0,"move"!=i&&(t.selected=!1,I=0),"build"==i&&(t.g=t.g.add(f(.1))),e={chop:["k","choppa","yep?"],mine:["k","yep?"],build:["k","hamma?","yep?"],store:["hoard","stow","store"],shelter:["shellta","safety"],move:["goin","yep?","k"],farm:["fooda","grub","k"],pray:["pray","holy"]},i&&e[i]&&li(e[i][j(0,e[i].length)]),"pray"==i&&h("PRAY TO ME!"),t.Y&&t.Y.set(5)}class Ri extends Ii{constructor(t,i,e=g(4)){super(t,i,e),this.selected=!1,this.T=this.P=this.W=0,this.X=new $}S(t,i){return(t=t>this.g.x-this.size.x/2&&t<this.g.x+this.size.x/2&&i>this.g.y-this.size.y/2&&i<this.g.y+this.size.y/2)&&!this.selected&&li((i=G())<.3?"what":i<.6?"huh?":"ready"),t}update(){if(n(this.X)&&H>this.X.time&&(this.K?(this.m=this.K,delete this.K):(this.K=this.m,this.m=g(3)),this.X.set(1)),n(this.h))if(H>this.h.time){if(X(this.h),this.F=0,"chop"==this.l){var t=this.s;--t.h,t.h<=0&&(F[Math.round(t.g.y)][t.g.x]=0,Zt.splice(Zt.indexOf(t),1),t.B()),r(void 0,.03,405,void 0,void 0,0,3,.1,8,void 0,void 0,void 0,void 0,.1,27,.4,.04,.44,.01),this.W+=1}else if("pray"==this.l)G()<(25-z)/25&&(r(.5,void 0,600,void 0,void 0,0,void 0,3.9,void 0,-1,650,.05,.04,void 0,void 0,void 0,.08,.84,.18),z++,se(this.g,te));else if("farm"==this.l)--(t=this.s).i,t.i<=0&&t.B(),this.T+=1;else if("mine"==this.l)--(t=this.s).h,t.h<=0&&(F[t.g.y][t.g.x]=0,$t.splice($t.indexOf(t),1),t.B()),r(.5,0,1793,void 0,.05,.02,3,.7,void 0,-1,void 0,void 0,void 0,.1,void 0,void 0,void 0,.63,.02,void 0,-1400),this.P+=1;else if("build"==this.l)if(t=Ai(this.s,1),r(void 0,.03,405,void 0,void 0,0,3,.1,8,void 0,void 0,void 0,void 0,.1,27,.4,.04,.44,.01),t&&this.s instanceof Ci)L(this,"farm",this.s);else if(t){for(t=0;t<O.length;t++)if((i=O[t]).L)return void L(this,"build",i);L(this)}3<=this.W+this.P+this.T&&(this.ea=this.l,this.da=this.i,this.l="store",this.i=jt)}else.9<(t=Z(this.h))?(this.j-=10,this.F+=.95<t?-.03125:.03125):this.j++;else if(!this.i||this.i.x==this.g.x&&this.i.y==this.g.y)this.u=0;else if(i=a(this.i,this.g).angle(),U(this.i,this.g)**.5<this.speed){if(this.g=this.i,this.i=void 0,"chop"==this.l){for(var i=1/0,e=0;e<Zt.length;e++){var s=Zt[e],h=a(s.g,this.g).length();h<i&&(t=s,i=h)}t&&(this.i=t.g)}}else if(e=Y(i,this.speed),t=Di(s=this.g.add(e)))if(t instanceof ji&&"chop"==this.l)this.h.set(1),this.u=this.j=0,this.s=t;else if(t instanceof Wi&&"mine"==this.l)this.h.set(1),this.u=this.j=0,this.s=t;else if(t instanceof Fi&&"pray"==this.l)this.h.set(3),this.X.set(.8),this.K=this.m,this.m=g(3),this.u=this.j=0,this.s=t;else if(t instanceof bi&&"build"==this.l&&t.L)this.h.set(1),this.u=this.j=0,this.s=t;else if(t instanceof Ci&&"farm"==this.l)this.h.set(1),this.u=this.j=0,this.s=t;else if(t==this.s&&"shelter"==this.l){for(i=0;i<b.length;i++)if(b[i].v==t)return void L(this);this.g=t.g.U(),this.v=t,this.H=this.v.H+1}else t instanceof Li&&"store"==this.l?(R+=this.W,D+=this.P,ei+=this.T,this.T=this.P=this.W=0,this.l=this.ea,this.i=this.da):(this.g=this.g.add(Y(i,this.speed/4)),this.D=e.x<0,this.u++,this.H=-this.g.y);else this.g=s,this.D=e.x<0,this.u++,this.H=-this.g.y}M(){this.selected&&x(this.g,f(16/12),g(1)),super.M()}}function Di(t){return t.x<0||t.y<0?1:F[Math.round(t.y)][Math.round(t.x)]}class zi{constructor(){for(var t=new xt(f(36,36)),i=0;i<36;i++)for(var e=0;e<36;e++){var s=0,h=j(0,5),n=F[i][e],r=("w"==n?s=11:"t"==n?Zt.push(new ji(f(e,i))):"s"==n&&$t.push(new Wi(f(e,i))),n=t,f(e,i)),s=new mt(s,h);J(r,n.size)&&(n.data[(0|r.y)*n.size.x+r.x|0]=s)}for(t.j=[u,it,c,d,v],u=t.h,it=t.i,c=t.size.multiply(t.m.size),d=t.size.scale(.5),v=t.m.size.x,u.width=c.x,u.height=c.y,t.i.imageSmoothingEnabled=!1,At(),e=t.size.x;e--;)for(n=t.size.y;n--;)i=t,h=f(e,n),r=i.m.size,null!=(s=J(h,i.size)&&i.data[(0|h.y)*i.size.x+h.x|0]).h&&x(h=i.g.add(h).add(f(.5)),f(1),g(s.h,r,i.m.h),s.color,s.direction*P/2,!1);Ot(!0),[u,it,c,d,v]=t.j,O.push(new Li,new Fi),Ai(Lt(a(jt,f(3,1))),10),b.push(new Ri(f(14,12))),qt=new tt(f(33),f(3),g(f(48,132),24))}}class Ni extends bi{constructor(t){super(t,f(2),g(f(0,96),f(24))),this.G=this.o=10,F[t.y][t.x]=this,R-=6,D-=4}J(i){if(!super.J(i)){for(let t=0;t<i.length;t++)L(i[t],"shelter",this),i[t].s=this;return i.length||h("PUT A WORKER\nINSIDE TO UPGRADE"),!0}}B(){for(let t=0;t<b.length;t++){var i=b[t];i.v==this&&(i.v=void 0)}super.B()}}class Ci extends bi{constructor(t){super(t,f(2),g(f(24,96),f(24))),R-=6,D-=4,this.i=50}J(i){if(!super.J(i)){for(let t=0;t<i.length;t++)L(i[t],"farm",this);return!0}}}class Fi extends bi{constructor(){super(f(17,22),f(2),g(f(48,96),f(24))),this.G=this.o=18,Ai(this,10)}J(i){if(!super.J(i)){i.length||h("HOLY SHRINE");for(let t=0;t<i.length;t++)L(i[t],"pray",this);return!0}}}class Li extends bi{constructor(){var t=jt;super(t,f(2),g(f(72,96),24)),this.ba=3,this.G=this.o=18,Ai(this,10),this.h=a(t,f(.3,-.75))}J(i){for(let t=0;t<i.length;t++)i[t].selected=!1;return I=Gt,!0}B(){I=Bt,super.B()}}class Wi extends tt{constructor(t){super(t,f(1),g(8)),this.H=-t.y,(F[t.y][t.x]=this).h=48}J(t){t.forEach(t=>{t.I||L(t,"mine",this)})}}class ji extends tt{constructor(t){super(t.add(f(0,.45)),f(1,2),g(f(24,0),f(12,24))),this.H=-t.y,this.D=.5<G(),(F[t.y][t.x]=this).h=8}J(t){t.forEach(t=>{t.I||L(t,"chop",this)})}}class Bi extends Ri{constructor(t){super(t,f(1),g(12)),this.selected=!1,this.I="bow",this.Y=new $(1),R-=4,D-=2}update(){!n(this.h)&&H>this.Y.time&&Oi(this,S,this.v?4:3,t=>{X(this.h),this.u=this.j=0,this.s=t,this.l="shoot",r(.7,void 0,334,.13,void 0,.2,4,3,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.77,.03,void 0,103),this.Y.set(4);var i=this.g.U(),e=new tt(i,1,g(9),a(t.g,i).angle());Zi.push({object:e,origin:i,target:t})}),super.update()}}class Ui extends Ii{constructor(t,i,e,s){super(t,i,e),this.I=.5<G()?"axe":"sword",this.speed=.015625,s&&(this.G=this.o=s)}S(t,i){return t>this.g.x-this.size.x/2&&t<this.g.x+this.size.x/2&&i>this.g.y-this.size.y/2&&i<this.g.y+this.size.y/2}update(){var t,i,e,s;n(this.h)?H>this.h.time?(X(this.h),r(void(this.F=0),.03,405,void 0,void 0,0,3,.1,8,void 0,void 0,void 0,void 0,.1,27,.4,.04,.44,.01),this.s.O(Math.floor(Math.sqrt(this.G)))):.9<(t=Z(this.h))?(this.j-=10,this.F+=.95<t?-.03125:.03125):this.j++:!this.i||this.i.x==this.g.x&&this.i.y==this.g.y?this.u=0:(t=a(this.i,this.g).angle(),U(this.i,this.g)**.5<this.speed?this.i=jt:(Oi(this,b,.8,t=>{t.v||(this.h.set(1),this.j=0,this.s=t)}),Oi(this,b,3,t=>{this.i=t.g}),i=Y(t,this.speed),(s=Di(e=this.g.add(i)))?s instanceof bi?(this.h.set(1),this.j=0,this.s=s):(this.g=this.g.add(Y(t,this.speed/4)),this.D=i.x<0,this.u++,this.H=-this.g.y):(this.g=e,this.D=i.x<0,this.u++,this.H=-this.g.y)))}M(){super.M(),Si(this,"axe"==this.I?f(24):f(72,48))}}class Gi extends Ri{constructor(t){super(t,f(1),g(14)),this.I="spear",this.G=this.o=6,R-=4,D-=2}update(){n(this.h)?H>this.h.time&&this.s instanceof Ui&&(X(this.h),r(void(this.F=0),.03,405,void 0,void 0,0,3,.1,8,void 0,void 0,void 0,void 0,.1,27,.4,.04,.44,.01),this.s.O(1)):this.v||(Oi(this,S,.8,t=>{this.h.set(1),this.j=0,this.s=t}),Oi(this,S,3,t=>{this.i=t.g})),super.update()}O(t){super.O(t/2)}}class Pi extends Hi{constructor(t,i,e,s,h){super(t,96,i,h),this.m=e,this.j=s}}class Ki extends Hi{constructor(t){super(128,96,g(4),t),this.i=1}h(){return this.u=5*b.length,super.h()}}class Vi extends Hi{constructor(t,i,e,s,h){super(t,i,e,h),this.D=s}}class Yi extends Hi{constructor(t,i,e,s){super(t,96,i,s),this.P=e,this.m=4,this.j=2,this.F=1}V(){super.V();var t=new l(1,1,1,this.h()?1:.5);x(m(f(this.x,innerHeight-this.y)).add(f(0,-2/12)),f(2),this.P,t)}}var Ji=128;function ki(){if(ee($i,function(t){y(t.g,f(1/12),new l(.7,.2,.2)),t.dy-=.002}),ee(qi,function(t){y(t.g,f(.25),new l(.4,.7,.2,.4)),t.g.y-=t.dy/2}),ee(_i,function(t){y(t.g,f(.25,1/12),new l(.4,.7,.2)),y(t.g,f(1/12,.25),new l(.4,.7,.2))}),ee(Qi,function(t){y(t.g,f(1/12),new l(1,.9,.2))}),ee(te,function(t){y(t.g,f(2/12),new l(.4,.6,1))}),ee(ie,function(t){y(t.g,f(2/12),new l(.6,.7,.7,1-t.aa/40)),t.g.x-=t.dx/2,t.g.y-=3*t.dy/4}),I==Bt)at("YOU HAVE LOST\nCLICK TO RETRY?",m(f(innerWidth/2,innerHeight/2)),.08);else if(I==Ut)((v+=di)>oi||v<ai)&&(di=-di),at("YOU HAVE DEFEATED\nTHE HEROES!",m(f(innerWidth/2,innerHeight/2)),.08);else{var t,i,e,s,h;if(5<I&&(t=Math.round(p.x),i=Math.round(p.y),e=new l(1,1,1,.5),s=f(1),n=g(50),Di(p)&&(e=new l(1,0,0,.5)),I==Vt?(s=f(2),n=g(f(0,96),f(24))):I==kt?n=g(51):I==Jt&&(s=f(2),n=g(f(24,96),f(24))),x(f(t,i),s,n,e)),Xi(i=m(f(t=Math.min(128,Math.round(128*innerWidth/800)),64)),g(36),R),Xi(m(f(innerWidth-t,64)),g(45),z),Xi(i=a(i,f(0,2)),g(44),D),Xi(i=a(i,f(0,2)),g(37),ei),Xi(i=a(i,f(0,2)),g(4),b.length+"/"+ci()),I==Kt)for(i=0;i<_t.length;i++)_t[i].V();if(I==Pt)for(i=0;i<Qt.length;i++)Qt[i].V();else if(I==Gt)for(i=0;i<ti.length;i++)ti[i].V();for(i=0;i<ii.length;i++)ii[i].V();for(Ji=t,x(e=m(f(innerWidth-t,innerHeight-t)),f(3),g(f(0,144),f(36,36))),y(e,f(28/12),new l(.2,.6,.4)),t=[Zt,$t,O.concat(b),S],i=[new l(.3,.4,.2),new l(.61,.68,.72),new l(.6,1,.3),new l(.9,.3,.4)],s=0;s<t.length;s++){var n=t[s],r=i[s];for(let t=0;t<n.length;t++){var o=n[t];y(e.add(f((o.g.x-18)/12,(o.g.y-18)/12)),f((o instanceof Li?2:1)/12),r)}}ri&&at(ri=H>ni.time?"":ri,a(d,f(0,5)),.08),t=Math.ceil(-xi.valueOf()),C<12&&t<31?h=(h=Xt[C]).C+" "+t+"\n"+h.from:S.length&&(h=Xt[C-1].name+"  \n"+C+"/13"),h&&at(h,m(f(innerWidth/2,24)),.08),yi||at("WENDOL\nVILLAGE",m(f(innerWidth/2,+innerHeight/3)),Math.min(.16,.16*innerWidth/700))}}function Xi(t,i,e){x(t,f(4,2),g(f(0,48),f(48,24))),x(a(t,f(.85,0)),f(1),i),at(e,t.add(f(.5,.2)),.08)}var Zi=[],$i=[],qi=[],Qi=[],_i=[],te=[],ie=[];function ee(i,e){for(let t=0;t<i.length;t++){var s=i[t];s.g.x+=s.dx,s.g.y+=s.dy,e(s),s.aa++,40<s.aa&&(i.splice(t,1),t--)}}function se(i,e,s=5){s=j(1,s);for(let t=0;t<s;t++){var h=G()*P;e.push({g:i.U(),dx:.01*Math.cos(h),dy:.05*Math.sin(h),aa:0})}}</script>
