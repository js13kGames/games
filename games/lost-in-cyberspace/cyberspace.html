<!doctype html><title>Lost in CYBERSPACE</title><script src=/2017/webxr/aframe.js></script><script>!function(e,t,n){function r(e,t){let n=[],r=0;for(let t=0;t<8;t++){let o=(t*e+r)%8;void 0!==n[o]&&(o=(t*e+ ++r)%8),n[o]=t}return t&&(n=n.concat(n.splice(0,t))),n}function o(e){return~~(n.random()*e)}function i(e,t,n,o){if(0===e||0===n)return null;let i=function(e,t){return{rowWalls:e.map((function(e,n){return[e,7-t[n]]})),colWalls:t.map((function(t,n){return[t,7-e[n]]}))}}(r(e,t),r(n,o)),s=a(i.rowWalls,i.colWalls);return-1===s.reduce(((e,t)=>e.concat(t))).indexOf(0)?s.reduce(((e,t)=>e.concat(t))).filter((e=>1===e)).length<5?null:{rowSpread:e,rowOffset:t,colSpread:n,colOffset:o,rowWalls:i.rowWalls,colWalls:i.colWalls,connections:s}:null}function a(e,t){let n=[];for(let e=0;e<8;e++){n[e]=[];for(let t=0;t<8;t++)n[e][t]=0}return s(n,0,0,e,t),n[0][0]--,n}function s(e,t,n,r,o){if(e[t][n])return void e[t][n]++;let i,a;e[t][n]=1,a=n,(i=t+1)<8&&-1===r[n].indexOf(i)&&s(e,i,a,r,o),i=t,(a=n+1)<8&&-1===o[t].indexOf(a)&&s(e,i,a,r,o),a=n,(i=t-1)>=0&&-1===r[n].indexOf(t)&&s(e,i,a,r,o),i=t,(a=n-1)>=0&&-1===o[t].indexOf(n)&&s(e,i,a,r,o)}function l(){let e=[0,1,2,3];return[e.splice(o(e.length),1)[0],e.splice(o(e.length),1)[0],e.splice(o(e.length),1)[0],e[0]]}function c(){return[o(8),o(8)]}function u(){return function(e){let t=[];for(let r=0;r<4;r++){let o=e[r],i=(4*r+e[(r+1)%4]+e[(r+2)%4])%16;o===i&&(i=15-o),(4===n.abs(o-i)||1===n.abs(o-i)&&~~(o/4)==~~(i/4))&&(o=(16+o-5)%16,i=(i+5)%16),[o,i].forEach((e=>{let n=[e%4,~~(e/4)];1!==r&&3!==r||(n[0]=n[0]+4),2!==r&&3!==r||(n[1]=n[1]+4),t.push(n)}))}return{trapsSeed:e,trapsXY:t}}([o(16),o(16),o(16),o(16)])}function p(){let e=u(),t=c(),n=function(){let e=o(6)+1,t=o(7),n=o(6)+1,r=o(7),a=i(e,t,n,r);for(;!a;)a=i(e,t,n=o(6)+1,r=o(7));return a}();for(;e.trapsXY.some((e=>e.join()===t.join()))||1!==n.connections[t[0]][t[1]];)e=u(),t=c();return{colors:l(),traps:e,target:t,walls:n}}function d(e){return(e+4*o(4)).toString(16).toUpperCase()}function h(e){return(e+8*o(2)).toString(16).toUpperCase()}function f(e){return"0x"+d(0)+e.map(d).join("")}function m(e){return"0x"+d(1)+[e.rowSpread,e.rowOffset,e.colSpread,e.colOffset].map(h).join("")}function y(e){return"0x"+d(2)+e.trapsSeed.map((e=>e.toString(16).toUpperCase())).join("")}function g(e){let t="0x"+d(3);return t+e.map(h).join("")+e.map(h).join("")}function E(){this.setSettings=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var n=this.b+this.c+this.e;if(n<.18){var r=.18/n;this.b*=r,this.c*=r,this.e*=r}}}function A(t){G=t,ee++,e.querySelectorAll(".node-inside").forEach((e=>e.setAttribute("visible",!1))),t.el.querySelector(".node-inside").setAttribute("visible",!0),t.isTrap&&(t.el.querySelector(".node-box").components[U?"sound__lose":"sound__trap"].playSound(),R(32)),w()}function v(e,t){let n=performance.now(),r=!1;return requestAnimationFrame((function o(i){let a=(i-n)/t;a>1&&(a=1),r||e(a),!r&&a<1&&requestAnimationFrame(o)})),()=>{r=!0}}function C(t,n){const r=e.createElement(t);for(const e in n){let t=n[e];"position"===e&&(t=(t.x||0)+" "+(t.y||0)+" "+(t.z||0)),r.setAttribute(e,t)}return r}function b(e){return C("a-box",{class:"wall",src:"#G",position:e,color:"#FFF",height:4,width:4,depth:4})}function T(e,t,n=1){let r=C("a-entity",{position:{x:e.x-.5*n,y:e.y,z:e.z-.5*n},rotation:"0 "+(90*n-45)+" 0"});if(r.appendChild(C("a-plane",{position:{y:-.4},rotation:"-10 0 0",height:.5,width:.5,src:`#T${t.isTrap?"T":t.sector}`})),!t.isTrap){r.appendChild(C("a-plane",{class:"node-action-help",position:{x:-.3,y:-.2},rotation:"-10 15 0",height:.1,width:.4,src:"#AE",material:"transparent: true;","fuse-on-hover":"","scale-on-hover":"","help-on-click":"","text-on-hover":"",sound__click:{src:J}})),r.appendChild(C("a-plane",{class:"node-action-hack",position:{x:-.31,y:-.35},rotation:"-10 15 0",height:.1,width:.4,src:"#AA",material:"transparent: true;","fuse-on-hover":"","scale-on-hover":"","hack-on-click":"","text-on-hover":"",sound__hack:{src:X}}));let e=C("a-entity",{class:"hint",position:{y:-.2,z:-.1},visible:!1});e.appendChild(C("a-plane",{position:{y:.375},height:.5,width:.5,src:"#H",material:"transparent:true"})),e.appendChild(C("a-plane",{position:{y:.0625},height:.125,width:.125,src:"#HA",material:"transparent:true"})),r.appendChild(e)}return r}function x(e,t){let n=C("a-entity",{class:"node"});n.appendChild(C("a-box",{class:"node-box",src:`#N${t.sector}`,position:e,height:1.5,width:1.5,depth:1.5,rotation:"0 45 0","move-on-click":"","scale-on-hover":"","text-on-hover":"","fuse-on-hover":"",sound__move:{src:P,on:"click"},sound__trap:{src:K},sound__lose:{src:V}}));let r=C("a-entity",{class:"node-inside"});return r.appendChild(C("a-plane",{position:{x:e.x,y:e.y-.7,z:e.z},color:t.isTrap?$:O[D.colors[t.sector]],rotation:"-90 45 0",material:"transparent:true",src:"#F",height:1.46,width:1.46})),r.appendChild(T(e,t)),r.appendChild(T(e,t,-1)),n.appendChild(r),n.data=t,n}function k(e){let t=e%60,n=`0${~~(e/60)}:${t<10?"0":""}${t}`,r=~~(100*(Y-e)/Y);return`LOCATING INTRUDER\n${r}% [${"=".repeat(~~(r/10)+(r<100?1:0))+" ".repeat(10-~~(r/10)+(r<10?1:0))}]\n            ${n}`}function w(e){M.forEach(((t,n)=>{I(te[`T${n}`],function(e,t,n){let r=k(e),o=`> access code\n  ${t}`,i="\n\n> "+(n||"");return(q&&!H?r+"\n\n":"")+(G.isHacked?"> hack\n  ACCESS DENIED!":H?"> hack\n\n  ACCESS GRANTED\n\n> sudo rm -rf /\n> kill -9 -1":o)+(H?"":i)}(Z,t,e),O[D.colors[n]],48)})),I(te.TT,function(e){let t=k(e);return(q?t+"\n\n":"")+"    INTRUDER  \n"+(U?"   ELIMINATED":"    DETECTED  ")}(Z),$)}function S(e){M.forEach(((t,n)=>{I(te[`N${n}`],">"+(e||""),O[D.colors[n]],112)}))}function R(e){(Z-=e)<0&&(Z=0),w()}function _(){H||(--Z<0&&(Z=0),w(),Z?setTimeout(_,G.isTrap?500:1e3):(L&&L(),U=!0,e.getElementById("camera").setAttribute("position","0 0 0"),j($),A(B)))}function N(){q||(q=!0,w(),_())}function F(){let t=function(e,t){let n=o(16),r=[n,e,t].reduce(((e,t,n)=>e+t*(2*n+1)),0);return"0x"+n.toString(16).toUpperCase()+[e,t].map((e=>(e<16?"0":"")+e.toString(16).toUpperCase())).join("")+(r%16).toString(16).toUpperCase()}(Z,ee),n=["              ERROR","","A fatal exception "+t+" has","occured in the network sectors:",M.join(" ")+".","","All processes terminated.","","Contact your system administator","or technical support for further","assistance.","",`TIME_TO_LOCATE_INTRUDER: 0${~~(Z/60)}:${Z%60<10?"0":""}${Z%60}`,"INTRUDER_SWITCHES_COUNT: "+ee,"NETWORK_TOP_HACKER_CODE: "+t,"","YOU WIN!"].join("\n");I(te.H,n,"",24);let r=C("a-plane",{width:2,height:2,position:{y:1,z:-3},src:"#H",material:"transparent:true"});e.getElementById("camera").appendChild(r),r=C("a-plane",{width:2,height:2,position:{y:1,z:3},src:"#H",material:"transparent:true",rotation:"0 180 0"}),e.getElementById("camera").appendChild(r)}function z(){function t(n,r,i){let a=[].filter.call(e.querySelectorAll(n),(e=>e.getAttribute("visible")));a.length?(a[o(a.length)].setAttribute("visible",!1),a[o(a.length)].setAttribute("visible",!1),setTimeout((()=>t(n,r,i)),r)):i()}H=!0;let n=e.getElementById("camera");n.setAttribute("sound",{src:Q}),n.components.sound.playSound(),w(),e.getElementById("scene").appendChild(C("a-sky",{color:"#00F"})),e.querySelectorAll(".sky").forEach((e=>e.parentNode.removeChild(e))),e.querySelectorAll(".node-action-hack").forEach((e=>e.parentNode.removeChild(e))),e.querySelectorAll(".node-action-help").forEach((e=>e.parentNode.removeChild(e))),j("#00F"),t(".wall",20,(()=>t(".node",50,F)))}function I(e,t,n,r=48,o="white"){t=t.split("\n"),e.clearRect(0,0,512,512),n&&(e.fillStyle=n,e.fillRect(0,0,512,512)),e.lineWidth=1,e.fillStyle=o,e.font=`${r}px Monaco,Consolas,monospace`,t.forEach(((t,n)=>e.fillText(t,10,(n+1)*r*1.2))),n&&r>30&&(e.strokeStyle=n,t.forEach(((t,n)=>e.strokeText(t,10,(n+1)*r*1.2)))),e.strokeStyle="rgba(0,0,0,0.3)",t.forEach(((t,n)=>e.strokeText(t,10,(n+1)*r*1.2)))}function j(e="#FFF"){let t=te.G;t.fillStyle="black",t.strokeStyle=e,t.fillRect(0,0,256,256);for(let e=0;e<6;e++){let n=51*e+.5;t.beginPath(),t.moveTo(0,n),t.lineTo(256,n),t.stroke()}}let O=["#3C5","#3CF","#FC3","#F3C"],$="#F00";var W=new function(){var e,t,r,o,i,a,s,l,c,u,p,d;this._params=new E,this.reset=function(){var e=this._params;o=100/(e.f*e.f+.001),i=100/(e.g*e.g+.001),a=1-e.h*e.h*e.h*.01,s=-e.i*e.i*e.i*1e-6,e.a||(p=.5-e.n/2,d=5e-5*-e.o),l=1+e.l*e.l*(e.l>0?-.9:10),c=0,u=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var n=this._params;return e=n.b*n.b*1e5,t=n.c*n.c*1e5,r=n.e*n.e*1e5+12,3*((e+t+r)/3|0)},this.synthWave=function(h,f){var m=this._params,y=1!=m.s||m.v,g=m.v*m.v*.1,E=1+3e-4*m.w,A=m.s*m.s*m.s*.1,v=1+1e-4*m.t,C=1!=m.s,b=m.x*m.x,T=m.g,x=m.q||m.r,k=m.r*m.r*m.r*.2,w=m.q*m.q*(m.q<0?-1020:1020),S=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,R=m.d,_=m.j/2,N=m.k*m.k*.01,F=m.a,z=e,I=1/e,j=1/t,O=1/r,$=5/(1+m.u*m.u*20)*(.01+A);$>.8&&($=.8),$=1-$;for(var W,q,U,H,L,D,M=!1,B=0,G=0,Y=0,P=0,K=0,X=0,V=0,J=0,Q=0,Z=0,ee=new Array(1024),te=new Array(32),ne=ee.length;ne--;)ee[ne]=0;for(ne=te.length;ne--;)te[ne]=2*n.random()-1;for(ne=0;ne<f;ne++){if(M)return ne;if(S&&++Q>=S&&(Q=0,this.reset()),u&&++c>=u&&(u=0,o*=l),(o*=a+=s)>i&&(o=i,T>0&&(M=!0)),q=o,_>0&&(Z+=N,q*=1+n.sin(Z)*_),(q|=0)<8&&(q=8),F||((p+=d)<0?p=0:p>.5&&(p=.5)),++G>z)switch(G=0,++B){case 1:z=t;break;case 2:z=r}switch(B){case 0:Y=G*I;break;case 1:Y=1+2*(1-G*j)*R;break;case 2:Y=1-G*O;break;case 3:Y=0,M=!0}x&&((U=0|(w+=k))<0?U=-U:U>1023&&(U=1023)),y&&E&&((g*=E)<1e-5?g=1e-5:g>.1&&(g=.1)),D=0;for(var re=8;re--;){if(++V>=q&&(V%=q,3==F))for(var oe=te.length;oe--;)te[oe]=2*n.random()-1;switch(F){case 0:L=V/q<p?.5:-.5;break;case 1:L=1-V/q*2;break;case 2:L=.225*(((L=1.27323954*(H=6.28318531*((H=V/q)>.5?H-1:H))+.405284735*H*H*(H<0?1:-1))<0?-1:1)*L*L-L)+L;break;case 3:L=te[n.abs(32*V/q|0)]}y&&(W=X,(A*=v)<0?A=0:A>.1&&(A=.1),C?(K+=(L-X)*A,K*=$):(X=L,K=0),P+=(X+=K)-W,L=P*=1-g),x&&(ee[J%1024]=L,L+=ee[(J-U+1024)%1024],J++),D+=L}D*=.125*Y*b,h[ne]=D>=1?32767:D<=-1?-32768:32767*D|0}return f}};t.jsfxr=function(e){W._params.setSettings(e);var t=W.totalReset(),n=new Uint8Array(4*((t+1)/2|0)+44),r=2*W.synthWave(new Uint16Array(n.buffer,44),t),o=new Uint32Array(n.buffer,0,44);o[0]=1179011410,o[1]=r+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=r,r+=44;for(var i=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="data:audio/wav;base64,";i<r;i+=3){var l=n[i]<<16|n[i+1]<<8|n[i+2];s+=a[l>>18]+a[l>>12&63]+a[l>>6&63]+a[63&l]}return s};let q,U,H,L,D,M,B,G,Y=256,P=`url(${jsfxr([0,.002,.0234,.1937,.7505,.2288,,.2736,.0139,-.1929,-.2634,-.818,-.532,,,,-.3047,.8316,.7164,-.0983,,.1088,9e-4,.5])})`,K=`url(${jsfxr([1,.06,.3,.2,.08,.18,,,,,,,,,,,,,1,,,.09,,.5])})`,X=`url(${jsfxr([1,,.19,.13,.12,.22,,-.02,,,,.02,,,,,-.0799,.08,1,,,.12,,.5])})`,V=`url(${jsfxr([0,.0107,.4818,.1177,.1103,.5301,,-.001,-.2314,,.8409,.6064,-.8357,-.2814,-.1833,,-.1204,-6e-4,.9992,.2134,.7968,.9975,-.8724,.5])})`,J=`url(${jsfxr([0,,.1906,,.0556,.4761,,,,,,,,.1562,,,,,1,,,.1,,.5])})`,Q=`url(${jsfxr([1,,.3447,,.4712,.2109,,.1984,,.1398,.5774,,,,,,,,1,,,,,.5])})`,Z=Y,ee=-1,te={};AFRAME.registerComponent("scale-on-hover",{init:function(){let e=this.el;e.addEventListener("mouseenter",(()=>{e.setAttribute("scale",{x:1.1,y:1.1,z:1.1})})),e.addEventListener("mouseleave",(()=>{e.setAttribute("scale",{x:1,y:1,z:1})}))}}),AFRAME.registerComponent("fuse-on-hover",{init:function(){let t=e.getElementById("cursor");if(!t.components.cursor.data.fuse)return;let n,r=this.el;r.addEventListener("mouseenter",(()=>{t.setAttribute("scale",{x:1.2,y:1.2,z:1.2}),n=v((e=>{let n=.007-.0069*e;t.setAttribute("geometry",{radiusInner:n})}),1500)}));let o=()=>{t.setAttribute("scale",{x:1,y:1,z:1}),t.setAttribute("material",{color:"white"}),t.setAttribute("geometry",{radiusInner:.007}),n()};r.addEventListener("mouseleave",o),r.addEventListener("click",o)}}),AFRAME.registerComponent("text-on-hover",{init:function(){let e=this.el;e.addEventListener("mouseenter",(()=>{"node-box"===e.className?S("switch"):"node-action-hack"===e.className&&w("hack"),"node-action-help"===e.className&&w("help")})),e.addEventListener("mouseleave",(()=>{S(),w()}))}}),AFRAME.registerComponent("move-on-click",{init:function(){let t=this.el,n=e.getElementById("camera"),r=!1;t.addEventListener("click",(()=>{if(r||U)return;let e=n.getAttribute("position"),o=t.getAttribute("position"),i=t.parentEl.data,a=G.isTrap?$:O[D.colors[G.sector]],s=i.isTrap?$:O[D.colors[i.sector]],l=a.split("").splice(1).map((e=>parseInt(e,16))),c=s.split("").splice(1).map((e=>parseInt(e,16)));L=v((t=>{let r={x:e.x+(o.x-e.x)*t,y:e.y,z:e.z+(o.z-e.z)*t};n.setAttribute("position",r),a!==s&&j("#"+l.map(((e,n)=>(~~(e+(c[n]-e)*t)).toString(16))).join(""))}),1e3),i&&(N(),r=!0,setTimeout((()=>{U||(A(i),r=!1)}),900))}))}}),AFRAME.registerComponent("hack-on-click",{init:function(){let e=this.el,t=e.parentNode.parentNode.parentNode;e.addEventListener("click",(()=>{t.data&&(t.data.isTarget?z():(N(),t.data.isHacked=!0,e.components.sound__hack.playSound(),R(16)))}))}}),AFRAME.registerComponent("help-on-click",{init:function(){let e=this.el,t=e.parentNode.querySelector(".hint");e.addEventListener("click",(()=>{e.components.sound__click.playSound(),t.setAttribute("visible",!t.getAttribute("visible"))}))}}),AFRAME.registerComponent("cyberspace",{init:function(){let t,n=this.el,r=function(e){return[f(e.colors),m(e.walls),y(e.traps),g(e.target)]}(D=p()),i=D.target;t=i[1]<4?i[0]<4?3:2:i[0]<4?1:0;let a=r.slice(0,3);(M=[]).push(a.splice(o(a.length),1)[0]),M.push(a.splice(o(a.length),1)[0]),M.push(a[0]),M.splice(t,0,r[3]),function(){let t=e.querySelector("a-assets"),n=(n,r,o)=>{let i=e.createElement("canvas");return i.id=n,i.width=r,i.height=o,te[n]=i.getContext("2d"),t.appendChild(i),te[n]},r=n("G",256,256);j(),(r=n("F",128,128)).strokeStyle="#FFF",r.clearRect(0,0,128,128),r.strokeRect(.5,.5,127,127),I(n("AA",512,128),">hack","",90),I(n("AE",512,128),">help","",90),(r=n("HA",128,128)).fillStyle="rgba(255,255,255,0.8)",r.beginPath(),r.moveTo(0,0),r.lineTo(64,64),r.lineTo(128,0),r.fill();let o=["> access code","","Four ACCESS_CODEs from terminals","in different sectors can be used","by NAVIGATOR to map the network","and locate the TARGET node.","","> hack","","HACK the TARGET node to destroy","the corporate network and win.","","But beware - hacking wrong nodes","will make you easier to locate","and you will be lost in CYBERSPACE","when the time runs out!"].join("\n");I(n("H",512,512),o,"rgba(255,255,255,0.8)",24,"#333"),["N0","N1","N2","N3","T0","T1","T2","T3","TT"].forEach((e=>n(e,512,512))),S()}();for(let e=0;e<=16;e++)for(let t=0;t<=16;t++){let r={x:4*e,y:2,z:4*t};(0===e||16===e||0===t||16===t||e%2==0&&t%2==0)&&n.appendChild(b(r))}n.appendChild(b({x:-4,y:2,z:0})),n.appendChild(b({x:0,y:2,z:-4})),D.walls.rowWalls.forEach(((e,t)=>{e.forEach(((r,o)=>{r&&r!==e[o-1]&&n.appendChild(b({x:2*r*4,y:2,z:4*(2*t+1)}))}))})),D.walls.colWalls.forEach(((e,t)=>{e.forEach(((r,o)=>{r&&r!==e[o-1]&&n.appendChild(b({x:4*(2*t+1),y:2,z:2*r*4}))}))}));let s,l,c,u=[];for(let e=0;e<8;e++){u[e]=[];for(let t=0;t<8;t++){let n={isTrap:!1,isTarget:!1,isHacked:!1,el:null};t<4?(n.code=e<4?M[0]:M[1],n.sector=e<4?0:1):(n.code=e<4?M[2]:M[3],n.sector=e<4?2:3),u[e][t]=n}}for(D.traps.trapsXY.forEach((e=>{u[e[0]][e[1]].isTrap=!0})),u[D.target[0]][D.target[1]].isTarget=!0,s=0;s<8;s++)for(l=0;l<8;l++){let e={x:4*(2*s+1),y:1.7,z:4*(2*l+1)};u[s][l].el=x(e,u[s][l]),n.appendChild(u[s][l].el)}(B={isTrap:!0,sector:0}).el=x({x:0,y:1.7,z:0},B),n.appendChild(B.el);do{s=o(8),l=o(8),c=u[s][l]}while(c.isTrap||c.isTarget||c.code!==r[0]&&c.code!==r[1]);let d=e.getElementById("camera"),h={x:4*(2*s+1),z:4*(2*l+1)};d.setAttribute("position",h),d.setAttribute("rotation","0 45 0"),j(c.isTrap?$:O[D.colors[c.sector]]),A(c)}})}(document,window,Math)</script><body bgcolor=#000><p style="position:absolute;margin-left:1em;color:#fff;font:1em Monaco,Consolas,monospace">Entering CYBERSPACE...</p><a-scene cyberspace id=scene><a-assets></a-assets><a-entity id=camera><a-camera wasd-controls-enabled=false><a-entity id=cursor cursor geometry="primitive: ring; radiusInner: 0.007; radiusOuter: 0.01, segmentsTheta: 32" material="color: white; shader: flat; opacity: 0.8" position="0 0 -0.5"></a-camera></a-entity><a-plane class=sky color=#001 height=600 position="0 5 0" rotation="90 0 0" width=600></a-plane><a-plane class=sky color=#001 height=600 position="0 -1 0" rotation="-90 0 0" width=600></a-plane></a-scene>