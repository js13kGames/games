<title>Deadly Taxi</title><style>*{margin:0;padding:0}body{background-color:#000}.myButton{background-color:#44c767;border-radius:28px;border:1px solid #18ab29;display:inline-block;cursor:pointer;color:#fff;font-family:Arial;font-size:17px;padding:16px 31px;text-decoration:none;text-shadow:0 1px 0 #2f6627}.myButton:hover{background-color:#5cbf2a}.myButton:active{position:relative;top:1px}#game{position:absolute;width:600px;height:500px;border:1px solid #000;margin:auto;box-sizing:border-box}#character{width:100px;height:100px;position:absolute;top:300px;left:0}#boy{width:100px;height:100px}#bottom{top:500px;z-index:100;position:absolute;width:300px;height:130px;background-color:#98fbff}#block{width:100px;height:100px;top:500px;position:absolute;animation:slide 1.5s infinite linear}.train{width:100px;height:300px}@keyframes slide{0%{top:-500px}50%{top:500px}55%{top:1000px}100%{top:1000px}}#left,#right{width:50%;position:absolute;height:500px}#right{left:50%}</style><body><script src=https://cdn.jsdelivr.net/npm/near-api-js@0.45.1/dist/near-api-js.min.js></script><center><div id=root></div><div id=game><span style=position:relative;z-index:-1;font-size:600px;left:-110px;top:-100px>üõ£Ô∏è</span><div id=bomb style=position:absolute;z-index:5;font-size:100px;top:500px;left:30px><span>üí•</span></div><div id=left></div><div id=right></div><div id=block><span style=font-size:50px class=train>üß®</span></div><div id=character><span style=position:relative;font-size:100px;top:180px id=boy>üöñ</span></div></div></center><script>let contract,account,wallet,near,nearApi;game.style.visibility="hidden";const accountContract="dev-1663096451057-36206123249674";(async()=>{await async function(){nearAPI=window.nearApi;const{keyStores:e,connect:t,WalletConnection:n}=nearAPI,l={networkId:"testnet",keyStore:new e.BrowserLocalStorageKeyStore,nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};near=await t(l),wallet=new n(near)}();const e=()=>{wallet.requestSignIn(accountContract)},t=()=>{wallet.signOut(),window.location.reload()},n=async()=>await contract.get_greeting();const l=(e,t,n,l,o)=>{let r=document.createElement("button");return document.body.prepend(r),r.classList.add("myButton"),r.style.position="absolute",r.style.left=e+"px",r.style.top=t+"px",r.innerHTML=o,r.style.width=n+"px",r.style.height=l+"px",r.style.zIndex=5,r};let o,r=.1*innerWidth,i=r/2.5;if((o=l(innerWidth/2-r/2,.4*innerHeight-i/2,r,i,"PLAY")).onclick=function(){o.remove(),document.getElementById("nameWallet")?.remove(),document.querySelector("button")?.remove(),s(),a()},wallet.isSignedIn()){const e=wallet.getAccountId();console.log("IS SIGNED IN!",e),account=await near.account(wallet._authData.accountId);const n=await account.state();console.log("STATE",n),contract=new nearAPI.Contract(account,accountContract,{viewMethods:["get_greeting"],changeMethods:["set_greeting"],sender:account}),(but=l(innerWidth/2-r/2,.6*innerHeight-i/2,r,i,"SIGN OUT")).onclick=t,((e,t,n)=>{let l=document.createElement("div"),o=document.createElement("span");root.append(l),l.append(o),o.style.cssText='\n                    font-family: "Lucida Console", Monaco, monospace;\n                    letter-spacing: 0px;\n                    word-spacing: -2px;\n                    color: #000000;\n                    text-decoration: none;\n                    font-style: normal;\n                    font-variant: normal;\n                    text-transform: uppercase;',o.innerHTML=t,o.id=n,o.style.fontSize=parseInt(e.style.height)/2+"px",o.style.color="white",l.style.left=parseInt(e.style.left)-parseInt(getComputedStyle(l).width)/5+"px",l.style.top=parseInt(e.style.top)-parseInt(e.style.height)/2+"px",l.style.position="absolute",l.style.zIndex=5})(but,e,"nameWallet")}else l(innerWidth/2-r/2,.6*innerHeight-i/2,r,i,"SIGN IN").onclick=e;const a=async()=>{const e=document.getElementById("bomb");game.style.visibility="visible",e.style.visibility="hidden";let t=!1;document.addEventListener("keydown",(e=>{"ArrowLeft"===e.key&&r(),"ArrowRight"===e.key&&i()}));let l=document.getElementById("character"),o=document.getElementById("boy");function r(){if(t)return;let e=parseInt(window.getComputedStyle(l).getPropertyValue("left"));e-=200,e>=0&&(l.style.left=e+"px")}function i(){if(t)return;let e=parseInt(window.getComputedStyle(l).getPropertyValue("left"));e+=200,e<600&&(l.style.left=e+"px")}e.style.visibility="hidden",document.getElementById("right").addEventListener("touchstart",i),document.getElementById("left").addEventListener("touchstart",r);let a=document.getElementById("block"),s=0;var c;c=document.createElement("span"),document.body.appendChild(c),c.style.position="absolute",c.style.color="white",c.style.fontSize=.05*innerHeight+"px",c.style.left=innerWidth/2-.055*innerWidth+"px",c.style.top=.03*innerHeight+"px",c.style.zIndex=5,c.innerHTML="üèÜSCORE: 0";const d=parseInt(o.style.top);let p=!0;var y=setInterval((()=>{let e=parseInt(o.style.top);if(e>=d+25&&p)p=!1;else if(p)return void(o.style.top=e+2+"px");e<=d-25&&!p?p=!0:o.style.top=e-2+"px"}),35);await new Promise((e=>setTimeout(e,2e3)));let u=!1;a.addEventListener("animationiteration",(()=>{setTimeout((()=>{let t=Math.floor(3*Math.random());left=100*t,a.style.left=2*left+"px",u||(e.style.left=2*left+"px",e.style.visibility="visible",u=!0)}),10),setTimeout((()=>{e.style.visibility="hidden",u=!1}),17),s++,c.innerHTML=`üèÜSCORE: ${s}`}));let g=setInterval((function(){let e=parseInt(window.getComputedStyle(l).getPropertyValue("left")),o=parseInt(window.getComputedStyle(a).getPropertyValue("left")),r=parseInt(window.getComputedStyle(a).getPropertyValue("top"));if(e==o&&r<2e3&&r>450)return t=!0,a.style.animation="none",clearInterval(g),clearInterval(y),void(wallet.isSignedIn()?(async e=>{let t=await n();if(!t)return void console.log("error");let l=wallet.getAccountId(),o=e,r=t.split("|"),i=[],a=[];for(let e=0;e<r.length;e+=3)i.push(r[e+1]),a.push(parseInt(r[e+2]));i.push(l),a.push(o),console.log(i,a),function(e,t){var n,l,o=[];for(e.sort((function(e,t){var n=e>t?1:e<t?-1:0;return o.push(n),n})),n=0;n<t.length;n++)l=o.concat([]),t[n].sort((function(){return l.splice(0,1)}))}(a,[i]),i.reverse(),a.reverse(),console.log(i,a),i=i.slice(0,10),a=a.slice(0,10);let s="";for(let e=0;e<a.length;e++)s+=`${e+1}|${i[e]}|${a[e]}|`;s.length>0&&(s=s.substr(0,s.length-1)),console.log(s),await contract.set_greeting({message:s}),alert("SCORE: "+o),window.location.reload()})(s):(alert("SCORE: "+s),window.location.reload()))}),1)},s=async()=>{let e=await n(),t=[];t=e.split("|");let l=document.createElement("table");root.append(l),l.style.position="absolute",l.style.color="white",l.style.fontSize=.03*innerHeight+"px",l.style.zIndex=5,l.style.right=.05*innerWidth+"px",l.style.top=.05*innerHeight+"px";let o="";Object.keys(e);for(let e=0;e<t.length;e+=3)o+=`<tr> <td> ${t[e]} </td> <td> | </td>   <td>${t[e+1]}</td>   <td> | </td>   <td>${t[e+2]}</td>    </tr>`;l.innerHTML=o}})()</script>