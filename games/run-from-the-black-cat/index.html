<!doctype html><title>Run from the Black Cat - js13kGames 2025</title><style>body,html{margin:0;padding:0;height:100%;background:#222;display:flex;justify-content:center;align-items:center}canvas{display:block;background:#000}</style><canvas id=c></canvas><script>const c=document.getElementById("c"),ctx=c.getContext("2d");c.width=800,c.height=400;let zzfxV=.3,zzfxX=new AudioContext,zzfx=(t=1,e=.05,c=220,l=0,a=0,n=.1,o=0,i=1,r=0,y=0,x=0,s=0,f=0,h=0,p=0,d=0,w=0,u=1,g=0,m=0,v=0)=>{let S=Math,b=2*S.PI,k=44100,C=r*=500*b/k/k,M=c*=(1-e+2*e*S.random(e=[]))*b/k,R=0,H=0,I=0,P=1,X=0,z=0,B=0,Q=v<0?-1:1,T=b*Q*v*2/k,E=S.cos(T),O=S.sin,A=O(T)/4,D=1+A,L=-2*E/D,G=(1-A)/D,Y=(1+Q*E)/2/D,V=-(Q+E)/D,K=Y,j=0,N=0,U=0,W=0;for(y*=500*b/k**3,p*=b/k,x*=b/k,s*=k,f=k*f|0,t*=zzfxV,Q=(l=k*l+9)+(g*=k)+(a*=k)+(n*=k)+(w*=k)|0;I<Q;e[I++]=B*t)++z%(100*d|0)||(B=o?1<o?2<o?3<o?O(R**3):S.max(S.min(S.tan(R),1),-1):1-(2*R/b%2+2)%2:1-4*S.abs(S.round(R/b)-R/b):O(R),B=(f?1-m+m*O(b*I/f):1)*(B<0?-1:1)*S.abs(B)**i*(I<l?I/l:I<l+g?1-(I-l)/g*(1-u):I<l+g+a?u:I<Q-w?(Q-I-w)/n*u:0),B=w?B/2+(w>I?0:(I<Q-w?1:(Q-I)/w)*e[I-w|0]/2/t):B,v&&(B=W=K*j+V*(j=N)+Y*(N=B)-G*U-L*(U=W))),T=(c+=r+=y)*S.cos(p*H++),R+=T+T*h*O(I**5),P&&++P>s&&(c+=x,M+=x,P=0),!f||++X%f||(c=M,r=C,P=P||1);(t=zzfxX.createBuffer(1,Q,k)).getChannelData(0).set(e),(c=zzfxX.createBufferSource()).buffer=t,c.connect(zzfxX.destination),c.start()},day=!0,timer=15e3,dayLength=3e4,nightLength=3e4,gravity=.3,camX=0,gameState="startMenu";const maxDistance=5e3;let craftingOpen=!1,craftingRecipes=[{name:"Axe",cost:{wood:3,stone:0},time:3},{name:"Pick Axe",cost:{wood:5,stone:2},time:5},{name:"Trap",cost:{wood:2,stone:1},time:5},{name:"Bridge",cost:{wood:3,stone:0},time:5}],craftingQueue=null,player={x:200,y:300,w:20,h:20,vy:0,onGround:!1};woodDamage=1,stoneDamage=1;const speed=3;let interactCooldown=0,musicStarted=!1;function playDayMusic(){window.nightMusicInterval&&(clearInterval(window.nightMusicInterval),window.nightMusicInterval=null),window.dayMusicInterval&&(clearInterval(window.dayMusicInterval),window.dayMusicInterval=null);const t=[[.3,0,440,.1,.3,.2],[.3,0,494,.1,.2,.1],[.3,0,523,.1,.2,.15],[.3,0,494,.1,.2,.1],[.3,0,440,.1,.3,.2],[.3,0,587,.1,.2,.1],[.3,0,659,.1,.2,.15],[.3,0,587,.1,.3,.15],[.3,0,523,.1,.2,.1],[.3,0,494,.1,.2,.1],[.3,0,440,.1,.3,.15],[.3,0,659,.1,.2,.15],[.3,0,587,.1,.2,.1],[.3,0,523,.1,.3,.15],[.3,0,494,.1,.2,.1],[.3,0,440,.1,.4,.2]];let e=0;window.dayMusicInterval=setInterval(()=>{zzfx(...t[e]),e=(e+1)%t.length},1e3)}function playNightMusic(){window.dayMusicInterval&&(clearInterval(window.dayMusicInterval),window.dayMusicInterval=null),window.nightMusicInterval&&(clearInterval(window.nightMusicInterval),window.nightMusicInterval=null);const t=[[.7,0,220,.3,.7,.25],[.7,0,233,.2,.6,.2],[.7,0,196,.3,.8,.25],[.7,0,370,.2,.6,.2],[.7,0,220,.25,.7,.25],[.7,0,247,.2,.6,.2],[.7,0,311,.3,.7,.25],[.7,0,196,.25,.7,.2]];let e=0;window.nightMusicInterval=setInterval(()=>{zzfx(...t[e]),e=(e+1)%t.length},500)}let sfxVolume=.1;function playJumpSound(){zzfx(...[sfxVolume,,440,,.05,.2,1,1.5,0,0,0,0,.01])}function playHitSound(){zzfx(...[sfxVolume,,80,,.02,.05,3,.5,0,0,0,0,.01])}function playCraftSound(){zzfx(...[sfxVolume,,220,,.1,.3,1,1,0,0,0,0,.02])}const inventorySize=8;let craftingMessage=null,inventory={wood:0,stone:0};function addToInventory(t,e){t in inventory||(inventory[t]=0),inventory[t]+=e}function hasResources(t){const e=t.cost||{};return!(e.wood&&inventory.wood<e.wood||e.stone&&inventory.stone<e.stone)}function spendResources(t){const e=t.cost||{};e.wood&&(inventory.wood-=e.wood),e.stone&&(inventory.stone-=e.stone)}function refundResources(t){const e=t.cost||{};e.wood&&(inventory.wood=(inventory.wood||0)+e.wood),e.stone&&(inventory.stone=(inventory.stone||0)+e.stone)}let catHeight=c.height/4,cat={x:0,y:250,w:catHeight,h:catHeight,speed:2,vy:0},blinking=!1,blinkCooldown=1e3+2e3*Math.random(),blinkDuration=0,lastTime=0,signs=[{x:400,y:180,text:"Press A/D to move"},{x:1150,y:180,text:"Press W to jump"},{x:1650,y:180,text:"Safe pillar"},{x:4e3,y:180,text:"Press SPACE to break the stone"},{x:5e3,y:180,text:"Press C to craft a bridge"},{x:7500,y:180,text:"Collect 5 blue orbs to pass"},{x:1e4,y:180,text:"You made it! Congrats!"}],blocks=[{x:0,y:350,w:5e3,h:50},{x:5150,y:350,w:2850,h:50},{x:8150,y:350,w:350,h:50},{x:8650,y:350,w:350,h:50},{x:9150,y:350,w:1e4,h:50},{x:1e3,y:280,w:100,h:20},{x:1150,y:240,w:100,h:20},{x:1300,y:200,w:100,h:20},{x:1450,y:160,w:100,h:20},{x:1600,y:140,w:100,h:1e3},{x:1800,y:0,w:20,h:300},{x:1800,y:280,w:750,h:20},{x:1900,y:210,w:750,h:20},{x:1800,y:140,w:750,h:20},{x:1900,y:70,w:750,h:20},{x:1800,y:0,w:750,h:20},{x:2600,y:70,w:100,h:1e3},{x:5500,y:280,w:100,h:20},{x:5650,y:240,w:100,h:20},{x:5800,y:200,w:100,h:20},{x:5950,y:160,w:100,h:20},{x:6100,y:120,w:100,h:20},{x:6100,y:30,w:100,h:20},{x:6100,y:280,w:100,h:20},{x:6250,y:80,w:100,h:20},{x:6250,y:160,w:100,h:20},{x:6400,y:30,w:100,h:20},{x:6400,y:120,w:100,h:20},{x:6550,y:160,w:100,h:20},{x:6700,y:200,w:100,h:20},{x:6850,y:240,w:100,h:20},{x:7e3,y:280,w:100,h:20}],stopBlocks=[{x:7500,y:100,w:50,h:300,required:5}];stopBlocks.forEach(t=>blocks.push(t));let collectibles=[{x:1580,y:340,collected:!1},{x:2710,y:340,collected:!1},{x:5800,y:340,collected:!1},{x:6100,y:10,collected:!1},{x:6300,y:340,collected:!1},{x:6470,y:10,collected:!1},{x:6440,y:90,collected:!1}],collectedCount=0,stones=[{x:4e3,y:200,w:100,h:150,hp:30},{x:8200,y:200,w:100,h:150,hp:30},{x:8700,y:200,w:100,h:150,hp:30},{x:9300,y:200,w:100,h:150,hp:30}],trees=[{x:1500,y:290,w:22,h:60,hp:10,maxHp:10},{x:3020,y:290,w:22,h:60,hp:10,maxHp:10},{x:3075,y:290,w:22,h:60,hp:10,maxHp:10},{x:3200,y:290,w:22,h:60,hp:10,maxHp:10},{x:3500,y:290,w:22,h:60,hp:10,maxHp:10},{x:3600,y:290,w:22,h:60,hp:10,maxHp:10},{x:3700,y:290,w:22,h:60,hp:10,maxHp:10},{x:3810,y:290,w:22,h:60,hp:10,maxHp:10},{x:4200,y:290,w:22,h:60,hp:10,maxHp:10},{x:4500,y:290,w:22,h:60,hp:10,maxHp:10},{x:4600,y:290,w:22,h:60,hp:10,maxHp:10},{x:4700,y:290,w:22,h:60,hp:10,maxHp:10},{x:5200,y:290,w:22,h:60,hp:10,maxHp:10},{x:5300,y:290,w:22,h:60,hp:10,maxHp:10},{x:5350,y:290,w:22,h:60,hp:10,maxHp:10},{x:5450,y:290,w:22,h:60,hp:10,maxHp:10},{x:5550,y:290,w:22,h:60,hp:10,maxHp:10},{x:5700,y:290,w:22,h:60,hp:10,maxHp:10},{x:5790,y:290,w:22,h:60,hp:10,maxHp:10},{x:5850,y:290,w:22,h:60,hp:10,maxHp:10},{x:6150,y:290,w:22,h:60,hp:10,maxHp:10},{x:6240,y:290,w:22,h:60,hp:10,maxHp:10},{x:6880,y:290,w:22,h:60,hp:10,maxHp:10},{x:7050,y:290,w:22,h:60,hp:10,maxHp:10},{x:7250,y:290,w:22,h:60,hp:10,maxHp:10},{x:7350,y:290,w:22,h:60,hp:10,maxHp:10},{x:7050,y:290,w:22,h:60,hp:10,maxHp:10},{x:7250,y:290,w:22,h:60,hp:10,maxHp:10},{x:7350,y:290,w:22,h:60,hp:10,maxHp:10}],traps=[],keys={},prevKeys={};const keyPressed=t=>keys[t]&&!prevKeys[t],keyReleased=t=>!keys[t]&&prevKeys[t];onkeydown=t=>keys[t.key]=!0,onkeyup=t=>keys[t.key]=!1,document.addEventListener("keydown",t=>{"KeyC"===t.code&&(craftingOpen=!craftingOpen)}),document.addEventListener("keydown",t=>{"Escape"===t.key&&(craftingQueue?(refundResources(craftingQueue.recipe),craftingQueue=null):craftingOpen&&(craftingOpen=!1))});let mouse={x:0,y:0};c.addEventListener("mousemove",t=>{const e=c.getBoundingClientRect();mouse.x=t.clientX-e.left,mouse.y=t.clientY-e.top}),c.addEventListener("mousedown",t=>{if(!craftingOpen)return;const e=c.getBoundingClientRect(),l=t.clientX-e.left,a=t.clientY-e.top,n=(c.width-186)/2+10,o=(c.height-186)/2+10;craftingRecipes.forEach((t,e)=>{const c=e%3,i=Math.floor(e/3),r=n+58*c,y=o+58*i;l>r&&l<r+50&&a>y&&a<y+50&&(craftingQueue||(hasResources(t)?(console.log("has resources:",hasResources(t)),console.log("Klick p!!Ã¥:",t.name),spendResources(t),craftingQueue={recipe:t,timeLeft:t.time},craftingOpen=!1):(craftingMessage="Not enough resources!",setTimeout(()=>craftingMessage=null,2e3))))})}),c.addEventListener("mousemove",t=>{const e=c.getBoundingClientRect();mouse.x=t.clientX-e.left,mouse.y=t.clientY-e.top});const eyeR=60,pupilR=18,eyeOffsetX=130,eyeY=c.height/2;function drawEye(t,e){ctx.save(),ctx.shadowColor="rgba(255, 230, 80, 0.9)",ctx.shadowBlur=25,ctx.fillStyle="rgb(255, 220, 60)",ctx.beginPath(),ctx.arc(t,e,60,0,2*Math.PI),ctx.fill(),ctx.restore();const c=mouse.x-t,l=mouse.y-e,a=Math.hypot(c,l)||1,n=t+c/a*Math.min(a,36),o=e+l/a*Math.min(a,36);ctx.fillStyle="#000",ctx.beginPath(),ctx.arc(n,o,18,0,2*Math.PI),ctx.fill(),ctx.fillStyle="rgba(255,255,255,0.7)",ctx.beginPath(),ctx.arc(n-7.2,o-7.2,3,0,2*Math.PI),ctx.fill()}function drawStartMenu(){ctx.fillStyle="#000",ctx.fillRect(0,0,c.width,c.height);const t=c.width/2;drawEye(t-130,eyeY),drawEye(t+130,eyeY),ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="red",ctx.font="36px monospace",ctx.shadowColor="rgba(255,0,0,0.35)",ctx.shadowBlur=10,ctx.fillText("Run from the black cat",c.width/2,eyeY-60-50),ctx.font="18px monospace",ctx.textAlign="left",ctx.textBaseline="bottom",ctx.shadowBlur=0;const e="Click to Start",l=ctx.measureText(e).width,a=c.height-20,n=mouse.x>=620&&mouse.x<=620+l&&mouse.y>=a-24&&mouse.y<=a;ctx.fillStyle=n?"yellow":"white",ctx.fillText(e,620,a),c.addEventListener("click",t=>{"startMenu"===gameState&&(t.offsetX,t.offsetY,n&&("suspended"===zzfxX.state&&zzfxX.resume(),playDayMusic(),gameState="playing"))})}function drawSigns(){ctx.font="16px monospace",ctx.textAlign="center",ctx.textBaseline="bottom";for(let t of signs)ctx.fillStyle=day?"black":"white",ctx.fillText(t.text,t.x-camX,t.y-10)}function drawWin(){ctx.fillStyle="black",ctx.fillRect(0,0,c.width,c.height),ctx.fillStyle="yellow",ctx.font="40px monospace",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("YOU WIN!",c.width/2,c.height/2),ctx.font="20px monospace",ctx.fillText("Press F5 to restart",c.width/2,c.height/2+50)}function drawOrbCount(){collectedCount<=0||(ctx.font="20px monospace",ctx.fillStyle="cyan",ctx.textAlign="left",ctx.textBaseline="top",ctx.fillText(`Blue Orbs: ${collectedCount}`,20,60))}function drawCrafting(){if(!craftingOpen)return;const t=50,e=(c.width-186)/2,l=(c.height-186)/2;ctx.fillStyle="rgba(0,0,0,0.7)",ctx.fillRect(e,l,186,186),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="12px Arial",craftingRecipes.forEach((c,a)=>{const n=a%3,o=Math.floor(a/3),i=e+10+58*n,r=l+10+58*o;ctx.fillStyle="rgba(60,60,60,0.9)",ctx.fillRect(i,r,t,t),ctx.strokeStyle="#fff",ctx.strokeRect(i,r,t,t),ctx.fillStyle="#fff",ctx.fillText(c.name,i+25,r+25)});const a=mouse.x,n=mouse.y;craftingRecipes.forEach((c,o)=>{const i=o%3,r=Math.floor(o/3),y=e+10+58*i,x=l+10+58*r;if(a>y&&a<y+t&&n>x&&n<x+t){const t=Object.entries(c.cost).filter(([t,e])=>e>0).map(([t,e])=>`${e} ${t}`).join(", "),e=t+(t?", ":"")+`${c.time}s`,l=ctx.measureText(e).width+10,o=20;ctx.fillStyle="rgba(0,0,0,0.8)",ctx.fillRect(a+10,n+10,l,o),ctx.fillStyle="#fff",ctx.fillText(e,a+10+l/2,n+10+o/2)}})}function drawCraftingProgress(){if(craftingQueue){const t=200,e=20,l=(c.width-t)/2,a=c.height-60;ctx.fillStyle="rgba(0,0,0,0.5)",ctx.fillRect(l,a,t,e),ctx.fillStyle="lime";const n=1-craftingQueue.timeLeft/craftingQueue.recipe.time;ctx.fillRect(l,a,t*n,e)}if(craftingQueue){const t=200,e=20,l=(c.width-t)/2,a=c.height-60,n=(craftingQueue.recipe.time-craftingQueue.timeLeft)/craftingQueue.recipe.time;ctx.fillStyle="rgba(0,0,0,0.7)",ctx.fillRect(l,a,t,e),ctx.fillStyle="lime",ctx.fillRect(l,a,t*n,e),ctx.strokeStyle="#fff",ctx.strokeRect(l,a,t,e),ctx.fillStyle="#fff",ctx.textAlign="center",ctx.fillText(craftingQueue.recipe.name+" ("+craftingQueue.recipe.time+"s)",l+t/2,a-5)}}function drawTraps(){for(let t of traps)t.active&&(ctx.fillStyle="orange",ctx.fillRect(t.x-camX,t.y,t.w,t.h))}function drawInventory(){if(Object.values(inventory).every(t=>0===t))return;const t=40,e=Object.keys(inventory).filter(t=>inventory[t]>0),l=46*e.length-6,a=(c.width-l)/2,n=c.height-t-10;ctx.font="14px Arial",ctx.textAlign="right",ctx.textBaseline="bottom",e.forEach((e,c)=>{const l=a+46*c;ctx.fillStyle="rgba(50,50,50,0.7)",ctx.fillRect(l,n,t,t),ctx.strokeStyle="#fff",ctx.strokeRect(l,n,t,t),"wood"===e?(ctx.fillStyle="#8B4513",ctx.fillRect(l+10,n+10,20,20)):"stone"===e&&(ctx.fillStyle="#777",ctx.fillRect(l+10,n+10,20,20)),ctx.fillStyle="#fff",ctx.fillText(inventory[e],l+t-3,n+t-3)})}function drawCollectibles(){collectibles.forEach(t=>{t.collected||(ctx.fillStyle="blue",ctx.beginPath(),ctx.arc(t.x-camX,t.y,10,0,2*Math.PI),ctx.fill())})}function drawTrees(){for(const t of trees){ctx.fillStyle=day?"#5e2b08ff":"#555",ctx.fillRect(t.x-camX,t.y,t.w,t.h);const e=t.x-camX+t.w/2,c=t.y-10;if(ctx.fillStyle=day?"#2e8b57":"#444",ctx.beginPath(),ctx.ellipse(e,c,1.4*t.w,18,0,0,2*Math.PI),ctx.fill(),t.hp<t.maxHp&&t.hp>0){const e=t.w,c=3,l=t.x-camX,a=t.y-6;ctx.fillStyle="#333",ctx.fillRect(l,a,e,c),ctx.fillStyle="#4caf50",ctx.fillRect(l,a,e*(t.hp/t.maxHp),c),ctx.strokeStyle="#000",ctx.strokeRect(l,a,e,c)}}}function drawCat(){if(!0===day)ctx.fillStyle="black",ctx.fillRect(cat.x-camX,cat.y,cat.w,cat.h),ctx.fillStyle="white",ctx.font="16px monospace",ctx.fillText("Zzz",cat.x-camX+20,cat.y-10);else if(ctx.fillStyle="black",ctx.fillRect(cat.x-camX,cat.y,cat.w,cat.h-10),!blinking){let t=cat.y+cat.h/2-20,e=cat.x-camX+.3*cat.w,c=cat.x-camX+.7*cat.w,l=.2*cat.h,a=.4*l;ctx.fillStyle="yellow",ctx.beginPath(),ctx.arc(e,t,l,0,2*Math.PI),ctx.arc(c,t,l,0,2*Math.PI),ctx.fill(),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(e,t,a,0,2*Math.PI),ctx.arc(c,t,a,0,2*Math.PI),ctx.fill()}}function drawPlayer(){ctx.fillStyle="lime",ctx.fillRect(player.x-camX,player.y,player.w,player.h),craftingQueue&&(ctx.fillStyle="yellow",ctx.fillRect(player.x-camX,player.y-10,player.w,5))}function drawBackground(){let t;day?(t=ctx.createLinearGradient(0,0,0,c.height),t.addColorStop(0,"#87CEEB"),t.addColorStop(1,"#ffffff")):(t=ctx.createLinearGradient(0,0,0,c.height),t.addColorStop(0,"#0a0a4bff"),t.addColorStop(1,"#000000")),ctx.fillStyle=t,ctx.fillRect(0,0,c.width,c.height)}function drawPlattform(){ctx.fillStyle=day?"#8B4513":"#303030ff";for(let t of blocks)ctx.fillRect(t.x-camX,t.y,t.w,t.h);ctx.fillStyle="gray";for(let t of stones){t.maxHp||(t.maxHp=t.hp),ctx.fillRect(t.x-camX,t.y,t.w,t.h);const e=40,c=Math.max(0,t.hp/t.maxHp),l=t.x-camX+t.w/2-e/2,a=t.y-8;ctx.fillStyle="darkred",ctx.fillRect(l,a,e,4),ctx.fillStyle="red",ctx.fillRect(l,a,e*c,4),ctx.strokeStyle="black",ctx.strokeRect(l,a,e,4),ctx.fillStyle="gray"}}function drawGameOver(){ctx.fillStyle="rgba(0,0,0,0.7)",ctx.fillRect(0,0,c.width,c.height),ctx.fillStyle="red",ctx.font="30px monospace",ctx.fillText("GAME OVER",c.width/2-80,c.height/2),ctx.fillStyle="white",ctx.font="16px monospace",ctx.fillText("Press F5 to restart",c.width/2-100,c.height/2+30)}function rectsOverlap(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function loop(){if(requestAnimationFrame(loop),"startMenu"===gameState&&drawStartMenu(),"gameOver"===gameState&&drawGameOver(),"win"===gameState&&drawWin(),"playing"===gameState){timer-=16,timer<=0&&(day=!day,timer=day?dayLength:nightLength,day?playDayMusic():playNightMusic()),(player.y>c.height+200||player.x>c.width+camX+200)&&(gameState="gameOver"),interactCooldown>0&&(interactCooldown-=16);let t=0;craftingQueue||(keys.a&&(t-=3),keys.d&&(t+=3),keyPressed("w")&&player.onGround&&(playJumpSound(),player.vy=-7.5,player.onGround=!1));const e=blocks.concat(stones);player.vy+=gravity,player.y+=player.vy,player.onGround=!1;for(let t of blocks)player.x<t.x+t.w&&player.x+player.w>t.x&&player.y<t.y+t.h&&player.y+player.h>t.y&&(player.vy>0&&player.y+player.h>t.y&&player.y<t.y?(player.y=t.y-player.h,player.vy=0,player.onGround=!0):player.vy<0&&player.y<t.y+t.h&&player.y+player.h>t.y+t.h&&(player.y=t.y+t.h,player.vy=0));player.x+=t;for(const c of e)player.x<c.x+c.w&&player.x+player.w>c.x&&player.y<c.y+c.h&&player.y+player.h>c.y&&(t>0?player.x=c.x-player.w:t<0&&(player.x=c.x+c.w));player.vy+=gravity,player.y+=player.vy,player.onGround=!1;for(const t of e)player.x<t.x+t.w&&player.x+player.w>t.x&&player.y<t.y+t.h&&player.y+player.h>t.y&&(player.vy>0?(player.y=t.y-player.h,player.vy=0,player.onGround=!0):player.vy<0&&(player.y=t.y+t.h,player.vy=0));if(keys[" "]&&interactCooldown<=0){const t=12,e=()=>{interactCooldown=200};let c=!1;if(void 0!==stones){for(const e of stones)if(player.x+player.w>e.x-t&&player.x<e.x+e.w+t&&player.y+player.h>e.y-t&&player.y<e.y+e.h+t&&e.hp>0){playHitSound(),e.hp=e.hp-stoneDamage,e.hitCooldown=10,c=!0,e.hp<=0&&(console.log("added to inventory"),addToInventory("stone",3));break}stones=stones.filter(t=>t.hp>0)}if(!c){for(const e of trees)if(player.x+player.w>e.x-t&&player.x<e.x+e.w+t&&player.y+player.h>e.y-t&&player.y<e.y+e.h+t&&e.hp>0){playHitSound(),e.hp=e.hp-woodDamage,c=!0,e.hp<=0&&(console.log("added to inventory"),addToInventory("wood",1));break}trees=trees.filter(t=>t.hp>0)}c&&e(),keys[" "]=!1}for(let t of stones)t.hitCooldown&&t.hitCooldown--;if(stones=stones.filter(t=>t.hp>0),!1===day){for(let t of traps)t.active&&cat.x<t.x+t.w&&cat.x+cat.w>t.x&&cat.y<t.y+t.h&&cat.y+cat.h>t.y&&(t.active=!1,cat.stunnedUntil=Date.now()+1e4);if(void 0===cat.vx&&(cat.vx=0),!(cat.stunnedUntil&&Date.now()<cat.stunnedUntil)){const t=cat.x+cat.w/2,e=player.x+player.w/2;if(cat.onGround){t<e-5?cat.x+=cat.speed:t>e+5&&(cat.x-=cat.speed);const c=Math.abs(t-e),l=player.y-cat.y;c<150&&l<-50&&(cat.vy=-15,cat.vx=e>t?4:-4,cat.onGround=!1)}}cat.onGround||(cat.x+=cat.vx),cat.vy+=gravity,cat.y+=cat.vy;const t=c.height-40;cat.y+cat.h>t?(cat.y=t-cat.h,cat.vy=0,cat.vx=0,cat.onGround=!0):cat.onGround=!1,blinking?(blinkDuration-=30,blinkDuration<=0&&(blinking=!1,blinkCooldown=1500+2e3*Math.random())):(blinkCooldown-=10,blinkCooldown<=0&&(blinking=!0,blinkDuration=180)),player.x<cat.x+cat.w&&player.x+player.w>cat.x&&player.y<cat.y+cat.h&&player.y+player.h>cat.y&&(gameState="gameOver")}if(!0===day&&(blinking=!1,blinkDuration=0),camX=player.x-c.width/2,camX<0&&(camX=0),craftingQueue&&(playCraftSound(),craftingQueue.timeLeft-=1/60,craftingQueue.timeLeft<=0)){console.log("klar:",craftingQueue.recipe.name),"Axe"===craftingQueue.recipe.name&&(woodDamage=5),"Pick Axe"===craftingQueue.recipe.name&&(stoneDamage=5),"Bridge"===craftingQueue.recipe.name&&blocks.push({x:player.x+player.w+10,y:player.y+player.h-10,w:100,h:20}),"Trap"===craftingQueue.recipe.name&&traps.push({x:player.x,y:c.height-60,w:15,h:15,active:!0});let t=craftingQueue.recipe.name.toLowerCase();inventory[t]=(inventory[t]||0)+1,craftingQueue=null}drawBackground(),drawPlattform(),drawTrees(),drawCollectibles(),drawCat(),drawPlayer(),drawTraps(),drawInventory(),drawCrafting(),drawCraftingProgress(),drawOrbCount(),drawSigns(),player.x>=1e4&&(gameState="win"),collectibles.forEach(t=>{!t.collected&&player.x<t.x+10&&player.x+player.w>t.x-10&&player.y<t.y+10&&player.y+player.h>t.y-10&&(t.collected=!0,collectedCount++,console.log("Collected:",collectedCount),stopBlocks.forEach(t=>{collectedCount>=t.required&&(blocks=blocks.filter(e=>e!==t))}))}),craftingMessage&&(ctx.fillStyle="red",ctx.font="20px Arial",ctx.fillText(craftingMessage,c.width/2-80,c.height/2-100))}prevKeys={...keys}}loop()</script>