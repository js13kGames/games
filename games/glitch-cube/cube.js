!function(){var t,i=window.GlitchCube=function(t){return this.init(t)},e=i.Utils={EPS:.001,PI_HALF:Math.PI/2,PI_180:Math.PI/180,COS80:Math.cos(80*Math.PI/180),colorFloat2Int:function(t){return Math.round(255*t)}};t=function(){function t(){this.elements=new Float32Array(16)}return t.prototype={setFrustum:function(t,i,e,s,n,r){var o=this.elements,a=1/(i-t),h=1/(s-e),u=1/(r-n);return o[0]=2*n*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n*h,o[6]=0,o[7]=0,o[8]=(i+t)*a,o[9]=(s+e)*h,o[10]=-(r+n)*u,o[11]=-1,o[12]=0,o[13]=0,o[14]=-2*n*r*u,o[15]=0,this},setPerspective:function(t,i,e,s){var n=e*Math.tan(.5*t),r=-n,o=n*i,a=-o;return this.setFrustum(a,o,r,n,e,s)},setLookAt:function(t,i,e,s,n,r,o,a,h){var u=this.elements,l=s-t,c=n-i,f=r-e,d=1/Math.sqrt(l*l+c*c+f*f);l*=d,c*=d,f*=d;var m=c*h-f*a,p=f*o-l*h,g=l*a-c*o,b=1/Math.sqrt(m*m+p*p+g*g);m*=b,p*=b,g*=b;var v=p*f-g*c,x=g*l-m*f,M=m*c-p*l;return u[0]=m,u[1]=v,u[2]=-l,u[3]=0,u[4]=p,u[5]=x,u[6]=-c,u[7]=0,u[8]=g,u[9]=M,u[10]=-f,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this.translate(-t,-i,-e)},translate:function(t,i,e){var s=this.elements;return s[12]+=s[0]*t+s[4]*i+s[8]*e,s[13]+=s[1]*t+s[5]*i+s[9]*e,s[14]+=s[2]*t+s[6]*i+s[10]*e,s[15]+=s[3]*t+s[7]*i+s[11]*e,this},makeTranslate:function(t,i,e){var s=this.elements;s[12]=t,s[13]=i,s[14]=e},setIdentity:function(){var t=this.elements;t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1},setRotateX:function(t){var i=this.elements,e=Math.cos(t),s=Math.sin(t);return i[0]=1,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=e,i[9]=-s,i[13]=0,i[2]=0,i[6]=s,i[10]=e,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},setRotateY:function(t){var i=this.elements,e=Math.cos(t),s=Math.sin(t);return i[0]=e,i[4]=0,i[8]=s,i[12]=0,i[1]=0,i[5]=1,i[9]=0,i[13]=0,i[2]=-s,i[6]=0,i[10]=e,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},setRotateZ:function(t){var i=this.elements,e=Math.cos(t),s=Math.sin(t);return i[0]=e,i[4]=-s,i[8]=0,i[12]=0,i[1]=s,i[5]=e,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=1,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},multiplyVector:function(t){var i=this.elements,e=i[0]*t.x+i[4]*t.y+i[8]*t.z+i[12],n=i[1]*t.x+i[5]*t.y+i[9]*t.z+i[13],r=i[2]*t.x+i[6]*t.y+i[10]*t.z+i[14],o=i[3]*t.x+i[7]*t.y+i[11]*t.z+i[15];return e/=o,n/=o,r/=o,new s(e,n,r)},transpose:function(){var t,i=this.elements;t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t},setInverseOf:function(t){var i=this.elements,e=t.elements,s=e[0],n=e[4],r=e[8],o=e[12],a=e[1],h=e[5],u=e[9],l=e[13],c=e[2],f=e[6],d=e[10],m=e[14],p=e[3],g=e[7],b=e[11],v=e[15];i[0]=u*m*g-l*d*g+l*f*b-h*m*b-u*f*v+h*d*v,i[4]=o*d*g-r*m*g-o*f*b+n*m*b+r*f*v-n*d*v,i[8]=r*l*g-o*u*g+o*h*b-n*l*b-r*h*v+n*u*v,i[12]=o*u*f-r*l*f-o*h*d+n*l*d+r*h*m-n*u*m,i[1]=l*d*p-u*m*p-l*c*b+a*m*b+u*c*v-a*d*v,i[5]=r*m*p-o*d*p+o*c*b-s*m*b-r*c*v+s*d*v,i[9]=o*u*p-r*l*p-o*a*b+s*l*b+r*a*v-s*u*v,i[13]=r*l*c-o*u*c+o*a*d-s*l*d-r*a*m+s*u*m,i[2]=h*m*p-l*f*p+l*c*g-a*m*g-h*c*v+a*f*v,i[6]=o*f*p-n*m*p-o*c*g+s*m*g+n*c*v-s*f*v,i[10]=n*l*p-o*h*p+o*a*g-s*l*g-n*a*v+s*h*v,i[14]=o*h*c-n*l*c-o*a*f+s*l*f+n*a*m-s*h*m,i[3]=u*f*p-h*d*p-u*c*g+a*d*g+h*c*b-a*f*b,i[7]=n*d*p-r*f*p+r*c*g-s*d*g-n*c*b+s*f*b,i[11]=r*h*p-n*u*p-r*a*g+s*u*g+n*a*b-s*h*b,i[15]=n*u*c-r*h*c+r*a*f-s*u*f-n*a*d+s*h*d;var x=s*i[0]+a*i[4]+c*i[8]+p*i[12];if(0!==x){x=1/x;for(var M=0;M<16;M++)i[M]*=x}}},t.FromValues=function(i,e,s,n,r,o,a,h,u,l,c,f,d,m,p,g){var b=new t;return b.elements[0]=i,b.elements[1]=e,b.elements[2]=s,b.elements[3]=n,b.elements[4]=r,b.elements[5]=o,b.elements[6]=a,b.elements[7]=h,b.elements[8]=u,b.elements[9]=l,b.elements[10]=c,b.elements[11]=f,b.elements[12]=d,b.elements[13]=m,b.elements[14]=p,b.elements[15]=g,b},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.multiplyTo=function(t,i,e){var s=t.elements,n=i.elements,r=e.elements;r[0]=s[0]*n[0]+s[4]*n[1]+s[8]*n[2]+s[12]*n[3],r[4]=s[0]*n[4]+s[4]*n[5]+s[8]*n[6]+s[12]*n[7],r[8]=s[0]*n[8]+s[4]*n[9]+s[8]*n[10]+s[12]*n[11],r[12]=s[0]*n[12]+s[4]*n[13]+s[8]*n[14]+s[12]*n[15],r[1]=s[1]*n[0]+s[5]*n[1]+s[9]*n[2]+s[13]*n[3],r[5]=s[1]*n[4]+s[5]*n[5]+s[9]*n[6]+s[13]*n[7],r[9]=s[1]*n[8]+s[5]*n[9]+s[9]*n[10]+s[13]*n[11],r[13]=s[1]*n[12]+s[5]*n[13]+s[9]*n[14]+s[13]*n[15],r[2]=s[2]*n[0]+s[6]*n[1]+s[10]*n[2]+s[14]*n[3],r[6]=s[2]*n[4]+s[6]*n[5]+s[10]*n[6]+s[14]*n[7],r[10]=s[2]*n[8]+s[6]*n[9]+s[10]*n[10]+s[14]*n[11],r[14]=s[2]*n[12]+s[6]*n[13]+s[10]*n[14]+s[14]*n[15],r[3]=s[3]*n[0]+s[7]*n[1]+s[11]*n[2]+s[15]*n[3],r[7]=s[3]*n[4]+s[7]*n[5]+s[11]*n[6]+s[15]*n[7],r[11]=s[3]*n[8]+s[7]*n[9]+s[11]*n[10]+s[15]*n[11],r[15]=s[3]*n[12]+s[7]*n[13]+s[11]*n[14]+s[15]*n[15]},t}();var s=function(){function t(t,i,e){this.x=t,this.y=i,this.z=e}return t.prototype={toArray:function(){return[this.x,this.y,this.z]},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},sub:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},normalize:function(){var t=this.length();this.x/=t,this.y/=t,this.z/=t},clone:function(){return new t(this.x,this.y,this.z)}},t.sub=function(t,i){var e=t.clone();return e.sub(i),e},t}(),n=function(){function i(i,e,n,r,o){this.enabled=!0,this.canvas=null,this.fovY=i,this.aspect=e,this.near=n,this.far=r,this.zoomInertia=.9,this.rotateInertia=.9,this.zoomSensibility=1,this.zoomOffset=0,this.rotateSensibility=.01,this.rotateOffsetX=0,this.rotateOffsetY=0,this.rotationX=0,this.rotationY=0,this.rotateKeySensibility=10,this.keys=[],this.minDistance=110,this.maxDistance=210,this.position=new s(o.x,o.y,o.z),this.applyPosition(),this.mouse={x:0,y:0,down:!1,dx:0,dy:0},this.vMatrix=t.Identity(),this.pMatrix=t.Identity(),this.updateMatrices()}return i.prototype={update:function(){if(this.checkKeys(),Math.abs(this.zoomOffset)<e.EPS&&(this.zoomOffset=0),Math.abs(this.rotateOffsetX)<e.EPS&&(this.rotateOffsetX=0),Math.abs(this.rotateOffsetY)<e.EPS&&(this.rotateOffsetY=0),this.zoomOffset||this.rotateOffsetX||this.rotateOffsetY){if((this.rotateOffsetX||this.rotateOffsetY)&&(this.rotationX+=this.rotateOffsetX,this.rotationY+=this.rotateOffsetY,this.rotateOffsetX*=this.rotateInertia,this.rotateOffsetY*=this.rotateInertia,this.checkRotateLimits(),this.applyRotation()),this.zoomOffset){var t=this.distance;this.distance+=this.zoomOffset,this.zoomOffset*=this.zoomInertia,this.checkZoomLimits();var i=this.distance/t;this.position.x*=i,this.position.y*=i,this.position.z*=i}this.updateViewMatrix()}},checkKeys:function(){for(var t,i=0,e=0,s=0;s<this.keys.length;s++)switch(t=this.keys[s]){case 39:i-=this.rotateKeySensibility;break;case 37:i+=this.rotateKeySensibility;break;case 40:e-=this.rotateKeySensibility;break;case 38:e+=this.rotateKeySensibility}0==i&&0==e||this.rotateXY(i,e)},applyPosition:function(){this.distance=this.position.length(),this.rotationX=Math.acos(this.position.y/this.distance)/e.PI_180,this.rotationY=-Math.atan2(this.position.z,this.position.x)/e.PI_180,this.rotationY<0&&(this.rotationY+=360)},applyRotation:function(){var t=this.rotationY*e.PI_180,i=this.rotationX*e.PI_180;this.position.x=Math.sin(i)*Math.cos(t)*this.distance,this.position.y=Math.cos(i)*this.distance,this.position.z=-Math.sin(i)*Math.sin(t)*this.distance},checkRotateLimits:function(){(this.rotationY>=360||this.rotationY<=-360)&&(this.rotationY=this.rotationY%360),this.rotationY<0&&(this.rotationY+=360),this.rotationX>=170?(this.rotationX=170,this.rotateOffsetX=0):this.rotationX<=10&&(this.rotationX=10,this.rotateOffsetX=0)},checkZoomLimits:function(){this.distance>=this.maxDistance&&(this.distance=this.maxDistance,this.zoomOffset=0),this.distance<=this.minDistance&&(this.distance=this.minDistance,this.zoomOffset=0)},updateMatrices:function(){this.updateProjectMatrix(),this.updateViewMatrix()},updateProjectMatrix:function(t){t&&(this.aspect=t),this.pMatrix.setPerspective(this.fovY,this.aspect,this.near,this.far)},updateViewMatrix:function(){this.vMatrix.setLookAt(this.position.x,this.position.y,this.position.z,0,0,0,0,1,0)},onMouseWheel:function(t){if(this.enabled){t.preventDefault();var i=1;t.wheelDelta?i=t.wheelDelta>0?1:-1:t.detail&&(i=t.detail>0?-1:1),this.zoom(-i)}},zoom:function(t){this.zoomOffset=t*this.zoomSensibility},onMouseDown:function(t){if(this.enabled){this.mouse.down=!0;var i=u(t,this.canvas);this.mouse.x=i.x,this.mouse.y=i.y}},onMouseUp:function(t){this.mouse.down=!1},onMouseOut:function(t){this.mouse.down=!1},onMouseMove:function(t){if(this.enabled&&this.mouse.down){var i=u(t,this.canvas),e=i.x-this.mouse.x,s=i.y-this.mouse.y;this.mouse.x=i.x,this.mouse.y=i.y,this.rotateXY(e,s)}},rotateXY:function(t,i){this.rotateOffsetX+=-i*this.rotateSensibility,this.rotateOffsetY+=-t*this.rotateSensibility},onKeyDown:function(t){[39,37,40,38].indexOf(t.which)!==-1&&this.keys.indexOf(t.which)===-1&&this.keys.push(t.which)},onKeyUp:function(t){if([39,37,40,38].indexOf(t.which)!==-1){var i=this.keys.indexOf(t.which);i>=0&&this.keys.splice(i,1)}},attachControl:function(t){this.canvas=t;var i=this,e="mouse";t.addEventListener("DOMMouseScroll",function(t){i.onMouseWheel(t)},!1),t.addEventListener(e+"wheel",function(t){i.onMouseWheel(t)},!1),this.canvas.addEventListener(e+"down",function(t){i.onMouseDown(t)},!1),this.canvas.addEventListener(e+"move",function(t){i.onMouseMove(t)},!1),this.canvas.addEventListener(e+"up",function(t){i.onMouseUp(t)},!1),this.canvas.addEventListener(e+"out",function(t){i.onMouseOut(t)},!1),document.addEventListener("keydown",function(t){i.onKeyDown(t)},!1),document.addEventListener("keyup",function(t){i.onKeyUp(t)},!1)}},i}(),r=function(){function i(i,e,n,r,o,a){this.isReady=!1,this.name=i,this.vertices=new Float32Array(e),this.indices=new Uint8Array(n),this.normals=new Float32Array(r),this.drawMode=a,this.textureCoords=new Float32Array([]),this.material=o,this.elementsCnt=n.length,this.position=new s(0,0,0),this.rotation=new s(0,0,0),this.mMatrix=t.Identity(),this.parentMatrix=t.Identity(),this.worldMatrix=t.Identity(),this.data=null,this.vbo=null,this.ibo=null,this.nbo=null,this.tbo=null}return i.prototype={setTextureCoords:function(t){this.textureCoords=new Float32Array(t)},updateMatrices:function(){this.rotation.x?this.mMatrix.setRotateX(this.rotation.x):this.rotation.y?this.mMatrix.setRotateY(this.rotation.y):this.rotation.z?this.mMatrix.setRotateZ(this.rotation.z):this.mMatrix.setIdentity(),this.setTranslate(this.position.x,this.position.y,this.position.z)},updateWorldMatrix:function(){t.multiplyTo(this.parentMatrix,this.mMatrix,this.worldMatrix)},setParentMatrix:function(t){this.parentMatrix=t},setTranslate:function(t,i,e){this.position.x=t,this.position.y=i,this.position.z=e,this.mMatrix.makeTranslate(this.position.x,this.position.y,this.position.z)}},i}(),o=function(){function i(i,e){this.cube=e,this.name=i,this.sideMeshes=[],this.position=new s(0,0,0),this.rotation=new s(0,0,0),this.mMatrix=t.Identity()}return i.prototype={addSide:function(t){t.setParentMatrix(this.mMatrix),this.sideMeshes.push(t),this.cube.meshes.push(t)}},i.prototype.updateMatrices=r.prototype.updateMatrices,i.prototype.setTranslate=r.prototype.setTranslate,i}(),a=function(){function t(t){this.position=new s(t.x,t.y,t.z)}return t}(),h=function(){function t(t,i,e,n){this.name=t,this.color=i,this.color||(this.color=new s(1,1,1)),this.textureSrc=e,this.textureImg=null,this.textureReady=!1,this.texture=null,this.cbo=null,this.colors=null,this.textureData=null,this.gl=n,this.crossOrigin=null,this.initTexture()}return t.prototype={setColors:function(t){this.colors=new Float32Array(t)},setCrossOrigin:function(t){this.crossOrigin=t},initTexture:function(){var t=e.colorFloat2Int(this.color.x),i=e.colorFloat2Int(this.color.y),s=e.colorFloat2Int(this.color.z);this.textureData=new Uint8Array([t,i,s]),this.texture=this.gl.createTexture(),this.prepareTexture()},loadTexture:function(){if(this.textureSrc){this.textureImg=new Image;var t=this;this.crossOrigin&&(this.textureImg.crossOrigin=this.crossOrigin),this.textureImg.onload=this.textureImg.onerror=function(i){i&&"error"!==i.type&&(t.textureReady=!0,t.prepareTexture())},this.textureImg.src=this.textureSrc}},prepareTexture:function(){this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.textureReady?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB,this.gl.RGB,this.gl.UNSIGNED_BYTE,this.textureImg):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB,1,1,0,this.gl.RGB,this.gl.UNSIGNED_BYTE,this.textureData),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},t}();i.prototype={vxShader:["attribute vec3 aPosition;","attribute vec3 aNormal;","attribute vec4 aColor;","uniform mat4 uPMatrix;","uniform mat4 uVMatrix;","uniform mat4 uMMatrix;","uniform mat4 uNMatrix;","uniform vec3 uLightPosition;","varying vec4 vColor;","varying vec2 vTextureCoord;","attribute vec2 aVertexTextureCoords;","void main(void) {","vec4 vertex = uMMatrix * vec4(aPosition, 1.0);","vec3 normal = vec3(uNMatrix * vec4(aNormal, 1.0));","vec4 lightPos = vec4(uLightPosition, 1.0);","vec3 lightRay = vertex.xyz - lightPos.xyz;","float lambertTerm = max(dot(normalize(normal), -normalize(lightRay)), 0.0);","vec3 diffuse = vec3(1.0, 1.0, 1.0) * aColor.rgb * lambertTerm;","vec3 ambient = vec3(0.4, 0.4, 0.4) * aColor.rgb;","vColor = vec4(ambient + diffuse, aColor.a);","vTextureCoord = aVertexTextureCoords;","gl_Position = uPMatrix * uVMatrix * vertex;","}"],fgShader:["#ifdef GL_ES","precision mediump float;","#endif","varying vec4 vColor;","uniform sampler2D uSampler;","varying vec2 vTextureCoord;","void main(void) {","vec4 texColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = vColor * texColor;","}"],meshes:[],cubes:[],camera:null,gl:null,prg:null,light:null,crossOrigin:null,nMatrix:null,width:800,height:600,maxHeight:8640,maxWidth:15360,minHeight:100,minWidth:100,sceneSize:260,halfSceneSize:null,canvas:null,animationRatio:1,deltaTime:0,currentFrame:null,currentDir:null,currentSubCubes:[],animating:!1,rotAngle:0,rotSpeed:2,antialias:!0,showFps:!0,fps:60,frameTimestamps:[],fpsContainer:null,hudContainer:null,menuContainer:null,movesContainer:null,sideMeshProto:null,subCubeBoundSize:20,cubeBoundSizeHalf:30,cubeVertices:[],sideIndices:{F:{indices:[43,42,41,40,47,46,45,44,51,50,49,48,55,54,53,52],cellsOrder:[19,18,17,22,21,20,25,24,23]},N:{indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],cellsOrder:[0,1,2,3,4,5,6,7,8]},R:{indices:[3,19,31,43,7,21,33,47,11,23,35,51,15,27,39,55],cellsOrder:[2,11,19,5,13,22,8,16,25]},L:{indices:[40,28,16,0,44,32,20,4,48,34,22,8,52,36,24,12],cellsOrder:[17,9,0,20,12,3,23,14,6]},T:{indices:[40,41,42,43,28,29,30,31,16,17,18,19,0,1,2,3],cellsOrder:[17,18,19,9,10,11,0,1,2]},B:{indices:[12,13,14,15,24,25,26,27,36,37,38,39,52,53,54,55],cellsOrder:[6,7,8,14,15,16,23,24,25]}},mouseDown:null,mouseSensitivity:60,mouseAngleSensitivity:.86,pickableMeshes:null,scrambles:[],scramblesMax:100,scramblesMin:20,movesCnt:0,sounds:{rotate:null},mute:!1,paused:!0,solved:!1,cameraInitialPosition:[-95,95,-95],X0:-20,X1:0,X2:20,Y0:-20,Y1:0,Y2:20,Z0:20,Z1:0,Z2:-20,rotRadius1:null,rotRadius2:20,subCubeSize:19.6,subCubeSizeHalf:9.8,sides:{F:{rotation:null,position:null,material:null,color:new s(1,0,0),texture:"r.png"},N:{rotation:null,position:null,material:null,color:new s(1,.4,.1),texture:"o.png"},R:{rotation:null,position:null,material:null,color:new s(0,0,1),texture:"b.png"},L:{rotation:null,position:null,material:null,color:new s(0,1,0),texture:"g.png"},T:{rotation:null,position:null,material:null,color:new s(1,1,0),texture:"y.png"},B:{rotation:null,position:null,material:null,color:new s(.8,.8,.8),texture:"w.png"}},backSide:{rotation:null,position:null,material:null,color:new s(.5,.5,.5),texture:null},rules:{X:["F","T","N","B","F"],Y:["F","L","N","R","F"],Z:["R","T","L","B","R"]},cells:[{s:["L","T","N"],f:["X0","Y2","Z0"],r:{"X+":6,"X-":17,"Y+":2,"Y-":17,"Z-":2,"Z+":6},rot:{X:135,Y:225,Z:135},pos:1},{s:["T","N"],f:["X1","Y2","Z0"],r:{"X+":7,"X-":18,"Y+":11,"Y-":9,"Z-":5,"Z+":3},rot:{X:135,Y:270,Z:90},pos:2},{s:["R","T","N"],f:["X2","Y2","Z0"],r:{"X+":8,"X-":19,"Y+":19,"Y-":0,"Z-":8,"Z+":0},rot:{X:135,Y:315,Z:45},pos:1},{s:["L","N"],f:["X0","Y1","Z0"],r:{"X+":14,"X-":9,"Y+":5,"Y-":20,"Z-":1,"Z+":7},rot:{X:180,Y:225,Z:180},pos:2},{s:["N"],f:["X1","Y1","Z0"],r:{"X+":15,"X-":10,"Y+":13,"Y-":12,"Z-":4,"Z+":4},rot:{X:180,Y:270,Z:0},pos:3},{s:["R","N"],f:["X2","Y1","Z0"],r:{"X+":16,"X-":11,"Y+":22,"Y-":3,"Z-":7,"Z+":1},rot:{X:180,Y:315,Z:0},pos:2},{s:["L","B","N"],f:["X0","Y0","Z0"],r:{"X+":23,"X-":0,"Y+":8,"Y-":23,"Z-":0,"Z+":8},rot:{X:225,Y:225,Z:225},pos:1},{s:["B","N"],f:["X1","Y0","Z0"],r:{"X+":24,"X-":1,"Y+":16,"Y-":14,"Z-":3,"Z+":5},rot:{X:225,Y:270,Z:270},pos:2},{s:["R","B","N"],f:["X2","Y0","Z0"],r:{"X+":25,"X-":2,"Y+":25,"Y-":6,"Z-":6,"Z+":2},rot:{X:225,Y:315,Z:315},pos:1},{s:["L","T"],f:["X0","Y2","Z1"],r:{"X+":3,"X-":20,"Y+":1,"Y-":18,"Z-":11,"Z+":14},rot:{X:90,Y:180,Z:135},pos:2},{s:["T"],f:["X1","Y2","Z1"],r:{"X+":4,"X-":21,"Y+":10,"Y-":10,"Z-":13,"Z+":12},rot:{X:90,Y:0,Z:90},pos:3},{s:["R","T"],f:["X2","Y2","Z1"],r:{"X+":5,"X-":22,"Y+":18,"Y-":1,"Z-":16,"Z+":9},rot:{X:90,Y:0,Z:45},pos:2},{s:["L"],f:["X0","Y1","Z1"],r:{"X+":12,"X-":12,"Y+":4,"Y-":21,"Z-":10,"Z+":15},rot:{X:0,Y:180,Z:180},pos:3},{s:["R"],f:["X2","Y1","Z1"],r:{"X+":13,"X-":13,"Y+":21,"Y-":4,"Z-":15,"Z+":10},rot:{X:0,Y:0,Z:0},pos:3},{s:["L","B"],f:["X0","Y0","Z1"],r:{"X+":20,"X-":3,"Y+":7,"Y-":24,"Z-":9,"Z+":16},rot:{X:270,Y:180,Z:225},pos:2},{s:["B"],f:["X1","Y0","Z1"],r:{"X+":21,"X-":4,"Y+":15,"Y-":15,"Z-":12,"Z+":13},rot:{X:270,Y:0,Z:270},pos:3},{s:["R","B"],f:["X2","Y0","Z1"],r:{"X+":22,"X-":5,"Y+":24,"Y-":7,"Z-":14,"Z+":11},rot:{X:270,Y:0,Z:315},pos:2},{s:["L","T","F"],f:["X0","Y2","Z2"],r:{"X+":0,"X-":23,"Y+":0,"Y-":19,"Z-":19,"Z+":23},rot:{X:45,Y:135,Z:135},pos:1},{s:["T","F"],f:["X1","Y2","Z2"],r:{"X+":1,"X-":24,"Y+":9,"Y-":11,"Z-":22,"Z+":20},rot:{X:45,Y:90,Z:90},pos:2},{s:["R","T","F"],f:["X2","Y2","Z2"],r:{"X+":2,"X-":25,"Y+":17,"Y-":2,"Z-":25,"Z+":17},rot:{X:45,Y:45,Z:45},pos:1},{s:["L","F"],f:["X0","Y1","Z2"],r:{"X+":9,"X-":14,"Y+":3,"Y-":22,"Z-":18,"Z+":24},rot:{X:0,Y:135,Z:180},pos:2},{s:["F"],f:["X1","Y1","Z2"],r:{"X+":10,"X-":15,"Y+":12,"Y-":13,"Z-":21,"Z+":21},rot:{X:0,Y:90,Z:0},pos:3},{s:["R","F"],f:["X2","Y1","Z2"],r:{"X+":11,"X-":16,"Y+":20,"Y-":5,"Z-":24,"Z+":18},rot:{X:0,Y:45,Z:0},pos:2},{s:["L","B","F"],f:["X0","Y0","Z2"],r:{"X+":17,"X-":6,"Y+":6,"Y-":25,"Z-":17,"Z+":25},rot:{X:315,Y:135,Z:225},pos:1},{s:["B","F"],f:["X1","Y0","Z2"],r:{"X+":18,"X-":7,"Y+":14,"Y-":16,"Z-":20,"Z+":22},rot:{X:315,Y:90,Z:270},pos:2},{s:["R","B","F"],f:["X2","Y0","Z2"],r:{"X+":19,"X-":8,"Y+":23,"Y-":8,"Z-":23,"Z+":19},rot:{X:315,Y:45,Z:315},pos:1}],init:function(i){var e=this;return this.canvas=document.getElementById(i),this.isSupported()?(this.initContext(),this.halfSceneSize=this.sceneSize/2,this.rotRadius1=Math.sqrt(2*this.rotRadius2*this.rotRadius2),this.handleSize(),this.initCamera(),this.initProgram()?(this.nMatrix=t.Identity(),this.light=new a(new s(0,0,0)),this.light.position=this.camera.position,this.initSounds(),this.showFps&&(this.fpsContainer=document.createElement("div"),this.fpsContainer.title=this.fpsContainer.id="stats",document.body.appendChild(this.fpsContainer)),this.initSides(),this.createCube(),this.initBuffers(),window.addEventListener("resize",function(){e.handleSize()}),this.scramble(),this.initMouseControls(),this.initHud(),this.initMenu(),this.run(),this.setPaused(!1),this):this):(this.showError("Unfortunately your browser is not supported"),this)},initCamera:function(){var t=.8,i=this.width/this.height,e=new s(this.cameraInitialPosition[0],this.cameraInitialPosition[1],-this.cameraInitialPosition[2]);this.camera=new n(t,i,1,260,e)},initMeshBuffers:function(t){try{t.vbo=this.createBuffer("vbo",t.name),t.nbo=this.createBuffer("nbo",t.name),t.material.cbo||(t.material.cbo=this.createBuffer("cbo",t.name),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.material.cbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.material.colors,this.gl.STATIC_DRAW))}catch(t){return console.log(t.message),!1}if(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.nbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.normals,this.gl.STATIC_DRAW),t.indices.length){try{t.ibo=this.createBuffer("ibo",t.name)}catch(t){return console.log(t.message),!1}this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.ibo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t.indices,this.gl.STATIC_DRAW)}if(t.textureCoords.length){try{t.tbo=this.createBuffer("tbo",t.name)}catch(t){return console.log(t.message),!1}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.tbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.textureCoords,this.gl.STATIC_DRAW)}return t.isReady=!0,!0},createBuffer:function(t,i){var e=this.gl.createBuffer();return e?e:(console.log("Failed to create "+t+" for "+i),!1)},initSideMeshProtoBuffers:function(){var t=this.sideMeshProto;try{t.vbo=this.createBuffer("vbo",t.name),t.nbo=this.createBuffer("nbo",t.name),t.ibo=this.createBuffer("ibo",t.name),t.tbo=this.createBuffer("tbo",t.name)}catch(t){return console.log(t.message),!1}return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.nbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.normals,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.ibo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.tbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.textureCoords,this.gl.STATIC_DRAW),t.isReady=!0,!0},initSideMeshBuffers:function(t){try{t.material.cbo||(t.material.cbo=this.createBuffer("cbo",t.name),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.material.cbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.material.colors,this.gl.STATIC_DRAW))}catch(t){return console.log(t.message),!1}return t.isReady=!0,!0},initBuffers:function(){var t=this;this.initSideMeshProtoBuffers(),this.sideMeshProto.isReady&&this.meshes.forEach(function(i){t.initSideMeshBuffers(i)}),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)},calculateNMatrix:function(t){t.updateWorldMatrix(),this.nMatrix.setInverseOf(t.worldMatrix),this.nMatrix.transpose()},drawSideMesh:function(t,i){t.isReady&&(this.calculateNMatrix(t),this.gl.uniformMatrix4fv(this.prg.uMMatrix,!1,t.worldMatrix.elements),this.gl.uniformMatrix4fv(this.prg.uNMatrix,!1,this.nMatrix.elements),i!==t.material.name&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.material.cbo),this.gl.vertexAttribPointer(this.prg.aColor,3,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,t.material.texture)),this.gl.drawElements(t.drawMode,t.elementsCnt,this.gl.UNSIGNED_BYTE,0))},drawMeshes:function(){var t=this;this.gl.uniformMatrix4fv(this.prg.uPMatrix,!1,this.camera.pMatrix.elements),this.gl.uniformMatrix4fv(this.prg.uVMatrix,!1,this.camera.vMatrix.elements),this.gl.uniform3fv(this.prg.uLightPosition,this.light.position.toArray()),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(this.prg.uSampler,0),this.gl.enableVertexAttribArray(this.prg.aPosition),this.gl.enableVertexAttribArray(this.prg.aNormal),this.gl.enableVertexAttribArray(this.prg.aColor),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sideMeshProto.vbo),this.gl.vertexAttribPointer(this.prg.aPosition,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sideMeshProto.nbo),this.gl.vertexAttribPointer(this.prg.aNormal,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sideMeshProto.ibo),this.gl.enableVertexAttribArray(this.prg.aVertexTextureCoords),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sideMeshProto.tbo),this.gl.vertexAttribPointer(this.prg.aVertexTextureCoords,2,this.gl.FLOAT,!1,0,0);var i="";this.meshes.forEach(function(e){t.drawSideMesh(e,i),i=e.material.name}),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)},render:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.drawMeshes()},measureStat:function(t){if(!(t<=0)){this.frameTimestamps.push(t);var i=this.frameTimestamps.length;i>=2&&(this.deltaTime=this.frameTimestamps[i-1]-this.frameTimestamps[i-2]);var e=Math.max(1,Math.min(this.deltaTime,1e3));if(this.animationRatio=.06*e,i>=61&&(i>61&&(this.frameTimestamps.shift(),i=this.frameTimestamps.length),this.showFps)){for(var s=0,n=i-1,r=0;r<n;r++)s+=this.frameTimestamps[r+1]-this.frameTimestamps[r];this.fps=1e3*n/s}}},renderLoopUpdate:function(){this.animating&&this.rotatingFrame(),this.camera.update()},renderLoop:function(t,i){if(this.measureStat(t),this.showFps&&(this.fpsContainer.innerHTML=this.fps.toFixed()+" fps"),!this.paused&&(this.renderLoopUpdate(),this.render(),this.solved)){var e=this;setTimeout(function(){e.win()},0)}this.requestFrame(t)},requestFrame:function(t){var i=this;window.requestAnimationFrame(function(e){i.renderLoop(e,t)})},createShader:function(t,i,e){var s=t.createShader(e);t.shaderSource(s,i),t.compileShader(s);var n=t.getShaderParameter(s,t.COMPILE_STATUS);return n?s:(console.log(t.getShaderInfoLog(s)),t.deleteShader(s),null)},initProgram:function(){var t=this.vxShader.join("\n"),i=this.createShader(this.gl,t,this.gl.VERTEX_SHADER);t=this.fgShader.join("\n");var e=this.createShader(this.gl,t,this.gl.FRAGMENT_SHADER);if(!i||!e)return!1;var s=this.gl.createProgram();this.gl.attachShader(s,i),this.gl.attachShader(s,e),this.gl.linkProgram(s);var n=this.gl.getProgramParameter(s,this.gl.LINK_STATUS);if(!n)return console.log(this.gl.getProgramInfoLog(s)),this.gl.deleteProgram(s),this.gl.deleteShader(e),this.gl.deleteShader(i),!1;this.prg=s,this.gl.useProgram(this.prg);try{this.prg.aPosition=this.getAttribLocation("aPosition"),this.prg.aNormal=this.getAttribLocation("aNormal"),this.prg.aColor=this.getAttribLocation("aColor"),this.prg.aVertexTextureCoords=this.getAttribLocation("aVertexTextureCoords"),this.prg.uPMatrix=this.getUniformLocation("uPMatrix"),this.prg.uVMatrix=this.getUniformLocation("uVMatrix"),this.prg.uMMatrix=this.getUniformLocation("uMMatrix"),this.prg.uNMatrix=this.getUniformLocation("uNMatrix"),this.prg.uLightPosition=this.getUniformLocation("uLightPosition"),this.prg.uSampler=this.getUniformLocation("uSampler")}catch(t){return console.log(t.message),!1}return!0},getAttribLocation:function(t){var i=this.gl.getAttribLocation(this.prg,t);if(i<0)throw new Error("Failed to get the storage location of "+t);return i},getUniformLocation:function(t){var i=this.gl.getUniformLocation(this.prg,t);if(!i)throw new Error("Failed to get the storage location of "+t);return i},getAvailableSpace:function(){var t={w:0,h:0};return t.w=window.innerWidth,t.h=window.innerHeight,t},calcSize:function(){var t=this.getAvailableSpace(),i=t.h,e=t.w;return i=Math.max(this.minHeight,Math.min(i,this.maxHeight)),e=Math.max(this.minWidth,Math.min(e,this.maxWidth)),{w:e,h:i}},handleSize:function(){var t=this.calcSize();if(this.width=t.w,this.height=t.h,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.gl.viewport(0,0,this.width,this.height),this.camera){var i=this.width/this.height;this.camera.updateProjectMatrix(i)}},initContext:function(){if(!this.gl)for(var t={antialias:this.antialias},i=["webgl","experimental-webgl"],e=null,s=0;s<i.length;s++)try{if(e=this.canvas.getContext(i[s],t),null!=e&&window.WebGLRenderingContext)return this.gl=e,this.gl}catch(t){}return this.gl},isSupported:function(){return this.initContext(),!!this.gl},initMenu:function(){var t=this;this.menuContainer=document.createElement("div"),this.menuContainer.id="menu";var i=document.createElement("button");i.textContent="New Game",i.addEventListener("click",function(){var i=confirm("Are you sure?");i&&t.reset()},!1),this.menuContainer.appendChild(i),document.body.appendChild(this.menuContainer)},initHud:function(){this.hudContainer=document.createElement("div"),this.hudContainer.id="hud",this.movesContainer=document.createElement("span"),this.movesContainer.id="hud-moves";var t=document.createTextNode("Moves: ");this.hudContainer.appendChild(t),this.hudContainer.appendChild(this.movesContainer),this.movesContainer.textContent="0",document.body.appendChild(this.hudContainer)},updateHud:function(t,i){t&&(this.movesContainer.textContent=this.movesCnt)},initSounds:function(){this.sounds.rotate=new Audio("r.wav")},playSound:function(t){var i=this.sounds[t];i.readyState>=2&&i.play()},initCubeVertices:function(){for(var t=-this.cubeBoundSizeHalf,i=this.cubeBoundSizeHalf,e=this.cubeBoundSizeHalf,n=t,r=i,o=e,a=1;a<=16;a++)this.cubeVertices.push(new s(n,o,r)),n+=this.subCubeBoundSize,a%4===0&&(n=t,o-=this.subCubeBoundSize);r-=this.subCubeBoundSize,o=e;for(var a=1;a<=16;a++)6!==a&&7!==a&&10!==a&&11!==a&&this.cubeVertices.push(new s(n,o,r)),n+=this.subCubeBoundSize,a%4===0&&(n=t,o-=this.subCubeBoundSize);r-=this.subCubeBoundSize,o=e;for(var a=1;a<=16;a++)6!==a&&7!==a&&10!==a&&11!==a&&this.cubeVertices.push(new s(n,o,r)),n+=this.subCubeBoundSize,a%4===0&&(n=t,o-=this.subCubeBoundSize);o=e,r-=this.subCubeBoundSize;for(var a=1;a<=16;a++)this.cubeVertices.push(new s(n,o,r)),n+=this.subCubeBoundSize,a%4===0&&(n=t,o-=this.subCubeBoundSize)},getVisibleSides:function(){var t=[];return t.push({n:"F",v:this.sideVisibility(new s(0,0,-this.cubeBoundSizeHalf))}),t.push({n:"N",v:this.sideVisibility(new s(0,0,this.cubeBoundSizeHalf))}),t.push({n:"R",v:this.sideVisibility(new s(this.cubeBoundSizeHalf,0,0))}),t.push({n:"L",v:this.sideVisibility(new s(-this.cubeBoundSizeHalf,0,0))}),t.push({n:"T",v:this.sideVisibility(new s(0,this.cubeBoundSizeHalf,0))}),t.push({n:"B",v:this.sideVisibility(new s(0,-this.cubeBoundSizeHalf,0))}),t.sort(function(t,i){return i.v-t.v}),t},sideVisibility:function(t){var i=s.sub(this.camera.position,t);return i.normalize(),t.normalize(),i.dot(t)},intersectLine:function(t,i,e){var s=i,n=e,r=null;if(i.x>e.x&&(s=e,n=i),t.ndcX>s.x&&t.ndcX<n.x){var o=(n.y-s.y)/(n.x-s.x);r=o*(t.ndcX-s.x)+s.y}return r},checkInsideRectangle:function(t,i){var e=!1,s=Math.min(i[0].x,i[1].x,i[2].x,i[3].x),n=Math.min(i[0].y,i[1].y,i[2].y,i[3].y),r=Math.max(i[0].x,i[1].x,i[2].x,i[3].x),o=Math.max(i[0].y,i[1].y,i[2].y,i[3].y);if(t.ndcX>s&&t.ndcX<r&&t.ndcY>n&&t.ndcY<o)for(var a,h,u,l=[],c=0;c<4;c++)if(h=c,u=c>2?0:h+1,a=this.intersectLine(t,i[h],i[u]),null!==a&&l.push(a),c>0&&2===l.length){n=Math.min(l[0],l[1]),o=Math.max(l[0],l[1]),t.ndcY>n&&t.ndcY<o&&(e=!0);break}return e},addSideVertexNdc:function(t,i,e,s){var n=t[i];return"undefined"==typeof e[n]&&(e[n]=s.multiplyVector(this.cubeVertices[n])),n},pick:function(i){var s={hit:!1},n=new t;t.multiplyTo(this.camera.pMatrix,this.camera.vMatrix,n);var r={};r[0]=n.multiplyVector(this.cubeVertices[0]),r[3]=n.multiplyVector(this.cubeVertices[3]),r[12]=n.multiplyVector(this.cubeVertices[12]),r[15]=n.multiplyVector(this.cubeVertices[15]),r[40]=n.multiplyVector(this.cubeVertices[40]),r[43]=n.multiplyVector(this.cubeVertices[43]),r[52]=n.multiplyVector(this.cubeVertices[52]),r[55]=n.multiplyVector(this.cubeVertices[55]);for(var o,a=this.getVisibleSides(),h=[],u=!1,l=0;l<6;l++)if(o=a[l],h.length=0,o.v>e.COS80){switch(o.n){case"N":h.push(r[12]),h.push(r[0]),h.push(r[3]),h.push(r[15]);break;case"F":h.push(r[55]),h.push(r[43]),h.push(r[40]),h.push(r[52]);break;case"L":h.push(r[52]),h.push(r[40]),h.push(r[0]),h.push(r[12]);break;case"R":h.push(r[15]),h.push(r[3]),h.push(r[43]),h.push(r[55]);break;case"B":h.push(r[52]),h.push(r[12]),h.push(r[15]),h.push(r[55]);break;case"T":h.push(r[0]),h.push(r[40]),h.push(r[43]),h.push(r[3])}if(u=this.checkInsideRectangle(i,h)){
for(var c,f,d,m=this.sideIndices[o.n].indices,p=this.sideIndices[o.n].cellsOrder,g=0,l=0;l<9;l++)if(g=l<3?l:l<6?l+1:l+2,h.length=0,f=this.addSideVertexNdc(m,g,r,n),h.push(r[f]),f=this.addSideVertexNdc(m,g+1,r,n),h.push(r[f]),f=this.addSideVertexNdc(m,g+5,r,n),h.push(r[f]),f=this.addSideVertexNdc(m,g+4,r,n),h.push(r[f]),c=this.checkInsideRectangle(i,h)){d=p[l],s.hit=!0,s.ndcX=i.ndcX,s.ndcY=i.ndcY,s.pointerX=i.x,s.pointerY=i.y,s.side=o.n,s.cell=d;break}break}}return s},onMouseDown:function(t){if(t.preventDefault(),!this.paused){if(0!==t.button)return void(this.mouseDown&&(this.camera.enabled=!0,this.mouseDown=null));var i=this.pick(u(t,this.canvas));if(!i.hit)return void(this.mouseDown=null);this.camera.enabled=!1,this.mouseDown=i}},onMouseOut:function(){this.paused||this.resetMouse()},onMouseUp:function(t){t.preventDefault(),this.paused||this.resetMouse()},onMouseMove:function(t){if(!this.paused&&this.mouseDown&&0===t.button){var i=this.cells[this.mouseDown.cell],e=null;3!==i.pos&&(e=this.pick(u(t,this.canvas)));var s=null,n=null;if(e&&e.hit){if(this.mouseDown.cell===e.cell)return;var r=this.mouseDown.pointerX-e.pointerX,o=this.mouseDown.pointerY-e.pointerY,a=Math.sqrt(r*r+o*o);if(a<this.mouseSensitivity)return;var h=this.mouseDown.side,l=e.side;if(h===l){var c=null;switch(h){case"F":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,0,1,1,-1);break;case"N":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,0,1,-1,1);break;case"R":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,1,2,1,1);break;case"L":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,1,2,-1,-1);break;case"T":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,0,2,-1,-1);break;case"B":c=this.getMouseRotationParams(this.mouseDown.cell,e.cell,0,2,1,1)}s=c[0],n=c[1]}}this.mouseDown=null,this.camera.enabled=!0,s&&n&&"X1"!==s&&"Y1"!==s&&"Z1"!==s&&this.rotateFrameStart(s,n>0?"+":"-")}},resetMouse:function(){this.mouseDown&&(this.camera.enabled=!0),this.mouseDown=null},getMouseRotationParams:function(t,i,e,s,n,r){var o,a,h,u,l,c,f=null,d=null,m=this.cells[t],p=this.cells[i];return t!==i&&(h=m.f[e],u=p.f[e],l=m.f[s],c=p.f[s],h===u?(f=h,o=m.f[s].charAt(1),a=p.f[s].charAt(1),d=a-o,d*=n):l===c&&(f=l,o=m.f[e].charAt(1),a=p.f[e].charAt(1),d=a-o,d*=r)),[f,d]},initMouseControls:function(){var t=this;this.initCubeVertices();var i="mouse";this.canvas.addEventListener(i+"down",function(i){t.onMouseDown(i)},!1),this.canvas.addEventListener(i+"out",function(i){t.onMouseOut(i)},!1),this.canvas.addEventListener(i+"move",function(i){t.onMouseMove(i)},!1),this.canvas.addEventListener(i+"up",function(i){t.onMouseUp(i)},!1),this.camera.attachControl(this.canvas)},initSides:function(){var t;for(var i in this.sides){switch(t=this.sides[i],i){case"F":t.rotation=new s(0,-Math.PI,0),t.position=new s(0,0,-this.subCubeSizeHalf);break;case"N":t.rotation=new s(0,0,0),t.position=new s(0,0,this.subCubeSizeHalf);break;case"R":t.rotation=new s(0,e.PI_HALF,0),t.position=new s(this.subCubeSizeHalf,0,0);break;case"L":t.rotation=new s(0,-e.PI_HALF,0),t.position=new s(-this.subCubeSizeHalf,0,0);break;case"T":t.rotation=new s(-e.PI_HALF,0,0),t.position=new s(0,this.subCubeSizeHalf,0);break;case"B":t.rotation=new s(e.PI_HALF,0,0),t.position=new s(0,-this.subCubeSizeHalf,0)}t.material=new h(i,t.color,t.texture,this.gl),t.material.setCrossOrigin(this.crossOrigin),t.material.loadTexture()}this.backSide.material=new h("back",this.backSide.color,null,this.gl),this.backSide.material.setCrossOrigin(this.crossOrigin)},createSideProto:function(){var t=[this.subCubeSizeHalf,this.subCubeSizeHalf,0,-this.subCubeSizeHalf,this.subCubeSizeHalf,0,-this.subCubeSizeHalf,-this.subCubeSizeHalf,0,this.subCubeSizeHalf,-this.subCubeSizeHalf,0],i=[0,1,2,0,2,3],e=[0,0,1,0,0,1,0,0,1,0,0,1];this.sideMeshProto=new r("proto",t,i,e,null,this.gl.TRIANGLES);var s=[1,1,0,1,0,0,1,0];this.sideMeshProto.setTextureCoords(s)},createCube:function(){this.createSideProto();for(var t=0;t<26;t++)this.createSubCube(t);this.meshes.sort(function(t,i){return i.material.name==t.material.name?0:i.material.name>t.material.name?1:-1})},createSubCube:function(t){var i,e,s=this.cells[t],n=new o("subCube_"+t,this);for(var r in this.sides){var a=!0;e=this.sides[r];for(var h in s.s)if(s.s[h]===r){a=!1;break}i=a?this.createBackSideMesh(t,r,e):this.createSideMesh(t,r,e),n.addSide(i)}n.data={cell:t,aim:t,ini:t,orientation:{F:"F",N:"N",R:"R",L:"L",T:"T",B:"B"}};var u=s.f;return n.setTranslate(this[u[0]],this[u[1]],this[u[2]]),this.cubes.push(n),n},createBackSideMesh:function(t,i,e){return this.backSide.position=e.position,this.backSide.rotation=e.rotation,this.createSideMesh(t,i,this.backSide)},createSideMesh:function(t,i,e){if(!e.material.colors){for(var n=new s(1,1,1),o=[],a=0;a<4;a++)o.push(n.x,n.y,n.z);e.material.setColors(o)}var h=new r(i+t,[],[],[],e.material,this.gl.TRIANGLES);return h.vertices=this.sideMeshProto.vertices,h.indices=this.sideMeshProto.indices,h.normals=this.sideMeshProto.normals,h.textureCoords=this.sideMeshProto.textureCoords,h.elementsCnt=this.sideMeshProto.elementsCnt,h.rotation=e.rotation.clone(),h.position=e.position.clone(),h.updateMatrices(),h.data={side:i},h},setPaused:function(t){this.paused=t},reset:function(){var t=this;this.resetMouse(),this.solved=!1,this.setPaused(!0),this.animating=!1,this.currentSubCubes.length=0;for(var i=this.cubes.length,e=0;e<i;e++){var s=this.cubes[e],n=this.cells[s.data.aim];for(var r in s.data.orientation)s.data.orientation[r]=r;s.data.cell=s.data.aim,s.rotation.x=s.rotation.y=s.rotation.z=0,s.position.x=this[n.f[0]],s.position.y=this[n.f[1]],s.position.z=this[n.f[2]],s.updateMatrices(),s.sideMeshes.forEach(function(i){var e=t.sides[i.data.side];i.rotation=e.rotation.clone(),i.position=e.position.clone(),i.updateMatrices()})}this.scramble(),this.movesCnt=0,this.updateHud(!0,!0),this.setPaused(!1)},scramble:function(){this.scrambles.length=0;var t=[];t.push(["X0","+"],["X0","-"],["Y0","+"],["Y0","-"],["Z0","+"],["Z0","-"],["X2","+"],["X2","-"],["Y2","+"],["Y2","-"],["Z2","+"],["Z2","-"]);for(var i,e,s,n,r=t.length,o=Math.floor(Math.random()*(this.scramblesMax-this.scramblesMin+1))+this.scramblesMin,a=null,h=null,u=0;u<o;u++){if(i=Math.floor(Math.random()*r),e=t[i][0],s=t[i][1],e===a&&s!==h){switch(n=t.slice(0),e){case"X0":n.splice(0,2);break;case"Y0":n.splice(2,2);break;case"Z0":n.splice(4,2);break;case"X2":n.splice(6,2);break;case"Y2":n.splice(8,2);break;case"Z2":n.splice(10,2)}i=Math.floor(Math.random()*n.length),e=n[i][0],s=n[i][1]}this.scrambles.push([e,s]),a=e,h=s}var l=this.mute;this.mute=!0;for(var c=this.scrambles.length,u=0;u<c;u++)this.rotateFrameStart(this.scrambles[u][0],this.scrambles[u][1]),this.rotateFrameEnd();if(this.checkComplete()){this.scrambles.length=0,this.scrambles.push(["X0","-"],["Z2","+"],["Z2","+"],["Y0","+"],["Z2","-"],["Y0","-"],["Y0","-"],["Z2","+"],["Y2","+"],["Z0","+"],["Z0","+"],["Y2","-"],["Z0","+"],["Z0","+"],["Y0","-"],["Y0","-"],["Z0","+"],["Z0","+"],["X0","+"],["Z0","+"],["Z0","+"],["Y2","+"],["Z0","-"],["Y0","-"],["X2","+"],["Y2","+"],["Z0","-"],["Y2","-"],["Y2","-"],["Z0","+"],["Z2","+"],["Z2","+"],["X0","-"],["X0","-"],["Z0","-"]),c=this.scrambles.length;for(var u=0;u<c;u++)this.rotateFrameStart(this.scrambles[u][0],this.scrambles[u][1]),this.rotateFrameEnd()}this.mute=l},rotateFrameStart:function(t,i){if(this.animating)return!1;this.animating=!0,this.currentFrame=t,this.currentDir=i,this.rotAngle=0;for(var e=this.cubes.length,s=0;s<e;s++){var n=this.cubes[s],r=this.cells[n.data.cell];r.f.indexOf(t)<0||this.currentSubCubes.push(n)}this.mute||this.playSound("rotate")},rotateFrameEnd:function(){var t=this,i=this.currentFrame.charAt(0),e=i+this.currentDir,s=this.rules[i].slice(0);"-"===this.currentDir&&s.reverse(),this.currentSubCubes.forEach(function(i){var n=t.cells[i.data.cell],r=n.r[e],o=t.cells[r];i.data.cell=r,i.rotation.x=i.rotation.y=i.rotation.z=0,i.position.x=t[o.f[0]],i.position.y=t[o.f[1]],i.position.z=t[o.f[2]],i.updateMatrices();for(var a,h,u,l={},c=0;c<4;c++)a=s[c],h=s[c+1],u=i.data.orientation[a],l[h]=u;for(var f in l)i.data.orientation[f]=l[f];i.sideMeshes.forEach(function(i){for(var e in l)if(i.data.side===l[e]){var s=t.sides[e];i.rotation=s.rotation.clone(),i.position=s.position.clone(),i.updateMatrices()}})}),this.animating=!1,this.currentFrame=null,this.currentDir=null,this.currentSubCubes.length=0,this.rotAngle=0,this.paused||(this.movesCnt++,this.updateHud(!0,!1),this.checkComplete()&&(this.solved=!0))},checkComplete:function(){for(var t=!0,i=this.cubes.length,e=0;e<i;e++){var s=this.cubes[e];if(s.data.cell!==s.data.aim){t=!1;break}}return t},win:function(){this.setPaused(!0),alert("You won!"),this.reset()},rotatingFrame:function(){var t=this,i=this.currentFrame.charAt(0);return this.rotAngle+=this.rotSpeed*this.animationRatio,this.rotAngle>=90?void this.rotateFrameEnd():void this.currentSubCubes.forEach(function(s){var n=t.cells[s.data.cell],r=1===n.pos?t.rotRadius1:t.rotRadius2,o=n.rot[i],a=t.rotAngle;switch("-"===t.currentDir?(o-=a,a*=-1):o+=a,o*=e.PI_180,a*=e.PI_180,i){case"X":3!==n.pos&&(s.position.y=r*Math.sin(o),s.position.z=-r*Math.cos(o)),s.rotation.x=a;break;case"Y":3!==n.pos&&(s.position.z=-r*Math.sin(o),s.position.x=r*Math.cos(o)),s.rotation.y=a;break;case"Z":3!==n.pos&&(s.position.y=r*Math.sin(o),s.position.x=r*Math.cos(o)),s.rotation.z=a}s.updateMatrices()})},showError:function(t){alert(t)},run:function(){this.gl.clearColor(0,0,0,1),this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.CULL_FACE),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);var t=0;this.renderLoop(t,t)}};var u=function(t,i){var e,s,n=i.getBoundingClientRect();e=t.clientX-n.left,s=t.clientY-n.top;var r=e/n.width*2-1,o=2*-(s/n.height)+1;return{x:e,y:s,ndcX:r,ndcY:o}};window.addEventListener("DOMContentLoaded",function(){new i("gameCanvas")})}();