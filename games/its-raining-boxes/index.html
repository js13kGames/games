<!DOCTYPE html><html><head><title>It's Raining... Boxes?! - js13kGames 2015</title><meta name='viewport' content='width=device-width,maximum-scale=1.01'><style>*{margin:0;padding:0}body,html{height:100%}body{background-color:black;width:100%}#table{display:table;width:100%;height:100%}#cell{display:table-cell;vertical-align:middle}#canvascontainer{margin: auto;outline:1px solid #fff}canvas{width: 100%;height:100%;display:block}</style></head><body><div id="table"><div id="cell"><div id="canvascontainer"><canvas></canvas></div></div></div><script>var _=window,raf=_.requestAnimationFrame||_.webkitRequestAnimationFrame||_.mozRequestAnimationFrame||function($){to($,1e3/60)},M=Math,abs=M.abs,min=M.min,max=M.max,to=setTimeout;function rd($,t){return t||(t=$,$=0),M.random()*(t-$)+$}function rp($){return $[~~rd($.length)]}function xt($,t){var i={};for(var h in $)i[h]=$[h];for(var h in t)i[h]=t[h];return i}var p=CanvasRenderingContext2D.prototype;for(var i in p.fr=p.fillRect,p.sv=p.save,p.rs=p.restore,p.tr=p.translate,p.lt=p.lineTo,p.mt=p.moveTo,p.sc=p.scale,p.bp=p.beginPath,p.clg=p.createLinearGradient,p.rt=p.rotate,p.ft=p.fillText,p.$i=function($){this.globalAlpha=$},p.fs=function($){this.fillStyle=P.$h?$aP($):$},p.di=function($,t,i){P.$h&&(arguments[0]=$aP(arguments[0])),this.drawImage.apply(this,arguments)},p)_[i]=function($){return function(){c[$].apply(c,arguments)}}(i);var $aM={};function $aP($){if($.$h)return $.$h;if($.length){if(!$aM[$]&&"#"===$.charAt(0)){var t=$.substring(1);3==t.length&&(t=t.charAt(0)+"0"+t.charAt(1)+"0"+t.charAt(2)+"0"),t=parseInt(t,16),$aM[$]="#"+("000000"+(16777215^t).toString(16)).slice(-6)}return $aM[$]||$}return $}function $n($,t,i,h,s){var a=document.createElement("canvas"),n=a.getContext("2d");if(a.width=a.w=$,a.height=a.h=t,i(a,n,$,t),s&&(P.$h=1,a.$h=$n($,t,i,0,0),P.$h=0),"$4"===h){var o=n.createPattern(a,"repeat");return o.width=$,o.height=t,s&&(o.$h=n.createPattern(a.$h,"repeat"),o.$h.width=$,o.$h.height=t),o}return a}function $0(){}function $5($,t,i){return max(t,min(i,$))}function $a4($){for(var t,i,h=$.length;h;t=~~(rd(1)*h),i=$[--h],$[h]=$[t],$[t]=i);return $}navigator.vibrate=navigator.vibrate||navigator.mozVibrate||navigator.webkitVibrate||$0;var P={w:640,h:920,g:800,$aj:100};function $bc(){with(G=this,G.$y=parseInt(localStorage.hs)||0,G.$ag=1,G.$O=[],G.can=document.querySelector("canvas"),G.can)width=P.w,height=P.h;with(G.ctx=window.c=G.can.getContext("2d"),G.$as(),G.$a_(),$_.$3=new $a6,G.resize(),onresize=G.resize,document.body)ontouchstart=G.$8.bind(G),ontouchmove=G.$6.bind(G),ontouchend=G.$ae.bind(G),onmo$ciown=G.$bX.bind(G),onmousemove=G.$bZ.bind(G),onmouseup=G.$c_.bind(G);onkeydown=G.$aO.bind(G),onkeyup=G.$aA.bind(G),G.$aL=0,G.$bf=G.$bO=Date.now(),raf(function(){G.$c(),raf(arguments.callee)});var $bv=_.innerWidth*_.innerHeight*_.devicePixelRatio,$bx=P.w*P.h,$a0=$bv/$bx;$a0<.5&&G.$aX(2*$a0),$N("die",[[3,,.0246,,.2645,.29,,-.568,,,,,,,,,,,1,,,.0072,,.5]]),$N("$K",[[0,,.1336,,.1006,.3814,,.2867,,,,,,.1429,,,,,.7082,,,,,.5]]),$N("box$a1",[[3,,.0635,.13,.22,.14,.05,,.02,,,,,,,.28,,.04,.49,.04,,,,.25],[3,,.1733,.96,.06,.2304,,-.3608,,,,,,,,,,,1,,,,,.25],[3,,.09,.7003,.23,.0844,,.227,,,,,,,,.7108,,,1,,,,,.25]]),$N("$a$a1",[[3,,.0118,.03,.1681,.565,,-.2343,,,,.26,.6855,,,,,,1,,,,,.2]]),$N("$M",[[0,.1696,.5004,.2598,.3914,.7047,,.0141,-5e-4,,,.6608,-.8497,-.1484,-.0163,.5521,.2529,-.5832,.6323,-.595,.9155,.2821,-.0615,.26]]),$N("test",[[,.5,,.2098,,.1569,.3,.3677,,.2937,,,,,,,,,,,.2912,,,,,.4261,,,.1431,,,,1]]),$N("$ac",[[2,.18,.24,,.54,.34,,,,1,.31,,,,.8522,,,,.23,,,,,.49]])}function $bg(){with($_=this,this.score=0,this.$t=P.h-P.$aj,this.$ah=0,this.$U=0,this.$u=-400,this.$aE=0,this.$b=[],this.$cYs=[],this.down={},this.$Q=0,this.$aH=0,this.pf=this.$bi(new $T(this,P.w-200,200)))x=P.w/2,y=P.h-this.pf.h/2,$ai=0,$X=0;with(this.$a=this.$bi(new $aK(this)))x=P.w/2,y=100,$a1(this.pf);this.$I=[];for(var i=0;i<10;i++)this.$I.push({x:rd(P.w),y:rd(P.h)});this.t=0}function $C(){this.$Ms=[],this.$i=0,$d.$e(this,"$i",0,1,.5)}function $br($){$C.call(this);var t=this;this.$Ms.push(new $F($7,(P.w-$7.width)/2,0,function(){G.$ay(),t.out(G.play.bind(G))})),1==localStorage.getItem("tut")&&this.$Ms.push(new $F($a8,(P.w-$a8.width)/2,0,function(){localStorage.tut=null,G.$ay(),t.out(G.play.bind(G))})),this.$Ms.push(new $F($aps$F,(P.w-$aps$F.width)/2,0,function(){P.$h=!P.$h,localStorage.c=P.$h?"1":"0"})),this.$a2Y=200,$d.$e(this,"$a2Y",-100,this.$a2Y,.5,0,$J);var i=.5,h=3==this.$Ms.length?400:500;this.$Ms.forEach(function($){$.y=h,$d.$e($,"y",$.y+600,$.y,1,i,$J),i+=.5,h+=150}),$d.$e(this,"$bw",P.h,860,1,i,$J)}function $bl($){$C.call(this),this.score=$;var t=this;this.$Ms.push(new $F($bS,(P.w-$7.width)/2,500,function(){G.$ay(),t.out(G.play.bind(G))})),this.$Ms.push(new $F($bR,(P.w-$7.width)/2,660,function(){G.$aq()})),$d.$e(this.$Ms[0],"y",this.$Ms[0].y+500,this.$Ms[0].y,1,1,$J),$d.$e(this.$Ms[1],"y",this.$Ms[1].y+500,this.$Ms[1].y,1,1.5,$J),play("$ac")}function $T($,t,i){this.w=t,this.h=i,this.x=this.y=0,this.vX=this.vY=0,this.$ai=1,this.$aR=1,this.$X=1,this.over=[],this.$bk=1,this.$ak=0,this.$Y=0,this.sx=this.sy=1,this.$aQ=0,$d.$e(this,"$aQ",0,1,.3,0,$J)}function $aK($){$T.call(this,$,40,80),this.$2=this.wd=1,this.$D=this.$aw=this.vXFactor=this.$ax=0,this.$aT=this.$aR=0,this.$x=1}$bc.prototype={$a_:function(){G.$p=new $bm},$aq:function(){G.$p=new $br(G)},$ay:function(){G.$q.$a.$V&&G.$as()},play:function($){G.$p=null,G.$q.$a.$V&&G.$as(),G.$q.$3=new $a3},$bT:function(){var $=G.$q.score;G.$y=M.max($,G.$y),localStorage.hs=G.$y,G.lastScore=$,to(function(){$_.$3=null,G.$p=new $bl($)},1500)},$c:function(){sv(),sc(G.$ag,G.$ag);var $=Date.now(),t=($-G.$bf)/1e3;if(t=M.min(t,1/30),G.$bf=$,G.$aL++,100===G.$aL){var i=Date.now()-G.$bO;G.$aL/(i/1e3)<30&&!navigator.userAgent.match(/Android/i)&&G.$aX(.6*G.$ag)}G.$q.$c(t),G.$p&&G.$p.$c(t),$d.$c(t),rs()},$as:function(){G.$q=new $bg},resize:function(){to(function(){var $,t,i=innerWidth,h=innerHeight,s=i/h,a=P.w/P.h,n=(abs(s-a),document.getElementById("canvascontainer").style);s<=a?t=($=i)/a:$=(t=h)*a,n.width=$+"px",n.height=t+"px"},100)},pos:function($){var t=G.can.getBoundingClientRect(),i=[];$=$.touches||[$];for(var h=0;h<$.length;h++)i.push({x:($[h].clientX-t.left)/(t.width/P.w),y:($[h].clientY-t.top)/(t.height/P.h)});return i},$8:function($,t){$.preventDefault(),G.touch=G.touch||!t;var i=G.pos($);G.$O=i,scrollTo(0,1),G.$p||G.$q.$8()},$6:function($){if($.preventDefault(),G.$O){if(G.$O=G.pos($),G.$p)return;G.$q.$6()}},$ae:function($){$.preventDefault();var t=G.$O[0];G.$O=G.pos($),G.$p?G.$p.$aI(t.x,t.y):G.$q.$ae()},$aO:function($){32!=$.keyCode&&40!=$.keyCode&&38!=$.keyCode||$.preventDefault(),G.$p||G.$q.$aO($.keyCode)},$aA:function($){G.$p||G.$q.$aA($.keyCode)},$bX:function($){G.touch||G.$8($,1)},$bZ:function($){G.touch||G.$6($)},$c_:function($){G.touch||G.$ae($)},$aX:function($){G.can.width=P.w*$,G.can.height=P.h*$,G.$ag=$}},$bg.prototype={$a5:function($){for(var t=[],i=this,h=0;h<$;h++)t.push(null);return this.$b.forEach(function($){var h,s,a;if($!==i.$a)for(s=~~($.$s()*t.length/P.w),a=~~($.$E()*t.length/P.w),h=s;h<=a;h++)t[h]=min(t[h]||i.pf.$f(),$.$f())}),t},$b3:function($,t){var i=null;return this.$b.forEach(function(h){h!==$_.$a&&h.$f()>t&&(!i||h.$f()<i.$f())&&abs($-h.x)<h.w/2&&(i=h)}),i},$b6:function($){for(var t=~~(P.w/$),i=this.$a5(t),h=0,s=1;s<t;s++)null!==i[s]&&i[s]>i[h]&&(h=s);var a=i[h],n=[];for(s=0;s<t;s++)abs(i[s]-a)<150&&n.push(s);return $5((h=rp(n))*P.w/t+$/2,this.pf.x-this.pf.w/2,this.pf.x+this.pf.w/2)+rd(-P.w/t,P.w/t)/2},$cd:function($){$.y=rd(-400,-100)},$Z:function($,t,i){var h=new $T(this,(i=i||rp([{w:60,h:60},{w:90,h:60},{w:90,h:90},{w:40,h:90}])).w,i.h);return h.x=$||this.$b6(i.w),h.y=t||this.$u-100,this.$b.push(h),h},$bi:function($){return this.$b.push($),$},$bq:function($){var t=this.$b.indexOf($);t>=0&&this.$b.splice(t,1),$.$bk=0},$cc:function(){var $=0,t=0;return this.$b.forEach(function(i){i!==$_.$a&&i!==$_.pf&&i.$l&&(i.x<P.w/2?$++:t++)}),t-$},$c:function($){this.t+=$,this.$a.$V||(this.$t-=$*this.$ah*(this.$U?5:1)),(this.$aH-=$)<=0&&(this.$bP(),this.$aH=2),(this.$aE-=$)<=0&&(this.thunder(),this.$aE=15),0!==this.$Q&&this.$b.forEach(function($){$!==$_.$a&&$!==$_.pf&&$.$9($_.$Q/(Math.PI/32)*20)}),this.$3&&this.$3.$c($);var t=this.$a.y-.6*P.h-this.$u;if(!this.$a.$V&&!G.$p){var i=t>0?100:50;t=$5(t,-(i=max(10,.5*abs(t)))*$,i*$),this.$u+=t,this.$u=min(this.$u,this.$t+P.$aj-P.h)}if(fs("#000"),fr(0,0,P.w,P.h),P.$h||di($ca,0,0),!G.$p&&this.score>0){i=this.score.toString();var h=$P(i);$i(.2),$z(c,i,P.$h?"black":"white",(P.w-h)/2,300),$i(1)}sv(),tr(0,-~~this.$u),this.$S&&tr(~~rd(-8,8),~~rd(-8,8)),sv(),tr(0,~~max(this.$t+P.$aj,this.$u+P.h)-$az.height),fs($az),fr(0,0,P.w,$az.height),rs(),this.$H(50*this.t,this.$t-20),sv(),tr(P.w/2,P.h/2),rt(this.$Q),tr(-P.w/2,-P.h/2);var s=this.$b.slice(0);for(var a in s)s[a].$c($);for(var a in this.$cYs)this.$cYs[a].$R();for(rs(),this.$H(50*-this.t,this.$t),this.$H(50*this.t,this.$t+20),rs(),sv(),tr(P.w/2,P.h/2),rt(-M.PI/64),tr(-P.w/2,-P.h/2),fs("#fff"),$i(this.$U?1:.5),a=0;a<this.$I.length;a++)this.$I[a].y+=$*(this.$U?2e3:1e3),this.$I[a].y>P.h&&(this.$I[a].x=rd(P.w),this.$I[a].y=rd(-600,-100)),fr(this.$I[a].x,this.$I[a].y,2,40);rs(),G.touch&&!G.$p&&!this.$a.$V&&this.$a.$x&&($i(-1==this.$a.$D?1:.5),di($b7,60,P.h-100),$i(1==this.$a.$D?1:.5),di($aD,P.w-60-$aD.width,P.h-100),$i(this.$a.vY<0?1:.5),di($K,(P.w-$K.width)/2,P.h-100),$i(1))},$H:function($,t){t=~~t,sv(),tr($,t),$i(.5),fs($H),fr(-$,0,P.w,$H.height);var i=~~($H.height+t-this.$u);fs("#d5d5d5"),fr(-$,$H.height,P.w,P.h-i),rs()},$8:function($,t){$_.$bp()},$6:$0,$ae:function(){$_.$bp()},$aA:function($){$_.down[$]=0,$_.$aY()},$aO:function($){$_.down[$]=1,38!=$&&87!=$||$_.$a.$K(),$_.$aY()},$aY:function(){var $=0;($_.down[37]||$_.down[65])&&($=-1),($_.down[39]||$_.down[68])&&($=1),$_.$a.$aS($)},$bp:function($){if(G.touch){var t=0;G.$O.forEach(function($){$.x<P.w/3?t=-1:$.x>2*P.w/3?t=1:$_.$a.$K()}),$_.$a.$aS(t)}},$cb:function(){var $=function(){$_.$b.forEach(function($){$!==$_.pf&&$!==$_.$a&&($.vX=rd(-100,100))})};$_.$a.$g("EARTHQUAKE!!!"),to(function(){$_.$S=1},2e3);for(var t=2;t<5;t+=.2)to($,1e3*t);to(function(){$_.$S=0,$_.$a.$g("Phewww")},1e3*t)},$b9:function(){$_.$a.$g("FLOOD!!!"),to(function(){$_.$U=1},2e3),to(function(){$_.$U=0,$_.$a.$g("Flood's over")},8e3)},$bK:function(){$_.$a.$g("BOX STOOORM!!!");for(var $=[],t=0;t<1;t++)for(var i=0;i<P.w;i+=rd(100,200))$.push(i);$a4($),t=0;for(var h=3;t<$.length;t++,h+=1.2)to(function($){return function(){$_.$Z($)}}($[t]),1e3*h);to(function(){$_.$a.$g("Storm is over")},1e3*h+1e3)},add$1:function($){$_.$cYs.push($)},$bV:function($){var t=$_.$cYs.indexOf($);t>=0&&$_.$cYs.splice(t,1)},$bP:function(){$_.$bQ(),$_.$b.sort(function($,t){var i=abs($.x-P.w/2),h=abs(t.x-P.w/2);return $===$_.$a?1:t===$_.$a?-1:h-i})},$bQ:function(){for(var $=max($_.$u+P.h,$_.$t+P.$aj),t=$_.$b.length;$_.$b[--t];)$_.$b[t].$f()>=$&&($_.$b[t].over.forEach(function($){$!==$_.$a&&($.$l=null,$.$ai=0)}),$_.$b.splice(t,1))},thunder:function(){for(var $=P.$h,t=function(){P.$h=!$},i=function(){P.$h=$},h=0;h<400;h+=200)to(t,h),to(i,h+100)},tilt:function(){$_.$a.$g("THE PLATFORM IS TILTING!!!");var $=$_.$cc(),t=M.PI/64;$<0&&(t*=-1),$d.$e($_,"$Q",0,t,1,1,$G,function(){$d.$e($_,"$Q",$_.$Q,0,1,2)})}},$C.prototype={$c:function($){for(var t in $i(this.$i),fs("rgba(0,0,0,.7)"),fr(0,0,P.w,P.h),this.$Ms)this.$Ms[t].$R();$i(1)},$aI:function($,t){for(var i in this.$Ms)if(this.$Ms[i].$bI($,t))return void this.$Ms[i].$aI()},out:function($){$d.$e(this,"$i",this.$i,0,.5,0,$G,$)}},$br.prototype=xt($C.prototype,{$c:function($){$C.prototype.$c.call(this,$),$i(this.$i),di($a2,(P.w-$a2.width)/2,this.$a2Y);var t=G.$y?"highscore: "+G.$y:"";$z(c,t,"white",(P.w-$P(t,.5))/2,this.$bw,.5,1),$i(1)}}),$bl.prototype=xt($C.prototype,{$c:function($){$C.prototype.$c.call(this,$),$i(this.$i),di($ac,(P.w-$ac.width)/2,200);var t=this.score+"";$z(c,t,"white",(P.w-$P(t))/2,300,1,1),t="best: "+G.$y,$z(c,t,"white",(P.w-$P(t,.5))/2,400,.5,1),$i(1)}}),$T.prototype={$f:function(){return this.y-this.h/2},$o:function(){return this.y+this.h/2},$s:function(){return this.x-this.w/2},$E:function(){return this.x+this.w/2},$c:function($){var t,i=this.$o(),h=this;if(this.$ai)if(this.$l)t=this.$l,(abs(t.x-this.x)>(this.w+t.w)/2||abs(t.y-this.y)>(this.h+t.h)/2+2||!t.$bk)&&this.$aG();else if(this.y+=$*this.vY,this.vY+=$*P.g,this.vY>0&&!this.deco$a0n){this.y>P.h&&$_.$bq(this);var s=this.$bU(i);s&&this.$aF(s)&&this.$aZ(s)&&this.$a1(s)}if(0!=this.vX){var a=this.x;this.x+=this.vX*$,this.vX>0?this.vX=max(0,this.vX-300*$):this.vX<0&&(this.vX=min(0,this.vX+300*$)),$_.$b.forEach(function($){$!==h&&$.$aF(h)&&($.$9(.6*h.vX),h.x=a,h.vX=0)})}var n=$5(this.vY/1e3,0,1)*$bj.height-this.$Y;if(this.$Y+=$5(n,-500*$,500*$),i<$_.$t&&this.$o()>$_.$t&&!this.$l)for(var o=0;o<20;o++){var r=new $1(rd(10,20),"#ddd");r.x=rd(this.$s(),this.$E()),r.y=this.$o()+50,$_.add$1(r),r.x,this.x;var e=2*(r.x-this.x);$d.$e(r,"x",r.x,r.x+e,.3),$d.$e(r,"y",r.y,r.y-rd(100,200),.3),$d.$e(r,"s",r.s,0,.3,0,$G,r.$al.bind(r))}this.$R()},$aZ:function($){return 1},$R:function(){sv(),$i(this.deco$a0n?.5:1),tr(this.x,this.y),sc(this.sx,this.sy),tr(-this.x,-this.y);var $=(P.w/2-this.$s())/(P.w/2),t=(P.w/2-this.$E())/(P.w/2),i=20*min(0,$),h=20*max(0,t);this.$ai&&this.$Y>20&&(sv(),tr(this.$s(),this.y-this.$Y),fs($bj),fr(i,0,this.w-i+h,abs(this.$Y)),rs()),fs("#ffffff"),fr(this.x-this.w/2,this.y-this.h/2+this.$ak,this.w,this.h),this.y<$_.$u-this.h/2&&!this.deco$a0n&&(sv(),tr(this.x,$_.$u+100),sc(this.$aQ,this.$aQ),di($aB,-$aB.width/2,-$aB.height),rs()),fs("#c0c0c0"),fr(this.$s(),this.$f()+this.$ak,i,this.h),fr(this.$E(),this.$f()+this.$ak,h,this.h),rs()},$bJ:function($){-1===this.over.indexOf($)&&this.over.push($)},$bY:function($){var t=this.over.indexOf($);t>=0&&this.over.splice(t,1)},$aG:function(){this.$l&&(this.$l.$bY(this),this.$l=null,this.vY=0)},$a1:function($){var t=this.vY,i=function($,t,i,h){var s=$/h;return(1-M.pow(abs(2*s-1),3))*i+t};this.y=$.$f()-this.h/2,this.vY>100&&this.$aR&&$d.$e(this,"$ak",0,-this.vY/45,.4,0,i),this.vY=0,this.$aG(),this.$l=$,$.$bJ(this),$.$aU(this,t);for(var h=this.$s()+rd(5,15);h<this.$E();h+=rd(10,25)){var s=new $1(rd(10,20),"gray");s.x=h,s.y=this.$o(),$_.add$1(s),$d.$e(s,"y",s.y,s.y-rd(30,80),.3,0,$G,s.$al.bind(s)),$d.$e(s,"s",s.s,0,.3)}play(this===$_.$a?"$a$a1":"box$a1"),$d.$e(this,"sx",1,1.1,.2,0,i),$d.$e(this,"sy",1,.9,.2,0,i)},$aU:$0,$b0:function($){return this.$o()>$.$o()&&abs($.x-this.x)<(this.w+$.w)/2},$bL:function($,t){var i;this.x,$.x>this.x?($.x=this.$E()+$.w/2,t&&this.$X&&(i=-150)):($.x=this.$s()-$.w/2,t&&this.$X&&(i=150)),i&&this.$9(i)},$9:function($){for(var t in this.vX=$,this.over)this.over[t].$9(.7*$)},$bU:function($){var t,i=this;return this.$o(),$_.$b.forEach(function($){$.$b0(i)&&(!t||$.$f()<t.$f())&&(t=$)}),t},$aF:function($){return abs($.x-this.x)<(this.w+$.w)/2&&abs($.y-this.y)<(this.h+$.h)/2}},$aK.prototype=xt($T.prototype,{$c:function($){this.$b4=this.$o(),this.$bE=this.$f(),$T.prototype.$c.call(this,$),this.$x||(this.$D=0),this.$D?this.$D!==this.$2?this.vXFactor=0:this.vXFactor=min(this.vXFactor+4*$,1):this.vXFactor=max(0,this.vXFactor-4*$),this.$2=this.$D||this.$2,this.x+=300*this.$2*this.vXFactor*$,this.$aw+=abs(this.vXFactor)*$,this.$l||(this.$aw+=$),this.$aT=0!==this.$D,this.$ax-=$,this.$w-=$;var t=this;$_.$b.forEach(function($){t!==$&&t.$aF($)&&!$.deco$a0n&&(t.$bE>$.$o()?(t.vY=0,t.y=$.$o()+t.h/2):($.$bL(t,t.$l),t.$l&&(t.$ax=.3)))}),this.y>$_.$t&&(this.$g("Cold cold cooooold!!!"),this.y>$_.$t+50&&this.die())},$aZ:function($){return $.$f()>=this.$b4&&$.$f()<=this.$o()},$R:function(){var $=$bW;di($,this.x-$.width/2,this.y-$.height/2),sv(),tr(this.$s(),this.$f()),this.$w>0&&(fs("#fff"),fr(this.w/2,-10,4,this.$gY+30),c.textAlign="center",c.textBaseline="middle",c.font="16pt Arial",fs("#000"),ft(this.$aN,this.w/2+1,this.$gY+1),fs("#fff"),ft(this.$aN,this.w/2,this.$gY)),tr(this.w/2,0),sc(this.wd*this.sx,1),tr(-this.w/2,0),fs("#fff"),fr(0,0,this.w,60);var t=5*M.sin(this.$aw*M.PI*2/.5)+5,i=20,h=20;!this.$aT&&this.$l||(i=20-t,h=10+t),fr(5,60,5,i),fr(30,60,5,h),fs("#000");var s=$_.t%4,a=min(1,max(3.85-s,s-3.85)/.15);$=5*a,fr(20,15,5,5*a),fr(31,15,5,5*a),fs("#ccc"),this.$l?this.$ax<=0?fr(3,25,5,23):(fr(16,33,34,5),fr(40,25,15,5)):(fr(3,-5,5,30),fr(17,-5,5,5)),rs()},$K:function(){this.$l&&this.$x&&(this.$aG(),this.$l=0,this.vY=-400,play("$K"))},$aU:function(){this.die()},die:function(){$_.$bq(this),this.$V=1,play("die"),G.$bT();for(var $=0;$<20;$++){(h=new $1(rd(2,8),"red")).x=rd(this.$s()-10,this.$E()+10),h.y=rd(this.$f(),this.$o()),$_.add$1(h);var t=$_.$b3(h.x,h.y),i=t?t.$f():P.h+200;$d.$e(h,"y",h.y,i,rd(.9,1.2),0,easeOutBounce),$d.$e(h,"s",h.s,0,1,3,$G,h.$al.bind(h))}for($=0;$<20;$++){var h;(h=new $1(rd(10,20),"red")).x=rd(this.$s()-10,this.$E()+10),h.y=rd(this.$f(),this.$o()),$_.add$1(h),$d.$e(h,"y",h.y,h.y-rd(30,80),.3,0,$G,h.$al.bind(h)),$d.$e(h,"s",h.s,0,.3)}$_.$S=1,to(function(){$_.$S=0},500),navigator.vibrate(500)},$g:function($,t){$!=this.$aN&&$d.$e(this,"$gY",0,-80,.5,0,$J),this.$aN=$,this.$w=t||3},$aS:function($){$!==this.$D&&$&&$d.$e(this,"wd",this.wd,$,.1),this.$D=$}});var $bb={a:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,,1]],b:[[1,1,1],[1,,1],[1,1],[1,,1],[1,1,1]],c:[[1,1,1],[1,,],[1,,],[1,,],[1,1,1]],e:[[1,1,1],[1,,],[1,1],[1,,],[1,1,1]],g:[[1,1,1],[1,,],[1,,],[1,,1],[1,1,1]],h:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],i:[[1,1,1],[,1],[,1],[,1],[1,1,1]],k:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]],l:[[1,,0],[1,,],[1,,],[1,,],[1,1,1]],m:[[1,,1],[1,1,1],[1,,1],[1,,1],[1,,1]],n:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,,1]],o:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],p:[[1,1,1],[1,,1],[1,1,1],[1,,],[1,,]],r:[[1,1,1],[1,,1],[1,1],[1,,1],[1,,1]],s:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],t:[[1,1,1],[,1],[,1],[,1],[,1]],u:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],v:[[1,,1],[1,,1],[1,,1],[1,,1],[,1]],w:[[1,,1,,1],[1,,1,,1],[1,,1,,1],[1,,1,,1],[,1,,1]],x:[[1,,1],[1,,1],[,1],[1,,1],[1,,1]],y:[[1,,1],[1,,1],[1,1,1],[,1],[,1]],"'":[[1]],".":[[0],[0],[0],[0],[1]]," ":[[,0],[,],[,],[,],[,]],":":[[0],[1],[],[1],[]],"?":[[1,1,1],[,,1],[,1,1],[,,],[,1]],"!":[[,1],[,1],[,1],[,,],[,1]],1:[[1,1,0],[,1],[,1],[,1],[1,1,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[,1,1],[,,1],[1,1,1]],4:[[1,,0],[1,,],[1,,1],[1,1,1],[,,1]],5:[[1,1,1],[1,,],[1,1],[,,1],[1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,1],[,1],[,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]]},$am={},$b_=function($){for(var t in $am[$]={},$bb){var i=$bb[t];$am[$][t]=$n(10*i[0].length+10,10*i.length,function(t,h){for(var s in h.fs($),i)for(var a in i[s])i[s][a]&&h.fr(10*a,10*s,10,10)})}};$b_("white"),$b_("black");var $z=function($,t,i,h,s,a,n){a=a||1,n&&$z($,t,"black",h+5,s+5,a,0),$.sv(),$.tr(h,s),$.sc(a,a),h=0;for(var o=0;o<t.length;o++){var r=t.charAt(o),e=$am[i][r];e&&($.di(e,h,0),h+=e.width)}$.rs()},$P=function($,t){for(var i=0,h=$.length;h--;){var s=$am.white[$.charAt(h)];i+=s?s.width:0}return i*(t||1)},$ca=$n(P.w,P.h,function($,t){t.fs("#000"),t.fr(0,0,$.w,$.h),t.fs("white");for(var i=0;i<300;i++)t.globalAlpha=rd(.5,1),t.fr(rd(P.w),rd(P.h),2,2);var h=t.clg(0,P.h-300,0,P.h-800);h.addColorStop(0,"rgba(0, 0, 0, 1)"),h.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fs(h),t.fr(0,0,P.w,P.h)}),$H=$n(100,20,function($,t){var i=$.w/100,h=$.h/2,s=$.w;t.fs("#d5d5d5"),t.beginPath(),t.mt(0,h);for(var a=0,n=0;a<=100;a++,n+=i)t.lt(n,M.sin(n*M.PI*2/s)*h+h);t.lt(n,$.h),t.lt(0,$.h),t.fill()},"$4",1),$az=$n(100,400,function($,t){var i=t.clg(0,0,0,$.h),h=P.$h?"0,0,0":"255,255,255";i.addColorStop(0,"rgba("+h+", 0)"),i.addColorStop(1,"rgba("+h+", 1)"),t.globalAlpha=.3,t.fs(i),t.fr(0,0,$.w,$.h)},"$4",1),$a2=$n(475,115,function($,t){$z(t,"it's raining","white",0,0,1,1),$z(t,"...boxes?!","white",0,60,1,1)}),$M=function($,t){return $n(400,120,function(t,i){i.fs("#fff"),i.fr(0,0,400,100),i.fs("#757575"),i.fr(0,100,t.w,20),$z(i,$,"black",(t.w-$P($))/2,25)})},$7=$M("play"),$a8=$M("tutorial"),$bS=$M("try again"),$aps$F=$M("reverse"),$bR=$M("back"),$a_=function($,t,i){return $n(P.w,P.h/2,function(h,s){s.fs(t),s.fr(0,0,h.w,h.h),$z(s,i,$,(h.w-$P(i))/2,h.h/2-25)})},$bN=$a_("black","#fff","black on white"),$bM=$a_("white","#000","white on black"),$ac=$n(345,55,function($,t){$z(t,"game over","white",0,0,1,1)}),$aD=$n(80,80,function($,t){t.fs("#000"),t.beginPath(),t.mt(0,0),t.lt($.w,$.h/2),t.lt(0,$.h),t.fill()},0,1),$b7=$n(80,80,function($,t){t.tr($.w,0),t.sc(-1,1),t.di($aD,0,0)},0,1),$K=$n(80,80,function($,t){t.fs("#000"),t.bp(),t.arc($.w/2,$.h/2,$.w/2,0,2*M.PI,1),t.fill()},0,1),$aB=$n(80,80,function(c,r){with(r)tr(0,c.h),sc(2,-2),fs("#fff"),bp(),mt(20,40),lt(40,20),lt(30,20),lt(30,0),lt(10,0),lt(10,20),lt(0,20),fill()},0,1),$bW=$n(150,150,function($,t){var i=t.createRadialGradient($.w/2,$.h/2,1,$.w/2,$.h/2,$.h/2),h=P.$h?"0,0,0":"255,255,255";i.addColorStop(0,"rgba("+h+",1)"),i.addColorStop(1,"rgba("+h+",0)"),t.globalAlpha=.3,t.fs(i),t.fr(0,0,$.w,$.h)},0,1),$bj=$n(20,200,function($,t){var i=t.clg(0,0,0,$.h),h=P.$h?"0,0,0":"255,255,255";i.addColorStop(0,"rgba("+h+", 0)"),i.addColorStop(1,"rgba("+h+", 1)"),t.globalAlpha=.5,t.fs(i),t.fr(0,0,$.w,$.h)},"$4",1);addEventListener("load",function(){new $bc});var $es=[];function $G($,t,i,h){return $/h*i+t}function $J($,t,i,h,s){return null==s&&(s=1.70158),i*(($=$/h-1)*$*((s+1)*$+s)+1)+t}function easeOutBounce($,t,i,h){return($/=h)<1/2.75?i*(7.5625*$*$)+t:$<2/2.75?i*(7.5625*($-=1.5/2.75)*$+.75)+t:$<2.5/2.75?i*(7.5625*($-=2.25/2.75)*$+.9375)+t:i*(7.5625*($-=2.625/2.75)*$+.984375)+t}var $d={$e:function($,t,i,h,s,a,n,o){$es.push({o:$,p:t,a:i,b:h,d:s,l:a||0,f:n||$G,e:o||$0,t:0})},$c:function($){for(var t,i=$es.length-1;i>=0;i--)(t=$es[i]).l>0?(t.l-=$,t.o[t.p]=t.a):(t.t=min(t.d,t.t+$),t.o[t.p]=t.f(t.t,t.a,t.b-t.a,t.d),t.t==t.d&&(t.e(),$es.splice(i,1)))}};function $F($,t,i,h){this.$r=$,this.x=t,this.y=i,this.$aIf=h,this.$bt=1}function $bo($){this.$W=6,this.$ar=this.$an=10,this.$aJ=40,this.$U=0,this.$av=40,$_.$a.$x=1,this.$af=[["I should have brought my swimsuit","Or my umbrella"],["How do I shoot?"],["It's raining men!","Alleluia it's raining men!"],["What does the box say?"],["Did the weather man predict this?"],["Follow me @remvst"],["This does not feel like Tetris at all"],["I'm siiinging in the raiiin"],["I should have taken swimming lessons"],["I have no mouth :( "],["Dem graphics"],["I need a helmet","Safety first"],["Did you notice I blink?"],["Like the game?","Tweet about it!"]],$a4(this.$af),this.$m={};var t=0;$||(this.$m[0]="Hello"+(void 0!==G.lastScore?" again":"")+"!",G.$y>0&&void 0===G.lastScore&&(this.$m[0]="Hey, you came back!"),t+=3);var i=0;$||("lastScore"in G&&G.$y<40?(this.$m[3]="I see you didn't do too well last time",this.$m[6]="Here is my advice",this.$m[9]="Try to avoid falling boxes",this.$m[12]="Then, build a wall with the boxes",this.$m[15]="And climb it to avoid the water",this.$m[18]="Let's try it!",this.$m[21]="It's raining boxes!!!",i=30,this.$W=24):(this.$m[t]="It's raining boxes today!",this.$m[t+7]="Water is rising!",this.$W=6,i=15)),this.$ar=this.$an=this.$W+7;for(var h=0;h<this.$af[h];h++,i+=15)for(var s=0;s<this.$af[h][s];s++,i+=3)this.$m[i]=this.$af[h][s];this.$m[i+10]="You're getting good at this!",this.$m[i+13]="Like... really good!",this.t=0}function $a3(){var $=this,t={w:60,h:60};this.$aus={hello:{$v:function(){$_.$a.$g("Hello!"),$_.$a.$x=0},$c:function(){$_.$a.$w<0&&$.$A("name")}},name:{$v:function(){$_.$a.$g("My name is Didi")},$c:function(){$_.$a.$w<0&&$.$A("$bH")}},$bH:{$v:function(){$_.$a.$g("It's raining boxes today!"),$.bx=$_.$Z($_.pf.x-$_.pf.w/2+t.w/2,-100,t)},$c:function(){$.bx.$l&&$.$A("push")}},push:{$v:function(){$_.$a.$g("Try to push this one away!"),$_.$a.$x=1},$c:function(){2===$_.$b.length?$.$A("pushed"):$_.$a.$w<0&&$_.$a.$g("Use the arrow "+(G.touch?"buttons":"keys")+" to move")}},pushed:{$v:function(){$_.$a.$g("Nice!"),$_.$a.$x=0},$c:function(){$_.$a.$w<0&&$.$A("$b2")}},$b2:{$v:function(){$_.$a.$g("Boxes can stack up");var i=$_.pf.x+$_.pf.w/2-70;$_.$a.x>P.w/2&&(i=P.w-i),$.$b=[];var h=[i,i-70,i+70,i-35,i+35,i];h.forEach(function(i,h){to(function(){$.$b.push($_.$Z(i,-100*h-100,t))},400*h)}),to(function(){$.$A("$bG")},200*h.length+2e3)},$c:$0},$bG:{$v:function(){$_.$a.$g("Try to jump on them"),$_.$a.$x=1;for(var t=0;t<$.$b.length;t++)$.$b[t].$X=0},$c:function(){$_.$a.$l===$.$b[$.$b.length-1]?$.$A("$b1"):$_.$a.$w<0&&$_.$a.$g(G.touch?"Use the round button to jump":"Use the up arrow to jump")}},$b1:{$v:function(){$_.$a.$g("Nice!"),$_.$a.$x=0},$c:function(){$_.$a.$w<0&&$.$A("$b8")}},$b8:{$v:function(){$_.$a.$g("Try not to fall in the water!");for(var t=0;t<$.$b.length;t++)$.$b[t].$X=1},$c:function(){$_.$a.$w<0&&$.$A("start")}},start:{$v:function(){$_.$a.$g("Let's play now!"),$_.$a.$x=1},$c:function(){$_.$a.$w<0&&$.end(1)}}},1==localStorage.tut?to(this.end,1):this.$A("hello")}function $a6(){this.nb=0}function $1($,t){this.s=$,this.c=t}function $bm(){$C.call(this);var $=this;this.$Ms.push(new $F($bN,0,0,function(){P.$h=1,localStorage.c="1",$.out(G.$aq.bind(G))})),this.$Ms.push(new $F($bM,0,P.h/2,function(){P.$h=0,localStorage.c="0",$.out(G.$aq.bind(G))}));var t=localStorage.c;t&&(P.$h="1"===t,setTimeout(function(){G.$aq()},0))}function J(){this.B=function($){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=$[t]||0;.01>this.c&&(this.c=.01),.18>($=this.b+this.c+this.e)&&($=.18/$,this.b*=$,this.c*=$,this.e*=$)}}$F.prototype={$R:function(){di(this.$r,this.x,this.y)},$bI:function($,t){return this.$bt&&$>this.x&&t>this.y&&$<this.x+this.$r.width&&t<this.y+this.$r.height},$aI:function(){this.$aIf(),play("$M")}},$bo.prototype={$c:function($){if(!$_.$a.$V&&!G.$p){this.t+=$;var t=~~this.t;if(this.$m[t]&&($_.$a.$g(this.$m[t]),this.$m[t]=null),(this.$W-=$)<=0){var i=$_.$Z();this.$W=3,abs(i.x-$_.$a.x)<($_.$a.w+i.w)/2&&$_.$a.$g("WATCH OUT!",2)}if((this.$av-=$)<=0&&$_.$a.$l){for(var h,s=0;s<$_.$b.length;s++)if((i=$_.$b[s])!=$_.$a&&i.$f()<$_.$a.$o()&&i.$l){h=1;break}h||($_.$a.$g("I'm on top of the wooooooorld!"),this.$av=20)}if((this.$ar-=$)<=0&&($_.score+=1,this.$ar=1,$_.score===G.$y+1&&G.$y&&$_.$a.$g("New record!")),this.$an>0?(this.$an-=$,this.$an<=0&&$_.$a.$g("Water is rising!"),$_.$ah=0):($_.$ah=2.5,this.t>60&&($_.$ah=3.5)),this.$aJ-=$,this.$aJ<=0){var a=rp(["$cb","$b9","$bK","tilt"]);$_[a].call($_),this.$aJ=40}}}},$a3.prototype={$c:function($){this.$au&&this.$au.$c($),$_.$a.x=$5($_.$a.x,$_.pf.x-$_.pf.w/2,$_.pf.x+$_.pf.w/2)},$A:function($){(this.$au=this.$aus[$]).$v()},end:function($){localStorage.tut=1,$_.$3=new $bo($)}},$a6.prototype={$c:function($){this.nb-=$,this.nb<=0&&($_.$Z().deco$a0n=1,this.nb=.5)}},$1.prototype={$R:function($){fs(this.c),fr(this.x-this.s/2,this.y-this.s/2,this.s,this.s)},$al:function(){$_.$bV(this)}},$bm.prototype=xt($C.prototype,{out:function($){$d.$e(this.$Ms[0],"y",0,-P.h/2,.2),$d.$e(this.$Ms[1],"y",P.h/2,P.h,.2,0,$G,$)}});var W=new function(){var $,t,i,h,s,a,n,o,r,e,f,c;this.A=new J,this.$ba=function(){var $=this.A;h=100/($.f*$.f+.001),s=100/($.g*$.g+.001),a=1-.01*$.h*$.h*$.h,n=1e-6*-$.i*$.i*$.i,$.a||(f=.5-$.n/2,c=5e-5*-$.o),o=0<$.l?1-.9*$.l*$.l:1+10*$.l*$.l,r=0,e=1==$.m?0:2e4*(1-$.m)*(1-$.m)+32},this.D=function(){this.$ba();var h=this.A;return $=1e5*h.b*h.b,t=1e5*h.c*h.c,i=1e5*h.e*h.e+10,$+t+i|0},this.C=function(u,l){var b=1!=(q=this.A).s||q.v,d=.1*q.v*q.v,w=1+3e-4*q.w,v=.1*q.s*q.s*q.s,p=1+1e-4*q.t,g=1!=q.s,y=q.x*q.x,_=q.g,G=q.q||q.r,P=.2*q.r*q.r*q.r,x=q.q*q.q*(0>q.q?-1020:1020),m=q.p?32+(2e4*(1-q.p)*(1-q.p)|0):0,M=q.d,A=q.j/2,k=.01*q.k*q.k,I=q.a,S=$,Y=1/$,C=1/t,T=1/i;.8<(q=5/(1+20*q.u*q.u)*(.01+v))&&(q=.8);for(var X,E,F,D,O,q=1-q,H=!1,R=0,z=0,U=0,N=0,W=0,J=0,L=0,K=0,Q=0,B=0,j=Array(1024),V=Array(32),Z=j.length;Z--;)j[Z]=0;for(Z=V.length;Z--;)V[Z]=2*Math.random()-1;for(Z=0;Z<l;Z++){if(H)return Z;if(m&&++Q>=m&&(Q=0,this.$ba()),e&&++r>=e&&(e=0,h*=o),(h*=a+=n)>s&&(h=s,0<_&&(H=!0)),E=h,0<A&&(B+=k,E*=1+Math.sin(B)*A),8>(E|=0)&&(E=8),I||(0>(f+=c)?f=0:.5<f&&(f=.5)),++z>S)switch(z=0,++R){case 1:S=t;break;case 2:S=i}switch(R){case 0:U=z*Y;break;case 1:U=1+2*(1-z*C)*M;break;case 2:U=1-z*T;break;case 3:U=0,H=!0}G&&(0>(F=0|(x+=P))?F=-F:1023<F&&(F=1023)),b&&w&&(1e-5>(d*=w)?d=1e-5:.1<d&&(d=.1)),O=0;for(var $$=8;$$--;){if(++L>=E&&(L%=E,3==I))for(X=V.length;X--;)V[X]=2*Math.random()-1;switch(I){case 0:D=L/E<f?.5:-.5;break;case 1:D=1-L/E*2;break;case 2:D=0>(D=0>(D=.5<(D=L/E)?6.28318531*(D-1):6.28318531*D)?1.27323954*D+.405284735*D*D:1.27323954*D-.405284735*D*D)?.225*(D*-D-D)+D:.225*(D*D-D)+D;break;case 3:D=V[Math.abs(32*L/E|0)]}b&&(X=J,0>(v*=p)?v=0:.1<v&&(v=.1),g?(W+=(D-J)*v,W*=q):(J=D,W=0),N+=(J+=W)-X,D=N*=1-d),G&&(j[K%1024]=D,D+=j[(K-F+1024)%1024],K++),O+=D}O=.125*O*U*y,u[Z]=1<=O?32767:-1>=O?-32768:32767*O|0}return l}};window.$bA=function($){W.A.B($);var t=W.D();$=new Uint8Array(4*((t+1)/2|0)+44),t=2*W.C(new Uint16Array($.buffer,44),t),(i=new Uint32Array($.buffer,0,44))[0]=1179011410,i[1]=t+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=t,t+=44;for(var i=0,h="data:audio/wav;base64,";i<t;i+=3){var s=$[i]<<16|$[i+1]<<8|$[i+2];h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[s>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[s>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[s>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&s]}return i-=t,h.slice(0,h.length-i)+"==".slice(0,i)};var $ao={},$N=function($,t){$ao[$]=[],t.forEach(function(t){var i=new Audio;i.src=$bA(t),$ao[$].push(i)})},play=function($){$ao[$]&&rp($ao[$]).play()}</script></body></html>
