<!doctype html><style>body{margin:0;padding:0}</style><canvas height=640 id=mainCanvas width=640></canvas><script>function Note(e){var t=e.split(space);this.frequency=Note.getFrequency(t[0])||0,this.duration=Note.getDuration(t[1])||0}function Sequence(e,t,n){this.ac=e||new AudioContext,this.createFxNodes(),this.tempo=t||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,n||[])}octave="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",openGuitar=["E2 q","A2 q","D3 q","G3 q","B3 q","E4 q"],eMaj=["E2 q","B2 q","E3 q","G#3 q","B3 q","E4 q"],eMin=["E2 q","B2 q","E3 q","G3 q","B3 q","E4 q"],fMaj=["E#2 q","B#3 q","E#3 q","A3 q","C4 q","F4 q"],fMin=["E#2 q","B#3 q","E#3 q","G#3 q","C4 q","F4 q"],aMin=["E2 q","A2 q","E3 q","A3 q","C q","E4 q"],aMin=["E2 q","A2 q","E3 q","A3 q","C4 q","E4 q"],cMaj=["G#2 q","C3 q","E3 q","G3 q","C4 q","E4 q"],dMaj=["E2 q","A2 q","D3 q","A3 q","D4 q","F#4 q"];var enharmonics="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",middleC=440*Math.pow(Math.pow(2,1/12),-9),numeric=/^[0-9.]+$/,octaveOffset=4,space=/\s+/,num=/(\d+)/,offsets={};enharmonics.split("|").forEach((function(e,t){e.split("-").forEach((function(e){offsets[e]=t}))})),Note.getFrequency=function(e){var t=e.split(num),n=offsets[t[0]],o=(t[1]||octaveOffset)-octaveOffset;return middleC*Math.pow(Math.pow(2,1/12),n)*Math.pow(2,o)},Note.getDuration=function(e){return numeric.test(e)?parseFloat(e):e.toLowerCase().split("").reduce((function(e,t){return e+("w"===t?4:"h"===t?2:"q"===t?1:"e"===t?.5:"s"===t?.25:0)}),0)},Sequence.prototype.createFxNodes=function(){var e=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(t,n){(n=this[t[0]]=this.ac.createBiquadFilter()).type="peaking",n.frequency.value=t[1],e.connect(e=n)}.bind(this)),e.connect(this.ac.destination),this},Sequence.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(e){this.notes.push(e instanceof Note?e:new Note(e))}.bind(this)),this},Sequence.prototype.createCustomWave=function(e,t){t||(t=e),this.waveType="custom",this.customWave=[new Float32Array(e),new Float32Array(t)]},Sequence.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},Sequence.prototype.scheduleNote=function(e,t){var n=60/this.tempo*this.notes[e].duration,o=n*(1-(this.staccato||0));return this.setFrequency(this.notes[e].frequency,t),this.smoothing&&this.notes[e].frequency&&this.slide(e,t,o),this.setFrequency(0,t+o),t+n},Sequence.prototype.getNextNote=function(e){return this.notes[e<this.notes.length-1?e+1:0]},Sequence.prototype.getSlideStartDelay=function(e){return e-Math.min(e,60/this.tempo*this.smoothing)},Sequence.prototype.slide=function(e,t,n){var o=this.getNextNote(e),i=this.getSlideStartDelay(n);return this.setFrequency(this.notes[e].frequency,t+i),this.rampFrequency(o.frequency,t+n),this},Sequence.prototype.setFrequency=function(e,t){return this.osc.frequency.setValueAtTime(e,t),this},Sequence.prototype.rampFrequency=function(e,t){return this.osc.frequency.linearRampToValueAtTime(e,t),this},Sequence.prototype.play=function(e){return e="number"==typeof e?e:this.ac.currentTime,this.createOscillator(),this.osc.start(e),this.notes.forEach(function(t,n){e=this.scheduleNote(n,e)}.bind(this)),this.osc.stop(e),this.osc.onended=this.loop?this.play.bind(this,e):null,this},Sequence.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},TinyMusic={},TinyMusic.Note=Note,TinyMusic.Sequence=Sequence,guitarScreen=function(){var e=document.getElementById("mainCanvas"),t=e.getContext("2d"),n=e.width/2,o=e.height/2;for(t.beginPath(),t.rect(0,0,2*n,2*o),t.fillStyle="grey",t.fill(),t.beginPath(),t.arc(n,o,91,0,2*Math.PI,!1),t.fillStyle="saddlebrown",t.fill(),t.lineWidth=5,t.strokeStyle="#003300",t.stroke(),t.beginPath(),t.arc(.6*n,1.4*o,140,0,2*Math.PI,!1),t.fillStyle="saddlebrown",t.fill(),t.lineWidth=5,t.strokeStyle="#003300",t.stroke(),t.beginPath(),t.arc(.6*n,1.4*o,42,0,2*Math.PI,!1),t.fillStyle="black",t.fill(),t.lineWidth=5,t.strokeStyle="brown",t.stroke(),t.save(),t.translate(e.width/2,e.height/2),t.rotate(Math.PI/4),t.fillStyle="black",t.fillRect(-20,-300,40,500),i=0;i<35;++i)t.fillStyle=i%3?"white":"navy",t.fillRect(-18,10*i-300,35,8);t.restore(),glob.stateMachine.statechanged("guitar_loaded")};var welcomeScreen=function(){var e=document.getElementById("mainCanvas"),t=e.getContext("2d"),n=e.width/2,o=e.height/2;t.font="48px Gill Sans Extrabold fantasy",t.fillText("Can you guess two songs...",.3*n,.3*o,1.4*n),setTimeout((function(){t.fillText("at once?",.3*n,.6*o,1.4*n)}),1e3),setTimeout((function(){t.fillText("My buggytar is a little... well",.3*n,.8*o,1.4*n),t.fillText("buggy. Due to design flaw and",.3*n,1*o,1.4*n),t.fillText("80's technology imperfection,",.3*n,1.2*o,1.4*n),t.fillText("it plays two songs simultaneously.",.3*n,1.4*o,1.4*n),t.fillText("Can you guess all mixins?",.3*n,1.6*o,1.4*n)}),2e3),setTimeout((function(){t.beginPath(),t.rect(.4*n,1.7*o,1.2*n,.25*o),t.fillStyle="beige",t.strokeStyle="grey",t.fill(),t.stroke(),t.fillStyle="black",t.fillText("START",.8*n,1.85*o),glob.stateMachine.statechanged("welcome_loaded")}),2500),t.beginPath(),t.rect(0,0,2*n,2*o),t.strokeStyle="grey",t.stroke()};ac=new AudioContext;var playNotes=function(e,t,n){var o=t||120,i=ac.currentTime+.5,s=new TinyMusic.Sequence(ac,o,e);return s.loop=!1,s.staccato=.2,s.waveType="sawtooth",s.play(i),s};openGuitar=["E2 q","A2 q","D3 q","G3 q","B3 q","E4 q"],labamba=["C3 q","E3 e","G3 e","F3 q","A3 e","G3 e","- e","G2 e","B2 e","D3 e","F3 e","F3 e","E3 e","D3 e","C3 q","E3 e","G3 e","F3 q","A3 e","G3 e"],condor=["B2 q","E3 e","D#3 e","E3 e","F#3 e","G3 e","F#3 e","G3 e","A3 e","B3 q","- q","D4 e","D4 e","B3 q","- q","E4 e","D4 e","B3 q","- q","B3 e","A3 e","G3 e","E3 q"],gfather1=["B3 q","E4 q","G4 q","F#4 q","E4 q","G4 q","E4 q","F#4 q","E4 q","C4 q","D4 q","B3 q","- h"],gfather2=gfather1.slice(0,-4).concat(["B3 q","A#3 q","A3 q"]),gfather=gfather1.concat(gfather2),house_rising1=aMin.slice(1,4).concat(aMin.slice(0).reverse().slice(0,3)),house_rising2=cMaj.slice(1,4).concat(aMin.slice(0).reverse().slice(0,3)),house_rising3=dMaj.slice(2,5).concat(dMaj.slice(0).reverse().slice(0,3)),house_rising4=fMaj.slice(0,1).concat(fMaj.slice(2,4),fMaj.slice(0).reverse().slice(0,3)),house_rising=house_rising1.concat(house_rising2,house_rising3,house_rising4),love_tender=["G3 q","C4 q","B3 q","C4 q","D4 q","A3 q","D4 h","C4 q","B3 q","A3 q","B3 q","B3 h","B3 h"],love_tender=love_tender.concat(love_tender),no_woman=["C4 h","B3 e","C4 e","C4 e","A3 e","A3 w","C4 h","F4 e","E4 e","D4 e","C4 e","C4 w"],no_woman=no_woman.concat(no_woman),silence=["E3 e","E3 e","G3 e","G3 e","B3 e","B3 e","A3 w","D3 e","D3 e","F#3 e","F#3 e","A3 e","A3 e","G3 w","- e","G3 e","G3 e","G3 e","B3 e","B3 e","D4 e","D4 e"],twinkle=["G3 q","G3 q","D4 q","D4 q","E4 q","E4 q","D4 h","C4 q","C4 q","B3 q","B3 q"],songs=[{title:"Twinkle, twinkle little star",notes:twinkle},{title:"Speak softly love",notes:gfather},{title:"House of the rising sun",notes:house_rising,tempo:180},{title:"Love me tender",notes:love_tender},{title:"Sounds of silence",notes:silence},{title:"El condor pasa",notes:condor},{title:"No woman, no cry",notes:no_woman},{title:"La bamba",notes:labamba}],"undefined"==typeof glob&&(glob={}),glob.stateMachine={state:"",statechanged:function(e){switch(state=e,e){case"welcome_loaded":startButton();break;case"guitar_loaded":case"new_songs":play()}}};var startButton=function(){var e=document.getElementById("mainCanvas"),t=e.width/2,n=e.height/2,o=function(i){i.pageY>1.7*n&&i.pageY<1.95*n&&i.pageX>.4*t&&i.pageX<1.6*t&&(e.removeEventListener("click",o),guitarScreen())};e.addEventListener("click",o)},guitarscrVC={button:function(e,t){var n=document.getElementById("mainCanvas"),o=n.width/2,s=n.height/2,a=n.getContext("2d");i=e,a.beginPath(),a.rect(.5*i*o,1.9*s,.5*o,.1*s),a.fillStyle=t||"white",a.strokeStyle="grey",a.fill(),a.stroke()},drawButtons:function(){for(i=0;i<4;++i)guitarscrVC.button(i,"white")}};pressed=0,selected=-1;var play=function(){var e=document.getElementById("mainCanvas"),t=e.width/2,n=e.height/2;guitarscrVC.drawButtons();e.addEventListener("click",(function(e){if(e.pageY>1.9*n){var o=Math.floor(e.pageX/(.5*t)),i=songs[btns[o]];if(btns[o]===selected)return;if(0===pressed){selected=btns[o],pressed+=1;var s=i.title===song1.title||i.title===song2.title?"green":"red";guitarscrVC.button(o,s),showTitles(songs[btns[o]].title,o)}else if(1===pressed){pressed=0,selected=-1;s=i.title===song1.title||i.title===song2.title?"green":"red";guitarscrVC.button(o,s),showTitles(songs[btns[o]].title,o),seq1.stop(),seq2.stop(),setTimeout((function(){glob.stateMachine.statechanged("new_songs")}),1e3)}}})),chooseSongs()},shuffle=function(e){var t,n,o;for(o=e.length;o;o--)t=Math.floor(Math.random()*o),n=e[o-1],e[o-1]=e[t],e[t]=n},showTitles=function(e,t){var n=document.getElementById("mainCanvas"),o=n.width/2,i=n.height/2,s=n.getContext("2d");s.font="14px Gill Sans Extrabold fantasy",s.fillStyle="black",s.fillText(e,.5*t*o+.05*o,1.98*i,.4*o)},chooseSongs=function(){count=songs.length;for(var e=Math.floor(Math.random()*count),t=e;t===e;)t=Math.floor(Math.random()*count);for(var n=e,o=e;-1!==[e,t].indexOf(n);)n=Math.floor(Math.random()*count);for(;-1!==[e,t,n].indexOf(o);)o=Math.floor(Math.random()*count);for(song1=songs[e],song2=songs[t],seq1=playNotes(song1.notes,song1.tempo),seq2=playNotes(song2.notes,song2.tempo,.2),btns=[e,t,n,o],shuffle(btns),i=0;i<4;++i)showTitles(songs[btns[i]].title,i)};welcomeScreen()</script>