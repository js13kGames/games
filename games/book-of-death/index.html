<!DOCTYPE html><html><head><title>Book of Death</title></head><body style="background-color:#2e0f09"><canvas id="main" width="800" height="400" style="margin:auto;display:block;margin-top:50px"></canvas><script>!function(){"use strict";let x=()=>{};function c(t,e){let i=e.parentNode;t.setAttribute("data-kontra",""),i?(e=i.querySelector("[data-kontra]:last-of-type")||e,i.insertBefore(t,e.nextSibling)):document.body.appendChild(t)}function e(t,e){e=t.indexOf(e);return-1!=e&&(t.splice(e,1),1)}let t,g,Y={};function w(t,...e){(Y[t]||[]).map(t=>t(...e))}let i={get:(t,e)=>"_proxy"==e||x};function o(t){return t*Math.PI/180}function l(t,e){return(Math.random()*(e-t+1)|0)+t}function s(t,e,i){return Math.min(Math.max(t,i),e)}function d(t,e){return[t,e]=[t,e].map(n=>{{let{x:t=0,y:e=0,width:i,height:s}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}}),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}class n{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new n(this.x+t.x,this.y+t.y,this)}subtract(t){return new n(this.x-t.x,this.y-t.y,this)}scale(t){return new n(this.x*t,this.y*t)}normalize(t=this.length()){return new n(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?s(this._a,this._d,t):t}set y(t){this._y=this._c?s(this._b,this._e,t):t}}function h(){return new n(...arguments)}class u extends class{constructor(t){return this.init(t)}init(t={}){this.position=h(),this.velocity=h(),this.acceleration=h(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration,i=(t&&(e=e.scale(t)),this.velocity=this.velocity.add(e),this.velocity);t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}_pc(){}}{init({width:t=0,height:e=0,context:i=g,render:s=this.draw,update:n=this.advance,children:h=[],anchor:r={x:0,y:0},opacity:a=1,rotation:o=0,scaleX:l=1,scaleY:c=1,...d}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:r,opacity:a,rotation:o,scaleX:l,scaleY:c,...d}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=n}update(e){this._uf(e),this.children.map(t=>t.update&&t.update(e))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);var e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(t=>t.render&&t.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){var t,e,i,s,n,h;this._di&&({_wx:t=0,_wy:e=0,_wo:s=1,_wr:i=0,_wsx:n=1,_wsy:h=1}=this.parent||{},{x:i,y:h}=(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=n*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=i+this.rotation,s={x:this._wx,y:this._wy},n=i,h=Math.sin(n),n=Math.cos(n),{x:s.x*n-s.y*h,y:s.x*h+s.y*n}),this._wx=i,this._wy=h,this._wx+=t,this._wy+=e)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(t=>{this.children.push(t),t.parent=this,t._pc=t._pc||x,t._pc()})}removeChild(...t){t.flat().map(t=>{e(this.children,t)&&(t.parent=null,t._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class r extends u{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}let D=/(\d+)(\w+)/;class H extends u{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=g.font,...n}={}){super.init({text:t=""+t,textAlign:e,lineHeight:i,font:s,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){var e;this._d=!0,this._f=t,this._fs=(t=t.match(D),e=+t[1],t[2],e)}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let s=this.context;if(s.font=this.font,!this._s.length&&this._fw){let t=this.text.split(" "),e=0,i=2;for(;i<=t.length;i++){var n=t.slice(e,i).join(" ");s.measureText(n).width>this._fw&&(this._s.push(t.slice(e,i-1).join(" ")),e=i-1)}this._s.push(t.slice(e,i).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map(t=>{this._s.push(t),e=Math.max(e,s.measureText(t).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||s.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let i,s=void this.textAlign,n=this.context;s=this.textAlign||("rtl"==n.canvas.dir?"right":"left"),i="right"==s?this.width:"center"==s?this.width/2|0:0,this._s.map((t,e)=>{n.textBaseline="top",n.textAlign=s,n.fillStyle=this.color,n.font=this.font,n.fillText(t,i,this._fs*this.lineHeight*e)})}}function a(){return new H(...arguments)}function I(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}let p={},f={},y={},m={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function v(t=x,e){t._pd&&e.preventDefault(),t(e)}function O(t){var e=m[t.code],i=p[e];y[e]=!0,v(i,t)}function X(t){var e=m[t.code],i=f[e];y[e]=!1,v(i,t)}function N(){y={}}function _(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let n="keydown"==i?p:f;e._pd=s,[].concat(t).map(t=>n[t]=e)}function b(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map(t=>{e=e.concat(b(t))}),e}class k{constructor({id:t,name:e=t,objects:i=[],context:s=g,cullObjects:n=!0,cullFunction:h=d,sortFunction:r,...a}){this._o=[];let o=s.canvas,l=this._dn=document.createElement("section");l.tabIndex=-1,l.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",l.id=t,l.setAttribute("aria-label",e),c(l,o),Object.assign(this,{id:t,name:e,context:s,cullObjects:n,cullFunction:h,sortFunction:r,...a});var{width:e,height:n}=o,h=e/2,r=n/2;this.camera=function(){return new u(...arguments)}({x:h,y:r,width:e,height:n,context:s,centerX:h,centerY:r,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(t=>{this._o.push(t),b(t).map(t=>{this._dn.appendChild(t)})})}remove(...t){t.flat().map(t=>{e(this._o,t),b(t).map(t=>{c(t,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(t=>t.focus);(t||this._dn).focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){var{x:t,y:e}=t.world||t;this.camera.x=t,this.camera.y=e}update(e){this.hidden||this._o.map(t=>t.update&&t.update(e))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:n,sortFunction:h,cullObjects:r,cullFunction:a}=this,o=(e.translate(i,s),t);r&&(o=o.filter(t=>a(n,t))),h&&o.sort(h),o.map(t=>t.render&&t.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:n,centerY:h}=e;t.save(),this._sx=n-i,this._sy=h-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function S(){return new k(...arguments)}class F extends r{width=300;height=330;numLines=9;numPage=0;currentEnemies=[];title=a({text:"Book of Death",font:"32px Luminari",color:"white",x:55,y:-50});paginationText=a({x:147,y:313,font:"12px Luminari",color:"#880808"});currentLine=this.numLines-2;textPositions=[...Array(this.numLines).keys()].map(t=>30*t+60);playerName=a({x:this.width/2,y:18,color:"#880808",font:"13px monospace",text:"",textAlign:"center",anchor:{x:.5,y:.5}});constructor(t,e){super({x:t,y:e,render:()=>{let e=this.context;e.fillStyle="#f2dcb1",e.fillRect(0,0,this.width,this.height),e.fillStyle="#778377",this.textPositions.forEach(t=>e.fillRect(20,t,260,1)),this.paginationText.render(),this.playerName.render(),this.title.render(),e.fillStyle="#554444",e.fillRect(20,-50,10,40),e.fillRect(10,-40,30,10),e.fillRect(270,-50,10,40),e.fillRect(260,-40,30,10)}}),this.initCover()}initCover(){["Ancient funerary texts, holding","names of the departed, now burned to","ashes. Cursed to never rest, the dead","roam these lands once more. Thou who","holds me, collect the names of","these lost souls and restore order.","Seal a pact, give me thy first name."].forEach((t,e)=>this.insertLineAt(e,t)),this.lineBreak()}initGameOver(t){this.numPage=0,this.currentLine=this.numLines-1,this.paginationText.text="",this.x=235,this.children=[],["You succumbed to the dead","and entered the realm of death.","","You successfully returned",z.instance.score+" souls to my realm.","","Turn this page to go back","and try once again."].forEach((t,e)=>this.insertLineAt(e,t))}updatePlayerName(t){var e=1-t.health/t.maxHealth;1<e?this.playerName.text=t.name:(e=Math.floor(e*t.name.length),this.playerName.text=t.name.substring(0,e)+"_".repeat(t.name.length-e))}lineBreak(){++this.currentLine%this.numLines==0&&(this.currentLine=0,this.numPage+=1,this.paginationText.text=this.numPage+"",this.children=[]),this.insertLineAt(this.currentLine,"› ")}type(t){t=" "==t?"·":t;let e=this.currentText(),i=(e.text+=e.text.length<34?t:"",e.text.substring(2).replaceAll("·"," "));this.currentEnemies.forEach(t=>t.onType(i))}insertLineAt(t,e){this.addChild(a({x:20,y:this.textPositions[t]-11,color:"#880808",font:"12px monospace",text:e}))}currentText(){return this.children.at(-1)}}function M(...t){$.play(...t)}const $={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),e=this.x.createBufferSource();return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(this.x.destination),e.start(),e},buildSamples:function(t=1,e=.05,i=220,s=0,n=0,h=.1,r=0,a=1,o=0,l=0,c=0,d=0,u=0,p=0,f=0,y=0,m=0,x=1,g=0,w=0){var v=2*Math.PI;let _,b,k=this.sampleRate,S=o*=500*v/k/k,M=i*=(1+2*e*Math.random()-e)*v/k,A=[],P=0,T=0,C=0,j=1,L=0,E=0,R=0;for(l*=500*v/k**3,f*=v/k,c*=v/k,d*=k,u=u*k|0,b=(s=s*k+9)+(g*=k)+(n*=k)+(h*=k)+(m*=k)|0;C<b;A[C++]=R)++E%(100*y|0)||(R=r?1<r?2<r?3<r?Math.sin((P%v)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/v%2+2)%2:1-4*Math.abs(Math.round(P/v)-P/v):Math.sin(P),R=(u?1-w+w*Math.sin(v*C/u):1)*(0<R?1:-1)*Math.abs(R)**a*t*this.volume*(C<s?C/s:C<s+g?1-(C-s)/g*(1-x):C<s+g+n?x:C<b-m?(b-C-m)/h*x:0),R=m?R/2+(m>C?0:(C<b-m?1:(b-C)/m)*A[C-m|0]/2):R),_=(i+=o+=l)*Math.cos(f*T++),P+=_-_*p*(1-1e9*(Math.sin(C)+1)%2),j&&++j>d&&(i+=c,M+=c,j=0),!u||++L%u||(i=M,o=S,j=j||1);return A},getNote:function(t=0,e=440){return e*2**(t/12)}},q={songData:[{i:[3,0,128,0,3,10,128,0,0,0,7,20,40,0,0,0,0,0,0,0,2,35,0,0,13,0,0,0,0],p:[1,2,1,3,4,5,6,7,8,9,10],c:[{n:[,,,,132,,,,,,,,130,,,,,,,,132,,,,,,,,130,,,,,,,,135,,,,,,,,134,,,,,,,,135,,,,,,,,134,,,,,,,,139,,,,,,,,137,,,,,,,,139,,,,,,,,137],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,90]},{n:[,,,,130,,,,,,,,128,,,,,,,,125,,,,125,,,,127,,,,,,,,134,,,,,,,,132,,,,,,,,128,,,,129,,,,130,,,,,,,,137,,,,,,,,135,,,,,,,,132,,,,132,,,,134],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,64,,,,,,,,103]},{n:[,,,,130,,,,,,,,128,,,,,,,,118,,,,,,,,120,,,,,,,,134,,,,,,,,132,,,,,,,,122,,,,,,,,123,,,,,,,,137,,,,,,,,135,,,,,,,,125,,,,,,,,127],f:[]},{n:[,,,,132,,,,,,,,127,,,,,,,,127,,,,127,,,,128,,,,,,,,135,,,,,,,,130,,,,,,,,131,,,,131,,,,132,,,,,,,,139,,,,,,,,134,,,,,,,,134,,,,134,,,,135],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,67,,,,,,,,107]},{n:[,,,,127,,,,,,,,130,,,,,,,,128,,,,130,,,,120,,,,,,,,130,,,,,,,,134,,,,,,,,132,,,,134,,,,123,,,,,,,,134,,,,,,,,137,,,,,,,,135,,,,137,,,,127],f:[,,,,13,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,59,,,,,,,,,,,,,,,,56,,,,,,,,103]},{n:[,,,,135,,,,,,,,130,,,,,,,,130,,,,130,,,,131,,,,,,,,138,,,,,,,,133,,,,,,,,134,,,,134,,,,135,,,,,,,,142,,,,,,,,137,,,,,,,,137,,,,137,,,,138],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,60,,,,,,,,100]},{n:[,,,,130,,,,,,,,133,,,,,,,,131,,,,133,,,,123,,,,,,,,133,,,,,,,,137,,,,,,,,135,,,,137,,,,126,,,,,,,,137,,,,,,,,140,,,,,,,,138,,,,140,,,,130],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,59,,,,,,,,95]},{n:[,,,,125,,,,,,,,125,,,,,,,,132,,,,,,,,132,,,,,,,,128,,,,,,,,128,,,,,,,,135,,,,,,,,135,,,,,,,,132,,,,,,,,132,,,,,,,,139,,,,,,,,139],f:[]},{n:[,,,,132,,,,,,,,130,,,,,,,,127,,,,,,,,127,,,,,,,,135,,,,,,,,134,,,,,,,,130,,,,,,,,130,,,,,,,,139,,,,,,,,137,,,,,,,,134,,,,,,,,134],f:[]},{n:[,,,,132,,,,,,,,132,,,,,,,,128,,,,,,,,130,,,,,,,,135,,,,,,,,135,,,,,,,,132,,,,,,,,132,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135],f:[]}]},{i:[3,124,128,0,3,146,128,12,0,0,7,89,29,0,0,0,0,0,0,0,2,255,0,0,9,47,3,27,2],p:[1,2,1,3,4,5,6,7,8,9,10],c:[{n:[,,116,118,120,,120,,120,,120,116,118,,120,,120,,116,118,120,,118,,118,,116,,118],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,41]},{n:[,,113,116,118,,118,,118,,111,115,116,,116,,116,,116,115,113,,113,111,113,,113,111,115],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[,,115,116,118,,118,,118,,118,115,116,,113,,113,,115,116,118,,118,115,116,,120,,120],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[,,120,118,123,,123,122,123,,123,125,130,,,,,,,,127,,123,,120,,122,,127],f:[12,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,25,,,,,,,,,,,,91,,,,,,,,40,,,,,,,,59]},{n:[,,,,127,,123,,130,,127,,134,,130,,125,,127,,130,128,130,,132,,135,,132],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,36,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[,,123,121,126,,126,125,126,,126,128,133,,,,,,,,130,,126,,123,,125,,130],f:[12,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,28,,,,,,,,,,,,93,,,,,,,,36,,,,,,,,67]},{n:[,,,,130,,126,,133,,130,,137,,133,,128,,130,,133,131,133,,135,,138,,135],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,32,,,,,,,,,,,,,,,,,,,,,,,,,,,,108]},{n:[,,,,137,,,,,,,,144,,144,140,142,,142,137,139,,,,,,,,139,,139,135],f:[,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,28,,,,,,,,100,,,,,,,,37]},{n:[137,,137,130,132,,,,,,,,130,,132,,137,,140,,139,,,,,,,,139,,137],f:[,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,92,,,,,,,,33,,,,,,,,103,,,,,,,,49]},{n:[135,,130,,132,,,,,,,,132,,132,128,130,,130,127,128,,125,,123,,122,,120],f:[,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,12,,,,,,,,93,,,,,,,,39,,,,,,,,,,,,,,,,89]}]},{i:[0,47,116,85,0,45,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,47,15,0,11,0,0,0,0],p:[,,,,4,5,6,7,8,9,10],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,144,,,,144,,,,,,149,149,149,,,,144,,,,144,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,,,144,,,,149,149,149,,,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,149,149,149,,,,144,,,,144,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,,,144,,,,149,149,149,,,,,,144],f:[]},{n:[,,,,144,,,,,,,,,,149,149,149,,149,149,149,,149,149,149,,,,144,,149,149],f:[]},{n:[149,,149,149,149,,149,149,149],f:[]},{n:[,,,,,,,,,,,,144,,149,149,149,,149,149,149,,,,144,,,,144],f:[]}]}],rowLen:5300,patternLen:32,endPattern:10,numChannels:3},U={songData:[{i:[0,0,140,0,0,0,140,0,0,255,96,0,0,0,0,0,0,51,2,1,2,58,239,0,32,88,1,107,2],p:[1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};class G extends r{width=2;height=2;z=3;maxHealth=10;health;invincibleTime;name;time=0;constructor(t){super({game:t})}update(){this.time++,y.arrowleft&&5<this.x&&this.x--,y.arrowright&&this.x+this.width<345&&this.x++,y.arrowup&&5<this.y&&this.y--,y.arrowdown&&this.y+this.height<395&&this.y++,0<this.invincibleTime?this.invincibleTime--:this.color="#695535ee"}render(){let t=this.context;t.fillStyle=this.color,t.fillRect(this.x-4,this.y-4,10,10),t.fillStyle="#99c3a0",t.fillRect(this.x,this.y,2,2)}reset(){this.invincibleTime=0,this.health=this.maxHealth}hit(t=1){return!(0<this.invincibleTime||(M(.15,void 0,291,.02,.04,void 0,3,.76,void 0,void 0,void 0,void 0,void 0,.3,-458,void 0,void 0,.82,.03,.18),this.health-=t,this.game.notebook.updatePlayerName(this),this.health<=0&&this.game.transitionToScene("gameOver"),this.invincibleTime+=40,this.color="#69553555",0))}}const W=["ari","amy","mary","john","lisa","mark","paul","james","linda","david","susan","sarah","karen","nancy","betty","emily","donna","carol","kevin","brian","laura","jacob","robert","joseph","thomas","daniel","sandra","donald","ashley","steven","andrew","joshua","amanda","george","pamela","michael","william","barbara","richard","jessica","charles","matthew","anthony","kenneth","dorothy","melissa","timothy","deborah","stephen","patricia","jennifer","margaret","kimberly","michelle","jonathan","elizabeth","stephanie","christopher"],K=["li","lee","wang","berg","musa","tamm","park","moore","evans","brown","nowak","meyer","lopez","smith","monet","akbas","novak","taylor","gracia","hansen","burton","walker","melnyk","almeida","ibrahim","lavigne","adamcik","seatang","albescu","williams","kowalska","einstein","pedersen","andersson"],A=["cold","wind","forgotten","hateful","great","greedy","slayer","grumpy","sleepy","lonely","hungry"],P=["sidney","berlin","paris","london","madrid","beijing","tallinn","stockholm","abuja","brasilia","rome","bukarest","vienna","oslo"];let T=[""];function C(t,e){var i=Math.floor(e.length/2);return e[l(t=Math.max(Math.min(t-5,2*i)-1,0),i+t)]}class J extends r{constructor(t){super({color:t,time:0})}init(t){super.init({width:4,height:4,color:this.color,...t,render(){let t=this.context;t.fillStyle=this.color,t.strokeStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,this.width,this.height),t.strokeRect(0,0,this.width,this.height)}})}update(){super.update(),this.time++,348<this.x&&(this.ttl=0)}}class Q extends class{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(e){let i,s=!1;for(let t=this.size;t--;)(i=this.objects[t]).update(e),i.isAlive()||(s=!0,this.size--);s&&this.objects.sort((t,e)=>e.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}{maxSize=5e3;tick=0;rotation=10;arrays=1;arraySpread=120;beams=1;beamSpread=10;originX=0;originY=0;spinRate=0;inverseSpin=0;fireRate=5;bulletSpeed=1;startAngle=0;ttl=200;active=!1;constructor(t="red"){super({create:()=>new J(t)})}getBeamConfigs(t){const i=[];var s=t*this.arraySpread,n=this.beams%2==0;for(let e=0;e<this.beams;e++){let t;t=n?e%2==0?s-e/2*this.beamSpread-this.beamSpread/2:s+(e-1)/2*this.beamSpread+this.beamSpread/2:0===e?s:e%2==0?s-e/2*this.beamSpread:s+(e+1)/2*this.beamSpread;var h=s=>e=>{let i=t;if(this.spinRate){const s=0===this.inverseSpin?360:2*this.inverseSpin;let t=e*this.spinRate%s;this.inverseSpin&&t>this.inverseSpin&&(t=this.inverseSpin-t%this.inverseSpin),i+=t}return s(i)},h={x:this.originX,y:this.originY,dxf:h(t=>Math.cos(o(t))*this.bulletSpeed),dyf:h(t=>-Math.sin(o(t))*this.bulletSpeed),ddxf:h(t=>Math.cos(o(t+5))/100),ddyf:h(t=>-Math.sin(o(t+5))/100),fireRate:this.fireRate,ttl:this.ttl};i.push(h)}return i}_pc(){}bulletTick(){if(this.active){this.tick+=1;for(let t=0;t<this.arrays;t++)for(const n of this.getBeamConfigs(t))if(this.tick%this.fireRate==0){let t=n.dx,e=n.dy,i=(n.dxf&&(t=n.dxf(this.tick)),n.dyf&&(e=n.dyf(this.tick)),n.dx),s=n.dy;n.ddxf&&(i=n.ddxf(this.tick)),n.ddyf&&(s=n.ddyf(this.tick)),super.get({...n,dx:t,dy:e,ddy:s,ddx:i})}}}checkHit(e){for(let t=this.size;t--;)if(d(e,this.objects[t]))return!0;return!1}}function V(t,e){let i=t;const s=[];for(;0<i;){var n=l(1,Math.min(Math.ceil(i/2),6));i-=n;const r=function(t,e){const i=new Q(e);return i.arrays=t,i.arraySpread=360/t,i}(n,e);if(n=r,h=Math.min(50,t),n.fireRate=Math.floor(20-Math.abs(-5*Math.log(h+3)+6)),0<=i){const t=l(0,Math.min(Math.ceil(i/2),6));i-=t,n=r,h=t,s.length,n.spinRate=1+h}l(0,5)<1&&(r.inverseSpin=l(45,120)),s.push(r)}var h;return s}class Z{ticks=1;pools=[];movement=(t,e)=>{var i=t.level.player,s=i.x-t.x,i=i.y-t.y;t.x+=1/(500-100*e)*s,t.y+=1/(500-100*e)*i};togglePools(e){this.pools.forEach(t=>{t.active=e})}}class j extends r{width=30;height=40;dx=1;dy=1;speed=1;z=2;time=0;anchor={x:.5,y:.5};currentPattern=0;patternTick=0;r=l(50,255);g=l(50,255);b=l(50,255);rot=l(-5,5)/10;constructor(t,e,i){super({x:e,y:i,level:t,name:function(t){let e="",i=0;for(;T.includes(e);)10<i++&&(T=[""]),e=C(t,W)+" "+C(t,K),5<t&&.4<Math.random()?e+=" the "+A[l(0,A.length-1)]:10<t&&.5<Math.random()&&(e+=" from "+P[l(0,P.length-1)]);return T.push(e),e}(t.difficulty),render:()=>{let e=this.context;e.fillStyle=`rgba(${this.r}, ${this.g}, ${this.b}, ${this.transparency()})`,e.strokeStyle=`rgba(0, 0, 0, ${2*this.transparency()})`,e.beginPath(),e.arc(15,15,15,Math.PI,2*Math.PI),e.lineTo(this.width,40);for(let t=0;t<=this.width;t+=1){var i=40+2*Math.sin(.5*t);e.lineTo(this.width-t,i)}e.lineTo(0,15),e.stroke(),e.fill(),e.beginPath(),e.fillStyle=`rgba(50, 50, 50, ${this.transparency()})`,e.ellipse(9,20,4,7,-this.rot,0,2*Math.PI),e.ellipse(21,20,4,7,this.rot,0,2*Math.PI),e.fill()}});e=t.difficulty<12?t.difficulty:t.difficulty-4;e-=t.difficulty<22?0:5,this.patterns=function(t,e){const i=[];let s=t;for(;0<s;){const t=new Z;t.ticks=l(120,240),t.movement=function(t){const e=[(s=1===l(1,2),(t,e)=>{let i=t.level.height;s?(i=t.level.width,(t.x<=20||t.x>=i-20)&&(t.dx*=-1),t.x+=t.dx*e):((t.y<=20||t.y>=i-20)&&(t.dy*=-1),t.y+=t.dy*e)})];var s,a;if(5<t&&e.push((t,e)=>{var i=t.level.player,s=i.x-t.x,i=i.y-t.y;t.x+=1/(500-100*e)*s,t.y+=1/(500-100*e)*i}),10<t){const s=l(30,60-t);e.push((a=s,(t,e)=>{var i=t.level.player,s=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),n=.01*(a-s),h=o(1+Math.atan2(t.y-i.y,t.x-i.x)*(180/Math.PI)),r=i.x+Math.cos(h)*(s+n),i=i.y+Math.sin(h)*(s+n);t.x=r,t.y=i}))}return e[l(0,e.length-1)]}(s);var n=l(3,Math.max(s,4));t.pools=V(n,e),i.push(t),s-=n}return i.reverse()}(e,`rgb(${this.r},${this.g},${this.b})`),this.patterns.forEach(t=>{this.level.addChild(...t.pools)}),this.patterns[this.currentPattern].togglePools(!0)}transparency(){return Math.min(.3,this.time/600)}onType(t){this.name==t&&(M(.2,void 0,213,.02,.09,.11,1,.64,void 0,void 0,void 0,void 0,void 0,.1,void 0,.2,void 0,.6,.04),this.level.notebook.lineBreak(),this.level.removeChild(this),this.level.enemies=this.level.enemies.filter(t=>t!==this),++z.instance.score,this.level.checkClear())}alignPools(t){t.forEach(t=>{t.originX=this.x,t.originY=this.y})}update(){++this.patternTick;let t=this.patterns[this.currentPattern];this.patternTick>t.ticks&&(t.togglePools(!1),this.patternTick=0,this.currentPattern=(this.currentPattern+1)%this.patterns.length,(t=this.patterns[this.currentPattern]).togglePools(!0)),300<++this.time&&t.movement(this,this.speed);const e=t.pools;this.alignPools(e),e.forEach(t=>{t.bulletTick(),t.checkHit(this.level.player)&&this.level.player.hit()})}}class L extends r{color="#444444";width=7;height=7;text=a({text:this.name,color:"black",font:"15px Garamond",textAlign:"center",width:100,anchor:{x:.5,y:0}});playerCollision=!1;z=1;constructor(t,e,i,s){super({x:t,y:e,name:i,level:s}),this.setTextPos()}setTextPos(){this.text.x=this.x+this.width/2,this.text.y=this.y+this.height+7}render(){super.render(),this.playerCollision&&this.text.render()}spread(t,e){e*=Math.PI/180;this.x+=Math.cos(e)*t,this.y+=Math.sin(e)*t,this.x<50&&(this.x=50),300<this.x&&(this.x=300),this.setTextPos()}onPlayerCollisionEnter(){this.playerCollision||(this.playerCollision=!0)}onPlayerCollisionExit(){this.playerCollision&&(this.playerCollision=!1)}}class tt extends L{width=15;height=25;dx=2;time=0;splits=this.name.split(" ");explode=!1;constructor(t,e,i,s){super(t,e,i,s),this.setTextPos(),this.explode=5<l(1,10)&&s.difficulty>l(5,30)}render(){let t=this.context;t.fillStyle=this.color,t.fillRect(this.x,this.y+5,this.width,5),t.fillRect(this.x+5,this.y,5,this.height),this.playerCollision&&this.text.render()}update(){if(this.explode&&(this.time++%5==0&&this.time<120&&(this.x+=this.dx*=-1),121==this.time)){M(.4,void 0,653,.03,.02,.48,void 0,.87,void 0,void 0,void 0,void 0,void 0,1.4,void 0,.6,void 0,.41,.12);let s=this.level,n=(s.removeChild(this),l(0,360));this.splits.forEach((t,e)=>{let i=new L(this.x,this.y,t);s.gravestones.push(i),s.addChild(i);t=(n+360/this.splits.length*(e+1))%360;i.spread(l(20,70),t)}),s.sort()}}}class et extends r{color="#8da683";width=350;height=400;gravestones=[];enemies;name;scoreText=a({x:4,y:4,z:100,text:"Returned: "+z.instance.score,color:"black"});constructor(t){super({scene:t,player:t.player,notebook:t.notebook,difficulty:z.instance.currentDifficulty++}),this.enemies=[new j(this,l(120,180),l(70,120))],12<this.difficulty&&60<l(1,100)&&this.enemies.push(new j(this,l(80,100),l(200,230))),22<this.difficulty&&60<l(1,100)&&this.enemies.push(new j(this,l(200,250),l(200,230))),this.notebook.currentEnemies=this.enemies,this.enemies.forEach(t=>this.gravestones.push(new tt(t.x-7,t.y-7,t.name,this))),this.children.push(...this.gravestones,this.player,...this.enemies,this.scoreText),this.sort()}update(t){this.gravestones.forEach(t=>d(this.player,t)?t.onPlayerCollisionEnter():t.onPlayerCollisionExit()),this.enemies.forEach(t=>{d(this.player,t)&&this.player.hit(3)}),super.update(t)}sort(){this.children.sort((t,e)=>t.z-e.z)}checkClear(){0==this.enemies.length&&(this.children=[],this.render(),this.scene.game.transitionToScene("game"))}}function it(){function B(t){return Math.sin(6.283184*t)}function Y(t){return.003959503758*2**((t-128)/12)}var D,H,I,O,X,N=[B,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){t=t%1*4;return t<2?t-1:3-t}];this.init=function(t){H=(D=t).endPattern,I=0,O=t.rowLen*t.patternLen*(H+1)*2,X=new Int32Array(O)},this.generate=function(){for(var t,e,i,s,n,h,r,a=new Int32Array(O),o=D.songData[I],l=D.rowLen,c=D.patternLen,d=0,u=0,p=!1,f=[],y=0;y<=H;++y)for(i=o.p[y],t=0;t<c;++t){for(var m=i?o.c[i-1].f[t]:0,x=(m&&(o.i[m-1]=o.c[i-1].f[t+c]||0,m<17&&(f=[])),N[o.i[16]]),g=o.i[17]/512,w=2**(o.i[18]-9)/l,v=o.i[19],_=o.i[20],b=43.23529*o.i[21]*3.141592/44100,k=1-o.i[22]/255,S=1e-5*o.i[23],M=o.i[24]/32,A=o.i[25]/512,P=6.283184*2**(o.i[26]-9)/l,T=o.i[27]/255,C=o.i[28]*l&-2,j=(y*c+t)*l,L=0;L<4;++L)if(e=i?o.c[i-1].n[t+L*c]:0){f[e]||(f[e]=function(t,e,i){for(var s,n,h,r,a=N[t.i[0]],o=t.i[1],l=t.i[3]/32,c=N[t.i[4]],d=t.i[5],u=t.i[8]/32,p=t.i[9],f=t.i[10]*t.i[10]*4,y=t.i[11]*t.i[11]*4,m=t.i[12]*t.i[12]*4,x=1/m,g=-t.i[13]/16,w=t.i[14],v=i*2**(2-t.i[15]),_=new Int32Array(f+y+m),b=0,k=0,S=0,M=0;S<f+y+m;S++,M++)0<=M&&(M-=v,h=Y(e+(15&(w=w>>8|(255&w)<<4))+t.i[2]-128),r=Y(e+(15&w)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,S<f?s=S/f:f+y<=S&&(s=(1-(s=(S-f-y)*x))*3**(g*s)),n=a(b+=h*s**l)*o,n+=c(k+=r*s**u)*d,p&&(n+=(2*Math.random()-1)*p),_[S]=80*n*s|0;return _}(o,e,l));for(var E=f[e],R=0,z=2*j;R<E.length;R++,z+=2)a[z]+=E[R]}for(R=0;R<l;R++)(n=a[s=2*(j+R)])||p?(h=b,v&&(h*=x(w*s)*g+.5),u+=(h=1.5*Math.sin(h))*(h=k*(n-u)-(d+=h*u)),n=3==_?u:1==_?h:d,S&&(n=(n*=S)<1?-1<n?B(.25*n):-1:1,n/=S),p=1e-5<(n*=M)*n,r=n*(1-(h=Math.sin(P*s)*A+.5)),n*=h):r=0,C<=s&&(r+=a[s-C+1]*T,n+=a[s-C]*T),a[s]=0|r,a[1+s]=0|n,X[s]+=0|r,X[1+s]+=0|n}return++I/D.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,O/2,44100),i=0;i<2;i++)for(var s=e.getChannelData(i),n=i;n<O;n+=2)s[n>>1]=X[n]/65536;return e},this.createWave=function(){var t=44+2*O-8,e=t-36,i=new Uint8Array(44+2*O);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,n=44;s<O;++s){var h=(h=X[s])<-32767?-32767:32767<h?32767:h;i[n++]=255&h,i[n++]=h>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var h=i+n;s[n]=0<t&&h<X.length?X[h]/32768:0}return s}}const E=new class{sounds={};init(){this.sounds={bgmusic:this.initSound(q,!0),wind:this.initSound(U)}}initSound(t,e=!1){let i=new it;for(i.init(t);i.generate()<1;);let s=document.createElement("audio");return s.src=URL.createObjectURL(new Blob([i.createWave()],{type:"audio/wav"})),s.loop=e,s}play(t){this.sounds[t].currentTime=0,this.sounds[t].play()}},st=["space",...[...Array(26).keys()].map(t=>String.fromCharCode(t+97))];class R extends k{level;constructor(t){super({game:t,notebook:t.notebook,objects:[t.notebook],player:t.player}),this.player.reset()}nextLevel(){this.level=new et(this),this.player.x=165,this.player.y=350,this.player.health=Math.min(this.player.health+1,this.player.maxHealth),this.add(this.level)}transition(){this.nextLevel(),this.notebook.updatePlayerName(this.player),this.notebook.x=400}}class z{activeScene;transitionBlock=function(){return new r(...arguments)}({width:800,height:600,color:"#2e0f09"});transitioning;transitioningTo;musicPlaying=!1;notebook=new F(235,70);player=new G(this);currentDifficulty=1;score=0;scenes={menu:S({objects:[this.notebook],transition(){}}),game:new R(this),gameOver:S({objects:[this.notebook],game:this,transition(){this.game.notebook.initGameOver(this.game.score)}})};static instance;constructor(){this.transitionToScene("menu"),_("enter",()=>{if(!this.transitioning){switch(this.transitioningTo){case"menu":return void(3<this.notebook.children.at(-1).text.length&&(this.player.name??=this.notebook.currentText().text.substring(2),this.transitionToScene("game"),this.notebook.lineBreak()));case"gameOver":return this.scenes.game=new R(this),this.currentDifficulty=1,this.score=0,this.transitionToScene("game"),this.notebook.updatePlayerName(this.player),void this.notebook.lineBreak()}this.notebook.lineBreak()}}),_(st,t=>{this.transitioning||"gameOver"==this.transitioningTo||(M(.5,.15,130,.02,.01,.01,void 0,3.1,void 0,93,void 0,void 0,void 0,void 0,33,void 0,void 0,.5),this.notebook.type(t.key))}),z.instance=this}setScene(t){return this.activeScene=this.scenes[t],this.activeScene.transition(),this.activeScene.update(),this.activeScene}transitionToScene(t){this.transitioning=!0,this.transitioningTo=t,this.transitionBlock.y=-600,this.transitionBlock.dy=20,E.play("wind")}render(){this.activeScene?.render(),this.transitioning&&this.transitionBlock.render()}update(){this.transitioning?(this.transitionBlock.y+=20,0==this.transitionBlock.y&&this.setScene(this.transitioningTo),400<=this.transitionBlock.y&&(this.musicPlaying||"game"!=this.transitioningTo||(this.musicPlaying=!0,E.play("bgmusic")),this.transitioning=!1)):this.activeScene?.update()}}var[{contextless:nt=!1}={}]=[];if(t=document.getElementById(void 0)||document.querySelector("canvas"),!(t=nt?t||new Proxy({},i):t))throw Error("You must provide a canvas element for the game");(g=t.getContext("2d")||new Proxy({},i)).imageSmoothingEnabled=!1,w("init");{let t;for(t=0;t<26;t++)m["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)m["Digit"+t]=m["Numpad"+t]=""+t;window.addEventListener("keydown",O),window.addEventListener("keyup",X),window.addEventListener("blur",N)}E.init();const B=new z;!function({fps:t=60,clearCanvas:e=!0,update:i,render:s,context:n=g,blur:h=!1}){if(!s)throw Error("You must provide a render() function");let r,a,o,l,c,d=0,u=1e3/t,p=1/t,f=e?I:x,y=!0;function m(){if(a=requestAnimationFrame(m),y&&(o=performance.now(),l=o-r,r=o,!(1e3<l))){for(w("tick"),d+=l;d>=u;)c.update(p),d-=u;f(n),c.render()}}return h||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),c={update:i,render:s,isStopped:!0,start(){r=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:m,set _last(t){r=t}}}({update:()=>{B.update()},render:()=>{B.render()}}).start()}()</script><script>!function(){"use strict";let x=()=>{};function c(t,e){let i=e.parentNode;t.setAttribute("data-kontra",""),i?(e=i.querySelector("[data-kontra]:last-of-type")||e,i.insertBefore(t,e.nextSibling)):document.body.appendChild(t)}function e(t,e){e=t.indexOf(e);return-1!=e&&(t.splice(e,1),1)}let t,g,Y={};function w(t,...e){(Y[t]||[]).map(t=>t(...e))}let i={get:(t,e)=>"_proxy"==e||x};function o(t){return t*Math.PI/180}function l(t,e){return(Math.random()*(e-t+1)|0)+t}function s(t,e,i){return Math.min(Math.max(t,i),e)}function d(t,e){return[t,e]=[t,e].map(n=>{{let{x:t=0,y:e=0,width:i,height:s}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}}),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}class n{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new n(this.x+t.x,this.y+t.y,this)}subtract(t){return new n(this.x-t.x,this.y-t.y,this)}scale(t){return new n(this.x*t,this.y*t)}normalize(t=this.length()){return new n(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?s(this._a,this._d,t):t}set y(t){this._y=this._c?s(this._b,this._e,t):t}}function h(){return new n(...arguments)}class u extends class{constructor(t){return this.init(t)}init(t={}){this.position=h(),this.velocity=h(),this.acceleration=h(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration,i=(t&&(e=e.scale(t)),this.velocity=this.velocity.add(e),this.velocity);t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}_pc(){}}{init({width:t=0,height:e=0,context:i=g,render:s=this.draw,update:n=this.advance,children:h=[],anchor:r={x:0,y:0},opacity:a=1,rotation:o=0,scaleX:l=1,scaleY:c=1,...d}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:r,opacity:a,rotation:o,scaleX:l,scaleY:c,...d}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=n}update(e){this._uf(e),this.children.map(t=>t.update&&t.update(e))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);var e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(t=>t.render&&t.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){var t,e,i,s,n,h;this._di&&({_wx:t=0,_wy:e=0,_wo:s=1,_wr:i=0,_wsx:n=1,_wsy:h=1}=this.parent||{},{x:i,y:h}=(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=n*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=i+this.rotation,s={x:this._wx,y:this._wy},n=i,h=Math.sin(n),n=Math.cos(n),{x:s.x*n-s.y*h,y:s.x*h+s.y*n}),this._wx=i,this._wy=h,this._wx+=t,this._wy+=e)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(t=>{this.children.push(t),t.parent=this,t._pc=t._pc||x,t._pc()})}removeChild(...t){t.flat().map(t=>{e(this.children,t)&&(t.parent=null,t._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class r extends u{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}let D=/(\d+)(\w+)/;class H extends u{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=g.font,...n}={}){super.init({text:t=""+t,textAlign:e,lineHeight:i,font:s,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){var e;this._d=!0,this._f=t,this._fs=(t=t.match(D),e=+t[1],t[2],e)}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let s=this.context;if(s.font=this.font,!this._s.length&&this._fw){let t=this.text.split(" "),e=0,i=2;for(;i<=t.length;i++){var n=t.slice(e,i).join(" ");s.measureText(n).width>this._fw&&(this._s.push(t.slice(e,i-1).join(" ")),e=i-1)}this._s.push(t.slice(e,i).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map(t=>{this._s.push(t),e=Math.max(e,s.measureText(t).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||s.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let i,s=void this.textAlign,n=this.context;s=this.textAlign||("rtl"==n.canvas.dir?"right":"left"),i="right"==s?this.width:"center"==s?this.width/2|0:0,this._s.map((t,e)=>{n.textBaseline="top",n.textAlign=s,n.fillStyle=this.color,n.font=this.font,n.fillText(t,i,this._fs*this.lineHeight*e)})}}function a(){return new H(...arguments)}function I(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}let p={},f={},y={},m={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function v(t=x,e){t._pd&&e.preventDefault(),t(e)}function O(t){var e=m[t.code],i=p[e];y[e]=!0,v(i,t)}function X(t){var e=m[t.code],i=f[e];y[e]=!1,v(i,t)}function N(){y={}}function _(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let n="keydown"==i?p:f;e._pd=s,[].concat(t).map(t=>n[t]=e)}function b(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map(t=>{e=e.concat(b(t))}),e}class k{constructor({id:t,name:e=t,objects:i=[],context:s=g,cullObjects:n=!0,cullFunction:h=d,sortFunction:r,...a}){this._o=[];let o=s.canvas,l=this._dn=document.createElement("section");l.tabIndex=-1,l.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",l.id=t,l.setAttribute("aria-label",e),c(l,o),Object.assign(this,{id:t,name:e,context:s,cullObjects:n,cullFunction:h,sortFunction:r,...a});var{width:e,height:n}=o,h=e/2,r=n/2;this.camera=function(){return new u(...arguments)}({x:h,y:r,width:e,height:n,context:s,centerX:h,centerY:r,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(t=>{this._o.push(t),b(t).map(t=>{this._dn.appendChild(t)})})}remove(...t){t.flat().map(t=>{e(this._o,t),b(t).map(t=>{c(t,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(t=>t.focus);(t||this._dn).focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){var{x:t,y:e}=t.world||t;this.camera.x=t,this.camera.y=e}update(e){this.hidden||this._o.map(t=>t.update&&t.update(e))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:n,sortFunction:h,cullObjects:r,cullFunction:a}=this,o=(e.translate(i,s),t);r&&(o=o.filter(t=>a(n,t))),h&&o.sort(h),o.map(t=>t.render&&t.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:n,centerY:h}=e;t.save(),this._sx=n-i,this._sy=h-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function S(){return new k(...arguments)}class F extends r{width=300;height=330;numLines=9;numPage=0;currentEnemies=[];title=a({text:"Book of Death",font:"32px Luminari",color:"white",x:55,y:-50});paginationText=a({x:147,y:313,font:"12px Luminari",color:"#880808"});currentLine=this.numLines-2;textPositions=[...Array(this.numLines).keys()].map(t=>30*t+60);playerName=a({x:this.width/2,y:18,color:"#880808",font:"13px monospace",text:"",textAlign:"center",anchor:{x:.5,y:.5}});constructor(t,e){super({x:t,y:e,render:()=>{let e=this.context;e.fillStyle="#f2dcb1",e.fillRect(0,0,this.width,this.height),e.fillStyle="#778377",this.textPositions.forEach(t=>e.fillRect(20,t,260,1)),this.paginationText.render(),this.playerName.render(),this.title.render(),e.fillStyle="#554444",e.fillRect(20,-50,10,40),e.fillRect(10,-40,30,10),e.fillRect(270,-50,10,40),e.fillRect(260,-40,30,10)}}),this.initCover()}initCover(){["Ancient funerary texts, holding","names of the departed, now burned to","ashes. Cursed to never rest, the dead","roam these lands once more. Thou who","holds me, collect the names of","these lost souls and restore order.","Seal a pact, give me thy first name."].forEach((t,e)=>this.insertLineAt(e,t)),this.lineBreak()}initGameOver(t){this.numPage=0,this.currentLine=this.numLines-1,this.paginationText.text="",this.x=235,this.children=[],["You succumbed to the dead","and entered the realm of death.","","You successfully returned",z.instance.score+" souls to my realm.","","Turn this page to go back","and try once again."].forEach((t,e)=>this.insertLineAt(e,t))}updatePlayerName(t){var e=1-t.health/t.maxHealth;1<e?this.playerName.text=t.name:(e=Math.floor(e*t.name.length),this.playerName.text=t.name.substring(0,e)+"_".repeat(t.name.length-e))}lineBreak(){++this.currentLine%this.numLines==0&&(this.currentLine=0,this.numPage+=1,this.paginationText.text=this.numPage+"",this.children=[]),this.insertLineAt(this.currentLine,"› ")}type(t){t=" "==t?"·":t;let e=this.currentText(),i=(e.text+=e.text.length<34?t:"",e.text.substring(2).replaceAll("·"," "));this.currentEnemies.forEach(t=>t.onType(i))}insertLineAt(t,e){this.addChild(a({x:20,y:this.textPositions[t]-11,color:"#880808",font:"12px monospace",text:e}))}currentText(){return this.children.at(-1)}}function M(...t){$.play(...t)}const $={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),e=this.x.createBufferSource();return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(this.x.destination),e.start(),e},buildSamples:function(t=1,e=.05,i=220,s=0,n=0,h=.1,r=0,a=1,o=0,l=0,c=0,d=0,u=0,p=0,f=0,y=0,m=0,x=1,g=0,w=0){var v=2*Math.PI;let _,b,k=this.sampleRate,S=o*=500*v/k/k,M=i*=(1+2*e*Math.random()-e)*v/k,A=[],P=0,T=0,C=0,j=1,L=0,E=0,R=0;for(l*=500*v/k**3,f*=v/k,c*=v/k,d*=k,u=u*k|0,b=(s=s*k+9)+(g*=k)+(n*=k)+(h*=k)+(m*=k)|0;C<b;A[C++]=R)++E%(100*y|0)||(R=r?1<r?2<r?3<r?Math.sin((P%v)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/v%2+2)%2:1-4*Math.abs(Math.round(P/v)-P/v):Math.sin(P),R=(u?1-w+w*Math.sin(v*C/u):1)*(0<R?1:-1)*Math.abs(R)**a*t*this.volume*(C<s?C/s:C<s+g?1-(C-s)/g*(1-x):C<s+g+n?x:C<b-m?(b-C-m)/h*x:0),R=m?R/2+(m>C?0:(C<b-m?1:(b-C)/m)*A[C-m|0]/2):R),_=(i+=o+=l)*Math.cos(f*T++),P+=_-_*p*(1-1e9*(Math.sin(C)+1)%2),j&&++j>d&&(i+=c,M+=c,j=0),!u||++L%u||(i=M,o=S,j=j||1);return A},getNote:function(t=0,e=440){return e*2**(t/12)}},q={songData:[{i:[3,0,128,0,3,10,128,0,0,0,7,20,40,0,0,0,0,0,0,0,2,35,0,0,13,0,0,0,0],p:[1,2,1,3,4,5,6,7,8,9,10],c:[{n:[,,,,132,,,,,,,,130,,,,,,,,132,,,,,,,,130,,,,,,,,135,,,,,,,,134,,,,,,,,135,,,,,,,,134,,,,,,,,139,,,,,,,,137,,,,,,,,139,,,,,,,,137],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,90]},{n:[,,,,130,,,,,,,,128,,,,,,,,125,,,,125,,,,127,,,,,,,,134,,,,,,,,132,,,,,,,,128,,,,129,,,,130,,,,,,,,137,,,,,,,,135,,,,,,,,132,,,,132,,,,134],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,64,,,,,,,,103]},{n:[,,,,130,,,,,,,,128,,,,,,,,118,,,,,,,,120,,,,,,,,134,,,,,,,,132,,,,,,,,122,,,,,,,,123,,,,,,,,137,,,,,,,,135,,,,,,,,125,,,,,,,,127],f:[]},{n:[,,,,132,,,,,,,,127,,,,,,,,127,,,,127,,,,128,,,,,,,,135,,,,,,,,130,,,,,,,,131,,,,131,,,,132,,,,,,,,139,,,,,,,,134,,,,,,,,134,,,,134,,,,135],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,67,,,,,,,,107]},{n:[,,,,127,,,,,,,,130,,,,,,,,128,,,,130,,,,120,,,,,,,,130,,,,,,,,134,,,,,,,,132,,,,134,,,,123,,,,,,,,134,,,,,,,,137,,,,,,,,135,,,,137,,,,127],f:[,,,,13,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,59,,,,,,,,,,,,,,,,56,,,,,,,,103]},{n:[,,,,135,,,,,,,,130,,,,,,,,130,,,,130,,,,131,,,,,,,,138,,,,,,,,133,,,,,,,,134,,,,134,,,,135,,,,,,,,142,,,,,,,,137,,,,,,,,137,,,,137,,,,138],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,60,,,,,,,,100]},{n:[,,,,130,,,,,,,,133,,,,,,,,131,,,,133,,,,123,,,,,,,,133,,,,,,,,137,,,,,,,,135,,,,137,,,,126,,,,,,,,137,,,,,,,,140,,,,,,,,138,,,,140,,,,130],f:[,,,,,,,,,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,,,,,,,,,59,,,,,,,,95]},{n:[,,,,125,,,,,,,,125,,,,,,,,132,,,,,,,,132,,,,,,,,128,,,,,,,,128,,,,,,,,135,,,,,,,,135,,,,,,,,132,,,,,,,,132,,,,,,,,139,,,,,,,,139],f:[]},{n:[,,,,132,,,,,,,,130,,,,,,,,127,,,,,,,,127,,,,,,,,135,,,,,,,,134,,,,,,,,130,,,,,,,,130,,,,,,,,139,,,,,,,,137,,,,,,,,134,,,,,,,,134],f:[]},{n:[,,,,132,,,,,,,,132,,,,,,,,128,,,,,,,,130,,,,,,,,135,,,,,,,,135,,,,,,,,132,,,,,,,,132,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135],f:[]}]},{i:[3,124,128,0,3,146,128,12,0,0,7,89,29,0,0,0,0,0,0,0,2,255,0,0,9,47,3,27,2],p:[1,2,1,3,4,5,6,7,8,9,10],c:[{n:[,,116,118,120,,120,,120,,120,116,118,,120,,120,,116,118,120,,118,,118,,116,,118],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,41]},{n:[,,113,116,118,,118,,118,,111,115,116,,116,,116,,116,115,113,,113,111,113,,113,111,115],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[,,115,116,118,,118,,118,,118,115,116,,113,,113,,115,116,118,,118,115,116,,120,,120],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[,,120,118,123,,123,122,123,,123,125,130,,,,,,,,127,,123,,120,,122,,127],f:[12,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,25,,,,,,,,,,,,91,,,,,,,,40,,,,,,,,59]},{n:[,,,,127,,123,,130,,127,,134,,130,,125,,127,,130,128,130,,132,,135,,132],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,36,,,,,,,,,,,,,,,,,,,,,,,,,,,,60]},{n:[,,123,121,126,,126,125,126,,126,128,133,,,,,,,,130,,126,,123,,125,,130],f:[12,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,28,,,,,,,,,,,,93,,,,,,,,36,,,,,,,,67]},{n:[,,,,130,,126,,133,,130,,137,,133,,128,,130,,133,131,133,,135,,138,,135],f:[12,,,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,32,,,,,,,,,,,,,,,,,,,,,,,,,,,,108]},{n:[,,,,137,,,,,,,,144,,144,140,142,,142,137,139,,,,,,,,139,,139,135],f:[,,,,,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,28,,,,,,,,100,,,,,,,,37]},{n:[137,,137,130,132,,,,,,,,130,,132,,137,,140,,139,,,,,,,,139,,137],f:[,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,92,,,,,,,,33,,,,,,,,103,,,,,,,,49]},{n:[135,,130,,132,,,,,,,,132,,132,128,130,,130,127,128,,125,,123,,122,,120],f:[,,,,12,,,,,,,,12,,,,,,,,,,,,,,,,12,,,,,,,,93,,,,,,,,39,,,,,,,,,,,,,,,,89]}]},{i:[0,47,116,85,0,45,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,47,15,0,11,0,0,0,0],p:[,,,,4,5,6,7,8,9,10],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,144,,,,144,,,,,,149,149,149,,,,144,,,,144,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,,,144,,,,149,149,149,,,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,149,149,149,,,,144,,,,144,,,,144],f:[]},{n:[,,,,144,,,,144,,,,144,,,,144,,,,149,149,149,,,,,,144],f:[]},{n:[,,,,144,,,,,,,,,,149,149,149,,149,149,149,,149,149,149,,,,144,,149,149],f:[]},{n:[149,,149,149,149,,149,149,149],f:[]},{n:[,,,,,,,,,,,,144,,149,149,149,,149,149,149,,,,144,,,,144],f:[]}]}],rowLen:5300,patternLen:32,endPattern:10,numChannels:3},U={songData:[{i:[0,0,140,0,0,0,140,0,0,255,96,0,0,0,0,0,0,51,2,1,2,58,239,0,32,88,1,107,2],p:[1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};class G extends r{width=2;height=2;z=3;maxHealth=10;health;invincibleTime;name;time=0;constructor(t){super({game:t})}update(){this.time++,y.arrowleft&&5<this.x&&this.x--,y.arrowright&&this.x+this.width<345&&this.x++,y.arrowup&&5<this.y&&this.y--,y.arrowdown&&this.y+this.height<395&&this.y++,0<this.invincibleTime?this.invincibleTime--:this.color="#695535ee"}render(){let t=this.context;t.fillStyle=this.color,t.fillRect(this.x-4,this.y-4,10,10),t.fillStyle="#99c3a0",t.fillRect(this.x,this.y,2,2)}reset(){this.invincibleTime=0,this.health=this.maxHealth}hit(t=1){return!(0<this.invincibleTime||(M(.15,void 0,291,.02,.04,void 0,3,.76,void 0,void 0,void 0,void 0,void 0,.3,-458,void 0,void 0,.82,.03,.18),this.health-=t,this.game.notebook.updatePlayerName(this),this.health<=0&&this.game.transitionToScene("gameOver"),this.invincibleTime+=40,this.color="#69553555",0))}}const W=["ari","amy","mary","john","lisa","mark","paul","james","linda","david","susan","sarah","karen","nancy","betty","emily","donna","carol","kevin","brian","laura","jacob","robert","joseph","thomas","daniel","sandra","donald","ashley","steven","andrew","joshua","amanda","george","pamela","michael","william","barbara","richard","jessica","charles","matthew","anthony","kenneth","dorothy","melissa","timothy","deborah","stephen","patricia","jennifer","margaret","kimberly","michelle","jonathan","elizabeth","stephanie","christopher"],K=["li","lee","wang","berg","musa","tamm","park","moore","evans","brown","nowak","meyer","lopez","smith","monet","akbas","novak","taylor","gracia","hansen","burton","walker","melnyk","almeida","ibrahim","lavigne","adamcik","seatang","albescu","williams","kowalska","einstein","pedersen","andersson"],A=["cold","wind","forgotten","hateful","great","greedy","slayer","grumpy","sleepy","lonely","hungry"],P=["sidney","berlin","paris","london","madrid","beijing","tallinn","stockholm","abuja","brasilia","rome","bukarest","vienna","oslo"];let T=[""];function C(t,e){var i=Math.floor(e.length/2);return e[l(t=Math.max(Math.min(t-5,2*i)-1,0),i+t)]}class J extends r{constructor(t){super({color:t,time:0})}init(t){super.init({width:4,height:4,color:this.color,...t,render(){let t=this.context;t.fillStyle=this.color,t.strokeStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,this.width,this.height),t.strokeRect(0,0,this.width,this.height)}})}update(){super.update(),this.time++,348<this.x&&(this.ttl=0)}}class Q extends class{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(e){let i,s=!1;for(let t=this.size;t--;)(i=this.objects[t]).update(e),i.isAlive()||(s=!0,this.size--);s&&this.objects.sort((t,e)=>e.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}{maxSize=5e3;tick=0;rotation=10;arrays=1;arraySpread=120;beams=1;beamSpread=10;originX=0;originY=0;spinRate=0;inverseSpin=0;fireRate=5;bulletSpeed=1;startAngle=0;ttl=200;active=!1;constructor(t="red"){super({create:()=>new J(t)})}getBeamConfigs(t){const i=[];var s=t*this.arraySpread,n=this.beams%2==0;for(let e=0;e<this.beams;e++){let t;t=n?e%2==0?s-e/2*this.beamSpread-this.beamSpread/2:s+(e-1)/2*this.beamSpread+this.beamSpread/2:0===e?s:e%2==0?s-e/2*this.beamSpread:s+(e+1)/2*this.beamSpread;var h=s=>e=>{let i=t;if(this.spinRate){const s=0===this.inverseSpin?360:2*this.inverseSpin;let t=e*this.spinRate%s;this.inverseSpin&&t>this.inverseSpin&&(t=this.inverseSpin-t%this.inverseSpin),i+=t}return s(i)},h={x:this.originX,y:this.originY,dxf:h(t=>Math.cos(o(t))*this.bulletSpeed),dyf:h(t=>-Math.sin(o(t))*this.bulletSpeed),ddxf:h(t=>Math.cos(o(t+5))/100),ddyf:h(t=>-Math.sin(o(t+5))/100),fireRate:this.fireRate,ttl:this.ttl};i.push(h)}return i}_pc(){}bulletTick(){if(this.active){this.tick+=1;for(let t=0;t<this.arrays;t++)for(const n of this.getBeamConfigs(t))if(this.tick%this.fireRate==0){let t=n.dx,e=n.dy,i=(n.dxf&&(t=n.dxf(this.tick)),n.dyf&&(e=n.dyf(this.tick)),n.dx),s=n.dy;n.ddxf&&(i=n.ddxf(this.tick)),n.ddyf&&(s=n.ddyf(this.tick)),super.get({...n,dx:t,dy:e,ddy:s,ddx:i})}}}checkHit(e){for(let t=this.size;t--;)if(d(e,this.objects[t]))return!0;return!1}}function V(t,e){let i=t;const s=[];for(;0<i;){var n=l(1,Math.min(Math.ceil(i/2),6));i-=n;const r=function(t,e){const i=new Q(e);return i.arrays=t,i.arraySpread=360/t,i}(n,e);if(n=r,h=Math.min(50,t),n.fireRate=Math.floor(20-Math.abs(-5*Math.log(h+3)+6)),0<=i){const t=l(0,Math.min(Math.ceil(i/2),6));i-=t,n=r,h=t,s.length,n.spinRate=1+h}l(0,5)<1&&(r.inverseSpin=l(45,120)),s.push(r)}var h;return s}class Z{ticks=1;pools=[];movement=(t,e)=>{var i=t.level.player,s=i.x-t.x,i=i.y-t.y;t.x+=1/(500-100*e)*s,t.y+=1/(500-100*e)*i};togglePools(e){this.pools.forEach(t=>{t.active=e})}}class j extends r{width=30;height=40;dx=1;dy=1;speed=1;z=2;time=0;anchor={x:.5,y:.5};currentPattern=0;patternTick=0;r=l(50,255);g=l(50,255);b=l(50,255);rot=l(-5,5)/10;constructor(t,e,i){super({x:e,y:i,level:t,name:function(t){let e="",i=0;for(;T.includes(e);)10<i++&&(T=[""]),e=C(t,W)+" "+C(t,K),5<t&&.4<Math.random()?e+=" the "+A[l(0,A.length-1)]:10<t&&.5<Math.random()&&(e+=" from "+P[l(0,P.length-1)]);return T.push(e),e}(t.difficulty),render:()=>{let e=this.context;e.fillStyle=`rgba(${this.r}, ${this.g}, ${this.b}, ${this.transparency()})`,e.strokeStyle=`rgba(0, 0, 0, ${2*this.transparency()})`,e.beginPath(),e.arc(15,15,15,Math.PI,2*Math.PI),e.lineTo(this.width,40);for(let t=0;t<=this.width;t+=1){var i=40+2*Math.sin(.5*t);e.lineTo(this.width-t,i)}e.lineTo(0,15),e.stroke(),e.fill(),e.beginPath(),e.fillStyle=`rgba(50, 50, 50, ${this.transparency()})`,e.ellipse(9,20,4,7,-this.rot,0,2*Math.PI),e.ellipse(21,20,4,7,this.rot,0,2*Math.PI),e.fill()}});e=t.difficulty<12?t.difficulty:t.difficulty-4;e-=t.difficulty<22?0:5,this.patterns=function(t,e){const i=[];let s=t;for(;0<s;){const t=new Z;t.ticks=l(120,240),t.movement=function(t){const e=[(s=1===l(1,2),(t,e)=>{let i=t.level.height;s?(i=t.level.width,(t.x<=20||t.x>=i-20)&&(t.dx*=-1),t.x+=t.dx*e):((t.y<=20||t.y>=i-20)&&(t.dy*=-1),t.y+=t.dy*e)})];var s,a;if(5<t&&e.push((t,e)=>{var i=t.level.player,s=i.x-t.x,i=i.y-t.y;t.x+=1/(500-100*e)*s,t.y+=1/(500-100*e)*i}),10<t){const s=l(30,60-t);e.push((a=s,(t,e)=>{var i=t.level.player,s=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),n=.01*(a-s),h=o(1+Math.atan2(t.y-i.y,t.x-i.x)*(180/Math.PI)),r=i.x+Math.cos(h)*(s+n),i=i.y+Math.sin(h)*(s+n);t.x=r,t.y=i}))}return e[l(0,e.length-1)]}(s);var n=l(3,Math.max(s,4));t.pools=V(n,e),i.push(t),s-=n}return i.reverse()}(e,`rgb(${this.r},${this.g},${this.b})`),this.patterns.forEach(t=>{this.level.addChild(...t.pools)}),this.patterns[this.currentPattern].togglePools(!0)}transparency(){return Math.min(.3,this.time/600)}onType(t){this.name==t&&(M(.2,void 0,213,.02,.09,.11,1,.64,void 0,void 0,void 0,void 0,void 0,.1,void 0,.2,void 0,.6,.04),this.level.notebook.lineBreak(),this.level.removeChild(this),this.level.enemies=this.level.enemies.filter(t=>t!==this),++z.instance.score,this.level.checkClear())}alignPools(t){t.forEach(t=>{t.originX=this.x,t.originY=this.y})}update(){++this.patternTick;let t=this.patterns[this.currentPattern];this.patternTick>t.ticks&&(t.togglePools(!1),this.patternTick=0,this.currentPattern=(this.currentPattern+1)%this.patterns.length,(t=this.patterns[this.currentPattern]).togglePools(!0)),300<++this.time&&t.movement(this,this.speed);const e=t.pools;this.alignPools(e),e.forEach(t=>{t.bulletTick(),t.checkHit(this.level.player)&&this.level.player.hit()})}}class L extends r{color="#444444";width=7;height=7;text=a({text:this.name,color:"black",font:"15px Garamond",textAlign:"center",width:100,anchor:{x:.5,y:0}});playerCollision=!1;z=1;constructor(t,e,i,s){super({x:t,y:e,name:i,level:s}),this.setTextPos()}setTextPos(){this.text.x=this.x+this.width/2,this.text.y=this.y+this.height+7}render(){super.render(),this.playerCollision&&this.text.render()}spread(t,e){e*=Math.PI/180;this.x+=Math.cos(e)*t,this.y+=Math.sin(e)*t,this.x<50&&(this.x=50),300<this.x&&(this.x=300),this.setTextPos()}onPlayerCollisionEnter(){this.playerCollision||(this.playerCollision=!0)}onPlayerCollisionExit(){this.playerCollision&&(this.playerCollision=!1)}}class tt extends L{width=15;height=25;dx=2;time=0;splits=this.name.split(" ");explode=!1;constructor(t,e,i,s){super(t,e,i,s),this.setTextPos(),this.explode=5<l(1,10)&&s.difficulty>l(5,30)}render(){let t=this.context;t.fillStyle=this.color,t.fillRect(this.x,this.y+5,this.width,5),t.fillRect(this.x+5,this.y,5,this.height),this.playerCollision&&this.text.render()}update(){if(this.explode&&(this.time++%5==0&&this.time<120&&(this.x+=this.dx*=-1),121==this.time)){M(.4,void 0,653,.03,.02,.48,void 0,.87,void 0,void 0,void 0,void 0,void 0,1.4,void 0,.6,void 0,.41,.12);let s=this.level,n=(s.removeChild(this),l(0,360));this.splits.forEach((t,e)=>{let i=new L(this.x,this.y,t);s.gravestones.push(i),s.addChild(i);t=(n+360/this.splits.length*(e+1))%360;i.spread(l(20,70),t)}),s.sort()}}}class et extends r{color="#8da683";width=350;height=400;gravestones=[];enemies;name;scoreText=a({x:4,y:4,z:100,text:"Returned: "+z.instance.score,color:"black"});constructor(t){super({scene:t,player:t.player,notebook:t.notebook,difficulty:z.instance.currentDifficulty++}),this.enemies=[new j(this,l(120,180),l(70,120))],12<this.difficulty&&60<l(1,100)&&this.enemies.push(new j(this,l(80,100),l(200,230))),22<this.difficulty&&60<l(1,100)&&this.enemies.push(new j(this,l(200,250),l(200,230))),this.notebook.currentEnemies=this.enemies,this.enemies.forEach(t=>this.gravestones.push(new tt(t.x-7,t.y-7,t.name,this))),this.children.push(...this.gravestones,this.player,...this.enemies,this.scoreText),this.sort()}update(t){this.gravestones.forEach(t=>d(this.player,t)?t.onPlayerCollisionEnter():t.onPlayerCollisionExit()),this.enemies.forEach(t=>{d(this.player,t)&&this.player.hit(3)}),super.update(t)}sort(){this.children.sort((t,e)=>t.z-e.z)}checkClear(){0==this.enemies.length&&(this.children=[],this.render(),this.scene.game.transitionToScene("game"))}}function it(){function B(t){return Math.sin(6.283184*t)}function Y(t){return.003959503758*2**((t-128)/12)}var D,H,I,O,X,N=[B,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){t=t%1*4;return t<2?t-1:3-t}];this.init=function(t){H=(D=t).endPattern,I=0,O=t.rowLen*t.patternLen*(H+1)*2,X=new Int32Array(O)},this.generate=function(){for(var t,e,i,s,n,h,r,a=new Int32Array(O),o=D.songData[I],l=D.rowLen,c=D.patternLen,d=0,u=0,p=!1,f=[],y=0;y<=H;++y)for(i=o.p[y],t=0;t<c;++t){for(var m=i?o.c[i-1].f[t]:0,x=(m&&(o.i[m-1]=o.c[i-1].f[t+c]||0,m<17&&(f=[])),N[o.i[16]]),g=o.i[17]/512,w=2**(o.i[18]-9)/l,v=o.i[19],_=o.i[20],b=43.23529*o.i[21]*3.141592/44100,k=1-o.i[22]/255,S=1e-5*o.i[23],M=o.i[24]/32,A=o.i[25]/512,P=6.283184*2**(o.i[26]-9)/l,T=o.i[27]/255,C=o.i[28]*l&-2,j=(y*c+t)*l,L=0;L<4;++L)if(e=i?o.c[i-1].n[t+L*c]:0){f[e]||(f[e]=function(t,e,i){for(var s,n,h,r,a=N[t.i[0]],o=t.i[1],l=t.i[3]/32,c=N[t.i[4]],d=t.i[5],u=t.i[8]/32,p=t.i[9],f=t.i[10]*t.i[10]*4,y=t.i[11]*t.i[11]*4,m=t.i[12]*t.i[12]*4,x=1/m,g=-t.i[13]/16,w=t.i[14],v=i*2**(2-t.i[15]),_=new Int32Array(f+y+m),b=0,k=0,S=0,M=0;S<f+y+m;S++,M++)0<=M&&(M-=v,h=Y(e+(15&(w=w>>8|(255&w)<<4))+t.i[2]-128),r=Y(e+(15&w)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,S<f?s=S/f:f+y<=S&&(s=(1-(s=(S-f-y)*x))*3**(g*s)),n=a(b+=h*s**l)*o,n+=c(k+=r*s**u)*d,p&&(n+=(2*Math.random()-1)*p),_[S]=80*n*s|0;return _}(o,e,l));for(var E=f[e],R=0,z=2*j;R<E.length;R++,z+=2)a[z]+=E[R]}for(R=0;R<l;R++)(n=a[s=2*(j+R)])||p?(h=b,v&&(h*=x(w*s)*g+.5),u+=(h=1.5*Math.sin(h))*(h=k*(n-u)-(d+=h*u)),n=3==_?u:1==_?h:d,S&&(n=(n*=S)<1?-1<n?B(.25*n):-1:1,n/=S),p=1e-5<(n*=M)*n,r=n*(1-(h=Math.sin(P*s)*A+.5)),n*=h):r=0,C<=s&&(r+=a[s-C+1]*T,n+=a[s-C]*T),a[s]=0|r,a[1+s]=0|n,X[s]+=0|r,X[1+s]+=0|n}return++I/D.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,O/2,44100),i=0;i<2;i++)for(var s=e.getChannelData(i),n=i;n<O;n+=2)s[n>>1]=X[n]/65536;return e},this.createWave=function(){var t=44+2*O-8,e=t-36,i=new Uint8Array(44+2*O);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,n=44;s<O;++s){var h=(h=X[s])<-32767?-32767:32767<h?32767:h;i[n++]=255&h,i[n++]=h>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var h=i+n;s[n]=0<t&&h<X.length?X[h]/32768:0}return s}}const E=new class{sounds={};init(){this.sounds={bgmusic:this.initSound(q,!0),wind:this.initSound(U)}}initSound(t,e=!1){let i=new it;for(i.init(t);i.generate()<1;);let s=document.createElement("audio");return s.src=URL.createObjectURL(new Blob([i.createWave()],{type:"audio/wav"})),s.loop=e,s}play(t){this.sounds[t].currentTime=0,this.sounds[t].play()}},st=["space",...[...Array(26).keys()].map(t=>String.fromCharCode(t+97))];class R extends k{level;constructor(t){super({game:t,notebook:t.notebook,objects:[t.notebook],player:t.player}),this.player.reset()}nextLevel(){this.level=new et(this),this.player.x=165,this.player.y=350,this.player.health=Math.min(this.player.health+1,this.player.maxHealth),this.add(this.level)}transition(){this.nextLevel(),this.notebook.updatePlayerName(this.player),this.notebook.x=400}}class z{activeScene;transitionBlock=function(){return new r(...arguments)}({width:800,height:600,color:"#2e0f09"});transitioning;transitioningTo;musicPlaying=!1;notebook=new F(235,70);player=new G(this);currentDifficulty=1;score=0;scenes={menu:S({objects:[this.notebook],transition(){}}),game:new R(this),gameOver:S({objects:[this.notebook],game:this,transition(){this.game.notebook.initGameOver(this.game.score)}})};static instance;constructor(){this.transitionToScene("menu"),_("enter",()=>{if(!this.transitioning){switch(this.transitioningTo){case"menu":return void(3<this.notebook.children.at(-1).text.length&&(this.player.name??=this.notebook.currentText().text.substring(2),this.transitionToScene("game"),this.notebook.lineBreak()));case"gameOver":return this.scenes.game=new R(this),this.currentDifficulty=1,this.score=0,this.transitionToScene("game"),this.notebook.updatePlayerName(this.player),void this.notebook.lineBreak()}this.notebook.lineBreak()}}),_(st,t=>{this.transitioning||"gameOver"==this.transitioningTo||(M(.5,.15,130,.02,.01,.01,void 0,3.1,void 0,93,void 0,void 0,void 0,void 0,33,void 0,void 0,.5),this.notebook.type(t.key))}),z.instance=this}setScene(t){return this.activeScene=this.scenes[t],this.activeScene.transition(),this.activeScene.update(),this.activeScene}transitionToScene(t){this.transitioning=!0,this.transitioningTo=t,this.transitionBlock.y=-600,this.transitionBlock.dy=20,E.play("wind")}render(){this.activeScene?.render(),this.transitioning&&this.transitionBlock.render()}update(){this.transitioning?(this.transitionBlock.y+=20,0==this.transitionBlock.y&&this.setScene(this.transitioningTo),400<=this.transitionBlock.y&&(this.musicPlaying||"game"!=this.transitioningTo||(this.musicPlaying=!0,E.play("bgmusic")),this.transitioning=!1)):this.activeScene?.update()}}var[{contextless:nt=!1}={}]=[];if(t=document.getElementById(void 0)||document.querySelector("canvas"),!(t=nt?t||new Proxy({},i):t))throw Error("You must provide a canvas element for the game");(g=t.getContext("2d")||new Proxy({},i)).imageSmoothingEnabled=!1,w("init");{let t;for(t=0;t<26;t++)m["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)m["Digit"+t]=m["Numpad"+t]=""+t;window.addEventListener("keydown",O),window.addEventListener("keyup",X),window.addEventListener("blur",N)}E.init();const B=new z;!function({fps:t=60,clearCanvas:e=!0,update:i,render:s,context:n=g,blur:h=!1}){if(!s)throw Error("You must provide a render() function");let r,a,o,l,c,d=0,u=1e3/t,p=1/t,f=e?I:x,y=!0;function m(){if(a=requestAnimationFrame(m),y&&(o=performance.now(),l=o-r,r=o,!(1e3<l))){for(w("tick"),d+=l;d>=u;)c.update(p),d-=u;f(n),c.render()}}return h||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),c={update:i,render:s,isStopped:!0,start(){r=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:m,set _last(t){r=t}}}({update:()=>{B.update()},render:()=>{B.render()}}).start()}()</script></body></html>