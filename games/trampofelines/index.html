<!doctype html><meta name=viewport content="width=device-width"><title>Trampofelines! - js13kGames 2025</title><style>body,html{margin:0;padding:0;height:100%}canvas{position:absolute;top:0;left:0;user-select:none;touch-action:none;image-rendering:pixelated}#stage{width:100vw;height:100lvh}button{z-index:4;position:absolute;left:calc(50% - 100px);bottom:20%;outline:0;border:none;border-radius:5px;cursor:pointer;animation:a1 2s ease-in-out alternate infinite}@keyframes a1{from{transform:scale(1)}to{transform:scale(1.1)}}@keyframes a2{from{transform:scale(1)}to{transform:scale(1.2)}}</style><div id=stage><div id=title><button id=go!></button></div><div id=gameover><button id=again></button> <button id=bye></button></div></div><script>var t=Math.PI/180;function e(t){return t[Math.floor(Math.random()*t.length)]}function i(t,e,i){return Math.max(t,Math.min(i,e))}function s(t,e,i){return t*(1-i)+e*i}function a(t,e,i,a=()=>{}){if(i<=1)return[s(t,e,.5)];let o=[];for(let n=0;n<i;n++){let l=s(t,e,n/(i-1));o.push(l),a(l,n)}return o}function o(t,e,i,a){return s(t,e,1-Math.exp(-i*a))}function n(t,e,i){return new h(s(t.x,e.x,i),s(t.y,e.y,i))}function l(t,e,i){return t.dot(e)<t.dot(i)}function r(t,e,i){return e.sub(t).cross(i.sub(t))}Math.PI;var h=class t{constructor(t,e){this.x=t,this.y=e}static ZERO=new t(0,0);static random(e=new t(0,0),i=new t(1,1)){return new t(s(e.x,i.x,Math.random()),s(e.y,i.y,Math.random()))}set(t,e){this.x=t,this.y=e}abs(){return Math.hypot(this.x,this.y)}rotate(e){let i=Math.cos(e),s=Math.sin(e);return new t(this.x*i-this.y*s,this.x*s+this.y*i)}rotateAbout(t,e){return t.add(this.sub(t).rotate(e))}rotateAboutI(t,e){let i=t.add(this.sub(t).rotate(e));this.set(i.x,i.y)}normalize(){let t=this.abs();return this.x/=t,this.y/=t,this}clone(){return new t(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}addI(t){return this.x+=t.x,this.y+=t.y,this}subI(t){return this.x-=t.x,this.y-=t.y,this}scaleI(t){return this.x*=t,this.y*=t,this}incrY(t){return this.y+=t,this}incrX(t){return this.x+=t,this}add(t){return this.clone().addI(t)}addX(t){return this.clone().incrX(t)}addY(t){return this.clone().incrY(t)}sub(t){return this.clone().subI(t)}scale(t){return this.clone().scaleI(t)}perp(){return new t(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}onSegment(t,e){return 0===r(t,e,this)&&function(t,e,i){return t.sub(i).dot(e.sub(i))<=0}(t,e,this)}projectI(t,e){return this.set(this.dot(t),this.dot(e))}project(t,e){return this.clone().projectI(t,e)}toString(){return`(${this.x},${this.y})`}},c=class{setAlpha(t){return this.alpha=t,this}toAlpha(t){return this.clone().setAlpha(t)}},d=class t extends c{constructor(t=0,e=0,i=0,s=1){super(),this.h=t,this.s=e,this.l=i,this.alpha=s}clone(){return new t(this.h,this.s,this.l,this.alpha)}lighten(t){let e=this.clone();return e.l*=t,e}toString(){return`hsla(${this.h},${this.s}%,${this.l}%,${this.alpha})`}},u={black:p(0,0,0),white:p(0,0,100),gray:p(0,0,75),brightYellow:p(64,97,56),pink:p(350,100,88),hotPink:p(330,100,71),coral:p(16,100,66),fuchsia:p(300,100,66),chartreuse:p(131,77,44),tube1:p(120,62,45),tube2:p(120,53,34),nightBlue:p(212,94,7),darkBlue:p(212,52,14),blueGray:p(212,18,40),basket2:p(26,56,39),basket1:p(29,54,49),blue0:p(210,100,35),blue1:p(210,100,40),blue2:p(210,100,50),blue3:p(210,100,65)},v=u;function p(t,e,i,s=1){return new d(t,e,i,s)}function f(t){for(let e of Object.values(u))e.alpha=t}function w(t,{innerRadius:e=5,outerRadius:i=10,points:s=5,angle:a=0,fill:o,stroke:n,ctx:l,cb:r}={}){let c=2*Math.PI/(2*s);l?.beginPath();for(let o=0,n=0;o<2*s;o++,n+=c){let s=new h(Math.cos(n),Math.sin(n)).scale(o%2==0?i:e);s=s.rotate(a),s=s.add(t),l?.lineTo(s.x,s.y),r&&r(s,o)}l?.closePath(),l&&(o&&(l.fillStyle=o,l.fill()),n&&(l.strokeStyle=n,l.stroke()))}function y(t,e,{color1:i=p(120,100,50),color2:a=p(120,100,31),shineColor:o=p(120,100,88),shinePos:n=.1,shineSize:l=.2,shineSmoothness:r=.5}={}){let{ctx:h}=mt,c=h.createLinearGradient(t.x,t.y,e.x,e.y);return c.addColorStop(0,i),l>0&&(c.addColorStop(n,i),c.addColorStop(n+s(0,.5*l,r),o),c.addColorStop(n+l-s(0,.5*l,r),o),c.addColorStop(n+l,i)),c.addColorStop(1,a),c}function g(t,e,i="black"){let{ctx:s}=mt;s.strokeStyle=i,s.fillStyle=i,s.lineWidth=2,s.beginPath(),s.arc(t.x,t.y,2,0,2*Math.PI),s.fill(),s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.stroke(),s.beginPath(),s.arc(e.x,e.y,4,0,2*Math.PI),s.fill()}function m(t,e){let{ctx:i}=mt;i.beginPath(),i.arc(t.x,t.y,e,0,2*Math.PI)}function x(t,{padding:e=5,width:i=50,height:s=200,color1:a=v.blue1,color2:o=v.blue3,right:n=!1,beamLength:l=30,content:r=()=>{}}){let{ctx:h}=mt;h.lineWidth=4,h.strokeStyle=a,[t.y+2*e,t.y+s].forEach(s=>{h.beginPath(),h.moveTo(t.x,s),h.lineTo(t.x+(n?i+2*e+l:-l),s),h.stroke()});let c=new Path2D,d=new Path2D;c.roundRect(t.x,t.y,i+2*e,s+2*e,10),d.roundRect(t.x-e,t.y-e,i+4*e,s+4*e,5),h.fillStyle=a,h.fill(d),h.lineWidth=2,h.strokeStyle=o,h.stroke(c),h.save(),h.translate(t.x+e,t.y+e),r(),h.restore()}var b=class{static _then;static _now=0;static _id=0;static _timers=new Map;static get dt(){return this._now-this._then}static get time(){return this._now}static update(t){return this._then=this._now,this._now=t,this._timers.forEach(t=>{t._elapsed+=this.dt,t._elapsed>=t.interval&&(t.cb(),t._elapsed=0)}),this.dt}static cancelTimer(t){this._timers.delete(t)}static every(t,e){let i=this._id;return this._timers.set(i,{_elapsed:0,interval:t,cb:e}),this._id++,i}},k=class{constructor(t=new h(0,0),e=1){this._direction=t,this._magnitude=e}set magnitude(t){this._magnitude=t}set direction(t){this._direction=t}get magnitude(){return this._magnitude}get direction(){return this._direction}},S=class extends k{constructor(t,e,i=1){super(),this.from=t,this.to=e,this.strength=i}get magnitude(){return this.strength+this.to.sub(this.from).abs()}get direction(){return this.to.sub(this.from).normalize()}},T=class t extends k{constructor(t,e,i=1){super(t,e),this.lambda=i}static EPSILON=1e-6;update(){this._magnitude=this._magnitude<=t.EPSILON?0:o(this._magnitude,0,this.lambda,b.dt)}},P=class{name;position;velocity;orientation;angularVelocity;mass;friction;_forces=[];_aux=new h(0,0);_locks={x:!1,y:!1};_fixed=!1;collider;ref;collisionID;state=0;constructor(t,{name:e="DB",mass:i=1,friction:s=1,orientation:a=0,angularVelocity:o=0}={}){this.name=e,this.position=t,this.velocity=new h(0,0),this.mass=i,this.friction=s,this.orientation=a,this.angularVelocity=o}die(){this.state=2,z.unregisterBody(this)}addForce(t){!this._fixed&&this._forces.push(t)}clearForces(){this._forces=[]}attachCollider(t){this.collider=t}get totalForce(){return this._aux.set(0,0),this._forces.forEach(t=>this._aux.addI(t.direction.scale(t.magnitude))),this._aux}get acceleration(){return this.totalForce.scaleI(1/this.mass).subI(this.velocity.scale(this.friction))}toggleX(){this._locks.x=!this._locks.x}toggleY(){this._locks.y=!this._locks.y}toggleFixed(){this._fixed=!this._fixed}update(){let{dt:t}=b;if(this._fixed)return;this._forces.forEach(t=>t.update&&t.update());let e=this.orientation+this.angularVelocity*t;this.orientation=e>2*Math.PI?0:e,this._locks.x||(this.velocity.x+=this.acceleration.x*t,this.position.x+=this.velocity.x*t+this.acceleration.x*t*t*.5),this._locks.y||(this.velocity.y+=this.acceleration.y*t,this.position.y+=this.velocity.y*t+this.acceleration.y*t*t*.5)}},M=new k(new h(0,1),9.81),z=class{static counter=0;static pairs=new Set;static getId(t){if(t.collider&&0===t.state)return t.collisionID||(t.collisionID=`${t.name}${this.counter++}`),t.collisionID}static register(t,e,i={}){let s=this.getId(t),a=this.getId(e);!s||!a||this.pairs.add({id1:s,id2:a,ref1:new WeakRef(t),ref2:new WeakRef(e),...i})}static unregisterBody(t){[...this.pairs.values()].filter(({id1:e,id2:i})=>t.collisionID===e||t.collisionID===i).forEach(t=>{this.pairs.delete(t)})}static update(){this.pairs.forEach(({ref1:t,ref2:e,filter:i,cb:s,sensor:a=!1,contactForceFactor:o=300})=>{let n=t.deref(),l=e.deref(),r=n?.collider,h=l?.collider;!n||!l||!r||!h||0!==n.state||0!==l.state||i&&!i(n,l)||!r.checkContact(h)||(a||(n.addForce(this.collide(n,l,o)),l.addForce(this.collide(l,n,o))),s&&s())})}static collide(t,e,i=1){let s=2*e.mass/(t.mass+e.mass),a=t.collider.center.sub(e.collider.center);return new T(a.normalize(),s*i)}};function E(t,e){return function(t,e,i){if(!t.equals(e)){let s=e.sub(t);if(l(s,t,i)&&l(s,i,e))return Math.abs(s.cross(i)-s.cross(t))/s.abs()}return Math.min(i.sub(t).abs(),i.sub(e).abs())}(e.a,e.b,t.center)<=t.radius}var C=class{constructor(t){this.type=t}},L=class extends C{constructor(t,e){super(0),this.center=t,this.radius=e}checkContact(t){switch(t.type){case 0:return function(t,e){return e.center.sub(t.center).abs()<=t.radius+e.radius}(this,t);case 1:return E(this,t)}}draw(){let{ctx:t}=mt;t.lineWidth=1,t.strokeStyle=v.chartreuse,m(this.center,this.radius),t.stroke()}},_=class t extends C{constructor(t,e,i=0){super(1),this.center=t,this.length=e,this.dir=i}static fromEndPoints(e,i){let s=e.sub(i);new t(n(e,i,.5),s.abs(),Math.atan2(s.y,s.x))}get a(){return this.center.add(new h(1,0).scale(.5*this.length).rotate(this.dir))}get b(){return this.center.add(new h(1,0).scale(-.5*this.length).rotate(this.dir))}checkContact(t){return E(t,this)}draw(){g(this.center,this.a,v.chartreuse),g(this.center,this.b,v.chartreuse)}};function A(t,e){let i=e.velocity.y>=0,s=e.position.y<t.position.y;return i&&s}var I,R,D,W,V,Y=class extends P{constructor(t,e=.1,i=1,s=100){super(t,{name:"J",mass:e,friction:i}),this.attraction=s}addNeighbor(t){this.addForce(new S(this.position,t.position,this.attraction)),t.addForce(new S(t.position,this.position,this.attraction))}},j=class{joints=[];mass;damping;jointsAttraction;constructor(t,e,i,{mass:s=1,damping:a=1,jointsAttraction:o=100}={}){let l;this.mass=s,this.damping=a,this.jointsAttraction=o;for(let r=0;r<i;r++){let h=new Y(n(t,e,r/(i-1)),s,a,o);l&&h.addNeighbor(l),this.joints.push(h),h.addForce(M),h.attachCollider(new L(h.position,jt)),l=h}this.joints.at(0)?.clearForces(),this.joints.at(-1)?.clearForces(),this.joints.at(0)?.toggleFixed(),this.joints.at(-1)?.toggleFixed()}update(){this.joints.forEach(t=>{t.update()})}},F=class{entities=new Map;get list(){return[...this.entities.values()]}get count(){return this.entities.size}clearEntities(){this.entities.clear()}delete(t){this.entities.delete(t.id)}add(t){t.id||=crypto.randomUUID(),this.entities.set(t.id,t)}},B=class{static activeTweens=new Map;static add(t){[...this.activeTweens.values()].forEach(e=>{e.obj===t.obj&&e.property===t.property&&this.activeTweens.delete(e.id)}),t.id=crypto.randomUUID(),this.activeTweens.set(t.id,t)}static delete(t){this.activeTweens.delete(t.id)}static update(){this.activeTweens.forEach(t=>t.update())}},U=class{constructor(t,e,{startValue:i,finalValue:s=1,speed:a=7,onUpdate:o=t.draw?.bind(t)??void 0,onComplete:n,epsilon:l=.001}={}){this.obj=t,this.property=e,this.startValue=i??this.obj[e],this.value=this.startValue,this.targetValue=s,this.speed=a,this.onUpdate=o,this.onComplete=n,this.epsilon=l,B.add(this)}id;value;startValue;targetValue;speed;onUpdate;onComplete;epsilon;update(){let t=.1*b.dt;if(this.obj[this.property]=this.value=o(this.value,this.targetValue,this.speed,t),this.onUpdate&&this.onUpdate(),Math.abs(this.value-this.targetValue)<this.epsilon)return this.obj[this.property]=this.targetValue,this.onComplete&&this.onComplete(),void B.delete(this)}},O=class{constructor(t,{startRadius:e=5,finalRadius:i=10,startTransparency:s=1,finalTransparency:a=0,color:o=v.white,speed:n=7}={}){this.position=t,this.radius=e,this.alpha=s,this.color=o.clone(),new U(this,"alpha",{finalValue:a,speed:n}),new U(this,"radius",{finalValue:i,speed:n})}radius;alpha;color;draw(){let{ctx:t}=mt;t.fillStyle=this.color.setAlpha(this.alpha),t.beginPath(),m(this.position,this.radius),t.fill()}},$=class extends O{constructor(t,{color2:e=v.blue3,points:i=5,...s}={}){super(t,s),this.center=t,this.color2=e.clone(),this.points=i}ctx;color2;points;drawEven;drawOdd;draw(){mt.setActiveLayer("game");let{ctx:t}=mt,{time:e}=b;t.lineWidth=2,w(this.center,{outerRadius:this.radius,innerRadius:this.radius,points:this.points,angle:.05*e,cb:(i,s)=>{w(i,{angle:.3*e,ctx:t,fill:this.color.setAlpha(this.alpha),stroke:this.color2.setAlpha(this.alpha)})}})}},X=(...t)=>{let e=N.createBufferSource(),i=N.createBuffer(t.length,t[0].length,J);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(N.destination),e.start(),e},G=(t=1,e=.05,i=220,s=0,a=0,o=.1,n=0,l=1,r=0,h=0,c=0,d=0,u=0,v=0,p=0,f=0,w=0,y=1,g=0,m=0)=>{let x,b,k=2*Math.PI,S=r*=500*k/J**2,T=(0<p?1:-1)*k/4,P=i*=(1+2*e*Math.random()-e)*k/J,M=[],z=0,E=0,C=0,L=1,_=0,A=0,I=0;for(h*=500*k/J**3,p*=k/J,c*=k/J,d*=J,u=J*u|0,b=(s=99+J*s)+(g*=J)+(a*=J)+(o*=J)+(w*=J)|0;C<b;M[C++]=I)++A%(100*f|0)||(I=n?1<n?2<n?3<n?Math.sin((z%k)**3):Math.max(Math.min(Math.tan(z),1),-1):1-(2*z/k%2+2)%2:1-4*Math.abs(Math.round(z/k)-z/k):Math.sin(z),I=(u?1-m+m*Math.sin(2*Math.PI*C/u):1)*(0<I?1:-1)*Math.abs(I)**l*t*q*(C<s?C/s:C<s+g?1-(C-s)/g*(1-y):C<s+g+a?y:C<b-w?(b-C-w)/o*y:0),I=w?I/2+(w>C?0:(C<b-w?1:(b-C)/w)*M[C-w|0]/2):I),x=(i+=r+=h)*Math.sin(E*p-T),z+=x-x*v*(1-1e9*(Math.sin(C)+1)%2),E+=x-x*v*(1-1e9*(Math.sin(C)**2+1)%2),L&&++L>d&&(i+=c,P+=c,L=0),!u||++_%u||(i=P,r=S,L=L||1);return M},q=.3,J=44100,N=new(window.AudioContext||webkitAudioContext),K={filled:G(void 0,void 0,408,.06,.14,.25,1,1.3,3,void 0,51,.17,void 0,void 0,void 0,void 0,void 0,.67,.29),score:G(2.6,void 0,447,.01,.01,.05,1,.7,18,-11,void 0,void 0,void 0,void 0,void 0,void 0,.09,.99,.07,void 0),score2:G(1.3,0,493.8833,void 0,.1,.32,void 0,3.6,void 0,void 0,100,-.08,.07,void 0,void 0,void 0,.2,1.7,.02),button:G(void 0,void 0,321,.04,.02,.07,1,.7,void 0,157,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.66,.02),drawing:G(2,void 0,440,.02,.01,.001,1,.1,34,12,void 0,void 0,void 0,void 0,void 0,void 0,.1,.88,.01),badPlacement:G(.5,void 0,419,.02,.08,.07,3,3.2,-8,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.95,.05,void 0),meow:G(void 0,void 0,242,void 0,.03,.08,void 0,void 0,void 0,154,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.99,.04,void 0),spawn:G(void 0,void 0,129,.01,void 0,.15,void 0,void 0,void 0,void 0,void 0,void 0,void 0,5),bounce:G(void 0,void 0,217,.01,.05,.06,void 0,2.3,void 0,46,void 0,void 0,void 0,.1,void 0,void 0,void 0,.95,.05),gameover:G(void 0,void 0,925,.04,.3,.6,1,.3,void 0,6.27,-184,.09,.17),drop:G(2,0,174.6141,void 0,.1,.17,1,4.2,void 0,void 0,-50,.07,.07,void 0,void 0,void 0,.07,.94,.02,void 0)},Z=!1,H=0,Q=!1,tt=!0,et=0,it=p(0,100,0),{nightBlue:st,blueGray:at}=v,ot=class extends F{enableUI(){mt.stage.appendChild(mt.getLayer("ui"))}disableUI(){I=R=void 0,V&&clearInterval(V);let t=mt.getLayer("ui");t.parentElement&&mt.stage.removeChild(t)}constructor(){super();let t=mt.getLayer("ui");function e(){if(Z=!1,clearInterval(V),!I||!R||H<100)return I=R=void 0,void(H=0);tt&&Mt.spawn(),tt&&X(K.meow),!tt&&X(K.badPlacement),I=R=void 0}t.addEventListener("mousedown",function(e){e.preventDefault(),I=t.resolveMousePosition(e),mt.setActiveLayer("game"),V=setInterval(()=>et>2&&X(K.drawing),50),Z=!0},!1),t.addEventListener("mousemove",function(e){if(e.preventDefault(),et=Math.hypot(e.movementX,e.movementY),!Z||0===e.buttons)return Z=!1,Q=!1,I=R=void 0,void clearInterval(V);Q=!0,H=I&&R?I.sub(R).abs():0,R=t.resolveMousePosition(e)},!1),t.addEventListener("mouseup",function(t){t.preventDefault(),e()},!1),t.addEventListener("touchstart",function(e){I=t.resolveTouchPosition(e.touches[0]),Z=!0},!1),t.addEventListener("touchmove",function(e){e.preventDefault(),Z?(Q=!0,H=I&&R?I.sub(R).abs():0,R=t.resolveTouchPosition(e.touches[0])):I=R=void 0},!1),t.addEventListener("touchend",function(t){t.preventDefault(),e()},!1)}update(){this.list.forEach(t=>{t.update(),t.draw()}),this.drawGuides()}spawn(){if(!I||!R||I.equals(R))return;let t=new nt(R,I,10,{damping:2,mass:2,jointsAttraction:220});return this.add(t),Et.list.forEach(e=>t.catch(e)),t}testPlacement(){return tt=H>=Yt&&this.count<Wt&&0===this.list.filter(({joints:t,dead:e})=>!e&&(D=t.at(0).position,W=t.at(-1).position,function(t,e,i,s){let a=r(i,s,t),o=r(i,s,e),n=r(t,e,i),l=r(t,e,s);if(a*o<0&&n*l<0)return t.scale(o).sub(e.scale(a)).scale(1/(o-a))}(I,R,D,W))).length}drawGuides(){let{time:t}=b;mt.setActiveLayer("ui"),mt.clearLayer();let{ctx:e}=mt;!I||!R||(e.lineWidth=10,e.lineDashOffset=5*-t,e.setLineDash([5,15]),it.l=this.testPlacement()?0:50,it.alpha=s(.6,.8,Math.sin(t)),e.strokeStyle=it,e.lineCap=e.lineJoin="round",e.beginPath(),e.moveTo(I.x,I.y),e.lineTo(R.x,R.y),e.stroke(),e.setLineDash([]))}static isDrawing(){return Q}},nt=class extends j{alpha=1;dead=!1;id;catch(t){this.joints.forEach(e=>z.register(e,t,{cb:()=>{new $(t.position,{points:2,startRadius:15,finalRadius:50,startTransparency:1,color:v.brightYellow,color2:v.brightYellow}),X(K.bounce),this.die()}}))}die(){this.dead=!0,this.joints.forEach(t=>t.die()),new U(this,"alpha",{finalValue:0,onComplete:()=>Mt.delete(this)})}draw(){let{ctx:t}=mt;f(this.alpha),t.lineWidth=25,t.strokeStyle=st,t.beginPath(),t.moveTo(this.joints[0].position.x,this.joints[0].position.y),this.joints.forEach(e=>{t.lineTo(e.position.x,e.position.y)}),t.stroke();{let e=this.joints[0].position,i=this.joints[1].position,s=e.sub(i),a=Math.atan2(-s.x,s.y);t.save(),t.translate(e.x,e.y),t.rotate(a),lt(),t.restore()}{let e=this.joints.at(-1).position,i=this.joints.at(-2).position,a=e.sub(i).normalize(),o=Math.atan2(-a.x,a.y);t.save(),t.translate(e.x,e.y),t.rotate(o),function(){let{time:t}=b,{ctx:e}=mt;e.fillStyle=st.toString(),e.lineWidth=2,e.beginPath(),m(new h(0,0),20),e.fill(),e.strokeStyle=at.toString(),e.beginPath(),e.moveTo(2,4),e.lineTo(-2,0),e.moveTo(-2,4),e.lineTo(2,0),e.stroke(),e.strokeStyle=st.toString(),e.lineWidth=10;let i=10;[i,-i].forEach(t=>{e.beginPath(),e.moveTo(t,0),e.lineTo(t,40),e.stroke(),e.save(),e.strokeStyle=at.toString(),e.lineWidth=2,e.translate(t,40),e.fillStyle=at.toString(),m(new h(0,-3),3),e.fill(),m(new h(4,2),2),e.fill(),m(new h(0,4),2),e.fill(),m(new h(-4,2),2),e.fill(),e.restore()});let a=s(-15,15,.5*Math.sin(.1*t)+.5);e.strokeStyle=st.toString(),e.lineWidth=10,e.beginPath(),e.moveTo(0,0);for(let t=0,i=40;t<2;t++,i+=40)e.quadraticCurveTo((t%2==0?-1:1)*a,20+40*t-7,0,i+-7);e.stroke()}(),t.restore()}f(1)}};function lt({coatColor:t=v.nightBlue,detailColor:e=v.blueGray,pink:i=v.pink,white:s=v.white,black:a=v.black,drawPaws:o=!0}={}){let{ctx:n}=mt;if(o){n.strokeStyle=t,n.lineWidth=10;let i=10;[i,-i].forEach(t=>{n.beginPath(),n.moveTo(t,0),n.lineTo(t,40),n.stroke(),n.save(),n.strokeStyle=e,n.lineWidth=2,n.translate(t,40),n.beginPath(),n.moveTo(2,4),n.lineTo(2,0),n.moveTo(-2,4),n.lineTo(-2,0),n.stroke(),n.restore()})}let l=10;n.lineWidth=2,n.fillStyle=t,n.strokeStyle=e,n.beginPath(),n.moveTo(20,-20),n.bezierCurveTo(40,30,-40,30,-20,-20),[l,-l].forEach((t,e)=>{n.moveTo(t,-20),n.lineTo(t+5*(1===e?-1:1),-30),n.lineTo(t+10*(1===e?-1:1),-20)}),n.stroke(),n.fill(),n.beginPath(),n.moveTo(0,-20),n.lineTo(0,-15),n.moveTo(-3,-20),n.lineTo(-3,-17),n.moveTo(3,-20),n.lineTo(3,-17),n.stroke();let r=-10;n.fillStyle=s,m(new h(10,r),5),n.fill(),m(new h(-10,r),5),n.fill(),n.fillStyle=a,m(new h(10,r),2),n.fill(),m(new h(-10,r),2),n.fill(),n.strokeStyle=s,n.lineWidth=2,n.beginPath();let c=5,d=20;[[-c,-d],[c,d]].forEach(([t,e])=>{[-5,0,5].forEach(i=>{n.moveTo(t,0),n.lineTo(e,i)})}),n.stroke(),n.fillStyle=i,n.strokeStyle=a,n.beginPath(),m(new h(0,0),4),n.closePath(),n.fill(),n.stroke(),n.strokeStyle=e,n.beginPath(),n.moveTo(-7,5),n.quadraticCurveTo(-5,10,0,5),n.quadraticCurveTo(5,10,7,5),n.stroke()}var rt=class t{position;size;right=!1;shootVelocity=50;timer;constructor(e,{size:i=new h(100,100),right:s=!1,cb:a}={}){this.position=e,this.size=i,this.right=s,mt.newOffscreenLayer("tube",1.5*i.x,i.y),t.drawTube(this.size.x,this.size.y)}intro(){new U(this.position,"x",{finalValue:this.right?mt.stage.clientWidth+50:-50,speed:2,epsilon:1,onComplete:()=>{this.timer=b.every(Vt,()=>{1===Ot.state&&Et.count<Dt&&(X(K.spawn),this.launch())})}})}outro(){new U(this.position,"x",{finalValue:this.right?mt.stage.clientWidth+200:-200,speed:2,epsilon:1,onComplete:()=>b.cancelTimer(this.timer)})}launch(){let{size:{x:t}}=this,i=Math.max(.1*t,20),a=e([v.coral,v.fuchsia,v.chartreuse,v.hotPink]),o=this.position.addX((this.right?-1:1)*(this.size.x+i)).addY(.5*this.size.y),n=o.addY(-30),l=o.addY(30).addX(20),r=Et.spawn(o,new h(this.right?-1:1,0).scale(this.shootVelocity),Bt,jt,a);Mt.list.forEach(t=>t.catch(r)),zt.list.forEach(t=>t.catch(r));for(let t=0;t<5;t++){let e=s(10,20,t/5);new O(h.random(n,l),{startRadius:e,finalRadius:e+10})}return r}update(){let{ctx:t}=mt;t.save(),t.translate(this.position.x,this.position.y),this.right&&t.transform(-1,0,0,1,0,0),t.drawImage(mt.getLayer("tube"),0,0),t.restore()}static drawTube(t,e){mt.setActiveLayer("tube");let{ctx:i}=mt,s=new Path2D,a=new Path2D,o=new Path2D,n=new Path2D,l=20,r=10,c=Math.max(.1*t,20);s.rect(0,r,t,e-20);let d=t+c,u=t;a.moveTo(d,0),a.lineTo(u,0),a.bezierCurveTo(t-l,-r,t-l,e+r,t,e),a.lineTo(t+c,e),a.closePath(),o.moveTo(d,0),o.bezierCurveTo(d-l,-r,d-l,e+r,d,e),o.bezierCurveTo(d+l,e+r,d+l,-r,d,0),n.ellipse(d+2,.5*e,8,.4*e,0,0,2*Math.PI);let[p,f]=[t,d].map(t=>{let i=new Path2D;return i.moveTo(t,0),i.bezierCurveTo(t-l,-r,t-l,e+r,t,e),i});i.fillStyle=y(new h(0,0),new h(0,e),{shineSize:.2}),i.fillRect,i.strokeStyle=v.tube1,i.fill(s),i.fillStyle=y(new h(0,-r),new h(0,e+r),{shinePos:.05}),i.fill(a),i.fillStyle=y(new h(0,-r),new h(0,e+r),{shineSize:0}),i.fill(o),i.fillStyle=y(new h(0,0),new h(0,e),{color1:v.black,color2:v.tube2,shineSize:0}),i.fill(n),i.lineWidth=3,[p,f].forEach(t=>{i.strokeStyle=i.fillStyle=y(new h(0,-30),new h(0,e+30),{color1:v.white.toAlpha(0),color2:v.white.toAlpha(0),shineSize:.55,shinePos:0,shineSmoothness:1}),i.stroke(t)})}},ht=class{static init(){Ot.tubes.push(new rt(new h(-200,100)),new rt(new h(mt.stage.clientWidth+200,100),{right:!0}))}static draw(){mt.setActiveLayer("bg");let{ctx:e,cw:i,ch:o}=mt,n=y(new h(0,0),new h(0,o),{color1:p(245,69,19),color2:p(245,67,38),shineSize:0});e.fillStyle=n,e.fillRect(0,0,i,o),e.fillStyle=y(new h(0,0),new h(0,o),{color1:v.white.toAlpha(.5),color2:v.white.toAlpha(0),shineSize:0});for(let t=0;t<100;t++){let t=s(0,i,Math.random()),a=s(0,o,Math.random());e.fillRect(t,a,2,2)}a(50,i-50,10,(t,i)=>{let a=s(0,.6*o,Math.random()),n=i%2==0;w(new h(t,a),{points:4,outerRadius:n?8:1,innerRadius:n?2:5,ctx:e,fill:n?v.brightYellow.toAlpha(.5):v.blue3.toAlpha(.5)}),e.closePath()}),e.fillStyle=y(new h(0,.5*o),new h(0,o),{color1:p(245,33,44),color2:p(245,41,42),shineSize:0}),e.moveTo(0,.5*o);let l=.9*o,r=Math.floor(i/70),c=[];a(0,i,r,t=>{let s=15*Math.floor(10*Math.random());c.push(s),e.lineTo(t,l),e.lineTo(t,l-s),e.lineTo(t+i/(r-1),l-s)}),e.lineTo(i,o),e.lineTo(0,o),e.fill();let d=p(245,21,51);e.fillStyle=d,a(0,i,r,(t,i)=>{let s=Math.floor(10*Math.random());s<5&&e.fillRect(t+10+10*s,l-c[i]+10+10*s,10,10)});{let t=p(245,30,51),s=p(245,30,45);e.lineWidth=3;let a=20,n=(a,n,l,r=!1)=>{e.fillStyle=s,e.beginPath();let h=(r?i:0)+(r?-1:1)*a,c=(r?i:0)+(r?-1:1)*(a+l);e.moveTo(h,n),e.lineTo(c,n+l),e.lineTo(c,o),e.lineTo(h,o),e.fill(),e.fillStyle=t,e.fillRect(r?i-a:0,n,a,o)};n(5*a,300,50),n(a,200,50),n(6*a,400,40,!0),n(a,200,60,!0),e.fillStyle=d;let l=(t,i,s,a,o=0)=>{e.beginPath(),e.moveTo(t,i),e.lineTo(t+s,i+o),e.lineTo(t+s,i+a+o),e.lineTo(t,i+a),e.fill()};l(0,260,10,80),l(0,480,10,80),l(45,260,20,80,20),l(25,580,20,80,10),l(110,380,20,60,15),l(120,560,20,60,10),l(0,260,10,80),l(0,480,10,80),l(i-150,520,20,50,-20),l(i-100,620,20,50,0),l(i-50,280,20,60,-20),l(i-70,540,20,60,-20),l(i-10,480,10,60,0)}{x(new h(80,590),{width:30,height:30,color1:v.blue1,color2:v.brightYellow.toAlpha(.7),content(){w(new h(15,15),{ctx:e,innerRadius:8,outerRadius:15,angle:55*t,fill:v.brightYellow.toAlpha(.7)})}}),x(new h(140,630),{width:70,height:30,color1:v.blue0,color2:v.brightYellow.toAlpha(.3),content(){Tt("dalps",{pos:new h(35,15),fontSize:18,fill:v.brightYellow.toAlpha(.3)})}});let s="トランポリン",a=36;e.font=`${a}px sans-serif`,e.textBaseline="ideographic",e.textAlign="left",x(new h(60,350),{width:a,height:a*s.length,content(){let t=new h(0,0);Array.from(s).forEach(i=>{t.incrY(a),e.strokeStyle=e.fillStyle=v.blue3,e.strokeText(i,t.x,t.y),e.fillText(i,t.x,t.y)})}}),a=24,e.font=`${a}px Consolas,sans-serif`,e.textAlign="left",x(new h(i-120,350),{right:!0,width:48,height:144,content(){let t=new h(4,0);Array.from("JS13K").forEach(i=>{t.incrY(a),e.strokeStyle=e.fillStyle=v.white.toAlpha(.3),e.strokeText(i,t.x,t.y),e.fillText(i,t.x,t.y)}),t=new h(30,0),Array.from("GAMES").forEach(i=>{t.incrY(a),e.strokeStyle=e.fillStyle=v.hotPink.toAlpha(.7),e.strokeText(i,t.x,t.y),e.fillText(i,t.x,t.y)}),Tt("2025",{pos:new h(24,132),fontSize:18,fill:v.blue3})}}),s="弹性猫";let o=80;e.font="24px sans-serif",e.textAlign="center",x(new h(i-o-80,550),{width:o,height:o,right:!0,content(){e.drawImage(mt.getLayer("catFace"),15,-15),e.fillStyle=v.blue3,e.fillText(s,40,80)}})}}},ct=class extends HTMLCanvasElement{constructor(t,e=480,i=480){super(),this.name=t,this.width=e,this.height=i,this.setSize(e,i)}_ctx;_rect;setSize(t,e){this.width=t,this.height=e}get ctx(){return this._ctx||(this._ctx=this.getContext("2d")),this._ctx}get rect(){return this._rect??(this._rect=this.getBoundingClientRect())}resolveMousePosition(t){return t.offsetX?new h(t.offsetX,t.offsetY):new h(t.layerX,t.layerY)}resolveTouchPosition(t){return new h(t.clientX-this.rect.x,t.clientY-this.rect.y)}};customElements.define("my-canvas",ct,{extends:"canvas"});var dt=class extends F{update(){}spawn(t,e,i,s=10,a){let o=new ut(t,e,i,s,a);return this.add(o),o}clearEntities(){this.list.forEach(t=>t.die()),super.clearEntities()}},ut=class t extends P{id;thread;threadLength=0;radius=10;color;constructor(t,e,i,s=10,a){super(t,{friction:.1,angularVelocity:.5}),this.name="YB",this.id=crypto.randomUUID(),this.mass=i,this.color=a,this.radius=s,this.attachCollider(new L(this.position,this.radius)),this.velocity=e.clone(),this.addForce(M);let o=[];for(let t=0;t<10;t++)o.push(this.position.clone());this.thread=o.map(t=>new P(t)),b.every(2,()=>{this.thread.push(new P(this.thread.at(-1).position.clone()))})}die(){z.unregisterBody(this),Et.delete(this)}update(){let{dt:t}=b;super.update(),this.threadLength+=.01*t,this.thread[0].position=this.position.add(new h(.5*this.radius,0)).rotateAbout(this.position,this.orientation);let e=this.thread[0];this.radius=Math.max(Ft,this.radius-.05*t),this.radius<=Ft&&z.unregisterBody(this),this.thread.forEach(i=>{(function(t,e,i,s){t.x=o(t.x,e.x,2,s),t.y=o(t.y,e.y,2,s)})(i.position,e.position,0,t),e=i}),this.draw()}draw(){mt.setActiveLayer("game");let{ctx:e}=mt;e.lineCap=e.lineJoin="round",e.beginPath(),e.lineWidth=4,e.strokeStyle=this.color.toString(),e.moveTo(this.position.x,this.position.y),this.thread.forEach((t,i)=>{i>=0&&e.lineTo(t.position.x,t.position.y)}),e.stroke(),e.save();let{x:i,y:s}=this.position;e.translate(i,s),e.rotate(this.orientation),t.drawTexture(new h(0,0),{radius:Math.max(10,this.radius),color:this.color,lineWidth:2}),e.restore()}static drawTexture(t,{radius:e=100,color:i=v.coral,lineWidth:s=7,rotation:a=0,decoration:o=!1}={}){let{ctx:n}=mt,l=new Path2D("M6.2,5.3C5.4,2.5-3.8,0.5-6.5,3.9M34.2,-14.2C20.5,-36.9-4.3,-41-25.9,-26.9M26.1,-6.4C19.8,-20.8-5.4,-27.6-21.1,-16.8M17.3,0C10.5,-9.4-4.6,-12.3-14.4,-6M45.8,8.7C44.1,15.3 30.8,22.3 17.5,23.7M46,-8.1C41.9,-0.5 24.8,13.6 5,15M41,-22.2C35.6,-15.3 18.5,5.5-3.3,7.3M-45.4,-11c3.7,18.6 21.5,45.1 55.2,56.6M-39.5,-24.9c8.9,27.5 29.2,51.4 64.5,64.3M-29.4,-36.2C-16.9,3.3 15.3,27.1 35.3,30.5"),r=new Path2D("M0,46C-35,47-75,46-50,29-36,19-100,32-64,12"),h=new Path2D,c=new Path2D,d=new Path2D,u=(new DOMMatrix).translate(t.x,t.y).rotate(0,0,a).scale(e/50,e/50);c.arc(0,0,47.5,0,2*Math.PI),h.addPath(c,u),h.addPath(l,u),o&&h.addPath(r,u),n.beginPath(),d.addPath(c,u),n.fillStyle=i.lighten(1.1),n.fill(d),n.lineWidth=s,n.strokeStyle=i,n.stroke(h)}};function vt(){mt.setActiveLayer("info"),mt.clearLayer();let{ctx:t,cw:e}=mt,i=new h(.5*e-82.5,20),s=new h(27.5,27.5);t.lineCap=t.lineJoin="round";let a=(e,a)=>{t.lineWidth=e,w(i.add(s),{points:4,innerRadius:0,outerRadius:18,ctx:t,stroke:a,angle:Math.PI/4})};for(let t=0;t<It-Ot.lives;t++)a(8,v.white),a(4,p(0,100,50)),i.incrX(55);for(let t=0;t<Ot.lives;t++)ut.drawTexture(i.add(s),{radius:20,color:v.fuchsia,lineWidth:2,decoration:!0}),i.incrX(55);Tt(`${Ot.stock} basket${1===Ot.stock?"":"s"}`,{pos:new h(.5*e,100),fontSize:18})}function pt(){mt.setActiveLayer("info");let{ctx:t,cw:e,ch:i}=mt;t.fillStyle=v.black.toAlpha(.5),t.fillRect(0,0,e,i),t.lineWidth=3;let s=56;Tt("game over",{pos:new h(.5*e,.5*i-s),fill:v.blue3,stroke:v.blue0,fontSize:s}),s=24,Tt(`you filled ${Ot.stock} basket${1===Ot.stock?"":"s"}`,{pos:new h(.5*e,.5*i),fontSize:s})}var ft,wt=document.getElementById("title"),yt=document.getElementById("gameover"),gt=["bg","game","info","ui"],mt=class t{static _layers=new Map;static stage;static _activeLayer;static setActiveLayer(t){this._activeLayer=this._layers.get(t)}static getLayer(t){return this._layers.get(t)}static clearLayer(e){let{ctx:i,width:s,height:a}=e?t.getLayer(e):t.activeLayer;i.clearRect(0,0,s,a)}static get activeLayer(){return this._activeLayer}static get cw(){return this.activeLayer.width}static get ch(){return this.activeLayer.height}static get ctx(){return this.activeLayer.ctx}static init(){this.stage=document.getElementById("stage"),_t.drawCrissCrossPattern(),ft=[["again",()=>Ot.restart(),v.coral],["bye",()=>Ot.title(),v.blue2],["go!",()=>Ot.restart(),v.blue2]].map(([t,e,i])=>{let s=document.getElementById(t),{x:a,y:o}=new h(200,48);return this.newOffscreenLayer(t,a,o),s.style.width=`${a}px`,s.style.height=`${o}px`,s.style.background=i,this.setActiveLayer(t),Tt(t,{pos:new h(.5*a,.5*o),fontSize:24}),s.appendChild(this.getLayer(t)),s.onclick=()=>{X(K.button),e()},s}),gt.forEach((t,e)=>{let i=new ct(t);i.id=t,i.style.zIndex=`${e}`,this._layers.set(t,i),this.stage.appendChild(i)});let{blue0:e,blue1:i,blue3:s}=v;t.newOffscreenLayer("catFace",50,100),t.setActiveLayer("catFace"),t.ctx.translate(25,50),lt({coatColor:i,detailColor:e,white:s,black:e,pink:s,drawPaws:!1}),this.fitLayersToStage(),window.addEventListener("resize",this.fitLayersToStage.bind(this))}static newOffscreenLayer(t,e,i){let s=new ct(t,e,i);this._layers.set(t,s)}static fitLayersToStage(){let[t,e]=[this.stage.clientWidth,this.stage.clientHeight];switch(gt.forEach(i=>{this.getLayer(i).setSize(t,e)}),e/t<.65?(ft[0].style.bottom=ft[1].style.bottom,ft[0].style.left=.5*t-220+"px",ft[1].style.left=.5*t+20+"px"):(ft[0].style.bottom="30%",ft[0].style.left=.5*t-100+"px",ft[1].style.left=.5*t-100+"px"),ht.draw(),Ot.state){case 0:break;case 1:Ot.tubes.forEach(t=>t.intro()),vt();break;case 2:pt()}}},xt={0:{path:"m31.5 70.8c-1.3-3.3-2.2-6.7-3.2-10.1l-2.3-11.4-1.0-14.5 1.4-16.7 4.8-18.1h35.9c1.7 2.8 2.7 5.9 3.9 9.0l2.6 10.8 1.3 14.7-1.3 16.7-4.8 19.7h-37.2m23.6-56.6h-10.2v42.5h10.2v-42.5",size:50},1:{path:"m46.2 71.2v-58.1h-10.3v-13.1h28.3v71.2h-18.0",size:28},2:{path:"m25.2 71.2v-14.2l29.7-44.4h-25.6v-12.6h29.4l7.4 5.0 3.1 5.8 1.3 7.7-5.5 17.3-8.0 10.2-12.4 11.1h30.1v14.2h-49.6",size:50},3:{path:"m42.1 69.3 11.6-29.7h-27.4v-12.5h19.6l5.9-14.5h-24.9v-12.6h27.8l8.4 4.9 4.9 12.0-3.7 10.8 6.2 5.4 3.1 10.5-3.9 13.6-14.1 17.0-13.6-5.0",size:47},4:{path:"m51.5 73.1v-13.7h-27.1l-0.1-13.9 5.2-14.8 2.9-7.6 2.8-7.2 6.5-15.9 16.8 6.8-2.4 7.0-2.4 6.3h15.6v25.2h6.5v14.2h-6.5v13.7h-17.7m0.0-48.3-4.9 9.2-4.1 6.4-2.9 3.6-1.0 1.2h12.9v-20.4",size:51},5:{path:"m42.5 68.2 11.0-31.0h-27.4v-37.2h42.5v13.1h-24.5v11.6h18.3l7.1 4.5 3.1 5.5 1.3 7.4-3.8 13.8-13.9 16.9-13.6-4.6",size:48},6:{path:"m32.1 71.3-4.2-8.7-2.1-11.9-0.6-5.8-0.3-4.8-0.1-4.5 2.3-16.4 5.4-11.1 6.0-6.2 4.2-1.9h25.3v14.3h-24.7v12.8h23.7l1.4 1.5 2.9 4.3 2.9 7.0 1.2 9.3-1.4 10.3-5.2 11.8h-36.6m25.8-30.0h-14.6v15.8h14.6v-15.8",size:51},7:{path:"m34.3 66.7 18.6-54.1h-27.0v-12.6h47.7l0.2 1.3 0.2 4.0-0.8 9.1-3.3 14.0-7.2 18.8-5.6 11.3-7.1 12.6-15.8-4.5",size:48},8:{path:"m31.5 71.2c-1.2-1.7-2.1-3.5-3.2-5.3l-2.2-6.4-1.0-8.5 0.6-7.1 2.3-8.1-2.1-12.3 1.4-10.8 5.1-12.7h34.8c1.4 1.8 2.6 3.7 3.7 5.7l2.5 6.8 1.2 9.0-2.5 13.6 1.9 6.0 0.8 7.8-1.3 10.3-4.8 11.9h-37.1m25.9-56.9h-14.9v14.4h14.9v-14.4m0.0 28.5h-14.9v14.2h14.9v-14.2",size:50},9:{path:"m27.7 71.3v-14.2h29.4v-12.8h-25.9l-5.2-8.4-1.5-9.7 1.0-9.6 2.2-8.4 2.2-6.0 1.0-2.2h33.8l6.3 8.7 3.3 11.9 0.8 5.8 0.6 8.1c0.1 1.8-0.1 3.6-0.2 5.4l-0.6 4.4-1.0 5.5-4.2 11.8-8.1 9.7h-33.9m29.4-57.0h-16.1v15.8h16.1v-15.8",size:51},"!":{path:"m41.9 45.6v-45.6h16.2v45.6h-16.2zm0.0 25.6v-16.0h16.2v16.0h-16.2z",size:16},A:{path:"m75.7 72.7-1.2-1.3-3.4-3.7-4.7-5.9-5.6-7.9h-30.0l-7.3 17.9-13.4-5.0 27.1-66.8h22.5l30.0 65.5-14.0 7.2m-23.0-33.1-4.3-10.0-3.4-10.8-8.4 20.8h16.1",size:80},B:{path:"m23.9 71.2v-71.2h30.2l6.5 0.9 6.4 3.1 4.8 6.0 1.9 9.5-4.6 14.0 4.9 6.1 2.0 9.3-1.5 9.6-3.6 7.1-8.2 5.7h-38.8m30.6-56.8h-12.6v14.2h12.6v-14.2m0.4 28.4h-13.0v14.1h13.0v-14.1",size:52},C:{path:"m48.6 71.2-6.6-1.6-7.5-5.5-6.2-10.9-2.6-17.5 2.6-17.4 6.2-11.0 7.5-5.6 6.6-1.6h25.8v14.3h-24.3v42.7h24.3v14.2h-25.8",size:49},D:{path:"m20.0 71.3v-71.3h39.7l4.7 1.9 6.8 6.3 6.1 11.6 2.6 17.8c-0.1 4.4-1.0 8.6-1.9 12.9l-4.6 11.1-9.0 9.6h-44.4m37.2-57.0h-19.1v42.7h19.1v-42.7",size:60},E:{path:"m23.8 71.2v-71.2h52.3v14.3h-33.3v12.3h31.0v14.2h-31.0v16.2h33.3v14.2h-52.3",size:52},F:{path:"m42.8 40.8v30.4h-19.0v-71.2h52.3v14.3h-33.3v12.3h31.0v14.2h-31.0",size:52},G:{path:"m35.8 71.2-4.2-2.5-6.4-7.0-5.9-11.2-2.6-14.9 2.9-17.4 6.7-11.0 7.8-5.6 6.1-1.6h37.0v14.3h-35.5v42.7h21.3v-21.4h19.5c0.5 2.1 0.5 4.2 0.6 6.3l-0.3 5.6-1.4 7.0-2.9 8.0-4.8 8.7h-37.9",size:66},I:{path:"m40.5 71.2v-71.2h19.0v71.2h-19.0",size:19},J:{path:"m40.5 71.2v-71.2h19.0v38.8l-0.9 12.3-1.9 10.3-1.9 7.1-0.9 2.6h-13.3",size:19},K:{path:"m66.7 74.8-1.8-1.8-4.1-5.2-5.0-9.0-4.2-12.8h-12.4l-1.1 10.8-1.9 8.6c-0.8 2.6-1.6 5.1-2.6 7.6h-13.2v-71.2h19.0v31.7h0.3l21.4-33.5 16.2 10.6-9.6 13.2-8.8 9.7h7.4l13.3 35.2-12.9 6.1",size:59},L:{path:"m23.7 71.2v-71.2h18.0v55.6l7.6-1.6 8.1-1.4 16.8-1.3 2.0 0.1v19.8h-52.6",size:53},M:{path:"m69.0 71.2v-27.5l-4.5 8.4-3.9 6.5-3.8 5.6h-13.4c-1.2-1.8-1.6-2.2-3.9-5.7l-4.0-6.6-4.5-8.4v27.7h-18.0v-71.2h18.0l19.1 48.2 19.0-48.2h18.0v71.2h-18.0",size:74},N:{path:"m63.8 71.2c-3.1-3.0-6.0-6.1-9.0-9.3l-4.2-4.8-4.6-5.6-9.7-13.1v32.8h-18.1v-71.2h18.1l27.5 44.8v-44.8h18.1v71.2h-18.1",size:64},O:{path:"m41.1 71.2-7.4-1.6-9.1-5.5-7.7-10.9-3.3-17.5 3.3-17.4 7.7-11.0 9.1-5.6 7.4-1.6h17.8l7.4 1.6 9.1 5.6 7.7 11.0 3.2 17.4-3.2 17.5-7.7 10.9-9.1 5.5-7.4 1.6h-17.8m20.9-56.9h-24.1v42.7h24.1v-42.7",size:73},P:{path:"m40.7 41.8-1.0 11.7-1.9 9.3-1.9 6.1-0.9 2.3h-13.2v-71.2h42.6l2.9 1.3 4.7 3.8 4.5 6.2 1.9 8.4-2.5 10.1-8.7 11.9h-26.4m15.6-27.5h-15.6v13.2h15.6v-13.2",size:57},R:{path:"m65.4 73.2-0.6-0.4-1.5-1.4-5.2-5.5-6.3-9.7-5.3-14.4h-5.1l-1.0 11.7-1.9 9.3-1.9 6.1-0.9 2.3h-13.2v-71.2h40.0l2.8 1.3 4.7 3.8 4.5 6.2 1.9 8.4-2.4 9.9-8.6 11.7 12.2 24.6-12.2 7.2m-11.0-58.9h-13.0v13.2h13.0v-13.2",size:55},S:{path:"m27.4 71.2v-14.2h26.5l-14.5-13.2-11.0-12.9-3.3-11.2 6.7-14.3 13.2-5.4h28.4v14.3h-29.0l9.4 8.5 8.3 8.0 7.7 8.2 5.0 14.2-1.8 9.2-6.0 8.7h-39.7",size:50},T:{path:"m40.9 71.2v-56.9h-17.0v-14.3h52.3v14.3h-17.2v56.9h-18.1",size:52},U:{path:"m60.4 0.0h18.1v47.0l-0.1 1.0-0.3 3.3c-0.6 3.1-1.9 5.9-3.2 8.8l-8.5 8.3-16.4 3.7-16.4-3.5-8.4-8.1-3.2-8.7-0.3-3.5-0.1-1.2v-47.2h18.1v58.1h20.8v-58.1",size:57},V:{path:"m21.5 71.2v-71.2h18.0v56.7h20.9v-56.7h18.0v44.9l-1.3 5.6-4.6 8.9-9.6 8.3-15.8 3.6z",size:57},Y:{path:"m40.5 71.2v-29.7l-11.3-5.3-6.1-7.5-2.5-7.4-0.4-2.9-0.1-1.0v-17.4h19.0v28.2h21.9v-28.2h19.0v16.6l-0.3 2.7-0.3 1.4-2.5 7.4-6.1 7.8-11.3 5.6v29.7h-19.1",size:60}," ":{size:20}};xt.A.kernings={Y:2,G:5,T:2,V:8,K:8,B:8},xt.Y.kernings={A:2},xt.O.kernings={P:5};var bt=70,kt=12,St=100;function Tt(t,{pos:e=new h(0,0),fontSize:i=16,fill:s=v.white,stroke:a}={}){let{ctx:o}=mt,n=i/St,{path:l,length:r}=Pt(t);o.save(),o.translate(e.x-.5*r*n,e.y-.5*bt*n),o.scale(n,n),s&&(o.fillStyle=s,o.fill(l)),a&&(o.strokeStyle=a,o.stroke(l)),o.restore()}function Pt(t){let e,i=0,s=new Path2D,a=new DOMMatrix;return Array.from(t).forEach(t=>{let o=t.toUpperCase();if(!xt[o])throw new Error(`${o} is not available as a glyph.`);let{size:n=0,path:l="",kernings:r={}}=xt[o],h=.5*(St-n),c=new Path2D(l);if(c.closePath(),e){let t=r[e]??kt;a.translateSelf(t,0,0),i+=t}a.translateSelf(-h,0,0),s.addPath(c,a),a.translateSelf(n,0,0),a.translateSelf(h,0,0),i+=n,e=o}),{path:s,length:i}}var Mt,zt,Et,Ct=class extends O{constructor(t,e,{fontSize:i=24,...s}={}){super(t,s),this.center=t,this.text=e,this.fontSize=i}fontSize;draw(){mt.setActiveLayer("game"),Tt(this.text,{fontSize:this.fontSize,pos:this.center.addY(-this.radius),fill:this.color.setAlpha(this.alpha)})}},Lt=class extends F{outro(){this.list.forEach(t=>t.outro())}spawn(){let t=a(100,mt.cw-100,4),i=e(a(280,mt.ch-100,4).filter(t=>!this.list.find(e=>e.position.y===t))),s=e(t),o=Math.floor(1+5*Math.random()),n=new _t(new h(s,i),o);return n.drawTexture(),this.add(n),Et.list.forEach(t=>n.catch(t)),n}update(){1===Ot.state&&this.count<Rt&&this.spawn(),this.list.forEach(t=>t.update())}},_t=class extends P{constructor(t,e=5){let i=t.x<=.5*mt.cw?-300:mt.cw+300;super(new h(i,t.y)),this.wanted=e,this.name="BK",this.id=crypto.randomUUID(),this.toggleX(),this.toggleY(),this.attachCollider(new _(t,Ut)),mt.newOffscreenLayer(this.id,200,200),new U(this.position,"x",{finalValue:t.x,epsilon:1})}id;filledFlag=!1;content=[];get filled(){return this.content.length>=this.wanted}outro(){new U(this.position,"y",{startValue:this.position.y,finalValue:-200,speed:1,epsilon:1,onComplete:()=>zt.delete(this)})}catch(t){z.register(this,t,{sensor:!0,filter:A,cb:()=>{1===Ot.state&&(new $(t.position,{startRadius:5,finalRadius:50,points:3,speed:4,color:t.color,color2:v.white}),t.die(),this.addYarnball(t),vt(),X(K.score))}})}addYarnball(t){this.content.push(t),this.drawTexture()}update(){let{time:e,dt:i}=b,{cw:s,ch:a}=mt,o=this.collider,n=-1*Math.cos(.05*e)*t*i;o.dir+=n,o.center.rotate(n),!this.filledFlag&&this.filled&&(this.filledFlag=!0,Ot.stock+=1,z.unregisterBody(this),X(K.filled),X(K.score2),new $(this.position,{startRadius:5,finalRadius:100,speed:3,finalTransparency:1,color:v.brightYellow,color2:v.brightYellow}),new Ct(this.position,"nice!",{startRadius:0,finalRadius:50,finalTransparency:1}),this.outro(),vt()),mt.setActiveLayer("game");let{ctx:l}=mt;l.save(),l.translate(this.position.x,this.position.y),l.rotate(o.dir),l.drawImage(mt.getLayer(this.id),-100,-90),l.restore()}static drawCrissCrossPattern(){mt.newOffscreenLayer("pattern",16,16),mt.setActiveLayer("pattern");let{ctx:t,cw:e,ch:i}=mt;t.fillStyle=v.basket1,t.fillRect(0,0,e,i),t.strokeStyle=v.basket2,t.lineWidth=2,t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.moveTo(e,0),t.lineTo(0,i),t.stroke()}drawTexture(){mt.setActiveLayer(this.id);let{ctx:t}=mt;t.save(),t.translate(100,100),t.lineWidth=2;let e=new Path2D("m-69,-12.5c-37.6,75.2 175.6,75.2 137.9,0 0,16.5-137.9,16.3-137.9,0z"),i=new Path2D("m0,0c-38.2,0-69,-5.7-69,-12.5-0,-6.9 30.7,-12.5 68.7,-12.5 38.3,-0 69.3,5.6 69.3,12.5C69,-5.7 38.2,0 0,0Z"),s=new Path2D("m-69,-12.5c-0,16.4 137.9,16.4 137.9,0"),o=new Path2D("M21.9-0.9C21.9-0.9 25.1-50.2 0-50.2C-25.1-50.2-21.9-25.1-21.9-25.1L-28.2-25.1C-28.2-25.1-31.3-56.4 0-56.4C31.3-56.4 28.2-0.9 28.2-0.9Z"),n=t.createPattern(mt.getLayer("pattern"),"repeat");t.lineWidth=5,t.strokeStyle=v.basket2,t.fillStyle=n,t.stroke(i),t.fill(i),t.fillStyle=v.black.toAlpha(.7),t.fill(i),this.filled&&(g(new h(45,0),new h(60,-50),v.gray),g(new h(40,0),new h(45,-60),v.gray));let l=a(-40,40,this.wanted);this.content.forEach((t,e)=>ut.drawTexture(new h(l[e],e%2==0?-10:-5),{color:t.color,radius:t.radius,lineWidth:2})),t.fillStyle=n,t.fill(e),t.lineWidth=2,t.strokeStyle=v.basket2,t.stroke(e),t.lineWidth=5,t.stroke(s),t.lineWidth=2,t.fillStyle=n,t.fill(o),t.stroke(o);let r=Math.max(0,this.wanted-this.content.length),c=new h(0,20);r>0?Tt(`${r}`,{pos:c,fontSize:36}):w(c),t.restore()}},At=class{static vignette=0;static trampoPos=new h(-1e3,300);static felinesPos=new h(1e3,300);static skew;static init(){}static intro(){let{ctx:t,cw:e,ch:i}=mt;new $(new h(.3*e,.5*i),{startRadius:5,finalRadius:100,speed:1}),new $(new h(.5*e,.3*i),{startRadius:5,finalRadius:100,speed:1}),new $(new h(.7*e,.4*i),{startRadius:5,finalRadius:100,speed:1}),new U(this,"vignette",{finalValue:.5,speed:.7}),new U(this.trampoPos,"x",{finalValue:.5*e,epsilon:1}),new U(this.felinesPos,"x",{finalValue:.5*e,epsilon:1}),new U(this,"skew",{startValue:50,finalValue:-.2})}static outro(){let{ctx:t,cw:e,ch:i}=mt;new U(this,"vignette",{finalValue:0}),new U(this.trampoPos,"x",{finalValue:2*e,epsilon:1}),new U(this.felinesPos,"x",{finalValue:2*-e,epsilon:1})}static draw(){mt.setActiveLayer("game");let{ctx:t,cw:e,ch:a}=mt,{time:o}=b,{white:n,blue0:l,blue1:r,blue2:h,blue3:c}=v;t.fillStyle=v.black.toAlpha(this.vignette),t.fillRect(0,0,e,a),t.fillStyle=v.white,t.strokeStyle=v.blue2,t.lineWidth=2;let d=s(.5,1,i(0,1,e/a));[["trampo",this.trampoPos,-40],["felines!",this.felinesPos,50]].forEach(([e,i,s],a)=>{let o=new Path2D,{path:n,length:l}=Pt(e);o.addPath(n,new DOMMatrix([d,this.skew,this.skew,d,i.x-l*d*.5,i.y+s*d])),t.fill(o),t.stroke(o)})}},It=3,Rt=3,Dt=3,Wt=3,Vt=20,Yt=100,jt=20,Ft=3,Bt=3,Ut=120,Ot=class t{static state=0;static tubes=[];static lives=It;static stock=0;static settings={};static init(){Mt=new ot,zt=new Lt,Et=new dt}static update(){switch(mt.setActiveLayer("game"),mt.clearLayer(),this.state){case 0:At.draw();case 2:case 1:let{cw:e,ch:s}=mt;z.update(),t.tubes.forEach(t=>{t.update()}),zt.update(),Mt.update(),Et.list.forEach(a=>{a.thread.at(-1).position.y>s&&1===t.state&&(X(K.drop),a.die(),t.lives=Math.max(0,t.lives-1),vt(),t.lives<=0&&t.gameOver(),new Ct(new h(i(70,e-70,a.position.x),s),"missed "+(It-t.lives),{startRadius:0,finalRadius:50,finalTransparency:1}));let o=.5*a.radius;(a.position.x-o<0||a.position.x+o>e)&&(a.velocity.x*=-1.1),a.update()})}}static gameOver(){switch(this.state){case 0:case 1:pt(),X(K.gameover),yt.style.display="block",wt.style.display="none",Mt.disableUI(),this.state=2}}static restart(){switch(this.state){case 0:case 2:this.lives=It,this.stock=0,Et.clearEntities(),Mt.clearEntities(),zt.outro(),this.tubes.forEach(t=>t.intro()),Mt.enableUI(),yt.style.display="none",wt.style.display="none",At.outro(),ht.draw(),vt(),this.state=1}}static title(){switch(this.state){case 2:case 0:this.lives=It,Et.clearEntities(),Mt.clearEntities(),Mt.disableUI(),zt.outro(),this.tubes.forEach(t=>t.outro()),yt.style.display="none",wt.style.display="block",mt.clearLayer("info"),ht.draw(),At.intro(),At.draw(),this.state=0}}};mt.init(),Ot.init(),ht.draw(),ht.init(),Ot.title(),requestAnimationFrame(function t(e){b.update(.01*e),Ot.update(),B.update(),requestAnimationFrame(t)})</script>