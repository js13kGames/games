<!doctype html><title>Blob Rising - js13kGames 2012</title><style>body{background-color:#262625;font-family:Tahoma;font-size:13px;width:1024px;margin:10px auto;color:#fff}p{margin:10px 0}#content{width:100%;text-align:center}.title{color:#fc0;font-size:15px;font-weight:700}#canvas{background-color:#000;background-image:url('bgPattern.gif');background-repeat:repeat;display:inline;border:2px solid #18f9ff;min-height:400px;min-width:600px}.keyboard{display:inline;color:#18f9ff;font-size:20px}#score{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;position:absolute;background-color:#262625;border:3px dashed #18f9ff;padding:10px;margin:15px;z-index:1}.count{color:#18f9ff;font-weight:700;font-size:15px}.mainMenu{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;width:965px;position:absolute;background-color:#262625;border:1px dashed #18f9ff;padding:10px 10px;font-weight:700;font-size:15px;margin:30px 20px}.menuInGame{padding:30px 0 5px}.helpInGame{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;right:20px;text-align:right;cursor:default;position:absolute;top:20px;position:absolute;background-color:#262625;border:1px dashed #18f9ff;padding:10px;font-weight:700;font-size:15px}#startBlob{position:absolute;cursor:default;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-weight:700;font-size:30px;color:red;display:none;border:3px dotted red;width:60px;height:60px;text-align:center;background-color:#fff;opacity:.8;border-radius:30px}.blob{background:url('blobSprite.gif') no-repeat;background-position:0 0;width:20px;height:20px;border:0}.menuEntitiesNb{position:absolute;cursor:default;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-size:15px;color:#fff;display:inline;text-align:right;bottom:20px;right:20px;background-color:#262625;border:1px dashed #18f9ff;padding:10px}#endOfGame{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;width:965px;position:absolute;background-color:#262625;border:1px dashed #18f9ff;padding:10px 10px;font-weight:700;font-size:15px;margin:30px 20px}#nextLevel,#replayGame,#replayLevel,#tweetScore{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;width:117px;background-color:#262625;border:3px dashed #18f9ff;padding:10px;margin:15px;z-index:1}#nextLevel,#replayGame{color:#fc0}#tweetScore a{color:#18f9ff}</style><div id=content><div id=score><span class=title>Blob Rising </span>- Score : <span class=count>0</span></div><div id=mainMenu class=mainMenu><div class=keyboard>Press space to start/resume game</div><div class=menuInGame>------------------------------ Goal ------------------------------</div><p>Blobs <img src="" class=blob> are coming from your main source <img src=source.gif width=20px height=20px> . Your goal is to carry them to the final well <img src=wellFinal.gif width=20px height=20px> .<p>To achieve this goal, you can use rotate <img src=rotate.gif width=20px height=20px> and magnet <img src=magnet.gif width=20px height=20px> machine at your disposal.<p>Beware, on your path there are traps, like wall <img src=wall.gif width=20px height=20px> or fake well <img src=well.gif width=20px height=20px> .<div class=menuInGame>------------------------------ Gameplay ------------------------------</div><p><div class=keyboard>Space</div>: Pause/Resume game<p><div class=keyboard>L</div>: Restart the level ---<div class=keyboard>R</div>: Restart the game<p><div class=keyboard>C</div>: Add a magnet machine <img src=magnet.gif width=20px height=20px> with radius which attract blob to itself. Use them to provide some direction to your blob.<p><div class=keyboard>X</div>: Add a rotate machine <img src=rotate.gif width=20px height=20px> . When blob is near its radius, it will rotate around. Use them to avoid traps.<p><div class=keyboard>S</div>: Show/Hide none entities, for save cpu perf hide none entities (entities who does nothing on game) !<div class=menuInGame>------------------------------ Score ------------------------------</div><p>The less machine you use, the more you will score. Same if you win on minimum tries.</div><div id=startBlob></div><div id=menuEntitiesNb class=menuEntitiesNb><img src=rotate.gif width=20px height=20px> :<div id=nbMenuRotate style=display:inline></div>(X)<br><img src=magnet.gif width=20px height=20px> :<div id=nbMenuMagnet style=display:inline></div>(C)</div><div id=endOfGame></div><canvas id=canvas>Your browser doesn't support canvas element !</canvas></div><script>(function(){this.app=this.app||{}}).apply(window);var t,e,i={precision:.001,Vector:function(){},Matrix:function(){}},s=(i.Matrix.create=function(t){return(new i.Matrix).setElements(t)},i.Matrix.create,i.Matrix.Rotation=function(t,e){var s,a,n,h,r;return e?3!==(e=e.dup()).elements.length?null:(s=e.modulus(),a=e.elements[0]/s,n=e.elements[1]/s,e=e.elements[2]/s,s=Math.sin(t),h=Math.cos(t),i.Matrix.create([[(r=1-h)*a*a+h,r*a*n-s*e,r*a*e+s*n],[r*a*n+s*e,r*n*n+h,r*n*e-s*a],[r*a*e-s*n,r*n*e+s*a,r*e*e+h]])):i.Matrix.create([[Math.cos(t),-Math.sin(t)],[Math.sin(t),Math.cos(t)]])},i.Matrix.prototype={dup:function(){return i.Matrix.create(this.elements)},setElements:function(t){var e,i=t.elements||t;if(i[0]&&void 0!==i[0][0])for(t=i.length,this.elements=[];t--;)for(e=i[t].length,this.elements[t]=[];e--;)this.elements[t][e]=i[t][e];else for(e=i.length,this.elements=[],t=0;t<e;t++)this.elements.push([i[t]]);return this}},i.Vector.create=function(t){return(new i.Vector).setElements(t)},i.Vector.create);function a(){a.parent.constructor.apply(this,arguments)}i.Vector.prototype={forEach:function(t,e){for(var i=this.elements.length,s=0;s<i;s++)t.call(e,this.elements[s],s+1)},angleFrom:function(t){var e,i,s,a=t.elements||t;return this.elements.length!==a.length||(s=i=e=0,this.each(function(t,n){e+=t*a[n-1],i+=t*t,s+=a[n-1]*a[n-1]}),i=Math.sqrt(i),s=Math.sqrt(s),0==i*s)?null:(1<(t=(t=e/(i*s))<-1?-1:t)&&(t=1),Math.acos(t))},rotate:function(t,e){var s,a,n,h,r=null;switch(t.determinant&&(r=t.elements),this.elements.length){case 2:return 2!==(h=e.elements||e).length?null:(r=r||i.Matrix.Rotation(t).elements,a=this.elements[0]-h[0],n=this.elements[1]-h[1],i.Vector.create([h[0]+r[0][0]*a+r[0][1]*n,h[1]+r[1][0]*a+r[1][1]*n]));case 3:return e.direction?(s=e.pointClosestTo(this).elements,r=r||i.Matrix.Rotation(t,e.direction).elements,a=this.elements[0]-s[0],n=this.elements[1]-s[1],h=this.elements[2]-s[2],i.Vector.create([s[0]+r[0][0]*a+r[0][1]*n+r[0][2]*h,s[1]+r[1][0]*a+r[1][1]*n+r[1][2]*h,s[2]+r[2][0]*a+r[2][1]*n+r[2][2]*h])):null;default:return null}},setElements:function(t){return this.elements=(t.elements||t).slice(),this}},i.Vector.prototype.x=i.Vector.prototype.multiply,i.Vector.prototype.each=i.Vector.prototype.forEach,app.js={},app.js.isDefined=function(t){return null!=t},e={}.hasOwnProperty,app.js.inherit=function(t,i){function s(){this.constructor=t}for(var a in i)e.call(i,a)&&(t[a]=i[a]);return s.prototype=i.prototype,t.prototype=new s,t.parent=i.prototype,t},app.js.stringToClass=function(t){t=t.split(".");for(var e=window||this,i=0,s=t.length;i<s;i++)e=e[t[i]];if("function"!=typeof e)throw Error("function not found");return e},app.js.deserialize=function(t,e){var i,s={};for(i in app.js.isDefined(t)&&app.js.isDefined(t.className)?s=new(app.js.stringToClass("app.entities."+t.className)):app.js.isDefined(e)&&(s=e),t)if(t[i]instanceof Array)for(var a in app.js.isDefined(s[i])||(s[i]=[]),t[i])s[i].push(app.js.deserialize(t[i][a]));else s[i]="object"==typeof t[i]?app.js.deserialize(t[i],s[i]):t[i];return s},app.js.clone=function(t){return app.js.deserialize(t)},app.js.arrayRemove=function(t,e){if(app.js.isDefined(t)&&app.js.isDefined(e))return-1!=(e=t.indexOf(e))&&t.splice(e,1),-1!=e},app.shapes=app.shapes||{},n=app.shapes,v.prototype.drawImage=function(t,e){var i,s=new Image;app.js.isDefined(this.urlSprite)?(s.src=this.urlSprite,(i=0)<(e=180*e.radian/Math.PI)&&e<=45?i=132:45<e&&e<=90?i=154:90<e&&e<=135?i=0:135<e&&e<=180?i=22:e<=-135&&-180<e?i=44:e<=-90&&-135<e?i=66:e<=-45&&-90<e?i=88:e<=0&&-45<e&&(i=110),t.drawImage(s,0,i,20,20,this.x,this.y,this.width,this.height)):(s.src=this.urlImage,t.drawImage(s,this.x,this.y,this.width,this.height))},n.Shape=v;var n=app.js.inherit,h=app.shapes;function r(t,e,i,s,a,n){r.parent.constructor.apply(this,arguments)}function o(t,e,i){o.parent.constructor.apply(this,arguments),this.nbBlob=50,this.maxAge=1e3,this.physic=new app.physics.Physic(this,2,i),this.shape=new app.shapes.Rectangle(0,0,t,e,"#00FF00",null,null,"blobSprite.gif"),this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0)),this.firstAttract=!0}function l(t){this.game=t,this.isFirstAddWell=!0,this.scoreDiv=document.getElementById("score"),this.helpDiv=document.getElementById("mainMenu"),this.endOfGameDiv=document.getElementById("endOfGame"),this.startBlobDiv=document.getElementById("startBlob"),this.endOfGameDiv.style.display="none",this.firstInnerHTML=this.helpDiv.innerHTML,this.firstDisplay=this.helpDiv.style.display;var e=this;this.game.canvas.addEventListener("mousemove",function(t){app.Menu.prototype.onCanvasMove.call(e,t)},!1),this.game.canvas.addEventListener("mousedown",function(t){app.Menu.prototype.onCanvasClick.call(e,t)},!1),document.onkeypress=function(i){(i="number"==typeof(i=i||window.event).which?i.which:i.keyCode)&&(32==i?t.isRun&&!t.currentMap.isFinish()?(t.pause(),e.showHelp()):t.currentMap.isFinish()||(t.start(),e.showMapName()):114==i?(t.pause(),e.showHelp(),t.restart(),t.init()):38==i?(t.currentIndexMap++,t.init()):108==i?(t.clear(),t.init(),t.start(),e.showMapName(),e.showHelp("This level has been restarted","1000")):t.isRun&&(115==i?(t.currentMap.showNoneEntities=!t.currentMap.showNoneEntities,t.currentMap.showNoneEntities||(t.currentMap.noneEntities=[]),t.currentMap.staticBuffering=!1,t.clear(),t.currentMap.draw(t.context,!1)):120!=i&&99!=i||(!0===e.isFirstAddWell&&(e.isFirstAddWell=!1,e.showHelp("Move your mouse and then click to add well !","mousedown")),120==i?0<e.nbRotate?e.addEntity(t,app.js.clone(t.currentMap.menuRotate)):e.showHelp("You have no more rotate machine !","1000"):0<e.nbMagnet?e.addEntity(t,app.js.clone(t.currentMap.menuMagnet)):e.showHelp("You have no more magnet machine !","1000"))))}}function p(t,e){this.endOfGameDiv=document.getElementById("endOfGame"),this.listSerializedMap=t,this.canvas=e,this.context=e.getContext("2d"),this.restart()}function c(){this.showNoneEntities=!0,this.menuRotate={},this.menuMagnet={},this.staticEntities=[],this.blobEntities=[],this.noneEntities=[],this.menuEntities=[],this.startSource=new app.entities.Source,this.endWell=new app.entities.Well,this.endWell.last=!0,this.endWell.shape.color="#80FF02",this.endWell.shape.urlImage="wellFinal.gif",this.staticEntities.push(this.startSource),this.staticEntities.push(this.endWell),this.nbBlobDead=0,this.staticBuffering=!1,this.deadlyEntities=[],this.attractiveEntities=[],this.orbitalEntities=[]}function d(){d.parent.constructor.apply(this),this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","rotate.gif"),this.orbit=new app.shapes.Ellipse,this.orbit.color="rgba(0,0,0,1)",this.attracted=0,this.className="Rotate"}function u(){u.parent.constructor.apply(this),this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","magnet.gif"),this.factorAttraction=3}function m(){m.parent.constructor.apply(this),this.className="Well",this.nbBlobMax=5,this.nbBlob=0,this.last=!1,this.shape=new app.shapes.Rectangle(0,0,50,52,"#FF0000","well.gif"),this.attraction=new app.shapes.Ellipse,this.attraction.color="rgba(1,2,3,1)",this.attracted=0,this.factorAttraction=2}function y(){y.parent.constructor.apply(this),this.className="Wall",this.shape=new app.shapes.Rectangle(0,0,50,50,"#A0CD6C",null,"wall.gif")}function g(){g.parent.constructor.apply(this),this.nbBlob=1,this.maxAge=this.lostTime=100,this.degreeBlob=120,this.firstAgeForLostBlob=300,this.shape=new app.shapes.Rectangle(0,0,50,35,"#00FFFF","source.gif"),this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0))}function f(t,e){f.parent.constructor.apply(this),this.maxAge=100,this.shape=new app.shapes.Rectangle(0,0,t,e,"#FF0000",null,null,"blobSprite.gif"),this.initialWidth=t,this.initialHeight=e}function w(){this.age=0,this.imAlive=!0,this.shape=new app.shapes.Rectangle,this.draggable=!1}function b(t,e,i){this.entity=t,this.speed=e,this.radian=Math.PI*i/180,t=Number(Math.cos(this.radian).toFixed(2)),e=Number(Math.sin(this.radian).toFixed(2)),this.angle=s([t,e])}function v(t,e,i,s,a,n,h,r){this.x=t,this.y=e,this.width=i,this.height=s,this.color=a,this.urlImage=n,this.urlPattern=h,this.urlSprite=r}n(a,app.shapes.Shape),a.prototype.draw=function(t,e){t.save(),app.js.isDefined(this.urlImage)||app.js.isDefined(this.urlSprite)?a.parent.drawImage.call(this,t,e):app.js.isDefined(this.urlPattern)&&((e=new Image).src=this.urlPattern,e=t.createPattern(e,"repeat"),t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle=e,t.fillRect(this.x,this.y,this.width,this.height),t.strokeStyle="#626163",t.strokeRect(this.x,this.y,this.width,this.height)),t.restore()},h.Rectangle=a,(n=app.js.inherit)(r,(h=app.shapes).Shape),r.prototype.draw=function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.width/2,0,2*Math.PI,!1),t.closePath(),app.js.isDefined(this.urlImage)&&r.parent.drawImage.call(this,t),t.strokeStyle=this.color,t.stroke(),t.restore()},r.prototype.getRadius=function(){return this.width/2},h.Ellipse=r,app.physics={},t=app.js.isDefined,n=app.physics,b.prototype.update=function(t,e,i){var s=this.entity.shape.x,a=this.entity.shape.y,n=this.entity.shape.height,h=this.entity.shape.width,r=a+this.speed*this.angle.elements[1],o=Number((s+this.speed*this.angle.elements[0]).toFixed(2));r=Number(r.toFixed(2)),this.setCoordinate(o,r),(a<=0||s<=0||a<=0||i-n<=a||e-h<=s)&&this.entity.dead(t)},b.prototype.setCoordinate=function(t,e){this.entity.shape.x=t,this.entity.shape.y=e},b.prototype.attractTo=function(t){this.angle=this.calculAngle(this.entity.shape,t)},b.prototype.calculAngle=function(t,e){return e=Math.atan2(e.y-t.y,e.x-t.x)/(Math.PI/180),this.radian=Math.PI*e/180,e=Math.cos(this.radian),t=Math.sin(this.radian),s([e,t])},b.prototype.rotateAround=function(t){var e=this.entity.shape.x,i=this.entity.shape.y,a=s([t.x,t.y]),n=(relativX=t.x-e,relativY=t.y-i,this.radian=s([relativX,relativY]).angleFrom(a),t=Number(Math.cos(this.radian+Math.PI/2).toFixed(2)),Number(Math.sin(this.radian+Math.PI/2).toFixed(2)));this.angle=s([t,n]),t=this.speed*Math.PI/180,e=s([e,i]).rotate(t,a),this.setCoordinate(e.elements[0],e.elements[1]),this.speed+=.01},b.prototype.isInRectangle=function(t,e){var i=t.shape.x,s=t.shape.y,a=t.shape.height,n=(t=t.shape.width,e.shape.x),h=e.shape.y,r=e.shape.height;return!(n+e.shape.width<i||i+t<n||h+r<s||s+a<h)},b.prototype.isInRadius=function(e){var i,s,a,n,h=e.getRadius();return!(!t(h)||h<=0||(i=this.entity.shape.y+this.entity.shape.height/2,s=this.entity.shape.width,a=this.entity.shape.height,n=Math.abs(e.x-(this.entity.shape.x+this.entity.shape.width/2)),e=Math.abs(e.y-i),s/2+h<n)||a/2+h<e||!(n<=s/2||e<=a/2||(cornerDistance=Math.pow(n-s/2,2)+Math.pow(e-a/2,2))<=Math.pow(h,2)))},n.Physic=b,app.entities=app.entities||{},h=app.entities,w.prototype.update=function(t){this.incrementMyAge(t)},w.prototype.draw=function(t){this.shape.draw(t)},w.prototype.incrementMyAge=function(){this.age++},w.prototype.dead=function(t){this.imAlive=!1,app.js.arrayRemove(t.staticEntities,this)},h.Entity=w,(0,app.js.inherit)(f,(n=app.entities).Entity),f.prototype.draw=function(t){this.shape.draw(t,this.physic)},f.prototype.incrementMyAge=function(t){f.parent.incrementMyAge.call(this,t),this.age<this.maxAge&&0<this.shape.width?(this.shape.width=this.initialWidth-this.initialWidth/this.maxAge*this.age,this.shape.height=this.initialHeight-this.initialHeight/this.maxAge*this.age):this.dead(t)},f.prototype.dead=function(t){this.imAlive=!1,app.js.arrayRemove(t.noneEntities,this)},n.Molecule=f,(h=app.js.inherit)(o,(n=app.entities).Molecule),o.prototype.update=function(t,e){for(var i=!0,a=!1,n=e.getDeadlyEntities(),h=0;h<n.length;h++){var r=n[h];if(this.physic.isInRectangle(this,r)&&!1===r.draggable){this.dead(e),a=!(i=!1);break}}if(!a)for(n=e.getAttractiveEntities(),h=0;h<n.length;h++)if(r=n[h],this.physic.isInRadius(r.attraction)&&!1===r.draggable){if("Well"==r.className)return this.dead(e),void r.nbBlob++;r.attracted<8&&(this.firstAttract||(this.physic.angle=s([this.oldAngle.x,this.oldAngle.y])),this.physic.attractTo(r.attraction),this.firstAttract=r.isDraggable=!1,r.attracted++,a=!0,this.attractedBy=r,this.oldAngle={x:this.physic.angle.elements[0],y:this.physic.angle.elements[1]})}else r.attracted=0;if(!a)for(a=e.getOrbitalEntities(),h=0;h<a.length;h++)r=a[h],this.physic.isInRadius(r.orbit)&&!1===r.draggable&&(this.physic.rotateAround(r.orbit),i=r.isDraggable=!1);i&&this.physic.update(e,t.canvas.width,t.canvas.height),this.isBirthday()&&0<this.nbBlob&&(this.nbBlob--,e.showNoneEntities)&&((i=new app.entities.Molecule(this.shape.width,this.shape.height)).shape.x=this.shape.x,i.shape.y=this.shape.y,i.physic={radian:this.physic.radian},e.noneEntities.push(i)),o.parent.incrementMyAge.call(this,e)},o.prototype.isBirthday=function(){return 0==this.age%this.timeToLostMolecule&&this.imAlive},o.prototype.dead=function(t){this.imAlive=!1,t.nbBlobDead++,app.js.arrayRemove(t.blobEntities,this)},n.Blob=o,(0,app.js.inherit)(g,(h=app.entities).Entity),g.prototype.draw=function(t,e){var i,s,a,n;this.age<this.firstAgeForLostBlob&&(i=Math.PI*this.degreeBlob/180,s=Number(Math.cos(i).toFixed(2)),i=Number(Math.sin(i).toFixed(2)),a=this.shape.x+this.shape.width/2,n=this.shape.y+this.shape.height/2,t.beginPath(),t.strokeStyle="#18f9ff",t.moveTo(a,n),t.lineTo(a+100*s,n+100*i),t.lineWidth=2,t.lineCap="round",t.stroke()),g.parent.draw.call(this,t,e)},g.prototype.update=function(t){var e;this.isBirthday()&&0<this.nbBlob?(this.nbBlob--,(e=new app.entities.Blob(30,30,this.degreeBlob)).shape.x=this.shape.x+this.shape.width/2,e.shape.y=this.shape.y+this.shape.height/2,t.blobEntities.push(e)):this.age<this.firstAgeForLostBlob&&0==this.age%100?((e=document.getElementById("startBlob")).style.display="block",e.style.margin=this.shape.y+"px "+this.shape.x+"px",e.innerHTML=this.firstAgeForLostBlob/100-this.age/100):this.age>=this.firstAgeForLostBlob&&((e=document.getElementById("startBlob")).style.display="none",t.staticBuffering=!1),g.parent.update.call(this,t)},g.prototype.isBirthday=function(){return this.age>=this.firstAgeForLostBlob&&0==this.age%this.lostTime},h.Source=g,(0,app.js.inherit)(y,(n=app.entities).Entity),n.Wall=y,(0,app.js.inherit)(m,(h=app.entities).Entity),m.prototype.update=function(t){this.nbBlobMax<=this.nbBlob&&!0!==this.last?this.dead(t):m.parent.update.call(this,t)},m.prototype.draw=function(t,e){this.attraction.x=this.shape.x+this.shape.width/2,this.attraction.y=this.shape.y+this.shape.height/2,this.attraction.width=this.shape.width*this.factorAttraction,this.attraction.height=this.attraction.width,e.showNoneEntities&&(t.save(),t.shadowColor=this.shape.color,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=6,this.attraction.draw(t),t.restore()),m.parent.draw.call(this,t,e)},h.Well=m,(0,app.js.inherit)(u,(n=app.entities).Well),n.Magnet=u,(0,app.js.inherit)(d,(h=app.entities).Entity),d.prototype.draw=function(t,e){this.orbit.x=this.shape.x+this.shape.width/2,this.orbit.y=this.shape.y+this.shape.height/2,this.orbit.width=Math.max(this.shape.width,this.shape.height)+80,this.orbit.height=this.orbit.width,e.showNoneEntities&&(t.save(),t.shadowColor=this.shape.color,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=6,this.orbit.draw(t),t.restore()),d.parent.draw.call(this,t,e)},h.Rotate=d,n=app,c.prototype.buffering=function(){app.js.isDefined(this.canvasBuffer)?this.canvasBuffer.width=this.canvasBuffer.width:(this.canvasBuffer=document.createElement("canvas"),this.canvasBuffer.width=1024,this.canvasBuffer.height=600);for(var t,e=this.canvasBuffer.getContext("2d"),i=this.staticEntities.length,s=0;s<i;s++)t=this.staticEntities[s],app.js.isDefined(t)&&t.draw(e,this);this.staticBuffering=!0},c.prototype.draw=function(t,e){if(!1===this.staticBuffering&&this.buffering(),t.drawImage(this.canvasBuffer,0,0),!0===e)for(var i,s=this.staticEntities.length,a=0;a<s;a++)i=this.staticEntities[a],app.js.isDefined(i)&&i.update(this);for(s=this.menuEntities.length,a=0;a<s;a++)i=this.menuEntities[a],app.js.isDefined(i)&&i.draw(t,this);if(this.showNoneEntities)for(s=this.noneEntities.length,a=0;a<s;a++)i=this.noneEntities[a],app.js.isDefined(i)&&(!0===e&&i.update(this),i.draw(t,this));for(s=this.blobEntities.length,a=0;a<s;a++)i=this.blobEntities[a],app.js.isDefined(i)&&(!0===e&&i.update(t,this),i.draw(t,this))},c.prototype.addEntity=function(t){this.staticBuffering=t.draggable=!1,this.staticEntities.push(t),this.clearIterators()},c.prototype.clearIterators=function(){this.deadlyEntities=[],this.attractiveEntities=[],this.orbitalEntities=[]},c.prototype.getDeadlyEntities=function(){if(!(0<this.deadlyEntities.length))for(var t=0;t<this.staticEntities.length;t++)"Wall"===this.staticEntities[t].className&&this.deadlyEntities.push(this.staticEntities[t]);return this.deadlyEntities},c.prototype.getAttractiveEntities=function(){if(!(0<this.attractiveEntities.length))for(var t=0;t<this.staticEntities.length;t++)this.staticEntities[t].hasOwnProperty("attraction")&&this.attractiveEntities.push(this.staticEntities[t]);return this.attractiveEntities},c.prototype.getOrbitalEntities=function(){if(!(0<this.orbitalEntities.length))for(var t=0;t<this.staticEntities.length;t++)this.staticEntities[t].hasOwnProperty("orbit")&&this.orbitalEntities.push(this.staticEntities[t]);return this.orbitalEntities},c.prototype.isFinish=function(){return 0==this.startSource.nbBlob&&0==this.blobEntities.length},c.prototype.isWin=function(){return 0<this.endWell.nbBlob},n.Map=c,h=app,p.prototype.restart=function(){this.loop={},this.score=this.currentIndexMap=0},p.prototype.init=function(){this.currentMap=app.js.deserialize(this.listSerializedMap[this.currentIndexMap],new app.Map),this.menu.init(this.currentMap)},p.prototype.clear=function(){this.context.canvas.width=this.context.canvas.width},p.prototype.start=function(){var t=this;t.currentMap.isFinish()?t.end():(window.requestAnimFrame(function(){t.isRun&&t.start()}),this.clear(),this.currentMap.draw(this.context,!0),this.isRun=!0)},p.prototype.pause=function(){this.isRun=!1},p.prototype.end=function(){this.pause();var t="<br /> <br />You won by saving  "+this.currentMap.endWell.nbBlob+" Blobs. <br />";this.currentMap.isWin()&&this.currentIndexMap+1<this.listSerializedMap.length?(this.calculScore(),this.createPopup("Congrats ! You won this level !! "+t+"In this level your score is :"+this.scoreLastMap+" points. <br /> <br />Let's see how you will deal with the next level !<br /> <div style='float:right'><div id='replayLevel'>Replay level</div><div id='nextLevel'>Next level</div><div id='tweetScore'><a href='"+this.createTweetUrl(!1,this.currentIndexMap,this.scoreLastMap,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>")):this.currentMap.isWin()?this.createPopup("Congrats ! You won the Blob Rising game !! "+t+"Your final score is : "+this.scoreLastMap+" points. <br /> <br /><div style='float:right'><div id='replayLevel'>Replay level</div><div id='replayGame'>Replay game</div><div id='tweetScore'><a href='"+this.createTweetUrl(!0,this.currentIndexMap,this.scoreLastMap,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>"):(this.score-=100,this.createPopup("Unfortunately you lost this level... <br /> <br />In this level your score is :"+this.score+" points. <br /> <br /> <br />Try again to save Blobs ! <br /><div style='float:right'><div id='replayLevel'>Replay level</div><div id='tweetScore'><a href='"+this.createTweetUrl(!1,this.currentIndexMap,this.score,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>")),document.getElementById("score").innerHTML="Score : "+this.score+" Blob"},p.prototype.createTweetUrl=function(t,e,i,s){return i=" with "+i+" points. I saved "+s+" Blobs. Try it yourself !&url=http://blobrising.github.com/BlobRising/&via=BlobRising&related=BlobRising",t?encodeURI("https://twitter.com/intent/tweet?text=I played Blob Rising and I won the game"+i):encodeURI("https://twitter.com/intent/tweet?text=I played Blob Rising, I have done the level "+(e+1)+i)},p.prototype.onNextLevelClick=function(){this.currentIndexMap+=1,this.createStartGame()},p.prototype.onReplayLevelClick=function(){this.createStartGame()},p.prototype.onReplayGameClick=function(){this.endOfGameDiv.style.display="none",this.pause(),this.menu.showHelp(),this.restart(),this.init(),this.menu.showMapName(),document.getElementById("score").innerHTML="Score : "+this.score+" Blob"},p.prototype.createStartGame=function(){this.endOfGameDiv.style.display="none";var t=this.currentMap.showNoneEntities;this.clear(),this.init(),this.currentMap.showNoneEntities=t,this.start(),this.menu.showMapName()},p.prototype.createPopup=function(t){var e=this;this.endOfGameDiv.innerHTML=t,this.endOfGameDiv.style.display="block",this.endOfGameNextLevel=document.getElementById("nextLevel"),app.js.isDefined(this.endOfGameNextLevel)&&(this.endOfGameNextLevel.style.display="inline-block",this.endOfGameNextLevel.addEventListener("mousedown",function(t){app.Game.prototype.onNextLevelClick.call(e,t)},!1)),this.endOfGameReplayGame=document.getElementById("replayGame"),app.js.isDefined(this.endOfGameReplayGame)&&(this.endOfGameReplayGame.style.display="inline-block",this.endOfGameReplayGame.addEventListener("mousedown",function(t){app.Game.prototype.onReplayGameClick.call(e,t)},!1)),this.endOfGameTweetScore=document.getElementById("tweetScore"),app.js.isDefined(this.endOfGameTweetScore)&&(this.endOfGameTweetScore.style.display="inline-block",this.endOfGameTweetScore.addEventListener("mousedown",function(t){app.Game.prototype.onTweetScoreClick.call(e,t)},!1)),this.endOfGameReplayLevel=document.getElementById("replayLevel"),app.js.isDefined(this.endOfGameTweetScore)&&(this.endOfGameReplayLevel.style.display="inline-block",this.endOfGameReplayLevel.addEventListener("mousedown",function(t){app.Game.prototype.onReplayLevelClick.call(e,t)},!1))},p.prototype.calculScore=function(){for(var t=0,e=this.currentMap.staticEntities.length,i=0;i<e;i++)!0===this.currentMap.staticEntities[i].isFromMenu&&t++;this.scoreLastMap=100*this.currentMap.endWell.nbBlob+100*(this.currentMap.menuRotate.nb+this.currentMap.menuMagnet.nb-t)-100*(this.currentMap.nbBlobDead-this.currentMap.endWell.nbBlob),this.score+=this.scoreLastMap},h.Game=p,n=app,l.prototype.init=function(t){this.nbRotateInit=this.nbRotate=t.menuRotate.nb,this.nbMagnetInit=this.nbMagnet=t.menuMagnet.nb,this.updateMenuEntities()},l.prototype.showMapName=function(){this.showHelp("You are on <div class='keyboard'>"+this.game.currentMap.mapName+"</div> map",3e3)},l.prototype.addEntity=function(t,e){null!=this.entitySelected&&this.entitySelected.hasPosed?this.showHelp("You must put your machine before add another !","1000"):(e.shape.x=-1e3,e.shape.y=-1e3,e.draw(t.context,t.currentMap),e.isFromMenu=!0,e.isDraggable=!0,(this.entitySelected=e).draggable=!0,e.hasPosed=!1,t.currentMap.menuEntities=[],t.currentMap.menuEntities.push(e))},l.prototype.showHelp=function(t,e){var i;this.helpDiv.style.display="block",this.lastStartBlobDiv=this.startBlobDiv.style.display,app.js.isDefined(t)||app.js.isDefined(e)?(this.helpDiv.className="helpInGame","mousedown"===e?(this.helpDiv.innerHTML=t,(i=this).game.canvas.addEventListener("mousedown",function(){i.hideHelp()},!1)):(clearTimeout(this.timeout),this.helpDiv.innerHTML=t,(i=this).timeout=setTimeout(function(){i.hideHelp()},e))):(this.startBlobDiv.style.display="none",this.helpDiv.className="mainMenu",this.scoreDiv.style.display="block",this.helpDiv.innerHTML=this.firstInnerHTML)},l.prototype.hideHelp=function(){this.game.isRun?(this.startBlobDiv.style.display=this.lastStartBlobDiv,this.helpDiv.style.display="none",this.scoreDiv.style.display="none"):this.game.currentMap.isFinish()||this.showHelp()},l.prototype.updateMenuEntities=function(){document.getElementById("nbMenuRotate").innerHTML=this.nbRotate+"/"+this.nbRotateInit,document.getElementById("nbMenuMagnet").innerHTML=this.nbMagnet+"/"+this.nbMagnetInit},l.prototype.onCanvasMove=function(t){var e=this.game.canvas,i=t.clientX-document.documentElement.scrollLeft-e.offsetLeft;t=t.clientY-document.documentElement.scrollTop-e.offsetTop,app.js.isDefined(this.entitySelected)&&this.entitySelected.imAlive&&(this.setEntityPosition(i,t),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected.shape.draw(this.game.context))},l.prototype.onCanvasClick=function(t){var e=this.game.canvas,i=t.clientX-document.documentElement.scrollLeft-e.offsetLeft;if(t=t.clientY-document.documentElement.scrollTop-e.offsetTop,app.js.isDefined(this.entitySelected))app.js.isDefined(this.entitySelected)&&("Rotate"==this.entitySelected.className&&!1===this.entitySelected.hasPosed?this.nbRotate--:!1===this.entitySelected.hasPosed&&this.nbMagnet--,this.entitySelected.hasPosed=!0,this.updateMenuEntities(),this.setEntityPosition(i,t),this.entitySelected.draggable=!1,app.js.arrayRemove(this.game.currentMap.menuEntities,this.entitySelected),this.game.currentMap.addEntity(this.entitySelected),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected=null);else{e=this.game.currentMap.staticEntities.length;for(var s=!1,a=0;a<e&&!s;a++){var n=this.game.currentMap.staticEntities[a];this.isClick(n,i,t)&&(s=!0,this.entitySelected=n,app.js.arrayRemove(this.game.currentMap.staticEntities,this.entitySelected),this.game.currentMap.staticBuffering=!1,this.game.currentMap.menuEntities.push(this.entitySelected),this.game.currentMap.clearIterators())}}},l.prototype.setEntityPosition=function(t,e){this.entitySelected.shape.x=t-this.entitySelected.shape.width/2,this.entitySelected.shape.y=e-this.entitySelected.shape.width/2},l.prototype.isClick=function(t,e,i){if(!0===t.isFromMenu&&!0===t.isDraggable){var s=t.shape.x,a=t.shape.y,n=t.shape.height;if(!(s+t.shape.width<e||e+1<s||a+n<i||i+1<a))return!0}return!1},n.Menu=l,window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,50)},h=document.getElementById("canvas"),n=new app.Game([{mapName:"Semi arc",menuRotate:{className:"Rotate",nb:0},menuMagnet:{className:"Magnet",nb:1},staticEntities:[{className:"Wall",shape:{x:400,y:300,width:180}},{className:"Magnet",shape:{x:350,y:470}},{className:"Magnet",shape:{x:680,y:450}},{className:"Magnet",shape:{x:820,y:300}},{className:"Magnet",shape:{x:735,y:100}}],startSource:{degreeBlob:50,shape:{x:150,y:350}},endWell:{shape:{x:200,y:100}}},{mapName:"Simple effect",menuRotate:{className:"Rotate",nb:3},menuMagnet:{className:"Magnet",nb:1},staticEntities:[{className:"Well",shape:{x:300,y:200}},{className:"Wall",shape:{x:550,y:200,height:180}}],startSource:{degreeBlob:40,shape:{x:50,y:100}},endWell:{shape:{x:500,y:250}}},{mapName:"BLOB",menuRotate:{className:"Rotate",nb:3},menuMagnet:{className:"Magnet",nb:5},staticEntities:[{className:"Wall",shape:{x:100,y:100,width:150,height:35}},{className:"Wall",shape:{x:100,y:100,width:35,height:300}},{className:"Wall",shape:{x:100,y:250,width:150,height:35}},{className:"Wall",shape:{x:100,y:400,width:150,height:35}},{className:"Wall",shape:{x:250,y:100,width:35,height:335}},{className:"Wall",shape:{x:350,y:100,width:35,height:300}},{className:"Wall",shape:{x:350,y:400,width:150,height:35}},{className:"Wall",shape:{x:550,y:100,width:150,height:35}},{className:"Wall",shape:{x:550,y:100,width:35,height:300}},{className:"Wall",shape:{x:550,y:400,width:150,height:35}},{className:"Wall",shape:{x:700,y:100,width:35,height:335}},{className:"Wall",shape:{x:800,y:100,width:150,height:35}},{className:"Wall",shape:{x:800,y:100,width:35,height:300}},{className:"Wall",shape:{x:800,y:250,width:150,height:35}},{className:"Wall",shape:{x:800,y:400,width:150,height:35}},{className:"Wall",shape:{x:950,y:100,width:35,height:335}}],startSource:{degreeBlob:0,firstAgeForLostBlob:700,shape:{x:10,y:10}},endWell:{shape:{x:850,y:500}}},{mapName:"Jail",menuRotate:{className:"Rotate",nb:4},menuMagnet:{className:"Magnet",nb:4},staticEntities:[{className:"Wall",shape:{x:200,y:10,width:35,height:300}},{className:"Wall",shape:{x:200,y:10,width:35,height:300}},{className:"Wall",shape:{x:310,y:280,width:200,height:35}},{className:"Wall",shape:{x:650,y:280,width:260,height:35}},{className:"Wall",shape:{x:570,y:10,width:35,height:230}},{className:"Well",shape:{x:400,y:70}},{className:"Well",shape:{x:800,y:450}}],startSource:{degreeBlob:55,firstAgeForLostBlob:800,shape:{x:50,y:50}},endWell:{shape:{x:800,y:100}}},{mapName:"Patience",menuRotate:{className:"Rotate",nb:2},menuMagnet:{className:"Magnet",nb:10},staticEntities:[{className:"Wall",shape:{x:500,y:0,width:5,height:100}},{className:"Wall",shape:{x:500,y:125,width:5,height:100}},{className:"Wall",shape:{x:500,y:245,width:5,height:100}},{className:"Wall",shape:{x:500,y:365,width:5,height:100}},{className:"Wall",shape:{x:500,y:485,width:5,height:100}}],startSource:{degreeBlob:0,firstAgeForLostBlob:300,shape:{x:50,y:250}},endWell:{shape:{x:750,y:250}}},{mapName:"Inverse",menuRotate:{className:"Rotate",nb:10},menuMagnet:{className:"Magnet",nb:10},staticEntities:[{className:"Wall",shape:{x:500,y:150,width:35,height:300}},{className:"Wall",shape:{x:700,y:150,width:300,height:35}},{className:"Wall",shape:{x:700,y:415,width:300,height:35}},{className:"Wall",shape:{x:10,y:150,width:300,height:35}},{className:"Wall",shape:{x:10,y:415,width:300,height:35}},{className:"Well",shape:{x:500,y:150}},{className:"Well",shape:{x:500,y:415}}],startSource:{degreeBlob:0,firstAgeForLostBlob:500,shape:{x:550,y:250}},endWell:{shape:{x:400,y:250}}}],h),h.width=1024,h.height=600,document.body.appendChild(h),h=new app.Menu(n),n.menu=h,n.init()</script>