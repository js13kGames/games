<!doctype html><style>*{box-sizing:border-box}body,html{background-color:#000;color:#dcf5ff;height:100vh;image-rendering:pixelated;image-rendering:crisp-edges;margin:0;padding:0;width:100vw}button{align-items:center;background:0 0;border:none;color:inherit;cursor:pointer;display:flex;font-family:inherit;font-size:inherit;outline:0;padding:2px 3px;position:relative;text-align:left;width:46px}button:after{background-color:#55415f;clip-path:polygon(0 3px,1px 3px,1px 2px,2px 2px,2px 1px,3px 1px,3px 0,46px 0,46px 6px,45px 6px,45px 7px,44px 7px,44px 8px,43px 8px,43px 9px,0 9px);content:"";display:block;bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0;transition:background-color .4s steps(3);z-index:-1}button:hover:after{background-color:#3a2c41}button:focus:before{background-color:#e6c86e;content:"";display:block;height:2px;margin-right:1px;width:2px}button:not(:first-child){margin-top:4px}button.center{display:flex;justify-content:center}button.go:after{background-color:#64b964}button.go:hover:after{background-color:#49a149}canvas.text{display:inline-block;pointer-events:none}dl{margin:0}h1,h2{margin:2px;padding:4px 1px;position:relative}h1:after,h1:before,h2:after,h2:before{background-image:url(7e4a8706bd76292a68b92f65f202b304.png);background-repeat:no-repeat;content:"";display:block;height:2px;left:0;pointer-events:none;position:absolute;right:0}h1:after,h2:after{bottom:0;transform:rotate(180deg)}h1:before,h2:before{top:0}h1 div+div,h2 div+div{margin-top:1px}ol{list-style:none;margin:0;padding:0}.frame{display:flex;flex-direction:column;height:119px;padding:4px;position:relative}.frame:before{clip-path:polygon(0 6px,1px 6px,1px 5px,2px 5px,2px 4px,3px 4px,3px 3px,4px 3px,4px 2px,5px 2px,5px 1px,6px 1px,6px 0,100% 0,100% 113px,calc(100% - 1px) 113px,calc(100% - 1px) 114px,calc(100% - 2px) 114px,calc(100% - 2px) 115px,calc(100% - 3px) 115px,calc(100% - 3px) 116px,calc(100% - 4px) 116px,calc(100% - 4px) 117px,calc(100% - 5px) 117px,calc(100% - 5px) 118px,calc(100% - 6px) 118px,calc(100% - 6px) 119px,0 100%,0 6px,2px 6px,2px 117px,calc(100% - 7px) 117px,calc(100% - 7px) 116px,calc(100% - 6px) 116px,calc(100% - 6px) 115px,calc(100% - 5px) 115px,calc(100% - 5px) 114px,calc(100% - 4px) 114px,calc(100% - 4px) 113px,calc(100% - 3px) 113px,calc(100% - 3px) 112px,calc(100% - 2px) 112px,calc(100% - 2px) 2px,7px 2px,7px 3px,6px 3px,6px 4px,5px 4px,5px 5px,4px 5px,4px 6px,3px 6px,3px 7px,2px 7px);content:"";display:block;bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:1}.frame.dark:before{background-color:#55415f}.frame.light:before{background-color:#dcf5ff}.frame .bottom{margin-top:auto}.frame.center{align-items:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.map{border:solid #55415f;border-width:0 0 1px;cursor:pointer;display:flex;margin:0 2px;padding:1px 2px}.map>:first-child{margin-right:6px;min-width:9px;text-align:right}.map:hover{background:#646964}.pull-right{float:right}.text-right{text-align:right}.score{margin:4px 2px 0}.score .value{margin-top:2px}.screen{display:grid;gap:4px;grid-template-columns:54px 116px 54px;height:119px}.stretch{grid-column:span 2}#brand{background-image:url(43063ce1628e9cf5102119af4a5a5007.png);height:22px;width:132px}#canvas-wrap{background-image:url(c165dff90d3322c56903643457214a39.png);background-repeat:repeat-x;clip-path:polygon(0 6px,1px 6px,1px 5px,2px 5px,2px 4px,3px 4px,3px 3px,4px 3px,4px 2px,5px 2px,5px 1px,6px 1px,6px 0,100% 0,100% 100%,0 100%)}#canvas-wrap>canvas{margin:-2px 6px 2px}#game-wrapper{height:127px;padding:4px;transform-origin:0 0;transition:transform .5s;width:240px}#level-recap:not([hidden]){background-color:rgba(0,0,0,.8);bottom:0;display:grid;left:0;place-items:center;position:absolute;right:0;top:0;z-index:0}#level-recap>div{display:grid;gap:4px;grid-template-columns:1fr auto auto}#level-recap>div header{padding-bottom:4px}#level-recap>div #final-score{padding-top:4px}#level-recap>div #final-score,#level-recap>div header{grid-column:span 3}#play-info time{align-items:center;background-image:url(97457ae82200f240757816886f57c0b4.png);background-repeat:no-repeat;margin:2px;min-width:42px;padding:4px;text-align:center}#play-info #skip-timer{margin-bottom:2px}#tile-queue{display:flex;flex-direction:column;flex-shrink:1;height:100%;overflow:hidden}#tile-queue header{padding:4px}#tile-queue #empty-queue-message{display:none}#tile-queue [hidden]+[hidden]+#empty-queue-message{align-items:center;display:flex;flex-direction:column;gap:2px;height:100%;justify-content:center;place-items:center}#tiles-remaining{background-color:#646964;border-top:1px solid #55415f;bottom:1px;clip-path:polygon(0 0,46px 0,46px 2px,45px 2px,45px 3px,0 3px);height:3px;left:2px;position:absolute;width:46px}#tiles-remaining:before{background-color:var(--c);bottom:0;content:"";display:block;left:0;position:absolute;top:0;width:calc(100% - var(--p))}#tutorial-message{background-color:rgba(0,0,0,.5);bottom:0;left:0;padding:4px;position:absolute;right:0;text-align:center}#tutorial-message:empty{display:none}#tutorial-message>*+*{margin-top:2px}[hidden]{display:none}</style><div id=game-wrapper><div class=screen hidden id=main-menu><div class="frame dark"><h2>Menu</h2></div><div class="center frame dark stretch"><div id=brand></div><button class="center go" id=start>Start</button></div></div><div class=screen hidden id=map-select><div class="frame dark"><h2>Menu</h2><div class=bottom><button id=tutorial>Tutorial</button> <button class=back>Back</button></div></div><div class="frame dark stretch"><h1>Choose a Map</h1><dl id=maps></dl></div></div><div class=screen hidden id=game><div class="frame dark"><h1><div data-font=Thaleah>Level</div><div class=text-right data-font=Thaleah id=level-index></div></h1><div class=score id=high-score><div>High</div><div class="text-right value"></div></div><div class=score id=current-score><div>Current</div><div class="text-right value"></div></div><div class=bottom><button id=reset>Reset</button> <button data-action=quit>Quit</button></div></div><div class="frame light" id=canvas-wrap><canvas height=113 width=97></canvas><div hidden id=level-recap><div><header data-font=Thaleah>Victory!</header><div>Early Start</div><div>+</div><div class=text-right data-score=earlyStartBonus></div><div>Path Bonus</div><div>+</div><div class=text-right data-score=pathBonus></div><div>Time Bonus</div><div>+</div><div class=text-right data-score=timeBonus></div><div>Remaining Tiles</div><div>+</div><div class=text-right data-score=remainingTileBonus></div><div>Corrupted Tiles</div><div>+</div><div class=text-right data-score=corruptedTileBonus></div><div id=final-score><span data-font=Thaleah>Total</span> <span class="pull-right value" data-font=Thaleah></span></div><div><button id=retry>Retry</button> <button class=go id=next-level>Next</button></div></div></div><div hidden id=tutorial-message></div></div><div class="frame dark" id=play-info><time data-font=Thaleah>00:00</time><div id=tile-queue><div id=current-tile><header>Current</header><div class=target></div></div><div id=next-tile><header>Next</header><div class=target></div></div><div id=empty-queue-message><span>No Tiles</span> <span>Remaining</span></div></div><button class=go id=skip-timer>Go!</button><div id=tiles-remaining></div></div></div></div><script>this||window,function(){"use strict";(()=>{function e(i){if(r[i])return r[i].exports;var a=r[i]={exports:{}};return t[i](a,a.exports,e),a.exports}var t={93:(e,t,r)=>{r.d(t,{k:()=>i,I:()=>a});let i={h:16,w:12},a={h:6,w:8}},144:(e,t,r)=>{function i(e,t,r,i=0,n=1,o,s){i&&e.alpha(.5),n?e.image(a.n,o,s,8,8,t,r-1,8,8):(e.color(null,"red"),e.alpha(.5),e.rect(t,r-1,8,8)),e.alpha(1)}r.d(t,{S:()=>n});var a=r(869);let n=[()=>{},(e,t,r,a=0,n=1)=>i(e,t,r,a,n,0,0),(e,t,r,a=0,n=1)=>i(e,t,r,a,n,0,8)]},869:(e,t,r)=>{r.d(t,{n:()=>i}),e=r.p+"4f8aa6a40a61b50988d35967c60f32d1.png";let i=new Image;i.src=e},782:(e,t,r)=>{r.d(t,{D:()=>o});var i=r(144),a=r(93);let n=[[-1,0],[1,0],[0,1],[0,-1],[0,0]];class o{constructor(e,t,r=a.k.w,i=a.k.h){this.original=t[0].toString().padStart(r*i,"0").split("").map((e=>+e)),this.delay=t[1],this.originalObjects=t[2],this.size={w:r,h:i},this.name=e,this.reset(),this.tiles=t.slice(3).map((e=>{let t=+e[0],r=+e[1];return e=BigInt(e.slice(2)),new o("",[e,0,[]],t,r)}))}index(e,t){return t*this.size.w+e}reset(){this.data=[...this.original],this.objects=this.originalObjects.map((([e,t,r])=>({x:e,y:t,type:r,state:{ox:0,oy:0}})))}update(e,t,r){this.data[this.index(t,r)]=e}at(e,t){return this.data[this.index(e,t)]}render(e,t=0,r=0,n=0){const o=t*a.I.w,s=r*a.I.h;this.data.forEach(((l,h)=>{if(i.S[l]){let c=h%this.size.w;h=Math.floor(h/this.size.w),i.S[l](e,c*a.I.w+o,h*a.I.h+s,n,!n||!n.at(c+t,h+r))}}))}path(e,t){return function(e,t,r,i){let a,o,{x:s,y:l}=r,{x:h,y:c}=i,d=[];e.forEach(((e,r)=>{let i=r%t.w;r=(r-i)/t.w,d[i]=d[i]||[],d[i][r]=e})),a={mask:d.map((e=>e.map((e=>1==e)))),layer:d.map(((e,t)=>e.map(((e,r)=>+(t==s&&r==l)))))};for(let e=0,r={};e<t.w*t.h&&(-1==h||0==a.layer[h][c]);e++)r.mask=a.mask,r.layer=a.layer.map(((e,t)=>e.map(((e,r)=>{e=0;for(let i of n)(o=a.layer[t+i[0]])&&o[r+i[1]]&&(e=1);return a.layer[t][r]+e*a.mask[t][r]})))),a=r;if(-1==h)return a.layer.map(((e,t)=>e.map(((e,r)=>e?{x:t,y:r}:0)))).flat(3).filter((e=>e));for(e=h,r=c,i=[];s!=e||l!=r;){let t=[],s=0;for(let t of n){var u=[e+t[0],r+t[1]];s=Math.max(s,(o=a.layer[u[0]])&&o[u[1]]||0)}if(0==s)return{x:-1,y:-1};for(let i of n)u=[e+i[0],r+i[1]],((o=a.layer[u[0]])&&o[u[1]])==s&&t.push(u);i.push({x:e,y:r}),[e,r]=t[Math.random()*t.length|0]}return i.reverse()}(this.data,this.size,e,t)}}},896:()=>{let e=EventTarget.prototype;e.on=e.addEventListener,e.off=e.removeEventListener,e.once=function(e,t){let r=i=>{t(i),this.off(e,r)};return this.on(e,r)}},819:()=>{}},r={};e.d=(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:1,get:r[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:1})},e.p="",(()=>{function t(e){let t=new EventTarget;return new Proxy(e,{get:(e,r)=>"on"===r?t.on.bind(t):e[r],set(e,r,i){let a={detail:{key:r,value:i}};return e[r]=i,t.dispatchEvent(new CustomEvent("change:"+r,a)),t.dispatchEvent(new CustomEvent("change",a)),1}})}function r(){let e=window.innerHeight,t=window.innerWidth,r=e/127;240/127>t/e&&(r=Math.floor(t/240)),document.querySelector("#game-wrapper").style.transform=`scale(${r})`}function i(e,t,r,i){let a=0;e.forEach((e=>{r.drawImage(t,e.x,0,e.w,e.h,a,0,e.w,e.h),a+=e.w+1})),r.globalCompositeOperation="source-atop",r.fillStyle=i?"#d77355":"#dcf5ff",r.fillRect(0,0,r.canvas.width,r.canvas.height)}function a(){let e=c.indexOf(d.map)+1;return c[e]?e:null}var n={};e.r(n),e.d(n,{characterDefaults:()=>b,coords:()=>v,fontImage:()=>w,state:()=>x});var o={};e.r(o),e.d(o,{characterDefaults:()=>k,coords:()=>q,fontImage:()=>S,state:()=>T});var s=e(93),l=e(869);e(819),e(896);var h=new(e(782).D)("Precondition Required",[100000000001110001100011100000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000n,1e4,[[0,7,"robot"],[11,7,"exit"]],"31111","31111"]);let c=[h,new(e(782).D)("Conflict",[100002200001110002200011100002200001000000000000000000000000000000000000000000000000000000000000000000000000000000000000n,1e4,[[0,7,"robot"],[11,7,"exit"]],"31111","221110","221101","31111"]),new(e(782).D)("Timeout",[2200000000002200000100002200001110010010011100002200001000002200000000002200000000000000000000000000000000000000000000000000000000000000000n,1e4,[[0,7,"robot"],[11,7,"exit"]],"2111","2111","13111","411111","13111","2111"]),new(e(782).D)("Bad Request",[1000000000010000000000100000000000000000000000000000000000010000000010010000000010010001100010010001100010010000000010010000000010000000000000000000000000000000000001000000000010000000000100n,1e4,[[1,1,"robot"],[10,14,"exit"]],"13111","411111","32100122","1211","3310111010","1211","241012101","411111","13111"]),new(e(782).D)("Continue",[100010001001000000000000000000000000001000100010000000000000000000000000100010001001000000000000000000000000001000100010000000000000000000000000100010001001000000000000000000000000001000100010n,1e4,[[0,0,"robot"],[10,15,"exit"]],"141111","32111001","33200020002","241010101","3510212212212010","411111","32111001","34101101111100","33202202202","32111001","3310111222","32111001"]),new(e(782).D)("Im a teapot",[11110000000000000000002022220000000000000000102000000201102011110201102000000201000000000000000022220200000000000000000011110000000000000000000000000000000000000000n,1e4,[[0,7,"robot"],[11,7,"exit"]],"32100111","141111","141111","31111","3310111010","33121020121","33222111222"]),new(e(782).D)("Loop Detected",[1001000010000000000000001000000000000000000000000000000000001000000010001110000010001110000000001110000000000100002200000100002210000100000011122122100010100100100210111211212210100000012212n,1e4,[[3,13,"robot"],[10,15,"exit"]],"1211","111","2111","411111","4322011110220","141111","13111"]),new(e(782).D)("Payload Too Large",[1001001001000000000000000000000000001001001000000000000000000000000000001001001000000000000000000000000000001001001000000000000000000000000000000000000000n,15e3,[[2,3,"robot"],[11,3,"exit"]],"35101101101101101","331011110","53111110000011111","35102102102102102","53111110000022222","3310111010","35102102102102102","3610210212012010110","141111","411111"]),new(e(782).D)("Misdirected Request",[20200002020001000000100020200002020010001100000022221122210000221122110000221122000022222222220020110111020000202200000000000000000020200002020001000000100020200002020000000000000n,1e4,[[3,9,"exit"],[1,4,"robot"]],"31111","411111","31111","2310111","321111","411111","23101011"]),new(e(782).D)("Unprocessable Entity",[110000000000010000000000010011000000020002000000000000001001000000000021022200000000020000000000000020000000002220120000000000100100000000000000200020000000110010000000000010000000000011000n,16e3,[[11,4,"exit"],[0,11,"robot"]],"23111010","2310111","411111","141111","331012122","141111","33112212222","33221210100","32111001","411111"])],d=t(new Proxy({currentTile:0,entities:[],frame:0,highScore:0,isVictory:0,lastTimerUpdate:0,map:null,mapIndex:null,paused:1,placeX:0,placeY:0,timeRemaining:0,totalMoves:0,tutorial:0},{set(e,t,r){if("map"===t)return(t=c[+r]).reset(),e.currentTile=0,e.entities=t.objects,e.highScore=localStorage.getItem(`TS:NF:${r}::high-score`),e.isVictory=0,e.mapIndex=r,e.placeX=0,e.placeY=0,e.timeRemaining=t.delay,e.totalMoves=0,e.map=t,e=document.querySelector("#play-info time"),r=document.querySelector("#skip-timer"),e.classList.remove("danger"),r.removeAttribute("hidden"),r.removeAttribute("disabled"),p.reset(),1;if("timeRemaining"===t)return e[t]=Math.max(r,-599e3),1;if("currentTile"===t){var i=e.map.tiles[r];if(i){var a=s.k.w-i.size.w;i=s.k.h-i.size.h,e.placeY>i&&(e.placeY=i),e.placeX>a&&(e.placeX=a)}}if(["placeX","placeY"].includes(t)){if(a=e.map.tiles[e.currentTile]){let{w:i,h:n}=a.size;switch(t){case"placeX":0<=r&&r<=s.k.w-i&&(e[t]=r);break;case"placeY":0<=r&&r<=s.k.h-n&&(e[t]=r)}}return 1}return e[t]=r,1}})),u={corruptedTileBonus:0,earlyStartBonus:0,get pathBonus(){return d.totalMoves?Math.floor(192/d.totalMoves*1e3):0},get remainingTileBonus(){return 1e3*(d.map.tiles.length-d.currentTile)},get timeBonus(){return 0>d.timeRemaining?100*Math.floor(6e5/Math.abs(d.timeRemaining)):0},get preTotal(){return this.earlyStartBonus+this.corruptedTileBonus},get total(){return this.earlyStartBonus+this.pathBonus+this.timeBonus+this.remainingTileBonus+this.corruptedTileBonus},reset:()=>{u.corruptedTileBonus=0,u.earlyStartBonus=0}},p=t(u),m=0;document.on("keydown",(({code:e})=>{if(m)switch(e){case"ArrowDown":case"KeyS":d.placeY+=1;break;case"ArrowLeft":case"KeyA":--d.placeX;break;case"ArrowRight":case"KeyD":d.placeX+=1;break;case"ArrowUp":case"KeyW":--d.placeY;break;case"Enter":0<=d.timeRemaining&&(p.earlyStartBonus+=d.timeRemaining,d.timeRemaining=0,document.querySelector("#skip-timer").setAttribute("hidden",1));break;case"Space":(()=>{let{map:e,placeX:t,placeY:r}=d,i=e.tiles[d.currentTile];if(i&&!i.data.some(((a,n)=>a?0!==e.at(n%i.size.w+t,Math.floor(n/i.size.w)+r):0))){var a=0;i.data.forEach(((n,o)=>{n&&(e.update(n,o%i.size.w+t,Math.floor(o/i.size.w)+r),2==n&&(a+=1))})),a&&(p.corruptedTileBonus+=250*a),d.currentTile+=1}})()}})),e(144);let y=()=>{let e=localStorage.getItem("TS:NF:unlockedLevels");return e?JSON.parse(e):[0]},f={exit(e,t){e.image(l.n,24+8*Math.floor(d.frame%60/6),0,8,16,s.I.w*t.x,s.I.h*t.y-13,8,16)},robot(e,t){let{entities:r,frame:i,isVictory:a,map:n,timeRemaining:o}=d,h=t.state;if(!a&&0>=o){if(!h.path||0===h.path.length&&t.x===h.next.x&&h.next.y===t.y){var c=n.path({x:t.x,y:t.y},{x:-1,y:-1});let e=r.find((e=>"exit"===e.type)),i=c.find((({x:t,y:r})=>t==e.x&&e.y==r)),a=Math.max(...c.map((e=>e.x)));c=c.filter((e=>e.x===a)),i||(i=c[Math.floor(Math.random()*c.length)]),h.path=n.path({x:t.x,y:t.y},i),h.next=h.path.shift()||t}0==i%5&&(t.x+h.ox/s.I.w==h.next.x&&t.y+h.oy/s.I.h==h.next.y&&(d.totalMoves+=1,t.x=h.next.x,t.y=h.next.y,h.next=h.path.shift()||t,h.ox=0,h.oy=0),h.next.x>t.x&&h.ox++,h.next.x<t.x&&h.ox--,h.next.y>t.y&&h.oy++,h.next.y<t.y&&h.oy--)}e.image(l.n,8+8*Math.floor(i%60/30),0,8,16,h.ox+s.I.w*t.x,h.oy+s.I.h*t.y-13,8,16)}};class g{constructor(e,t=0,i=0){this.target=e.getContext("2d"),this.shadow=e.cloneNode().getContext("2d"),this.queue=[[],[],[]],this.offsetX=t,this.offsetY=i,window.on("resize",r)}alpha(e){this.queue[this.layer].push(["a",e])}color(e="black",t="black"){this.queue[this.layer].push(["col",e,t])}image(e,t,r,i,a,n,o,s,l,h=[]){this.queue[this.layer].push(["drawImage",e,t,r,i,a,n,o,s,l,...h])}line(e,t,r,i,a){this.queue[this.layer].push(["beginPath"]),this.queue[this.layer].push(["moveTo",e,t]),this.queue[this.layer].push(["lineTo",r,i]),this.queue[this.layer].push(["stroke"])}lineWidth(e){this.queue[this.layer].push(["lineWidth",lineWidth])}rect(e,t,r,i,a=[],n="fill"){this.queue[this.layer].push([n+"Rect",e,t,r,i,...a])}update(){var e=this.queue.flat();let t=this.shadow;t.clearRect(0,0,65535,65535),t.translate(this.offsetX,this.offsetY);for(let r of e)switch([e]=r,e){case"a":[,t.globalAlpha]=r;break;case"col":[,t.strokeStyle,t.fillStyle]=r;break;case"lineWidth":[,t.lineWidth]=r;break;default:let[,...i]=r;t[e](...i)}t.setTransform(1,0,0,1,0,0),this.refresh(),this.queue=[[],[],[]]}refresh(){this.target.canvas.height=this.shadow.canvas.height,this.target.canvas.width=this.shadow.canvas.width,this.target.clearRect(0,0,65535,65535),this.target.drawImage(this.shadow.canvas,0,0)}drawEntities(e){this.layer=2,e.sort(((e,t)=>e.y-t.y)).forEach((e=>f[e.type](this,e)))}drawGrid(){let e=this.layer=0;for(var t=0;t<=s.k.h;){let e=6*t+.5;this.color("hsla(278, 19%, 25%, 0.5)","transparent"),this.line(0,e,97,e),t+=1}for(;e<=s.k.w;)t=8*e+.5,this.color("hsla(278, 19%, 25%, 0.5)","transparent"),this.line(t,0,t,97),e+=1}drawMap(e,t,r,i){this.layer=1,e.render(this,t,r,i)}drawPlacement(){let{currentTile:e,map:t,placeX:r,placeY:i}=d;this.drawMap(t.tiles[e],r,i,t)}}h=e.p+"d7b19c24a82c7325789d323586e9ff6a.png";let w=new Image,x={loaded:0};w.src=h,w.on("load",(()=>x.loaded=1));let b={h:5,w:4},v={a:[0],b:[4],c:[8],d:[12],e:[16],f:[20],g:[24],h:[28],i:[32,1],j:[33],k:[37],l:[41],m:[45,5],n:[50,5],o:[55],p:[59],q:[63],r:[67],s:[71],t:[75,5],u:[80],v:[84],w:[88,5],x:[93],y:[97],z:[101],0:[105],1:[109,1],2:[110],3:[114],4:[118],5:[122],6:[126],7:[130],8:[134],9:[138],":":[142,1],"!":[143,1],"?":[144,3],",":[147,1,6],"+":[148,3],"-":[151,3]," ":[154]};h=e.p+"04ffed43a95bd3d7bce07cd540dcf082.png";let S=new Image,T={loaded:0};S.src=h,S.on("load",(()=>T.loaded=1));let k={h:7,w:7},q={a:[0],b:[7],c:[14],d:[21],e:[28],f:[35],g:[42],h:[49],i:[56,2],j:[58],k:[65],l:[72],m:[79],n:[86],o:[93],p:[100],q:[107],r:[114],s:[121],t:[128,6],u:[134],v:[141],w:[148],x:[155],y:[162,6],z:[168],0:[175],1:[182,4],2:[186],3:[193],4:[200],5:[207],6:[214],7:[221],8:[228],9:[235],":":[242,2],"!":[244,2],"?":[246],"-":[253,5]," ":[258]},M={awkward:n,thaleah:o},I=(e,t="awkward",r)=>{let{characterDefaults:a,coords:n,fontImage:o,state:s}=M[t],l=e.toLowerCase().trim(),{stringCoords:h,stringHeight:c,stringWidth:d}=l.split("").reduce(((e,r,i)=>{let o={...a};return n[r]||(console.log(`No glyph exists for the '${r}' character in the '${t}' font`),r="?"),n[r].map(((e,t)=>void 0!==e?o["xwh"[t]]=e:0)),e.stringCoords.push(o),e.stringHeight=Math.max(e.stringHeight,o.h),e.stringWidth+=o.w,i!==l.length-1&&(e.stringWidth+=1),e}),{stringCoords:[],stringHeight:0,stringWidth:0}),u=(e=document.createElement("canvas")).getContext("2d");return e.classList.add("text"),e.setAttribute("width",d),e.setAttribute("height",c),e.style.width=d,e.style.height=c,s.loaded?i(h,o,u,r):o.on("load",(()=>i(h,o,u))),e},E=[];class A{appendChild(e){this.node.appendChild(e)}constructor(e){let{onHide:t,onInit:r,onShow:i,selector:a}=e;E.push(this),this.node=document.querySelector(a),this.onHide=t,this.onShow=i,r&&r.call(this)}hide(){this.node.setAttribute("hidden",1),this.onHide&&this.onHide()}show(e){E.forEach((e=>{e.hide()})),this.node.removeAttribute("hidden"),this.onShow&&this.onShow(e)}}n=document.querySelector("canvas");let L=new g(n,0,14),H=new A({onHide(){d.paused=1,m=0},onInit(){let e=this.node.querySelector("#current-score .value"),t=this.node.querySelector("#current-tile"),r=this.node.querySelector("#high-score"),i=this.node.querySelector("#level-recap"),n=this.node.querySelector("#next-tile"),o=this.node.querySelector("#next-level"),l=this.node.querySelector('[data-action="quit"]'),h=this.node.querySelector("#reset"),c=this.node.querySelector("#retry"),u=this.node.querySelector("#skip-timer"),m=this.node.querySelector("#tiles-remaining"),f=this.node.querySelector("#tutorial-message");this.timers=[];let w=()=>{if(!d.isVictory&&!d.paused){let e=performance.now(),{currentTile:t,entities:r,map:i}=d;d.frame+=1,L.drawGrid(),L.drawMap(i),L.drawEntities(r),t<i.tiles.length&&L.drawPlacement(),L.update(),function(e){let{isVictory:t,lastTimerUpdate:r,mapIndex:i,timeRemaining:a,tutorial:n}=d,o=document.querySelector("#skip-timer"),s=document.querySelector("#play-info time");if(n&&2>i)s.innerHTML="0:00";else if(!t&&1e3<=e-r){var l=Math.abs(Math.floor(a/1e3));let t=(""+l%60).padStart(2,"0");l=Math.floor(l/60);let r="-";0>=a&&(r="",o.setAttribute("hidden",1)),s.innerHTML=`${r}${l}:${t}`,d.timeRemaining-=1e3,d.lastTimerUpdate=e}}(e);let[a,n]=d.entities.reduce(((e,t)=>{switch(t.type){case"exit":e[1].push(t);break;case"robot":e[0].push(t)}return e}),[[],[]]);n.every((e=>a.some((({x:t,y:r})=>t===e.x&&r===e.y))))&&(d.isVictory=1)}requestAnimationFrame(w)},x=()=>{let{currentTile:e,map:r}=d;[t,n].forEach(((t,i)=>{i=r.tiles[e+i];let a=t.querySelector(".target");if(a.innerHTML="",i){let e=document.createElement("canvas");e.height=i.size.h*s.I.h+2,e.width=i.size.w*s.I.w;let r=new g(e,0,1);r.drawMap(i),r.update(),a.appendChild(e),t.removeAttribute("hidden")}else t.setAttribute("hidden",1)}));let i=e/r.tiles.length*100,a="#64b964";50<=i&&(a="#e6c86e"),75<=i&&(a="#d77355"),m.style.setProperty("--p",e/r.tiles.length*100+"%"),m.style.setProperty("--c",a)};l.on("click",(()=>C.show())),u.on("click",(({target:e})=>{p.earlyStartBonus+=d.timeRemaining,d.timeRemaining=0,e.blur(),e.setAttribute("hidden",1)})),o.on("click",(()=>d.map=a())),h.on("click",(({target:e})=>{e.blur(),d.map.reset(),d.entities=d.map.objects,d.currentTile=0})),c.on("click",(()=>d.map=d.mapIndex)),p.on("change",(()=>{e.innerText!=p.preTotal&&(e.innerText=p.preTotal)})),d.on("change:currentTile",x),d.on("change:map",(()=>{let{map:t}=d;if(t&&(this.timers.map(clearTimeout),this.node.querySelector("#level-index").innerHTML=(d.mapIndex+1+"").padStart(2,"0"),e.innerHTML=0,d.highScore?(r.querySelector(".value").innerHTML=d.highScore,r.removeAttribute("hidden")):r.setAttribute("hidden",1),i.setAttribute("hidden",1),x(),tutorial&&(f.innerHTML="",d.tutorial))){let e=[[["Use the arrow keys","or W, A, S, and D","to move the placer"],["Press the Space Bar","to place a tile"],["Press the Enter key","to start the bot"],["Build a bridge so it","can reach the portal"]],[["Dark blocks are","corrupted"],["The bot cannot","move on them"],["Build your bridge","around them instead"]],[["Watch your timer!"],["The bot will start","moving when the","timer hits 0"],["You will earn bonus","points for starting","before the timer ends"]]],t=r=>{var i=e[d.mapIndex];i&&(i=i[r],f.innerHTML="",i?(i.map((e=>{let t=document.createElement("div");t.innerHTML=e,f.appendChild(t)})),f.removeAttribute("hidden"),this.timers.push(setTimeout(t,3e3,r+1))):f.setAttribute("hidden",1))};t(0)}})),d.on("change:isVictory",(()=>{if(d.isVictory){(e=>{e.querySelectorAll("[data-score]").forEach((e=>{e.innerHTML=p[e.getAttribute("data-score")]})),e.querySelector("#final-score .value").innerHTML=p.total})(i);var t=`TS:NF:${d.mapIndex}::high-score`;if(localStorage.setItem(t,Math.max(localStorage.getItem(t),p.total)),e.innerHTML=p.total,f.innerHTML="",this.timers.map(clearTimeout),t=a()){const e=y();-1==e.indexOf(t)&&localStorage.setItem("TS:NF:unlockedLevels",JSON.stringify([...e,t]))}else o.setAttribute("hidden",1);i.removeAttribute("hidden")}})),w()},onShow(){m=1,d.paused=0},selector:"#game"}),C=new A({onInit(){this.node.querySelector("#tutorial").on("click",(()=>{d.tutorial=1,d.map=0,H.show()}))},onShow(){let e=this.node.querySelector("#maps");e.innerHTML="";let t=({target:e})=>{d.tutorial=0,d.map=+e.getAttribute("data-value"),H.show()};this.node.querySelector(".back").addEventListener("click",(()=>R.show())),y().forEach((r=>{let i=c[r],a=document.createElement("li"),n=document.createElement("div"),o=document.createElement("div");n.innerHTML=(r+1+"").padStart(2,"0"),o.innerHTML=" - "+i.name,a.classList.add("map"),a.setAttribute("data-value",r),n.setAttribute("data-value",r),o.setAttribute("data-value",r),a.on("click",t),a.appendChild(n),a.appendChild(o),e.appendChild(a)}))},selector:"#map-select"}),R=new A({onInit(){this.node.querySelector("#start").on("click",(()=>C.show()))},selector:"#main-menu"});(()=>{function e(e=document.documentElement){3===e.nodeType&&(e=e.parentNode),e=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode({data:e}){if(e.trim())return NodeFilter.FILTER_ACCEPT}},0);for(var t=null;t=e.nextNode();){if(t=t.parentNode,["SCRIPT","STYLE"].includes(t.tagName))continue;var r=(t.getAttribute("data-font")||"awkward").toLowerCase();/^h\d$/iu.test(t.nodeName)&&(r="thaleah");let e=t.querySelector("canvas");e&&t.removeChild(e),r=I(t.innerText,r,t.classList.contains("danger")),t.style.fontSize=0,t.appendChild(r)}}let t=t=>{let{addedNodes:r,type:i}=t;"childList"===i&&r.length&&r.forEach((t=>e(t)))};new MutationObserver(((e,r)=>{e.forEach(t)})).observe(document.documentElement,{childList:1,subtree:1}),r(),e(),R.show()})()})()})()}()</script>