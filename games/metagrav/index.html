<head><title>METAGRAV</title><meta name="author" content="Xavier Cooney"><style>#c{position:fixed;left:0;top:0;width:100%;height:100%;z-index:-9;font-variant-ligatures:no-common-ligatures;}</style></head><body><canvas id="c"></canvas><script>'use strict';const aa=document.getElementById("c"),a=aa.getContext("2d");let e=600,g;function ba(){let b=e*aa.clientWidth/aa.clientHeight;aa.width=b;aa.height=e;g=1E3*b/e;ca=g-150}window.addEventListener("resize",ba);ba();function h(b,c,d){return b+Math.max(0,Math.min(1,d))*(c-b)}function l(b,c){return h(b,c,Math.random())}function da(b){return b[Math.floor(Math.random()*b.length)]}function ea(b){return 2*Math.abs(b-Math.floor(b+.5))}
let n=0,r=0,t=0,u=500,v=1,w=0,fa=-Infinity,x=1,z=1,B=0,ha=0,ia=!1,D=500;var ca;let E=-Infinity,F=0,ja=-Infinity,ka=1,la=-Infinity,G=0,H=0,I=0,ma=0;const J=[[30,0],[0,-20],[-40,-20],[-60,-30],[-70,-40],[-80,-40],[-80,-30],[-70,-30],[-60,-20],[-60,20],[-70,30],[-80,30],[-80,40],[-70,40],[-60,30],[-40,20],[0,20]];let na=[],oa=0,K=[],L=600,M=[],pa=!1,qa=!1,N=Number(window.localStorage["xav-space-js13k-graphics"]);[0,1,2].includes(N)||(N=1);e=[1E3,600,300][N];ba();
function O(b,c,d,f){return`rgba(${b}, ${c}, ${d}, ${f})`}function ra(){return h(l(-20,20),0,(n-fa)/3)}let P=[],Q=[],R=[],S=Infinity;const sa=[1,3,5,6,8,10,12];let ta=!0,ua=!1;function va(){for(let d=0;d<[1200,750,200][N];++d){var b=d**4.7,c=1.9*b%500*g/500;const f=b%501*1E3/501;a.beginPath();b=b%6*Math.sin(d+n*(d%2?.9:.8))**2;a.arc(c,f,b/2*[.8,1,1.8][N],0,2*Math.PI);c=42*b;a.fillStyle=O(c,c,c,c);a.fill()}}function wa(b){return`${b}px 'Press Start 2P', monospace`}
function xa(){return 4==G?"#ff7575":7==G?"#97fcd1":"#f7c65c"}function ya(){return 5==G||6==G||8==G||10==G||12==G}
function za(b,c,d,f){if(!(ya()||1<=d)){a.save();a.translate(h(b,r,f),h(c,u,f));a.beginPath();a.arc(0,0,h(40,0,d),0,2*Math.PI);a.lineWidth=8;a.fillStyle=xa();a.strokeStyle=4==G?"#ff0000":7==G?"#00f02c":"#fff700";a.fill();a.stroke();a.lineWidth=2;a.lineCap="round";for(b=5.6;32>b;b+=7)c=n*b/10,a.beginPath(),a.arc(0,0,h(b,0,d),c+Math.PI/4,c+3*Math.PI/4,!1),a.stroke(),a.beginPath(),a.arc(0,0,h(b,0,d),c+5*Math.PI/4,c+7*Math.PI/4,!1),a.stroke();a.restore()}}
function Aa(){return.1>n-la?1:9==G?1>n-E?h(0,.08,n-E):h(.08,0,(n-E-1)/4):1==F?1>n-E?h(0,.7,n-E):h(.7,0,(n-E-1)/5):0==G?.002:[4,5,6,7,8].includes(F)?.5>n-E?h(0,.9,n-E):h(.9,0,(n-E-.5)/6.5):10==F?h(.3,0,n-E):0}let Ba=null;
function Ca(){a.save();var b=Aa();if(0==b)Ba=null;else{a.globalAlpha=b;a.translate(ca,D+h(l(-20,20),0,(n-la)/2));1==F&&(a.rotate(Math.PI),a.translate(ca-300,0));b=new Path2D;b.arc(120*Math.sqrt(2)+5,0,250,3*Math.PI/4,5*Math.PI/4,!0);a.fillStyle="#b400eb";a.fill(b);Ba=b;a.beginPath();a.moveTo(0,-180);a.quadraticCurveTo(-40,0,0,180);for(b=0;1>=b;b++)for(let c=b?1:0;b?0<c:1>c;c+=b?-.02:.02){const d=7*Math.sin(c*Math.PI)*Math.sin(10*c+5*n);a.lineTo(h(0,90,c)+d,h(b?-180:180,0,c)+70*d/120)}a.closePath();
a.fillStyle="#FFF";a.lineJoin="round";a.strokeStyle="#DDD";a.lineWidth=4;a.fill();a.clip();a.fillStyle="#329ba8";a.beginPath();b=Math.sin(n);a.arc(0,30*(0<b?1:-1)*Math.pow(Math.abs(b),.7),40,0,2*Math.PI);a.fill()}a.restore()}
function Da(){a.save();a.scale(e/1E3,e/1E3);a.fillStyle="#111";a.fillRect(0,0,g,1E3);const b=[0,1].includes(G)?0:2==G?h(0,150,4*(I-.2)):150;a.translate(b,0);va();for(var c=0;70>c;++c){a.beginPath();const d=1-c/70;a.arc(((c+7)**5.1+-1*t*Math.pow(1.4*(1-d),2))%(2*g)-g/2,2E3-(h(80,160,(c+6)**5.5%1)+60*d),1E3,0,2*Math.PI);const f=h(1,.6,d);a.fillStyle=O(f*h(250,250,d),f*h(90,175,d),f*h(62,62,d),h(1,1,d));a.fill()}a.save();a.translate(-t,0);a.save();M.forEach(d=>{a.beginPath();a.moveTo(d.x,d.y);for(let f=
0;f<=d.w;f+=2)a.lineTo(d.x+f,d.y+6*Math.sin((d.x+f)/d.s));a.lineWidth=2;a.strokeStyle=d.f?"#00ff26":"#bc42f5";a.stroke()});ya()&&(a.globalAlpha=h(1,0,.8*I));K.forEach(d=>{d.r()});a.restore();a.restore();na.forEach(d=>{a.beginPath();const f=n-d.t;a.arc(d.x-t,d.y,h(4,30,f/2),0,2*Math.PI);a.fillStyle=O(210,h(50,120,f),0,1);a.fill()});0!=G&&(a.save(),c=(Math.sin(n*Math.PI*10)+1)/2*h(1,0,(n-fa)/3),a.fillStyle=O(h(255,176,c),h(255,12,c),h(255,12,c),1),a.strokeStyle=O(h(240,176,c),h(240,12,c),h(240,12,c),
1),a.translate(r-t+ra(),u+ra()),a.beginPath(),a.moveTo(...J[0]),J.forEach((d,f)=>{0!=f&&a.lineTo(...d)}),a.closePath(),a.lineJoin="round",a.lineWidth=5,a.fill(),a.stroke(),pa&&(a.beginPath(),a.moveTo(30,0),a.lineTo(20,20/3),a.lineTo(20,-20/3),a.closePath(),a.fillStyle="#00ff26",a.strokeStyle="#00ff26",a.fill(),a.stroke()),a.fillStyle="#3BE",a.fillRect(-6,-8,10,16),0==v?a.fillRect(-24,-8,10,16):(a.beginPath(),a.moveTo(-19,8*v),a.lineTo(-28,8*-v),a.lineTo(-10,8*-v),a.closePath(),a.fill()),a.fillRect(-42,
-8,10,16),a.restore());0==G&&(a.fillStyle=O(255,255,255,h(0,1,I/1-1)),a.textAlign="center",a.textBaseline="hanging",a.font=wa(68+16*Math.sin(1.3*n-1.3)),a.fillText("METAGRAV",g/2,50),c=h(-150,0,n-2),a.fillStyle=O(255,255,255,h(0,1,I/1-2)),a.font=wa(40),a.fillText("Press [SPACE] to Start",g/2,300+c),a.fillText(`AUDIO ${Ea()?"MUTED":"ON"} (switch with [m])`,g/2,380+c),a.fillText(`GRAPHICS ${["FANCY","NORMAL","BASIC"][N]} (switch with [g])`,g/2,460+c),a.fillText("A game by Xavier Cooney for js13k-games",
g/2,620+c));a.save();a.translate(-b,0);Ca();a.restore();![0,1].includes(G)&&0<b&&(a.fillStyle="#111",a.fillRect(-b,0,b,1E3),a.strokeStyle="#EEE",a.beginPath(),a.moveTo(0,0),a.lineTo(0,1E3),a.lineWidth=10,a.stroke(),a.fillStyle="#7d1111",a.fillRect(-100,40,50,700),c=700*z,a.fillStyle="#ff1919",a.fillRect(-100,740-c,50,c),0<ha&&(za(-b/2,860,0,0),a.fillStyle=xa(),a.font=wa(20),a.textAlign="center",a.textBaseline="hanging",a.fillText(`${B}/${ha}`,-b/2,930)));a.translate(-b,0);if(sa.includes(G)){let d=
h(g+10,g-700-50,I+(ya()?-2:0));a.fillStyle="#DDD";a.fillRect(d,50,700,900);a.strokeStyle="#888";a.lineWidth=10;a.lineJoin="round";a.strokeRect(d,50,700,900);let f=0;P.forEach((p,k)=>{a.font="30px 'Press Start 2P', monospace";a.textAlign="left";a.textBaseline="hanging";a.fillStyle="#000";a.fillText(p,d+20,70+f);const q=a.measureText(p+"|");f+=q.actualBoundingBoxDescent+q.actualBoundingBoxAscent+9;k==P.length-1&&0==Q.length&&0<R.length&&(p=a.measureText(p+" "+R[0]).width,"\n"==R[0]?(R.shift(),P.push("")):
660>p?(Q="#"!=R[0]?(R[0]+" ").split(""):["#"],R.shift()):P.push(""))});P.length&&!Q.length&&!R.length&&ua&&(a.font="italic 20px 'Press Start 2P', monospace",a.textAlign="center",a.textBaseline="bottom",a.fillStyle="#000",a.fillText("[SPACE] to continue",d+350,930))}a.restore()}let T,U,Fa,Ga;function Ea(){return"y"==window.localStorage["xav-space-js13k-mute"]}
function Ha(){const b=T.currentTime+.3,c=T.createOscillator();c.type="sawtooth";c.frequency.value=880;c.frequency.exponentialRampToValueAtTime(110,b);c.start(T.currentTime);c.stop(b);const d=T.createGain();d.gain.setValueAtTime(.2,T.currentTime);d.gain.exponentialRampToValueAtTime(.01,b);c.connect(d).connect(U)}let Ia=null;
function Ja(){var b=1.5*T.sampleRate;if(null===Ia){var c=T.createBuffer(1,b,T.sampleRate),d=c.getChannelData(0);let f=0,p=0;for(let k=0;k<b;k++)f+=1200*Math.pow(.5,k/T.sampleRate)/T.sampleRate,1<f&&(f-=Math.floor(f),p=l(-1,1)),d[k]=p;Ia=c}b=T.createBufferSource();b.buffer=Ia;c=T.createBiquadFilter();c.type="lowpass";c.frequency.value=440;d=T.createGain();d.gain.setValueAtTime(4,T.currentTime);d.gain.linearRampToValueAtTime(0,T.currentTime+1.5);b.connect(c).connect(d).connect(U);b.start(T.currentTime)}
const Ka=[0,0];function La(b){for(;10>Ka[b]-T.currentTime;){var c=da([1,1.5,.75,1.125,2/3]);const d=T.createOscillator();d.type=b?"sine":"sawtooth";d.frequency.value=220*c;d.start(Ka[b]);c=60*da([1,1,1,1,.5,2])/70;d.stop(Ka[b]+c+.03);const f=T.createGain();f.gain.setValueAtTime(b?.6:.065,Ka[b]);f.gain.linearRampToValueAtTime(.03,Ka[b]+c);d.connect(f).connect(U);Ka[b]+=c}}function Ma(){La(0);La(1);setTimeout(()=>Ma(),100)}let Na=0;function V(b){0==P.length&&(P=[""]);R.push(...b.split(" "))}
function W(b){V(b);R.push("\n")}function X(b){u-=(u-250)/3*b;v=w=0}function Oa(b){2>n-fa||ya()&&10!=G||(2==G||sa.includes(G)||10==F?(x*=1-b,x=Math.max(x,.05)):(x-=b,x=Math.max(0,x),0>=x&&(Pa=G,Y(5))),fa=n,Ja())}
function Qa(b){const c=T.currentTime+5,d=T.createOscillator();d.type="sine";d.frequency.value=450*b+5*Math.random();d.frequency.exponentialRampToValueAtTime(430*b+3*Math.random(),c);d.start(T.currentTime);d.stop(c);b=T.createGain();b.gain.setValueAtTime(.9,T.currentTime);b.gain.exponentialRampToValueAtTime(1E-4,c);d.connect(b).connect(U)}let Pa;
function Ra(b,c){function d(){const q=40*Math.sin(3*n+p),m=(n-k)/3;return O(h(89,210+q,m),h(228,54,m),h(54,228+q,m),1)}function f(){const q=new Path2D;q.moveTo(p,b);for(let m=b;m<=b+c;m+=[1,2,4][N]){let y=5*(ea(m/100+n)-.5)+(ea(m/30-3*n)-.5);y*=6;y*=ea((m-b)/c);q.lineTo(p+y,m)}a.lineWidth=12+4*Math.cos((r-p)/100);a.strokeStyle=d();a.lineCap="round";return q}const p=L;let k=-1;return{x:p-100,w:200,y:b-100,h:c+200,r:()=>{function q(y,C){a.beginPath();a.arc(p,y,C,0,2*Math.PI);a.fill()}a.beginPath();
a.fillStyle=d();var m=h(16,12,.5+.5*Math.cos((r-p)/100));q(b,m);q(b+c,m);m=f();a.stroke(m);a.lineWidth=3;a.strokeStyle="#3d36ff";a.stroke(m)},i:()=>{const q=f();for(let m=0;m<J.length;++m)a.isPointInStroke(q,J[m][0]+r,J[m][1]+u)&&Oa(.25)},j:()=>{k=n},m:b,u:c,l:p}}
function Sa(b){function c(y){return 1.3*(Math.sin(5*y+.5*n)+Math.sin(6*y-.7*n)+.5*Math.sin(11*y+10*n))}function d(){const y=new Path2D;y.moveTo(f+p+c(0),b);for(let C=0;C<=2*Math.PI;C+=[.06,.08,.15][N])y.lineTo(f+(p+c(C))*Math.cos(C),b+(p+c(C))*Math.sin(C));y.closePath();a.lineWidth=4;return y}var f=L;const p=l(15,25),k=b,q=f;let m=l(-.1,.5);.6>Math.random()&&(m=0);m=0;K.push({x:f-20,y:b-20,w:40,h:40,r:()=>{a.strokeStyle="#3d130a";const y=d();let C=a.createRadialGradient(f,b,0,f,b,p);C.addColorStop(0,
"#66291c");C.addColorStop(1,"#964230");a.fillStyle=C;a.fill(y);a.stroke(y)},i:()=>{const y=d();for(let C=0;C<J.length;++C)a.isPointInPath(y,J[C][0]+r,J[C][1]+u)&&Oa(1/9)},g:()=>{b=k+(r-q)*m;f=q+0*(r-q)}})}
function Ta(b,c){if(!(.6<Math.random())&&2!=G&&11!=G){var d=Infinity,f=!1;K.push({x:b-40,w:80,y:c-40,h:80,r:()=>{za(b,c,h((Math.sin(3*n)+1)/10,1,(n-d)/.4),(n-d)/.42)},i:()=>{d=Math.min(d,n);if(!f&&(f=!0,!sa.includes(G)&&!ya())){B+=1;const p=T.currentTime+.3,k=T.createOscillator();k.type="square";k.frequency.value=440;k.frequency.exponentialRampToValueAtTime(3520,p);k.start(T.currentTime);k.stop(p);const q=T.createGain();q.gain.setValueAtTime(1,T.currentTime);q.gain.exponentialRampToValueAtTime(.01,
p);k.connect(q).connect(U);B==ha?4==G?Y(6):7==G?Y(8):9==G&&Y(10):9==G&&[4,8,10,12].includes(B)&&(E=n)}}})}}
function Ua(){var b=Math.random(),c=L;if(.1>b)K.push(Ra(l(0,450),l(250,350))),L+=700;else if(.5>b)for(b=c+(2==G?1E3:l(1800,3200));L<=b;)c=Math.random(),.2>c?(K.push(Ra(250,400)),Ta(L+300,450),L+=l(650,800)):.4>c?(K.push(Ra(-100,650)),Ta(L+300,300),L+=l(700,800)):.6>c&&(K.push(Ra(250,1750)),Ta(L+300,600),L+=l(700,800));else if(.9>b&&2!=G){L+=50;for(b=0;60>b;++b)c=l(0,h(125,420,b/20)),.5<Math.random()&&(c=840-c),100<c&&740>c&&.85<Math.random()?(L+=80,Ta(L,c),L+=120):(L+=80,Sa(c));L+=300}}
function Z(){H+=1;P=[];ua=ta=!0}
function Va(b){n+=b;I+=b;if(0==G)D=500+50*Math.sin(n/3);else{.2<n-oa&&([-35,35].forEach(f=>{na.push({x:r-80+ra(),y:u+f+ra(),o:-5,v:w/3,t:n})}),oa=n);na.forEach(f=>{f.x+=f.o*b});na.length&&na[0].x+200<t&&na.shift();r+=330*b;t=Math.max(600,r)-600;w+=v*b*1E3;u+=w*b;12!=G&&(60>u?(u=60,w=0):120>u&&0>w&&(w+=-15*b*w));850<u&&(u-=50,w=0,Oa(.2),v=-1);var c=r-100,d=u-40;ya()||K.forEach(f=>{f.g&&f.g(b);f.x<c+150&&f.x+f.w>c&&f.y<d+80&&f.y+f.h>d&&f.i()});M.forEach(f=>{f.g(f,b)});for(M=M.filter(f=>-10<f.w&&f.x-
t<g+500&&-500<f.x+f.w-t);M.length;)if(M[0].x-t>g+20)M.shift();else break;for(;K.length&&K[0].x+K[0].w<t;)K.shift();if(0!=G)for(;L<t+g+100;)sa.includes(G)||2==G&&1==H?L+=100:Ua();z>x?z-=Math.min(.5*b,z-x):z<x&&(z+=Math.min(b/2,x-z));ia&&5!=G&&(x+=b/(11==G?60:80),x=Math.min(x,1));if(Q.length&&(5!=G||2<I))if("#"==Q[0]){if(qa||.5<n-Na)Q.shift(),qa||(Na+=.5)}else if(qa||.05<n-Na)Na=Math.max(Na,n-3*.05),Fa.frequency.cancelScheduledValues(T.currentTime),Fa.frequency.setValueAtTime(700,T.currentTime),Fa.frequency.linearRampToValueAtTime(100,
T.currentTime+.04),Ga.gain.cancelScheduledValues(T.currentTime),Ga.gain.setValueAtTime(.12,T.currentTime),Ga.gain.linearRampToValueAtTime(0,T.currentTime+.04),qa||(Na+=.05),P[P.length-1]+=Q[0],Q.shift();0!=Q.length||0!=R.length||ua?S=Infinity:(S=Math.min(S,n),qa=!1);1==G?(X(b),u=250,0==H&&1<I?(W("[HYPERSPACE ANOMALY DETECTED] \n"),W("# [STARTING SHIP AI] \n"),W("# # # Hello there, # I am OSCAR, your Onboard Ship Computational Analysis Reporter. Please standby... \n"),H=1):1==H&&2<n-S?(r=-300,W("ALERT! Exiting hyperspeed!"),
ta=!1,ua=!0,H=2):2==H&&.3<n-S?(Z(),W("I have detected some good news and some bad news. # The bad news is that the ship has exited hyperspace onto a planet 200 parsecs away from the target desination. # The good news is that all the ship's systems are intact...")):3==H&&.1<n-S?(fa=n,Ja(),Z(),W("# # # # Update: I was wrong. It's all bad news actually. # Almost every control is scrambled. In fact, the only thing that's working seems to be the internal gravitational actuator. # I've wired up the [SPACE] button on your control matrix to it. The orbital navigation system should keep you from flying up to outer space, but uhhhh still... # be careful.")):
4==H&&.3<n-S&&(L+=900,K.push(Ra(-20,500)),L+=500,Y(2))):3==G?(X(b),0==H?(Z(),V("Hi. OSCAR here again. I realised I should've probably warned you about the plasma arcs usually found in this planetary system, "),1>x?V("sorry. Regardless, as a rule of thumb, I advise tring not to hit big scary looking stuff. # # Or small scary looking stuff."):V("but it looks like you've already got that handled. Good job.")):1==H&&.1<n-S?(Z(),V("To get out of here, you'll need to collect some materials. # Try to pick up any red coloured part bundles you find, # and if you get enough I might be able to fix the ship's hull regeneration system."),
1>x&&V("And try not to hit anything else.")):2==H&&.1<n-S&&Y(4)):5==G?(X(b),0==H&&2<I?(x=1,Z(),V("Well it looks like the hull's been severly damaged. Luckily I phase shifted the ship into a different timeline right before the engine exploded."),0==B?V("At least you didn't lose any of the parts you were gathering."):V(`Alas, you lost ${B} part${1==B?"":"s"} you were gathering.`),B=0):1==H&&.1<n-S&&(K=[],Y(Pa))):6==G?(X(b),0==H&&1.5<I?(B=0,Z(),V("Great work! Now I should be able to to repair the hull regenerator...")):
1==H&&.1<n-S?(Z(),ia=!0,V("Done! This should help with those meteorites that I probably should've warned you about. Next thing to fix is the ship's LASER, for that you'll need to collect green part bundles.")):2==H&&.1<n-S&&(K=[],Y(7)),X(b)):8==G?(X(b),0==H&&1.5<I?(B=0,Z(),W("Brilliant! LASER time!! \n \n # # Ummm, sorry, but I slightly exaggerated the need to repair the LASER. It isn't going to be particularly useful, but LASERs are so fun! # # Pew # pew # pew # pew! # # Anyway...")):1==H&&.1<n-
S?(Z(),pa=!0,W("I've wired up the LASER activation control to the same [SPACE] button on your key matrix to keep things simple. But really, it won't be of much use. The last parts to collect are the golden hyperdrive bundles, and then we should be able to jump out of here.")):2==H&&.1<n-S&&(K=[],Y(9))):10==G?(X(b),0==H&&1.9<I?(B=0,Z(),W("Great job! # Now all I have to do is enable the hyperdri-")):1==H&&.1<n-S?(K=[],E=n,F=1,H=2):2==H&&2==F?(Z(),W("What the volt was that!? It just shot at us! If it hits the ship as we go into hyperspeed, we'll definitely explode. \n \n Before we leave this planet, you'll need to make sure that thing is dead. I guess repairing the LASER was a good idea after all. After 5 cries it should be finished.")):
3==H&&.1<n-S&&(K=[],Y(11),E=n)):12==G?(0!=H&&1!=H||X(b),0==H&&1.9<I?(X(b),B=0,Z(),W("It's dead!! # # # I may have made a slight error though. # I think it was trying to communicate with us, my database shows this species use purple wavelengths as a substitute for speech. It didn't know it was hurting us. Whoops.")):1==H&&.1<n-S?(Z(),W("Congratulations player! The hyperdrive is repaird and your craft is now able to enter hyperspeed. \n \n Thanks for playing. Game made by Xavier Cooney, with sage advice from Gus. Feel free to reach out on my Github for feedback, etc.")):
2==H&&.1<n-S&&(v=w=0,u-=200*b)):0<G&&0==v&&(v=1);2==G&&(0==H&&r>ma+2E3?H=1:1==H&&0===K.length&&Y(3));if(1==F)D=h(2E3/3,-300,(n-E)/6),.2<n-ja&&(ja=n,Wa(t+160,D,1,!1)),6<n-E&&(F=2);else if(10==F)2<n-E&&(Y(12),F=-1);else if(11==G){if(9<n-E){let f=[3,4,5,6,7,8].filter(p=>p!=F);F=f[Math.floor(f.length*Math.random())];E=n}n-ja>1/3&&[6,7].includes(F)&&.5<n-E&&6.5>n-E&&(ja=n,Wa(ca+t,D,-1,!1));if(3==F)D=-1E3;else if(4==F||6==F)D=h(-300,900,(n-E)/7);else if(5==F)D=h(900,-300,(n-E)/7);else if(7==F||8==F)D=u}}}
function Y(b){0==G&&(r=-1E20,na=[],T=new AudioContext,U=T.createGain(),U.gain.value=window.localStorage["xav-space-js13k-mute"]?0:.8,U.connect(T.destination),Fa=T.createOscillator(),Fa.type="triangle",Ga=T.createGain(),Ga.gain.value=0,Fa.connect(Ga).connect(U),Fa.start(),Ma());4==b?ha=8:7==b?(ha=12,ia=!0):9==b?(ha=16,pa=!0):ha=0;G=b;I=H=0;ma=L}let Xa=new Date/1E3;
function Ya(){var b=new Date/1E3;let c=Math.max(Math.min(b-Xa,1/15),0);window.A=c/(1/15);Xa=b;b=1+Math.ceil(c/.03);for(let d=0;d<b;++d)Va(c/b);Da();requestAnimationFrame(Ya)}Ya();
function Wa(b,c,d,f){let p=null;M.push({x:-1==d?b-80:b,y:c,w:80,s:5,f,g:(k,q)=>{null!==p?(k.x+=d*q*700,k.w-=900*q):(k.x+=d*q*700,k.w+=100*q);if(null===p)if(K.forEach(m=>{m.j&&k.x<m.l&&m.l<k.x+k.w&&m.m<k.y&&k.y<m.m+m.u&&(m.j(),p=!0)}),f).05<Aa()&&null!==Ba&&a.isPointInPath(Ba,k.x+k.w-t-ca,k.y-D)&&(p=!0,3>n-la||(la=n,ka-=1/6,0>=ka&&(ka=0,F=10,E=n,Ja()),Qa(1),Qa(Math.sqrt(2)),Qa(2),Qa(2*Math.sqrt(2))));else{q=1==d?k.x+k.w:k.x;const m=9==G?35:25;r-70<q&&q<r+20&&u-m<k.y&&k.y<u+m&&(p=!0,Oa(1/15))}}});Ha()}
let Za=-1;window.addEventListener("keydown",b=>{"Space"==b.code?0>Za&&(Za=n,sa.includes(G)?!P.length||Q.length||R.length?ta&&(1==G||.3<I)&&(qa=!0):ua&&(ua=!1):0==G?Y(1):(v*=-1,w/=4,pa&&Wa(r,u,1,!0))):"KeyQ"==b.code?r+=0:"KeyM"==b.code?(b=!Ea(),window.localStorage["xav-space-js13k-mute"]=b?"y":"",U&&(U.gain.value=b?0:.8)):"KeyG"==b.code&&(N+=1,N%=3,window.localStorage["xav-space-js13k-graphics"]=N,e=[1E3,600,300][N],ba())});window.addEventListener("keyup",b=>{"Space"==b.code&&(Za=-1)});
</script></body></html>