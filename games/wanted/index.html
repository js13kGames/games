<title>Wanted - js13kGames 2023</title><canvas width=512 height=512></canvas><style>body{background:#000}canvas{border:1px solid #fff}</style><script>zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),i=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,i=220,a=0,r=0,h=.1,s=0,n=1,o=0,d=0,l=0,c=0,u=0,y=0,p=0,f=0,m=0,x=1,g=0,w=0)=>{let _,v,z=2*Math.PI,b=o*=500*z/zzfxR**2,E=(0<p?1:-1)*z/4,M=i*=(1+2*e*Math.random()-e)*z/zzfxR,A=[],F=0,R=0,S=0,k=1,C=0,L=0,X=0;for(a=99+zzfxR*a,g*=zzfxR,r*=zzfxR,h*=zzfxR,m*=zzfxR,d*=500*z/zzfxR**3,p*=z/zzfxR,l*=z/zzfxR,c*=zzfxR,u=zzfxR*u|0,v=a+g+r+h+m|0;v>S;A[S++]=X)++L%(100*f|0)||(X=s?1<s?2<s?3<s?Math.sin((F%z)**3):Math.max(Math.min(Math.tan(F),1),-1):1-(2*F/z%2+2)%2:1-4*Math.abs(Math.round(F/z)-F/z):Math.sin(F),X=(u?1-w+w*Math.sin(2*Math.PI*S/u):1)*(0<X?1:-1)*Math.abs(X)**n*t*zzfxV*(a>S?S/a:a+g>S?1-(S-a)/g*(1-x):a+g+r>S?x:v-m>S?(v-S-m)/h*x:0),X=m?X/2+(m>S?0:(v-m>S?1:(v-S)/m)*A[S-m|0]/2):X),_=(i+=o+=d)*Math.sin(R*p-E),F+=_-_*y*(1-1e9*(Math.sin(S)+1)%2),R+=_-_*y*(1-1e9*(Math.sin(S)**2+1)%2),k&&++k>c&&(i+=l,M+=l,k=0),!u||++C%u||(i=M,o=b,k=k||1);return A},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(i,a,r,t=125)=>{let h,s,n,o,d,l,c,u,y,p,f,m,x,g,w=0,_=[],v=[],z=[],b=0,E=0,M=1,A={},F=zzfxR/t*60>>2;for(;M;b++)_=[M=u=m=0],r.map((t,e)=>{for(c=a[t][b]||[0,0,0],M|=!!a[t][b],g=m+(a[t][0].length-2-!u)*F,x=e==r.length-1,s=2,o=m;s<c.length+x;u=++s){for(d=c[s],y=s==c.length+x-1&&x||p!=(c[0]||0)|d|0,n=0;F>n&&u;n++>F-99&&y&&(f+=(f<1)/99))l=(1-f)*_[w++]/2||0,v[o]=(v[o]||0)-l*E+l,z[o]=(z[o++]||0)+l*E+l;d&&(f=d%1,E=c[1]||0,d|=0)&&(_=A[[p=c[w=0]||0,d]]=A[[p,d]]||((h=[...i[p]])[2]*=2**((d-12)/12),0<d?zzfxG(...h):[]))}m=g});return[v,z]};var I=()=>{};function D(t,e){return-1!=(e=t.indexOf(e))&&(t.splice(e,1),1)}var e,x,j={};function T(t,e){j[t]=j[t]||[],j[t].push(e)}function g(t,...e){(j[t]||[]).map(t=>t(...e))}var B={get:(t,e)=>"_proxy"==e?1:I};function J(){return e}function u(){return x}var W=class{constructor({spriteSheet:t,frames:e,frameRate:i,loop:a=1,name:r}){var{width:h,height:s,margin:n=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:a,name:r,width:h,height:s,margin:n,isStopped:0,_f:0,_a:0})}clone(){return new W(this)}start(){this.isStopped=0,this.loop||this.reset()}stop(){this.isStopped=1}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;1<=this._a*this.frameRate;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}render({x:t,y:e,width:i=this.width,height:a=this.height,context:r=u()}){var h=this.frames[this._f]/this.spriteSheet._f|0,s=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,s*this.width+(2*s+1)*this.margin,h*this.height+(2*h+1)*this.margin,this.width,this.height,t,e,i,a)}};function O(){return new W(...arguments)}var U=/^\//,G=new WeakMap;function N(t,e){return new URL(t,e).href}function $(t,e){return[t.replace(/\/$/,""),t?e.replace(U,""):e].filter(t=>t).join("/")}function H(t){return t.split(".").pop()}function q(t){return 2==(t=t.replace("."+H(t),"")).split("/").length?t.replace(U,""):t}var s={},d={},r={};function V(){window.__k||(window.__k={dm:G,u:N,d:r,i:s})}function i(t,e,i){return Math.min(Math.max(t,i),e)}function K(t,e){return[t,e]=[t,e].map(t=>Z(t)),t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height}function Z(t){let{x:e=0,y:i=0,width:a,height:r}=t.world||t;return t.mapwidth&&(a=t.mapwidth,r=t.mapheight),t.anchor&&(e-=a*t.anchor.x,i-=r*t.anchor.y),a<0&&(e+=a,a*=-1),r<0&&(i+=r,r*=-1),{x:e,y:i,width:a,height:r}}var a=class{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new a(this.x+t.x,this.y+t.y,this)}subtract(t){return new a(this.x-t.x,this.y-t.y,this)}scale(t){return new a(this.x*t,this.y*t)}normalize(t=this.length()||1){return new a(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,a){this._c=1,this._a=t,this._b=e,this._d=i,this._e=a}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?i(this._a,this._d,t):t}set y(t){this._y=this._c?i(this._b,this._e,t):t}};function Q(){return new a(...arguments)}var t1=class extends class{constructor(t){return this.init(t)}init(t={}){this.position=Q(),this.velocity=Q(),this.acceleration=Q(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration,i=(t&&(e=e.scale(t)),this.velocity=this.velocity.add(e),this.velocity);t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}_pc(){}}{init({width:t=0,height:e=0,context:i=u(),render:a=this.draw,update:r=this.advance,children:h=[],anchor:s={x:0,y:0},opacity:n=1,rotation:o=0,scaleX:d=1,scaleY:l=1,...c}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:s,opacity:n,rotation:o,scaleX:d,scaleY:l,...c}),this._di=1,this._uw(),this.addChild(h),this._rf=a,this._uf=r,T("init",()=>{this.context??=u()})}update(e){this._uf(e),this.children.map(t=>t.update&&t.update(e))}render(){var t=this.context,e=(t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY),-this.width*this.anchor.x),i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map(t=>t.render&&t.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){var t,e,i,a,r,h;this._di&&({_wx:t=0,_wy:e=0,_wo:a=1,_wr:i=0,_wsx:r=1,_wsy:h=1}=this.parent||{},{x:i,y:h}=(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=a*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=i+this.rotation,a={x:this._wx,y:this._wy},r=i,h=Math.sin(r),r=Math.cos(r),{x:a.x*r-a.y*h,y:a.x*h+a.y*r}),this._wx=i,this._wy=h,this._wx+=t,this._wy+=e)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(t=>{this.children.push(t),t.parent=this,t._pc=t._pc||I,t._pc()})}removeChild(...t){t.flat().map(t=>{D(this.children,t)&&(t.parent=null,t._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=i(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}},e1=class extends t1{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...a}={}){super.init({image:t,width:e,height:i,...a})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function h(){return new e1(...arguments)}function i1(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}var a1={},r1={},h1={},n={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function s1(t=I,e){t._pd&&e.preventDefault(),t(e)}function t(t,e,{handler:i="keydown",preventDefault:a=1}={}){let r="keydown"==i?a1:r1;e._pd=a,[].concat(t).map(t=>r[t]=e)}function n1(t,{handler:e="keydown"}={}){let i="keydown"==e?a1:r1;[].concat(t).map(t=>delete i[t])}function o1(t){return[].concat(t).some(t=>h1[t])}function d1(t){if(+t==t)return t;let e=[],i=t.split(".."),a=+i[0],r=+i[1],h=a;if(a<r)for(;r>=h;h++)e.push(h);else for(;h>=r;h--)e.push(h);return e}function l1(t,e){return t/e|0}function c1(t,e){return t/e|0}var u1,o,l,y1=0,p1=0,c=0,f1=0,y=0,m1=0,x1=1e5,g1=0,w1=1,p=1,_1=()=>{o||((o=zzfxP(...u1)).loop=1,zzfxX.resume())},v1=()=>{o&&(o.stop(),o.disconnect(),o=null)};zzfxX.suspend(),t1=[[[,0,23,,,.2,3,5],[,0,740,.02,.12,.15,,.3,-.1,-.15,9,.02,,,.12,,.06],[.5,0,196,,.08,.5,3],[2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5]],[[[1,-.4,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,12,,,,12,,,,12,,,,12,,,,8,,,,8,,,,8,,,,8,,,,],[,-.7,13,,,,20,,,,21,,,,20,,,,13,,,,20,,,,21,,,,20,,,,20,,,,,,,,18,,,,,,,,16,,,,,,,,15,,,,,,,,],[2,.5,12,,14,,15,,12,,15,,19,,17,,15,,12,,14,,15,,12,,15,,19,,17,,15,,14,,,,14,,,,14,,,,14,,,,7,,,,7,,,,7,,5,,3,,2,,],[3,.8,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,13,13,13,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,,13,,]],[[1,.7,1,,,,8,,,,9,,,,8,,,,1,,,,8,,,,9,,,,8,,,,12,,,,12,,,,12,,,,12,,,,8,,,,8,,,,8,,,,8,,,,],[,-.7,13,,,,20,,,,16,,,,15,,,,13,,,,20,,,,16,,,,15,,,,20,,,,24,,,,21,,,,20,,,,16,,,,,,,,20,,18,,16,,15,,],[2,-.6,19,,17,,15,,12,,19,,17,,15,,12,,19,,17,,15,,12,,19,,17,,15,,12,,14,,15,,14,,12,,11,,12,,14,,15,,14,,15,,14,,12,,7,,5,,3,,2,,],[3,.8,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,13,13,13,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,,13,,]],[[1,-.7,,,,,,,,,,,,,,,,,16,,15,,13,,15,,16,,20,,18,,16,,,,,,,,,,,,,,,,,,8,,,,8,,,,8,,6,,4,,3,,],[,-.3,21,,20,,19,,20,,21,,20,,19,,20,,20,,19,,20,,21,,20,,22,21,20,,20,,19,,,,,,,,18,,,,,,,,16,,,,,,,,15,,,,,,,,],[2,.8,12,,14,,15,,12,,15,,19,,17,,15,,12,,14,,15,,12,,15,,19,,17,,15,,14,,,,14,,,,14,,,,14,,,,7,,,,7,,,,7,,5,,3,,2,,],[3,.8,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,13,13,13,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,,13,,]],[[1,.3,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,15,,,,15,,,,15,,,,15,,,,16,,,,16,,,,20,,,,20,,,,],[,,13,,,,20,,,,21,,,,20,,,,13,,,,20,,,,21,,,,20,,,,20,,,,27,,,,18,,,,25,,,,16,,,,21,,,,20,,24,,25,,24,,],[2,-.4,12,,14,,,,15,,15,,,,,,,,15,,17,,,,19,,19,,,,,,,,19,,20,,,,19,,19,,,,,,,,19,,17,,,,15,,14,,,,,,,,],[3,.8,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,13,13,13,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,,13,13,13,13,13,,13,,]]],[0,0,1,1,0,0,3,3,2,3,3,2,2],120,{title:"song1",instruments:["Dig Dug","Flute","Piano","Hihat"],patterns:["Phrase1","Phrase2","Phrase3","Phrase4"]}],(l=!!o)&&v1(),u1=zzfxM(...t1),l&&_1();var f,m,z1=h({x:256,y:256,width:250,height:180,anchor:{x:.5,y:.5},color:"#1D2B53"}),w=h({x:0,y:0,width:512,height:512,color:"",flash:0}),_=0,v="title",z=0,b=["steal from the rich","music on","sounds on","controls"],E="",b1=1,E1=1,M1=[,,,,,,,,,,,,,,1,1,1,,,,,,,,,,,,,,,1,1,,,,,,,,,,,,4,5,,1,1,,,,,,,,,,1,1,1,1,1,1,1,,,,,,,,8,,,,,,,1,1,,,,1,1,1,1,1,1,1,1,1,,,1,1,1,1,,,,,,,,,,,,,1,1,,,8,,,,,,,,,,,,1,1,,,1,1,1,1,1,1,1,1,,,,,1,1,4,5,,,,,,,,,,8,,,1,1,1,1,,,,,,,,,8,1,1,1,1,1,,,,,,,,,,1,1,,,,1,1,,,,,,,,,8,,,,,,1,1,,,1,1,1,1,1,1,1,1,1,1,,,1,1,,8,,,,,,,,,,,8,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],A1=[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3,1,1,1,1,1,1,1,1,2,1,2,,,,,3,1,,,1,,1,1,1,1,1,2,,,,,3,1,1,1,1,1,1,1,1,1,1,2,,,],M=[],A=(({contextless:t=0}={})=>{if(e=document.getElementById(void 0)||document.querySelector("canvas"),e=t?e||new Proxy({},B):e)return(x=e.getContext("2d")||new Proxy({},B)).imageSmoothingEnabled=0,g("init"),{canvas:e,context:x};throw Error("You must provide a canvas element for the game")})().context;{let t;for(t=0;t<26;t++)n["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)n["Digit"+t]=n["Numpad"+t]=""+t;window.addEventListener("keydown",function(t){var e=n[t.code],i=a1[e];h1[e]=1,s1(i,t)}),window.addEventListener("keyup",function(t){var e=n[t.code],i=r1[e];h1[e]=0,s1(i,t)}),window.addEventListener("blur",function(){h1={}})}var F,R,S=[],k=[],F1=[],R1=[],S1=[];function k1(){R.renderLayer("ground"),m.render(),S.forEach(t=>{t.render()}),X(Y,4,"*"+x1,32*S.length-8*S.length+12,8,"#FFF1E8"),k.forEach(t=>{t.render()}),F1.forEach(t=>{t.render()}),R1.forEach(t=>{t.render()}),S1.forEach(t=>{t.render()}),w.render()}function C1(){let i=0;S.forEach((t,e)=>{t.x=32*e-i,i+=8})}function C(t,e){let i=t.x-16,a=t.y,r=t.width,h=t.height,s=0,n=0,o=0,d=0;return"left"===e?(s=i-4,o=i,n=a+16,d=a+h-4):"right"===e?(s=i+r-4,o=i+r,n=a+16,d=a+h-4):"up"===e?(s=8+i,o=i+r-8,n=a+20,d=a+16):"down"===e&&(s=8+i,o=i+r-8,n=a+h,d=a+h),1===R.tileAtLayer("ground",{x:s,y:n})||1===R.tileAtLayer("ground",{x:s,y:d})||1===R.tileAtLayer("ground",{x:o,y:n})||1===R.tileAtLayer("ground",{x:o,y:d})}function L(t,e,i){t=h({x:32*t,y:32*e,dx:0,dy:0,max_dx:2,max_dy:4,width:32,height:32,scaleX:L1(),anchor:{x:.5,y:0},health:5,acc:.11,boost:4.7,checkJump:1,animations:f.animations,type:i,flash:0}),F1.push(t)}function L1(){return Math.random()<.5?-1:1}function X1(){t(["enter","z","x","space"],()=>{switch(z){case 0:if("title"===v){_=0,m.health=4,m.invisible=0,m.x=304,m.y=384,m.color="",x1=0,S=[],F1=[],R1=[],k=[],M=[],F.y=200,R.setLayer("bricks",M),R.renderLayer("bricks");var t,e=m.health;for(let t=0;e>t;t++){var i=h({x:0,y:0,width:32,height:32,type:"heart",animations:f.animations});S.push(i)}S.length===e&&(t=h({x:0,y:0,width:32,height:32,type:"coin",animations:f.animations}),S.push(t)),C1(),w.flash=0,L(9,4,"old"),L(13,6,"lady"),L(9,4,"old"),L(13,6,"lady")}else b.pop();v="game",z=0,P();break;case 1:w1=(b1=1-b1)?(b[1]="music on",1):(b[1]="music off",0),"title"===v&&P();break;case 2:p=(E1=1-E1)?(b[2]="sound on",1):(b[2]="sound off",0);break;case 3:E=v,v="controls",z=0;break;default:v=E="title",b[z=0]="Steal from the rich",b.pop(),P()}})}function X(e,r,i,h,s,n,o){A.imageSmoothingEnabled=0;var d=[];i=i.toUpperCase();for(let t=0;t<i.length;t++){var a=e[i.charAt(t)];a&&d.push(a)}A.fillStyle=n;let l=0;for(let t=0;t<d.length;t++){let e=d[t],i=0,a=0;o&&(A.fillStyle=o,A.fillRect(h+l-4,s+i-4,5*r,28),A.fillStyle=n);for(let t=0;t<e.length;t++){var c=e[t];for(let t=0;t<c.length;t++)c[t]&&A.fillRect(h+l+t*r,s+i,r,r);a=Math.max(a,c.length*r),i+=r}l+=r+a}}function P(){w1&&p||w1&&!p?(zzfxX.resume(),l||_1()):!w1&&p?(v1(),zzfxX.resume()):w1||p||zzfxX.suspend()}(async()=>{V(),await Promise.all(["./img/ss.png","./img/tiles.png"].map(t=>{var o,h,e=H([].concat(t)[0]);if(e.match(/(jpeg|jpg|gif|png|webp)$/))return h=t,V(),new Promise((t,e)=>{let i,a,r;if(i=$("",h),s[i])return t(s[i]);(a=new Image).onload=function(){r=N(i,window.location.href),g("assetLoaded",s[q(h)]=s[i]=s[r]=this,h),t(this)},a.onerror=()=>{e("Unable to load image "+i)},a.src=i});if(e.match(/(wav|mp3|ogg|aac)$/))return o=t,new Promise((t,e)=>{let i,a,r,h,s=o,n;return i=new Audio,a={wav:(n=i).canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")},(o=[].concat(o).reduce((t,e)=>t||(a[H(e)]?e:null),0))?(r=$("",o),d[r]?t(d[r]):(i.addEventListener("canplay",function(){h=N(r,window.location.href),g("assetLoaded",d[q(o)]=d[r]=d[h]=this,o),t(this)}),i.onerror=()=>{e("Unable to load audio "+r)},i.src=r,void i.load())):e("cannot play any of the audio formats provided "+s)});{var a=t;let e,i;return V(),e=$("",a),r[e]?Promise.resolve(r[e]):fetch(e).then(t=>{if(t.ok)return t.clone().json().catch(()=>t.text());throw t}).then(t=>(i=N(e,window.location.href),"object"==typeof t&&G.set(t,i),g("assetLoaded",r[q(a)]=r[e]=r[i]=t,a),t))}})),R=function(){return new class{constructor(e={}){var{width:t,height:i,tilewidth:a,tileheight:r,tilesets:h}=e,t=t*a,a=i*r;(i=document.createElement("canvas")).width=t,i.height=a,this._c=i,this._ctx=i.getContext("2d"),h.map(i=>{var{__k:t,location:a}=window,a=(t?t.dm.get(e):"")||a.href,r=i.source;if(r){if(!t)throw Error('You must use "load" or "loadData" to resolve tileset.source');let e=t.d[t.u(r,a)];if(!e)throw Error(`You must load the tileset source "${r}" before loading the tileset`);Object.keys(e).map(t=>{i[t]=e[t]})}if(""+(r=i.image)===r){if(!t)throw Error('You must use "load" or "loadImage" to resolve tileset.image');if(!(t=t.i[t.u(r,a)]))throw Error(`You must load the image "${r}" before loading the tileset`);i.image=t}}),Object.assign(this,{context:u(),layerMap:{},layerCanvases:{},mapwidth:t,mapheight:a,_sx:0,_sy:0,_o:[],...e}),this.context&&this._p(),T("init",()=>{this.context??=u(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){var e=Math.max(0,this.mapwidth-J().width);this._sx=i(0,e,t)}set sy(t){var e=Math.max(0,this.mapheight-J().height);this._sy=i(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(t=>{this._o.push(t),t.parent=this})}remove(...t){t.flat().map(t=>{D(this._o,t),t.parent=null})}setTileAtLayer(t,e,i){var{layerMap:a,tileheight:r,tilewidth:h,width:s}=this,{row:e,col:n,x:o,y:d}=e,e=e??l1(d,r),d=n??c1(o,h);a[t]&&(this._d=1,a[t]._d=1,a[t].data[e*s+d]=i)}setLayer(t,e){var i=this.layerMap;i[t]&&(this._d=1,i[t]._d=1,i[t].data=e)}layerCollidesWith(t,e){var{tilewidth:i,tileheight:a,layerMap:r}=this,{x:e,y:h,width:s,height:n}=Z(e),o=l1(h,a),d=c1(e,i),l=l1(h+n,a),c=c1(e+s,i),u=r[t];for(let e=o;l>=e;e++)for(let t=d;c>=t;t++)if(u.data[t+e*this.width])return 1;return 0}tileAtLayer(t,e){var{layerMap:i,tileheight:a,tilewidth:r,width:h}=this,{row:e,col:s,x:n,y:o}=e,e=e??l1(o,a),o=s??c1(n,r);return i[t]?i[t].data[e*h+o]:-1}render(t=this._c,e=1){var{_d:i,context:a,sx:r=0,sy:h=0}=this,{width:i,height:s}=(i&&this._p(),J()),i=Math.min(t.width,i),s=Math.min(t.height,s);a.drawImage(t,r,h,i,s,0,0,i,s),e&&(a.save(),(r||h)&&a.translate(-r,-h),this.objects.map(t=>t.render&&t.render()),a.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,a=i[t],r=e[t],h=r?.getContext("2d"),s,n;r||({mapwidth:s,mapheight:n}=this,r=document.createElement("canvas"),h=r.getContext("2d"),r.width=s,r.height=n,e[t]=r,this._r(a,h)),a._d&&(a._d=0,h.clearRect(0,0,r.width,r.height),this._r(a,h)),this.render(r,0)}_p(){let{_ctx:r,layers:t=[],layerMap:h}=this;this._d=0,t.map(t=>{var{name:e,data:i,visible:a}=t;t._d=0,h[e]=t,i&&0!=a&&this._r(t,r)})}_r(t,d){let{opacity:e,data:i=[]}=t,{tilesets:l,width:c,tilewidth:u,tileheight:y}=this;d.save(),d.globalAlpha=e,i.map((i,t)=>{if(i){let e;for(let t=l.length-1;0<=t&&i/(e=l[t]).firstgid<1;t--);var{image:a,margin:r=0,firstgid:h,columns:s}=e,h=i-h,s=s??a.width/(u+r)|0,n=t%c*u,t=(t/c|0)*y,o=h%s*(u+r),h=(h/s|0)*(y+r);d.drawImage(a,o,h,u,y,n,t,u,y)}}),d.restore()}}(...arguments)}({tilewidth:32,tileheight:32,frameMargin:10,width:16,height:16,tilesets:[{firstgid:1,image:s["./img/tiles.png"]}],layers:[{name:"ground",data:M1},{name:"bg",data:A1},{name:"bricks",data:M}]}),f=function(){return new class{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:a,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:a},this._f=t.width/e|0,this.createAnimations(r)}createAnimations(t){let e,i;for(i in t){var{frames:a,frameRate:r,loop:h}=t[i];if(e=[],null==a)throw Error("Animation "+i+" must provide a frames property");[].concat(a).map(t=>{e=e.concat(d1(t))}),this.animations[i]=O({spriteSheet:this,frames:e,frameRate:r,loop:h,name:i})}}}(...arguments)}({image:s["./img/ss.png"],frameWidth:8,frameHeight:8,frameMargin:1,animations:{playerIdle:{frames:[0,1],frameRate:3},playerRun:{frames:[2,3,4,3],frameRate:8},playerJump:{frames:[6]},playerFall:{frames:[7]},playerSlide:{frames:[5]},guard:{frames:[10,11,10],frameRate:5},hit:{frames:[20,21,20],frameRate:5},arrow:{frames:12},lady:{frames:13},old:{frames:[14,15,14],frameRate:6},heart:{frames:16},coin:{frames:17}}}),m=h({x:0,y:256,dx:0,dy:0,max_dx:2,max_dy:4,width:32,height:32,anchor:{x:.5,y:0},invisible:0,health:4,animations:f.animations}),F=h({x:170,y:200,width:32,height:32,animations:f.animations}),function({fps:t=60,clearCanvas:e=1,update:i,render:a,context:r=x,blur:h=0}){if(!a)throw Error("You must provide a render() function");let s,n,o,d,l,c=0,u=1e3/t,y=1/t,p=e?i1:I,f=1;function m(){if(n=requestAnimationFrame(m),f&&(o=performance.now(),d=o-s,s=o,d<=1e3)){for(g("tick"),c+=d;c>=u;)l.update(y),c-=u;p(l.context),l.render()}}return h||(window.addEventListener("focus",()=>{f=1}),window.addEventListener("blur",()=>{f=0})),T("init",()=>{l.context??=x}),l={update:i,render:a,isStopped:1,context:r,start(){s=performance.now(),this.isStopped=0,requestAnimationFrame(m)},stop(){this.isStopped=1,cancelAnimationFrame(n)},_frame:m,set _last(t){s=t}}}({update(){"title"===v?(t("esc",()=>{}),t("arrowup",()=>{l||P(),--z<0&&(z=b.length-1)}),t("arrowdown",()=>{l||P(),++z>b.length-1&&(z=0)}),X1(),_++):"controls"===v?(n1(["x","z","space"]),t(["esc","enter"],()=>{v=E})):"pause"===v?(t("arrowup",()=>{--z<0&&(z=b.length-1)}),t("arrowdown",()=>{++z>b.length-1&&(z=0)}),t("esc",()=>{v=E="pause"===E?"game":E,b.pop(),P()}),X1()):"game"===v?(_%300==0&&(Math.random()<.5?L(2,9,"guard"):L(13,2,"guard")),_+=1,m.dy+=.2,m.dx*=.85,Math.abs(m.dx)<.2&&(m.dx=0,m1=0),o1("arrowleft")&&(c=y?0:1,m.setScale(-1,1),m.dx-=.25),o1("arrowright")&&(c=y?0:1,m.setScale(1,1),m.dx+=.25),!c||o1("arrowleft")||o1("arrowright")||(c=0,m1=1),t("x",()=>{p1&&(m.dy-=4.1,p1=0)}),0<m.dy?(y=1,f1=p1=0,m.dy=i(-m.max_dy,m.max_dy,m.dy),C(m,"down")&&(m.dy=0,p1=1,y=0,m.y-=(m.y+m.height+8)%8-1)):m.dy<0&&(f1=1,c=0,C(m,"up"))&&(m.dy=0),m.dx<0?(m.dx=i(-m.max_dx,m.max_dx,m.dx),C(m,"left")&&(m.dx=0,m.x-=(m.x-17+1)%8-1)):0<m.dx&&(m.dx=i(-m.max_dx,m.max_dx,m.dx),C(m,"right"))&&(m.dx=0,m.x+=(m.width+1)%8-1),m.x+=m.dx,m.y+=m.dy,0<m.invisible&&(m.color=7<_%10?"#000000":"",_%60==0)&&m.invisible--,0<w.flash&&(w.color=7<_%10?"#7E2553":"",_%10==0)&&w.flash--,t(["esc","enter"],()=>{E=v,v="pause",b.push("reset"),zzfxX.suspend()}),t("z",()=>{var t,e,i;y1||(y1=1,p&&zzfx(1.01,void 0,460,.01,.03,.05,1,.7,-1.8,-.3,void 0,void 0,void 0,void 0,100,void 0,void 0,.88,.01,.06),t=m.x,e=m.y,i=m.scaleX,t=h({x:t,y:32*Math.floor((e+12)/32),dx:6*i,scaleX:i,scaleY:1,width:32,height:32,anchor:{x:0,y:0},animations:f.animations,ttl:70}),k.push(t))}),t("z",()=>{y1=0},{handler:"keyup"}),m.update(),c?m.playAnimation("playerRun"):f1?m.playAnimation("playerJump"):y?m.playAnimation("playerFall"):m1?m.playAnimation("playerSlide"):m.playAnimation("playerIdle"),S.forEach(t=>{t.update(),t.playAnimation(t.type)}),k.forEach((t,e)=>{t.update(),t.playAnimation("arrow"),(C(t,"left")||C(t,"right"))&&(t.ttl=0),-1<e&&t.ttl<=0&&k.splice(e,1)}),F1.forEach((t,e)=>{switch(t.update(),t.dy+=.2,t.dx*=.85,t.dx-=t.acc*t.scaleX,8===R.tileAtLayer("ground",t)?t.checkJump&&(t.checkJump=0,Math.random()<.75)&&(t.dy-=t.boost):t.checkJump=1,0<t.dy?(t.dy=i(-t.max_dy,t.max_dy,t.dy),t.acc=.11,C(t,"down")&&(t.dy=0,t.y-=(t.y+t.height+8)%8-1)):t.dy<0&&C(t,"up")&&(t.dy=0),t.dx<0&&t.dy<=0?(t.dx=i(-t.max_dx,t.max_dx,t.dx),C(t,"left")&&(t.scaleX=-1)):0<t.dx&&t.dy<=0&&(t.dx=i(-t.max_dx,t.max_dx,t.dx),C(t,"right"))&&(t.scaleX=1),t.x+=t.dx,t.y+=t.dy,r=t,k.forEach(t=>{if(K(t,r)){if("guard"===r.type)--r.health,r.flash=1,p&&zzfx(1.05,.02,434,void 0,.1,.16,void 0,1.7,void 0,-5.3,void 0,void 0,.1,.8,void 0,.3,void 0,.51,.08,.01);else{var e=r.x,i=r.y;for(let t=0;t<1;t++){var a=h({x:e,y:i,dy:0,max_dy:4,width:32,height:32,bounce:3,boost:3,ttl:200,anchor:{x:.5,y:0},animations:f.animations});R1.push(a),a.dy-=a.boost}}t.ttl=0}}),0<t.health||(((e,i)=>{for(let t=0;t<5;t++){var a=h({x:e,y:i,dy:0,dx:2*Math.random()*L1(),width:16*Math.random()+8,height:16*Math.random()+8,bounce:3,boost:4*Math.random(),ttl:50,anchor:{x:.5,y:0},color:"#C2C3C7"});S1.push(a),a.dy-=a.boost}})(t.x,t.y),p&&zzfx(2,void 0,810,.01,.02,.52,1,4.36,void 0,.9,void 0,void 0,void 0,1.6,void 0,.6,void 0,.39,.13,.25),F1.splice(e,1)),K(t,m)&&!m.invisible&&"guard"===t.type&&(m.invisible=3,m.health--,w.flash=2,p&&zzfx(1.02,void 0,56,.01,.01,.08,3,2.58,void 0,-.2,void 0,void 0,void 0,1,11,.1,void 0,.51,.04,.09),m.health<1&&(_=0,v="bricks"),S.shift(),C1()),t.type){case"guard":0<t.flash?(t.playAnimation(2<_%10?"hit":"guard"),_%10==0&&t.flash--):t.playAnimation("guard");break;case"lady":t.playAnimation("lady");break;case"old":t.playAnimation("old")}var r}),R1.forEach((t,e)=>{t.update(),t.playAnimation("coin"),t.dy+=.2,0<t.dy?(t.dy=i(-t.max_dy,t.max_dy,t.dy),C(t,"down")&&(0<t.bounce&&t.dy<1?(t.boost*=.6,t.bounce--,t.dy-=t.boost):(t.dy=0,t.y-=(t.y+t.height+8)%8-1))):t.dy<0&&C(t,"up")&&(t.dy=0),t.y+=t.dy,t.ttl<40&&(t.color=6<_%10?"#000000":""),K(t,m)&&(t.ttl=0,x1+=100,p)&&zzfx(void 0,0,2400,.01,.12,.18,void 0,.3,void 0,-1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.45,.03),-1<e&&t.ttl<=0&&R1.splice(e,1)}),S1.forEach(t=>{t.update(),t.dy+=.2}),z=0):"bricks"===v?(n1(["enter","z","x","space","esc"]),++_%6==0&&(M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.setLayer("bricks",M),R.renderLayer("bricks")),256<M.length&&(v="over")):"over"===v&&(_++,F.y+=-.5*Math.sin(_/18),g1<x1&&(g1+=100),n1(["z","space","esc","enter"]),t(["x"],()=>{E="title",b[z=0]="Steal from the rich",v=E}),m.update(),m.playAnimation("playerIdle"))},render(){"title"===v?(E="title",R.renderLayer("bg"),X(P1,8,"WANTED",106,114,"#000000"),X(P1,8,"WANTED",110,108,"#AB5236"),b.forEach((t,e)=>{z===e?(X(Y,4,">",100+4*Math.sin(_/12),280+28*e,"#008751"),X(Y,4,t,130,280+28*e,"#FFF1E8","#008751")):X(Y,4,t,130,280+28*e,"#FFF1E8")}),X(Y,4,"2023 Isaac Benitez",120,450,"#C2C3C7")):"controls"===v?(X(Y,4,"Controls",190,100,"#FFF1E8"),X(Y,4,"Z      Shoot",190,170,"#FFF1E8"),X(Y,4,"X      Jump",190,198,"#FFF1E8"),X(Y,4,"<      Left",190,226,"#FFF1E8"),X(Y,4,">      Right",190,254,"#FFF1E8"),X(Y,4,"Enter  Select",158,320,"#FFF1E8"),X(Y,4,"ESC  back",190,348,"#FFF1E8")):"pause"===v?(b[0]="continue",k1(),z1.render(),b.forEach((t,e)=>{z===e?(X(Y,4,">",180,190+28*e),X(Y,4,t,208,190+28*e,"#FFF1E8")):X(Y,4,t,200,190+28*e,"#FFF1E8")})):"game"===v?k1():"bricks"===v?(k1(),R.renderLayer("bricks")):"over"===v&&(X(Y,8,"Game Over",120,100,"#AB5236"),F.playAnimation("coin"),F.render(),X(Y,4,"* "+g1,F.x+50,200,"#FFF1E8"),m.x=250,m.y=280,m.render(),X(Y,4,"Press X",200,380,"#FFF1E8"))}}).start(),_1()})();var Y={0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[1,1],[,1],[,1],[,1],[1,1,1]],2:[[1,1,1],[,,1],[1,1,1],[1],[1,1,1]],3:[[1,1,1],[,,1],[,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],6:[[1],[1],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[,,1]],A:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,,1]],B:[[1,1,1],[1,,1],[1,1],[1,,1],[1,1,1]],C:[[,1,1],[1],[1],[1],[,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],E:[[1,1,1],[1],[1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1],[1,,1],[1,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,1],[,1],[,1],[1,1]],K:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1],[1,1,1],[1,,1],[1,,1],[1,,1]],N:[[1,1],[1,,1],[1,,1],[1,,1],[1,,1]],O:[[,1,1],[1,,1],[1,,1],[1,,1],[1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1],[1,,1],[1,,1],[1,1],[,1,1]],R:[[1,1,1],[1,,1],[1,1],[1,,1],[1,,1]],S:[[,1,1],[1],[1,1,1],[,,1],[1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[,1,1]],V:[[1,,1],[1,,1],[1,,1],[1,1,1],[,1]],W:[[1,,1],[1,,1],[1,,1],[1,1,1],[1,1,1]],X:[[1,,1],[1,,1],[,1],[1,,1],[1,,1]],Y:[[1,,1],[1,,1],[1,1,1],[,,1],[1,1,1]],Z:[[1,1,1],[,,1],[,1],[1],[1,1,1]],"*":[[],[1,,1],[,1],[1,,1]]," ":[[,]],"<":[[,,1],[,1,1],[1,1,1],[,1,1],[,,1]],">":[[1],[1,1],[1,1,1],[1,1],[1]]},P1={W:[[1,,1,1,,1,1],[1,1,,1,1,,1,1],[1,1,,1,1,,1,1],[1,1,,1,1,,1,1],[1,1,,1,1,,1,1],[1,1,,1,1,,1],[1,1,1,1,1,1,1],[,1,1,,1,1]],A:[[1,1,1,1,1],[,1,,1,1],[1,1,,1,1],[1,1,1,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[,,,1]],N:[[1,,1,1],[1,1,1,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1],[1,1,,1],[1,1,,1,1]],T:[[1,1,1,1,1],[1,1,1,1],[,,1],[,1,1],[,1,1],[,1,1],[,1,1],[,,1,1]],E:[[,,1,1,1],[,1,,1,1],[1,1],[1,1,,,1],[1,1,1,1,1],[1,1],[1,1,,,1],[,1,1,1]],D:[[1,1,1,1],[1,1,1,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[1,1,,1,1],[1,,1,1]]}</script>