<!doctype html><title>Alive'n'loaded</title><style>canvas{margin:0;position:absolute;top:0}ul{width:100%;list-style-type:none;padding:0;margin:0}#t{width:200px;position:absolute;display:none;overflow:hidden}#p{width:224px;position:absolute;top:0;background:#300;color:#fff}#h{position:absolute;background:#dff;color:#000;padding:8px 32px 8px 32px;display:flex;flex-direction:column}#h>div{flex:1;overflow-y:auto}#h>div>div{display:table;width:100%}#h>div>div>div{display:table-row;border-top:solid 1px #06f}#h>div>div>div>div{display:table-cell}.speech{background:#fff}#t>.l{width:100%;height:24px;color:#fff;background:#600}li{width:100%;height:24px;color:#fff;background:#006}.unavailable{text-decoration:line-through}li:hover{background:#03c}li:active{background:#06f}#a{width:224px;position:absolute;display:none;color:#fff;background:#006}#a>li,input{width:100%;height:auto}body{background:#000}h2,p{display:inline-block;margin-top:4px;margin-bottom:4px}p.right{float:right}img{display:none}.equipt{display:inline-block;width:32px;height:32px;margin:4px 8px 4px 8px;background-image:url(s.png);border:solid 2px #000}#i div:hover,.equipt:hover{border:solid 2px #600}#i div:active,.equipt:active{border:solid 2px red}#i div.selected,#i div.selected:hover,.selected,.selected:hover{border:solid 2px #c00}hr{margin:0}#f{position:absolute;top:6px;right:8px}#f:hover{color:#06f}#i{width:100%;text-align:center;margin-top:128px}h1{color:#ea0;width:80%;margin:0 auto}#i div,#r>div>div{width:64px;height:88px;background-image:url(s.png)}#i div{display:inline-block;margin:12px;border:solid 2px #000}#i1,#r>div:first-child>div{background-position:0 -208px}#i2,#r>div:nth-child(2)>div{background-position:0 -296px}#i3,#r>div:nth-child(3)>div{background-position:0 -384px}#r{position:absolute;border:2px solid #ea0;top:-360px;width:576px;display:table;background:#000;color:#fe6;transition:top .5s ease-in-out}#r>div{display:table-row}#r>div>*{display:table-cell;vertical-align:middle}#r>div>h3{padding-left:64px}.disabled{opacity:.2}</style><div id=i><h1>Choose your character</h1><br><br><input type=button></div><img id=s src=s.png><ul id=t></ul><div id=p><hr><hr><p>Condition :<hr><p>Backpack</p><br><br><div><div></div><div></div><div></div><div></div></div><ul></ul></div><ul id=a><li>Active : +5?/turn, minimal chance to detect traps.<li>Cautious : +4?/turn, fair chance to detect traps and thieves.<li>Vigilant : +3?/turn, will detect most traps and deter thieves.</ul><div id=h><div id=r><div></div><div></div><div></div></div><script src=/socket.io.js></script><script>function u(t){this.controls=t,this.a=new v,this.B=new x(t,this.a)}function y(){z(),requestAnimationFrame((function(){y()}))}function A(){var t=game;t.state=1,B(t.a),C(t.B),setInterval((function(){var t=game;if(1<t.state){for(var e=t.B,a=-1,n=0;n<e.a.N.length&&0>a;++n){for(var i=e.controls.Z,o=e.a.N[n],s=(o.length-1)/2,r=!1,h=o[2*s-1],c=o[2*s],l=0;s>l;++l){var u=o[2*l+1],d=o[2*l+2];d>=i!=c>=i&&e.controls.Y<(h-u)/(c-d)*(i-d)+u&&(r=!r),h=u,c=d}r&&(a=e.a.N[n][0])}for(e.a.w=a,e.controls.X&&(e.controls.X=!1,a!=e.a.s?(e.a.s=a,a>-1&&E(e,(a=D(e.a,a)).x,a.y)):0<=controls.I&&controls.I<e.a.H&&0<=controls.J&&controls.J<e.a.H&&E(e,Math.floor(controls.I),Math.floor(controls.J))),t=t.a,e=!1,a=0;a<t.b.length;++a)0<(n=t.b[a]).u?(n.M=(1+n.M)%6,n.x+=.2*[0,1,0,-1][n.orientation],n.y+=.2*[1,0,-1,0][n.orientation],--n.u,e=!0):0<n.A.length?(n.u=5*n.A.shift(),n.orientation=n.A.shift()):(n.x=Math.round(n.x),n.y=Math.round(n.y),n.M=0);e&&F(t)}}),40),requestAnimationFrame((function(){y()}))}function G(){this.I=this.J=this.Y=this.Z=0,this.F=[0,0,240],this.X=!1}function H(t){this.f=t,this.a=t.a,this.m=document.getElementById("t"),this.o=document.getElementById("p"),this.P=document.getElementById("h"),this.K=document.getElementById("a"),this.O=!1,this.$=document.getElementById("c"),this.G=document.getElementById("i"),this.S=document.getElementById("r"),this.c=this.$.getContext("2d"),this.l=16,this.i=document.createElement("canvas"),this.i.width=640,this.i.height=560,t=this.i.getContext("2d");var e=document.getElementById("s");t.drawImage(e,0,0),t.scale(-1,1),t.drawImage(e,0,0,264,161,-640,0,264,161),t.drawImage(e,0,208,128,352,-256,208,128,352),t.scale(-1,1),this.R=!0,I(this,!1),this.ja=this.ka=-1;var a=this,n=this.f.B;this.o.children[5].onmouseover=function(){a.O=!0},this.K.onmouseleave=function(){a.O=!1},this.K.children[0].onclick=function(){n.h.emit("cA",0),a.O=!1},this.K.children[1].onclick=function(){n.h.emit("cA",1),a.O=!1},this.K.children[2].onclick=function(){n.h.emit("cA",2),a.O=!1},this.G.children[2].onmouseup=function(){n.a.g=0},this.G.children[3].onmouseup=function(){n.a.g=1},this.G.children[4].onmouseup=function(){n.a.g=2},this.G.children[6].onmouseup=function(){n.V[1+n.a.g]&&n.h.emit("chooseCharacter",n.a.g)},document.getElementById("f").onclick=function(){I(a,!0)},document.getElementById("r").onclick=function(){n.ba=!1},this.L=["Hallway","","","","Open door","Closed door","","","","","","","Blocked door","","","","","Rocks",,,,,,,,,,,,,"outside world",,"Clay cup","Metal cup","Chalice","Stone idol","Stone calendar",,,,,,,,,,,"","Steven","Ernesto","Marzena",""],this.ga=["Take","Open","Close","Walk through",,,,,"Drop","Pick backpack"],this.ha=["Active","Cautious","Vigilant"],this.sa=[" takes a $1"," opens the $1"," closes the $1"," leaves the room towards the $1",,,,," drops a $1"," successfully snatches a $1 from $2's backpack"," tries to pick from $2's backpack without success"," catches the attention of $2 trying to steal from $4 backpack"," tries to grab from $2's backpack, only to find it empty"," catches $2 red-handed in $3 backpack"," enters from the $1"," The ground quivers for a short instant, then becomes still again"," A deep rumble rise from the ground as the stones start shaking"," Thunder echoes through the room as the jolts from the ground bring you to your knees"," A sudden quake causes the ceiling to collapse on the $1 side of the room"],this.da=0}function J(t){var e=t.a,a=t.f.B;t.o.children[0].innerHTML=t.L[48+t.a.g],t.o.children[2].innerHTML=t.a.C+" ?",t.o.children[5].innerHTML=t.ha[t.a.ia];var n=Math.ceil((t.a.fa-new Date)/1e3),i=n%60;for(t.o.children[6].innerHTML=t.a.fa?"+"+(5-t.a.ea)+" ? in 0"+Math.floor(n/60)+":"+(10>i?"0":"")+i:"Waiting",t.o.children[7].innerHTML="Next : "+t.ha[t.a.ea],t.o.children[10].innerHTML=["","","Burdened : -1?","Overloaded : -2?","Struggling : -3?"][Math.floor((t.a.D.length+2)/3)],i=n=0;i<t.o.children[13].children.length;++i)for(var o=t.o.children[13].children[i],s=0;s<o.children.length;++s)o.children[s].style.backgroundPosition=-32*(n>=t.a.D.length?0:t.a.D[n]/4-31)+"px -176px",o.children[s].setAttribute("class","equipt"+(t.a.T==n?" selected":"")),o.children[s].index=n,o.children[s].onmouseup=function(){var t=this.index;e.D.length>t&&(e.T=t)},++n;n=t.o.children[14].firstChild,i=t.a.U[8],n.style.display=-1<t.a.T?"block":"none",n.innerHTML=i+"? "+t.ga[8],n.setAttribute("class",i>t.a.C?"unavailable":""),n.onclick=function(){a.a.U[8]<=a.a.C&&a.h.emit("action",8,!1,a.a.T)}}function K(t){if(t.ka!=t.a.s||t.ja!=t.a.w){var e=t.f.B,a=t.a.w;if(-1<t.a.s&&(a=t.a.s),a>-1){var n=D(t.a,a);t.m.children[0].innerHTML=t.L[n.type>>2];for(var i=L(n.type),o=0;o<i.length;++o){var s=i[o],r=t.a.U[s];t.m.children[o+1].innerHTML=r+"? "+t.ga[s],t.m.children[o+1].setAttribute("class",r>t.a.C||!s&&11<t.a.D.length?"unavailable":""),t.m.children[o+1].pa=s,t.m.children[o+1].Fa=a,t.m.children[o+1].onclick=function(){var t=this.pa,a=this.Fa;e.a.U[t]<=e.a.C&&(t||12>e.a.D.length)&&(e.h.emit("action",t,!0,a>=e.a.v.items.length?a-e.a.v.items.length:a),e.a.s=-1,e.a.w=-1)}}t.m.style.display="block",t.m.style.left=Math.max(t.F[0]+2*t.l*(n.x+n.y+1)-100,0)+"px",t.m.style.top=t.F[2]+t.l*(-n.x+n.y)+12+"px",t.m.style.height=-1<t.a.s?24+24*i.length+"px":"24px"}else t.m.style.display="none";t.ka=t.a.s,t.ja=t.a.w}}function M(t,e,a){t.c.drawImage(t.i,64*a.orientation,208+88*e,64,88,2*t.l*(a.x+a.y+1)-32,t.l*(-a.x+a.y)-88,64,88)}function N(t,e,a,n){var i=2*t.l*(a+n+1);if(a=t.l*(-a+n+1),t.c.save(),t.c.translate(i,a),a=3&e,n=e>>2,1&e&&t.c.scale(-1,1),5==n&&(i=0==a||3==a?8:0,t.c.drawImage(t.i,112,10,40,124,-8-2*i,-126-i,40,124)),n>31&&t.c.drawImage(t.i,32*(n-31),176,32,32,-16,-32,32,32),17==n)for(e=a==t.a.ma,i=1;20>i;++i){a=80/Math.pow(i,.5);var o=Math.max(0,(new Date-t.f.a.W)/20-i);o=-30-(n=(35*i&127)-63)/2-2*i+(e?Math.min(0,o*o-2500):0),t.c.drawImage(t.i,192,176,32,32,n-a/2,o-a/2,a,a)}t.c.restore()}function O(t,e,a){for(var n=0;18>n;++n)(7>n||n>10||0>a[2])&&t.c.drawImage(t.i,0,58,16,103,16*n,-102-8*n,16,103),e&&(7>n||n>10||0>a[1])&&t.c.drawImage(t.i,624,58,16,103,288+16*n,8*n-238,16,103),e&&(6>n||n>11||0>a[0])&&t.c.drawImage(t.i,152,58,16,103,288+16*n,42-8*n,16,103),e&&(6>n||n>11||0>a[3])&&t.c.drawImage(t.i,452,58,16,103,16*n,8*n-84,16,103);-1<a[2]&&t.c.drawImage(t.i,16,0,96,153,96,-200,96,153),-1<a[1]&&t.c.drawImage(t.i,528,0,96,153,384,-200,96,153),-1<a[0]&&t.c.drawImage(t.i,168,0,96,153,384,-56,96,153),-1<a[3]&&t.c.drawImage(t.i,376,0,96,153,96,-56,96,153),-1==t.a.w&&0<=t.f.controls.I&&t.f.controls.I<t.a.H&&0<=t.f.controls.J&&t.f.controls.J<t.a.H&&(e=2*t.l*(Math.floor(t.f.controls.I)+Math.floor(t.f.controls.J)),a=t.l*(-Math.floor(t.f.controls.I)+Math.floor(t.f.controls.J)),t.c.translate(e,a),t.c.strokeStyle="#884",t.c.lineWidth=2,t.c.beginPath(),t.c.moveTo(0,0),t.c.lineTo(2*t.l,-t.l),t.c.lineTo(4*t.l,0),t.c.lineTo(2*t.l,t.l),t.c.lineTo(0,0),t.c.stroke(),t.c.translate(-e,-a))}function P(t){t.c.fillStyle="black",t.c.fillRect(0,0,576,512);var e=(new Date-t.f.a.W)/20;e=Math.floor(Math.floor(t.f.a.la*Math.exp(-e/80))*Math.cos(e));t.c.translate(0,t.F[2]+e);var a=t.a.b[t.a.g].j,n=t.a.v;O(t,a>1,n.ra);for(var i=[],o=0;o<n.items.length;++o){var s=-n.items[o].x+n.items[o].y;i.push([s,0,n.items[o]])}for(o=0;o<t.a.b.length;++o)(n=t.a.b[o]).j==a&&(s=-n.x+n.y,i.push([s,1,n,o]));for(i.sort((function(t,e){return t[0]-e[0]})),o=0;o<i.length;++o)(a=i[o])[1]?M(t,a[3],a[2]):N(t,a[2].type,a[2].x,a[2].y);t.c.translate(0,-t.F[2]-e)}function z(){var t=game.Ba;if(t.$.style.display=t.o.style.display=t.K.style.display=1<t.f.state?"block":"none",t.S.style.display=3==t.f.state?"block":"none",2>t.f.state&&(t.m.style.display="none"),t.G.style.display=1==t.f.state?"block":"none",1==t.f.state){for(var e=0;3>e;++e)t.G.children[e+2].setAttribute("class",(t.a.g==e?"selected":"")+(t.f.B.V[1+e]?"":" disabled"));e=t.f.B.V[1+t.a.g],t.G.children[6].setAttribute("class",e?"":"disabled"),t.G.children[6].value="Play "+(e?"as "+t.L[48+t.a.g]:"")}if(1<t.f.state){for(e=t.f.B.na;t.da<e.length;){var a=e[t.da],n=((o=Math.ceil((a[5]-t.a.startTime)/1e3)%86400)-(s=o%60))/60%60,i=Math.floor(o/3600),o=document.createElement("div"),s="<div>"+(10>i?"0":"")+i+":"+(10>n?"0":"")+n+":"+(10>s?"0":"")+s+"</div><div>"+t.L[48+a[0]]+"</div>";-1==a[1]?s+="<div class='speech'>"+a[4]+"</div>":(s+="<div>"+t.sa[a[1]],n=0<a[1]&&5>a[1]||18==a[1]?["south","east","north","west"][a[2]]:t.L[a[2]],n+=1==a[1]||2==a[1]||4==a[1]?" door":"",s=s.replace("$1",n).replace("$2",t.L[48+a[3]]).replace("$3",1<a[0]?"her":"his").replace("$4",1<a[3]?"her":"his")),o.innerHTML=s,t.P.children[1].firstChild.insertBefore(o,null),++t.da}P(t),K(t),J(t),t.K.style.display=t.O?"block":"none"}if(3==t.f.state)for(t.S.style.top=t.f.B.ba?t.$.style.top:"-360px",e=0;3>e;++e)t.S.children[e].children[1].innerHTML=t.L[48+e],t.S.children[e].children[2].innerHTML=0>t.a.b[e].aa?["Trapped inside","Still inside"][2+t.a.b[e].aa]:t.a.b[e].aa+" ?"}function I(t,e){t.R^=e;var a=Math.floor(Math.max(0,window.innerWidth-800)/3);t.F=[a,0,240],t.S.style.left=t.$.style.left=t.P.style.left=a+"px",t.K.style.left=t.o.style.left=2*a+576+"px",t.P.style.top=(t.R?400:160)+"px",t.P.style.width=a+736+"px",t.P.style.height=window.innerHeight-(t.R?400:160)+"px",t.f.controls.F=t.F,document.getElementById("f").innerHTML=(t.R,"?")}function x(t,e){this.controls=t,this.a=e,this.na=[],this.V=[!1,!1,!1,!1,!1],this.ba=!1}function R(t,e,a,n,i,o){t.na.push([e,a,n,i,o,new Date])}function E(t,e,a){var n=-1;if(!t.a.ca[e+2][a+2])for(var i=[0,1,0,-1],o=[1,0,-1,0],s=0;4>s&&-1==n;++s)t.a.ca[e+2+i[s]][a+2+o[s]]&&(e+=i[s],a+=o[s],n=2^s);t.h.emit("move",e,a,n)}function C(t){t.h=io({path:location.pathname+"io",upgrade:!1,transports:["websocket"]}),t.h.on("cA",t.ta.bind(t)),t.h.on("eW",t.ua.bind(t)),t.h.on("cy",t.va.bind(t)),t.h.on("pM",t.ya.bind(t)),t.h.on("r3",t.Da.bind(t)),t.h.on("n3",t.xa.bind(t)),t.h.on("rR",t.Ea.bind(t)),t.h.on("n0",t.wa.bind(t)),t.h.on("nR",t.oa.bind(t)),t.h.on("n9",t.Aa.bind(t)),t.h.on("sp",t.za.bind(t)),t.h.on("ac",t.Ca.bind(t))}function v(){this.g=-1,this.C=0,this.v={items:[],ra:[]},this.b=[],this.H=9,this.la=0,this.ma=-1,this.N=[],this.qa=[[-.5,.25,-.5,-5.25,2.5,-6.75,2.5,-1.25],[0,0,2,-1,2,-3.5,0,-4.5,-2,-3.5,-2,-1],[0,0,1,-.5,1,-1.5,0,-2,-1,-1.5,-1,-.5],[0,0,1,-.5,1,-5.5,0,-6,-1,-5.5,-1,-.5]],this.U=[1,1,1,1,1,1,1,1,1,2],this.T=this.s=this.w=-1}function F(t){t.b[t.g].type=-1,t.N=[];for(var e=t.v.items.concat(t.b),a=0;a<e.length;++a){var n=32*((h=e[a]).x+h.y+1),i=16*(-h.x+h.y+1);if(-1<h.type){for(var o=[a],s=t.qa[h.type>>6],r=1&h.type?-1:1,h=-1==h.x||9==h.y?-12:0,c=0;c<s.length;c+=2)o.push(n+r*(16*s[c]+2*h),i+(16*s[c+1]+h));t.N.push(o)}}t.N.sort((function(t,e){return e[2]-t[2]}))}function S(t,e,a,n,i,o){a=Math.round(a),n=Math.round(n);for(var s=[],r=[],h=[],c=-1;c<t.H+3;++c){for(var l=[],u=[],d=[],f=[],m=-1;m<t.H+3;++m)l.push([]),d.push(c>0&&m>0&&c<=t.H&&m<=t.H),u.push(999),f.push([]);s.push(l),r.push(u),h.push(d)}for(c=0;c<t.v.items.length;++c)h[(l=t.v.items[c]).x+2][l.y+2]=!1;for(c=0;c<t.b.length;++c)(l=t.b[c]).j==t.b[t.g].j&&c!=t.g&&(h[l.x+2][l.y+2]=!1);for(a=[0,2+a,2+n,0,0,2+a,2+n,1];0<a.length;){n=a.shift();c=a.shift(),l=a.shift(),u=a.shift(),d=s[c][l],f=1,m=[0,1,0,-1][u=u+1&3];for(var g=[1,0,-1,0][u];h[c+f*m][l+f*g];){if(n+f<r[c+f*m][l+f*g]){r[c+f*m][l+f*g]=n+f;var p=d.slice(0);p.push(f,u),s[c+f*m][l+f*g]=p,a.push(n+f,c+f*m,l+f*g,u)}++f}for(f=1,m=-m,g=-g,u^=2;h[c+f*m][l+f*g];)n+f<r[c+f*m][l+f*g]&&(r[c+f*m][l+f*g]=n+f,(p=d.slice(0)).push(f,u),s[c+f*m][l+f*g]=p,a.push(n+f,c+f*m,l+f*g,u)),++f}return e&&(t.ca=h),i>-2?s[2+i][2+o]:void 0}function D(t,e){return e<t.v.items.length?t.v.items[e]:t.b[e-t.v.items.length]}function Q(t,e){t.v=e,F(t),S(t,!0,t.b[t.g].x,t.b[t.g].y,-2,-2)}function L(t){if((t>>=2)>47)return[9];if(t>31)return[0];if(t>12)return[];var e=[[3],[1],[4],[1]][3&t];return t>3&&0==(3&t)&&e.push(2),e}function B(t){t.b=[{j:0,x:2,y:0,orientation:0,u:0,M:0,A:[],type:-1},{j:0,x:2,y:2,orientation:0,u:0,M:0,A:[],type:-1},{j:0,x:2,y:2,orientation:0,u:0,M:0,A:[],type:-1},{j:0,x:2,y:2,orientation:0,u:0,M:0,A:[],type:-1}],t.D=[],t.ia=0,t.ea=0,t.fa=0,t.startTime=0,t.C=0,t.ca=[]}u.prototype={},G.prototype={},H.prototype={},x.prototype={speak:function(t){this.h.emit("speak",t)},ta:function(t){this.V=[!1].concat(t)},ua:function(t){Q(this.a,t),this.a.W=this.a.startTime=1*new Date,game.state=2},va:function(t,e,a,n,i){this.a.C=t,this.a.ia=e,Q(this.a,i),this.a.la=a,this.a.ma=n,a>0&&R(this,3,n>-1?18:15+Math.floor(Math.min(2,a/10)),n,0,""),this.a.W=1*new Date,this.a.fa=this.a.W+3e4,this.ba=3==game.state},ya:function(t,e,a,n){var i=this.a,o=i.b[t];o.u%=5,t=S(i,t==i.g,o.x+.2*o.u*[0,1,0,-1][o.orientation],o.y+.2*o.u*[1,0,-1,0][o.orientation],e,a),o.A=t.slice(),n>-1&&o.A.push(0,n)},xa:function(t,e,a,n,i,o){R(this,t,e?14:3,n,0,""),this.a.b[t].j=a,this.a.b[t].u=0,this.a.b[t].A=[],this.a.b[t].x=i,this.a.b[t].y=o,this.a.b[t].type=e?192+4*t:-1,F(this.a)},Da:function(t,e,a,n){this.a.w=-1,this.a.s=-1,R(this,this.a.g,3,t,0,""),(t=this.a.b[this.a.g]).u=0,t.A=[];for(var i=0;3>i;++i)this.a.b[i].x=a[i].x,this.a.b[i].y=a[i].y,this.a.b[i].j=a[i].j,this.a.b[i].aa=a[i].aa;for(i=0;3>i;++i)this.a.b[i].type=this.a.b[i].j==t.j?192+4*i:-1;Q(this.a,e),this.a.C=n,game.state=1==t.j?3:2,this.ba=3==game.state},oa:function(t,e,a,n){R(this,t,e,a,0,""),Q(this.a,n)},Ea:function(t,e,a,n,i,o,s){1&a&&(this.a.w=-1,this.a.s=-1),2&a&&(-1<(a=this.a).D.length&&(a.T=-1)),R(this,this.a.g,t,n,e,""),Q(this.a,i),this.a.D=o,this.a.C=s},wa:function(t,e,a,n){this.a.w>e&&--this.a.w,this.a.s>e&&--this.a.s,this.oa(t,0,a,n)},Aa:function(t,e,a,n){2==e&&R(this,a,13,0,t,""),this.a.g==a&&(this.a.D=n)},za:function(t,e){R(this,t,-1,0,0,e)},Ca:function(t){this.a.ea=t}},v.prototype={},window.addEventListener("load",(function(){controls=new G;var t=document.getElementById("c");t.onmousedown=function(){return controls.X=!0},t.onmouseup=function(){return controls.X=!1,!0},t.onmousemove=function(t){var e=controls,a=0,n=0;return"clientX"in t&&"clientY"in t&&(a=t.clientX,n=t.clientY),e.Y=a-e.F[0],e.Z=n-e.F[2],e.I=(e.Y-2*e.Z)/64,e.J=(e.Y+2*e.Z)/64,!0},document.onkeydown=function(t){if(13==t.which){var e=(t=document.getElementById("h").firstChild).value;return""!=e&&(t.value="",game.B.speak(e)),!1}return!0},game=new u(controls),renderer=new H(game),window.addEventListener("resize",(function(){I(renderer,!1)})),game.Ba=renderer,A()}))</script>