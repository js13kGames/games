<!DOCTYPE html><head><title>Little JS Starter Project</title><meta charset=utf-8></head><body><script>let ba=!0,f=!1,ca=[],h=!1,l=!1,da=!1,ea=!1,fa,ha;function r(t,e){e?console.assert(t,e):console.assert(t)}function ia(t,e=u(),i="#fff",a=0,s=0,n=!1){r("string"==typeof i,"pass in css color strings"),ca.push({g:t,size:u(e),color:i,time:new ja(a),angle:s,fill:n})}function ka(t,e=0,i="#fff"){r("string"==typeof i,"pass in css color strings"),ca.push({g:t,size:e,color:i,time:new ja(0),angle:0,fill:!0})}function la(t,e){r("string"==typeof e,"pass in css color strings"),ia(t,void 0,e)}function ma(t,e,i,a=.1){e=u((e.x-t.x)/2,(e.y-t.y)/2),a=u(a,2*e.length()),ia(t.add(e),a,i,void 0,e.angle(),!0)}function na(t,e,i,a,s){var n=u(Math.min(t.x-e.x/2,i.x-a.x/2),Math.min(t.y-e.y/2,i.y-a.y/2));t=u(Math.max(t.x+e.x/2,i.x+a.x/2),Math.max(t.y+e.y/2,i.y+a.y/2)),ia(n.T(t,.5),t.j(n),s)}function oa(t,e){r(!0,"pass in css color strings"),ca.push({text:t,g:e,size:.2,color:"#fff",time:new ja(0),angle:0,font:"monospace"})}function pa(){var t=v.toDataURL("image/png");ha.download="screenshot",ha.href=t,ha.click()}function qa(){if(ra(),fa&&(ra(!0),w.drawImage(v,0,0),sa(),v.width|=0,y.fillRect(0,0,z.width,z.height),y.drawImage(z,0,0),pa(),fa=0),ea&&ta&&navigator.getGamepads)for(var t=navigator.getGamepads(),e=t.length;e--;){var i=t[e];if(i){for(var a=A,s=ua[e],n=s.length;n--;){var r=a.add(u(2*+n,3*+e)),o=r.add(s[n].scale(1));ka(r,1,"#fff7"),ma(r,o,"#f00"),la(o,"#f00")}for(s=i.buttons.length;s--;)ka(n=a.add(u(.2*s*2,3*+e-1-.2)),.2,i.buttons[s].pressed?"#f00":"#fff7"),oa(""+s,n)}}if(f){t=w,w=y,e=B.scale(1/C),ia(A,e.j(u(.1)),"#f008"),e=1/0;for(var c of D){var b;!c.u&&(va(c),c.size.x)&&c.size.y&&(i=wa(E,c.g))<e&&(e=i,b=c)}0<F.x&&0<F.y&&xa(E.floor().add(u(.5)),u(1),G(0,0,1,.5),0,!1),w=t}y.lineWidth=2;let g=.5*C;if(ca.forEach(t=>{y.save();var e=ya(t.g);if(y.translate(0|e.x,0|e.y),y.rotate(t.angle),y.scale(1,t.text?1:-1),y.fillStyle=y.strokeStyle=t.color,null!=t.text)y.font=t.size*C+"px "+t.font,y.textAlign="center",y.textBaseline="middle",y.fillText(t.text,0,0);else if(null!=t.points){y.beginPath();for(var i of t.points)e=i.scale(C).floor(),y.lineTo(e.x,e.y);y.closePath(),t.fill&&y.fill(),y.stroke()}else 0==t.size||0===t.size.x&&0===t.size.y?(y.fillRect(-g/2,-1,g,3),y.fillRect(-1,-g/2,3,g)):null!=t.size.x?(i=(e=t.size.scale(C).floor()).x,e=e.y,t.fill&&y.fillRect(-i/2|0,-e/2|0,i,e),y.strokeRect(-i/2|0,-e/2|0,i,e)):(y.beginPath(),y.arc(0,0,t.size*C,0,9),t.fill&&y.fill(),y.stroke());y.restore()}),ca=ca.filter(t=>t.time<0),b&&(c=w,w=y,(t=za(b.g))&&xa(t.floor().add(u(.5)),u(1),G(0,1,1,.3)),Aa(E,b.g,t?G(1,0,0,.5):G(0,1,0,.5),!1),Ca(b="mouse pos = "+E+"\nmouse collision = "+Ba(E)+"\n\n--- object info ---\n"+b.toString(),Da,24,G(),.05,void 0,"center","monospace"),w=c),y.save(),y.fillStyle="#fff",y.textAlign="left",y.textBaseline="top",y.font="28px monospace",y.shadowColor="#000",y.shadowBlur=9,b=-20,f){for(var x in y.fillText("LittleJS",9,b+=30),y.fillText("Objects: "+D.length,9,b+=30),y.fillText("Time: "+Ea(),9,b+=30),y.fillText("---------",9,b+=30),y.fillStyle="#f00",y.fillText("ESC: Debug Overlay",9,b+=30),y.fillStyle=h?"#f00":"#fff",y.fillText("1: Debug Physics",9,b+=30),y.fillStyle=da?"#f00":"#fff",y.fillText("2: Debug Particles",9,b+=30),y.fillStyle=ea?"#f00":"#fff",y.fillText("3: Debug Gamepads",9,b+=30),y.fillStyle=l?"#f00":"#fff",y.fillText("4: Debug Raycasts",9,b+=30),y.fillStyle="#fff",y.fillText("5: Save Screenshot",9,b+=30),c="",H[0])I(x,0)&&(c+=x+" ");if(c&&y.fillText("Keys Down: "+c,9,b+=30),x="",H[1])for(var d in H[1])I(d,1)&&(x+=d+" ");x&&y.fillText("Gamepad: "+x,9,b+=30)}else y.fillText(h?"Debug Physics":"",9,b+=30),y.fillText(da?"Debug Particles":"",9,b+=30),y.fillText(l?"Debug Raycasts":"",9,b+=30),y.fillText(ea?"Debug Gamepads":"",9,b+=30);y.restore()}let Fa=Math.PI;function J(t,e=0,i=1){return t<e?e:i<t?i:t}function Ga(t,e,i){return(i-=e)?J((t-e)/i):0}function Ha(t,e,i,a=u()){return 2*Math.abs(t.x-i.x)<e.x+a.x&&2*Math.abs(t.y-i.y)<e.y+a.y}function Ea(){return(Ia/60|0)+":"+(Ia%60<10?"0":"")+(Ia%60|0)}function u(t=0,e){return"number"==typeof t?new K(t,null==e?t:e):new K(t.x,t.y)}function L(t){return t instanceof K}function wa(t,e){return r(L(e)),(t.x-e.x)**2+(t.y-e.y)**2}function Ja(t){return t.x**2+t.y**2}function Ka(t,e){return r(L(e)),wa(t,e)**.5}function La(t,e=1){var i=t.length();return e<i?t.scale(e/i):t}class K{constructor(t=0,e=0){this.x=t,this.y=e,r(this.B())}set(t=0,e=0){return this.x=t,this.y=e,r(this.B()),this}o(){return new K(this.x,this.y)}add(t){return r(L(t)),new K(this.x+t.x,this.y+t.y)}j(t){return r(L(t)),new K(this.x-t.x,this.y-t.y)}multiply(t){return r(L(t)),new K(this.x*t.x,this.y*t.y)}L(t){return r(L(t)),new K(this.x/t.x,this.y/t.y)}scale(t){return r(!L(t)),new K(this.x*t,this.y*t)}length(){return Ja(this)**.5}normalize(t=1){var e=this.length();return e?this.scale(t/e):new K(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var e=Math.cos(-t);return t=Math.sin(-t),new K(this.x*e-this.y*t,this.x*t+this.y*e)}setDirection(t,e=1){return r(0==(t=(t%4+4)%4)||1==t||2==t||3==t),u(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new K(Math.floor(this.x),Math.floor(this.y))}T(t,e){return r(L(t)),this.add(t.j(this).scale(J(e)))}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}B(){return"number"==typeof this.x&&!isNaN(this.x)&&"number"==typeof this.y&&!isNaN(this.y)}}function G(t,e,i,a){return new M(t,e,i,a)}function N(t){return t instanceof M}function Ma(t){return(255*J(t.r)|0)+(255*J(t.l)<<8)+(255*J(t.b)<<16)+(255*J(t.a)<<24)}class M{constructor(t=1,e=1,i=1,a=1){this.r=t,this.l=e,this.b=i,this.a=a,r(this.B())}set(t=1,e=1,i=1,a=1){return this.r=t,this.l=e,this.b=i,this.a=a,r(this.B()),this}o(){return new M(this.r,this.l,this.b,this.a)}add(t){return r(N(t)),new M(this.r+t.r,this.l+t.l,this.b+t.b,this.a+t.a)}j(t){return r(N(t)),new M(this.r-t.r,this.l-t.l,this.b-t.b,this.a-t.a)}multiply(t){return r(N(t)),new M(this.r*t.r,this.l*t.l,this.b*t.b,this.a*t.a)}L(t){return r(N(t)),new M(this.r/t.r,this.l/t.l,this.b/t.b,this.a/t.a)}scale(t,e=t){return new M(this.r*t,this.l*t,this.b*t,this.a*e)}T(t,e){return r(N(t)),this.add(t.j(this).scale(J(e)))}toString(t=!0){var e=t=>((t=255*J(t)|0)<16?"0":"")+t.toString(16);return"#"+e(this.r)+e(this.l)+e(this.b)+(t?e(this.a):"")}B(){return!("number"!=typeof this.r||isNaN(this.r)||"number"!=typeof this.l||isNaN(this.l)||"number"!=typeof this.b||isNaN(this.b)||"number"!=typeof this.a||isNaN(this.a))}}G(),G(0,0,0),G(.5,.5,.5),G(1,0,0),G(1,.5,0),G(1,1,0),G(0,1,0),G(0,1,1),G(0,0,1),G(.5,0,1),G(1,0,1);class ja{constructor(t){this.time=null==t?void 0:Ia+t,this.setTime=t}set(t=0){this.time=Ia+t,this.setTime=t}active(){return Ia<this.time}get(){return null!=this.time?Ia-this.time:0}toString(){return null!=this.time?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let A=u(),C=32,Na=u(1920,1080),Oa=u(),Pa="arial",O=!1,Qa=!0,Ra=!0,Sa=u(16),Ta=0,ta=!0;function va(t){var e=u(Math.max(t.size.x,.2),Math.max(t.size.y,.2)),i=G(t.J?1:0,t.C?1:0,t.H?1:0,t.parent?.2:.5),a=t.parent?G(1,1,1,.5):G(0,0,0,.8);xa(t.g,e,i,t.angle,!1),xa(t.g,e.scale(.8),a,t.angle,!1),t.parent&&Aa(t.g,t.parent.g,G(0,0,1,.5),!1)}function Ua(t){var e,i,a=t.parent;a&&(e=a.U?-1:1,t.g=t.ha.multiply(u(e,1)).rotate(a.angle).add(a.g),t.angle=e*t.ga+a.angle);for(i of t.children)Ua(i)}function Va(t){if(!t.u){t.u=1,t.parent&&t.parent.removeChild(t);for(var e of t.children)Va(e,e.parent=0)}}function Wa(t){r(!0,"solid objects must be set to collide"),t.C=!0,t.H=!0,t.J=!0,t.R=!0}u(640,80);class Xa{constructor(t=u(),e=u(1),i){var a=new M;r(L(t)&&L(e),"ensure pos and size are vec2s"),r("number"!=typeof i||!i,"old style tile setup"),this.g=t.o(),this.size=e,this.da=void 0,this.ia=i,this.angle=0,this.color=a,this.ba=void 0,this.U=!1,this.I=this.F=this.i=1,this.G=0,this.ea=.8,this.fa=1,this.V=0,this.h=u(),this.N=0,this.children=[],this.ca=!0,this.parent=this.m=void 0,this.ha=u(),this.ga=0,this.R=this.H=this.C=this.J=!1,D.push(this)}update(){var t;if(!this.parent&&(this.ca?(this.h.x=J(this.h.x,-1,1),this.h.y=J(this.h.y,-1,1)):1<(t=Ja(this.h))&&(this.h.x*=t=1/t**.5,this.h.y*=t),t=this.g.o(),this.h.x*=this.F,this.h.y*=this.F,this.i&&(this.h.y+=0*this.fa),this.g.x+=this.h.x,this.g.y+=this.h.y,this.angle+=this.N*=this.I,r(0<=this.I&&this.I<=1),r(0<=this.F&&this.F<=1),this.i)){var e,i,a,s,n,o,l=this.h.y<0;if(this.m&&(o=this.m!=this&&this.m.h?this.m.h.x:0,this.h.x=o+(this.h.x-o)*this.ea,this.m=void 0),this.C)for(var c of Ya)!this.H&&!c.H||c.u||c.parent||c==this||Ha(this.g,this.size,c.g,c.size)&&(o=this.D(c),e=c.D(this),o)&&e&&(Ha(t,this.size,c.g,c.size)?((e=(o=t.j(c.g)).length())<.01?(o=new K,e=2*Fa*Math.random(),o.x=.001*Math.sin(e),o.y=.001*Math.cos(e)):o=o.scale(.001/e),this.h=this.h.add(o),c.i&&(c.h=c.h.j(o)),f&&h&&na(this.g,this.size,c.g,c.size,"#f00")):(e=this.size.add(c.size),i=2*(t.y-c.g.y)>e.y+0,a=2*Math.abs(t.y-c.g.y)<e.y,s=2*Math.abs(t.x-c.g.x)<e.x,o=Math.max(this.G,c.G),!i&&!s&&a||(this.g.y=c.g.y+(e.y/2+.001)*Math.sign(t.y-c.g.y),c.m&&l||!c.i?(l&&(this.m=c),this.h.y*=-o):c.i&&(s=(this.i*this.h.y+c.i*c.h.y)/(this.i+c.i),n=c.h.y*(c.i-this.i)/(this.i+c.i)+2*this.h.y*this.i/(this.i+c.i),this.h.y=s+J(o)*(this.h.y*(this.i-c.i)/(this.i+c.i)+2*c.h.y*c.i/(this.i+c.i)-s),c.h.y=s+J(o)*(n-s))),!i&&a&&(this.g.x=c.g.x+(e.x/2+.001)*Math.sign(t.x-c.g.x),c.i?(e=(this.i*this.h.x+c.i*c.h.x)/(this.i+c.i),i=c.h.x*(c.i-this.i)/(this.i+c.i)+2*this.h.x*this.i/(this.i+c.i),this.h.x=e+J(o)*(this.h.x*(this.i-c.i)/(this.i+c.i)+2*c.h.x*c.i/(this.i+c.i)-e),c.h.x=e+J(o)*(i-e)):this.h.x*=-o),f&&h&&na(this.g,this.size,c.g,c.size,"#f0f")));this.J&&Za(this.g,this.size,this)&&!Za(t,this.size,this)&&(c=Za(u(t.x,this.g.y),this.size,this),o=Za(u(this.g.x,t.y),this.size,this),!c&&o||(this.h.y*=-this.G,l?(this.g.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4,this.m=this):(this.g.y=t.y,this.m=void 0)),o&&(this.g.x=t.x,this.h.x*=-this.G),f)&&h&&ia(this.g,this.size,"#f00")}}D(){return!0}removeChild(t){r(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){let t="type = "+this.constructor.name;return(this.g.x||this.g.y)&&(t+="\npos = "+this.g),(this.h.x||this.h.y)&&(t+="\nvelocity = "+this.h),(this.size.x||this.size.y)&&(t+="\nsize = "+this.size),this.angle&&(t+="\nangle = "+this.angle.toFixed(3)),this.color&&(t+="\ncolor = "+this.color),t}}let z,w,v,y,B=u(),$a=[],ab;class P{constructor(t=u(),e=Sa,i=0){this.g=t.o(),this.size=e.o(),this.W=i,this.padding=0}offset(t){return new P(this.g.add(t),this.size,this.W)}frame(t){return r("number"==typeof t),this.offset(u(t*(this.size.x+2*this.padding),0))}}class bb{constructor(t){var e;this.image=t,this.size=u(t.width,t.height),(e=Qa)&&(e=Q.createTexture(),Q.bindTexture(Q.TEXTURE_2D,e),t&&t.width?Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,Q.RGBA,Q.UNSIGNED_BYTE,t):(t=new Uint8Array([255,255,255,255]),Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,1,1,0,Q.RGBA,Q.UNSIGNED_BYTE,t)),t=Q.NEAREST,Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,t),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,t)),this.S=e}}function cb(){var t=Da;return new K((t.x-B.x/2+.5)/C+A.x,(t.y-B.y/2+.5)/-C+A.y)}function ya(t){return new K((t.x-A.x)*C+B.x/2-.5,(t.y-A.y)*-C+B.y/2-.5)}function db(t,e=u(1),n,h=new M,i=0,a,s=new M(0,0,0,0),o=Qa){r(!0,"context only supported in canvas 2D mode"),r("number"!=typeof n||!n,"this is an old style calls, to fix replace it with tile(tileIndex, tileSize)"),r(L(t)&&L(e)),r(N(h)&&N(s));let l=n&&$a[n.W];var f,c,y,b;o?l?(b=u(1).L(l.size),o=n.g.x*b.x,f=n.g.y*b.y,c=n.size.x*b.x,y=n.size.y*b.y,b=b.scale(Ta),eb(l.S),fb(t.x,t.y,a?-e.x:e.x,e.y,i,o+b.x,f+b.y,o-b.x+c,f-b.y+y,Ma(h),Ma(s))):fb(t.x,t.y,e.x,e.y,i,0,0,0,0,0,Ma(h)):(ba&&++ab,gb(t,e=u(e.x,-e.y),i,a,t=>{var e,i,a,s;l?(e=n.g.x+Ta,i=n.g.y+Ta,a=n.size.x-2*Ta,s=n.size.y-2*Ta,t.globalAlpha=h.a,t.drawImage(l.image,e,i,a,s,-.5,-.5,1,1),t.globalAlpha=1):(t.fillStyle=h.toString(),t.fillRect(-.5,-.5,1,1))}))}function xa(t,e,i,a,s){db(t,e,void 0,i,a,!1,void 0,s)}function Aa(t,e,i,a){e=u((e.x-t.x)/2,(e.y-t.y)/2);var s=u(.1,2*e.length());xa(t.add(e),s,i,e.angle(),a)}function gb(t,e,i,a,s){var n=w;t=ya(t),e=e.scale(C),n.save(),n.translate(t.x+.5,t.y+.5),n.rotate(i),n.scale(a?-e.x:e.x,-e.y),s(n),n.restore()}function Ca(t,e,i=1,a=new M,s=0,n=new M(0,0,0),r="center",h=Pa){var o=y;o.fillStyle=a.toString(),o.lineWidth=s,o.strokeStyle=n.toString(),o.textAlign=r,o.font=i+"px "+h,o.textBaseline="middle",o.lineJoin="round",e=e.o(),t=(t+"").split("\n"),e.y-=(t.length-1)*i/2,t.forEach(t=>{s&&o.strokeText(t,e.x,e.y,void 0),o.fillText(t,e.x,e.y,void 0),e.y+=i})}function I(t,e=0){return r(0<e||"number"!=typeof t||t<3,"use code string for keyboard"),H[e]&&!!(1&H[e][t])}function hb(t){return r("number"!=typeof t||t<3,"use code string for keyboard"),H[0]&&!!(2&H[0][t])}let E=u(),Da=u(),ib=!1;function jb(t,e=0){return I(t,e+1)}let H=[[]];function kb(){if(!O)for(var t of H)for(var e in t)t[e]&=1}function lb(){function e(t){return"KeyW"==t?"ArrowUp":"KeyS"==t?"ArrowDown":"KeyA"==t?"ArrowLeft":"KeyD"==t?"ArrowRight":t}O||(onkeydown=t=>{t.repeat||(ib=!1,H[0][t.code]=3,H[0][e(t.code)]=3)},onkeyup=t=>{H[0][t.code]=4,H[0][e(t.code)]=4},onmousedown=t=>{!O&&R&&"running"!=R.state&&R.resume(),ib=!1,H[0][t.button]=3,Da=mb(t),t.button&&t.preventDefault()},onmouseup=t=>H[0][t.button]=2&H[0][t.button]|4,onmousemove=t=>Da=mb(t),onwheel=t=>t.ctrlKey?0:Math.sign(t.deltaY),oncontextmenu=()=>!1,onblur=()=>{H=[[]]},nb&&ob())}function mb(t){var e=z.getBoundingClientRect();return u(Ga(t.x,e.left,e.right)*z.width,Ga(t.y,e.top,e.bottom)*z.height)}let ua=[];function pb(){var e,i;if(ta&&navigator&&navigator.getGamepads){var a=navigator.getGamepads();for(let t=a.length;t--;){var s=a[t],n=H[t+1]||(H[t+1]=[]),r=ua[t]||(ua[t]=[]);if(s){for(var h=0;h<s.axes.length-1;h+=2)r[h>>1]=(e=u(s.axes[h],s.axes[h+1]),void 0,La(u((i=t=>.3<t?Ga(t,.3,.8):t<-.3?-Ga(-t,.3,.8):0)(e.x),i(-e.y))));for(h=s.buttons.length;h--;){var o=s.buttons[h],l=jb(h,t);n[h]=o.pressed?l?1:3:l?4:0,ib||=!t&&o.pressed}Ja(s=u((jb(15,t)&&1)-(jb(14,t)&&1),(jb(12,t)&&1)-(jb(13,t)&&1)))&&(r[0]=La(s))}}}}let nb=!O&&void 0!==window.ontouchstart;function ob(){function e(t){!O&&R&&"running"!=R.state&&R.resume();var e,i=t.touches.length;return i?(e=u(t.touches[0].clientX,t.touches[0].clientY),Da=mb(e),a?ib=!1:H[0][0]=3):a&&(H[0][0]=2&H[0][0]|4),a=i,document.hasFocus()&&t.preventDefault(),!0}document.addEventListener("touchstart",t=>e(t),{passive:!1}),document.addEventListener("touchmove",t=>e(t),{passive:!1}),document.addEventListener("touchend",t=>e(t),{passive:!1}),onmousedown=onmouseup=()=>0;let a}let R=new AudioContext,qb,rb=[],F=u();function Ba(t){var e=F;return r(L(e)),0<=t.x&&0<=t.y&&t.x<e.x&&t.y<e.y?rb[(0|t.y)*F.x+t.x|0]:0}function Za(t,e=u(),i){var a=Math.max(t.x-e.x/2|0,0),s=Math.max(t.y-e.y/2|0,0),n=Math.min(t.x+e.x/2,F.x);for(t=Math.min(t.y+e.y/2,F.y);s<t;++s)for(e=a;e<n;++e){var r,h=rb[s*F.x+e];if((r=h)&&!(r=!i)&&(u(e,s),r=0<h),r)return!0}return!1}function za(t){var e=E,i=e.j(t),a=i.length(),s=i.normalize(),s=u(Math.abs(1/s.x),Math.abs(1/s.y));let n=t.floor(),r=s.x*(i.x<0?t.x-n.x:n.x-t.x+1),h=s.y*(i.y<0?t.y-n.y:n.y-t.y+1);for(;;){if(Ba(n))return l&&ma(t,e,"#f00",.02),l&&la(n.add(u(.5)),"#ff0"),n.add(u(.5));if(r>a&&h>a)break;r>h?(n.y+=Math.sign(i.y),h+=s.y):(n.x+=Math.sign(i.x),r+=s.x)}l&&ma(t,e,"#00f",.02)}let S,Q,sb,tb,ub,vb,T,wb,U,xb,yb;function zb(){if(Qa&&!O){S=document.createElement("canvas"),Q=S.getContext("webgl2",{antialias:!0});var t=z.parentElement;if(Ra&&t.appendChild(S),t=Q.createProgram(),Q.attachShader(t,Ab("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",Q.VERTEX_SHADER)),Q.attachShader(t,Ab("#version 300 es\nprecision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}",Q.FRAGMENT_SHADER)),Q.linkProgram(t),!Q.getProgramParameter(t,Q.LINK_STATUS))throw Q.getProgramInfoLog(t);sb=t,t=new ArrayBuffer(44e4),T=new Float32Array(t),wb=new Uint32Array(t),ub=Q.createBuffer(),vb=Q.createBuffer(),t=new Float32Array([U=0,0,1,0,0,1,1,1]),Q.bindBuffer(Q.ARRAY_BUFFER,vb),Q.bufferData(Q.ARRAY_BUFFER,t,Q.STATIC_DRAW)}}function Bb(){var h,t,e;Qa&&!O&&(sa(),Q.useProgram(sb),Q.activeTexture(Q.TEXTURE0),$a[0]&&Q.bindTexture(Q.TEXTURE_2D,tb=$a[0].S),h=xb=yb=0,t=(t,e,i,a)=>{t=Q.getAttribLocation(sb,t);var s=i&&44,n=i&&1,r=1==i;Q.enableVertexAttribArray(t),Q.vertexAttribPointer(t,a,e,r,s,h),Q.vertexAttribDivisor(t,n),h+=a*i},Q.bindBuffer(Q.ARRAY_BUFFER,vb),t("g",Q.FLOAT,0,2),Q.bindBuffer(Q.ARRAY_BUFFER,ub),Q.bufferData(Q.ARRAY_BUFFER,44e4,Q.DYNAMIC_DRAW),t("p",Q.FLOAT,4,4),t("u",Q.FLOAT,4,4),t("c",Q.UNSIGNED_BYTE,1,4),t("a",Q.UNSIGNED_BYTE,1,4),t("r",Q.FLOAT,4,1),t=u(2*C).L(B),e=u(-1).j(A.multiply(t)),Q.uniformMatrix4fv(Q.getUniformLocation(sb,"m"),!1,[t.x,0,0,0,0,t.y,0,0,1,1,1,1,e.x,e.y,0,0]))}function sa(){Q.viewport(0,0,S.width=z.width,S.height=z.height),Q.clear(Q.COLOR_BUFFER_BIT)}function eb(t){O||t==tb||(Cb(),Q.bindTexture(Q.TEXTURE_2D,tb=t))}function Ab(t,e){if(e=Q.createShader(e),Q.shaderSource(e,t),Q.compileShader(e),Q.getShaderParameter(e,Q.COMPILE_STATUS))return e;throw Q.getShaderInfoLog(e)}function Cb(){var t;U&&(t=yb?Q.ONE:Q.ONE_MINUS_SRC_ALPHA,Q.blendFuncSeparate(Q.SRC_ALPHA,t,Q.ONE,t),Q.enable(Q.BLEND),Q.bufferSubData(Q.ARRAY_BUFFER,0,T),Q.drawArraysInstanced(Q.TRIANGLE_STRIP,0,4,U),ba&&(ab+=U),U=0,yb=xb)}function ra(t=!1){var e=w;Qa&&(U||t)&&(Cb(),Ra&&!t||e.drawImage(S,0,0))}function fb(t,e,i,a,s,n,h,o,l,u,f=0){r("number"==typeof u&&"number"==typeof f,"invalid color"),(1e4<=U||yb!=xb)&&Cb();var c=11*U++;T[c++]=t,T[c++]=e,T[c++]=i,T[c++]=a,T[c++]=n,T[c++]=h,T[c++]=o,T[c++]=l,wb[c++]=u,wb[c++]=f,T[+c]=s}let D=[],Ya=[],Db=0,Ia=0,Eb=0,V=0,Fb=0,Gb=[],Hb=[];function Ib(){Ya=D.filter(t=>t.C);for(var t of D)t.parent||(function t(e){if(!e.u){e.update();for(var i of e.children)t(i)}}(t),Ua(t));D=D.filter(t=>!t.u)}function Jb(t,e,i=D){var a,s=[];for(a of i){if(i=a.R)t:{i=t;var n=e,r=a.size,r=(h=a.g.j(r.scale(.5))).add(r),n=n.j(i),h=i.j(h);r=i.j(r),i=[-n.x,n.x,-n.y,n.y],h=[h.x,-r.x,h.y,-r.y],r=0,n=1;for(let t=4;t--;)if(i[t]){var o=h[t]/i[t];if(i[t]<0){if(n<o){i=!1;break t}r=Math.max(o,r)}else{if(o<r){i=!1;break t}n=Math.min(o,n)}}else if(h[t]<0){i=!1;break t}i=!0}i&&(l&&ia(a.g,a.size,"#f00"),s.push(a))}return l&&ma(t,e,s.length?"#f00":"#00f",.02),s}let W,Kb,Lb,Mb,Nb,Ob,Pb,X,Qb=!1;function Rb(i){var a,s=W.g;let n=1/0,r=null;for(a of u=Jb(s,i,Sb.M)){let t=a.K;var h,o,l=a.v,u=null;let e=0;for(h of l=[[l.right<s.x,()=>Tb(s,i,t.Z,t.P)],[l.left>s.x,()=>Tb(s,i,t.Y,t.O)],[l.top<s.y,()=>Tb(s,i,t.Y,t.Z)],[l.bottom>s.y,()=>Tb(s,i,t.O,t.P)]])!h[0]||null==(l=h[1]())||(o=Ka(s,l))>e&&(u=l,e=o);e<n&&(r=u,n=e)}return r=null===r?s.add(i.j(s).normalize(10)):r}function Tb(t,e,i,a){var s=(t.x-e.x)*(i.y-a.y)-(t.y-e.y)*(i.x-a.x);return Math.abs(s)<5e-5?null:u(((t.x*e.y-t.y*e.x)*(i.x-a.x)-(t.x-e.x)*(i.x*a.y-i.y*a.x))/s,((t.x*e.y-t.y*e.x)*(i.y-a.y)-(t.y-e.y)*(i.x*a.y-i.y*a.x))/s)}function Ub(){Lb.h=u(0,0),W.h=u(0,0)}((e,s,n,o,c,t,i=document.body)=>{function b(t=0){var e=t-Eb,i=(Eb=t,Fb+=J(.05)*(1e3/(e||1)-Fb),t=I("Equal"),I("Minus"));for(V+=e*(t?5:i?.2:1),t||(V=Math.min(V,50)),g(),e=0,V<0&&-9<V&&(e=V,V=0);0<=V;V-=1e3/60)Ia=Db++/60,O||(nb||document.hasFocus()||(H=[[]]),E=cb(),pb()),s(),Gb.forEach(t=>t()),Ib(),(f=hb("Escape")?!f:f)&&(hb("Digit0")&&(ba=!ba),hb("Digit1")&&(h=!h,da=!1),hb("Digit2")&&(da=!da,h=!1),hb("Digit3")&&(ea=!ea),hb("Digit4")&&(l=!l),hb("Digit5"))&&(fa=1),n(),kb();if(V+=e,!O){B=u(z.width,z.height),y.imageSmoothingEnabled=w.imageSmoothingEnabled=!1,Bb(),o(),D.sort((t,e)=>t.V-e.V);for(var a of D)a.u||db(a.g,a.da||a.size,a.ia,a.color,a.angle,a.U,a.ba);c(),Hb.forEach(t=>t()),qa(),ra(),ba&&(y.textAlign="right",y.textBaseline="top",y.font="1em monospace",y.fillStyle="#000",a="LittleJS v1.11.13 / "+ab+" / "+D.length+" / "+Fb.toFixed(1)+(Qa?" GL":" 2D"),y.fillText(a,z.width-3,3),y.fillStyle="#fff",y.fillText(a,z.width-2,2),ab=0)}requestAnimationFrame(b)}function g(){var t,e;O||(Oa.x?(z.width=Oa.x,z.height=Oa.y,t=innerWidth/innerHeight,e=z.width/z.height,(S||z).style.width=z.style.width=v.style.width=t<e?"100%":"",(S||z).style.height=z.style.height=v.style.height=t<e?"":"100%"):(z.width=Math.min(innerWidth,Na.x),z.height=Math.min(innerHeight,Na.y)),v.width=z.width,v.height=z.height,B=u(z.width,z.height))}function a(){new Promise(t=>t(e())).then(b)}r(!w,"engine already initialized"),r(Array.isArray(t),"pass in images as array"),e||=()=>{},s||=()=>{},n||=()=>{},o||=()=>{},c||=()=>{},O?a():(i.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",i.appendChild(z=document.createElement("canvas")),w=z.getContext("2d"),lb(),O||((qb=R.createGain()).connect(R.destination),qb.gain.value=.3),ha=document.createElement("a"),zb(),i.appendChild(v=document.createElement("canvas")),y=v.getContext("2d"),z.style.cssText=v.style.cssText="position:absolute",S&&(S.style.cssText="position:absolute"),g(),i=t.map((i,a)=>new Promise(t=>{let e=new Image;e.crossOrigin="anonymous",e.onerror=e.onload=()=>{$a[a]=new bb(e),t()},e.src=i})),t.length||i.push(new Promise(t=>{$a[0]=new bb(new Image),t()})),Promise.all(i).then(a))})(function(){var t=new P(u(1,0),u(62,64)),e=new P(u(64,0),u(64,64)),i=(Mb=new P(u(128,0),u(63,63)),new P(u(0,64),u(64,64)));for(Nb=new P(u(64,64),u(64,64)),new P(u(128,64),u(64,64)),W=new Vb(u(0,0),Vb.A,t),Lb=new Wb(u(0,0),Wb.A,e),Ob=new Xb(u(10,10),i),Kb=new Sb,t=.2;t<64;t+=16)for(e=192.2;e<256;e+=16)Yb.X.push(new P(u(e,t),u(15.6,15.6)));Pb=new Yb(Zb[0]),X="paused"},function(){var t;I("Space")?Qb||(Qb=!0,"paused"==X?(X="active",console.log("Game Active")):"active"==X?(X="paused",Ub(),console.log("Game Paused")):"caught"==X&&(X="active",$b(Pb),W.size=Vb.A,Lb.size=Wb.A)):Qb=!1,"active"==X&&(W.h=u((I("ArrowRight")?1:0)-(I("ArrowLeft")?1:0),(I("ArrowUp")?1:0)-(I("ArrowDown")?1:0)).scale(Vb.speed),(t=Lb).h=La(Kb.g.j(t.g),Wb.speed),t.v=ac(t.g,t.size),t.K=cc(t.v))},function(){},function(){for(var e=-10;e<10;e+=4)for(let t=-10;t<10;t+=4)db(u(e,t),u(4),Mb);"active"==X&&(e=Rb(e=W.g.add(E.j(W.g).normalize(20))),Kb.g=e),Aa(W.g,Kb.g,G(1,0,0))},function(){"caught"==X&&(db(W.g.add(Lb.g).scale(.5),u(5,5),Nb),Ca("Caught",ya(u(0,-5)),100),Ca("Press Space to Restart",ya(u(0,-10)),50)),"paused"==X&&Ca("Press Space to Start",B.scale(.5),100)},["tiles.png"]);class Vb extends Xa{static A=u(1.5,1.5);constructor(t,e,i){super(t,e,i),Wa(this)}static speed=.2;D(t){return t instanceof Wb&&(X=X="caught",W.size=u(0),Lb.size=u(0),Ub()),t instanceof dc&&(this.h=u(0,0)),!0}}class Wb extends Xa{static A=u(1.9,1.9);constructor(t,e,i){super(t,e,i),Wa(this),this.v=ac(this.g,this.size),this.K=cc(this.v),Sb.M.push(this)}static speed=.05}function ac(t,e){return{top:t.y+e.y/2,left:t.x-e.x/2,right:t.x+e.x/2,bottom:t.y-e.y/2}}function cc(t){return{Z:u(t.right,t.top),Y:u(t.left,t.top),P:u(t.right,t.bottom),O:u(t.left,t.bottom)}}class dc extends Xa{constructor(t,e,i){super(t,e,i),Wa(this),this.i=0,dc.ja.push(this),Sb.M.push(this),this.v=ac(this.g,this.size),this.K=cc(this.v)}static ja=[]}class Sb extends Xa{static M=[];constructor(){super(W.g,u(.3,.3)),this.color=G(1,0,0)}}class Xb extends Xa{constructor(t,e){super(t,u(2,2),e),Wa(this)}D(t){return t instanceof Vb&&(alert("WIN!"),Va(this)),!1}}function $b(i){for(let e=0;e<i.height;e++)for(let t=0;t<i.width;t++){var a=u(t-i.$,e-i.aa).scale(Yb.scale);"C"==Y(i,t,e)&&(Lb.g=a),"M"==Y(i,t,e)&&(W.g=a),"G"==Y(i,t,e)&&(Ob.g=a,Kb.g=Ob.g)}}function Y(t,e,i){return e>=t.width||i>=t.height||e<0||i<0?"+":(e<0&&(e=t.width-e),i<0&&(i=t.height-i),t.level[i][e])}class Yb{static X=[];static scale=2;constructor(i){i=i.trim().split("\n"),this.level=[];for(var a of i)this.level.push(Array.from(a));this.level.reverse(),this.width=this.level[0].length,this.height=this.level.length,this.$=Math.round(this.width/2),this.aa=Math.round(this.height/2);for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){var s;"W"==Y(this,t,e)&&(a=u(t-this.$,e-this.aa).scale(Yb.scale),i=u(1,1).scale(Yb.scale),s=+("W"==Y(this,t,e+1)),s=(s=(s+=+("W"==Y(this,t+1,e))<<1)+(+("W"==Y(this,t,e-1))<<2))+(+("W"==Y(this,t-1,e))<<3),new dc(a,i,Yb.X[s]))}$b(this)}}let Zb=["\nWWWWWWWWW\nW++W++C+W\nW+++++++W\nWM++WW++W\nW+++WW+0W\nWWWWWWWWW\n","\nWWWWWWWWWWWWWW\nW+++W+C++W+++W\nW+1+W+2++++++W\nWM+++++++W+0+W\nW+++W++++W+++W\nWWWWWWWWWWWWWW\n"];
</script>