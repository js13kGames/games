<!doctype html><title>Laserpointer - js13kGames 2025</title><body><script>let t,e,i=!0,s=!1,n=[],r=!1,h=!1,a=!1,o=!1;function l(t,e){e?console.assert(t,e):console.assert(t)}function f(t,e=b(),i="#fff",s=0,r=0,h=!1){l("string"==typeof i,"pass in css color strings"),n.push({g:t,size:b(e),color:i,time:new B(s),angle:r,fill:h})}function c(t,e=0,i="#fff"){l("string"==typeof i,"pass in css color strings"),n.push({g:t,size:e,color:i,time:new B(0),angle:0,fill:!0})}function u(t,e){l("string"==typeof e,"pass in css color strings"),f(t,void 0,e)}function g(t,e,i,s=.1){e=b((e.x-t.x)/2,(e.y-t.y)/2),s=b(s,2*e.length()),f(t.add(e),s,i,void 0,e.angle(),!0)}function x(t,e,i,s,n){var r=b(Math.min(t.x-e.x/2,i.x-s.x/2),Math.min(t.y-e.y/2,i.y-s.y/2));t=b(Math.max(t.x+e.x/2,i.x+s.x/2),Math.max(t.y+e.y/2,i.y+s.y/2)),f(r.T(t,.5),t.j(r),n)}function y(t,e){l(!0,"pass in css color strings"),n.push({text:t,g:e,size:.2,color:"#fff",time:new B(0),angle:0,font:"monospace"})}function d(){if(kt(),t&&(kt(!0),$.drawImage(Z,0,0),Gt(),Z.width|=0,q.fillRect(0,0,V.width,V.height),q.drawImage(V,0,0),function(){var t=Z.toDataURL("image/png");e.download="screenshot",e.href=t,e.click()}(),t=0),o&&O&&navigator.getGamepads)for(var i=navigator.getGamepads(),l=i.length;l--;){var x=i[l];if(x){for(var d=_,m=pt[l],v=m.length;v--;){var p=d.add(b(2*+v,3*+l)),w=p.add(m[v].scale(1));c(p,1,"#fff7"),g(p,w,"#f00"),u(w,"#f00")}for(m=x.buttons.length;m--;)c(v=d.add(b(.2*m*2,3*+l-1-.2)),.2,x.buttons[m].pressed?"#f00":"#fff7"),y(""+m,v)}}if(s){for(var W of(i=$,$=q,l=tt.scale(1/N),f(_,l.j(b(.1)),"#f008"),l=1/0,Yt)){var A;!W.u&&(Y(W),W.size.x)&&W.size.y&&(x=T(ut,W.g))<l&&(l=x,A=W)}0<Pt.x&&0<Pt.y&&at(ut.floor().add(b(.5)),b(1),R(0,0,1,.5),0,!1),$=i}q.lineWidth=2;let E=.5*N;if(n.forEach(t=>{q.save();var e=rt(t.g);if(q.translate(0|e.x,0|e.y),q.rotate(t.angle),q.scale(1,t.text?1:-1),q.fillStyle=q.strokeStyle=t.color,null!=t.text)q.font=t.size*N+"px "+t.font,q.textAlign="center",q.textBaseline="middle",q.fillText(t.text,0,0);else if(null!=t.points){for(var i of(q.beginPath(),t.points))e=i.scale(N).floor(),q.lineTo(e.x,e.y);q.closePath(),t.fill&&q.fill(),q.stroke()}else 0==t.size||0===t.size.x&&0===t.size.y?(q.fillRect(-E/2,-1,E,3),q.fillRect(-1,-E/2,3,E)):null!=t.size.x?(i=(e=t.size.scale(N).floor()).x,e=e.y,t.fill&&q.fillRect(-i/2|0,-e/2|0,i,e),q.strokeRect(-i/2|0,-e/2|0,i,e)):(q.beginPath(),q.arc(0,0,t.size*N,0,9),t.fill&&q.fill(),q.stroke());q.restore()}),n=n.filter(t=>t.time<0),A&&(W=$,$=q,(i=function(t){var e=ut,i=e.j(t),s=i.length(),n=i.normalize();n=b(Math.abs(1/n.x),Math.abs(1/n.y));let r=t.floor(),a=n.x*(i.x<0?t.x-r.x:r.x-t.x+1),o=n.y*(i.y<0?t.y-r.y:r.y-t.y+1);for(;;){if(Ut(r))return h&&g(t,e,"#f00",.02),h&&u(r.add(b(.5)),"#ff0"),r.add(b(.5));if(a>s&&o>s)break;a>o?(r.y+=Math.sign(i.y),o+=n.y):(r.x+=Math.sign(i.x),a+=n.x)}h&&g(t,e,"#00f",.02)}(A.g))&&at(i.floor().add(b(.5)),b(1),R(0,1,1,.3)),ot(ut,A.g,i?R(1,0,0,.5):R(0,1,0,.5),!1),lt(A="mouse pos = "+ut+"\nmouse collision = "+Ut(ut)+"\n\n--- object info ---\n"+A.toString(),gt,24,R(),.05,void 0,"center","monospace"),$=W),q.save(),q.fillStyle="#fff",q.textAlign="left",q.textBaseline="top",q.font="28px monospace",q.shadowColor="#000",q.shadowBlur=9,A=-20,s){for(var z in q.fillText("LittleJS",9,A+=30),q.fillText("Objects: "+Yt.length,9,A+=30),q.fillText("Time: "+(Kt/60|0)+":"+(Kt%60<10?"0":"")+(Kt%60|0),9,A+=30),q.fillText("---------",9,A+=30),q.fillStyle="#f00",q.fillText("ESC: Debug Overlay",9,A+=30),q.fillStyle=r?"#f00":"#fff",q.fillText("1: Debug Physics",9,A+=30),q.fillStyle=a?"#f00":"#fff",q.fillText("2: Debug Particles",9,A+=30),q.fillStyle=o?"#f00":"#fff",q.fillText("3: Debug Gamepads",9,A+=30),q.fillStyle=h?"#f00":"#fff",q.fillText("4: Debug Raycasts",9,A+=30),q.fillStyle="#fff",q.fillText("5: Save Screenshot",9,A+=30),W="",dt[0])ft(z,0)&&(W+=z+" ");if(W&&q.fillText("Keys Down: "+W,9,A+=30),z="",dt[1])for(var S in dt[1])ft(S,1)&&(z+=S+" ");z&&q.fillText("Gamepad: "+z,9,A+=30)}else q.fillText(r?"Debug Physics":"",9,A+=30),q.fillText(a?"Debug Particles":"",9,A+=30),q.fillText(h?"Debug Raycasts":"",9,A+=30),q.fillText(o?"Debug Gamepads":"",9,A+=30);q.restore()}let m=Math.PI;function v(t,e=0,i=1){return t<e?e:i<t?i:t}function p(t,e,i){return(i-=e)?v((t-e)/i):0}function w(t,e,i,s=b()){return 2*Math.abs(t.x-i.x)<e.x+s.x&&2*Math.abs(t.y-i.y)<e.y+s.y}function b(t=0,e){return"number"==typeof t?new S(t,null==e?t:e):new S(t.x,t.y)}function W(t){return t instanceof S}function T(t,e){return l(W(e)),(t.x-e.x)**2+(t.y-e.y)**2}function A(t){return t.x**2+t.y**2}function E(t,e){return l(W(e)),T(t,e)**.5}function z(t,e=1){var i=t.length();return e<i?t.scale(e/i):t}class S{constructor(t=0,e=0){this.x=t,this.y=e,l(this.B())}set(t=0,e=0){return this.x=t,this.y=e,l(this.B()),this}o(){return new S(this.x,this.y)}add(t){return l(W(t)),new S(this.x+t.x,this.y+t.y)}j(t){return l(W(t)),new S(this.x-t.x,this.y-t.y)}multiply(t){return l(W(t)),new S(this.x*t.x,this.y*t.y)}L(t){return l(W(t)),new S(this.x/t.x,this.y/t.y)}scale(t){return l(!W(t)),new S(this.x*t,this.y*t)}length(){return A(this)**.5}normalize(t=1){var e=this.length();return e?this.scale(t/e):new S(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var e=Math.cos(-t);return t=Math.sin(-t),new S(this.x*e-this.y*t,this.x*t+this.y*e)}setDirection(t,e=1){return l(0==(t=(t%4+4)%4)||1==t||2==t||3==t),b(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new S(Math.floor(this.x),Math.floor(this.y))}T(t,e){return l(W(t)),this.add(t.j(this).scale(v(e)))}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}B(){return"number"==typeof this.x&&!isNaN(this.x)&&"number"==typeof this.y&&!isNaN(this.y)}}function R(t,e,i,s){return new F(t,e,i,s)}function M(t){return t instanceof F}function D(t){return(255*v(t.r)|0)+(255*v(t.l)<<8)+(255*v(t.b)<<16)+(255*v(t.a)<<24)}class F{constructor(t=1,e=1,i=1,s=1){this.r=t,this.l=e,this.b=i,this.a=s,l(this.B())}set(t=1,e=1,i=1,s=1){return this.r=t,this.l=e,this.b=i,this.a=s,l(this.B()),this}o(){return new F(this.r,this.l,this.b,this.a)}add(t){return l(M(t)),new F(this.r+t.r,this.l+t.l,this.b+t.b,this.a+t.a)}j(t){return l(M(t)),new F(this.r-t.r,this.l-t.l,this.b-t.b,this.a-t.a)}multiply(t){return l(M(t)),new F(this.r*t.r,this.l*t.l,this.b*t.b,this.a*t.a)}L(t){return l(M(t)),new F(this.r/t.r,this.l/t.l,this.b/t.b,this.a/t.a)}scale(t,e=t){return new F(this.r*t,this.l*t,this.b*t,this.a*e)}T(t,e){return l(M(t)),this.add(t.j(this).scale(v(e)))}toString(t=!0){var e=t=>((t=255*v(t)|0)<16?"0":"")+t.toString(16);return"#"+e(this.r)+e(this.l)+e(this.b)+(t?e(this.a):"")}B(){return!("number"!=typeof this.r||isNaN(this.r)||"number"!=typeof this.l||isNaN(this.l)||"number"!=typeof this.b||isNaN(this.b)||"number"!=typeof this.a||isNaN(this.a))}}R(),R(0,0,0),R(.5,.5,.5),R(1,0,0),R(1,.5,0),R(1,1,0),R(0,1,0),R(0,1,1),R(0,0,1),R(.5,0,1),R(1,0,1);class B{constructor(t){this.time=null==t?void 0:Kt+t,this.setTime=t}set(t=0){this.time=Kt+t,this.setTime=t}active(){return Kt<this.time}get(){return null!=this.time?Kt-this.time:0}toString(){return null!=this.time?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let _=b(),N=32,I=b(1920,1080),P=b(),U="arial",L=!1,G=!0,C=!0,j=b(16),k=0,O=!0;function Y(t){var e=b(Math.max(t.size.x,.2),Math.max(t.size.y,.2)),i=R(t.J?1:0,t.C?1:0,t.H?1:0,t.parent?.2:.5),s=t.parent?R(1,1,1,.5):R(0,0,0,.8);at(t.g,e,i,t.angle,!1),at(t.g,e.scale(.8),s,t.angle,!1),t.parent&&ot(t.g,t.parent.g,R(0,0,1,.5),!1)}function X(t){var e,i,s=t.parent;for(i of(s&&(e=s.U?-1:1,t.g=t.ha.multiply(b(e,1)).rotate(s.angle).add(s.g),t.angle=e*t.ga+s.angle),t.children))X(i)}function H(t){if(!t.u)for(var e of(t.u=1,t.parent&&t.parent.removeChild(t),t.children))H(e,e.parent=0)}function K(t){l(!0,"solid objects must be set to collide"),t.C=!0,t.H=!0,t.J=!0,t.R=!0}b(640,80);class J{constructor(t=b(),e=b(1),i){var s=new F;l(W(t)&&W(e),"ensure pos and size are vec2s"),l("number"!=typeof i||!i,"old style tile setup"),this.g=t.o(),this.size=e,this.da=void 0,this.ia=i,this.angle=0,this.color=s,this.ba=void 0,this.U=!1,this.I=this.F=this.i=1,this.G=0,this.ea=.8,this.fa=1,this.V=0,this.h=b(),this.N=0,this.children=[],this.ca=!0,this.parent=this.m=void 0,this.ha=b(),this.ga=0,this.R=this.H=this.C=this.J=!1,Yt.push(this)}update(){var t;if(!this.parent&&(this.ca?(this.h.x=v(this.h.x,-1,1),this.h.y=v(this.h.y,-1,1)):1<(t=A(this.h))&&(this.h.x*=t=1/t**.5,this.h.y*=t),t=this.g.o(),this.h.x*=this.F,this.h.y*=this.F,this.i&&(this.h.y+=0*this.fa),this.g.x+=this.h.x,this.g.y+=this.h.y,this.angle+=this.N*=this.I,l(0<=this.I&&this.I<=1),l(0<=this.F&&this.F<=1),this.i)){var e,i,n,h,a,o,c=this.h.y<0;if(this.m&&(o=this.m!=this&&this.m.h?this.m.h.x:0,this.h.x=o+(this.h.x-o)*this.ea,this.m=void 0),this.C)for(var u of Xt)!this.H&&!u.H||u.u||u.parent||u==this||w(this.g,this.size,u.g,u.size)&&(o=this.D(u),e=u.D(this),o)&&e&&(w(t,this.size,u.g,u.size)?((e=(o=t.j(u.g)).length())<.01?(o=new S,e=2*m*Math.random(),o.x=.001*Math.sin(e),o.y=.001*Math.cos(e)):o=o.scale(.001/e),this.h=this.h.add(o),u.i&&(u.h=u.h.j(o)),s&&r&&x(this.g,this.size,u.g,u.size,"#f00")):(e=this.size.add(u.size),i=2*(t.y-u.g.y)>e.y+0,n=2*Math.abs(t.y-u.g.y)<e.y,h=2*Math.abs(t.x-u.g.x)<e.x,o=Math.max(this.G,u.G),!i&&!h&&n||(this.g.y=u.g.y+(e.y/2+.001)*Math.sign(t.y-u.g.y),u.m&&c||!u.i?(c&&(this.m=u),this.h.y*=-o):u.i&&(h=(this.i*this.h.y+u.i*u.h.y)/(this.i+u.i),a=u.h.y*(u.i-this.i)/(this.i+u.i)+2*this.h.y*this.i/(this.i+u.i),this.h.y=h+v(o)*(this.h.y*(this.i-u.i)/(this.i+u.i)+2*u.h.y*u.i/(this.i+u.i)-h),u.h.y=h+v(o)*(a-h))),!i&&n&&(this.g.x=u.g.x+(e.x/2+.001)*Math.sign(t.x-u.g.x),u.i?(e=(this.i*this.h.x+u.i*u.h.x)/(this.i+u.i),i=u.h.x*(u.i-this.i)/(this.i+u.i)+2*this.h.x*this.i/(this.i+u.i),this.h.x=e+v(o)*(this.h.x*(this.i-u.i)/(this.i+u.i)+2*u.h.x*u.i/(this.i+u.i)-e),u.h.x=e+v(o)*(i-e)):this.h.x*=-o),s&&r&&x(this.g,this.size,u.g,u.size,"#f0f")));this.J&&Lt(this.g,this.size,this)&&!Lt(t,this.size,this)&&(u=Lt(b(t.x,this.g.y),this.size,this),o=Lt(b(this.g.x,t.y),this.size,this),!u&&o||(this.h.y*=-this.G,c?(this.g.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4,this.m=this):(this.g.y=t.y,this.m=void 0)),o&&(this.g.x=t.x,this.h.x*=-this.G),s)&&r&&f(this.g,this.size,"#f00")}}D(){return!0}removeChild(t){l(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){let t="type = "+this.constructor.name;return(this.g.x||this.g.y)&&(t+="\npos = "+this.g),(this.h.x||this.h.y)&&(t+="\nvelocity = "+this.h),(this.size.x||this.size.y)&&(t+="\nsize = "+this.size),this.angle&&(t+="\nangle = "+this.angle.toFixed(3)),this.color&&(t+="\ncolor = "+this.color),t}}let V,$,Z,q,Q,tt=b(),et=[];class it{constructor(t=b(),e=j,i=0){this.g=t.o(),this.size=e.o(),this.W=i,this.padding=0}offset(t){return new it(this.g.add(t),this.size,this.W)}frame(t){return l("number"==typeof t),this.offset(b(t*(this.size.x+2*this.padding),0))}}class st{constructor(t){var e;this.image=t,this.size=b(t.width,t.height),(e=G)&&(e=Tt.createTexture(),Tt.bindTexture(Tt.TEXTURE_2D,e),t&&t.width?Tt.texImage2D(Tt.TEXTURE_2D,0,Tt.RGBA,Tt.RGBA,Tt.UNSIGNED_BYTE,t):(t=new Uint8Array([255,255,255,255]),Tt.texImage2D(Tt.TEXTURE_2D,0,Tt.RGBA,1,1,0,Tt.RGBA,Tt.UNSIGNED_BYTE,t)),t=Tt.NEAREST,Tt.texParameteri(Tt.TEXTURE_2D,Tt.TEXTURE_MIN_FILTER,t),Tt.texParameteri(Tt.TEXTURE_2D,Tt.TEXTURE_MAG_FILTER,t)),this.S=e}}function nt(){var t=gt;return new S((t.x-tt.x/2+.5)/N+_.x,(t.y-tt.y/2+.5)/-N+_.y)}function rt(t){return new S((t.x-_.x)*N+tt.x/2-.5,(t.y-_.y)*-N+tt.y/2-.5)}function ht(t,e=b(1),s,n=new F,r=0,h,a=new F(0,0,0,0),o=G){l(!0,"context only supported in canvas 2D mode"),l("number"!=typeof s||!s,"this is an old style calls, to fix replace it with tile(tileIndex, tileSize)"),l(W(t)&&W(e)),l(M(n)&&M(a));let f=s&&et[s.W];var c,u,g,x;o?f?(x=b(1).L(f.size),o=s.g.x*x.x,c=s.g.y*x.y,u=s.size.x*x.x,g=s.size.y*x.y,x=x.scale(k),function(t){L||t==Et||(jt(),Tt.bindTexture(Tt.TEXTURE_2D,Et=t))}(f.S),Ot(t.x,t.y,h?-e.x:e.x,e.y,r,o+x.x,c+x.y,o-x.x+u,c-x.y+g,D(n),D(a))):Ot(t.x,t.y,e.x,e.y,r,0,0,0,0,0,D(n)):(i&&++Q,function(t,e,i,s,n){var r=$;t=rt(t),e=e.scale(N),r.save(),r.translate(t.x+.5,t.y+.5),r.rotate(i),r.scale(s?-e.x:e.x,-e.y),n(r),r.restore()}(t,e=b(e.x,-e.y),r,h,t=>{var e,i,r,h;f?(e=s.g.x+k,i=s.g.y+k,r=s.size.x-2*k,h=s.size.y-2*k,t.globalAlpha=n.a,t.drawImage(f.image,e,i,r,h,-.5,-.5,1,1),t.globalAlpha=1):(t.fillStyle=n.toString(),t.fillRect(-.5,-.5,1,1))}))}function at(t,e,i,s,n){ht(t,e,void 0,i,s,!1,void 0,n)}function ot(t,e,i,s){e=b((e.x-t.x)/2,(e.y-t.y)/2);var n=b(.1,2*e.length());at(t.add(e),n,i,e.angle(),s)}function lt(t,e,i=1,s=new F,n=0,r=new F(0,0,0),h="center",a=U){var o=q;o.fillStyle=s.toString(),o.lineWidth=n,o.strokeStyle=r.toString(),o.textAlign=h,o.font=i+"px "+a,o.textBaseline="middle",o.lineJoin="round",e=e.o(),t=(t+"").split("\n"),e.y-=(t.length-1)*i/2,t.forEach(t=>{n&&o.strokeText(t,e.x,e.y,void 0),o.fillText(t,e.x,e.y,void 0),e.y+=i})}function ft(t,e=0){return l(0<e||"number"!=typeof t||t<3,"use code string for keyboard"),dt[e]&&!!(1&dt[e][t])}function ct(t){return l("number"!=typeof t||t<3,"use code string for keyboard"),dt[0]&&!!(2&dt[0][t])}let ut=b(),gt=b(),xt=!1;function yt(t,e=0){return ft(t,e+1)}let dt=[[]];function mt(){if(!L)for(var t of dt)for(var e in t)t[e]&=1}function vt(t){var e=V.getBoundingClientRect();return b(p(t.x,e.left,e.right)*V.width,p(t.y,e.top,e.bottom)*V.height)}let pt=[];function wt(){var t,e;if(O&&navigator&&navigator.getGamepads){var i=navigator.getGamepads();for(let l=i.length;l--;){var s=i[l],n=dt[l+1]||(dt[l+1]=[]),r=pt[l]||(pt[l]=[]);if(s){for(var h=0;h<s.axes.length-1;h+=2)r[h>>1]=(t=b(s.axes[h],s.axes[h+1]),z(b((e=t=>.3<t?p(t,.3,.8):t<-.3?-p(-t,.3,.8):0)(t.x),e(-t.y))));for(h=s.buttons.length;h--;){var a=s.buttons[h],o=yt(h,l);n[h]=a.pressed?o?1:3:o?4:0,xt||=!l&&a.pressed}A(s=b((yt(15,l)&&1)-(yt(14,l)&&1),(yt(12,l)&&1)-(yt(13,l)&&1)))&&(r[0]=z(s))}}}}let bt,Wt,Tt,At,Et,zt,St,Rt,Mt,Dt,Ft,Bt,_t=!L&&void 0!==window.ontouchstart,Nt=new AudioContext,It=[],Pt=b();function Ut(t){var e=Pt;return l(W(e)),0<=t.x&&0<=t.y&&t.x<e.x&&t.y<e.y?It[(0|t.y)*Pt.x+t.x|0]:0}function Lt(t,e=b(),i){var s=Math.max(t.x-e.x/2|0,0),n=Math.max(t.y-e.y/2|0,0),r=Math.min(t.x+e.x/2,Pt.x);for(t=Math.min(t.y+e.y/2,Pt.y);n<t;++n)for(e=s;e<r;++e){var h,a=It[n*Pt.x+e];if((h=a)&&!(h=!i)&&(b(e,n),h=0<a),h)return!0}return!1}function Gt(){Tt.viewport(0,0,Wt.width=V.width,Wt.height=V.height),Tt.clear(Tt.COLOR_BUFFER_BIT)}function Ct(t,e){if(e=Tt.createShader(e),Tt.shaderSource(e,t),Tt.compileShader(e),Tt.getShaderParameter(e,Tt.COMPILE_STATUS))return e;throw Tt.getShaderInfoLog(e)}function jt(){var t;Dt&&(t=Bt?Tt.ONE:Tt.ONE_MINUS_SRC_ALPHA,Tt.blendFuncSeparate(Tt.SRC_ALPHA,t,Tt.ONE,t),Tt.enable(Tt.BLEND),Tt.bufferSubData(Tt.ARRAY_BUFFER,0,Rt),Tt.drawArraysInstanced(Tt.TRIANGLE_STRIP,0,4,Dt),i&&(Q+=Dt),Dt=0,Bt=Ft)}function kt(t=!1){var e=$;G&&(Dt||t)&&(jt(),C&&!t||e.drawImage(Wt,0,0))}function Ot(t,e,i,s,n,r,h,a,o,f,c=0){l("number"==typeof f&&"number"==typeof c,"invalid color"),(1e4<=Dt||Bt!=Ft)&&jt();var u=11*Dt++;Rt[u++]=t,Rt[u++]=e,Rt[u++]=i,Rt[u++]=s,Rt[u++]=r,Rt[u++]=h,Rt[u++]=a,Rt[u++]=o,Mt[u++]=f,Mt[u++]=c,Rt[+u]=n}let Yt=[],Xt=[],Ht=0,Kt=0,Jt=0,Vt=0,$t=0,Zt=[],qt=[];function Qt(){for(var t of(Xt=Yt.filter(t=>t.C),Yt))t.parent||(function t(e){if(!e.u)for(var i of(e.update(),e.children))t(i)}(t),X(t));Yt=Yt.filter(t=>!t.u)}let te,ee,ie,se,ne,re,he,ae,oe=!1;function le(t,e,i,s){var n=(t.x-e.x)*(i.y-s.y)-(t.y-e.y)*(i.x-s.x);return Math.abs(n)<5e-5?null:b(((t.x*e.y-t.y*e.x)*(i.x-s.x)-(t.x-e.x)*(i.x*s.y-i.y*s.x))/n,((t.x*e.y-t.y*e.x)*(i.y-s.y)-(t.y-e.y)*(i.x*s.y-i.y*s.x))/n)}function fe(){ie.h=b(0,0),te.h=b(0,0)}((n,f,c,u,g,x,y=document.body)=>{function m(e=0){var n=e-Jt,l=(Jt=e,$t+=v(.05)*(1e3/(n||1)-$t),e=ft("Equal"),ft("Minus"));for(Vt+=n*(e?5:l?.2:1),e||(Vt=Math.min(Vt,50)),p(),n=0,Vt<0&&-9<Vt&&(n=Vt,Vt=0);0<=Vt;Vt-=1e3/60)Kt=Ht++/60,L||(_t||document.hasFocus()||(dt=[[]]),ut=nt(),wt()),f(),Zt.forEach(t=>t()),Qt(),(s=ct("Escape")?!s:s)&&(ct("Digit0")&&(i=!i),ct("Digit1")&&(r=!r,a=!1),ct("Digit2")&&(a=!a,r=!1),ct("Digit3")&&(o=!o),ct("Digit4")&&(h=!h),ct("Digit5"))&&(t=1),c(),mt();if(Vt+=n,!L){for(var x of(tt=b(V.width,V.height),q.imageSmoothingEnabled=$.imageSmoothingEnabled=!1,function(){var t,e,i;G&&!L&&(Gt(),Tt.useProgram(At),Tt.activeTexture(Tt.TEXTURE0),et[0]&&Tt.bindTexture(Tt.TEXTURE_2D,Et=et[0].S),t=Ft=Bt=0,e=(e,i,s,n)=>{e=Tt.getAttribLocation(At,e);var r=s&&44,h=s&&1,a=1==s;Tt.enableVertexAttribArray(e),Tt.vertexAttribPointer(e,n,i,a,r,t),Tt.vertexAttribDivisor(e,h),t+=n*s},Tt.bindBuffer(Tt.ARRAY_BUFFER,St),e("g",Tt.FLOAT,0,2),Tt.bindBuffer(Tt.ARRAY_BUFFER,zt),Tt.bufferData(Tt.ARRAY_BUFFER,44e4,Tt.DYNAMIC_DRAW),e("p",Tt.FLOAT,4,4),e("u",Tt.FLOAT,4,4),e("c",Tt.UNSIGNED_BYTE,1,4),e("a",Tt.UNSIGNED_BYTE,1,4),e("r",Tt.FLOAT,4,1),e=b(2*N).L(tt),i=b(-1).j(_.multiply(e)),Tt.uniformMatrix4fv(Tt.getUniformLocation(At,"m"),!1,[e.x,0,0,0,0,e.y,0,0,1,1,1,1,i.x,i.y,0,0]))}(),u(),Yt.sort((t,e)=>t.V-e.V),Yt))x.u||ht(x.g,x.da||x.size,x.ia,x.color,x.angle,x.U,x.ba);g(),qt.forEach(t=>t()),d(),kt(),i&&(q.textAlign="right",q.textBaseline="top",q.font="1em monospace",q.fillStyle="#000",x="LittleJS v1.11.13 / "+Q+" / "+Yt.length+" / "+$t.toFixed(1)+(G?" GL":" 2D"),q.fillText(x,V.width-3,3),q.fillStyle="#fff",q.fillText(x,V.width-2,2),Q=0)}requestAnimationFrame(m)}function p(){var t,e;L||(P.x?(V.width=P.x,V.height=P.y,t=innerWidth/innerHeight,e=V.width/V.height,(Wt||V).style.width=V.style.width=Z.style.width=t<e?"100%":"",(Wt||V).style.height=V.style.height=Z.style.height=t<e?"":"100%"):(V.width=Math.min(innerWidth,I.x),V.height=Math.min(innerHeight,I.y)),Z.width=V.width,Z.height=V.height,tt=b(V.width,V.height))}function w(){new Promise(t=>t(n())).then(m)}l(!$,"engine already initialized"),l(Array.isArray(x),"pass in images as array"),n||=()=>{},f||=()=>{},c||=()=>{},u||=()=>{},g||=()=>{},L?w():(y.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",y.appendChild(V=document.createElement("canvas")),$=V.getContext("2d"),function(){function t(t){return"KeyW"==t?"ArrowUp":"KeyS"==t?"ArrowDown":"KeyA"==t?"ArrowLeft":"KeyD"==t?"ArrowRight":t}L||(onkeydown=e=>{e.repeat||(xt=!1,dt[0][e.code]=3,dt[0][t(e.code)]=3)},onkeyup=e=>{dt[0][e.code]=4,dt[0][t(e.code)]=4},onmousedown=t=>{!L&&Nt&&"running"!=Nt.state&&Nt.resume(),xt=!1,dt[0][t.button]=3,gt=vt(t),t.button&&t.preventDefault()},onmouseup=t=>dt[0][t.button]=2&dt[0][t.button]|4,onmousemove=t=>gt=vt(t),onwheel=t=>t.ctrlKey?0:Math.sign(t.deltaY),oncontextmenu=()=>!1,onblur=()=>{dt=[[]]},_t&&function(){function t(t){!L&&Nt&&"running"!=Nt.state&&Nt.resume();var i,s=t.touches.length;return s?(i=b(t.touches[0].clientX,t.touches[0].clientY),gt=vt(i),e?xt=!1:dt[0][0]=3):e&&(dt[0][0]=2&dt[0][0]|4),e=s,document.hasFocus()&&t.preventDefault(),!0}let e;document.addEventListener("touchstart",e=>t(e),{passive:!1}),document.addEventListener("touchmove",e=>t(e),{passive:!1}),document.addEventListener("touchend",e=>t(e),{passive:!1}),onmousedown=onmouseup=()=>0}())}(),L||((bt=Nt.createGain()).connect(Nt.destination),bt.gain.value=.3),e=document.createElement("a"),function(){if(G&&!L){Wt=document.createElement("canvas"),Tt=Wt.getContext("webgl2",{antialias:!0});var t=V.parentElement;if(C&&t.appendChild(Wt),t=Tt.createProgram(),Tt.attachShader(t,Ct("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",Tt.VERTEX_SHADER)),Tt.attachShader(t,Ct("#version 300 es\nprecision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}",Tt.FRAGMENT_SHADER)),Tt.linkProgram(t),!Tt.getProgramParameter(t,Tt.LINK_STATUS))throw Tt.getProgramInfoLog(t);At=t,t=new ArrayBuffer(44e4),Rt=new Float32Array(t),Mt=new Uint32Array(t),zt=Tt.createBuffer(),St=Tt.createBuffer(),t=new Float32Array([Dt=0,0,1,0,0,1,1,1]),Tt.bindBuffer(Tt.ARRAY_BUFFER,St),Tt.bufferData(Tt.ARRAY_BUFFER,t,Tt.STATIC_DRAW)}}(),y.appendChild(Z=document.createElement("canvas")),q=Z.getContext("2d"),V.style.cssText=Z.style.cssText="position:absolute",Wt&&(Wt.style.cssText="position:absolute"),p(),y=x.map((t,e)=>new Promise(i=>{let s=new Image;s.crossOrigin="anonymous",s.onerror=s.onload=()=>{et[e]=new st(s),i()},s.src=t})),x.length||y.push(new Promise(t=>{et[0]=new st(new Image),t()})),Promise.all(y).then(w))})(function(){var t=new it(b(1,0),b(62,64)),e=new it(b(64,0),b(64,64)),i=(se=new it(b(128,0),b(63,63)),new it(b(0,64),b(64,64)));for(ne=new it(b(64,64),b(64,64)),new it(b(128,64),b(64,64)),te=new ce(b(0,0),ce.A,t),ie=new ue(b(0,0),ue.A,e),re=new me(b(10,10),i),ee=new de,t=.2;t<64;t+=16)for(e=192.2;e<256;e+=16)we.X.push(new it(b(e,t),b(15.6,15.6)));he=new we(be[0]),ae="paused"},function(){var t;ft("Space")?oe||(oe=!0,"paused"==ae?(ae="active",console.log("Game Active")):"active"==ae?(ae="paused",fe(),console.log("Game Paused")):"caught"==ae&&(ae="active",ve(he),te.size=ce.A,ie.size=ue.A)):oe=!1,"active"==ae&&(te.h=b((ft("ArrowRight")?1:0)-(ft("ArrowLeft")?1:0),(ft("ArrowUp")?1:0)-(ft("ArrowDown")?1:0)).scale(ce.speed),(t=ie).h=z(ee.g.j(t.g),ue.speed),t.v=ge(t.g,t.size),t.K=xe(t.v))},function(){},function(){for(var t=-10;t<10;t+=4)for(let e=-10;e<10;e+=4)ht(b(t,e),b(4),se);"active"==ae&&(t=function(t){var e,i=te.g;let s=1/0,n=null;for(e of l=function(t,e,i=Yt){var s,n=[];for(s of i){if(i=s.R)t:{i=t;var r=e,a=s.size,o=(a=(o=s.g.j(a.scale(.5))).add(a),r=r.j(i),i.j(o));a=i.j(a),i=[-r.x,r.x,-r.y,r.y],o=[o.x,-a.x,o.y,-a.y],a=0,r=1;for(let t=4;t--;)if(i[t]){var l=o[t]/i[t];if(i[t]<0){if(r<l){i=!1;break t}a=Math.max(l,a)}else{if(l<a){i=!1;break t}r=Math.min(l,r)}}else if(o[t]<0){i=!1;break t}i=!0}i&&(h&&f(s.g,s.size,"#f00"),n.push(s))}return h&&g(t,e,n.length?"#f00":"#00f",.02),n}(i,t,de.M)){let h=e.K;var r,a,o=e.v,l=null;let f=0;for(r of o=[[o.right<i.x,()=>le(i,t,h.Z,h.P)],[o.left>i.x,()=>le(i,t,h.Y,h.O)],[o.top<i.y,()=>le(i,t,h.Y,h.Z)],[o.bottom>i.y,()=>le(i,t,h.O,h.P)]])!r[0]||null==(o=r[1]())||(a=E(i,o))>f&&(l=o,f=a);f<s&&(n=l,s=f)}return null===n?i.add(t.j(i).normalize(10)):n}(t=te.g.add(ut.j(te.g).normalize(20))),ee.g=t),ot(te.g,ee.g,R(1,0,0))},function(){"caught"==ae&&(ht(te.g.add(ie.g).scale(.5),b(5,5),ne),lt("Caught",rt(b(0,-5)),100),lt("Press Space to Restart",rt(b(0,-10)),50)),"paused"==ae&&lt("Press Space to Start",tt.scale(.5),100)},["tiles.png"]);class ce extends J{static A=b(1.5,1.5);constructor(t,e,i){super(t,e,i),K(this)}static speed=.2;D(t){return t instanceof ue&&(ae=ae="caught",te.size=b(0),ie.size=b(0),fe()),t instanceof ye&&(this.h=b(0,0)),!0}}class ue extends J{static A=b(1.9,1.9);constructor(t,e,i){super(t,e,i),K(this),this.v=ge(this.g,this.size),this.K=xe(this.v),de.M.push(this)}static speed=.05}function ge(t,e){return{top:t.y+e.y/2,left:t.x-e.x/2,right:t.x+e.x/2,bottom:t.y-e.y/2}}function xe(t){return{Z:b(t.right,t.top),Y:b(t.left,t.top),P:b(t.right,t.bottom),O:b(t.left,t.bottom)}}class ye extends J{constructor(t,e,i){super(t,e,i),K(this),this.i=0,ye.ja.push(this),de.M.push(this),this.v=ge(this.g,this.size),this.K=xe(this.v)}static ja=[]}class de extends J{static M=[];constructor(){super(te.g,b(.3,.3)),this.color=R(1,0,0)}}class me extends J{constructor(t,e){super(t,b(2,2),e),K(this)}D(t){return t instanceof ce&&(alert("WIN!"),H(this)),!1}}function ve(t){for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){var e=b(s-t.$,i-t.aa).scale(we.scale);"C"==pe(t,s,i)&&(ie.g=e),"M"==pe(t,s,i)&&(te.g=e),"G"==pe(t,s,i)&&(re.g=e,ee.g=re.g)}}function pe(t,e,i){return e>=t.width||i>=t.height||e<0||i<0?"+":(e<0&&(e=t.width-e),i<0&&(i=t.height-i),t.level[i][e])}class we{static X=[];static scale=2;constructor(t){for(var e of(t=t.trim().split("\n"),this.level=[],t))this.level.push(Array.from(e));this.level.reverse(),this.width=this.level[0].length,this.height=this.level.length,this.$=Math.round(this.width/2),this.aa=Math.round(this.height/2);for(let s=0;s<this.height;s++)for(let n=0;n<this.width;n++){var i;"W"==pe(this,n,s)&&(e=b(n-this.$,s-this.aa).scale(we.scale),t=b(1,1).scale(we.scale),i=+("W"==pe(this,n,s+1)),i=(i=(i+=+("W"==pe(this,n+1,s))<<1)+(+("W"==pe(this,n,s-1))<<2))+(+("W"==pe(this,n-1,s))<<3),new ye(e,t,we.X[i]))}ve(this)}}let be=["\nWWWWWWWWW\nW++W++C+W\nW+++++++W\nWM++WW++W\nW+++WW+0W\nWWWWWWWWW\n","\nWWWWWWWWWWWWWW\nW+++W+C++W+++W\nW+1+W+2++++++W\nWM+++++++W+0+W\nW+++W++++W+++W\nWWWWWWWWWWWWWW\n"]</script>