<!doctype html><meta content="width=device-width" name=viewport><style>body{background:#000;color:#fff;margin:0;padding:0;font-size:16px;display:flex;min-height:100vh}canvas{margin:auto;cursor:none;image-rendering:pixelated}</style><title>Exit the Castle - js13kGames 2023</title><body><script>let o,f,h=[],n=(h.push({map:[[9,9],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[4,1]],t:[[64,24]],i:[64,80]}),h.push({map:[[9,9],h[0].map[1],[4,1]],t:[[16,24],[112,24]],i:[64,112]}),h.push({map:[[19,9],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[16,1]],t:[[32,24],[32,42],[256,112],[256,96],[272,80]],i:[32,112]}),h.push({map:[[19,9],h[2].map[1],[2,1]],t:[[128,56],[256,24],[256,42],[32,112],[32,96],[16,80]],i:[256,112]}),h.push({map:[[13,17],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6,1]],t:[[80,32],[96,32],[112,32],[16,240],[32,240],[176,240],[160,240]],i:[96,240]}),h.push({map:[[17,14],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1]],t:[[208,152],[240,152],[240,96],[96,32],[80,32],[64,88],[80,88],[16,32],[16,48],[96,192],[64,192]],i:[224,192]}),h.push({map:[[13,13],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6,1]],t:[[16,24],[176,24],[16,176],[32,176],[16,160],[176,176],[160,176],[176,160]],i:[96,176]}),h.push({map:[[17,14],h[5].map[1].slice().reverse(),[2,1]],t:[[160,32],[160,64],[192,64],[192,32],[240,48],[240,96],[240,128],[192,128],[192,192],[16,192],[16,128],[16,64],[48,64]],i:[240,192]}),h.push({map:[[13,17],h[4].map[1].slice().reverse(),[6,1]],t:[[16,24],[32,24],[48,24],[64,24],[128,24],[144,24],[160,24],[176,24],[80,192],[112,192],[80,96],[112,96]],i:[96,240]}),h.push({map:[[13,13],h[6].map[1],[6,1]],t:[[16,24],[32,24],[16,42],[176,24],[160,24],[176,42],[16,176],[32,176],[16,160],[176,176],[160,176],[176,160]],i:[96,176]}),h.push({map:[[14,14],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,1]],t:[[16,136],[80,136],[80,192],[16,192],[128,136],[192,136],[192,192],[128,192],[128,24],[192,24],[192,80],[128,80],[16,24],[80,24],[80,80],[16,80]],i:[48,192]}),h.push({map:[[13,14],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6,1]],t:[[16,32],[32,32],[48,32],[16,192],[32,192],[48,192],[144,192],[160,192],[176,192],[144,32],[160,32],[176,32],[96,32],[96,48],[96,64]],i:[96,128]}),h.push({map:[[28,12],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[26,1]],t:[[16,120],[32,120],[96,160],[112,96],[128,96],[16,32],[32,32],[96,32],[80,32],[144,160],[160,160],[224,32],[208,32],[240,96],[256,96],[272,160],[288,160],[272,32],[288,32],[336,96],[352,96],[336,160],[352,160],[336,32],[352,32],[368,160],[384,160],[368,32],[384,32]],i:[224,160]}),[]);const a=document.createElement("canvas"),y=(a.setAttribute("width",320),a.setAttribute("height",180),a.getContext("2d")),x=320,d=180,c={},m={x:0,y:0},u={x:0,y:0},p=(key={x:0,y:0,o:128,h:31,l:0},{u:[,,150,.05,,.05,,1.3,,,,,,3],m:[.2,0,267,.1,.06,,,1.49,4.3,-.8,,,,2,,.3,.15,.52,.05],M:[.3,0,260,,.1,.07,4,4.7,,,,,,.4,,.4,.12,.3,.02,.01],g:[.5,,499,,.15,.04,,1.47,4.5,-6.8,,,.17,.5,,.3,.13,.73,.04,.12],p:[.2,0,415,.01,.4,.35,1,.7,,6.27,-50,.04,.11,,,,,.5],escape:[1.01,,749,.1,.09,.14,1,1.03,,,100,.03,-.02,,,,.11,.7,.07],P:[1.1,,146,,.02,.12,1,.6,-8.6,-6.3,,,,,,,,.8,.02,.15],v:[.5,0,471,,.03,.43,4,1.06,-5.5,,,,,.9,61,.1,,.5,.02],key:[,,1675,,.06,.24,1,1.82,,,837,.06]});let g,z=0,M=null,e=new Image,w=0,R=1,v=0,A=0,S=0,k=0,L=0;const E=new OffscreenCanvas(320,180),b=E.getContext("2d"),C=new OffscreenCanvas(160,96),l=C.getContext("2d");let I=[];class s{constructor(e,t){this.x=e,this.y=t,this.k=D.x>this.x?1:-1}k=0;R=1;C=0;S=0;speed=.75;T=0;A=100;frame=0;D=0;p=0}const D={x:100,y:100,k:1,R:0,D:0,A:100,frame:0,angle:0,X:[],Y:18,accuracy:19,G:1,key:0,O:100,l:function(){b.save(),-1==this.k&&(b.translate(320,0),b.scale(-1,1)),this.A<=0?(0==this.A&&(zzfx(...p.p),this.A=-1),b.drawImage(C,128,64,16,16,152,82,16,16)):0<this.D?(2==this.D&&zzfx(...p.g),b.drawImage(C,144,64,16,16,152,82,16,16),--this.D):b.drawImage(C,16*Math.floor(D.frame),64,16,16,152,82,16,16),b.restore(),b.fillStyle="rgb(0, 0, 0)",b.fillRect(D.x-u.x-1,D.y-u.y+4+16-1,18,3),b.fillStyle="rgb(255, 0, 0)",b.fillRect(D.x-u.x,D.y-u.y+4+16,Math.round(D.A/this.O*100*.16),1)}};function V(e="",r=100,o=0,f="rgb(255,255,255)",t=2,a=0,h=0){e=String(e).toUpperCase();const n=(t*=5)/5,y=[...Array(33),29,,,,,,12,,,,"ᇄ",3,"ႄ",1,1118480,"縿",31,"庽","嚿","炟","皷","纷","䈟","线","皿",17,,,"⥊",,"䊼",,"㹏","纮","縱","縮","纵","纐","񴚦","粟","䟱","丿",1020241,"簡",33059359,1024159,"縿","纜","񼙯","繍","皷","䏰","簿",25363672,32541759,18157905,"惸",18470705,,,,,"С"];let i,x=[];i=[...e].reduce((e,t)=>{const a=y[t.charCodeAt()]||"",i=((0<a?a:a.codePointAt())||0).toString(2),l=31==a?3:Math.ceil(i.length/5),s=e+n;return i.padStart(5*l,0).match(new RegExp(".{5}","g")).map((e,a)=>[...e].map((e,t)=>{1==e&&x.push({fill:f,q:r+s+a*n,F:o+t*n,H:n})})),e+(l+1)*n+h},0);const l=a?Math.floor(i/2):0;x.forEach(e=>{b.fillStyle=e.fill,b.fillRect(e.q-l,e.F,n,n)})}function B(e,t,a,i,l,s,r,o){return e<l+r&&l<e+a&&t<s+o&&s<i+t}function W(){b.imageSmoothingEnabled=!1,b.fillStyle="#000",b.fillRect(0,0,x,d),o.l(C,b,u.x,u.y,x,d),I.sort((e,t)=>e.y>t.y?1:-1),I.forEach(e=>{e.A<=0?(b.save(),-1==e.k&&(b.translate(2*(e.x-u.x)+16,0),b.scale(-1,1)),0==e.A&&(e.A=-1),b.globalAlpha=(100- -1*e.A)/100,b.drawImage(C,128,80,16,16,e.x-u.x,e.y-u.y,16,16)):(b.save(),D.x<e.x&&(b.translate(2*(e.x-u.x)+16,0),b.scale(-1,1)),e.D?(2==e.D&&zzfx(...p.M),b.drawImage(C,144,80,16,16,e.x-u.x,e.y-u.y,16,16),--e.D):e.C?b.drawImage(C,112+16*Math.floor(e.frame),48,16,16,e.x-u.x,e.y-u.y,16,16):b.drawImage(C,16*Math.floor(e.frame),80,16,16,e.x-u.x,e.y-u.y,16,16)),b.restore()}),D.l(),key.l&&b.drawImage(C,key.o,key.h,16,16,key.x-u.x,key.y-u.y,16,16),D.X.forEach(e=>{var t=e.x-u.x,a=e.y-u.y;t<0||319<t||a<0||179<a||(b.save(),b.translate(t,a),b.rotate(e.angle),b.translate(-t,-a),b.drawImage(C,128,0,19,19,t-10,a-10,19,19),b.restore())})}function t(){var e=Math.floor(window.innerWidth/x),t=Math.floor(window.innerHeight/d);g=Math.min(e,t)||1,a.setAttribute("width",x*g),a.setAttribute("height",d*g)}function G(e){var t,a=e-w,l=Math.min(1e3/60,25);if(a>Math.floor(l)){if(w=e,v)a=m.x<205&&120<m.x&&78<m.y&&m.y<123?"#fd0":"#fff",b.fillStyle="#000",b.fillRect(0,0,x,d),V("Exit the Castle",161,19,"#dd0a1e",3,1),z?(V("You didn't escape this time",160,45,"#fff",1,1),V("You made it to level "+(k+1),160,55,"#fff",1,1),V("Try again to see if you can make it out",160,65,"#fff",1,1)):(V("You are trapped in the Sheriff of Nottingham's castle",160,50,"#fff",1,1),V("Survive against his knights to escape",160,60,"#fff",1,1)),V("Play",160,90,a,4,1),b.strokeStyle=a,b.lineWidth=4,b.strokeRect(122,80,80,40),V("WASD/arrows to move, mouse to aim, click to shoot",160,140,"#eee",1,1);else if(R)b.fillStyle="#4b0e9a",b.fillRect(0,0,x,d),(l=b.createRadialGradient(x,d,400,180,0,110)).addColorStop(1,"#423a9c"),l.addColorStop(.7,"#72394a"),l.addColorStop(0,"#f17640"),b.fillStyle=l,b.fillRect(0,0,x,d),V("13",80,22,"#773f10",10,0,8),V("13",75,17,"#773f10",10,0,8),V("13",70,12,"#e1ae00",10,0,8),V("th",179,51,"#773f10",3,0,4),V("th",177,49,"#773f10",3,0,4),V("th",175,47,"#e1ae00",3,0,4),b.fillStyle="#773f10",b.fillRect(87,68,130,6),b.fillStyle="#e1ae00",b.fillRect(85,66,130,6),b.fillStyle="#773f10",b.fillRect(92,76,120,3),b.fillStyle="#e1ae00",b.fillRect(90,74,120,3),V("century",101,83,"#773f10",3,0,3),V("century",99,81,"#773f10",3,0,3),V("century",97,79,"#e1ae00",3,0,3),b.fillStyle="#773f10",b.fillRect(92,98,120,5),b.fillStyle="#e1ae00",b.fillRect(90,96,120,5),V("badger",100,107,"#773f10",4,0,1),V("badger",98,105,"#773f10",4,0,1),V("badger",96,103,"#e1ae00",4,0,1),b.fillStyle="#773f10",b.fillRect(92,128,120,3),b.fillStyle="#e1ae00",b.fillRect(90,125,120,3),b.fillStyle="#773f10",b.fillRect(98,131,110,33),b.fillStyle="#e1ae00",b.fillRect(95,131,110,30);else if(A)for(b.fillStyle="#000",b.fillRect(0,0,x,d),V("Level up!",160,20,"#dd0a1e",3,1),V("How far can you get?",160,50,"#fff",1,1),V("Choose an upgrade to start level "+(k+2),160,65,"#fff",1,1),f=["Extra health"],0<k&&(19==D.accuracy&&f.push("Eagle eye"),13==D.accuracy&&f.push("Eagle eye master"),7==D.accuracy)&&f.push("Eagle eye legend"),2<k&&(18==D.Y&&f.push("Extra damage"),20==D.Y&&f.push("Damage master"),25==D.Y)&&f.push("Damage legend"),4<k&&1==D.G&&f.push("Twin shot"),7<k&&2==D.G&&f.push("Triple shot"),i=0;i<f.length;i++){var s=80+20*i,r=m.y>s&&m.y<11+s?"#fd0":"#fff";V(f[i],160,s,r,2,1),n[i]=[s,11+s]}else if(S)e=m.x<199&&124<m.x&&120<m.y&&m.y<136?"#fd0":"#fff",b.fillStyle="#000",b.fillRect(0,0,x,d),V("Congratulations!",160,18,"#fff",3,1,1),V("Congratulations!",160,20,"#666",3,1,1),V("Congratulations!",161,19,"#fd0",3,1,1),V("You made your way out",160,50,"#fff",2,1),V("Escaping from the Sheriff of Nottingham once",160,80,"#fff",1,1),V("again, you go on to write your name into legend",160,95,"#fff",1,1),b.fillStyle=e,b.fillRect(124,120,74,15),b.fillStyle="#000",b.fillRect(125,121,72,13),V("back to the start",160,125,e,1,1);else{0<D.A?(D.R=0,(c.w||c.ArrowUp)&&(a=Math.floor(D.x/16),l=Math.floor((D.y-D.speed+8)/16),e=Math.floor((D.x+16)/16),t=Math.floor((D.y-D.speed+8)/16),1==D.key)&&(a==o.N[0]&&l==o.N[1]||e==o.N[0]&&t==o.N[1])&&(k+1==h.length?(zzfx(...p.escape),S=1):A=1),(c.w||c.ArrowUp)&&o.V(D.x,D.y-D.speed)&&o.V(D.x+16-1,D.y-D.speed)&&(D.y-=D.speed,D.R=1),(c.a||c.ArrowLeft)&&o.V(D.x-D.speed,D.y)&&o.V(D.x-D.speed,D.y+16-1)&&(D.x-=D.speed,D.R=1),(c.s||c.ArrowDown)&&o.V(D.x,D.y+D.speed+16-1)&&o.V(D.x+16-1,D.y+D.speed+16-1)&&(D.y+=D.speed,D.R=1),(c.d||c.ArrowRight)&&o.V(D.x+D.speed+16-1,D.y)&&o.V(D.x+D.speed+16-1,D.y+16-1)&&(D.x+=D.speed,D.R=1),D.frame=D.frame<7&&1==D.R?D.frame+=.25:0):null==M&&(M=setTimeout(()=>{Y(0),v=1,z=1},2e3)),key.l&&B(D.x,D.y,16,16,key.x,key.y,16,16)&&(key.l=0,D.key=1,zzfx(...p.key)),u.x=D.x-160+8,u.y=D.y-90+8;for(let r=0;r<I.length;r++){let i=I[r],l=0,s=0;if(!(i.A<=0)&&(i.C?(i.frame=i.frame<2?i.frame+=.3:0,2<i.frame&&(i.C=0)):i.frame=i.frame<7&&1==i.R?i.frame+=.25:0,i.T+=i.speed,1<i.T)){--i.T,D.x>i.x&&o.V(i.x+i.speed+16-1,i.y)&&o.V(i.x+i.speed+16-1,i.y+16-1)&&(l=i.speed),D.y>i.y&&o.V(i.x,i.y+i.speed+16-1)&&o.V(i.x+16-1,i.y+i.speed+16-1)&&(s=i.speed),D.x<i.x&&o.V(i.x-i.speed,i.y)&&o.V(i.x-i.speed,i.y+16-1)&&(l=-i.speed),D.y<i.y&&o.V(i.x,i.y-i.speed)&&o.V(i.x+16-1,i.y-i.speed)&&(s=-i.speed);let t=0,a=0;for(let e=0;e<I.length;e++)r==e||I[e].A<=0||(B(i.x+l,i.y,16,8,I[e].x,I[e].y,16,8)&&(t=1),B(i.x,i.y+s,16,8,I[e].x,I[e].y,16,8)&&(a=1));B(i.x-1,i.y-1,18,18,D.x,D.y,16,16)||(t||(i.x+=l),a)||(i.y+=s),0<i.S&&--i.S,B(i.x-1,i.y-1,18,18,D.x,D.y,16,16)&&0==i.S&&0<D.A&&(i.C=1,D.A-=10,D.D=2,i.frame=0,i.S=10)}}D.X.forEach(t=>{D.X=D.X.filter(e=>!0!==e.remove),t.x+=t.j,t.y+=t.I,o.V(t.x,t.y)||(t.remove=!0),I.forEach(e=>{e.A<=0||0==t.remove&&B(e.x,e.y,16,16,t.x,t.y,1,1)&&(t.remove=!0,e.A-=D.Y,e.S=10,e.C=0,e.D=2,e.A<=0)&&(D.x<e.x?e.k=-1:e.k=1)})}),I.forEach(e=>{if(e.A<=0&&!e.p){e.p=1,zzfx(...p.v);let t=0;for(let e=0;e<I.length;e++)1!=I[e].p&&1!=I[e].remove&&(t+=1);0==t&&(key.x=e.x,key.y=e.y,key.l=1)}e.A<=0&&--e.A,e.A<=-100&&(e.remove=!0)}),I=I.filter(e=>!0!==e.remove),W()}b.drawImage(C,0,16,5,5,m.x-3,m.y-3,5,5),a=E,(l=y).imageSmoothingEnabled=!1,l.drawImage(a,0,0,x,d,0,0,x*g,d*g)}requestAnimationFrame(G)}function X(e,t){t=-t*(Math.PI/180);var a=Math.cos(t);return t=Math.sin(t),new Array(Math.round(1e4*(e[0]*a-e[1]*t))/1e4,Math.round(1e4*(e[0]*t+e[1]*a))/1e4)}function Y(t){0==t&&(D.Y=18,D.accuracy=19,D.G=1,D.O=100),t=h[t],M=null,D.A<=0&&(D.A=100),D.R=0,D.D=0,D.speed=1,D.frame=0,D.angle=0,D.X=[],D.key=0,I=[],D.x=t.i[0],D.y=t.i[1],o=new r(t.map[1],t.map[0][0],t.map[0][1],t.map[2]);for(let e=0;e<t.t.length;e++)I.push(new s(t.t[e][0],t.t[e][1]))}window.addEventListener("load",()=>{window.addEventListener("resize",e=>{t(),W()}),document.addEventListener("keydown",e=>{c[e.key]=!0}),document.addEventListener("keyup",e=>{c[e.key]=!1}),document.addEventListener("mousemove",e=>{m.x=Math.round((e.clientX-a.getBoundingClientRect().left)/g),m.y=Math.round((e.clientY-a.getBoundingClientRect().top)/g),D.A<=0||(D.k=m.x<160?-1:1)}),document.addEventListener("mousedown",e=>{if(A)for(i=0;i<n.length;i++)m.y>n[i][0]&&m.y<n[i][1]&&(A=0,Y(++k),"Extra health"==f[i]&&(D.A+=20,D.A>D.O)&&(D.O=D.A),"Eagle eye"==f[i]&&(D.accuracy=13),"Eagle eye master"==f[i]&&(D.accuracy=7),"Eagle eye legend"==f[i]&&(D.accuracy=1),"Extra damage"==f[i]&&(D.Y=20),"Damage master"==f[i]&&(D.Y=25),"Damage legend"==f[i]&&(D.Y=35),"Twin shot"==f[i]&&(D.G=2),"Triple shot"==f[i])&&(D.G=3);else if(R)L||(L=1,a=zzfxM(...J),zzfxP(...a).onended=function(){R=0,v=1,L=0},setTimeout(()=>{1==L&&(L=0,R=0,v=1)},9e3));else if(v)m.x<205&&120<m.x&&78<m.y&&m.y<123&&(v=0,k=0);else if(S&&m.x<199&&124<m.x&&120<m.y&&m.y<136&&location.reload(),!(S||D.A<=0)){var t,a=m.x-(D.x-u.x)+8-16,l=m.y-(D.y-u.y)+8-16,s=(a/=s=Math.sqrt(a*a+l*l),l/=s,D.angle=Math.atan2(l,a),D.angle<0&&(D.angle=Math.PI+(Math.PI+D.angle)),2==D.G?-5:0),r=X([a,l],(t=-D.accuracy,r=D.accuracy,Math.floor(t+Math.random()*(r-t+1))+s));let e={x:D.x+8+Math.floor(10*a),y:D.y+8+Math.floor(10*l),j:3*r[0],I:3*r[1],angle:D.angle,remove:!1};D.X.push(e),1<D.G&&(t=2==D.G?X([a,l],5):X([a,l],10),e={x:D.x+8+Math.floor(10*a),y:D.y+8+Math.floor(10*l),j:3*t[0],I:3*t[1],angle:D.angle,remove:!1},D.X.push(e)),3==D.G&&(multi=X([a,l],-10),e={x:D.x+8+Math.floor(10*a),y:D.y+8+Math.floor(10*l),j:3*multi[0],I:3*multi[1],angle:D.angle,remove:!1},D.X.push(e)),zzfx(...p.u)}}),document.body.appendChild(a),t(),e.onload=async function(){l.imageSmoothingEnabled=!1,l.drawImage(e,0,0,160,96,0,0,160,96);var t=l.getImageData(0,0,160,96);for(let e=0;e<t.data.length;e+=4)t.data[e]<5&&t.data[e+1]<5&&250<t.data[e+2]&&(t.data[e+3]=0);l.clearRect(0,0,160,96),l.putImageData(t,0,0),Y(k),requestAnimationFrame(G)},e.src="s.png"});class r{cols=32;rows=35;L=16;W=7;B=[];N=[];constructor(e,t,a,i){this.B=e,this.rows=a,this.cols=t,this.N=i;for(let t=0;t<this.B.length;t++){var l=t%this.cols,s=Math.floor(t/this.cols);if(0==this.B[t]){let e=0;Math.abs(this.J(l,s-1)-2.5)<2.5&&(e+=1),Math.abs(this.J(l,s+1)-2.5)<2.5&&(e+=8),Math.abs(this.J(l-1,s)-2.5)<2.5&&(e+=2),Math.abs(this.J(1+l,s)-2.5)<2.5&&(e+=4),0<(e=0==e&&(Math.abs(this.J(l-1,s+1)-2.5)<2.5&&(e=64),Math.abs(this.J(1+l,s+1)-2.5)<2.5)?128:e)&&(this.B[t]=e+this.W)}else 1==this.B[t]&&(this.B[t]=Math.floor(4*Math.random())+1)}for(let e=0;e<this.B.length;e++){var r,o;4<this.B[e]||(r=e%this.cols,o=Math.floor(e/this.cols),this.J(r,o-1)==8+this.W&&(this.B[e]=5),this.J(r,o-1)==10+this.W&&(this.B[e]=6),this.J(r,o-1)==12+this.W&&(this.B[e]=7))}}J(e,t){return this.B[t*this.cols+e]}V(e,t){var a;return!(-1==(a=this.J(Math.floor(e/this.L),Math.floor((t+this.L/2)/this.L)))||4<a&&a<8||0==(a=this.J(Math.floor(e/this.L),Math.floor(t/this.L)))||a>this.W)}K(e){return-1==e?{x:112,y:32}:-2==e?{x:112,y:16}:0<e&&e<5?{x:e*this.L,y:2*this.L}:5==e?{x:80,y:16}:6==e?{x:96,y:48}:7==e?{x:96,y:16}:e==4+this.W?{x:0,y:48}:e==2+this.W?{x:32,y:48}:e==1+this.W?{x:16,y:48}:e==8+this.W?{x:80,y:0}:e==3+this.W?{x:80,y:32}:e==5+this.W?{x:0,y:32}:e==12+this.W?{x:96,y:0}:e==10+this.W?{x:96,y:32}:void 0}l(a,i,e,t,l,s){var r=Math.floor(e/this.L),o=r+l/this.L,f=Math.floor(t/this.L),h=f+s/this.L,n=-e+r*this.L,y=-t+f*this.L;for(let t=r;t<=o;t++)for(let e=f;e<=h;e++){var x=this.J(t,e),d=this.K(x),c=16*(t-r)+n,m=16*(e-f)+y;void 0!==d&&x&&0<=t&&t<this.cols&&0<=e&&e<this.rows&&(i.drawImage(a,d.x,d.y,this.L,this.L,c,m,this.L,this.L),t==this.N[0])&&e==this.N[1]&&i.drawImage(a,112,32,this.L,this.L,c,m,this.L,this.L)}}}const J=[[[.7,0,51,,.1,.2,3,4,,,3,.9,.05],[.7,0,58,,.25,.2,3,4,,,3,.9,.05]],[[[1,0,11,0,15,0,18,0,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,15,0,14,0,13,0,15,15.3,15.6,,,],[1,0,11,0,15,0,18,0,20,,,,,0,0,0,0,13,0,16,0,20,0,23,,,,,0,0,0,0,13,0,16,0,19,0,23,,,,,0,0,18,0,15,0,16,0,18,18.3,18.6,,,],[0,0,,,,,,,,,1,0,1,1,1,,,-1,0,0,0,0,0,0,0,1,0,1,1,1,,,13,0,16,0,19,0,23,,,,,-1,,,,,,,,2,2.3,2.6,,,],[0,0,,,,,,,,,4,0,4,4,4,,,-1,0,0,0,0,0,0,0,4,0,4,4,6,,,,,,,,,,,,,,,,,,,,,,3,3.3,3.6,,,],[0,0,,,,,,,,,8,0,8,8,8,,,-1,0,0,0,0,0,0,0,7,0,7,7,10,,,,,-1,,,,,,,,,,,,,,,,,6,6.3,6.6,,,]]],[0],102];zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxP=(...e)=>{let t=zzfxX.createBufferSource(),a=zzfxX.createBuffer(e.length,e[0].length,zzfxR);return e.map((e,t)=>a.getChannelData(t).set(e)),t.buffer=a,t.connect(zzfxX.destination),t.start(),t},zzfxG=(e=1,t=.05,a=220,i=0,l=0,s=.1,r=0,o=1,f=0,h=0,n=0,y=0,x=0,d=0,c=0,m=0,u=0,p=1,g=0,z=0)=>{let M,w,R=2*Math.PI,v=f*=500*R/zzfxR**2,A=(0<c?1:-1)*R/4,S=a*=(1+2*t*Math.random()-t)*R/zzfxR,k=[],L=0,E=0,b=0,C=1,I=0,D=0,V=0;for(i=99+zzfxR*i,g*=zzfxR,l*=zzfxR,s*=zzfxR,u*=zzfxR,h*=500*R/zzfxR**3,c*=R/zzfxR,n*=R/zzfxR,y*=zzfxR,x=zzfxR*x|0,w=i+g+l+s+u|0;b<w;k[b++]=V)++D%(100*m|0)||(V=r?1<r?2<r?3<r?Math.sin((L%R)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/R%2+2)%2:1-4*Math.abs(Math.round(L/R)-L/R):Math.sin(L),V=(x?1-z+z*Math.sin(2*Math.PI*b/x):1)*(0<V?1:-1)*Math.abs(V)**o*e*zzfxV*(b<i?b/i:b<i+g?1-(b-i)/g*(1-p):b<i+g+l?p:b<w-u?(w-b-u)/s*p:0),V=u?V/2+(u>b?0:(b<w-u?1:(w-b)/u)*k[b-u|0]/2):V),M=(a+=f+=h)*Math.sin(E*c-A),L+=M-M*d*(1-1e9*(Math.sin(b)+1)%2),E+=M-M*d*(1-1e9*(Math.sin(b)**2+1)%2),C&&++C>y&&(a+=n,S+=n,C=0),!x||++I%x||(a=S,f=v,C=C||1);return k},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(a,i,l,e=125)=>{let s,r,o,f,h,n,y,x,d,c,m,u,p,g,z=0,M=[],w=[],R=[],v=0,A=0,S=1,k={},L=zzfxR/e*60>>2;for(;S;v++)M=[S=x=u=0],l.map((e,t)=>{for(y=i[e][v]||[0,0,0],S|=!!i[e][v],g=u+(i[e][0].length-2-!x)*L,p=t==l.length-1,r=2,f=u;r<y.length+p;x=++r){for(h=y[r],d=r==y.length+p-1&&p||c!=(y[0]||0)|h|0,o=0;o<L&&x;o++>L-99&&d&&(m+=(m<1)/99))n=(1-m)*M[z++]/2||0,w[f]=(w[f]||0)-n*A+n,R[f]=(R[f++]||0)+n*A+n;h&&(m=h%1,A=y[1]||0,h|=0)&&(M=k[[c=y[z=0]||0,h]]=k[[c,h]]||((s=[...a[c]])[2]*=2**((h-12)/12),0<h?zzfxG(...s):[]))}u=g});return[w,R]}</script>