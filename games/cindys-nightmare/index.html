<!doctype html><meta content="width=device-width" name=viewport><title>Cindy's Nightmare</title><style>body{background:#000}canvas{background-image:url("brickthing.png");background-repeat:repeat;width:100%;max-width:80vw;display:block;margin:auto}</style><canvas height=480 id=canvas width=854></canvas><script>!function(){"use strict";if("function"!=typeof e||void 0===t)if("function"==typeof e&&"undefined"!=typeof webkitURL)var t=webkitURL;else var e=function(t){var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},o=function(t,e,n){this.data=t,this.size=t.length,this.type=e,this.encoding=n},i=n.prototype,a=o.prototype,r=t.FileReaderSync,c=function(t){this.code=this[this.name=t]},u="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),l=u.length,s=t.URL||t.webkitURL||t,d=s.createObjectURL,f=s.revokeObjectURL,R=s,p=t.btoa,h=t.atob,b=!1,g=t.ArrayBuffer,B=t.Uint8Array;for(o.fake=a.fake=!0;l--;)c.prototype[u[l]]=l+1;try{B&&function(t){b=!t}.apply(0,new B(3528e4))}catch(t){}return s.createObjectURL||(R=t.URL={}),R.createObjectURL=function(t){var e,n=t.type;return null===n&&(n="application/octet-stream"),t instanceof o?(e="data:"+n,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):d?d.call(s,t):void 0},R.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&f&&f.call(s,t)},i.append=function(t){var n=this.data;if(B&&(t instanceof g||t instanceof B))if(b)n.push(String.fromCharCode.apply(String,new B(t)));else{for(var i="",a=new B(t),u=0,l=a.length;u<l;u++)i+=String.fromCharCode(a[u]);n.push(i)}else if("Blob"===e(t)||"File"===e(t)){if(!r)throw new c("NOT_READABLE_ERR");var s=new r;n.push(s.readAsBinaryString(t))}else t instanceof o?"base64"===t.encoding&&h?n.push(h(t.data)):"URI"===t.encoding?n.push(decodeURIComponent(t.data)):"raw"===t.encoding&&n.push(t.data):("string"!=typeof t&&(t+=""),n.push(unescape(encodeURIComponent(t))))},i.getBlob=function(t){return arguments.length||(t=null),new o(this.data.join(""),t,"raw")},i.toString=function(){return"[object BlobBuilder]"},a.slice=function(t,e,n){var i=arguments.length;return i<3&&(n=null),new o(this.data.slice(t,i>1?e:this.data.length),n,this.encoding)},a.toString=function(){return"[object Blob]"},n}(t);return function(t,n){var o=n&&n.type||"",i=new e;if(t)for(var a=0,r=t.length;a<r;a++)i.append(t[a]);return i.getBlob(o)}}(self)}()</script><script>!function(){"use strict";function t(t,...n){C[t]&&C[t].map((t=>t(...n)))}function n(){return I}function e(){return D}function i(n){if(!(I=document.getElementById(n)||n||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return D=I.getContext("2d"),D.imageSmoothingEnabled=!1,t("init"),{canvas:I,context:D}}function a(t){return new j(t)}function r(t,n){return new URL(t,n).href}function o(t,n){return[t.replace(U,""),t?n.replace(G,""):n].filter((t=>t)).join("/")}function f(t){return t.split(".").pop()}function h(t){let n=t.replace("."+f(t),"");return 2==n.split("/").length?n.replace(G,""):n}function s(){window.__k||(window.__k={dm:Y,u:r,d:J,i:F})}function c(n){return s(),new Promise(((e,i)=>{let a,f,s;if(a=o(H,n),F[a])return e(F[a]);f=new Image,f.onload=function(){s=r(a,window.location.href),F[h(n)]=F[a]=F[s]=this,t("assetLoaded",this,n),e(this)},f.onerror=function(){i("Unable to load image "+a)},f.src=a}))}function l(n){return new Promise(((e,i)=>{let a,s,c,l;return a=new Audio,s=function(t){return{wav:"",mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}(a),n=[].concat(n).reduce(((t,n)=>t||(s[f(n)]?n:null)),0),n?(c=o(X,n),$[c]?e($[c]):(a.addEventListener("canplay",(function(){l=r(c,window.location.href),$[h(n)]=$[c]=$[l]=this,t("assetLoaded",this,n),e(this)})),a.onerror=function(){i("Unable to load audio "+c)},a.src=c,void a.load())):i("cannot play any of the audio formats provided"+n)}))}function u(n){let e,i;return s(),e=o(q,n),J[e]?Promise.resolve(J[e]):fetch(e).then((t=>{if(!t.ok)throw t;return t.clone().json().catch((()=>t.text()))})).then((a=>(i=r(e,window.location.href),"object"==typeof a&&Y.set(a,i),J[h(n)]=J[e]=J[i]=a,t("assetLoaded",a,n),a)))}function d(){let t=n();e().clearRect(0,0,t.width,t.height)}function p({fps:n=60,clearCanvas:e=!0,update:i,render:a}={}){function r(){if(f=requestAnimationFrame(r),h=performance.now(),s=h-o,o=h,!(s>1e3)){for(t("tick"),l+=s;l>=u;)c.update(p),l-=u;m(),c.render()}}if(!i||!a)throw Error("You must provide update() and render() functions");let o,f,h,s,c,l=0,u=1e3/n,p=1/n,m=e?d:N;return c={update:i,render:a,isStopped:!0,start(){o=performance.now(),this.isStopped=!1,requestAnimationFrame(r)},stop(){this.isStopped=!0,cancelAnimationFrame(f)},_frame:r,set _last(t){o=t}}}function m(t){let n=Z[t.which];K[n]=!0,V[n]&&V[n](t)}function x(t){K[Z[t.which]]=!1}function y(){K={}}function g(t,n){[].concat(t).map((t=>V[t]=n))}function w(t){return!!K[t]}function v(t){let n=t.x,e=t.y;t.anchor&&(n-=t.width*t.anchor.x,e-=t.height*t.anchor.y);let i=it.x-Math.max(n,Math.min(it.x,n+t.width)),a=it.y-Math.max(e,Math.min(it.y,e+t.height));return i*i+a*a<it.radius*it.radius}function _(t){let n=void 0!==t.button?et[t.button]:"left";nt[n]=!0,T(t,"onDown")}function M(t){let n=void 0!==t.button?et[t.button]:"left";nt[n]=!1,T(t,"onUp")}function S(t){T(t,"onOver")}function b(){nt={}}function T(t,e){let i=n();if(i){let n,a;-1!==["touchstart","touchmove","touchend"].indexOf(t.type)?(n=(t.touches[0]||t.changedTouches[0]).clientX,a=(t.touches[0]||t.changedTouches[0]).clientY):(n=t.clientX,a=t.clientY);let r=i.height/i.offsetHeight,o=i.getBoundingClientRect(),f=(n-o.left)*r,h=(a-o.top)*r;it.x=f,it.y=h,t.preventDefault();let s=function(){let t,n=Q.length?Q:z;for(let e=n.length-1;e>=0;e--)if(t=n[e],t.collidesWithPointer?t.collidesWithPointer(it):v(t))return t}();s&&s[e]&&s[e](t),tt[e]&&tt[e](t,s)}}function A(t,n,e={}){let i=new at(t,n);return e._c&&(i.clamp(e._a,e._b,e._d,e._e),i.x=t,i.y=n),i}function L(t){return new rt(t)}function k(t){if(+t===t)return t;let n=[],e=t.split(".."),i=+e[0],a=+e[1],r=i;if(i<a)for(;r<=a;r++)n.push(r);else for(;r>=a;r--)n.push(r);return n}function R(t){return new ot(t)}function P(){if(St){var t=xt.play();void 0!==t&&t.then((function(t){})).catch((function(t){St=!1}))}else xt.pause()}function E(){var t=[],n=[430,340,244,148,52],e=1,i=0,a=!1,r=0,o=0,h=!1;(function(t){H=t})("."),function(...t){return s(),Promise.all(t.map((t=>{let n=f([].concat(t)[0]);return n.match(O)?c(t):n.match(B)?l(t):u(t)})))}("platform.png","walkcycle.png","ghost.png").then((function(){function f(t){return t.collidesWith(d[0])||t.collidesWith(d[1])||t.collidesWith(d[2])||t.collidesWith(d[3])}function s(){var i=0;n.map((function(n){i++;for(var a=1;a<=Math.floor(Math.random()*e)+1;a++){var r=10;switch(i){case 1:r=Math.floor(500*Math.random());break;case 2:r=Math.floor(772*Math.random())+80;break;case 3:r=Math.floor(Math.random()*(u[1].x+u[1].width));break;case 4:r=Math.floor(706*Math.random())+144;break;case 5:r=Math.floor(Math.random()*(u[3].x+u[3].width))}var o=L({type:"ghost",x:r,y:n,height:32,width:21,score:10,dx:5*Math.random()+1,image:F.ghost});t.push(o)}}))}var c,l=L({image:F.platform,y:464,type:"platform"}),u=[L({image:F.platform,y:374,x:80,type:"platform"}),L({image:F.platform,y:278,x:-128,type:"platform"}),L({image:F.platform,y:182,x:144,type:"platform"}),L({image:F.platform,y:86,x:-80,type:"platform"})],d=[L({height:11,width:1,y:378,x:80,type:"platform"}),L({height:11,width:1,y:282,x:-128+u[1].width,type:"platform"}),L({height:11,width:1,y:184,x:144,type:"platform"}),L({height:11,width:1,y:89,x:-80+u[3].width,type:"platform"})],m=L({x:10,y:46,width:30,height:40,color:"blue",render:function(){this.draw(),ct.strokeStyle="black",ct.strokeRect(this.x,this.y,this.width,this.height)}}),x=L({x:814,y:424,width:30,height:40,color:"orange",render:function(){this.draw(),ct.strokeStyle="black",ct.strokeRect(this.x,this.y,this.width,this.height)}}),y=R({image:F.walkcycle,frameWidth:32,frameHeight:31,animations:{walkRight:{frames:"0..2",frameRate:14},walkLeft:{frames:"3..5",frameRate:14},shootL:{frames:"7..7",frameRate:1},shootR:{frames:"6..6",frameRate:1}}}),g=L({x:x.x,y:400,animations:y.animations,onGround:!1,type:"player"});(c=t).push.apply(c,[l].concat(u,[m,x,g]));var v=u[0].y+u[0].height,_=u[1].y+u[1].height,M=u[2].y+u[2].height,S=u[3].y+u[3].height;s();var b=p({update:function(){if(r+=1/60,o+=1/60,w("space")&&r>.75){r=0,Mt&&(gt.load(),gt.play()),a?g.playAnimation("shootL"):g.playAnimation("shootR");var n=L({type:"bullet",x:a?g.x:g.x+g.width,y:g.y+10,dx:a?-6:6,width:4,height:2,ttl:30,color:"white"});t.push(n),n.update()}w("d")||w("right")?(g.x<809&&(f(g)||(w("shift")?g.x+=4:g.x+=2.5),g.playAnimation("walkRight"),a=!1),g.onGround&&g.update()):(w("a")||w("left"))&&(g.x>0&&(f(g)||(w("shift")?g.x-=4:g.x-=2.5),g.playAnimation("walkLeft"),a=!0),g.onGround&&g.update()),(w("w")||w("up"))&&g.onGround&&o>.25&&(o=0,Mt&&(yt.load(),yt.play()),g.dy-=4.5,g.update()),g.y<=0&&(g.dy=.1,g.update()),function(t){var n=t.y+t.height;return!(n>=l.y||n>=u[0].y&&n<v&&t.x+t.width>=u[0].x+10||n>=u[1].y&&n<_&&t.x<=u[1].x+u[1].width-10||n>=u[2].y&&n<M&&t.x+t.width>=u[2].x+10||n>=u[3].y&&n<S&&t.x<=u[3].x+u[3].width-10)}(g)?(g.dy+=.1,g.onGround=!1,g.update()):(g.onGround=!0,g.dy=0),function(t){return t.y<=v&&t.y>v-5&&t.x+t.width>=u[0].x+10||t.y<=_&&t.y>_-5&&t.x<=u[1].x+u[1].width-10||t.y<=M&&t.y>M-5&&t.x+t.width>=u[2].x+10||t.y<=S&&t.y>S-5&&t.x<=u[3].x+u[3].width-10}(g)&&(g.onGround=!1,g.dy=.1,g.update()),g.collidesWith(m)&&(g.x=x.x,g.y=x.y,Mt&&(wt.load(),wt.play()),e++,s()),t.map((function(n){"ghost"==n.type&&(430==n.y?n.x<2?n.dx=Math.abs(n.dx):n.x>500&&(n.dx=-Math.abs(n.dx)):340==n.y?n.x<82?n.dx=Math.abs(n.dx):n.x>833&&(n.dx=-Math.abs(n.dx)):244==n.y?n.x<2?n.dx=Math.abs(n.dx):n.x>u[1].x+u[1].width-n.width&&(n.dx=-Math.abs(n.dx)):148==n.y?n.x<144?n.dx=Math.abs(n.dx):n.x>833&&(n.dx=-Math.abs(n.dx)):52==n.y&&(n.x<2?n.dx=Math.abs(n.dx):n.x>u[3].x+u[3].width-n.width&&(n.dx=-Math.abs(n.dx))),t.map((function(t){"bullet"==t.type&&n.collidesWith(t)&&(i+=n.score*e,n.ttl=0,t.ttl=0),"player"==t.type&&n.collidesWith(t)&&(g.ttl=0,h=!0)})))})),t.map((function(t){"bullet"!=t.type&&"ghost"!=t.type||t.update()})),t=t.filter((function(t){return t.isAlive()}))},render:function(){t.map((function(t){return t.render()})),ct.font="20px "+dt,ct.fillStyle="#fff",ct.textAlign="left",ct.fillText("Level: "+e,10,25),ct.textAlign="center",ct.fillText("HighScore: "+Tt,lt/2,25),ct.textAlign="right",ct.fillText("Score: "+i,lt-10,25),h&&(Pt.display(),Tt=i,W(),b.stop())}});b.start()}))}function W(){var t={hScore:Tt,musicOn:St,sfxOn:Mt};localStorage.setItem("BackToThePortal",JSON.stringify(t))}let I,D,C={};class j{constructor({spriteSheet:t,frames:n,frameRate:e,loop:i=!0}={}){this.spriteSheet=t,this.frames=n,this.frameRate=e,this.loop=i;let{width:a,height:r,margin:o=0}=t.frame;this.width=a,this.height=r,this.margin=o,this._f=0,this._a=0}clone(){return a(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:n,width:i=this.width,height:a=this.height,context:r=e()}={}){let o=this.frames[this._f]/this.spriteSheet._f|0,f=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,f*this.width+(2*f+1)*this.margin,o*this.height+(2*o+1)*this.margin,this.width,this.height,t,n,i,a)}}a.prototype=j.prototype,a.class=j;let O=/(jpeg|jpg|gif|png)$/,B=/(wav|mp3|ogg|aac)$/,G=/^\//,U=/\/$/,Y=new WeakMap,H="",X="",q="",F={},$={},J={};const N=()=>{};let V={},K={},Z={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},z=[],Q=[],tt={},nt={},et={0:"left",1:"middle",2:"right"},it={x:0,y:0,radius:5};class at{constructor(t=0,n=0){this._x=t,this._y=n}add(t,n=1){return A(this.x+(t.x||0)*n,this.y+(t.y||0)*n,this)}clamp(t,n,e,i){this._c=!0,this._a=t,this._b=n,this._d=e,this._e=i}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}A.prototype=at.prototype,A.class=at;class rt{constructor(t){this.init(t)}init(t={}){let{x:n,y:i,dx:a,dy:r,ddx:o,ddy:f,width:h,height:s,image:c}=t;this.position=A(n,i),this.velocity=A(a,r),this.acceleration=A(o,f),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=e();for(let n in t)this[n]=t[n];c&&(this.width=void 0!==h?h:c.width,this.height=void 0!==s?s:c.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let n,e;for(n in this._a={},t)this._a[n]=t[n].clone(),e=e||this._a[n];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}set width(t){let n=t<0?-1:1;this._fx=n,this._w=t*n}set height(t){let n=t<0?-1:1;this._fy=n,this._h=t*n}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let n=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,i=t.x,a=t.y;return t.anchor&&(i-=t.width*t.anchor.x,a-=t.height*t.anchor.y),n<i+t.width&&n+this.width>i&&e<a+t.height&&e+this.height>a}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,n=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let e=this.width/2+t,i=this.height/2+n;this.context.translate(e,i),this.context.scale(this._fx,this._fy),this.context.translate(-e,-i)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,n,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:n,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,n,this.width,this.height)),this.context.restore()}}L.prototype=rt.prototype,L.class=rt;class ot{constructor({image:t,frameWidth:n,frameHeight:e,frameMargin:i,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:n,height:e,margin:i},this._f=t.width/n|0,this.createAnimations(a)}createAnimations(t){let n,e;for(e in t){let{frames:i,frameRate:r,loop:o}=t[e];if(n=[],void 0===i)throw Error("Animation "+e+" must provide a frames property");[].concat(i).map((t=>{n=n.concat(k(t))})),this.animations[e]=a({spriteSheet:this,frames:n,frameRate:r,loop:o})}}}R.prototype=ot.prototype,R.class=ot;var ft=function(){var t,n,e,i,a,r=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*Math.pow(2,(t-128)/12)},f=function(t,n,e){var i,a,r,f,s,c,l,u=h[t.i[0]],d=t.i[1],p=t.i[3],m=h[t.i[4]],x=t.i[5],y=t.i[8],g=t.i[9],w=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,_=t.i[12]*t.i[12]*4,M=1/_,S=t.i[13],b=e*Math.pow(2,2-t.i[14]),T=new Int32Array(w+v+_),A=0,L=0;for(i=0,a=0;i<w+v+_;i++,a++)a>=0&&(a-=b,c=o(n+(15&(S=S>>8|(255&S)<<4))+t.i[2]-128),l=o(n+(15&S)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,i<w?r=i/w:i>=w+v&&(r-=(i-w-v)*M),f=c,p&&(f*=r*r),s=u(A+=f)*d,f=l,y&&(f*=r*r),s+=m(L+=f)*x,g&&(s+=(2*Math.random()-1)*g),T[i]=80*s*r|0;return T},h=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(r){t=r,n=r.endPattern,e=0,i=r.rowLen*r.patternLen*(n+1)*2,a=new Int32Array(i)},this.generate=function(){var o,s,c,l,u,d,p,m,x,y,g,w,v,_,M=new Int32Array(i),S=t.songData[e],b=t.rowLen,T=t.patternLen,A=0,L=0,k=!1,R=[];for(c=0;c<=n;++c)for(p=S.p[c],l=0;l<T;++l){var P=p?S.c[p-1].f[l]:0;P&&(S.i[P-1]=S.c[p-1].f[l+T]||0,P<16&&(R=[]));var E=h[S.i[15]],W=S.i[16]/512,I=Math.pow(2,S.i[17]-9)/b,D=S.i[18],C=S.i[19],j=43.23529*S.i[20]*3.141592/44100,O=1-S.i[21]/255,B=1e-5*S.i[22],G=S.i[23]/32,U=S.i[24]/512,Y=6.283184*Math.pow(2,S.i[25]-9)/b,H=S.i[26]/255,X=S.i[27]*b&-2;for(g=(c*T+l)*b,u=0;u<4;++u)if(d=p?S.c[p-1].n[l+u*T]:0){R[d]||(R[d]=f(S,d,b));var q=R[d];for(s=0,o=2*g;s<q.length;s++,o+=2)M[o]+=q[s]}for(s=0;s<b;s++)(y=M[m=2*(g+s)])||k?(w=j,D&&(w*=E(I*m)*W+.5),L+=(w=1.5*Math.sin(w))*(v=O*(y-L)-(A+=w*L)),y=3==C?L:1==C?v:A,B&&(y=(y*=B)<1?y>-1?r(.25*y):-1:1,y/=B),k=(y*=G)*y>1e-5,_=y*(1-(x=Math.sin(Y*m)*U+.5)),y*=x):_=0,m>=X&&(_+=M[m-X+1]*H,y+=M[m-X]*H),M[m]=0|_,M[m+1]=0|y,a[m]+=0|_,a[m+1]+=0|y}return++e/t.numChannels},this.createWave=function(){var t=44+2*i-8,n=t-36,e=new Uint8Array(44+2*i);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255]);for(var r=0,o=44;r<i;++r){var f=a[r];f=f<-32767?-32767:f>32767?32767:f,e[o++]=255&f,e[o++]=f>>8&255}return e}};i(),function(){let t;for(t=0;t<26;t++)Z[65+t]=(10+t).toString(36);for(t=0;t<10;t++)Z[48+t]=""+t;window.addEventListener("keydown",m),window.addEventListener("keyup",x),window.addEventListener("blur",y)}(),function(){let t=n();t.addEventListener("mousedown",_),t.addEventListener("touchstart",_),t.addEventListener("mouseup",M),t.addEventListener("touchend",M),t.addEventListener("blur",b),t.addEventListener("mousemove",S),t.addEventListener("touchmove",S),function(t,n){C[t]=C[t]||[],C[t].push(n)}("tick",(()=>{Q.length=0,z.map((t=>{Q.push(t)})),z.length=0}))}();var ht=i(),st=ht.canvas,ct=ht.ct;st=n(),ct=e();var lt=st.width,ut=st.height;Z[16]="shift";var dt="Arial, Verdana, san-serif",pt={music:"",jump:"",gs:"",portal:""},mt={music:!1,jump:!1,gs:!1,portal:!1};[{name:"music",songData:[{i:[0,255,107,1,0,255,92,0,1,32,4,6,35,0,0,0,0,0,0,2,36,0,9,21,0,5,0,0],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,147,,,147,147,,,147,147,147,,,,,147,,147,,,147,147,,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[,,,,,,,24,,,24,24,,,24,24,,,,,,24,,24,,,24,24,,,24,24,,,,,,,,47,,,49,51,,,49,49,,,,,,47,,49,,,47,41,,,37,36]}]},{i:[3,0,128,0,3,68,128,0,1,218,4,4,40,0,0,1,0,0,1,2,67,115,124,190,0,6,39,1],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,1,34,0,17,32,83,3,130,6],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,151,154,,,,,,,,,,,,,,146,149,153],f:[,,,,,21,21,21,21,23,,,28,,,,,,,,,,,,,,,,,,,,,,,,,67,46,44,34,17,,,6]}]},{i:[0,255,92,1,0,255,92,0,1,0,0,7,101,0,0,0,0,0,0,2,255,0,1,8,83,5,25,1],p:[12,12],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,147,,,151,154,,,,,146,,,,,146,,149,,,146,153],f:[13,,,,,,,13,,,13,13,24,24,24,24,24,,,,,13,,13,,,13,13,,,,,154,,,,,,,92,,,92,89,12,12,12,9,8,,,,,96,,99,,,101,101]}]},{i:[0,0,128,0,0,0,128,0,0,72,0,1,56,0,0,0,0,0,0,1,193,171,0,4,39,3,0,3],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,0,1,1,0,167,0,28,77,6,17,6],p:[23,24],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,151,,,154,,,149,,,156,,158,,146,,,153,,,149,,,,148,,142,,144],f:[21,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,17]},{n:[147,,,151,,,154,,,,149,,156,157,158,,146,149,151,152,153,,,,151,153,154,156,158],f:[]}]},{i:[0,31,131,1,0,83,128,0,1,210,4,7,41,0,0,0,0,0,1,2,255,0,12,17,61,5,0,0],p:[,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146,139,135],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,,147,,,147,,,147,,147,154,144,139,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:7},{name:"portal",songData:[{i:[0,146,128,0,0,224,128,3,0,0,37,0,81,0,0,3,0,0,1,2,124,135,0,32,0,3,0,6],p:[27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]},{i:[0,232,142,1,0,0,164,0,1,0,29,0,57,0,0,0,0,0,0,3,85,0,1,39,76,5,0,0],p:[15],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2},{name:"jump",songData:[{i:[3,255,128,0,0,255,147,0,0,127,2,2,23,0,0,0,0,0,1,3,94,79,0,32,0,2,0,4],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},{name:"gs",songData:[{i:[3,148,157,1,1,125,128,0,1,85,4,7,43,0,0,0,0,0,1,2,177,0,2,32,0,5,0,6],p:[1],c:[{n:[147],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,85]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}].map((function(t){return function(t){var n=!1,e=new ft;e.init(t),setInterval((function(){if(!n&&(n=e.generate()>=1)){var i=e.createWave();pt[t.name]=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),mt[t.name]=!0}}),0)}(t)}));var xt=document.createElement("audio"),yt=document.createElement("audio"),gt=document.createElement("audio"),wt=document.createElement("audio"),vt=setInterval((function(){""!=pt.music&&""!=pt.jump&&""!=pt.gs&&""!=pt.portal&&(xt.src=pt.music,yt.src=pt.jump,gt.src=pt.gs,wt.src=pt.portal,clearInterval(vt))}),0);xt.volume=.1,xt.loop=!0;var _t=!1,Mt=!0,St=!0,bt=!1,Tt=0;if(localStorage.getItem("BackToThePortal")){var At=JSON.parse(localStorage.getItem("BackToThePortal")),Lt=At.hScore,kt=At.musicOn,Rt=At.sfxOn;Tt=Lt,St=kt,Mt=Rt}else W();P();var Pt=L({display:function(){ct.font="40px "+dt,ct.fillStyle="#fff",ct.textAlign="center",ct.fillText("GAME OVER",lt/2,ut/2),ct.font="20px "+dt,ct.fillText("Press [R] to replay.",lt/2,ut/2+30),ct.fillText("Press [B] to go back to main menu.",lt/2,ut/2+60),bt=!0}}),Et=!0,Wt=L({mainMenu:function(){ct.font="50px "+dt,ct.strokeStyle="#fff",ct.textAlign="center",ct.strokeText("Press [Enter] to play.",lt/2,ut/2),ct.font="30px "+dt,ct.fillStyle="#fff",ct.fillText("Controls",lt/2,ut-100),ct.fillText("HighScore: "+Tt,lt/2,ut/2+50),ct.font="20px "+dt,ct.fillText("Press [Space] to fire.",lt/2,ut-70),ct.fillText("Press [W] or [↑] to jump.",lt/2,ut-40),ct.fillText("Press [A] [D] or [←] [→] to move Left and Right. Use [Shift] to sprint.",lt/2,ut-10),ct.font="italic 35px Comic Sans Ms",ct.fillText("i",22,ut-10),ct.beginPath(),ct.arc(25,ut-22,20,0,2*Math.PI),ct.font="20px Comic Sans Ms",ct.fillText("[M] Music",lt-60,ut-30),ct.fillText("[S] sfx",lt-60,ut-10),ct.fillText("[C]",60,ut-15),Mt||(ct.moveTo(797,465),ct.lineTo(829,465),ct.strokeStyle="#fff"),St||(ct.moveTo(785,445),ct.lineTo(839,445),ct.strokeStyle="#fff"),ct.stroke()}}),It=L({credits:function(){ct.font="50px "+dt,ct.fillStyle="#fff",ct.textAlign="center",ct.fillText("Credits",lt/2,100),ct.font="35px "+dt,ct.fillText("Sfx & Music",lt/2,175),ct.fillText("Sprites & Tiles",lt/2,250),ct.font="25px "+dt,ct.fillText("Ash Blue",lt/2,205),ct.fillText("Kimmo Rundelin",lt/2,280),ct.fillText("thekingphoenix",lt/2,310),ct.fillText("Lanea Zimmerman",lt/2,340),ct.textAlign="left",ct.fillText("Press [B] to go back.",10,ut-10)}});Wt.mainMenu(),g("enter",(function(t){t.preventDefault(),!_t&&Et&&(ct.clearRect(0,0,lt,ut),_t=!0,E())})),g("c",(function(t){t.preventDefault(),!_t&&Et&&(ct.clearRect(0,0,lt,ut),Et=!1,It.credits())})),g("m",(function(t){t.preventDefault(),!_t&&Et&&(St=!St,ct.clearRect(0,0,lt,ut),Wt.mainMenu(),P(),W())})),g("s",(function(t){t.preventDefault(),!_t&&Et&&(Mt=!Mt,ct.clearRect(0,0,lt,ut),Wt.mainMenu(),W())})),g("b",(function(t){t.preventDefault(),_t||Et||(ct.clearRect(0,0,lt,ut),Et=!0,Wt.mainMenu()),bt&&(Et=!0,_t=!1,ct.clearRect(0,0,lt,ut),Wt.mainMenu(),bt=!1)})),g("r",(function(t){t.preventDefault(),bt&&(ct.clearRect(0,0,lt,ut),_t=!0,E())}))}()</script>