(()=>{"use strict";const e="#dc3220",t="#1aff1a",s="#0a650a",i="#1a85ff",n="#fefe62",o="#ffc20a",a="#ffffff",r="#000000",l=window.location.search.includes("debug"),h=e=>{for(let t=e.length-1;t>1;t--){const s=Math.floor(Math.random()*t),i=e[t];e[t]=e[s],e[s]=i}return e},c=(e=512)=>{const t=document.createElement("canvas");t.width=e,t.height=e;const s=t.getContext("2d");return[t,s]},{StandardMaterial:d,Texture:u}=BABYLON;let p=0;const m={},g=(e,t,s)=>{const i=`color_${t.glow?"glow_":""}${e}`;if(m[i])return m[i];const n=new d(`${i}${++p}`,s);return n.diffuseColor=BABYLON.Color3.FromHexString(e),t.glow&&(n.emissiveColor=BABYLON.Color3.FromHexString(e)),m[i]=n,n},B=(e,t)=>{const s=new d("material"+ ++p,t),i=u.LoadFromDataString("texture"+ ++p,e.toDataURL(),t);return i.hasAlpha=!0,s.diffuseTexture=i,s},b=(e,t,s)=>{const i=`text-${t}-${e.join("")}`;if(m[i])return m[i];const[n,o]=c(512);o.fillStyle=t,o.fillRect(0,0,n.width,n.height),o.fillStyle=r,o.font="64px Helvetica",o.scale(1,e.length),o.textBaseline="top",o.textAlign="left";let a=64;if(e.length>0){const t=o.measureText(e[0]);a=Math.min(28672/t.width,512),o.font=`${a}px Helvetica`}e.forEach(((e,t)=>{o.fillText(`${e}`,32,32+a*t)}));const l=B(n,s);return l.transparencyMode=BABYLON.Material.MATERIAL_OPAQUE,m[i]=l,l};class f{constructor(){this.animations=[],this.scene=null}static get Instance(){return f._instance||(f._instance=new f),f._instance}initScene(e){this.scene||(this.scene=e,this.scene.registerBeforeRender((()=>{const e=Date.now();this.animations=this.animations.filter((t=>{const s=(i=(e-t.startTime)/(t.endTime-t.startTime),0,1,Math.min(Math.max(i,0),1));var i;return e>=t.endTime?(t.end.position&&(t.mesh.position=t.end.position),t.end.rotation&&(t.mesh.rotation=t.end.rotation),t.end.scaling&&(t.mesh.scaling=t.end.scaling),!1):(t.end.position&&(t.mesh.position=BABYLON.Vector3.Lerp(t.start.position,t.end.position,t.easeFunc.ease(s))),t.end.rotation&&(t.mesh.rotation=BABYLON.Vector3.Lerp(t.start.rotation,t.end.rotation,t.easeFunc.ease(s))),t.end.scaling&&(t.mesh.scaling=BABYLON.Vector3.Lerp(t.start.scaling,t.end.scaling,t.easeFunc.ease(s))),!0)}))})))}animateTransform(e){const{mesh:t,end:s}=e,i=e.duration||1e3,n=e.delay||0,o=e.ease||new BABYLON.QuadraticEase,a=Date.now();this.animations.push({mesh:t,start:{position:t.position,rotation:t.rotation,scaling:t.scaling},end:s,easeFunc:o,startTime:a+n,endTime:a+n+i})}}function w(...e){return P.play(...e)}const P={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),s=this.x.createBufferSource();return e.map(((e,s)=>t.getChannelData(s).set(e))),s.buffer=t,s.connect(this.x.destination),s.start(),s},buildSamples:function(e=1,t=.05,s=220,i=0,n=0,o=.1,a=0,r=1,l=0,h=0,c=0,d=0,u=0,p=0,m=0,g=0,B=0,b=1,f=0,w=0){const P=2*Math.PI;let k,O,M=this.sampleRate,v=l*=500*P/M/M,L=s*=(1+2*t*Math.random()-t)*P/M,y=[],N=0,E=0,C=0,A=1,S=0,x=0,I=0;for(h*=500*P/M**3,m*=P/M,c*=P/M,d*=M,u=u*M|0,O=(i=i*M+9)+(f*=M)+(n*=M)+(o*=M)+(B*=M)|0;C<O;y[C++]=I)++x%(100*g|0)||(I=a?a>1?a>2?a>3?Math.sin((N%P)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/P%2+2)%2:1-4*Math.abs(Math.round(N/P)-N/P):Math.sin(N),I=(u?1-w+w*Math.sin(P*C/u):1)*(I>0?1:-1)*Math.abs(I)**r*e*this.volume*(C<i?C/i:C<i+f?1-(C-i)/f*(1-b):C<i+f+n?b:C<O-B?(O-C-B)/o*b:0),I=B?I/2+(B>C?0:(C<O-B?1:(O-C)/B)*y[C-B|0]/2):I),k=(s+=l+=h)*Math.cos(m*E++),N+=k-k*p*(1-1e9*(Math.sin(C)+1)%2),A&&++A>d&&(s+=c,L+=c,A=0),!u||++S%u||(s=L,l=v,A=A||1);return y},getNote:function(e=0,t=440){return t*2**(e/12)}},k=()=>w(...[2,0,65.40639,.14,.15,.08,2,2.5,,,,,,,,.1,.02,.84,.11]),O=()=>w(...[4.4,,38,.01,.01,.03,1,3.8,11,,,,,,,,.2,.67,.02,.04,419]),M=()=>w(...[,0,391.9954,.01,.09,.14,,3.9,,,,,,,,,,.8,.08]),v=()=>w(...[2.3,,85,.01,.26,.47,,.1,,-5,,,.27,1.9,,.5,.1,.49,.15,.39]),{TransformNode:L,MeshBuilder:y,Vector3:N}=BABYLON;let E,C=0;class A{constructor(e,t){this.scene=t,this.count=1e3*(e.count||30),this.endDt=-1,this.parent=new L("Clock",this.scene),this.value=0,this.state="intro",this.target=e.target||13,this.materials={red:g("#ff0000",{glow:!0},t),green:g("#BAD455",{glow:!0},t),blue:g("#0000ff",{glow:!0},t)},this.reset()}set position(e){this.parent.position=e}set rotation(e){this.parent.rotation=e}get model(){return this.parent}reset(){this.tickSFX=new BABYLON.Sound("Tick",w(...[,0,901,.02,,.02,1,1.2,,20,-400,.09,,1,319,.1,,.58,.03]).buffer,this.scene,null,{loop:!1,autoplay:!1,spatialSound:!0,maxDistance:25}),this.tickSFX.switchPanningModelToHRTF();const e=y.CreateBox("body"+ ++C,{width:.8,height:.6,depth:.25});e.material=this.materials.blue,e.setParent(this.parent),e.position=new N(0,0,0),this.tickSFX.attachToMesh(e),this.body=e;const t=y.CreatePlane("billboard",{width:.7,height:.5,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);return t.setParent(this.parent),t.isPickable=!1,t.position=new N(0,0,-.126),this.face=t,E=()=>{if("running"===this.state){const e=Math.max(0,Math.ceil((this.endDt-Date.now())/1e3));e!==this.value&&(e<this.target+5&&this.tickSFX?.play(),e<this.target&&this.fail()),this.value=e,this.face&&(this.face.material=b([`${this.value}`],o,this.scene))}},this.scene.registerBeforeRender(E),parent}start(){this.state="running",this.endDt=Date.now()+this.count,this.body&&(this.body.material=this.materials.blue)}stop(){this.value===this.target?this.pass():this.fail()}pass(){this.state="passed",M(),this.body&&(this.body.material=this.materials.green)}fail(){this.state="failed",this.body&&(this.body.material=this.materials.red)}dispose(){this.scene.unregisterBeforeRender(E),this.face?.dispose(),this.body?.dispose()}}const{TransformNode:S,Vector3:x,MeshBuilder:I}=BABYLON;class Y{constructor(e){this.solved=!1,this.failed=!1,this.failedClocks=0,this.scene=e,this.parent=new S("TimerChallenge",this.scene),this.state="intro",this.clocks=[],this.failedClocks=0}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){if(l)return!0;if("running"!==this.state)return!1;if(this.solved)return!0;let e=0,t=0;if(this.clocks?.forEach((s=>{"failed"===s.state&&e++,"running"===s.state&&t++})),this.solved=0==t&&e<3,e!==this.failedClocks){if(!this.scoreboardMesh){const e=I.CreatePlane("scoreboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);e.setParent(this.parent),e.position=new x(0,.25,2),this.scoreboardMesh=e}this.scoreboardMesh.material=b(["Lives: "+(3-e)],i,this.scene),e>this.failedClocks&&k(),this.failedClocks=e}return this.solved&&this.clocks?.forEach((e=>e.stop())),this.solved}isFailed(){if("running"!==this.state)return!1;if(this.failed)return!0;let e=0;return this.clocks?.forEach((t=>{"failed"===t.state&&e++})),this.failed=e>=3,this.failed&&this.clocks?.forEach((e=>e.stop())),this.failed}reset(){this.clocks.forEach((e=>e.dispose())),this.clocks=[],this.state="intro",this.solved=!1,this.failed=!1;const e=l?4:13,t=BABYLON.Color3.Random(),s=new BABYLON.PBRMaterial("");s.albedoColor=t,s.metallic=0,s.roughness=1;const i=I.CreateBox("timer_challenge_walls",{height:6,width:12,depth:12,sideOrientation:1},this.scene);i.checkCollisions=!0,i.isPickable=!1,i.setParent(this.parent),i.position.y=3.01,i.material=s,i.receiveShadows=!0;const n=h([...Array(288).keys()]);for(let t=0;t<e;t++){const e=25,s=5,i=.5*Math.random(),o=new A({count:e+s*t+i},this.scene);o.model.setParent(this.parent);const a=Math.floor(n[t]/72),r=n[t]%72,l=r%12-6+.5,h=Math.floor(r/12)+.5;o.position=new x(l,h,6),o.model.rotateAround(this.parent.position,x.UpReadOnly,.5*Math.PI*a),o.model.onPointerPick=()=>{"running"===this.state&&o.stop()},this.clocks?.push(o)}if(!this.infoBillboard){const e=I.CreatePlane("billboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);e.material=b(["Stop the clocks at 13 seconds.","Stop too soon or ","miss too many and you will fail"],o,this.scene),e.setParent(this.parent),e.isPickable=!0,e.position=new x(0,1.5,-.126),e.onPointerPick=()=>{this.start()},this.infoBillboard=e}this.infoBillboard.setEnabled(!0)}start(){this.state="running",this.infoBillboard?.setEnabled(!1),this.scoreboardMesh?.setEnabled(!0),this.clocks?.forEach((e=>e.start()))}stop(){this.clocks.forEach((e=>{e.stop()})),this.scoreboardMesh?.setEnabled(!1),this.parent.setEnabled(!1)}}const{TransformNode:T,Vector3:_,Color3:z,MeshBuilder:$}=BABYLON,D=["Hit the correct buttons","to reveal the answer.","Beware RESET buttons."],F=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,1,1,1,0,0,0],[0,0,1,0,1,0,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,0,1,1,0,0,0],[0,0,0,0,1,0,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,1,0,0,1,0,0],[0,0,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]];class R{constructor(){this.connectedLights=[],this.on=!1}addLight(e){this.connectedLights.push(e)}}class V{constructor(){this.solution=[...F],this.board=[],this.solved=!1,this.buttons=[];const e=[];for(let t=0;t<this.solution.length;t++)for(let s=0;s<this.solution[t].length;s++)0==this.solution[t][s]&&e.push({x:s,y:t});h(e);for(let e=0;e<13;e++)this.buttons.push(new R);e.forEach(((e,t)=>this.buttons[t%this.buttons.length].addLight(e)));for(let e=0;e<5;e++)this.buttons.push(new R);this.buttons=h(this.buttons),this.reset()}pressButton(e){const t=this.buttons[e];return!t.on&&(t.connectedLights.length?(t.connectedLights.forEach((e=>{this.board[e.y][e.x]=0})),t.on=!0,!1):(this.reset(),!0))}isSolved(){if(this.solved)return!0;let e=!0;for(let t=0;t<this.solution.length;t++)for(let s=0;s<this.solution[t].length;s++)e=e&&this.solution[t][s]==this.board[t][s];return e&&(this.solved=!0),e}reset(){this.solved=!1,this.buttons.forEach((e=>e.on=!1)),this.board=this.solution.map((e=>e.map((()=>1))))}}class U{constructor(e){this.solved=!1,this.failed=!1,this.scene=e,this.puzzle=new V,this.parent=new T("ButtonChallenge",this.scene),this.lightsParent=new T("Lights",this.scene),this.lightsParent.setParent(this.parent),this.lightsParent.position=new _(-1.5,3,0),this.buttonsParent=new T("Buttons",this.scene),this.buttonsParent.setParent(this.parent),this.buttonsParent.rotateAround(_.Zero(),_.Right(),-.15*Math.PI),this.buttonsParent.position=new _(-.5,.35,-2),this.state="intro",l&&console.log("ButtonChallenge created")}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return!!l||"running"===this.state&&(!!this.solved||(this.puzzle.isSolved()&&(this.solved=!0),this.solved))}isFailed(){return"running"===this.state&&(!!this.failed||this.failed)}reset(){this.parent.setEnabled(!0),this.state="intro",this.solved=!1,this.failed=!1;const e=z.Random(),t=new BABYLON.PBRMaterial("");t.albedoColor=e,t.metallic=0,t.roughness=1;const s=$.CreateBox("button_challenge_walls",{height:6,width:12,depth:12,sideOrientation:1},this.scene);s.checkCollisions=!0,s.isPickable=!1,s.setParent(this.parent),s.position.y=3.01,s.material=t,s.receiveShadows=!0;const i=$.CreatePlane("billboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);i.material=b(D,o,this.scene),i.setParent(this.parent),i.isPickable=!0,i.position=new _(0,1.5,-.126),i.onPointerPick=()=>{this.start()},this.infoBillboard=i,this.updateMeshes()}updateMeshes(){const{board:e,buttons:t}=this.puzzle;e.forEach(((e,t)=>{e.forEach(((e,s)=>{const i=`light_${s}-${t}`;let n=this.scene.getMeshByName(i);if(!n){const e=new BABYLON.PBRMaterial(`light_${s}_${t}`,this.scene);e.metallic=0,e.roughness=1,n=$.CreateSphere(i,{diameter:.3},this.scene),n.metadata={color:"#ffffff"},n.material=e,n.setParent(this.lightsParent),n.position=new _(.3*s,-.3*t,1)}if(n.material){const t=n.material;t.name="light"+(e?"_glow":""),t.albedoColor=e?n.metadata.color:z.Black(),t.emissiveColor=e?n.metadata.color:z.Black()}}))})),t.forEach(((e,t)=>{const o=`button_${t}`;let l=this.scene.getMeshByName(o);if(!l){const e=.075*Math.floor(3*Math.random())+.2,a=z.FromHexString((h=[s,i,n,"#666666","#994f00",r])[Math.floor(Math.random()*h.length)]),c=new BABYLON.PBRMaterial(`button_${t}`);c.metallic=0,c.roughness=1,l=$.CreateCylinder(o,{diameter:e,height:.1,tessellation:Math.floor(3*Math.random())+3},this.scene),l.metadata={color:a},l.material=c,l.setParent(this.buttonsParent),l.position=new _(.35*Math.floor(t/4),.5,t%4*.25),l.onPointerPick=()=>{l.scaling=new _(1,.5,1),f.Instance.animateTransform({mesh:l,end:{scaling:new _(1,1,1)},duration:60}),this.start(),this.puzzle.pressButton(t)?k():w(...[2,.1,130.8128,.05,.05,.08,,2.5,,,,,,,,.1,.02,.84,.11]),this.updateMeshes()}}var h;if(l.material){console.log("updating mat",t,e);const s=l.material;s.albedoColor=e.on?z.FromHexString(a):l.metadata.color,s.emissiveColor=z.Black()}}))}start(){"intro"===this.state&&(this.state="running",this.infoBillboard?.setEnabled(!1))}stop(){this.parent.setEnabled(!1)}}const{TransformNode:H,Color3:W,Vector2:G,Vector3:X,MeshBuilder:j}=BABYLON,Z=["Lead the snake to apples","Grow to size 13.","Don't get stuck."];class q{constructor(e){this.body=[e,e],this.direction="up",this.alive=!0,this.color=s}}const J=new G(0,1),Q=new G(0,-1),K=new G(-1,0),ee=new G(1,0),te=(e,t)=>"up"===t?e.clone().addInPlace(J):"down"===t?e.clone().addInPlace(Q):"left"===t?e.clone().addInPlace(K):"right"===t?e.clone().addInPlace(ee):e;class se{constructor(){this.width=10,this.height=10,this.food=[],this.snakes=[new q(new G(Math.floor(this.width/2),Math.floor(this.height/2)))],this.target=null,this.running=!0,this.solved=!1,this.failed=!1}get score(){return this.snakes[0].body.length}setSnakeDirection(e,t){this.snakes[e].direction=t}spaceHasFood(e){return this.food.some((t=>t.equals(e)))}spaceHasSnakes(e){return this.snakes.some((t=>t.alive&&t.body.some(((s,i)=>i!==t.body.length-1&&s.equals(e)))))}spaceIsEmpty(e){return!this.spaceHasFood(e)&&!this.spaceHasSnakes(e)}spaceIsOnBoard(e){return e.x>=0&&e.x<this.width&&e.y>=0&&e.y<this.height}isSolved(){return this.solved||this.snakes.some((e=>e.body.length>=(l?3:13)))&&(this.solved=!0),this.solved}tick(){if(w(...[,,76,.02,.02,.01,1,.44,,,,,,.5,,,,,.01,.57]),this.snakes.forEach((e=>{if(!e.alive)return;if(this.target){const t=e.body[0],s=this.target.x-t.x,i=this.target.y-t.y;let n=e.direction;n=Math.abs(i)>Math.abs(s)?i<0?"down":"up":s<0?"left":"right",this.spaceHasSnakes(te(t,n))||(e.direction=n)}const t=te(e.body[0],e.direction);this.spaceIsOnBoard(t)&&!this.spaceHasSnakes(t)||(k(),e.alive=!1,this.failed=!0),e.body.pop(),this.spaceHasFood(t)&&(M(),e.body.push(e.body[e.body.length-1]),this.food=this.food.filter((e=>!e.equals(t)))),e.body.unshift(t)})),0==this.food.length){const e=new G(Math.floor(Math.random()*this.width),Math.floor(Math.random()*this.height));for(;!this.spaceIsEmpty(e);)e.x=Math.floor(Math.random()*this.width),e.y=Math.floor(Math.random()*this.height);this.food.push(e)}this.snakes.every((e=>!e.alive))&&(this.running=!1)}}class ie{constructor(e){this.solved=!1,this.failed=!1,this.clock=()=>{"running"===this.state&&(this.elapsedMs+=this.scene.getEngine().getDeltaTime(),this.elapsedMs>=400&&(this.puzzle&&this.puzzle.tick(),this.updateMeshes(),this.elapsedMs=0,this.currentFrame+=1))},this.scene=e,this.puzzle=new se,this.parent=new H("SnakeChallenge",this.scene),this.boardParent=new H("BoardParent",this.scene),this.boardParent.setParent(this.parent),this.state="intro",this.elapsedMs=0,this.currentFrame=0,l&&console.log("SnakeChallenge created")}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return!!l||"running"===this.state&&(!!this.solved||(this.puzzle.isSolved()&&(this.scene.unregisterBeforeRender(this.clock),this.solved=!0),this.solved))}isFailed(){return"running"===this.state&&(!!this.failed||(this.puzzle.failed&&(this.scene.unregisterBeforeRender(this.clock),console.log("FAILED"),this.failed=!0),this.failed))}reset(){this.parent.getChildMeshes().forEach((e=>e.dispose())),this.boardParent&&this.boardParent.dispose(),this.boardParent=new H("BoardParent",this.scene),this.boardParent.setParent(this.parent),this.boardParent.position=new X(-2.25,1,3),this.boardParent.scaling=new X(.5,.5,.5),this.puzzle=new se,this.scene.unregisterBeforeRender(this.clock),this.scene.registerBeforeRender(this.clock),this.state="intro",this.solved=!1,this.failed=!1;const t=BABYLON.Color3.Random(),s=new BABYLON.PBRMaterial("");s.albedoColor=t,s.metallic=0,s.roughness=1;const i=j.CreateBox("snake_challenge_walls",{height:6,width:12,depth:12,sideOrientation:1},this.scene);i.checkCollisions=!0,i.isPickable=!1,i.setParent(this.parent),i.position.y=3.01,i.material=s,i.receiveShadows=!0;const n=j.CreatePlane("control",{width:12,height:6},this.scene);n.setParent(this.parent),n.position=new X(0,3,this.boardParent.position.z),n.isPickable=!0,n.visibility=0;const a=j.CreateSphere("laser_buddy",{diameter:.1},this.scene);a.setParent(this.parent),a.isPickable=!1,a.material=g(e,{glow:!0},this.scene),n.onPointerMove=e=>{if(!e?.pickedPoint)return;a.position=e?.pickedPoint;const t=new G(a.position.x-this.boardParent.position.x,a.position.y-this.boardParent.position.y).scaleInPlace(1/this.boardParent.scaling.x);this.puzzle.target=t};const l=j.CreatePlane("billboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);l.material=b(Z,o,this.scene),l.setParent(this.parent),l.isPickable=!0,l.position=new X(0,1.5,-.126),l.onPointerPick=()=>{this.start()},this.infoBillboard=l;for(let e=0;e<this.puzzle.height;e++)for(let t=0;t<this.puzzle.width;t++){const s=j.CreateCylinder(`board_dot_${t}-${e}`,{height:.2,diameter:.2},this.scene);s.material=g(r,{},this.scene),s.isPickable=!1,s.setParent(this.boardParent),s.scaling=X.One(),s.position=new X(t,e,0),s.rotation=new X(Math.PI/2,0,0)}this.updateMeshes()}updateMeshes(){const{snakes:t,food:s}=this.puzzle;if(t.forEach(((e,t)=>{e.body.forEach(((s,i)=>{const n=`snake_${t}_${i}`;let o=this.scene.getMeshByName(n);o||(o=j.CreateBox(n,{size:i?.8:.95},this.scene),o.isPickable=!1,o.setParent(this.boardParent),o.position=new X(s.x,s.y,0),o.scaling=X.One()),f.Instance.animateTransform({mesh:o,end:{position:new X(s.x,s.y,0)},duration:70}),o.position=new X(s.x,s.y,0),o.metadata={frame:this.currentFrame},o.material=g(e.color,{glow:!1},this.scene)}))})),s.forEach((t=>{let s=this.scene.getMeshByName(`food_${t.x}-${t.y}`);if(!s){s=j.CreateSphere(`laser_food_${t.x}-${t.y}`,{diameter:1},this.scene);const i=g(e,{glow:!0},this.scene);i.emissiveColor=W.FromHexString(e),s.material=i,s.isPickable=!1,s.setParent(this.boardParent),s.scaling=X.One(),s.position=new X(t.x,t.y,0)}s.metadata={frame:this.currentFrame}})),this.boardParent.getChildMeshes(!0).forEach((e=>{e.metadata&&e.metadata.frame!==this.currentFrame&&e.dispose()})),!this.scoreboard){const e=j.CreatePlane("scoreboard",{width:1,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);e.setParent(this.parent),e.isPickable=!1,e.position=new X(0,.5,this.boardParent.position.z-.5),this.scoreboard=e}this.scoreboard.material=b([`${this.puzzle.score}`],o,this.scene)}start(){"intro"===this.state&&(this.state="running",this.infoBillboard?.setEnabled(!1))}stop(){this.parent.setEnabled(!1)}}const{TransformNode:ne,Vector3:oe,MeshBuilder:ae}=BABYLON,re=["Place tiles to add up to 13","in each row, column and","diagonal"],le=[[13,83,33],[63,43,23],[53,3,73]],he=[[0,0,0],[0,0,0],[0,0,0]],ce=["0,0","0,1","1,2"];class de{constructor(){this.solution=[...le],this.board=[...he],this.selected=0,this.rack=[],this.reset()}pickRack(e){const t=this.rack[e];this.selected&&this.rack.push(this.selected),this.selected=t,this.rack=this.rack.filter((e=>e!==t))}pickBoard(e,t){if(ce.includes(`${e},${t}`))return;const s=this.selected;this.selected=this.board[t][e],this.board[t][e]=s,l&&console.log(this.toString())}rowSum(e){let t=0;return this.board[e].forEach((e=>t+=e)),129===t&&(t=130),t}colSum(e){let t=0;return this.board.forEach((s=>t+=s[e])),129===t&&(t=130),t}isSolved(){return this.solution.every(((e,t)=>e.every(((e,s)=>this.board[t][s]===e))))}reset(){this.solution=[...le],this.selected=0,this.board=[...he],this.rack=[],this.solution.forEach(((e,t)=>{e.forEach(((e,s)=>{ce.includes(`${s},${t}`)?this.board[t][s]=e:this.rack.push(e)}))})),this.rack=h([...this.rack])}toString(){let e="";return this.board.forEach((t=>{e+=`${t.join(" ")}\n`})),e+=`*${this.rack.join("*")}*`,e}}class ue{constructor(e){this.solved=!1,this.failed=!1,this.scene=e,this.puzzle=new de,this.parent=new ne("MagicBoxChallenge",this.scene),this.boardParent=new ne("Board",this.scene),this.boardParent.setParent(this.parent),this.boardParent.position=new oe(-1,5,3),this.boardParent.scaling=new oe(1,1,1),this.rackParent=new ne("Board",this.scene),this.rackParent.setParent(this.parent),this.rackParent.position=new oe(-2.5,1,2),this.rackParent.scaling=new oe(1,1,1),this.state="intro"}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return!!l||"running"===this.state&&(!!this.solved||(this.puzzle.isSolved()&&(this.solved=!0),this.solved))}isFailed(){return!1}reset(){this.puzzle=new de,this.state="intro",this.solved=!1,this.failed=!1;const e=BABYLON.Color3.Random(),t=new BABYLON.PBRMaterial("");t.albedoColor=e,t.metallic=0,t.roughness=1;const s=ae.CreateBox("magicbox_challenge_walls",{height:6,width:12,depth:12,sideOrientation:1},this.scene);s.checkCollisions=!0,s.isPickable=!1,s.setParent(this.parent),s.position.y=3.01,s.material=t,s.receiveShadows=!0;const i=ae.CreatePlane("billboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);i.material=b(re,o,this.scene),i.setParent(this.parent),i.isPickable=!0,i.position=new oe(0,1.5,-.126),i.onPointerPick=()=>{this.start()},this.infoBillboard=i,this.updateMeshes()}updateMeshes(){const{board:e,rack:s,selected:i}=this.puzzle,r=this.scene.getMeshByName("inventory-parent");if(e.forEach(((s,i)=>{const r=`magic_box_row_sum_${i}`;let l=this.scene.getMeshByName(r);l||(l=ae.CreatePlane(r,{width:.6,height:.6,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),l.setParent(this.boardParent),l.scaling=oe.One(),l.isPickable=!1,l.position=new oe(s.length,-1*i,0));const h=this.puzzle.rowSum(i)/10;l.material=b([`${h}`],13===h?t:n,this.scene),s.forEach(((s,r)=>{if(0===i){const s=`magic_box_col_sum_${r}`;let i=this.scene.getMeshByName(s);i||(i=ae.CreatePlane(s,{width:.6,height:.6,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),i.setParent(this.boardParent),i.scaling=oe.One(),i.isPickable=!1,i.position=new oe(r,-1*e.length,0));const o=this.puzzle.colSum(r)/10;i.material=b([`${o>0?o:""}`],13===o?t:n,this.scene)}const l=ce.includes(`${r},${i}`),h=`magic_box_slot_${r}-${i}`;let c=this.scene.getMeshByName(h);if(c||(c=ae.CreateBox(h,{width:.85,height:.85,depth:.1},this.scene),c.setParent(this.boardParent),c.position=new oe(r,-1*i,.1),c.scaling=oe.One(),c.material=g(a,{glow:!0},this.scene),l||(c.onPointerPick=()=>{this.start(),this.puzzle.pickBoard(r,i),this.updateMeshes(),O()})),!s)return;const d=`magic_box_tile_${s}`;let u=this.scene.getMeshByName(d);u||(u=ae.CreatePlane(d,{width:.8,height:.8,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),u.isPickable=!1,u.material=b([`${s?s/10:""}`],l?"#12b212":o,this.scene),u.position=new oe(r,-1*i,0)),u.setParent(this.boardParent),u.scaling=oe.One(),f.Instance.animateTransform({mesh:u,end:{position:new oe(r,-1*i,0)},duration:100})}))})),s.forEach(((e,t)=>{const s=`magic_box_rack_${t}`;let i=this.scene.getMeshByName(s);if(i||(i=ae.CreateBox(s,{width:.85,height:.85,depth:.1},this.scene),i.setParent(this.rackParent),i.material=g(a,{glow:!0},this.scene),i.position=new oe(t,0,.1),i.scaling=oe.One(),i.onPointerPick=()=>{this.start(),this.puzzle.pickRack(t),this.updateMeshes(),O()}),!e)return;const n=`magic_box_tile_${e}`;let r=this.scene.getMeshByName(n);r||(r=ae.CreatePlane(n,{width:.8,height:.8,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),r.isPickable=!1,r.material=b([`${e?e/10:""}`],o,this.scene),r.position=new oe(1*t,0,0)),r.setParent(this.rackParent),r.scaling=oe.One(),f.Instance.animateTransform({mesh:r,end:{position:new oe(1*t,0,0)},duration:100})})),i){const e=`magic_box_tile_${i}`;let t=this.scene.getMeshByName(e);t||(t=ae.CreatePlane(e,{width:.8,height:.8,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),t.isPickable=!1,t.material=b([`${i?i/10:""}`],o,this.scene),t.position=new oe(0,1,0)),t.setParent(r),t.scaling=oe.One(),f.Instance.animateTransform({mesh:t,end:{position:new oe(0,1,0)},duration:100})}}start(){"intro"===this.state&&(this.state="running",this.infoBillboard?.setEnabled(!1))}stop(){this.parent.setEnabled(!1)}}const{MeshBuilder:pe,Vector3:me}=BABYLON,ge=[[-1,1,2],[0,2,2],[1,3,2],[2,4,2],[0,2,-2]],Be=[[-2,1,-2],[-2,2,1],[-2,3,-1],[-2,4,0],[2,1,-1],[2,2,1],[2,3,-2],[2,4,0]],{MeshBuilder:be,Vector3:fe}=BABYLON,{MeshBuilder:we,Vector3:Pe}=BABYLON,ke=[[0,1,-1],[0,1,0],[0,0,0],[0,-1,0],[0,-2,0],[1,-2,0],[1,-2,-1],[1,-2,-2],[0,-2,-2],[-1,-2,-2],[-2,-2,-2],[-2,-2,-1],[-2,-2,-1]],Oe=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,1,1,1,0,0,0],[0,0,1,0,1,0,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,0,1,1,0,0,0],[0,0,0,0,1,0,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,1,0,0,1,0,0],[0,0,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],{MeshBuilder:Me,Vector3:ve}=BABYLON,Le="boldbigflank-js13k2024",ye=["   Thanks for Playing!   ","   Made by Alex Swan","   Click to Restart"],{Engine:Ne,Scene:Ee,MeshBuilder:Ce,HemisphericLight:Ae,UniversalCamera:Se,Vector3:xe,PointerEventTypes:Ie}=BABYLON,Ye=async()=>{let e=!1;document.getElementById("intro").style.display="none";const n=document.getElementById("c"),h=n;if(!h)return;h.style.display="block",h.addEventListener("click",(async()=>{document.pointerLockElement!==n&&await h.requestPointerLock({unadjustedMovement:!0})}));const P=new Ne(h,!0),k=new Ee(P),O=new BABYLON.GlowLayer("glow",k);O.customEmissiveColorSelector=(e,t,s,i)=>{e.name.includes("glow_")?i.set(1,1,1,1):s.name.includes("glow")?i.set(.5,.5,.5,1):e.name.includes("laser")?i.set(1,0,0,1):i.set(0,0,0,0)};let M=null,L=null;const y=[],N=new BABYLON.TransformNode("puzzleBoxes",k);f.Instance.initScene(k),k.gravity=new xe(0,-.15,0),k.collisionsEnabled=!0,l&&k.debugLayer.show({embedMode:!0}),P.displayLoadingUI();const E=new Se("MainCamera",new xe(0,1.615,-4),k);E.inertia=0,E.speed=3,E.keysUp.push(87),E.keysDown.push(83),E.keysLeft.push(65),E.keysRight.push(68),E.keysUpward.push(69),E.keysDownward.push(81),E.attachControl(h,!0),E.angularSensibility=500,E.applyGravity=!0,E.ellipsoid=new xe(.4,.8,.4),E.checkCollisions=!0,E.minZ=.1;const C=()=>k.pick(P.getRenderWidth()/2,P.getRenderHeight()/2);k.onPointerObservable.add((t=>{if(k)if(t.type===Ie.POINTERMOVE){const s=e?t.pickInfo:C();let i=s?.pickedMesh;for(;i&&!i.onPointerMove;)i=i.parent;i&&i.onPointerMove&&i.onPointerMove(s)}else if(t.type===Ie.POINTERDOWN){if(!e&&0!==t.event.button)return;const s=e?t.pickInfo:C();let i=s?.pickedMesh;for(;i&&!i.onPointerPick;)i=i.parent;i&&i.onPointerPick&&i.onPointerPick(s)}})),P.runRenderLoop((()=>{k.render()})),window.addEventListener("resize",(()=>{P.resize()}));const A=new BABYLON.TransformNode("inventory-parent",k);A.setParent(k.activeCamera),A.position=new xe(-.5,0,2);const S=BABYLON.MeshBuilder.CreatePlane("cursor",{},k);O.addExcludedMesh(S),S.isPickable=!1,S.material=(e=>{const t="cursor";if(m[t])return m[t];const[s,i]=c(512);i.imageSmoothingEnabled=!1,i.lineCap="square",i.beginPath(),i.moveTo(249,256),i.lineTo(251,256),i.moveTo(261,256),i.lineTo(263,256),i.moveTo(256,249),i.lineTo(256,251),i.moveTo(256,261),i.lineTo(256,263),i.lineWidth=4,i.strokeStyle=r,i.stroke(),i.lineWidth=2,i.strokeStyle=a,i.stroke();const n=B(s,e);return n.disableLighting=!0,n.emissiveColor=BABYLON.Color3.White(),n.diffuseTexture.hasAlpha=!0,m[t]=n,n})(k),S.setParent(E),S.position=new xe(0,0,1.1),S.renderingGroupId=1,new Ae("light",new xe(-.5,1,0),k);const x=new Ae("light",new xe(.5,-1,0),k),I=BABYLON.MeshBuilder.CreateSphere("skybox",{diameter:200,sideOrientation:BABYLON.Mesh.DOUBLESIDE},k),T=function(e){const t=BABYLON.Color3.FromHexString(e.color1||"#ff0000"),s=BABYLON.Color3.FromHexString(e.color2||"#0000ff"),i=e.scale||1,n=new BABYLON.NodeMaterial("node");n.mode=BABYLON.NodeMaterialModes.Material;const o=new BABYLON.InputBlock("position");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("position");const a=new BABYLON.TransformBlock("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;const r=new BABYLON.InputBlock("World");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("World normal");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=0;const h=new BABYLON.InputBlock("normal");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsAttribute("normal");const c=new BABYLON.LightBlock("Lights");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=3;const d=new BABYLON.InputBlock("cameraPosition");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1,d.setAsSystemValue(BABYLON.NodeMaterialSystemValues.CameraPosition);const u=new BABYLON.MultiplyBlock("Multiply");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=4;const p=new BABYLON.GradientBlock("Gradient");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4,p.colorSteps=[],p.colorSteps.push(new BABYLON.GradientBlockColorStep(0,t)),p.colorSteps.push(new BABYLON.GradientBlockColorStep(1,s));const m=new BABYLON.SimplexPerlin3DBlock("SimplexPerlin3D");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;const g=new BABYLON.ScaleBlock("Scale");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4;const B=new BABYLON.InputBlock("Scale");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=1,B.value=i,B.min=0,B.max=0,B.isBoolean=!1,B.matrixMode=0,B.animationType=BABYLON.AnimatedInputBlockTypes.None,B.isConstant=!0;const b=new BABYLON.FragmentOutputBlock("FragmentOutput");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=2,b.convertToGammaSpace=!1,b.convertToLinearSpace=!1,b.useLogarithmicDepth=!1;const f=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.complementZ=0,f.complementW=1;const w=new BABYLON.InputBlock("ViewProjection");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=1,w.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const P=new BABYLON.VertexOutputBlock("VertexOutput");return P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=1,o.output.connectTo(a.vector),r.output.connectTo(a.transform),a.output.connectTo(f.vector),w.output.connectTo(f.transform),f.output.connectTo(P.vector),a.output.connectTo(c.worldPosition),h.output.connectTo(l.vector),r.output.connectTo(l.transform),l.output.connectTo(c.worldNormal),d.output.connectTo(c.cameraPosition),c.diffuseOutput.connectTo(u.left),a.xyz.connectTo(g.input),B.output.connectTo(g.factor),g.output.connectTo(m.seed),m.output.connectTo(p.gradient),p.output.connectTo(u.right),u.output.connectTo(b.rgb),n.addOutputNode(P),n.addOutputNode(b),n.build(),n}({color1:"#0065BF",color2:a,scale:.1});I.material=T,I.infiniteDistance=!0,x.includedOnlyMeshes.push(I);const _=Ce.CreateTiledGround("ground",{xmin:-50,xmax:100,zmin:-20,zmax:80,subdivisions:{w:20,h:10}});_.material=((e,t)=>{const s=`colortexture${e}`;if(m[s])return m[s];const i=new d("standardMaterial"+ ++p,t);i.diffuseColor=BABYLON.Color3.FromHexString(e);const n=(()=>{const[e,t]=c(512),s=t.getImageData(0,0,e.width,e.height),i=s.data,n=i.length;for(let e=0;e<n;e+=4)i[e]=i[e+1]=i[e+2]=256*Math.random()|0,i[e+3]=255;t.putImageData(s,0,0);const[o,a]=c(512);a.save();for(let t=4;t<=e.width;t*=2){const s=Math.random()*(e.width-t)|0,i=Math.random()*(e.height-t)|0;a.globalAlpha=4/t,a.drawImage(e,s,i,t,t,0,0,o.width,o.height)}return a.restore(),o})(),o=u.LoadFromDataString("texture"+ ++p,n.toDataURL(),t);return i.diffuseColor=BABYLON.Color3.FromHexString(e),i.diffuseTexture=o,m[s]=i,i})(t,k),_.checkCollisions=!0,_.position.y=-.01;const z=Ce.CreateTiledGround("ground",{xmin:-3,xmax:3,zmin:-3,zmax:3,subdivisions:{w:2,h:1}});z.position.z=E.position.z,z.checkCollisions=!0,z.visibility=.2,z.position.y=-.02;const $=new Y(k);$.model.setEnabled(!1),y.push($);const D=new U(k);D.model.setEnabled(!1),y.push(D);const F=new ie(k);F.model.setEnabled(!1),y.push(F);const R=new ue(k);R.model.setEnabled(!1),y.push(R);const V=(e=>{const t=new BABYLON.TransformNode("clock_cloud_parent",e);t.metadata={offsetY:1};const s=BABYLON.MeshBuilder.CreateBox("clock_cloud",{size:4},e);return s.setParent(t),s.scaling=new me(1/4,1/4,1/4),s.visibility=.5,Be.forEach((([t,n,o])=>{const a=pe.CreateBox(`clock_box_${t}-${n}-${o}`,{width:.2,height:.8,depth:.8},e);a.setParent(s),a.material=g(i,{},e),a.isPickable=!1,a.scaling=me.One(),a.position=new me(t>0?t-.105:t+.105,n-2.5,o+.5)})),ge.forEach((([t,n,o])=>{const a=pe.CreateBox(`clock_box_${t}-${n}-${o}`,{width:.8,height:.8,depth:.2},e);a.setParent(s),a.material=g(i,{},e),a.isPickable=!1,a.scaling=me.One(),a.position=new me(t-.5,n-2.5,o>0?o-.105:o+.105)})),t})(k);V.position=new xe(0,.5,2),V.onPointerPick=()=>{v(),M=$,L=V,$.model.setEnabled(!0),$.reset(),N.setEnabled(!1)},V.setParent(N);const H=(e=>{const t=Oe[0].length,s=new BABYLON.TransformNode("thirteen_parent",e);s.metadata={offsetY:2};const i=BABYLON.MeshBuilder.CreateBox("thirteen",{size:t},e);return i.setParent(s),i.scaling=new ve(1/t,1/t,1/t),i.visibility=.5,Oe.forEach(((t,s)=>{t.forEach(((n,o)=>{if(!n)return;const a=Me.CreateSphere(`glow_light_${o}-${s}`,{diameter:1},e);a.setParent(i),a.isPickable=!1,a.scaling=ve.One(),a.position=new ve(o-.5*t.length,.5*Oe.length-s,0)}))})),s})(k);H.position=new xe(2,.5,0),H.onPointerPick=()=>{v(),M=D,L=H,D.model.setEnabled(!0),D.reset(),N.setEnabled(!1)},H.setParent(N);const W=(e=>{const t=new BABYLON.TransformNode("snake_parent",e);t.metadata={offsetY:.5};const i=BABYLON.MeshBuilder.CreateBox("snake",{size:4},e);return i.setParent(t),i.scaling=new Pe(1/4,1/4,1/4),i.visibility=.5,ke.forEach((([t,n,o],a)=>{const r=we.CreateBox(`snake_box_${t}-${n}-${o}`,{size:a>0?.8:.95},e);r.setParent(i),r.material=g(s,{},e),r.isPickable=!1,r.scaling=Pe.One(),r.position=new Pe(t+.5,n+.5,o+.5)})),t})(k);W.position=new xe(0,.5,-2),W.onPointerPick=()=>{v(),M=F,L=W,F.model.setEnabled(!0),F.reset(),N.setEnabled(!1)},W.setParent(N);const G=(e=>{const t=new BABYLON.TransformNode("box_base_parent",e);t.metadata={offsetY:0};const s=BABYLON.MeshBuilder.CreateBox("box_base",{size:3},e);s.setParent(t),s.scaling=new fe(1/3,1/3,1/3),s.visibility=.5;for(let t=0;t<3;t++)for(let i=0;i<3;i++){const n=be.CreateBox(`box_base_${i}-${t}`,{size:.9},e);n.setParent(s),n.isPickable=!1,n.scaling=fe.One(),n.material=g(o,{},e),n.position=new fe(i-1,-1,t-1)}return t})(k);G.position=new xe(-2,.5,0),G.onPointerPick=()=>{v(),M=R,L=G,R.model.setEnabled(!0),R.reset(),N.setEnabled(!1)},G.setParent(N);const X=e=>{if((e=>{console.log("checking",e);const t=localStorage.getItem(Le)||"{}";return JSON.parse(t)[e]||!1})(e.name))return e.isPickable=!1,e.onPointerPick=void 0,f.Instance.animateTransform({mesh:e,end:{position:new xe(0,1+e.metadata.offsetY,0),scaling:new xe(2,2,2),rotation:new xe(0,2*Math.PI,0)},duration:1e3}),e.position=new xe(0,1+e.metadata.offsetY,0),e.scaling=new xe(2,2,2),e.getChildMeshes(!0).forEach((e=>{e.visibility=0,e.isPickable=!1})),!0},j=Ce.CreatePlane("billboard",{width:2,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},k);j.material=b(ye,o,k),j.isPickable=!0,j.position=new xe(0,.75,-1.126),j.onPointerPick=()=>{localStorage.setItem(Le,"{}"),window.location.reload()},j.setEnabled(!1);const Z=()=>{X(V)&&X(H)&&X(W)&&X(G)&&j.setEnabled(!0)};Z(),X(V),X(H),X(W),X(G),k.registerBeforeRender((()=>{M&&(M.isSolved()?(w(...[2.07,0,130.81,.01,.26,.47,3,1.15,,.1,,,.05,,,,.14,.26,.15,.02]),M.stop(),M=null,L&&(((e,t)=>{console.log("saving",e);const s=localStorage.getItem(Le)||"{}",i=JSON.parse(s);i[e]=!0,localStorage.setItem(Le,JSON.stringify(i))})(L.name),L.isPickable=!1,L.onPointerPick=void 0,f.Instance.animateTransform({mesh:L,end:{position:new xe(0,1+L.metadata.offsetY,0),scaling:new xe(2,2,2),rotation:new xe(0,2*Math.PI,0)},duration:1e3}),L.getChildMeshes(!0).forEach((e=>{e.visibility=0,e.isPickable=!1})),L=null,Z()),N.setEnabled(!0)):M.isFailed()&&(M?.stop(),M=null,L=null,N.setEnabled(!0)))}));const q=Ce.CreateBox("bounds",{width:12,height:5,depth:12,sideOrientation:BABYLON.Mesh.BACKSIDE},k);q.isPickable=!1,q.position=new xe(0,2.5,0),q.checkCollisions=!0,q.visibility=0,P.hideLoadingUI();const J=await k.createDefaultXRExperienceAsync({floorMeshes:[z]});J.input.onControllerAddedObservable.add((e=>{e.onMotionControllerInitObservable.add((e=>{e.onModelLoadedObservable.add((e=>{A.setParent(e.rootMesh),A.position=new xe(0,.1,.1),A.rotation=xe.Zero()}))}))})),J.input.onControllerRemovedObservable.add(((e,t)=>{A.setParent(k.activeCamera),A.position=new xe(-.5,0,2),A.rotation=xe.Zero()})),J.baseExperience.onStateChangedObservable.add((t=>{console.log("state",t,BABYLON.WebXRState.IN_XR),e=t===BABYLON.WebXRState.IN_XR,S.isEnabled(!e),e||(A.setParent(k.activeCamera),A.position=new xe(-.5,0,2),A.rotation=xe.Zero())}))};window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("playButton").onclick=Ye}))})();