<!doctype html><title>Death Estate</title><style>body,canvas,div,html{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}body{line-height:1}</style><body><script>!function(){"use strict";const t=Math.PI,s=t=>t<0?-t:t,e=(t,s)=>t<s?t:s,i=(t,s)=>t>s?t:s,n=t=>t<0?-1:1,h=(t,s=0,e=1)=>t<s?s:t>e?e:t,o=(t,s=0,e=1)=>e-s?h((t-s)/(e-s)):0,r=(t,s=0,e=1)=>s+h(t)*(e-s),l=(t=1,s=0)=>s+(t-s)*Math.random(),a=(t=1,s=0)=>0|l(t,s),c=(t=0,s)=>null==t.x?new u(t,null==s?t:s):new u(t.x,t.y);class u{constructor(t=0,s=0){this.x=t,this.y=s}t(){return new u(this.x,this.y)}add(t){return new u(this.x+t.x,this.y+t.y)}i(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t.x,this.y*t.y)}h(t){return new u(this.x/t.x,this.y/t.y)}scale(t){return new u(this.x*t,this.y*t)}length(){return this.o()**.5}o(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new u(0,t)}g(t=1){const s=this.length();return s>t?this.scale(t/s):this}m(t){return this.x*t.x+this.y*t.y}p(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}v(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),e=Math.sin(t);return new u(this.x*s-this.y*e,this.x*e+this.y*s)}direction(){return s(this.x)>s(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new u(this.y,-this.x)}floor(){return new u(Math.floor(this.x),Math.floor(this.y))}k(){return s(this.x*this.y)}S(t,s){return this.add(t.i(this).scale(h(s)))}T(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class d{constructor(t=1,s=1,e=1,i=1){this.r=t,this.A=s,this.b=e,this.a=i}t(){return new d(this.r,this.A,this.b,this.a)}add(t){return new d(this.r+t.r,this.A+t.A,this.b+t.b,this.a+t.a)}i(t){return new d(this.r-t.r,this.A-t.A,this.b-t.b,this.a-t.a)}multiply(t){return new d(this.r*t.r,this.A*t.A,this.b*t.b,this.a*t.a)}h(t){return new d(this.r/t.r,this.A/t.A,this.b/t.b,this.a/t.a)}scale(t,s=t){return new d(this.r*t,this.A*t,this.b*t,this.a*s)}C(){return new d(h(this.r),h(this.A),h(this.b),h(this.a))}S(t,s){return this.add(t.i(this).scale(h(s)))}R(t=0,s=0,e=1,i=1){const n=e<.5?e*(1+s):e+s-e*s,h=2*e-n,o=(t,s,e)=>(e=(e%1+1)%1)<1/6?t+6*(s-t)*e:e<.5?s:e<2/3?t+(s-t)*(2/3-e)*6:t;return this.r=o(h,n,t+1/3),this.A=o(h,n,t),this.b=o(h,n,t-1/3),this.a=i,this}D(){const t=this.r,s=this.A,e=this.b,i=this.a,n=Math.max(t,s,e),h=Math.min(t,s,e),o=(n+h)/2;let r=0,l=0;if(n!=h){let i=n-h;l=o>.5?i/(2-n-h):i/(n+h),t==n?r=(s-e)/i+(s<e?6:0):s==n?r=(e-t)/i+2:e==n&&(r=(t-s)/i+4)}return[r/6,l,o,i]}$(t=.05,s=0){return new d(this.r+l(t,-t),this.A+l(t,-t),this.b+l(t,-t),this.a+l(s,-s)).C()}toString(){return`rgb(${255*this.r|0},${255*this.A|0},${255*this.b|0},${this.a})`}F(){return(255*this.r|0)+(255*this.A<<8)+(255*this.b<<16)+(255*this.a<<24)}P(t){const s=s=>parseInt(t.slice(s,s+2),16)/255;return this.r=s(1),this.A=s(3),this.b=s(5),this.a=1,this}H(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.A)+t(this.b)}}let y,f,x=c(1920,1200),p=c(),w=c(16),g=.3,m=(c(1),c()),b=i(w.x,w.y),v=0,z=0,A=0,M=0;const S="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",O=new Image;let k,T,C,D,P=c();const F=t=>t.add(c(.5)).i(P.scale(.5)).multiply(c(1/b,-1/b)).add(m),$=t=>t.i(m).multiply(c(b,-b)).add(P.scale(.5)).i(c(.5));function E(t,s=c(1),e=-1,i=w,n=new d,h=0,o,r=new d(0,0,0,0),l=1){if(l)if(e<0||!O.width)ft(t.x,t.y,s.x,s.y,h,0,0,0,0,0,n.F());else{const l=y.x/i.x|0,a=i.x/y.x,c=i.y/y.y,u=e%l*a,d=(e/l|0)*c;ft(t.x,t.y,o?-s.x:s.x,s.y,h,u+f.x,d+f.y,u-f.x+a,d-f.y+c,n.F(),r.F())}else!function(t,s,e,i,n,h=T){t=$(t),s=s.scale(b),h.save(),h.translate(t.x+.5|0,t.y-.5|0),h.rotate(e),h.scale(i?-s.x:s.x,s.y),n(h),h.restore()}(t,s,h,o,(t=>{if(e<0)t.fillStyle=n,t.fillRect(-.5,-.5,1,1);else{const s=y.x/i.x|0,h=e%s*i.x+g,o=(e/s|0)*i.y+g,r=i.x-.6,l=i.y-.6;t.globalAlpha=n.a,t.drawImage(O,h,o,r,l,-.5,-.5,1,1)}}))}function Z(t,s,e,i,n){E(t,s,-1,w,e,i,0,0,n)}function B(t,s,e,i,n){!function(t,s=c(1),e,i,n,h,o,r,l){E(F(t),s.scale(1/b),e,i,n,h,o,r,l)}(t,s,-1,w,e,i,0,0,n)}function R(t,s,e=1,i=new d,n=0,h=new d(0,0,0),o="center",r="arial"){D.fillStyle=i,D.lineWidth=n,D.strokeStyle=h,D.textAlign=o,D.font=e+"px "+r,D.textBaseline="middle",D.lineJoin="round",s=s.t(),(t+"").split("\n").forEach((t=>{n&&D.strokeText(t,s.x,s.y),D.fillText(t,s.x,s.y),s.y+=e}))}function I(t,s,e=1,i,n,h,o,r){R(t,$(s),e*b,i,n*b,h,o,r)}const N=(t,s=0)=>_[s]&&1&_[s][t]?1:0,U=(t,s=0)=>_[s]&&2&_[s][t]?1:0,W=(t,s=0)=>_[s]&&4&_[s][t]?1:0;let q=c(),H=c(),L=0,Y=0,_=[[]];function j(){for(const t of _)for(const s in t)t[s]&=1;L=0}onkeydown=t=>{t.repeat||(_[Y=0][K(t.keyCode)]=3)},onkeyup=t=>{_[0][K(t.keyCode)]=4};const K=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{_[Y=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>_[0][t.button]=2&_[0][t.button]|4,onmousemove=t=>H=G(t),onwheel=t=>t.ctrlKey||(L=n(t.deltaY)),oncontextmenu=t=>!1;const G=t=>{if(!k)return c();const s=k.getBoundingClientRect();return c(k.width,k.height).multiply(c(o(t.x,s.left,s.right),o(t.y,s.top,s.bottom)))};if(void 0!==window.ontouchstart){let t,s;ontouchstart=ontouchmove=ontouchend=e=>{e.button=0;const i=e.touches.length;return i?(s||Q(0,s=1),e.x=e.touches[0].clientX,e.y=e.touches[0].clientY,t?onmousemove(e):onmousedown(e)):t&&onmouseup(e),t=i,!e.cancelable}}let J;new class{constructor(t){this.time=null==t?void 0:z+t,this.setTime=t}set(t=0){this.time=z+t,this.setTime=t}W(){this.time=void 0}U(){return null!=this.time}active(){return z<=this.time}N(){return z>this.time}get(){return this.U()?z-this.time:0}q(){return this.U()?o(this.time-z,this.setTime,0):0}toString(){}},c();class V{constructor(t,s=30,e=.7){this.range=s,this.B=e,this.I=t[1]||0,t[1]=0,this.L=st(...t)}play(t,s=1,e=1,i=1){let n=0;if(t){const e=this.range;if(e){const i=m.l(t);if(i>e*e)return;s*=o(i**.5,e,e*this.B)}n=2*$(t).x/k.width-1}const h=e+e*this.I*i*l(-1,1);return X([this.L],s,h,n)}_(t,s,e=1){return this.play(s,e,2**(t/12),0)}}function X(t,s=1,e=1,i=0,n=0){if(J||(J=new(window.AudioContext||webkitAudioContext)),J.resume(),"running"!=J.state)return;const o=J.createBuffer(t.length,t[0].length,tt),r=J.createBufferSource();t.forEach(((t,s)=>o.getChannelData(s).set(t))),r.buffer=o,r.playbackRate.value=e,r.loop=n;const l=J.createGain();return l.gain.value=.5*s,l.connect(J.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(J,{pan:h(i,-1,1)})):r).connect(l),r.start(),r}const Q=(...t)=>X([st(...t)]),tt=44100;function st(h=1,o=.05,r=220,a=0,c=0,u=.1,d=0,y=1,f=0,x=0,p=0,w=0,g=0,m=0,b=0,v=0,z=0,A=1,M=0,S=0){let O,k,T=2*t,C=f*=500*T/tt/tt,D=[],P=r*=(1+o*l(-1,1))*T/tt,F=0,$=0,E=0,Z=1,B=0,R=0,I=0;for(x*=500*T/tt**3,b*=T/tt,p*=T/tt,w*=tt,g=g*tt|0,k=(a=a*tt+9)+(M*=tt)+(c*=tt)+(u*=tt)+(z*=tt)|0;E<k;D[E++]=I)++R%(100*v|0)||(I=d?d>1?d>2?d>3?Math.sin((F%T)**3):i(e(Math.tan(F),1),-1):1-(2*F/T%2+2)%2:1-4*s(Math.round(F/T)-F/T):Math.sin(F),I=(g?1-S+S*Math.sin(T*E/g):1)*n(I)*s(I)**y*h*.5*(E<a?E/a:E<a+M?1-(E-a)/M*(1-A):E<a+M+c?A:E<k-z?(k-E-z)/u*A:0),I=z?I/2+(z>E?0:(E<k-z?1:(k-E)/z)*D[E-z|0]/2):I),O=(r+=f+=x)*Math.cos(b*$++),F+=O-O*m*(1-1e9*(Math.sin(E)+1)%2),Z&&++Z>w&&(r+=p,P+=p,Z=0),!g||++B%g||(r=P,f=C,Z=Z||1);return D}let et,it,nt,ht,ot,rt,lt,at,ct,ut;function dt(t,s){const e=it.createShader(s);return it.shaderSource(e,t),it.compileShader(e),e}function yt(){if(!at)return;const t=ct?xt:gt;it.blendFuncSeparate(wt,t,xt,t),it.enable(mt),it.bufferSubData(zt,0,rt.subarray(0,at*At*Mt)),it.drawArrays(pt,0,at*At),at=0,ct=ut}function ft(t,s,e,i,n,h,o,r,l,a=4294967295,c=0){at!=St&&ct==ut||yt();const u=Math.cos(n)/2,d=Math.sin(n)/2,y=u*e,f=u*i,x=d*e,p=d*i;let w=at++*At*Mt;rt[w++]=t-y-p,rt[w++]=s-f+x,rt[w++]=h,rt[w++]=l,lt[w++]=a,lt[w++]=c,rt[w++]=t+y+p,rt[w++]=s+f-x,rt[w++]=r,rt[w++]=o,lt[w++]=a,lt[w++]=c,rt[w++]=t-y+p,rt[w++]=s+f+x,rt[w++]=h,rt[w++]=o,lt[w++]=a,lt[w++]=c,rt[w++]=t-y-p,rt[w++]=s-f+x,rt[w++]=h,rt[w++]=l,lt[w++]=a,lt[w++]=c,rt[w++]=t+y-p,rt[w++]=s-f-x,rt[w++]=r,rt[w++]=l,lt[w++]=a,lt[w++]=c,rt[w++]=t+y+p,rt[w++]=s+f-x,rt[w++]=r,rt[w++]=o,lt[w++]=a,lt[w++]=c}c();const xt=1,pt=4,wt=770,gt=771,mt=3042,bt=3553,vt=5121,zt=34962,At=6,Mt=6,St=65536,Ot=[[0,1],[1,0],[0,-1],[-1,0]],kt=(Ot.concat([[1,1],[1,-1],[-1,-1],[-1,1]]),0),Tt=[1,2,4,8,16,32,64,128];class Ct{constructor(){this.buttons=[],this.Z=null}tt(t){this.buttons.push(t)}st(t){const s=this.buttons.indexOf(t);s>-1&&this.buttons.splice(s,1)}pressed(){this.Z=null;for(let t=this.buttons.length-1;t>=0&&!this.Z;t--){const s=this.buttons[t];s.it()&&(this.Z=s)}return!!this.Z}nt(){return!!this.Z&&(this.Z.it()&&this.Z.pressed(),this.Z=null,!0)}update(){this.buttons.forEach((t=>t.update()))}et(){this.buttons.forEach((t=>t.et()))}}const Dt=new V([2.77,,21,,.02,.01,3,.23,72,27,-13,.07,,,,.1,,.36]),Pt=new V([1.01,,402,.02,.04,.08,2,1.24,-14,,,,,,,,,.56,.07]),Ft=new V([1.54,,438,.02,.04,.19,,1.49,-6.9,,,,,.1,,.3,.01,.85,.01]),$t=new V([,,167,.01,.01,.01,2,.06,,,,,,,,.1,,,,.01]),Et=new V([,,86,.01,.01,.01,2,.06,,,,,,,,.1,,,,.01]),Zt=new V([1.73,,389,,.09,.13,1,1.89,,,-455,.01,,,,,.01,.74,.05,.08]),Bt=new d(.2,.2,.2,0);class Rt{constructor(t,s,e,i,n,h,o,r=!0,l=!0){this.ht=t,this.offset=c(),this.size=s,this.text=e,this.ot=i,this.bgColor=n,this.rt=h,this.ct=o||(()=>{}),this.ut=l,this.lt=!0,this.visible=!0,this.dt=r,this.ft=!1,this.wt=0,this.gt=0}get enabled(){return this.lt}set enabled(t){this.lt=t,this.bgColor.a=t?1:.5,this.rt.a=t?1:.5}it(){if(!this.enabled||!this.visible)return!1;const t=this.dt?H:q;return t.x>=this.ht.x-this.size.x/2&&t.y>=this.ht.y-this.size.y/2&&t.x<this.ht.x+this.size.x/2&&t.y<this.ht.y+this.size.y/2}pressed(){this.ct(),this.vt(),this.ut&&Dt.play()}vt(){this.ft=!0,this.wt=z,this.gt=z+.1}update(){if(!this.ft)return;if(z>=this.gt)return this.offset.y=0,void(this.ft=!1);const t=o(z,this.wt,this.gt);this.offset.y=.5*t-.5}et(){if(!this.visible)return;let t,s;this.dt?(t=B,s=R):(t=Z,s=I);const e=.5+this.offset.y;t(this.ht.add(this.offset).add(c(0,-this.size.y/2-e/2)),c(this.size.x,e),this.bgColor.i(Bt)),t(this.ht.add(this.offset),this.size,this.bgColor),s(this.text,this.ht.add(this.offset),this.ot,this.rt)}}const It=["Can you build me this?","Please make this for me?","I would like this house!"],Nt=["Thank you!","Thanks so much!","Appreciate it!","<3"],Ut=["Aww...","Darn...","Fine then...",":("];function Wt(t){return t[a(0,t.length)]}class qt{constructor(t){this.ht=t,this.color=new d(1,1,1,1),this.size=c(6),this.text=null,this.Mt=21+a(0,4),this.yt=!1,this.kt=t.t(),this.St=c(),this.xt=0,this.bt=0,this.Tt=null,this.At=!1,this.Ct=1,this.Rt=1,this.Dt=0,this.$t=0,this.Ft=null,this.Pt=!1,this.Ht=this.size.t(),this.Wt=c(),this.Ut=0,this.Nt=0,this.zt=null,this.qt=!1}moveTo(t,s){this.kt=this.ht.t(),this.St=t;const e=this.kt.u(this.St)/s;return this.xt=z,this.bt=z+e,this.yt=!0,new Promise((t=>this.Tt=t))}Bt(t,s){return this.Ct=this.color.a,this.Rt=t,this.Dt=z,this.$t=z+s,this.At=!0,new Promise((t=>this.Ft=t))}resizeTo(t,s){return this.Ht=this.size.t(),this.Wt=t,this.Ut=z,this.Nt=z+s,this.Pt=!0,new Promise((t=>this.zt=t))}It(){this.text=Wt(It)}Et(){this.text=Wt(Nt),setTimeout((()=>this.text=null),1500)}Lt(){this.text=Wt(Ut)}_t(){if(!this.yt)return;if(z>=this.bt)return this.ht=this.St.t(),this.yt=!1,this.Tt(this),void(this.Tt=null);const t=o(z,this.xt,this.bt);this.ht=this.kt.S(this.St,t)}Gt(){if(!this.At)return;if(z>=this.$t)return this.color.a=this.Rt,this.At=!1,this.Ft(this),void(this.Ft=null);const t=o(z,this.Dt,this.$t);this.color.a=r(t,this.Ct,this.Rt)}Jt(){if(!this.Pt)return;if(z>=this.Nt)return this.size=this.Wt.t(),this.Pt=!1,this.zt(this),void(this.zt=null);const t=o(z,this.Ut,this.Nt);this.size=this.Ht.S(this.Wt,t)}update(){this._t(),this.Gt(),this.Jt()}et(){E(this.ht,this.size,this.Mt,void 0,this.color),this.text&&I(this.text,this.ht.add(c(0,this.size.y/2+1)),1,this.color)}}const Ht=[new d(1,1,1,.3),null,new d(1,0,0,.5),new d(1,1,1,.5)],Lt=c(2);class Yt{constructor(t,s){this.ht=t,this.offset=c(),this.Ot=s||function(t){const s=a(1,10),e=[],i=[];for(let t=0;t<3;t++)e.push(new Array(3).fill(0));for(let t=0;t<s;t++){let s,n;if(0===t)s=a(0,3),n=a(0,3),i.push([s,n]);else{const t=i[a(0,i.length)],h=Ot.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=3||i[1]<0||i[1]>=3||0!==e[i[1]][i[0]]?null:i})).filter((t=>t));if(!h.length)continue;const o=h[a(0,h.length)];[s,n]=o,i.push(o)}e[n][s]=1}for(let t=e.length-1;t>=0;t--)e[t].every((t=>0===t))&&e.splice(t,1);for(let t=2;t>=0;t--)e.map((s=>s[t])).every((t=>0===t))&&e.forEach((s=>s.splice(t,1)));return e}(),this.jt(),this.Yt=-1,1===this.Ot.length&&1===this.Ot[0].length&&(this.Yt=a(0,7)-1,this.Yt>-1&&(this.Yt+=25)),this.state=0,this.Kt=!1,this.Qt=0,this.Vt=0}Xt(){this.Kt||(this.Kt=!0,this.Qt=z,this.Vt=z+.2)}jt(){for(let t=0;t<this.Ot.length;t++)for(let s=0;s<this.Ot[t].length;s++){const e=c(this.Ot[t].length,this.Ot.length),i=Ot.reduce(((i,n,h)=>{const o=c(s+n[0],t+n[1]);return o.T(e)&&7&this.Ot[o.y][o.x]?i|Tt[h]:i}),0);this.Ot[t][s]=7&this.Ot[t][s]|i<<3}}t(){const t=[];for(let s=0;s<this.Ot.length;s++)t.push([...this.Ot[s]]);return new Yt(this.ht.t(),t)}Zt(){const t=2*this.Ot[0].length,s=2*this.Ot.length;return[this.ht.t(),this.ht.add(c(t,s))]}ts(){const t=q.i(this.ht).add(c(1)).h(c(2)).floor(),s=this.Ot[t.y];return!!s&&!!s[t.x]}rotate(t){const s=this.Ot.length,e=this.Ot[0].length,i=new Array(e);for(let t=0;t<e;t++)i[t]=new Array(s).fill(0);for(let t=0;t<s;t++)for(let s=0;s<e;s++)i[s][t]=this.Ot[t][s];1===t?i.reverse():i.forEach((t=>t.reverse())),this.Ot=i,this.jt()}update(){if(!this.Kt)return;z>=this.Vt&&(this.offset.y=0,this.Kt=!1);const s=o(z,this.Qt,this.Vt);this.offset.y=1*Math.sin(s*t)}et(){for(let t=0;t<this.Ot.length;t+=1){const s=this.Ot[t];for(let e=0;e<s.length;e+=1){const i=s[e];if(!(7&i))continue;const n=Ht[this.state],h=c(e,t).multiply(Lt).add(this.ht).add(this.offset),o=this.Yt>-1?this.Yt:i>>3;E(h,Lt,o),n&&Z(h,Lt,n)}}}}const _t=new class{constructor(){this.ss=null,this.ns=kt}init(t){this.ss=t}es(t,s){this.ns=t,this.hs=this.ss[t],this.hs.init(s)}os(){this.hs.os()}rs(){this.hs.rs()}},jt=new Rt(c(0,-10),c(4,2.5),"Start",1.5,new d(1,1,1),new d(0,0,0),(()=>{_t.es(2)}),!1),Kt=new Ct;Kt.tt(jt);const Gt=c(5,0),Jt=c(-5,0),Vt=new qt(Gt.t());Vt.size=c(10);let Xt=null,Qt=0;function ts(){Xt=new Yt(c());const t=Xt.Zt(),s=c((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2),e=Xt.ht.i(s);Xt.ht.x=Jt.x+e.x,Xt.ht.y=Jt.y+e.y,Xt.state=1,Xt.Xt()}const ss={init(){ts()},os(){const s=Math.sin(z*t*2/.5)/2+.5,e=Math.sin(z*t*2/1.3),i=Math.sin(z*t*2/2.1);Vt.color.a=1-.2*s,Vt.ht=Gt.add(c(1*e,1*i)),z-Qt>=1&&(ts(),Qt=z),Xt&&Xt.update(),U(0)&&Kt.pressed(),W(0)&&Kt.nt(),Kt.update()},rs(){Xt&&Xt.et(),Vt.et();const s=Math.sin(z*t*2/3)/2+.5;I("Death Estate",c(0,10),5,new d(1,0,0),1+.2*s,new d(1,1,1)),Kt.et()}},es=[null,null,new d(.6,.6,.6),new d(.5,.5,.5),new d(.8,.3,.3),new d(1,0,0)],is=[new d(.278,.176,.235),new d(.223,.125,.183)],ns=[null,{index:4,angle:t},{index:4,angle:-t/2},{index:1,angle:-t/2},{index:4,angle:0},{index:0,angle:0},{index:1,angle:0},{index:2,angle:0},{index:4,angle:t/2},{index:1,angle:t},{index:0,angle:t/2},{index:2,angle:-t/2},{index:1,angle:t/2},{index:2,angle:t},{index:2,angle:t/2},{index:3,angle:0}];class hs{constructor(t,s,e){this.x=s,this.y=e,this.type=t||0,this.cs=0,this.us=!1}t(){return new hs(this.type,this.x,this.y)}apply(t){this.type=t.type}}class os{constructor(t,s){this.ht=c(),this.Ot=[],this.ls=[],this.ds=[],this.fs=!1,this.ws=!1,this.size=c(t,s);const e=this.size.x*this.size.y;for(let t=0;t<e;t+=1){const s=new hs(0,t%this.size.x,Math.floor(t/this.size.y));this.Ot.push(s),this.ds.push(s.t())}}gs(){this.Ot.forEach(((t,s)=>this.ds[s].apply(t)))}ps(t){const s=t.Zt(),e=this.Zt();if(!(s[0].x>=e[0].x&&s[0].y>=e[0].y&&s[1].x<=e[1].x&&s[1].y<=e[1].y))return!1;const i=t.ht.h(c(2)),n=t.Ot;for(let t=0;t<n.length;t+=1){const s=n[t];for(let e=0;e<s.length;e+=1){if(!(7&s[e]))continue;const n=i.add(c(e,t)),h=this.vs(n.x,n.y);if(h&&h.type)return!1}}return!0}Ms(t){const s=t.t();s.state=3;for(const t of this.Ot){const e=c(t.x,t.y).multiply(c(2));s.ht=e;for(let t=0;t<4;t++){if(this.ps(s)&&this.ys(s))return s;s.rotate(1)}}return null}ks(){const t=this.Ot.filter((t=>2===t.type));for(const s of t)for(const t of Ot){const e=c(s.x+t[0],s.y+t[1]),i=this.vs(e.x,e.y);if(i&&0===i.type)return void(this.ws=!0)}this.ws=!1}ys(t){const s=t.ht.h(c(2)),e=t.Ot;for(let t=0;t<e.length;t+=1){const i=e[t];for(let e=0;e<i.length;e+=1){if(!(7&i[e]))continue;const n=s.add(c(e,t));if(Ot.map((t=>this.vs(n.x+t[0],n.y+t[1]))).filter((t=>t)).some((t=>2===t.type)))return!0}}return!1}Ss(t){t.state=1,this.ls.push(t);const s=t.ht.h(c(2)),e=t.Ot;for(let t=0;t<e.length;t+=1){const i=e[t];for(let e=0;e<i.length;e+=1){if(!(7&i[e]))continue;const n=s.add(c(e,t));this.xs(n.x,n.y,1)}}}bs(){return this.size.multiply(c(2))}Zt(){return[this.ht.t(),this.ht.add(this.size.multiply(c(2)))]}xs(t,s,e){this.Ot[t+s*this.size.x].type=e}vs(t,s){return c(t,s).T(this.size)?this.Ot[t+s*this.size.x]:null}Ts(){const t=this.As();return t?this.vs(t.x,t.y):null}As(t=!1){return this.Cs(q,t)}Cs(t,s=!1){const e=t.i(this.ht).add(c(1));return s||e.T(this.size.multiply(c(2)))?e.h(c(2)).floor():null}Rs(t,s,e){const i=[];if(Math.abs(s.x-t.x)<Math.abs(s.y-t.y)){const e=Math.max(Math.min(s.y,t.y),0),n=Math.min(Math.max(s.y,t.y),this.size.y-1);for(let s=e;s<=n;s+=1)i.push(this.vs(t.x,s))}else{const e=Math.max(Math.min(s.x,t.x),0),n=Math.min(Math.max(s.x,t.x),this.size.x-1);for(let s=e;s<=n;s+=1)i.push(this.vs(s,t.y))}for(const t of i)t.type=e;return i}Ds(){this.Ot.forEach(((t,s)=>t.apply(this.ds[s])))}$s(){const t=this.Ot.filter((t=>2===t.type||5===t.type));t.forEach((t=>{t.type=5,t.us=!1}));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));if(!e.length)return void(this.fs=!1);const i=[];e.forEach((t=>{i.some((e=>s(e.x-t.x)<=3&&s(e.y-t.y)<=3))&&5!==t.type||(t.us=!0,i.push(t)),this.Fs(t.x,t.y)})),this.fs=t.every((t=>2===t.type))}Fs(t,s){const e=this.vs(t,s);if(e&&5===e.type){e.type=2;for(const e of Ot)this.Fs(t+e[0],s+e[1])}}jt(){const t=this.Ot.filter((t=>2===t.type));for(const s of t)s.cs=Ot.reduce(((t,e,i)=>{const n=c(s.x+e[0],s.y+e[1]);if(n.T(this.size)){const s=this.vs(n.x,n.y);if(!s||2!==s.type)return t}else if(!s.us)return t;return t|Tt[i]}),0)}Ps(){const t=this.size.x*this.size.y;let s=0,e=0;for(const t of this.Ot)1===t.type?s+=1:2===t.type&&(e+=1);return{Hs:t,Ws:s,Us:e}}et(){for(const t of this.Ot){let s=-1,e=0;const i=c(t.x,t.y).multiply(c(2)).add(this.ht),n=es[t.type]||is[(t.x+t.y)%2];if(2===t.type){const i=ns[t.cs];i&&(s=i.index+16,e=i.angle)}s>-1?E(i,c(2),s,void 0,void 0,e):n&&Z(i,c(2),n)}for(const t of this.ls)t.et()}}let rs,ls,as,cs,us,ds=c(),ys=null,fs=null,xs=c(),ps=null,ws=null;const gs=c(0,-8);let ms=[];const bs=c(),vs=c();let zs=c();const As="Drag and drop the ghosts' house requests! Must touch\na road, not overlap other houses, and be within the grid",Ms=new Ct,Ss=new Rt(c(0,-4),c(5,3),"Done",1.5,new d(1,1,1),new d(0,0,0),(()=>{rs.fs&&_t.es(3)}),!1);Ms.tt(Ss);const Os=new Ct,ks=new Rt(c(0,-5),c(5,3),"Rotate",1.2,new d(1,1,1),new d(0,0,0),(()=>{us.rotate(1)}),!1);Os.tt(ks);const Ts=new Rt(ks.ht.add(c(0,-4)),c(5,3),"Skip",1.5,new d(1,1,1),new d(0,0,0),(()=>{as>0&&(us=null,as-=1,Ft.play(),ps.Lt(),ps.Bt(0,2),ps.moveTo(gs.t().add(c(20,0)),10).then((t=>t.qt=!0)),_t.es(3)),as<=0&&(Ts.enabled=!1)}),!1,!1);Os.tt(Ts);const Cs={lower:c(),upper:c()},Ds=Ts.ht.i(Ts.size.h(c(2))).add(c(1)),Ps=ks.ht.add(ks.size.h(c(2))).add(c(1));function Fs(){for(let t=0;t<ms.length;t++){const s=ms[t];s.update(),s.qt&&(ms.splice(t,1),t--)}}const $s={init(){rs=new os(15,15),ys=null,fs=null,us=null;const t=rs.bs();m.x=rs.ht.x+t.x/2-1,m.y=rs.ht.y+t.y/2-1,Ss.ht.x=rs.ht.x+t.x/2-1,Ss.enabled=!1,bs.x=Ss.ht.x,bs.y=rs.ht.y+t.y-1+5,vs.x=Ss.ht.x,vs.y=Ss.ht.y-4,as=3;const s=rs.Zt();Cs.lower=s[0].i(c(8)),Cs.upper=s[1].add(c(8)),xs.x=rs.ht.x+t.x/2-1,xs.y=-8,gs.x=rs.ht.x+t.x-5,ms=[]},os(){if(U(0)&&!Ms.pressed()&&(fs=rs.As(),fs)){rs.gs();const t=rs.Ts();ls=2===t.type||5===t.type?4:3}if(W(0)){if(Ms.nt(),fs){rs.Ds();const t=rs.As(!0);3===ls?(rs.Rs(fs,t,2),Et.play()):(rs.Rs(fs,t,0),Zt.play()),rs.$s(),rs.jt(),Ss.enabled=rs.fs}fs=null}if(Ms.update(),N(0)&&fs){rs.Ds();const t=rs.As(!0);rs.Rs(fs,t,ls)}},rs(){rs.et(),I("Make roads by clicking and dragging lines\non the grid. Delete by clicking and dragging\non existing roads",bs,1.5),rs.fs||I("All roads must connect to an edge of the grid",vs,1.5),Ms.et()}},Es={init(){Ts.enabled=!1,ks.enabled=!1,ps=new qt(c(40,-20)),ps.moveTo(gs,15).then((()=>{_t.es(4)})),ms.push(ps)},os(){Fs(),Os.update()},rs(){rs.et(),us&&us.et();for(const t of ms)t.et();I(As,bs,1.5),I("right-click\nworks too",ks.ht.add(c(3,.5)),1,void 0,void 0,void 0,"left"),I(`Skips left: ${as}`,Ts.ht.add(c(3,0)),1.5,void 0,void 0,void 0,"left"),Os.et()}},Zs={init(){Ts.enabled=as>0,ks.enabled=!0,ps.It(),rs.ks(),us=new Yt(xs.t()),ws=rs.Ms(us),rs.ws&&(ws||as>0)&&Pt.play(),us.Xt()},os(){if(Fs(),us.update(),W(2)&&(us.rotate(1),Dt.play()),U(0)&&!Os.pressed()&&us.ts()&&($t.play(),us.state=0,ds=us.ht.t(),ys=q.t()),W(0)&&(Os.nt(),ys)){us.ht.x=2*Math.floor((us.ht.x+1)/2),us.ht.y=2*Math.floor((us.ht.y+1)/2);const t=us.Zt(),s=c((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);s.x>=Ds.x&&s.x<=Ps.x&&s.y>=Ds.y&&s.y<=Ps.y&&(us.ht.x=ds.x,us.ht.y=ds.y),rs.ps(us)&&rs.ys(us)?(Et.play(),rs.Ss(us),ps.Et(),ps.resizeTo(c(1),1),ps.moveTo(s.t(),10).then((t=>t.Bt(0,1))).then((t=>{t.qt=!0})),us=null,_t.es(3)):(Zt.play(),us.state=2),ys=null}if(Os.update(),N(0)&&ys){us.ht.x=ds.x+(q.x-ys.x),us.ht.y=ds.y+(q.y-ys.y);const t=us.Zt();t[0].x<Cs.lower.x?us.ht.x=Cs.lower.x:t[1].x>Cs.upper.x&&(us.ht.x=Cs.upper.x-(t[1].x-t[0].x)),t[0].y<Cs.lower.y?us.ht.y=Cs.lower.y:t[1].y>Cs.upper.y&&(us.ht.y=Cs.upper.y-(t[1].y-t[0].y))}4===_t.ns&&(!rs.ws||!ws&&as<=0)&&(ps&&(ps.Lt(),ps.Bt(0,2),ps.moveTo(gs.t().add(c(20,0)),10).then((t=>t.qt=!0))),Ft.play(),_t.es(5))},rs(){rs.et();for(const t of ms)t.et();us.et(),I(As,bs,1.5),I("right-click\nworks too",ks.ht.add(c(3,.5)),1,void 0,void 0,void 0,"left"),I(`Skips left: ${as}`,Ts.ht.add(c(3,0)),1.5,void 0,void 0,void 0,"left"),Os.et()}},Bs={init(){ks.enabled=!1,Ts.enabled=!1,cs=Date.now()},os(){Fs(),Os.update();const s=Date.now(),e=s-cs;if(zs=((s=1)=>(new u).v(l(2*t),s))(r(o(e,0,1e3),1,0)),e>=3e3){const t=rs.Ps();_t.es(6,{timestamp:s,Ns:t.Hs,zs:t.Ws,Us:t.Us})}},rs(){rs.et(),us.et();for(const t of ms)t.et();I("Game over! No more space or skips",bs.add(zs),1.5),I("right-click\nworks too",ks.ht.add(c(3,.5)),1,new d(1,1,1,.5),void 0,void 0,"left"),I(`Skips left: ${as}`,Ts.ht.add(c(3,0)),1.5,new d(1,1,1,.5),void 0,void 0,"left"),Os.et()}},Rs=new d(1,0,0),Is=new d(1,1,1),Ns=new d(1,1,1),Us=new d(1,1,0),Ws="deathestate_jayther_ldb",qs={};let Hs,Ls=[],Ys=0,_s=0,js=!0;const Ks=c(0,18),Gs=Ks.add(c(0,-5)),Js=Ks.add(c(0,-13)),Vs=Js.add(c(3,-5)),Xs=new Array(5);for(let t=0;t<Xs.length;t++)Xs[t]=[Vs.add(c(-.7,-2*t)),Vs.add(c(.7,-2*t))];const Qs=new Ct,te=new Rt(Ks.add(c(0,-31)),c(5,3),"Retry",1.5,new d(1,1,1),new d(0,0,0),(()=>{_t.es(2)}),!1);Qs.tt(te);const se=[{init(){},os(){},rs(){}},ss,$s,Es,Zs,Bs,{init(t){Ys=t.Ns,_s=t.Us,function(){let t=null;if(js)try{t=window.localStorage.getItem(Ws)}catch(t){js=!1}else t=qs[Ws]||null;t&&(Ls=JSON.parse(t)),Ls=Ls.filter((t=>"number"==typeof t.zs)),Ls.forEach((t=>t.qs=new Date(t.timestamp).toLocaleDateString()))}(),function(t,s){for(Hs={zs:t,timestamp:s,qs:new Date(s).toLocaleDateString(),Bs:!0},Ls.push(Hs),Ls.sort(((t,s)=>{const e=s.zs-t.zs;return 0===e?s.timestamp-t.timestamp:e}));Ls.length>5;)Ls.pop();!function(){const t=Ls.map((t=>({zs:t.zs,timestamp:t.timestamp}))),s=JSON.stringify(t);if(js)try{window.localStorage.setItem(Ws,s)}catch(t){js=!1}js||(qs[Ws]=s)}()}(t.zs,t.timestamp),m.x=0,m.y=0},os(){U(0)&&Qs.pressed(),W(0)&&Qs.nt(),Qs.update()},rs(){!function(){I("Game over",Ks,4,Rs,.5,Is),I(`You covered ${Hs.zs} tiles (${Math.floor(Hs.zs/Ys*100)}%)\n(road count: ${_s}, grid total: ${Ys})`,Gs,2,Ns),I("High Scores",Js,4,Rs,.5,Is);for(let t=0;t<5;t++){const s=Ls[t];let e,i,n;s?(e=s.qs,i=s.zs.toString(),n=s.Bs?Us:Ns):(e="-------------",i="---",n=Ns),I(e,Xs[t][0],2,n,void 0,void 0,"right"),I(i,Xs[t][1],2,n,void 0,void 0,"left")}}(),Qs.et()}}],ee=b;!function(t,s,i,n,h,o){O.onerror=O.onload=()=>{f=c(g).h(y=c(O.width,O.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(k=document.createElement("canvas")),T=k.getContext("2d"),k.style=S,function(){et=document.createElement("canvas"),it=et.getContext("webgl",{antialias:!1}),et.style=S,nt=function(t){if(!t||!t.width)return;const s=it.createTexture();return it.bindTexture(bt,s),it.texImage2D(bt,0,6408,6408,vt,t),it.texParameteri(bt,10241,9728),it.texParameteri(bt,10240,9728),it.texParameteri(bt,10242,33071),it.texParameteri(bt,10243,33071),s}(O),document.body.appendChild(et),ot=function(t,s){const e=it.createProgram();return it.attachShader(e,dt("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}",35633)),it.attachShader(e,dt("precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}",35632)),it.linkProgram(e),e}();const t=new ArrayBuffer(St*At*24);(function(t,s,e){const i=it.createBuffer();it.bindBuffer(t,i),it.bufferData(t,s,35048)})(zt,t.byteLength),rt=new Float32Array(t),lt=new Uint32Array(t);let s=at=0;const e=(t,e,i,n,h=0)=>{const o=it.getAttribLocation(ot,t);it.enableVertexAttribArray(o),it.vertexAttribPointer(o,n,e,h,24,s),s+=n*i};e("p",5126,4,2),e("t",5126,4,2),e("c",vt,1,4,1),e("a",vt,1,4,1)}(),document.body.appendChild(C=document.createElement("canvas")),D=C.getContext("2d"),C.style=S,ne(),_t.init(se),_t.es(1),r()};const r=(t=0)=>{let s=t-A;if(A=t,M=e(M+!0*s,50),p.x){C.width=k.width=p.x,C.height=k.height=p.y;const t=innerWidth/innerHeight,s=k.width/k.height;k.style.width=C.style.width=t<s?"100%":"",k.style.height=C.style.height=t<s?"":"100%",et&&(et.style.width=k.style.width,et.style.height=k.style.height)}else C.width=k.width=e(innerWidth,x.x),C.height=k.height=e(innerHeight,x.y);P=c(k.width,k.height);{let t=0;for(M<0&&M>-9&&(t=M,M=0);M>=0;M-=1e3/60)document.hasFocus()||(_=[[]]),q=F(H),_t.os(),z=++v/60,j();M+=t}P=c(k.width,k.height),T.imageSmoothingEnabled=!1,function(t,s,e,i,n){it.viewport(0,0,et.width=t,et.height=s),it.clear(16384),it.bindTexture(bt,ht=nt),it.useProgram(ot),ut=undefined;const h=2*n/t,o=2*n/s;it.uniformMatrix4fv(it.getUniformLocation(ot,"m"),0,new Float32Array([h,0,0,0,0,o,0,0,1,1,-1,1,-1-h*e,-1-o*i,0,0]))}(k.width,k.height,m.x,m.y,b),_t.rs(),at&&yt(),requestAnimationFrame(r)};o?O.src=o:O.onload()}(0,0,0,0,0,"t.png");let ie=null;function ne(){const t=680/940>innerWidth/innerHeight?innerWidth/680:innerHeight/940;!function(t){b=t}(ee*t)}window.addEventListener("resize",(function(){clearTimeout(ie),ie=setTimeout(ne,200)}),!1)}()</script>