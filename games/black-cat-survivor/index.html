<!doctype html><title>Black Cat Survivor - js13kGames 2025</title><body style=margin:0><canvas id=game style=display:block></canvas><script>function t(){var t,e,i,s,a,h=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},n=function(t,e,i){var s,a,h,n,l,d,c=o[t.i[0]],m=t.i[1],u=t.i[3]/32,p=o[t.i[4]],f=t.i[5],g=t.i[8]/32,y=t.i[9],x=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,b=1/v,S=-t.i[13]/16,R=t.i[14],A=i*2**(2-t.i[15]),j=new Int32Array(x+w+v),H=0,k=0;for(s=0,a=0;s<x+w+v;s++,a++)a>=0&&(a-=A,l=r(e+(15&(R=R>>8|(255&R)<<4))+t.i[2]-128),d=r(e+(15&R)+t.i[6]-128)*(1+8e-4*t.i[7])),h=1,s<x?h=s/x:s>=x+w&&(h=(1-(h=(s-x-w)*b))*3**(S*h)),n=c(H+=l*h**u)*m,n+=p(k+=d*h**g)*f,y&&(n+=(2*Math.random()-1)*y),j[s]=80*n*h|0;return j},o=[h,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(h){t=h,e=h.endPattern,i=0,s=h.rowLen*h.patternLen*(e+1)*2,a=new Int32Array(s)},this.generate=function(){var r,l,d,c,m,u,p,f,g,y,x,w,v,b,S=new Int32Array(s),R=t.songData[i],A=t.rowLen,j=t.patternLen,H=0,k=0,M=!1,C=[];for(d=0;d<=e;++d)for(p=R.p[d],c=0;c<j;++c){var _=p?R.c[p-1].f[c]:0;_&&(R.i[_-1]=R.c[p-1].f[c+j]||0,_<17&&(C=[]));var T=o[R.i[16]],X=R.i[17]/512,O=2**(R.i[18]-9)/A,L=R.i[19],E=R.i[20],Y=43.23529*R.i[21]*3.141592/44100,I=1-R.i[22]/255,D=1e-5*R.i[23],W=R.i[24]/32,F=R.i[25]/512,B=6.283184*2**(R.i[26]-9)/A,U=R.i[27]/255,P=R.i[28]*A&-2;for(x=(d*j+c)*A,m=0;m<4;++m)if(u=p?R.c[p-1].n[c+m*j]:0){C[u]||(C[u]=n(R,u,A));var N=C[u];for(l=0,r=2*x;l<N.length;l++,r+=2)S[r]+=N[l]}for(l=0;l<A;l++)(y=S[f=2*(x+l)])||M?(w=Y,L&&(w*=T(O*f)*X+.5),k+=(w=1.5*Math.sin(w))*(v=I*(y-k)-(H+=w*k)),y=3==E?k:1==E?v:H,D&&(y=(y*=D)<1?y>-1?h(.25*y):-1:1,y/=D),M=(y*=W)*y>1e-5,b=y*(1-(g=Math.sin(B*f)*F+.5)),y*=g):b=0,f>=P&&(b+=S[f-P+1]*U,y+=S[f-P]*U),S[f]=0|b,S[f+1]=0|y,a[f]+=0|b,a[f+1]+=0|y}return++i/t.numChannels},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var h=0,r=44;h<s;++h){var n=a[h];n=n<-32767?-32767:n>32767?32767:n,i[r++]=255&n,i[r++]=n>>8&255}return i}}if(("function"!=typeof Blob||typeof e>"u")&&"function"==typeof Blob&&typeof webkitURL<"u")var e=webkitURL;var i,s,a=Blob||(i=self,s=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},i=function(){this.data=[]},s=function(t,e,i){this.data=t,this.size=t.length,this.type=e,this.encoding=i},a=i.prototype,h=s.prototype,r=t.FileReaderSync,n=function(t){this.code=this[this.name=t]},o="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),l=o.length,d=t.URL||t.webkitURL||t,c=d.createObjectURL,m=(d.revokeObjectURL,d),u=t.btoa,p=t.atob,f=!1,g=t.ArrayBuffer,y=t.Uint8Array;for(s.fake=h.fake=!0;l--;)n.prototype[o[l]]=l+1;try{y&&function(t){f=!t}.apply(0,new y(3528e4))}catch{}return d.createObjectURL||(m=t.URL={}),m.createObjectURL=function(t){var e,i=t.type;return null===i&&(i="application/octet-stream"),t instanceof s?(e="data:"+i,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):u?e+";base64,"+u(t.data):e+","+encodeURIComponent(t.data)):c?c.call(d,t):void 0},a.append=function(t){var i=this.data;if(y&&(t instanceof g||t instanceof y))if(f)i.push(String.fromCharCode.apply(String,new y(t)));else{for(var a="",h=new y(t),o=0,l=h.length;o<l;o++)a+=String.fromCharCode(h[o]);i.push(a)}else if("Blob"===e(t)||"File"===e(t)){if(!r)throw new n("NOT_READABLE_ERR");var d=new r;i.push(d.readAsBinaryString(t))}else t instanceof s?"base64"===t.encoding&&p?i.push(p(t.data)):"URI"===t.encoding?i.push(decodeURIComponent(t.data)):"raw"===t.encoding&&i.push(t.data):("string"!=typeof t&&(t+=""),i.push(unescape(encodeURIComponent(t))))},a.getBlob=function(t){return arguments.length||(t=null),new s(this.data.join(""),t,"raw")},a.toString=function(){return"[object BlobBuilder]"},h.toString=function(){return"[object Blob]"},i}(i),function(t,e){var i=e&&e.type||"",a=new s;if(t)for(var h=0,r=t.length;h<r;h++)a.append(t[h]);return a.getBlob(i)}),h=document.getElementById("game"),r=h.getContext("2d");r.imageSmoothingEnabled=!1;var n=function(){h.width=window.innerWidth,h.height=window.innerHeight,r.scale(6,6),r.imageSmoothingEnabled=!1};n(),window.addEventListener("resize",n);var o={};function l(t){return o[t]}window.addEventListener("keydown",function(t){o[t.code]=!0}),window.addEventListener("keyup",function(t){o[t.code]=!1});var d,c=function(e){var i=new t;for(e=Object.assign({loop:!1,rowLen:5513,patternLen:1,endPattern:0,numChannels:1},e),i.init(e);i.generate()<1;);var s=i.createWave(),h=document.createElement("audio");return h.src=URL.createObjectURL(new a([s],{type:"audio/wav"})),h.loop=null==e.loop||e.loop,null!=e.volume&&(h.volume=e.volume),h.tryplay=function(){window.addEventListener("focus",()=>{h.paused&&h.play()}),window.addEventListener("blur",()=>{h.paused||h.pause()}),h._tryplay()},h._tryplay=function(){h.play().catch(()=>{requestAnimationFrame(h._tryplay)})},h},m=function(t,e){return Math.random()*(e-t)+t},u=function(t){return(43758.5453*Math.sin(function(t,e){return t.x*e.x+t.y*e.y}(t,{x:12.9898,y:78.233}))%1+1)/2},p=function(t){let e={};for(let i in t)e[i]=t[i].clone();return e},f=function(t,e,i,s){let a=s?1:10;return parseInt(Math.floor(t/a)*a).toString(16).padStart(2,"0")+parseInt(Math.floor(e/a)*a).toString(16).padStart(2,"0")+parseInt(Math.floor(i/a)*a).toString(16).padStart(2,"0")},g=function(t){let e=t.match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/);return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]},y=function(t,e){var i=new OffscreenCanvas(t.width,t.height);let s=i.getContext("2d");s.drawImage(t,0,0);let a=s.getImageData(0,0,t.width,t.height);for(let t=0;t<a.data.length;t+=4){let i=f(a.data[t],a.data[t+1],a.data[t+2]);if(Object.keys(e).includes(i)){let s=g(e[i]);a.data[t]=s[0],a.data[t+1]=s[1],a.data[t+2]=s[2]}}return s.putImageData(a,0,0),i.transferToImageBitmap()},x=function(t){switch(this.targetType){case 1:let e=null,i=1/0,s=k.getEnemies();for(let a=0;a<s.length;a++){let h=s[a];if(t==h)continue;let r=L(this.world,h.world);r<i&&r<=this.maxAttackRange&&(i=r,e={obj:h,dist:r,dir:E(this.world,h.world)})}return e;case 2:let a=L(this.world,H.world);return a<=this.maxAttackRange?{obj:H,dist:a,dir:E(this.world,H.world)}:null}return null},w=class{constructor(t={x:0,y:0,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},objects:[],animations:null,grass:null}){if(Object.assign(this,t),null!=this.animations)for(this.animations=p(this.animations),this.grass=[],Object.values(this.animations).forEach(t=>{let e=t.frames[0]/t.spriteSheet._f|0,i=t.frames[0]%t.spriteSheet._f|0;createImageBitmap(t.spriteSheet.image,i*t.width,e*t.height,t.width,t.height).then(t=>{this.grass.push(t)})});this.grass.length<this.animations.length;);}render(){if(null!=this.grass){let t={h:h.height/6/8,w:h.width/6/8};for(let e=0;e<t.h;e++)for(let i=0;i<t.w;i++){let t=Math.floor(this.x/8),s=Math.floor(this.y/8),a=u({x:t+i,y:s+e});if(a>.85){let h=(a+u({x:t+i+1e3,y:s+e+1e3}))/2>.5?1:-1;r.save();let n=this.grass[0];a>.95?n=this.grass[2]:a>.9&&(n=this.grass[1]);let o=8*i-(this.x-8*t),l=8*e-(this.y-8*s);r.translate(o,l);let d=Math.min(.8,Math.max(.5,(a+u({x:t+i+2e3,y:s+e+2e3}))/2));r.scale(h*d,1*d),r.drawImage(n,0,0,n.width,n.height,0,0,n.width*h,n.height),r.restore()}}}r.save(),r.translate(-this.x,-this.y);for(let t=0;t<this.objects.length;t++)this.objects[t].render();r.restore()}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],i=e.indexOf(t);i>=0&&e.splice(i,1),t.parent=null}reset(){this.objects=[]}update(t){this.x=H.x-h.width/2/6,this.y=H.y-h.height/2/6,(this.grass||[]).forEach(e=>e.update&&e.update(t)),(this.objects||[]).forEach(e=>e.update&&e.update(t))}},v=1/60,b=0,S=!1,R=null,A=null,j={x:0,y:14,cardSeparation:4,objects:[],reset:function(){this.objects=[]},render:function(){r.save(),(this.x||this.y)&&r.translate(this.x,this.y);for(let t=0;t<this.objects.length;t++)this.objects[t].render(),r.translate(this.objects[t].cardWidth+this.cardSeparation,0);r.restore()},addChild:function(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e},removeChild:function(t){let e=this.objects||[],i=e.indexOf(t);i>=0&&e.splice(i,1),t.parent=null},update:function(t){let e=0;(this.objects||[]).forEach(i=>{i.update&&i.update(t),e+=i.cardWidth+i.border.l+i.border.r+this.cardSeparation}),this.x=h.width/2/6-e/2}},H=null,k=null,M={},C=[],_={background:c({loop:!0,songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[139,,,,137,,,,139,,,,140,,,,,,,,135],f:[]}]}],patternLen:32}),edie:c({songData:[{i:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,14,0,10,32,0,0,0,0],p:[1],c:[{n:[156],f:[]}]}]}),ehit:c({songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[151],f:[]}]}]}),pickup:c({songData:[{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[1],c:[{n:[182],f:[]}]}]}),gshoot:c({volume:.5,songData:[{i:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[1],c:[{n:[175],f:[]}]}]}),lbounce:c({songData:[{i:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[1],c:[{n:[182],f:[]}]}]}),lvlup:c({songData:[{i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[166,,168,,170,,159],f:[]}]}],patternLen:12}),gover:c({songData:[{i:[0,214,104,64,0,204,104,0,64,229,4,40,43,51,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[1],c:[{n:[159],f:[]}]}],patternLen:8}),gwin:c({songData:[{i:[3,100,128,0,3,201,128,2,0,0,0,6,49,0,0,0,0,139,4,1,3,30,184,119,244,147,6,84,6],p:[1],c:[{n:[156,,154,,156,,158],f:[]}]}],patternLen:8})},T=null,X=function(t,e,i){return Math.min(Math.max(t,e),i)},O=function(t){let e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/(0!=e?e:1),y:t.y/(0!=e?e:1)}},L=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},E=function(t,e){return O({x:e.x-t.x,y:e.y-t.y})},Y=function(t,e){let i=Math.cos(e),s=Math.sin(e);return{x:i*t.x-s*t.y,y:s*t.x+i*t.y}},I=function(t,e,i){r.save(),r.font=i,r.fillText(t,e.x,e.y),r.restore()},D=class{constructor(t){this.init(t),this.initialize()}init(t){Object.assign(this,{x:0,y:0,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:0,y:0},ttl:1/0,scaleX:1,scaleY:1,parent:null,visible:!0,world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1},hurtWidth:0,hurtHeight:0,flipy:!1,flipx:!1}),Object.assign(this,t),"animations"in t&&(this.animations=p(t.animations),this.currentAnimation=this.animations[Object.keys(this.animations)[0]],this.width=this.currentAnimation.width,this.height=this.currentAnimation.height),this.hurtBox=new W({parent:this,center:{x:0,y:0},width:this.hurtWidth,height:this.hurtHeight})}initialize(){}isAlive(){return this.ttl>0}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],i=e.indexOf(t);i>=0&&e.splice(i,1),t.parent=null}update(t=v){this.advance(t)}advance(t=v){this.dx+=this.ddx*t,this.dy+=this.ddy*t,this.x+=this.dx*t,this.y+=this.dy*t,this.ttl--,this.currentAnimation?.update(t);let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,(this.objects||[]).forEach(e=>e.update&&e.update(t))}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}render(){if(this.visible){if(r.save(),(this.x||this.y)&&r.translate(this.x,this.y),r.save(),"currentAnimation"in this){let t=this.currentAnimation.frames[this.currentAnimation._f]/this.currentAnimation.spriteSheet._f|0,e=this.currentAnimation.frames[this.currentAnimation._f]%this.currentAnimation.spriteSheet._f|0,i=this.flipx?-1:1,s=this.flipy?-1:1;r.scale(i*this.scaleX,s*this.scaleY),r.filter=this?.invert?"invert(1)":"",r.translate(-1*i*this.currentAnimation.width*this.anchor.x,-1*s*this.currentAnimation.height*this.anchor.y),r.drawImage(this.currentAnimation.spriteSheet.image,this.currentAnimation.margin+e*this.currentAnimation.width+(2*e+1)*this.currentAnimation.spacing,this.currentAnimation.margin+t*this.currentAnimation.height+(2*t+1)*this.currentAnimation.spacing,this.currentAnimation.width,this.currentAnimation.height,0,0,this.currentAnimation.width*i,this.currentAnimation.height*s)}r.restore(),(this.objects||[]).forEach(t=>t.render&&t.render()),r.restore()}}},W=class{constructor({parent:t,center:e,width:i,height:s}={}){this.center=e,this.width=i,this.height=s,this.parent=t}getWorldPos(){return{x:this.center.x+this.parent?.world?.x|0,y:this.center.y+this.parent?.world?.y|0}}intersects(t){let e=this.getWorldPos(),i=t.getWorldPos();return 2*Math.abs(e.x-i.x)<this.width+t.width&&2*Math.abs(e.y-i.y)<this.height+t.height}},F=class{constructor(t){this.fps=60,Object.assign(this,t),this.isStopped=!0,this.accumulator=0,this.delta=1e3/this.fps,this.step=1/this.fps,this.last=null,this.rAF=null,this.dt=null,this.focused=!0,window.addEventListener("focus",()=>{this.focused=!0}),window.addEventListener("blur",()=>{this.focused=!1})}frame(){if(this.isStopped)return;if(!this.focused)return void(this.rAF=requestAnimationFrame(this.frame.bind(this)));let t=performance.now();if(this.dt=t-this.last,this.last=t,this.dt>1e3)this.rAF=requestAnimationFrame(this.frame.bind(this));else{for(this.accumulator+=this.dt;this.accumulator>=this.delta&&(this.update(this.step),!this.isStopped);)this.accumulator-=this.delta;r.clearRect(0,0,h.width,h.height),this.render(),this.rAF=requestAnimationFrame(this.frame.bind(this))}}start(){this.isStopped&&(this.last=performance.now(),this.isStopped=!1,this.rAF=requestAnimationFrame(this.frame.bind(this)))}stop(){this.isStopped=!0,cancelAnimationFrame(this.rAF)}update(){}fill_canvas(t,e="destination-under",i=null){r.save(),r.globalCompositeOperation=e,r.fillStyle=t,i?r.fillRect(i.x,i.y,i.width,i.height):r.fillRect(0,0,h.width,h.height),r.restore()}renderInside(){}render(){this.fill_canvas("#334e1b","source-over"),this.renderInside()}},B=class t{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:a}){let{width:h,height:r,spacing:n=0,margin:o=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:a,width:h,height:r,spacing:n,margin:o,isStopped:!1,_f:0,_a:0})}clone(){return new t(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1)return void this.stop();for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:a=a}){let h=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;a.drawImage(this.spriteSheet.image,this.margin+r*this.width+(2*r+1)*this.spacing,this.margin+h*this.height+(2*h+1)*this.spacing,this.width,this.height,t,e,i,s)}},U=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:a=0,animations:h}={}){this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:a},this._f=(t.width-a)/e|0,this.createAnimations(h)}parseFrames(t){if(+t==t)return t;let e=[],i=t.split(".."),s=+i[0],a=+i[1],h=s;if(s<a)for(;h<=a;h++)e.push(h);else for(;h>=a;h--)e.push(h);return e}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:a,loop:h}=t[i];e=[],[].concat(s).map(t=>{e=e.concat(this.parseFrames(t))}),this.animations[i]=new B({spriteSheet:this,frames:e,frameRate:a,loop:h,name:i})}}},P=class{constructor(t){Object.assign(this,Object.assign({maxValue:100,minValue:0,value:0,x:0,y:0,anchor:{x:0,y:0},scaleX:1,scaleY:1,parent:null,visible:!0,width:1,height:1,world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}},t)),"animations"in t&&(this.animations=p(t.animations),Object.keys(this.animations).map(e=>{let i=new D({width:12,height:4,animations:p(t.animations),flipy:t.flipy||!1});return i.playAnimation(e),i}).forEach(t=>{this.addChild(t)}),this.width=Math.max(this.width,12),this.height=Math.max(this.height,4))}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],i=e.indexOf(t);i>=0&&e.splice(i,1),t.parent=null}update(t=v){this.advance(t)}advance(t=v){let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,this.world.dirty=!0;let i=this.value/(this.maxValue-this.minValue);this.objects[1].scaleX=i,(this.objects||[]).forEach(e=>e.update&&e.update(t))}render(){this.visible&&(r.save(),r.translate(this.x-this.width*this.anchor.x*this.scaleX,this.y-this.height*this.anchor.y*this.scaleY),r.scale(this.scaleX,this.scaleY),(this.objects||[]).forEach(t=>t.render&&t.render()),r.restore())}},N=class extends D{constructor(t){super(Object.assign({shinedx:0,shinetime:5},t))}pickup(){return!1}update(t){let e=L(H.world,this.world);if(e<=H.attractionRange){let t=E(this.world,H.world),i=H.attractionSpeed/2+(1-e/H.attractionRange)*H.attractionSpeed*.75;this.dx=t.x*i,this.dy=t.y*i}else this.dx=0,this.dy=0;this.advance(t),H.hurtBox.intersects(this.hurtBox)&&this.pickup()&&A.removeChild(this),this.shinedx+=t,this.shinedx>=this.shinetime&&(this.shinedx=0,this.playAnimation("shine"))}},V=class{constructor(t){Object.assign(this,Object.assign({icon:null,cardWidth:8,cardHeight:8,border:{l:1,r:2,b:-.5,t:-.5},color:"#333333",borderColor:"#000000",emptyColor:"#000000",filledColor:"#00FF00",anchor:{x:.5,y:.5},banchor:{x:.26,y:.5},world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}},t)),this.icon=p(this.icon),this.frame=this.icon[Object.keys(this.icon)[0]],this.frameCoords={y:this.frame.frames[0]/this.frame.spriteSheet._f|0,x:this.frame.frames[0]%this.frame.spriteSheet._f|0},this.scale={x:(this.cardWidth-3)/this.frame.width,y:(this.cardHeight-3)/this.frame.height},this.iconSize={x:this.frame.width*this.scale.x,y:this.frame.height*this.scale.y}}update(t){this.frame.update(t)}render(){r.save(),r.save();let t=this.cardWidth+this.border.l+this.border.r,e=this.cardHeight+this.border.t+this.border.b;r.translate(-t*this.banchor.x,-e*this.banchor.y),r.fillStyle=this.borderColor,r.fillRect(0,0,t,e),r.fillStyle=this.color,r.translate(.1,.1),r.fillRect(0,0,t-.2,e-.2),r.restore();for(let i=1;i<=this.item.maxLevel;i++){r.fillStyle=this.emptyColor;let s=Math.floor(i/4);r.fillRect(-t*this.banchor.x+this.cardWidth+2*(s-1),-e*this.banchor.y+.65+2*(i-3*s-1),1.5,1.5),r.fillStyle=i<=this.item.level?this.filledColor:"#555555",r.fillRect(-t*this.banchor.x+this.cardWidth+2*(s-1)+.1,-e*this.banchor.y+.65+2*(i-3*s-1)+.1,1.3,1.3)}r.scale(this.scale.x,this.scale.y),r.translate(-this.frame.width*this.anchor.x,-this.frame.height*this.anchor.y),r.drawImage(this.frame.spriteSheet.image,this.frame.margin+this.frameCoords.x*this.frame.width+(2*this.frameCoords.x+1)*this.frame.spacing,this.frame.margin+this.frameCoords.y*this.frame.height+(2*this.frameCoords.y+1)*this.frame.spacing,this.frame.width,this.frame.height,0,0,this.frame.width,this.frame.height),r.restore()}},q=function(t){return new N(Object.assign({animations:C[12].animations,anchor:{x:.5,y:.5},score:1,hurtWidth:4,hurtHeight:4,scaleX:1,scaleY:1,pickup:function(){return H.score+=this.score,H.addXp(this.score),_.pickup.play(),!0}},t))},z=function(t){return q(Object.assign({animations:C[16].animations,pickup:function(){return H.score+=this.score,_.pickup.play(),S=!0,!0}},t))},K=function(t){return new D(Object.assign({x:0,y:0,anchor:{x:.5,y:.5},animations:C[8].animations,ttl:30,update:function(){this.advance(),this.ttl<=0&&A.removeChild(this)}},t))},G=function(t){return new D(Object.assign({targetType:1,direction:{x:1,y:0},speed:5,hurtWidth:1,hurtHeight:1,damage:1,removeOnHit:!0,cooldown:.5,dt:0,update:function(t){if(this.dt-=t,this.dx=this.direction.x*this.speed,this.dy=this.direction.y*this.speed,this.advance(t),this.dt<=0)switch(this.targetType){case 1:let t=k.getEnemies();for(let e=0;e<t.length;e++){let i=t[e];if(this.hurtBox.intersects(i.hurtBox)){if(i?.takeDamage&&i.takeDamage(this.damage),this.removeOnHit){this.ttl=0;break}this.dt=this.cooldown}}break;case 2:if(this.hurtBox.intersects(H.hurtBox)){if(H?.takeDamage&&H?.takeDamage(this.damage),this.removeOnHit){this.ttl=0;break}this.dt=this.cooldown}}this.ttl<=0&&A.removeChild(this)}},t))},$=function(t){return new D(Object.assign({aiTransitions:{},aiState:"n",aiDt:0,aiLastStackReturn:null,update:function(t){this.advance(t),this.aiState in this&&this[this.aiState](),(this.aiTransitions[this.aiState]||[]).every(t=>(this.aiLastStackReturn=this[t.method](...(t.args||[]).concat([this.aiLastStackReturn])),this.aiLastStackReturn)),this.aiLastStackReturn=null},changeState(t){this.aiState=t},aiDeltaUpdate(t){return(this.aiDt<=0||this.aiDt>t)&&(this.aiDt=t),this.aiDt=this.aiDt-v,this.aiDt<=0}},t))},J=function(t){return $(Object.assign({targetType:1,anchor:{x:.5,y:.5},bulletSpeed:15,reloadTime:1,maxAttackRange:50,shootSound:null,level:1,maxLevel:5,icon:null,damage:1,reload:function(){let t=Math.max(v,this.reloadTime*(1/this.level));return this.aiDeltaUpdate(t)},getClosestTargetInRange:x,fire:function(t){if(null==t)return null;let e=G(Object.assign({x:this.world.x,y:this.world.y,speed:this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,direction:t.dir,ttl:300,color:"#00FF00",width:1,height:1,scaleX:1,scaleY:1,targetType:this.targetType,level:this.level,damage:this.damage*((1==this.targetType?1:0)+this.level)},this.bulletArgs));return this.shootSound&&this.shootSound.play(),e},addToMap:function(t){return null!=t&&A.addChild(t),!0},aiTransitions:{seek:[{method:"getClosestTargetInRange",args:[]},{method:"fire",args:[]},{method:"addToMap",args:[]},{method:"changeState",args:["reloadg"]}],reloadg:[{method:"reload",args:[]},{method:"changeState",args:["seek"]}]},aiState:"seek"},t))},Q=.75,Z=function(t){let e=J({x:0,y:0,width:7,height:7,scaleX:1,scaleY:1,bulletSpeed:0,maxAttackRange:3.5,targetType:2,damage:t.damage,level:t.level,bulletArgs:{anchor:{x:.5,y:.5},hurtHeight:t.hurtHeight||7,hurtWidth:t.hurtWidth||7,ttl:1,removeOnHit:!1}}),i=new P({x:0,y:4,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,animations:C[10].animations}),s=$(Object.assign({scoreAmt:1,curHealth:10,maxHealth:10,x:100,y:100,anchor:{x:.5,y:.5},animations:C[1].animations,scaleX:1,scaleY:1,hurtWidth:7,hurtHeight:7,createDropItem:q,_lastflipx:0,updateDirection:function(){return this._lastflipx=Math.max(0,this._lastflipx-v),this._lastflipx<=0&&(this.flipx=this.dx<0,this._lastflipx=.5),!0},takeDamage:function(t){this.curHealth=Math.max(0,this.curHealth-t),this.curHealth<=0?this.die():_.ehit.play()},updateHealthBar:function(){return this.objects[0].y=this.height/2*this.scaleY,this.objects[0].value=this.curHealth,this.objects[0].maxValue=this.maxHealth,this.objects[0].visible=this.curHealth!=this.maxHealth,!0},die:function(){this.curHealth=0,A.removeChild(this),A.addChild(K({x:this.world.x,y:this.world.y})),_.edie.play(),A.addChild(this.createDropItem({x:this.world.x,y:this.world.y,score:this.scoreAmt}))},reinit:function(t){this.init(t),this.objects[1].damage=t.damage,this.objects[1].level=t.level}},t));return s.addChild(i),s.addChild(e),s},tt=class{constructor(t={}){Object.assign(this,Object.assign({enemyArgs:[],bossArgs:null,maxEnemies:50,sps:2},t)),this.x=0,this.y=0,this.dx=0,this.dy=0,this.ddx=0,this.ddy=0,this.scaleX=1,this.scaleY=1,this.width=1,this.height=1,this.world={x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},this.enemyList=[],this._dt=0}reset(){this.enemyList=[],this.boss=null,this._dt=0}_assignRandPos(t){let e=Y({x:1,y:0},m(-Math.PI,Math.PI));t.x=H.world.x+150*e.x,t.y=H.world.y+150*e.y}update(t=v){if(this._dt-=t,this._dt<=0){let t=Math.max(v,this.sps-.25*Math.floor(b/15));this._dt=t;let i=this.getEnemies();var e;i.length<this.maxEnemies&&(i.length<this.enemyList.length?(e=this.enemyList.filter(t=>t.curHealth<=0)[0]).reinit(this.pickEnemy()):((e=Z(this.pickEnemy())).parent=this,this.enemyList.push(e)),e.speed=e.speed*m(.9,1.1),this._assignRandPos(e)),!this?.boss&&b>=120&&(this.boss=Z(this.bossArgs),this._assignRandPos(this.boss),this.enemyList.push(this.boss))}let i={};this.getEnemies().forEach(t=>{L(H.world,t.world)>300&&this._assignRandPos(t);let e=Math.floor(t.world.x/64)+","+Math.floor(t.world.y/64),s=i[e]||[];s.push(t),i[e]=s}),Object.values(i).forEach(t=>{if(t.length<=1)return;let e=t.map(t=>({x:t.x,y:t.y,world:t.world,dx:t.dx,dy:t.dy,enemy:t}));e.forEach(e=>{E(e.world,H.world);let i=0,s=0,a=0,h={x:0,y:0},r={x:0,y:0},n={x:0,y:0};if(t.forEach(t=>{t.etype==e.enemy.etype&&(r.x+=t.world.x,r.y+=t.world.y,i+=1),!(e.enemy==t||L(e,t)>12)&&(t.etype==e.enemy.etype&&(s+=1,h.x+=t.dx,h.y+=t.dy),a+=1,n.x+=t.world.x-e.world.x,n.y+=t.world.y-e.world.y)}),s>0||i>0||a>0){let t=1;s>0&&(h.x/=s,h.y/=s,h=O(h),t-=.1),i>0&&(r.x=r.x/i-e.world.x,r.x=r.y/i-e.world.y,r=O(r),t-=.1),a>0&&(n.x/=-1*a,n.y/=-1*a,n=O(n),t-=.3);let o=O({x:e.dx,y:e.dy}),l=O({x:.1*h.x+.1*r.x+.3*n.x+o.x*t,y:.1*h.y+.1*r.y+.3*n.y+o.y*t});e.dx=l.x*e.enemy.speed,e.dy=l.y*e.enemy.speed}}),e.forEach(t=>{t.enemy.dx=t.dx,t.enemy.dy=t.dy})}),(this.getEnemies()||[]).forEach(e=>e.update&&e.update(t))}pickEnemy(){let t=Math.floor(b/30);return this.enemyArgs[Math.floor(m(0,1)*Math.min(t,this.enemyArgs.length))]}getEnemies(){return this.enemyList.filter(t=>t.curHealth>0)}render(){r.save(),(this.x||this.y)&&r.translate(this.x,this.y),(this.getEnemies()||[]).forEach(t=>t.render&&t.render()),r.restore()}};(function(...t){return Promise.all(t.map(t=>function(t){return new Promise((e,i)=>{if(M[t])return e(M[t]);let s=new Image;s.onload=function(){let i=new URL(t,window.location.href).href;M[t]=M[i]=this,e(this)},s.onerror=function(){i(t)},s.src=t})}(t)))})("characters.png").then(()=>{C=(C=[{idle:[0],img:M["characters.png"]},{idle:[1],img:M["characters.png"]},{idle:[1],img:y(M["characters.png"],{141414:"381616",282828:"382716",323232:"381d16","3c3c3c":"382716","1e1e1e":"382716"})},{idle:[27],img:M["characters.png"]},{idle:[33],img:M["characters.png"]}].map(t=>new U({image:t.img,frameWidth:8,frameHeight:8,animations:{idle:{frames:t.idle,frameRate:1,loop:!0}}}))).concat(new U({image:y(M["characters.png"],{"000000":"5f6902",fafafa:"c4cb06"}),frameWidth:4,frameHeight:4,animations:{fly:{frames:[24,25],frameRate:8,loop:!0}}}),new U({image:y(M["characters.png"],{"000000":"ff5fff",fafafa:"ff9cec"}),frameWidth:4,frameHeight:4,animations:{fly:{frames:[36,37,38,39],frameRate:8,loop:!0}}}),new U({image:y(M["characters.png"],{323232:"670404",646464:"c11010"}),frameWidth:8,frameHeight:8,animations:{fly:{frames:[12,13,14,15],frameRate:4,loop:!0}}}),new U({image:M["characters.png"],frameWidth:16,frameHeight:16,animations:{explode:{frames:[1,2,5,8],frameRate:8,loop:!1}}}),new U({image:y(M["characters.png"],{fafafa:"1ff1b7"}),frameWidth:16,frameHeight:16,animations:{explode:{frames:[1,2,5,8],frameRate:8,loop:!1}}}),new U({image:M["characters.png"],frameWidth:12,frameHeight:4,animations:{back:{frames:[24],frameRate:1,loop:!1},fore:{frames:[25],frameRate:1,loop:!1}}}),new U({image:M["characters.png"],frameWidth:8,frameHeight:8,animations:{variant1:{frames:[24],frameRate:1,loop:!1},variant2:{frames:[25],frameRate:1,loop:!1},variant3:{frames:[26],frameRate:1,loop:!1}}}),new U({image:y(M["characters.png"],{323232:"3ba2ff",646464:"6ae4ff","000000":"3f37ff"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[84],frameRate:1,loop:!1},shine:{frames:[84,85,86,87,88,89],frameRate:6,loop:!1}}}),new U({image:y(M["characters.png"],{aa3c3c:"3ba2ff"}),frameWidth:12,frameHeight:4,animations:{back:{frames:[24],frameRate:1,loop:!1},fore:{frames:[25],frameRate:1,loop:!1}}}),new U({image:y(M["characters.png"],{323232:"a03030"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[78],frameRate:1,loop:!1}}}),new U({image:y(M["characters.png"],{323232:"702b88"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[79],frameRate:1,loop:!1}}}),new U({image:y(M["characters.png"],{323232:"ad5fff",646464:"dcb1fe","000000":"8f0dff"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[84],frameRate:1,loop:!1},shine:{frames:[84,85,86,87,88,89],frameRate:6,loop:!1}}})),T={pew:function(){return J({itemType:"pew",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bulletSpeed:25,reloadTime:2,shootSound:_.gshoot,damage:1,icon:C[5].animations,iconWidth:4,iconHeight:4,bulletArgs:{width:4,height:4,hurtHeight:1,hurtWidth:1,animations:C[5].animations,removeOnHit:!0}})},flame:function(){return J({itemType:"flame",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bulletSpeed:2,anchor:{x:.5,y:.5},flames:[],maxFlames:1,flameDist:16,time:0,icon:C[7].animations,bulletArgs:{width:8,height:8,scaleX:.75,scaleY:.75,hurtHeight:4,hurtWidth:4,anchor:{x:.5,y:.5},ttl:1/0,removeOnHit:!1,animations:C[7].animations},aiTransitions:{spawnFlames:[{method:"updateFlames",args:[]},{method:"fire",args:[]},{method:"addFlame",args:[]},{method:"changeState",args:["reloadg"]}],reloadg:[{method:"updateFlames",args:[]},{method:"reload",args:[]},{method:"changeState",args:["spawnFlames"]}]},aiState:"reloadg",addFlame:function(t){return this.addChild(t),!0},updateFlames:function(){this.time+=v,this.parent,this.x,this.parent,this.y;for(let t=0;t<this.objects?.length|0;t++){let e=this.objects[t];e.speed=this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,e.damage=this.damage*(1+this.level);let i=3,s=Math.floor(t/i),a=t-s*i,h=this.objects.length-s*i,r=a*Math.PI*2/Math.min(i,h),n=s%2==0?1:-1,o=Y({x:this.flameDist-4*s*Math.sin(this.time*e.speed),y:0},r+n*this.time*e.speed);e.x=o.x,e.y=o.y}return this.maxFlames=this.level,(0|this.objects?.length)<this.maxFlames?{dir:{x:0,y:0}}:null}})},magnet:function(){return{itemType:"magnet",itemFlavor:"support",level:1,maxLevel:2,scaleX:.5,scaleY:.5,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},icon:C[14].animations,update:function(t){let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,this.attractionRange||(this.attractionRange=this.parent?.attractionRange),this.attractionSpeed||(this.attractionSpeed=this.parent?.attractspeed),this.parent.attractionRange=this.attractionRange*(1+this.level),this.parent.attractspeed=this.attractionSpeed+40*this.level}}},hiheel:function(){return{itemType:"hiheel",itemFlavor:"support",level:1,maxLevel:2,scaleX:.5,scaleY:.5,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},icon:C[15].animations,update:function(t){let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,this.speed?this.parent.speed=this.speed+5*this.level:this.speed=this.parent?.speed}}},ltn:function(){return J({itemType:"ltn",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bounceAmt:1,bulletSpeed:40,reloadTime:4,shootSound:_.gshoot,damage:1,icon:C[6].animations,iconWidth:4,iconHeight:4,bulletArgs:{width:4,height:4,hurtHeight:1,hurtWidth:1,animations:C[6].animations,maxAttackRange:40},reload:function(){let t=Math.max(v,this.reloadTime-.03*this.level*this.level);return this.aiDeltaUpdate(t)},fire:function(t){if(null==t)return null;let e=G(Object.assign({x:this.world.x,y:this.world.y,speed:this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,target:t.obj,ttl:300,width:1,height:1,scaleX:1,scaleY:1,bounceAmt:this.bounceAmt+this.level,targetType:this.targetType,damage:this.damage*((1==this.targetType?1:0)+this.level),getClosestTargetInRange:x,update:function(t){!this.target||this.target?.curHealth<=0||L(this.target,this)>this.maxAttackRange?this.target=this.getClosestTargetInRange(this.target)?.obj:1===(this.direction=E(this.world,this.target.world),this.dx=this.direction.x*this.speed,this.dy=this.direction.y*this.speed,this.advance(t),this.targetType)&&this.hurtBox.intersects(this.target.hurtBox)&&(this.target?.takeDamage&&this.target.takeDamage(this.damage),this.bounceAmt-=1,this.target=this.getClosestTargetInRange(this.target)?.obj,this.bounceAmt>0&&_.lbounce.play()),(this.ttl<=0||this.bounceAmt<=0||null==this.target)&&A.removeChild(this)}},this.bulletArgs));return this.shootSound&&this.shootSound.play(),e}})}},d={pew:"d",flame:"d",magnet:"support",hiheel:"support",ltn:"d"},function(){A=new w({animations:C[11].animations}),H=function(){let t=new P({x:0,y:4,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,animations:C[10].animations}),e=new P({x:0,y:5.5,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,flipy:!0,animations:C[13].animations}),i=new D({score:0,xp:0,level:1,curHealth:10,maxHealth:10,speed:20,attractionRange:10,attractionSpeed:40,x:0,y:0,width:4,height:8,anchor:{x:.5,y:.5},scaleX:1,scaleY:1,groundFriction:8,animations:C[0].animations,hurtWidth:7,hurtHeight:7,reset:function(){this.score=0,this.xp=0,this.level=1,this.curHealth=10,this.maxHealth=10,this.attractionRange=10,this.speed=20,this.objects=[this.objects[0],this.objects[1]]},addXp:function(t){this.xp+=t,this.xp>=this.nextLevelXp()&&(this.xp-=this.nextLevelXp(),this.level+=1,this.levelUp())},nextLevelXp:function(){return 5*this.level},levelUp:function(){let t=Object.keys(T),e=this.objects.filter(t=>t?.level==t?.maxLevel).map(t=>t.itemType),i=this.objects.reduce((t,e)=>t+("d"==e.itemFlavor?e.level:0),0),s=t.filter(t=>!e.includes(t)&&("support"==d[t]&&i>1||"support"!=d[t]));s.length>0&&this.addItem(T[s[Math.floor(m(0,1)*s.length)]]()),[1,2,3].forEach(t=>{A.addChild(K({x:this.world.x+m(-8,8),y:this.world.y+m(-8,8),animations:C[9].animations,scaleX:m(.8,1.1),scaleY:m(.8,1.1)}))}),_.lvlup.play()},getActions:function(){return{leftpressed:l("KeyA")||l("ArrowLeft"),rightpressed:l("KeyD")||l("ArrowRight"),downpressed:l("KeyS")||l("ArrowDown"),uppressed:l("KeyW")||l("ArrowUp")}},update:function(t){let e=this.getActions(),i=O({x:(e.leftpressed?-1:0)+(e.rightpressed?1:0),y:(e.uppressed?-1:0)+(e.downpressed?1:0)});this.dx=X(this.dx+i.x*this.speed,-this.speed,this.speed),this.dy=X(this.dy+i.y*this.speed,-this.speed,this.speed),0==i.x&&0!=this.dx&&(this.dx=Math.max(0,this.dx+-1*Math.sign(this.dx)*this.groundFriction),Math.abs(this.dx)<=1&&(this.dx=0)),0==i.y&&0!=this.dy&&(this.dy=Math.max(0,this.dy+-1*Math.sign(this.dy)*this.groundFriction),Math.abs(this.dy)<=1&&(this.dy=0)),0!=this.dx&&(this.flipx=this.dx<0),this.advance(t),this.objects[0].value=this.curHealth,this.objects[0].maxValue=this.maxHealth,this.objects[1].value=this.xp,this.objects[1].maxValue=this.nextLevelXp(),this.invunldt=Math.max(0,this.invunldt-t),this.invert=this.invunldt>0&&(this.invunldt/Q>=.25&&this.invunldt/Q<=.5||this.invunldt/Q>=.75&&this.invunldt/Q<=1)},takeDamage(t){this.invunldt>0||(this.curHealth=Math.max(0,this.curHealth-t),this.invunldt=Q)},addItem(t){let e=this.objects.filter(e=>e?.itemType==t?.itemType);e.length>0?e[0].level=Math.min(e[0].level+1,e[0].maxLevel):(this.addChild(t),j.addChild(new V({icon:t.icon,x:10,y:10,item:t,scaleX:1/(2/t.width),scaleY:1/(2/t.height)})))}});return i.addChild(t),i.addChild(e),i}(),k=new tt({enemyArgs:[{etype:"blcat",scoreAmt:1,curHealth:3,maxHealth:3,damage:1,level:1,speed:15,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:C[1].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=E(this.world,H.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}},{etype:"brcat",scoreAmt:2,curHealth:8,maxHealth:8,damage:1,level:1,speed:15,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:C[2].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=E(this.world,H.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}},{etype:"ninja",scoreAmt:3,curHealth:10,maxHealth:10,damage:2,level:1,speed:20,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:C[3].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=E(this.world,H.world),e=L(this.world,H.world),i=Y(t,Math.PI/4*Math.min(1,e/150));return this.dx=i.x*this.speed,this.dy=i.y*this.speed,!0}},{etype:"floaty",scoreAmt:3,curHealth:15,maxHealth:15,damage:3,level:1,speed:21,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:C[4].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=E(this.world,H.world),e=function(t){return{x:-t.y,y:t.x}}(t);return e.x*=Math.sin(b*Math.PI),e.y*=Math.sin(b*Math.PI),this.dx=(2*t.x/3+e.x/3)*this.speed,this.dy=(2*t.y/3+e.y/3)*this.speed,!0}}],bossArgs:{etype:"bigcat",scoreAmt:13e3,curHealth:1e3,maxHealth:1e3,damage:2,level:1,speed:12,hurtWidth:21,hurtHeight:21,anchor:{x:.5,y:.5},scaleX:3,scaleY:3,animations:C[1].animations,createDropItem:z,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=E(this.world,H.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}}});let t=_.background;b=0,(R=new F({audio:t,speedCheck:0,maxAudioSpeed:5,_oldk:{},update:function(t){if(H.curHealth<=0)return this.audio.pause(),!this._playedgover&&_.gover.play()&&(this._playedgover=!0),void this.updateGameOver(t);if(S)return this.audio.pause(),!this._playedgover&&_.gwin.play()&&(this._playedgover=!0),void this.updateGameOver(t);let e=l("KeyM");if(this._oldk.m&&!e&&(this.audio.paused?this.audio.play():this.audio.pause()),this._oldk.m=e,b+=t,A.update(t),j.update(t),this.speedCheck-=t,this.speedCheck<=0){this.speedCheck=5;let t=.75+.25*Math.abs(Math.sin(.5*b));this.audio.playbackRate=Math.max(.35,k.getEnemies().length/k.maxEnemies*this.maxAudioSpeed*t)}let i=Math.round(Math.max(0,5-b)/5*255);this.titleColor="#000000"+i.toString(16).padStart(2,"0")},updateGameOver:function(t){let e=l("Space");this._oldk.p&&!e&&this.reset(),this._oldk.p=e,this.titleColor="black"},reset:function(){S=!1,this._playedgover=!1,b=0,j.reset(),k.reset(),this.speedCheck=0,H.reset(),H.x=50,H.y=50,H.addItem(T.pew()),A.reset(),A.addChild(H),A.addChild(k),this.audio.tryplay()},renderInside:function(){r.save(),A.render(),I("score: "+H.score,{x:h.width/6/2-20,y:8},"8px serif"),I("x: "+Math.round(H.world.x)+", y: "+Math.round(H.world.y),{x:0,y:8},"5px serif"),j.render(),S?(r.fillStyle="#44a35455",r.fillRect(0,0,h.width,h.height),r.fillStyle="#000000",I("You Win",{x:h.width/6/2-42,y:h.height/6/2},"16px serif"),I("<Space> to Restart",{x:h.width/6/2-75,y:h.height/6/2+16},"16px serif")):H.curHealth<=0&&(r.fillStyle="#a3464455",r.fillRect(0,0,h.width,h.height),r.fillStyle="#000000",I("Game Over",{x:h.width/6/2-45,y:h.height/6/2},"16px serif"),I("<Space> to Restart",{x:h.width/6/2-75,y:h.height/6/2+16},"16px serif")),r.fillStyle=this.titleColor,I("Black Cat Survivor",{x:h.width/6/2-75,y:h.height/6/2-16},"16px serif"),r.fillStyle="#000000",r.restore()}})).reset(),R.start()}()})</script>