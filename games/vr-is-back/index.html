<!doctype html><title>Virtual Reality is back</title><style>body{overflow:hidden;margin:0}</style><body><script src=/2019/webxr/three.js></script><script>THREE.WEBVR={createButton:function(e,t){function n(t){l.style.display="",l.style.cursor="pointer",l.style.left="calc(50% - 50px)",l.style.width="100px",l.textContent="ENTER VR",l.onmouseenter=function(){l.style.opacity="1.0"},l.onmouseleave=function(){l.style.opacity="0.5"},l.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.domElement}])},e.vr.setDevice(t)}function s(){l.style.display="",l.style.cursor="auto",l.style.left="calc(50% - 75px)",l.style.width="150px",l.onmouseenter=null,l.onmouseleave=null,l.onclick=null,l.textContent="NO VR",e.vr.setDevice(null)}function o(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if(t&&t.referenceSpaceType&&e.vr.setReferenceSpaceType(t.referenceSpaceType),"getVRDisplays"in navigator){var l=document.createElement("button");return l.style.display="none",o(l),window.addEventListener("vrdisplayconnect",(function(e){n(e.display)}),!1),window.addEventListener("vrdisplaydisconnect",(function(){s()}),!1),window.addEventListener("vrdisplaypresentchange",(function(e){l.textContent=e.display.isPresenting?"EXIT":"VR"}),!1),window.addEventListener("vrdisplayactivate",(function(t){t.display.requestPresent([{source:e.domElement}])}),!1),navigator.getVRDisplays().then((function(e){e.length>0?n(e[0]):s()})).catch(s),l}var i=document.createElement("a");return i.href="https://webvr.info",i.innerHTML="NO WEBVR",i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",o(i),i}}</script><script>function SfxrParams(){this.setSettings=function(r){for(var a=0;a<24;a++)this[String.fromCharCode(97+a)]=r[a]||0;this.c<.01&&(this.c=.01);var t=this.b+this.c+this.e;if(t<.18){var e=.18/t;this.b*=e,this.c*=e,this.e*=e}}}function SfxrSynth(){var r,a,t,e,s,n,i,h,f,c,o,v;this._params=new SfxrParams,this.reset=function(){var r=this._params;e=100/(r.f*r.f+.001),s=100/(r.g*r.g+.001),n=1-r.h*r.h*r.h*.01,i=-r.i*r.i*r.i*1e-6,r.a||(o=.5-r.n/2,v=5e-5*-r.o),h=1+r.l*r.l*(r.l>0?-.9:10),f=0,c=1==r.m?0:(1-r.m)*(1-r.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return r=e.b*e.b*1e5,a=e.c*e.c*1e5,t=e.e*e.e*1e5+12,3*((r+a+t)/3|0)},this.synthWave=function(u,b){var w=this._params,m=1!=w.s||w.v,y=w.v*w.v*.1,g=1+3e-4*w.w,k=w.s*w.s*w.s*.1,S=1+1e-4*w.t,l=1!=w.s,p=w.x*w.x,d=w.g,x=w.q||w.r,A=w.r*w.r*w.r*.2,q=w.q*w.q*(w.q<0?-1020:1020),M=w.p?32+((1-w.p)*(1-w.p)*2e4|0):0,_=w.d,U=w.j/2,j=w.k*w.k*.01,C=w.a,P=r,R=1/r,W=1/a,z=1/t,B=5/(1+w.u*w.u*20)*(.01+k);B>.8&&(B=.8),B=1-B;for(var D,E,F,G,H,I,J=!1,K=0,L=0,N=0,O=0,Q=0,T=0,V=0,X=0,Y=0,Z=0,$=new Array(1024),rr=new Array(32),ar=$.length;ar--;)$[ar]=0;for(ar=rr.length;ar--;)rr[ar]=2*Math.random()-1;for(ar=0;ar<b;ar++){if(J)return ar;if(M&&++Y>=M&&(Y=0,this.reset()),c&&++f>=c&&(c=0,e*=h),(e*=n+=i)>s&&(e=s,d>0&&(J=!0)),E=e,U>0&&(Z+=j,E*=1+Math.sin(Z)*U),(E|=0)<8&&(E=8),C||((o+=v)<0?o=0:o>.5&&(o=.5)),++L>P)switch(L=0,++K){case 1:P=a;break;case 2:P=t}switch(K){case 0:N=L*R;break;case 1:N=1+2*(1-L*W)*_;break;case 2:N=1-L*z;break;case 3:N=0,J=!0}x&&((F=0|(q+=A))<0?F=-F:F>1023&&(F=1023)),m&&g&&((y*=g)<1e-5?y=1e-5:y>.1&&(y=.1)),I=0;for(var tr=8;tr--;){if(++V>=E&&(V%=E,3==C))for(var er=rr.length;er--;)rr[er]=2*Math.random()-1;switch(C){case 0:H=V/E<o?.5:-.5;break;case 1:H=1-V/E*2;break;case 2:H=.225*(((H=1.27323954*(G=6.28318531*((G=V/E)>.5?G-1:G))+.405284735*G*G*(G<0?1:-1))<0?-1:1)*H*H-H)+H;break;case 3:H=rr[Math.abs(32*V/E|0)]}m&&(D=T,(k*=S)<0?k=0:k>.1&&(k=.1),l?(Q+=(H-T)*k,Q*=B):(T=H,Q=0),O+=(T+=Q)-D,H=O*=1-y),x&&($[X%1024]=H,H+=$[(X-F+1024)%1024],X++),I+=H}I*=.125*N*p,u[ar]=I>=1?32767:I<=-1?-32768:32767*I|0}return b}}var synth=new SfxrSynth;window.jsfxr=function(r){synth._params.setSettings(r);var a=synth.totalReset(),t=new Uint8Array(4*((a+1)/2|0)+44),e=2*synth.synthWave(new Uint16Array(t.buffer,44),a),s=new Uint32Array(t.buffer,0,44);s[0]=1179011410,s[1]=e+36,s[2]=1163280727,s[3]=544501094,s[4]=16,s[5]=65537,s[6]=44100,s[7]=88200,s[8]=1048578,s[9]=1635017060,s[10]=e,e+=44;for(var n=0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";n<e;n+=3){var f=t[n]<<16|t[n+1]<<8|t[n+2];h+=i[f>>18]+i[f>>12&63]+i[f>>6&63]+i[63&f]}return h}</script><script>var c1,c2,a,b,c,f,g,l,m,n,o,p,s,t,u,v,w,x,y,z,i,j,k,dv=document.createElement("div"),re=new THREE.WebGLRenderer({antialias:!0}),e=re.domElement,sin=Math.sin,cos=Math.cos,floor=Math.floor,min=Math.min,max=Math.max,sqrt=Math.sqrt,abs=Math.abs,pow=Math.pow;re.setPixelRatio(window.devicePixelRatio),re.setSize(window.innerWidth,window.innerHeight),re.vr.enabled=!0,dv.appendChild(e),document.body.appendChild(dv),window.addEventListener("resize",(()=>{ca.aspect=window.innerWidth/window.innerHeight,ca.updateProjectionMatrix(),re.setSize(window.innerWidth,window.innerHeight)}),!1),window.addEventListener("vrdisplaypointerrestricted",(()=>{e&&"function"==typeof e.requestPointerLock&&e.requestPointerLock()}),!1),window.addEventListener("vrdisplaypointerunrestricted",(()=>{(p=document.pointerLockElement)&&p===e&&"function"==typeof document.exitPointerLock&&document.exitPointerLock()}),!1),document.body.appendChild(THREE.WEBVR.createButton(re));var sndSta=jsfxr([0,,.097,.536,.467,.528,,,,,,.543,.641,,,,,,1,,,,,.3]),sndLow=jsfxr([3,,.368,.203,.184,.133,,-.397,,,,,,,,,.426,-.116,1,,,,,.3]),sndMed=jsfxr([3,,.385,.505,.329,.116,,-.241,,,,,,,,,,,1,,,,,.3]),sndHig=jsfxr([3,,.311,.798,.399,.126,,.215,,,,,,,,,,,1,,,,,.3]),sndMul=jsfxr([1,,.086,.4,.312,.466,,.484,,,,,,,,.659,,,1,,,,,.4]),sndMis=jsfxr([3,.9,.2,.163,.223,.5,0,.8,.55,.1,0,-.7,-.65,.5,.4,.4,-.75,.4,.8,-.5,.8,.45,-.35,.4]);function ply(e){var t=new Audio;t.src=e,t.play(),t.addEventListener("ended",(function(e){url.revokeObjectURL(t.src)}),!1)}var seed=function(e){return function(t,o){return e=1e4*sin(e),(.5*sin(e)+.5)*(o-t)+t}};function rnd(e,t){return lerp(Math.random(),e,t)}function lerp(e,t,o){return(o-t)*min(max(e,0),1)+t}function rot(e,t,o,i){var s=cos(a),n=sin(a);return new THREE.Vector3(s*t-n*i,o,n*t+s*i)}function centroid(e,t){for(p of(c=new THREE.Vector3(0,0,0),e))c.x+=p.x,c.y+=p.y,c.z+=p.z;return t/=e.length,c.x*=t,c.y*=t,c.z*=t,c}function geom(e,t){return t.c?(m=new THREE.MeshPhongMaterial({color:t.c,flatShading:!0,polygonOffset:!1,polygonOffsetFactor:.1,polygonOffsetUnits:.1}),o=new THREE.Mesh(e,m),t.w&&(o.wire=new THREE.LineSegments(new THREE.EdgesGeometry(e),new THREE.LineBasicMaterial({color:t.w,linewidth:2})),o.add(o.wire))):o=new THREE.LineSegments(new THREE.EdgesGeometry(e),new THREE.LineBasicMaterial({color:t.w,linewidth:2})),void 0!==t.x&&o.position.set(t.x,t.y,t.z),void 0!==t.i&&o.rotation.set(t.i,t.j,t.k),o}function cube(e,t){return geom(new THREE.CubeGeometry(e,e,e),t)}function logo(){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=1024,e.height=256,i.shadowBlur=10,i.shadowColor="black",i.shadowOffsetX=3,i.shadowOffsetY=3,(g=i.createLinearGradient(0,0,0,e.height)).addColorStop(.09,"#40c4c9"),g.addColorStop(.16,"#ffffff"),g.addColorStop(.17,"#444444"),g.addColorStop(.25,"#f157cb"),g.addColorStop(.27,"#fbc3ff"),i.font="Bold 72px Verdana",i.strokeStyle="white",i.fillStyle=g,i.lineWidth=3,t="VIRTUAL REALITY",i.strokeText(t,135,70),i.fillText(t,135,70),i.rotate(-.25),(g=i.createLinearGradient(0,0,2.2*e.width,3*e.height)).addColorStop(.51,"#ffffff"),g.addColorStop(.62,"#ffffff"),i.font="64px Courier New",i.fillStyle=g,i.strokeStyle="black",i.lineWidth=3,i.textDecoration="underline overline",i.strokeText("is back",640,300),i.fillText("is back",640,300),(t=new THREE.Texture(e)).needsUpdate=!0,o=new THREE.Mesh(new THREE.PlaneGeometry(7,1.75,1,1),new THREE.MeshBasicMaterial({map:t,transparent:!0}))}function stini(e,i,s,n){var r=document.createElement("canvas"),a=r.getContext("2d");return r.width=e,r.height=i,a.font=n,a.strokeStyle="black",a.textAlign="center",a.fillStyle="white",a.shadowBlur=5,a.shadowColor="black",a.shadowOffsetX=1,a.shadowOffsetY=1,t=new THREE.Texture(r),(o=new THREE.Mesh(new THREE.PlaneGeometry(e/128,i/128,1,1),new THREE.MeshBasicMaterial({map:t,transparent:!0}))).can=r,o.ctx=a,o.tex=t,o.siz=s,o}function stset(e,t){e.ctx.clearRect(0,0,e.can.width,e.can.height),e.ctx.fillText(t,e.can.width/2,.8*e.can.height),e.tex.needsUpdate=!0}function pincheit(e){var t=[],o=[],s=[];for(i=0;i<e.faces.length;i++){n=o.length,f=e.faces[i];var r=e.vertices[f.a],a=e.vertices[f.b],c=e.vertices[f.c];o.push(r.clone(),a.clone(),c.clone(),centroid([r,a,c],3*i%4==0?2.5:1)),f.a=n,f.b=n+1,f.c=n+2;var d=(new THREE.Face3).copy(f),l=(new THREE.Face3).copy(f),p=(new THREE.Face3).copy(f);d.a=n+3,l.b=n+3,p.c=n+3,t.push(d,l,p),w=[e.faceVertexUvs[0][i][0],e.faceVertexUvs[0][i][1],e.faceVertexUvs[0][i][2]],s.push(w,w,w)}return e.vertices=o,e.vertices[o.length-1]=new THREE.Vector3(0,0,0),e.faces=t,e.faceVertexUvs[0]=s,e}function pinchos(){var e=new THREE.Object3D;return(o=geom(new THREE.CylinderBufferGeometry(.01,.01,.5,7,4),{c:2139305,w:4232345})).position.set(0,.06,0),o.updateMatrix(),e.add(o),(o=geom(pincheit(new THREE.IcosahedronGeometry(.08,1)),{c:2139305,w:4232345})).position.set(0,.35,0),o.updateMatrix(),o.geometry.computeVertexNormals(),e.add(o),e.rotation.set(-.8,0,0),e.pivot=o,e}function dist(e,t){return x=e.x-t.x,y=e.y-t.y,z=e.z-t.z,sqrt(x*x+y*y+z*z)}function avgvel(){var e={v:[],i:0};for(i=0;i<20;i++)e.v.push(0);return e.add=t=>{var o=0;for(e.old?o=abs(e.old.set(t.x-e.old.x,t.y-e.old.y,t.z-e.old.z).length()):e.old=new THREE.Vector3,e.old.set(t.x,t.y,t.z),e.v[e.i]=o,e.i=(e.i+1)%20,e.vel=0,i=0;i<20;i++)e.vel+=e.v[i];e.vel*=5},e}function onSta(){this.userData.isSelecting=!0}function onEnd(){this.userData.isSelecting=!1}function controllers(){var e=pinchos(),t=pinchos();(c1=re.vr.getController(0)).userData.id=0,c1.pivot=e.pivot,c1.pos=new THREE.Vector3,c1.avgvel=avgvel(),c1.addEventListener("selectstart",onSta),c1.addEventListener("selectend",onEnd),c1.add(e),sc.add(c1),(c2=re.vr.getController(1)).userData.id=1,c2.pivot=t.pivot,c2.pos=new THREE.Vector3,c2.avgvel=avgvel(),c2.addEventListener("selectstart",onSta),c2.addEventListener("selectend",onEnd),c2.add(t),sc.add(c2)}var cl=new THREE.Clock,sc=new THREE.Scene,ca=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,1e4);sc.background=new THREE.Color(3089227),sc.add(ca),(l=new THREE.HemisphereLight(16777215,2036539,1.5)).position.set(0,.2,-1).normalize(),sc.add(l);var ga=(g=new THREE.IcosahedronBufferGeometry(200,3)).attributes,gp=ga.position;for(g.addAttribute("color",new THREE.BufferAttribute(new Float32Array(3*gp.count),3)),i=0;i<gp.count;i++)ga.color.setXYZ(i,1,gp.getY(i)/200+.7,.5);for((o=new THREE.Mesh(g,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}))).position.set(0,150,-1e3),sc.add(o),gp=(ga=(g=new THREE.BoxBufferGeometry(5e3,300,5)).attributes).position,g.addAttribute("color",new THREE.BufferAttribute(new Float32Array(3*gp.count),3)),i=0;i<gp.count;i++)y=gp.getY(i)/300+.7,ga.color.setXYZ(i,lerp(y,1,.18),lerp(y,.04,.14),lerp(y,.5,.3));(o=new THREE.Mesh(g,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}))).position.set(0,100,-1e3),sc.add(o);var ve=[],co=[],vf=[],py=[];for(i=0;i<=100;i++)for(j=0;j<100;j++)py.push(rnd(0,2)-20+30*cos(i/20+.6)+(100-j)/2+1.5*cos(i/4.7)+2*cos(j/3.5));for(i=30;i<70;i++)for(j=20;j<60;j++)y=py[k=j+100*i],s=py[k+1],t=py[k+100],u=py[k+101],n=15*i-750,w=(1-(m=15*j-750))/400+.3,ve.push(n,y,m),ve.push(n,s,m+15),co.push(w,.1,.8-w/4),co.push(w,.1,.8-w/4),ve.push(n,y,m),ve.push(n+15,t,m),co.push(w,.1,.8-w/4),co.push(w,.1,.8-w/4),vf.push(n,y-.1,m),vf.push(n,s-.1,m+15),vf.push(n+15,u-.1,m+15),vf.push(n,y-.1,m),vf.push(n+15,u-.1,m+15),vf.push(n+15,t-.1,m);(g=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(ve,3)),g.addAttribute("color",new THREE.Float32BufferAttribute(co,3)),g.v=ve,g.c=co,o=new THREE.LineSegments(g,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors})),sc.add(o),(g=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(vf,3)),o=new THREE.Mesh(g,new THREE.MeshLambertMaterial({flatShading:!0})),sc.add(o);var ob=new THREE.Geometry,ornd=seed(5);for(n=150,i=0;i<n;i++)j=abs(k=i*(w=500)*2/n-w),s=ornd(25,35+abs(k)/10),z=ornd(-400,-650)+j/2,(o=new THREE.Mesh(new THREE.CubeGeometry(s,s,s))).position.set(k,ornd(0,40)+j/4-z/5-160,z),o.rotation.set(0,ornd(.2,5),ornd(2,2.5)),o.updateMatrix(),ob.merge(o.geometry,o.matrix);for(sc.add(geom((new THREE.BufferGeometry).fromGeometry(ob),{c:3089227,w:15875210})),g=new THREE.Geometry,i=0;i<4e3;i++)r=1e3,a=rnd(0,6.28),b=rnd(0,6.28),v=new THREE.Vector3(r*cos(a)*sin(b),r*sin(a)*sin(b),r*cos(b)),g.vertices.push(v);ob=new THREE.Points(g,new THREE.PointsMaterial({size:.1,color:13421772})),sc.add(ob),controllers();var stlog=logo();stlog.position.set(0,3.7,-6),sc.add(stlog);var stinf=stini(512,64,40,"20px Courier New");stinf.position.set(0,.2,-6),sc.add(stinf),stset(stinf,"A 8k WebVR game by @jordi_ros");var ststa=stini(512,64,40,"40px Tahoma");ststa.position.set(0,2.2,-6),sc.add(ststa),stset(ststa,"Press trigger to start");var stsco=stini(512,64,40,"Bold 40px Tahoma");stsco.position.set(-3,2.7,-6),stsco.rotation.set(0,.6,0),sc.add(stsco);var stend=stini(512,64,48,"Bold 48px Tahoma");stend.position.set(0,2.7,-6),sc.add(stend);var stmul=stini(512,64,32,"32px Tahoma");stmul.position.set(-3,2.4,-5.9),stmul.rotation.set(0,.6,0),sc.add(stmul);var stmis=stini(512,64,40,"Bold 40px Tahoma");stmis.position.set(3,2.7,-6),stmis.rotation.set(0,-.6,0),sc.add(stmis),stset(stmis,"MISS!");var life,diff,score,multi,tmulti,tmiss,addtime,cobj=[],pobj=[],pexp=[],time=0,de=0,state=0;for(i=0;i<80;i++)ob=cube(.3,{c:2139305,w:2139305}),pobj.push(ob),sc.add(ob),ob.visible=!1;for(i=0;i<300;i++)ob=cube(1,{c:1,w:1}),pexp.push(ob),sc.add(ob),ob.visible=!1;function cadd(){for(ob=null,i=0;i<pobj.length;i++)if(!pobj[i].visible){(ob=pobj[i]).visible=!0;break}ob&&(a=rnd(-.4,.4),v=rot(a,rnd(-1,1)*lerp(diff,.9,1.2),rnd(1,2.2),lerp(diff,-30,-18)),ob.position.set(v.x,v.y,v.z),ob.vel=rot(a,0,0,lerp(diff,12,25)),ob.tposy=0,ob.posy=v.y,sc.add(ob),cobj.push(ob))}function cexp(e,t,o){for(1==state&&(life=min(1,life+(t>.8?.05:t>.5?.02:.01)),score+=floor(t>.8?150*t:100*t)*floor(multi)*10,m=min(8,multi+.25*t),floor(m)>floor(multi)&&(tmulti=time,ply(sndMul)),multi=m,ply(t>.8?sndHig:t>.5?sndMed:sndLow)),p=e.position,n=floor(t>.8?15:t>.5?8:3),cdel(e),j=0;j<n;j++){for(e=null,i=0;i<pexp.length;i++)if(!pexp[i].visible){(e=pexp[i]).visile=!0;break}if(!e)return;s=rnd(lerp(t,.35,.08),lerp(t,.4,.13)),e.position.set(p.x,p.y,p.z),e.scale.set(s,s,s),e.sc=s,e.sd=rnd(.7,1.3),e.sx=rnd(-4,4)*lerp(t,.2,1),e.sz=rnd(-12,-4)*lerp(t,.4,1),e.sy=rnd(-3,5)*lerp(t,.2,1),e.vel=t,e.visible=!0,cobj.push(e)}}function cmis(e){1==state&&(life-=.15,tmiss=time,tmulti=multi>=2?time:-1,multi=1,ply(sndMis)),cdel(e)}function cdel(e){cobj.splice(cobj.indexOf(e),1),e.visible=!1}function cupd(){for(o of cobj)if(o.tposy+=2*de,void 0===o.sx){if(o.rotation.z+=1.26*de,o.rotation.x+=.78*de,o.rotation.y+=1.92*de,o.position.x+=de*o.vel.x,o.position.y=lerp(Math.pow(1.5*o.tposy,2),-1,o.posy),o.position.z+=de*o.vel.z,1==state){var e,t=0;c1&&c2?(dist(o.position,c1.pos)<.6&&(t=min(c1.avgvel.vel,10)/10,e=c1),dist(o.position,c2.pos)<.6&&(t=min(c2.avgvel.vel,10)/10,e=c2)):o.position.z>-3&&(rnd(0,1)<lerp(diff,.95,.3)?t=rnd(.05,1):cmis(o)),t>0&&cexp(o,t,e)}o.position.z>1&&cmis(o)}else{s=o.sd*o.sc,o.rotation.z+=1.76*de,o.rotation.x+=2.18*de,o.rotation.y+=2.42*de,o.position.x+=de*o.sx,o.position.y+=de*o.sy,o.position.z+=de*o.sz,o.scale.set(s,s,s),s=pow(o.sd,4);var i=o.vel>.8?1:.14,n=o.vel>.8?1:.74,r=o.vel>.8?1:.76;f=o.vel>.8?1.2:.7,v=o.vel>.8?1.2:1,o.material.color.setRGB(lerp(s,1,i)*f,lerp(s,.05,n)*f,lerp(s,.5,r)*f),o.wire.material.color.setRGB(lerp(s,1,i)*v,lerp(s,.05,n)*v,lerp(s,.5,r)*v),o.sy-=9.8*de,o.sd-=de,o.sd<.1&&cdel(o)}}function menu(){stlog.visible=!0,ststa.visible=!0,stinf.visible=!0,stend.visible=!1,stsco.visible=!1,stmul.visible=!1,stmis.visible=!1,ststa.material.opacity=.6+.4*sin(.005*(new Date).getTime()),(c1&&c1.userData.isSelecting||c2&&c2.userData.isSelecting||!c1&&!c2&&time>5)&&(time=0,state=1,life=.5,diff=0,score=0,multi=1,tmulti=-1,tmiss=-1,addtime=1,stlog.visible=!1,ststa.visible=!1,stinf.visible=!1,ply(sndSta))}function game(){stsco.visible=!0,stset(stsco,score),stmul.visible=!0,stset(stmul,"x"+floor(multi)),s=lerp(3*(time-tmulti),1.5,1),stmul.scale.set(s,s,s),stmis.visible=time-tmiss<1,stmis.material.opacity=lerp(2*(time-tmiss-.5),1,0),s=lerp(3*(time-tmiss),1.5,1),stmis.scale.set(s,s,s),addtime+=de,diff=min(1,time/120),addtime>0&&(cadd(),addtime=rnd(lerp(diff,-.4,-.2),lerp(diff,-1,-.35))),c1&&c2&&(c1.pivot.getWorldPosition(c1.pos)&&c1.avgvel.add(c1.pos),c2.pivot.getWorldPosition(c2.pos)&&c2.avgvel.add(c2.pos)),cupd(),life<0&&(state=2,time=0)}function end(){stlog.visible=!1,ststa.visible=!0,stend.visible=!0,stsco.visible=!1,stmul.visible=!1,stmis.visible=!1,ststa.material.opacity=1,stset(ststa,"GAME OVER"),stset(stend,score),cupd(),(c1&&c1.userData.isSelecting||c2&&c2.userData.isSelecting||!c1&&!c2&&time>5)&&(state=0)}function loop(){switch(de=min(cl.getDelta(),.05),time+=de,state){case 0:menu();break;case 1:game();break;case 2:end()}re.render(sc,ca)}re.setAnimationLoop(loop)</script>