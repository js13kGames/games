<!doctype html><meta name=viewport content="width=device-width"><title>The Black Cross Cat - js13kGames</title><style>body{margin:0;padding:0;background:#000;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:Arial,sans-serif}#game-container{position:relative}#game{background:#111;cursor:pointer}.loading{color:#fff;font-size:18px;text-align:center}</style><div id=game-container><canvas id=game width=800 height=600></canvas></div><script>var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class i{constructor(){this.currentState="menu",this.level=1,this.score=0,this.catLives=9,this.playerLives=1,this.carIndexCompleted=[],this.activePenalties=[]}setState(t){this.currentState=t}isState(t){return this.currentState===t}addPenalty(t,e){this.activePenalties.push({id:t,penalty:e})}removePenalty(t){this.activePenalties=this.activePenalties.filter(e=>e.id!==t)}nextLevel(){this.level++,this.setState("playing")}resetLevel(){this.setState("playing")}gameOver(){this.setState("gameOver")}loseLife(){this.playerLives--,this.playerLives<=0&&this.gameOver()}getRoadsCount(){return this.level<=3?this.level+1:this.level}getCatSpeed(){return 100+(this.level<2?10*this.level:20*this.level)}}const s=94,h=84,a=["invert","brake","badLuckCat"],n={invert:"purple",brake:"red",badLuckCat:"black"},r=[2,2,2,3,3,3,3,3,4],l=class t{constructor(e,i,s,a,n,r,l,o=null){this.gameState=e,this.x=i,this.y=s,this.width=n,this.height=r,this.index=l,this.speed=this.gameState.getCatSpeed(),this.path=o,this.currentWaypoint=0,this.forwardPath=null,this.vx=0,this.vy=0,t.image||(t.image=new Image,t.image.src=a,t.image.onload=()=>t.imageLoaded=!0),this.hasBeenHit=!1,this.hitTimer=0,this.resurrectionProgress=0,this.bloodSplashes=[],this.facingLeft=!1,this.directionTimer=0,this.spriteWidth=h,this.spriteHeight=98,this.currentFrame=0,this.frameCount=2,this.frameTimer=0,this.frameInterval=.2}hit(){this.hasBeenHit||(this.hasBeenHit=!0,this.hitTimer=2,this.createHitBloodSplashes())}createHitBloodSplashes(){for(let t=0;t<25;t++){const t=2*Math.random()*Math.PI,e=120*Math.random()+60;this.bloodSplashes.push({x:this.x+this.width/2,y:this.y+this.height/2,vx:Math.cos(t)*e,vy:Math.sin(t)*e,life:.4+.3*Math.random(),size:Math.floor(3*Math.random())+2})}}updateBloodSplashes(t){this.bloodSplashes=this.bloodSplashes.filter(e=>(e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t,e.life>0))}renderBloodSplashes(t){t.fillStyle="rgba(180,0,0,0.9)",this.bloodSplashes.forEach(e=>{t.fillRect(Math.floor(e.x),Math.floor(e.y),e.size,e.size)})}update(t,e,i){if(this.updateBloodSplashes(t),this.hasBeenHit){if(this.resurrectionProgress+=t/2,this.resurrectionProgress>1&&(this.resurrectionProgress=1),this.hitTimer-=t,!(this.hitTimer<=0))return;this.hasBeenHit=!1,this.resurrectionProgress=0}this.randomMove(t,e,i)}updateFrame(t){0!==this.speed?(this.frameTimer+=t,this.frameTimer>=this.frameInterval&&(this.frameTimer=0,this.currentFrame=(this.currentFrame+1)%this.frameCount)):this.currentFrame=0}getRandomMoveArea(t,e,i){return{minX:i,minY:0,maxX:t-i-this.width,maxY:e}}randomMove(t,e,i,s=94){const{minX:h,minY:a,maxX:n,maxY:r}=this.getRandomMoveArea(e,i,s);if(this.directionTimer-=t,this.directionTimer<=0){let t=(Math.atan2(this.vy,this.vx)||0)+(Math.random()-.5);const s=(this.x-e/2)/e,h=(this.y-i/2)/i;t=Math.atan2(-h+(Math.random()-.5),-s+(Math.random()-.5)),this.vx=Math.cos(t)*this.speed,this.vy=Math.sin(t)*this.speed,this.directionTimer=2+4*Math.random()}this.x+=this.vx*t,this.y+=this.vy*t,this.x<h&&(this.x=h,this.vx*=.5*(Math.random()-.5)-1),this.x>n&&(this.x=n,this.vx*=.5*(Math.random()-.5)-1),this.y<a&&(this.y=a,this.vy*=.5*(Math.random()-.5)-1),this.y+this.height>r&&(this.y=r-this.height,this.vy*=.5*(Math.random()-.5)-1),this.facingLeft=this.vx<0}checkCollision(t){return!t.isSafe&&this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}render(e){if(!t.imageLoaded)return;this.renderBloodSplashes(e);const i=this.currentFrame*this.spriteWidth;if(this.hasBeenHit&&this.resurrectionProgress<1){e.fillStyle="rgba(180, 0, 0, 0.8)",e.beginPath(),e.ellipse(this.x+this.width/2,this.y+this.height/2,this.width/2,this.height/3,.2*Math.random()-.1,0,2*Math.PI),e.fill();for(let t=0;t<3;t++){const t=(Math.random()-.5)*this.width*.6,i=(Math.random()-.5)*this.height*.6,s=Math.random()*this.width*.15+2,h=Math.random()*this.height*.1+2;e.beginPath(),e.ellipse(this.x+this.width/2+t,this.y+this.height/2+i,s,h,0,0,2*Math.PI),e.fill()}e.save();const s=this.y+this.height/2,h=this.height/2,a=.2*Math.sin(this.resurrectionProgress*Math.PI),n=h*this.resurrectionProgress*(1+a);e.beginPath(),e.rect(this.x,s-n,this.width,n),e.clip();const r=h*(1-this.resurrectionProgress)*(1-a);e.drawImage(t.image,i,0,this.spriteWidth,this.spriteHeight,this.x,this.y+r,this.width,this.height),e.restore()}else e.save(),this.facingLeft?(e.translate(this.x+this.width/2,this.y+this.height/2),e.scale(-1,1),e.drawImage(t.image,i,0,this.spriteWidth,this.spriteHeight,-this.width/2,-this.height/2,this.width,this.height)):e.drawImage(t.image,i,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height),e.restore()}};e(l,"image",null),e(l,"imageLoaded",!1);let o=l;const c=class t{constructor(e,i,h,a,n=100,r=50,l=0,o=0,c){this.gameState=e,this.x=i,this.y=h,this.width=n,this.height=r,this.baseY=h,this.baseWidth=n,this.baseHeight=r,this.speed=0,this.maxSpeed=250,this.baseMaxSpeed=this.maxSpeed,this.acceleration=800,this.friction=600,this.targetX=l,this.targetY=o,this.isSafe=!1,this.i=c,this.facingLeft=this.targetX<this.x,this.movingDirection=0,this.penalty=null,this.penaltyTime=0,this.lastHitTime=0,this.hitCooldown=.5,this.particles=[],t.image||(t.image=new Image,t.image.src=a,t.image.onload=()=>t.imageLoaded=!0),this.knockback=null,this.lightningParticles=[],this.spriteWidth=s,this.spriteHeight=60,this.currentFrame=0,this.frameCount=2,this.frameTimer=0,this.frameInterval=.2,this.reset()}reset(){this.isSafe=!1}applyPenalty(t=null){if(t)this.penalty=t,this.penaltyTime=180,this.gameState.removePenalty(this.i),this.gameState.addPenalty(this.i,this.penalty);else{const t=Math.floor(Math.random()*a.length);this.penalty===a[t]?this.penaltyTime+=120:(this.penalty=a[t],this.penaltyTime=180,this.gameState.removePenalty(this.i),this.gameState.addPenalty(this.i,this.penalty))}}runPenaltyEffect(t){switch(this.penalty){case"invert":-1===this.movingDirection?this.movingDirection=1:1===this.movingDirection&&(this.movingDirection=-1);break;case"brake":Math.random()<.05&&(this.speed=0);break;case"badLuckCat":this.maxSpeed=150,this.speed*=.5}}resetPenalty(){this.penalty=null,this.width=this.baseWidth,this.height=this.baseHeight,this.maxSpeed=this.baseMaxSpeed,this.y=this.baseY+(this.baseHeight-this.height),this.gameState.removePenalty(this.i)}update(t,e,i,s){this.isSafe||(this.updateParticles(t),this.updateLightningParticles(t),this.movingDirection=0,"left"===e?this.movingDirection=-1:"right"===e&&(this.movingDirection=1),this.penaltyTime>0?(this.penaltyTime-=60*t,this.runPenaltyEffect(t)):this.resetPenalty(),0!==this.movingDirection?(this.speed+=this.movingDirection*this.acceleration*t,this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed<-this.maxSpeed&&(this.speed=-this.maxSpeed)):this.completeSpeedDeceleration(t),this.manageKnockback(t),this.x+=this.speed*t,this.x<=this.targetX&&this.x+this.width>=this.targetX&&(this.resetPenalty(),this.x=this.targetX-this.width/2,this.isSafe=!0,this.gameState.carIndexCompleted.push(this.i),this.gameState.score=this.gameState.score+100-4*(9-this.gameState.catLives)),this.x<i&&(this.x=i,this.speed=0),this.x+this.width>s&&(this.x=s-this.width,this.speed=0),this.lastHitTime>0&&(this.lastHitTime-=t))}updateFrame(t){0!==this.speed?(this.frameTimer+=t,this.frameTimer>=this.frameInterval&&(this.frameTimer=0,this.currentFrame=(this.currentFrame+1)%this.frameCount)):this.currentFrame=0}manageKnockback(t){this.knockback&&(this.knockback.progress+=5*t,this.knockback.progress>=1&&(this.knockback.progress=1),this.x=this.knockback.startX+(this.knockback.targetX-this.knockback.startX)*this.knockback.progress,1===this.knockback.progress&&(this.knockback=null))}completeSpeedDeceleration(t){this.speed>0?(this.speed-=this.friction*t,this.speed<0&&(this.speed=0)):this.speed<0&&(this.speed+=this.friction*t,this.speed>0&&(this.speed=0))}render(e){if(t.imageLoaded){e.save();const i=this.currentFrame*this.spriteWidth,s=0;let h=0;0!==this.speed&&(h=1.5*(Math.random()-.5)),this.facingLeft?(e.translate(this.x+this.width/2,this.y+this.height/2+h),e.scale(-1,1),e.drawImage(t.image,i,s,this.spriteWidth,this.spriteHeight,-this.width/2,-this.height/2,this.width,this.height)):e.drawImage(t.image,i,s,this.spriteWidth,this.spriteHeight,this.x,this.y+h,this.width,this.height),e.restore(),this.renderPenaltyCloud(e),this.renderTarget(e),this.renderParticles(e)}}renderPenaltyCloud(t){if(!this.penalty)return;const e=Math.floor(this.x+this.width/2),i=Math.floor(this.y-32),s=Date.now()/400,h=2*Math.sin(s);t.save(),t.translate(e,i+h),t.fillStyle="#333",t.fillRect(-20,-8,40,16),t.fillRect(-12,-12,24,4),t.fillRect(8,-12,8,4),t.fillRect(-16,-12,8,4),t.fillRect(-24,-4,4,8),t.fillRect(20,-4,4,8),t.fillRect(-12,8,24,4);const a=n[this.penalty]||"yellow",r=Math.sin(Date.now()/200)>0?a:"yellow";t.fillStyle=r,t.fillRect(-4,-4,4,4),t.fillRect(0,-4,4,4),t.fillRect(0,0,4,4),t.fillRect(4,0,4,4),t.fillRect(4,4,4,4),t.fillRect(0,4,4,4),t.fillRect(0,8,4,4),Math.random()<.2&&this.lightningParticles.push({x:0+2*(Math.random()-.5),y:3,dy:.5+1*Math.random(),life:20+20*Math.random(),color:n[this.penalty]||"yellow"}),this.renderLightningParticles(t,0,0,4),t.restore()}setCarSpeed(t){this.speed=t}spawnExplosionParticles(t,e,i,s){for(let h=0;h<60;h++){const h=2*Math.random()*Math.PI,a=1.5*Math.random()+.5,n=40*Math.random()+40;this.particles.push({x:t+i/2,y:e+s/2,dx:Math.cos(h)*a,dy:Math.sin(h)*a,life:n,color:"red",size:3*Math.random()+2,drag:.92+.03*Math.random()})}}updateParticles(t){this.particles.forEach(e=>{e.x+=e.dx*t*60,e.y+=e.dy*t*60,e.dx*=e.drag,e.dy*=e.drag,e.life-=60*t}),this.particles=this.particles.filter(t=>t.life>0)}renderParticles(t){this.particles.forEach(e=>{t.globalAlpha=Math.max(0,e.life/60),t.fillStyle=e.color,t.fillRect(e.x-e.size/2,e.y-e.size/2,e.size,e.size)}),t.globalAlpha=1}updateLightningParticles(t){this.lightningParticles.forEach(e=>{e.y+=e.dy*t*60,e.life-=60*t}),this.lightningParticles=this.lightningParticles.filter(t=>t.life>0)}renderLightningParticles(t,e,i,s){this.lightningParticles.forEach(h=>{t.fillStyle=h.color,t.fillRect(e+h.x*s,i+h.y*s,s,s)})}renderTarget(t){if(this.isSafe)return;t.save(),t.translate(this.targetX,this.targetY);const e=Date.now()/200;for(let i=0;i<4;i++)for(let s=0;s<4;s++){t.fillStyle=(i+s)%2==0?"#fff":"#000";const h=3*Math.sin(e+.5*i+.3*s);t.fillRect(6*s-12+h,6*i-12,6,6)}t.restore()}onCarHitsCat(t,e,i,s){if(this.lastHitTime>0)return;this.gameState.catLives--,this.applyPenalty(),this.spawnExplosionParticles(t,e,i,s);const h=this.facingLeft?i:-i;this.knockback={startX:this.x,targetX:this.x+h,progress:0},this.lastHitTime=this.hitCooldown}isAtFinish(){return this.isSafe}};e(c,"image",null),e(c,"imageLoaded",!1);let d=c;class f{constructor(t){this.gameState=t,this.selectedCarIndex=0,this.keys={},this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",t=>{this.keys[t.code]=!0,this.handleKeyDown(t.code)}),document.addEventListener("keyup",t=>{this.keys[t.code]=!1,this.lastMoveDirection=null})}handleKeyDown(t){if(this.gameState.isState("playing"))switch(t){case"ArrowUp":this.selectPreviousCar();break;case"ArrowDown":this.selectNextCar();break;case"ArrowLeft":this.moveSelectedCarLeft();break;case"ArrowRight":this.moveSelectedCarRight()}}selectPreviousCar(){let t=this.selectedCarIndex-1;for(;t>=0;){if(!this.gameState.carIndexCompleted.includes(t))return void(this.selectedCarIndex=t);t--}}selectNextCar(){const t=this.gameState.getRoadsCount();let e=this.selectedCarIndex+1;for(;e<t;){if(!this.gameState.carIndexCompleted.includes(e))return void(this.selectedCarIndex=e);e++}}moveSelectedCarLeft(){this.lastMoveDirection="left"}moveSelectedCarRight(){this.lastMoveDirection="right"}getSelectedCarIndex(){return this.selectedCarIndex}getLastMoveDirection(){return this.lastMoveDirection}isKeyPressed(t){return this.keys[t]||!1}}class m{constructor(t,e,i,s,h,a){this.gameState=t,this.index=e,this.totalRoads=i,this.canvasWidth=s,this.canvasHeight=h,this.carHeight=a,this.selected=!1,this.completed=!1,this.height=this.canvasHeight/this.totalRoads,this.y=Math.floor(this.index*this.height),this.carY=h/i*e+h/i/2-a/2,this.createDirtyPixel()}getCarY(){return this.carY}getRoadCenter(){const t=this.canvasHeight/this.totalRoads;return Math.floor(this.index*t)+t/2}setSelected(t){this.selected=t}setCompleted(t){this.completed=t}createDirtyPixel(){this.dirtPixels=[];const t=Math.floor(this.canvasHeight/this.totalRoads);for(let e=0;e<80;e++)this.dirtPixels.push({x:Math.floor(Math.random()*this.canvasWidth),y:Math.floor(Math.random()*t),color:Math.random()>.5?"#636161ff":"#888686ff"})}render(t){const e=Math.floor(this.canvasHeight/this.totalRoads),i=Math.floor(this.index*e);let s=this.index%2==0?"#202020":"#252525",h=this.selected?"#6793a9ff":s;if(this.completed&&(h="#094b07ff"),t.fillStyle=h,t.fillRect(0,i,this.canvasWidth,e),!this.completed)for(const e of this.dirtPixels)t.fillStyle=e.color,t.fillRect(e.x,i+e.y,2,2);t.fillStyle=this.completed?"#ffffff":"#f5e663";const a=i+Math.floor(e/2)-1;for(let e=0;e<this.canvasWidth;e+=35)t.fillRect(e,a,20,3)}}let g,p,x=!1,u=0;function v(t,e,i,s="sine",h=.2){const a=g.createOscillator(),n=g.createGain();a.type=s,a.frequency.value=t,n.gain.setValueAtTime(h,g.currentTime+e),n.gain.exponentialRampToValueAtTime(.001,g.currentTime+e+i),a.connect(n).connect(g.destination),a.start(g.currentTime+e),a.stop(g.currentTime+e+i)}function S(){x=!1,p&&clearTimeout(p),g&&g.close()}function y(t){return{cx:t.x+t.width/2,cy:t.y+t.height/2,radius:.4*Math.min(t.width,t.height)}}function w(t,e,i,s=4,h="red"){const a=[[0,1,0,1,0],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]];t.fillStyle=h;for(let h=0;h<a.length;h++)for(let n=0;n<a[h].length;n++)a[h][n]&&t.fillRect(e+n*s,i+h*s,s,s)}const M="data:image/png;base64,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",A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABiBAMAAAA8ZulCAAAAMFBMVEVHcEwAAAAwNUI+Pj67FxcME+wdH1x3eJb/1wm6nQrQgbyOJia7ihX9/f26jgpUYYGwPUw0AAAAAXRSTlMAQObYZgAAAxBJREFUWMO91z9r20AUAHBdSemql1YO9aQehg6dTL+AY+4DVIMgWQqB4CFT6OKxZJOHBjIE7EKGLhk0enWH7vXa0QV/gZBv0N6705+7k95ZDrQPI1unn55Od6c7OQicAGefuQUGDV0adqdkWrAtAJBp96LgSJJOzgzLoDfpTCc+Km1Y372fTsCI3EPz7vQCa1DHhY/e2/T+rCvFHV9jOUGPgX1olJgwJWsAkESpKdPEQ6G2UZpSWZnKkuKmyPmbGlosQnWrcil5l229NMt+aZue3G2uCfpcXXuefdmoKpxk2eZ666MZio+SzjvQq831g6JXm2zrawEpYPYgz1rgjxuKYiixuMnhdL6Lvl7Ms9nia/7tdJFls9sk9AyXBUbSx75I0+gDOVzSJMK+TQApNi49slQqNH3QO/TsEhW0n+eg83puS0U/xw89E7GWh4AYrnvQ5tNFOx9tnvgvqGcOcKvumSyYVcSaOY3VyErbQuFJFA+HTkWPptMpGDvhf6JWPbVlgCftope6sPz2UJiqshcmBYIeXfKAx9M/jy3UHdKfOOdvPz+2LettlPOAqGrvzKLvVqslb3s5Ab1QV8EH39frn8vY7PX6V89c4QZC0jVF9UrZkaq8uh4c6Q+aSotxLoTgfCVjaY374Bm2ypsmFavVwehAiJqGivJyXceQUoy55PiDpD2TDhQd1V1wgPvHBhWacp20TIstX1Bu05GmuBlV9FWRo6TnivJYBLIwDqoqqEYSdW17OieeO0Brjm6mO1w4lCMd8bgxoWHDWHSsqHAo5sVbGKlzqggCPnCzyqhalls0GDco00+NQZXg/NidEBlYtEoEhy5lxfwsvw8d6k7d5fzHiuvHVblLq2HfpEDTQ4vKopcWxYL3Moay/m5SdQDMZ9qmxuUbVBW0UVVuUi2xTLV67FJ9oKRYd7nljaxDfaAzHe5DQ4cO7dXWpLA/hYpCB1o17C5q9IE7NO0DBg0bj0bRXaE9KoZtrwrttPkXpKBDk5bt1U6hGwXnctRfIJqG5Cti8BTK6D9gO98gW+Mvds5VQ3YOWsYAAAAASUVORK5CYII=",P=document.getElementById("game"),C=new class{constructor(t){this.canvas=t,this.context=t.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.fps=0,this.frameCount=0,this.fpsTimer=0,this.gameState=new i,this.inputManager=new f(this.gameState),this.setupEventListeners(),this.roads=[],this.cars=[],this.cats=[],window.gameManager=this,this.levelCompleteEffect={active:!1,timer:0,duration:2e3},this.winEffect={active:!1,timer:0,duration:4e3},this.musicGamePlaying=!1,this.carImage=new Image,this.carImage.src=M,this.catImage=new Image,this.catImage.src=A,this.plotShown=!1}initializeRoadsAndCars(){this.cars.length>0&&(this.cars=[]);const t=this.gameState.getRoadsCount();for(let e=0;e<t;e++){const i=new m(this.gameState,e,t,this.canvas.width,this.canvas.height,60);this.roads.push(i);const h=Math.random()<.5,a=h?0:this.canvas.width-s,n=i.getCarY(),r=h?this.canvas.width-47:47,l=i.getRoadCenter();this.cars.push(new d(this.gameState,a,n,M,s,60,r,l,e))}}initializeBlackCats(){const t=r[this.gameState.level-1]||2;for(let e=0;e<t;e++){const{startX:t,startY:i}=this.calculateCatRandomPosition(),s=new o(this.gameState,t,i,A,h,98,e);this.cats.push(s)}}calculateCatRandomPosition(){const t=this.canvas.width-84-h,e=this.canvas.height-84-98;return{startX:Math.random()*(t-84)+84,startY:Math.random()*(e-84)+84}}setupEventListeners(){document.addEventListener("keydown",t=>{"Space"===t.code&&(this.gameState.isState("menu")?this.plotShown?this.startGame():this.startPlot():this.gameState.isState("plot")?this.startGame():(this.gameState.isState("gameOver")||this.gameState.isState("gameWin"))&&this.restartGame())}),document.addEventListener("click",()=>{this.gameState.isState("menu")?this.plotShown?this.startGame():this.startPlot():this.gameState.isState("plot")?this.startGame():(this.gameState.isState("gameOver")||this.gameState.isState("gameWin"))&&this.restartGame()})}startPlot(){this.gameState.setState("plot"),this.plotShown=!0}startGame(){this.gameState.setState("playing"),this.resetLevel()}restartGame(){this.gameState=new i,this.inputManager=new f(this.gameState),this.startGame()}resetLevel(){this.inputManager.selectedCarIndex=Math.floor(Math.random()*this.gameState.level),this.gameState.carIndexCompleted=[],this.cars=[],this.roads=[],this.cats=[],this.initializeBlackCats(),this.initializeRoadsAndCars(),this.musicGamePlaying||(function(){if(x)return;g=new(window.AudioContext||window.webkitAudioContext),x=!0,u=0;const t=[261,293,329,349,392,440,523];!function e(){if(!x)return;let i=t[Math.random()*t.length|0];Math.random()<.3&&(i*=2),v(i,u,.1*(Math.random()<.5?1:2),Math.random()<.3?"triangle":"sine",.12),Math.random()<.2&&v(i/2,u,.8,"sawtooth",.05),Math.random()<.4&&v(880,u,.05,"square",.03),Math.random()<.2&&v(1320,u,.03,"square",.025),u+=.1,p=setTimeout(e,100)}()}(),this.musicGamePlaying=!0)}nextLevel(){if(this.gameState.nextLevel(),this.gameState.level>9)return this.gameState.setState("gameWin"),this.winEffect={active:!0,timer:0,duration:4e3},this.levelCompleteEffect.active=!1,void(this.musicGamePlaying&&(S(),this.musicGamePlaying=!1));this.resetLevel(),this.levelCompleteEffect.active=!0,this.levelCompleteEffect.timer=0,this.gameState.catLives=9}update(t){this.gameState.isState("playing")&&(0===this.gameState.catLives&&this.gameState.setState("gameOver"),this.checkLevelCompletion()),this.updateEffects(t)}updateEffects(t){this.levelCompleteEffect.active&&(this.levelCompleteEffect.timer+=1e3*t,this.levelCompleteEffect.timer>=this.levelCompleteEffect.duration&&(this.levelCompleteEffect.active=!1)),this.winEffect.active&&(this.winEffect.timer+=1e3*t,this.winEffect.timer>=this.winEffect.duration&&(this.winEffect.active=!1))}checkLevelCompletion(){this.cars.length>0&&this.cars.every(t=>t.isAtFinish())&&this.nextLevel()}render(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#1a1a1a",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.gameState.isState("menu")?this.renderMenu():this.gameState.isState("plot")?this.renderPlot():this.gameState.isState("playing")?this.renderGame(t):this.gameState.isState("gameOver")?this.renderGameOver():this.gameState.isState("gameWin")&&this.renderGameWin()}renderMenu(){const t=this.canvas.width/2-104;this.context.drawImage(this.carImage,t,100,s,60),this.context.drawImage(this.catImage,t+h+20,60,h,98),this.context.fillStyle="#ffffff",this.context.font="32px Trebuchet MS",this.context.textAlign="center",this.context.fillText("THE BLACK CROSSCAT",this.canvas.width/2,this.canvas.height/2-50),this.context.font="20px Trebuchet MS",this.context.fillText("Press SPACE or Click to start",this.canvas.width/2,this.canvas.height/2),this.context.font="14px Trebuchet MS",this.context.fillText("Use ARROWS to control cars and avoid the black cat!",this.canvas.width/2,this.canvas.height/2+30),this.context.font="16px Trebuchet MS",this.context.fillText("Controls: ↑↓ Select Car | ←→ Move Car",this.canvas.width/2,this.canvas.height/2+60),this.renderMenuPenalties()}renderPlot(){this.context.fillStyle="#ffffff",this.context.font="18px Trebuchet MS",this.context.textAlign="center",this.context.fillText("An ancient belief holds that if a black cat crosses your path, you will be marked by bad luck.",this.canvas.width/2,this.canvas.height/2-20),this.context.fillText("So be careful to get to the end of the road without hitting the black cat,",this.canvas.width/2,this.canvas.height/2),this.context.fillText(" who like an outlaw crosses the road on his dirt bike!",this.canvas.width/2,this.canvas.height/2+20),this.context.font="16px Trebuchet MS",this.context.fillText("Press SPACE or Click to start",this.canvas.width/2,this.canvas.height/2+80)}renderMenuPenalties(){this.context.font="14px Trebuchet MS",this.context.textAlign="left";let t=this.canvas.height/2+100;const e="⚡ Penalty Colors:",i=this.context.measureText(e).width,s=this.canvas.width/2-i/2;this.context.fillStyle="white",this.context.fillText(e,s,t),Object.entries(n).forEach(([e,i],h)=>{const a=t+40*(h+1);!function(t,e,i,s){t.save(),t.translate(e,i),t.fillStyle="#333",t.fillRect(-20,-8,40,16),t.fillRect(-12,-12,24,4),t.fillRect(8,-12,8,4),t.fillRect(-16,-12,8,4),t.fillRect(-24,-4,4,8),t.fillRect(20,-4,4,8),t.fillRect(-12,8,24,4),t.fillStyle=s,t.fillRect(-4,-4,4,4),t.fillRect(0,-4,4,4),t.fillRect(0,0,4,4),t.fillRect(4,0,4,4),t.fillRect(4,4,4,4),t.fillRect(0,4,4,4),t.fillRect(0,8,4,4),t.restore()}(this.context,s+20,a-10,i),this.context.fillStyle="#ffffff",this.context.textAlign="left",this.context.fillText(e,s+40+10,a)}),this.context.textAlign="center"}renderGame(t){this.roads.forEach((t,e)=>{t.setSelected(e===this.inputManager.getSelectedCarIndex());const i=this.gameState.carIndexCompleted.length>0&&void 0!==this.gameState.carIndexCompleted.find(t=>t===e);t.setCompleted(i),t.render(this.context)}),this.cats.length>0&&this.cats.forEach(e=>{e.update(t,this.canvas.width,this.canvas.height),e.render(this.context)}),this.cars.forEach((e,i)=>{let s=null;i===this.inputManager.getSelectedCarIndex()&&(s=this.inputManager.getLastMoveDirection()),e&&!e.isAtFinish()&&(e.update(t,s,0,this.canvas.width),e.render(this.context),e.isSafe||this.cats.forEach(t=>{t&&!t.hasBeenHit&&0===t.resurrectionProgress&&function(t,e){const i=y(t),s=y(e),h=i.cx-s.cx,a=i.cy-s.cy;return Math.sqrt(h*h+a*a)<i.radius+s.radius}(e,t)&&(t.hit(),e.onCarHitsCat(t.x,t.y,t.width,t.height))}))}),this.levelCompleteEffect.active&&this.renderLevelCompleteEffect(),this.renderUI(t)}renderLevelCompleteEffect(){const t=1-this.levelCompleteEffect.timer/this.levelCompleteEffect.duration;this.context.fillStyle=`rgba(0, 255, 0, ${.5*t})`,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=`rgba(255, 255, 255, ${t})`,this.context.font="48px Trebuchet MS",this.context.textAlign="center",this.context.fillText("LEVEL COMPLETE!",this.canvas.width/2,this.canvas.height/2)}renderUI(t){this.context.fillStyle="#ffffff",this.context.font="16px Trebuchet MS",this.context.textAlign="left",this.context.fillStyle="white",this.context.fillText("Level",14,28),function(t,e,i,s,h=4,a="white"){const n={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[1,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,1,0],[1,0,0,1,0],[1,1,1,1,1],[0,0,0,1,0],[0,0,0,1,0]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};t.fillStyle=a;let r=i;for(let i of e.toString()){let e=n[i];for(let i=0;i<e.length;i++)for(let a=0;a<e[i].length;a++)e[i][a]&&t.fillRect(r+a*h,s+i*h,h,h);r+=(e[0].length+1)*h}}(this.context,this.gameState.level,60,14,3,"lime"),this.context.fillStyle="white",this.context.fillText(`Score ${this.gameState.score}`,100,28);for(let t=0;t<this.gameState.catLives;t++)w(this.context,260+30*t,10,5)}calcFps(t){this.frameCount++,this.fpsTimer+=t,this.fpsTimer>=1&&(this.fps=Math.round(this.frameCount/this.fpsTimer),this.frameCount=0,this.fpsTimer=0)}renderGameOver(){this.context.fillStyle="#ffffff",this.context.font="32px Trebuchet MS",this.context.textAlign="center",this.context.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-50),this.context.font="20px Trebuchet MS",this.context.fillText(`Final Score: ${this.gameState.score}`,this.canvas.width/2,this.canvas.height/2),this.context.fillText("Press SPACE to restart",this.canvas.width/2,this.canvas.height/2+40),this.musicGamePlaying&&(S(),this.musicGamePlaying=!1)}renderGameWin(){var t;if(null==(t=this.winEffect)?void 0:t.active){const t=1-this.winEffect.timer/this.winEffect.duration;this.context.fillStyle=`rgba(0, 255, 0, ${.6*t})`,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle="#ffffff",this.context.font="32px Trebuchet MS",this.context.textAlign="center",this.context.fillText("YOU WIN!",this.canvas.width/2,this.canvas.height/2-50),this.context.font="20px Trebuchet MS",this.context.fillText(`Final Score: ${this.gameState.score}`,this.canvas.width/2,this.canvas.height/2),this.context.fillText("Press SPACE to restart",this.canvas.width/2,this.canvas.height/2+40)}}(P);let T=0;requestAnimationFrame(function t(e){T||(T=e);const i=(e-T)/1e3;T=e,C.update(i),C.render(i),requestAnimationFrame(t)})</script>