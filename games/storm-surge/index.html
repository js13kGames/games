<!doctype html><title>Storm Surge - js13kGames 2018</title><style>body{color:#888;background:#000;text-align:center}canvas{display:block;margin:0 auto;width:320px;height:288px;background:#0f380f;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}ul{margin:0 auto;max-width:240px;text-align:left}h1,h3{margin:0}p{margin:.5em}</style><canvas id=g></canvas><h1>Storm Surge</h1><p><i>The game about keeping a thunderstorm from interrupting your viewing of cat GIFs,memes,and maybe work.</i><h3>Goal</h3><p>Don't let the lightning strike within the fence of your home.<br>Use your fire cannon to evaporate the clouds so they can't strike.<h3>Controls</h3><ul><li>A or left arrow - Move cannon left<li>D or right arrow - Move cannon right<li>Space - Shoot cannon<li>Reload page to restart</ul><script>let canvas=document.getElementById("g"),ctx=canvas.getContext("2d");ctx.mozImageSmoothingEnabled=!1,ctx.msImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,canvas.width=80,canvas.height=72;class Sprite{constructor(t,s,i,h){this.key=t,this.x=s,this.y=i,this.img=h,this.w=this.img.width,this.h=this.img.height,this.bbox={x:this.x,y:this.y,w:this.w,h:this.h},this.velX=0,this.velY=0,this.scale=1,this.vis=!0,this.data=[],this.canDestroy=!1,this.showBbox=!1}setData(t,s){null==this.getData(t)?this.data.push({key:t,value:s}):this.getData(t).value=s}getData(t){for(var s=this.data.length,i=0;i<s;i++)if(this.data[i].key==t)return this.data[i];return null}draw(t){this.vis&&(t.drawImage(this.img,this.x,this.y),this.showBbox&&(t.save(),t.fillStyle="red",t.fillRect(this.bbox.x,this.bbox.y),t.restore()))}}class FlashRect{constructor(t,s,i,h,e){this.x=t,this.y=s,this.w=i,this.h=h,this.c=e,this.fSt="in",this.fOn=!0,this.ncd=rndInt(1,3),this.nct=0,this.canDestroy=!1}draw(t){if(this.fOn)if(this.nct<this.ncd)this.nct++;else{if("in"==this.fSt)switch(this.c){case"#0f380f":this.c="#306230";break;case"#306230":this.c="#8bac0f";break;case"#8bac0f":this.c="#9bbc0f";break;case"#9bbc0f":this.fSt="out"}else switch(this.c){case"#9bbc0f":this.c="#8bac0f";break;case"#8bac0f":this.c="#306230";break;case"#306230":this.c="#0f380f";break;case"#0f380f":this.canDestroy=!0}this.nct=0}this.canDestroy||(t.save(),t.fillStyle=this.c,t.fillRect(this.x,this.y,this.w,this.h),t.restore())}}class Timer{constructor(t,s){this.d=t,this.t=0,this.cb=s,this.a=!0}update(){this.a&&(this.t<this.d?this.t++:(this.cb(),this.t=0))}}class BoltLine{constructor(t,s,i,h){this.x1=t,this.y1=s,this.x2=i,this.y2=h,this.canDestroy=!1}draw(t){t.save(),t.fillStyle="#9bbc0f",drawLineNoAliasing(t,this.x1,this.y1,this.x2,this.y2),t.restore()}}class Bolt{constructor(t,s,i){this.game=t,this.ix=s,this.iy=i,this.nlx1=this.ix,this.nly1=this.iy,this.nlx2=this.ix,this.nly2=this.iy,this.nbd=1,this.nbt=0,this.bltLns=[],this.ms=rndInt(3,10),this.cs=0,this.canDestroy=!1,this.createNextCoords(),this.bltLns.push(new BoltLine(this.nlx1,this.nly1,this.nlx2,this.nly2))}createNextCoords(){this.nlx1=this.nlx2,this.nly1=this.nly2,this.nlx2=this.nlx1+rndInt(-5,5),this.nly2=this.nly2+rndInt(5,10),this.nly2>this.game.h-32&&(this.ms-=1,this.nlx2=this.nlx1+rndInt(-4,4),this.nly2=this.game.h-32)}update(){this.cs<this.ms?this.nbt<this.nbd?this.nbt++:(this.createNextCoords(),this.bltLns.push(new BoltLine(this.nlx1,this.nly1,this.nlx2,this.nly2)),this.nbt=0,this.cs++):(this.nlx2>.5*this.game.w-16&&this.nlx2<.5*this.game.w+16&&this.game.setGameOver(!0),this.bltLns.forEach((function(t){t.canDestroy=!0})),this.canDestroy=!0),this.bltLns=this.bltLns.filter((function(t){return!t.canDestroy}))}draw(t){for(var s=this.bltLns.length,i=0;i<s;i++)this.bltLns[i].draw(t)}}function collide(t,s){return t.x<s.x+s.w&&t.x+t.w>s.x&&t.y<s.y+s.h&&t.y+t.h>s.y}function rndInt(t,s){return Math.floor(Math.random()*(s-t+1))+t}function rndArb(t,s){return Math.random()*(s-t)+t}function DBP(t,s,i,h){return Math.sqrt((i-t)*(i-t)+(h-s)*(h-s))}function getAngle(t,s){return Math.atan(s/(0==t?.01:t))+(t<0?Math.PI:0)}function drawLineNoAliasing(t,s,i,h,e){for(var n=DBP(s,i,h,e),r=getAngle(h-s,e-i),a=0;a<n;a++)t.fillRect(Math.round(s+Math.cos(r)*a),Math.round(i+Math.sin(r)*a),1,1)}function supportsLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}!function(t,s){var i={w:t.width,h:t.height,p:["#0f380f","#306230","#8bac0f","#9bbc0f"],elapsed:0,running:!1,secretImg:null,state:"mainmenu",highscore:0,kd:[],kEnt:13,kW:87,kA:65,kS:83,kD:68,kUp:38,kLft:37,kDwn:40,kRgt:39,kSpc:32,kSft:16,shootDelay:30,shootTick:0,cannCanMv:!0,cannCanShoot:!0,waveStarted:!1,isGameOver:!1,maxSpwns:30,secds:0,imgs:[],sprs:[],flashRects:[],ltn:[],ethTimer:null,cldTimer:null,mkImg:function(t){var s=new Image;return s.src=t,s.addEventListener("load",(function(){s.width=this.width,this.height=this.height})),s},addSpr:function(t){return this.sprs.push(t),t},getSprs:function(t){for(var s=[],i=this.sprs.length,h=0;h<i;h++)this.sprs[h].key==t&&s.push(this.sprs[h]);return s},rmSpr:function(t){this.sprs.filter((function(s){return s.key!==t}))},loadContent:function(){let t="content/",s=".png";this.imgs.title=this.mkImg(t+"title"+s),this.imgs.about=this.mkImg(t+"about"+s),this.imgs.pressenter=this.mkImg(t+"pressenter"+s),this.imgs.bliss=this.mkImg(t+"bliss"+s),this.imgs.cat0=this.mkImg(t+"cat0"+s),this.imgs.guisepar=this.mkImg(t+"guisepar"+s),this.imgs.ethnet=this.mkImg(t+"ethnet"+s),this.imgs.pt0=this.mkImg(t+"pt0"+s),this.imgs.pt1=this.mkImg(t+"pt1"+s),this.imgs.cpu=this.mkImg(t+"cpu"+s),this.imgs.cpuOff=this.mkImg(t+"cpuOff"+s),this.imgs.hills=this.mkImg(t+"hills"+s),this.imgs.home=this.mkImg(t+"home"+s),this.imgs.wall=this.mkImg(t+"wall"+s),this.imgs.cannon=this.mkImg(t+"cannon"+s),this.imgs.fball0=this.mkImg(t+"fball0"+s),this.imgs.cld0=this.mkImg(t+"cld0"+s),this.imgs.px=this.mkImg(t+"px"+s),this.imgs.hOffln=this.mkImg(t+"hOffln"+s),this.imgs.hStyOnln=this.mkImg(t+"styonln"+s),this.init()},init:function(t){var s=["cat0"];rndInt(0,100)>95?this.secretImg=this.imgs[s[rndInt(0,s.length-1)]]:this.secretImg=this.imgs.bliss,this.setState("mainmenu"),this.running=!0,this.mainloop()},loadHighscore:function(){return supportsLocalStorage()&&null!==localStorage.getItem("highscore")?localStorage.getItem("highscore"):0},saveHighscore:function(t){if(supportsLocalStorage()){null==localStorage.getItem("highscore")&&localStorage.setItem("highscore",0);var s=localStorage.getItem("highscore");t>parseInt(s)&&(this.highscore=t,localStorage.setItem("highscore",t))}},setState:function(t){switch(this.state=t,this.sprs.length=0,this.state){case"mainmenu":var s=2;supportsLocalStorage()||(s+=4),this.addSpr(new Sprite("title",9,s,this.imgs.title)),this.addSpr(new Sprite("pressenter",8,48,this.imgs.pressenter)),this.addSpr(new Sprite("about",0,this.h-8,this.imgs.about)),this.highscore=this.loadHighscore(),this.pressenterTimer=new Timer(30,function(){var t=this.getSprs("pressenter")[0];t.vis=!t.vis}.bind(this));break;case"play":this.addSpr(new Sprite("separ",0,this.h-24,this.imgs.guisepar)),this.addSpr(new Sprite("ethnet",0,this.h-10,this.imgs.ethnet)),this.addSpr(new Sprite("cpu",this.getSprs("ethnet")[0].x+40,this.getSprs("ethnet")[0].y-12,this.imgs.cpu)),this.addSpr(new Sprite("hills",0,this.getSprs("separ")[0].y-8,this.imgs.hills)),this.addSpr(new Sprite("wall",28,39,this.imgs.wall)),this.addSpr(new Sprite("wall",55,38,this.imgs.wall)),this.addSpr(new Sprite("home",this.getSprs("hills")[0].x+36,this.getSprs("hills")[0].y-10,this.imgs.home)),this.addSpr(new Sprite("cannon",.25*this.w,this.getSprs("hills")[0].y-6,this.imgs.cannon)),this.ethTimer=new Timer(15,function(){var t=["pt0","pt1"],s=t[rndInt(0,t.length-1)];this.addSpr(new Sprite("ethPt",rndInt(0,32),this.getSprs("ethnet")[0].y-1,this.imgs[s])).velY=-rndArb(.1,.5)}.bind(this)),this.cldTimer=new Timer(15,function(){if(!this.isGameOver){var t=rndInt(2,5);if(this.sprs.length+t<this.maxSpwns)for(var s=0;s<t;s++)if(1==rndInt(0,2)){var i=1==rndInt(0,2)?"l":"r",h=.001*Math.floor(this.elapsed/60),e=.01*Math.floor(this.elapsed/60),n=rndArb(h,e);"l"==i?(x=this.w,n=-rndArb(h,e)):(x=-64,n=rndArb(h,e)),y=rndInt(0,8);var r=[this.imgs.cld0],a=new Sprite("cld",x,y,r[rndInt(0,r.length-1)]);a.velX=n,this.addSpr(a)}}}.bind(this))}},setGameOver:function(t){!this.isGameOver&&t&&(this.saveHighscore(this.secds),this.getSprs("cpu")[0].canDestroy=!0,this.addSpr(new Sprite("cpu",this.getSprs("ethnet")[0].x+40,this.getSprs("ethnet")[0].y-12,this.imgs.cpuOff)),this.addSpr(new Sprite("hOffln",6,4,this.imgs.hOffln)),this.addSpr(new Sprite("hStyOnln",6,16,this.imgs.hStyOnln)),this.getSprs("cannon")[0].vis=!1,this.cannCanMv=!1,this.cannCanShoot=!1,this.ethTimer.a=!1);this.isGameOver=t},startWave:function(){this.waveTick=0},update:function(){switch(this.state){case"mainmenu":this.pressenterTimer.update(),this.kd[this.kEnt]&&this.setState("play"),rndInt(0,100)>98&&this.flashRects.push(new FlashRect(0,0,this.w,this.h,this.p[0]));break;case"play":this.elapsed++,this.isGameOver||this.elapsed%60!=0||this.secds++,this.ethTimer.update(),this.cldTimer.update();for(var t=this.sprs.length,s=0;s<t;s++){if(this.sprs[s].x+=this.sprs[s].velX,this.sprs[s].y+=this.sprs[s].velY,"ethPt"==this.sprs[s].key&&this.sprs[s].y<this.h-24&&(this.sprs[s].canDestroy=!0),"cld"==this.sprs[s].key&&(this.sprs[s].bbox={x:this.sprs[s].x,y:this.sprs[s].y,w:24*this.sprs[s].scale,h:6*this.sprs[s].scale},1==rndInt(0,1e3)&&(this.sprs[s].x>0&&this.sprs[s].x<this.w?(this.flashRects.push(new FlashRect(0,0,this.w,this.h,this.p[0])),this.ltn.push(new Bolt(this,this.sprs[s].x+rndInt(0,this.sprs[s].img.width),this.sprs[s].y+4))):rndInt(0,100)>95&&this.flashRects.push(new FlashRect(0,0,this.w,this.h,this.p[0])))),"fball"==this.sprs[s].key){this.sprs[s].bbox={x:this.sprs[s].x,y:this.sprs[s].y,w:4,h:4};for(var i=0;i<this.getSprs("cld").length;i++){var h=this.getSprs("cld")[i];collide(this.sprs[s].bbox,h.bbox)&&(this.sprs[s].canDestroy=!0,this.getSprs("cld")[i].canDestroy=!0)}}let t=320;(this.sprs[s].x<-t||this.sprs[s].x>this.w+t||this.sprs[s].y<-t||this.sprs[s].y>this.h+t)&&(this.sprs[s].canDestroy=!0)}if(this.waveStarted||(this.waveTick=0,this.waveStarted=!0),this.cannCanMv){var e=this.getSprs("cannon")[0];this.kd[this.kA]||this.kd[this.kLft]?e.velX=-1:this.kd[this.kD]||this.kd[this.kRgt]?e.velX=1:e.velX=0,e.x=e.x<-6?e.x=-6:e.x,e.x=e.x>this.w-8?this.w-8:e.x}if(this.cannCanShoot&&(this.shootTick<this.shootDelay&&this.shootTick++,(this.kd[this.kSpc]||this.kd[this.kSft])&&this.shootTick==this.shootDelay)){e=this.getSprs("cannon")[0];this.addSpr(new Sprite("fball",e.x+5,e.y,this.imgs.fball0)),this.shootTick=0}var n=this.getSprs("fball");for(s=0;s<n.length;s++)n[s].velY=-2;if(this.kd[84]&&this.setGameOver(!0),this.isGameOver){var r=this.getSprs("ethnet")[0];r.x>-32?r.velX=-1:r.velX=0}var a=this.ltn.length;for(s=0;s<a;s++)this.ltn[s].update();this.sprs=this.sprs.filter((function(t){return!t.canDestroy})),this.flashRects=this.flashRects.filter((function(t){return!t.canDestroy})),this.ltn=this.ltn.filter((function(t){return!t.canDestroy}))}},draw:function(){s.clearRect(0,0,this.w,this.h);for(var t=this.flashRects.length,i=0;i<t;i++)this.flashRects[i].draw(s);if("mainmenu"===this.state)if(s.save(),s.fillStyle="#0f380f",s.fillRect(0,0,this.w,24),s.fillRect(0,24,48,this.h-24),s.fillRect(this.w-4,24,4,this.h-24),s.fillRect(48,this.h-28,48,28),s.fillRect(this.w-19,24,2,20),s.fillRect(48,33,28,2),s.restore(),s.save(),s.fillStyle="#306230",s.fillRect(0,40,36,4),s.fillRect(22,40,8,this.h-40),s.restore(),s.save(),s.fillStyle="#306230",s.fillRect(2,26,10,14),s.fillStyle="#0f380f",s.fillRect(3,29,8,2),s.fillRect(3,32,8,2),rndInt(0,100)>5&&(s.fillStyle="#9BBC0F",s.fillRect(10,27,1,1)),s.restore(),s.save(),s.fillStyle="#306230",s.fillRect(22,38,4,2),s.fillRect(14,24,20,14),s.drawImage(this.secretImg,15,26),s.restore(),supportsLocalStorage()){s.save(),s.font="normal 8px arial",s.fillStyle="#9BBC0F";var h="HS: "+this.highscore;s.fillText(h,.5*this.w-.5*s.measureText(h).width,21),s.restore()}var e=this.sprs.length;for(i=0;i<e;i++)this.sprs[i].draw(s);var n=this.ltn.length;for(i=0;i<n;i++)this.ltn[i].draw(s);if("play"===this.state)if(this.isGameOver)for(i=0;i<3;i++){s.font="normal 10px arial";var r=this.secds+" secs";s.fillText(r,.5*this.w-.5*s.measureText(r).width,.65*this.h),s.restore()}else s.font="normal 10px monospace",s.fillStyle="#8BAC0F",s.fillText("sec:",this.w-17,this.h-16),s.fillText(this.secds,this.w-17,this.h-8)},mainloop:function(){var t;(t=i).update(),t.draw(),window.requestAnimationFrame(t.mainloop)}};i.running||i.loadContent(),window.addEventListener("keydown",(function(t){var s=t.keyCode||t.which;i.kd[s]=!0})),window.addEventListener("keyup",(function(t){var s=t.keyCode||t.which;i.kd[s]=!1})),document.onkeydown=function(t){var s=(t=t||window.event).keyCode;if(s>=37&&s<=40||32==s)return!1}}(canvas,ctx)</script>