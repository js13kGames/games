<!doctype html><meta name=viewport content="width=device-width"><title>Sunset Stars - js13kGames 2021</title><style>*{margin:0;padding:0}body,html{overflow:hidden}</style><body><script type=module>import*as l from"/2021/webxr/three.js";const s=[],i=[],d=[],c=[],h=-7.5,t=new l.Raycaster,p=[],a=new l.Matrix4,r=[],m=new l.Scene,e={width:window.innerWidth,height:window.innerHeight},w=new l.TextureLoader,u=new l.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,30),v=(u.position.set(0,1.6,3),new l.WebGLRenderer({antialias:!0})),f=(v.setPixelRatio(window.devicePixelRatio,2),v.setSize(window.innerWidth,window.innerHeight),v.xr.enabled=!0,document.body.appendChild(v.domElement),document.body.appendChild(class{static createButton(o,e){const i=document.createElement("button");function t(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}var n;return"xr"in navigator?(i.id="VRButton",i.style.display="none",t(i),navigator.xr.isSessionSupported("immersive-vr").then(function(e){(e?function(){let t=null;async function e(e){e.addEventListener("end",n),await o.xr.setSession(e),i.textContent="EXIT VR",t=e}function n(){t.removeEventListener("end",n),i.textContent="ENTER VR",t=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===t?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(e):t.end()}}:function(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,i.textContent="VR NOT SUPPORTED"})()}),i):(n=document.createElement("a"),!1===window.isSecureContext?(n.href=document.location.href.replace(/^http:/,"https:"),n.innerHTML="WEBXR NEEDS HTTPS"):(n.href="https://immersiveweb.dev/",n.innerHTML="WEBXR NOT AVAILABLE"),n.style.left="calc(50% - 90px)",n.style.width="180px",n.style.textDecoration="none",t(n),n)}}.createButton(v)),v.xr.getController(0));m.add(f);var n=new l.LineBasicMaterial({color:15094391}),o=(new l.BufferGeometry).setFromPoints([new l.Vector3(0,0,0),new l.Vector3(0,0,-1)]),M=new l.Line(o,n);M.name="line",M.scale.z=10,f.add(M.clone());const A=new l.AmbientLight(16777215,.5),y=(m.add(A),new l.PointLight(16777215,.5));let g,V,C;y.position.set(2,3,4),m.add(y),function(){var t=[],e=w.load("sb3.webp"),n=e,o=w.load("sb2.webp"),i=w.load("sb1.webp"),a=e,r=e;t.push(new l.MeshBasicMaterial({map:e})),t.push(new l.MeshBasicMaterial({map:n})),t.push(new l.MeshBasicMaterial({map:o})),t.push(new l.MeshBasicMaterial({map:i})),t.push(new l.MeshBasicMaterial({map:a})),t.push(new l.MeshBasicMaterial({map:r}));for(let e=0;e<6;e++)t[e].side=l.BackSide;e=new l.BoxGeometry(20,20,20),n=new l.Mesh(e,t),m.add(n)}(),function(){var e=new l.PlaneBufferGeometry(1,1,1,1),t=w.load("title.webp");(e=new l.Mesh(e,new l.MeshPhongMaterial({map:t,transparent:!0}))).position.set(-0,2,.5),e.name="Title",m.add(e)}(),function(){var e=new l.PlaneBufferGeometry(1,1,1,1),t=w.load("start.webp");(e=new l.Mesh(e,new l.MeshPhongMaterial({map:t,transparent:!0}))).position.set(-0,2,-5.5),e.name="Start",e.visible=!1,m.add(e),r.push(e)}(),function(){var e=new l.PlaneBufferGeometry(.5,.5,1,1),t=w.load("exit.webp");(e=new l.Mesh(e,new l.MeshPhongMaterial({map:t,transparent:!0}))).name="Exit",m.add(e),e.visible=!1,r.push(e)}(),window.addEventListener("resize",()=>{e.width=window.innerWidth,e.height=window.innerHeight,u.aspect=e.width/e.height,u.updateProjectionMatrix(),v.setSize(e.width,e.height),v.setPixelRatio(Math.min(window.devicePixelRatio,2))}),v.xr.addEventListener("sessionstart",function(e){t=new l.PlaneBufferGeometry(2,2,1,1),n=w.load("arwLft2.webp"),(o=new l.Mesh(t,new l.MeshPhongMaterial({map:n,transparent:!0}))).position.set(-1.5,-2,h),o.name="ButLeft",m.add(o),(o=new l.Mesh(t,new l.MeshPhongMaterial({map:n,transparent:!0}))).rotation.set(0,0,Math.PI/180*180),o.position.set(1.5,-2,h),o.name="ButRight",m.add(o),t=new l.PlaneBufferGeometry(1.5,1.5,1,1),n=w.load("help.webp"),(t=new l.Mesh(t,new l.MeshPhongMaterial({map:n,transparent:!0}))).position.set(-0,.75,-5.5),t.name="Help",m.add(t);var t,n,o=m.getObjectByName("Title");o.rotation.set(0,-45*Math.PI/180,0),o.position.set(3,2,-2.5),(o=m.getObjectByName("Exit")).rotation.set(0,-45*Math.PI/180,0),o.position.set(3,.5,-2.5),o.visible=!0,m.getObjectByName("Start").visible=!0,P()}),f.addEventListener("selectstart",function(e){var t=E(e=e.target);if(0<t.length)switch(t=t[0],a.getInverse(e.matrixWorld),t.object.name){case"ButLeft":0!==s.length&&(s[0].position.x+=-.25);break;case"ButRight":0!==s.length&&(s[0].position.x+=.25);break;case"Start":b(S[0]+2),G(),s.pop(),B(S[0]+4),m.getObjectByName("Start").visible=!1;var n=m.getObjectByName("Help"),o=(m.remove(n),(n=m.getObjectByName("ButLeft")).visible=!0,m.getObjectByName("ButRight"));r.push(n,o),o.visible=!0;break;case"Exit":location.reload()}}),v.setAnimationLoop(function(){var e=c,t=H.getElapsedTime(),n=t-L,o=1+.1*S[0];if(L=t,void 0!==j)for(let e=0;e<250;e++)j.getMatrixAt(e,N),I.setFromMatrixPosition(N),T.setFromRotationMatrix(N),T.z+=-.025,N.makeRotationFromEuler(T),N.setPosition(I),j.setMatrixAt(e,N),j.instanceMatrix.needsUpdate=!0;if(0!==s.length&&void 0!==s&&(t=s[0].position.x,s[0].position.y>.86*R&&(s[0].rotateOnAxis(z,k*n*100),s[0].position.y+=1e3*n*o*-.002),null!=e)){var i=e.includes(t),n=.866*R;switch(s[0].position.y>.1+n){case!0:break;case!1:!1===O&&g(void 0,void 0,537,.02,.02,.22,1,1.59,-6.98,4.97);var a,r=m.getObjectByName("C_Row:"+R+" PosX:"+s[0].position.x);void 0!==r&&(-1<(a=e.indexOf(r.position.x))&&e.splice(a,1),m.remove(r),d.splice(a,1),0==d.length&&D(),0===e.length&&(0!==S.length?(R++,G):F)(),s.pop(),setTimeout(()=>{B(S[0]+4)},500)),!0!==i&&!1===O&&(g(void 0,void 0,396,void 0,void 0,.16,4,1.32,void 0,void 0,void 0,void 0,void 0,.3,void 0,.3,void 0,.8,.02),s[0].material.color.set(16711680),s[0].scale.set(.0125,.015,.0125),s[0].position.z+=.01,s.pop(),setTimeout(()=>{B(S[0]+4)},500))}}for(;p.length;)p.pop().material.emissive.g=0;void 0===(o=f).userData.selected&&(t=o.getObjectByName("line"),0<(o=E(o)).length?((n=(o=o[0]).object).material.emissive.g=1,p.push(n),t.scale.z=o.distance):t.scale.z=10),v.render(m,u)}),V=.3,g=(e=1,t=.05,n=220,o=0,i=0,a=.1,r=0,s=1,l=0,d=0,c=0,h=0,p=0,m=0,w=0,u=0,v=0,f=1,M=0,y=0)=>{let g,x,b=Math,B=44100,P=2*b.PI,E=l*=500*P/B/B,R=n*=(1-t+2*t*b.random(t=[]))*P/B,L=0,S=0,O=0,j=1,N=0,I=0,T=0;for(d*=500*P/B**3,w*=P/B,c*=P/B,h*=B,p=B*p|0,x=(o=B*o+9)+(M*=B)+(i*=B)+(a*=B)+(v*=B)|0;O<x;t[O++]=T)++I%(100*u|0)||(T=r?1<r?2<r?3<r?b.sin((L%P)**3):b.max(b.min(b.tan(L),1),-1):1-(2*L/P%2+2)%2:1-4*b.abs(b.round(L/P)-L/P):b.sin(L),T=(p?1-y+y*b.sin(P*O/p):1)*(0<T?1:-1)*b.abs(T)**s*e*.3*(O<o?O/o:O<o+M?1-(O-o)/M*(1-f):O<o+M+i?f:O<x-v?(x-O-v)/a*f:0),T=v?T/2+(v>O?0:(O<x-v?1:(x-O)/v)*t[O-v|0]/2):T),g=(n+=l+=d)*b.cos(w*S++),L+=g-g*m*(1-1e9*(b.sin(O)+1)%2),j&&++j>h&&(n+=c,R+=c,j=0),!p||++N%p||(n=R,l=E,j=j||1);return(e=C.createBuffer(1,x,B)).getChannelData(0).set(t),(n=C.createBufferSource()).buffer=e,n.connect(C.destination),n.start(),n},C=new(window.AudioContext||webkitAudioContext);const x=new l.Group;function b(e){d.length=0;let t=e;const n=.5*Math.tan(Math.PI/180*60);let o=-(t/2+.5),i=0;for(var a=new l.CircleBufferGeometry(.4,6),r=new l.MeshBasicMaterial({color:255,wireframe:!0,transparent:!0,opacity:.2});i<e+1;){for(var s=i*n;0<t;){const e=new l.Mesh(a,r),n=o+ +t;e.position.set(n,s,h),m.add(e),e.name="C_Row:"+i+" PosX:"+e.position.x,e.userData.row=i,e.userData.posX=e.position.x,d.push(e),t--}i++,t=e-i,o+=.5}}function B(t){var n=[];for(let e=0;e<10;e++){const i=e%2==1?10:20,t=e/5*Math.PI;n.push(new l.Vector2(Math.cos(t)*i,Math.sin(t)*i))}var e=new l.Shape(n),e=new l.ShapeGeometry(e),o=[15890944,15102720,16744448,16752704,16757606][Math.floor(5*Math.random())];(e=new l.Mesh(e,new l.MeshPhongMaterial({color:o}))).position.set(0,t,-7.49),e.rotation.set(0,0,Math.random()),e.scale.set(.025,.025,.025),m.add(e),e.name="dr",m.add(e),s.push(e),i.push(e)}function P(){const e=new l.PlaneBufferGeometry(1,1,1,1),t=w.load("lvl.webp"),n=new l.Mesh(e,new l.MeshPhongMaterial({map:t,transparent:!0}));n.position.set(0,5,-.05),x.add(n);let o=new l.CircleBufferGeometry(.1,12),i=new l.MeshBasicMaterial({color:255,transparent:!0,opacity:.2}),a=6;for(;0<a;){const e=new l.Mesh(o,i),t=4.5-.5*-(a-6);e.position.set(0,t,0),x.add(e),e.userData.lvl=6-a+1,e.name="LvlCirc"+e.userData.lvl,a--}var r=S[0];m.getObjectByName("LvlCirc"+r),r=(new l.Shape).lineTo(-3,8).lineTo(0,6).lineTo(3,8).lineTo(0,0),r=new l.ShapeGeometry(r),(r=new l.Mesh(r,new l.MeshPhongMaterial({color:16744448}))).position.set(-.2,4.5,0),r.rotation.set(0,0,90*Math.PI/180),r.scale.set(.05,.05,.05),r.name="AH",x.add(r),x.rotation.set(0,45*Math.PI/180,0),x.position.set(-2.5,-2,-2.5),m.add(x)}function E(e){return a.identity().extractRotation(e.matrixWorld),t.ray.origin.setFromMatrixPosition(e.matrixWorld),t.ray.direction.set(0,0,-1).applyMatrix4(a),t.intersectObjects(r,!0)}x.name="LevelUI";let R=0,L=0;const z=new l.Vector3(0,0,1).normalize(),k=.01,S=[1,2,3,4,5,6];let O=!1;const H=new l.Clock;let j,N=new l.Matrix4,I=new l.Vector3,T=new l.Euler;const W=[];function D(){g(1.09,void 0,117,.06,.47,.49,1,1.57,1.5,void 0,-752,.09,.09,.1,void 0,void 0,void 0,.95,.09,.2);var e=m.getObjectByName("LvlCirc"+S[0]),t=new l.RingGeometry(.1,.2,32),n=new l.MeshBasicMaterial({color:11203708});(t=new l.Mesh(t,n)).position.copy(e.position),t.name="Ring",x.add(t),W.push(t),m.getObjectByName("AH").position.y+=-.5,S.shift(),R=0,i.forEach(function(e){m.remove(e)}),b(S[0]+2),G(),s.pop(),B()}function G(){c.pop();var e=d.filter(function(e){return e.userData.row==R});e.forEach(function(e){c.push(e.position.x)}),e.pop()}function F(){if(!O){O=!0,s.pop(),g(1.35,void 0,687,void 0,.08,.21,void 0,1.72,void 0,void 0,176,void 0,.08,void 0,void 0,void 0,.03,.7,.1,.01);var t=[];for(let e=0;e<10;e++){var n=e%2==1?10:20,o=e/5*Math.PI;t.push(new l.Vector2(Math.cos(o)*n,Math.sin(o)*n))}var e=new l.Shape(t),e=new l.ShapeGeometry(e),i=((j=new l.InstancedMesh(e,new l.MeshPhongMaterial({color:16744448}),250)).scale.set(.015,.015,.015),new l.Matrix4);for(let e=0;e<250;e++)X(i),j.setMatrixAt(e,i);j.name="WinIM",m.add(j);var e=m.getObjectByName("ButLeft"),a=m.getObjectByName("ButRight");e.visible=!1,a.visible=!1,setTimeout(function(){s.pop();var e=m.getObjectByName("WinIM");m.remove(e),m.getObjectByName("Start").visible=!0,R=0;for(let e=1;e<7;e++)S.push(e);for(var t=m.getObjectByName("LevelUI"),n=t.children.length-1;0<=n;--n)t.remove(t.children[n]);m.remove(x),m.children.forEach(e=>"AH"==e.name?m.remove(e):null),P(),O=!1},5e3)}}const X=function(){const t=new l.Vector3,n=new l.Euler,o=new l.Quaternion,i=new l.Vector3;return function(e){t.x=400*Math.random()-200,t.y=400*Math.random()-200,t.z=400*Math.random()-600,n.x=2*Math.random()*Math.PI,n.y=2*Math.random()*Math.PI,n.z=2*Math.random()*Math.PI,o.setFromEuler(n),i.x=i.y=i.z=+Math.random(),e.compose(t,o,i)}}()</script>