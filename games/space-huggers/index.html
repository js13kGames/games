<title>Space Huggers - js13kGames 2021</title><script>const t=Math.PI,i=t=>t<0?-t:t,s=(t,i)=>t<i?t:i,h=(t,i)=>i<t?t:i,e=(t,i=1,s=0)=>t<s?s:i<t?i:t,a=(t,i=1,s=0)=>i-s?e((t-s)/(i-s)):0,n=(t,i=1,s=0)=>s+e(t)*(i-s),r=(t,s,h,e)=>2*i(t.x-h.x)<s.x+e.x&2*i(t.y-h.y)<s.y+e.y,o=(t=1,i=0)=>i+(t-i)*Math.random(),c=(i=1)=>w(new m,o(2*t),i),l=(t=new S,i=new S(0,0,0,1),s)=>s?t.ra(i,o()):new S(o(t.r,i.r),o(t.u,i.u),o(t.b,i.b),o(t.a,i.a));let d=0;const u=(t=1,i=0)=>i+(t-i)*(1e9*Math.sin(++d)**2%1),g=(t=0,i)=>null==t.x?new m(t,null==i?t:i):new m(t.x,t.y);function w(t,i,s=1){return t.x=s*Math.sin(i),t.y=s*Math.cos(i),t}function f(t,i){return new m(t.x/i.x,t.y/i.y)}function x(t){return t.x**2+t.y**2}function y(t,i){return(t.x-i.x)**2+(t.y-i.y)**2}function v(t){var i=t.length();return 1<i?t.scale(1/i):t}function b(t){return new m(0|t.x,0|t.y)}function p(t,i){return 0<=t.x&&0<=t.y&&t.x<i.x&&t.y<i.y}class m{constructor(t=0,i=0){this.x=t,this.y=i}L(){return new m(this.x,this.y)}scale(t){return new m(this.x*t,this.y*t)}add(t){return new m(this.x+t.x,this.y+t.y)}j(t){return new m(this.x-t.x,this.y-t.y)}multiply(t){return new m(this.x*t.x,this.y*t.y)}length(){return x(this)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new m(t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(t);return t=Math.sin(t),new m(this.x*i-this.y*t,this.x*t+this.y*i)}direction(){return i(this.x)>i(this.y)?this.x<0?3:1:this.y<0?2:0}round(){return new m(Math.round(this.x),Math.round(this.y))}ra(t,i){return this.add(t.j(this).scale(e(i)))}}function A(t){return new S(e(t.r),e(t.u),e(t.b),e(t.a))}function z(t,i=.05){return A(new S(t.r+o(i,-i),t.u+o(i,-i),t.b+o(i,-i),t.a+o(0,-0)))}function D(t){return`rgb(${255*t.r|0},${255*t.u|0},${255*t.b|0},${t.a})`}function C(t){return(255*t.r|0)+(255*t.u<<8)+(255*t.b<<16)+(255*t.a<<24)}function M(t=0,i=0,s=1,h=1){var e=new S,a=(t,i,s)=>(s=(s%1+1)%1)<1/6?t+6*(i-t)*s:s<.5?i:s<2/3?t+(i-t)*(2/3-s)*6:t;return e.r=a(s=2*s-(i=s<.5?s*(1+i):s+i-s*i),i,t+1/3),e.u=a(s,i,t),e.b=a(s,i,t-1/3),e.a=h,e}class S{constructor(t=1,i=1,s=1,h=1){this.r=t,this.u=i,this.b=s,this.a=h}L(){return new S(this.r,this.u,this.b,this.a)}add(t){return new S(this.r+t.r,this.u+t.u,this.b+t.b,this.a+t.a)}j(t){return new S(this.r-t.r,this.u-t.u,this.b-t.b,this.a-t.a)}multiply(t){return new S(this.r*t.r,this.u*t.u,this.b*t.b,this.a*t.a)}scale(t,i=t){return new S(this.r*t,this.u*t,this.b*t,this.a*i)}ra(t,i){return this.add(t.j(this).scale(e(i)))}}function j(t){t.time=void 0}function B(t){return null!=t.time}function F(t){return B(t)?a(t.time-N,0,t.setTime):0}class I{constructor(t){this.time=null==t?void 0:N+t,this.setTime=t}set(t=0){this.time=N+t,this.setTime=t}active(){return N<=this.time}get(){return B(this)?N-this.time:0}}const T=1/60,G=g(16);let L,P,R=0,k=0,H=g(),E=[],K=[],J=0,N=0,Z=0,Q=0,U=g(),W=4*h(G.x,G.y);const X=new Image;function O(){const t=i=>{if(!i.M){i.update();for(const s of i.children)t(s)}};for(const i of E)i.parent||t(i);E=E.filter(t=>!t.M),K=K.filter(t=>!t.M),N=++J/60}function V(t,i=0,s=()=>1){var h=K;if(i)if(null!=i.x)for(const e of h)r(t,i,e.g,e.size)&&s(e);else{i**=2;for(const e of h)y(t,e.g)<i&&s(e)}else for(const t of h)s(t)}let Y;function q(s,h,e=15,n=1){var r=1.5*e;r**2<(h=y(U,h))||((s=[...s])[0]=(s[0]||1)*n*a(h**.5,e,r),function(s=1,h=.05,e=220,a=0,n=0,r=.1,o=0,c=1,l=0,d=0,u=0,g=0,w=0,f=0,x=0,y=0,v=0,b=1,p=0,m=0){let A=2*t,z=l*=500*A/44100/44100,D=[];h=e*=(1+2*h*Math.random()-h)*A/44100;let C,M,S=0,j=0,B=0,F=1,I=0,T=0,G=0;for(d*=500*A/44100**3,x*=A/44100,u*=A/44100,g*=44100,w=44100*w|0,M=(a=44100*a+9)+(p*=44100)+(n*=44100)+(r*=44100)+(v*=44100)|0;B<M;D[B++]=G)++T%(100*y|0)||(G=o?1<o?2<o?3<o?Math.sin((S%A)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/A%2+2)%2:1-4*i(Math.round(S/A)-S/A):Math.sin(S),G=(w?1-m+m*Math.sin(A*B/w):1)*(0<G?1:-1)*(G<0?-G:G)**c*s*.5*(B<a?B/a:B<a+p?1-(B-a)/p*(1-b):B<a+p+n?b:B<M-v?(M-B-v)/r*b:0),G=v?G/2+(v>B?0:(B<M-v?1:(M-B)/v)*D[B-v|0]/2):G),C=(e+=l+=d)*Math.cos(x*j++),S+=C-C*f*(1-1e9*(Math.sin(B)+1)%2),F&&++F>g&&(e+=u,h+=u,F=0),!w||++I%w||(e=h,l=z,F=F||1);bt&&(Y=Y||new(window.AudioContext||webkitAudioContext),s=Y.createBuffer(1,D.length,44100),e=Y.createBufferSource(),s.getChannelData(0).set(D),e.buffer=s,e.connect(Y.destination),e.start())}(...s))}const $=g(.999);function _(t,i=1){return t.s?-i:i}function tt(t,i,s=g()){i.parent||t.children.includes(i),t.children.push(i),i.parent=t,i.pb=s.L(),i.N=0}function it(t,i=1,s){i&&!t.Ga?(K.includes(t),K.push(t)):!i&&t.Ga&&(K.includes(t),K.splice(K.indexOf(t),1)),t.Ga=i,t.nb=s,t.ua=1}class st{constructor(t,i=$,s=-1,h=G,e=0){this.g=t.L(),this.size=i,this.F=s,this.G=h,this.angle=e,this.color=void 0,this.l=1,this.ja=this.ka=.99,this.H=0,this.Ka=.8,this.U=N,this.h=g(this.Ga=this.A=this.O=0),this.ua=this.ea=1,this.children=[],E.push(this)}update(){if(this.parent)this.g=this.pb.multiply(g(_(this),1)).rotate(-this.parent.angle).add(this.parent.g),this.angle=_(this)*this.N+this.parent.angle;else{this.h.x=e(this.h.x,1,-1),this.h.y=e(this.h.y,1,-1);var t=this.g.L();if(this.g.x+=this.h.x*=this.ka,this.g.y+=this.h.y=this.ka*this.h.y+-.01*this.ea,this.angle+=this.O*=this.ja,this.l){var s,h,a,n,o,l=this.h.y<0;if(this.B&&(s=this.B.h?this.B.h.x:0,this.h.x=s+(this.h.x-s)*this.Ka,this.B=0),this.Ga)for(var d of K)!this.nb&!d.nb||d.M||d.parent||r(this.g,this.size,d.g,d.size)&&d!=this&&(!this.Y(d)|!d.Y(this)||(r(t,this.size,d.g,d.size)?(s=(h=(s=t.j(d.g)).length())<.01?c(.001):s.scale(.001/h),this.h=this.h.add(s),d.l&&(d.h=d.h.j(s))):(s=this.size.x+d.size.x,h=this.size.y+d.size.y,a=2*(t.y-d.g.y)>h+-.01,n=2*i(t.y-d.g.y)<h,o=2*i(t.x-d.g.x)<s,!a&&!o&&n||(this.g.y=d.g.y+(.5*h+.001)*(t.y-d.g.y<0?-1:1),d.B&&l||!d.l?(l&&(this.B=d),this.h.y*=-this.H):d.l&&(this.h.y=d.h.y=(this.l*this.h.y+d.l*d.h.y)/(this.l+d.l))),a||!n&&o||(this.g.x=d.g.x+(.5*s+.001)*(t.x-d.g.x<0?-1:1),this.h.x=d.l?d.h.x=(this.l*this.h.x+d.l*d.h.x)/(this.l+d.l):this.h.x*-this.H))));this.ua&&ot(this.g,this.size,this)&&!ot(t,this.size,this)&&(d=ot(new m(t.x,this.g.y),this.size,this),s=ot(new m(this.g.x,t.y),this.size,this),!d&&s||(this.B=l,this.g.y=t.y,this.h.y*=-this.H),!s&&d||(this.g.x=t.x,this.h.x*=-this.H))}}}T(){Vt(this.g,this.size,this.F,this.G,this.color,this.angle,this.s,this.ba)}o(){if(!this.M){this.M=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.o(t.parent=0)}}Sa(t){return 0<t}Y(){return 1}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}}let ht=[],et=g();const at=[],nt=(t,i=0)=>{p(t,et)&&(ht[(0|t.y)*et.x+t.x|0]=i)},rt=t=>p(t,et)?ht[(0|t.y)*et.x+t.x|0]:0;function ot(t,i=g(),s){var h=t.x-.5*i.x|0,e=t.y-.5*i.y|0,a=t.x+.5*i.x|0;for(t=t.y+.5*i.y|0;e<=t;++e)for(i=h;i<=a;++i){var n=ht[e*et.x+i];if(n&&(!s||s.Sa(n,new m(i,e))))return 1}}function ct(t,s){t=b(t);var h=(s=b(s)).j(t),e=i(h.x),a=-i(h.y),n=h.x<0?-1:1;h=h.y<0?-1:1;let r=e+a;for(let i=t.x,o=t.y;;){if((t=rt(g(i,o)))&&0<t)return new m(i+.5,o+.5);if(i==s.x&o==s.y)break;a<=(t=2*r)&&(r+=a,i+=n),t<=e&&(r+=e,o+=h)}}class lt{constructor(t=-1,i=0,s=0,h=new S){this.cb=t,this.direction=i,this.s=s,this.color=h}clear(){this.cb=this.direction=this.s=0,color=new S}}function dt(i,s){var h=b(s).add(i.g).add(g(.5));wt(i,h,g(1),0,0,t=>t.clearRect(-.5,-.5,1,1)),(s=i.getData(s)).cb<0||Vt(h,g(1),s.cb||-1,i.G,s.color,s.direction*t/2,s.s)}function ut(t){var i=t.size.x*t.G.x,s=t.size.y*t.G.y;t.canvas.width=i,t.canvas.height=s,t.tb=[H,R,k,W,U],W=t.G.x,U=t.size.scale(.5),R=t.canvas,k=t.context,k.imageSmoothingEnabled=!1,H=g(i,s),Qt(i,s)}function gt(t){for(let i=t.size.x;i--;)for(let s=t.size.y;s--;)dt(t,g(i,s))}function wt(t,i,s,h,e,a){const n=t.context;n.save(),i=i.j(t.g).multiply(t.G),s=s.multiply(t.G),n.translate(i.x,t.canvas.height-i.y),n.rotate(h),n.scale(e?-s.x:s.x,s.y),a(n),n.restore()}class ft extends st{constructor(t){var i=g(1);for(super(g(),t),this.canvas=at.length?at.pop():document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=i,this.G=G.L(),this.A=-1e9,this.Fb=1,this.data=[],t=(t=this.size).x*t.y;t--;)this.data.push(new lt)}o(){at.push(this.canvas),super.o()}setData(t,i,s){p(t,this.size)&&(this.data[(0|t.y)*this.size.x+t.x|0]=i,s&&dt(this,t))}getData(t){return p(t,this.size)&&this.data[(0|t.y)*this.size.x+t.x|0]}update(){}T(){this.Fb&&Wt();var t=this.g.add(g(0,this.size.y*this.scale.y)).j(U).multiply(g(W,-W)).add(H.scale(.5)).j(g(.5));k.drawImage(this.canvas,t.x,t.y,W*this.size.x*this.scale.x,W*this.size.y*this.scale.y)}}const xt=[[]],yt=(t,i=0)=>xt[i][t]&&xt[i][t].d?1:0,vt=(t,i=0)=>xt[i][t]&&xt[i][t].p?1:0;let bt=0,pt=g();onkeydown=t=>{t.repeat||(xt[At=0][mt(t.keyCode)]={d:bt=1,p:1})},onkeyup=t=>{t=mt(t.keyCode),xt[0][t]&&(xt[0][t].d=0,xt[0][t].r=1)},onmousedown=t=>(xt[0][t.button]={d:bt=1,p:1},onmousemove(t)),onmouseup=t=>xt[0][t.button]&&(xt[0][t.button].d=0,xt[0][t.button].r=1),onmousemove=t=>{var i;R&&(i=R.getBoundingClientRect(),pt.x=H.x*a(t.x,i.right,i.left),pt.y=H.y*a(t.y,i.bottom,i.top))},oncontextmenu=()=>!1;const mt=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;let At=0,zt=0;const Dt=(t=0)=>t<zt?xt[t+1].Aa[0]:g(),Ct=(t,i=0)=>i<zt?yt(t,i+1):0,Mt=(t,i=0)=>i<zt?vt(t,i+1):0;function St(t){var i=null!=t.Ta.x?new m(o(-.5,.5),o(-.5,.5)).multiply(t.Ta).rotate(t.angle):((t=1)=>0<t?c(t*o(0/t,1)**.5):new m)(.5*t.Ta);i=new Bt(t.g.add(i),t.F,t.G,t.angle+o(t.qb,-t.qb));const s=t.Nb;var h=(r=t=>t+t*o(s,-s))(t.Mb),e=r(t.bb),a=r(t.Pb),n=r(t.speed),r=r(t.wb)*(2*(0|o(2))-1);const d=o(t.gb,-t.gb),u=l(t.Cb,t.Db,t.sb),g=l(t.Ab,t.Bb,t.sb);i.Ia=u,i.Ha=g.j(u),i.h=w(new m,t.angle+d,n),i.O=r,i.Jb=h,i.bb=e,i.Qb=a-e,i.Ua=t.Ua,i.ka=t.ka,i.ja=t.ja,i.H=t.H,i.Ka=t.Ka,i.ea=t.ea,i.ua=t.ua,i.Ca=t.Ca,i.A=t.A,i.ha=t.ha,i.fb=t.Za,t.Lb&&t.Lb(i)}class jt extends st{constructor(i,s=0,h=0,e=100,a=t,n=-1,r=G,o=new S,c=new S,l=new S(1,1,1,0),d=new S(1,1,1,0),u=.5,g=.1,w=1,f=.1,x=.05,y=1,v=1,b=0,p=t,A=.1,z=.2,D,C,M=1,j=(C?1e9:0)){super(i,new m,n,r),this.Ta=s,this.hb=h,this.P=e,this.gb=a,this.Cb=o,this.Db=c,this.Ab=l,this.Bb=d,this.sb=M,this.Mb=u,this.bb=g,this.Pb=w,this.speed=f,this.wb=x,this.ka=y,this.ja=v,this.ea=b,this.qb=p,this.Ua=A,this.Nb=z,this.ua=D,this.Ca=C,this.A=j,this.ha=this.xa=0}update(){if(this.parent&&super.update(),!this.hb||N-this.U<=this.hb){if(this.P){var t=1/this.P;for(this.xa+=T;0<this.xa;this.xa-=t)St(this)}}else this.o()}T(){}}class Bt extends st{constructor(t,i,s,h){super(t,new m,i,s,h)}T(){var t=s((N-this.U)/this.Jb,1),i=this.bb+t*this.Qb,e=(i=new m(i,i),.5*this.Ua);e=new S(this.Ia.r+t*this.Ha.r,this.Ia.u+t*this.Ha.u,this.Ia.b+t*this.Ha.b,(this.Ia.a+t*this.Ha.a)*(t<e?t/e:1-e<t?(1-t)/e:1));if(this.Ca&&Nt(1),this.ha){var a=this.h.length();const t=this.h.scale(1/a);a*=this.ha,i.y=h(i.x,a),this.angle=t.angle(),Vt(this.g.add(t.multiply(g(0,.5*-a))),i,this.F,this.G,e,this.angle,this.s)}else Vt(this.g,i,this.F,this.G,e,this.angle,this.s);this.Ca&&Nt(void 0),1==t&&(this.color=e,this.size=i,this.fb&&this.fb(this),this.M=1)}}let Ft,It,Tt,Gt,Lt,Pt,Rt,kt,Ht,Et,Kt;function Jt(){Ft=document.createElement("canvas"),It=Ft.getContext("webgl",{antialias:!1}),It.bindTexture(3553,It.createTexture()),It.texImage2D(3553,0,6408,6408,5121,X),Ht=.3/L.x,Et=.3/L.y,Kt&&(document.body.appendChild(Ft),Ft.style=R.style.cssText),Tt=function(){var t=It.createProgram();return It.attachShader(t,Zt("precision lowp float;uniform mat4 m;attribute float a;attribute vec2 p,s,t;attribute vec4 c,b;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4((s*cos(-a)+vec2(-s.y,s.x)*sin(-a))*.5+p,1,1);v=t;d=c;e=b;}",35633)),It.attachShader(t,Zt("precision lowp float;varying vec2 v;varying vec4 d,e;uniform sampler2D j;void main(){gl_FragColor=texture2D(j,v)*d+e;}",35632)),It.linkProgram(t),t}();var t=new ArrayBuffer(14155776);(function(t){var i=It.createBuffer();It.bindBuffer(34962,i),It.bufferData(34962,t,35048)})(t.byteLength),Gt=new Float32Array(t),Lt=new Uint32Array(t),t=(t,s,h,e,a=0)=>{t=It.getAttribLocation(Tt,t),It.enableVertexAttribArray(t),It.vertexAttribPointer(t,e,s,a,36,i),i+=e*h};let i=Rt=Pt=0;t("a",5126,4,1),t("p",5126,4,2),t("s",5126,4,2),t("t",5126,4,2),t("c",5121,1,4,1),t("b",5121,1,4,1),It.texParameteri(3553,10241,9728),It.texParameteri(3553,10240,9728)}function Nt(t){t!=kt&&Ut(),kt=t,It.blendFunc(770,t?1:771),It.enable(3042)}function Zt(t,i){return i=It.createShader(i),It.shaderSource(i,t),It.compileShader(i),i}function Qt(t,i){Ft.width=t,Ft.height=i,It.viewport(0,0,t,i),It.useProgram(Tt),Nt(),t=2*W/t,i=2*W/i,It.uniformMatrix4fv(It.getUniformLocation(Tt,"m"),0,new Float32Array([t,0,0,0,0,i,0,0,1,1,-1,1,-1-t*U.x,-1-i*U.y,0,0]))}function Ut(){Pt&&(It.bufferSubData(34962,0,Gt.subarray(0,216*Pt)),It.drawArrays(4,0,6*Pt),Pt=0)}function Wt(t){var i=k;Rt&&(Ut(),!Kt||t)&&(i.drawImage(Ft,0,kt=Rt=0),It.clear(16384))}function Xt(t,i,s,h,e,a,n,r,o,c,l,d){65536<=Pt&&Ut(),n+=Ht,r+=Et,o-=Ht,c-=Et;var u=54*Pt++-1;s=a?-s:s,Rt=1,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=-s,Gt[++u]=-h,Gt[++u]=n,Gt[++u]=c,Lt[++u]=l,Lt[++u]=d,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=s,Gt[++u]=h,Gt[++u]=o,Gt[++u]=r,Lt[++u]=l,Lt[++u]=d,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=-s,Gt[++u]=h,Gt[++u]=n,Gt[++u]=r,Lt[++u]=l,Lt[++u]=d,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=-s,Gt[++u]=-h,Gt[++u]=n,Gt[++u]=c,Lt[++u]=l,Lt[++u]=d,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=s,Gt[++u]=-h,Gt[++u]=o,Gt[++u]=c,Lt[++u]=l,Lt[++u]=d,Gt[++u]=e,Gt[++u]=t,Gt[++u]=i,Gt[++u]=s,Gt[++u]=h,Gt[++u]=o,Gt[++u]=r,Lt[++u]=l,Lt[++u]=d}const Ot=t=>t.add(g(.5)).j(H.scale(.5)).multiply(g(1/W,-1/W)).add(U);function Vt(t,i=g(1),s=-1,h=G,e=new S,a=0,n,r=new S(0,0,0,0)){var o,c;!i.x|!i.y||(s<0?Xt(t.x,t.y,i.x,i.y,a,0,0,0,0,0,0,C(e)):(o=X.width/h.x|0,c=h.x*P.x,h=h.y*P.y,Xt(t.x,t.y,i.x,i.y,a,n,n=s%o*c,s=(s/o|0)*h,n+c,s+h,C(e),C(r))))}function Yt(t,i=g(1),s,h,e,a){Vt(Ot(t),i.scale(1/W),s,h,e,a,void 0,void 0)}function qt(t){return Ni||r(t.g,t.size,U,rs)}function $t(i,s){!i.W||B(i.V)||i.ib.active()||1==i.I&&N-i.U<2||(s?(i.V.set(i.Fa*o(1.5,1)),s=new jt(g(),1,0,60,t,0,void 0,new S(1,1,0),new S(1,.5,.5),new S(1,0,0),new S(1,.5,.1),.5,.5,.1,.01,.1,.95,.1,-.05,t,.5,.5,0,1),i.Z=s,tt(i,i.Z)):B(i.Ea)||i.Ea.set(i.xb*o(1.5,1)))}function _t(t){return n(F(t.V),.2,1)}function ti(t){t.Z&&0==t.Z.P||(t.ib.set(.1),j(t.V),j(t.Ea),t.Z&&t.Z.o(),t.Z=0)}class ii extends st{constructor(t,i,s,h){super(t,i,s,h,void 0),this.pa=1,this.R=this.W=0,this.xb=.1,this.Fa=3,this.va=new I,this.Ea=new I,this.V=new I,this.ib=new I,this.color=new S,this.ba=new S(0,0,0,0)}update(){var t;(this.parent||this.S||!this.B||qt(this))&&super.update(),this.mb||(!this.i()&&B(this.va)?(t=.5*a(this.va.get(),0,.15),this.ba=new S(t,t,t,0)):this.ba=new S(0,0,0,0)),!this.parent&&this.g.y<-1?(this.K(),this.S||this.o()):this.Fa&&(B(this.V)?N>this.V.time?(this.K(),this.Z&&(this.Z.P=0)):o()<.01&&V(this.g,2,t=>t.pa&&$t(t)):N>this.Ea.time&&$t(this,1))}T(){Vt(this.g,this.size,this.F,this.G,this.color.scale(_t(this),1),this.angle,this.s,this.ba)}C(t,i){if(this.i())return 0;this.va.set();for(const t of this.children)t.va&&t.va.set();return(t=h(this.R-t,0))||this.K(i),this.R-(this.R=t)}i(){return!this.R}K(){this.o()}Y(t){if(t.mb&&this.W){if(Ni)return this.o(),1;$t(this)}return 1}}class si extends ii{constructor(i){var s;super(i),this.type=9*o()**2|0,i=5,this.F=16,(this.la=0)==this.type?(this.color=new S(1,.5,0),this.W=1):2==this.type?(this.color=new S(.9,.9,1),i=10):1==this.type?(this.color=new S(.2,.8,.2),this.W=1,this.la=2,i=1e3):5==this.type?(this.F=17,this.color=new S(.9,.9,1),i=10):3==this.type?(this.F=17,this.color=new S(.2,.8,.2),this.W=1,this.la=2,i=1e3):6==this.type?(this.F=17,this.color=new S(1,.1,.1),this.W=1,this.la=3,this.Fa=o(.5,.1),i=1e3):4==this.type?(this.F=17,this.color=new S(0,.6,1),i=.01):7!=this.type&&8!=this.type||(this.F=18,this.color=z(new S(.8,.8,.8),.2),i=30,this.l*=4,o()<.2&&(i=99,this.l*=4,this.size=this.size.scale(2),this.g.y+=.5),this.Hb=1,8==this.type&&(this.color=new S(1,.9,0),this.ba=new S(1,0,0),this.mb=1)),this.angle=(0|o(4))*t/2,o()<.5&&(s=this.size,this.size=new m(s.y,s.x)),this.s=o()<.5,this.R=i,it(this,1,1)}update(){var t=this.h.L();super.update(),.05<(t=x(this.h.j(t)))&&this.C(2*t)}C(t,i){(this.la||0==this.type&&o()<.1)&&$t(this),super.C(t,i)}K(){this.M||(4==this.type&&function(i){new jt(i,1,.05,400,t,0,void 0,new S(1,1,1,.5),new S(.5,1,1,.2),new S(1,1,1,.5),new S(.5,1,1,.2),.5,.5,2,.1,.05,.9,1,0,t,.5,.5,0,0,0,1e9);const s=new jt(i,1,.1,400,t,0,void 0,new S(.8,1,1,.6),new S(.5,.5,1,.2),new S(.8,1,1,.6),new S(.5,.5,1,.2),2,.1,.1,.2,0,.99,1,.5,t,.2,.5,1);s.H=.2,s.ha=2,V(i,3,t=>{var s;t.pa&&(B(t.V)&&ti(t),s=t.g.j(i).normalize(3*a(y(t.g,i)**.5,1.5,3)*.2).scale(1/t.l),t.h=t.h.add(s),t.i&&t.i()&&(t.O+=(2*(0|o(2))-1)*o(.75,.3)))})}(this.g),this.o(),Si(this.g,this.color.scale(_t(this),1)),this.la?ji(this.g,this.la):q(fi,this.g))}}let hi,ei,ai=new I;class ni extends ii{constructor(t){super(b(t).add(g(.5))),this.A=-1001,this.Gb=1;for(let i=3;i--;)for(let s=6;s--;)nt(t.j(g(i-1,1-s)),s?0:1)}update(){if(qt(this))for(const t of Yi)t&&!t.i()&&y(this.g,t.g)<1&&this.setActive()}setActive(){ei==this||Ni||q(mi,this.g),hi=this.g,ei=this,ai.set(.1)}T(){var t=ei==this?new S(1,0,0):new S,i=Math.sin(4*N+this.g.x);Vt(this.g.add(g(.5,3.2-.03*i)),g(1,.6),14,void 0,t,.06*i),Vt(this.g.add(g(0,1.5)),g(.1,4),-1,G,new S(.9,.9,.9),void 0)}}class ri extends ii{constructor(t){super(t,g(.2),5,g(8)),this.R=1e3,this.eb=new I(1),this.H=.3,this.Ka=.9,this.ja=.96,this.A=1e8,it(this)}update(){super.update(),3<N-this.U?(ji(this.g,3),this.o()):(N>this.eb.time&&(q(Di,this.g),this.eb.set(1)),di(this.g,this.g))}T(){Vt(this.g,g(.5),this.F,this.G,this.color,this.angle);var i=N-this.U;Nt(1),Vt(this.g,g(2),0,g(16),new S(1,0,0,.2-.2*Math.cos(2*i*t))),Vt(this.g,g(1),0,g(16),new S(1,0,0,.2-.2*Math.cos(2*i*t))),Vt(this.g,g(.5),0,g(16),new S(1,1,1,.2-.2*Math.cos(2*i*t))),Nt(0)}}class oi extends st{constructor(t,i){super(t,g(.6),4,g(8)),this.da=this.N=0,this.ab=new I,tt(this,this.Pa=new jt(g(),0,0,0,.1,void 0,void 0,new S(1,.8,.5),new S(.9,.7,.5),new S(1,.8,.5),new S(.9,.7,.5),3,.1,.1,.15,.1,1,.95,1,0,0,.1,1)),this.Pa.H=.5,this.Pa.Za=Ci,this.A=i.A+1,i.J=this,tt(i,this,this.Kb=g(.55,0))}update(){if(super.update(),this.s=this.parent.s,this.da+=T,this.ab.active()&&(this.N=n(F(this.ab),0,this.N)),this.ub)for(var t=.5*(this.parent.Ma?1:.5);0<this.da;this.da-=.125)this.N=-o(.2,.15),this.ab.set(o(.4,.3)),new ci(this.g,this.parent).h=g(_(this,t),0).rotate(o(.1,-.1)),this.Pa.N=-.8*_(this),St(this.Pa),q(wi,this.g),this.parent.Ma&&di(this.g,this.g);else this.da=s(this.da,0)}}class ci extends st{constructor(t,i){super(t,g(0)),this.color=new S(1,1,0,1),this.ob=this.h,it(this),this.C=this.ka=1,this.ea=0,this.I=i.I,this.A=1e9,this.$a=8}update(){this.ob=this.h,super.update(),this.$a-=this.h.length(),this.$a<0?(new jt(this.g,.2,.1,100,t,0,void 0,new S(1,1,0,.5),new S(1,1,1,.5),new S(1,1,0,0),new S(1,1,1,0),.1,.5,.1,.1,.1,1,1,.5,t,.1,.5,0,1),this.o()):V(this.g,this.size,t=>{t.pa&&!t.parent&&t.I!=this.I&&(t.D&&t.D.active()||this.Y(t))})}Y(t){var i;return t.pa&&(t.C(this.C,this),i=this.h.scale(.1).scale(1/t.l),t.h=t.h.add(i),t.Xa?(q(bi,this.g),this.o()):this.K()),1}Sa(t,i){return t<=0?0:(o()<(6==t?1:2==t?.2:.05)&&Ii(i),this.K(),1)}K(){var i;this.M||((i=new jt(this.g,0,.1,100,.5,void 0,void 0,new S(1,1,0),new S(1,0,0),new S(1,1,0),new S(1,0,0),.2,.2,0,.1,.1,1,1,.5,t,.1,.5,1,1)).ha=1,i.angle=this.ob.angle()+t,i.H=.3,this.o())}T(){var t=new S(1,1,1,.5),i=this.h.angle();Vt(this.g,g(.4,.5),-1,G,t,i),t=this.h.angle(),Vt(this.g,g(.2,.5),-1,G,this.color,t)}}class li extends ii{constructor(t){super(t,g(.6,.95).scale(1),32),this.Qa=this.R=this.W=this.Xa=1,this.fa=new I,this.qa=new I,this.$=new I,this.rb=new I,this.D=new I,this.wa=new I,this.Ja=new I,this.Ra=new I,this.m=g(),this.jb=new S(0,0,0,0),this.color=new S,this.ma=new S,this.Da=3,this.Va=2,this.A=10,this.Ya=this.na=this.ia=0,this.kb=new I,it(this)}update(){if(this.Ib=this.g.L(),this.ea=1,this.i()||!qt(this)&&!this.S)super.update();else{var s=this.m.L(),h=0;for(let t=2;t--;){var a=this.g.add(g(0,t+.1*this.m.y-.5*this.size.y));h|=-1==rt(a)}h?this.m.y&&(this.ca=1):this.ca=0,this.D.active()?(this.angle=_(this,2*t*F(this.D)),this.B&&(this.h.x+=_(this,.1)),V(this.g,this.size,t=>{t.Xa&&t.I!=this.I&&!t.i()&&t.C(1,this)})):this.angle=0,this.ca?(this.ea=this.X=this.B=0,j(this.qa),j(this.fa),this.h=this.h.multiply(g(.85)).add(g(0,.02*s.y)),this.h.x+=.02*(.5+(0|this.g.x)-this.g.x)*i(s.x?0:s.y),s.x*=.2,this.ca=0<=s.y||rt(this.g.j(g(0,1)))<=0):((this.B||this.X)&&this.fa.set(.1),!this.fa.active()||this.D.active()||!this.$.active()||this.qa.active()||this.rb.active()||(this.X?this.h.y=.25:(this.h.y=.15,this.qa.set(.2)),this.rb.set(.5),q(yi,this.g)),this.qa.active()&&!this.X&&(j(this.fa),this.La&&0<this.h.y&&this.qa.active()&&(this.h.y+=.017)),this.B||(s.x=(s.x<0?-1:1)==(this.h.x<0?-1:1)?.1*s.x:.2*s.x,this.h.y<0&&(this.h.y+=-.002))),!this.za||this.D.active()||this.wa.active()||(this.D.set(.4),this.wa.set(2),j(this.qa),ti(this),q(vi,this.g),!this.B&&.2<N-this.U&&(this.h.y+=.2)),this.h.x=e(this.h.x+.042*s.x,.2,-.2),s=this.h.L(),super.update(),this.Ma||this.D.active()||.1<(s=x(this.h.j(s)))&&this.C(10*s),this.ca||this.fa.active()&&!this.D.active()?(s=this.h.length(),this.ia+=.5*s,this.ia=.01<s?(this.ia%1+1)%1:0):this.ia=0,this.J.ub=this.lb&&!this.D.active(),this.D.active()||(0<this.na&&this.Oa&&!this.Rb&&!this.kb.active()&&(--this.na,(s=new ri(this.g)).h=this.h.add(g(_(this),o(.8,.7)).normalize(.25+o(.02))),s.O=_(this)*o(.8,.5),q(yi,this.g),this.kb.set(1)),this.Rb=this.Oa),this.m.x&&!this.D.active()&&(this.s=this.m.x<0),this.g.x=e(this.g.x,Hi.x-2,2),o()<.005&&this.Ra.set(o(.2,.1))}}T(){var i,s,h,e;r(this.g,this.size,U,os)&&(this.F=this.i()?this.Da:this.ca||this.fa.active()?this.Da+2*this.ia|0:this.Da+1,i=this.ba.add(this.jb),this.Ma&&!this.i()&&N>this.wa.time&&this.wa.get()<.2&&(s=.6-3*this.wa.get(),i=A(i.add(new S(0,s,s,0)))),s=this.Qa,h=this.color.scale(_t(this),1),e=this.ma.scale(_t(this),1),Vt(this.g.add(g(0,.06*Math.sin(this.ia*t)-.1).scale(s)),g(s),this.F,this.G,h,this.angle,this.s,i),Vt(this.g.add(g(_(this,.05),.46).scale(s).rotate(-this.angle)),g(s/2),this.Va,g(8),h,this.angle,this.s,i),i=this.yb?this.i()?.3:.5+.5*Math.cos(F(this.Ra)*t*2):1,Vt(this.g.add(g(_(this,.05),.46).scale(s).rotate(-this.angle)),g(s/2,i*s/2),this.Va+1,g(8),e,this.angle,this.s,this.ba))}C(t,i){this.M||1==this.I&&N-this.U<2||(this.i()&&!this.S&&(this.Ya+=t,5<this.Ya&&(Mi(this.g,300),this.o())),this.Ra.set(o(.5,.4)),Mi((i||this).g),super.C(t,i))}K(t){this.i()||(Ni?this.o():(this.Ja.set(),this.size=this.size.scale(.5),Mi(this.g,300),q(xi,this.g),this.R=this.I=0,this.O=(t?t.h.x<0?-1:1:2*(0|o(2))-1)*o(.22,.14),this.ja=.9,this.J&&this.J.o(),this.A=1))}Sa(t,i){if(t)return-1==t?i.y+1>this.Ib.y-.5*this.size.y||rt(i.add(g(0,1)))&&(!rt(i.add(g(1,0)))||!rt(i.add(g(1,0))))?void 0:!this.ca:(t=i.y-this.g.y,!this.ca&&.1<this.h.y&&0<t&&t<.5*this.size.y&&Ii(i)?void(this.h.y=0):1)}Y(t){return this.i()||.04<x(t.h)&&(s=25*t.l*x(t.h.j(this.h)),!t.B&&t.Hb&&!this.S&&t.h.y<0&&this.g.y<t.g.y-t.size.y/2&&i(t.g.x-this.g.x)<.5*t.size.x?(this.C(1e3,t),this.i()&&(Mi(this.g,300),this.o())):1<s&&this.C(4*s|0,t)),super.Y(t);var s}}function di(t,i){V(t,4,t=>{2==t.I&&t.alert&&t.alert(i)})}class ui extends li{constructor(t){super(t),this.I=2,this.ga=new I,this.sa=new I,this.ya=new I,this.oa=new I,this.aa=new I,this.Na=12,this.type=u()**3*s(Ei+1,5)|0,t=1+this.type,this.ma=new S(1,.5,0),0==this.type?(this.color=new S(0,1,0),this.size=this.size.scale(this.Qa=.9)):1==this.type?this.color=new S(0,.4,1):2==this.type?(this.color=new S(1,0,0),this.ma=new S(1,1,0)):3==this.type?(this.color=new S(1,1,1),this.ma=new S(1,0,0),this.Na=15):4==this.type&&(this.color=new S(.7,0,1),this.ma=new S(0,0,0),this.na=3,this.W=0),(this.Wa=u()<.05)&&(this.size=this.size.scale(this.Qa=1.3),t*=2,this.na*=10,this.Na=15,--Ji),this.R=t,this.color=z(this.color),this.s=o()<.5,new oi(this.g,this),--Ji,this.Ob=0|o(9)}update(){if(Ni||this.i()||!qt(this))this.J&&(this.J.ub=0),super.update();else{if(this.J&&(this.J.pb=this.J.Kb.scale(this.Qa)),J%9==this.Ob){var t=B(this.ga)&&this.ga.get()<5,s=(t?1.2*this.Na:this.Na)**2;for(const h of Yi)if(h&&!h.i()&&(t||_(this)==(h.g.x-this.g.x<0?-1:1))&&(t||i(h.g.x-this.g.x)>i(h.g.y-this.g.y))&&y(this.g,h.g)<s&&!ct(this.g,h.g)){this.alert(h.g,1);break}t&&di(this.g,this.ta)}this.za=this.X=this.Oa=0,B(this.V)?(j(this.ya),o()<.005&&(this.$.set(.05),this.oa.set(o(.05))),o()<.05&&(this.m.x=(2*(0|o(2))-1)*o(.6,.3)),this.m.y=0,3==this.type?this.za=1:this.B&&(this.za=o()<.005)):B(this.ga)&&this.ga.get()<10?(2<=this.type&&this.m.x&&!this.h.x&&this.h.y<0&&(this.h.y*=.8,this.X=1,this.$.set(.1),this.oa.set(o(.2))),t=this.ga.get(),this.J.N*=.8,this.sa.active()?this.m.x=0:t<5?(this.D.active()||(s=this.ta.x-this.g.x<0?-1:1,4==this.type&&o()<.002&&_(this)==s&&(this.Oa=1),o()<.05&&this.ya.set(o(2,.5)),o()<(this.type<2?5e-4:.005)&&(this.$.set(.1),this.oa.set(o(.2))),o()<(this.Wa?.05:.02)?this.m.x=0:o()<.01&&(this.m.x=o()<.6?s*o(.5,.2):-s*o(.4,.2)),o()<.03&&(this.m.y=o()<.5?0:(2*(0|o(2))-1)*o(.4,.2)),i(this.ta.y-this.g.y)<4&&(!B(this.aa)||1<this.aa.get())&&o()<(0<this.type?.02:.01)&&this.aa.set(this.Wa?o(2,1):.05)),3==this.type&&(this.za=o()<.01&&t<.5)):(o()<.04&&this.ya.set(o(2,.5)),o()<.02?this.m.x=0:o()<.01&&(this.m.x=(2*(0|o(2))-1)*o(.4,.2)),o()<(this.ta.y>this.g.y?.002:.001)&&(this.$.set(.1),this.oa.set(o(.2))),(!B(this.aa)||5<this.aa.get())&&o()<.001&&this.aa.set(o(.2,.1)),this.m.y=e(this.ta.y-this.g.y,.5,-.5))):(o()<.03?this.m.x=0:o()<.005?this.m.x=(2*(0|o(2))-1)*o(.2,.1):o()<.001&&(this.m.x=1e-9*(2*(0|o(2))-1)),this.J.N=n(.1,.7,this.J.N),j(this.sa)),this.Wa&&3!=this.type&&(j(this.$),j(this.oa)),this.lb=this.aa.active(),this.La=this.oa.active(),super.update(),!this.ya.active()||this.D.active()||this.sa.active()||(this.s=this.ta.x<this.g.x)}}alert(t,i){!i&&B(this.ga)||(B(this.sa)||(this.sa.set(o(1,.5)*(0==this.type?2:1)),this.ya.set(o(2,1)),this.B&&o()<.2&&(this.h.y+=.1)),this.ga.set(),this.ta=t)}C(t,i){super.C(t,i),this.i()||(this.alert(i?i.g.j(i.h.normalize()):this.g,1),this.sa.set(o(1,.5)),j(this.aa))}K(t){this.i()||(super.K(t),Ni||++ki)}}class gi extends li{constructor(t,i=0){super(t),this.na=3,this.Fa=2,this.ma=M(.6*-i,1,.5),i&&(this.color=M(.3*i-.3,.5,.5),this.jb=M(.3*i-.3,1,.1,0)),this.Da=5,this.Va=18,this.v=i,this.A=20+10*i,this.Ba=0,this.I=this.S=this.vb=this.yb=this.Ma=1,new oi(this.g,this),(Yi[i]=this).h.y=.2,this.s=i%2,--Li}update(){if(this.i()){if(this.S&&Li)if(1==Yi.length)2<this.Ja.get()&&(this.S=0,new gi(hi,this.v),q(yi,U));else{var t=0;let i=1e3;for(const h of Yi)h&&(i=s(i,h.i()?h.Ja.get():1e3),t|=!h.i()&&.1<N-h.U);2<i&&(t?ai.active()&&(this.S=0,new gi(hi,this.v),q(yi,U)):(this.S=0,new gi(hi.add(g(1-this.v/2,0)),this.v),this.v||q(yi,U)))}super.update()}else if(this.X=0,this.m.x&&!this.h.x&&this.h.y<0&&(this.h.y*=.8,this.X=1),this.m.x=At||this.v?Dt(this.v).x:yt(39)-yt(37),this.m.y=At||this.v?Dt(this.v).y:yt(38)-yt(40),(this.La=!this.v&&yt(38)||Ct(0,this.v))?this.vb&&!this.X||this.$.set(.3):j(this.$),this.vb=this.La,this.lb=!this.v&&(yt(0)||yt(90))||Ct(2,this.v),this.Oa=!this.v&&(yt(2)||yt(67))||Ct(1,this.v),this.za=!this.v&&(yt(1)||yt(88))||Ct(3,this.v),super.update(),this.Ba+=i(this.h.x),.01<i(this.h.x)&&this.fa.active()&&!this.D.active()?1<this.Ba&&(this.Ba=0,q(bi,this.g)):this.Ba=.5,1<Yi.length&&!this.i()&&!r(this.g,this.size,U,cs))if(ct(this.g,g(this.g.x,0)))for(t of Yi)t&&t!=this&&!t.i()&&(this.g=t.g.L(),this.h=g(),q(yi,this.g));else this.K()}}const wi=[,,90,,.01,.03,4,,,,,,,9,50,.2,,.2,.01],fi=[.5,,1e3,.02,,.2,1,3,.1,,,,,1,-30,.5,,.5],xi=[.5,.4,126,.05,,.2,1,2.09,,-4,,,1,1,1,.4,.03],yi=[.4,.2,250,.04,,.04,,,1,,,,,3],vi=[.4,.2,150,.05,,.05,,,-1,,,,,4,,,,,.02],bi=[.3,.1,70,,,.01,4,,,,-9,.1,,,,,,.5],pi=[2,.2,72,.01,.01,.2,4,,,,,,,1,,.5,.1,.5,.02],mi=[.6,0,500,,.04,.3,1,2,,,570,.02,.02,,,,.04],Ai=[.02,,1e3,2,,2,,,,,,,,99],zi=[.01,.3,2e3,2,1,2,,,,,,,1,2,,,,,,.1],Di=[.5,.01,300,,,.02,3,.22,,,-9,.2,,,,,,.5],Ci=t=>{t.B&&function(t,i=g(1),s=0,h=G,e=new S,a=0,n){wt(Pi,t,i,a,n,t=>{var i;s<0?(t.fillStyle=D(e),t.fillRect(-.5,-.5,1,1)):(i=X.width/h.x,t.globalAlpha=e.a,t.drawImage(X,s%i*h.x,(s/i|0)*h.x,h.x,h.y,-.5,-.5,1,1))})}(t.g,t.size,t.F,t.G,t.color,t.angle,t.s)};function Mi(i,s=50){new jt(i,1,.1,s,t,void 0,void 0,new S(1,0,0),new S(.5,0,0),new S(1,0,0),new S(.5,0,0),3,.1,.1,.1,.1,1,.95,.7,t,0,.5,1).Za=Ci}function Si(i,s=new S){var h=s.ra(new S,.5);(i=new jt(i,1,.1,100,t,void 0,void 0,s,h,s,h,3,.2,.2,.1,.05,1,.95,.4,t,0,.5,1)).H=.3,i.Za=Ci}function ji(i,s=2){if(!Ni){for(var h=2*s,e=-s;e<s;++e)for(var n=(s**2-e**2)**.5,r=-n;r<=n;++r)Ii(i.add(g(e,r)),0,0);for(n=-(e=s+1);n<e;++n)for(let t=-(r=(e**2-n**2)**.5);t<r;++t)Fi(b(i.add(g(n,t))));V(i,3*s,t=>{var e=y(t.g,i)**.5;t.pa&&(e<s&&t.C(h),e<1.5*s&&$t(t));e=a(e,s,2*s);var n=t.g.j(i).normalize(e*s*.2).scale(1/t.l);t.h=t.h.add(n),t.i&&t.i()&&(t.O+=(2*(0|o(2))-1)*o(e*s/4,.3))}),q(pi,i),new jt(i,s/2,.2,50*s,t,0,void 0,new S(0,0,0),new S(0,0,0),new S(0,0,0,0),new S(0,0,0,0),1,.5,2,.1,.05,.9,1,-.3,t,.1,.5,0,0,0,1e8),new jt(i,s/2,.1,100*s,t,0,void 0,new S(1,.5,.1),new S(1,.1,.1),new S(1,.5,.1,0),new S(1,.1,.1,0),.5,.5,2,.1,.05,.9,1,0,t,.05,.5,0,1,0,1e9)}}class Bi extends st{constructor(t,i=1,s=0){super(t,g()),this.zb=i,this.Eb=new I(s?.05:o(.3,.1))}update(){N>this.Eb.time&&(Ii(this.g,1,1,this.zb),this.o())}}function Fi(i){var s=rt(i);if(s<=0)s||Pi.setData(i,new lt,1);else if(!(2!=s&3!=s&5!=s&4!=s&1!=s))for(let e=4;e--;)if(rt(i.add(w(g(),e*t/2)))!=s){let t=2==s?g(o(16,8),2):g(16,1);1&e&&(t=new m(t.y,t.x)),Pi.context.fillStyle=D(2==s?z(Wi,.1):new S(.1,.1,.1));var h=i.scale(16);2==s?Pi.context.fillRect(h.x+((1==e?14:0)+(1&e?0:8-t.x/2))|0,Pi.canvas.height-h.y+((0==e?-14:0)-(1&e?8-t.y/2:0))|0,0|t.x,0|-t.y):Pi.context.fillRect(h.x+(1==e?15:0)|0,Pi.canvas.height-h.y+(0==e?-15:0)|0,0|t.x,0|-t.y)}}function Ii(t,i=1,s=1,h=1){t=b(t);var e=rt(t);if(!e)return 1;if(1==e)return 0;var a=t.add(g(.5)),n=Pi.getData(t);if(n){if(Si(a,z(n.color)),i&&q(fi,a),nt(t,0),Pi.setData(t,new lt,1),s)for(i=-1;i<=1;++i)for(s=-1;s<=1;++s)Fi(t.add(g(i,s)));6==e?(h=1,rt(t.add(g(0,-1)))==e&&new Bi(t.add(g(0,-1)),1,1)):2!=e&&(h=0),o()<h&&rt(t.add(g(0,1)))==e&&new Bi(t.add(g(0,1)),.4*h,6==e)}return 1}function Ti(){var i,s;Xi&&(i=U.add(g(o(-40,40),0)),(s=ct(g(i.x,Hi.y),g(i.x,0)))&&s.y>U.y+10&&(i=s),Xi.g=i.add(g(0,20)),o()<.002&&(Xi.P=e(Xi.P+o(200,-200),500),Xi.angle=e(Xi.angle+o(.3,-.3),t+.5,t-.5)),Ni||qi.active()||(qi.set(o(2,1)),q(Oi?Ai:zi,i,20,Xi.P/1e3),o()<.1&&q(zi,i,20,o(Xi.P/1e3))))}let Gi=[];let Li,Pi,Ri,ki,Hi,Ei,Ki,Ji,Ni,Zi,Qi,Ui,Wi,Xi,Oi,Vi,Yi=[],qi=new I,$i=new I,_i=new I,ts=new I;const is=(t,i=0)=>{p(t,et)&&(Vi[(0|t.y)*et.x+t.x|0]=i)},ss=t=>p(t,et)?Vi[(0|t.y)*et.x+t.x|0]:0;function hs(t){5<i(hi.x-t.x)&&(new si(t),u()<.2?(new si(t.add(g(1.02,0))),u()<.2&&new si(t.add(g(.51,1.02)))):u()<.2&&(new si(t.add(g(0,1.02))),u()<.2&&new si(t.add(g(0,2.04)))))}function es(){for(var t of(j(ts),E))t.o();E=[],K=[],Vi=[],et=t=Hi,ht=[];for(var s=ht.length=et.x*et.y;s--;)ht[s]=0;for(var a=s=o(40,60),n=o(.5,-.5),r=0,c=0,l=0,d=0;d<t.x;d++){a+=n=o()<.05?o(.5,-.5):n+(s-a)/1e3,o()<.04&&(a+=o(9,-9)),o()<.03&&(n=o(9,-9),s=e(s+n,80,20),a+=n,n=o(.5,-.5)),--r,o()<.005&&(r=o(7,2)),c+=l,o()<.1&&(c=o(3,-1)),o()<.1&&(c=0),o()<.1&&(l=o(1,-1));c=e(c,3,-1),a=e(a,99,30);for(var w=0;w<t.y;w++){var f=g(d,w),x=0;w<a&&r<=0&&(x=2);var y=w<a+c?2:0;nt(f,x),is(f,y)}}for(t=Hi.x;t--;)for(s=g(o(Hi.x),o(Hi.y-19,19)),a=0|o(9,1);--a;)for(r=0|o(9,1);--r;)nt(s.add(g(a,r)),0);for(t=99;!v;){if(!t--)return 1;hi=g(Hi.x/2+(Hi.x/2-10-u(9))*(u()<.5?-1:1)|0,Hi.y);var v=ct(hi,g(hi.x,0))}for(hi=v.add(g(0,1)),v=99;0<Ji;){if(!(t=!v--))t:{for(a=void 0,t=99;!a;){if(!t--){t=1;break t}s=g(u(Hi.x-40,40),Hi.y),30<i(hi.x-s.x)&&(a=ct(s,g(s.x,0)))}for(s=o()<.5,t=b(a),r=0|u(20,9),a=s?1:0|u(6,1),c=0|u(s?7:4,0),(t=t.j(g(0,6*c))).y=h(t.y,9),c=-c;c<=a;++c){for(d=c==a,l=!c,l=(w=s?o()<.8|(0==c&&o()<.6):0)?0|u(9,2):d?0:l?0|u(9,4):0|u(7,2),n=d?4:h(l-1,0),f=o()<.5,x=o(4,2),y=-r;y<=r;++y){var p=!w&&u()<.3;w||u(),s?f=0:o()<.1&&(f=!f),s&&o()<.2&&(l=e(l+o(3,-3)|0,9,2));for(let i=-1;i<l;++i){var m,A=t.add(g(y,i));let s=0;w?(i<0|i==l-1&&(s=2),is(A,2)):((m=i<0|i==l-1)&&(s=4),(y<0?-y:y)==r&&(s=m?3:p?6:5),m=0<s||l<3?7:3,f&&0<i&&i<l-x&&(y<0?-y:y)<r-2&&(m=8),is(A,m)),nt(A,s)}}if(!s||!d)for(w=u(2)+1|0;w--;)for(f=0|u(r-1,1-r),t.add(g(f,-2)),x=0;x<Hi.y&&!((y=t.add(g(f,-x-1))).y<2);++x)if(x&&0<rt(y)&&rt(y.add(g(0,1)))<=0){for(;x--;)y=t.add(g(f,-x-1)),nt(y,-1);break}for(f=w=0|u(r/2);f--;)hs(t.add(g(u(r-2,2-r),.5)));if(d||1<n)for(d=w;d--;)n=t.add(g(u(r-1,1-r),.7)),new ui(n);d=r,r=0|h(r+u(8,-8),9),t.y+=l,t.x+=0|u(d-r+1)}for(s=20;0<Ji&&s--;)(a=ct(r=g(t.x+u(99,-99),Hi.y),g(r.x,0)))&&20<i(hi.x-r.x)&&(a=a.add(g(0,2)),u()<.7?new ui(a):hs(a));t=void 0}if(t)return 1}for(t=0;t<Hi.x-9;)t+=o(100,70),(v=ct(s=g(t,Hi.y),g(s.x,0)))&&50<i(hi.x-s.x)&&(v=v.add(g(0,1)),new ni(v))}function as(){for(Li+=4,Ji=15+s(30*Ei,300),++Ei,Ki=d=0|o(1e9),Hi=g(s(99*Ei,400),200),Zi=l(new S(.2,.2,.2),new S(.8,.8,.8)),Qi=l(new S(.5,.5,.5),new S(.9,.9,.9)),Ui=A(z(Qi.j(new S(.05,.05,.05)),.3)),Wi=A(z(Zi).add(new S(.3,.3,.3)));es(););Ni=1;const i=new ni(hi).setActive();!function(){Pi=new ft(Hi),Pi.A=-1e3;for(var i=Hi.x;i--;)for(var s=Hi.y;s--;){var h,e,a,n,r=g(i,s),c=rt(r);c&&(h=0|o(4),e=0|o(2),a=void 0,n=8,2==c?(n=10+2*o()**3|0,a=z(Zi,.03)):4==c?(n=13,h=1):5==c?(n=13,h=0):6==c?(n=13,h=0,a=new S(0,1,1,.5)):3==c?n=12:-1==c&&(n=15,h=e=0),Pi.setData(r,new lt(n,h,e,a)))}for(ut(i=Pi),gt(i),Wt(1),[H,R,k,W,U]=i.tb,Ri=new ft(Hi),Ri.A=-2e3,i=Hi.x;i--;)for(s=Hi.y;s--;)r=g(i,s),(c=ss(r))&&(h=0|o(4),e=0|o(2),a=new S,n=8,2==c?(n=10+2*o()**3|0,a=z(Zi)):3==c?(n=14,a=a.scale(o(1,.7),1)):7==c?(n=14,a=z(a.scale(o(.5,.3),1))):8==c&&(n=0,a=new S(0,1,1,.5)),Ri.setData(r,new lt(n,h,e,a.scale(.4,1))));for(ut(i=Ri),gt(i),Wt(1),[H,R,k,W,U]=i.tb,s=Hi.x;s--;)for(r=Hi.y;--r;){if(i=g(s,r),(c=ss(i))<=0)c||Ri.setData(i,new lt,1);else for(c=4;c--;)0<(h=ss(i.add(w(g(),c*t/2))))|0<(e=ss(i.add(w(g(),(c+1)%4*t/2))))||(h=b(w(g(),c*t/2+t/4,10)),h=b(i.add(g(.5)).scale(16).add(h)),Ri.context.clearRect(h.x-1|0,Ri.canvas.height-h.y-1|0,2,2));Fi(g(s,r))}for(Gi=[],i=0;i<3;++i)for(s=g(600,300),r=o(99,120)+30*i,c=Gi[i]=new ft(s),h=r,e=o(1,-1),c.A=-3e3+i,c.canvas.width=s.x,a=z(Zi,.2).ra(Qi,.95-.15*i),(n=c.context.fillStyle=c.context.createLinearGradient(0,0,0,c.canvas.height=s.y)).addColorStop(0,D(a)),n.addColorStop(1,D(A(z(a.j(new S(1,1,1,0)),.1)))),a=s.x;a--;)c.context.fillRect(a,h+=e=o()<.05?o(1,-1):e+(r-h)/2e3,1,s.y);ns||((Oi=o()<.5)?(Xi=new jt(g(),3,0,0,.3,0,void 0,new S(.8,1,1,.6),new S(.5,.5,1,.2),new S(.8,1,1,.6),new S(.5,.5,1,.2),2,.1,.1,.2,0,.99,1,.5,t,.2,.5,1),Xi.H=.2,Xi.ha=2):Xi=new jt(g(),3,0,0,.5,0,void 0,new S(1,1,1,.8),new S(1,1,1,.2),new S(1,1,1,.8),new S(1,1,1,.2),3,.1,.1,.3,.01,.98,1,.2,t,.2,.5,1),Xi.P=o()<.5?o(500):0,Xi.angle=t+o(.5,-.5))}();for(let t=120;t--;)Ti(),O();V(Ni=0,0,t=>{t.pa&&t!=i&&(t.Gb?0<ss(t.g):ot(t.g,t.size))&&t.o()}),_i.set(),Yi=[],new gi(hi)}const ns=Kt=!window.chrome;let rs,os,cs;!function(){X.onload=()=>{P=f(g(1),L=g(X.width,X.height)),document.body.appendChild(R=document.createElement("canvas")),document.body.style="margin:0;overflow:hidden;background:#000",R.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);image-rendering:crisp-edges;image-rendering:pixelated",k=R.getContext("2d"),Jt(),j(ts),$i.set(ki=Ei=0),as(Li=6),W=64,t()};const t=(i=0)=>{requestAnimationFrame(t),document.hasFocus()||(xt[0].length=0);var n=i-Z;for(Z=i,Q+=n,Ot(pt),function(){if(navigator.getGamepads&&document.hasFocus()){var t,i=navigator.getGamepads();for(let s=zt=0;s<navigator.getGamepads().length;++s){const h=i[s];let e=xt[s+1];e||(e=xt[s+1]=[],e.Aa=[g(),g()]),h&&2<=h.axes.length&&(zt=s+1,t=t=>.3<t?a(t,.8,.3):t<-.3?-a(-t,.8,.3):0,e.Aa[0]=g(t(h.axes[0]),t(-h.axes[1])),Ct(12,s)|Ct(13,s)|Ct(14,s)|Ct(15,s)&&(e.Aa[0]=g(Ct(15,s)-Ct(14,s),Ct(12,s)-Ct(13,s))),e.Aa[0]=v(e.Aa[0]),h.buttons.map((t,i)=>{xt[s+1][i]=t.pressed?{d:1,p:!Ct(i,s)}:xt[s+1][i]={r:Ct(i,s)},At|=t.pressed&&!s}))}}}(),i=0,Q<0&&-9<Q&&(i=Q,Q=0),Q=Q<50?Q:50;0<=Q;Q-=1e3/60)for(var r of((()=>{os=g(R.width,R.height).scale(1/W).add(g(5)),cs=g(R.width,R.height).scale(.015625),rs=cs.add(g(30));let t=1e3;for(const i of Yi)t=s(t,i&&i.i()?i.Ja.get():0);(3<t&&(vt(90)||vt(32)||Mt(0))||vt(82))&&(j(ts),$i.set(ki=Ei=0),as(Li=6)),3<ts.get()&&as()})(),O(),(()=>{if(1==Yi.length){var t=Yi[0];t.i()||(U=U.ra(t.g,e((N-t.U)/2)))}else{t=g();let i=0;for(const s of Yi)s&&!s.i()&&(++i,t=t.add(s.g.add(g(0,1))));i&&(U=U.ra(t.scale(1/i),.2))}for(t=4;t--;)Yi[t]||!Mt(0,t)&&!Mt(1,t)||(++Li,new gi(hi,t));t=R.width/2/W+1,U.y=h(U.y,R.height/2/W+2),2*t<et.x&&(U.x=e(U.x,et.x-t,t)),Gi.forEach((t,i)=>{var s=4+i;i=g(150,30).scale(i*i+1),i=f(U.j(Hi.scale(.5)),f(Hi.scale(-.5),i)),t.scale=g(s/W),t.g=U.j(t.size.multiply(t.scale).scale(.5)).add(i.scale(1/W)).j(g(0,150/W))}),Ti()})(),xt))r.map(t=>t.r=t.p=0);Q+=i,R.width=innerWidth<1920?innerWidth:1920,R.height=innerHeight<1200?innerHeight:1200,H=g(R.width,R.height),k.imageSmoothingEnabled=!1,Qt(R.width,R.height),(()=>{var t=k.createLinearGradient(0,0,0,R.height);for(t.addColorStop(0,D(Qi)),t.addColorStop(1,D(Ui)),k.fillStyle=t,k.fillRect(0,0,R.width,R.height),d=Ki,t=ns?400:1e3;t--;){let s=u(6,1);var i=.9>u()?u(5):u(99,9);let h=M(u(.2,-.3),u()**9,u(1,.5),u(.9,.3));9>t&&(s=99*u()**3+9,i=u(5),h=A(M(u(),u(),u(1,.5)).add(Qi.scale(.5))));const e=R.width+400,a=R.height+400;i=g((u(e)+N*i)%e-200,(u(a)+N*i*u(1,.2))%a-200),ns?(k.fillStyle=D(h),9>s?k.fillRect(i.x,i.y,s,s):(k.beginPath(),k.arc(i.x,i.y,s,0,9),k.fill())):Yt(i,g(s),0,g(16),h)}})(),E.sort((t,i)=>t.A-i.A);for(const t of E)t.M||t.T();Wt(),(()=>{k.textAlign="center";var t,i=a($i.get(),8,10);for(t of(k.fillStyle=D(new S(0,0,0,i)),0<i&&(k.font="1.5in impact",k.fillText("SPACE HUGGERS",R.width/2,140)),k.font=".5in impact",0<i&&k.fillText("A JS13K Game by Frank Force",R.width/2,210),i=0,K))if(t.Xa&&2==t.I){++i;var s=t.size.scale(20),h=t.color.scale(1,.6);Yt(g(R.width/2+30*(t.g.x-U.x),R.height-20),s,-1,G,h,void 0)}i||B(ts)||ts.set(),k.fillStyle=D(new S(0,0,0)),k.fillText("Level "+Ei+"      Lives "+Li+"      Enemies "+i,R.width/2,R.height-40),t=B(ts)?a(ts.get(),3,1):a(_i.get(),.5,2),Vt(U,g(1e3),-1,G,new S(0,0,0,t),void 0)})(),Wt()};X.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABABAMAAAAg+GJMAAAAJ1BMVEUAAAD///+AgID/AAAAAACJT6T/dwBIG11mlD2i91azs7PZ2dlAQEA9UPniAAAAAXRSTlMAQObYZgAAAoRJREFUeNqsk8dZw0AQhWfNiHDbARfgVAB0sNI3LTgcfSLcbasC0o0j6panHIYMT+FX+p8y/UdECJnNJlTn6PJnft4wEvHFasCkis2JakItl9dpemjZxgniywInnhX2hWAxXug0NIwKcduwjRTpF8hVLp7PJDSEuE5X24ofFZAQV7cAEZtDQ4jLJcSKgzuAXD8DDuVDdGOFmWjNaPN0v1zdPtU0BTSIi8cQY60ZPWcQ715r2oIzeqFupBQbZqVY0xY8PT1RN6zIh7QP8TTL+lcwmiE1megkRagif1DgvB8WsAILbQpYgZ2aD8kWsGLMUSybdfMpm1tgDRiJzfr7P5MteGufDpXchoE4jGcKj32C2oBKsM5jlPUlT4VKyN9TdFuSwKsfqrLHTcE5ucQgKL8H+GZW2n0YZptZKUXSXhIUic4nfa4OXrPPNmXTxI8BwzCBFcP6DjGxfwFmmwIwBv548/sccBJqPGRK10uYu5YCtRkD/r3xc8AEELDOk6ZAn3OHXR7h19D8OAckE3ukFiAkyb7V+lPXAqecd/8DYCSAkAGK+r37W3fhDZYCQqg4ICS/HKjNQsACbuYYRHLmHLh1BFfRHikKevd0dwATAQzTW3Dv7n8DKCrsZSF51wLh2hssfCOGQTLoegvZrn/j0iIlVEyKLSDjk0VaWGVjZERCQpHLqwywcEzIlbCChLArx1SbpQBgjITB5+f88l6bw+tLnbzW2eZWJQGEOMwKk3hz4JQnuy8FIH4tw+T2QNkNzSmeA0eA7T0BgFMc8mQox9qsCiQIY+AwDO/bNSOk4zaMIxxyvi8AMAW2xwcH1o+w/hHXf+P6RVq/yo86pjXn/PT09LTsL3dlHSBbTLmdAAAAAElFTkSuQmCC"}()</script>
