<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=no"><title>Couch 2048</title><style>#container,#menu{position:absolute}#end,#home,#load,.opt,.opt::after,.opt::before{box-sizing:border-box}body,html{background:#263238;height:100%;margin:0;overflow:hidden;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}#container>*,label{-moz-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}#backcanvas,#canvas,#end,#home,#load{display:block;height:100%;left:0;position:absolute;top:0;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);width:100%}#backcanvas{background:#455a64}#end,#home,#load{background:rgba(0,0,0,.5);color:#fff;cursor:default;font:300 64px/96px 'Segoe UI','Helvetica Neue',sans-serif;height:1080px;padding:0 100px;transform-origin:0 0;width:1920px}#load+#home{display:none}#end>*,#home>*,#load>*{margin:40px 0}h1{font:300 96px/1 'Segoe UI','Helvetica Neue',sans-serif;margin-top:80px;text-shadow:2px 0 0 red,-2px 0 0 #0ff}p{text-shadow:1px 0 0 red,-1px 0 0 #0ff}#reset,#start{-webkit-animation:blink .7s steps(2,start) infinite;animation:blink .7s steps(2,start) infinite;background:#e1ff5f;border-radius:2px;color:#202020;cursor:pointer;display:inline-block;font-size:48px;font-weight:700;outline:4px;outline-offset:4px;padding:40px 120px}#reset:hover,#start:hover,.opt::after{background:#fff}@-webkit-keyframes blink{to{outline:#E1FF5F solid 4px}}@keyframes blink{to{outline:#E1FF5F solid 4px}}#menu{right:0;top:0;transform:translate3d(0,0,0);width:550px}.opt{-webkit-appearance:none;height:48px;margin:0 10px;outline:0;position:relative;width:80px}.opt::after,.opt::before{border-radius:100px;content:'';display:inline-block;transition:all .2s}.opt::after{border:2px solid #607d8b;height:40px;left:4px;position:absolute;top:4px;width:40px}.opt::before{background:#b0bec5;height:48px;width:80px}.opt:checked::after{left:36px}.opt:checked::before{background:#c6ff00}label{color:#eeff41}body.mobile #menu>*{display:none}#q{display:inline-block!important}#q+label{display:inline!important}</style><div id=container><canvas id=backcanvas></canvas><canvas id=canvas></canvas><div id=load><h1>Loading</h1></div><div id=home><h1>Couch 2048</h1><p><b>How to play:</b><br>⭐️ Drag pieces around<br>⭐️ Stack those with the same number<br>⭐️ Get to 2048 to win the game<br>⭐️ REVEL IN GLORY <small>(optional but recommended)</small><div id=start>NEW GAME</div><div id=menu><input type=checkbox class=opt id=m checked=checked><label for=m>Music</label><br><input type=checkbox class=opt id=s checked=checked><label for=s>Sound FX</label><br><input type=checkbox class=opt id=q checked=checked><label for=q>High Quality</label></div></div><div id=end style=display:none><h1>You win</h1><p><b>Let's party!</b><br><small>Success is commemorated; failure merely remembered</small><br>Written for js13kGames–2016<div id=reset>PLAY AGAIN</div></div></div><script>!function(){function t(){this.A=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;.01>this.c&&(this.c=.01),.18>(t=this.b+this.c+this.e)&&(t=.18/t,this.b*=t,this.c*=t,this.e*=t)}}var e=new function(){var e,n,o,r,s,i,a,c,f,l,h,_;this.z=new t,this.reset=function(){var t=this.z;r=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),i=1-.01*t.h*t.h*t.h,a=1e-6*-t.i*t.i*t.i,t.a||(h=.5-t.n/2,_=5e-5*-t.o),c=1+t.l*t.l*(0<t.l?-.9:10),f=0,l=1==t.m?0:2e4*(1-t.m)*(1-t.m)+32},this.C=function(){this.reset();var t=this.z;return e=1e5*t.b*t.b,n=1e5*t.c*t.c,o=1e5*t.e*t.e+12,3*((e+n+o)/3|0)},this.B=function(t,u){var d=1!=(O=this.z).s||O.v,v=.1*O.v*O.v,p=1+3e-4*O.w,x=.1*O.s*O.s*O.s,y=1+1e-4*O.t,m=1!=O.s,w=O.x*O.x,g=O.g,q=O.q||O.r,b=.2*O.r*O.r*O.r,E=O.q*O.q*(0>O.q?-1020:1020),M=O.p?32+(2e4*(1-O.p)*(1-O.p)|0):0,L=O.d,k=O.j/2,P=.01*O.k*O.k,S=O.a,T=e,B=1/e,A=1/n,D=1/o;.8<(O=5/(1+20*O.u*O.u)*(.01+x))&&(O=.8);for(var I,C,N,F,U,O=1-O,j=!1,z=0,R=0,H=0,W=0,V=0,X=0,Y=0,G=0,J=0,K=0,Q=Array(1024),Z=Array(32),$=Q.length;$--;)Q[$]=0;for($=Z.length;$--;)Z[$]=2*Math.random()-1;for($=0;$<u;$++){if(j)return $;if(M&&++J>=M&&(J=0,this.reset()),l&&++f>=l&&(l=0,r*=c),(r*=i+=a)>s&&(r=s,0<g&&(j=!0)),C=r,0<k&&(K+=P,C*=1+Math.sin(K)*k),8>(C|=0)&&(C=8),S||(0>(h+=_)?h=0:.5<h&&(h=.5)),++R>T)switch(R=0,++z){case 1:T=n;break;case 2:T=o}switch(z){case 0:H=R*B;break;case 1:H=1+2*(1-R*A)*L;break;case 2:H=1-R*D;break;case 3:H=0,j=!0}q&&(0>(N=0|(E+=b))?N=-N:1023<N&&(N=1023)),d&&p&&(1e-5>(v*=p)?v=1e-5:.1<v&&(v=.1)),U=0;for(var tt=8;tt--;){if(++Y>=C&&(Y%=C,3==S))for(I=Z.length;I--;)Z[I]=2*Math.random()-1;switch(S){case 0:F=Y/C<h?.5:-.5;break;case 1:F=1-Y/C*2;break;case 2:F=.225*((0>(F=1.27323954*(F=6.28318531*(.5<(F=Y/C)?F-1:F))+.405284735*F*F*(0>F?1:-1))?-1:1)*F*F-F)+F;break;case 3:F=Z[Math.abs(32*Y/C|0)]}d&&(I=X,0>(x*=y)?x=0:.1<x&&(x=.1),m?(V+=(F-X)*x,V*=O):(X=F,V=0),W+=(X+=V)-I,F=W*=1-v),q&&(Q[G%1024]=F,F+=Q[(G-N+1024)%1024],G++),U+=F}U*=.125*H*w,t[$]=1<=U?32767:-1>=U?-32768:32767*U|0}return u}};window.SOUND=function(t){e.z.A(t);var n=e.C();t=new Uint8Array(4*((n+1)/2|0)+44),n=2*e.B(new Uint16Array(t.buffer,44),n),(o=new Uint32Array(t.buffer,0,44))[0]=1179011410,o[1]=n+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=n,n+=44;for(var o=0,r="data:audio/wav;base64,",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";o<n;o+=3){var i=t[o]<<16|t[o+1]<<8|t[o+2];r+=s[i>>18]+s[i>>12&63]+s[i>>6&63]+s[63&i]}return r}}(),function(){function t(){S.clearRect(0,0,q,b),S.save(),S.shadowColor="rgba(0,0,0,0.4)",S.shadowBlur=25,g.paint(S,"#0091EA"),S.shadowColor="#000",S.translate(0,1),Z.paint(S,"rgba(55,71,79,0.4)"),$.paint(S,"rgba(55,71,79,0.4)"),tt.paint(S,"rgba(55,71,79,0.4)"),S.restore()}function e(t,e,n){t.style[e]=n+"px"}function n(){var t=window.innerWidth,n=window.innerHeight;t/n>E?t=n*E:n=t/E,M=q/t,e(L,"width",t),e(L,"height",n),e(L,"left",.5*(window.innerWidth-t)),e(L,"top",.5*(window.innerHeight-n));var o=.5*t/q,r="scale3d("+o+","+o+",1)";N.style[B]=r,U.style[B]=r}function o(t){var e=t.target;"INPUT"!=e.tagName&&"LABEL"!=e.tagName&&(t.preventDefault(),t.stopPropagation())}function r(){L.removeChild(N),l.play("new"),(h||M>1)&&document.body.requestFullscreen&&document.body.requestFullscreen()}function s(){U.style.display="none",l.play("new"),W=[],V=[],X=[],Y=null,ot.dragging=!1,a()}function i(){return(.3*Math.random()+.35)*q}function a(){for(var t=2;t<=2048;t*=2)K[t]=0;Z=new v(280,480,400,60),$=new v(220,420,60,120),tt=new v(680,420,60,120),new u(Z,Z.handle0,$.handle0,.1),new u(Z,Z.handle1,tt.handle1,.1);var e=.5*b;new x(.35*q,e),new x(.65*q,e)}function c(t){ot.x=(t.clientX-L.offsetLeft)*M,ot.y=(t.clientY-L.offsetTop)*M}var f=function(){function t(){this.on=!0,this.sounds={}}return t.prototype.add=function(t,e,n){this.sounds[t]={tick:0,count:e,pool:[]};for(var o=0;o<e;++o){var r=new Audio;r.src=window.SOUND(n),this.sounds[t].pool.push(r)}},t.prototype.play=function(t){if(this.on){var e=this.sounds[t];e.pool[e.tick].play(),++e.tick>=e.count&&(e.tick=0)}},t}(),l=new f,h=null!=navigator.userAgent.match(/Android|iPhone|iPad/i);h?l.on=!1:(l.add("bip",9,[1,,.1241,,.1855,.5336,,,,,,,,,,,,,1,,,.1,,.64]),l.add("die",4,[1,.0013,.3576,.0681,.8007,.5117,,-.3453,.0049,.148,-.2563,-.2717,.2608,,-.3543,-.1884,-.0106,-.0281,.9971,-.6629,-.7531,.0097,-.0086,.5]),l.add("new",2,[1,,.2548,,.1007,.7539,.0996,-.5302,,,,,,.7769,-.4436,,,,1,,,,,.5]),l.add("win",1,[1,.0309,.5597,.0464,.7472,.369,,-.1366,,-.3111,,-.1581,-.8665,,-.0414,.2802,.0258,-.1198,.9955,.1759,,,-5e-4,.64]));var _=function(){function t(t){void 0===t&&(t=1),this.vertices=[],this.positions=[],this.constraints=[],this.boundaries=[],this.center=new w,this.halfExtents=new w,this.mass=t}return t.prototype.boundingBox=function(){for(var t=99999,e=99999,n=-99999,o=-99999,r=0,s=this.positions;r<s.length;r++){var i=s[r];i.x<t&&(t=i.x),i.y<e&&(e=i.y),i.x>n&&(n=i.x),i.y>o&&(o=i.y)}this.center.set(.5*(t+n),.5*(e+o)),this.halfExtents.set(.5*(n-t),.5*(o-e))},t.prototype.project=function(t){this._min=99999,this._max=-99999;for(var e=0,n=this.positions;e<n.length;e++){var o=n[e].dot(t);o<this._min&&(this._min=o),o>this._max&&(this._max=o)}},t.prototype.drag=function(){if(ot.dragging&&!Y&&T.isPointInPath(ot.x,ot.y))for(var t=99999,e=0,n=this.vertices;e<n.length;e++){var o=n[e],r=o.position.distance(ot);r<t&&(t=r,Y=o)}},t}(),u=function(){function t(t,e,n,o,r){void 0===r&&(r=!1),this.parent=t,this.v0=e,this.v1=n,this.p0=e.position,this.p1=n.position,this.length=this.p0.distance(this.p1),this.stiffness=o,this.isBoundary=r,t.constraints.push(this),r&&t.boundaries.push(this),X.push(this)}return t.prototype.solve=function(){G.setSubtract(this.p0,this.p1);var t=G.length();t&&(G.multiplyScalar(this.stiffness*(this.length-t)/t),this.p0.add(G),this.p1.subtract(G))},t}(),d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},v=function(t){function e(n,o,r,s,i){void 0===i&&(i=!0),t.call(this,250);var a=this.handle0=new y(this,n,o+e.chamfer),c=new y(this,n+e.chamfer,o),f=new y(this,n+r-e.chamfer,o),l=this.handle1=new y(this,n+r,o+e.chamfer),h=new m(this,n+r,o+s),_=new m(this,n,o+s);new u(this,a,c,.1,!0),new u(this,c,f,.1,!0),new u(this,f,l,.1,!0),new u(this,l,h,.1,!0),new u(this,h,_,.1,!0),new u(this,_,a,.1,!0),new u(this,a,l,.1),new u(this,a,h,.1),new u(this,c,h,.1),new u(this,c,_,.1),new u(this,f,h,.1),new u(this,f,_,.1),new u(this,l,_,.1),i&&W.push(this)}return d(e,t),e.prototype.paint=function(t,e){t.beginPath();var n=this.positions[0],o=this.positions[1];t.moveTo(.5*(n.x+o.x),.5*(n.y+o.y));for(var r=1;r<=6;++r)4!=r&&5!=r?(n=this.positions[r%6],o=this.positions[(r+1)%6],t.quadraticCurveTo(n.x,n.y,.5*(n.x+o.x),.5*(n.y+o.y))):t.lineTo(this.positions[r].x,this.positions[r].y);t.fillStyle=e||"#00B0FF",t.fill()},e.prototype.paintLow=function(t,e){t.beginPath();for(var n=0,o=this.positions;n<o.length;n++){var r=o[n];t.lineTo(r.x,r.y)}t.fillStyle=e||"#00B0FF",t.fill()},e.chamfer=10,e}(_),p=(d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},{});["eee4da","ede0c8","f2b179","f59563","f67c5f","f65e3b","edcf72","edcc61","edc850","edc53f","edc22e"].forEach(function(t,e){p[Math.pow(2,e+1)]="#"+t});var x=function(t){function e(e,n,o,r){void 0===n&&(n=-40),void 0===o&&(o=2),void 0===r&&(r=!0),t.call(this,1+.2*Math.log10(o)),++K[this.n=o],this.r=40+4*(Math.log2(o)-1),this.font="bold "+(.1*this.r+28)+"px 'Segoe UI','Helvetica Neue',sans-serif";for(var s=function(t){return Math.min(.04*Math.PI*t<<1,16)}(this.r),i=2*Math.PI/s,a=0;a<s;++a){var c=a*i;new y(this,e+this.r*Math.cos(c),n+this.r*Math.sin(c))}for(a=0;a<s-1;++a)for(var f=a+1;f<s;++f)new u(this,this.vertices[a],this.vertices[f],.005,f==a+1);r&&(this.boundingBox(),W.push(this))}return d(e,t),e.prototype.paint=function(t){t.beginPath();var e=this.positions[0],n=this.positions[1];t.moveTo(.5*(e.x+n.x),.5*(e.y+n.y));for(var o=1;o<=this.positions.length;++o)e=this.positions[o%this.positions.length],n=this.positions[(o+1)%this.positions.length],t.quadraticCurveTo(e.x,e.y,.5*(e.x+n.x),.5*(e.y+n.y));t.fillStyle=p[this.n],t.fill(),t.save(),t.translate(this.center.x,this.center.y),t.rotate(Math.atan2(e.y-this.center.y,e.x-this.center.x)),t.font=this.font,t.fillStyle=this.n>4?"#f9f6f2":"#776e65",t.fillText(""+this.n,0,0),t.restore(),this.drag()},e.prototype.paintLow=function(t){t.beginPath();var e=this.boundaries[0].p0;t.moveTo(e.x,e.y);for(var n=0,o=this.boundaries;n<o.length;n++){var r=o[n].p1;t.lineTo(r.x,r.y)}t.fillStyle=p[this.n],t.fill(),t.save(),t.translate(this.center.x,this.center.y),t.rotate(Math.atan2(e.y-this.center.y,e.x-this.center.x)),t.font=this.font,t.fillStyle=this.n>4?"#f9f6f2":"#776e65",t.fillText(""+this.n,0,0),t.restore(),this.drag()},e}(_),y=function(){function t(t,e,n){this.parent=t,this.position=new w(e,n),this.oldPosition=new w(e,n),t.vertices.push(this),t.positions.push(this.position),V.push(this)}return t.prototype.integrate=function(){var t=this.position,e=this.oldPosition,n=t.x,o=t.y;t.x+=t.x-e.x,t.y+=t.y-e.y+j,e.set(n,o),t.y<-100?t.y=-100:t.y>=P.height+250&&(t.x-=(t.x-e.x)*H,t.y=P.height-1),t.x<0?t.x=0:t.x>=P.width&&(t.x=P.width-1)},t}(),m=(d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},function(t){function e(e,n,o){t.call(this,e,n,o),this.x=n,this.y=o}return d(e,t),e.prototype.integrate=function(){this.position.set(this.x,this.y),this.oldPosition.set(this.x,this.y)},e}(y)),w=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){this.x=t,this.y=e},t.prototype.setTo=function(t){this.x=t.x,this.y=t.y},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.setSubtract=function(t,e){this.x=t.x-e.x,this.y=t.y-e.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.multiplyScalar=function(t){this.x*=t,this.y*=t},t.prototype.setMultiplyScalar=function(t,e){this.x=t.x*e,this.y=t.y*e},t.prototype.setNormal=function(t,e){var n=t.y-e.y,o=e.x-t.x,r=Math.sqrt(n*n+o*o);if(r<Number.MIN_VALUE)return this.x=n,void(this.y=o);var s=1/r;this.x=n*s,this.y=o*s},t}(),g=null,q=960,b=540,E=16/9,M=1,L=document.getElementById("container"),k=document.getElementById("backcanvas"),P=document.getElementById("canvas"),S=k.getContext("2d"),T=P.getContext("2d"),B="transform";B in L.style||(B="webkitTransform"),k.width=P.width=q,k.height=P.height=b,T.lineWidth=2,T.textAlign="center",T.textBaseline="middle",window.addEventListener("resize",n),window.addEventListener("orientationchange",n),P.addEventListener("contextmenu",function(t){t.preventDefault()});var A=function(){var t,e,n,o=new w;return[function(r,s){if(Math.abs(s.center.x-r.center.x)-(r.halfExtents.x+s.halfExtents.x)>=0||Math.abs(s.center.y-r.center.y)-(r.halfExtents.y+s.halfExtents.y)>=0)return!1;t=99999;for(var i=0,a=[r,s];i<a.length;i++)for(var c=0,f=a[i].boundaries;c<f.length;c++){var l=f[c];if(G.setNormal(l.p0,l.p1),r.project(G),s.project(G),(v=r._min<s._min?s._min-r._max:r._min-s._max)>0)return!1;(v*=-1)<t&&(t=v,o.setTo(G),e=l)}if(e.parent!=s){var h=r;r=s,s=h}G.setSubtract(r.center,s.center),G.dot(o)<0&&o.multiplyScalar(-1);for(var _=99999,u=0,d=r.vertices;u<d.length;u++){var v,p=d[u];G.setSubtract(p.position,s.center),(v=o.dot(G))<_&&(_=v,n=p)}return!0},function(){var r=e.p0,s=e.p1,i=e.v0.oldPosition,a=e.v1.oldPosition,c=n.position,f=n.oldPosition;G.setMultiplyScalar(o,t);var l=Math.abs(r.x-s.x)>Math.abs(r.y-s.y)?(c.x-G.x-r.x)/(s.x-r.x):(c.y-G.y-r.y)/(s.y-r.y),h=1/(l*l+(1-l)*(1-l)),_=n.parent.mass,u=e.parent.mass,d=_+u;u/=d;var v=(1-l)*h*(_/=2*d),p=l*h*_;r.x-=G.x*v,r.y-=G.y*v,s.x-=G.x*p,s.y-=G.y*p,c.x+=G.x*u,c.y+=G.y*u,G.set(c.x-f.x-.5*(r.x+s.x-i.x-a.x),c.y-f.y-.5*(r.y+s.y-i.y-a.y)),J.set(-o.y,o.x),G.setMultiplyScalar(J,G.dot(J)),i.x-=G.x*R*v,i.y-=G.y*R*v,a.x-=G.x*R*p,a.y-=G.y*R*p,f.x+=G.x*R*u,f.y+=G.y*R*u}]}(),D=A[0],I=A[1],C=document.getElementById("load"),N=document.getElementById("home"),F=document.getElementById("start"),U=document.getElementById("end"),O=document.getElementById("reset");N.addEventListener("mousedown",o),N.addEventListener("touchstart",o),F.addEventListener("mousedown",r),F.addEventListener("touchstart",r),U.addEventListener("mousedown",o),U.addEventListener("touchstart",o),O.addEventListener("mousedown",s),O.addEventListener("touchstart",s);var j=.6,z=.1,R=.9,H=.6,W=[],V=[],X=[],Y=null,G=new w,J=new w,K={},Q=function(){var t,e=null;return function(){t=Date.now(),e||(e=setTimeout(function n(){var o=Date.now()-t;o<300?e=setTimeout(n,300-o):(e=null,function(){var t=K[256]||K[512]||K[1024];K[2]?new x(i()):K[4]?new x(i(),-44,4):t?K[8]?new x(i(),-48,8):(new x(.35*q,-44,4),new x(.65*q,-44,4)):(new x(.35*q),new x(.65*q)),l.play("new")}())},300))}}(),Z=null,$=null,tt=null,et=function(){function t(t){return Math.sin(6.283184*t)}function e(e){return t(e)<0?-1:1}function n(t){return t%1-.5}function o(t){var e=t%1*4;return e<2?e-1:3-e}function r(t){return.00390625*Math.pow(1.059463094,t-128)}var s,i,a=44100,c=a*nt.songLen;!function(){var t=Math.ceil(Math.sqrt(2*c/2)),e=document.createElement("canvas").getContext("2d");s=e.createImageData(t,t).data;var n,o=e.createImageData(t,t).data;for(n=t*t*4-2;n>=0;n-=2)o[n]=0,o[n+1]=128;i=o}(),this.lps=a/nt.rowLen,this.generate=function(f){var l,h,_,u,d,v,p,x,y,m,w,g,q,b,E,M,L,k,P,S,T,B,A=[t,e,n,o],D=s,I=i,C=c,N=2*c*2,F=nt.songData[f],U=nt.rowLen,O=A[F.lfo_waveform],j=A[F.osc1_waveform],z=A[F.osc2_waveform],R=F.env_attack,H=F.env_sustain,W=F.env_release,V=Math.pow(2,F.fx_pan_freq-8)/U,X=Math.pow(2,F.lfo_freq-8)/U;for(_=0;_<N;_+=2)D[_]=0,D[_+1]=128;for(p=0,u=0;u<nt.endPattern-1;++u)for(x=F.p[u],d=0;d<32;++d){if(x&&(v=F.c[x-1].n[d]))for(y=m=0,T=r(v+12*(F.osc1_oct-8)+F.osc1_det)*(1+8e-4*F.osc1_detune),B=r(v+12*(F.osc2_oct-8)+F.osc2_det)*(1+8e-4*F.osc2_detune),w=F.fx_resonance/255,g=q=0,l=R+H+W-1;l>=0;--l){switch(M=O((h=l+p)*X)*F.lfo_amt/512+.5,L=1,l<R?L=l/R:l>=R+H&&(L-=(l-R-H)/W),E=T,F.lfo_osc1_freq&&(E+=M),F.osc1_xenv&&(E*=L*L),P=j(y+=E)*F.osc1_vol,E=B,F.osc2_xenv&&(E*=L*L),P+=z(m+=E)*F.osc2_vol,F.noise_fader&&(P+=(2*Math.random()-1)*F.noise_fader*L),P*=L/255,S=F.fx_freq,F.lfo_fx_freq&&(S*=M),q+=(S=1.5*Math.sin(3.141592*S/a))*(b=w*(P-q)-(g+=S*q)),F.fx_filter){case 1:P=b;break;case 2:P=g;break;case 3:P=q;break;case 4:P=g+b}E=t(h*V)*F.fx_pan_amt/512+.5,P*=39*F.env_master,k=D[h<<=2]+(D[h+1]<<8)+P*(1-E),D[h]=255&k,D[h+1]=k>>8&255,k=D[h+2]+(D[h+3]<<8)+P*E,D[h+2]=255&k,D[h+3]=k>>8&255}p+=U}for(u=F.fx_delay_time*U>>1,E=F.fx_delay_amt/255,v=0;v<C-u;++v)_=4*v,k=D[h=4*(v+u)]+(D[h+1]<<8)+(D[_+2]+(D[_+3]<<8)-32768)*E,D[h]=255&k,D[h+1]=k>>8&255,k=D[h+2]+(D[h+3]<<8)+(D[_]+(D[_+1]<<8)-32768)*E,D[h+2]=255&k,D[h+3]=k>>8&255;for(_=0;_<N;_+=2)k=I[_]+(I[_+1]<<8)+D[_]+(D[_+1]<<8)-32768,I[_]=255&k,I[_+1]=k>>8&255},this.createAudio=function(){var t,e,n,o,r,a,f,l,h=i,_=2*c*2;for(s=null,a=(r=_-8)-36,o=String.fromCharCode(82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),t=0;t<_;){for(n="",e=0;e<256&&t<_;++e,t+=2)l=(l=4*(h[t]+(h[t+1]<<8)-32768))<-32768?-32768:l>32767?32767:l,n+=String.fromCharCode(255&l,l>>8&255);o+=n}return f="data:audio/wav;base64,"+btoa(o),o=null,new Audio(f)},this.getData=function(t,e){for(var n=Math.floor(t*a),o=0,r=[],s=i;o<2*e;o+=2){var c=4*(n+o)+1;r.push(t>0&&c<s.length?(s[c]+s[c-1]/256)/256:.5)}return r}},nt={songLen:37,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9},ot={dragging:!1,x:0,y:0};addEventListener("mousedown",function(t){t.preventDefault(),ot.dragging=!0,c(t)}),addEventListener("mousemove",function(t){t.preventDefault(),c(t)}),addEventListener("mouseup",function(t){t.preventDefault(),ot.dragging=!1,Y=null}),document.addEventListener("touchstart",function(t){var e=t.target;"INPUT"!=e.tagName&&"LABEL"!=e.tagName&&t.preventDefault(),ot.dragging=!0,c(t.targetTouches[0])}),document.addEventListener("touchmove",function(t){t.preventDefault(),c(t.targetTouches[0])}),document.addEventListener("touchend",function(t){ot.dragging=!1,Y=null}),document.addEventListener("touchcancel",function(t){ot.dragging=!1,Y=null}),Math.log2||(Math.log2=function(t){return Math.log(t)/Math.LN2}),Math.log10||(Math.log10=function(t){return Math.log(t)/Math.LN10}),Date.now||(Date.now=function(){return(new Date).getTime()}),Element.prototype.requestFullscreen||(Element.prototype.requestFullscreen=Element.prototype.mozRequestFullScreen||Element.prototype.msRequestFullscreen||Element.prototype.webkitRequestFullscreen);var rt=null;if(!h)try{!function(){for(var t=new et,e=0;e<8;++e)t.generate(e);(rt=t.createAudio()).loop=!0,rt.volume=.9}()}catch(t){}n(),function(){h&&(document.body.className="mobile");var e=document.getElementById("m"),n=document.getElementById("s"),o=document.getElementById("q");e.addEventListener("change",function(t){rt&&(e.checked?(rt.currentTime=0,rt.play()):rt.pause())}),n.addEventListener("change",function(t){l.on=n.checked});var r=v.prototype.paint,s=v.prototype.paintLow,i=x.prototype.paint,a=x.prototype.paintLow;h&&(o.checked=!1,v.prototype.paint=s,x.prototype.paint=a),o.addEventListener("change",function(e){v.prototype.paint=o.checked?r:s,x.prototype.paint=o.checked?i:a,t()}),L.removeChild(C),rt&&rt.play()}(),a(),g=new v(255,360,450,180,!1),requestAnimationFrame(function t(){T.clearRect(0,0,q,b);for(var e=0,n=V;e<n.length;e++)n[e].integrate();for(var o,r=!1,s=function(t){var e=W[t];e.center.y>=b+e.r&&(X=X.filter(function(t){return t.parent!=e}),V=V.filter(function(t){return t.parent!=e}),Y&&Y.parent==e&&(Y=null,ot.dragging=!1),W.splice(t,1),--K[e.n],l.play("die"),r=!0,--t),o=t},i=3;i<W.length;++i)s(i),i=o;var a=function(t){for(var e=W[t],n=2.5*e.r,o=99999,s=null,i=0,a=t+1;a<W.length;++a){var c=W[a];if(e.n==c.n){var f=e.center.distance(c.center);f<n&&f<o&&(o=f,s=c,i=a)}}if(!s)return"continue";var h=.5*(e.center.x+s.center.x),_=.5*(e.center.y+s.center.y);if(o>2*e.r){for(var u=0,d=e.positions;u<d.length;u++)(y=d[u]).x+=(h-y.x)*z,y.y+=(_-y.y)*z;for(var v=0,p=s.positions;v<p.length;v++){var y;(y=p[v]).x+=(h-y.x)*z,y.y+=(_-y.y)*z}}else X=X.filter(function(t){return t.parent!=e&&t.parent!=s}),V=V.filter(function(t){return t.parent!=e&&t.parent!=s}),!Y||Y.parent!=e&&Y.parent!=s||(Y=null,ot.dragging=!1),W.splice(i,1),W[t]=new x(h,_,e.n<<1,!1),K[e.n]-=2,l.play("bip"),r=!0,1024==e.n&&(U.style.display="block",l.play("win"))};for(i=3;i<W.length-1;++i)a(i);r&&Q(),Y&&(Y.position.x+=.24*(ot.x-Y.position.x),Y.position.y+=.24*(ot.y-Y.position.y));for(var c=0;c<40;++c){for(var f=0,h=X;f<h.length;f++)h[f].solve();for(var _=0,u=W;_<u.length;_++)u[_].boundingBox();for(i=0;i<W.length-1;++i)for(var d=i+1;d<W.length;++d)D(W[i],W[d])&&I()}for(var v=0,p=W;v<p.length;v++)p[v].paint(T);Y&&(T.beginPath(),T.moveTo(Y.position.x,Y.position.y),T.lineTo(ot.x,ot.y),T.strokeStyle="#FFD600",T.stroke()),requestAnimationFrame(t)}),t()}();</script>