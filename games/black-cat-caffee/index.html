<title>Black Cat Caffee - js13kGames 2025</title><body style=margin:0;height:100vh;overflow:hidden;display:flex;justify-content:center><canvas style=height:100vh;background-color:#000 height=1000 width=1600></canvas><script type=module>function e(e){return e[Math.floor(Math.random()*e.length)]}var t=class e{constructor(e,t){this.x=e,this.y=t}sub(t){return new e(this.x-t.x,this.y-t.y)}add(t){return new e(this.x+t.x,this.y+t.y)}scale(t){return new e(this.x*t,this.y*t)}len(){return Math.sqrt(this.x**2+this.y**2)}normal(){let t=this.len();return new e(this.x/t,this.y/t)}dot(e){return this.x*e.x+this.y*e.y}distance(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}perp(){return new e(-this.y,this.x)}set(e){this.x=e.x,this.y=e.y}},s=new t(600,400),n=[[new t(0,155),new t(155,365),new t(240,365),new t(85,155)].map(e=>e.add(s)),[new t(1354,841),new t(1500,841),new t(1200,413),new t(1050,413)]],o=[{pos:new t(1600,1e3),dir:new t(1600,1e3).sub(new t(1190,415))},{pos:new t(0,428),dir:new t(1,0)}].map(e=>({pos:e.pos,dir:e.dir.normal().perp()})),i=new t(0,-30);function a(e,t,s,n){return e>s&&e<n?n-e:s>e&&s<t?s-t:null}var r=[];function l({...e}){let s={pos:new t(0,0),...e,anchor:{x:.5,y:1}};return r.push(s),s}function h(e,t){let s=r.filter(s=>s.type==e&&s.pos.distance(t)<u);return 0!=s.length?s.reduce((e,s)=>e.pos.distance(t)<s.pos.distance(t)?e:s):null}var c=new t(1190,365),p=new t(1400,660),d=c.distance(p),f=p.sub(c).normal(),u=250;function g(e,t){t.anchor?t.rot?(e.save(),e.translate(t.pos.x-t.anchor.x*t.width,t.pos.y-t.anchor.y*t.height),e.rotate(t.rot),e.drawImage(t.image,0,0,t.width,t.height),e.restore()):e.drawImage(t.image,t.pos.x-t.anchor.x*t.width,t.pos.y-t.anchor.y*t.height,t.width,t.height):e.drawImage(t.image,t.pos.x,t.pos.y,t.width,t.height)}function w(e){return Promise.all(e.map(e=>new Promise(t=>{let s=new Image;s.src=e,s.onload=()=>t(s)})))}var[m,y,b,v]=await w(["ember.svg","dialog.svg","telecsésze.svg","tej.svg"]),x=[{type:"coffee"},{type:"coffee",tej:1},{type:"coffee",tej:2}],k=new t(480,700),z=[],I={update(e){if(this.target&&(this.pos.distance(this.target)>this.speed?(this.pos=this.pos.add(this.target.sub(this.pos).normal().scale(this.speed*e)),0==this.wobble_target?this.wobble_target=.03:.03==Math.abs(this.rot)&&(this.wobble_target*=-1)):(Object.assign(this.pos,this.target),this.target=null,this.wobble_target=0)),Math.abs(this.wobble_target-this.rot)<.005)this.rot=this.wobble_target;else{let e=this.wobble_target-this.rot,t=e/Math.abs(e);this.rot+=.005*t}},additionalRender(e){if("order"==this.state){e.drawImage(y,this.pos.x-this.width/2,this.pos.y+-150-this.height);for(let{image:t,x:s}of this.dialogContent)e.drawImage(t,this.pos.x-this.width/2+s,this.pos.y-this.height-95,50,50)}},calcDialogContent(){let e=this.order.flatMap(e=>{let t=[];return"coffee"===e.type&&(t.push(b),1==e.tej&&t.push(v),2==e.tej&&(t.push(v),t.push(v))),t}),t=100-(50*e.length+0*(e.length-1))/2;this.dialogContent=e.map((e,s)=>({image:e,x:t+50*s}))},itemDelivered(e){let t=this.order.findIndex(t=>"coffee"==e.content.type&&"coffee"==t.type&&t.tej==e.content.tej);return-1!=t&&(this.order.splice(t,1),0==this.order.length&&this.done(),!0)},done(){this.state="leave",this.target=new t(-200,1e3),z.splice(z.indexOf(this),1),z.forEach((e,s)=>e.target=new t(k.x-210*s,k.y))}};function _(e,t,s){return new Promise(n=>{e.fillStyle="white",e.clearRect(0,0,1600,1e3),e.font="30px monospace",e.fillText(t,800,300),e.font="20px monospace",e.fillText(`press any key to start level ${s}`,800,700),setTimeout(()=>{let e=()=>{document.body.removeEventListener("keydown",e),n()};document.body.addEventListener("keydown",e)},1e3)})}Array.prototype.remove=function(e){let t=this.indexOf(e);-1!=t&&this.splice(t,1)};var j={};onkeydown=e=>j[e.key]="press"==j[e.key]||"hold"==j[e.key]?"hold":"press",onkeyup=e=>j[e.key]=null;var M=document.getElementsByTagName("canvas")[0].getContext("2d");M.fillStyle="white",M.textAlign="center";var C=!0,[T,E,R,D,O,q,A,L,P,S,B,F,N,U,Y]=await w(["macska.svg","hatter.svg","elso_counter.svg","csésze.svg","telecsésze.svg","interact.svg","telifőzőcsésze.svg","féligtelifőzőcsésze.svg","üresfőzőcsésze.svg","kávéfőző.svg","kávéfőzőcsésze.svg","kávéfőzőcsészeteli.svg","kávéfőzőfej.svg","gőz1.svg","tej.svg"]),$=(()=>{let e=document.createElement("canvas");e.width=100,e.height=100;let t=e.getContext("2d");t.save(),t.translate(100,0),t.scale(-1,1),t.drawImage(U,0,0,100,100),t.restore();let s=new Image;return s.src=e.toDataURL(),s})(),G={image:T,pos:new t(500,500),anchor:{x:.6,y:1},width:100,height:100,rot:0,wobble_target:0},H={image:E,pos:new t(0,0),width:1600,height:1e3},J={image:R,pos:new t(600,769),anchor:{x:0,y:1},width:241,height:369},K={image:q,anchor:{x:.5,y:1.4},pos:new t(0,0),width:100,height:100},Q=!1,V=new t(600,400),W=new t(1150,300),X=new t(1100,150),Z=0,ee=1100,te=250,se=118.5144,ne=88.567*1.2,oe=125.832,ie=null,ae=!1,re=0,le=l({image:P,width:67,height:67,type:"főzőcsésze",fill:"none"});le.pos=new t(1200,400);var he=l({image:Y,width:70,height:70,type:"tej"});he.pos=new t(1300,600);var ce,pe=[],de=15e3,fe=1,ue=1;function ge(){be=[G,le,he],ce=fe,setTimeout(we,1e3),setTimeout(me,2e4),C=!0,je(performance.now())}function we(){if(0==ce)return;ce-=1;let s=function(){let s=k.x-210*z.length,n=Object.create(I);return n.pos=new t(-300,500),n.width=200,n.height=400,n.image=m,n.anchor={x:.5,y:1},n.target=new t(s,k.y),n.speed=4,n.state="order",n.order=[e(x)],n.left=!1,n.dialogContent=[],n.calcDialogContent(),n.rot=0,n.wobble_target=0,z.push(n),n}();pe.push(s),be.push(s),C&&setTimeout(we,de)}function me(){if(pe.length>0){let e=pe.length-1;for(;e>-1;)"leave"==pe[e].state&&null==pe[e].target&&pe.splice(e,1),e-=1;0==pe.length&&0==ce?ye():setTimeout(me,5e3)}else 0==ce&&ye()}async function ye(){C=!1,de*=.9,fe+=3,ue+=1,await _(M,"You finished level "+(ue-1),ue),ge()}var be,ve,xe,ke=new t(930,300);function ze(e){(function(e){let t=r.indexOf(e);if(t==r.length-1)r.pop();else if(-1!=t){let e=r.pop();r[t]=e}})(e),xe=e}function Ie(){let e=xe;return xe=null,e}var _e=performance.now();function je(e){if(!C)return;let t=(e-_e)/16.6666||1;_e=e;for(let e of pe)e.update(t);(function(e){if(j.w&&(G.pos.y-=7*e),j.s&&(G.pos.y+=7*e),j.a&&(G.pos.x-=7*e),j.d&&(G.pos.x+=7*e),j.w||j.s||j.a||j.d?0==G.wobble_target?G.wobble_target=.04:.04==Math.abs(G.rot)&&(G.wobble_target*=-1):G.wobble_target=0,Math.abs(G.wobble_target-G.rot)<.007)G.rot=G.wobble_target;else{let e=G.wobble_target-G.rot,t=e/Math.abs(e);G.rot+=.007*t}!function(e){let t=e.add(i);for(let s of n){let n=null,o=[],i=s[s.length-1];for(let e=0;e<s.length;e++){let t=s[e],n=t.sub(i).perp().normal();o.push(n),i=t}for(let e=0;e<s.length;e++){let i=1/0,r=-1/0;for(let t of s){let n=t.sub(s[e]).dot(o[e]);n>r&&(r=n),n<i&&(i=n)}let l=t.sub(s[e]).dot(o[e]),h=a(i,r,l-20,l+20);if(!h){n=null;break}(!n||n.len()>Math.abs(h))&&(n=o[e].scale(-h))}n&&e.set(e.add(n))}for(let s of o){let n=t.sub(s.pos).dot(s.dir)-20;n<0&&e.set(e.add(s.dir.scale(-n)))}}(G.pos)})(t),function(){if(xe)if(xe==le){if(G.pos.distance(W)<u&&null==ie)return K.pos=W,Q=!0,void(ve={type:"place-főzőcsésze"});if("full"==le.fill||"half"==le.fill){let e=h("cup",G.pos);if(e)return K.pos=e.pos,Q=!0,void(ve={type:"pour-coffee",item:e})}}else if(xe==he){let e=h("coffee",G.pos);if(e&&(e.content.tej<2||null==e.content.tej))return K.pos=e.pos,Q=!0,void(ve={type:"pour-milk",item:e})}else{let e=pe.filter(e=>e.pos.distance(G.pos)<u);if(0!=e.length)return e=pe.reduce((e,t)=>e.pos.distance(G.pos)<t.pos.distance(G.pos)?e:t),ve={type:"give-item",npc:e},void(Q=!1)}else{if(null!=ie&&G.pos.distance(W)<u&&!ae)return K.pos=W,Q=!0,void(ve={type:"take-főzőcsésze"});if(G.pos.distance(ke)<200)return K.pos=ke,Q=!0,void(ve={type:"cupboard"});let e=function(e){let t=r.filter(t=>t.pos.distance(e)<u);return 0!=t.length?t.reduce((t,s)=>t.pos.distance(e)<s.pos.distance(e)?t:s):null}(G.pos);if(e)return K.pos=e.pos,Q=!0,void(ve={type:"pickup",item:e})}Q=!1,ve=null}(),"press"==j.q&&function(){if(xe){let e=function(e){let t,s=e.sub(c).dot(f);return t=s<0?c:s>d?p:c.add(f.scale(s)),t.distance(e)<u?t:null}(G.pos);if(e){let t=Ie();t.pos=e,be.push(t),function(e){r.push(e)}(t)}}}(),"press"==j.e&&function(){if(ve)switch(ve.type){case"pickup":be.remove(ve.item),ze(ve.item);break;case"cupboard":ze(l({image:D,width:50,height:50,type:"cup",content:{}}));break;case"place-főzőcsésze":{let e=Ie();ie=e,re=1,ae=!0;let t=setInterval(()=>{Z=0==Z?1:0},500);setTimeout(()=>{ae=!1,re=2,e.fill="full",e.image=A,clearInterval(t)},5e3);break}case"take-főzőcsésze":re=0,ze(ie),ie=null;break;case"pour-coffee":{let e=xe,t=ve.item;switch(e.fill){case"full":e.image=L,e.fill="half";break;case"half":e.image=P,e.fill="none"}t.image=O,t.type="coffee",t.content={type:"coffee"};break}case"give-item":ve.npc.itemDelivered(xe)&&Ie();break;case"pour-milk":ve.item.content.tej=(ve.item.content.tej??0)+1}}(),function(){for(let e in j)"press"==j[e]&&(j[e]="hold")}(),M.fillStyle="black",M.clearRect(0,0,1600,1e3),g(M,H),function(){switch(M.drawImage(S,ee,te,se,ne),re){case 0:break;case 1:M.drawImage(B,ee,te,oe,ne);break;case 2:M.drawImage(F,ee,te,oe,ne)}M.drawImage(N,ee,te,se,ne)}(),be.sort(Ce).forEach(e=>{e==G?G.pos.y>J.pos.y||!(G.pos.y<J.pos.y-200)&&function(e){let t=(e.y-Ee.y)/Te.y,s=Ee.x+t*Te.x;return e.x-s}(G.pos)<0?(g(M,J),Me(),g(M,G)):(g(M,G),Me(),g(M,J)):(g(M,e),e.additionalRender&&e.additionalRender(M))}),ae&&(0==Z?M.drawImage(U,X.x,X.y,100,100):M.drawImage($,X.x,X.y,100,100)),Q&&g(M,K),requestAnimationFrame(je)}function Me(){xe&&(xe.pos=G.pos.add(new t(-5,-100)),g(M,xe))}function Ce(e,t){return e.pos.y-t.pos.y}var Te=new t(155,365).add(V).sub(new t(0,155).add(V)),Ee=new t(0,155).add(V);await _(M,"Black Cat Caffee",1),ge()</script>