<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=0"><title>OffLine</title><style>body{padding:0;margin:0}canvas{display:block;margin:0 auto}</style><div><canvas id=gameArea></canvas></div><script>var totalWidth,totalHeight,numCols,numFils,squareSize,marginX,marginY,sc,cLevel,rTime,score,rounds,endOfLevel,gates,openGates,gameCanvas=document.getElementById("gameArea"),gameContext=gameCanvas.getContext("2d"),levels=[[5,3,21,0,2,1,21,2,4,1,11,0,1,-1,31,2,1,-1,0,0,1.5,-.025,0,1.5,.025,12,4,1,0],[5,3,21,0,1,1,21,1,2,1,21,2,3,1,21,3,4,1,11,0,1,-1,31,1,1,-1,0,0,1.5,-.025,0,1.5,.025,12,2,1,0,31,3,1,0,0,0,1.5,-.05,0,1.5,.05,12,4,1,1],[5,3,21,0,1,0,21,1,2,0,22,1,0,2,1,21,2,3,1,22,2,1,3,2,21,3,4,2,11,0,0,-1,31,1,0,-1,0,0,1.5,-.025,0,1.5,.025,12,2,0,0,31,2,1,0,0,0,1.5,-.037,0,1.5,.037,12,3,1,1,31,3,2,1,0,0,1.5,-.05,0,1.5,.05,12,4,2,2],[5,3,21,0,1,0,21,3,4,0,23,1,1,0,2,22,3,1,4,2,24,1,0,1,1,25,3,0,3,1,11,0,0,-1,31,1,0,-1,0,0,1.5,-.05,0,1.5,.05,31,3,0,-1,1,0,1.5,.05,0,1.5,-.05,11,4,0,-1,31,1,1,0,1,0,1.5,.05,0,1.5,-.05,31,3,1,1,0,0,1.5,-.05,0,1.5,.05,12,0,2,2,12,4,2,3]],numLevels=4,touchPosition={x:void 0,y:void 0},colors=["#E23A59","#738D9C","#44ADAD"];function circleLimits(e){return e<0?e+=2*Math.PI:e>2*Math.PI&&(e-=2*Math.PI),e}function roundRect(e,t,a,s,i){gameContext.beginPath(),gameContext.moveTo(e+i,t),gameContext.lineTo(e+a-i,t),gameContext.arc(e+a-i,t+i,i,1.5*Math.PI,0,!1),gameContext.lineTo(e+a,t+s-i),gameContext.arc(e+a-i,t+s-i,i,0,.5*Math.PI,!1),gameContext.lineTo(e+i,t+s),gameContext.arc(e+i,t+s-i,i,.5*Math.PI,Math.PI,!1),gameContext.lineTo(e,t+i),gameContext.arc(e+i,t+i,i,Math.PI,1.5*Math.PI,!1),gameContext.stroke(),gameContext.closePath()}function circle(e,t,a,s){gameContext.beginPath(),gameContext.arc(e,t,a,0,2*Math.PI,!1),gameContext.fillStyle=s,gameContext.fill(),gameContext.stroke(),gameContext.closePath()}function Gate(e,t,a,s,i,o,n,l,c,r){this.posX=e,this.posY=t,this.parent=a,this.fromRight=s,this.iniRad1=i*Math.PI,this.endRad1=o*Math.PI,this.velRad1=n,this.iniRad2=l*Math.PI,this.endRad2=c*Math.PI,this.velRad2=r,this.state=1,this.delay=0;var m=Math.random()*Math.PI*2;this.iniRad1=circleLimits(this.iniRad1+m),this.endRad1=circleLimits(this.endRad1+m),this.update=()=>{1===this.state?(this.iniRad1=circleLimits(this.iniRad1+this.velRad1),this.endRad1=circleLimits(this.endRad1+this.velRad1),this.iniRad2=circleLimits(this.iniRad2+this.velRad2),this.endRad2=circleLimits(this.endRad2+this.velRad2)):0===this.state&&(this.delay--,0===this.delay&&(this.state=1)),this.draw()},this.draw=()=>{var e,t,s=squareSize/40,i=this.posX*squareSize+marginX,o=this.posY*squareSize+marginY;2===this.state?(e=colors[2],t=colors[2]):0===this.fromRight?(e=colors[isParentOpen(a)],t=colors[0]):(e=colors[0],t=colors[isParentOpen(a)]),drawIcon(i,o,4,e,colors[this.state],t),i+=squareSize/2,o+=squareSize/2-4*s,gameContext.beginPath(),gameContext.arc(i,o,9*s,this.iniRad1,this.endRad1,!1),gameContext.stroke(),gameContext.closePath(),gameContext.beginPath(),gameContext.arc(i,o,6*s,this.iniRad2,this.endRad2,!1),gameContext.stroke(),gameContext.closePath()},this.touched=()=>{if(1===this.state){var e=Math.abs(this.iniRad1-this.iniRad2);e>Math.PI&&(e=2*Math.PI-e),e<Math.PI/2?(this.state=2,openGates++):(this.state=0,this.delay=120)}}}function isParentOpen(e){return-1===e||2===gates[e].state?2:0}function findGateAt(e,t){var a=Math.floor((e-marginX)/squareSize),s=Math.floor((t-marginY)/squareSize),i=-1;return gates.forEach((function(e,t){e.posX===a&&e.posY===s&&(i=t)})),i}function drawIcon(e,t,a,s,i,o){var n=e+squareSize/2,l=t+squareSize/2;switch(a){case 1:roundRect(n-10*sc,l-13*sc,20*sc,6*sc,1.5*sc),roundRect(n-10*sc,l-7*sc,20*sc,6*sc,1.5*sc),roundRect(n-10*sc,l-sc,20*sc,6*sc,1.5*sc),gameContext.beginPath(),gameContext.rect(n-5*sc,l-10*sc,1,1),gameContext.rect(n-5*sc,l-4*sc,1,1),gameContext.rect(n-5*sc,l+2*sc,1,1),gameContext.moveTo(n,l-10*sc),gameContext.lineTo(n+6*sc,l-10*sc),gameContext.moveTo(n,l-4*sc),gameContext.lineTo(n+6*sc,l-4*sc),gameContext.moveTo(n,l+2*sc),gameContext.lineTo(n+6*sc,l+2*sc);break;case 2:roundRect(n-11*sc,l-13*sc,22*sc,15*sc,1.5*sc),gameContext.beginPath(),gameContext.moveTo(n-11*sc,l-2*sc),gameContext.lineTo(n+11*sc,l-2*sc),gameContext.moveTo(n,l+2*sc),gameContext.lineTo(n,l+5*sc),gameContext.moveTo(n-5*sc,l+5*sc),gameContext.lineTo(n+5*sc,l+5*sc);break;case 3:roundRect(n-5*sc,l-13*sc,10*sc,18*sc,1.5*sc),gameContext.beginPath(),gameContext.moveTo(n-5*sc,l-10*sc),gameContext.lineTo(n+5*sc,l-10*sc),gameContext.moveTo(n-5*sc,l+2*sc),gameContext.lineTo(n+5*sc,l+2*sc);break;case 4:gameContext.beginPath()}gameContext.moveTo(n,l+7*sc),gameContext.lineTo(n,l+10*sc),gameContext.moveTo(n-10*sc,l+10*sc),gameContext.lineTo(n+10*sc,l+10*sc),gameContext.stroke(),gameContext.closePath(),circle(n-10*sc,l+10*sc,1.5*sc,s),circle(n,l+10*sc,1.5*sc,i),circle(n+10*sc,l+10*sc,1.5*sc,o)}function drawBoard(){for(var e,t,a,s,i,o,n,l,c,r,m,g,h=0;h<numFils;h++)for(var v=0;v<numCols;v++)gameContext.fillStyle=(h+v)%2==0?"#999":"#AAA",gameContext.fillRect(v*squareSize+marginX,h*squareSize+marginY,squareSize,squareSize);for(e=2;e<levels[cLevel].length;)11===(l=levels[cLevel][e])||12===l?(t=levels[cLevel][e+1]*squareSize+marginX,a=levels[cLevel][e+2]*squareSize+marginY,-1===(c=levels[cLevel][e+3])||2===gates[c].state?(r=colors[2],m=colors[1],g=colors[2]):(r=colors[0],m=colors[1],g=colors[0]),drawIcon(t,a,l-10,r,m,g),e+=4):21===l?(s=levels[cLevel][e+1]*squareSize+marginX+squareSize/2+12*sc,o=levels[cLevel][e+2]*squareSize+marginX+squareSize/2-12*sc,n=i=levels[cLevel][e+3]*squareSize+marginY+squareSize/2+10*sc,gameContext.beginPath(),gameContext.moveTo(s,i),gameContext.lineTo(o,n),gameContext.stroke(),gameContext.closePath(),e+=4):22===l?(s=levels[cLevel][e+1]*squareSize+marginX+squareSize/2+10*sc,i=levels[cLevel][e+2]*squareSize+marginY+squareSize/2+12*sc,o=s,n=levels[cLevel][e+4]*squareSize+marginY+squareSize/2+10*sc,gameContext.beginPath(),gameContext.moveTo(s,i),gameContext.lineTo(o,n),o=levels[cLevel][e+3]*squareSize+marginX+squareSize/2-12*sc,gameContext.lineTo(o,n),gameContext.stroke(),gameContext.closePath(),e+=5):23===l?(s=levels[cLevel][e+1]*squareSize+marginX+squareSize/2-10*sc,i=levels[cLevel][e+2]*squareSize+marginY+squareSize/2+12*sc,o=s,n=levels[cLevel][e+4]*squareSize+marginY+squareSize/2+10*sc,gameContext.beginPath(),gameContext.moveTo(s,i),gameContext.lineTo(o,n),o=levels[cLevel][e+3]*squareSize+marginX+squareSize/2+12*sc,gameContext.lineTo(o,n),gameContext.stroke(),gameContext.closePath(),e+=5):24===l?(s=levels[cLevel][e+1]*squareSize+marginX+squareSize/2+12*sc,o=(levels[cLevel][e+3]+1)*squareSize+marginX+squareSize/2-12*sc,n=i=levels[cLevel][e+2]*squareSize+marginY+squareSize/2+10*sc,gameContext.beginPath(),gameContext.moveTo(s,i),gameContext.lineTo(o,n),n=levels[cLevel][e+4]*squareSize+marginY+squareSize/2+10*sc,gameContext.lineTo(o,n),o=levels[cLevel][e+3]*squareSize+marginX+squareSize/2+12*sc,gameContext.lineTo(o,n),gameContext.stroke(),gameContext.closePath(),e+=5):25===l?(s=levels[cLevel][e+1]*squareSize+marginX+squareSize/2-12*sc,o=(levels[cLevel][e+3]-1)*squareSize+marginX+squareSize/2+12*sc,n=i=levels[cLevel][e+2]*squareSize+marginY+squareSize/2+10*sc,gameContext.beginPath(),gameContext.moveTo(s,i),gameContext.lineTo(o,n),n=levels[cLevel][e+4]*squareSize+marginY+squareSize/2+10*sc,gameContext.lineTo(o,n),o=levels[cLevel][e+3]*squareSize+marginX+squareSize/2-12*sc,gameContext.lineTo(o,n),gameContext.stroke(),gameContext.closePath(),e+=5):31===l&&(e+=11);gates.forEach((e=>e.update()))}function drawGame(){gameContext.clearRect(0,0,totalWidth,totalHeight),drawBoard();for(var e=score+" ";e.length<5;)e="0"+e;gameContext.fillStyle="#000",gameContext.fillText(e,totalWidth,0),gameContext.fillStyle="#7F0000",gameContext.fillRect(0,.98*totalHeight,totalWidth*rTime,.02*totalHeight)}function gameLoop(){requestAnimationFrame(gameLoop),endOfLevel?rTime>0?(rTime-=.01,score++):(++cLevel===numLevels&&(cLevel=0,rounds+=.5),initLevel(),initDimensions()):openGates===gates.length?endOfLevel=!0:rTime>0?rTime-=.001:(initGame(),initLevel(),initDimensions()),drawGame()}function initGame(){score=0,cLevel=0,rounds=1}function initLevel(){var e,t,a,s,i,o,n,l,c,r,m;for(numCols=levels[cLevel][0],numFils=levels[cLevel][1],e=2,gates=[];e<levels[cLevel].length;)elem=levels[cLevel][e],11===elem||12===elem||21===elem?e+=4:22===elem||23===elem||24===elem||25===elem?e+=5:31===elem&&(t=levels[cLevel][e+1],a=levels[cLevel][e+2],s=levels[cLevel][e+3],i=levels[cLevel][e+4],o=levels[cLevel][e+5],n=levels[cLevel][e+6],l=levels[cLevel][e+7]*rounds,c=levels[cLevel][e+8],r=levels[cLevel][e+9],m=levels[cLevel][e+10]*rounds,gates.push(new Gate(t,a,s,i,o,n,l,c,r,m)),e+=11);rTime=1,openGates=0,endOfLevel=!1}function initDimensions(){totalWidth=window.innerWidth,totalHeight=window.innerHeight,gameCanvas.width=totalWidth,gameCanvas.height=totalHeight,totalWidth/numCols<totalHeight/numFils?(squareSize=Math.floor(totalWidth/numCols),marginX=0,marginY=Math.floor((totalHeight-squareSize*numFils)/2)):(squareSize=Math.floor(totalHeight/numFils),marginX=Math.floor((totalWidth-squareSize*numCols)/2),marginY=0),sc=squareSize/40,gameContext.lineWidth=sc,gameContext.lineCap="round",gameContext.lineJoin="round",gameContext.strokeStyle="#EED069",gameContext.font="48px sans-serif";var e=gameContext.measureText("0000").width;gameContext.font=Math.floor(48*squareSize/e)+"px sans-serif",gameContext.textBaseline="top",gameContext.textAlign="right"}window.onload=function(){initGame(),initLevel(),initDimensions(),window.addEventListener("resize",(()=>{initDimensions()})),window.addEventListener("touchstart",(e=>{touchPosition.x=e.changedTouches[0].clientX,touchPosition.y=e.changedTouches[0].clientY;var t=findGateAt(touchPosition.x,touchPosition.y);t>-1&&gates[t].touched()})),gameLoop()}</script>