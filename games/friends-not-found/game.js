let t,e,i={};function s(t,...e){(i[t]||[]).map(t=>t(...e))}function n(){return t}function h(){return e}function o(i){if(t=document.getElementById(i)||i||document.querySelector("canvas"),!t)throw Error("You must provide a canvas element for the game");return e=t.getContext("2d"),e.imageSmoothingEnabled=0,s("init"),{canvas:t,context:e}}const a=()=>{};function r(t,e,i){return t*(1-i)+e*i}function c(t,e,i){return Math.min(Math.max(t,i),e)}class l{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new l(this.x+t.x,this.y+t.y,this)}subtract(t){return new l(this.x-t.x,this.y-t.y,this)}scale(t){return new l(this.x*t,this.y*t)}normalize(t=this.length()){return new l(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=1,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?c(this._a,this._d,t):t}set y(t){this._y=this._c?c(this._b,this._e,t):t}}function d(){return new l(...arguments)}d.prototype=l.prototype,d.class=l;class u extends class{constructor(t){return this.init(t)}init(t={}){this.position=d(),this.velocity=d(),this.acceleration=d(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=h(),render:s=this.draw,update:n=this.advance,children:o=[],anchor:a={x:0,y:0},sx:r=0,sy:c=0,opacity:l=1,rotation:d=0,scaleX:u=1,scaleY:E=1,...x}={}){this.children=[],super.init({width:t,height:e,context:i,anchor:a,sx:r,sy:c,opacity:l,rotation:d,scaleX:u,scaleY:E,...x}),this._di=1,this._uw(),o.map(t=>this.addChild(t)),this._rf=s,this._uf=n}render(t){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.sx||this.sy)&&e.translate(-this.sx,-this.sy),1==this.scaleX&&1==this.scaleY||e.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&e.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&e.translate(-i,-s);let n=this.children;t&&(n=n.filter(t)),n.map(t=>t.render&&t.render()),e.restore()}draw(){}_pc(t,e){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wr=s+this.rotation;let{x:o,y:a}=((t,e)=>{let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}})({x:this.x,y:this.y},s);this._wx=o,this._wy=a,this._wsx=n*this.scaleX,this._wsy=h*this.scaleY,this._wx=this.x*n,this._wy=this.y*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}addChild(t,{absolute:e=0}={}){this.children.push(t),t.parent=this,t._pc=t._pc||a,t._pc()}removeChild(t){let e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null,t._pc())}update(t){this._uf(t),this.children.map(t=>t.update&&t.update())}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function E(){return new u(...arguments)}E.prototype=u.prototype,E.class=u;class x extends E.class{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function p(){return new x(...arguments)}p.prototype=x.prototype,p.class=x;let g=/(\d+)(\w+)/;class _ extends E.class{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=h().font,...n}={}){super.init({text:t,textAlign:e,lineHeight:i,font:s,...n}),this._p()}get width(){return this._w}set width(t){this._d=1,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=1,this._t=t}get font(){return this._f}set font(t){this._d=1,this._f=t,this._fs=(t=>{let e=t.match(g),i=+e[1];return{size:i,unit:e[2],computed:i}})(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=1,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=0;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,s=2;for(;s<=e.length;s++){let n=e.slice(i,s).join(" ");t.measureText(n).width>this._fw&&(this._s.push(e.slice(i,s-1).join(" ")),i=s-1)}this._s.push(e.slice(i,s).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map(i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"===i.canvas.dir?"right":"left"),t="right"===e?this.width:"center"===e?this.width/2|0:0,this._s.map((s,n)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*n)})}}function w(){return new _(...arguments)}w.prototype=_.prototype,w.class=_;let A=new WeakMap,y={},f={},T={0:"left",1:"middle",2:"right"};function S(t,e){let{x:i,y:s,width:n,height:h}=(t=>{let e=t.world||t,i=e.x,s=e.y,n=e.width,h=e.height;return t.anchor&&(i-=n*t.anchor.x,s-=h*t.anchor.y),{x:i,y:s,width:n,height:h}})(t),o=e.x-Math.max(i,Math.min(e.x,i+n)),a=e.y-Math.max(s,Math.min(e.y,s+h));return o*o+a*a<e.radius*e.radius}function M(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):S(s,t))return s}}function m(t){let e=void 0!==t.button?T[t.button]:"left";f[e]=1,b(t,"onDown")}function G(t){let e=void 0!==t.button?T[t.button]:"left";f[e]=0,b(t,"onUp")}function v(t){b(t,"onOver")}function F(t){A.get(t.target)._oo=null,f={}}function b(t,e){t.preventDefault();let i=t.target,s=A.get(i),n=i.height/i.offsetHeight,h=i.getBoundingClientRect();if(-1!==["touchstart","touchmove","touchend"].indexOf(t.type)){s.touches={};for(var o=0;o<t.touches.length;o++)s.touches[t.touches[o].identifier]={id:t.touches[o].identifier,x:(t.touches[o].clientX-h.left)*n,y:(t.touches[o].clientY-h.top)*n,changed:0};for(o=t.changedTouches.length;o--;){const i=t.changedTouches[o].identifier;void 0!==s.touches[i]&&(s.touches[i].changed=1);let a=t.changedTouches[o].clientX,r=t.changedTouches[o].clientY;s.x=(a-h.left)*n,s.y=(r-h.top)*n;let c=M(s);c&&c[e]&&c[e](t),y[e]&&y[e](t,c)}}else{s.x=(t.clientX-h.left)*n,s.y=(t.clientY-h.top)*n;let i=M(s);i&&i[e]&&i[e](t),y[e]&&y[e](t,i),"onOver"==e&&(i!=s._oo&&s._oo&&s._oo.onOut&&s._oo.onOut(t),s._oo=i)}}class N extends p.class{init({padX:t=0,padY:e=0,text:i,onDown:s,onUp:h,...o}={}){super.init({padX:t,padY:e,...o}),this.textNode=w({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),function(...t){t.map(t=>{let e=t.context?t.context.canvas:n(),i=A.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}(this),this.addChild(this.textNode),this._od=s||a,this._ou=h||a;const r=this._dn=document.createElement("button");r.style="position:absolute;left:-9999px",r.textContent=this.text,r.addEventListener("focus",()=>this.focus()),r.addEventListener("blur",()=>this.blur()),r.addEventListener("keydown",t=>this._kd(t)),r.addEventListener("keyup",t=>this._ku(t)),((t,e)=>{let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,s.nextSibling)}else document.body.appendChild(t)})(r,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=1,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!==this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=0,this.onEnable()}disable(){this.disabled=this._dn.disabled=1,this.onDisable()}focus(){this.disabled||(this.focused=1,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=0,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=1)}onOut(){this.hovered=0}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=1,this._od())}onUp(){this.disabled||(this.pressed=0,this._ou())}_kd(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}_ku(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}function R(){return new N(...arguments)}function L(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}R.prototype=N.prototype,R.class=N;class I{constructor(){this.queue=[]}add(t){Array.isArray(t)?this.queue.push(...t):this.queue.push(t)}load(){const t={};return 0===this.queue.length?Promise.resolve({}):new Promise(async e=>{const i=[];this.queue.forEach(e=>{var s;t[e]=new Image,t[e].src=e,i.push((s=t[e],new Promise(t=>s.onload=()=>t())))}),await Promise.all(i),e(t)})}}class O{constructor(){this.loader=new I,this.scene=[],this.savedData={};const t=document.getElementById("mainCanvas");t.width=O.width,t.height=O.height;const{context:e}=o();this.canvas=t,this.context=e,this.loop=this.createGameLoop(),((t=n())=>{let e=A.get(t);var s;e||(e={x:0,y:0,radius:5,touches:{},canvas:t,_cf:[],_lf:[],_o:[],_oo:null},A.set(t,e)),t.addEventListener("mousedown",m),t.addEventListener("touchstart",m),t.addEventListener("mouseup",G),t.addEventListener("touchend",G),t.addEventListener("touchcancel",G),t.addEventListener("blur",F),t.addEventListener("mousemove",v),t.addEventListener("touchmove",v),e._t||(e._t=1,s=()=>{e._lf.length=0,e._cf.map(t=>{e._lf.push(t)}),e._cf.length=0},i.tick=i.tick||[],i.tick.push(s))})(),this.loadSave()}static isAllowedToInput(){let t=1;return Object.keys(O.BlockInputReasons).forEach(e=>{O.BlockInputReasons[e]&&(t=0)}),t}loadSave(){this.savedData=JSON.parse(window.localStorage.getItem("404sl")||"{}")}save(t,e){this.savedData=Object.assign(this.savedData,t),this.savedDataEvent||e||(this.savedDataEvent=1,setTimeout(()=>{window.localStorage.setItem("404sl",JSON.stringify(this.savedData)),this.savedDataEvent=0},1e3))}add(t){return this.loader.add(t)}getAsset(t){return this.assets[t]}load(){return this.loader.load().then(t=>this.assets=t)}blackAndWhite(t){this.canvas.style.filter=t?"grayscale(100%)":""}removeObj(t){const e=this.scene.findIndex(e=>e==t);if(-1===e)throw Error();this.scene.splice(e,1)}isInScene(t){return-1!==this.scene.findIndex(e=>e===t)}clearScene(){this.scene.length=0}start(){this.loop.start()}stop(){this.loop.stop()}update(t){this.scene.forEach(e=>e.update(t))}createGameLoop(){return function({fps:t=60,clearCanvas:e=1,update:i=a,render:n,context:o=h()}={}){if(!n)throw Error("You must provide a render() function");let r,c,l,d,u,E=0,x=1e3/t,p=1/t,g=e?L:a;function _(){if(c=requestAnimationFrame(_),l=performance.now(),d=l-r,r=l,!(d>1e3)){for(s("tick"),E+=d;E>=x;)u.update(p),E-=x;g(o),u.render()}}return u={update:i,render:n,isStopped:1,start(){r=performance.now(),this.isStopped=0,requestAnimationFrame(_)},stop(){this.isStopped=1,cancelAnimationFrame(c)},_frame:_,set _last(t){r=t}},u}({update:t=>this.update(t),render:()=>this.render()})}reset(){this.clearScene(),this.loop.stop(),this.loop=null,this.loop=this.createGameLoop(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.start()}forceRender(){console.error("This is not to go into production"),this.render()}render(){this.scene.forEach(t=>{t.x-t.width*t.anchor.x>O.width||t.x+t.width*t.anchor.x<0||t.y-t.height*t.anchor.y>O.height||t.y+t.height*t.anchor.y<0||t.render()})}}O.width=480,O.height=272,O.BlockInputReasons={};const P={x:.5,y:.5},B={x:O.width/2,y:O.height/2},D=["ä½•","ï¼¸","ç«","æ°´","åœ°","é¢¨","ðŸ¡¹","  "],C=["./a/b.png","./a/b_y.png","./a/sb.png"];function U(){return this._onUpdate||(this._onUpdate={}),{add:t=>{const e=Math.random().toString().substr(2);return this._onUpdate[e]=t,e},remove:t=>{this._onUpdate[t]&&delete this._onUpdate[t]}}}function k(t){for(const e in this._onUpdate)this._onUpdate.hasOwnProperty(e)&&this._onUpdate[e].call(this,t)}class Y extends w.class{constructor(t){super(t)}set alpha(t){this._alpha=Math.min(Math.max(0,t),1),this.updateAlpha()}get alpha(){return this._alpha}updateAlpha(){const t=Math.round(255*this._alpha).toString(16);this.color=this.color.substr(0,7)+(1===t.length?"0":"")+t}get onUpdate(){return U.call(this)}update(t){super.update(t),k.call(this,t)}}class H{static easeOutBounce(t,e,i,s){return(t/=s)<1/2.75?7.5625*i*t*t+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}static easeInBounce(t,e,i,s){return i-H.easeOutBounce(s-t,0,i,s)+e}static easeOutElastic(t,e,i,s){let n=1.70158,h=0,o=i;return 0===t?e:1==(t/=s)?e+i:(h||(h=.3*s),o<Math.abs(i)?(o=i,n=h/4):n=h/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*t)*Math.sin(2*Math.PI*(t*s-n)/h)+i+e)}static easeInElastic(t,e,i,s){let n=1.70158,h=0,o=i;return 0===t?e:1==(t/=s)?e+i:(h||(h=.3*s),o<Math.abs(i)?(o=i,n=h/4):n=h/(2*Math.PI)*Math.asin(i/o),-o*Math.pow(2,10*(t-=1))*Math.sin(2*Math.PI*(t*s-n)/h)+e)}static easeOutQuad(t,e,i,s){return-i*(t/=s)*(t-2)+e}}class X extends p.class{constructor(t){super(t),this._alpha=1}get onUpdate(){return U.call(this)}set alpha(t){this._alpha=Math.min(Math.max(0,t),1),this.updateAlpha()}get alpha(){return this._alpha}updateAlpha(){const t=Math.round(255*this._alpha).toString(16);this.color=this.color.substr(0,7)+(1===t.length?"0":"")+t}update(t){super.update(t),k.call(this,t)}}var K;(t=>{t[t.WILDCARD=-1]="WILDCARD",t[t.EMPTY=0]="EMPTY",t[t.TYPE1=1]="TYPE1",t[t.TYPE2=2]="TYPE2",t[t.TYPE3=3]="TYPE3",t[t.TYPE4=4]="TYPE4",t[t.UP=5]="UP",t[t.UNDEFINED=6]="UNDEFINED",t[t.LENGTH=7]="LENGTH"})(K||(K={}));var q,W,j=(q=new(window.audioContext||window.AudioContext||window.AudioContext||window.webkitAudioContext),(t,e,i)=>{t=+t,e=e%5||0,"function"!=typeof i&&(i=()=>{});var s=q.createOscillator();s.type=e;var n=q.createGain();n.gain.value=.25,n.connect(q.destination),s.connect(n),s.noteOn&&s.noteOn(0),s.start&&s.start(),setTimeout(()=>{s.noteOff&&s.noteOff(0),s.stop&&s.stop(),i()},t)});class V{static getNextLevel(){return this.currentLevel++,this.currentLevel>=this.levelOrder.length?null:V.levelOrder[this.currentLevel]}}V.levelOrder=[{levelId:"1",width:7,height:11,targetScore:15,dialogue:[{text:"ã“\nã‚“\nã«\nã¡\nã¯\n:)",face:"NORMAL"},{text:"ã“ã‚Œã¯ã€\n\nç§ã‚’ä½œã£ãŸ\nã‚²ãƒ¼ãƒ ã§ã™",face:"LOOK_LEFT"},{text:"ã§ã‚‚â€¦",face:"NORMAL"},{text:"ãƒ—ãƒ¬ã‚¤ã—ã¦\näººã‚‚å…¨ç„¶\n\nã„ãƒ»ãªãƒ»ã„\n\nã§ã™ï¼",face:"UPSET"},{text:"ã‚‚ã—\nã‚ˆã‹ã£ãŸã‚‰\n\næ‰‹ä¼ã„ãã‚Œ\nã¾ã›ã‚“ã‹ï¼Ÿ",face:"SAD"},{text:"ã‚ã‚ŠãŒã¨ã†\nã”ã–ã„ã¾ã™\n!!!!!!!!",face:"HAPPY"},{text:"ä¸»ã«ã€\nã“ã®ã‚²ãƒ¼ãƒ \nã®ç›®æ¨™ã¯\nãƒã‚¤ãƒ³ãƒˆã‚’\nç©ã‚‚ã‚‹ã€‚",face:"NORMAL"},{text:"ãƒã‚¤ãƒ³ãƒˆã®\nç©ã‚‚ã‚‹ã«ã¯\n\nå¡žãŒã‚‹\nã‚¿ã‚¤ãƒ«ã‚’\nã‚¯ãƒªãƒƒã‚¯ã—\nãŸã‚‰â€¦",face:"NORMAL"},{text:"â€¦ä¸Šã«\nè¡Œãã‚ˆï¼",face:"NORMAL"},{text:"å·¦ã®æ¼¢å­—ã¯\nåŒã˜ãªã‚‰\nãƒã‚¤ãƒ³ãƒˆã‚’\nå—ã‘å–ã‚‹ã€‚",face:"NORMAL"},{text:"â€¦ãã—ã¦ã€\nãã®ã‚¿ã‚¤ãƒ«\n\nç·‘ã«ãªã‚‹ã€‚",face:"NORMAL"},{text:"é»„è‰²ã®\nã‚¿ã‚¤ãƒ«ã‚’\nã‚¯ãƒªãƒƒã‚¯ã—\nãŸã‚‰ã€\n\nå¤–ã™ã‚ˆï¼",face:"NORMAL"},{text:"å³ä¸Šã«\nã‚¹ã‚³ã‚¢ã®\nç›®æ¨™ã«ã‚ã‚‹\n\n(^_^)",face:"NORMAL"},{text:"ãŒã‚“ã°ã£ã¦\nã­ï½žï¼",face:"HAPPY"}],upAllowance:8,contents:{grid:[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[2,0,0,0,1,0,0],[2,0,0,0,3,3,2],[4,2,0,0,2,2,2],[4,2,3,0,2,2,3],[1,4,2,0,1,1,1],[4,1,1,1,4,3,4]]},goals:[[1,0],[1,0],[1,0],[1,0],[1,0],[2,0],[3,0],[2,0],[0,0],[1,0],[0,0]]},{levelId:"2",width:9,height:12,targetScore:30,upAllowance:11,dialogue:[{text:"ã­â€¦ãªãœ\n\nã€Œã¿ã‚“ãª\nã©ã“ã«ã„\nã¾ã™ã‹ã€ã¨\nè¨€ã‚ãªã‹\nã£ãŸï¼Ÿ",face:"CONFUSED"},{text:"ã¾ã‚ã€\nãã‚Œã¯ã•ãƒ¼\n.......",face:"NORMAL"},{text:"ã„ã¤ã‚‚\nã‚²ãƒ¼ãƒ ã‚’\né–‹ç™ºã—ã¦\nã„ãŸã‹ã‚‰â€¦",face:"NORMAL"},{text:"â€¦ã¿ã‚“ãªâ€¦\n\næ­»ã‚“ã§ã„ãŸ",face:"UPSET"}],contents:{grid:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,1,0],[0,0,0,0,0,0,1,4,4],[1,4,0,4,4,0,1,4,2],[3,4,3,4,4,4,1,4,2],[2,4,3,2,2,4,2,4,3],[3,4,2,2,4,3,1,3,3],[1,2,1,1,3,1,1,1,1]]},goals:[[1,4],[1,2],[2],[1,2],[4,2],[3],[3],[3],[4],[3,4],[1,3],[1,3]]},{levelId:"3",width:9,height:12,targetScore:15,upAllowance:11,dialogue:[{text:"èˆˆå‘³ãŒãªã„\nã®ï¼Ÿ\n\nãªãœã¿ã‚“ãª\næ­»ã‚“ã§ã„ãŸ",face:"CONFUSED"},{text:"ç§ã®ã›ã„\nã˜ã‚ƒãªã„ã‚ˆ",face:"UPSET"},{text:"ã ã‹ã‚‰ã€\n\nãŸã \nãƒ‘ã‚½ã‚³ãƒ³\nã ã‚ˆ.",face:"NORMAL"},{text:"ã¿ã‚“ãªã‚’\næ®ºã•ã‚Œã¦ã€\nã©ã†ã‚„ã£ã¦\nã ã‚ã†ï¼Ÿ",face:"HAPPY"}],contents:{grid:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,0,3,0],[0,0,2,0,0,0,0,4,0],[0,4,3,0,0,0,0,3,0],[2,2,2,2,3,0,0,1,0],[3,1,2,3,4,2,3,1,3],[4,3,1,1,3,2,4,2,4],[3,1,2,3,1,3,1,2,2]]},goals:[[2,0],[2,0],[1,2],[1,0],[4,3],[3,0],[1,2],[2,0],[4,1],[3,4],[3,0],[0,0]]},{levelId:"4",width:12,height:12,targetScore:37,upAllowance:10,dialogue:[{text:"ã¾ã‚ã€\nãã®ãŠè©±ã¯\nå¿…è¦ãŒãªã„\nã§ã™ã­ï¼Ÿ",face:"HAPPY"},{text:"ã ã‹ã‚‰â€¦",face:"NORMAL"},{text:"ã‚ã‚“ãŸã¯â€¦",face:"NORMAL"},{text:"ç§ã®å‹é”ã«\nãªã£ãŸ\nã§ã—ã‚‡\n\n\\(^.^)/",face:"HAPPY"}],contents:{grid:[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,0,0,2,0,0,0],[0,0,4,0,0,0,0,0,3,0,0,0],[0,0,2,0,0,0,0,0,4,1,0,0],[0,2,3,1,0,0,0,0,3,4,1,0],[4,4,4,2,0,0,0,0,1,1,1,1],[2,3,2,3,0,0,3,1,3,3,3,3],[1,1,1,4,3,2,4,2,4,4,4,4],[3,2,1,4,1,3,1,2,2,2,2,2]]},goals:[[2,0],[2,0],[1,2],[1,0],[4,2],[3,1],[3,2],[2,3],[4,0],[2,3],[1,0],[0,2]]},{levelId:"5",width:14,height:12,targetScore:46,upAllowance:10,dialogue:[{text:"ä½•ã§ã™ã‹ï¼Ÿ\n\nã‚‚ã†\næ­¢ã¾ã‚ŠãŸã„\nã§ã™ã‹ï¼Ÿ",face:"CONFUSED"},{text:"ã§ã‚‚â€¦\nãªãœã ã‚ã†\n!!!!!!",face:"UPSET"},{text:"ã‚ã‚“ãŸâ€¦\n\nã¾ã \næ®ºã•ã‚Œãªã„\nã‹ã‚‰ã€ãªãœ\n?????",face:"UPSET"},{text:"ã„ã„ãˆâ€¦\nã„ã„ãˆã„ã„\nãˆã„ã„ãˆã„\nã„ãˆã„ã„ãˆ\nã„ã„ãˆãƒ¼ãƒ¼",face:"BLINK_2"},{text:"ã‚ã‚“ãŸã¯â€¦",face:"NORMAL"},{text:"ç§ã®å‹é”\nã ã‚ˆ\n\n:):):):)",face:"HAPPY"}],contents:{grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,4,0,0,0,0,0,0,3,0,0,0,0],[0,0,3,0,0,0,0,0,4,4,0,4,0,0],[0,4,2,1,0,0,0,0,1,1,0,4,0,0],[0,3,2,4,0,0,0,0,2,3,0,3,0,0],[0,2,4,3,1,1,2,0,1,2,2,2,1,0],[2,2,4,3,1,1,1,0,1,2,1,3,2,1],[4,4,1,4,4,1,1,2,4,1,2,1,2,1],[2,4,3,4,2,3,2,2,4,2,1,2,2,1],[2,1,2,4,2,3,3,1,3,4,3,4,4,1]]},goals:[[3,1],[3,0],[2,3],[1,0],[4,0],[3,0],[1,2],[4,0],[1,0],[2,3],[3,2],[1,0]]}],V.currentLevel=-1,(t=>{t.JAPANESE="ja"})(W||(W={}));let J=W.JAPANESE;function Q(){return J}const z={TEST:{[W.JAPANESE]:"ãƒ†ã‚¹ãƒˆ"},ChatBot_LevelEnd:{[W.JAPANESE]:"ã§ããŸã‚ˆï¼\n\nã“ã®ç·‘ã®\nãƒœã‚¿ãƒ³ã‚’\nãã‚Šã£ãã—\nãŸã‚‰é€²ã‚€ï¼\n:)"},ThanksForPlaying:{[W.JAPANESE]:"ãƒ—ãƒ¬ã‚¤ã—ãŸã®ã§\nã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ!\n\nå…¨é¡ã®ã‚¹ã‚³ã‚¢: "}},$={NORMAL:{Eye1:"Ê˜",Eye2:"Ê˜",Mouth1:"â€¿"},CHILL:{Eye1:"Ë˜",Eye2:"Ë˜",Mouth1:"â€¿",disableBlink:1},BLINK:{Eye1:"â—¡",Eye2:"â—¡"},BLINK_2:{Eye1:"â—¡",Eye2:"â—¡",Mouth1:"â€¿",disableBlink:1},UPSET:{Eye1:"á—’",Eye2:"á—•",Mouth1:"á—£",disableBlink:1},CONFUSED:{Eye1:"ï¼Ÿ",Eye2:"ï¼Ÿ",Mouth1:"á—£",disableBlink:1},SAD:{Eye1:"à²¥",Eye2:"à²¥",Mouth1:"ï¹",disableBlink:1},LOOK_LEFT:{Eye1:"â—•",Eye2:"â—•",Mouth1:"â€¿"},HAPPY:{Eye1:"^",Eye2:"^",Mouth1:"â€¿",disableBlink:1}};class Z extends E.class{constructor(t,e,i){super(i),this.currentFacialExpression=Object.assign({},$.NORMAL),this.resolveFunc=null,this.queue=[],this.canSkip=0,this.isOpen=0,this.pointerUp=0,this.overlayRef=e,this.mainBotSprite=Z.createChatBot(t),this.updateFacialExpression($.NORMAL),this.speechBubbleSprite=Z.createSpeechBubble(t,()=>{this.canSkip&&(this.canSkip=1,this.continueText())}),this.addChild(this.mainBotSprite),this.addChild(this.speechBubbleSprite.sprite);let s=0,n=2;s=setInterval(()=>{this.speechBubbleSprite.sprite.y+=n,n*=-1},1e3);let h=1,o=null;const a=()=>{h?(this.currentFacialExpression.disableBlink||(o=Object.assign({},this.currentFacialExpression),this.updateFacialExpression($.BLINK)),setTimeout(a,350)):(this.currentFacialExpression.disableBlink||this.updateFacialExpression(o),setTimeout(a,2e3)),h=!h};setTimeout(a,2e3),this.speechBubbleSprite.nextButton.textNode.color="#00FFFF00",this.speechBubbleSprite.sprite.x=-999}showLevelEnd(t){this.showingLevelEnd||(this.addToQueue([{text:z.ChatBot_LevelEnd[Q()],face:"NORMAL"}]),this.speechBubbleSprite.nextButton.textNode.color="#00FF00FF",this.showingLevelEnd=1,this.play(1).then(()=>{window._SCORE_COUNTER||(window._SCORE_COUNTER=0),window._SCORE_COUNTER+=t.getScore();const e=V.getNextLevel();if(e)t.loadNewLevel(e),this.speechBubbleSprite.nextButton.textNode.color="#00FFFFFF",t.start();else{t.showOrHide(1);const e=new Y({text:z.ThanksForPlaying[Q()]+window._SCORE_COUNTER.toString(),textAlign:"center",font:"22px MS Gothic",color:"white",x:B.x,y:B.y+20,anchor:P});t.getEngine().scene.push(e);const i=et.createTitle();i.heading.x+=B.x,i.title.x+=B.x,i.subheading.x+=B.x,i.heading.y+=.35*B.y,i.title.y+=.35*B.y,i.subheading.y+=.35*B.y,t.getEngine().scene.push(i.heading),t.getEngine().scene.push(i.title),t.getEngine().scene.push(i.subheading);const s="https://slynch.dev",n=R({x:B.x,y:1.75*B.y,font:"22px MS Gothic",text:{text:s,color:"white",anchor:P,textAlign:"center"},onUp(){window.open(s,"_blank").focus()},anchor:P});t.getEngine().scene.push(n);const h="https://twitter.com/Slynch2203",o=R({x:B.x,y:1.9*B.y,text:{text:"@Slynch2203",color:"white",anchor:P,textAlign:"center"},onUp(){window.open(h,"_blank").focus()},anchor:P});t.getEngine().scene.push(o)}}))}hideLevelEnd(){this.showingLevelEnd&&(this.speechBubbleSprite.nextButton.textNode.color="#00FFFFFF",this.showingLevelEnd=0,this.queue.shift(),this.close(1))}update(t){super.update(t),this.pointerUp=!!f.left}addToQueue(t){t&&(Array.isArray(t)?this.queue.push(...t):this.queue.push(t))}async play(t){if(this.closePromise&&await this.closePromise,this.isOpen)return;let e;this.isOpen=1,this.speechBubbleSprite.sprite.x=-71,this.speechBubbleSprite.sprite.scaleX=0;const i=Date.now();for(await new Promise(s=>{e=setInterval(()=>{const n=Date.now()-i;if(this.speechBubbleSprite.sprite.scaleX=H.easeOutQuad(n,0,1,1e3),!t){const t=Math.round(H.easeOutQuad(n,0,102,1e3)).toString(16);this.overlayRef.color="#000000"+(1===t.length?"0"+t:t)}n>=1e3&&(clearInterval(e),t||(this.overlayRef.color="#00000066"),this.speechBubbleSprite.sprite.scaleX=1,s())},16)}),t||(this.overlayRef.color="#00000066");0!==this.queue.length;){const t=this.queue[0].text,e=this.queue[0].face;await this.changeLine(t,e),this.queue.shift()}this.closePromise=this.close(t).then(()=>{this.closePromise=null})}changeLine(t,e){return e&&this.updateFacialExpression($[e]||$.NORMAL),new Promise(e=>{setTimeout(()=>{this.speechBubbleSprite.text.text="";let i=0,s=0;s=setInterval(()=>{if(i>=t.length||this.pointerUp)return this.pointerUp=0,clearInterval(s),this.speechBubbleSprite.text.text=t,this.speechBubbleSprite.nextButton.textNode.color=this.speechBubbleSprite.nextButton.textNode.color.substr(0,7)+"FF",this.canSkip=1,void(this.resolveFunc=e);this.speechBubbleSprite.text.text+=t[i],i++},100)},600)})}updateFacialExpression(t){this.currentFacialExpression=Object.assign(this.currentFacialExpression,t),this.currentFacialExpression.disableBlink=t.disableBlink||0;let e="(.E1M1E2.)";e=e.replace("E1",this.currentFacialExpression.Eye1),e=e.replace("E2",this.currentFacialExpression.Eye2),e=e.replace("M1",this.currentFacialExpression.Mouth1),this.mainBotSprite.text=e}static createChatBot(t){return new Y({text:"(.â—•â—¡â—•.)",x:-45,y:-5,anchor:{x:.5,y:1},color:"white",font:"16px Hiragino Kaku Gothic Pro"})}async close(t){if(!this.isOpen)return;let e;this.isOpen=0;const i=Date.now();this.updateFacialExpression($.NORMAL),await new Promise(s=>{e=setInterval(()=>{const n=Date.now()-i;if(this.speechBubbleSprite.sprite.scaleX=H.easeOutQuad(n,1,-1,1e3),!t){const t=Math.round(H.easeOutQuad(n,102,-102,1e3)).toString(16);this.overlayRef.color="#000000"+(1===t.length?"0"+t:t)}n>=1e3&&(clearInterval(e),t||(this.overlayRef.color="#00000000"),this.speechBubbleSprite.sprite.x=-999,this.speechBubbleSprite.sprite.scaleX=1,this.speechBubbleSprite.text.text=" ",s())},16)})}continueText(){0!==this.queue.length?this.resolveFunc&&(this.resolveFunc(),this.resolveFunc=null):this.close()}static createSpeechBubble(t,e){const i=new X({x:-71,y:-115,anchor:P,image:t.getAsset(C[2])}),s=new Y({x:0,y:-78,color:"white",lineHeight:1.4,textAlign:"center",anchor:{x:.5,y:0},text:"ã€€",font:"14px MS Gothic"}),n=R({x:23,y:38,text:{text:"ðŸ¡†",color:"#00FFFF00"},onUp:e});return i.addChild(n),i.addChild(s),{nextButton:n,sprite:i,text:s}}}class tt{constructor(t,e,i){this.UP_BLOCKS=[],this.initializeGameState(e),this.ENGINE_REF=t,this.ENGINE_REF.scene.push(this.SCORE_ELEMENT=tt.createScoreElement(this.GAME_STATE.width)),this.ENGINE_REF.scene.push(this.TARGET_ELEMENT=tt.createTargetElement(this.GAME_STATE.targetScore,this.GAME_STATE.width)),this.ENGINE_REF.scene.push(this.LEVEL_ID_ELEMENT=tt.createLevelIDElement(this.GAME_STATE.levelId,this.GAME_STATE.width)),this.GOAL_ELEMENTS=tt.createGoalElements(this,this.GAME_STATE);for(let t=0;t<this.GOAL_ELEMENTS.length;t++)for(let e=0;e<this.GOAL_ELEMENTS[t].length;e++)this.ENGINE_REF.scene.push(this.GOAL_ELEMENTS[t][e]);this.UP_BLOCKS.push(...tt.createUpBlocks(this.GAME_STATE.upAllowance,this.ENGINE_REF.getAsset("./a/b_y.png"),this.GAME_STATE.width,this.GAME_STATE.height)),this.UP_BLOCKS.forEach(t=>this.ENGINE_REF.scene.push(t)),this.GRID=tt.createGridElements(this.GAME_STATE,this.ENGINE_REF.getAsset("./a/b.png"),(t,e)=>this.onButtonPress(t,e)),this.GRID.forEach(t=>{t.forEach(t=>{this.ENGINE_REF.scene.push(t.text),this.ENGINE_REF.scene.push(t.button)})});const s=new X({color:"#00000000",width:O.width,height:O.height});t.scene.push(s),this.chatBot=new Z(t,s,{x:2*B.x-2,y:2*B.y-7}),i?this.start():O.BlockInputReasons.PlayNotYetStarted=1,this.updateGameViewToReflectGameState(),this.updateGridColors()}initializeGameState(t){for(this.GAME_STATE=Object.assign({variables:{SCORE:0,CURR_UPS:t.upAllowance}},t);this.GAME_STATE.goals.length<tt.maxHeight;)this.GAME_STATE.goals.unshift([,,].fill(K.EMPTY));for(;this.GAME_STATE.contents.grid.length<tt.maxHeight;)this.GAME_STATE.contents.grid.unshift(Array(this.GAME_STATE.width).fill(K.EMPTY).concat(Array(tt.maxWidth-this.GAME_STATE.width).fill(K.UNDEFINED)));for(let t=0;t<this.GAME_STATE.contents.grid.length;t++)for(;this.GAME_STATE.contents.grid[t].length<tt.maxWidth;)this.GAME_STATE.contents.grid[t].push(K.UNDEFINED)}static createLevelIDElement(t,e){return new Y({x:2*B.x+-10*(tt.maxWidth-e+1)-20,y:12,anchor:{x:1,y:0},text:"ãƒ¬ãƒ™ãƒ« "+t,color:"#FFFFFFAA",textAlign:"center",font:"10px MS Gothic"})}start(t){O.BlockInputReasons.PlayNotYetStarted=0,this.chatBot.addToQueue(this.GAME_STATE.dialogue),this.ENGINE_REF.isInScene(this.chatBot)||this.ENGINE_REF.scene.push(this.chatBot),!t&&this.GAME_STATE.dialogue&&0!==this.GAME_STATE.dialogue.length&&(O.BlockInputReasons.TutorialPlaying=1,setTimeout(()=>{this.chatBot.play(0).then(()=>{O.BlockInputReasons.TutorialPlaying=0})},800))}getEngine(){return this.ENGINE_REF}getScore(){return this.GAME_STATE.variables.SCORE}showOrHide(t){for(let e=0;e<tt.maxHeight;e++){t?this.UP_BLOCKS[e].x-=2e3:this.UP_BLOCKS[e].x+=2e3;for(let i=0;i<tt.maxWidth;i++)t?(this.GRID[e][i].button.x-=2e3,this.GRID[e][i].text.x-=2e3):(this.GRID[e][i].button.x+=2e3,this.GRID[e][i].text.x+=2e3)}for(let e=0;e<this.GOAL_ELEMENTS.length;e++)for(let i=0;i<this.GOAL_ELEMENTS[e].length;i++){const s=this.GOAL_ELEMENTS[e][i];t?s.x-=2e3:s.x+=2e3}t?(this.SCORE_ELEMENT.x-=2e3,this.TARGET_ELEMENT.x-=2e3,this.LEVEL_ID_ELEMENT.x-=2e3,this.chatBot.x-=2e3):(this.SCORE_ELEMENT.x+=2e3,this.TARGET_ELEMENT.x+=2e3,this.LEVEL_ID_ELEMENT.x+=2e3,this.chatBot.x+=2e3)}static playMusic(){}loadNewLevel(t){this.initializeGameState(t);for(let t=0;t<tt.maxHeight;t++)t<this.GAME_STATE.upAllowance?this.UP_BLOCKS[t].x=this.UP_BLOCKS[t]._oldX=55+20*this.GAME_STATE.width:this.UP_BLOCKS[t].x=-50,this.UP_BLOCKS[t].y=2*B.y-20*t-29;for(let t=0;t<tt.maxHeight;t++)for(let e=0;e<2;e++)t<this.GAME_STATE.goals.length&&e<this.GAME_STATE.goals[t].length?(this.GOAL_ELEMENTS[t][e].text=D[this.GAME_STATE.goals[t][e]+1],this.GAME_STATE.goals[t][e]===K.EMPTY&&(this.GOAL_ELEMENTS[t][e].color="#FFFFFF00")):this.GOAL_ELEMENTS[t][e].text=" ",this.GOAL_ELEMENTS[t][e].y=23+20*(tt.maxHeight-this.GAME_STATE.goals.length)+20*t;this.SCORE_ELEMENT.x=this.TARGET_ELEMENT.x=2*B.x+-10*(tt.maxWidth-this.GAME_STATE.width+1),this.LEVEL_ID_ELEMENT.x=this.SCORE_ELEMENT.x+-20,this.TARGET_ELEMENT.text="ç›®æ¨™: "+this.GAME_STATE.targetScore,this.LEVEL_ID_ELEMENT.text="ãƒ¬ãƒ™ãƒ« "+this.GAME_STATE.levelId,this.updateGameViewToReflectGameState(),this.updateGridColors()}static createTargetElement(t,e){return new Y({x:2*B.x+-10*(tt.maxWidth-e+1),y:45,anchor:{x:1,y:0},text:"ç›®æ¨™: "+t,color:"#FFFFFFAA",font:"14px MS Gothic"})}static createScoreElement(t){return new Y({x:2*B.x+-10*(tt.maxWidth-t+1),y:25,anchor:{x:1,y:0},text:" ",color:"white",font:"16px MS Gothic"})}static createGoalElements(t,e){const i=[];for(let t=0;t<tt.maxHeight;t++){i.push([]);for(let s=0;s<2;s++){let n,h;n=t<e.goals.length&&s<e.goals[t].length&&e.goals[t][s]!==K.EMPTY?D[e.goals[t][s]+1]:" ",h=new Y({x:50+-25*s,y:23+20*(tt.maxHeight-e.goals.length)+20*t,text:n,color:"white",font:"17px MS Gothic",anchor:{x:1,y:0}}),i[t].push(h)}}return i}static createUpBlocks(t,e,i,s){const n=[];for(let s=0;s<tt.maxHeight;s++){const h=new X({color:"#FFFF0066",width:17,height:17}),o=55+20*i,a=new X({x:o,_oldX:o,y:2*B.y-20*s-29,image:e}),r=new Y({text:D[K.UP+1],color:"yellow"});a.addChild(h),a.addChild(r),n.push(a),s>=t&&(a.x=-50)}return n}static createGridElements(t,e,i){const s=[];for(let n=0;n<tt.maxHeight;n++){s.push([]);for(let h=0;h<tt.maxWidth;h++){let o;const a={x:55+20*h,y:40+20*(tt.maxHeight-t.height)+20*n-20},r=new R({x:a.x,y:a.y,image:e,anchor:{x:0,y:1},column:h,row:n,linkedButton:null,onUp(){i(this.column,this.row)}}),c=tt.getText(h,n,t),l=tt.getColor(h,n,t);let d=K.EMPTY;h<t.width&&n<t.height&&(d=t.contents.grid[n][h]),o=new Y({x:a.x+10,y:a.y-8,anchor:P,width:16,height:16,column:h,row:n,type:d,text:c,color:l,font:"14px MS Gothic"}),s[n].push({button:r,text:o,type:d})}}return s}async onButtonPress(t,e){const i={x:t,y:e};O.isAllowedToInput()&&(this.GAME_STATE.contents.grid[i.y][i.x]!==K.UP&&0===this.GAME_STATE.variables.CURR_UPS||this.GAME_STATE.contents.grid[i.y][i.x]!==K.EMPTY&&this.GAME_STATE.contents.grid[i.y][i.x]!==K.UNDEFINED&&(this.GAME_STATE.contents.grid[0][i.x]!==K.EMPTY&&this.GAME_STATE.contents.grid[0][i.x]!==K.UNDEFINED&&this.GAME_STATE.contents.grid[i.y][i.x]!==K.UP||(O.BlockInputReasons.UpdatingGameState=1,j(100,1),this.updateGameState(i.x,i.y,!(this.GAME_STATE.contents.grid[i.y][i.x]===K.UP)),await new Promise(i=>{let s,n=0,h=0;const o=this.GRID[e][t].text;s=setInterval(()=>{switch(h){case 0:if(n>=1)return o.scaleX=0,n=0,h++,this.updateGameViewToReflectGameState(),void this.updateGridColors();o.scaleX=r(1,0,n+=.35);break;case 1:if(n>=1)return o.scaleX=1,void h++;o.scaleX=r(0,1,n+=.35);break;case 2:clearInterval(s),i()}},33)}),O.BlockInputReasons.UpdatingGameState=0)))}updateGameState(t,e,i){if(i){for(let i=0;i<e;i++)this.GAME_STATE.contents.grid[i][t]=this.GAME_STATE.contents.grid[i+1][t];this.GAME_STATE.contents.grid[e][t]=K.UP,this.GAME_STATE.variables.CURR_UPS--}else{for(let i=e;i>0;i--)this.GAME_STATE.contents.grid[i][t]=this.GAME_STATE.contents.grid[i-1][t];this.GAME_STATE.contents.grid[0][t]=K.EMPTY,this.GAME_STATE.variables.CURR_UPS++}}updateGridColors(){let t=0;for(let e=0;e<this.GAME_STATE.contents.grid.length;e++)for(let i=0;i<this.GAME_STATE.contents.grid[e].length;i++){if(this.GAME_STATE.contents.grid[e][i]===K.EMPTY){this.GRID[e][i].text.color="#FFFFFF00",this.GRID[e][i].button.image=this.ENGINE_REF.getAsset(C[0]);continue}if(this.GAME_STATE.contents.grid[e][i]===K.UNDEFINED){this.GRID[e][i].button.image=null,this.GRID[e][i].text.color="#FFFFFF00";continue}const s=this.GAME_STATE.goals[e];let n=0;this.GRID[e][i].text._oldPos||(this.GRID[e][i].text._oldPos={x:this.GRID[e][i].text.x,y:this.GRID[e][i].text.y}),-1!==s.indexOf(this.GAME_STATE.contents.grid[e][i])?(t++,this.GRID[e][i].text.color="#00FF00",this.GRID[e][i].text.x=this.GRID[e][i].text._oldPos.x,this.GRID[e][i].text.y=this.GRID[e][i].text._oldPos.y):this.GAME_STATE.contents.grid[e][i]===K.UP?(this.GRID[e][i].text.color="#FFFF00",this.GRID[e][i].text.x=this.GRID[e][i].text._oldPos.x-1,this.GRID[e][i].text.y=this.GRID[e][i].text._oldPos.y-1,n=1):(this.GRID[e][i].text.color="#FF0000",this.GRID[e][i].text.x=this.GRID[e][i].text._oldPos.x,this.GRID[e][i].text.y=this.GRID[e][i].text._oldPos.y),this.GRID[e][i].button.image=this.ENGINE_REF.getAsset(C[n])}this.SCORE_ELEMENT.text="ã‚¹ã‚³ã‚¢: "+(t<10?"0"+t:t),this.GAME_STATE.variables.SCORE=t;for(let t=0;t<this.UP_BLOCKS.length;t++)t<this.GAME_STATE.variables.CURR_UPS?this.UP_BLOCKS[t].x=this.UP_BLOCKS[t]._oldX:this.UP_BLOCKS[t].x=-50;t>=this.GAME_STATE.targetScore?this.chatBot.showLevelEnd(this):this.chatBot.hideLevelEnd()}updateGameViewToReflectGameState(){for(let t=0;t<this.GRID.length;t++)for(let e=0;e<this.GRID[t].length;e++)this.GRID[t][e].text.text=tt.getText(e,t,this.GAME_STATE)}static getText(t,e,i){return i.contents.grid[e][t]===K.EMPTY?D[K.EMPTY+1]:D[i.contents.grid[e][t]+1]}static getColor(t,e,i){return i.contents.grid[e][t]===K.EMPTY?"#FFFFFF00":"#FFFFFFFF"}}tt.maxWidth=15,tt.maxHeight=12,tt.isPlayingMusic=0;class et extends E.class{constructor(t,e){super(e);const i=this,s=et.createTitle(),n=new Y({text:"ðŸŽ®\nJS13K\nGAMES",textAlign:"center",color:"white",font:"12px MS Gothic",x:B.x-10,y:45-B.y,anchor:{x:1,y:0}});this.addChild(n),this.heading=s.heading,this.addChild(this.heading),this.title=s.title,this.addChild(this.title),this.subtitle=s.subheading,this.addChild(this.subtitle),this.startButton=R({text:{text:"ã“ã“ã‚¯ãƒªãƒƒã‚¯ã—ã¦\nã‚²ãƒ¼ãƒ ã‚’å§‹ã¾ã‚Šã¾ã™",color:"white",font:"14px MS Gothic",anchor:P,textAlign:"center"},onUp(){O.BlockInputReasons.AnimatingMainMenu||(O.BlockInputReasons.AnimatingMainMenu=1,new Promise(t=>{const e=Date.now(),s=i.y;let n;n=setInterval(()=>{const h=Date.now()-e;i.x+=5*(Math.random()-.5),i.y=H.easeInElastic(h,s,500,1e3),h>=1e3&&(clearInterval(n),i.y=s+500,t())},33)}).then(()=>{O.BlockInputReasons.AnimatingMainMenu=0,new tt(t,V.getNextLevel(),1),tt.isPlayingMusic||(tt.isPlayingMusic=1,tt.playMusic())}))},update(){O.isAllowedToInput()&&(this.hovered?this.color="#008800FF":this.color="#005500FF")},width:150,height:43,color:"#005500FF",y:114,anchor:P}),this.addChild(this.startButton),this.textAnimInterval=setInterval(()=>{this.title.color=this.subtitle.color=this.heading.color=`#${this.generateRandomColor()}${this.generateRandomColor()}${this.generateRandomColor()}FF`},250)}static createTitle(){return{title:new Y({text:"å‹é”ã‚’è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",y:0,color:"white",anchor:P,font:"22px MS Gothic",textAlign:"center"}),heading:new Y({text:"-404-",y:-24,color:"white",anchor:P,font:"22px MS Gothic",textAlign:"center"}),subheading:new Y({text:"::FRIEND NOT FOUND::",y:24,color:"white",anchor:P,font:"14px MS Gothic",textAlign:"center"})}}update(t){super.update(t)}generateRandomColor(){let t=Math.round(100*Math.random()+150).toString(16);return 1===t.length&&(t="0"+t),t}}(async()=>{const t=new O;t.add(C),await t.load(),t.scene.push(new et(t,{x:B.x,y:.75*B.y})),t.start()})();
