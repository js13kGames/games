<!doctype html><meta name=viewport content="width=device-width"><title>Basement Cat Ascends - js13kGames 2025</title><style>body{margin:0;padding:0;overflow:hidden;background-color:#000}#app{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center}canvas{border:1px solid #000}</style><div id=app></div><script>const A={sprites:"//////////////////////////////////////8HB/8HBwcHBwcH//8HBwcHB////wcHB///B///Bwf//////////////////////////////////wcH/wf//wcHBwf//wcHBwcHBwf/BwcH/////wcHB///////B/////////////////////////////////////8HB///BwcHBwcH/wcHBwcHBwcH/////////////////////////////////////////////////////wf//////////wcHB/8HB///BwcHBwcH/wf//wcHBwf//////////wf/////////////////////////////////////////////////////B/8HB/8HB///BwcHBwcH////BwcHB///////Bwf///////////////8H////////B/////8HB/8H/////wcH/wcHBwcHB////wcHBwcH////Bwf//wf///8H////B///////////////B/////////8H////Bwf/B/////8HB/8HBwcHBwf///8HBwcHB////wcH//8H////B////wf///////////8H//////8HBwf//////wcHB////////wcH////////Bwf/////////B////////wcH//////8A//////////////////////////////////////8HB////////wcH/////////////////////////////////////////////////////////////wcH//////8H//8H/////wf//wf//////wcH////////////////////////////B///B////wf/Bwf/B/8H/wf//wf/B/8H/////wf//wf/////B/8H/wf//wf/B/8H/wcH/wf///8H//8H/////wf//wf/////////////B////////wf/////////////////////B////////wf/////////////B///B///////////B///B///////////////Bwf/B///B/8HB/8HBwcHBwf///8HBwcHB////wcH//8H////B////wf///8H/////wf/////B/8H//8H/////////////////wf/BwcH/wcH////BwcHBwf///8HB///B////wf///8H//////8H/wf//wf/////////////////B/8HBwf//wf///8HB/8HB////wf/BwcH////B////wf/////////////B////////////wf///8H//8H////////B////wf/////B////wf///////8H////////////////////////////B////wf//////wf///8H////////////////////////B/////////////////////////////////////8GBgYGBgYGBgAFBQUFBQUGAAUFBQUFBQYABQUFBQUFBgAFBQUFBQUGAAUFBQUFBQYABQUFBQUFBgAAAAAAAAAGAg4ODg4ODg4BAgICAgICDgECAgICAgIOAQICAgICAg4BAgICAgICDgECAgICAgIOAQICAgICAg4BAQEBAQEBAgoKCgoKCgoKBAkJCQkJCQoECQkJCQkJCgQJCQkJCQkKBAkJCQkJCQoECQkJCQkJCgQJCQkJCQkKBAQEBAQEBAoHB////////wYHBwf/////Bwf///////8H/////////wcH////////BgcHB/////8HB////////wf/////////////////Bwf/////BwcHBv///////wcH/////////wf///////8HB/////8HBwcG////////Bwf/////////B/////////////////////////////////////////////8H////B////wf///8H//8HBwf/BwcHBwcGBwcHBgcHBgcHBwYHBwcHB/8HBwf//wf///8H////B////wf/////////////////////////////////////////////////////////CAj/CAj//wgICAgICAj/CAgICAgICP8ICAgICAgI//8ICAgICP////8ICAj///////8I//////////////////8HBwf/////B////wf//wf/B////wf/B///Bwf/B/8H//////8H//8H////B/////8HBwf///8=",tilemap:"EhISEhIS////EhISEhISEhISEhISEhIS//8SEhISEhIRERERERH//xEREREREREREREREREREf//ERERERERERP//xMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEv////////////////8VEhIU////////////////FRIR//////////////////8REf////8REf///xH/////ERP//xMXFxcXFxcXF////xMT//////////////////8TEv//////EhISEhIS//8VEhL//////////////////xIR//////////////////8REf////8RERH//xH/////ERP//xP//////////////xMT//////////////////8TEv////////////////8SEhL//xISEhISEhISEv///xIR//////8REREREREU//8REf8VEf///xH//xH/////ERP//xP//////////////xMT//////////////////8TEv////////////////8VEhL//xcXFxf//////////xIR/////xH//////xEU//8REf//ERER/xH//xERFP//ERP/////FhYWFhYWFv///xMT//////////////////8TEv//////////////Ev8VEhIU/////////xL//////xIR////Ef///////xH///8REf////8R/xH//xERFP//ERP/////ExMTExMTE////xMT//////////////////8TEv///////////xL/////EhIU/xL/////////////FRIR//8REREREREREREU//8REf////8R/xH/////////ERMU////E////xcXF////xMT//////////////////8TEv//////////////////EhL//////////////xL//xIR//////////////////8REf//ERER/xH/////////ERMU////E////////////xMT//////////////////8TEv///////xIS////////EhL///8S/xIU/////////xIR//8WFhb///////////8REf8VEf///xH///8RFP//ERMU////E////xb//////xMT////////ExP///////8TEv///////xYWFhYWFhYWEhL//////////////////xIR//8REREU/xH//xEU/xUREf////8RERH///8RFP//ERP/////ExP//xP//////xMT//////8TExMT//////8TEv//EhISEhISEhISEhISEhL//////////xL//////xIR//8R/xEU/xH//xEU/xUREf//Fv8RERH///8RFP//ERP/////FRP//xP//////xMT/////xMTExMTE/////8TEv//FxcXFxf/////////EhL//////////////////xIR//8R/xEU/xH//xEU/xUREf//Ef///xERERERFP//ERP///8TExP//xMU/////xMT////ExMTExMTExP///8TEv//////////////////EhL//////xL//////////xIR//8RERT//xH//xEU/xUREf8VERER/xH//xERFP//ERMU//8T/////xMTE////xMT//8TExMTExMTExMT//8TEhL/////////////////EhL//////////////////xIR/////////xf//////xUREf////8R/xH//xERFP//ERMU//8T/////xP//////xMT/xMTExMTExMTExMTE/8TEv//////////////////EhL//////////////////xIR/////////////////xUREf////8R////////////ERMWFhYT/////xMWFhYWFhMTExMTExMTExMTExMTExMTEhYWFhIWFhL//xIS////EhL//////////xIS/////xIRFhYWEREWFhYWFhER//8REf//ERERERERERERERERERMTExMT//8TExMTExMTExMTExMTExMTExMTExMTExMTEhISEhISEhL//xISEhISEhISEhISEhL//xISEhISEhIRERERERERERERERER//8REf//ERERERERERERERERERMTExMT//8TExMTExMTExMTExP//xMTExMTExMTExMTEv//////////////////EhL//////////////////xIR//////////8XFxcX//8REf//Ef////8R////////ERP//////////////////xMTFxP///////////////8TEv//////////////////EhL//////xb///8S/////xIR//////////////////8REf//Ef////8R////////ERP/////////E////////xMTFBf///////////////8TEv////8SEhISEhISEv//EhL/////EhIS/////////xIR//8RERER//////////8REf//Ef////8R////////ERP//////////////////xMTFP////8WFhYWFhb///8TEv//////////////Ev//EhL/////Ev8S/////////xIR//8R//8R//////8REREREf//Ef////8R/xUR////ERP/////E////////////xMTFP////8TExMTExP///8TEhISEhISEhISEhISEhT/EhL/////EhISFP8W/////xIR//8R//8RFhYW//////8REf//Ef////8R/xUR////ERP//////////////////xMTFBYWFhYTFxcXFRP///8TEv//////////////////EhL//////////xISEv///xIR//8R//8RERERFP////8REf//Ef////8R/xUR////ERP//////////////////xMTExMTExMTFP//FRP///8TEv//////////////////EhL//////////xL/Ev///xIR//8X//////////////8REf//Ef////8R/xURFP//ERP//////////////////xMTFxcXFxcX////FRP///8TEv//EhISEhISEhISEhISEhL//////////xISEhT//xIRFP//Fv////////////8REf//Ef////8R/xURFP8VERP//////////////////xMT////////////FRP///8TEv//Ev//////////////EhL//////////////////xIR////Ef////////////8REf//Ef////8R/xURFP//ERP//////////////////xMT////FhYW////FRP///8TEv//EhT/////////////EhL//////////////////xIR////Ef////////////8REf////////8R/xUR////ERP//////////////////xMT////ExMTFP//FRP///8TEv//EhT/////////////EhL///////////////8SEhIR////Ef////////////8REf///////////xUR////ERP/////////ExMTExMTExMT////E/8TFP//FRMT//8TEv//EhIS////////////EhL///////////////8SEhIR////Ef////////////8REf///////////xUR////ERP/////////ExQXFxcXFxMT//8VE/8TFP////////8TEv//FxcX////////////EhL/////////////EhISEhIR//////////////////8REf//////ERH///8X////ERP/////////F////////xMTE///E/8TFP////////8TEv///////xb/////Fv//EhL/////////////EhISEhIR//////////////////8REf//////////////////ERP/////////Fv///////xMT////E/8TFP///xYWFhYTEhISEhISEhISEv//EhISEhISEhISEv///xISEhISEhIREREWFhYREf///xER//8REf////////////8WERERERP///8TFhYWExYWExMTExMT//8TExMTExMTExMTExMTEhISEhISEhISEv//EhISEhISEhISEv///xISEhISEhIRERERERERERERERER//8RERERERERERER//8RERERERMTExMTExMTExMTExP//xMT//8TExMTExMTExMTExMTEv//////////////////EhL//xL//////xISEhISEhIR////////////Ef////8REf///////xH/////////ERP//////////////xP//xMT//////////////////8TEv//////////////////EhL//xL//////xISEhISEhIR////////////Ef////8REf///////xf/////////ERP//////////////xP//xMT////FRMTExMTExMTFP8TEv//EhISEhISEhIS////EhL//xL//xISEhL/FxcXFxIR//8REREREf//ERER//8REf//Ef//////////////ERP//xMTExMT/////xP//xMT/////xcXFxcXFxcX//8TEv//Ev//////////////EhL//xL//xL//////////xIR//8R////Ef//Ef////8REf//////////Ef//////ERP//xP///8TFP///xP//xMT//////////////////8TEv//////////////////EhL//xL/FRL//////////xIR//8R////Ef//Ef////8REf//////////////////ERP//xP///8TFP///xP//xMT//////////////////8TEv//////////////////EhL//xL//xL/////FRL//xIR//8R////Ef////////8REf//////////////////ERP//xP///8TFP///xP//xMT/////xYWFhYWFhYW//8TEv//EhIS////////////EhL//xL//xL/////FRL//xIR//8R////Ef////////8REf//////////////////ERP//xP///8TFP///xf//xMT////FRMTExMTExMT//8TEv//////////////////EhL//xL//xL/FRL//xL//xIR//8R//////////8REREREf//////////////////ERP//xP///8TFP///////xMT/////////xUT//////8TEv///////xIS////////EhL//xL//xL/FRL/FRL//xIR//////////////////8REf////////////8R////ERP//xP///8TFhYWFhb//xMT/////////xUT//////8TEv//////////////////EhL//xIU/xL/FRL//////xIR//////////////////8REf///xH/////////////ERP//xMTExMTExMTExP//xMT/////////xUT/////xUTEv///////////xIS////EhL//xL//xL/FRL//////xIR//////////////////8REf//////////////////ERP//////xP//////xP//xMT/////////xUT//8TFBUTEv//////////////////EhL//xL//xL/FRISEv///xIR//////////////////8REf//////////////////ERP//////xf//////xP//xMT/////////xUT//8TFBUTEv///////xIS////////EhL//////////xcXF////xIR//////////////////8REf//////////////////ERP//////////////xP//xMT//////////////////8TEv//////////////////EhL//////////////////xIRFP////////////////8REf//////////////////ERP//////xb//////xP//xMT//////////////////8TEv//EhISEv//////////EhISEhISEhISEv///xISEhIRFhYWERERERERERER//8REf//////////ERER////ERMTExMTExP//xMTExMTExMT//8TExYWFhYWFhYWFhYTEhIS//8SEhISEhISEhISEhISEhISEhISEhL//xISEhIRERERERERERERERER//8REREREREREf//ERERERERERMTExMTExP//xMTExMTExMT//8TExMTExMTExMTExMTEv//////////////////EhL//////////xL//////xIR//////////////////8REf//////////////////ERP//////////////////xMT//8T//////////////8TEv//////////////////EhL//////////xIS/////xIR//////////////////8REf//////////////////ERP//////////////////xMT//8T//////////////8TEhISEhISEhISEv//////EhL///////////8VEv///xIR//////////////////8REf//////////////////ERP//////////////////xMT//8X//////////////8TEv//////////////EhISEhL///8S//8S//8VEv///xIR////////////////EREREf//////////////////ERP///////8T//8T/////xMT//8W//////////////8TEv//////////EhIS////EhL///8S//8S//8VEv///xIR////////////////FxUREf///xH/////////////ERP///////8T//8T/////xMT//8TExMT//////////8TEv//////EhIS////////EhL///8S//8S//8VEv///xIR/////////////////xUREf////////////8R////ERP///////8T//8T/////xMT//8XFxcX//////////8TEv//EhIS////////////EhL///8S//8S//8VEv///xIR/////////////////xUREf//////////////////ERP///////8T/////////xMT//////////////////8TEv//////////////////EhL///8S//8S//8VEv///xIR//////8RERH//////xUREf//////////////////ERP///////8T/////////xMTFhYWFhYW//////////8TEhISEv//////////////EhL///8S//8S//8VEv///xIR//////8XFxf//////xUREf//////////////////ERP//////////////////xMTExMTExMT////FRP///8TEv///xISEv//////////EhL///8S//8S/////////xIR/////////////////xUREf///xH/////////////ERP//////////////////xMTExMTExMT////FRP///8TEv///////xISEv//////EhL///8S//8S/////////xIR/////////////////xUREf//////////////////ERP//////////////////xMT/////////////xf///8TEv///////////xIS////EhL///8S//8X////Ev///xIREREREf///////////xURERH/////////////////ERP//////////////////xMT//////////////////8TEv//////////////Ev//EhL//////////////////xIR/////xH//////////xUREf//////////////////ERP//////////////////xMT/////////////xb///8TEv//////////////////EhL//////////////////xIR/////////////////xUREf//////////////////ERP//////////////////xMT/////////////xP///8TEhISEhISEhISEhISEhISEhL/////EhIS/////////xIRERERERERERH///////8REf///////xEREf//////ERP///////8TExP//xP//xMT//8TExP///////////8T",collision:"AgICAgICAAAAAgICAgICAgICAgICAgICAAACAgICAgICAgICAgIAAAICAgICAgICAgICAgICAgAAAgICAgICAgIAAAICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgAAAAAAAAAAAAAAAAAQAgIIAAAAAAAAAAAAAAAAEAICAAAAAAAAAAAAAAAAAAACAgAAAAACAgAAAAIAAAAAAgIAAAJAQEBAQEBAQAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAgICAgICAAAQAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAACAgIAAAIAAAAAAgIAAAIAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAACAgIAAAICAgICAgICAgAAAAICAAAAAAACAgICAgIIAAACAgAQAgAAAAIAAAIAAAAAAgIAAAIAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAQAgIAAEBAQEAAAAAAAAAAAAICAAAAAAIAAAAAAAIIAAACAgAAAgICAAIAAAICCAAAAgIAAAAAICAgICAgIAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAgAQAgIIAAAAAAAAAAIAAAAAAAICAAAAAgAAAAAAAAIAAAACAgAAAAACAAIAAAICCAAAAgIAAAAAAgICAgICAgAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAIAAAAAAgIIAAIAAAAAAAAAAAAAEAICAAACAgICAgICAgIIAAACAgAAAAACAAIAAAAAAAAAAgIIAAAAAgAAAEBAQAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAgICAAIAAAAAAAAAAgIIAAAAAgAAAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAICAAAAAAAAAgIAAAACAAIIAAAAAAAAAAICAAAgICAAAAAAAAAAAAACAgAQAgAAAAIAAAACCAAAAgIIAAAAAgAAACAAAAAAAAICAAAAAAAAAgIAAAAAAAACAgAAAAAAACAgICAgICAgAgIAAAAAAAAAAAAAAAAAAAICAAACAgIIAAIAAAIIABACAgAAAAACAgIAAAACCAAAAgIAAAAAAgIAAAIAAAAAAAICAAAAAAACAgICAAAAAAACAgAAAgICAgICAgICAgICAgIAAAAAAAAAAAIAAAAAAAICAAACAAIIAAIAAAIIABACAgAAIAACAgIAAAACCAAAAgIAAAAAEAIAAAIAAAAAAAICAAAAAAICAgICAgAAAAACAgAAQEBAQEAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAACAAIIAAIAAAIIABACAgAAAgAAAAICAgICCAAAAgIAAAACAgIAAAIIAAAAAAICAAAAAgICAgICAgIAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAIAAAAAAAAAAAICAAACAggAAAIAAAIIABACAgAQAgICAAIAAAICCAAAAgIIAAACAAAAAAICAgAAAAICAAACAgICAgICAgICAAACAgIAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAEAAAAAAABACAgAAAAACAAIAAAICCAAAAgIIAAACAAAAAAIAAAAAAAICAAICAgICAgICAgICAgACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAABACAgAAAAACAAAAAAAAAAAAAgIgICACAAAAAAIgICAgIAICAgICAgICAgICAgICAgICAiAgIAIgIAIAAAICAAAAAgIAAAAAAAAAAAICAAAAAAICICAgAgIgICAgIAICAAACAgAAAgICAgICAgICAgICAgICAgICAAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAAAICAgICAgICAgICAgIAAAICAgICAgICAgICAgICAgICAgICAAACAgAAAgICAgICAgICAgICAgICAgICAAACAgICAgICAgICAgIAAAICAgICAgICAgICAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAABAQEBAAAACAgAAAgAAAAACAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICQAIAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAACAAAAACAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAgAAAAACAAAAAAAAAgIAAAAAAAAAAgAAAAAAAAICCEAAAAAAAAAAAAAAAAACAgAAAAACAgICAgICAgAAAgIAAAAAAgICAAAAAAAAAAICAAACAgICAAAAAAAAAAACAgAAAgAAAAACAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICCAAAAAAgICAgICAAAAACAgAAAAAAAAAAAAAAAgAAAgIAAAAAAgACAAAAAAAAAAICAAACAAACAAAAAAACAgICAgAAAgAAAAACABACAAAAAgIAAAAAAgAAAAAAAAAAAAICCAAAAAACAgICAgIAAAACAgICAgICAgICAgICAggAAgIAAAAAAgICCAAgAAAAAAICAAACAAACICAgAAAAAAACAgAAAgAAAAACABACAAAAAgIAAAAAAAAAAAAAAAAAAAICCCAgICACQEBAEAIAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAICAgAAAAICAAACAAACAgICCAAAAAACAgAAAgAAAAACABACAAAAAgIAAAAAAAAAAAAAAAAAAAICAgICAgICCAAAEAIAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAIAAgAAAAICAABAAAAAAAAAAAAAAAACAgAAAgAAAAACABACCAAAAgIAAAAAAAAAAAAAAAAAAAICQEBAQEBAAAAAEAIAAAACAgAAAgICAgICAgICAgICAgIAAAAAAAAAAAICAggAAAICCAAAIAAAAAAAAAAAAAACAgAAAgAAAAACABACCAAQAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAEAIAAAACAgAAAgAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAgAAAAAAAAAAAAACAgAAAgAAAAACABACCAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAICAgAAAAEAIAAAACAgAAAggAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAgAAAAAAAAAAAAACAgAAAAAAAAACABACAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAgICCAAAEAIAAAACAgAAAggAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAACAgICAAAAAgAAAAAAAAAAAAACAgAAAAAAAAAAABACAAAAAgIAAAAAAAAAAgICAgICAgICAAAAAgACCAAAEAICAAACAgAAAgICAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAACAgICAAAAAgAAAAAAAAAAAAACAgAAAAAAAAAAABACAAAAAgIAAAAAAAAAAghAQEBAQAICAAAQAgACCAAAAAAAAAACAgAAQEBAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAgICAgICAAAAAAAAAAAAAAAAAAACAgAAAAAAAgIAAABAAAAAAgIAAAAAAAAAQAAAAAAAAAICAgAAAgACCAAAAAAAAAACAgAAAAAAACAAAAAAIAAAAgIAAAAAAAAAAAAAAgICAgICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAIAAAAAAAAAICAAAAAgACCAAAACAgICACAgICAgICAgICAgAAAgICAgICAgICAgAAAAICAgICAgICAgIgICACAgAAAAICAAACAgAAAAAAAAAAAAAgAgICAgIAAAACICAgAiAgAgICAgICAAACAgICAgICAgICAgICAgICAgICAgICAgAAAgICAgICAgICAgAAAAICAgICAgICAgICAgICAgICAgICAAACAgICAgICAgICAAACAgICAgICAgICAgICAgICAgIAAAICAAACAgICAgICAgICAgICAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAAAAAICAgICAgICAAAAAAAAAAAAAgAAAAACAgAAAAAAAAIAAAAAAAAAAgIAAAAAAAAAAAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAAAAAICAgICAgICAAAAAAAAAAAAAgAAAAACAgAAAAAAAEAAAAAAAAAAAgIAAAAAAAAAAAAAAAIAAAICAAAAEAICAgICAgICCAACAgAAAgICAgICAgICAAAAAgIAAAIAAAICAgIAQEBAQAICAAACAgICAgAAAgICAAACAgAAAgAAAAAAAAAAAAAAAgIAAAICAgICAAAAAAIAAAICAAAAAEBAQEBAQEBAAAACAgAAAgAAAAAAAAAAAAAAAgIAAAIAAAIAAAAAAAAAAAICAAACAAAAAgAAAgAAAAACAgAAAAAAAAAAAgAAAAAAAgIAAAIAAAACCAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAEAIAAAAAAAAAAAICAAACAAAAAgAAAgAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAACCAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAIAAAAAEAIAAAICAAACAAAAAgAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAACCAAAAAIAAAICAAAAACAgICAgICAgAAACAgAAAgICAAAAAAAAAAAAAgIAAAIAAAIAAAAAEAIAAAICAAACAAAAAgAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAACCAAAAEAAAAICAAAAEAICAgICAgICAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAIAEAIAAAIAAAICAAACAAAAAAAAAAACAgICAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAACCAAAAAAAAAICAAAAAAAAABACAAAAAAACAgAAAAAAAAICAAAAAAAAAgIAAAIAAAIAEAIAEAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAACAAAAAgIAAAIAAAACICAgICAAAAICAAAAAAAAABACAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAIIAAIAEAIAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAIAAAAAAAAAAAAAAgIAAAICAgICAgICAgIAAAICAAAAAAAAABACAAAAABACAgAAAAAAAAAAAAICAAAAAgIAAAIAAAIAEAIAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAIAAAAAAAIAAAICAAAAAAAAABACAAACCBACAgAAAAAAAAAAAAAAAAAAAgIAAAIAAAIAEAICAgAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAEAAAAAAAAIAAAICAAAAAAAAABACAAACCBACAgAAAAAAAAICAAAAAAAAAgIAAAAAAAAAAEBAQAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICCAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAACAAAAAAAAIAAAICAAAAAAAAAAAAAAAAAAACAgAAAgICAgAAAAAAAAAAAgICAgICAgICAgAAAAICAgICICAgAgICAgICAgICAAACAgAAAAAAAAAAAgICAAAAAgICAgICAgIAAAICAgICAgICAAACAiAgICAgICAgICACAgICAAACAgICAgICAgICAgICAgICAgICAgIAAAICAgICAgICAgICAgICAgICAAACAgICAgICAgAAAgICAgICAgICAgICAgIAAAICAgICAgICAAACAgICAgICAgICAgICAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAIAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAACAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAICAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAACAAAAAAAAAAAAAAACAgICAgICAgICAgAAAAAAAgIAAAAAAAAAAAAQAgAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAABAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAgICAgIAAAACAAACAAAQAgAAAAICAAAAAAAAAAAAAAAAAgICAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAACAAACAAAAAAICAAAgAAAAAAAAAAAAAAACAgAAAAAAAAAAAgICAAAAAgIAAAACAAACAAAQAgAAAAICAAAAAAAAAAAAAAAAQBACAgAAAAIAAAAAAAAAAAAAAgIAAAAAAAACAAACAAAAAAICAAACAgICAAAAAAAAAAACAgAAAAAAAgICAAAAAAAAAgIAAAACAAACAAAQAgAAAAICAAAAAAAAAAAAAAAAABACAgAAAAAAAAAAAAACAAAAAgIAAAAAAAACAAACAAAAAAICAABAQEBAAAAAAAAAAAACAgAAAgICAAAAAAAAAAAAAgIAAAACAAACAAAQAgAAAAICAAAAAAAAAAAAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAACAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAACAAACAAAQAgAAAAICAAAAAAACAgIAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAACAAAAAAAAAAICICAgICAgAAAAAAAAAAACAgICAgAAAAAAAAAAAAAAAgIAAAACAAACAAAQAgAAAAICAAAAAABAQEAAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAgICAgICAAAAEAIAAAACAgAAAAICAgAAAAAAAAAAAgIAAAACAAACAAAAAAAAAAICAAAAAAAAAAAAAAAAABACAgAAAAIAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAgICAgICAAAAEAIAAAACAgAAAAAAAAICAgAAAAAAAgIAAAACAAACAAAAAAAAAAICAAAAAAAAAAAAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAEAAAAACAgAAAAAAAAAAAAICAAAAAgIAAAACAABAAAAAAgAAAAICAgICAgAAAAAAAAAAABACAgIAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAAAACAgAAAAAAAAAAAAAAAgAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAIAAAAAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAACAAAAACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAAAABACAgAAAAAAAAAAAAAAAAAAAgIAAAAAAAAAAAAAAAAAAAICAAAAAAAAAAAAAAIAAAACAgICAgICAgICAgICAgICAgIAAAAAAgICAAAAAAAAAAICAgICAgICAgIAAAAAAAACAgAAAAAAAAICAgAAAAAAAgIAAAAAAAACAgIAAAIAAAICAAACAgIAAAAAAAAAAAAC",charBitmapsData:"AAAAAAAAAAAAAAEBAQAAAAABAAAAAQAAAAEAAAEBAAAAAQABAAEAAAABAQAAAQAAAAEAAAABAAAAAAEBAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAEBAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAABAQEAAAAAAAAAAAAAAAAAAQEBAAAAAAEAAAABAAAAAAAAAAEAAAAAAAABAAAAAAAAAQAAAAAAAAEAAAAAAAABAQEBAQAAAAAAAAAAAAAAAQEBAQEAAAAAAAABAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAQAAAAEAAAABAAAAAAEBAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAABAQAAAAAAAQABAAAAAAEAAAEAAAAAAQEBAQEAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAABAQEBAQAAAAEAAAAAAAAAAQEBAQAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAQEBAAAAAAAAAAAAAAAAAAABAQAAAAAAAQAAAAAAAAEAAAAAAAAAAQEBAQAAAAABAAAAAQAAAAEAAAABAAAAAAEBAQAAAAAAAAAAAAAAAAEBAQEBAAAAAAAAAAEAAAAAAAABAAAAAAAAAQAAAAAAAAEAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAEAAAABAAAAAQAAAAEAAAAAAQEBAAAAAAEAAAABAAAAAQAAAAEAAAAAAQEBAAAAAAAAAAAAAAAAAAEBAQAAAAABAAAAAQAAAAEAAAABAAAAAAEBAQEAAAAAAAAAAQAAAAAAAAEAAAAAAAEBAAAAAAAAAAAAAAAAAAABAQEAAAAAAQAAAAEAAAABAAAAAQAAAAEBAQEBAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAQEBAAAAAAEAAAABAAAAAQAAAAEAAAABAQEBAAAAAAEAAAABAAAAAQAAAAEAAAABAQEBAAAAAAAAAAAAAAAAAAEBAQEAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAEBAQEAAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAEAAAAAAAAAAQAAAAAAAAABAQEBAAAAAAEAAAAAAAAAAQAAAAAAAAABAQEBAQAAAAAAAAAAAAAAAQEBAQEAAAABAAAAAAAAAAEAAAAAAAAAAQEBAQAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAQAAAAAAAAABAAAAAAAAAAEAAQEBAAAAAQAAAAEAAAABAAAAAQAAAAABAQEAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAQEBAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAEBAQAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAEBAQAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAABAQEAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAEAAAAAAQABAAAAAAABAQAAAAAAAAEAAQAAAAAAAQAAAQAAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQEBAQEAAAAAAAAAAAAAAAEAAAABAAAAAQEAAQEAAAABAAEAAQAAAAEAAQABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAQEAAAEAAAABAAEAAQAAAAEAAAEBAAAAAQAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAEBAQAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAQAAAAEAAAABAAAAAQAAAAEBAQEAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAEAAAABAAAAAQAAAAEAAAABAQEBAAAAAAEAAQAAAAAAAQAAAQAAAAABAAAAAQAAAAAAAAAAAAAAAAEBAQEAAAABAAAAAAAAAAEAAAAAAAAAAAEBAQAAAAAAAAAAAQAAAAAAAAABAAAAAQEBAQAAAAAAAAAAAAAAAAEBAQEBAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAQEBAAAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAABAAEAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAQABAAAAAQABAAEAAAABAAEAAQAAAAABAAEAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAQABAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAABAQAAAAAAAAAAAAAAAAAAAQEAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAABAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",charMap:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","R","S","T","U","V","W","Y","!",".",":","(",")"," "],code:'const cFL=t=>({x:128*Math.floor(t/4),y:128*(4-t%4)-128}),rL=t=>{t.x=8*lv[t.lv][0],t.y=8*lv[t.lv][1],t.velocity.x=0,t.velocity.y=0,t.controller.dead=!1,t.sprite.active=!0,t.fPa=.5,t.controller.b=0,t.animationPlayer.play("idle"),ca.x=cFL(t.lv).x,ca.y=cFL(t.lv).y},cTxt=t=>64-4*t.length/3-7,rSS=(t,s)=>{let e="Basement Cat",i="Ascends";if(print(e,24.5,19.5,0,1),print(e,25,20,7,1),print(i,36.5,34.5,0,1),print(i,37,35,7,1),"m"===gs)for(let s=0;s<t.gm.length;s++){let e=t.gm[s],i=62+6*s,l=t.sel===s?7:5;print(e,cTxt(e),i,l,.5)}else for(let s=0;s<t.o.length;s++){let e=t.o[s],i=62+6*s,l=t.sel===s?7:5;print(e,cTxt(e),i,l,.5)}spr(5,30,5,s.ad?10:0),spr(25,56,5,s.tc?7:0),spr(24,86,5,s.hc?8:0)},rPS=()=>{print("PAUSED",40,58,7,1)},rGOS=()=>{cls(1),print("GAME OVER",35,58,7,1);let t="Press A to restart";print(t,35,75,0,.5)},rAS=()=>{cls(1);let t=p.lv>8?"You\'ve reached the attic!":"You\'ve reached the living room!",s=p.lv>8?"You can now dash by ":"You can now double jump!",e="pressing down and jump button",i="Press A to continue";print(t,cTxt(t),30,7,.5),print(s,cTxt(s),40,7,.5),p.lv>8&&print(e,cTxt(e),50,7,.5),print(i,cTxt(i),75,0,.5)},sES=t=>{if(void 0===t)return;gs="end";let s="Additional Challenges Unlocked!",e="Deaths: "+(p.d||0),i="Time: "+fT(p.t),l="Press A to restart";cls(1),print("Congratulations!",30,21,7,.75),print("You have ascended!",25,35,7,.75),print(e,cTxt(e),55,7,.5),print(i,cTxt(i),61,7,.5),0===p.m&&print(s,cTxt(s),72,7,.5),print(l,cTxt(l),81,0,.5)},fT=t=>{let s=Math.floor(t/60),e=Math.floor(t%60),i=Math.floor(100*t%100);return s+":"+e.toString().padStart(2,"0")+"."+i.toString().padStart(2,"0")},PC=({speed:t=40,jumpForce:s=140,gravity:e=520,maxFall:i=200,coyoteMax:l=.12,bufferMax:p=.12,wc:a=0,wm:o=.12,boostForce:r=200})=>({type:"controller",attach(t){this.owner=t,this.resetState()},resetState(){this.g=!1,this.pg=!1,this.c=0,this.b=0,this.lt=0,this.iw=!1,this.wj=0,this.wd=0,this.wc=a,this.wm=o,this.dead=!1,this.ff=0,this.ls=0,this.jc=0,this.bu=!1,this.bo=!1,this.a=!1,this.p=!1,this.fPa=0,this.go=!1},update(t){const s=this.owner;if(this.p||this.go||s.fPa>0)return;if(this.dead)return this.handleDeath(s);if(this.a||this.isAtGoal())return s.animationPlayer.play("ascend"),this.a=!0,3===s.m&&(s.tc=!0),2===s.m&&(s.hc=!0),this.lv=0,s.velocity.x=0,s.velocity.y=-40,s.ad=!0,s.hp=!1,void s.sfls();const e=this.handleInput();this.updateGroundAndWallState(e),this.updateWallCoyote(t),this.handleJumpLogic(s,e),this.updateTimers(t,e,s),this.applyGravity(t,s),this.handleAnimations(t,e,s),this.applySpriteFlip(e,s,t)},updateWallCoyote(t){this.iw?(this.wc=o,this.ls=this.owner.collisionBox.isOnWallLeft?-1:1):this.wc=Math.max(0,this.wc-t)},handleInput(){let t=0;return btn(0)&&(t-=1),btn(1)&&(t+=1),t},updateGroundAndWallState(t){const s=this.owner;this.pg=this.g,this.g=s.collisionBox.isOnFloor,this.g&&(this.ls=0,this.jc=0,this.bu=!1,this.bo=!1);const e=t<0&&s.collisionBox.isOnWallLeft,i=t>0&&s.collisionBox.isOnWallRight;this.iw=!this.g&&(e||i),(this.iw||0==s.velocity.x)&&(this.bo=!1)},handleJumpLogic(e,i){if(!(this.b<=0)){if(e.asc>1&&btn(3)&&!this.bu&&!this.onWall){const t=e.sprite.flipX?-1:1;if(0!==t)return e.velocity.y=.8*-s,e.velocity.x=t*r,this.bu=!0,this.bo=!0,0===this.jc&&this.jc++,void(this.b=0)}if(this.c>0)e.velocity.y=-s,this.b=0,this.c=0,this.jc++;else if(this.wc>0&&0!==this.ls){this.wj=.25,e.velocity.y=-s;const i=-this.ls;e.velocity.x=i*t*1.2,e.sprite.flipX=i<0,this.wd=i,this.ff=.2,this.ls=0,this.b=0,this.wc=0}else this.jc<2&&e.asc>0&&(e.velocity.y=-s,this.b=0,this.jc++,this.bo=!1)}},updateTimers(s,e,i){this.c=this.g?l:Math.max(0,this.c-s),btn_pressed(4)?this.b=p:this.b=Math.max(0,this.b-s),this.wj>0?(this.wj-=s,i.velocity.x=this.wd*t):this.bo||(i.velocity.x=e*t),btn_released(4)&&(i.velocity.y=i.velocity.y/3)},applyGravity(t,s){this.iw&&s.velocity.y>0?s.velocity.y=Math.min(s.velocity.y+e*t,30):s.velocity.y=Math.min(s.velocity.y+e*t,i)},handleAnimations(t,s,e){if(!this.pg&&this.g&&(this.lt=.1),this.lt>0)return this.lt-=t,void e.animationPlayer.play(Math.abs(e.velocity.x)>.1?"run":"idle");this.g?e.animationPlayer.play(Math.abs(e.velocity.x)>.1?"run":"idle"):e.velocity.y<=-.5?e.animationPlayer.play("jump_up"):e.velocity.y>=.5?e.animationPlayer.play(this.iw?"wall":"fall"):e.animationPlayer.play("jump_mid")},applySpriteFlip(t,s,e){!this.onWall&&s.sprite&&0!==t&&(this.ff>0?this.ff-=e:(this.ff=0,s.sprite.flipX=t<0))},handleDeath(t){t.animationPlayer.play("death"),t.velocity.x=0,t.velocity.y=0,this.bu=!1,this.bo=!1,t.sfls()},isAtGoal(){const t=this.owner,s=t.x+t.collisionBox.width*t.s/2,e=t.y+t.collisionBox.height*t.s/2;return s>=8*t.goalTile.x&&s<=8*t.goalTile.x+8&&e>=8*t.goalTile.y&&e<=8*t.goalTile.y+8}}),DBC=({width:t=8,height:s=8,offsetX:e=0,offsetY:i=0})=>({type:"damageBox",attach(l){this.owner=l,this.width=t,this.height=s,this.offsetX=e,this.offsetY=i},getAABB(t=this.owner.x,s=this.owner.y){return{x:t+this.offsetX,y:s+this.offsetY,w:this.width*this.owner.s,h:this.height*this.owner.s}},update(t){const s=this.owner,e=this.getAABB();(collide_box(e.x,e.y,e.w,e.h,4)||check_half_tile(e.x,e.y,e.w,e.h,8,"left")||check_half_tile(e.x,e.y,e.w,e.h,16,"right")||check_half_tile(e.x,e.y,e.w,e.h,32,"bottom")||check_half_tile(e.x,e.y,e.w,e.h,64,"top"))&&s.onDamage?.()}}),lv=[[3,62],[4,46],[9,30],[10,14],[22,62],[29,46],[26,30],[26,14],[39,62],[43,46],[44,30],[44,14],[56,62],[58,46],[60,30],[51,14],[72,62],[73,46],[76,30],[71,14],[83,62],[84,46],[83,30],[81,13]],cBox={width:6,height:5,offsetX:1,offsetY:3},p=new GO({x:8*lv[0][0],y:8*lv[0][1],s:1,name:"p"});p.lv=0,p.goalTile={x:88,y:7},p.add(Sprite({id:[[0]],s:1,flipX:!1,flipY:!1})),p.add(AnimationPlayer({animations:{idle:{frames:[5,6],speed:2},run:{frames:[0,1,2,3,4],speed:15},jump_up:{frames:[1],speed:1},jump_mid:{frames:[2],speed:1},fall:{frames:[3],speed:1},wall:{frames:[7],speed:1},death:{frames:[8,9,10,11],speed:15,repeat:!1,onEnd:()=>rL(p)},ascend:{frames:[12,13,14,15,16],speed:6,repeat:!1,onEnd:()=>{p.sprite.active=!1,p.lv=0,p.hp=!1,sES(p),p.controller.resetState()}}},defaultAnimation:"idle"})),p.add(PC({})),p.add(CollisionBox(cBox)),p.add(DBC(cBox)),p.getColor=()=>p.controller.a?10:0===p.asc?0:1===p.asc?p.controller.jc>1?0:4:2===p.asc?p.controller.bu?p.controller.jc>1?0:4:p.controller.jc>1?6:7:void 0,p.onDamage=()=>{p.controller.dead||(p.controller.dead=!0,p.d++)},p.r=()=>{p.asc=0,p.m=0,p.d=0,p.t=0,p.controller.resetState(),p.setLevel(),p.sprite.active=!0,p.lives=2===p.m?9:0},p.setLevel=()=>{p.x=8*lv[p.lv][0],p.y=8*lv[p.lv][1]},p.lfls=()=>{const t=JSON.parse(localStorage.getItem("basement-cat-ascends-save"));t&&(p.hp=t.hp||!1,p.lv=t.lv||0,p.asc=t.asc||0,p.d=t.d||0,p.t=t.t||0,p.lives=t.lives||0,p.ad=t.ad||!1,p.tc=t.tc||!1,p.hc=t.hc||!1,p.m=t.m||0,p.setLevel())},p.sfls=()=>{const t={hp:p.hp,lv:p.lv,asc:p.asc,d:p.d,t:p.t,lives:p.lives,ad:p.ad||!1,tc:p.tc,hc:p.hc,m:p.m};localStorage.setItem("basement-cat-ascends-save",JSON.stringify(t))},p.setMode=t=>{p.r(),p.m=t,0===t?(p.hp=!0,p.sfls()):1===t?(p.asc=2,p.hp=!0,p.sfls()):2===t?(p.asc=2,p.lives=9,p.hp=!0,p.sfls()):3===t&&(p.asc=2,p.m=3,p.hp=!0,p.sfls())},p.lfls(),p.tc=!1,p.hc=!1;const ca=cFL(p.lv);let gs="st",ss={sel:0,resume:p.hp||!1,o:["New Game"],gm:["Normal","Ascended","Nine Lives","Time Challenge","Back"],choosing_mode:!1};function _init(){addObject(p),ss.resume&&ss.o.unshift("Resume")}function _update(t){if(void 0!==p){if(p.fPa>0)return p.fPa-=t,void(p.fPa<0&&(p.fPa=0));if("p"!==gs){if("st"===gs){if(p.lfls(),btn_pressed(4))if("Resume"===ss.o[ss.sel])rL(p),gs="pl";else if("New Game"===ss.o[ss.sel])return p.ad?(gs="m",void(ss.sel=0)):(p.r(),p.hp=!0,p.lv=0,p.sfls(),rL(p),void(gs="pl"));btn_pressed(2)&&(ss.sel=(ss.sel-1+ss.o.length)%ss.o.length),btn_pressed(3)&&(ss.sel=(ss.sel+1)%ss.o.length)}if("m"===gs&&(btn_pressed(2)&&(ss.sel=(ss.sel-1+ss.gm.length)%ss.gm.length),btn_pressed(3)&&(ss.sel=(ss.sel+1)%ss.gm.length),btn_pressed(4)))return"Back"===ss.gm[ss.sel]?(gs="st",void(ss.sel=0)):(p.setMode(ss.sel),p.lv=0,rL(p),void(gs="pl"));if("pl"===gs){if(btn_pressed(6))return gs="p",void(p.controller.p=!0);if(2===p.m&&p.d>=p.lives)return gs="go",p.controller.go=!0,void(p.sprite.active=!1);if(3===p.m&&p.t>300)return gs="go",p.controller.go=!0,p.sprite.active=!1,p.t=0,void p.sfls();p.t+=t,p.lv>7&&0===p.asc&&(p.asc=1),p.lv>15&&p.asc<2&&(p.asc=2);let s={x:0,y:0};s.x=p.x-ca.x,s.y=p.y-ca.y,s.y<0&&(p.lv++,p.lv%8==0&&p.lv>0&&0===p.m&&(gs="new_ability"),p.sfls(),rL(p)),s.y>119&&!p.controller.dead&&(p.controller.dead=!0,p.d++)}"go"!==gs?("new_ability"===gs&&btn_pressed(4)&&(gs="pl"),"end"===gs&&btn_pressed(4)&&(gs="st",p.lv=0,p.hp=!1,p.asc=0,rL(p))):btn_pressed(4)&&(gs="st",p.lv=0,p.lives=2===p.m?9:0,p.d=0,p.t=3===p.m?3e5:0,p.sprite.active=!0,p.controller.resetState(),p.hp=!1,rL(p),p.sfls())}else btn_pressed(6)&&(gs="pl",p.controller.p=!1)}}function _draw(t){if("st"===gs||"m"===gs)return cls(1),void rSS(ss,p);if("pl"!==gs&&"p"!==gs||(p.lv<8?cls(5):p.asc<16?cls(1):cls(5),cam(ca.x,ca.y,1),2===p.m&&(spr(24,1,0,8,{s:.25}),print(p.lives-p.d,10,1,7,.75)),3===p.m&&(spr(25,1,0,7),print(fT(Math.max(0,300-p.t)),10,1,7,.75)),"p"===gs&&rPS()),"go"!==gs){if("new_ability"!==gs)return"end"===gs?(cls(1),void sES(p)):void 0;rAS()}else rGOS()}',p:[[0,0,0],[.114,.169,.326],[.475,.224,.506],[0,.667,.278],[.796,.251,.161],[.275,.275,.275],[.667,.667,.667],[1,1,1],[1,0,.263],[1,.635,0],[1,.988,0],[0,.933,.255],[0,.745,1],[.392,.608,.922],[1,.506,.98],[.949,.667,.263]],constants:{SPRITE_SIZE:8,SCALE:8,NUMBER_OF_COLS:16},inputMap:{keyboard:{ArrowLeft:0,ArrowRight:1,ArrowUp:2,ArrowDown:3,z:4,x:5,Enter:6,Shift:7,a:0,d:1,w:2,s:3},gamepad:{buttons:{0:4,1:5,8:7,9:6,12:2,13:3,14:0,15:1},axes:{"0-":0,"0+":1,"1-":2,"1+":3}}}},t=({id:A,s:t=1,flipX:s=!1,flipY:e=!1,spr:i,camera:E})=>({type:"sprite",attach(i){this.owner=i,this.id=A,this.s=t,this.flipX=s,this.flipY=e,this.active=!0},draw(A){if(!this.active)return;const t=this.owner,s=t.s*this.s,e=E;let h=Array.isArray(this.id[0])?this.id:[Array.isArray(this.id)?this.id:[this.id]];const I=h.length,a=h[0].length,g=t.x,r=t.y,n=t.x+8*a*s,o=t.y+8*I*s,C=e.x,l=e.y,c=e.x+e.width,x=e.y+e.height;if(n<C-8||g>c+8||o<l-8||r>x+8)return;const p=t.previousX+(t.x-t.previousX)*A,R=t.previousY+(t.y-t.previousY)*A;for(let A=0;A<I;A++)for(let E=0;E<a;E++){const g=this.flipY?I-1-A:A,r=this.flipX?a-1-E:E,n=h[g][r];i(n,(p+8*E*s-e.x)*e.s,(R+8*A*s-e.y)*e.s,t.getColor(),{s:s*e.s,flipX:this.flipX,flipY:this.flipY})}}}),s=({width:A=8,height:t=8,offsetX:s=0,offsetY:e=0,box_collide:i})=>({type:"collisionBox",attach(E){this.owner=E,this.width=A,this.height=t,this.offsetX=s,this.offsetY=e,this.box_collide=i,this.isOnFloor=!1,this.isOnWallLeft=!1,this.isOnWallRight=!1,this.isOnWall=!1,this.isOnCeiling=!1},getAABB(A=this.owner.x,t=this.owner.y){return{x:A+this.offsetX,y:t+this.offsetY,w:this.width*this.owner.s,h:this.height*this.owner.s}},update(A){const t=this.owner,s=t.x+t.velocity.x*A,e=t.y+t.velocity.y*A,i=this.getAABB(s,t.y),E=this.getAABB(t.x,e);this.box_collide(i.x,i.y,i.w,i.h)?(t.velocity.x=0,t.x<s&&(this.isOnWallRight=!0),t.x>s&&(this.isOnWallLeft=!0)):(t.x=s,this.isOnWallLeft=!1,this.isOnWallRight=!1),this.box_collide(E.x,E.y,E.w,E.h)?(t.velocity.y=0,t.y<e&&(this.isOnFloor=!0),t.y>e&&(this.isOnCeiling=!0)):(t.y=e,this.isOnFloor=!1,this.isOnCeiling=!1)}}),e=({animations:A,defaultAnimation:t})=>({type:"animationPlayer",attach(s){this.owner=s,this.animations=A,this.currentAnimation=null,this.currentFrameIndex=0,this.accumulatedTime=0,t&&this.play(t)},play(A){const t=this.animations[A];t&&t!==this.currentAnimation&&(this.currentAnimation=t,this.currentFrameIndex=0,this.accumulatedTime=0)},update(A){if(!this.currentAnimation)return;const t=this.currentAnimation,s=t.repeat??!0,e=t.onEnd??null;for(this.accumulatedTime+=A*(t.speed??1);this.accumulatedTime>=1;)this.accumulatedTime-=1,this.currentFrameIndex++,this.currentFrameIndex>=t.frames.length&&(s?this.currentFrameIndex=0:(this.currentFrameIndex=t.frames.length-1,e&&e(this.owner)));const i=this.owner.sprite;i&&(i.id=t.frames[this.currentFrameIndex])}});class i{constructor(A,t=null,s,e=2){this.map=A,this.s=s,this.tileSize=t??8*s,this.mask=255&e}_flagsAt(A,t,s=null){const e=(s||this.map)[t];return e?255&e[A]:0}_tileHitsMask(A,t,s,e=null){return 0!=(this._flagsAt(A,t,e)&s)}isBoxColliding(A,t,s,e,i={}){const E=i.map||this.map,h=i.mask||this.mask;A*=this.s,t*=this.s,s*=this.s,e*=this.s;const I=this.tileSize,a=Math.floor(A/I),g=Math.floor((A+s-1)/I),r=Math.floor(t/I),n=Math.floor((t+e-1)/I);for(let A=r;A<=n;A++)for(let t=a;t<=g;t++)if(this._tileHitsMask(t,A,h,E))return!0;return!1}checkHalfTile(A,t,s,e,i,E,h=this.map){A*=this.s,t*=this.s,s*=this.s,e*=this.s;const I=this.tileSize,a=Math.floor(A/I),g=Math.floor((A+s-1)/I),r=Math.floor(t/I),n=Math.floor((t+e-1)/I);for(let o=r;o<=n;o++)for(let r=a;r<=g;r++){if(!(this._flagsAt(r,o,h)&i))continue;const a=r*I,g=o*I;switch(E){case"left":if(A<a+I/2&&A+s>a)return!0;break;case"right":if(A+s>a+I/2&&A<a+I)return!0;break;case"top":if(t<g+I/2&&t+e>g)return!0;break;case"bottom":if(t+e>g+I/2&&t<g+I)return!0}}return!1}}class E{constructor({x:A=0,y:t=0,s:s=1,z:e=0,name:i=""}={}){this.x=A,this.y=t,this.previousX=A,this.previousY=t,this.s=s,this.z=e,this.velocity={x:0,y:0},this.name=i,this.isActive=!0,this.components=[]}add(A){return A.attach?.(this),this.components.push(A),A.type&&(this[A.type]=A),this}update(A){this.previousX=this.x,this.previousY=this.y;for(const t of this.components)t.update?.(A)}destroy(){if(this.isActive=!1,this.parser){const A=this.parser.sceneObjects.indexOf(this);A>=0&&this.parser.sceneObjects.splice(A,1)}}draw(A){for(const t of this.components)t.draw?.(A)}}const h=A=>Uint8Array.from(atob(A),A=>A.charCodeAt(0));function I(A,t,s,e){const i=[];let E=0;for(let h=0;h<t;h++){const t=[];for(let i=0;i<s;i++){const s=[];for(let t=0;t<e;t++)s.push(A[E++]);t.push(s)}i.push(t)}return i}function a(A,t,s){const e=[];for(let i=0;i<t;i++)e.push(A.slice(i*s,(i+1)*s));return e}A.sprites=I(h(A.sprites),26,8,8),A.tilemap=a(h(A.tilemap),64,96),A.collision=a(h(A.collision),64,96),A.charBitmapsData=I(h(A.charBitmapsData),46,8,8),A.cb=function(A,t){const s={};return A.forEach((A,e)=>{s[A]=t[e]}),s}(A.charMap,A.charBitmapsData),A.inputMap=A.inputMap;const{SPRITE_SIZE:g,SCALE:r,NUMBER_OF_COLS:n}=A.constants,o=g*r,C=o*n,l=new class{constructor(A,t,s,e,i,E,h={}){this.canvasWidth=A,this.canvasHeight=t,this.id=s,this.parentId=e,this.spriteSheet=i,this.tm=E,this.styles=h,this.canvas=null,this.parser=null,this.renderer=null}setRenderer(A){this.renderer=A}setParser(A){this.parser=A}createCanvas(){return this.canvas=document.createElement("canvas"),this.canvas.id=this.id,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvas.style.imageRendering="pixelated",this.canvas.style.imageRendering="crisp-edges",this.canvas.style.position="absolute",this.styles.left&&(this.canvas.style.left=this.styles.left),this.styles.top&&(this.canvas.style.top=this.styles.top),this.styles.zIndex&&(this.canvas.style.zIndex=this.styles.zIndex),this.canvas}init(){document.getElementById(this.parentId||document.body).appendChild(this.canvas),this.renderer.lSDT(this.spriteSheet),this.renderer.lTDT(this.tm),this.parser.runInit(),this.updateInterval=setInterval(()=>{this.parser.updateGame()},1e3/60),this.animationFrame=requestAnimationFrame(this.renderLoop.bind(this))}tearDown(){clearInterval(this.updateInterval),cancelAnimationFrame(this.animationFrame),this.renderer=null,this.parser=null}renderLoop(){this.parser.drawGame(),this.renderer.r(),this.animationFrame=requestAnimationFrame(this.renderLoop.bind(this))}}(C,C,"game-canvas","app",A.sprites,A.tilemap),c=l.createCanvas(),x=new class{constructor(A,t,s,e,i,E,h){this.canvas=A,this.ftw=null,this.fth=null,this.p=t,this.cb=s,this.ss=e,this.nc=i,this.s=E,this.sts=e*E,this.fcm=null,this.g=A.getContext("webgl2"),this.g||console.error("WebGL2 not supported"),this.dq=[],this.iGL(),this.txm={sprite:this.pT(),font:this.pT({width:Object.keys(this.cb).length*this.ss,height:this.p.length*this.ss}),tm:this.pT({width:128*this.ss,height:64*this.ss})},this.ms=2e3,this.vs=24,this.sb=new Float32Array(this.ms*this.vs),this.ssc=null,this.tmc=null,this.tm=h,this.spriteData=[],this.lFTFB()}iGL(){const A=this.g;A.enable(A.BLEND),A.blendFunc(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA),this.program=this.cSP("#version 300 es\n            precision mediump float;\n            in vec2 position;\n            in vec2 texcoord;\n            out vec2 v_texcoord;\n            void main() {\n                gl_Position = vec4(position, 0.0, 1.0);\n                v_texcoord = texcoord;\n            }\n        ","#version 300 es\n            precision mediump float;\n            in vec2 v_texcoord;\n            out vec4 outColor;\n            uniform sampler2D u_texture;\n            void main() {\n                outColor = texture(u_texture, v_texcoord);\n            }\n        "),A.useProgram(this.program),this.vertexBuffer=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),this.positionLoc=A.getAttribLocation(this.program,"position"),A.enableVertexAttribArray(this.positionLoc),A.vertexAttribPointer(this.positionLoc,2,A.FLOAT,!1,16,0),this.texcoordLoc=A.getAttribLocation(this.program,"texcoord"),A.enableVertexAttribArray(this.texcoordLoc),A.vertexAttribPointer(this.texcoordLoc,2,A.FLOAT,!1,16,8),this.uTexture=A.getUniformLocation(this.program,"u_texture"),A.uniform1i(this.uTexture,0)}pT(A={width:this.canvas.width,height:this.canvas.width}){const t=this.g,s=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,A.width,A.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),s}cSP(A,t){const s=this.g;function e(A,t,s){const e=A.createShader(t);return A.shaderSource(e,s),A.compileShader(e),A.getShaderParameter(e,A.COMPILE_STATUS)?e:(console.error(A.getShaderInfoLog(e)),A.deleteShader(e),null)}const i=e(s,s.VERTEX_SHADER,A),E=e(s,s.FRAGMENT_SHADER,t),h=s.createProgram();return s.attachShader(h,i),s.attachShader(h,E),s.linkProgram(h),s.getProgramParameter(h,s.LINK_STATUS)||console.error(s.getProgramInfoLog(h)),h}lSDT(A){this.spriteData=A;const t=document.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.width;const s=t.getContext("2d"),e=s.createImageData(this.canvas.width,this.canvas.width),i=e.data;for(let s=0;s<A.length;s++){const e=s%this.nc*this.sts,E=Math.floor(s/this.nc)*this.sts;for(let h=0;h<this.ss;h++)for(let I=0;I<this.ss;I++){const a=this.p[A[s][h][I]]||[0,0,0,0];for(let A=0;A<this.s;A++)for(let s=0;s<this.s;s++){const g=e+I*this.s+s,r=4*((E+h*this.s+A)*t.width+g);i[r]=255*a[0],i[r+1]=255*a[1],i[r+2]=255*a[2],i[r+3]=a.length>3?a[3]:255}}}s.putImageData(e,0,0),this.ssc=t;const E=this.g;E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,this.txm.sprite),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,t),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.NEAREST),E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,null)}lTDT(A){const t=document.createElement("canvas");t.width=128*this.ss,t.height=64*this.ss;const s=t.getContext("2d");if(!this.ssc)return void console.error("ssc saknas. Kör lSDT först.");Math.floor(this.ssc.width/this.sts);for(let t=0;t<64;t++)for(let e=0;e<128;e++){const i=A[t][e];if(null==i||255===i)continue;const E=i%this.nc*this.sts,h=Math.floor(i/this.nc)*this.sts;s.drawImage(this.ssc,E,h,this.sts,this.sts,e*this.ss,t*this.ss,this.ss,this.ss)}const e=this.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.txm.tm),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,null),this.tmc=t}lFTFB(){const A=this.cb,t=this.p,s=Object.keys(A),e=s.length,i=t.length,E=document.createElement("canvas");E.width=8*e,E.height=8*i,this.ftw=E.width,this.fth=E.height;const h=E.getContext("2d"),I=h.createImageData(E.width,E.height),a=I.data;for(let h=0;h<e;h++){const e=A[s[h]];for(let A=0;A<i;A++){const s=t[A];for(let t=0;t<8;t++)for(let i=0;i<8;i++){const I=e[t][i],g=8*h+i,r=4*((8*A+t)*E.width+g);a[r]=255*s[0]*I,a[r+1]=255*s[1]*I,a[r+2]=255*s[2]*I,a[r+3]=I?255:0}}}h.putImageData(I,0,0);const g=this.g;g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,this.txm.font),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,E),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.activeTexture(g.TEXTURE0),g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,null),this.fcm=Object.fromEntries(s.map((A,t)=>[A,t]))}cS(A=[0,0,0]){this.dq=[];const t=this.g;t.clearColor(A[0],A[1],A[2],1),t.clear(t.COLOR_BUFFER_BIT)}dR(A,t,s,e,i){this.dq.push({type:"rect",x:A,y:t,width:s,height:e,color:i})}dC(A,t,s,e){this.dq.push({type:"circle",x:A,y:t,radius:s,color:e})}dLR(A,t,s,e,i){this.dR(A,t,s,this.s,i),this.dR(A,t,this.s,e,i),this.dR(A+s-this.s,t,this.s,e,i),this.dR(A,t+e-this.s,s,this.s,i)}dT(A,t,s,e=7,i={}){t*=this.s,s*=this.s,A=A.toString();const E=i.s??1,h=Math.round((i.spacing??this.s*this.s/1.6)*Math.max(.1,E)),I=A.toUpperCase();for(let A=0;A<I.length;A++){const a=I[A],g=this.fcm?.[a];if(void 0===g)continue;const r=e,n=g*this.ss/this.ftw,o=r*this.ss/this.fth,C=this.ss/this.ftw,l=this.ss/this.fth;this.dq.push({type:"font",x:t+A*(this.ss*E+h),y:s,spriteX:n,spriteY:o,spriteWidth:C,spriteHeight:l,options:i})}}dTM(A,t,s,e,i,E,h={}){this.dq.push({type:"tilemap",cx:A,cy:t,mx:s,my:e,mw:i,mh:E,s:h.s??this.s??1})}rTM(A){const t=this.g,{cx:s,cy:e,mx:i,my:E,mw:h,mh:I,s:a=this.s}=A,g=128*this.ss,r=64*this.ss,n=.5/g,o=.5/r,C=(i+n)/g,l=(E+o)/r,c=(i+h-n)/g,x=(E+I-o)/r,p=this.canvas.width/2,R=this.canvas.height/2,d=s/p-1,f=1-e/R,T=d+h*a/p,B=f-I*a/R,u=new Float32Array([d,f,C,l,T,f,c,l,d,B,C,x,d,B,C,x,T,f,c,l,T,B,c,x]);t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.txm.tm),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,u,t.STATIC_DRAW),t.drawArrays(t.TRIANGLES,0,6)}cDQ(){this.dq=[]}dF(A){const{s:t=1,flipX:s=!1,flipY:e=!1}=A.options??{},i=this.canvas.width/2,E=A.x/i-1,h=1-A.y/i,I=E+this.sts*t*(s?-1:1)/i,a=h-this.sts*t*(e?-1:1)/i;let g=A.spriteX,r=A.spriteY,n=g+A.spriteWidth,o=r+A.spriteHeight;s&&([g,n]=[n,g]),e&&([r,o]=[o,r]);const C=new Float32Array([E,h,g,r,I,h,n,r,E,a,g,o,E,a,g,o,I,h,n,r,I,a,n,o]),l=this.g;l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,this.txm.font),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,C,l.STATIC_DRAW),l.drawArrays(l.TRIANGLES,0,6)}dRI(A){let t=A.width/(this.canvas.width/2),s=A.height/(this.canvas.width/2),e=1+A.x/(this.canvas.width/2)-1,i=1-A.y/(this.canvas.width/2)+1-s,E=A.color;const h=this.g;h.enable(h.SCISSOR_TEST),h.scissor(e*(this.canvas.width/2),i*(this.canvas.width/2),t*(this.canvas.width/2),s*(this.canvas.width/2)),h.clearColor(E[0],E[1],E[2],E[3]||1),h.clear(h.COLOR_BUFFER_BIT),h.disable(h.SCISSOR_TEST)}drawSpriteWithSingleColor(A,t,s,e,{s:i=1,flipX:E=!1,flipY:h=!1}={}){this.g;const I=this.ss,a=t*this.s,g=s*this.s,r=this.spriteData[A];for(let A=0;A<I;A++)for(let t=0;t<I;t++){if(255===r[A][t])continue;let s=h?I-1-A:A;const n=a+(E?I-1-t:t)*this.s*i,o=g+s*this.s*i;this.dq.push({type:"rect",x:n,y:o,width:this.s*i,height:this.s*i,color:e})}}r(){const A=this.g;A.bindFramebuffer(A.FRAMEBUFFER,null),A.viewport(0,0,this.canvas.width,this.canvas.height),A.clear(A.COLOR_BUFFER_BIT),A.useProgram(this.program),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.enableVertexAttribArray(this.positionLoc),A.vertexAttribPointer(this.positionLoc,2,A.FLOAT,!1,16,0),A.enableVertexAttribArray(this.texcoordLoc),A.vertexAttribPointer(this.texcoordLoc,2,A.FLOAT,!1,16,8);for(let A=0;A<this.dq.length;A++){const t=this.dq[A];"font"===t.type&&this.dF(t),"rect"===t.type&&this.dRI(t),"circle"===t.type&&this.dECF(t),"tilemap"===t.type&&this.rTM(t)}this.cDQ()}}(c,A.p,A.cb,g,n,r,A.tilemap),p=new class{constructor(A,h,I,a,g,r,n){this.userCode=A,this.renderer=h,this.gameFunctions={_init:()=>{},_update:()=>{},_draw:()=>{}},this.inputState=null,this.keyboardState=null,this.gamepadState=null,this.cp=I,this.s=a,this.inputMap=r,this.fixedDelta=1e3/60,this.lastTime=performance.now(),this.fpsAccumulator=0,this.alpha=null,this.collisionLayer=n||Array.from({length:64},()=>Array(128).fill(0)),this.collisionHelper=new i(this.collisionLayer,g,this.s),this.gamepadMap={buttons:{},axes:{}},this.sceneObjects=[],this.camera={x:0,y:0,width:h.width,height:h.height,s:1},this.sandbox={Math:Math,console:console,log:(...A)=>console.log("[Game]:",...A),print:(A,t=0,s=0,e=7,i=1)=>this.renderer.dT(A,t,s,e,{s:i}),cls:(A=0)=>this.renderer.cS(this.cp[A]),spr:(A,t,s,e=0,i={s:1,flipX:!1,flipY:!1})=>this.renderer.drawSpriteWithSingleColor(A,t,s,this.cp[e],{scaleX:i.s,scaleY:i.s,flipX:i.flipX,flipY:i.flipY}),cam:(A,t,s=1)=>this.drawCamera(A,t,s),rect:(A,t,s,e,i=7)=>this.renderer.dR(A*this.s,t*this.s,s*this.s,e*this.s,this.cp[i]),collide_box:(A,t,s,e,i=null,E=null)=>this.collisionHelper.isBoxColliding(A,t,s,e,{map:E,mask:i}),check_half_tile:(A,t,s,e,i,E,h=this.map)=>this.collisionHelper.checkHalfTile(A,t,s,e,i,E,h),btn:A=>!(!this.keyboardState?.[A]&&!this.gamepadState?.[A]),btn_pressed:A=>{const t=!!this.keyboardState?.[A],s=!!this.keyboardPrevState?.[A],e=!!this.gamepadState?.[A],i=!!this.gamepadPrevState?.[A];return t&&!s||e&&!i},btn_released:A=>{const t=!!this.keyboardState?.[A],s=!!this.keyboardPrevState?.[A],e=!!this.gamepadState?.[A],i=!!this.gamepadPrevState?.[A];return!t&&s||!e&&i},GO:E,Sprite:A=>t({...A,spr:this.sandbox.spr,camera:this.camera}),CollisionBox:A=>s({...A,box_collide:this.sandbox.collide_box}),AnimationPlayer:A=>e(A),addObject:A=>this.addObject(A)},this.setupInput(),this.loadGame()}drawCamera(A,t,s=1){this.camera.x=A,this.camera.y=t,this.camera.s=s,this.renderer.dTM(0,0,A,t,128,128,s)}addObject(A){return A.parser=this,this.sceneObjects.push(A),A}setupInput(){let A={ArrowLeft:0,ArrowRight:1,ArrowUp:2,ArrowDown:3,Space:4,Enter:6,a:0,d:1,w:2,s:3};this.gamepadMap=this.inputMap.gamepad;const t=Math.max(...Object.values(A));this.inputState=new Array(t+1).fill(!1),this.keyboardState=new Array(t+1).fill(!1),this.keyboardPreviousState=new Array(t+1).fill(!1),this.gamepadState=new Array(t+1).fill(!1),this.gamepadMapPrevious=new Array(t+1).fill(!1),window.addEventListener("keydown",t=>{void 0!==A[t.key]&&(this.keyboardState[A[t.key]]=!0),void 0!==A[t.code]&&(this.keyboardState[A[t.code]]=!0)}),window.addEventListener("keyup",t=>{void 0!==A[t.key]&&(this.keyboardState[A[t.key]]=!1),void 0!==A[t.code]&&(this.keyboardState[A[t.code]]=!1)})}pollGamepadInput(){const A=navigator.getGamepads?.();if(!A)return;const t=A[0];if(t){for(const[A,s]of Object.entries(this.gamepadMap.buttons)){const e=parseInt(A);this.gamepadState[s]=t.buttons[e]?.pressed||!1}for(const[A,s]of Object.entries(this.gamepadMap.axes)){const e=A.match(/^(\d+)([+-])$/);if(!e)continue;const i=parseInt(e[1]),E=e[2],h=t.axes[i]??0,I="+"===E&&h>.5||"-"===E&&h<-.5;this.gamepadState[s]=this.gamepadState[s]||I}}}loadGame(){try{const A=new Function("sandbox",`\n                with (sandbox) {\n                    ${this.userCode} // Exekvera användarkod\n\n                    const result = {};\n                    if (typeof _init === "function") result._init = _init;\n                    if (typeof _update === "function") result._update = _update;\n                    if (typeof _draw === "function") result._draw = _draw;\n\n                    // Spara alla variabler i sandboxen\n                    for (let key in this) {\n                        if (!(key in sandbox)) {\n                            sandbox[key] = this[key];\n                        }\n                    }\n\n                    return result;\n                }\n            `).call(this.sandbox,this.sandbox);"function"==typeof A._init&&(this.gameFunctions._init=A._init),"function"==typeof A._update&&(this.gameFunctions._update=A._update),"function"==typeof A._draw&&(this.gameFunctions._draw=A._draw)}catch(A){console.error("Error parsing game code:",A)}}async runInit(){this.setupInput(),this.gameFunctions._init(),this.renderer.cS()}updateGame(){const A=performance.now(),t=A-this.lastTime;for(this.lastTime=A,this.fpsAccumulator+=t;this.fpsAccumulator>=this.fixedDelta;){this.fpsAccumulator-=this.fixedDelta,this.pollGamepadInput(),this.gameFunctions._update(this.fixedDelta/1e3);for(const A of this.sceneObjects)A.isActive&&A.update(this.fixedDelta/1e3);this.keyboardPrevState=[...this.keyboardState],this.gamepadPrevState=[...this.gamepadState]}this.alpha=this.fpsAccumulator/this.fixedDelta}drawGame(){this.renderer.cS(),this.gameFunctions._draw(this.alpha);for(const A of this.sceneObjects)A.isActive&&A.draw(this.alpha)}}(A.code,x,A.p,r,o,A.inputMap,A.collision);function R(){const A=document.getElementById("app"),t=document.getElementById("game-canvas"),s=C/r,e=Math.floor(Math.min(A.clientWidth/s,A.clientHeight/s));t.style.width=s*e+"px",t.style.height=s*e+"px"}l.setRenderer(x),l.setParser(p),l.init(),R(),window.addEventListener("resize",R),window.addEventListener("DOMContentLoaded",R)</script>