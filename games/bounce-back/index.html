<html><head><title>Bounce Back - js13kGames 2019</title><style>body{background:#000;overflow:hidden;margin:0;}canvas{width:100%;height:100%;image-rendering:-moz-crisp-edges;image-rendering:pixelated;}</style></head><body><canvas id=c1></canvas><canvas id=c2 style=visibility:hidden></canvas><script>var t,i,e="function"==typeof Object.create?Object.create:function(t){function i(){}return i.prototype=t,new i};if("function"==typeof Object.setPrototypeOf)i=Object.setPrototypeOf;else{var s;t:{var h={};try{h.__proto__={w:!0},s=h.w;break t}catch(u){}s=!1}i=s?function(t,i){if(t.__proto__=i,t.__proto__!==i)throw new TypeError(t+" is not extensible");return t}:null}var n=i;function o(t,i){if(t.prototype=e(i.prototype),t.prototype.constructor=t,n)n(t,i);else for(var s in i)if("prototype"!=s)if(Object.defineProperties){var h=Object.getOwnPropertyDescriptor(i,s);h&&Object.defineProperty(t,s,h)}else t[s]=i[s]}function a(t,i,e,s){return"rgba("+(255*(void 0===t?0:t)|0)+","+(255*(void 0===i?0:i)|0)+","+(255*(void 0===e?0:e)|0)+","+(void 0===s?1:s)+")"}var r=Math.PI;function c(t){return Math.random()*(void 0===t?1:t)}function f(t){return 0|c(t)}function l(t,i){return t+c(i-t)}function u(t,i){return t+f(i-t+1)}function p(t){return T(new F(void 0===t?1:t,0),c(2*r))}function v(t,i){return t.b().pa(i,c())}function d(t,i,e){return 0<=t&&0<=i&&t<e&&i<e}function w(t,i){return t<i?t:i}function b(t,i){return t>i?t:i}function g(t){var i=(0|t)%60;return(t/60|0)+":"+(10>i?"0":"")+i}function x(){this.endTime=0}function m(t){return 0<t.endTime?L-t.endTime:1e9}function S(t){return!(0<t.endTime)||L>t.endTime}function F(t,i){this.x=void 0===t?0:t,this.y=void 0===i?0:i}function j(t,i){return i instanceof F?(t.x+=i.x,t.y+=i.y):(t.x+=i,t.y+=i),t}function C(t,i){return i instanceof F?(t.x*=i.x,t.y*=i.y):(t.x*=i,t.y*=i),t}function M(t,i,e){return t.x+=i,t.y+=e,t}function A(t,i){i=void 0===i?1:i;var e=B(t);return 0<e?C(t,i/e):t.Set(i,y=0)}function T(t,i){var e=Math.cos(i),s=Math.sin(i);return t.Set(t.x*e-t.y*s,t.x*s-t.y*e)}function B(t){return Math.hypot(t.x,t.y)}function k(t){return Math.abs(t.x)>Math.abs(t.y)?0<t.x?2:0:0<t.y?1:3}function O(t,i,e,s){this.r=void 0===t?0:t,this.S=void 0===i?0:i,this.O=void 0===e?0:e,this.w=void 0===s?1:s}function P(t,i){return t.w=i,t}function R(t,i,e,s,h,n){s=void 0===s?.5:s,h=void 0===h?0:h,n=void 0===n?1:n,this.a=t.b(),this.i=i,this.Z=e,this.size=new F(s,s),this.ga=h,this.K=this.c=n,this.l=new x,this.v=new x,this.v.Set(),this.acceleration=new F,this.g=new F,this.j=this.angle=0,this.ha=.8,this.height=this.D=0,this.J=.5,this.sa=1,$.push(this)}function z(t){var i=Pt;i.c&&(i.c=w(i.c+t,i.K))}function I(t,i){return t.B(i)<i.ga+t.ga}function K(t){$.splice($.indexOf(t),1)}x.prototype.Set=function(t){this.endTime=L+(void 0===t?0:t)},(t=F.prototype).H=function(t){return this.x=t.x,this.y=t.y,this},t.b=function(t){return C(new F(this.x,this.y),void 0===t?1:t)},t.o=function(t){return this.x-=t.x,this.y-=t.y,this},t.Set=function(t,i){return this.x=t,this.y=i,this},t.B=function(t){return Math.hypot(this.x-t.x,this.y-t.y)},t.pa=function(t,i){return j(this,C(t.b().o(this),i))},(t=O.prototype).H=function(t){return this.r=t.r,this.S=t.S,this.O=t.O,this.w=t.w,this},t.b=function(t){return t=void 0===t?1:t,new O(this.r*t,this.S*t,this.O*t,this.w*t)},t.o=function(t){return this.r-=t.r,this.S-=t.S,this.O-=t.O,this.w-=t.w,this},t.pa=function(t,i){return t.b().o(t.b().o(this).b(1-i))},t.RGBA=function(){return a(this.r,this.S,this.O,this.w)},(t=R.prototype).f=function(){j(this.g,this.acceleration);var t=this.a,i=this.a.b();j(i,this.g);var e=this.ga;if(!pt(i,e,this)){var s=pt(new F(i.x,t.y),e);e=pt(new F(t.x,i.y),e),s&&!e||(i.x=t.x,this.g.x*=-.5),e&&!s||(i.y=t.y,this.g.y*=-.5)}this.a=i,C(this.g,this.ha),C(this.acceleration,0),this.angle+=this.j},t.m=function(){at(this.a,this.size,this.i,this.Z,this.angle,this.D,this.height)},t.I=function(t){if(!this.c||.5>m(this.l))return 0;this.l.Set();var i=this.c;return(this.c=b(this.c-t,0))||this.u(),i-this.c},t.ya=function(){return 0},t.u=function(){this.c=0,K(this)},t.B=function(t){var i=this.a,e=t.a;return Math.hypot(i.x-e.x,i.y-e.y,this.height-t.height)},t.$=function(t){return t.type?1<this.height?0:t.object:1};var _,D,G,E,H,W=1,J=new F,L=1,N=1/60,U=0,Y=0,X=new F,Z=0;function V(){(Z=!document.hasFocus())&&(Q=tt=0,it.map(function(t){return t.oa=t.ia=0})),X.Set(window.innerWidth/2,window.innerHeight/2),Lt.width=X.x,Lt.height=X.y,_.imageSmoothingEnabled=0,j(C(st.H(et).o(X.b(.5)),1/W*16),J),Z||(L+=N,function(){if(++kt,It||(localStorage.KBAP_coins=Rt.G),0<Ht.endTime||!Pt.c||(Nt+=N),!bi&&Q&&!tt&&(bi=new AudioContext),0<Yt.endTime&&S(Yt)&&(Fi(10,800),Yt.endTime=0),At||0<Ht.endTime){var t=[-5,0,2,4,7,12,-5,-8];S(mi)&&(++Si,mi.Set(.5),!(15<Si)||1&Si&&!f(2)||(0==Si%8&&(xi=1),gi(.4,0,220*Math.pow(2,t[xi]/12),(f(2)+1)/2,.05,0,.4),xi=(xi+(f(6)-2)+t.length)%t.length),0==Si%2||18&Si||!f(20))&&(0==Si%4?gi(.3,.2,1e3,.08,.05,.8,21,51):gi(.7,.2,150,.04,.005,.1,1,.5,.15))}if(Pt.c&&!(0<Ht.endTime)||!ht(27)||it[27].oa||(Bt=2),0<Dt.endTime&&S(Dt)&&(Bt=1),Mt&&(W=b(W-.001,1)),At){t=new F(8,3.7);var i=m(_t),e=w(b((i-0)/3.3,0),1),s=Math.abs(3-4*e)/1.7;i="hsla("+99*i+",99%,50%)",bt("BOUNCE",M(t.b(),0,-s),33*e,"center",2,"#000",i),bt("BACK",M(t.b(),0,s+1.2),33*e,"center",2,"#000",i),200==kt&&bt("A JS13k 2019 Game",new F(8,9.5),14),260==kt&&bt("By Frank Force",new F(8,10.5),14)}}(),$.forEach(function(t){return t.f()})),$.sort(function(t,i){return t.a.y-i.a.y}),function(){if(J.H(Pt.a),_.fillStyle=Et.RGBA(),_.fillRect(0,0,X.x,X.y),At){_.fillStyle="#999";for(var t=2e3;t--;)_.fillRect((1e9*Math.sin(t)-L*(t+1e3)/50)%(Lt.width+9)-9,9*t%Lt.height,t%7,t%7)}Ft.m()}(),U=1,q(),U=0,q(),function(){Bt&&(2==Bt&&Zt(),Bt=0,Vt());var t=m(vi);2<t||(_.save(),_.beginPath(),t=t*X.x/2,_.rect(0,0,X.x,X.y),_.arc(X.x/2,X.y/2,t,0,7),_.clip("evenodd"),_.drawImage(di,0,0),_.restore()),t="",Z&&(t="-paused-"),0<Ht.endTime&&(t="You Win!"),Pt.c||(t="Game Over!",rt("Press Escape",X.x/2,X.y/2+80,42)),rt(t,X.x/2,X.y/2-80,72,"center",2),t=16;for(var i=0;i<Pt.K;i++){var e=1,s=16;.5>m(Wt)&&(s*=1+.2*Math.sin(2*r*m(Wt)/.5)),Pt.c>i&&(e=1<=Pt.c-i?3:2),nt(16+32*i,t,s,e)}nt(16,t+=32,16,0),rt(Rt.R,34,t+2,32,"left"),Rt.F&&(nt(76,t,16,7),rt(Rt.F,94,t+2,32,"left")),t+=32,nt(16,80,16,5),rt(Rt.G,34,t+2,32,"left"),It&&rt(g(Nt),Lt.width/2,28,40,"center",1,!Pt.c||0<Ht.endTime?"#F00":"#000"),function(){if(!At&&!Mt){var t=X.x-96-10;At||rt("L-"+jt,t-10,24,32,"right"),Gt[Qt(Pt.a)]&&(Gt[Qt(Pt.a)]=-1),_.strokeStyle="#000",_.lineWidth=2,_.strokeRect(t,10,96,96);for(var i=4;i--;)for(var e=4;e--;){var s=Gt[e+4*i],h="#0004";0<s&&(h="#333"),-1==s&&(h="#FFF"),e==(Pt.a.x/16|0)&&i==(Pt.a.y/16|0)&&(h="#F00"),_.fillStyle=h,_.fillRect(t+24*e,10+24*i,24,24),s&&_.strokeRect(t+24*e,10+24*i,24,24)}$.forEach(function(i){var e=i.X;if(e&&0>Gt[Qt(i.a)]){var s=M(i.a.b(1.5),t,10);s.x=Math.round(s.x),s.y=Math.round(s.y),_.fillStyle=i==Pt?"#FFF":"#000",_.fillRect(s.x-e-1,s.y-e-1,2*e+2,2*e+2),_.fillStyle=i==Pt?"#000":i.ja?"#F00":"#FFF",_.fillRect(s.x-e,s.y-e,2*e,2*e)}})}}(),Lt.style.cursor="none",t=0|et.x,i=0|et.y,_.globalCompositeOperation="difference",_.fillStyle="#FFF",_.fillRect(t-2,i-15,4,30),_.fillRect(t-15,i-2,30,4),_.globalCompositeOperation="source-over"}(),tt=Q,it.map(function(t){return t.oa=t.ia}),requestAnimationFrame(V)}var $=[];function q(){$.forEach(function(t){t.m(),!U&&(Y=w(b(1-m(t.l)/t.J,0),1))&&(t.sa&&(_.globalCompositeOperation="difference"),t.m(),_.globalCompositeOperation="source-over",Y=0)})}var Q=0,tt=0,it=[],et=new F,st=new F;function ht(t){return it[t]?it[t].ia:0}function nt(t,i,e,s){_.drawImage(ji,16*s,80,16,16,t-e,i-e,2*e,2*e)}function ot(t,i,e,s){e=void 0===e?0:e,s=void 0===s?0:s,_.save(),t=t.b(),U?M(t,.7*-s/2,.7*-s/2):t.y-=s,C(t.o(J),16*W),j(t,X.b(.5)),_.translate(0|t.x,0|t.y),i=i.b(16),U&&_.transform(1,0,.7,.7,-.7*W*i.x,W*(1-.7)*i.y),e&&_.rotate(e),_.scale(W,W)}function at(t,i,e,s,h,n,o){n=void 0===n?0:n,ot(t,i,void 0===h?0:h,void 0===o?0:o),t=ji,U?(t=D,_.globalAlpha*=.5,e+=ji.width/16):Y&&(t=D,_.globalAlpha*=Y),i=i.b(32),_.scale(n?-i.x:i.x,i.y),_.drawImage(t,16*e+.25,16*s+.25,15.5,15.5,-.5,-.5,1,1),_.restore(),_.globalAlpha=1}function rt(t,i,e,s,h,n,o,a,r){n=void 0===n?1:n,a=void 0===a?"#FFF":a,(r=void 0===r?_:r).fillStyle=void 0===o?"#000":o,r.font="900 "+s+"px arial",r.textAlign=void 0===h?"center":h,r.textBaseline="middle",r.fillText(t,i,e),n&&(r.lineWidth=n,r.strokeStyle=a,r.strokeText(t,i,e))}function ct(){this.object=this.rotation=this.M=this.type=0}function ft(){E.height=E.width=1024,this.data=[];for(var t=0;4096>t;t++)this.data[t]=new ct}function lt(t,i){return ut(t,i.x,i.y)}function ut(t,i,e){return d(i,e,64)?t.data[(0|i)+64*(0|e)]:new ct}function pt(t,i,e){var s=Ft;e=void 0===e?0:e;var h=t.y;t=t.x;for(var n=h-i;n<=h+i;){for(var o=t-i;o<=t+i;){var a=new F(Math.floor(o)+.5,Math.floor(n)+.5),r=lt(s,a);if(e){if(e.$(r,a))return 0}else if(!r.type||r.object)return 0;if(o==t+i)break;++o>t+i&&(o=t+i)}if(n==h+i)break;++n>h+i&&(n=h+i)}return 1}function yt(t,i,e){dt(t,i,function(t){return t.object=t.type?e:t.object})}function vt(t,i,e){dt(t,i,function(t){return t.type=e})}function dt(t,i,e){for(var s=Ft,h=-i;h<=i;h++)for(var n=Math.pow(Math.pow(i,2)-Math.pow(h+.5,2),.5),o=t.y-n;o<t.y+n;o++){var a=t.x+h|0,r=0|o;d(a,r,64)&&e(ut(s,a,r))}}function wt(t,i,e,s){e=void 0===e?"#FFF":e,s=void 0===s?0:s,i=C(C(new F(1,1),i),16),H.beginPath(),H.ellipse(16*t.x,16*t.y,i.x,i.y,s,0,7),H.fillStyle=e,H.fill()}function bt(t,i,e,s,h,n,o){rt(t,16*i.x,16*i.y,e,void 0===s?"center":s,void 0===h?0:h,void 0===n?"#000":n,void 0===o?"#FFF":o,H)}function gt(t,i,e){var s=(t=ut(t,i|=0,e|=0)).M%8,h=t.M/8|0;xt(i=new F(i+.5,e+.5),s,h,t.rotation*r/2),t.object&&xt(i,s=(t.object-1)%8,h=3+((t.object-1)/8|0))}function xt(t,i,e,s){s=void 0===s?0:s,H.save(),H.translate(16*t.x,16*t.y),H.rotate(s),H.drawImage(ji,16*i,16*e,16,16,-8,-8,16,16),H.restore()}function mt(t,i,e,s,h,n,o){this.Da=t,this.a=i,this.g=e,this.size=s,this.Ga=h,this.Pa=n,this.Na=o,this.v=new x,this.v.Set()}function St(t,i,e,s,h){R.call(this,t,0,0,i),this.Ja=e,this.Aa=s.b(),this.Ba=h.b(),this.W=[],this.ba=0}oncontextmenu=function(t){t.preventDefault()},onmousedown=function(){Q=1},onmouseup=function(){Q=0},onmousemove=function(t){var i=Lt.getBoundingClientRect();C(et.Set((t.clientX-i.left)/i.width,(t.clientY-i.top)/i.height),X)},onkeydown=function(t){it[t.keyCode]={ia:1}},onkeyup=function(t){it[t.keyCode].ia=0},ft.prototype.m=function(){var t=j(J.b(16*-W),X.b(.5));_.drawImage(E,0|t.x,0|t.y,W*E.width|0,W*E.height|0)},mt.prototype.f=function(){j(this.a,C(this.g,.9)),m(this.v)>this.Ga&&this.Da.W.splice(this.Da.W.indexOf(this),1)},mt.prototype.m=function(){var t=this.Ga;t=0==t?0:w(b((m(this.v)-0)/(t-0),0),1);var i=this.Pa.b().pa(this.Na,t);i.w*=.1>t?t/.1:1,_.fillStyle=i.RGBA(),t=this.size*W*16*(1+-.5*w(b(t,0),1)),i=j(j(C(this.a.b().o(J),16*W),X.b(.5)),-t),_.fillRect(i.x,i.y,2*t,2*t)},o(St,R),St.prototype.f=function(){if(this.W.forEach(function(t){return t.f()}),.05>=m(this.v))for(this.ba+=N;.005<this.ba;)this.ba-=.005,this.W.push(new mt(this,j(this.a.b(),p(c(this.size.x))),p(c(.2)),l(this.Ja,2*this.Ja),l(.5,1),v(this.Aa,this.Ba),P(v(this.Aa,this.Ba),0)));else this.W.length||this.u();R.prototype.f.call(this)},St.prototype.m=function(){this.W.forEach(function(t){return t.m()})};var Ft,jt,Ct,Mt,At,Tt,Bt,kt,Ot,Pt,Rt,zt,It,Kt=0,_t=new x,Dt=new x,Gt=[],Et=new O,Ht=new x,Wt=new x,Jt=new x,Lt=c1,Nt=0,Ut=0,Yt=new x;function Xt(){this.K=this.c=3,this.R=1,this.G=this.F=0}function Zt(){Rt=new Xt,localStorage.KBAP_coins&&(Rt.G=parseInt(localStorage.KBAP_coins,10)),localStorage.KBAP_warp&&(Kt=parseInt(localStorage.KBAP_warp,10)),localStorage.KBAP_best&&(Ut=parseInt(localStorage.KBAP_best,10)),Ct=0}function Vt(){for(kt=0,jt=Ct,Ct=(Ct+1)%11,!It&&jt>Kt&&(Kt=jt),localStorage.KBAP_warp=Kt,Mt=10==jt,(At=!jt)&&(It=0),Ht.endTime=0,W=2,vi.Set(),di.width=X.x,di.height=X.y,wi.drawImage(Lt,0,0),$=[],Dt.endTime=0,_t.Set(),Ot=Tt=0,Rt.R||Rt.F||(Rt.R=1),Et=new O(c(.1),c(.1),c(.1)),At&&(Et=new O(.1,0,.2));!yi(););Pt=new hi(zt)}function $t(t,i,e){if(e=void 0===e?1:e,!(c()>(void 0===i?1:i)))for(i=0;i<e;++i){var s=new oi(t.b(),f(8)?f(20)?3:4:f(4)?0:1);1<e&&(s.g=p(.1+.03*w(b(i,3),30)*c()))}}function qt(t,i){i=void 0===i?1:i;var e=lt(Ft,t);if(e.type&&!e.object)return 0;var s=1;if(1==(e=e.object)||2==e){if(lt(Ft,t).object=0,gt(Ft,t.x,t.y),$t(t,.05),1==e)Fi(5),wt(t,l(.1,.15),a(0,0,0,l(.3,.6))),s=0;else{for(Fi(14),s=9;s--;)wt(j(t.b(),p(.2)),l(.1,.2),a(.2,.1,.05,l(.3,.6)));s=i}new St(t,.5,.1,new O(.4,1==e?.8:.2,.1,1),new O(0,1==e?.1:0,0,1))}return s}function Qt(t){return(0|(t=t.b(.0625)).x)+4*(0|t.y)}function ti(t,i,e,s,h,n){R.call(this,t,void 0===i?0:i,void 0===e?0:e,void 0===s?.5:s,void 0===h?0:h,void 0===n?1:n),this.P=new O(.8,0,.05,.5),this.s=0,this.X=this.rotation=1,this.qa=this.da=0}function ii(t){var i=t.s;if(t.s+=1.5*B(t.g),1>i%2&&1<t.s%2||t.s%2<i%2){var e=si(t),s=t.rotation*r/2;i=T(new F(0,(t.s%2<i%2?1:-1)/8),s),t=j(t.a.b(),i),i=new F(.2,e?.2:.1),e&&(i.y*=l(1,1.5),i.x*=l(1,1.5)),t.y+=.3,wt(t,i,e?"#4215":"#2223",s)}}function ei(t,i,e){i=void 0===i?1:i,e=void 0===e?1:e,t.qa&&(H.globalCompositeOperation="screen");for(var s=30;s--;){var h=j(t.a.b(),p(c(i*t.size.x))),n=l(0,2*r);wt(h,C(new F(t.size.x*l(.2,.5),t.size.y*l(.2,.5)),i),t.P.RGBA(),n)}H.globalCompositeOperation="source-over",e&&(i*=t.size.x,new St(t.a,.6*i,.2*i,P(t.P.b(),1),P(t.P.b(t.qa?3:.5),1)))}function si(t){return 2==lt(Ft,t.a).type}function hi(t){ti.call(this,t,0,4,.5,.4,Rt.K),this.c=Rt.c,J.H(t),this.h=new x,this.Y=new x,this.ca=new x,this.Ka=new x,this.ca.Set(-1),this.wa=0,this.U=[],this.aa=3,this.X=2}function ni(t,i){i=void 0===i?0:i,ti.call(this,t,i?7:0,5,.5,i?.45:.4),this.ha=.98,this.ra=this.na=this.L=this.T=this.angle=0,this.C=i}function oi(t,i){i=void 0===i?0:i,ti.call(this,t,2+i,5,.5,.3),this.type=i,this.Qa=c(9),this.Fa=2!=i,this.sa=this.ta=0,this.J=.8,this.X=this.Fa?1:3}function ai(t,i,e,s,h,n,o){o=void 0===o?0:o,ti.call(this,t,void 0===i?0:i,void 0===e?0:e,void 0===s?.5:s,void 0===h?0:h,void 0===n?1:n),this.qa=this.va=this.ja=1,this.X=(this.C=o)?2:1}function ri(t,i,e){e=void 0===e?1:e;var s=.25*i;ai.call(this,t,5+e,0,s,.8*s,i*e,3<i),this.P=1<e?new O(1,0,.5,.5):new O(0,.5,1,.5),this.Ma=new x,this.La=new F,this.va=1==i?e/2:0,this.Ca=e,this.Ea=i,this.za=s,this.ha=.9}function ci(t,i){i=void 0===i?0:i,ai.call(this,t,2,2,i?1:.5,i?.8:.4,i?12:4,i),this.la=new x,this.ka=new x,this.ka.Set(l(1,3)),this.V=0,this.ua=new F,this.P=new O(1,.5,0,.1),this.speed=i?.012:.01}function fi(t,i,e){i=void 0===i?0:i,e=void 0===e?0:e,ai.call(this,t,4,2,e?1:.5,e?.8:.4,i?50:e?6:2,e),this.Ha=new x,this.h=new x,this.ha=.8,this.type=i,this.ma=0,this.speed=e?.015:.012,i?(this.speed=.018,Ot=this):this.P=new O(.3,1,0,.5),this.ea=this.type&&!At}function li(t){ti.call(this,t,7,1,.5,.5),this.count=At||Mt?3:2+f(2);for(var i=1-this.count,e=this.count;e--;){var s=f(4);At||Mt?s=e+1:0==e?s=u(0,1):1==e&&(s=u(2,3)),new ui(M(t.b(),2*e+i,0),s,this)}this.a.y-=2,this.Oa=1,vt(t,3,1),yt(t,5,0)}function ui(t,i,e){ti.call(this,t,i+3,5,.5,.2),this.Ia=e,this.type=i,this.A=5,this.xa=0,1==this.type&&(this.A=50),2==this.type&&(this.A=40,this.i=0),3==this.type&&(this.A=90,this.i=7),At||(this.A*=l(.5,1.5)),this.A=w(b(this.A,1),99),this.A|=0}function pi(t,i){i=void 0===i?0:i,ti.call(this,t,0,0,0,.5),this.type=i,this.X=2,this.fa=new x,this.a.y+=.01}function yi(){Ft=new ft,$=[],Gt=function(){function t(t,e,s,h){return!(!d(t+s,e+h,4)||i(t+s,e+h)||i(t+2*s,e+2*h)||i(t+2*s+h,e+2*h+s)||i(t+2*s-h,e+2*h-s)||i(t+s+h,e+h+s)||i(t+s-h,e+h-s))}function i(t,i){return d(t,i,4)?h[t+4*i]:0}function e(t,i,e){return h[t+4*i]=void 0===e?1:e}var s=jt,h=[];h.length=16,h.fill(0);var n=f(4),o=f(4);if(At&&(n=o=0,e(0,0),e(1,0)),Mt){n=0,o=3,e(0,3),e(1,3),e(2,3),e(1,2);for(var a=4;a--;)for(var r=2;r--;)e(a,r)}if(zt=new F(n,o),At||Mt)return h;var l,u,p,y=o;for(e(n,y),o=[],r=a=0;r<1.5*s;++r){var v=0;if(t(n,y,-1,0)&&++v,t(n,y,1,0)&&++v,t(n,y,0,-1)&&++v,t(n,y,0,1)&&++v,v&&r!=s&&(r<s||.5>c())){var w=0,b=0;v=f(v),t(n,y,-1,0)&&!v--?(w=-1,b=0):t(n,y,1,0)&&!v--?(w=1,b=0):t(n,y,0,-1)&&!v--?(w=0,b=-1):(w=0,b=1),o.push({x:n,y:y}),e(n+=w,y+=b)}else{if(!o.length)break;p=void 0,p=0+i((l=n)+1,u=y),p+=i(l-1,u),p+=i(l,u+1),1>=(p+=i(l,u-1))?e(n,y,2+a++):.5>c()&&zt.Set(n,y),n=(y=o.pop()).x,y=y.y}}return h}();for(var t=4;t--;)for(var i=4;i--;)if(Gt[t+4*i]){var e=C(new F(t+.5,i+.5),16);vt(e,Mt?12:9,1);for(var s=f(4);s--;)vt(j(e.b(),p(c(8))),l(2,6),1+f(2))}if(C(j(zt,.5),16),Mt){for(t=30;t--;)yt(new F(u(0,64),u(0,50)),u(4,14),1+f(2));for(yt(zt,12,0),vt(M(zt.b(),16,-20),12,1),vt(M(zt.b(),16,-14),12,1),vt(t=new F(24,18),9,2),yt(t,10,0),H.fillStyle="#F00",H.fillRect(0,0,X.x,X.y),H.drawImage(ji,0,0),i=16;i--;)for(e=16;e--;)s=H.getImageData(i+64,e+80,1,1).data,lt(Ft,M(t.b(),i-8,e-7)).object=s[1]?2:s[0]?0:1}else if(At)vt(zt,8,1),vt(M(zt.b(),16,0),7,1),yt(M(zt.b(),8,-2),3,1),yt(M(zt.b(),8,2),3,1);else{for(t=64;t--;)yt(new F(u(0,64),u(0,64)),u(1,10),f(3));for(yt(zt,l(2,5),0),t=5*jt,i=0;0<t;){if(1e4<++i)return 0;if(e=new F(l(0,64),l(0,64)),!(!(s=Gt[Qt(e)])||2==s&&1<jt||15>e.B(zt))&&(500<i&&yt(e,2,0),pt(e,2))){if(.33>c()||1>=jt){s=u(1,3),.1>c()&&5<jt&&(s=4);var h=5>jt||.5>c()?1:2;e=new ri(e,s,h),s*=h}else 3!=jt&&(.5>c()||2>=jt)?(e=new ci(e,s=.1>c()&&3<jt),s=s?6:2):(e=new fi(e,0,s=.1>c()&&4<jt),s=s?9:3);4<jt&&.1>c()&&(e.da=1,s*=2),t-=s}}}if(Mt)new li(new F(43,47)),new fi(j(zt.b(),new F(.5,0)),1),new oi(new F(24,19.5),2);else if(At)new li(new F(24,3.5)),new fi(zt.b(),1),new oi(j(zt.b(),new F(16,0)),2),Tt=new pi(new F(24,13)),1<Kt&&new pi(new F(29.5,8),2),localStorage.KBAP_won&&new pi(new F(29.5,13),3);else{for(t=4;t--;)for(i=4;i--;)2==Gt[t+4*i]&&1<jt&&(30<(e=C(new F(t+.5,i+.5),16)).B(zt)&&.3>c()?(.5<c()?new oi(e,2):new ni(e),vt(e,u(2,4),1),yt(e,u(3,5),0)):new li(e));new pi(zt,1)}for(t=Ft,i=0;64>i;i++)(e=ut(t,i,0)).type=e.object=0,(e=ut(t,i,63)).type=e.object=0,(e=ut(t,0,i)).type=e.object=0,(e=ut(t,63,i)).type=e.object=0;for(t=Ft,i=0;64>i;i++)for(e=0;64>e;e++){h=(s=ut(t,e,i)).type;var n=ut(t,e+1,i).type==h,o=ut(t,e-1,i).type==h,a=ut(t,e,i-1).type==h,r=ut(t,e,i+1).type==h,y=n+o+a+r,v=8*h,w=0;2>h&&(v+=y,2<=y&&v++,1==y?o?w=1:a?w=2:n&&(w=3):2==y?n&&o?(v--,w=1):a&&r?v--:o&&r?w=1:o&&a?w=2:n&&a&&(w=3):3==y&&(n?r?o||(w=3):w=2:w=1)),s.M=v,s.rotation=w}for(t=0;64>t;t++)for(i=0;64>i;i++).05<c()||(13==(e=ut(Ft,i,t)).M&&(e.M++,e.rotation=f(4)),16==e.M&&(e.M+=1,e.rotation=f(4)));for(t=Ft,E.width|=0,i=0;64>i;i++)for(e=0;64>e;e++)gt(t,e,i);return 1}o(ti,R),ti.prototype.u=function(){ei(this),Fi(9),R.prototype.u.call(this)},ti.prototype.m=function(){!this.da||U||Y||(_.globalAlpha=.1+w(b(1-m(this.l)/this.J,0),1)),R.prototype.m.call(this)},o(hi,ti),(t=hi.prototype).$=function(t,i){return S(this.h)?ti.prototype.$.call(this,t,i):qt(i)},t.f=function(){if(Rt.c=this.c,!this.c||0<Dt.endTime||1.5>m(_t))C(this.acceleration,0);else{1>=this.c&&m(Wt)>this.c&&(Wt.Set(),Fi(11));var t=si(this);if(Q&&!tt&&(Rt.R||Rt.F)){var i=0;Rt.F?(--Rt.F,i=1):--Rt.R,i=new ni(this.a,i);var e=st;Fi(7),i.na=i.C?9:8,i.L=e.b().o(this.a),A(i.L,.04),i.j=.5,i.height=i.j/2,i.g=this.g.b(),this.wa=k(i.L),this.Y.Set(.4)}i=new F,ht(65)&&(--i.x,this.rotation=0),ht(68)&&(i.x+=1,this.rotation=2),ht(87)&&(--i.y,this.rotation=3),ht(83)&&(i.y+=1,this.rotation=1),S(this.h)?(0<this.h.endTime&&m(this.h)>this.aa&&(this.h.endTime=0,Fi(16)),this.U=[],!(ht(32)&&!it[32].oa||ht(16)&&!it[16].oa)||0<this.h.endTime||(Fi(12),this.h.Set(.5))):(i.x||i.y||T(i.Set(-1,0),-this.rotation*r/2),t=0,this.l.Set(),0==kt%3&&this.U.push(this.a.b()),20<this.U.length&&this.U.shift()),(i.x||i.y)&&(A(i,.016*(t?.5:1)),!S(this.h)&&C(i,2),j(this.acceleration,i),this.ca.Set()),1<m(this.ca)&&(this.s=0),S(this.Y)&&S(this.h)&&ii(this),ti.prototype.f.call(this)}},t.m=function(){if(!(0<Dt.endTime))if(!this.c||1.5>m(_t)&&At)this.i=7,this.Z=3,ti.prototype.m.call(this);else{this.Z=4,1&this.rotation?(this.i=1==this.rotation?2:3,this.D=this.s%2|0,S(this.Y)&&S(this.h)?1<m(this.ca)&&1==this.rotation&&(this.i=7,this.D=1&m(this.ca)/2):this.i+=3):(this.D=2!=this.rotation,this.i=this.s%2|0,S(this.Y)&&S(this.h)||(this.i=4));var t=Y;if(S(this.Y)||(this.rotation=this.wa,1&this.rotation&&(this.D=1==this.rotation)),!U&&t){_.globalCompositeOperation="screen";for(var i=this.U.length;i--;)Y=t*(i/this.U.length+.01),at(this.U[i],this.size,this.i,this.Z,this.angle,this.D,this.height);Y=t,_.globalCompositeOperation="difference"}i=m(this.h),!U&&i<this.aa+.5&&(Y=i<this.aa?i/this.aa:Math.sin((i-this.aa)*r*4),at(this.a,this.size.b(1.1),this.i,this.Z,this.angle,this.D,this.height),Y=t),ti.prototype.m.call(this),(Rt.R||Rt.F)&&(t=Rt.F?7:0,3==this.rotation&&at(this.a,this.size,t,5),0==this.rotation%2&&at(M(this.a.b(),.2*-(this.rotation-1),0),this.size.b(new F(.6,1)),t,5))}},t.I=function(t){return!S(this.Ka)||0<Dt.endTime||1.5>m(_t)||0<Ht.endTime?0:(t=ti.prototype.I.call(this,t))?(ei(this),Fi(1),this.Ka.Set(1),t):0},t.u=function(){ei(this,2),Fi(2)},o(ni,ti),ni.prototype.$=function(t,i){return t.object&&this.l.Set(),qt(i,!this.C)},ni.prototype.f=function(){var t=this;if(this.na&&this.na--,this.j){if(0<Dt.endTime&&Dt.Set(1),Q&&this.na?this.L&&j(this.g,this.L):this.L=0,this.j-=.002,.1>this.j&&(this.j-=.005,C(this.g,.8),0>this.j&&(this.j=0)),this.height=this.j/2,!this.L&&0<this.height){var i=Pt.a.b();C(i.o(this.a),.004*this.j),j(this.g,i)}$.forEach(function(i){if(!t.C&&i.Fa&&.5<m(i.v)&&!i.ta&&!t.T&&I(i,t))i.ta=1,t.T=i;else if((i.ja||i.Oa)&&I(i,t))if(t.ra==i||i.ya(t.g))t.ra!=i&&(Fi(15),t.ra=i,C(t.g,-.4),t.j*=.4,t.l.Set(),t.L=0);else if(i.I(1+t.C)){if(!At){var e=t.g.b(.5);j(i.acceleration,e)}t.l.Set()}})}else this.X=3,this.J=.8,this.sa=0,this.T&&(this.T.ta=0),this.T=0,.005>c()&&m(this.l)>4*this.J&&this.l.Set(-this.J/2);(!this.j||.5<m(this.v))&&Pt.c&&.6>Pt.B(this)&&this.N(),ti.prototype.f.call(this),this.T&&M(this.T.a.H(this.a),0,-.001)},ni.prototype.N=function(){Fi(6),this.C?Rt.F++:Rt.R++,Pt.Y.Set(.3),Pt.wa=k(this.a.b().o(Pt.a)),K(this)},o(oi,ti),oi.prototype.f=function(){.005>c()&&m(this.l)>4*this.J&&this.l.Set(-this.J/2),this.height=.1+.1*Math.sin(2*L+this.Qa),Pt.c&&I(Pt,this)?this.N():Ot&&I(Ot,this)&&(Fi(14),K(this)),ti.prototype.f.call(this)},oi.prototype.N=function(){2==this.type?(++Rt.K,Pt.K=Rt.K,z(1),Fi(4)):3==this.type?(Fi(10),++Rt.G):4==this.type?(Fi(10),Rt.G+=5):(z(.5+this.type/2),Fi(3)),K(this)},o(ai,ti),ai.prototype.I=function(t){return(t=ti.prototype.I.call(this,t))&&this.c&&(ei(this,.5),Fi(8)),t},ai.prototype.f=function(){if(I(Pt,this)&&Pt.I(.5)){var t=Pt.a.b();A(t.o(this.a),.1),j(Pt.acceleration,t)}ti.prototype.f.call(this)},ai.prototype.u=function(){ti.prototype.u.call(this),Tt||Mt||!Pt.c||$.some(function(t){return t.ja})||(Tt=new pi(this.a),this.C||(this.va=0));var t=1;this.C&&(t=u(3,5)),this.da&&(t*=2),$t(this.a,this.va,t)},o(ri,ai),ri.prototype.f=function(){var t=Pt.a.B(this.a);if(!(20<t)){H.globalCompositeOperation="screen";var i=P(this.P.b(),.05).RGBA();wt(this.a,C(new F(.6,.4),this.size),i),H.globalCompositeOperation="source-over",S(this.Ma)&&(this.Ma.Set(l(.5,1)),this.La=p(1.3)),i=new F,Pt.c&&15>t&&A(i.H(Pt.a).o(this.a)),C(C(j(i,this.La),1<this.Ca?.004:.003),si(this)?.5:1),j(this.acceleration,i),t=Math.sin(10*m(this.v)),this.size.Set(this.za*(.9+.1*(1-t)),this.za*(.9+.1*t)),ai.prototype.f.call(this)}},ri.prototype.u=function(){if(1<this.Ea)for(var t=2;t--;){var i=new ri(this.a,this.Ea-1,this.Ca);i.l.Set(),i.da=this.da,i.g=this.g.b()}ai.prototype.u.call(this)},o(ci,ai),ci.prototype.f=function(){var t=Pt.a.B(this.a);if(!(20<t)){if(S(this.ka)&&0>=this.height&&(this.V=l(.15,.2),this.C&&(this.V*=1.2),this.ka.Set(l(1.5,3)),this.ua=p(l(0,1)),this.la.endTime=0),this.height+=this.V,this.V-=.005,0>=this.height)0<this.la.endTime||(this.la.Set(.3),ei(this,.8,0)),this.height=this.V=0;else{var i=new F;if(Pt.c&&15>t){var e=B(t=i.H(Pt.a).o(this.a));j(t=1<e?C(t,1/e):t,this.ua)}else i.H(this.ua);i=C(i,this.speed),j(this.acceleration,i)}this.i=2,(-.25<m(this.ka)||!S(this.la))&&++this.i,ai.prototype.f.call(this)}},o(fi,ai),(t=fi.prototype).ya=function(t){if(.5>m(this.l))return 0;var i=T(new F(1,0),this.rotation*r/2);return i=(t=A(t.b())).x*i.x+t.y*i.y,this.type?.4<i:-.4>i},t.$=function(t,i){var e=!this.C&&!this.type;return t.type&&!t.object||(e&&S(this.h)&&(this.rotation=(this.rotation+2)%4),C(this.g,0)),qt(i,!this.type)},t.I=function(t){return this.type&&!Pt.c?0:ai.prototype.I.call(this,t)},t.f=function(){var t=m(this.v),i=!this.type&&si(this),e=Pt.a.B(this.a);if(this.type&&At)this.rotation=.5>Math.abs(this.a.x-Tt.a.x)?1:0,1>this.B(Tt)&&K(this);else if(this.ea)24<this.a.x?(this.a.x=24,this.rotation=3):this.rotation=0;else{if(20<e&&!this.type)return;if(S(this.Ha)&&S(this.h)){if(this.ma=0,Pt.c&&(15>e||this.type)){var s=k(Pt.a.b().o(this.a));1&s||(s=(s+2)%4),this.rotation=s,this.type&&(this.ma=.5>c()),this.ma&&(this.rotation=(this.rotation+2)%4),.2>c()&&this.h.Set(2)}else this.rotation=f(4);this.Ha.Set(l(.8,2))}}i=T(new F(this.speed*(i?.5:1),0),this.rotation*r/2),S(this.h)||C(i,-1>m(this.h)?0:2),this.type&&At?10.5<e&&C(i,0):this.type&&((10<t&&this.c<this.K||20<t&&10>e)&&(this.ea=0),this.ea?(14<e&&C(i,0),21>this.a.y&&(C(i,0),this.rotation=1,this.s+=.021)):(this.ea=0,2>this.size.x?(M(this.size,.005,.005),this.ga=.8*this.size.x,C(i,0),this.s+=.1,0==kt%10&&(this.rotation=(this.rotation+1)%4),C(i,0)):this.size.Set(2,2))),j(this.g,C(i,this.ma?-1:1)),1&this.rotation?(this.i=1==this.rotation?6:7,this.D=this.s%2|0):(this.D=this.rotation,this.i=4+(this.s%2|0)),this.type&&(this.Z=3,this.i-=2),ii(this),ai.prototype.f.call(this)},t.u=function(){ai.prototype.u.call(this),this.type&&(Ot=0,Mt&&(new oi(this.a,2),$t(this.a,1,40),Ht.Set(),localStorage.KBAP_warp=0,localStorage.KBAP_won=1,Nt|=0,It&&(!Ut||Nt<Ut)&&(Ut=Nt,localStorage.KBAP_best=Ut),Fi(2)))},o(li,ti),li.prototype.u=function(){$t(this.a),ti.prototype.u.call(this)},li.prototype.f=function(){var t=this;if(.1>m(this.v)){var i=C(M(this.a.b(),0,2),16),e=16*this.count;H.fillStyle="#CCC",H.fillRect(i.x-e-2,i.y-30-2,2*e+4,44),H.fillStyle="#329",H.fillRect(i.x-e,i.y-30,2*e,40)}this.D=Pt.a.x<this.a.x,S(Jt)||(i=m(Jt),this.height=-i*(.5-.5*Math.cos(6*r*i))/2),$.forEach(function(i){i.ja&&I(i,t)&&t.u()}),ti.prototype.f.call(this)},o(ui,ti),ui.prototype.f=function(){Pt.c&&I(Pt,this)?(this.xa||this.N(),this.xa=1):this.xa=0,this.Ia&&!this.Ia.c&&K(this),ti.prototype.f.call(this)},ui.prototype.N=function(){this.A>Rt.G?(Fi(15),this.l.Set()):(2>this.type?new oi(this.a,this.type+1).N():new ni(this.a,3==this.type).N(),Jt.Set(1),Rt.G-=this.A,K(this))},ui.prototype.m=function(){U||Y||(ot(M(this.a.b(),0,-1),this.size),rt(this.A,-6,0,14,"left",.5,.5>m(this.l)?"#F00":"#000"),nt(-10,-1,4,5),_.restore()),ti.prototype.m.call(this)},o(pi,ti),pi.prototype.f=function(){this.height=.1+.1*Math.sin(5*L),this.j=.05/(this.size+.1);var t=this.size.x;if(1==this.type)60==kt&&Fi(13),0>=(t=b(0,1-m(_t)/2))&&K(this);else if(0<this.fa.endTime)t=-m(this.fa);else if(1>m(this.v))t=w(2*m(this.v),1);else if(Pt.c&&3>Pt.B(this)&&S(Pt.h)){var i=this.a.b().o(Pt.a),e=B(i);.5>e?(At&&3==this.type&&(It=1,Nt=0,Rt=new Xt),Fi(13),Dt.Set(1),this.fa.Set(1),2==this.type&&(Ct=Kt)):j(Pt.g,A(i,.005/e))}t=b(0,t),this.size.Set(t,t),ti.prototype.f.call(this)},pi.prototype.m=function(){ot(this.a,this.size,this.angle,this.height),_.lineWidth=1;for(var t,i=19;i--;_.stroke()){_.beginPath(),t="hsla("+(9*i+99*L)+",99%,"+(U?0:50)+"%,"+(U?.5:1)+")",_.strokeStyle=t;for(var e=8;e--;){var s=L-e*r/3+5*Math.sin(i/2+2*L)/19;_.arc(0,0,i*this.size.x,s,s)}}!(1<this.type)||U||0<this.fa.endTime||(rt(2==this.type?"Warp "+Kt:"Speed Run",0,-24,14,"center",1,t,"#000"),3==this.type&&Ut&&rt("Best "+g(Ut),0,-36,12,"center",1,t,"#000")),_.restore()};var vi=new x,di=c2,wi=di.getContext("2d"),bi=0;function gi(t,i,e,s,h,n,o,a,c){if(o=void 0===o?0:o,bi){e*=2*r/44100,e*=1+l(-i,i),n=1e3*r/Math.pow(44100,2)*(void 0===n?0:n),h=(void 0===h?.1:h)*(s=44100*(void 0===s?1:s)|0)|0,a=2*r/44100*(void 0===a?0:a),c=(void 0===c?0:c)*r,i=[];for(var f=0,u=0,p=0;p<s;++p)i[p]=.2*t*Math.cos(f*e*Math.cos(u*a+c))*(p<h?p/h:1-(p-h)/(s-h)),f+=1+l(-o,o),u+=1+l(-o,o),e+=n;t=bi.createBuffer(1,s,44100),e=bi.createBufferSource(),t.getChannelData(0).set(i),e.buffer=t,e.connect(bi.destination),e.start()}}var xi,mi=new x,Si=0;function Fi(t,i){switch(i=void 0===i?0:i,t){case 1:gi(1,.1,4504,.3,.1,-30,.5,.5,.33);break;case 2:gi(.7,0,500,4,.01,-.2,3,3,0);break;case 3:gi(1,0,1504,.3,.17,1.7,.5,.4,.33);break;case 4:gi(1,0,805,1.1,.71,.5,1.5,.5);break;case 5:gi(.3,.2,370,.2,.1,3.9,13,27,.12);break;case 6:gi(1,.1,0,.2,.23,2,.4,.6,.9);break;case 7:gi(1,.1,53,.2,.26,0,.1,7.5,.58);break;case 8:gi(1,.2,370,.1,.23,4.5,2.8,27.4,.12);break;case 9:gi(1,.2,1138,.2,.02,0,4,1.2,.1);break;case 10:0<Yt.endTime||Yt.Set(.05),gi(1,.01,800+i,.2,.05);break;case 11:gi(.4,.1,418,.1,.79,5,0,1.9,.74);break;case 12:gi(1,.1,319,.4,.08,6.6,3.2,2.6,.59);break;case 13:gi(1,.1,7,1,.97,0,.6,21.7,.5);break;case 14:gi(.8,.1,70,.1,.23,4.5,2.8,27,.12);break;case 15:gi(1,.1,800,.2,.02,-.3);break;case 16:gi(1,.1,0,.1,.1,1,.1,100)}}var ji=new Image;ji.onload=function(){_=Lt.getContext("2d"),X.Set(window.innerWidth/2,window.innerHeight/2),Lt.width=X.x,Lt.height=X.y,E=document.createElement("canvas"),H=E.getContext("2d"),E.display="none",H.imageSmoothingEnabled=0,D=document.createElement("canvas"),G=D.getContext("2d"),D.display="none",D.width=2*ji.width,D.height=ji.height,G.fillStyle="#FFF",G.fillRect(0,0,D.width,D.height),G.globalCompositeOperation="destination-atop",G.drawImage(ji,0,0),G.globalCompositeOperation="source-over",G.drawImage(D,ji.width,0),G.globalCompositeOperation="difference",G.drawImage(D,ji.width,0),_.fillRect(0,0,X.x,X.y),Zt(),Vt(),V()},ji.src="tiles.png"</script>