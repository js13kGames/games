<!doctype html><meta name=viewport content="width=device-width"><title>13 Maze - js13kGames</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#000}#gameCanvas{display:block;background-color:#f0f0f0}#optionContainer{display:none;flex-direction:column;align-items:center;position:absolute;background-color:#fff;padding:20px;border:1px solid #000;box-shadow:0 0 10px rgba(0,0,0,.3)}button{margin:10px}</style><canvas id=gameCanvas></canvas><div id=optionContainer><button onclick=move()>Move</button><button id=hintBtn onclick=useHint()>Hint</button><button onclick=cancel()>Close</button></div><script>const canvas=document.getElementById("gameCanvas");let canvasWidth,canvasHeight;if(0===window.orientation||180===window.orientation)canvasWidth=window.innerWidth,canvasHeight=window.innerHeight;else{const e=9/16;canvasWidth=window.innerWidth,canvasHeight=window.innerWidth/e,canvasHeight>window.innerHeight&&(canvasHeight=window.innerHeight,canvasWidth=window.innerHeight*e)}canvas.width=canvasWidth,canvas.height=canvasHeight;const context=canvas.getContext("2d"),mazeSize=10,tileSize=Math.min(canvas.width,canvas.height)/mazeSize,tiles=[],playerPosition={row:0,col:0},endTile={row:mazeSize-1,col:mazeSize-1};let currentScore=0,hintsAvailable=3,selectedTile=null;const sprite=new Image;sprite.src="./asset/sprite.png",sprite.onerror=function(){console.error("sprite error.")};let gameState="start";function drawStartScreen(){context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height);const e=mazeSize*tileSize,t=mazeSize*tileSize,i=(canvas.width-e)/2,n=(canvas.height-t)/2;context.font="50px Arial",context.textAlign="center",context.textBaseline="middle",drawGlitchText("13-Maze \n \n Click or Tap \n to Start",i+e/2,n+t/2),document.getElementById("hintBtn").innerHTML=`Hint (${hintsAvailable})`,createHorrorBGM()}function drawGameOverScreen(){context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height);const e=mazeSize*tileSize,t=mazeSize*tileSize,i=(canvas.width-e)/2,n=(canvas.height-t)/2;let a=currentScore>=13?"OVER 13":currentScore<=-13?"-13 DOWN":"";context.font="50px Arial",context.textAlign="center",context.textBaseline="middle",drawGlitchText("Game Over \n\n"+a,i+e/2,n+t/2)}function drawGameClearScreen(){context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height);const e=mazeSize*tileSize,t=mazeSize*tileSize,i=(canvas.width-e)/2,n=(canvas.height-t)/2;context.fillStyle="red",context.font="50px Arial",context.textAlign="center",context.textBaseline="middle",drawGlitchText("Game Clear",i+e/2,n+t/2)}let glitchText=[],glitchTextX=0,glitchTextY=[];function drawGlitchText(e,t,i){glitchText=e.split("\n"),glitchTextX=t,glitchTextY=glitchText.map(((e,t)=>i+50*t))}function update(){if(glitchText.length>0){context.font="50px Arial",context.textAlign="center",context.textBaseline="middle";for(let e=0;e<glitchText.length;e++)for(let t=0;t<5;t++){const t=10*Math.random()-5,i=10*Math.random()-5;context.fillStyle=`rgb(${180*Math.random()},${80*Math.random()},${80*Math.random()})`,context.fillText(glitchText[e],glitchTextX+t,glitchTextY[e]+i)}}requestAnimationFrame(update)}function drawScreen(){context.clearRect(0,0,canvas.width,canvas.height),context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height),"start"===gameState?drawStartScreen():"playing"===gameState?drawMaze():"gameover"===gameState?drawGameOverScreen():"gameclear"===gameState&&drawGameClearScreen()}function playMoveSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),i=e.createGain();t.type="square",t.frequency.setValueAtTime(150,e.currentTime),t.connect(i),i.connect(e.destination),i.gain.setValueAtTime(.2,e.currentTime),i.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.1),t.start(),t.stop(e.currentTime+.1)}update();const audioContext=new(window.AudioContext||window.webkitAudioContext);function createHorrorBGM(){const e=audioContext.createOscillator(),t=audioContext.createGain();e.type="sawtooth",e.frequency.setValueAtTime(60,audioContext.currentTime),t.gain.setValueAtTime(.01,audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.05,audioContext.currentTime+2),t.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+4),e.connect(t).connect(audioContext.destination),e.start(),setInterval((()=>{e.frequency.setValueAtTime(60,audioContext.currentTime),t.gain.setValueAtTime(.01,audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.05,audioContext.currentTime+2),t.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+4)}),4e3)}function getRandomScore(){return Math.random()<.7?Math.floor(4*Math.random()):-Math.floor(4*Math.random())}function initializeMaze(){for(let e=0;e<mazeSize;e++){tiles[e]=[];for(let t=0;t<mazeSize;t++)tiles[e][t]={x:t*tileSize,y:e*tileSize,wall:Math.random()<.2,revealed:!1,moveable:!1,score:getRandomScore()}}tiles[endTile.row][endTile.col].wall=!1,tiles[playerPosition.row][playerPosition.col].wall=!1,createMaze(),drawMaze(),updateMoveableTiles()}function isTileVisible(e,t,i){const n=mazeSize*tileSize,a=mazeSize*tileSize,o=(canvas.width-n)/2,l=(canvas.height-a)/2,c=playerPosition.col*tileSize-o,r=playerPosition.row*tileSize-l,s=t*tileSize-o,d=e*tileSize-l,m=Math.abs(c-s),h=Math.abs(r-d);return m<=i*tileSize&&h<=i*tileSize}function drawMaze(){context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height);const e=mazeSize*tileSize,t=mazeSize*tileSize,i=(canvas.width-e)/2,n=(canvas.height-t)/2;for(let e=0;e<mazeSize;e++)for(let t=0;t<mazeSize;t++){const a=tiles[e][t],o=i+a.x,l=n+a.y,c=isTileVisible(e,t,2);e===endTile.row&&t===endTile.col?context.drawImage(sprite,0,0,16,16,o,l,tileSize,tileSize):a.wall?c&&context.drawImage(sprite,16,0,16,16,o,l,tileSize,tileSize):(context.drawImage(sprite,32,0,16,16,o,l,tileSize,tileSize),a.revealed&&0!==a.score&&(context.fillStyle=a.score>0?"green":"red",context.font="20px Arial",context.textAlign="center",context.fillText(a.score,o+tileSize/2,l+tileSize/2+8))),a.moveable&&(context.strokeStyle="yellow",context.lineWidth=2,context.strokeRect(o,l,tileSize,tileSize))}context.drawImage(sprite,48,0,16,16,i+playerPosition.col*tileSize,n+playerPosition.row*tileSize,tileSize,tileSize),context.globalCompositeOperation="destination-in",context.beginPath(),context.arc(i+playerPosition.col*tileSize+tileSize/2,n+playerPosition.row*tileSize+tileSize/2,2*tileSize,0,2*Math.PI),context.fill(),context.globalCompositeOperation="source-over",context.fillStyle="rgba(0, 0, 0, 0.5)",context.beginPath(),context.rect(i,n,e,t),context.arc(i+playerPosition.col*tileSize+tileSize/2,n+playerPosition.row*tileSize+tileSize/2,2*tileSize,0,2*Math.PI),context.fill("evenodd")}function createMaze(){function e(e,t){return e>=0&&e<mazeSize&&t>=0&&t<mazeSize}function t(){const t=[[-1,0],[1,0],[0,-1],[0,1]],i=[playerPosition],n=new Set([`${playerPosition.row},${playerPosition.col}`]);for(;i.length>0;){const{row:a,col:o}=i.shift();if(a===endTile.row&&o===endTile.col)return!0;for(const[l,c]of t){const t=a+l,r=o+c;!e(t,r)||tiles[t][r].wall||n.has(`${t},${r}`)||(n.add(`${t},${r}`),i.push({row:t,col:r}))}}return!1}let i=0;for(;!t()&&i<1e3;){for(let e=0;e<mazeSize;e++)for(let t=0;t<mazeSize;t++)e===playerPosition.row&&t===playerPosition.col||e===endTile.row&&t===endTile.col||(tiles[e][t].wall=Math.random()<.4);i++}}function updateMoveableTiles(){for(let e=0;e<mazeSize;e++)for(let t=0;t<mazeSize;t++)tiles[e][t].moveable=!1;const e=[[-1,0],[1,0],[0,-1],[0,1]];for(const[t,i]of e){const e=playerPosition.row+t,n=playerPosition.col+i;e>=0&&e<mazeSize&&n>=0&&n<mazeSize&&!tiles[e][n].wall&&(tiles[e][n].moveable=!0)}drawMaze()}function move(){if(selectedTile&&tiles[selectedTile.row][selectedTile.col].moveable){tiles[playerPosition.row][playerPosition.col].revealed=!1,playerPosition.row=selectedTile.row,playerPosition.col=selectedTile.col;const e=tiles[selectedTile.row][selectedTile.col].score;currentScore+=e,drawMaze(),0!==e&&"playing"===gameState&&displayPixelatedScoreEffect(e),playMoveSound(),playerPosition.row===endTile.row&&playerPosition.col===endTile.col?(document.getElementById("optionContainer").style.display="none",gameState="gameclear",drawScreen(),currentScore=0,playerPosition.row=0,playerPosition.col=0):currentScore>=13||currentScore<=-13?(document.getElementById("optionContainer").style.display="none",gameState="gameover",drawScreen(),currentScore=0,playerPosition.row=0,playerPosition.col=0):(updateMoveableTiles(),document.getElementById("optionContainer").style.display="none"),selectedTile=null}}function displayPixelatedScoreEffect(e){const t=e>0?`+${e}`:`${e}`,i=e>0?"gray":"red";console.log("Displaying pixelated score:",t,"with color:",i);const n=document.createElement("canvas"),a=n.getContext("2d"),o=Math.min(canvas.width,canvas.height)/5;n.width=canvas.width,n.height=canvas.height,a.font=`bold ${o}px Arial`,a.fillStyle=i,a.textAlign="center",a.textBaseline="middle",a.fillText(t,n.width/2,n.height/2);const l=a.getImageData(0,0,n.width,n.height);for(let e=0;e<l.data.length;e+=4)if(l.data[e+3]>128){Math.random()>.8&&(l.data[e+3]=0)}a.putImageData(l,0,0),context.drawImage(n,0,0);let c=1;const r=setInterval((()=>{context.fillStyle="black",context.fillRect(0,0,canvas.width,canvas.height),context.globalAlpha=c,drawMaze(),context.drawImage(n,0,0),c-=.1,c<=0&&(clearInterval(r),context.globalAlpha=1,drawMaze(),updateMoveableTiles())}),100)}function useHint(){hintsAvailable>0?(hintsAvailable--,revealSurroundingTiles(playerPosition.row,playerPosition.col,1),drawMaze(),document.getElementById("optionContainer").style.display="none",document.getElementById("hintBtn").innerHTML=`Hint (${hintsAvailable})`):alert("Hints are no longer available.")}function revealSurroundingTiles(e,t,i){for(let n=e-i;n<=e+i;n++)for(let e=t-i;e<=t+i;e++)n>=0&&n<mazeSize&&e>=0&&e<mazeSize&&!tiles[n][e].wall&&(tiles[n][e].revealed=!0)}function cancel(){document.getElementById("optionContainer").style.display="none",selectedTile=null}function onClick(e){const t=canvas.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,a=mazeSize*tileSize,o=mazeSize*tileSize,l=i-(canvas.width-a)/2,c=n-(canvas.height-o)/2,r=Math.floor(l/tileSize),s=Math.floor(c/tileSize);if(s>=0&&s<mazeSize&&r>=0&&r<mazeSize){tiles[s][r].moveable&&(selectedTile={row:s,col:r},adjustOptionContainerPosition(e.clientX-t.left,e.clientY-t.top),optionContainer.style.display="flex")}}function drawTransition(e){context.fillStyle=`rgba(0,0,0,${e})`,context.fillRect(0,0,canvas.width,canvas.height)}function adjustOptionContainerPosition(e,t){const i=canvas.getBoundingClientRect(),n=optionContainer.offsetWidth,a=optionContainer.offsetHeight,o=Math.max(0,Math.min(e,canvas.width-n)),l=Math.max(0,Math.min(t,canvas.height-a));optionContainer.style.left=`${i.left+o}px`,optionContainer.style.top=`${i.top+l}px`}document.getElementById("optionContainer").addEventListener("click",(function(e){e.stopPropagation()})),canvas.addEventListener("click",(function(e){if("start"===gameState){gameState="transition";let e=0;const t=setInterval((()=>{drawTransition(e),e+=.01,e>=1&&(clearInterval(t),glitchText=[],gameState="playing",initializeMaze())}),10)}else"playing"===gameState?onClick(e):"gameover"!==gameState&&"gameclear"!==gameState||(gameState="start",drawScreen())})),canvas.addEventListener("touchstart",(function(e){if(e.preventDefault(),"start"===gameState){gameState="transition";let e=0;const t=setInterval((()=>{drawTransition(e),e+=.01,e>=1&&(clearInterval(t),glitchText=[],gameState="playing",initializeMaze())}),10)}else if("playing"===gameState){e.preventDefault();const t=canvas.getBoundingClientRect(),i=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top,a=mazeSize*tileSize,o=mazeSize*tileSize,l=i-(canvas.width-a)/2,c=n-(canvas.height-o)/2,r=Math.floor(l/tileSize),s=Math.floor(c/tileSize);if(s>=0&&s<mazeSize&&r>=0&&r<mazeSize){tiles[s][r].moveable&&(selectedTile={row:s,col:r},adjustOptionContainerPosition(e.clientX-t.left,e.clientY-t.top),optionContainer.style.display="flex")}}else"gameover"!==gameState&&"gameclear"!==gameState||(gameState="start",drawScreen())}),!1),drawStartScreen()</script>