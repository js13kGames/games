<title>Tangled - js13kGames 2025</title><body><script>const t=document,n=window,e=t.body,o=t.createElement("canvas"),i=o.getContext("2d");(document.getElementById("content")||e).innerHTML="",Object.assign(e.style,{margin:0,overflow:"hidden"}),Object.assign(o.style,{display:"block",touchAction:"none"}),e.appendChild(o);const{min:s,max:c,hypot:l,sqrt:r,sin:_,cos:a,PI:y,random:f}=Math,x=(t,n,e)=>c(n,s(e,t)),u=(t,n,e,o)=>t*o-n*e,E=s(2,n.devicePixelRatio||1);function M(){const e=n.innerWidth||t.documentElement.clientWidth,s=n.innerHeight||t.documentElement.clientHeight;Object.assign(o.style,{width:e+"px",height:s+"px"}),o.width=e*E|0,o.height=s*E|0,i.setTransform(E,0,0,E,0,0)}n.addEventListener("resize",M);const S={SIM:{DT_S:1/60,SUBSTEPS:1,ITERS:18,GRAVITY_MPS2:[0,9.81],DRAG:.01,BOUNDS_M:[0,-1e3,8,6],COLLIDE_CIRCLES:!0,CONTACT_COMPLIANCE_M_PER_N:0,CONTACT_SLIDING_SLOP_M:.001,RESTITUTION:.2,FRICTION:.55},RENDER:{BG:"#121825",LINK_STROKE:["#e74688","#d73779","#cb2f6f"],LINK_PATTERN:[0,0,1,2,1],LINK_WIDTH_PX:8,PIXELS_PER_METER:130,SHOW_BOUNDS:!1},GAME:{ROPE_COUNT:1e3,ROPE_START_M:{x:4,y:.8},ROPE_SEG_LEN_M:.1,ROPE_NODE_MASS_KG:.01,ROPE_NODE_RADIUS_M:.025,ROPE_STIFFNESS_N_PER_M:1e8,BALL_POS_M:{x:6,y:4.3},BALL_RADIUS_M:.3,BALL_MASS_KG:2,MAX_FRAME_DT_S:1/30,CLICK_POKE_N_PER_M:300,YARN_SNAP_MAX_STRETCH:1.35,YARN_SNAP_COOLDOWN_S:.15,YARN_SNAP_MIN_FROM_TIP:20,DEBRIS_COLLIDES:!0,MAX_LEVELS:100,X_MARGIN_M:.6,PLATFORM_RADIUS_M:.1,PEG_RADIUS_M:.18,THORN_RADIUS_M:.15,STEP_CHOICES_M:[.5,1,1.5],PEG_SPAWN_PROB:.5,THORN_START_DELTA_M:25,THORN_PROB_AT_START:0,THORN_PROB_AT_TOP:.8}};let d=performance.now();const A={mode:"playing",clicks:0,startY:S.GAME.BALL_POS_M.y,best_m:0,height_m:0,msg:""};function R(t){A.mode="lost",A.msg=t}function g(){location.reload()}const h={spanY_m:S.SIM.BOUNDS_M[3],minY:0},m=[];!function(){const[t,n,e,o]=S.SIM.BOUNDS_M,i=e-t,s=o-n;for(let e=0;e<300;e++){const e=t+f()*i,o=n+f()*s,c=.01+.02*f(),l=.04+.05*f(),r=.25+.45*f(),_=f()*y*2,a=f();m.push({x:e,y:o,r:c,gap:l,a:r,twinkle:_,layer:a})}}();const I=1e-9,T=function(){const t=function(t={}){const n={dt:t.dt??S.SIM.DT_S,substeps:t.substeps??S.SIM.SUBSTEPS,iters:t.iters??S.SIM.ITERS,g:t.g??S.SIM.GRAVITY_MPS2.slice(),drag:t.drag??S.SIM.DRAG,bounds:t.bounds??(S.SIM.BOUNDS_M&&S.SIM.BOUNDS_M.slice()),contactCompliance:t.contactCompliance??S.SIM.CONTACT_COMPLIANCE_M_PER_N,collide:t.collide??S.SIM.COLLIDE_CIRCLES,e:t.restitution??S.SIM.RESTITUTION,mu:t.friction??S.SIM.FRICTION,P:[],C:[],T:[],R:[],K:[]};function e(t,n,e,o,i){(t.w||t.iI)&&(t.w&&(t.vx+=n*t.w,t.vy+=e*t.w),t.iI&&(t.omega+=t.iI*u(o,i,n,e)))}function o(t,n,o,i,s,l,r,_,a=0,y=1/60,f=0){const E=-l,M=s,S=n.x-t.x,d=n.y-t.y,A=i.x-o.x,R=i.y-o.y,g=t.vx+(-t.omega||0)*d,h=t.vy+(t.omega||0)*S,m=o.vx+(-o.omega||0)*R-g,I=o.vy+(o.omega||0)*A-h,T=(t.w||0)+(t.iI||0)*u(S,d,s,l)**2+((o.w||0)+(o.iI||0)*u(A,R,s,l)**2)||1e9,p=(t.w||0)+(t.iI||0)*u(S,d,E,M)**2+((o.w||0)+(o.iI||0)*u(A,R,E,M)**2)||1e9,O=1/(T||1e-9),P=c(0,f)*O*y,N=m*s+I*l,v=m*E+I*M;let w=0;N<0&&(w=-(1+r)*N/T);const C=w+(a>0?1*a/y/T:0);if(0!==C){const n=C*s,i=C*l;e(t,-n,-i,S,d),e(o,n,i,A,R)}let L=-v/p;const b=_*(c(C,0)+P);L=x(L,-b,b);const G=L*E,D=L*M;e(t,-G,-D,S,d),e(o,G,D,A,R)}function i(t,n){const e=n.x-t.x,o=n.y-t.y;let i=l(e,o);i<I&&(i=I);const s=(t.r||0)+(n.r||0);return{hit:i<s,d:i,nx:e/i,ny:o/i,pen:s-i}}function s(t,n){const e=function(t,n,e,o,i,s){const c=i-e,l=s-o;let r=((t-e)*c+(n-o)*l)/(c*c+l*l||1);return r=x(r,0,1),{x:e+r*c,y:o+r*l,t:r}}(t.x,t.y,n.x1,n.y1,n.x2,n.y2),o=t.x-e.x,i=t.y-e.y;let s=l(o,i)||I;const r=(t.r||0)+n.r;return{hit:s<r+S.SIM.CONTACT_SLIDING_SLOP_M,d:s,nx:o/s,ny:i/s,pen:c(0,r-s),pc:{x:e.x,y:e.y}}}return{P:n.P,C:n.C,T:n.T,R:n.R,K:n.K,get dt(){return n.dt},set dt(t){n.dt=t},get iters(){return n.iters},set iters(t){n.iters=0|t},get substeps(){return n.substeps},set substeps(t){n.substeps=0|t},get gravity(){return n.g},set gravity(t){n.g=t},get bounds(){return n.bounds},set bounds(t){n.bounds=t},get collide(){return n.collide},set collide(t){n.collide=!!t},add:function(t,e,o=1,i=0,s=7,c=!0){const l={x:t,y:e,px:t,py:e,vx:0,vy:0,w:o>0?1/o:0,r:i,col_mask:s,active:c,rigid:!1};return n.P.push(l),l},addRigidCircle:function(t,e,o,i=0,s=7,c=!0){const l={x:t,y:e,px:t,py:e,vx:0,vy:0,w:i>0?1/i:0,r:o,col_mask:s,active:c,rigid:!0,theta:0,omega:0,iI:i>0?1/(i>0?.5*i*o*o:1/0):0};return n.R.push(l),l},addCapsule:function(t,e,o,i,s,c=0,l=7,r=!0){const _={x1:t,y1:e,x2:o,y2:i,r:s,w:c>0?1/c:0,col_mask:l,active:r,capsule:!0};return n.K.push(_),_},link:function(t,e,o=null,i=0){if(null==o){const n=e.x-t.x,i=e.y-t.y;o=l(n,i)}const s={a:t,b:e,rest:o,comp:i,lam:0};return n.C.push(s),s},addForce:function(t,e,o){return t.w?(t.vx+=e*t.w*n.dt,t.vy+=o*t.w*n.dt,t):t},step:function(t=n.dt){const e=n.P,c=n.C,r=n.R,_=n.g,a=n.drag,y=n.substeps,f=n.iters,x=!!n.bounds,u=n.bounds,E=!!n.collide,M=n.e,S=n.mu,d=t/y,A=1/(1+a),R=d*d;for(let t=0;t<y;t++){for(let t=0;t<e.length;t++){const n=e[t];n.active&&(n.px=n.x,n.py=n.y,n.w&&(n.vx+=_[0]*d,n.vy+=_[1]*d,n.vx*=A,n.vy*=A,n.x+=n.vx*d,n.y+=n.vy*d))}for(let t=0;t<r.length;t++){const n=r[t];n.active&&(n.px=n.x,n.py=n.y,n.w&&(n.vx+=_[0]*d,n.vy+=_[1]*d,n.vx*=A,n.vy*=A,n.x+=n.vx*d,n.y+=n.vy*d),n.theta+=n.omega*d)}for(let t=0;t<f;t++){for(let t=0;t<c.length;t++){const n=c[t],e=n.a,o=n.b;let i=o.x-e.x,s=o.y-e.y;const r=l(i,s);if(r<I)continue;const _=i/r,a=s/r,y=r-n.rest,f=e.w+o.w;if(0===f){n.lam=0;continue}const x=(n.comp||0)/R,u=1*n.lam,E=(-y-x*u)/(f+x);n.lam=u+E;const M=E*_,S=E*a;e.w&&(e.x-=M*e.w,e.y-=S*e.w),o.w&&(o.x+=M*o.w,o.y+=S*o.w)}if(x){const[t,n,o,i]=u;for(let s=0;s<e.length;s++){const c=e[s];if(!c.active)continue;const l=c.r||0;c.x<t+l&&(c.x=t+l),c.x>o-l&&(c.x=o-l),c.y<n+l&&(c.y=n+l),c.y>i-l&&(c.y=i-l)}for(let e=0;e<r.length;e++){const s=r[e];if(!s.active)continue;const c=s.r||0;s.x<t+c&&(s.x=t+c),s.x>o-c&&(s.x=o-c),s.y<n+c&&(s.y=n+c),s.y>i-c&&(s.y=i-c)}}if(E){for(let t=0;t<r.length;t++){const n=r[t];if(n.active)for(let e=t+1;e<r.length;e++){const t=r[e];if(!t.active)continue;if(0==(n.col_mask&t.col_mask))continue;const o=i(n,t);if(!o.hit)continue;const s=n.w+t.w;if(0===s)continue;const c=o.pen/s;n.w&&(n.x-=o.nx*c*n.w,n.y-=o.ny*c*n.w),t.w&&(t.x+=o.nx*c*t.w,t.y+=o.ny*c*t.w)}}for(let t=0;t<r.length;t++){const e=r[t];if(e.active)for(let t=0;t<n.K.length;t++){const o=n.K[t];if(!o.active)continue;if(0==(e.col_mask&o.col_mask))continue;const i=s(e,o);i.hit&&e.w&&(e.x+=i.nx*i.pen,e.y+=i.ny*i.pen)}}for(let t=0;t<e.length;t++){const o=e[t];if(o.active&&o.r&&o.w)for(let t=0;t<n.K.length;t++){const e=n.K[t];if(!e.active)continue;if(0==(o.col_mask&e.col_mask))continue;const i=s(o,e);i.hit&&(o.x+=i.nx*i.pen,o.y+=i.ny*i.pen)}}for(let t=0;t<e.length;t++){const n=e[t];if(n.active&&n.r)for(let t=0;t<r.length;t++){const e=r[t];if(!e.active||!e.r)continue;if(0==(n.col_mask&e.col_mask))continue;const o=i(n,e);if(!o.hit)continue;const s=n.w+e.w;if(0===s)continue;const c=o.pen/s;n.w&&(n.x-=o.nx*c*n.w,n.y-=o.ny*c*n.w),e.w&&(e.x+=o.nx*c*e.w,e.y+=o.ny*c*e.w)}}}}for(let t=0;t<e.length;t++){const n=e[t];n.active&&(n.vx=(n.x-n.px)/d,n.vy=(n.y-n.py)/d)}for(let t=0;t<r.length;t++){const n=r[t];n.active&&(n.vx=(n.x-n.px)/d,n.vy=(n.y-n.py)/d)}if(E){for(let t=0;t<r.length;t++){const e=r[t];if(e.active)for(let s=t+1;s<r.length;s++){const t=r[s];if(!t.active)continue;if(0==(e.col_mask&t.col_mask))continue;const c=i(e,t);if(!c.hit)continue;const l={x:e.x+c.nx*e.r,y:e.y+c.ny*e.r},_={x:t.x-c.nx*t.r,y:t.y-c.ny*t.r},a=((e.w?1:0)-(t.w?1:0))*(n.g[0]*c.nx+n.g[1]*c.ny);o(e,l,t,_,c.nx,c.ny,M,S,c.pen,d,a)}}for(let t=0;t<r.length;t++){const e=r[t];if(e.active)for(let t=0;t<n.K.length;t++){const i=n.K[t];if(!i.active)continue;if(0==(e.col_mask&i.col_mask))continue;const c=s(e,i);if(!c.hit)continue;const l={x:c.pc.x,y:c.pc.y},r=-c.nx,_=-c.ny,a=n.g[0]*r+n.g[1]*_;o(e,{x:e.x-c.nx*e.r,y:e.y-c.ny*e.r},{x:i.x1,y:i.y1,vx:0,vy:0,omega:0,w:0,iI:0},l,r,_,M,S,c.pen,d,a)}}if(x){const[t,n,e,i]=u;for(let s=0;s<r.length;s++){const c=r[s];c.active&&(c.x-c.r<=t&&o(c,{x:t,y:c.y},{x:0,y:0,vx:0,vy:0,omega:0,w:0,iI:0},{x:t,y:c.y},1,0,M,S),c.x+c.r>=e&&o(c,{x:e,y:c.y},{x:0,y:0,vx:0,vy:0,omega:0,w:0,iI:0},{x:e,y:c.y},-1,0,M,S),c.y-c.r<=n&&o(c,{x:c.x,y:n},{x:0,y:0,vx:0,vy:0,omega:0,w:0,iI:0},{x:c.x,y:n},0,1,M,S),c.y+c.r>=i&&o(c,{x:c.x,y:i},{x:0,y:0,vx:0,vy:0,omega:0,w:0,iI:0},{x:c.x,y:i},0,-1,M,S))}}}}},stiffnessToCompliance:function(t){return t>0?1/t:0}}}({dt:S.SIM.DT_S,iters:S.SIM.ITERS,substeps:S.SIM.SUBSTEPS,g:S.SIM.GRAVITY_MPS2,bounds:S.SIM.BOUNDS_M,collide:S.SIM.COLLIDE_CIRCLES,contactCompliance:S.SIM.CONTACT_COMPLIANCE_M_PER_N,restitution:S.SIM.RESTITUTION,friction:S.SIM.FRICTION});let n=0;const e=S.GAME.ROPE_SEG_LEN_M,o=S.GAME.YARN_SNAP_MAX_STRETCH,i=[],E=[],M=[],[d,A,R,g]=S.SIM.BOUNDS_M,h=R-d,m=g-A,T=t.addCapsule(d-h,g,R+h,g,.12,0,7,!0);function p(t,n){return t+f()*(n-t)}function O(i){if(n>0)return void(n-=i);if(B-U<=1)return;let s=-1,c=0;for(let t=U;t<B-1;t++){const n=L[t],o=L[t+1],i=o.x-n.x,l=o.y-n.y,r=(Math.hypot(i,l)||e)/e;r>c&&(c=r,s=t)}if(!(s>=0&&c>=o))return;const l=s-U>=S.GAME.YARN_SNAP_MIN_FROM_TIP,r=s<B-S.GAME.YARN_SNAP_MIN_FROM_TIP;l&&r&&function(e){const o=G[e];if(o){const n=t.C.indexOf(o);n>=0&&t.C.splice(n,1),G[e]=null}for(let t=U;t<=e;t++)L[t]&&(S.GAME.DEBRIS_COLLIDES||(L[t].col_mask=0));U=e+1,n=S.GAME.YARN_SNAP_COOLDOWN_S}(s)}i.push(T),i.push(t.addCapsule(d+.15*h,g-.9,R-.15*h,g-1,S.GAME.PLATFORM_RADIUS_M,0,7,!0));let P=g-1.2;for(let n=0;n<S.GAME.MAX_LEVELS;n++){const n=P-(N=S.GAME.STEP_CHOICES_M)[f()*N.length|0],e=d+S.GAME.X_MARGIN_M,o=R-S.GAME.X_MARGIN_M,l=p(e,o-2),r=l+p(1.2,2.4);i.push(t.addCapsule(l,n,s(r,o),n+p(-.05,.05),S.GAME.PLATFORM_RADIUS_M,0,7,!0));const _=.5*(P+n),a=p(e,o),y=S.GAME.BALL_POS_M.y-n,x=c(0,y-S.GAME.THORN_START_DELTA_M),u=s(1,x/(.8*m)),A=S.GAME.THORN_PROB_AT_START*(1-u)+S.GAME.THORN_PROB_AT_TOP*u;f()<S.GAME.PEG_SPAWN_PROB&&(f()<A?M.push(t.addRigidCircle(a,_,S.GAME.THORN_RADIUS_M,0,7,!0)):E.push(t.addRigidCircle(a,_,S.GAME.PEG_RADIUS_M,0,7,!0))),P=n}var N;const v=S.GAME.ROPE_COUNT,w=S.GAME.ROPE_START_M,C=S.GAME.ROPE_SEG_LEN_M,L=[];let b=t.add(w.x,w.y,S.GAME.ROPE_NODE_MASS_KG,S.GAME.ROPE_NODE_RADIUS_M,0);L.push(b);const G=[];for(let n=1;n<v;n++){const e=t.add(w.x+n*C,w.y,S.GAME.ROPE_NODE_MASS_KG,S.GAME.ROPE_NODE_RADIUS_M,0),o=t.link(b,e,C,t.stiffnessToCompliance(S.GAME.ROPE_STIFFNESS_N_PER_M));G.push(o),L.push(e),b=e}const D=t.addRigidCircle(S.GAME.BALL_POS_M.x,S.GAME.BALL_POS_M.y,S.GAME.BALL_RADIUS_M,S.GAME.BALL_MASS_KG,1,!0),k=function(t,n,e){const o=new Array(t).fill(0),i=new Array(t).fill(0),s=e,c=[],x=t=>{if(!c.length)return void c.push(t);const e=c[c.length-1],o=l(t.x-e.x,t.y-e.y),i=(t.x-e.x)/(o||1),s=(t.y-e.y)/(o||1);c.push({x:e.x+i*n,y:e.y+s*n})};x({x:s,y:s});const u=t-c.length;let E=1;for(let t=0;t<u;t++){f()<.2&&(E*=-1);const e=E*t*(n/(2*y*s))*2*y,o=(s-0)*r(1-t/u)+0;x({x:o*a(e),y:o*_(e)})}for(let n=0;n<t;n++){const t=c[n]||c[c.length-1];o[n]=t.x,i[n]=t.y}const M=new Array(t).fill(0);for(let n=1;n<t;n++)M[n]=l(o[n],i[n]);return{wX:o,wY:i,wR:M}}(v,C,S.GAME.BALL_RADIUS_M);let B=0,U=0;function Y(t,n,e,o=0){const i=a(o),s=_(o);return{x:n+(k.wX[t]*i-k.wY[t]*s),y:e+(k.wX[t]*s+k.wY[t]*i)}}return function(){for(let t=0;t<v;t++)L[t].w=0;L[0].w=0,B=0}(),{advance:function(n){if(B<v){const t=L[B],n=Y(B,D.x,D.y,D.theta);t.x=n.x,t.y=n.y,t.px=n.x,t.py=n.y}for(let t=B+1;t<v;t++){const n=L[t],e=Y(t,D.x,D.y,D.theta);n.x=e.x,n.y=e.y,n.px=e.x,n.py=e.y,n.vx=0,n.vy=0,n.w=0}t.step(n),O(n)},freeSegments:function(t=1){for(let n=0;n<t&&B<v;n++){const t=L[B];t.w=1/S.GAME.ROPE_NODE_MASS_KG;const n=t.x-D.x,e=t.y-D.y;t.vx=D.vx+-D.omega*e,t.vy=D.vy+D.omega*n,t.col_mask=2,B++}if(B<v){L[B].w=0;let t=0;const n=s(c(25,.1*(v-B)),v-B);for(let e=0;e<n;e++)t+=k.wR[e+B];D.r=c(.05,t/n)}else D.active=!1},applyPoke:function(n,e,o=S.GAME.CLICK_POKE_N_PER_M){t.addForce(D,(n-D.x)*o,(e-D.y)*o)},getRenderData:function(){const t=[];for(let n=U;n<s(B,v);n++)t.push({x:L[n].x,y:L[n].y});const n=[];if(B<v-1)for(let t=B;t<v;t++){const e=Y(t,D.x,D.y,D.theta);n.push(e)}const e=S.GAME.ROPE_SEG_LEN_M*B;return{bounds:S.SIM.BOUNDS_M.slice(),tail:t,wound:n,ball:{x:D.x,y:D.y,r:D.r,active:D.active,theta:D.theta,vx:D.vx,vy:D.vy},hud:{freedLength_m:e},platforms:i.map(t=>({r:t.r,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2})),pegs:E.map(t=>({x:t.x,y:t.y,r:t.r})),thorns:M.map(t=>({x:t.x,y:t.y,r:t.r}))}}}}(),p=function(){const t={pixelsPerMeter:S.RENDER.PIXELS_PER_METER,bg:S.RENDER.BG,linkStroke:S.RENDER.LINK_STROKE,linkPattern:S.RENDER.LINK_PATTERN,linkWidth:S.RENDER.LINK_WIDTH_PX,showBounds:S.RENDER.SHOW_BOUNDS},n=t.pixelsPerMeter;function e(t,e,o){const[i,s]=t;return[(e-i)*n,(o-s)*n]}function s(t){return t*n}return{draw:function(l,r){i.fillStyle=t.bg,i.fillRect(0,0,o.clientWidth,o.clientHeight);const f=r||l.bounds,x=Object.assign({},l,{bounds:f});!function(t){const[n,o,c,l]=t,r=.002*performance.now();i.save();for(const n of m){if(n.y<o-.5||n.y>l+.5)continue;const c=.02*o*(n.layer-.5),a=n.x+c,f=e(t,a-.5*n.gap,n.y),x=e(t,a+.5*n.gap,n.y),u=s(n.r)*(.15*_(r+n.twinkle)+.85);i.globalAlpha=.6*n.a,i.shadowColor="#e6fffa",i.shadowBlur=3*u,i.fillStyle="#e6fffa",i.beginPath(),i.arc(f[0],f[1],u,0,2*y),i.fill(),i.beginPath(),i.arc(x[0],x[1],u,0,2*y),i.fill(),i.shadowBlur=0}i.restore()}(f),function(n){const{bounds:o,tail:s,wound:c}=n,l=s.concat(c),r=l.length;if(!(r<2)){for(let t=0;t<r;t++)l[t]=e(o,l[t].x,l[t].y);!function(n){if(!n||n.length<2)return;const e=n.length-1,o=Array(e);for(let t=0;t<e;t++)o[t]=(s=n[t],c=n[t+1],[(s[0]+c[0])/2,(s[1]+c[1])/2]);var s,c;let l=0,r=t.linkStroke[t.linkPattern[l]];i.save(),i.lineWidth=t.linkWidth,i.lineCap="round",i.lineJoin="round",i.strokeStyle=r,i.beginPath(),i.moveTo(n[0][0],n[0][1]);for(let s=0;s<e;s++){i.quadraticCurveTo(n[s][0],n[s][1],o[s][0],o[s][1]),l=(l+1)%t.linkPattern.length;let e=t.linkStroke[t.linkPattern[l]];e!==r&&(i.stroke(),i.beginPath(),i.moveTo(o[s][0],o[s][1]),i.strokeStyle=r=e)}i.quadraticCurveTo(n[e][0],n[e][1],n[e][0],n[e][1]),i.stroke(),i.restore()}(l)}}(x),function(t){const{bounds:o,platforms:l,pegs:r,thorns:f,ball:x,hud:u}=t;i.strokeStyle="#666",i.lineCap="round";for(const t of l){i.lineWidth=t.r*n*2;const s=e(o,t.x1,t.y1),c=e(o,t.x2,t.y2);i.beginPath(),i.moveTo(s[0],s[1]),i.lineTo(c[0],c[1]),i.stroke()}i.fillStyle="#888";for(const t of r){const n=e(o,t.x,t.y);i.beginPath(),i.arc(n[0],n[1],s(t.r),0,2*y),i.fill()}i.fillStyle="#c0392b";for(const t of f){const n=e(o,t.x,t.y);i.beginPath(),i.arc(n[0],n[1],s(t.r),0,2*y),i.fill();const c=6,l=s(t.r),r=1.25*l;i.beginPath();for(let t=0;t<c;t++){const e=t/c*y*2;i.moveTo(n[0]+a(e)*l,n[1]+_(e)*l),i.lineTo(n[0]+a(e)*r,n[1]+_(e)*r)}i.strokeStyle="#c0392b",i.lineWidth=2,i.stroke()}i.fillStyle="#fff",i.font="14px system-ui,sans-serif";const E=c(0,100-u.freedLength_m);i.fillText("yarn left: "+E.toFixed(1)+" m",12,22),i.fillText("height: "+(A.startY-x.y).toFixed(1)+" m",12,42),i.fillText("best: "+A.best_m.toFixed(1)+" m",12,62),"lost"===A.mode&&i.fillText(A.msg+"  (click to restart)",12,84),performance.now()-d<1e4&&(i.globalAlpha=.8,i.fillStyle="#d8d8ff",i.font="13px system-ui,sans-serif",i.fillText("A black cat must climb the tower before dawn, but its yarn is limited…",12,82),i.globalAlpha=1)}(x)},screenToMeters:function(t,e,i){const s=o.getBoundingClientRect(),c=(e-s.left)/E,l=(i-s.top)/E,[r,_]=t;return{x:r+c/n,y:_+l/n}}}}();M();let O=performance.now();requestAnimationFrame(function t(n){const e=x((n-O)/1e3,0,S.GAME.MAX_FRAME_DT_S);O=n,T.advance(e);const o=T.getRenderData(),i=o.ball.y-2.5;i<h.minY&&(h.minY=.85*h.minY+.15*i),i>h.minY+5&&(h.minY=.97*h.minY+.03*i);const s=[o.bounds[0],h.minY,o.bounds[2],h.minY+h.spanY_m];if(A.height_m=c(0,A.startY-o.ball.y),A.height_m>A.best_m&&(A.best_m=A.height_m),"playing"===A.mode){o.ball.active||R("Out of yarn");const t=o.bounds[3];o.ball.y>=t-.01&&R("You fell"),function(t){const n=t.thorns||[];if(!n.length)return!1;for(const e of n){const n=t.ball.x-e.x,o=t.ball.y-e.y;if(l(n,o)<=t.ball.r+e.r)return!0}const e=S.GAME.ROPE_NODE_RADIUS_M;for(const o of t.tail)for(const t of n){const n=o.x-t.x,i=o.y-t.y;if(l(n,i)<=e+t.r)return!0}return!1}(o)&&R("Thorned!")}isNaN(o.ball.y)&&g(),p.draw(o,s),requestAnimationFrame(t)}),o.addEventListener("click",t=>{if("lost"===A.mode)return void g();A.clicks++;const n=T.getRenderData(),e=[n.bounds[0],h.minY,n.bounds[2],h.minY+h.spanY_m],o=p.screenToMeters(e,t.clientX,t.clientY);T.applyPoke(o.x,o.y,S.GAME.CLICK_POKE_N_PER_M),T.freeSegments(10)})</script>