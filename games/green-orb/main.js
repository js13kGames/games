var com;(function(a){(function(d){var c=(function(){function e(){}e.DEBUG=false;e.log=function f(){var g=[];for(var h=0;h<(arguments.length-0);h++){g[h]=arguments[h+0]}if(e.DEBUG==true){console.log("[LOG] "+g.join())}};return e})();d.Trace=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(i,k,j,h){if(typeof i==="undefined"){i=0}if(typeof k==="undefined"){k=0}if(typeof j==="undefined"){j=0}if(typeof h==="undefined"){h=0}this.x=i;this.y=k;this.width=j;this.height=h}g.prototype.isIntersecting=function(h){return(Math.abs(this.x-h.x)*2<(this.width+h.width))&&(Math.abs(this.y-h.y)*2<(this.height+h.height))};g.prototype.toString=function(){return"{x : "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"};return g})();f.Rectangle=e})(d.geom||(d.geom={}));var c=d.geom})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(e){var d=(function(){function f(g){this.sourceRect=g}return f})();e.SpriteData=d;var c=(function(){function p(){}p.data_0=function q(){return new d(new e.geom.Rectangle(6,13,9,9))};p.data_1=function o(){return new d(new e.geom.Rectangle(20,13,5,9))};p.data_2=function n(){return new d(new e.geom.Rectangle(30,13,9,9))};p.data_3=function m(){return new d(new e.geom.Rectangle(45,13,8,9))};p.data_4=function l(){return new d(new e.geom.Rectangle(58,13,10,9))};p.data_5=function k(){return new d(new e.geom.Rectangle(73,13,8,9))};p.data_6=function i(){return new d(new e.geom.Rectangle(87,13,8,9))};p.data_7=function h(){return new d(new e.geom.Rectangle(101,13,8,9))};p.data_8=function g(){return new d(new e.geom.Rectangle(114,13,9,9))};p.data_9=function f(){return new d(new e.geom.Rectangle(128,13,9,9))};p.data_game=function z(){return new d(new e.geom.Rectangle(8,28,221,53))};p.data_over=function y(){return new d(new e.geom.Rectangle(8,93,206,53))};p.data_click_to_continue=function s(){return new d(new e.geom.Rectangle(8,155,140,9))};p.data_tap_to_continue=function A(){return new d(new e.geom.Rectangle(8,168,128,9))};p.data_tap_to_start=function w(){return new d(new e.geom.Rectangle(152,168,104,9))};p.data_click_to_start=function t(){return new d(new e.geom.Rectangle(152,155,116,9))};p.data_you=function v(){return new d(new e.geom.Rectangle(8,184,152,53))};p.data_win=function u(){return new d(new e.geom.Rectangle(161,184,159,53))};p.data_click_to_resume=function x(){return new d(new e.geom.Rectangle(8,245,128,9))};p.data_tap_to_resume=function j(){return new d(new e.geom.Rectangle(148,245,116,9))};p.data_title_green_orb=function r(){return new d(new e.geom.Rectangle(25,267,219,149))};return p})();e.Res=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(e){var f=(function(){function i(){}i.isTouchDevice=function h(){if("ontouchstart" in window){return true}return false};i.isMobileOS=function j(){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/Mobile/i)||navigator.userAgent.match(/Tablet/i)){return true}return false};i.isFirefoxAndroid=function g(){if(navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Firefox/i)){return true}return false};return i})();e.Device=f})(d.utils||(d.utils={}));var c=d.utils})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(e){var f=(function(){function g(h,i){if(typeof h==="undefined"){h=0}if(typeof i==="undefined"){i=0}this.x=h;this.y=i}g.prototype.toString=function(){return"{x : "+this.x+", y: "+this.y+"}"};return g})();e.Point=f})(d.geom||(d.geom={}));var c=d.geom})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(g){var e=(function(){function h(i,j){if(typeof i==="undefined"){i=0}if(typeof j==="undefined"){j=0}this.x=i;this.y=j;this.id=0;this.color=h.LIGHT_COL}h.DARK_COL="rgba(25, 25, 25, 1)";h.LIGHT_COL="rgba(65, 65, 65, 1)";return h})();g.BackgroundParticle=e;var f=(function(){function h(o,p){this.context=o;this.stageSize=p;this._starList=[];var q=d.utils.Device.isMobileOS()?10:20;for(var n=0;n<q;n++){var l=(Math.random()*this.stageSize.width)>>0;var j=(Math.random()*this.stageSize.height)>>0;var k=new e(l,j);k.id=n;var m=(Math.random()*10)>>0;if(m>5){k.color=e.DARK_COL}this._starList.push(k)}}h.prototype.update=function(){for(var j=0;j<this._starList.length;j++){this.context.beginPath();this.context.rect(this._starList[j].x,this._starList[j].y,4,4);this.context.fillStyle=this._starList[j].color;this.context.fill();this._starList[j].y+=2;if(this._starList[j].y>(this.stageSize.height+10)){this._starList[j].y=0;this._starList[j].x=(Math.random()*this.stageSize.width)>>0}}};h.prototype.dispose=function(){this.context=null;this.stageSize=null;this._starList.length=0;this._starList=null};return h})();g.GameBackground=f})(d.elements||(d.elements={}));var c=d.elements})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){var c=(function(){function e(g,h,f){this.canvas=g;this.context=h;this.stageProp=f;this._isRAF=false;this._clickTextPosition=new d.geom.Point(100,420);this._titleTextPosition=new d.geom.Point(50,100);this._blinkCount=0;d.Trace.log("show title screen");if(window.requestAnimationFrame){d.Trace.log("using RAF");this._isRAF=true}this.bindHandlers();this.init();this.update()}e.prototype.bindHandlers=function(){this.updateBind=this.update.bind(this);this.onCanvasClickBind=this.onCanvasClick.bind(this)};e.prototype.init=function(){this._textSourceRect=d.utils.Device.isTouchDevice()?d.Res.data_tap_to_start().sourceRect:d.Res.data_click_to_start().sourceRect;this._titleSourceRect=d.Res.data_title_green_orb().sourceRect;this._background=new d.elements.GameBackground(this.context,this.stageProp);this.canvas.addEventListener("click",this.onCanvasClickBind,false)};e.prototype.onCanvasClick=function(g){d.Trace.log("click.. start game");g.preventDefault();var f=document.createEvent("Event");f.initEvent("startgame",true,true);document.dispatchEvent(f)};e.prototype.update=function(){this.context.globalCompositeOperation="source-over";this.context.fillStyle="rgba(0, 0, 0, 0.4)";this.context.fillRect(0,0,this.stageProp.width,this.stageProp.height);this.context.globalCompositeOperation="lighter";if(this._background){this._background.update()}this.context.drawImage(d.Res.gfxSprite,this._titleSourceRect.x,this._titleSourceRect.y,this._titleSourceRect.width,this._titleSourceRect.height,this._titleTextPosition.x,this._titleTextPosition.y,this._titleSourceRect.width,this._titleSourceRect.height);if(this._blinkCount<=100){this.context.drawImage(d.Res.gfxSprite,this._textSourceRect.x,this._textSourceRect.y,this._textSourceRect.width,this._textSourceRect.height,this._clickTextPosition.x,this._clickTextPosition.y,this._textSourceRect.width,this._textSourceRect.height)}this._blinkCount+=1;if(this._blinkCount>=150){this._blinkCount=0}this._frameRateID=this._isRAF?window.requestAnimationFrame(this.updateBind):window.setTimeout(this.updateBind,17)};e.prototype.dispose=function(){this._isRAF?window.cancelAnimationFrame(this._frameRateID):window.clearTimeout(this._frameRateID);if(this.canvas){this.canvas.removeEventListener("click",this.onCanvasClickBind,false)}if(this._background){this._background.dispose();this._background=null}this.canvas=null;this.context=null;this.updateBind=null;this.onCanvasClickBind=null;this.stageProp=null;this._clickTextPosition=null;this._textSourceRect=null;this._titleSourceRect=null;this._titleTextPosition=null};return e})();d.TitleMain=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){var c=(function(){function e(f){this.canvas=f;this.playerPosition=new d.geom.Point(162,380);this.isActive=false;this.isPaused=false;this._isLeft=false;this._isRight=false;this._isUp=false;this._isDown=false;this._velocity=new d.geom.Point(0,0);this._speed=0.3;this._friction=0.93;this._maxSpeed=4;this.bindHandlers();f.addEventListener("touchmove",this.onTouchMoveBind,false);f.addEventListener("touchend",this.onTouchEndBind,false);f.addEventListener("touchstart",this.onTouchStartBind,false);document.addEventListener("keydown",this.onKeyDownBind,false);document.addEventListener("keyup",this.onKeyUpBind,false);window.addEventListener("blur",this.onWindowBlurBind,false)}e.prototype.bindHandlers=function(){this.onTouchMoveBind=this.onTouchMove.bind(this);this.onTouchStartBind=this.onTouchStart.bind(this);this.onTouchEndBind=this.onTouchEnd.bind(this);this.onKeyDownBind=this.onKeyDown.bind(this);this.onKeyUpBind=this.onKeyUp.bind(this);this.onWindowBlurBind=this.onWindowBlur.bind(this);this.onStageClickBind=this.onStageClick.bind(this)};e.prototype.removeBlurListener=function(){window.removeEventListener("blur",this.onWindowBlurBind,false)};e.prototype.onWindowBlur=function(f){this.isPaused=true;this.canvas.addEventListener("click",this.onStageClickBind,false)};e.prototype.onStageClick=function(f){d.Trace.log("click");this.isPaused=false;this.canvas.removeEventListener("click",this.onStageClickBind,false)};e.prototype.onKeyDown=function(g){var f=false;if(g.keyCode==39){this._isLeft=false;this._isRight=true;f=true}else{if(g.keyCode==37){this._isRight=false;this._isLeft=true;f=true}}if(g.keyCode==38){this._isUp=true;this._isDown=false;f=true}else{if(g.keyCode==40){this._isDown=true;this._isUp=false;f=true}}if(f){g.preventDefault()}};e.prototype.onKeyUp=function(g){var f=false;if(g.keyCode==39){this._isRight=false;f=true}else{if(g.keyCode==37){this._isLeft=false;f=true}}if(g.keyCode==38){this._isUp=false;f=true}else{if(g.keyCode==40){this._isDown=false;f=true}}if(f){g.preventDefault()}};e.prototype.onTouchMove=function(f){if(f.targetTouches.length==1){var g=f.targetTouches[0];this.isActive=true;this.playerPosition.x=(((g.pageX-this.canvas.offsetLeft)/this._gameDimension.width)*320)>>0;this.playerPosition.y=(((g.pageY-this.canvas.offsetTop)/this._gameDimension.height)*460)>>0;this.playerPosition.y-=60}f.preventDefault()};e.prototype.onTouchEnd=function(f){f.preventDefault();if(this.isPaused){this.isPaused=false;return}};e.prototype.onTouchStart=function(f){if(navigator.userAgent.match(/Android/i)){f.preventDefault()}if(this.isPaused){this.isPaused=false;return}this.onTouchMoveBind(f)};e.prototype.updateGameDimension=function(f){this._gameDimension=f};e.prototype.update=function(){if(this.playerPosition.x<10){this._velocity.x=0;this.playerPosition.x=10;return}if(this.playerPosition.x>310){this._velocity.x=0;this.playerPosition.x=310;return}if(this.playerPosition.y>450){this._velocity.y=0;this.playerPosition.y=450;return}if(this.playerPosition.y<10){this._velocity.y=0;this.playerPosition.y=10;return}if(this._isDown){this._velocity.y+=this._speed}else{if(this._isUp){this._velocity.y-=this._speed}else{this._velocity.y*=this._friction}}if(this._isLeft){this._velocity.x-=this._speed}else{if(this._isRight){this._velocity.x+=this._speed}else{this._velocity.x*=this._friction}}this.playerPosition.x+=this._velocity.x;this.playerPosition.y+=this._velocity.y;if(this._velocity.x>this._maxSpeed){this._velocity.x=this._maxSpeed}else{if(this._velocity.x<-this._maxSpeed){this._velocity.x=-this._maxSpeed}}if(this._velocity.y>this._maxSpeed){this._velocity.y=this._maxSpeed}else{if(this._velocity.y<-this._maxSpeed){this._velocity.y=-this._maxSpeed}}};e.prototype.dispose=function(){if(this.canvas){this.canvas.removeEventListener("touchmove",this.onTouchMoveBind,false);this.canvas.removeEventListener("touchend",this.onTouchEndBind,false);this.canvas.removeEventListener("touchstart",this.onTouchStartBind,false);this.canvas.removeEventListener("click",this.onStageClickBind,false)}document.removeEventListener("keydown",this.onKeyDownBind,false);document.removeEventListener("keyup",this.onKeyUpBind,false);window.removeEventListener("blur",this.onWindowBlurBind,false);this.canvas=null;this.playerPosition=null;this._velocity=null;this._gameDimension=null;this.onTouchMoveBind=null;this.onTouchStartBind=null;this.onTouchEndBind=null;this.onKeyDownBind=null;this.onKeyUpBind=null;this.onWindowBlurBind=null;this.onStageClickBind=null};return e})();d.InputControls=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){(function(h){var g=(function(){function i(j){this.context=j;this.explosionComplete=false;this._isStarted=false;this._pixelList=[];this._currentDistance=0}i.EXPLOSION_COUNT=8;i.EXPLOSION_DISTANCE=50;i.EXPLOSION_PIXEL_SIZE=6;i.prototype.start=function(l,j){this._isStarted=true;this._color=j;this._currentDistance=0;for(var k=0;k<i.EXPLOSION_COUNT;k++){var m=new a.goldenratio.geom.Rectangle(l.x,l.y,i.EXPLOSION_PIXEL_SIZE,i.EXPLOSION_PIXEL_SIZE);this._pixelList.push(m)}};i.prototype.update=function(){if(!this._isStarted){return}this.context.beginPath();var n=(360/i.EXPLOSION_COUNT)>>0;var o=0;for(var m=0;m<this._pixelList.length;m++){var j=o*Math.PI/180;var l=this._pixelList[m].x+Math.cos(j)*this._currentDistance;var k=this._pixelList[m].y+Math.sin(j)*this._currentDistance;this.context.rect(l,k,this._pixelList[m].width,this._pixelList[m].height);this.context.fillStyle=this._color;this.context.fill();o+=n}if(this._currentDistance>=i.EXPLOSION_DISTANCE){this.explosionComplete=true}else{this._currentDistance+=3}};i.prototype.dispose=function(){this.context=null;if(this._pixelList){this._pixelList.length=0;this._pixelList=null}};return i})();h.PixelExplosion=g})(f.explosion||(f.explosion={}));var e=f.explosion})(d.particle||(d.particle={}));var c=d.particle})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(h){this.context=h;this.radius=0;this.color="rgba(0, 0, 0, 1)";this.position=new a.goldenratio.geom.Point(0,0);this.isAlive=true;this.canRemove=false;this.canCollect=false;this._explosion=new f.explosion.PixelExplosion(h)}g.prototype.update=function(){if(this.canRemove){return}this.context.beginPath();var h;if(this.isAlive){h=this.context.createRadialGradient(this.position.x,this.position.y,0,this.position.x,this.position.y,this.radius);h.addColorStop(0,"rgba(255, 255, 255, 1)");h.addColorStop(0.4,"rgba(255, 255, 255, 1)");h.addColorStop(0.4,this.color);h.addColorStop(1,"rgba(0, 0, 0, 1)");this.context.fillStyle=h;this.context.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2,false);this.context.fill()}else{if(!this.canCollect){this._explosion.update()}}if(this._explosion.explosionComplete){this.canRemove=true}};g.prototype.die=function(){this.isAlive=false;this._explosion.start(this.position,this.color)};g.prototype.setPosition=function(h,i){this.position.x=h;this.position.y=i};g.prototype.getBounds=function(){return new a.goldenratio.geom.Rectangle(this.position.x-(this.radius>>1),this.position.y-(this.radius>>1),this.radius*2,this.radius*2)};g.prototype.dispose=function(){this.context=null;this.position=null;if(this._explosion){this._explosion.dispose();this._explosion=null}};return g})();f.BaseParticle=e})(d.particle||(d.particle={}));var c=d.particle})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var __extends=this.__extends||function(e,a){function c(){this.constructor=e}c.prototype=a.prototype;e.prototype=new c()};var com;(function(a){(function(d){(function(f){var e=(function(h){__extends(g,h);function g(i){h.call(this,i);this.context=i;this.speed=10;this.radius=12;this.color="rgba(0, 255, 0, 1)";this.position=new a.goldenratio.geom.Point(162,380)}g.prototype.setPosition=function(l,p){var o=Math.sqrt(Math.pow((l-this.position.x),2)+Math.pow((p-this.position.y),2));var n=this.position.x;var k=this.position.y;if(o>5){var j=this.position.y-p;var m=this.position.x-l;var i=Math.atan2(j,m)*180/Math.PI;n-=(Math.cos(i/180*Math.PI)*this.speed)>>0;k-=(Math.sin(i/180*Math.PI)*this.speed)>>0}else{n=l;k=p}h.prototype.setPosition.call(this,n,k)};g.prototype.dispose=function(){this.context=null;h.prototype.dispose.call(this)};return g})(f.BaseParticle);f.HeroParticle=e})(d.particle||(d.particle={}));var c=d.particle})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(h){__extends(g,h);function g(i){h.call(this,i);this.context=i;this.timeId=0;this.isSpawned=false;this.radius=12;this.color="rgba(255, 0, 0, 1)";this.position=new a.goldenratio.geom.Point(0,0)}g.prototype.setColor=function(i){this.color=i};g.prototype.dispose=function(){this.context=null;h.prototype.dispose.call(this)};return g})(f.BaseParticle);f.EnemyParticle=e})(d.particle||(d.particle={}));var c=d.particle})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(){}g.GREEN="rgb(0, 255, 0)";g.RED="rgb(255, 0, 0)";g.BLUE="rgb(0, 0, 255)";return g})();f.EnemyType=e})(d.enums||(d.enums={}));var c=d.enums})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){var c=(function(){function e(f,g){this.context=f;this.stageSize=g;this.killHero=false;this.heroHealth=100;this.score=0;this.waveComplete=false;this._spawnTimer=0;this._waveCount=0;this._enemySpeed=2;this._enemyList=[]}e.SPEED_SLOW=3;e.SPEED_MEDIUM=5;e.SPEED_HIGH=7;e.prototype.startNewWave=function(){this._spawnTimer=0;if(this._waveCount==8){d.Trace.log("Game Complete!");this.waveComplete=true;return}this._waveCount++;d.Trace.log("starting new wave! "+this._waveCount);if(this._waveCount==1||this._waveCount==2){this._enemySpeed=e.SPEED_SLOW}else{if(this._waveCount==3||this._waveCount==4){this._enemySpeed=e.SPEED_MEDIUM}else{if(this._waveCount==5||this._waveCount==6||this._waveCount==7||this._waveCount==8){this._enemySpeed=e.SPEED_HIGH}}}this.waveComplete=false;this.spawnEnemies()};e.prototype.spawnEnemies=function(){d.Trace.log("init enemies!");var g=d.utils.Device.isMobileOS()?50:100;var k=d.utils.Device.isMobileOS()?200:50;for(var j=0;j<g;j++){var f=new d.particle.EnemyParticle(this.context);f.setPosition(((Math.random()*(this.stageSize.width-40))>>0)+20,-20);var h=this.getEnemyColor();f.setColor(h);f.canCollect=h==d.enums.EnemyType.GREEN;f.timeId=(j*30)+((Math.random()*k)>>0);this._enemyList.push(f)}};e.prototype.getEnemyColor=function(){var f=(Math.random()*3)>>0;if(f==0){return d.enums.EnemyType.GREEN}else{if(f==1){return d.enums.EnemyType.BLUE}}return d.enums.EnemyType.RED};e.prototype.update=function(j){if(this.waveComplete){return}if(!this.killHero){this._spawnTimer++}for(var h=this._enemyList.length-1;h>=0;h--){if(this._spawnTimer==this._enemyList[h].timeId&&!this.killHero){this._enemyList[h].isSpawned=true}if(!this._enemyList[h].isSpawned&&this.killHero){this._enemyList[h].dispose();this._enemyList[h]=null;this._enemyList.splice(h,1);continue}if(this._enemyList[h].isSpawned){if(!this._enemyList[h].canRemove){var g=this._enemyList[h].position.x;var f=this._enemyList[h].position.y;if(f<(this.stageSize.height+20)){if(this._enemyList[h].isAlive){this._enemyList[h].setPosition(g,f+this._enemySpeed);if(j&&j.isIntersecting(this._enemyList[h].getBounds())&&!this.killHero){this._enemyList[h].die();if(!this._enemyList[h].canCollect){this.heroHealth-=10;if(this.heroHealth<=0){this.killHero=true}}else{this._enemyList[h].canRemove=true;this.score+=50}}}this._enemyList[h].update()}else{this._enemyList[h].canRemove=true}}else{this._enemyList[h].dispose();this._enemyList[h]=null;this._enemyList.splice(h,1)}}}if(this._enemyList.length==0&&!this.killHero){d.Trace.log("wave complete!");this.startNewWave()}};e.prototype.dispose=function(){for(var f=0;f<this._enemyList.length;f++){this._enemyList[f].dispose();this._enemyList[f]=null}this._enemyList.length=0;this._enemyList=null;this.context=null;this.stageSize=null};return e})();d.GameManager=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(h){this.context=h;this._prop=new a.goldenratio.geom.Rectangle(160,10,150,10)}g.prototype.update=function(h){this.context.beginPath();this.context.rect(this._prop.x,this._prop.y,this._prop.width,this._prop.height);this.context.fillStyle="rgba(0, 0, 0, 0)";this.context.fill();this.context.lineWidth=1;this.context.strokeStyle="rgba(255, 255, 255, 1)";this.context.stroke();var i=(h/100)*(this._prop.width-6);this.context.beginPath();this.context.rect(this._prop.x+3,this._prop.y+3,i,this._prop.height-6);this.context.fillStyle="rgba(255, 255, 255, 1)";this.context.fill()};g.prototype.dispose=function(){this.context=null;this._prop=null};return g})();f.HealthBar=e})(d.elements||(d.elements={}));var c=d.elements})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(h){this.context=h}g.prototype.update=function(h){var l=h.toString();this._position=new a.goldenratio.geom.Point(8,8);for(var j=0;j<l.length;j++){var k=this.getSourceRect(l.charAt(j));if(k){this.context.drawImage(d.Res.gfxSprite,k.x,k.y,k.width,k.height,this._position.x,this._position.y,k.width,k.height);this._position.x+=k.width+3}}};g.prototype.getSourceRect=function(h){if(h=="0"){return d.Res.data_0().sourceRect}else{if(h=="1"){return d.Res.data_1().sourceRect}else{if(h=="2"){return d.Res.data_2().sourceRect}else{if(h=="3"){return d.Res.data_3().sourceRect}else{if(h=="4"){return d.Res.data_4().sourceRect}else{if(h=="5"){return d.Res.data_5().sourceRect}else{if(h=="6"){return d.Res.data_6().sourceRect}else{if(h=="7"){return d.Res.data_7().sourceRect}else{if(h=="8"){return d.Res.data_8().sourceRect}else{if(h=="9"){return d.Res.data_9().sourceRect}}}}}}}}}}return null};g.prototype.dispose=function(){this.context=null;this._position=null};return g})();f.ScoreView=e})(d.elements||(d.elements={}));var c=d.elements})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){(function(f){var e=(function(){function g(i,h){this.context=i;this.canvas=h;this._positionGame=new a.goldenratio.geom.Point(-221,100);this._positionOver=new a.goldenratio.geom.Point(326,170);this._positionClick=new a.goldenratio.geom.Point(90,280);this._showClickText=false;this._clickCounter=0;this._youWin=false;this._minPositionFirstLineX=0;this._minPositionSecondLineX=0;this._minPositionGameX=50;this._minPositionOverX=65;this._minPositionYouX=70;this._minPositionWinX=75;this._clickListenerAdded=false;if(d.utils.Device.isTouchDevice()){this._clickSourceRect=d.Res.data_tap_to_continue().sourceRect;this._positionClick.x=100}else{this._clickSourceRect=d.Res.data_click_to_continue().sourceRect}this._minPositionFirstLineX=this._minPositionGameX;this._minPositionSecondLineX=this._minPositionOverX}g.prototype.addClickListener=function(){this._clickListenerAdded=true;this.onStageClickBind=this.onStageClickHL.bind(this);this.canvas.addEventListener("click",this.onStageClickBind,false)};g.prototype.onStageClickHL=function(i){i.preventDefault();var h=document.createEvent("Event");h.initEvent("showtitle",true,true);document.dispatchEvent(h)};g.prototype.youWin=function(h){if(this._youWin!=h){this._youWin=h;if(this._youWin){this._minPositionFirstLineX=this._minPositionYouX;this._minPositionSecondLineX=this._minPositionWinX}else{this._minPositionFirstLineX=this._minPositionGameX;this._minPositionSecondLineX=this._minPositionOverX}}};g.prototype.update=function(){if(this._positionGame.x<=this._minPositionFirstLineX){this._positionGame.x+=4}else{this._showClickText=true;if(!this._clickListenerAdded){this.addClickListener()}}if(this._positionOver.x>=this._minPositionSecondLineX){this._positionOver.x-=4}var h;if(!this._youWin){h=d.Res.data_game().sourceRect;this.context.drawImage(d.Res.gfxSprite,h.x,h.y,h.width,h.height,this._positionGame.x,this._positionGame.y,h.width,h.height);h=d.Res.data_over().sourceRect;this.context.drawImage(d.Res.gfxSprite,h.x,h.y,h.width,h.height,this._positionOver.x,this._positionOver.y,h.width,h.height)}else{h=d.Res.data_you().sourceRect;this.context.drawImage(d.Res.gfxSprite,h.x,h.y,h.width,h.height,this._positionGame.x,this._positionGame.y,h.width,h.height);h=d.Res.data_win().sourceRect;this.context.drawImage(d.Res.gfxSprite,h.x,h.y,h.width,h.height,this._positionOver.x,this._positionOver.y,h.width,h.height)}if(this._showClickText){if(this._clickCounter<=100){this.context.drawImage(d.Res.gfxSprite,this._clickSourceRect.x,this._clickSourceRect.y,this._clickSourceRect.width,this._clickSourceRect.height,this._positionClick.x,this._positionClick.y,this._clickSourceRect.width,this._clickSourceRect.height)}this._clickCounter+=1;if(this._clickCounter>=150){this._clickCounter=0}}};g.prototype.dispose=function(){if(this.canvas){this.canvas.removeEventListener("click",this.onStageClickBind,false)}this.canvas=null;this.context=null;this._positionGame=null;this._positionOver=null;this._positionClick=null;this._clickSourceRect=null;this.onStageClickBind=null};return g})();f.GameOverView=e})(d.elements||(d.elements={}));var c=d.elements})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){var c=(function(){function e(g,h,f,i){this._isRAF=false;this._pauseTextPosition=new d.geom.Point(90,200);this._canvas=g;this._context=h;this._stageProp=f;this._gameDimension=i;d.Trace.log(this._stageProp.toString());d.Trace.log(navigator.userAgent);if(window.requestAnimationFrame){d.Trace.log("using RAF");this._isRAF=true}this.bindHandlers();this.init();this.update()}e.prototype.init=function(){this._pauseSourceRect=d.utils.Device.isTouchDevice()?d.Res.data_tap_to_resume().sourceRect:d.Res.data_click_to_resume().sourceRect;this._inputControls=new d.InputControls(this._canvas);this._inputControls.updateGameDimension(this._gameDimension);this._gameBackground=new d.elements.GameBackground(this._context,this._stageProp);this._hero=new d.particle.HeroParticle(this._context);this._gameManager=new d.GameManager(this._context,this._stageProp);this._healthBar=new d.elements.HealthBar(this._context);this._score=new d.elements.ScoreView(this._context);this._gameOver=new d.elements.GameOverView(this._context,this._canvas)};e.prototype.bindHandlers=function(){this.updateBind=this.update.bind(this)};e.prototype.dispose=function(){this._isRAF?window.cancelAnimationFrame(this._frameRateID):window.clearTimeout(this._frameRateID);if(this._inputControls){this._inputControls.dispose();this._inputControls=null}if(this._gameBackground){this._gameBackground.dispose();this._gameBackground=null}if(this._healthBar){this._healthBar.dispose();this._healthBar=null}if(this._hero){this._hero.dispose();this._hero=null}if(this._gameManager){this._gameManager.dispose();this._gameManager=null}if(this._score){this._score.dispose();this._score=null}if(this._gameOver){this._gameOver.dispose();this._gameOver=null}this._pauseTextPosition=null;this._pauseSourceRect=null;this._context=null;this._canvas=null;this._stageProp=null;this._gameDimension=null;this.updateBind=null};e.prototype.updateGameDimension=function(f){if(this._inputControls){this._inputControls.updateGameDimension(f)}};e.prototype.update=function(){if(this._inputControls&&this._inputControls.isPaused){this._context.drawImage(d.Res.gfxSprite,this._pauseSourceRect.x,this._pauseSourceRect.y,this._pauseSourceRect.width,this._pauseSourceRect.height,this._pauseTextPosition.x,this._pauseTextPosition.y,this._pauseSourceRect.width,this._pauseSourceRect.height);this._frameRateID=this._isRAF?window.requestAnimationFrame(this.updateBind):window.setTimeout(this.updateBind,17);return}this._context.globalCompositeOperation="source-over";this._context.fillStyle="rgba(0, 0, 0, 0.4)";this._context.fillRect(0,0,this._stageProp.width,this._stageProp.height);this._context.globalCompositeOperation="lighter";if(this._inputControls){this._inputControls.update()}if(this._gameBackground){this._gameBackground.update()}if(this._hero){if(this._hero.isAlive&&this._inputControls){this._hero.setPosition(this._inputControls.playerPosition.x,this._inputControls.playerPosition.y)}this._hero.update();if(this._hero.canRemove){this._hero.dispose();this._hero=null;if(this._inputControls){this._inputControls.dispose();this._inputControls=null}}}if(this._gameManager){var f=null;if(this._hero){f=this._hero.getBounds()}this._gameManager.update(f);if(this._hero&&this._gameManager.killHero&&this._hero.isAlive){this._hero.die()}if(this._inputControls&&this._gameManager.waveComplete){this._inputControls.dispose();this._inputControls=null}}if(this._healthBar&&this._gameManager){this._healthBar.update(this._gameManager.heroHealth)}if(this._score){this._score.update(this._gameManager.score)}if((this._gameOver&&this._gameManager.killHero)||this._gameManager.waveComplete){this._gameOver.youWin(this._gameManager.waveComplete);this._gameOver.update()}this._frameRateID=this._isRAF?window.requestAnimationFrame(this.updateBind):window.setTimeout(this.updateBind,17)};return e})();d.GameMain=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));var com;(function(a){(function(d){var c=(function(){function e(){this._stageProp=new d.geom.Rectangle(0,0,320,460);this._gameDimension=new d.geom.Rectangle(0,0,320,460);this._canvas=document.getElementById("slate");this._context=this._canvas.getContext("2d");this.bindHandlers();this.setUpRequestAnimationFrame();this.initListeners();d.utils.Device.isTouchDevice()==false?this.setupResizeForDesktop():this.resizeGame();this.loadAssets()}e.GAME_BOUND_DESKTOP=new d.geom.Rectangle(0,0,400,575);e.prototype.bindHandlers=function(){this.resizeHandlerBind=this.onResizeWindow.bind(this);this.onGfxSpriteLoadedBind=this.onGfxSpriteLoadComplete.bind(this);this.onStartGameBind=this.onStartGameHandler.bind(this);this.onShowTitleBind=this.onShowTitleHandler.bind(this)};e.prototype.initListeners=function(){if(d.utils.Device.isTouchDevice()){d.Trace.log("touch device");window.addEventListener("resize",this.resizeHandlerBind,false);window.addEventListener("orientationchange",this.resizeHandlerBind,false)}document.addEventListener("startgame",this.onStartGameBind,false);document.addEventListener("showtitle",this.onShowTitleBind,false)};e.prototype.loadAssets=function(){d.Res.gfxSprite=new Image();d.Res.gfxSprite.addEventListener("load",this.onGfxSpriteLoadedBind,false);d.Res.gfxSprite.src="gfx_sheet.png"};e.prototype.onGfxSpriteLoadComplete=function(){d.Res.gfxSprite.removeEventListener("load",this.onGfxSpriteLoadedBind,false);this.launchTitle()};e.prototype.onStartGameHandler=function(f){this.disposeTitle();this.launchGame()};e.prototype.onShowTitleHandler=function(f){this.disposeGame();this.launchTitle()};e.prototype.launchGame=function(){if(this._game){return}this._game=new d.GameMain(this._canvas,this._context,this._stageProp,this._gameDimension)};e.prototype.disposeGame=function(){if(this._game){this._game.dispose();this._game=null}};e.prototype.launchTitle=function(){if(this._title){return}this._title=new d.TitleMain(this._canvas,this._context,this._stageProp)};e.prototype.disposeTitle=function(){if(this._title){this._title.dispose();this._title=null}};e.prototype.onResizeWindow=function(){this.resizeGame()};e.prototype.setupResizeForDesktop=function(){this._gameDimension=e.GAME_BOUND_DESKTOP;this.resizeGame(this._gameDimension.width,this._gameDimension.height);var f=document.getElementById("gameContainer");f.style.paddingTop="20px"};e.prototype.resizeGame=function(j,f){if(typeof j==="undefined"){j=null}if(typeof f==="undefined"){f=null}var h=window.innerWidth;if(j){h=j}var l=window.innerHeight;if(f){l=f}var m=this._stageProp.width/this._stageProp.height;var k=h/l;if(k>m){h=l*m;this._canvas.style.height=l+"px";this._canvas.style.width=h+"px"}else{l=h/m;this._canvas.style.height=l+"px";this._canvas.style.width=h+"px"}var g=document.getElementById("gameContainer");g.style.width=h+"px";g.style.height=l+"px";var i=(window.innerHeight-l)>>1;g.style.paddingTop=i+"px";this._gameDimension.width=h;this._gameDimension.height=l;if(this._game){this._game.updateGameDimension(this._gameDimension)}};e.prototype.setUpRequestAnimationFrame=function(){if("requestAnimationFrame" in window&&"cancelAnimationFrame" in window){d.Trace.log("requestAnimationFrame & cancelAnimationFrame already available! setup exit!");return}var g=["ms","moz","webkit","o"];for(var f=0;f<g.length&&!window.requestAnimationFrame;f++){window.requestAnimationFrame=window[g[f]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[g[f]+"CancelAnimationFrame"]||window[g[f]+"CancelRequestAnimationFrame"]}if(window.requestAnimationFrame){d.Trace.log("requestAnimationFrame setup success! using.. "+g[f])}};return e})();d.Main=c})(a.goldenratio||(a.goldenratio={}));var b=a.goldenratio})(com||(com={}));window.addEventListener("load",onLoad,false);function onLoad(a){new com.goldenratio.Main()};