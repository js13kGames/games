<title>Spiro - js13kGames 2012</title><meta name=viewport content="width=device-width,"><style>body{background-color:#222}#m{position:relative;border:2px solid #06276f;background-color:#2a4580;margin-left:auto;margin-right:auto;width:610px;height:610px;overflow:hidden}#c{z-index:10}#s{position:absolute;z-index:15;right:8px;top:8px;color:#4573d5;font:bold 150% Impact,Helvetica,sans-serif;text-shadow:0 1px 1px #06276f,0 -1px 1px #06276f}#u{position:absolute;left:50%;z-index:15;bottom:100px;color:#ffa900;font:bold 200% Verdana,Helvetica,sans-serif;text-shadow:0 2px 5px #06276f;opacity:0}#u div{position:relative;left:-50%;cursor:pointer;text-align:center}#u div:hover{color:#ffcf73;text-shadow:0 3px 5px #06276f}#i{position:absolute;width:500px;left:50%;z-index:15;bottom:120px;color:#4573d5;text-shadow:0 1px 1px #06276f,0 -1px 1px #06276f;font:bold 90% Verdana,Helvetica,sans-serif}#i p{position:relative;left:-50%;text-align:center;opacity:0}#i p b{color:#ffcf73}.center{position:absolute;left:50%;top:50%;z-index:15;color:#06276f;font:bold 250% Verdana,Helvetica,sans-serif;text-shadow:0 2px 1px #4573d5,0 -2px 1px #4573d5;font-variant:small-caps}.center div{display:none;position:relative;top:-50px;left:-50%}#mob{display:none}.touch #mob{display:block}.touch #dk,.touch #start{display:none}.touch #i{bottom:10px}#doub,#shield{position:relative;width:40px;height:40px;overflow:hidden;top:-10px;right:40px}#doub canvas,#shield canvas{position:absolute;display:inline;margin-left:-20px;margin-top:-20px}a,a:visited{text-decoration:none;color:#6c8dd5}a:hover{color:#ffcf73}</style><div id=m><div id=i><p>By <a href=http://dougmcinnes.com target=_blank>Doug McInnes</a><p id=dk>Use <b>← →</b> to move, <b>X</b> to fire and <b>SPACE</b> to release a Line Pulse<p id=mob>Press left side to move left, right side to move right and tap the top of the screen to release a Line Pulse<p>Line Pulse is refreshed after Advancing to the Next Level<p><span id=doub></span>gives Double Lasers<p><span id=shield></span>gives Shield</div><div id=u><div id=start>START</div></div><div class=center><div id=over>Game Over</div><div id=pause>Paused</div></div><canvas id=c width=610 height=610></canvas><div id=s></div><script>function at(){this.A=function(t){t=t.split(","),this.t=parseInt(t[0])||0,this.c=parseFloat(t[1])||0,this.a=parseFloat(t[2])||0,this.C=parseFloat(t[3])||0,this.e=parseFloat(t[4])||0,this.r=parseFloat(t[5])||0,this.l=parseFloat(t[6])||0,this.n=parseFloat(t[7])||0,this.j=parseFloat(t[8])||0,this.F=parseFloat(t[9])||0,this.s=parseFloat(t[10])||0,this.d=parseFloat(t[11])||0,this.i=parseFloat(t[12])||0,this.B=parseFloat(t[13])||0,this.u=parseFloat(t[14])||0,this.m=parseFloat(t[15])||0,this.g=parseFloat(t[16])||0,this.h=parseFloat(t[17])||0,this.f=parseFloat(t[18])||0,this.z=parseFloat(t[19])||0,this.p=parseFloat(t[20])||0,this.k=parseFloat(t[21])||0,this.w=parseFloat(t[22])||0,this.q=parseFloat(t[23])||0}}function e(){var n,O,h,o,r,l,c,i,d,u,Y,G,U,N,f,p,g,v,y,_,j,H,m,V,w,J,K,b,M,Q,x,F,S,T,Z,k,C,z,L,B,$,I,E,tt,W,et,P,A,it,D,R,X,st,q;this.o=new at,this.b,this.reset=function(t){var e=this.o;if(g=100/(e.r*e.r+.001),y=100/(e.l*e.l+.001),_=1-.01*e.n*e.n*e.n,j=1e-6*-e.j*e.j*e.j,0==e.t&&(M=.5-.5*e.B,Q=5e-5*-e.u),J=0<e.d?1-.9*e.d*e.d:1+10*e.d*e.d,K=0,b=1==e.i?0:2e4*(1-e.i)*(1-e.i)+32,t){for(e.G=!1,O=e.q*e.q,h=e.t,e.a<.01&&(e.a=.01),(t=e.c+e.a+e.e)<.18&&(e.c*=t=.18/t,e.a*=t,e.e*=t),N=e.C,f=0,H=e.l,L=1!=e.f||0!=e.k,I=B=0,E=.1*e.f*e.f*e.f,tt=1+1e-4*e.z,W=1-(.8<(W=5/(1+20*e.p*e.p)*(.01+E))?.8:W),et=1!=e.f,P=0,A=.1*e.k*e.k,it=1+3e-4*e.w,m=0,V=.01*e.s*e.s,w=.5*e.F,l=r=o=0,d=1e5*e.a*e.a,u=1e5*e.e*e.e+10,c=i=1e5*e.c*e.c,this.b=i+d+u,Y=1/i,G=1/d,U=1/u,S=0!=e.g||0!=e.h,T=1020*e.g*e.g,e.g<0&&(T=-T),Z=.2*e.h*e.h*e.h,C=0,z=z||Array(1024),D=D||Array(32),t=0;t<1024;t++)z[t]=0;for(t=0;t<32;t++)D[t]=2*Math.random()-1;F=(x=0)==e.m?0:parseInt(2e4*(1-e.m)*(1-e.m))+32}},this.D=function(t,e){n=!1;for(var i=q=st=0;i<e;i++){if(n)return i;if(0!=F&&++x>=F&&(x=0,this.reset(!1)),0!=b&&++K>=b&&(b=0,g*=J),(g*=_+=j)>y&&(g=y,0<H)&&(n=!0),v=g,0<w&&(m+=V,v=g*(1+Math.sin(m)*w)),(v=parseInt(v))<8&&(v=8),0==h&&((M+=Q)<0?M=0:.5<M&&(M=.5)),++l>c)switch(l=0,++r){case 1:c=d;break;case 2:c=u}switch(r){case 0:o=l*Y;break;case 1:o=1+2*(1-l*G)*N;break;case 2:o=1-l*U;break;case 3:n=!(o=0)}S&&(T+=Z,(k=parseInt(T))<0?k=-k:1023<k&&(k=1023)),L&&0!=it&&((A*=it)<1e-5?A=1e-5:.1<A&&(A=.1));for(var s=R=0;s<8;s++){if(++f>=v&&(f-=v,3==h))for(var a=0;a<32;a++)D[a]=2*Math.random()-1;switch(h){case 0:X=f/v<M?.5:-.5;break;case 1:X=1-f/v*2;break;case 2:X=(X=(p=.5<(p=f/v)?6.28318531*(p-1):6.28318531*p)<0?1.27323954*p+.405284735*p*p:1.27323954*p-.405284735*p*p)<0?.225*(X*-X-X)+X:.225*(X*X-X)+X;break;case 3:X=D[Math.abs(parseInt(32*f/parseInt(v)))]}L&&($=B,(E*=tt)<0?E=0:.1<E&&(E=.1),I=et?(I+(X-B)*E)*W:(B=X,0),P+=(B+=I)-$,X=P*=1-A),S&&(z[1023&C]=X,X+=z[C-k+1024&1023],C=C+1&1023),R+=X}1<(R*=.125*O*o)?R=1:R<-1&&(R=-1),q=(q+R)/++st,st=0,t[i]=parseInt(32e3*q),q=0}return e}}e.prototype.v=function(t){var e=new Uint8Array([82,73,70,70,0,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,2,0,16,0,100,97,116,97,0,0,0,0]),i=(this.o.A(t),this.reset(!0),this.b=parseInt(this.b),t=new Uint16Array(this.b),this.D(t,this.b)),s=2*i,a=new Uint32Array(e.buffer);return a[1]=36+s,a[10]=s,e=new Blob([e.buffer,t.subarray(0,i-1).buffer],{type:"audio/wav"}),(window.URL||window.webkitURL).createObjectURL(e)},(window.SfxrSynth=e).prototype.getWave=e.prototype.v;var t=7,i=(window.scrollTo(0,1),requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},timestamp=window.performance&&window.performance.webkitNow?function(){return performance.webkitNow()}:Date.now,"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);function D(){this[++this.current%this.length].play()}i&&(document.body.className="touch"),i&&window.innerHeight<600&&((i=document.querySelector('meta[name="viewport"]')).content=i.content.replace(/1/g,"0.45"));var R,X=new SfxrSynth,y={shoot:"1,,0.14,,0.25,0.9927,0.6662,-0.2093,,,,,,0.715,-0.5504,,,,1,,,0.2751,,0.5",pickup:"1,,0.0454,,0.4952,0.35,,0.1773,,,,,,,,,,,1,,,,,0.5",splode1:"3,,0.2792,0.2599,0.28,0.0464,,0.26,,,,,,,,,0.4555,-0.055,1,,,,,0.5",splode2:"1,,0.1926,,0.066,0.6888,0.0064,-0.36,,,,,,0.3733,0.0696,,,,1,,,,,0.5",shieldHit:"0,,0.13,,0.2599,0.4721,,0.4366,,,,,,0.3465,,0.7747,,,1,,,,,0.5",newPickup:"1,,0.143,,0.3098,0.4283,,0.2087,,0.5804,0.45,,,,,,,,1,,,,,0.5",pulse:"0,0.08,0.44,0.0793,0.2657,0.5097,0.2913,-0.1914,0.0154,0.0193,0.0164,-0.0147,0.0216,0.7922,-0.2077,0.0809,-0.1022,0.0799,1,-0.0031,,0.0954,0.075,0.5",eggDrop:"0,,0.0809,,0.2607,0.651,,-0.3547,,,,,,0.568,,0.7,,,1,,,0.0417,,0.5",seeker:"1,0.64,0.12,,0.27,0.79,,0.3032,,,,,,,,0.765,,,1,,,,,0.5",levelIn:"0,0.61,0.51,,0.84,0.37,,0.3523,,,,,,0.2821,,0.2,,,1,,,,,0.5",levelOut:"0,0.61,0.51,,0.84,0.18,,0.3523,,,,,,0.2821,,0.35,,,1,,,,,0.5"};try{for(R in y){var q=X.getWave(y[R]),O=[];O.current=0,O.play=D;for(var s=0;s<3;s++){var Y=new Audio;Y.src=q,O[s]=Y}y[R]=O}}catch(S){function G(){}for(R in y)y[R]={play:G}}function a(t){for(var e in rt)rt.hasOwnProperty(e)&&!t.prototype[e]&&(t.prototype[e]=rt[e])}function n(){this.x=Math.floor(600*Math.random())-o,this.y=Math.floor(600*Math.random())-o,this.scale=0,this.dir=l/2,this.rot=0,this.collidable=!1,y.seeker.play()}var m,w,b,U,h,l=Math.PI,M=2*l,o=300,N=document.getElementById("c"),r=N.getContext("2d"),_=360,j=M/_,H=!0,x=null,c=null,F=0,V=timestamp(),J=0,e=0,d=0,u=0,K=1,Q=0,Z=document.getElementById("s"),$=document.getElementById("u"),tt=document.getElementById("i"),et=document.getElementById("over"),it=document.getElementById("pause"),st=0,nt=2,ht=0,ot=document.createElement("canvas"),rt=(ot.width=N.width,ot.height=N.height,r.translate(305,305),r.lineWidth=2,{collidable:!0,prevSprite:null,nextSprite:null,outside:function(){return this.x>o||this.x<-o||this.y>o||this.y<-o},updateSpriteCartesian:function(){void 0!==this.angle&&(this.x=Math.cos(d+this.angle)*this.dist,this.y=Math.sin(d+this.angle)*this.dist)},add:function(){this.alive=!0,this.link()},remove:function(){this.alive=!1,this.derezz()},link:function(){this.prevSprite=null,this.nextSprite=null,x?(x.nextSprite=this).prevSprite=x:c=this,x=this},unlink:function(){this.prevSprite?this.prevSprite.nextSprite=this.nextSprite:c=this.nextSprite,this.nextSprite?this.nextSprite.prevSprite=this.prevSprite:x=this.prevSprite},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},collide:function(t){},derezz:function(t){}}),f=function(t){this.group=t,this.ani=0,this.dist=0,this.scale=.1,this.collidable=!1},p=(f.prototype={tick:function(t){this.ani+=t/100,this.ani%=5;var e=this.group.dir*t/1e4;this.scale<1?this.scale+=t/3e3:1<this.scale&&(this.scale=1,this.collidable=!0),this.angle=W(this.angle+e),this.dist=m.f(this.angle),this.segment=bt(this.angle),this.rot=this.segment.tangent,this.updateSpriteCartesian()},render:function(t){t.translate(this.x,this.y),t.rotate(d+this.rot),t.scale(this.scale,this.scale),t.beginPath(),t.strokeStyle=this.scale<1?"#2A4580":"#06276F",t.lineWidth=3/this.scale,t.moveTo(-10+this.ani,0),t.lineTo(0,-8-this.ani),t.lineTo(10-this.ani,0),t.lineTo(0,8+this.ani),t.closePath(),t.stroke()},collide:function(t){y.splode2.play(),Ct(1===t.type?25:50),this.remove(),new L(5,this).add()},derezz:function(){0==--this.group.count&&(w--,Tt())},halfWidth:5,type:8,collidesWith:t},a(f),n.prototype={tick:function(t){var e,i;this.scale<1?this.scale+=t/1500:1<this.scale?(this.scale=1,this.collidable=!0):(e=t/100,i=wt(Math.atan2(b.y-this.y,b.x-this.x)-this.dir),this.dir+=i<0?-e:e,this.dir=W(this.dir),this.x+=Math.cos(this.dir)*t/10,this.y+=Math.sin(this.dir)*t/10),this.rot-=t/100,this.rot=W(this.rot)},render:function(t){t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.rotate(this.rot),t.globalAlpha=this.scale,t.drawImage(n.canvas,-25,-25)},collide:function(t){y.splode2.play(),Ct(1===t.type?250:500),this.remove(),new L(5,this).add()},derezz:function(){w--,Tt()},halfWidth:20,type:16,collidesWith:t},a(n),(n.canvas=document.createElement("canvas")).width=50,n.canvas.height=50,n.canvas.getContext("2d"));p.translate(25,25),p.lineWidth=2,p.beginPath(),p.moveTo(0,0);for(var lt=0;lt<3*M;){var ct=4*Math.pow(lt,.5);p.lineTo(Math.cos(lt)*ct,Math.sin(lt)*ct),lt+=j}function g(t){this.ani=0,this.dist=0,this.scale=0,this.dir=1,this.size=t||3,this.egg=!1,this.collidable=!1}function v(){this.ani=0,this.spawnTimeout=0,this.setPosition()}function S(){this.angle=0,this.rot=0,this.x=0,this.y=0,this.flash=0,this.newGuyTimeout=S.newGuyTimeoutMax,this.collidable=!1,this.upgrades={},this.hitTimeout=0}p.strokeStyle="#06276F",p.stroke(),g.range=Math.pow(400,2),g.eggDirections=[-l/4,-3*l/4,l/4,3*l/4],g.prototype={tick:function(t){var e,i,s;this.egg&&(this.x*this.x+this.y*this.y>g.range&&0<=this.x*this.velX+this.y*this.velY&&(this.velX=-this.x/Math.abs(this.x),this.velY=-this.y/Math.abs(this.y)),this.scale=this.size/3,this.x+=this.velX*t,this.y+=this.velY*t,this.hatchTime-=t,this.angle=Math.atan2(this.y,this.x)-d,this.dist=m.f(this.angle),e=Math.sqrt(this.x*this.x+this.y*this.y),this.hatchTime<0&&Math.abs(e-this.dist)<2*this.halfWidth&&(this.egg=!1,y.eggDrop.play()),s=this.angle,e>this.dist&&(s+=l),e=t/500,i=Math.atan2(this.velY,this.velX),i+=wt(s-i)<0?-e:e,this.velX=Math.cos(i)*t/50,this.velY=Math.sin(i)*t/50),this.egg||(this.ani+=t/200,this.ani%=M,this.angleVel=this.dir/5,s=.2+.8*this.size/3,this.scale<s?this.scale+=t/1e3:this.scale>s&&(this.scale=s,this.collidable=!0),this.angle=W(this.angle+this.angleVel*(t/1e3)),this.dist=m.f(this.angle),this.segment=bt(this.angle),this.rot=this.segment.tangent,this.updateSpriteCartesian(),this.index=Mt(this.angle))},render:function(t){t.strokeStyle="#06276F",t.fillStyle="#06276F",t.translate(this.x,this.y),t.rotate(d+this.rot),t.scale(this.scale,this.scale),this.egg||(this.renderLeg(t,1,1,0),this.renderLeg(t,-1,1,l),this.renderLeg(t,1,-1,3*l/2),this.renderLeg(t,-1,-1,l/2)),t.beginPath(),t.arc(0,0,10,0,M),t.closePath(),t.fill()},renderLeg:function(t,e,i,s){t.save();for(var a=30+10*Math.sin(this.ani+s),n=0,h=this.index;n<a;)(h=(h+i)%_)<0&&(h=359),n+=m.segments[h].length;a=n,s=h*j;var o=m.f(s),r=Math.cos(d+s)*o;s=Math.sin(d+s)*o,o=Math.atan2(s-this.y,r-this.x),s=a/2,r=Math.sqrt(900-s*s),-1===i&&(o+=l),t.rotate(o-this.rot-d),t.beginPath(),t.moveTo(0,0),t.lineTo(i*s,r*e),t.lineTo(i*a,0),t.stroke(),t.restore()},collide:function(t){y.splode2.play();var e=this.egg?4-this.size:this.size,i=this.size-1;if(Ct((1===t.type?50:100)*e),this.remove(),!this.egg&&0<i)for(var s,a,n=this.segment.tangent,h=Math.floor(4*Math.random()),o=0;o<m.eggCount+ht;o++)s=new g(i),a=n+g.eggDirections[(h+o)%4],s.egg=!0,s.hatchTime=500,s.x=this.x,s.y=this.y,s.scale=1,s.velX=Math.cos(a)/20,s.velY=Math.sin(a)/20,s.add(),w++;else new L(5,this).add()},derezz:function(){w--,Tt()},halfWidth:10,type:32,collidesWith:t},a(g),v.range=Math.pow(500,2),v.prototype={setPosition:function(){this.rot=Math.random()*M,this.x=500*Math.cos(this.rot),this.y=500*Math.sin(this.rot),this.curve=Math.random()<.5?1:-1,this.rot=this.rot-l-this.curve/3},tick:function(t){this.ani+=t/500,this.ani%=M,this.push=(1+Math.sin(2*this.ani))/2,this.rot+=this.curve*t/12e3;var e=this.push+.4;this.velX=Math.cos(this.rot)*e/20,this.velY=Math.sin(this.rot)*e/20,this.x+=this.velX*t,this.y+=this.velY*t,this.spawnTimeout<0?(this.angle=Math.atan2(this.y,this.x)-d,this.dist=m.f(this.angle),e=Math.sqrt(this.x*this.x+this.y*this.y),Math.abs(e-this.dist)<1&&(this.spawn(),this.spawnTimeout=1e3)):this.spawnTimeout-=t,this.x*this.x+this.y*this.y>v.range&&0<=this.x*this.velX+this.y*this.velY&&this.setPosition()},render:function(t){t.translate(this.x,this.y),t.rotate(this.rot+l/2);for(var e=0;e<4;e++){var i=Math.cos(this.ani+e);t.save(),t.translate(7*e-10,0),t.lineWidth=3,t.lineCap="round",t.strokeStyle="#06276F",t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(-10*i,20,20*i,40,0,30+20*this.push),t.stroke(),t.restore()}t.scale(1-this.push/10,.5+this.push/6),t.drawImage(v.body,-20,-40)},collide:function(t){y.splode2.play(),Ct(1===t.type?250:500),this.remove(),new L(5,this).add()},derezz:function(){w--,Tt()},spawn:function(){w++;var t=xt(this.angle,1);new L(5,t,!0,!0,"#06276F").add()},halfWidth:20,type:64,collidesWith:t},a(v),i=document.createElement("canvas"),(v.body=i).width=40,i.height=60,(i=i.getContext("2d")).fillStyle="#06276F",i.beginPath(),i.arc(20,20,15,0,M),i.fillRect(5,20,30,30),i.closePath(),i.fill(),S.newGuyTimeoutMax=4e3,S.prototype={tick:function(t){this.dist=m.f(this.angle),this.angle=d,this.segment=bt(this.angle),this.rot=this.segment.tangent,this.updateSpriteCartesian(),0<this.flash&&(this.flash-=t),0<this.newGuyTimeout&&(this.newGuyTimeout-=t,this.newGuyTimeout<=0)&&(this.collidable=!0),0<this.hitTimeout&&(this.hitTimeout-=t,this.hitTimeout<=0)&&(this.collidable=!0),0<this.newShieldTimeout&&(this.newShieldTimeout-=t,this.newShieldTimeout<0)&&(this.newShieldTimeout=0)},render:function(t){var e,i,s=1;this.collidable||(e=this.newGuyTimeout/S.newGuyTimeoutMax,s=(1+Math.cos(80*e*Math.sin(e)))/2),t.globalAlpha=s,t.translate(this.x,this.y),t.rotate(d+this.rot),t.drawImage(S.canvas,-15,-10),this.upgrades.shield&&0<this.upgrades.shieldStrength?(e=this.upgrades.shieldStrength+2,i=1+this.newShieldTimeout/300,t.globalAlpha=s<1?s:1<i?(s=1.5-i)<0?0:s:this.upgrades.shieldStrength/3,t.save(),t.scale(i,i),t.beginPath(),t.arc(0,0,20,0,M),t.lineWidth=e,t.strokeStyle="#A66E00",t.stroke(),t.lineWidth=1,t.strokeStyle="#FFBE40",t.stroke(),(0<this.flash||1<i)&&(t.lineWidth=e,t.globalCompositeOperation="lighter",t.globalAlpha=this.flash/800,t.stroke()),t.restore()):0<this.flash&&(1<i&&(foo=0),t.globalCompositeOperation="lighter",t.globalAlpha=this.flash/800,t.drawImage(S.canvas,-15,-10))},collide:function(t){56&t.type&&(0<this.upgrades.shieldStrength?(y.shieldHit.play(),this.upgrades.shieldStrength--,0<this.upgrades.shieldStrength?this.flash=800:new L(5,this).add(),this.hitTimeout=300,this.collidable=!1):(y.splode1.play(),this.flash=800,new L(10,this).add(),this.remove()))},fire:function(){k.freeBolts.length&&y.shoot.play(),this.upgrades.doubleGuns?(b.fireLaser(3,1),b.fireLaser(3,2),b.fireLaser(4,1),b.fireLaser(4,2)):(b.fireLaser(3),b.fireLaser(4))},fireLaser:function(t,e){var i,s;k.freeBolts.length&&(i=k.freeBolts.pop(),s=this.rot+d,i.x=this.x,i.y=this.y,s-=3===t?l/2:3*l/2,1===e?(i.x+=10*Math.sin(s),i.y-=10*Math.cos(s)):2===e&&(i.x-=10*Math.sin(s),i.y+=10*Math.cos(s)),i.rot=this.rot+d,i.velX=3*Math.cos(s),i.velY=3*Math.sin(s),i.add())},shield:function(){this.upgrades.shield=!0,this.upgrades.shieldStrength=3,this.newShieldTimeout=200},doubleGuns:function(){this.upgrades.doubleGuns=!0},halfWidth:10,type:1,collidesWith:56},a(S);var dt=[-15,0,-10,-8,-5,-8,-2,-10,-2,-8,2,-8,2,-10,5,-8,10,-8,15,0,10,8,5,8,2,10,2,8,-2,8,-2,10,-5,8,-10,8,-15,0],T=((t=document.createElement("canvas")).width=30,t.height=20,(S.canvas=t).getContext("2d"));T.translate(15,10),T.beginPath(),T.moveTo(dt[0],dt[1]);for(var ut=1;ut<dt.length;ut++)T.lineTo(dt[2*ut],dt[2*ut+1]);T.closePath(),T.fillStyle="#A66E00",T.fill(),T.strokeStyle="#FFA900",T.stroke(),T.fillStyle="#FFCF73",T.fillRect(-10,-7,20,14),T.fillStyle="#FFBE40",T.fillRect(-10,-5,20,10),T.fillStyle="#FFCF73",T.fillRect(-10,-3,20,6);var k=function(){this.rot=0};for(k.size=160,k.BOLT_FIRE_TIMEOUT=150,k.currentBoltFireTimeout=0,k.freeBolts=[],k.prototype={tick:function(t){this.x+=this.velX*t,this.y+=this.velY*t,this.outside()&&this.remove()},render:function(t){t.translate(this.x,this.y),t.rotate(this.rot),t.drawImage(k.canvas,-5,-k.size/2)},derezz:function(){k.freeBolts.push(this)},collide:function(t){this.remove()},halfWidth:20,type:2,collidesWith:56},a(k),k.canvas=document.createElement("canvas"),k.canvas.width=10,k.canvas.height=k.size,(i=k.canvas.getContext("2d")).lineWidth=2,i.lineCap="round",i.beginPath(),i.moveTo(5,5),i.lineTo(5,k.size-5),i.closePath(),i.shadowBlur="10",i.shadowColor="#FFCF73",i.strokeStyle="#6C8DD5",i.stroke(),s=0;s<6;s++)k.freeBolts.push(new k);function C(){this.angle=Math.floor(Math.random()*M),this.segment=bt(this.angle),this.life=C.maxLife,this.flavor=Math.random()<.5?"shield":"doubleGuns",y.newPickup.play()}function z(t,e){this.angle=t,this.dir=e,this.life=z.MAX_LIFE}z.MAX_LIFE=1e3,z.prototype={tick:function(t){this.life-=t,this.life<=0&&this.remove();var e=this.life/z.MAX_LIFE;this.angleVel=6*this.dir*(1-e),this.angle=W(this.angle+this.angleVel*t/1e3),this.dist=m.f(this.angle),this.segment=bt(this.angle),this.updateSpriteCartesian()},render:function(t){t.translate(this.x,this.y),t.drawImage(z.canvas,-40,-40)},derezz:function(){new L(3,this).add()},halfWidth:5,type:4,collidesWidth:56},a(z),t=document.createElement("canvas"),(z.canvas=t).width=80,t.height=80,(t=t.getContext("2d")).beginPath(),t.fillStyle="#FFBE40",t.shadowColor="#FFCF73",t.shadowBlur="30",t.arc(40,40,10,0,M),t.closePath(),t.fill();var L=function(t,e,i,s,a,n){this.x=e.x,this.y=e.y,this.origin=e,this.life=0,this.reverse=i,this.follow=s,this.color=a||"#FFCF73",this.callback=n,this.particleDirections=[];for(var h=0;h<t;h++){var o=Math.random()*M;this.particleDirections.push(Math.cos(o),Math.sin(o))}};function ft(t){t.beginPath(),t.fillStyle="#FFBE40",t.shadowColor="#FFCF73",t.shadowBlur="30",t.arc(40,40,10,0,M),t.fill()}L.prototype={tick:function(t){this.life+=t,500<this.life&&(this.remove(),this.callback)&&this.callback(),this.follow&&(this.x=this.origin.x,this.y=this.origin.y)},render:function(t){var e=this.reverse?(500-this.life)/8:this.life/8,i=this.particleDirections.length;t.translate(this.x,this.y),t.fillStyle=this.color;for(var s=0;s<i;s+=2){var a=this.particleDirections[s],n=this.particleDirections[s+1];t.fillRect(a*e,n*e,2,2)}}},a(L),C.maxLife=12e3,C.prototype={tick:function(t){this.dist=m.f(this.angle),this.updateSpriteCartesian(),this.life-=t,this.life<0?this.remove():b.alive&&this.distance(b)<this.halfWidth+b.halfWidth&&this.collide()},render:function(t){t.translate(this.x,this.y);var e=this.life/C.maxLife,i=(3+Math.sin(M*e*10))/2;e<.25&&(t.globalAlpha=(1+Math.cos(M*e*30))/2),t.scale(i,i),t.drawImage(C[this.flavor],-40,-40)},collide:function(t){y.pickup.play(),this.remove(),b[this.flavor]()},derezz:function(){w--},halfWidth:5},a(C),can=document.createElement("canvas"),(C.doubleGuns=can).width=80,can.height=80,ft(con=can.getContext("2d")),con.scale(.6,.4),con.drawImage(k.canvas,56.5,80,10,40),con.drawImage(k.canvas,66.5,80,10,40),document.getElementById("doub").appendChild(can),can=document.createElement("canvas"),(C.shield=can).width=80,can.height=80,ft(con=can.getContext("2d")),con.beginPath(),con.arc(40,40,6,0,M),con.shadowBlur="10",con.shadowColor="#06276F",con.strokeStyle="#06276F",con.stroke(),document.getElementById("shield").appendChild(can);var pt={13:"enter",32:"space",37:"left",38:"up",39:"right",40:"down",88:"x"},B={};function gt(t){U=window.innerWidth/2,window.scrollTo(0,1)}function vt(t){t.preventDefault(),"touchend"!==t.type&&(B.left=!1,B.right=!1,B.x=!1,B.space=!1);for(var e="touchend"===t.type?t.changedTouches:t.touches,i=0;i<e.length;i++){var s="touchend"!==t.type;e[i].pageX<U?B.left=s:B.right=s,B.x=s,"touchstart"===t.type&&e[i].pageY<100&&(B.space=!0)}B.left&&B.right&&(B.left=!1,B.right=!1)}function yt(t,e){var i=-t.velY,s=t.velX,a=e.x*i+e.y*s,n=(e.x-t.x)*t.velX+(e.y-t.y)*t.velY;return Math.abs(t.x*i+t.y*s-a)<t.halfWidth+e.halfWidth&&Math.abs(n)<k.size}function I(){var t=Mt(d),t=.16/(m.segments?m.segments[t].length:1);e+=J,Math.abs(e)>t&&(e=t*Math.abs(e)/e),d=W(d+=e),J=0,e*=.99}function mt(t,e,i,s){t.save();var a=F/2,n=(t.scale(a,a),t.lineWidth=3/a,t.rotate(s),0);for(t.beginPath(),t.moveTo(e(0,i),0);n<M;){var h=e(n,i);t.lineTo(Math.cos(n)*h,Math.sin(n)*h),n+=j}t.strokeStyle="#FFBE40",t.shadowColor="#FFCF73",t.shadowBlur="30",t.stroke(),t.restore()}function E(t,e,i){2===F?(h||((h=ot.getContext("2d")).clearRect(0,0,610,610),h.save(),h.translate(305,305),mt(h,t,e,0),h.restore()),r.save(),r.rotate(i),r.drawImage(ot,-305,-305),r.restore()):(h=null,mt(r,t,e,i))}function W(t){return(t%=M)<0&&(t+=M),t}function wt(t){return(t%=M)<-l?t+=M:l<t&&(t-=M),t}function bt(t){return t=Mt(t),m.segments[t]}function Mt(t){return Math.floor(_*W(t)/M)}function xt(t,e){for(var i,s={dir:.5<Math.random()?1:-1,count:e},a=0;a<e;a++)(i=new f(s)).angle=t+a/20,i.ani=a,i.add();return i}function Ft(t){B.left&&(J=-t/1e4),B.right&&(J=t/1e4),B.space&&0<K--&&(y.pulse.play(),new z(b.angle,1).add(),new z(b.angle,-1).add()),B.x&&(k.currentBoltFireTimeout-=t,k.currentBoltFireTimeout<0)&&(k.currentBoltFireTimeout=k.BOLT_FIRE_TIMEOUT,b.fire())}function St(t){for(var e=c;e;)e.alive&&(e.tick(2===F?t:0),r.save(),e.render(r),r.restore(),function(t){if(t.alive)for(var e=c;e;){if(e.type&t.collidesWith&&e.collidable&&t.collidable&&e.alive&&t.alive&&(2===e.type?yt(e,t):2===t.type?yt(t,e):e.distance(t)<e.halfWidth+t.halfWidth)&&(e.collide(t),t.collide(e),!t.alive))return;e=e.nextSprite}}(e)),e=e.nextSprite;for(e=c;e;)e.alive||e.unlink(),e=e.nextSprite}function Tt(){var t,e;m.nextBaddie<m.baddies.length&&(e=m.baddies[m.nextBaddie],!1!==(t=function(){for(var t,e=Math.round(m.totalLength/20),i=[],s=c;s;)void 0!==s.angle&&(t=m.segments[Mt(s.angle)].position,i[Math.floor(t/e)]=!0),s=s.nextSprite;for(var a=Math.floor(20*Math.random()),n=0;i[a]&&n<20;)a=(a+7)%20,n++;if(20<n)return!1;for(var h=0,o=(a+.5)*e;0<o;)o-=m.segments[h].length,h++;return M*h/_}()))&&(e===f?xt(t,m.badaSize):((e=new e).add(),e.angle=t),m.nextBaddie++,w++)}function kt(t){y.levelIn.play();for(var e=x;e;)e.unlink(),e=x;var i=b&&b.upgrades;if(b=new S,i&&(b.upgrades=i),b.add(),(currentLevelNumber=void 0===t?currentLevelNumber+1:t)>=Lt.length&&(currentLevelNumber=0,ht++),(m=Lt[currentLevelNumber]).nextBaddie=0,w=0,F=2,!(i=m).segments){for(var s,a,n,h,o,r=[],l=i.f,c=0,d=0,u=l(0,2),f=Math.cos(0)*u,p=Math.sin(0)*u,g=j;g<=M;)u=l(g,2),h=(a=Math.cos(g)*u)-f,o=(n=Math.sin(g)*u)-p,s=Math.sqrt(h*h+o*o),r[d]={length:s,position:c,tangent:Math.atan2(o,h)},c+=s,f=a,p=n,d++,g+=j;i.totalLength=c,i.segments=r}for(var v=0;v<m.spawnStart;v++)Tt();F=0}function Ct(t){Q+=t,Z.innerHTML=Q}function zt(){if(0<nt){r.save(),r.translate(o,270),r.rotate(l/2);for(var t=0;t<nt;t++)r.drawImage(S.canvas,0,0),r.translate(0,3*b.halfWidth);r.restore()}0<K&&(r.save(),r.translate(-320,230),r.drawImage(z.canvas,0,0),r.drawImage(z.canvas,10,0),r.drawImage(z.canvas,5,10),r.restore())}window.addEventListener("keydown",function(t){B[pt[t.keyCode]]=!0,80!==t.keyCode&&27!==t.keyCode||A!==P.waitToBegin&&((H=!H)&&Bt(),it.style.display=H?"none":"block")},!1),window.addEventListener("keyup",function(t){B[pt[t.keyCode]]=!1},!1),gt(),window.addEventListener("touchstart",vt),window.addEventListener("touchmove",vt),window.addEventListener("touchend",vt),window.addEventListener("orientationchange",gt),document.getElementById("start").addEventListener("click",function(t){A=P.begin});var Lt=[{f:function(t){return o*Math.cos(Math.sin(t*F))-20},spawnStart:3,badaSize:2,eggCount:1,baddies:[g,f,f,C,f,f]},{f:function(t){return o*Math.cos(Math.sin(2*t*F))-20},spawnStart:3,badaSize:3,eggCount:1,baddies:[v,g,f,C,f,f]},{f:function(t){return Math.sin(t*F)*o},spawnStart:3,badaSize:3,eggCount:1,baddies:[v,g,f,C,f,f]},{f:function(t){return F*o/3.4*(1+Math.sin(t))-100},spawnStart:2,badaSize:3,eggCount:1,baddies:[n,g,g,f,C,f,f]},{f:function(t){return(Math.cos(t/F)-Math.sin(t))*o},spawnStart:6,badaSize:3,eggCount:1,baddies:[v,v,v,v,v,v,C,v,v,v,v]},{f:function(t){return F*o/4.2*(1+Math.cos(t))},spawnStart:3,badaSize:3,eggCount:2,baddies:[v,g,f,f,C,f,f,n]},{f:function(t){return o*Math.sin(t+t*F)},spawnStart:3,badaSize:2,eggCount:2,baddies:[n,n,n,n,n,n,n,n]},{f:function(t){return Math.sin(2*t+t*F)*o},spawnStart:3,badaSize:4,eggCount:2,baddies:[v,g,f,f,f,C,f]},{f:function(t){return o*Math.cos(3*Math.sin(t*F))},spawnStart:3,badaSize:3,eggCount:2,baddies:[v,g,f,f,C,f,f]},{f:function(t){return o*Math.cos(Math.sin(t/F))-20},spawnStart:4,badaSize:4,eggCount:2,baddies:[v,g,f,C,f,f,f,n,f,n]},{f:function(t){return o*Math.cos(2*Math.sin(t*F))},spawnStart:4,badaSize:3,eggCount:2,baddies:[v,v,g,f,f,C,f,f,n,n]}],P={waitToBegin:function(t){var e,i,s;$.style.display="block",e=t,s=!(tt.style.display="block"),st<-60?.01<(i=Math.cos(-(st+60)*l/120))?(st-=i*e/10,$.style.opacity=1-i,$.style.bottom=60*(1-i)):s=!0:st-=e/10,r.save(),r.translate(10,st),r.strokeStyle="#FFA900",r.shadowOffsetX=4,r.shadowOffsetY=2,r.shadowColor="#BF8F30",r.lineJoin="round",r.translate(-140,-100),r.scale(2,2),r.beginPath(),r.moveTo(24,0),r.bezierCurveTo(-40,0,70,100,0,100),r.stroke(),r.translate(34,0),r.beginPath(),r.moveTo(0,100),r.lineTo(0,0),r.bezierCurveTo(30,0,30,50,0,50),r.stroke(),r.translate(32,0),r.beginPath(),r.moveTo(0,0),r.lineTo(0,100),r.stroke(),r.translate(12,0),r.beginPath(),r.moveTo(0,100),r.lineTo(0,0),r.bezierCurveTo(30,0,30,50,0,50),r.lineTo(20,100),r.stroke(),r.translate(30,0),r.beginPath(),r.moveTo(10,0),r.bezierCurveTo(-4,0,-4,100,10,100),r.bezierCurveTo(24,100,24,0,10,0),r.stroke(),r.restore(),s&&function(t){for(var e=tt.children,i=0,s=0;s<e.length;s++){var a=e[s],n=parseFloat(a.style.opacity,10)||0;if((i+=n)<s+1)return a.style.opacity=n+t/1e3}}(t),(B.space||B.x||B.enter)&&(A=P.begin)},begin:function(){nt=2,ht=Q=0,$.style.display="none",tt.style.display="none",F=0,b=null,Z.innerHTML=Q,Z.style.display="block",kt(0),A=P.startLevel},startLevel:function(t){F<2?F+=t/800:(F=2,K=1,A=P.runLevel),I(),E(m.f,F,d),zt()},runLevel:function(t){0===w&&(u=1500,A=P.runOutLevel),b.alive||(A=P.guyDie),Ft(t),I(),E(m.f,F,d),St(t),zt()},runOutLevel:function(t){0<u?(u-=t,Ft(t),I(),E(m.f,F,d),St(t),zt()):(A=P.finishLevel,y.levelOut.play())},finishLevel:function(t){F<4?F+=t/800:(kt(),A=P.startLevel),I(),E(m.f,F,d),zt()},guyDie:function(t){A=0<nt?(u=3e3,P.waitToRestart):(u=6e3,et.style.opacity=0,et.style.display="block",P.gameOver)},waitToRestart:function(t){0<u?u-=t:(nt--,(b=new S).tick(t),b.add(),A=P.runLevel),I(),E(m.f,F,d),St(t),zt()},gameOver:function(t){0<u?u-=t:(et.style.display="none",A=P.waitToBegin),I(),E(m.f,F,d),St(t),t=6e3-u,et.style.opacity=(t=1e3<t?1e3:t)/1e3}},A=P.waitToBegin;function Bt(){var t=timestamp(),e=t-V;V=t,100<e&&(e=100),r.clearRect(-305,-305,610,610),A(e),H&&requestAnimFrame(Bt,N)}Bt()</script>