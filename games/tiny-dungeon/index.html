<!doctype html><meta content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no" name=viewport><title>Tiny Dungeon</title><style>body,html{background-color:#333;color:#fff;font-family:helvetica,arial,sans-serif;margin:0;padding:0;font-size:12pt}#c,.social{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background:#000}.social{width:320px;height:480px;display:none;background:0 0}a{position:absolute;display:block;height:60px;text-indent:-9999px}a.tweet{top:236px;left:8px;width:148px}a.share{top:236px;left:164px;width:148px}a.again{top:304px;left:8px;width:304px}</style><canvas height=480 id=c width=320></canvas><div class=social><a class=tweet href=# target=_blank>Tweet</a> <a class=share href=# target=_blank>Share</a> <a class=again href=#>Play Again</a></div><script>!function(){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var t=t||function(){var t=[];return{REVISION:"14",getAll:function(){return t},removeAll:function(){t=[]},add:function(i){t.push(i)},remove:function(i){-1!==(i=t.indexOf(i))&&t.splice(i,1)},update:function(i){if(0===t.length)return!1;var e=0;for(i=void 0!==i?i:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e<t.length;)t[e].update(i)?e++:t.splice(e,1);return!0}}}();t.Tween=function(i){var e,n={},s={},h={},a=1e3,r=0,o=!1,u=!1,l=0,c=null,f=t.Easing.Linear.None,p=t.Interpolation.Linear,d=[],m=null,g=!1,y=null,w=null,x=null;for(e in i)n[e]=parseFloat(i[e],10);this.to=function(t,i){return void 0!==i&&(a=i),s=t,this},this.start=function(e){for(var a in t.add(this),u=!0,g=!1,c=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),c+=l,s){if(s[a]instanceof Array){if(0===s[a].length)continue;s[a]=[i[a]].concat(s[a])}n[a]=i[a],0==n[a]instanceof Array&&(n[a]*=1),h[a]=n[a]||0}return this},this.stop=function(){return u?(t.remove(this),u=!1,null!==x&&x.call(i),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,i=d.length;t<i;t++)d[t].stop()},this.delay=function(t){return l=t,this},this.repeat=function(t){return r=t,this},this.yoyo=function(t){return o=t,this},this.easing=function(t){return f=t,this},this.interpolation=function(t){return p=t,this},this.chain=function(){return d=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return w=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){var e;if(t<c)return!0;!1===g&&(null!==m&&m.call(i),g=!0);var u,x=f(u=1<(u=(t-c)/a)?1:u);for(e in s){var v=n[e]||0,T=s[e];T instanceof Array?i[e]=p(T,x):("string"==typeof T&&(T=v+parseFloat(T,10)),"number"==typeof T&&(i[e]=v+(T-v)*x))}if(null!==y&&y.call(i,x),1==u){if(0<r){for(e in isFinite(r)&&r--,h)"string"==typeof s[e]&&(h[e]+=parseFloat(s[e],10)),o&&(u=h[e],h[e]=s[e],s[e]=u),n[e]=h[e];return c=t+l,!0}for(null!==w&&w.call(i),e=0,u=d.length;e<u;e++)d[e].start(t);return!1}return!0}},t.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4))},Out:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin(2*(t-i)*Math.PI/.4)+1)},InOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),1>(t*=2)?-.5*e*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4):e*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4)*.5+1)}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){return 1>(t*=2)?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)}},Bounce:{In:function(i){return 1-t.Easing.Bounce.Out(1-i)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(i){return.5>i?.5*t.Easing.Bounce.In(2*i):.5*t.Easing.Bounce.Out(2*i-1)+.5}}},t.Interpolation={Linear:function(i,e){var n=i.length-1,s=n*e,h=Math.floor(s),a=t.Interpolation.Utils.Linear;return 0>e?a(i[0],i[1],s):1<e?a(i[n],i[n-1],n-s):a(i[h],i[h+1>n?n:h+1],s-h)},Bezier:function(i,e){var n,s=0,h=i.length-1,a=Math.pow,r=t.Interpolation.Utils.Bernstein;for(n=0;n<=h;n++)s+=a(1-e,h-n)*a(e,n)*i[n]*r(h,n);return s},CatmullRom:function(i,e){var n=i.length-1,s=n*e,h=Math.floor(s),a=t.Interpolation.Utils.CatmullRom;return i[0]===i[n]?(0>e&&(h=Math.floor(s=n*(1+e))),a(i[(h-1+n)%n],i[h],i[(h+1)%n],i[(h+2)%n],s-h)):0>e?i[0]-(a(i[0],i[0],i[1],i[1],-s)-i[0]):1<e?i[n]-(a(i[n],i[n],i[n-1],i[n-1],s-n)-i[n]):a(i[h?h-1:0],i[h],i[n<h+1?n:h+1],i[n<h+2?n:h+2],s-h)},Utils:{Linear:function(t,i,e){return(i-t)*e+t},Bernstein:function(i,e){var n=t.Interpolation.Utils.Factorial;return n(i)/n(e)/n(i-e)},Factorial:function(){var t=[1];return function(i){var e,n=1;if(t[i])return t[i];for(e=i;1<e;e--)n*=e;return t[i]=n}}(),CatmullRom:function(t,i,e,n,s){var h=s*s;return(2*i-2*e+(t=.5*(e-t))+(n=.5*(n-i)))*s*h+(-3*i+3*e-2*t-n)*h+t*s+i}}};var i,e,n,s,h,a,r,o,u,l,c,f,p,d,m,g,y="font t_earth t_water t_air t_fire p_mage p_staff e_lasher e_imp e_frostgiant bg".split(" "),w="title",x=null,v=!1,T=document.querySelector("#c"),I=T.getContext("2d");i=function(){var t=y,i=t.length,n={},s=0;return{lImg:function(t){return img=new Image,img.src="img/"+t+".png",img.onload=function(){s++,i===s&&(y=n,e=!0)},img},lImgs:function(e){for(e=0;e<i;e++)n[t[e]]=this.lImg(t[e])},lAssets:function(){var t,i;this.lImgs(),t=function(){e?(i=new CustomEvent("imgsL"),document.dispatchEvent(i)):setTimeout(t,100)},setTimeout(t,100)},r:function(t,i){return Math.random()*(i-t+1)|0+t}}}(),n=function(){var t=document.createElement("canvas").getContext("2d"),i=[];return{init:function(){var e,n,s,h=(e=y.font).width,a=e.height,r=0;for(t.canvas.width=h,t.canvas.height=a,t.drawImage(e,0,0,h,a),s=t.getImageData(0,0,h,a).data,e=0;e<s.length;e+=4)n=e/4%h|0,(e/4/h|0)===a-1&&!s[e+3]&&(i.push({x:r,y:0,w:n-r,h:a-2}),r=n+1,e+=4)},getData:function(e){var n,s=e.length,h=[];for(n=0;n<s;n++)h.push(i[e.charCodeAt(n)-32]);return{buffer:t.canvas,word:h}}}}(),s={init:function(){I.imageSmoothingEnabled=!1,I.oImageSmoothingEnabled=!1,I.mozImageSmoothingEnabled=!1,I.webkitImageSmoothingEnabled=!1,I.globalCompositeOperation="source-over"},drawText:function(t){var i=n.getData(t.text),e=0;i.word.forEach((function(n,s){I.drawImage(i.buffer,n.x,n.y,n.w,n.h,t.x+e,t.y,n.w,n.h),e+=n.w}))},fillRect:function(t){I.fillStyle=t.c,I.fillRect(t.x,t.y,t.w,t.h)}},h=function(){function e(t){this.type=n.r(0,3),this.colour=h[this.type],this.spell=s[this.type],this.image=y["t_"+this.spell],this.size=12,this.spacing=1,t&&(this.x=t.x,this.y=t.y,this.sP={x:t.x*(this.size+this.spacing),y:t.y*(this.size+this.spacing)},this.newPos={},t.sY&&this.nP({x:t.x,y:t.y,sY:t.sY}))}var n=i,s=["earth","water","air","fire"],h=["green","blue","magenta","red"],a=(I.globalCompositeOperation="screen","screen"===I.globalCompositeOperation);return e.prototype.update=function(t){},e.prototype.render=function(){this.selected?a?(I.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),I.globalCompositeOperation="screen",I.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),I.globalCompositeOperation="source-over"):I.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size):a?I.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size):(I.globalAlpha=.75,I.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),I.globalAlpha=1)},e.prototype.nP=function(i){this.x=i.x,this.y=i.y,i.sY&&(this.sP.y+=i.sY*(this.size+this.spacing)),this.newPos={x:i.x*(this.size+this.spacing),y:i.y*(this.size+this.spacing)},new t.Tween(this.sP).to(this.newPos,100).start()},e}(),a=function(){var t=new h,i=t.size+t.spacing,e=[];return{x:2,y:53,size:5,numTiles:0,isAnimated:!1,animatedTiles:[],create:function(){var t,i,e=[];for(t=0;t<this.size;t++)for(e[t]=[],i=0;i<this.size;i++)e[t][i]=new h({x:t,y:i}),this.numTiles+=1;return e},cTA:function(t){e[t.x][t.y]=new h(t),this.numTiles+=1},gTAC:function(t){return this.cellInBounds(t)?e[t.x][t.y]:null},gTASP:function(t){return t.x=(t.x-T.offsetLeft)/4,t.y=(t.y-T.offsetTop)/4,this.posInBounds(t)?(t.x-=this.x,t.x/=i,t.y-=this.y,t.y/=i,this.gTAC({x:0|t.x,y:0|t.y})):null},moveTileTo:function(t,i){e[t.x][t.y]=null,e[i.x][i.y]=t,t.nP(i)},removeTileAt:function(t){e[t.x][t.y]=null,this.numTiles-=1},cellInBounds:function(t){return 0<=t.x&&t.x<this.size&&0<=t.y&&t.y<this.size},posInBounds:function(t){return t.x>=this.x&&t.x<this.x+this.size*i&&t.y>=this.y&&t.y<this.y+this.size*i},validMove:function(t,i){return(i.x===t.x-1||i.x===t.x+1)&&i.y===t.y||(i.y===t.y-1||i.y===t.y+1)&&i.x===t.x},gFP:function(t){var i;do{t={x:(i=t).x,y:i.y+1}}while(this.cellInBounds(t)&&!this.gTAC(t));return i},rMT:function(){var t,i,e,n,s,h=[];for(t=0;t<this.size;t++)for(h[t]=0,i=this.size-1;0<=i;i--)e={x:t,y:i},(n=this.gTAC(e))?(s=this.gFP(e),this.moveTileTo(n,s)):h[t]+=1;for(t=0;t<this.size;t++)for(i=0;i<this.size;i++)e={x:t,y:i},(n=this.gTAC(e))||this.cTA({x:t,y:i,sY:-h[t]})},init:function(){e=this.create()},update:function(t){var i;for(t=0;t<this.size;t++)for(i=0;i<this.size;i++)e[t][i]instanceof h&&e[t][i].update()},render:function(){var t,n;for(I.save(),I.scale(4,4),I.translate(this.x,this.y),I.beginPath(),I.rect(0,0,this.size*i,this.size*i),I.clip(),I.closePath(),t=0;t<this.size;t++)for(n=0;n<this.size;n++)e[t][n]instanceof h&&e[t][n].render();I.restore()}}}(),r=function(){function t(){this.x=68,this.y=53,this.size={x:10,y:64},this.mT=60,this.sT=null,this.time=0,this.tick=this.size.y/this.mT}return t.prototype.init=function(){this.sT=+new Date},t.prototype.update=function(t){this.sT&&(this.time+=t),this.tP&&this.time>this.tP.end&&(this.tP=null)},t.prototype.render=function(){I.save(),I.scale(4,4),I.translate(this.x,this.y),s.fillRect({c:"#ccc",x:0,y:0,w:this.size.x,h:this.size.y}),s.fillRect({c:"black",x:1,y:1,w:this.size.x-2,h:this.size.y-2}),this.tP&&(s.fillRect({c:"#267AF6",x:1,y:1+(this.tP.from+this.tP.to|0)*this.tick,w:this.size.x-2,h:this.size.y-2-(0|this.time)*this.tick}),s.fillRect({c:"red",x:1,y:1+(0|this.tP.from)*this.tick,w:this.size.x-2,h:(0|this.tP.to)*this.tick})),s.fillRect({c:"#267AF6",x:1,y:1+(0|this.time)*this.tick,w:this.size.x-2,h:this.size.y-2-(0|this.time)*this.tick}),I.restore()},t.prototype.add=function(t,i){0<this.time-t?this.time-=t:this.time=0,i("+"+t+" SECS")},t.prototype.remove=function(t,i){this.tP={from:this.time+t+.8,to:t,end:this.time},this.time+=t,i("-"+t+" SECS")},t.prototype.pause=function(t){(this.paused=t)?this.pausedAt=+new Date:this.sT+=+new Date-this.pausedAt},t}(),o=function(){function t(){this.level=0,this.highestCrit={amount:0,e:""},this.mostDamageTaken={amount:0,e:""},this.totalTimeSurvived=this.totalEnemiesKilled=this.damageTakenOverall=this.longestSpellChain=0}return t.prototype.update=function(t,i){this.hasOwnProperty(t)&&("number"==typeof i&&i>this[t]||"object"==typeof i&&i.amount>this[t].amount)&&(this[t]=i)},t}(),u=function(){function e(){this.step=.25,this.stepTimer=0,this.mage=y.p_mage,this.mx=38,this.my=11,this.mw=this.mage.width,this.mh=this.mage.height,this.staff=y.p_staff,this.sx=44,this.sy=16,this.sw=this.staff.width,this.sh=this.staff.height,this.rotate=0,this.stats=new n,this.level=1}var n=o,s=i.r;return e.prototype.update=function(t){this.stepTimer+=t,(this.stepTimer>=2*this.step||v)&&(this.stepTimer=0)},e.prototype.render=function(){v?0!==this.rotate?(I.save(),I.translate(0,this.h),I.rotate(this.rotate*Math.PI/180),I.drawImage(this.staff,this.sx+this.rotate,this.sy-this.rotate+(this.stepTimer>=this.step?1:0),this.sw,this.sh),I.restore()):I.drawImage(this.staff,this.sx,this.sy+(this.stepTimer>=this.step?1:0),this.sw,this.sh):I.drawImage(this.mage,this.mx,this.my+(this.stepTimer>=this.step?1:0),this.mw,this.mh)},e.prototype.hit=function(t){var i=s(0,100)<t.critChance?1:.5;return{crit:1<=i,damage:i*t.strength|0}},e.prototype.cast=function(){var i=this,e=new t.Tween({r:0}).to({r:-10},200).easing(t.Easing.Quintic.In).onUpdate((function(){i.rotate=this.r})),n=new t.Tween({r:-10}).to({r:0},500).easing(t.Easing.Quadratic.Out).onUpdate((function(){i.rotate=this.r}));e.chain(n).start()},e}(),l=function(){function i(i){var e=this;this.x=i.x,this.y=i.y,this.dY=6*i.dY,this.alpha=1,this.text=i.text,this.lifeSpan=1.2,this.dead=!1,new t.Tween({y:this.y,alpha:this.alpha}).to({y:this.y+this.dY,alpha:0},1e3*e.lifeSpan).easing(t.Easing.Exponential.In).onUpdate((function(){e.y=this.y,e.alpha=this.alpha})).onComplete((function(){e.dead=!0})).start()}return i.prototype.render=function(){I.globalAlpha=this.alpha,s.drawText({text:this.text,x:this.x,y:this.y}),I.globalAlpha=1},i}(),c=function(){function t(t){this.y=this.x=0,this.z=e(300,450),this.fov=60,this.step=.25,this.stepTimer=0,this.type=e(0,n.length-1),this.name=n[this.type].name,this.spell=n[this.type].spell,this.weakTo=n[this.type].weakTo,this.level=t.level,this.health=this.baseHealth=10+4*this.level,this.strength=2*this.level,this.critChance=this.level+10,this.image=y["e_"+this.name],this.w=this.image.width,this.h=this.image.height,this.dead=!1}var e=i.r,n=[{name:"lasher",spell:"earth",weakTo:"air"},{name:"imp",spell:"fire",weakTo:"water"},{name:"frostgiant",spell:"water",weakTo:"fire"}];return t.prototype.drawHealthMeter=function(){I.fillStyle="white",I.fillRect(2,2,20,4),I.fillStyle="black",I.fillRect(3,3,18,2),I.fillStyle="red",I.fillRect(3,3,this.health/this.baseHealth*18,2)},t.prototype.hit=function(t,i){var e,n=1,s=" HP";t.spell===this.spell?(n=0,s=" HP *IMMUNE*"):t.spell===this.weakTo&&(n=2,s=" HP *CRIT!*"),e=n*t.strength,this.health-=e,i(2===n,e,"-"+e+s)},t.prototype.update=function(t,i){this.stepTimer+=i,this.stepTimer>this.step&&(this.z-=t*i,this.stepTimer=0),this.attacking?(this.attackFor-=i,0>this.attackFor&&(this.attacking=!1)):this.lAt+=i,0>=this.health&&(this.dead=!0)},t.prototype.render=function(t,i){var e=this.fov/(this.fov+this.z),n=this.x*e+t/2,s=this.y*e+i/2;200<this.z||this.dead||(I.globalAlpha=1-this.z/200,I.drawImage(this.image,n-this.w*e/2,s-(this.attacking?2:0)-this.h*e/2,this.w*e,this.h*e),I.globalAlpha=1,v&&(this.drawHealthMeter(),I.fillStyle="white",I.fillRect(t/2-15,i-9,30,7),I.fillStyle="black",I.fillRect(t/2-14,i-8,28,5)))},t}(),f=function(t){var e=i.r;return{x:2,y:3,w:76,h:48,stats:null,p:null,e:null,texts:[],init:function(){this.pos=0,this.vel=1e3,this.p=this.stats=null,this.sP(),this.e=null,this.sE(),this.bg=y.bg},sP:function(){this.p=new u},sE:function(){var t=new c({level:this.p.level});if(this.e&&this.e.type===t.type)return this.sE();this.e=t},hP:function(){var t=this,i=this.p.hit({strength:this.e.strength,critChance:this.e.critChance});x.remove(i.damage,(function(e){i.crit&&t.texts.push(new l({x:118,y:78,dY:1,text:"*CRIT!*"})),t.texts.push(new l({x:118,y:88,dY:1,text:e})),t.p.stats.update("mostDamageTaken",{amount:i.damage,e:t.e.name}),t.p.stats.update("damageTakenOverall",t.p.stats.damageTakenOverall+i.damage)})),this.e.lAt=0,this.e.attacking=!0,this.e.attackFor=.5},hE:function(t,i,n){var s=this;this.e.hit({spell:i.spell,strength:n},(function(t,i,n){s.texts.push(new l({x:9,y:20,dY:1,text:n})),t?(s.p.stats.update("highestCrit",{amount:i,e:s.e.name}),s.hP()):e(0,2)||s.hP()}))},castSpell:function(t){this.p.cast(),this.p.stats.update("longestSpellChain",t)},gainTime:function(t){var i=this;x.add(t,(function(t){i.texts.push(new l({x:118,y:88,dY:1,text:t}))}))},update:function(t){this.checkTimer()||(this.vel=v?0:1e3,this.pos+=this.vel,this.p.update(t),5>this.e.z&&(v=!0),this.e.dead?(this.sE(),this.p.level+=1.4,this.p.stats.update("totalEnemiesKilled",this.p.stats.totalEnemiesKilled+1),v=!1):(v&&8<this.e.lAt&&this.hP(),this.e.update(this.vel,t)))},render:function(){var t;for(I.save(),I.scale(4,4),I.translate(this.x,this.y),s.fillRect({c:"gray",x:0,y:0,w:this.w,h:this.h}),I.beginPath(),I.rect(1,1,this.w-2,this.h-2),I.clip(),I.closePath(),I.drawImage(this.bg,0,0),this.e.render(this.w,this.h),this.p.render(),I.restore(),I.save(),I.scale(2,2),t=0;t<this.texts.length;t++)this.texts[t].render();v&&s.drawText({text:this.e.name.toUpperCase(),x:2*(this.x+this.w/2)-this.e.name.length/2*4.3,y:2*(this.y+this.h-7)}),I.restore()},checkTimer:function(){if(x.time>=x.mT)return this.p.stats.update("totalTimeSurvived",(+new Date-x.sT)/1e3|0),this.stats=this.p.stats,event=new CustomEvent("gameEnd"),t.dispatchEvent(event),this.p=null,!0}}}(document),p=function(){var t="ontouchstart"in window;return{title:function(){I.save(),I.scale(4,4),s.drawText({text:"Tiny Dungeon",x:13.5,y:42}),s.drawText({text:(t?"Tap":"Click")+" To Start",x:t?14:12.5,y:66}),I.restore()},game:function(){f.render(),a.render(),x.render()},social:function(){var t=f.stats;I.save(),I.scale(4,4),s.drawText({text:"You survived",x:13.5,y:12}),s.drawText({text:"for "+t.totalTimeSurvived+" seconds",x:12-2*(""+t.totalTimeSurvived).length,y:22}),s.drawText({text:"in the",x:28,y:32}),s.drawText({text:"Tiny Dungeon",x:13.5,y:42}),I.fillStyle="#00B0ED",I.fillRect(2,59,37,15),s.drawText({text:"Tweet",x:8.5,y:64}),I.fillStyle="#3B5998",I.fillRect(41,59,37,15),s.drawText({text:"Share",x:48,y:64}),I.fillStyle="green",I.fillRect(2,76,76,15),s.drawText({text:"Play Again",x:18,y:81}),s.drawText({text:" Enemies killed: "+t.totalEnemiesKilled+" Longest spell chain: "+t.longestSpellChain+" Highest critical strike: "+t.highestCrit.amount+" on "+t.highestCrit.e+" Most damage taken: "+t.mostDamageTaken.amount+" from "+t.mostDamageTaken.e+" Damage taken overall: "+t.damageTakenOverall,x:80-this.statsX,y:103}),this.statsX+=.3,800<this.statsX&&(this.statsX=0),I.restore()},statsX:0}}(),d=function(){function t(){this.frame=this.frame.bind(this),this.lastTime=0,this.cb=function(){},this.start=function(t){this.cb=t,requestAnimationFrame(this.frame)}}return t.prototype.frame=function(t){var i=(t-this.lastTime)/1e3;this.lastTime=t,.2>i&&this.cb(i),requestAnimationFrame(this.frame)},new t}(),m=function(i,e){return{currentTile:{},chain:[],first:function(t){(t=a.gTASP(t))&&((t=a.gTAC(t))&&(t.selected=!0,this.chain.push(t),this.currentTile=t))},next:function(t){var i,e,n=a.gTASP(t);n&&((n=a.gTAC(n))&&n!==this.currentTile&&n.type===this.currentTile.type&&a.validMove(this.currentTile,n)&&(i=this.chain.filter((function(t){return n===t})),i.length&&(e=this.chain.indexOf(i[0]),(i=this.chain.splice(e,this.chain.length-e)).forEach((function(t){t.selected=!1}))),n.selected=!0,this.chain.push(n),this.currentTile=n))},last:function(){1<this.chain.length?(this.chain.forEach((function(t){a.removeTileAt({x:t.x,y:t.y})})),f.castSpell(this.chain.length),v?f.hE({x:a.x,y:a.y},this.currentTile,this.chain.length):f.gainTime(this.chain.length/2),a.rMT()):this.chain[0]&&(this.chain[0].selected=!1),this.chain=[]},init:function(){var t;n.init(),s.init(),t=new CustomEvent("gameReady"),e.dispatchEvent(t)},ready:function(){d.start((function(i){I.clearRect(0,0,320,480),f.p&&(f.update(i),a.update(i),x.update(i),t.update()),p[w]()}))},start:function(){w="game",document.querySelector(".social").style.display="none",(x=new r).init(),v=!1,a.init(),f.init()},pause:function(t){"game"===w&&x.pause(t)},end:function(){var t="I survived for "+f.stats.totalTimeSurvived+" seconds in the Tiny Dungeon https://js13kgames.com/games/tiny-dungeon/";w="social",p.statsX=0,document.querySelector(".tweet").href="https://twitter.com/intent/tweet?text="+encodeURIComponent(t)+"&hashtags=js13k",document.querySelector(".share").href="http://www.facebook.com/sharer.php?s=100&p[title]=Tiny+Dungeon+js13k+Game&p[url]="+encodeURIComponent("https://js13kgames.com/games/tiny-dungeon/")+"&p[summary]="+encodeURIComponent(t+" #js13k"),document.querySelector(".social").style.display="block"}}}(window,document),g=function(t,i){var e={},n={init:function(){this.bind("start",m.start),this.bind("pause",m.pause),this.bind("first",m.first),this.bind("next",m.next),this.bind("last",m.last)},bind:function(t,i){e[t]||(e[t]=[]),e[t].push(i)},trigger:function(t,i){var n,s,h=e[t],a=Array.prototype.slice.call(arguments,1);if(h)for(n=h.length,s=0;s<n;s++)h[s].apply(m,a)}};return n.init(),n}(),function(t,e){function n(t,i){var e,n;if(h&&t.touches){if(t.touches.length>i)return;e=t[i?"touches":"changedTouches"][0].clientX,n=t[i?"touches":"changedTouches"][0].clientY}else e=t.clientX,n=t.clientY;return{x:e,y:n}}var s=!1,h="ontouchstart"in window,a={init:function(){var t=this;this.bind(e,"DOMContentLoaded",i.lAssets.call(i)),this.bind(e,"imgsL",m.init),this.bind(e,"gameReady",m.ready),this.bind(e,"gameEnd",m.end),this.bind(e,"mousedown touchstart",(function(t){var i=n(t,1);"title"===w?g.trigger("start"):"game"===w&&(g.trigger("first",{x:i.x,y:i.y}),s=!0,t.preventDefault())})),this.bind(e,"mousemove touchmove",(function(t){var i=n(t,1);"game"===w&&(s&&g.trigger("next",{x:i.x,y:i.y}),t.preventDefault())})),this.bind(e,"mouseup touchend",(function(t){var i=n(t,0);"game"===w&&(g.trigger("last",{x:i.x,y:i.y}),s=!1,t.preventDefault())})),this.bind(document.querySelector(".again"),"mousedown touchstart",(function(t){g.trigger("start"),t.preventDefault()})),["webkit","moz","ms",""].forEach((function(i,n){i+"Hidden"in e&&t.bind(e,i+"visibilitychange",(function(t){g.trigger("pause",!!e[i+"Hidden"])}))}))},bind:function(t,i,e){"string"==typeof t&&(t=document.querySelector(t)),(i=0<=i.indexOf(" ")?i.split(" "):[i]).forEach((function(i){t.addEventListener(i,e,!1)}))}};a.init()}(window,document)}()</script>