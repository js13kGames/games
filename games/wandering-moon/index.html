<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script><title>Wandering Moon</title><script>AFRAME.registerComponent("orbit",{schema:{ir:{type:"number"},or:{type:"number"}},multiple:!0,init:function(){this.orbiting=!1;let a=this.el,b=[];for(let c=0;3>c;c++)b[c]=document.createElement("a-ring"),b[c].setAttribute("radius-outer",this.data.or),b[c].setAttribute("radius-inner",this.data.ir),b[c].setAttribute("color","white"),b[c].setAttribute("opacity","0.1"),b[c].setAttribute("material","side:double"),b[c].addEventListener("mouseenter",this.mouseEnter),b[c].addEventListener("mouseleave",this.mouseExit),b[c].setAttribute("class","orbit"),a.appendChild(b[c]);if(b[0].setAttribute("rotation","0 0 0"),b[1].setAttribute("rotation","0 90 90"),b[2].setAttribute("rotation","90 90 0"),this.orbits=b,"destination"===a.getAttribute("id"))a.setAttribute("color","#26871f");else{let b=["red","brown","orange"];a.setAttribute("color",b[Math.floor(Math.random()*b.length)])}},enterOrbit:function(){this.orbiting=!0;for(let a=0;3>a;a++)this.el.removeChild(this.orbits[a])},exitOrbit:function(){this.orbiting=!1;for(let a=0;3>a;a++)this.orbits[a].setAttribute("material","side:double"),this.el.appendChild(this.orbits[a])},mouseEnter:(a)=>{a.target.setAttribute("opacity","0.5")},mouseExit:(a)=>{a.target.setAttribute("opacity","0.1")}}),AFRAME.registerComponent("moon",{init:function(){var a=Math.atan2;this.d=2*Math.PI/500,this.t=0,this.state=0,this.time=0,this.movement={},this.r="000",this.orbiting=document.querySelector("#initial").components.orbit,this.orbiting.enterOrbit(),this.oldOrbit=null,this.o=this.orbiting.el.getAttribute("position"),this.o.h=100;let b=this.o.x+this.o.h;this.el.setAttribute("position",{x:b,y:this.o.y,z:this.o.z}),this.el.setAttribute("camera",""),this.el.setAttribute("look-controls","");let c=document.createElement("a-entity");c.setAttribute("click-everywhere",""),c.setAttribute("cursor","fuse:false;downEvents:gp-down;upEvents:gp-up"),c.setAttribute("raycaster","far: 1500"),c.setAttribute("position","0 0 -1"),c.setAttribute("geometry","primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"),c.setAttribute("material","color: white; shader: flat"),this.el.appendChild(c),this.planes={"000":(a,b,c)=>{let d=this.computeLoc(b-this.o.x,c-this.o.y);a.setAttribute("position",{x:d.x+this.o.x,y:d.y+this.o.y,z:this.o.z})},"09090":(a,b,c,d)=>{let e=this.computeLoc(c-this.o.y,d-this.o.z);a.setAttribute("position",{x:this.o.x,y:e.x+this.o.y,z:e.y+this.o.z})},90900:(a,b,c,d)=>{let e=this.computeLoc(b-this.o.x,d-this.o.z);a.setAttribute("position",{x:e.x+this.o.x,y:this.o.y,z:e.y+this.o.z})}},this.el.querySelector("a-entity[cursor]").addEventListener("click",(b)=>{if(console.log("hey"),"orbit"===b.detail.intersectedEl.getAttribute("class")&&0===this.state&&!b.detail.intersectedEl.parentEl.components.orbit.orbiting){let c=b.detail.intersection,d=this.el.getAttribute("position"),e=c.distance,f={};f.t=e/10,f.x=(c.point.x-d.x)/f.t,f.y=(c.point.y-d.y)/f.t,f.z=(c.point.z-d.z)/f.t,f.dest=c.point,this.movement=f;let g=b.detail.intersectedEl.getAttribute("rotation");switch(this.r=""+g.x+g.y+g.z,this.oldOrbit=this.orbiting,this.orbiting=b.detail.intersectedEl.parentEl.components.orbit,this.o=b.detail.intersectedEl.parentEl.getAttribute("position"),this.orbiting.enterOrbit(),this.r){case"000":this.o.h=this.dist(c.point.x,this.o.x,c.point.y,this.o.y),this.angle=a(c.point.y-this.o.y,c.point.x-this.o.x);break;case"09090":this.o.h=this.dist(c.point.y,this.o.y,c.point.z,this.o.z),this.angle=a(c.point.y-this.o.y,c.point.z-this.o.z);;break;case"90900":this.o.h=this.dist(c.point.z,this.o.z,c.point.x,this.o.x),this.angle=a(c.point.x-this.o.x,c.point.z-this.o.z);}this.state=1}})},tick:function(a){if(!(10>a-this.time)){let a=this.el;switch(this.state){case 0:let b=a.getAttribute("position");this.planes[this.r](a,b.x,b.y,b.z);break;case 1:let c=this.movement,d=a.getAttribute("position");if(a.setAttribute("position",{x:d.x+c.x,y:d.y+c.y,z:d.z+c.z}),this.t++,this.t>c.t&&(a.setAttribute("position",c.dest),this.t=0,this.state=0,this.oldOrbit.exitOrbit(),"destination"===this.orbiting.el.getAttribute("id"))){let b=document.createElement("a-image");b.setAttribute("src","#endtext"),b.setAttribute("width","4"),b.setAttribute("position","-0.7 0 -1"),a.appendChild(b),a.removeChild(a.querySelector("a-entity[cursor]"));let c=document.createElement("a-entity");c.setAttribute("click-everywhere",""),c.setAttribute("cursor","fuse:false;downEvents:gp-down;upEvents:gp-up"),c.setAttribute("raycaster","far: 1500"),c.setAttribute("position","0 0 -1"),c.addEventListener("mousedown",()=>{let a=document.querySelector("a-scene"),b=a.parentElement,c=document.createElement("a-scene");c.setAttribute("galaxy",""),vr?a.exitVR():"",b.removeChild(a);let d=document.querySelector("#intro");d.setAttribute("style","display:block")}),a.appendChild(c),console.log("you won")}}}},computeLoc:function(a,b){let c=Math.atan2(b,a)+this.d;return{a:c,x:this.o.h*Math.cos(c),y:this.o.h*Math.sin(c)}},dist:function(a,b,c,d){var e=Math.pow;return Math.sqrt(e(b-a,2)+e(d-c,2))}}),AFRAME.registerComponent("galaxy",{schema:{x:{type:"number",default:5},y:{type:"number",default:5},z:{type:"number",default:5}},init:function(){var a=Math.floor;let b=document.createElement("a-assets"),c=document.createElement("canvas");c.setAttribute("id","endtext"),c.setAttribute("width",4e3),c.setAttribute("height","500"),b.appendChild(c),this.el.appendChild(b);let d=c.getContext("2d");d.font="75px Courier New",d.fillStyle="white",d.fillText("Home at last!\nClick to restart.",c.width/2,c.height/2,c.width),this.planets=[];for(let b=0;b<this.data.x;b++){this.planets[b]=[];for(let c=0;c<this.data.y;c++){this.planets[b][c]=[];for(let d=0;d<this.data.z;d++){let e=document.createElement("a-sphere"),f=a(60*Math.random()+20),g=f+a(50*Math.random()+20),h=g+a(75*Math.random()+15),i=500*b+a(300*Math.random()-150),j=500*c+a(300*Math.random()-150),k=500*d+a(300*Math.random()-150);e.setAttribute("position",{x:i,y:j,z:k}),e.setAttribute("radius",f),e.setAttribute("orbit",{ir:g,or:h}),this.planets[b][c][d]=e,this.el.appendChild(e)}}}let e=this.planets[a(Math.random()*this.data.x)][a(Math.random()*this.data.y)][a(Math.random()*this.data.z)];e.setAttribute("id","initial");let f;do f=this.planets[a(Math.random()*this.data.x)][a(Math.random()*this.data.y)][a(Math.random()*this.data.z)];while(f===e);f.setAttribute("id","destination");let g=document.createElement("a-entity");g.setAttribute("moon",""),this.el.appendChild(g);let h=document.createElement("a-sky");h.setAttribute("color","black"),h.setAttribute("radius","7000"),this.el.appendChild(h)}}),AFRAME.registerComponent("click-everywhere",{tick:function(){let a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=!1;for(let c=0;c<a.length&&!b;c++){if(null===a[c])continue;let d=a[c].buttons;for(let a=0;a<d.length&&!b;a++)d[a].pressed&&(this.el.emit("gp-down"),this.el.emit("gp-up"),b=!0)}}});</script><style>#begin,html{font-family:Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace}#intro{width:50%;margin:0 auto}#begin{background-color:#2300a5;border:none;color:#fff;padding:15px 32px;display:inline-block;font-size:16px;margin:4px 2px;cursor:pointer;width:100%}</style><div id="intro"><h1>Wandering Moon</h1>As a meteor shower pelted your planet you were flung away, landing among distant and unfamiliar orbits. Now, you must struggle to navigate this strange realm in hopes of eventually returning home.<h2>Instructions</h2>Gaze at one of the faint white orbits to highlight it. Clicking while an orbit is highlighted will launch you into that orbit.<br><br><strong>VR headsets</strong> - Press any button to click.<br><strong>Desktop</strong> - Use the mouse to click. Click and drag to rotate your view.<br><strong>Mobile without headset</strong> - Rotate phone to rotate view. Tap the screen to click.<br><br>Map size:<br><input type="radio" id="small" name="size" value="small" checked="checked"><label for="small">Small</label><input type="radio" id="medium" name="size" value="medium"><label for="medium">Medium</label><input type="radio" id="large" name="size" value="other"><label for="large">Large</label><br><br><button id="begin">Begin your journey</button></div><script>vr=!1,window.onload=()=>{document.querySelector("#begin").addEventListener("click",()=>{let a="";document.querySelector("#small").checked?a="":document.querySelector("#medium").checked?a={x:6,y:6,z:6}:document.querySelector("#large").checked&&(a={x:7,y:7,z:7});let b=document.createElement("a-scene");b.setAttribute("galaxy",a),b.addEventListener("enter-vr",()=>{vr=!0}),b.addEventListener("exit-vr",()=>{vr=!1});let c=document.querySelector("#intro"),d=c.parentElement;c.setAttribute("style","display:none;"),d.appendChild(b)})};</script>