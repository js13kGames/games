<title>Casual Crusade - js13kGames 2023</title><style>body{margin:0;overflow:hidden}body{background:#000}</style><body><script>var B={d:(t,i)=>{for(var n in i)B.t(i,n)&&!B.t(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},t:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};function k(t,i,n,o){r(t,.5*O,.5*S,i=void 0===i?0:i,n=void 0===n?1:n,o=void 0===o?1:o)}function r(t,i,n,o,e,r){void 0===o&&(o=0),void 0===e&&(e=1),void 0===r&&(r=1),t.translate(i,n),t.rotate(o),t.scale(e,r),t.translate(-i,-n)}function F(t,i,n){return Math.min(Math.max(t,i),n)}function e(t,i){var n=Math.abs(t.x-i.x),t=Math.abs(t.y-i.y);return Math.sqrt(n*n+t*t)}function s(t,i,n){return{x:t.x+i,y:t.y+n}}function N(t,i){return t.d-i.d}function h(t,i,n,o){U(t,i,n,n,o)}function U(t,i,n,o,e){t.beginPath(),t.fillStyle=e,t.ellipse(i.x,i.y,n,o,0,0,2*Math.PI),t.fill()}function c(t,i,n,o,e,r){t.beginPath(),t.moveTo(i+r,n),t.lineTo(i+o-r,n),t.quadraticCurveTo(i+o,n,i+o,n+r),t.lineTo(i+o,n+e-r),t.quadraticCurveTo(i+o,n+e,i+o-r,n+e),t.lineTo(i+r,n+e),t.quadraticCurveTo(i,n+e,i,n+e-r),t.lineTo(i,n+r),t.quadraticCurveTo(i,n,i+r,n),t.closePath()}function H(i,t,n,o,e,r){var t=t.split("|"),s=!1,h=0,c=0;t.forEach(function(t){i.fillStyle=s?r[c]:e,s&&(c=(c+1)%r.length),i.fillText(t,n+h,o),s=!s,h+=i.measureText(t).width})}B.d({},{i:()=>S,h:()=>O});var L,a={x:0,y:0},G=(jt.prototype.scale=function(t,i){this.type="scale";var n=this.o.scale;this.start={x:n.x,y:n.y},this.u(t,i)},jt.prototype.move=function(t,i){this.type="move";var n=this.o.v;this.start={x:n.x,y:n.y},this.u(t,i)},jt.prototype.u=function(t,i){this.target=t,this.duration=1e3*i,this.active=!0,this.startTime=-1},jt.prototype.update=function(t){var i,n;this.startTime<0||"none"==this.type?this.startTime=t:this.active&&(this.time=F(t=(t-this.startTime)/this.duration,0,1),this.start)&&this.target&&(t=this.start,i=this.target,n=this.time,n={x:t.x+(n=n<4/11?121*n*n/16:n<8/11?9.075*n*n-9.9*n+3.4:n<.9?4356/361*n*n-35442/1805*n+16061/1805:10.8*n*n-20.52*n+10.72)*(i.x-t.x),y:t.y+n*(i.y-t.y)},"move"==this.type&&(this.o.v={x:n.x,y:n.y}),"scale"==this.type&&(this.o.scale={x:n.x,y:n.y}),this.active=this.time<1)},jt),W=(y.prototype.update=function(t,i){this.l.update(t)},y.prototype.p=function(t){},y.prototype.M=function(){return{x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y}},y.prototype.setPosition=function(t,i){this.v={x:t,y:i}},y.prototype.A=function(t){var i=this.M();return t.x>i.x-.5*this.s.x*this.scale.x&&t.x<i.x+.5*this.s.x*this.scale.x&&t.y>i.y-.5*this.s.y*this.scale.y&&t.y<i.y+.5*this.s.y*this.scale.y},L=function(t,i){return(L=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},It);if("function"!=typeof(t=bt=M=y)&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function X(){this.constructor=W}L(W,t),W.prototype=null===t?Object.create(t):(X.prototype=t.prototype,new X),It.prototype.update=function(t,i){bt.prototype.update.call(this,t,i),t=this.O,this.O=!i.T&&this.A(i),t&&!this.O&&this.S(),t||!this.O||this.locked&&!this._||this.m(),i.C||(this.pressed&&!i.T&&this.O&&this.click(),this.pressed=!1),this.O&&this._&&i.C&&!this.pressed&&!i.T?this.pressed=!0:this.locked||(this.O&&i.C&&!i.T&&!this.T&&(this.j(),this.start={x:this.v.x,y:this.v.y},this.T=!0,this.offset=s(i,-this.v.x,-this.v.y),i.T=!0,this.d=100),this.T&&(this.v=s(i,-this.offset.x,-this.offset.y),i.C||(this.T=!1,i.T=!1,this.d=0,this.R())))};var t=It,q=function(t,i){return(q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},Z=Vt;if("function"!=typeof(m=gt=M)&&null!==m)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function Y(){this.constructor=Z}function o(t,i){return void 0===i&&(i=1),(t=void 0===t?0:t)+Math.random()*i}function K(t){return t[Math.floor(Math.random()*t.length)]}function Q(){return Math.random()<.5?1:-1}q(Z,m),Z.prototype=null===m?Object.create(m):(Y.prototype=m.prototype,new Y),Vt.prototype.update=function(t,i){this.g||this.I<0||(this.v={x:this.v.x+this.D.x,y:this.v.y+this.D.y},this.ratio=1-(t-this.start)/(1e3*this.I),this.start<0&&(this.start=t),t-this.start>1e3*this.I&&(this.g=!0))};var J=function(t,i){return(J=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},$=Pt;if("function"!=typeof(i=Mt=m=Vt)&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function z(){this.constructor=$}J($,i),$.prototype=null===i?Object.create(i):(z.prototype=i.prototype,new z),Pt.prototype.p=function(t){var i=Math.max(0,Math.min(1-this.ratio,1)),n="#ffffff"+Math.round(i*this.alpha).toString(16).padStart(2,"0");h(t,this.v,i*this.F,0<this.N?"#ffffff00":n),0<this.N&&(t.strokeStyle=n,t.lineWidth=this.N,t.stroke())};var tt=Pt,it="Arial Black, HelveticaNeue-CondensedBlack, sans-serif",nt=function(t,i){return(nt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},ot=Ct;if("function"!=typeof(i=Et=m)&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function et(){this.constructor=ot}nt(ot,i),ot.prototype=null===i?Object.create(i):(et.prototype=i.prototype,new et),Ct.prototype.p=function(t){t.save(),t.rotate(null!=(i=null==(i=this.options)?void 0:i.angle)?i:0);var i=null!=(i=this.options)&&i.H?this.ratio:1;t.font="".concat(this.fontSize*i,"px ").concat(it),t.textAlign=null!=(i=null==(i=this.options)?void 0:i.align)?i:"center",null!=(i=this.options)&&i.U&&(t.fillStyle="#000",t.fillText(this.content.replace(/\|/g,""),this.v.x+this.options.U,this.v.y+this.options.U)),H(t,this.content,this.v.x,this.v.y,null!=(i=null==(i=this.options)?void 0:i.color)?i:"#fff",null!=(i=null==(i=this.options)?void 0:i.L)?i:[]),t.restore()};var l=Ct,rt=[{type:"b",color:"#00BDE5",name:"FIBONACCI'S BOON",k:"|Draw extra| card when |placed"},{type:"p",color:"#846AC1",name:"PENANCE",k:"|Recycle |random card when |stepping| on"},{type:"r",color:"#E93988",name:"POPE'S BLESSING",k:"|Heal| for one when |placed"},{type:"y",color:"#F3DC00",name:"INDULGENCE",k:"|Score earned| for stepping on is |tenfold"},{type:"o",color:"#F89F00",name:"DYNASTY",k:"|Doubles| move scores when |stepping| on"},{type:"g",color:"#B4D000",name:"KHAN'S LEGACY",k:"Fill neighbours with |blank cards"}];function st(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}function ht(t,i,n){void 0===t&&(t=1),void 0===i&&(i=!0);var o=Math.random()<.1?4:1+Math.floor(3*Math.random()),o=1==(n=null!=n?n:["u","r","d","l"].sort(function(){return Math.random()-.5}).slice(0,o)).length?.6*t:.2*t;return{G:n,P:i&&Math.random()<o?at({},K(rt)):null}}var ct=function(t,i){return(ct=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},at=function(){return(at=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},f=80,u=60,lt=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}ct(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(p,Tt=t),p.prototype.is=function(t){return this.data.P&&st([this.data.P.type],this.B.Y(this.data.P.type),!0).includes(t)},p.prototype.K=function(){return this.locked},p.prototype.W=function(){this.lock(),this._=!0},p.prototype.update=function(t,i){Tt.prototype.update.call(this,t,i),this.X()},p.prototype.X=function(){var n=this,t=st([],this.level.V,!0).filter(function(t){return!t.content&&t.q(n,n.level.V)&&e(n.v,t.v)<100}).sort(function(t,i){return e(n.v,t.v)-e(n.v,i.v)}),i=this.Z;this.Z=t[0],this.Z&&this.T&&(this.Z.J=!0),i&&i!=this.Z&&(i.J=!1)},p.prototype.move=function(t,i){this.l.move(t,i)},p.prototype.$=function(){return this.B.tt.v},p.prototype.it=function(){var i=this;return this.level.V.filter(function(t){return!t.content&&t.q(i,i.level.V)})},p.prototype.click=function(){this.B.nt.pop(),this.B.nt.st(),this.B.j(this),this.B.rt.visible=!1},p.prototype.j=function(){var i=this;this.start={x:this.v.x,y:this.v.y},this.B.ht(),this.B.nt.click(),this.level.V.forEach(function(t){return t.ot=!t.content&&t.q(i,i.level.V)})},p.prototype.R=function(){var t,i=this;this.level.V.forEach(function(t){return t.ot=!1}),this.selected=!1,this.B.nt.ut(),this.level.V.filter(function(t){return t.content===i}).forEach(function(t){return t.content=null}),this.d=100,setTimeout(function(){return i.d=0},100),0<this.B.et.ft||!this.Z||this.B.vt.ct?this.move(this.start,.1):(this.B.lt=1,this.locked=!0,this.v=this.Z.v,(this.Z.content=this).B.fill(),this.B.dt(this.Z,this.B),this.is("b")&&(this.B.nt.yt(),this.B.wt()),this.is("r")&&this.B.Mt(1),this.is("g")&&((t=this.Z.At(this.level.V,!0).filter(function(t){return!t.content})).forEach(function(t){return i.B.bt(t)}),0<t.length)&&(this.B.nt.open(),this.B.nt.Et(),this.pulse()),this.Z=null)},p.prototype.S=function(){this.data.P&&(this.B.rt.visible=!1)},p.prototype.m=function(){var t=this;this.data.P&&setTimeout(function(){t.B.rt.show(t.data.P.name,t.data.P.k,s(t.M(),0,-50*t.scale.y),[t.data.P.color])},5),this.B.nt.xt()},p.prototype.p=function(t){t.save();var i,n,o=this.M(),e=(r(t,o.x,o.y,0,this.scale.x,this.scale.y),this.O&&this._&&t.translate(0,-10),this.T&&(t.fillStyle="#00000022",n={x:(e=this.v.x+2)-.5*O,y:+(i=this.v.y+2)},c(t,e+12*(n=0==(e=Math.sqrt(n.x*n.x+n.y*n.y))?a:{x:n.x/e,y:n.y/e}).x,i+24*n.y,this.s.x-4,this.s.y-4,3),t.fill()),t.fillStyle="#000",t.fillRect(this.v.x+2,this.v.y+2,this.s.x-4,this.s.y-4),t.fillStyle=!this.O||this.locked&&!this._?"#fff":"#ffff66",this.Ot&&(t.fillStyle="#ffffaa"),t.fillRect(this.v.x+7+2,this.v.y+7+2,this.s.x-14-4,this.s.y-14-4),this.data.G.includes("u")&&this.lineTo(t,this.v.x+.5*this.s.x,this.v.y+7+2),this.data.G.includes("r")&&this.lineTo(t,this.v.x+this.s.x-7-2,this.v.y+.5*this.s.y),this.data.G.includes("d")&&this.lineTo(t,this.v.x+.5*this.s.x,this.v.y+this.s.y-7-2),this.data.G.includes("l")&&this.lineTo(t,this.v.x+7+2,this.v.y+.5*this.s.y),{x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y});0<this.data.G.length&&h(t,e,8,"#000"),this.data.P&&(h(t,e,12,"#000"),h(t,e,6,this.data.P.color)),this.selected&&(t.strokeStyle="#fff",t.save(),r(t,o.x,o.y,0,2,2.5),ft(t,this.v.x,this.v.y,4),t.restore()),t.restore()},p.prototype.lock=function(){this.d=-50,this.locked=!0},p.prototype.has=function(t){return this.data.G&&this.data.G.includes(t)},p.prototype.Tt=function(){var i=this,n=this.level.V.find(function(t){return t.content===i}).index;return this.data.G.map(function(t){return"u"==t?i.level.V.find(function(t){return t.index.x===n.x&&t.index.y===n.y-1&&t.content&&t.content.has("d")}):"d"==t?i.level.V.find(function(t){return t.index.x===n.x&&t.index.y===n.y+1&&t.content&&t.content.has("u")}):"l"==t?i.level.V.find(function(t){return t.index.x===n.x-1&&t.index.y===n.y&&t.content&&t.content.has("r")}):"r"==t?i.level.V.find(function(t){return t.index.x===n.x+1&&t.index.y===n.y&&t.content&&t.content.has("l")}):void 0}).filter(function(t){return t&&t.content})},p.prototype.St=function(){this.is("r")&&this.B._t&&this.B.Mt(1),this.is("p")&&(this.B.nt.yt(),this.B.yt()),this.is("o")&&this.Ct(),this.is("y")&&this.B.nt.jt()},p.prototype.Ct=function(){this.B.nt.lt(),this.B.lt*=2,this.Rt("x".concat(this.B.lt),{x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y-50},"#F89F00")},p.prototype.pop=function(t){var i=this;setTimeout(function(){i.B.Dt.It(3,.08),i.gt(t)},.2)},p.prototype.gt=function(t){var i=this.is("y"),t=this.Ft(t),n=(this.B.jt+=t,{x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y-20});this.pulse(),this.Rt(t.toString(),n,i?"#F3DC00":"#fff")},p.prototype.pulse=function(){var t=this.M();this.B.Nt.add(new tt(t.x,t.y,40+30*Math.random(),1,10,60))},p.prototype.Rt=function(t,i,n){this.B.Nt.add(new l(t,40+10*Math.random(),i.x,i.y,.5+Math.random(),{x:0,y:-1-Math.random()},{U:4,H:!0,color:n,angle:o(-.1,.1)}))},p.prototype.lineTo=function(t,i,n){t.beginPath(),t.strokeStyle="#000",t.lineWidth=7,t.moveTo(this.v.x+.5*this.s.x,this.v.y+.5*this.s.y),t.lineTo(i,n),t.stroke()},p.prototype.Ft=function(t){return t*(this.is("y")?10:1)*this.B.lt*this.level.level},p),ft=function(t,i,n,o){t.lineWidth=o=void 0===o?4:o,t.lineDashOffset=5,t.setLineDash([10,40,10,20,10,40,10,20]),t.strokeRect(i+15,n+15,50,30),t.setLineDash([])},ut=function(t,i){return(ut=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},pt=Rt;if("function"!=typeof(i=_t=m)&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function yt(){this.constructor=pt}ut(pt,i),pt.prototype=null===i?Object.create(i):(yt.prototype=i.prototype,new yt),Rt.prototype.update=function(t,i){var n;null!=(n=this.options)&&n.force&&(this.D={x:this.D.x+this.options.force.x,y:this.D.y+this.options.force.y}),_t.prototype.update.call(this,t,i)},Rt.prototype.p=function(t){var i;t.fillStyle=null!=(i=null==(i=this.options)?void 0:i.color)?i:"#fff",t.fillRect(this.v.x-.5*this.s.x,this.v.y-.5*this.s.y,this.s.x,this.s.y)};var vt=Rt;function dt(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}function xt(){function j(t){return Math.sin(6.283184*t)}function D(t){return.003959503758*Math.pow(2,(t-128)/12)}var B,k,F,N,U,H=[j,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){return(t=t%1*4)<2?t-1:3-t}];this.init=function(t){k=(B=t).zt,F=0,N=t.qt*t.Zt*(k+1)*2,U=new Int32Array(N)},this.$t=function(){for(var t,i,n,o,e,r,s,h=new Int32Array(N),c=B.Qt[F],a=B.qt,l=B.Zt,f=0,u=0,p=!1,y=[],v=0;v<=k;++v)for(n=c.v[v],t=0;t<l;++t){for(var d=H[c.Vt[16]],x=c.Vt[17]/512,m=Math.pow(2,c.Vt[18]-9)/a,w=c.Vt[19],O=c.Vt[20],S=43.23529*c.Vt[21]*3.141592/44100,_=1-c.Vt[22]/255,T=1e-5*c.Vt[23],E=c.Vt[24]/32,M=c.Vt[25]/512,g=6.283184*Math.pow(2,c.Vt[26]-9)/a,b=c.Vt[27]/255,A=c.Vt[28]*a&-2,R=(v*l+t)*a,C=0;C<4;++C)if(i=n?c.c[n-1].n[t+C*l]:0){y[i]||(y[i]=function(t,i){for(var n,o,e,r,s=H[t.Vt[0]],h=t.Vt[1],c=t.Vt[3]/32,a=H[t.Vt[4]],l=t.Vt[5],f=t.Vt[8]/32,u=t.Vt[9],p=t.Vt[10]*t.Vt[10]*4,y=t.Vt[11]*t.Vt[11]*4,v=t.Vt[12]*t.Vt[12]*4,d=1/v,x=-t.Vt[13]/16,m=t.Vt[14],w=(Math.pow(2,2-t.Vt[15]),new Int32Array(p+y+v)),O=0,S=0,_=0,T=0;_<p+y+v;_++,T++)0<=T&&(e=D(i+(15&m)+t.Vt[2]-128),r=D(i+(15&m)+t.Vt[6]-128)*(1+8e-4*t.Vt[7])),n=1,_<p?n=_/p:p+y<=_&&(n=(1-(n=(_-p-y)*d))*Math.pow(3,x*n)),o=s(O+=e*Math.pow(n,c))*h,o+=a(S+=r*Math.pow(n,f))*l,u&&(o+=(2*Math.random()-1)*u),w[_]=80*o*n|0;return w}(c,i));for(var P=y[i],V=0,I=2*R;V<P.length;V++,I+=2)h[I]+=P[V]}for(V=0;V<a;V++)(e=h[o=2*(R+V)])||p?(r=S,w&&(r*=d(m*o)*x+.5),u+=(r=1.5*Math.sin(r))*(r=_*(e-u)-(f+=r*u)),e=3==O?u:1==O?r:f,T&&(e=(e*=T)<1?-1<e?j(.25*e):-1:1,e/=T),p=1e-5<(e*=E)*e,s=e*(1-(r=Math.sin(g*o)*M+.5)),e*=r):s=0,A<=o&&(s+=h[o-A+1]*b,e+=h[o-A]*b),h[o]=0|s,h[1+o]=0|e,U[o]+=0|s,U[1+o]+=0|e}return++F/B.Jt},this.ti=function(t){for(var i=t.createBuffer(2,N/2,44100),n=0;n<2;n++)for(var o=i.getChannelData(n),e=n;e<N;e+=2)o[e>>1]=U[e]/65536;return i},this.ii=function(){var t=44+2*N-8,i=t-36,n=new Uint8Array(44+2*N);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var o=0,e=44;o<N;++o){var r=U[o];n[e++]=255&(r=r<-32767?-32767:32767<r?32767:r),n[e++]=r>>8&255}return n},this.getData=function(t,i){for(var n=2*Math.floor(44100*t),o=new Array(i),e=0;e<2*i;e+=1){var r=n+e;o[e]=0<t&&r<U.length?U[r]/32768:0}return o}}var mt=function(t,i){return(mt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},wt=n;if("function"!=typeof(i=St=M)&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function Ot(){this.constructor=wt}mt(wt,i),wt.prototype=null===i?Object.create(i):(Ot.prototype=i.prototype,new Ot),n.prototype.reset=function(t){var i=t.v;this.Z=t,this.v={x:i.x,y:i.y}},n.prototype.update=function(t,i){this.l.update(t),this.Ut=Math.abs(Math.sin(.005*t))},n.prototype.p=function(t){var i={x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y},n={x:this.v.x+.5*this.s.x,y:this.v.y+.5*this.s.y-30-5*this.Ut},o=(t.save(),Math.sin(-this.l.time*Math.PI));U(t,i,24+8*o,12+4*o,"#00000033"),t.translate(0,25*o),h(t,n,14,"#000"),t.strokeStyle="#000",t.lineWidth=5,t.fillStyle="#fff",t.beginPath(),t.moveTo(i.x,this.v.y-10-5*this.Ut),t.lineTo(i.x+14,this.v.y+32),t.quadraticCurveTo(i.x,this.v.y+40,i.x-14,this.v.y+32),t.lineTo(i.x-14,this.v.y+32),t.lineTo(i.x,this.v.y-1-5*this.Ut),t.fill(),t.stroke(),h(t,n,9,"#fff"),t.lineWidth=3,t.beginPath(),t.moveTo(n.x,n.y+5),t.lineTo(n.x,n.y-10),t.stroke(),t.beginPath(),t.moveTo(n.x-4,n.y-2*this.Ut),t.lineTo(n.x+4,n.y-2*this.Ut),t.stroke(),t.restore()},n.prototype.Lt=function(t){this.l.move(this.v,.3),this.kt(t)},n.prototype.kt=function(t){t.nt.move();for(var i=this.M(),n=0;n<10;n++){var o=1+3*Math.random(),e={x:4*Math.random()-2,y:-4*Math.random()};t.Nt.add(new vt(i.x,i.y,o,o,.2+.5*Math.random(),e,{force:{x:0,y:.1},Ht:20,color:"#5b7c5b44"}))}},n.prototype.dt=function(t,n,o){var e=this;this.path=[],this.Gt(this.Z,t,[this.Z],n.Pt),this.Z=this.path[this.path.length-1],this.ct=!0,this.path.forEach(function(t,i){setTimeout(function(){t.content.Ot=!0,0<i&&(e.l.move(t.v,.3),setTimeout(function(){return e.kt(n)},.075),t.content.St(),t.content.pop(i*n.Bt),n.Yt(t),n.Kt)&&t.Wt(o.V).filter(function(t){return t.content&&t.content.is("o")}).forEach(function(t){return t.content.St()})},.3*i*1e3)}),setTimeout(function(){e.path.forEach(function(t){return t.content.Ot=!1}),e.ct=!1},.3*(this.path.length+1)*1e3),setTimeout(function(){return n.Xt()},.3*this.path.length*1e3+600)},n.prototype.Gt=function(t,i,n,o){var e=this,r=t.content.Tt().filter(function(i){return!n.includes(i)||o.some(function(t){return i.content.is(t)})&&n.filter(function(t){return t==i}).length<5});t!=i?r.forEach(function(t){return e.Gt(t,i,dt(dt([],n,!0),[t],!1),o)}):this.evaluate(this.path)<this.evaluate(n)&&(this.path=dt([],n,!0))},n.prototype.evaluate=function(t){var n=1,o=0;return t.forEach(function(t,i){t.content.is("o")&&(n*=2),o+=t.content.Ft((i+1)*n)}),o};var St,_t,Tt,Et,Mt,gt,bt,i=n,At={Qt:[{Vt:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,21,0,0,50,0,0,0,0],v:[1,2,1,1,1,2,1,2],c:[{n:[147,,,,,147,,147,,,147,,,,,147,147,,,,,147,,147,,,147,,,,,147],f:[]},{n:[147,,,,,147,,147,,,147,,,,,147,147,,,,,147,,147,,,147],f:[]}]},{Vt:[0,0,140,0,0,0,140,0,0,50,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],v:[3,4,2,2,1,5,1,5,3,4],c:[{n:[147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147],f:[]},{n:[147,,147,147,147,,147,147,147,,147,,147,147,,147,147,,147,147,147,,147,147,147,,147,,147,147,,147],f:[]},{n:[147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147],f:[]},{n:[147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147],f:[]},{n:[147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147],f:[]}]},{Vt:[0,160,128,64,0,160,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],v:[1,1,1,1,1,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{Vt:[2,127,128,0,3,201,128,0,0,0,0,6,29,0,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],v:[1,2,1,2,1,2,1,2],c:[{n:[111,,111,,111,,,111,111,,,,111,,,,111,,111,,111,,,111,111,,,,111,,110,109],f:[]},{n:[111,,111,,111,,,111,111,,,,111,,,,111,,111,,111,,,111,111,,,,111],f:[]}]},{Vt:[3,192,116,0,3,192,128,0,0,0,7,12,22,0,0,0,0,0,0,0,2,255,0,0,32,61,3,29,4],v:[1,2,3,4,3,4,1,2,3,4],c:[{n:[135,138,142,147,150,154,150,147,135,138,142,147,150,154,150,123,130,133,137,142,145,149,145,142,130,133,137,142,145,149,145,142],f:[]},{n:[131,134,138,143,146,150,146,143,131,134,138,143,146,150,146,143,133,136,140,145,148,152,148,145,133,136,140,145,148,152,148,145],f:[]},{n:[142,,147,154,149,154,159,161,150,,162,,150,,159,,142,,142,,149,157,154,157,154,,159,,161,,154,,162,,,,,,,,,,,,,,,,159,,,161],f:[]},{n:[155,149,143,162,159,155,157,149,155,159,162,,159,,157,,143,,147,,147,152,162,159,142,158,149,154,158,154,161,,161,,,,,,,,,,,,,,,,155,,152],f:[]}]},{Vt:[3,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,0,0,0,1,0,0,0,32,47,3,13,2],v:[,,,,1,2,3,4],c:[{n:[114,,,,,,,,,,114,,113,,111,,106,,,,,,,,,,109,,106,,106],f:[]},{n:[102,,,,,,,,,,107,,102,,99,,104,,,,,,,,,,109,,104,,101],f:[10]},{n:[114,,,,,,,,,,114,,109,,106,,104,,,,,,,,,,109,,106,,104],f:[]},{n:[102,,,,,,,,,,107,,102,,99,,104,,,,,,,,,,106,,106,,106],f:[]}]},{Vt:[0,255,152,0,3,255,152,12,0,0,9,0,19,0,0,0,0,0,0,0,2,59,0,0,32,47,1,57,1],v:[,,,,,,,,1,2],c:[{n:[126,,,,,,126,,130,,,,126,,,,125,,,,,,,,130,,,,125],f:[]},{n:[125,,,,,,126,,123,,,,,,,,123,,,,,,,,122,,,,125],f:[]}]}],qt:7350,Zt:32,zt:9,Jt:7};function n(t){var i=this,n=t.v;return(i=St.call(this,n.x,n.y,f,u)||this).Z=t,i.path=[],i.Ut=0,i.d=50,i}function Rt(t,i,n,o,e,r,s){var h=this;return(h=_t.call(this,t,i,n,o,e,r)||this).options=s,null!=(t=h.options)&&t.Ht&&(h.d=h.options.Ht),h}function p(t,i,n,o,e){return(t=Tt.call(this,t,i,f,u)||this).level=n,t.B=o,t.data=e,t}function Ct(t,i,n,o,e,r,s){return(n=Et.call(this,n,o,0,0,e,r)||this).content=t,n.fontSize=i,n.options=s,n}function Pt(t,i,n,o,e,r){return void 0===o&&(o=1),void 0===e&&(e=0),void 0===r&&(r=40),(t=Mt.call(this,t,i,n,n,(.3+.1*Math.random())*o,a)||this).F=n,t.N=e,t.alpha=r,t}function Vt(t,i,n,o,e,r){return(t=gt.call(this,t,i,n,o)||this).I=e,t.D=r,t.ratio=1,t.start=-1,t}function It(){var t=null!==bt&&bt.apply(this,arguments)||this;return t.offset={x:0,y:0},t}function y(t,i,n,o){this.scale={x:1,y:1},this.d=0,this.v={x:t,y:i},this.s={x:n,y:o},this.l=new G(this)}function jt(t){this.o=t,this.time=0,this.type="none"}function v(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return Dt.play.apply(Dt,t)}var Dt={volume:.3,sampleRate:44100,x:new AudioContext,play:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.ni(this.si.apply(this,t))},ni:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.x.createBuffer(t.length,t[0].length,this.sampleRate),o=this.x.createBufferSource();return t.map(function(t,i){return n.getChannelData(i).set(t)}),o.buffer=n,o.connect(this.x.destination),o.start(),o},si:function(t,i,n,o,e,r,s,h,c,a,l,f,u,p,y,v,d,x,m,w){void 0===t&&(t=1),void 0===i&&(i=.05),void 0===n&&(n=220),void 0===o&&(o=0),void 0===e&&(e=0),void 0===r&&(r=.1),void 0===s&&(s=0),void 0===h&&(h=1),void 0===c&&(c=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===f&&(f=0),void 0===u&&(u=0),void 0===p&&(p=0),void 0===y&&(y=0),void 0===v&&(v=0),void 0===d&&(d=0),void 0===x&&(x=1),void 0===m&&(m=0),void 0===w&&(w=0);var O,S,_=2*Math.PI,T=this.sampleRate,E=c*=500*_/T/T,M=n*=(1+2*i*Math.random()-i)*_/T,g=[],b=0,A=0,R=0,C=1,P=0,V=0,I=0;for(o=o*T+9,m*=T,e*=T,r*=T,d*=T,a*=500*_/Math.pow(T,3),y*=_/T,l*=_/T,f*=T,u=u*T|0,S=o+m+e+r+d|0;R<S;g[R++]=I)++V%(100*v|0)||(I=s?1<s?2<s?3<s?Math.sin(Math.pow(b%_,3)):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/_%2+2)%2:1-4*Math.abs(Math.round(b/_)-b/_):Math.sin(b),I=(u?1-w+w*Math.sin(_*R/u):1)*(0<I?1:-1)*Math.pow(Math.abs(I),h)*t*this.volume*(R<o?R/o:R<o+m?1-(R-o)/m*(1-x):R<o+m+e?x:R<S-d?(S-R-d)/r*x:0),I=d?I/2+(R<d?0:(R<S-d?1:(S-R)/d)*g[R-d|0]/2):I),b+=(O=(n+=c+=a)*Math.cos(y*A++))-O*p*(1-1e9*(Math.sin(R)+1)%2),C&&++C>f&&(n+=l,M+=l,C=0),!u||++P%u||(n=M,c=E,C=C||1);return g}},Bt=(D.prototype.hi=function(){var i,n,o=this;this.ri||(this.nt=document.createElement("audio"),this.ri=!0,(i=new xt).init(At),i.$t(),this.loaded=!1,n=setInterval(function(){var t;!o.loaded&&(o.loaded=1<=i.$t(),o.loaded)&&(t=i.ii(),o.nt.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),o.nt.loop=!0,clearInterval(n))},5))},D.prototype.play=function(){var t=this,i=setInterval(function(){t.loaded&&(t.nt.play(),clearInterval(i))},5)},D.prototype.oi=function(){v.apply(void 0,[1.5,,157,.16,,0,,.35,-24,28,,,,.1,,.6,,.19,.01])},D.prototype.move=function(){v.apply(void 0,[,,759,.01,,.01,1,.97,15,,,,,,3.1,,,.76,.04])},D.prototype.ui=function(){v.apply(void 0,[.5,,392,.06,.22,.5,1,1.85,-.1,-.9,61,.05,.07,,,.1,,.96,.12])},D.prototype.fi=function(){v.apply(void 0,[.5,,146,.04,.23,.46,,.56,,-3.7,658,.02,.15,.1,,,,.82,.13,.2])},D.prototype.ei=function(){v.apply(void 0,[1.5,,785,.01,.1,.54,4,2.66,,,,,,.9,,.5,.38,.34,.11,.14])},D.prototype.open=function(){v.apply(void 0,[.4,,22,.08,.22,.02,1,.52,-4.2,-9.8,,,.14,,-18,.2,,,.05])},D.prototype.ci=function(){v.apply(void 0,[1.5,,430,.02,.12,.5,,.89,,-3.6,-133,.07,.13,,,.1,,.83,.23,.26])},D.prototype.ai=function(){v.apply(void 0,[.5,,160,.03,.03,.02,,1.52,-23,93,662,.02,,,,.1,,,.07,.01])},D.prototype.xt=function(){v.apply(void 0,[.7,,1305,,,.03,1,.75,,23,694,.01,,,3.9,,,,.01])},D.prototype.click=function(){v.apply(void 0,[,,158,.09,.18,.03,,2.53,11,-58,63,.02,.01,.5,,,,.16])},D.prototype.Et=function(){v.apply(void 0,[.7,,1496,.09,.09,.01,3,.14,,,-870,,,,3.2,.2,,.31,.02])},D.prototype.pop=function(){v.apply(void 0,[.5,,1368,.09,,0,,1.11,-76,9.1,-490,,,,,,,.56])},D.prototype.ut=function(){v.apply(void 0,[6,,205,,.02,0,,1.03,,,,,,,,,.12,.32])},D.prototype.st=function(){v.apply(void 0,[.1,,836,.11,,0,4,.91,13,,,,.09,.1,-39,,,.06,.07])},D.prototype.lt=function(){v.apply(void 0,[,,341,,.14,.23,1,1.01,.9,,-132,.03,,.1,,.1,,.52,.22])},D.prototype.jt=function(){v.apply(void 0,[,,103,.04,.11,.43,1,.77,,,57,.19,.05,,,.1,,.68,.24])},D.prototype.yt=function(){v.apply(void 0,[.5,,426,.01,,.05,,2.54,49,,9,.1,,,,,,.46,.15])},D.prototype.Mt=function(){v.apply(void 0,[,,193,.04,.27,.42,1,1.71,2.8,4.9,,,.1,.2,,.1,,.55,.27,.47])},D.prototype.vi=function(){v.apply(void 0,[,,922,.03,.03,.33,4,1.88,.5,.4,,,,.9,,.2,,.45,.05])},D),kt=function(t,i){return(kt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},Ft=((Nt=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}kt(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)})(Ji,Hi=M),Ji.prototype.update=function(t,i){var n;this.visible&&(n=this.O,this.O=!i.T&&this.A(i),!n&&this.O&&this.m(),i.C||(this.pressed&&!i.T&&this.O&&(this.nt.pop(),this.li()),this.pressed=!1),this.O)&&i.C&&!this.pressed&&!i.T&&(this.pressed=!0)},Ji.prototype.p=function(t){this.visible&&(t.save(),t.translate(0,this.O?-5:0),t.fillStyle="#000",t.fillRect(this.v.x,this.v.y,this.s.x,this.s.y),t.fillStyle=this.O?"#ffff77":"#fff",t.fillRect(this.v.x+7,this.v.y+7,this.s.x-14,this.s.y-14),t.font="30px ".concat(it),t.textAlign="center",t.fillStyle="#000",t.fillText(this.content,this.v.x+.5*this.s.x,this.v.y+.5*this.s.y+10),t.restore())},Ji.prototype.m=function(){this.nt.xt()},Ji),Nt=(Qi.prototype.It=function(t,i,n){var o=this;void 0===n&&(n=0),this.di=t,this.yi=n/360*Math.PI,setTimeout(function(){return o.reset()},1e3*i)},Qi.prototype.update=function(){this.offset={x:o(-this.di,this.di),y:o(-this.di,this.di)},this.rotation=o(-this.yi,this.yi)},Qi.prototype.reset=function(){this.di=0,this.yi=0},Qi),Ut=(Ui=function(t,i){return(Ui=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},j),d=Ni=M;if("function"!=typeof d&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Ht(){this.constructor=Ut}Ui(Ut,d),Ut.prototype=null===d?Object.create(d):(Ht.prototype=d.prototype,new Ht),j.prototype.update=function(i,n){Ni.prototype.update.call(this,i,n),this.children.forEach(function(t){return t.update(i,n)}),this.children.some(function(t){return t.g})&&(this.children=this.children.filter(function(t){return!t.g}))},j.prototype.hide=function(t){this.l.scale({x:0,y:0},t=void 0===t?.3:t)},j.prototype.show=function(t){this.l.scale({x:1,y:1},t=void 0===t?.3:t)},j.prototype.p=function(i){i.save();var t=this.v;r(i,t.x,t.y,0,this.scale.x,this.scale.y),this.children.forEach(function(t){return t.p(i)}),i.restore()},j.prototype.pi=function(t){return this.children[t]},j.prototype.wi=function(){return this.children},j.prototype.add=function(t){this.children.push(t)};var Lt=j,Gt=function(t,i){return(Gt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},Wt=I;if("function"!=typeof(d=Fi=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Xt(){this.constructor=Wt}Gt(Wt,d),Wt.prototype=null===d?Object.create(d):(Xt.prototype=d.prototype,new Xt),I.prototype.click=function(t,i,n){this.Ai.A({x:t,y:i})&&n.bi()},I.prototype.toggle=function(t){var i=this,n=t?.3:.1;this.l.scale({x:1,y:t?1:0},n),setTimeout(function(){return i.visible=t},1e3*n)},I.prototype.update=function(t,i){this.l.update(t),this.visible&&this.Ai.update(t,i)},I.prototype.p=function(t){t.save(),k(t,0,this.scale.x,this.scale.y),t.fillStyle="#000000bb",t.fillRect(-100,.2*S,O+200,.6*S),this.Mi.p(t),this.Ai.p(t),t.restore()};var qt=I,Zt=function(t,i){return(Zt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},Yt=Ki;if("function"!=typeof(d=ki=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Kt(){this.constructor=Yt}Zt(Yt,d),Yt.prototype=null===d?Object.create(d):(Kt.prototype=d.prototype,new Kt),Ki.prototype.open=function(t){void 0===t&&(t=function(){}),this.l.scale({x:0,y:0},.5),setTimeout(t,500)},Ki.prototype.close=function(t){void 0===t&&(t=function(){}),this.l.scale({x:1,y:1},.4),setTimeout(t,500)},Ki.prototype.p=function(t){t.fillStyle="#000",t.fillRect(0,0,O*this.scale.x,S),t.fillRect(O-O*this.scale.x,0,O*this.scale.x,S)};var Qt=Ki,Jt=function(t,i){return(Jt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},$t=Yi;if("function"!=typeof(d=Bi=m)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function zt(){this.constructor=$t}Jt($t,d),$t.prototype=null===d?Object.create(d):(zt.prototype=d.prototype,new zt),Yi.prototype.p=function(t){var i,n;t.beginPath(),t.lineWidth=this.width*this.ratio,t.strokeStyle=this.color,t.moveTo(this.from.x,this.from.y),this.Ei&&(i=s(n={x:this.from.x*this.xi+this.to.x*(1-this.xi),y:this.from.y*this.xi+this.to.y*(1-this.xi)},this.Ei*this.direction,0),n=s(n,-this.Ei*this.direction,0),t.lineTo(i.x,i.y),t.lineTo(n.x,n.y)),t.lineTo(this.to.x,this.to.y),t.stroke()};var ti=Yi,ii=function(t,i){return(ii=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},ni=function(){return(ni=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},oi="WILDCARD",ei=[{name:"SAINTHOOD",description:"Increase your |LIFE| by |2",color:"#E93988",Oi:"ಎ",offset:-3,Ti:!0,Si:function(t){return t._i(2)}},{name:"MAGNA CARTA",description:"Increase your |MAX HAND SIZE| by |1",color:"#00BDE5",Oi:"ಃ",offset:-3,Ti:!0,Si:function(t){return t.mi++}},{name:"SACRAMENT",description:"Increases the presented |reward options",color:"#F89F00",Oi:"ಐ",offset:-2,Ti:!0,Si:function(t){return t.Ci++}},{name:"MIRACLE",description:"Allows you to pick an |extra| reward",color:"#F89F00",Oi:"ಠ",Si:function(t){return t.ji++}},{name:"CAVALRY",description:"Your |empty cards| can open chests",color:"#B4D000",Oi:"ು",offset:-3,Si:function(t){return t.Ri=!0}},{name:"FAITH",description:"Stepping on |RED| also |HEALS",color:"#E93988",Oi:"ಏ",offset:-2,Si:function(t){return t._t=!0}},{name:"PILLAGE",description:"Double your step |SCORE",color:"#F3DC00",Oi:"ಚ",offset:-1,Ti:!0,Si:function(t){return t.Bt++}},{name:"LOOT",description:"Passing by |ORANGE| activates it",color:"#F89F00",Oi:"್",Si:function(t){return t.Kt=!0}},{name:"MANNA",description:"Get increased |GEM| chance",color:"#F3DC00",Oi:"ಞ",offset:-3,Ti:!0,Si:function(t){return t.Ii*=1.3}},{name:"SIN",description:"Once per level, |redraw| your hand if |stuck",color:"#846AC1",Oi:"೪",Si:function(t){return t.Di=!0}},{name:oi,description:"|!1| ⇆ |!2|",Oi:"ೞ",Ti:!0,gi:!0,offset:-3,Si:function(t){}},{name:"HOME",description:"Freely revisit |!1| tiles",Oi:"ಹ",Ti:!0,gi:!0,Si:function(t){}}],ri=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}ii(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(V,Di=t),V.prototype.A=function(t){var i;return this.icon?(i=this.M(),t.x>i.x-.25*this.s.x*this.scale.x&&t.x<i.x+.25*this.s.x*this.scale.x&&t.y>i.y-.25*this.s.y*this.scale.y&&t.y<i.y+.25*this.s.y*this.scale.y):Di.prototype.A.call(this,t)},V.prototype.move=function(t,i){this.l.move(t,i)},V.prototype.W=function(){},V.prototype.$=function(){return{x:30,y:50}},V.prototype.m=function(){var o=this;setTimeout(function(){var t=o.icon?230:0,i=o.icon?120:-50*o.scale.y,n=o.data.description.replace("!1",o.data.Fi[0].name).replace("!2",o.data.Fi[1].name);o.B.rt.show(o.data.name,n,s(o.M(),t,i),o.data.name==oi?o.data.Fi.map(function(t){return t.color}):[o.data.color],o.icon)},5),this.B.nt.xt()},V.prototype.S=function(){this.B.rt.visible=!1},V.prototype.j=function(){},V.prototype.click=function(){this.B.nt.pop(),this.B.nt.st(),this.B.Ni(this),this.B.rt.visible=!1,this.data.Si(this.B)},V.prototype.R=function(){},V.prototype.p=function(t){t.save();var i,n=this.M(),o=(r(t,n.x,n.y,0,this.scale.x,this.scale.y),this.O&&this._&&!this.icon&&t.translate(0,-10),this.icon||(t.fillStyle="#000",t.fillRect(this.v.x,this.v.y+2,this.s.x-4,this.s.y-4),t.fillStyle=this.O?"#ffff66":"#ddd",t.fillRect(this.v.x+7+2,this.v.y+7+2,this.s.x-14-4,this.s.y-14-4),t.strokeStyle="#00000022",ft(t,this.v.x,this.v.y)),t.font="30px sans-serif",t.textAlign="center",null!=(o=this.data.offset)?o:0);t.fillStyle=this.data.color,this.data.name==oi&&(i=this.M(),(i=t.createLinearGradient(i.x-20,0,i.x+20,0)).addColorStop(0,this.data.Fi[0].color),i.addColorStop(.49,this.data.Fi[0].color),i.addColorStop(.51,this.data.Fi[1].color),i.addColorStop(1,this.data.Fi[1].color),t.fillStyle=i),t.strokeStyle="#000000cc",t.lineWidth=6,t.strokeText(this.data.Oi,n.x+15-15,n.y+12+o),t.fillText(this.data.Oi,n.x+15-15,n.y+12+o),t.restore()},V);function si(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}var hi=function(t,i){return(hi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},ci=function(){return(ci=Object.assign||function(t){for(var i,n=1,o=arguments.length;n<o;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t}).apply(this,arguments)},ai=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}hi(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(P,ji=M),P.prototype.update=function(i,n){this.l.update(i),this.ft<=0||this.Hi.length<=0||!this.ready||this.Hi.forEach(function(t){return t.update(i,n)})},P.prototype.p=function(i){i.save(),k(i,0,this.scale.x,this.scale.y),i.fillStyle="#000000bb",i.fillRect(0,.2*S,O,.6*S),this.Hi.forEach(function(t){return t.p(i)}),this.title.p(i),i.restore()},P.prototype.Ui=function(n,o){var t=si([],this.Hi,!0).sort(function(t,i){return e(t.M(),{x:n,y:o})-e(i.M(),{x:n,y:o})})[0];t&&e(t.M(),{x:n,y:o})<100&&(t.O?(t instanceof lt&&this.B.j(t),t instanceof ri&&this.B.Ni(t)):t.O=!0)},P.prototype.remove=function(i){var t=this;!this.locked&&i&&(i.move(i.$(),.2),this.locked=!0,setTimeout(function(){t.Hi=t.Hi.filter(function(t){return t!=i}),1!=t.ft&&0!=t.Hi.length||(t.l.scale({x:1,y:0},.1),t.ready=!1),t.Li(),t.ft=Math.min(t.ft-1,t.Hi.length),t.locked=!1,t.B.rt.visible=!1,0<t.ft&&(t.title.content="PICK ".concat(t.ft," MORE!"))},150))},P.prototype.create=function(t,i){var n=this,o=(void 0===i&&(i=.25),this.ft+=t,this.l.scale({x:1,y:1},.3),setTimeout(function(){return n.ready=!0},300),this.B.Ci);this.Hi=[],this.title.content="PICK YOUR REWARD!",1<this.ft&&(this.title.content="PICK YOUR REWARDS!");for(var e=Math.random()<i&&1<this.level.level,r=si([],ei,!0).filter(function(t){return t.Ti||!n.B.ki.includes(t.name)}).sort(function(){return Math.random()<.5?1:-1}),s=0;s<o&&r[s];s++){var h=e?new ri(this.v.x+6-52*o+104*s,this.v.y+40,this.B,ci({},r[s])):new lt(this.v.x+6-52*o+104*s,this.v.y+40,this.level,this.B,ht(this.B.Ii));h.scale={x:1.3,y:1.3},this.Hi.push(h)}this.Li(),this.Hi.forEach(function(t){return t.W()})},P.prototype.Li=function(){var n=this;this.Hi.forEach(function(t,i){i={x:n.v.x+6-52+(i-.5*n.Hi.length+.5)*f*1.3,y:n.v.y+40},t.move(i,.15)})},P),li=function(t,i){return(li=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},fi=Zi;if("function"!=typeof(d=Ii=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function ui(){this.constructor=fi}li(fi,d),fi.prototype=null===d?Object.create(d):(ui.prototype=d.prototype,new ui),Zi.prototype.move=function(t,i){this.l.move(t,i)},Zi.prototype.p=function(t){var i;this.count<=0||(i=10*(Math.min(6,this.count)-1),t.fillStyle="#000",t.fillRect(this.v.x+2,this.v.y+2,this.s.x-4,this.s.y-4),t.fillStyle="#ccc",t.fillRect(this.v.x+7+2,this.v.y+7+2,this.s.x-14-4,this.s.y-14-4),t.fillStyle="#000",t.fillRect(this.v.x+2,this.v.y+2-i,this.s.x-4,this.s.y-4),t.fillStyle="#fff",t.fillRect(this.v.x+7+2,this.v.y+7+2-i,this.s.x-14-4,this.s.y-14-4),t.strokeStyle="#00000022",ft(t,this.v.x,this.v.y-i),t.font="27px ".concat(it),t.textAlign="center",t.fillStyle="#000",t.fillText(this.count.toString(),this.v.x+.5*this.s.x,this.v.y+.5*this.s.y+10-i))};var pi=Zi,yi=function(t,i){return(yi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},vi=qi;if("function"!=typeof(d=Vi=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function di(){this.constructor=vi}yi(vi,d),vi.prototype=null===d?Object.create(d):(di.prototype=d.prototype,new di),qi.prototype.show=function(t,i,n,o,e){void 0===e&&(e=!1);var r=n.x-.5*this.s.x,s=F(r,10,800-this.s.x-10);this.Gi=s-r,this.title=t,this.content=i,this.v={x:s,y:n.y-this.s.y},this.visible=!0,this.Pi=o,this.Bi=e},qi.prototype.update=function(t,i){this.Ut=Math.abs(Math.sin(.0025*t))},qi.prototype.p=function(t){var i,n,o;this.visible&&(t.save(),t.translate(0,this.Ut*(this.Bi,-7)),t.fillStyle="#000000",t.fillRect(this.v.x,this.v.y,this.s.x,this.s.y),t.font="30px ".concat(it),t.textAlign="left",i=this.v,t.fillStyle="#000",t.fillText(this.title,i.x+5+15,i.y+5+40),t.fillStyle=this.Pi[0],t.fillText(this.title,i.x+15,i.y+40),t.font="20px ".concat(it),t.fillStyle="#000",t.fillText(this.content,i.x+4+15,i.y+4+40+30),t.beginPath(),n=this.Bi?25:250-this.Gi,o=this.Bi?5:85,t.moveTo(i.x-15+n,i.y+o),t.lineTo(i.x+15+n,i.y+o),t.lineTo(i.x+n,i.y+o+(this.Bi?-15:15)),t.fill(),H(t,this.content,i.x+15,i.y+40+30,"#fff",this.Pi),t.restore())};var xi=qi;function x(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}var mi=function(t,i){return(mi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},wi=C;if("function"!=typeof(d=Pi=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Oi(){this.constructor=wi}mi(wi,d),wi.prototype=null===d?Object.create(d):(Oi.prototype=d.prototype,new Oi),C.prototype.Y=function(i){return x(x([],this.Ki.filter(function(t){return t.Zi==i}).map(function(t){return t.zi}),!0),this.Ki.filter(function(t){return t.zi==i}).map(function(t){return t.Zi}),!0)},C.prototype.j=function(t){this.et.ft<=0||(this.add(t.data,!0,!0),this.et.remove(t),this.fill())},C.prototype._i=function(t){this.Ji+=t,this.I+=t},C.prototype.Ni=function(t){var i;this.et.ft<=0||(t.data.name==oi&&this.Ki.push({Zi:t.data.Fi[0].type,zi:t.data.Fi[1].type}),"HOME"==t.data.name&&this.Pt.push(t.data.Fi[0].type),i=this.Vi.length,this.et.remove(t),this.ki.push(t.data.name),this.Vi.push(t),setTimeout(function(){t.icon=!0,t.scale={x:.8,y:.8},t.setPosition(i%10*30-15,30+30*Math.floor(i/10))},250))},C.prototype.Mt=function(t){this.I=Math.min(this.Ji,this.I+t),this.nt.Mt();for(var i=0;i<50;i++){var n=s(this.vt.M(),o(-20,40),o(-30,40));this.Nt.add(new vt(n.x,n.y,2,5,o(.1,.6),{x:0,y:-.25-1.5*o()},"#B4D000"))}},C.prototype.$i=function(t){this.qi.pi(0).content=t},C.prototype.tn=function(){var t,e=this,i=(clearTimeout(this.nn),this.rt.visible=!1,this.level.V.filter(function(t){return!t.content&&!t.sn}));0<i.length&&this.Di&&!this.level.rn?(this.nt.oi(),this.level.rn=!0,setTimeout(function(){return e.hn()},500)):(0<i.length&&this.nt.oi(),x([],i,!0).sort(Q).forEach(function(t,i){var n=t.M();setTimeout(function(){e.nt.ei(),e.Dt.It(15,.15,3),e.Nt.add(new tt(n.x,n.y,o(30,80),.5,0,120)),e.on(n),e.Nt.add(new ti({x:.5*O,y:-100},n,.4,10,"#ffffcc99",o(10,20))),e.I--,t.hidden=!0,e.nt.vi()},100+200*i+750)}),t=0<i.length?1300:100,this.I-i.length<=0?setTimeout(function(){e.Mi.toggle(!0),e.Dt.It(7,.3,2),e.nt.ci()},200*i.length+t):(setTimeout(function(){e.$i(K(["LAND CONQUERED","INFIDELS MASSACRED","MIGHTY RIGHTEOUS","SUCCESS","REPORTING TO POPE","GREAT SUCCESS","RECONQUISTA","HERETICS LIQUIDATED","THE CHURCH PREVAILS","PAGANS MURDERED","SINS FORGIVEN","SIGNED BY THE CROSS","CRUX TRANSMARINA","CRUX CISMARINA"])),e.qi.show(),e.nt.fi(),e.vt.Lt(e),e.nt.move()},200*i.length+t),setTimeout(function(){e.qi.hide(.6),e.Wi.close(function(){e.Wi.open(),e.Yi.T=!1,e.level.next(),e.Xi=[],e.vt.reset(e.level.V[2]),e.un(),e.fill(),e.fn();var t=x([],e.level.V,!0).filter(function(t){return!t.sn}).map(function(t){return t.index.x}).sort(function(t,i){return t-i}),i=x([],e.level.V,!0).filter(function(t){return!t.sn}).map(function(t){return t.index.y}).sort(function(t,i){return t-i}),n=.5*-(t[0]-1+t[t.length-1]-1)*f,o=.5*-(i[0]-1+i[i.length-1]-1)*u,t=(e.level.V.forEach(function(t){e.en(t,n,o),e.en(t.content,n,o),e.en(t.cn(),n,o)}),e.level.V[2].v);e.vt.setPosition(t.x,t.y)})},200*i.length+1500+t)))},C.prototype.click=function(n,o){if(this.Mi.visible)this.Mi.click(n,o,this);else{var t;if(!(0<this.et.ft))return this.Xi.forEach(function(t){return t.selected=!1}),(t=x([],t=this.Xi.filter(function(t){return!t.K()}),!0).sort(function(t,i){return e(t.M(),{x:n,y:o})-e(i.M(),{x:n,y:o})})[0])&&e(t.M(),{x:n,y:o})<100?(t.j(),t.selected=!0,void(this.an=t)):this.an?(this.an.selected=!1,this.an.setPosition(n-40,o-30),this.an.X(),this.an.R(),void(this.an=null)):void 0;this.et.Ui(n,o)}},C.prototype.ht=function(){this.Xi.forEach(function(t){return t.selected=!1})},C.prototype.fn=function(){var t=this;this.$i(["THE FOURTH CRUSADE","THE FIFTH CRUSADE","CRUSADE OF FREDERICK II","THE BARONS' CRUSADE","CRUSADE OF LOUIS IX","THE SHEPHERDS' CRUSADE","THE CRUSADE OF 1267","THE INFANTS OF ARAGON","THE EIGHTH CRUSADE","LORD EDWARD'S CRUSADE","THE FALL OF OUTREMER","THE CRUSADES AFTER ACRE","THE ARAGONESE CRUSADE"][(this.level.level-1)%13]),this.qi.show(),setTimeout(function(){return t.qi.hide()},2500)},C.prototype.Xt=function(){var t,i=this;this.vt.ct||(0<this.et.ft?this.nn=setTimeout(function(){return i.Xt()},500):0!=(t=this.Xi.filter(function(t){return!t.K()})).length&&!this.level.vn()&&t.some(function(t){return 0<t.it().length})||this.tn())},C.prototype.un=function(){this.Qi=x([],this.all,!0).sort(function(){return Math.random()<.5?1:-1})},C.prototype.fill=function(){for(var t=this,i=this.Xi.filter(function(t){return!t.K()}),n=0;n<this.mi-i.length;n++)setTimeout(function(){t.wt(),t.Li()},50*n);this.Li()},C.prototype.dt=function(t,i){this.vt.dt(t,i,this.level)},C.prototype.bt=function(t){var i=t.v;(i=new lt(i.x,i.y,this.level,this,{G:[]})).lock(),t.content=i,this.Xi.push(i),i.pulse(),this.Ri&&this.Yt(t)},C.prototype.add=function(t,i,n){void 0===i&&(i=!0),(n=void 0!==n&&n)&&this.all.push(t),this.Qi.push(t),i&&(this.Qi=x([],this.Qi,!0).sort(function(){return Math.random()<.5?1:-1})),this.Li()},C.prototype.wt=function(){var t,i;this.Qi.length<=0||(this.nt.st(),t=this.Qi.pop(),i=this.tt.v,this.Xi.push(new lt(i.x,i.y-20,this.level,this,t)),this.Li())},C.prototype.update=function(i,n){this.vt.update(i,n),this.Wi.update(i,n),this.ri&&x(x(x(x([],this.Xi,!0),this.level.V,!0),this.Vi,!0),[this.rt,this.qi,this.tt,this.et,this.Mi,this.Nt,this.Dt],!1).forEach(function(t){return t.update(i,n)})},C.prototype.p=function(i){this.ri?(x(x([],this.Xi,!0),[this.vt,this.tt],!1).sort(N).forEach(function(t){return t.p(i)}),x(x([this.et],this.Vi,!0),[this.qi,this.Mi,this.rt],!1).forEach(function(t){return t.p(i)})):this.vt.p(i)},C.prototype.hn=function(){var i=this,n=this.Xi.filter(function(t){return!t.K()});n.forEach(function(t){return t.move(i.tt.v,.3)}),setTimeout(function(){i.Xi=i.Xi.filter(function(t){return!n.includes(t)}),n.forEach(function(t){return i.add(t.data,!0,!1)}),i.fill()},300),this.nn=setTimeout(function(){return i.Xt()},1e3)},C.prototype.yt=function(){var t=this,i=K(this.Xi.filter(function(t){return!t.K()}));i&&(i.move(this.tt.v,.3),setTimeout(function(){t.Xi=t.Xi.filter(function(t){return t!=i}),t.add(i.data,!0,!1),t.fill()},300))},C.prototype.on=function(t){for(var i=0;i<20;i++){var n=1+3*Math.random();this.Nt.add(new vt(t.x,t.y,n,n,.2+.5*Math.random(),{x:6*Math.random()-3,y:-7*Math.random()},{force:{x:0,y:.1},Ht:20}))}},C.prototype.Yt=function(t){var n=this,i=t.ln(this.level.V).filter(function(t){return t.sn&&!t.dn});0<i.length&&(setTimeout(function(){n.nt.ai(),n.nt.open(),i.forEach(function(t){t.Yt(),n.on(s(t.M(),0,-5)),n.Dt.It(10,.3);var i={x:(t=s(t.M(),0,-15)).x,y:t.y-20};n.Nt.add(new ti(t,s(i,0,-10),.5,10,"#ffffff55")),n.Nt.add(new ti(s(t,-5,0),s(i,-10,0),.5,7,"#ffffff55")),n.Nt.add(new ti(s(t,5,0),s(i,10,0),.5,7,"#ffffff55"))})},150),setTimeout(function(){n.nt.ui(),n.et.create(i.length*n.ji)},600))},C.prototype.Li=function(){var n=this,o=x([],this.Xi.filter(function(t){return!t.K()}),!0).sort(function(t,i){return t.v.x-i.v.x});this.tt.count=this.Qi.length,o.forEach(function(t,i){return t.move(s(n.v,(i-.5*o.length+.5)*f,0),.15)}),this.tt.move(s(this.v,-(.5*o.length+1)*f,0),.15)},C.prototype.en=function(t,i,n){t&&(t.v=s(t.v,i,n))},C.prototype.bi=function(){var t=this;this.Wi.close(function(){t.Wi.open(),t.jt=0,t.Mi.toggle(!1),t.Xi=[],t.Vi=[],t.ki=[],t.Ki=[],t.Pt=[],t.Bt=1,t.Ii=1,t._t=!1,t.Kt=!1,t.Di=!1,t.Ri=!1,t.init(),t.level.bi(),t.vt.reset(t.level.V[2])})},C.prototype.init=function(){this.qi.scale={x:0,y:0},this.I=this.Ji=5,this.mi=3,this.Ci=3,this.ji=1,this.all=[{G:["u","d"]},{G:["u","d"]},{G:["l","r"]},{G:["l","r"]},ht(1,!0)],this.un(),this.fill()};var m=C,Si=function(t,i){return(Si=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},_i=Xi;if("function"!=typeof(d=Ci=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Ti(){this.constructor=_i}Si(_i,d),_i.prototype=null===d?Object.create(d):(Ti.prototype=d.prototype,new Ti),Xi.prototype.p=function(t){var i=this.M();t.fillStyle="#000",t.save(),t.translate(0,25*Math.sin(-this.l.time*Math.PI)),r(t,i.x,i.y,this.angle*this.l.time),t.fillRect(i.x-22,i.y-28,44,20),t.fillStyle="#F3DC00",t.fillRect(i.x-17,i.y-23,34,10),U(t,s(i,0,-17),3,2,"#000"),t.restore()},Xi.prototype.open=function(){this.l.move(s(this.M(),15*this.direction,-5),.2),this.angle=.25*Math.PI*this.direction};var Ei=Xi;function Mi(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}var gi=function(t,i){return(gi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},bi=R;if("function"!=typeof(d=Ri=M)&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function Ai(){this.constructor=bi}gi(bi,d),bi.prototype=null===d?Object.create(d):(Ai.prototype=d.prototype,new Ai),R.prototype.cn=function(){return this.pn},R.prototype.update=function(t,i){this.I=.01*t*(this.J?3:-1),this.pn.update(t,i)},R.prototype.Yt=function(){this.dn=!0,this.pn.open()},R.prototype.wn=function(t){this.sn||this.hidden||(t.setLineDash([0,this.yn]),t.lineDashOffset=2*this.offset,t.lineCap="round",t.lineWidth=this.yn+10,t.strokeStyle="#5b7c5b",c(t,this.v.x-5,this.v.y-5,this.s.x+10,this.s.y+10,5),t.stroke())},R.prototype.Mn=function(t){this.sn||this.hidden||(t.lineWidth=5,t.strokeStyle="#5b7c5b",t.beginPath(),t.setLineDash([]),c(t,this.v.x-5,this.v.y-5,this.s.x+10,this.s.y+10,15),t.stroke(),t.setLineDash([0,this.yn]),t.lineDashOffset=2*this.offset,t.lineCap="round",t.lineWidth=this.yn,t.strokeStyle="#afd594",c(t,this.v.x-5,this.v.y-5,this.s.x+10,this.s.y+10,5),t.stroke())},R.prototype.p=function(t){var i;this.hidden||(i=this.M(),this.sn||(t.fillStyle="#afd594",t.beginPath(),c(t,this.v.x-5,this.v.y-5,this.s.x+10,this.s.y+10,15),t.fill()),this.sn&&(t.save(),t.translate(0,7),U(t,this.M(),27,12,"#00000033"),t.fillStyle="#000",t.fillRect(i.x-20,i.y-22,40,25),t.fillStyle="#F3DC00",t.fillRect(i.x-15,i.y-17,30,15),t.fillStyle="#000",t.fillRect(i.x-12,i.y-16,24,7),this.pn.p(t),t.restore()),(this.ot||this.J)&&(t.strokeStyle=this.J?"#ffffffff":"#ffffff99",t.lineWidth=this.J?10:6,t.setLineDash([5,15]),t.lineCap="round",t.lineDashOffset=this.I+this.offset,t.beginPath(),c(t,this.v.x+10,this.v.y+10,this.s.x-20,this.s.y-20,10),t.stroke()),t.setLineDash([]))},R.prototype.An=function(t){return!this.content&&this.v.x==t.x&&this.v.y==t.y},R.prototype.q=function(i,t){var n=this;return!this.sn&&t.some(function(t){return!!(t.index.x==n.index.x&&t.index.y==n.index.y-1&&t.content&&t.content.has("d")&&i.has("u")||t.index.x==n.index.x&&t.index.y==n.index.y+1&&t.content&&t.content.has("u")&&i.has("d")||t.index.x==n.index.x+1&&t.index.y==n.index.y&&t.content&&t.content.has("l")&&i.has("r")||t.index.x==n.index.x-1&&t.index.y==n.index.y&&t.content&&t.content.has("r")&&i.has("l"))})},R.prototype.ln=function(t){var i=this;return t.filter(function(t){return t.sn&&Math.abs(t.index.x-i.index.x)+Math.abs(t.index.y-i.index.y)==1})},R.prototype.Wt=function(t){var i=this;return t.filter(function(t){return t.content&&Math.abs(t.index.x-i.index.x)+Math.abs(t.index.y-i.index.y)==1})},R.prototype.At=function(t,i){var n=this;return i?t.filter(function(t){return!t.sn&&!t.content&&t!=n&&Math.abs(t.index.x-n.index.x)<=1&&Math.abs(t.index.y-n.index.y)<=1}):t.filter(function(t){return!t.sn&&!t.content&&Math.abs(t.index.x-n.index.x)+Math.abs(t.index.y-n.index.y)==1})};var Ri,Ci,Pi,Vi,Ii,ji,Di,Bi,ki,Fi,Ni,Ui,Hi,w=R,t=(A.prototype.vn=function(){return!this.V.some(function(t){return!t.content})},A.prototype.bi=function(){this.level=0,this.next()},A.prototype.next=function(){var i=this;this.rn=!1,this.level++,this.V=[new w(0,1,this.offset),new w(1,0,this.offset),new w(1,1,this.offset),new w(1,2,this.offset),new w(2,1,this.offset)];for(var t=0;t<2*(this.level-1);t++){var n=this.bn();n&&this.V.push(new w(n.x,n.y,this.offset))}this.En&&(this.V[2].content=this.En,this.V[2].content.setPosition(this.offset.x+f,this.offset.y+u));var o=this.V[2].v;this.xn().sort(Q).sort(function(t,i){return e(t.v,o)-e(i.v,o)}).slice(0,Math.max(0,this.level-3*Math.max(0,this.level-8))).forEach(function(t){(t=i.On(t))&&((t=new w(t.x,t.y,i.offset)).sn=!0,i.V.push(t))})},A.prototype.Tn=function(t){return-3<t.index.x&&t.index.x<5&&-2<t.index.y&&t.index.y<4},A.prototype.bn=function(){var i=this,t=this.V.filter(function(t){return t.Wt(i.V).length<4}).filter(function(t){return i.Tn(t)}),n=[];return t.forEach(function(t){n.push(i.Sn(t,{x:1,y:0}),i.Sn(t,{x:-1,y:0}),i.Sn(t,{x:0,y:1}),i.Sn(t,{x:0,y:-1}))}),K(n.filter(function(t){return t!=a}))},A.prototype.On=function(t){return K((t=[this.Sn(t,{x:1,y:0}),this.Sn(t,{x:-1,y:0}),this.Sn(t,{x:0,y:1}),this.Sn(t,{x:0,y:-1})]).filter(function(t){return t!=a}))},A.prototype.xn=function(){var i=this;return function(t,i,n){if(n||2===arguments.length)for(var o,e=0,r=i.length;e<r;e++)!o&&e in i||((o=o||Array.prototype.slice.call(i,0,e))[e]=i[e]);return t.concat(o||Array.prototype.slice.call(i))}([],this.V.filter(function(t){return t!=i.V[2]&&t.Wt(i.V).length<4}),!0)},A.prototype.Sn=function(i,n){return this.V.some(function(t){return t.index.x==i.index.x+n.x&&t.index.y==i.index.y+n.y})?a:{x:i.index.x+n.x,y:i.index.y+n.y}},A),O=800,S=600,_=document.createElement("canvas"),T=_.getContext("2d"),E=new t,M=new i(E.V[2]),g={x:0,y:0},b=new m(M,new Lt,new Nt,E,new Bt,g),Li=new Ft("PLAY",.5*O,.5*S+210,250,75,function(){},b.nt),Gi=[Li,new l("CASUAL CRUSADE",70,.5*O,95,-1,a,{U:7}),new l("by Antti Haavikko",35,.5*O,140,-1,a,{U:4}),new l("Made for js13k 2023",20,.5*O,170,-1,a,{U:2}),new l("Press F for full screen",18,.5*O,S-20,-1,a,{U:2})],Wi=[new l("LIFE: 10",30,10,35,-1,a,{U:3,align:"left"}),new l("0",50,O-15,55,-1,a,{U:4,align:"right"})],t=M.v;function A(){this.level=0,this.rn=!1,this.offset={x:.5*O-120,y:.5*S-105},this.next()}function R(t,i,n){return(n=Ri.call(this,t*f+n.x,i*u+n.y,f,u)||this).I=0,n.offset=100*Math.random(),n.index={x:t,y:i},n.d=-100,n.yn=15+7*Math.random(),n.pn=new Ei(n.M()),n}function Xi(t){var i=Ci.call(this,t.x,t.y,0,0)||this;return i.angle=0,i.direction=1,i.direction=Math.sign(t.x-.5*O),i.d=75,i}function C(t,i,n,o,e,r){var s=Pi.call(this,360,500,0,0)||this;return s.vt=t,s.Nt=i,s.Dt=n,s.level=o,s.nt=e,s.Yi=r,s.jt=0,s.lt=1,s.mi=3,s.I=5,s.Ci=3,s.ji=1,s.ki=[],s.Bt=1,s.Ii=1,s.Ki=[],s.Wi=new Qt,s.Pt=[],s.rt=new xi(.5*O,.5*S,500,90),s.Xi=[],s.Qi=[],s.Vi=[],s.qi=new Lt(.5*O,140,[new l("",40,.5*O,120,-1,a,{U:4})]),e.hi(),s.tt=new pi(s.v.x-160-30,s.v.y),s.et=new ai(s.level,s),s.Mi=new qt(s),s.init(),s}function qi(t,i,n,o){return(t=Vi.call(this,t-.5*n,i-.5*o,n,o)||this).visible=!1,t.title="",t.content="",t.Ut=0,t.Gi=0,t.d=150,t}function Zi(t,i){var n=Ii.call(this,0,0,0,0)||this;return n.count=1,(n=Ii.call(this,t,i,f,u)||this).d=-5,n}function P(t,i){var n=ji.call(this,.5*O,.5*S,0,0)||this;return n.level=t,n.B=i,n.ft=0,n.Hi=[],n.title=new l("",55,.5*O,.5*S-20,-1,a,{U:7}),n.scale={x:1,y:0},n}function V(t,i,n,o){return(t=Di.call(this,t,i,f,u)||this).B=n,t.data=o,t._=!0,t.locked=!0,t.data.Fi=rt.map(function(t){return ni({},t)}).sort(Q),t.data.color=(t.data.gi?t.data.Fi[0]:t.data).color,t}function Yi(t,i,n,o,e,r){return void 0===r&&(r=0),(n=Bi.call(this,0,0,0,0,n,a)||this).from=t,n.to=i,n.width=o,n.color=e,n.Ei=r,n.direction=Math.random()<.5?1:-1,n.xi=.25+.5*Math.random(),n}function Ki(){var t=ki.call(this,0,0,0,0)||this;return t.d=500,t.open(),t}function I(t){var i=Fi.call(this,0,0,0,0)||this;return i.Mi=new l("SIEGE ENDED!",90,.5*O,280,-1,a,{U:8,align:"center"}),i.Ai=new Ft("TRY AGAIN?",.5*O,.5*S+90,300,75,function(){return t.bi()},t.nt),i.scale={x:1,y:0},i}function j(t,i,n){return void 0===n&&(n=[]),(t=Ni.call(this,t=void 0===t?0:t,i=void 0===i?0:i,0,0)||this).children=[],(i=t.children).push.apply(i,n),t}function Qi(){this.offset=a,this.di=0,this.yi=0}function Ji(t,i,n,o,e,r,s){return(i=Hi.call(this,i-.5*o,n-.5*e,o,e)||this).content=t,i.li=r,i.nt=s,i.visible=!0,i}function D(){this.ri=!1}function $i(){zi=Math.min(window.innerWidth/O,window.innerHeight/S),_.style.transformOrigin="top left",tn=.5*(window.innerWidth-O*zi),nn=.5*(window.innerHeight-S*zi),_.style.transform="translate(".concat(tn,"px,").concat(nn,"px) scale(").concat(zi,")")}E.En=new lt(t.x,t.y,E,b,{G:["u","r","d","l"]}),E.En.lock(),E.V[2].content=E.En,_.id="game",_.width=O,_.height=S,document.body.appendChild(_);var zi=1,tn=0,nn=0,on=($i(),window.onresize=$i,!1),en=(document.onfullscreenchange=function(){return on=!on},document.onmousemove=function(t){g.x=on?t.x/window.innerWidth*O:t.offsetX,g.y=on?t.y/window.innerHeight*S:t.offsetY},document.onkeydown=function(t){b.nt.hi(),"f"==t.key&&_.requestFullscreen(),"p"==t.key&&(E.level++,b.et.create(1,1)),"c"==t.key&&(b.et.ft=1,b.et.create(1,0))},document.ontouchstart=function(t){b.click((t.touches[0].clientX-tn)/zi,(t.touches[0].clientY-nn)/zi)},document.onmousedown=function(t){b.nt.play(),g.C=!0,Li.A(g)&&(Li.visible=!1,b.nt.pop(),setTimeout(function(){b.ri||b.fn(),b.ri=!0},100))},document.onmouseup=function(t){return g.C=!1},1.2);requestAnimationFrame(function t(i){Wi[0].content="LIFE: ".concat(b.I,"/").concat(b.Ji),Wi[1].content=b.jt.toString(),requestAnimationFrame(t),T.resetTransform(),k(T,b.Dt.rotation,en,en),T.translate(0,b.ri?0:30),T.translate(b.Dt.offset.x,b.Dt.offset.y),T.fillStyle="#74be75",T.fillRect(-100,-100,_.width+200,_.height+200);var n=T;n.save(),k(n,.25*-Math.PI,1.5,1.5),n.fillStyle="#ffffff22";for(var o=0;o<5;o++)n.fillRect(200*o,0,100,999),n.fillRect(200*o-70,0,5,999),n.fillRect(200*o-35,0,5,999),n.fillRect(200*o+50,0,5,999);for(n.save(),k(n,.5*-Math.PI),o=0;o<5;o++)n.fillRect(200*o,0,100,999),n.fillRect(200*o-70,0,5,999),n.fillRect(200*o-35,0,5,999),n.fillRect(200*o+50,0,5,999);n.restore(),n.restore(),b.update(i,g);var e=Mi(Mi(Mi([b],b.Nt.wi(),!0),E.V,!0),[E.En],!1);e.sort(N),E.V.forEach(function(t){return t.wn(T)}),E.V.forEach(function(t){return t.Mn(T)}),e.forEach(function(t){return t.p(T)}),b.ri?(en=Math.max(1,en-.02),Wi.forEach(function(t){return t.p(T)}),b.Wi.p(T)):(T.resetTransform(),Gi.forEach(function(t){t.update(i,g),t.p(T),b.Wi.p(T)}))})</script>