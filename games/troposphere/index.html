<!doctype html><style>*{margin:0;padding:0}body,html{margin:0!important;padding:0!important;overflow:hidden}body{background-color:#000}canvas{border:5px solid #fff}#board{margin:auto}</style><div id=board><canvas></div><script>!function(t){var i={};function e(h){if(i[h])return i[h].exports;var s=i[h]={i:h,l:!1,exports:{}};return t[h].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,h){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var h=Object.create(null);if(e.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(h,s,function(i){return t[i]}.bind(null,s));return h},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=9)}([function(t,i){t.exports='<svg width="50" height="150" xmlns="http://www.w3.org/2000/svg" version="1.1"><g><rect height="72" width="25" y="41" x="12" fill="silver"></rect><rect height="1" width="1" y="431" x="242" fill="silver"></rect><rect height="42" width="9" y="106" x="12" fill="silver"></rect><rect transform="rotate(12 30,127)" height="42" width="9" y="106" x="25" fill="silver"></rect><rect height="46" width="9" y="52" x="5" stroke-width="1.5" fill="silver"></rect><ellipse ry="23" rx="23" cy="24" cx="24" fill="lightblue" stroke-width="1" stroke="white"></ellipse><ellipse ry="4" rx="4" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="150" xmlns="http://www.w3.org/2000/svg" version="1.1"><g><rect height="72" width="25" y="41" x="12" fill="silver"></rect><rect height="1" width="1" y="431" x="242" fill="silver"></rect><rect transform="rotate(12 30,127)" height="42" width="9" y="106" x="12" fill="silver"></rect><rect height="42" width="9" y="106" x="25" fill="silver"></rect><rect height="46" width="9" y="52" x="5" stroke-width="1.5" fill="silver"></rect><ellipse ry="23" rx="23" cy="24" cx="24" fill="lightblue" stroke-width="1" stroke="white"></ellipse><ellipse ry="4" rx="4" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="150" xmlns="http://www.w3.org/2000/svg" version="1.1"><g><rect height="72" width="25" y="41" x="12" fill="silver"></rect><rect height="1" width="1" y="431" x="242" fill="silver"></rect><rect height="42" width="9" y="106" x="12" fill="silver"></rect><rect height="42" width="9" y="92" x="28" fill="silver"></rect><ellipse ry="23" rx="23" cy="24" cx="24" fill="lightblue" stroke-width="1" stroke="white"></ellipse><ellipse ry="4" rx="4" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="150" xmlns="http://www.w3.org/2000/svg" version="1.1"><g><rect height="72" width="25" y="41" x="12" fill="silver"></rect><rect height="1" width="1" y="431" x="242" fill="silver"></rect><rect height="42" width="9" y="94" x="12" fill="silver"></rect><rect height="42" width="9" y="106" x="28" fill="silver"></rect><ellipse ry="23" rx="23" cy="24" cx="24" fill="lightblue" stroke-width="1" stroke="white"></ellipse><ellipse ry="4" rx="4" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="80" xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:rgb(60,60,60);stop-opacity:1"></stop><stop offset="20%" style="stop-color:rgb(55,55,55);stop-opacity:1"></stop><stop offset="20.1%" style="stop-color:rgb(85,85,85);stop-opacity:1"></stop><stop offset="90%" style="stop-color:rgb(0,0,0);stop-opacity:1"></stop><stop offset="100%" style="stop-color:rgb(58,58,58);stop-opacity:1"></stop></linearGradient></defs><g><rect width="44" height="40" fill="url(#grad)" x="0" y="40"></rect><ellipse ry="20" rx="20" cy="22" cx="22" fill="rgb(128,0,0)" stroke-width="2" stroke="black"></ellipse><ellipse ry="3" rx="3" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="80" xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:rgb(60,60,60);stop-opacity:1"></stop><stop offset="20%" style="stop-color:rgb(55,55,55);stop-opacity:1"></stop><stop offset="20.1%" style="stop-color:rgb(85,85,85);stop-opacity:1"></stop><stop offset="90%" style="stop-color:rgb(0,0,0);stop-opacity:1"></stop><stop offset="100%" style="stop-color:rgb(58,58,58);stop-opacity:1"></stop></linearGradient></defs><g><rect width="44" height="40" fill="url(#grad)" x="0" y="40"></rect><ellipse ry="20" rx="20" cy="22" cx="22" fill="rgb(255,0,0)" stroke-width="2" stroke="black"></ellipse><ellipse ry="3" rx="3" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:rgb(60,60,60);stop-opacity:1"></stop><stop offset="20%" style="stop-color:rgb(55,55,55);stop-opacity:1"></stop><stop offset="20.1%" style="stop-color:rgb(85,85,85);stop-opacity:1"></stop><stop offset="90%" style="stop-color:rgb(0,0,0);stop-opacity:1"></stop><stop offset="100%" style="stop-color:rgb(58,58,58);stop-opacity:1"></stop></linearGradient></defs><g><ellipse ry="28" rx="20" cy="30" cx="22" fill="url(#grad)"></ellipse><rect width="44" height="10" fill="url(#grad)" x="0" y="0"></rect><ellipse ry="20" rx="20" cy="22" cx="22" fill="rgb(128,0,0)" stroke-width="2" stroke="black"></ellipse><ellipse ry="3" rx="3" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:rgb(60,60,60);stop-opacity:1"></stop><stop offset="20%" style="stop-color:rgb(55,55,55);stop-opacity:1"></stop><stop offset="20.1%" style="stop-color:rgb(85,85,85);stop-opacity:1"></stop><stop offset="90%" style="stop-color:rgb(0,0,0);stop-opacity:1"></stop><stop offset="100%" style="stop-color:rgb(58,58,58);stop-opacity:1"></stop></linearGradient></defs><g><ellipse ry="28" rx="20" cy="30" cx="22" fill="url(#grad)"></ellipse><rect width="44" height="10" fill="url(#grad)" x="0" y="0"></rect><ellipse ry="20" rx="20" cy="22" cx="22" fill="rgb(255,0,0)" stroke-width="2" stroke="black"></ellipse><ellipse ry="3" rx="3" cy="14" cx="34" fill="white"></ellipse></g></svg>'},function(t,i){t.exports='<svg width="80" height="150" xmlns="http://www.w3.org/2000/svg" version="1.1"><rect width="80" height="150" fill="rgb(40, 40, 55)"></rect><rect width="10" height="10" fill="grey" x="30" y="40"></rect><rect width="10" height="10" fill="grey" x="50" y="10"></rect><rect width="10" height="10" fill="grey" x="10" y="30"></rect><rect width="10" height="10" fill="grey" x="60" y="60"></rect></svg>'},function(t,i,e){"use strict";e.r(i);let h,s,o={};function r(t,...i){o[t]&&o[t].map((t=>t(...i)))}function l(){return h}function n(){return s}class a{constructor({spriteSheet:t,frames:i,frameRate:e,loop:h=!0}={}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=h;let{width:s,height:o,margin:r=0}=t.frame;this.width=s,this.height=o,this.margin=r,this._f=0,this._a=0}clone(){return c(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:h=this.height,context:s=n()}={}){let o=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,o*this.height+(2*o+1)*this.margin,this.width,this.height,t,i,e,h)}}function c(t){return new a(t)}c.prototype=a.prototype,c.class=a,new WeakMap;const d=()=>{};function g(){let t=l();n().clearRect(0,0,t.width,t.height)}function f({fps:t=60,clearCanvas:i=!0,update:e,render:h}={}){if(!e||!h)throw Error("You must provide update() and render() functions");let s,o,l,n,a,c=0,f=1e3/t,p=1/t,y=i?g:d;function x(){if(o=requestAnimationFrame(x),l=performance.now(),n=l-s,s=l,!(n>1e3)){for(r("tick"),c+=n;c>=f;)a.update(p),c-=f;y(),a.render()}}return a={update:e,render:h,isStopped:!0,start(){s=performance.now(),this.isStopped=!1,requestAnimationFrame(x)},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:x,set _last(t){s=t}}}let p={},y={},x={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function w(t){let i=x[t.which];y[i]=!0,p[i]&&p[i](t)}function u(t){y[x[t.which]]=!1}function m(){y={}}function v(t,i){[].concat(t).map((t=>p[t]=i))}function b(t){return!!y[t]}class _{constructor({create:t,maxSize:i=1024}={}){let e;if(!t||!(e=t())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=i}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let i=this.objects.shift();return i.init(t),this.objects.push(i),this._i++,i}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let i,e=this.size-1,h=Math.max(this.objects.length-this._i,0);for(;e>=h;)(i=this.objects[e]).update(t),i.isAlive()?e--:(this.objects=this.objects.splice(e,1).concat(this.objects),this._i--,h++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let i=this.size-1;i>=t;i--)this.objects[i].render()}}function S(t){return new _(t)}function T(t,i){let e=[],h=i.x+i.width/2,s=i.y+i.height/2,o=t.y<s&&t.y+t.height>=i.y,r=t.y+t.height>=s&&t.y<i.y+i.height;return t.x<h&&t.x+t.width>=i.x&&(o&&e.push(0),r&&e.push(2)),t.x+t.width>=h&&t.x<i.x+i.width&&(o&&e.push(1),r&&e.push(3)),e}S.prototype=_.prototype,S.class=_;class A{constructor({maxDepth:t=3,maxObjects:i=25,bounds:e}={}){this.maxDepth=t,this.maxObjects=i;let h=l();this.bounds=e||{x:0,y:0,width:h.width,height:h.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map((function(t){t.clear()})),this._b=!1,this._o.length=0}get(t){let i,e,h=new Set;for(;this._s.length&&this._b;){for(i=T(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].get(t).forEach((t=>h.add(t)));return Array.from(h)}return this._o.filter((i=>i!==t))}add(){let t,i,e,h;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this._b)this._a(e);else if(this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;h=this._o[t];t++)this._a(h);this._o.length=0}}_a(t,i,e){for(i=T(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].add(t)}_sp(t,i,e){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,e=0;e<4;e++)this._s[e]=k({bounds:{x:this.bounds.x+(e%2==1?t:0),y:this.bounds.y+(e>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[e]._d=this._d+1,this._s[e]._p=this}}function k(t){return new A(t)}k.prototype=A.prototype,k.class=A;class M{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return L(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,h){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function L(t,i,e={}){let h=new M(t,i);return e._c&&(h.clamp(e._a,e._b,e._d,e._e),h.x=t,h.y=i),h}L.prototype=M.prototype,L.class=M;class P{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:h,dy:s,ddx:o,ddy:r,width:l,height:a,image:c}=t;this.position=L(i,e),this.velocity=L(h,s),this.acceleration=L(o,r),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=n();for(let i in t)this[i]=t[i];c&&(this.width=void 0!==l?l:c.width,this.height=void 0!==a?a:c.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,h=t.x,s=t.y;return t.anchor&&(h-=t.width*t.anchor.x,s-=t.height*t.anchor.y),i<h+t.width&&i+this.width>h&&e<s+t.height&&e+this.height>s}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function C(t){return new P(t)}function E(t){if(+t===t)return t;let i=[],e=t.split(".."),h=+e[0],s=+e[1],o=h;if(h<s)for(;o<=s;o++)i.push(o);else for(;o>=s;o--)i.push(o);return i}C.prototype=P.prototype,C.class=P;class R{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:h,animations:s}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:h},this._f=t.width/i|0,this.createAnimations(s)}createAnimations(t){let i,e;for(e in t){let{frames:h,frameRate:s,loop:o}=t[e];if(i=[],void 0===h)throw Error("Animation "+e+" must provide a frames property");[].concat(h).map((t=>{i=i.concat(E(t))})),this.animations[e]=c({spriteSheet:this,frames:i,frameRate:s,loop:o})}}}function O(t){return new R(t)}O.prototype=R.prototype,O.class=R;const V=t=>{let i=new Image;const e=btoa(t);return i.src="data:image/svg+xml;base64,"+e,i},j=(t=1)=>Math.random()*t,z=(t,i)=>(t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t))+t),G=(t,i)=>{const e=t.x-i.x,h=t.y-i.y;return Math.sqrt(e*e+h*h)},I={songData:[{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,2,255,0,0,32,255,3,130,4],p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,,,,,,,,,,,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[139,140,144,149,152,152,152,,,,,,,,,,134,135,139,144,147,147,147],f:[25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]},{n:[141,142,146,151,154,154,154,,,,,,,,,,136,137,141,146,149,149,149],f:[]}]},{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,61,4,1,2,109,86,7,32,0,3,67,2],p:[,,,,,,,,1,2,3,4,3,4,3,4,3,4,,,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,,,3,4,3,4,3,4,3,4,3,4,3,4,3,4],c:[{n:[,,,,,,,,104,,116,,,,,,,,,,,,,,111,,123],f:[25]},{n:[,,,,,,,,106,,118,,,,,,,,,,,,,,113,,125],f:[25]},{n:[,,116,,,,116,,104,,116,,,,116,,,,111,,,,111,,111,,123,,,,111],f:[25]},{n:[,,118,,,,118,,106,,118,,,,118,,,,113,,,,113,,113,,125,,,,113],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,,,,1,1,1,1,1,,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147,,147],f:[]}]},{i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[123,,,,123,,,,123,,,,123,,,,123,,,,123,,,,123,,,,123],f:[]}]},{i:[3,0,128,0,3,68,128,0,1,218,4,4,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,,,,,,,,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,123,,,,,,,,123,,,,,,,,123,,,,,,,,123],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,51,2,1,2,58,239,0,32,255,1,157,2],p:[1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2],c:[{n:[123],f:[25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,192,4,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,,,,,,,,,,,,,,,,,,,1,2,1,2,1,2,1,3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[139,140,144,149,152,152,152,,,,,,,,,,134,135,139,144,147,147,147],f:[15,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,4]},{n:[141,142,146,151,154,154,154,,,,,,,,,,136,137,141,146,149,149,149,,,,149,149,149],f:[]},{n:[141,142,146,151,154,154,154,,,,,,,,,,136,137,141,146,149,149,149],f:[]}]}],rowLen:5513,patternLen:32,endPattern:53,numChannels:7},D={songData:[{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:20,endPattern:0,numChannels:1},F={songData:[{i:[0,192,104,1,0,80,99,0,0,0,4,0,66,0,0,3,0,0,0,1,0,1,2,32,0,12,60,8],p:[1],c:[{n:[137],f:[27,28,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60,8]}]}],rowLen:5513,patternLen:8,endPattern:0,numChannels:1};function W(){var t,i,e,h,s,o=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*Math.pow(2,(t-128)/12)},l=function(t,i,e){var h,s,o,l,a,c,d,g=n[t.i[0]],f=t.i[1],p=t.i[3],y=n[t.i[4]],x=t.i[5],w=t.i[8],u=t.i[9],m=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,b=t.i[12]*t.i[12]*4,_=1/b,S=t.i[13],T=e*Math.pow(2,2-t.i[14]),A=new Int32Array(m+v+b),k=0,M=0;for(h=0,s=0;h<m+v+b;h++,s++)s>=0&&(s-=T,c=r(i+(15&(S=S>>8|(255&S)<<4))+t.i[2]-128),d=r(i+(15&S)+t.i[6]-128)*(1+8e-4*t.i[7])),o=1,h<m?o=h/m:h>=m+v&&(o-=(h-m-v)*_),l=c,p&&(l*=o*o),a=g(k+=l)*f,l=d,w&&(l*=o*o),a+=y(M+=l)*x,u&&(a+=(2*Math.random()-1)*u),A[h]=80*a*o|0;return A},n=[o,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(o){t=o,i=o.endPattern,e=0,h=o.rowLen*o.patternLen*(i+1)*2,s=new Int32Array(h)},this.generate=function(){var r,a,c,d,g,f,p,y,x,w,u,m,v,b,_=new Int32Array(h),S=t.songData[e],T=t.rowLen,A=t.patternLen,k=0,M=0,L=!1,P=[];for(c=0;c<=i;++c)for(p=S.p[c],d=0;d<A;++d){var C=p?S.c[p-1].f[d]:0;C&&(S.i[C-1]=S.c[p-1].f[d+A]||0,C<16&&(P=[]));var E=n[S.i[15]],R=S.i[16]/512,O=Math.pow(2,S.i[17]-9)/T,V=S.i[18],j=S.i[19],z=43.23529*S.i[20]*3.141592/44100,G=1-S.i[21]/255,I=1e-5*S.i[22],D=S.i[23]/32,F=S.i[24]/512,W=6.283184*Math.pow(2,S.i[25]-9)/T,H=S.i[26]/255,Y=S.i[27]*T&-2;for(u=(c*A+d)*T,g=0;g<4;++g)if(f=p?S.c[p-1].n[d+g*A]:0){P[f]||(P[f]=l(S,f,T));var N=P[f];for(a=0,r=2*u;a<N.length;a++,r+=2)_[r]+=N[a]}for(a=0;a<T;a++)(w=_[y=2*(u+a)])||L?(m=z,V&&(m*=E(O*y)*R+.5),M+=(m=1.5*Math.sin(m))*(v=G*(w-M)-(k+=m*M)),w=3==j?M:1==j?v:k,I&&(w=(w*=I)<1?w>-1?o(.25*w):-1:1,w/=I),L=(w*=D)*w>1e-5,b=w*(1-(x=Math.sin(W*y)*F+.5)),w*=x):b=0,y>=Y&&(b+=_[y-Y+1]*H,w+=_[y-Y]*H),_[y]=0|b,_[y+1]=0|w,s[y]+=0|b,s[y+1]+=0|w}return++e/t.numChannels},this.createWave=function(){var t=44+2*h-8,i=t-36,e=new Uint8Array(44+2*h);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var o=0,r=44;o<h;++o){var l=s[o];l=l<-32767?-32767:l>32767?32767:l,e[r++]=255&l,e[r++]=l>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),h=new Array(i),o=0;o<2*i;o+=1){var r=e+o;h[o]=t>0&&r<s.length?s[r]/32768:0}return h}}const H=document.createElement("audio"),Y=document.createElement("audio"),N=document.createElement("audio"),U=(t,i,e)=>new Promise((h=>{var s=new W;s.init(i);var o=!1;setInterval((function(){if(!o&&(o=s.generate()>=1)){var i=s.createWave();t.src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),t.loop=e,h()}}),0)})),q=t=>{switch(t){case"main":H.currentTime=0,H.volume=.9;var i=H.play();void 0!==i&&i.then((()=>{})).catch((t=>{console.log("No for autoplay!"+t)}));break;case"end":N.play();var e=H.volume,h=setInterval((function(){(e=(parseFloat(e)-.2).toFixed(1))>=0?H.volume=e:(H.pause(),clearInterval(h))}),100);break;case"hit":Y.currentTime=0,Y.play()}};var B=e(0),J=e.n(B),Z=e(1),K=e.n(Z),Q=e(2),X=e.n(Q),$=e(3),tt=e.n($);const it=V(J.a),et=V(K.a),ht=V(X.a),st=V(tt.a),ot=t=>C({width:30,height:90,xVel:0,yVel:0,latestOnPlatformTime:0,state:0,fallingToGround:!1,stopClimbing:!1,moveLeft:!1,moveLeftFoot:0,image:it,walkingSpeed:5,ag:!1,energy:1e4,timeTravelFrames:0,swirlingStartTime:void 0,swirlingAngle:0,hidden:!1,isTimeTravelling:!1,isOnGround(){return this.y+this.height>t.height-5},isDead(){return 3===this.state},isSwirling(){return 4===this.state},swirl(){4!=this.state&&(this.state=4,this.swirlingStartTime=performance.now())},render(){if(!this.hidden){if(this.context.save(),this.context.translate(this.x,this.y),this.isTimeTravelling&&this.context.translate(j(10),j(10)),4===this.state){const t=.6+.4*Math.sin(this.swirlingAngle);this.context.scale(t,t),this.context.rotate(this.swirlingAngle),this.context.translate(-this.width/2,-this.height/2),this.swirlingAngle+=Math.PI/32}else this.fallingToGround?(this.context.translate(0,this.height),this.context.rotate(-Math.PI/2)):2===this.state?this.moveLeftFoot<5?this.image=ht:this.image=st:(this.moveLeft&&(this.context.translate(this.image.width/2,0),this.context.scale(-1,1),this.context.translate(-this.image.width/2,0)),this.moveLeftFoot<this.walkingSpeed?this.image=it:this.image=et);this.moveLeftFoot>2*this.walkingSpeed&&(this.moveLeftFoot=0),this.context.scale(30/this.image.width,90/this.image.height),this.context.drawImage(this.image,0,0),this.context.restore()}},_findLadderCollision(t){let i,e;for(let h=0;h<t.length;h++){let s=t[h];s.collidesWith(this)&&(i=!0,s.y<this.y&&this.y<s.y+s.height&&(e=!0))}return{collision:i,collidesHigh:e}},hit(t){Math.abs(this.xVel)<100&&(this.xVel+=t)},update(t,i,e){if(3===this.state)return;const h=performance.now();if(4===this.state)return void(!this.hidden&&h-this.swirlingStartTime>500&&(this.hidden=!0,this.y=-200));const s=this._findPlatform(i);s&&(this.latestOnPlatformTime=h);let o={dx:0,dy:0},r=this._findLadderCollision(t);r.collision||2!==this.state?this.yVel>40&&!this.ag?this.fallingToGround||(this.fallingToGround=!0,this._turnHorizontally()):this.fallingToGround||(o=this._handleControls(h,r,s)):this.state=1;let{dx:l,dy:n}=o;0!==this.xVel&&(l+=this.xVel,Math.abs(this.xVel)>4?this.xVel*=.97:this.xVel=0),1===this.state&&(this.yVel+=this.ag?.5:1,n+=this.yVel),this._updateHorizontalPosition(l),this._updateVerticalPosition(e,s,n)},_screenShake(t){const i=Math.min(80,Math.max(this.yVel-20,0))/80*20;t.shake(i,.5)},_turnHorizontally(){let t=this.width,i=this.height;this.width=i,this.height=t},_handleControls(i,e,h){let s=0,o=0;(b("left")||b("a"))&&this.x>0?(s=-7,this.moveLeft=!0,1!==this.state&&this.moveLeftFoot++):(b("right")||b("d"))&&this.x<t.width-this.width&&(s=7,this.moveLeft=!1,1!==this.state&&this.moveLeftFoot++);const r=b("up")||b("w");return r||(this.stopClimbing=!1),r&&!this.stopClimbing||b("space")||b("g")?(2===this.state&&0===s&&h&&!e.collidesHigh?(this.state=0,this.stopClimbing=!0):!(h||i-this.latestOnPlatformTime<200||this.isOnGround())||0===s&&e.collidesHigh?this.yVel>=0&&e.collision&&(this.state=2,this.yVel=0,o-=2):(this.yVel=-15,this.state=1,this.latestOnPlatformTime=0),2===this.state&&this.moveLeftFoot++):(b("down")||b("s"))&&e.collision&&(this.state=2,this.yVel=0,o+=2,this.moveLeftFoot++),{dx:s,dy:o}},_updateHorizontalPosition(i){this.x+i>t.width-this.width?(this.x=t.width-this.width,this.xVel=0):this.x+i<t.left?(this.x=t.left,this.xVel=0):0!==i&&(this.x+=i)},_updateVerticalPosition(i,e,h){if(this.y+h>t.height-this.height)this.y=t.height-this.height,this.fallingToGround?(this._screenShake(i),this.state=3,q("end")):this.state=0,this.yVel=0;else if(this.fallingToGround)this.state=1,this.y+=h;else if(2===this.state)this.y+=h;else if(h>0&&e){const t=5;this.y=e.y-this.height+t,this.yVel=0,this.state=0}else this.state=1,this.y+=h},_findPlatform(t){for(let i=0;i<t.length;i++){let e=t[i];if(this.collidesWith(e)&&this.y+this.height<e.y+e.height)return e}}});var rt=e(4),lt=e.n(rt),nt=e(5),at=e.n(nt);const ct=V(lt.a),dt=V(at.a),gt=t=>C({width:30,height:80,color:"black",dx:j(6)+1,image:ct,update(){this.advance();let i=this.dx;(t.x+t.width-this.width<this.x||this.x<t.x)&&(this.dx=-i)},render(){this.context.save(),this.context.translate(this.x,this.y),this.context.drawImage(this.image,0,0),this.context.restore()},collidesWith(t){return this.x<t.x+t.width-10&&this.x+this.width-10>t.x&&this.y<t.y+t.height-20&&this.y+this.height-20>t.y},hit(){this.image=dt,setTimeout((()=>{this.image=ct}),1e3)}});var ft=e(6),pt=e.n(ft),yt=e(7),xt=e.n(yt);const wt=V(pt.a),ut=V(xt.a),mt=(t,i)=>C({width:60,height:60,wayPoints:i,target:null,image:wt,SPEED:j(1)/2+1,PLAYER_FOLLOW_DISTANCE:j(600)+100,update(){this.advance();let i=0,e=0;this.target||this._pickTarget(),!t.isDead()&&!t.isSwirling()&&G(this,t)<this.PLAYER_FOLLOW_DISTANCE?(i=t.x-this.x,e=t.y-this.y,this.image=ut):this.target&&(this.image=wt,G(this,this.target)>200?(i=this.target.x-this.x,e=this.target.y-this.y):this._pickTarget()),this.dx=Math.sign(i)*this.SPEED,this.dy=Math.sign(e)*this.SPEED},_pickTarget(){this.target=i[Math.floor(j(100))%i.length]},hit(){},render(){this.context.save(),this.context.translate(this.x,this.y),this.context.drawImage(this.image,0,0),this.context.restore()},collidesWith(t){return this.x<t.x+t.width-20&&this.x+this.width-20>t.x&&this.y<t.y+t.height-20&&this.y+this.height-20>t.y}}),vt=()=>C({width:200,height:200,colorValue:0,colorUp:!0,render(){this.context.globalAlpha=.7,this.context.fillStyle="rgb(255,150,"+this.colorValue.toString()+")",this.context.fillRect(this.x,this.y,this.width,this.height),this._oscillateColor(),this.context.globalAlpha=1},collidesWith(t){const i=this.width*(3/8),e=this.height*(3/8);return this.x<t.x+t.width-i&&this.x+this.width-i>t.x&&this.y<t.y+t.height-e&&this.y+this.height-e>t.y},_oscillateColor(){this.colorUp?this.colorValue<255?this.colorValue++:this.colorUp=!1:this.colorValue>0?this.colorValue--:this.colorUp=!0}});var bt=e(8);const _t=V(e.n(bt).a),St=V(J.a);let{canvas:Tt,context:At}=function(t){if(!(h=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(s=h.getContext("2d")).imageSmoothingEnabled=!1,r("init"),{canvas:h,context:s}}();!function(){let t;for(t=0;t<26;t++)x[65+t]=(10+t).toString(36);for(t=0;t<10;t++)x[48+t]=""+t;window.addEventListener("keydown",w),window.addEventListener("keyup",u),window.addEventListener("blur",m)}();let kt,Mt=!1,Lt=!1,Pt=[],Ct=[],Et=[],Rt=[],Ot=[],Vt=[],jt=[],zt=[],Gt=0,It=!1,Dt=0,Ft={left:0,top:0,width:4e3,height:4e3},Wt=((t,i)=>({x:0,y:0,zoom:1,shakePower:0,shakeDecay:0,follow(t){this.zoom=1,this.target=t},zoomToLevel(){this.target=null,this.x=t.left+t.width/2,this.y=t.top+t.height/2,t.width/t.height>=i.width/i.height?this.zoom=i.width/t.width:this.zoom=i.height/t.height},shake(t=8,i=.5){this.shakePower=t,this.shakeDecay=t/i},update(){this.target&&(this._fitZoom(),this._follow()),this._shake()},_shake(){const{shakePower:t}=this;t<=0||(this.x+=j(2*t)-t,this.y+=j(2*t)-t,this.shakePower-=this.shakeDecay*(1/60))},_fitZoom(){const e=t.width*this.zoom,h=t.height*this.zoom;(e<i.width||h<i.height)&&(this.zoom=Math.max(i.width/t.width,i.height/t.height))},_follow(){let e=this.target.x+this.target.width,h=this.target.y+this.target.height;const s=i.width/this.zoom,o=i.height/this.zoom;e-s/2<t.left?e=t.left+s/2:e+s/2>t.width&&(e=t.width-s/2),h-o/2<t.top?h=t.top+o/2:h+o/2>t.height&&(h=t.height-o/2),this.x=e,this.y=h}}))(Ft,Tt);const Ht=(t,i)=>{if(t.positions||(t.positions=[]),i){if(t.positions.length>0){let i=t.positions.pop();t.position=i}}else t.positions.push(t.position),t.positions.length>120&&t.positions.shift(),t.update()},Yt=t=>{if(It)return;t.hit(),q("hit"),kt.energy>=1e3&&(kt.energy-=1e3);const i=t.x+t.width/2,e=kt.x+kt.width/2,h=Math.sign(e-i);kt.hit(20*h)},Nt=()=>f({update(){},render(){At.clearRect(0,0,Tt.width,Tt.height);let t=At.createLinearGradient(0,Tt.height/2,0,Tt.height);t.addColorStop(0,"rgb(0,0,25"),t.addColorStop(.2,"rgb(255,0,0)"),t.addColorStop(.3,"rgb(255,200,0)"),t.addColorStop(.8,"rgb(80,80,200)"),t.addColorStop(1,"rgb(100,100,255)"),At.fillStyle=t,At.fillRect(0,0,Tt.width,Tt.height),At.drawImage(St,.8*Tt.width,Tt.height/3),ni(Lt?"Press enter to start          ":"Loading.............          ")}}),Ut=()=>{for(let t=0;t<Pt.length;t++)Pt[t].render();for(let t=0;t<Vt.length;t++)Vt[t].render();for(let t=0;t<Ot.length;t++)Ot[t].render();for(let t=0;t<Rt.length;t++)Rt[t].render();for(let t=0;t<Et.length;t++)Et[t].render();for(let t=0;t<zt.length;t++)zt[t].render();for(let t=0;t<jt.length;t++)jt[t].render();kt.render();for(let t=0;t<Ct.length;t++)Ct[t].render();Wt.target||(At.save(),At.strokeStyle="red",At.lineWidth=5,At.beginPath(),At.lineTo(0,0),At.lineTo(Ft.width,0),At.lineTo(Ft.width,Ft.height),At.lineTo(0,Ft.height),At.closePath(),At.stroke(),At.restore())},qt=()=>{kt&&kt.isDead()?ei("Press ENTER to try again"):It&&(hi("CONGRATULATIONS!       ","YOU ARE ON YOUR WAY TO BACK HOME!      ","(Press ESC to continue)"),Gt=1)},Bt=()=>{(()=>{At.fillStyle="white",At.font="20px Sans-serif",At.fillText("ENERGY",50,35),At.fillText("LEVEL",Tt.width-120,35),At.fillText(Gt,Tt.width-40,35);const t=Tt.width/4,i=t-10,e=kt.energy/1e4*i;At.lineWidth=2,At.strokeStyle="white",At.strokeRect(50,50,t,50);let h="green";kt.energy<2e3?h="red":kt.energy<4e3&&(h="orange"),At.fillStyle=h,At.fillRect(55,55,e,40)})(),At.font="1em Sans-serif",At.fillStyle="black",At.globalAlpha=.1,At.fillRect(0,0,Tt.width/4+100,290),At.globalAlpha=.9,kt.ag?(At.fillStyle="white",At.fillText("ANTI-GRAVITY ACTIVATED",50,150)):(At.fillStyle="lightgray",At.fillText("ANTI-GRAVITY OFF",50,150)),At.fillText("[space] or [G]",50,170),Mt?(At.fillStyle="white",At.fillText("TIME TRAVELING ACTIVATED",50,220)):(At.fillStyle="lightgray",At.fillText("TIME TRAVELING OFF",50,220)),At.fillText("[T]",50,240),At.globalAlpha=1},Jt=(t,i,e)=>C({x:Math.random()*Ft.width*(5/4)-Ft.width/4,y:0===i?t+(200*Math.random()-102120):t+(200*Math.random()-100),color:"white",opacity:0===i?.95*e:.7*e,dx:0===i?.07+.1*Math.random():.05+.1*Math.random(),radius:20+Math.random()*Math.random()*70,update:function(){this.advance(),this.x-300>Ft.width&&(this.x=-600)},render:function(){let t=this.context;t.save(),t.fillStyle=this.color,t.globalAlpha=this.opacity,t.beginPath();let i=this.x,e=this.y;t.moveTo(i,e),t.bezierCurveTo(i-40,e+20,i-40,e+70,i+60,e+70),this.radius<45&&t.bezierCurveTo(i+80,e+100,i+150,e+100,i+170,e+70),t.bezierCurveTo(i+250,e+70,i+250,e+40,i+220,e+20),t.bezierCurveTo(i+260,e-40,i+200,e-50,i+170,e-40),t.bezierCurveTo(i+150,e-75,i+80,e-60,i+80,e-40),t.bezierCurveTo(i+30,e-75,i-20,e-60,i,e),t.closePath(),t.fill(),t.restore()}}),Zt=()=>C({color:"rgb(100,60,60)",color2:"rgb(80,20,20)",width:30,height:Ft.height,stepGap:j(25)+5,render:function(){const t=this.height/this.stepGap+1;let i=this.context;i.save();for(let e=0;e<t;e++)i.fillStyle=this.color2,i.fillRect(this.x+8,this.y+e*this.stepGap,this.width-16,this.stepGap/2),i.fillStyle=this.color,i.fillRect(this.x,this.y+e*this.stepGap+this.stepGap/2,this.width,this.stepGap/2);i.restore()}}),Kt=t=>C({color:"darkgray",color2:"rgb(80,80,80)",color3:"rgb(55,55,75)",width:200,height:t?400:20,opacity:.1,render:function(){const i=this.height/20;let e=this.context;if(e.save(),t)e.globalAlpha=this.opacity,e.fillStyle=this.color3,e.fillRect(this.x,this.y,this.width,this.height),e.strokeStyle=this.color3,e.lineWidth=1,e.strokeRect(this.x,this.y,this.width,this.height);else for(let t=0;t<i;t++)e.fillStyle=this.color2,e.fillRect(this.x+2,this.y+20*t,this.width-4,10),e.fillStyle=this.color,e.fillRect(this.x,this.y+20*t+15,this.width,10);e.restore()}}),Qt=()=>C({color:"darkgray",width:Ft.width,height:30,x:0,y:Ft.height-30,render:function(){let t=this.context;t.save(),t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.restore()}}),Xt=(t,i)=>{for(let e=0;e<20;e++){let e=Jt(t,0,i);Pt.push(e)}for(let e=0;e<20;e++){let e=Jt(t,1,i);Ct.push(e)}},$t=t=>{for(let i=0;i<Tt.width/10;i++){let e=C({width:80,height:150-100*Math.random(),render:function(){this.context.drawImage(_t,this.x,this.y)}});if(e.x=i*Math.random()*100,e.y=Ft.height-e.height,Vt.push(e),t){let t=C({width:80,height:150-100*Math.random(),render:function(){this.context.drawImage(_t,this.x,this.y)}});t.x=e.x,t.y=e.y-e.height,Vt.push(t)}}},ti=(t,i,e)=>{const h=t.width/6;for(let s=0;s<e;s++){let e=Zt();e.height=i,e.x=t.x+Math.floor(j(6))*h+h/2,e.y=t.y,Et.push(e)}},ii=(t,i)=>{let e=!1;for(let h=0;h<i;h++){const i=Ft.height-300*(h+1),s=t-400,o=s+800;if(e||j()<.8){let t=Kt(!1);if(t.width=800,t.x=s,t.y=i,Rt.push(t),ti(t,300,z(1,4)),j()<.7){let e=gt(t);e.x=s+j(800-e.width),e.y=i-e.height,jt.push(e)}e=!1}else{const t=800/3;let h=Kt(!1);h.width=t,h.x=s,h.y=i,Rt.push(h),ti(h,300,1);let r=Kt(!1);r.width=t,r.x=o-t,r.y=i,Rt.push(r),ti(r,300,1),e=!0}let r=Kt(!0);r.width=800,r.x=s,r.y=i,Ot.push(r)}return{x:t,width:800,height:300*i,top:Ft.height-300*i,bottom:Ft.height,left:t-400,right:t+400}},ei=t=>{hi(t)},hi=(...t)=>{At.fillStyle="white",At.font="22px Sans-serif";for(let i=0;i<t.length;i++){const e=t[i];let h=14*e.length;const s=Tt.width/2-h/2;let o=.25*Tt.height+40*i;At.fillText(e,s,o)}};let si=Nt();const oi=[()=>{},()=>{Ft.width=2e3,Ft.height=1500,$t(!0);const t=ii(1e3,3);let i=vt();i.x=t.x-i.width/2,i.y=t.top-i.height,zt.push(i),(kt=ot(Ft)).x=100,kt.y=Ft.height-kt.height},()=>{Ft.width=4e3,Ft.height=4e3,Xt(2400,1),Xt(1200,.8),$t(!1),Vt.push(Qt());const t=ii(1400,7),i=ii(2500,10);let e=vt();e.x=i.right-i.width/3,e.y=i.top-e.height,zt.push(e),(kt=ot(Ft)).x=1100,kt.y=Ft.height-kt.height;const h=[{x:t.left-200,y:t.top+300},{x:t.left-200,y:t.bottom-t.height/2},{x:t.x,y:t.top-300},{x:i.left-200,y:i.top+300},{x:i.left-200,y:i.bottom-i.height/2},{x:i.x,y:i.top-300},{x:i.right+200,y:i.bottom-i.height/2}];for(let t=0;t<8;t++){let t=mt(kt,h);t.x=j(Ft.width),t.y=j(Ft.height-500),jt.push(t)}},()=>{Ft.width=5e3,Ft.height=6e3,Xt(4400,.7),Xt(2200,.5),Vt.push(Qt()),ii(.25*Ft.width+100,8);const t=ii(.5*Ft.width,15);ii(.75*Ft.width-100,12);let i=vt();i.x=t.x,i.y=t.top-i.height,zt.push(i),(kt=ot(Ft)).x=1100,kt.y=Ft.height-kt.height;const e=[{x:t.left-200,y:t.top-500},{x:t.left-200,y:t.top+1e3},{x:t.left-200,y:t.top+4e3},{x:t.right+200,y:t.top-300},{x:t.right+200,y:t.top+1500},{x:t.right+200,y:t.top+4500}];for(let t=0;t<12;t++){let t=mt(kt,e);t.x=j(Ft.width),t.y=j(Ft.height-500),jt.push(t)}}],ri=t=>{t>=oi.length?It=!0:(si.stop(),It=!1,Et=[],Rt=[],Ot=[],Pt=[],Ct=[],Vt=[],jt=[],zt=[],(0,oi[t])(),v(["esc"],(()=>{ri(Gt=0)})),0===t?si=Nt():(Wt.follow(kt),si=f({update(){let t=b("t");Mt=t;let i=b("space")||b("g"),e=!1;t?(e=(()=>{if(kt.energy>=35&&kt.timeTravelFrames<120)return kt.energy-=35,kt.timeTravelFrames+=1,!0})())&&(kt.isTimeTravelling=!0):(kt.timeTravelFrames>0&&(kt.timeTravelFrames-=1),kt.isTimeTravelling=!1),t&&!e||((t,i)=>{for(let i=0;i<Pt.length;i++)Ht(Pt[i],t),Ht(Ct[i],t);for(let i=0;i<jt.length;i++){let e=jt[i];Ht(e,t),e.collidesWith(kt)&&Yt(e)}t||(i&&kt.energy>=5?(kt.energy-=5,kt.ag=!0):kt.ag=!1,kt.update(Et,Rt,Wt));for(let t=0;t<zt.length;t++)zt[t].collidesWith(kt)&&0===Dt&&(Dt=1,kt.swirl(),setTimeout((()=>{ri(++Gt)}),1500))})(t,i),Wt.update()},render(){let t;switch(At.save(),At.translate(Tt.width/2,Tt.height/2),At.scale(Wt.zoom,Wt.zoom),At.translate(-Wt.x,-Wt.y),t=At.createLinearGradient(0,0,0,Ft.height),Gt){case 1:t.addColorStop(0,"rgb(80,80,200)"),t.addColorStop(1,"rgb(100,100,255)");break;case 2:t.addColorStop(0,"rgb(255,200,0)"),t.addColorStop(1,"rgb(80,80,200)");break;case 3:t.addColorStop(0,"rgb(0,0,25"),t.addColorStop(.5,"rgb(255,0,0)"),t.addColorStop(1,"rgb(255,200,0)")}At.fillStyle=t,At.fillRect(0,0,Ft.width,Ft.height),Ut(),At.restore(),Bt(),qt()}})),1===t&&q("main"),Dt=0,si.start())},li=()=>{Tt.width=window.innerWidth-10,Tt.height=window.innerHeight-10},ni=t=>{hi("TROPOSPHERE                        ","","You are lost in a metropolis in a foreign planet.         ","You need to find your way to back home by                 ","using portals and climbing higher into Troposphere.       ","","Controls                                                   ","Use ARROWS or W/A/S/D to move. Jump with UP or W.          ","Press SPACE or G for anti-gravity jump (longer!/higher!)   ","Hold T for time travel (uses lots of energy!)              ","","(c) 2019 by Sami H & Tero J          ","",t)};window.addEventListener("resize",li,!1),li(),v(["enter"],(()=>{0===Gt&&Lt?ri(Gt=1):kt&&kt.isDead()&&(q("main"),ri(Gt))})),Promise.all([U(H,I,!0),U(Y,F,!1),U(N,D,!1)]).then((()=>{Lt=!0})),ri(Gt=0)}])</script>