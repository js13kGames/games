<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="initial-scale=1,width=device-width,user-scalable=no,viewport-fit=cover,maximum-scale=1,user-scalable=no"/><title>Khilji's Folly - A historic hill defense game for js13k 2023</title><style>body,html{width:100%;height:100%;min-height:fill-available;margin:0;padding:0}body{background-color:#000;display:grid;place-items:center}#gameCanvas{background:linear-gradient(#b2d4e5 0,#eef3f6 75%);display:block;max-width:100vw}@media all and (display-mode:fullscreen){#gameCanvas{width:calc(100vw - 20px)}}</style></head><body><script>function playAudioFx(which) {
        let notes = [[15], [, , , , 14, 14, 12], [, , 3, 4, 4, 5, 6, 7]];
        let context = new AudioContext();
        let gain = context.createGain();

        for (let i in notes[which]) {
          if (notes[which][i]) {
            let osc = context.createOscillator();
            osc.connect(gain);
            gain.connect(context.destination);
            osc.start(i * 0.12);
            osc.frequency.setValueAtTime(100 * 1.06 ** (13 - notes[which][i]), i * 0.12);
            osc.type = "triangle";
            gain.gain.setValueAtTime(1, i * 0.12);
            gain.gain.setTargetAtTime(0.0001, i * 0.12 + 0.1, 0.005);
            osc.stop(i * 0.12 + 0.11);
          }
        }
      }</script><script>(()=>{"use strict";var t=1280,i=720,h={};function s(t,i,s){return t in h||(h[t]=0),i?Date.now()-h[t]>s&&(h[t]=Date.now(),!0):i}function n(t){try{!function(t){var i=navigator.getGamepads().filter((function(t){return!!t}));if(0===i.length)return;var h=i[0];t.t=!1,t.i=!1,t.h=!1,t.o=!1,t.A=!1,t.u=!1,o(h.buttons[0])&&(t.t=!0);o(h.buttons[1])&&(t.i=!0);o(h.buttons[12])&&(t.o=!0);o(h.buttons[13])&&(t.h=!0);o(h.buttons[14])&&(t.A=!0);o(h.buttons[15])&&(t.u=!0)}(t)}catch(t){}}function o(t){return"object"==typeof t?t.pressed:1===t}var r,e=function(){function h(t){this.v=t,this.g=[]}return h.prototype.initialize=function(){for(var h=400,s=0;s<4;s+=1){var n={color:"rgba(67, 99, 79, ".concat((20+10*s)/100,")"),points:[]},o=0;n.points.push([o,h]);for(var r=0;r<100;r++){o+=60+100*Math.random();var e=h+40*Math.random()*(Math.random()>.5?1:-1);n.points.push([o,e])}n.points.push([t,i]),n.points.push([0,i]),n.points.push([0,i]),this.g.push(n),h+=70}},h.prototype.l=function(t){for(var i=0,h=this.g;i<h.length;i++){var s=h[i];this.p(t,s)}},h.prototype.p=function(t,i){t.beginPath(),t.strokeStyle="transparent",t.fillStyle=i.color;var h=i.points;t.moveTo(h[0][0],h[0][1]);for(var s=1;s<h.length-1;s++){var n=(h[s][0]+h[s+1][0])/2,o=(h[s][1]+h[s+1][1])/2;t.quadraticCurveTo(i.points[s][0],i.points[s][1],n,o)}t.closePath(),t.fill(),t.stroke()},h}(),a=function(){function t(t){this.v=t,this.S=[],this.m=[]}return t.prototype.k=function(){for(var t=this.S.length;t--;){var i=this.S[t];(s=this.v.M.indexOf(i))>-1&&this.v.M.splice(s,1),this.S.splice(t,1)}for(var h=this.m.length;h--;){var s,n=this.m[h];(s=this.v.C.indexOf(n))>-1&&this.v.C.splice(s,1),this.m.splice(h,1)}},t.prototype.I=function(t){this.S.push(t)},t.prototype.U=function(t){this.m.push(t)},t}(),A="IDLE",u="MENU",c="STARTED",f="ENDED",w=function(){function t(t){this.v=t}return t.prototype.l=function(t){if(this.v.state===c){var i="Controls";t.font="normal 16px Courier New",t.fillStyle="#808080",t.textAlign="end",t.fillText(i,1220,70);i="[Left/Right Arrow]/[DPad ← / → ] to move your Monk";t.font="normal 16px Courier New",t.fillStyle="#808080",t.textAlign="end",t.fillText(i,1220,100);i="[Up/Down Arrow]/[DPad ↑ / ↓ ] to adjust aim";t.font="normal 16px Courier New",t.fillStyle="#808080",t.textAlign="end",t.fillText(i,1220,130);i="[F]/[ B ] to cycle through ammo types";t.font="normal 16px Courier New",t.fillStyle="#808080",t.textAlign="end",t.fillText(i,1220,160);i="[SPACE]/[ A ] to shoot!";t.font="normal 16px Courier New",t.fillStyle="#808080",t.textAlign="end",t.fillText(i,1220,190),t.textAlign="start";for(var h=0,s=[[985,98],[1025,98],[1023,127],[1062,127],[927,156],[1100,186]];h<s.length;h++){var n=s[h];t.beginPath(),t.strokeStyle="#808080",t.arc(n[0],n[1],10,0,2*Math.PI),t.stroke()}}},t}();!function(t){t[t.R=0]="BASIC",t[t.D=1]="FAST",t[t.G=2]="HEAVY"}(r||(r={}));var v=new Image;v.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAAAjCAMAAAB4v7JNAAAARVBMVEX////ExMTMi3uenp5RTUgoKCdzbGu3e21hPAlSWVSuSEhzUB5zShK0NjYmJiZILQcTGBUjHBIAAAAYCARAFQquiEi3kl78vsLlAAAAAXRSTlMAQObYZgAAA0NJREFUWMO1mNvCoygQhKvSTQcPKyL97/s/6l5ojKCTbGYmXhlSfF00BOgA7UO8e76k4O2d5n80/AUGAFaNomy7tJ3kO4yGEtTehLFg32HUiVK7vZnToPdvMQ4ixmuvhwGF7v41xpPS9/3Al5TbGI1fYzxEEmL/D1955dD3/RcZK0YmDeOYXlE06NjLK0b4QwZABg1zirHbKNbkj0QXwjSOKt9kALQh5jnHOwFQllJaMTWlOae4bRSyZF4wpnn6IwaAe5/mmbwBXEpxz63gdh/SPNuNAGRZcplOo2kYefqcAfDeh5kgqSW753P+bvchz8SNkKVkz4FfYJCcYpoNEC3Z3d31pBh+wmwAZcl+EYZkODLyZwySBCTkFFJKZsPg7omwJGdF9GAcPGd3E99/H5cM/4BBo6m7m2kIUUMaNeRhiG4A1zUvlUJjDCENyT0B4nJW/B5jMvH1ScscNETV6D4MP7fHTignRQwebXB5nKtnRmwY01uGLPKQrJqoOvwk933iLhXRffh3d/oXGJCFT0nKWVXVB9Mj5KyIP+qvFZ8yIIZd4p6SqiYfTZ4HKGdeKMScV2GuGdeKI6Mx4qqa3EdP8oswq2IcVQSvFJ8yIAtZSdL6IuA7Bd8xjHyrOBqB7oocwvbG/YLxa8UjzrLIbzIER69Qd1/PIM4zAVsh27MY1tmzXSHrfrdRKCKr4smgu6fnMluWtcnwjCKb1YPX5MflC9DrX97acrxjSLVzk6A1Ci3u3X5Z7nRlHE8VKfn4+bFYq4PHPZddILK6t1qh9XUnNAopeYfShICejJRjDwG8SQjgnRTbjRAMjUTas4yhNIpSaHasa1IzFpTOHDX0mcTNiKA7VkmSG6snI8cEbGEMbGazuQIVEa8XRC48GWGpIZUPuufWiLTjFcCqNcBSRymsjRintg5xQKoJb1LGRAkNFM62pTYiaO6vBayN4HRFcqCr1pXW5axZnTGwA7wZL05GWE8vUZkXQuRkpO5TWHvXZrQwXhlhlVUBDsOhyNb4TAhgp/KjLpoLjs4orBnre+0d1lTeIpWzx15YN7QpaTPUVWY3vlRBT0ZOd+buqoRpS89yWiM1VC7+Wyltg/Ll13xRMP8Hz0dM8/b5wXAAAAAASUVORK5CYII=";var g=new Image;g.src="data:image/png;base64,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";var l=new Image;l.src="data:image/png;base64,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";var p=function(){function t(t,i){this.v=t,this.type=i,i==r.R?(this.y=672,this.speed=2,this.B=2,this.N=4,this.K=13):i==r.G?(this.y=673,this.speed=1.5,this.B=4,this.N=4,this.K=20):i==r.D&&(this.y=670,this.speed=4,this.B=1,this.N=4,this.K=13),this.Z=0,this.x=30,this.isActive=!0}return t.prototype.k=function(){this.v.state===c&&(this.x>1250&&(this.isActive=!1,this.v.T.V(),this.v.L.I(this)),this.x+=.25*this.speed*this.v.level.O)},t.prototype.l=function(t){if(this.isActive){var i;this.type==r.R?(i=v,this.Z+=.2):this.type==r.D?(i=g,this.Z+=.15):this.type==r.G&&(i=l,this.Z+=.15);var h=Math.floor(this.Z),s=i.width/this.N,n=i.height;t.drawImage(i,h*s,0,s,n,this.x-s/2,this.y-n/2,s,n),this.X(t),this.Z>=this.N&&(this.Z=0),this.v.q&&(t.beginPath(),t.arc(this.x,this.y,this.K,0,2*Math.PI),t.strokeStyle="rgba(0, 0, 0, 1)",t.stroke())}},t.prototype.X=function(t){for(var i=0;i<this.B;i++){t.fillStyle="red",t.beginPath();var h=this.x+7*i-this.B/2*7,s=this.y-35;t.fillRect(h,s,6,6),t.stroke()}},t}(),S=function(){function t(t){this.v=t,this.W=0}return t.prototype.j=function(){this.J(r.R)},t.prototype.P=function(){this.F()},t.prototype.k=function(){if(this.v.state===c&&Date.now()-this.W>this.H){var t=Math.floor(3*Math.random());this.J(t)}},t.prototype.J=function(t){var i=new p(this.v,t);this.v.M.push(i),this.W=Date.now(),this.F()},t.prototype.F=function(){this.H=(1e3+3e3*Math.random())/this.v.level.Y},t}(),m=function(){function t(t){this._=0,this.$=0,this.tt=0,this.it=0,this.ht=[],this.v=t,this._=0,this.$=Date.now()}return t.prototype.P=function(){this._=Date.now()},t.prototype.l=function(t){Date.now()-this.$>1e3?(this.it=this.tt,this.tt=0,this.$=Date.now(),this.st()):this.tt+=1;var i="".concat(this.it).padStart(2,"0")+" FPS";t.font="normal 12px Arial",t.fillStyle="yellow",t.fillText(i,1220,30)},t.prototype.st=function(){(this.ht.push(this.it),this.ht.length>60&&this.ht.shift(),this._>0&&Date.now()-this._>1e4)&&(this.ht.reduce((function(t,i){return t+i}),0)/this.ht.length<30&&(console.log("Reducing particle effect due to low FPS"),window.__OPTMIZE_PERFORMANCE=!0,this._=0))},t}(),k=function(){function t(t){this.nt=0,this.v=t}return t.prototype.ot=function(){this.nt=Date.now(),playAudioFx(2)},t.prototype.rt=function(){return this.v.state===f&&Date.now()-this.nt>3e3},t.prototype.et=function(t){return this.rt()&&t.At},t.prototype.l=function(t){if(this.v.state===f){t.fillStyle="rgba(67, 99, 79, 0.6)",t.fillRect(300,140,670,360);var i="That's not how it happened!";if(t.font="normal 32px Courier New",t.fillStyle="#000000",t.fillText(i,390,240),this.v.ct.ut>=this.v.ct.ft){i="You got the high score though!";t.font="normal 16px Courier New",t.fillStyle="#000000",t.fillText(i,500,280)}else{i="Shoot harder next time.";t.font="normal 16px Courier New",t.fillStyle="#000000",t.fillText(i,530,280)}var h=this.v.ct.wt();i="Your Score: ".concat(h);if(t.font="normal 24px Courier New",t.fillStyle="#000000",t.fillText(i,500,320),this.rt()){i="Press [SPACE / A ] to return to the menu";t.font="normal 20px Courier New",t.fillStyle="#000000",t.fillText(i,430,420),t.beginPath(),t.strokeStyle="#000000",t.arc(616,414,13,0,2*Math.PI),t.stroke()}}},t}(),M=function(){function t(t){this.v=t}return t.prototype.l=function(t){this.vt(t)},t.prototype.vt=function(t){var i=[[917,720],[945,617],[975,578],[1e3,544],[1204,453],[1276,448],[1280,720],[1280,720]];t.fillStyle="rgba(67, 99, 79, .9)",t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(var h=1;h<i.length-1;h++){var s=(i[h][0]+i[h+1][0])/2,n=(i[h][1]+i[h+1][1])/2;t.quadraticCurveTo(i[h][0],i[h][1],s,n)}t.closePath(),t.fill()},t}(),C=function(){function t(t){this.v=t,this.gt=1,this.Y=1,this.O=1}return t.prototype.k=function(){this.v.ct.ut>1e4?(this.gt=5,this.Y=3,this.O=3):this.v.ct.ut>8e3?(this.gt=4,this.Y=2.2,this.O=2.2):this.v.ct.ut>5e3?(this.gt=3,this.Y=1.8,this.O=1.8):this.v.ct.ut>1e3?(this.gt=2,this.Y=1.4,this.O=1.4):(this.gt=1,this.Y=1,this.O=1)},t.prototype.l=function(t){var i="Level ".concat(this.gt);t.font="bold 20px Courier New",t.fillStyle="#818589",t.fillText(i,20,80)},t}(),d=function(){function t(t){this.v=t,this.lt=5}return t.prototype.V=function(){this.lt>0&&(this.lt-=1),0===this.lt&&this.v.St()},t.prototype.l=function(t){var i="❤️".repeat(this.lt);t.font="normal 20px Courier New",t.fillStyle="grey",t.fillText(i,20,120)},t}(),I=function(){function t(t){this.v=t}return t.prototype.l=function(t){if(this.v.state===u){var i="Summer of 1206";t.font="normal 16px Courier New",t.fillStyle="#808080",t.fillText(i,280,130);i="Warlord Bakhtiyar Khalji has set his greedy eyes on the famed Tibetian mountain";t.font="normal 16px Courier New",t.fillStyle="#808080",t.fillText(i,280,160);i="ranges. As the sole guardian of Chumbi Valley, you must repell his horsemen in";t.font="normal 16px Courier New",t.fillStyle="#808080",t.fillText(i,280,190);i="the epic struggle, we now call...";t.font="normal 16px Courier New",t.fillStyle="#808080",t.fillText(i,280,220);i="Khilji's Folly";t.font="normal 32px Courier New",t.fillStyle="#808080",t.fillText(i,280,270);i="Press [SPACE]/ A to get started";t.font="normal 20px Courier New",t.fillStyle="#808080",t.fillText(i,460,340),t.beginPath(),t.strokeStyle="#808080",t.arc(646,334,12,0,2*Math.PI),t.stroke();i="Credits";t.font="normal 20px Courier New",t.fillStyle="#808080",t.fillText(i,280,400);i="Developer: Sayem Shafayet";t.font="normal 20px Courier New",t.fillStyle="#808080",t.fillText(i,280,430);i="Developer: Shuhan Mirza";t.font="normal 20px Courier New",t.fillStyle="#808080",t.fillText(i,280,460);i="Music: Mysha Azfar";t.font="normal 20px Courier New",t.fillStyle="#808080",t.fillText(i,280,490)}},t}();var b;!function(t){t[t.IDLE=0]="IDLE",t[t.kt=1]="MOVING_RIGHT",t[t.Mt=2]="MOVING_LEFT",t[t.Ct=3]="SHOOTING"}(b||(b={}));var E=new Image;E.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAWCAMAAAB37HsnAAAAFVBMVEWcdVKtW0Djk2uANSBXKxDvaS9VDwoL3UT+AAAAAXRSTlMAQObYZgAAAQJJREFUOMu11EuSgzAMBND+CN3/yLMwwVhgxlQq7B6o205wAtxc1Av+c1H8EUEOlrTOki18N/1qH9cwuFrN54VNnW+Ywkh5RlOip1UkpThuiJLs/lSiOSHq06EKNMW+tDjSpm0AYqPv2I5kqYKIz7RadSc7JTZy5LbzUkWhDdsQO8OUSB6UiBlLthGkj2nyYLidfccCHb6p6tNob9ZB2hH9le/khCV7IgAy3E8E9u9ylSUbz4/9BWv18JPyFyxV8HFUd2fmKp2ZmZ5VXcOOF3zaByLgOG3EcC6yZCsdBmL44wMXWbK1CtsGbKfwG26PrNMw4FU+L4xIIPvHCANeZsl2/gGs1AceQ8AEOQAAAABJRU5ErkJggg==";var U=new Image;U.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAAAWCAMAAAAsCCRTAAAAFVBMVEWcdVLjk2utW0CANSBXKxDvaS9VDwpm7wYuAAAAAXRSTlMAQObYZgAAAhZJREFUSMellkmC5TAIQ0EPfP8j98IZgNQfqsu7ECyEANtmv1ru9uf1wJB+vUeuYtFXzB4YeoC6PlCTXxaZmQmvsGDqGPoJw0eMblGN8oqarri4u7vH2IIaM2NgILvjSkSAqA4gtWwAdWoC6TCA5O4OGtmpUZsYR6BL7whE9LCgZ2VuajvudjnMIRqIu7s6MwtqegSc3DcfwB272yRCPrLr+UouAXeDABAcXwdX0SoVNM2CHyrh7jcRgg6ys6PuCKCLjBRx8ditShU0UDMAuLi2GIC5X8ASvf9tp889cXHm36ptRpkjaFw3qiaRmv/e0CXqU6UG6r71iLPRcmps5n7UXxXD5wBgfnEfxLcpJMxH9/bPerCkBOr5iz41AO2wggjMah3GiAR7VSJt7gB19spWvENCTIM9jLZiTDuLZxnqoEl2D7ykgRprAWSePkhDZ4SBF4UksaIEibXWWqEqUZ+7IZlYUWzKPBpXmaU0PLosSu9JwDqd8hSUIIvMmhfASC9WmO/0iUxdgiqK0OOU7V1kgNlmHsq71pmX26N7p4UVJ4Y9fF+BIMUa/3VgDE97R6QJvcws374THiIaAVH/72vvzcoHhrV2NqXMLHjHI1OTaVTY/AbDtYaoWRM8uzReY4Dkgwj1lRCfn139PDwvzVoI+Pzgw8xyCpK3JexLDA1LuyS/fX5O4VP22yXF7LS/P4v/C+NI5h+KjwlHpL5yBgAAAABJRU5ErkJggg==";var R=new Image;R.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAAAaCAMAAADMm0PyAAAAFVBMVEWcdVKtW0Djk2uANSBXKxDvaS9VDwoL3UT+AAAAAXRSTlMAQObYZgAAAl1JREFUWMPtmNuO4zAMQ0Udxf//yfPgXJzGttxuBwssNk8dgJBIXahMzP4/v/foH6H6qzrkX42mv9oUl97jqi8NUoNwz2vg/odi9JpE7u4tj1GKHHGvkb4AMdOtKve/XoXKzL3KudRqPmR3xICR54p9qTMS93pqGEGPiEoHRAsj9K3OoGaU9CyH5mahdONyhGmBqVbFcHBUWg7dt0D0c7QNbDs/IIp7xhV3J5EDCI5AutuGcBf+YNkA1KfRyJU7yaAhueZMJXnaYgIuMaZ9LiSZAZtL8svW6s5I7u4V4QpcD+c8EZVEB3Gp3gvqw80/i+5zVyZAQEuicgUCCeQOhxiZu7tJkoCAAHehXWY74wJg82gQHe+v5ZQGVqe9bAif3GRVMTwSVSIRAJhEXGN/XpmqRQITEXouHRCEokE8yJwchmJM7hnkSAch7DHVEGE71/4xhDCDV0ADmyIag9xbE8yLPoOYGWGSoiu3EmHsRRHHLPduvyaIBz5ilmgJYgYWiNBQbDC3EIIXG9Iyotmv1oQmvpuYohEauyJPJj2q7yF6xwySPHUhsrMZEcN7pfowPcvz05wjzCC29MAnTM4Wl9IFRaFGKCX6dSjlABT7EFF7VxCDJKfgUkpkYnwjumKglACiFGJQ0BIAUaKfJkeYmW3CzCgk3SMXI+2u05n1ywYG8a9Z5TOEmWmr85V0ppDprYa2Kbpvf72f7wAWEM0ZTRZCOaQtzaP756+tPx6eRFhA1HM2R+yxhjxWPkEo+2++fQ/7FGHG4oeQxW8PdMe5WfoYAJhHWECkLG6vGwePHwUCCPdZsXo9AAAAAElFTkSuQmCC";var y,D=function(){function t(t){this.dt=45,this.It=-45,this.bt=45,this.Et=0,this.Ut=1e3,this.Rt=0,this.yt=200,this.Dt=530,this.Gt=0,this.Bt=90,this.v=t,this.state=b.IDLE,this.Nt=0,this.Kt=6,this.Zt=0,this.Vt=8,this.xt=0,this.Tt=6}return t.prototype.Lt=function(){return[this.Ut+this.Et,this.Dt-this.Et/this.yt*this.Bt]},t.prototype.initialize=function(){this.Et=0},t.prototype.k=function(t){this.v.state===c&&(t.left&&this.Et>this.Rt&&(this.Et-=1),t.right&&this.Et<this.yt&&(this.Et+=1),t.Ot&&this.dt>this.It&&(this.dt-=1),t.Xt&&this.dt<this.bt&&(this.dt+=1),t.left||t.right||this.state==b.Ct||(this.state=b.IDLE),t.left&&(this.state=b.Mt),t.right&&(this.state=b.kt))},t.prototype.l=function(t){var i,h,s,n=this.Lt(),o=n[0],r=n[1];this.state==b.IDLE?(i=E,this.Nt+=.3,this.Nt>=this.Kt&&(this.Nt=0),h=this.Nt,s=this.Kt):this.state==b.Mt||this.state==b.kt?(i=U,this.Zt+=.25,this.Zt>=this.Vt&&(this.Zt=0),h=this.Zt,s=this.Vt,this.state==b.Mt&&(i=function(t){var i=document.createElement("canvas"),h=i.getContext("2d");if(!h)return console.error("Could not create 2D context"),t;i.width=t.width,i.height=t.height,h.translate(i.width,0),h.scale(-1,1),h.drawImage(t,0,0);var s=new Image;return s.src=i.toDataURL(),s}(i))):this.state==b.Ct&&(i=R,this.xt+=.2,this.xt>=this.Tt&&(this.xt=0,this.state=b.IDLE),h=this.xt,s=this.Tt);var e=Math.floor(h),a=i.width/s,A=i.height;t.drawImage(i,e*a,0,a,A,o-a/2,r-A/2,1.5*a,1.5*A)},t}();!function(t){t[t.D=0]="FAST",t[t.R=1]="BASIC",t[t.G=2]="HEAVY"}(y||(y={}));window.__OPTMIZE_PERFORMANCE=!1;var G=function(t,i,h,s){this.x=t,this.y=i,this.qt=h,this.Wt=s,this.jt=0};function B(t,i,h,s,n,o){var r=t.globalCompositeOperation;t.globalCompositeOperation="lighter";var e=10;window.__OPTMIZE_PERFORMANCE&&(n/=2,e=2);for(var a=0;a<e;a++){var A=new G(i,h,(2*Math.random()*1-1)/2,0-2*Math.random()*1);o.push(A)}for(a=0;a<o.length;a++)t.fillStyle="rgba("+(260-2*o[a].jt)+","+(2*o[a].jt+50)+","+2*o[a].jt+","+(n-o[a].jt)/n*.4+")",t.beginPath(),t.arc(o[a].x,o[a].y,Math.max(0,(n-o[a].jt)/n*(s/2)+s/2),0,2*Math.PI),t.fill(),o[a].x+=o[a].qt,o[a].y+=o[a].Wt,o[a].jt++,o[a].jt>=n&&(o.splice(a,1),a--);t.globalCompositeOperation=r}var N=function(){function t(i,h){var s;this.Jt=12,this.Pt=[],this.v=i,this.type=h,this.Qt=t.Ft(h),this.zt=t.Ht(h),s=this.v.pc.Lt(),this.Yt=s[0],this._t=s[1];var n=this.v.pc.dt;this.$t=n*Math.PI/180,this.velocityX=this.Qt*Math.cos(this.$t),this.velocityY=this.Qt*Math.sin(this.$t)*-1,this.x=this.Yt,this.y=this._t,this.isActive=!0,this.v.pc.state=b.Ct}return t.prototype.k=function(){if(this.v.state===c){var h=t.ti(this.type);this.x=this.x-this.velocityX*h,this.y=this.y+this.velocityY*h,this.velocityY=this.velocityY+10*h*.1,this.isActive&&(this.y>i&&(this.isActive=!1,this.v.L.U(this)),this.ii())}},t.prototype.ii=function(){for(var t,i,h,s,n,o,r,e,a=0,A=this.v.M;a<A.length;a++){var u=A[a];if(t=this.x,i=this.y,h=this.Jt,s=u.x,n=u.y,o=u.K,r=void 0,e=void 0,r=t-s,e=i-n,h+o>Math.sqrt(r*r+e*e)){this.v.ct.hi(100),this.isActive=!1,this.v.L.U(this),u.B-=this.zt,u.B<=0&&(u.isActive=!1,this.v.L.I(u)),playAudioFx(1);break}}},t.prototype.l=function(t){this.v.state===c&&this.isActive&&(this.y>690||(this.si(t),this.v.q&&(t.beginPath(),t.arc(this.x,this.y,this.Jt,0,2*Math.PI),t.strokeStyle="rgba(0, 0, 0, 1)",t.stroke())))},t.Ft=function(t){return t==y.R||t==y.G||t==y.D?30:void 0},t.ti=function(t){return t==y.R?.3:t==y.G?.15:t==y.D?.6:void 0},t.Ht=function(t){return t==y.R?2:t==y.G?4:t==y.D?1:void 0},t.prototype.si=function(t){var i=2*this.zt;B(t,this.x,this.y,i,20,this.Pt)},t}(),K=function(){function t(t){this.v=t,this.W=0}return t.prototype.k=function(t){if(this.v.state===c&&(t.At&&Date.now()-this.W>800)){var i=this.v.oi.ni;this.J(i)}},t.prototype.J=function(t){var i=new N(this.v,t);this.v.C.push(i),this.W=Date.now(),playAudioFx(0)},t}(),Z=function(){function t(t){var i;this.ri={},this.v=t,this.ni=y.R,this.ri=((i={})[y.R]=[],i[y.D]=[],i[y.G]=[],i)}return t.prototype.k=function(t){this.v.state===c&&t.f&&(t.f=!1,this.ni+=1,this.ni>=3&&(this.ni=0))},t.prototype.l=function(t){this.v.state===c&&(this.ei(t,1120,320,y.D),this.ei(t,1160,320,y.R),this.ei(t,1200,320,y.G))},t.prototype.ei=function(t,i,h,s){B(t,i,h,2*N.Ht(s),40,this.ri[s]),this.ni===s&&(t.beginPath(),t.moveTo(i,h+16),t.lineTo(i-10,h+32),t.lineTo(i+10,h+32),t.fill())},t}(),V=function(){function t(t){this.v=t}return t.prototype.l=function(t){t.strokeStyle="black",t.beginPath(),t.moveTo(5,690),t.lineTo(1275,690),t.stroke()},t}(),x=function(){function t(t){this.v=t,this.ut=0,this.ft=0}return t.prototype.initialize=function(){this.ft=this.ai()},t.prototype.hi=function(t){this.ut+=t,this.ut>this.ft&&(this.ft=this.ut,this.Ai())},t.prototype.l=function(t){var i="HIGHSCORE "+"".concat(this.ft).padStart(8,"00000000");t.font="normal 14px Courier New",t.fillStyle="#818589",t.fillText(i,20,56);i="SCORE "+this.wt();t.font="bold 20px Courier New",t.fillStyle="#818589",t.fillText(i,20,36)},t.prototype.wt=function(){return"".concat(this.ut).padStart(8,"00000000")},t.prototype.ai=function(){return parseInt(localStorage.getItem("--khiljis-folly--high-score"))||0},t.prototype.Ai=function(){localStorage.setItem("--khiljis-folly--high-score","".concat(this.ft))},t}(),T=function(){function t(t){this.v=t}return t.prototype.l=function(t){if(this.v.state===c)for(var i=this.v.pc.dt,h=this.v.oi.ni,s=N.Ft(h),n=this.v.pc.Lt(),o=n[0],r=n[1],e=i*Math.PI/180,a=s*Math.cos(e),A=s*Math.sin(e)*-1,u=.5,f=0;f<300;f++){var w=(300-3*f)/300;if(f>1&&this.ui(t,o,r,w),f+=u,o-=a*u,r+=A*u,A+=.5,r>690)break}},t.prototype.ui=function(t,i,h,s){t.fillStyle="rgba(67, 99, 79, ".concat(s,")"),t.beginPath();t.arc(i,h,2,0,2*Math.PI),t.fill()},t}(),L=function(){function h(){this.state=A,this.q=!1}return h.prototype.initialize=function(){this.ci(),this.fi=new e(this),this.wi=new m(this),this.vi=new S(this),this.gi=new M(this),this.li=new V(this),this.pc=new D(this),this.pi=new T(this),this.Si=new K(this),this.ct=new x(this),this.L=new a(this),this.T=new d(this),this.mi=new I(this),this.ki=new k(this),this.oi=new Z(this),this.Mi=new w(this),this.level=new C(this),this.M=[],this.C=[],this.ct.initialize(),this.fi.initialize(),this.pc.initialize()},h.prototype.Ci=function(){this.state=u,this.vi.j()},h.prototype.di=function(){this.state=c,this.vi.P(),this.wi.P()},h.prototype.k=function(t){this.state===u&&t.At&&(this.di(),t.At=!1),this.ki.et(t)?this.Ii():(this.level.k(),this.oi.k(t),this.pc.k(t),this.vi.k(),this.Si.k(t),this.M.forEach((function(t){t.k()})),this.C.forEach((function(t){t.k()})),this.L.k())},h.prototype.l=function(h){h.clearRect(0,0,t,i),this.fi.l(h),this.mi.l(h),this.ki.l(h),this.level.l(h),this.gi.l(h),this.li.l(h),this.pc.l(h),this.oi.l(h),this.pi.l(h),this.M.forEach((function(t){t.l(h)})),this.C.forEach((function(t){t.l(h)})),this.ct.l(h),this.T.l(h),this.Mi.l(h),this.wi.l(h)},h.prototype.ci=function(){this.time=Date.now()},h.prototype.St=function(){this.state=f,this.ki.ot()},h.prototype.bi=function(t){this.Ii=t},h}(),O=document.createElement("canvas"),X=O.getContext("2d");O.id="gameCanvas",O.width=t,O.height=i,document.createElement("div").appendChild(O),document.body.appendChild(O);var q,W={left:!1,right:!1,Xt:!1,Ot:!1,At:!1,f:!1},j={left:!1,right:!1,Xt:!1,Ot:!1,At:!1,f:!1},J={o:!1,h:!1,A:!1,u:!1,t:!1,i:!1};!function(t){window.addEventListener("keydown",(function(i){switch(i.key){case"ArrowLeft":t.left=!0;break;case"ArrowRight":t.right=!0;break;case"ArrowUp":t.Xt=!0;break;case"ArrowDown":t.Ot=!0;break;case"F":case"f":t.f=!0;break;case"Spacebar":case" ":t.At=!0}})),window.addEventListener("keyup",(function(i){switch(i.key){case"ArrowLeft":t.left=!1;break;case"ArrowRight":t.right=!1;break;case"ArrowUp":t.Xt=!1;break;case"ArrowDown":t.Ot=!1;break;case"F":case"f":t.f=!1;break;case"Spacebar":case" ":t.At=!1}}))}(j),function t(){(q=new L).initialize(),q.Ci(),q.bi((function(){t()}))}(),requestAnimationFrame((function t(i){n(J),function(t,i,h){t.Xt=i.Xt||h.o,t.Ot=i.Ot||h.h,t.left=i.left||h.A,t.right=i.right||h.u,t.At=i.At||h.t,t.f=i.f||h.i,t.At=s("SPACE",t.At,300),t.f=s("F",t.f,300)}(W,j,J),q.k(W),q.l(X),requestAnimationFrame(t)}))})();</script></body></html>