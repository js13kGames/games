<title>Phantomicus - js13kGames 2024</title><style>*{touch-action:none}body,html{width:100%;height:100%;margin:0;border:0;overflow:hidden;display:block;background:#000}canvas{position:absolute;image-rendering:pixelated}</style><canvas></canvas><canvas></canvas><script>const t=t=>t,s=(t,e,i)=>Math.max(e,Math.min(i,t)),e=()=>Math.random(),i=()=>2*Math.random()-1,r=(t,e,i)=>t+(e-t)*i,h=(e=0)=>new Promise(t=>setTimeout(t,e)),n=new AudioContext,a=n.sampleRate,o=n.createGain();o.connect(n.destination),o.gain.t=.8;let f=t=>n.createBuffer(2,t*a,a),c=t=>[t.getChannelData(0),t.getChannelData(1)],l=f(2),[u,v]=c(l),$=u.length;for(let t=0;$>t;t++)u[t]=.25*i()*(1-t/$)**5,v[t]=.25*i()*(1-t/$)**5;const m=n.createConvolver(),x=(m.buffer=l,m.connect(o),t=>Math.sin(2*Math.PI*t)),d=t=>t%1<.5?1:-1,w=()=>i(),M=(t,e,i,s,r,n)=>n<t?n/t:n<t+e?1-(n-t)/e*(1-i):n<r?i:n<r+s?(1-(n-r)/s)*i:0,b=t=>440*2**((t-69)/12),g=(t,i=.5)=>({s:t,i:i,e:0,n:e()}),y=(e,i,s,r,n,h,o,f=0)=>{let[c,l,u,v,p,$,x,w,m]=i,t=(r+n+$)*a|0,d=r*a|0,b=0,g=0;for(var Y=1/(f/20*a+1);t>d;){const i=Math.max(0,d/a-r),f=c(h,i)*s.s;s.e=s.e||f,s.e=Y*f+(1-Y)*s.e,s.n+=s.e/a;let t=l(s.n);if(w&&m){const e=w(h,i),s=m(h,i),r=1.5*Math.sin(e*Math.PI/a),n=(b+=r*g,s*(t-g)-b);switch(g+=r*n,x){case 1:t=n;break;case 2:t=b;break;case 3:t=g;break;case 4:t=b+n}}t*=M(u,v,p,$,n,i),e[0][d]+=Math.sin(s.i*Math.PI/2)*o*t,e[1][d]+=Math.cos(s.i*Math.PI/2)*o*t,d++}};let A=0;const p=(t,e,i,s,r,n,h,a)=>{for(const o of i)y(t,e,o,s,r,n,h,a)},P=(t,e)=>{var i=n.createBufferSource();return i.buffer=t,i.loop=!!e,i},Q=(t,e)=>{t.connect(o),e&&t.connect(m)};class T{constructor(t){this.h=t}async o(t){this.r=await(async(t,i)=>{const s=t[0];let r=t[1]??0;for(const t of s){const i=t[0],e=t[1];for(const t of e)r=Math.max(r,t[1]+t[2]+i[5])}const n=f(r),a=c(n);for(const t of s){const s=t[0],r=t[1],n=s[9]??1,f=s[10]??0,c=1/n,$=[g(1)];for(let t=1;n/2>t;t++)$.push(g(1+t*f,e())),$.push(g(1/(1+t*f),e()));for(var[o,l,u,v]of r)p(a,s,$,l,u,o,c,v),A++,A%50==0&&(i&&i(A/600),await h())}return t[1]=r,n})(this.h,t)}c(){var t=P(this.r);Q(t),t.start()}a(){var t,e;this.f||(this.l=P(this.r,this.h[2]),this.u=(t=this.l,e=n.createGain(),t.connect(e),e),Q(this.u,!0),this.l.start(),this.f=!0)}w(){this.l&&(this.l.stop(this.l.context.currentTime+.1),this.l=void 0),this.u&&(this.u.gain.linearRampToValueAtTime(0,this.u.context.currentTime+.1),this.u=void 0),this.f=!1}M(){this.f?this.w():this.a()}}const I=[t,t=>.4*d(t),.01,.01,.5,.1,2,()=>1200,()=>.8,1,.001],B=[t,t=>.075*(d(t)+d(t/2)),.01,.01,.5,.1,2,()=>2e3,()=>.5],k=[t,t=>.7*d(t),.01,.01,.5,.1,3,t=>1.25*t,()=>.1,7,.003],S=(e,i,s)=>{const r=[];for(let t=0;e.length>t;t++){var n=[],h=e[t][0],a=e[t][1];for(let t=0;a.length>t;t++){const i=a[t],r=h[i[0]];for(const e of r)n.push([b(e[2]),(i[1]+e[0])*s,e[1]*s])}r.push([i[t],n])}return[r,void 0,!0]},D=new T(S([[[[[0,2,45]],[[0,2,45],[12,2,52],[16,6,51],[24,2,52]],[[0,2,45],[16,2,45]],[[0,2,52],[0,2,45],[0,2,48]],[[0,2,47],[0,2,45],[0,2,51],[28,2,40]],[[0,2,50],[0,2,48],[0,2,44]],[[12,2,46],[16,2,47],[24,2,40]],[[0,2,40],[4,2,44],[8,2,48],[12,2,47],[16,2,45],[16,2,36]],[[28,2,40]],[[0,2,45],[28,2,44]],[[0,2,45],[8,2,48],[16,2,52],[24,2,48]],[[0,2,52],[8,2,48],[16,2,47]],[[0,2,52],[8,2,51],[24,2,49],[28,2,50]],[[0,2,49],[8,2,48],[24,2,47],[28,2,48]],[[0,2,47],[16,2,46],[28,2,51]],[[0,2,52],[4,2,47],[8,2,46],[12,2,47],[16,2,40],[16,14,52],[20,2,41],[24,2,44],[28,2,40]],[[0,14,52],[0,2,40],[4,2,41],[8,2,40],[12,2,41],[16,2,40],[16,14,52],[20,2,41],[24,2,44],[28,2,40]],[[0,2,45],[0,2,36],[0,2,40],[28,2,40]]],[[0,0],[1,32],[2,64],[1,96],[3,128],[4,160],[5,192],[6,224],[3,256],[4,288],[5,320],[7,352],[8,416],[9,448],[10,480],[11,512],[12,544],[13,576],[14,608],[15,640],[16,672],[17,704]]],[[[[0,2,76]],[[0,2,75]],[[0,2,74]],[[0,1,76],[1,1,77],[2,1,76],[3,1,72],[4,1,74],[5,1,76],[6,1,74],[7,1,71],[8,1,72],[9,1,74],[10,1,72],[11,1,69],[12,1,71],[13,1,72],[14,1,71],[15,1,68],[16,2,69]]],[[0,128],[1,160],[2,192],[0,256],[1,288],[2,320],[3,352]]],[[[[4,2,76],[8,2,76],[12,2,76],[16,2,76],[24,2,72],[28,2,76]],[[0,2,75],[8,2,71]],[[4,2,74],[8,2,74],[12,2,74],[16,2,74],[24,2,71],[28,2,74]],[[0,2,72],[12,2,70],[16,2,71],[24,2,64]],[[4,2,74],[8,2,74],[12,2,74],[16,2,74],[24,2,72],[28,2,74]],[[0,2,76],[4,2,74],[8,2,72],[12,2,71],[16,2,69]],[[28,2,64]],[[0,2,69],[28,2,68]],[[0,2,69],[4,2,71],[8,2,72],[12,2,74],[16,2,76],[24,2,81]],[[0,2,84],[0,2,81],[16,2,83],[16,2,80],[24,2,87],[28,2,88]],[[0,2,87],[0,2,83],[8,2,86],[8,2,82],[24,2,85],[24,2,76],[28,2,86],[28,2,77]],[[0,2,85],[0,2,76],[8,2,84],[8,2,74],[24,2,83],[24,2,76],[28,2,84],[28,2,77]],[[0,2,83],[0,2,76],[16,2,82],[16,2,75],[28,2,87],[28,2,75]],[[0,2,88],[0,2,76],[4,2,83],[4,2,71],[8,2,82],[8,2,70],[12,2,83],[12,2,71],[16,2,76],[16,14,64]],[[0,2,76],[0,14,64],[16,2,76],[16,14,64]],[[0,2,81],[0,2,72],[0,16,69]]],[[0,128],[1,160],[2,192],[3,224],[0,256],[1,288],[4,320],[5,352],[6,416],[7,448],[8,480],[9,512],[10,544],[11,576],[12,608],[13,640],[14,672],[15,704]]],[[[[12,2,70],[16,2,71],[24,2,64]]],[[0,224]]],[[[[0,16,76],[16,16,79]],[[0,16,78],[16,16,75]],[[0,16,74],[16,16,77]],[[0,2,76],[4,2,74],[8,2,72],[12,2,71],[16,48,69]],[[28,2,64]],[[0,16,69],[28,4,68]],[[0,2,69],[4,2,71],[8,2,72],[12,2,74],[16,2,76],[24,2,81]],[[0,16,84],[0,16,81],[0,2,76],[0,2,72],[16,2,80],[16,2,83],[16,2,71]]],[[0,256],[1,288],[2,320],[3,352],[4,416],[5,448],[6,480],[7,512]]],[[[[12,2,82],[16,2,83],[24,2,76]],[[0,2,88],[16,2,91]],[[0,2,90],[16,2,87]],[[0,2,86],[16,2,89]],[[0,2,88],[4,2,86],[8,2,84],[12,2,83],[16,2,81]]],[[0,224],[1,256],[2,288],[3,320],[4,352]]],[[[[12,2,76],[16,8,75],[24,2,76]],[[28,4,64]],[[0,2,69],[4,2,71],[8,2,72],[12,2,74],[16,2,76],[24,2,72],[24,2,81]],[[0,16,69],[16,2,71],[16,2,68],[24,4,76],[28,4,77]],[[0,8,76],[0,8,71],[8,8,74],[8,8,70],[24,4,73],[24,4,64],[28,4,74],[28,4,65]],[[0,8,73],[0,8,64],[8,8,72],[8,8,62],[24,4,71],[24,4,64],[28,4,72],[28,4,65]],[[0,8,71],[0,8,64],[16,8,70],[16,8,63],[28,4,75],[28,4,63]],[[0,2,76],[0,2,64],[4,2,71],[4,2,59],[8,2,70],[8,2,58],[12,2,71],[12,2,59],[16,14,64],[16,14,52]],[[0,14,64],[0,14,52],[16,14,64],[16,14,52]],[[0,16,69],[0,16,60],[0,32,57]]],[[0,288],[1,448],[2,480],[3,512],[4,544],[5,576],[6,608],[7,640],[8,672],[9,704]]]],[I,B,k,B,k,B,B],.08)),F=new T(S([[[[[0,12,69],[12,2,71],[16,2,72],[20,2,69],[24,2,72],[28,2,76]],[[0,16,75],[16,4,76]],[[4,12,76],[16,16,79]],[[0,16,78],[16,16,75]]],[[0,0],[1,32],[2,192],[3,224]]],[[[[0,12,33],[12,2,35],[16,2,36],[20,2,33],[24,2,36],[28,2,40]],[[0,16,39],[16,4,40]],[[0,4,45],[24,4,40]],[[0,4,45],[12,4,52],[16,8,51],[24,4,52]],[[0,4,45]],[[0,4,48],[12,4,46],[16,8,47],[24,4,40]]],[[0,0],[1,32],[2,64],[3,96],[4,128],[5,160],[2,192],[3,224]]],[[[[0,12,81],[12,2,83],[16,2,84],[20,2,81],[24,2,84],[28,2,88]],[[0,16,87],[16,4,88]],[[4,2,76],[8,2,76],[12,2,76],[16,4,76],[24,4,72],[28,4,76]],[[0,4,75],[8,4,71]],[[4,2,74],[8,2,74],[12,2,74],[16,4,74],[24,4,71],[28,4,74]],[[0,4,72],[12,4,70],[16,2,71],[24,2,64]]],[[0,0],[1,32],[2,64],[3,96],[4,128],[5,160],[2,192],[3,224]]],[[[[4,4,57],[4,4,60],[4,4,64],[12,4,57],[12,4,60],[12,4,64],[20,4,57],[20,4,60],[20,4,64],[28,4,57],[28,4,60],[28,4,64]],[[4,4,57],[4,4,60],[4,4,63],[12,4,57],[12,4,60],[12,4,63],[20,4,57],[20,4,60],[20,4,63],[28,4,57],[28,4,60],[28,4,63]],[[4,4,57],[4,4,62],[4,4,65],[12,4,57],[12,4,62],[12,4,65],[20,4,57],[20,4,62],[20,4,65],[28,4,57],[28,4,62],[28,4,65]],[[4,4,57],[4,4,60],[4,4,65],[12,4,57],[12,4,60],[12,4,65],[20,4,59],[20,4,62],[20,4,64],[28,4,59],[28,4,62],[28,4,64]]],[[0,64],[1,96],[2,128],[3,160],[0,192],[1,224]]],[[[[0,4,45],[8,4,45],[16,4,45],[24,4,40]],[[0,4,50],[8,4,50],[16,4,50],[24,4,45]],[[0,4,48],[8,4,45],[12,4,46],[16,4,47],[24,4,40]]],[[0,64],[0,96],[1,128],[2,160],[0,192],[0,224]]],[[[[0,32,35]],[[0,4,35],[16,4,35]],[[0,4,35],[12,4,35],[16,8,35],[24,8,35]]],[[0,0],[1,64],[1,96],[1,128],[2,160],[1,192],[1,224]]],[[[[8,4,38],[24,4,38]]],[[0,64],[0,96],[0,128],[0,192],[0,224]]],[[[[0,4,42],[4,4,42],[8,4,42],[12,4,42],[16,4,42],[20,4,42],[24,4,42],[28,4,42]]],[[0,64],[0,96],[0,128],[0,192],[0,224]]],[[[[4,3,48],[7,1,48],[8,3,48],[11,1,48]]],[[0,160]]]],[k,I,[t,t=>x(t)*(1+.2*x(3*t))*.2,.001,.15,.1,.1],B,B,[(t,e)=>t*(1+2*Math.exp(30*-e)),t=>.8*(.7*x(t)+.15*Math.tanh(2*x(t)))+Math.exp(200*-t)*w()*.2,.001,.15,.1,.1],[t,t=>.03*x(180*t)+.07*w(),.001,.1,.1,.1,1,t=>.5*t,()=>.3],[t,()=>.05*w(),.001,.03,0,.01,1,()=>2e3,()=>.5],[(t,e)=>t*(1+.5*Math.exp(20*-e)),t=>.5*(x(t)+.3*x(1.5*t)+.1*x(2*t))+w()*Math.exp(200*-t)*.1,.001,.15,.2,.2,2,(t,e)=>t*(.5+1.5*Math.exp(10*-e)),()=>.5]],.053)),H=[t,t=>.5*d(t),.01,.01,.2,.02],q=192,R=432,C=new T([[[H,[[577,0,.05],[727,.05,.05],[1728,.1,.05],[1153,.15,.05]]]]]),E=new T([[[H,[[153,0,.1],[686,.1,.1],[458,.2,.1],[305,.3,.1],[408,.4,.1],[514,.5,.25]]]]]),z=new T([[[H,[[577,0,.05],[686,.05,.05],[915,.1,.05]]]]]),L=new T([[[[t,()=>.3*w(),.01,.01,.8,.01,2,(t,e)=>s(5*t-25*t*e,20,5e3),()=>.7],[[R,0,.2],[R,.2,.2],[385,.4,.2],[343,.6,.2]]]]]),V=new T([[[[(t,e)=>s(t-500*e,20,2e3),t=>.3*x(t),.01,.01,.8,.01,2,(t,e)=>s(5*t-25*t*e,20,5e3),()=>.7],[[216,0,.2],[216,.2,.2]]]]]),K=new T([[[H,[[970,0,.06],[1295,.04,.06],[1453,.08,.08],[1940,.14,.1]]]]]),U=new T([[[H,[[647,0,.04],[R,.04,.04],[288,.08,.04],[q,.12,.04],[128,.16,.04],[647,.24,.04],[R,.28,.04],[288,.32,.04],[q,.36,.04],[128,.4,.04],[647,.48,.04],[R,.52,.04],[288,.56,.04],[q,.6,.04],[128,.64,.04]]]]]),j=new T([[[[t,()=>.4*w(),.01,.1,.5,.05,2,(t,e)=>s(500**(1+4*e),500,2e4),()=>.5],[[1,0,.25]]]]]),W=[];for(let t=0;t<20;t++)W.push([200+100*e(),t/12,.05]);const N=new T([[[[t,t=>.3*x(t),.01,.01,.8,.01,2,()=>300,()=>.5,3,.01],W]]]),G=new T([[[[(t,e)=>Math.min(t,50+300*e)+8*Math.sin(15*e),t=>.2*d(t)+.5*w(),.2,.01,.4,.03,2,()=>500,()=>.7],[[q,0,10]]]],4,!0]),X=new T([[[[t,()=>.2*w(),.03,.01,.2,.03,2,()=>500,()=>.7],[[7323,0,.05]]]],.28,!0]),Z=[z,C,K,U,X,G,j,N,E,L,V,D,F],_=1.4,O=1e-5,Y=(t=0,e=0,i=0)=>new Float32Array([t,e,i]),J=e=>{var i=[];for(let t=0;e>t;t++)i.push(Y());return i},tt=t=>new Float32Array(t),st=t=>Math.hypot(t[0],t[1],t[2]),et=Y(),it=(t,e)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),rt=(t,e,i,s)=>(t[0]=e,t[1]=i,t[2]=s,t),ht=(t,e,i)=>(t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t),nt=(t,e,i)=>(t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t),at=(t,e,i)=>(t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t),ot=(t,e,i)=>(t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t),ft=(t,e,i)=>(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t),ct=(t,e,i,s)=>(t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t),lt=(t,e)=>Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2]),ut=(t,e)=>Math.hypot(e[0]-t[0],e[2]-t[2]),vt=(t,e)=>(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t),$t=(t,e)=>{var i=st(e);return 0<i?ft(t,e,1/i):it(t,e)},mt=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],xt=(t,e,i)=>{var s=e[0],r=e[1],n=i[0],h=i[1];return t[0]=(e=e[2])*h-r*(i=i[2]),t[1]=s*i-e*n,t[2]=r*n-s*h,t},dt=(t,e,i,s,r,n)=>(t[0]=e[0]+n*(i-e[0]),t[1]=e[1]+n*(s-e[1]),t[2]=e[2]+n*(r-e[2]),t),wt=(t,e,i)=>{var s=e[0],r=e[1],n=i[3]*s+i[7]*r+i[11]*(e=e[2])+i[15];return t[0]=(i[0]*s+i[4]*r+i[8]*e+i[12])/(n=n||1),t[1]=(i[1]*s+i[5]*r+i[9]*e+i[13])/n,t[2]=(i[2]*s+i[6]*r+i[10]*e+i[14])/n,t},Mt=(t,e)=>e[0]>=t[0]&&t[1]<=e[1]&&t[2]<=e[2],bt=960,gt=540,yt=document.querySelectorAll("canvas"),At=yt[0],pt=At.getContext("webgl2",{d:!1}),Pt=yt[1],Qt=Pt.getContext("2d"),Tt=(Qt.imageSmoothingEnabled=!1,()=>{var t=(e=Math.min(window.innerWidth/bt,window.innerHeight/gt))*bt,e=e*gt,i=(window.innerWidth-t)/2,s=(window.innerHeight-e)/2;At&&(At.width=bt,At.height=gt,At.style.left=It(i),At.style.top=It(s),At.style.width=It(t),At.style.height=It(e)),Pt&&(Pt.width=bt,Pt.height=gt,Pt.style.left=It(i),Pt.style.top=It(s),Pt.style.width=It(t),Pt.style.height=It(e))}),It=t=>(0|t)+"px",Bt=(window.addEventListener("resize",Tt,!1),Tt(),()=>{var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}),kt=t=>(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),St=(t,e)=>{var i,s,r,n,h,a;return t===e?(i=e[1],s=e[2],r=e[3],n=e[6],h=e[7],a=e[11],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=n,t[11]=e[14],t[12]=r,t[13]=h,t[14]=a):(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]),t},Dt=(t,e,i)=>{var s=e[0],r=e[1],n=e[2],h=e[3],a=e[4],o=e[5],f=e[6],c=e[7],l=e[8],u=e[9],v=e[10],p=e[11],$=e[12],x=e[13],w=e[14],m=(e=e[15],i[0]),d=i[1],M=i[2],b=i[3];return t[0]=m*s+d*a+M*l+b*$,t[1]=m*r+d*o+M*u+b*x,t[2]=m*n+d*f+M*v+b*w,t[3]=m*h+d*c+M*p+b*e,t[4]=(m=i[4])*s+(d=i[5])*a+(M=i[6])*l+(b=i[7])*$,t[5]=m*r+d*o+M*u+b*x,t[6]=m*n+d*f+M*v+b*w,t[7]=m*h+d*c+M*p+b*e,t[8]=(m=i[8])*s+(d=i[9])*a+(M=i[10])*l+(b=i[11])*$,t[9]=m*r+d*o+M*u+b*x,t[10]=m*n+d*f+M*v+b*w,t[11]=m*h+d*c+M*p+b*e,t[12]=(m=i[12])*s+(d=i[13])*a+(M=i[14])*l+(b=i[15])*$,t[13]=m*r+d*o+M*u+b*x,t[14]=m*n+d*f+M*v+b*w,t[15]=m*h+d*c+M*p+b*e,t},Ft=(t,e,i)=>Ht(t,e,i[0],i[1],i[2]),Ht=(t,e,i,s,r)=>{var n,h,a,o,f,c,l,u,v,p,$,x;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*r+e[12],t[13]=e[1]*i+e[5]*s+e[9]*r+e[13],t[14]=e[2]*i+e[6]*s+e[10]*r+e[14],t[15]=e[3]*i+e[7]*s+e[11]*r+e[15]):(n=e[0],h=e[1],a=e[2],o=e[3],f=e[4],c=e[5],l=e[6],u=e[7],v=e[8],p=e[9],$=e[10],x=e[11],t[0]=n,t[1]=h,t[2]=a,t[3]=o,t[4]=f,t[5]=c,t[6]=l,t[7]=u,t[8]=v,t[9]=p,t[10]=$,t[11]=x,t[12]=n*i+f*s+v*r+e[12],t[13]=h*i+c*s+p*r+e[13],t[14]=a*i+l*s+$*r+e[14],t[15]=o*i+u*s+x*r+e[15]),t},qt=(t,e,i,s,r)=>(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t),Rt=(t,e,i)=>{var s=Math.sin(i),r=(i=Math.cos(i),e[4]),n=e[5],h=e[6],a=e[7],o=e[8],f=e[9],c=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*i+o*s,t[5]=n*i+f*s,t[6]=h*i+c*s,t[7]=a*i+l*s,t[8]=o*i-r*s,t[9]=f*i-n*s,t[10]=c*i-h*s,t[11]=l*i-a*s,t},Ct=(t,e,i)=>{var s=Math.sin(i),r=(i=Math.cos(i),e[0]),n=e[1],h=e[2],a=e[3],o=e[8],f=e[9],c=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i-o*s,t[1]=n*i-f*s,t[2]=h*i-c*s,t[3]=a*i-l*s,t[8]=r*s+o*i,t[9]=n*s+f*i,t[10]=h*s+c*i,t[11]=a*s+l*i,t},Et=(t,e,i)=>{var s=Math.sin(i),r=(i=Math.cos(i),e[0]),n=e[1],h=e[2],a=e[3],o=e[4],f=e[5],c=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i+o*s,t[1]=n*i+f*s,t[2]=h*i+c*s,t[3]=a*i+l*s,t[4]=o*i-r*s,t[5]=f*i-n*s,t[6]=c*i-h*s,t[7]=l*i-a*s,t},zt=(t,e,i)=>{var s=e[0],r=e[2],n=r+r,h=s*(c=s+s),a=s*(l=(f=e[1])+f),o=(s*=n,f*l),f=f*n,c=(e=e[3])*c,l=e*l;return e*=n,t[0]=1-(o+(r*=n)),t[1]=a+e,t[2]=s-l,t[3]=0,t[4]=a-e,t[5]=1-(h+r),t[6]=f+c,t[7]=0,t[8]=s+l,t[9]=f-c,t[10]=1-(h+o),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Lt=()=>({l:Y(),m:Y(),direction:Y(),v:0,p:0,y:0,x:.5}),Vt=(t,e,i)=>{it(t.m,e),nt(t.direction,e,t.l),t.p=Math.atan2(t.direction[0],t.direction[2]),t.v=Math.atan2(t.direction[1],Math.hypot(t.direction[0],t.direction[2])),t.y=i},Kt=34962,Ut=35044,jt=35048,Wt=5126,Nt=3553,Gt=33984,Xt=33071,Zt=36160,_t="#version 300 es\nprecision mediump float;",Ot=_t+"uniform sampler2D j;uniform int l;in vec2 v;out vec4 f;float z[11]=float[11](0.01f,0.02f,0.04f,0.08f,0.16f,0.38f,0.16f,0.08f,0.04f,0.02f,0.01f);void main(){if(l==0){vec4 w=texture(j,v);if(max(w.r,max(w.g,w.b))>(0.99f)){f=w;}else{discard;}}else{vec4 x=vec4(0);float y=0.0f;for(int A=-5;A<=5;A++){vec4 w=texture(j,v+(l%2==1?vec2(float(A)/512.0f,0.0f):vec2(0.0f,float(A)/512.0f)));x.rgb+=z[A+5]*w.rgb*w.a;y+=z[A+5]*w.a;}f=y==0.0f?vec4(0,0,0,1):vec4(x.rgb/y,y);}}",Yt=_t+"in vec2 c,d;out vec2 v;void main(){gl_Position=vec4(c,0,1);v=d;}",Jt=_t+"uniform vec3 i,n,m;uniform sampler2D k;uniform float g;in vec4 r,t,s,u;out vec4 f;void main(){if(r.r>0.99f||r.g>0.99f||r.b>0.99f){f=r;return;}vec3 G=normalize(s.xyz),B=u.xyz/u.w;float A=0.0f,w=0.0f;for(int D=-2;D<=2;D++){for(int C=-2;C<=2;C++){if(((texture(k,B.xy+vec2(C,D)/1024.0f)).r)<=(B.z-(0.0001f))){w+=1.0f;}A+=1.0f;}}vec3 z=t.xyz-n,y=normalize(t.xyz-n);float x=dot(z,z),E=0.0f;if((B.x>=0.0f&&B.x<=1.0f&&B.y>=0.0f&&B.y<=1.0f)&&(x<1600.0f&&(dot(y,normalize(m)))>0.9f)){E=(1.0f-w/A)*(1.0f/(1.0f+0.001f*(sqrt(x))+0.0003f*x));}vec3 F=mix(vec3(0.0f,0.0f,0.0f),(r.rgb),(clamp(g*(max(0.0f,dot((normalize(t.xyz-(vec3(256.0f,256.0f,-128.0f)))),G)))+(1.2f-g)*(max(0.0f,dot(y,G)))*E,0.0f,1.0f)));F=mix(F,vec3(1.0f,1.0f,1.0f),(E*pow(max(dot((normalize(i-t.xyz)),(reflect(y,G))),0.0f),(64.0f))));f=vec4(F.rgb,r.a);}",ts=_t+"in vec4 c,a,b;in mat4 e;uniform mat4 o,q,p;out vec4 t,s,r,u;void main(){t=e*c;s=transpose(inverse(e))*b*-1.0f;r=a;u=p*t;gl_Position=o*q*t;}",ss=_t+"uniform sampler2D j,h;in vec2 v;out vec4 f;void main(){vec4 w=texture(h,v);f=vec4((texture(j,v)).rgb+2.0f*w.a*w.rgb,1);}",es=_t+"in vec2 c,d;out vec2 v;void main(){gl_Position=vec4(c,0,1);v=d;}",is=(t,e)=>pt.getUniformLocation(t,e),rs=(t,e)=>(t=pt.createShader(t),pt.shaderSource(t,e),pt.compileShader(t),t),hs=(t,e)=>{t=rs(35633,t),e=rs(35632,e);var i=pt.createProgram();return pt.attachShader(i,t),pt.attachShader(i,e),pt.linkProgram(i),i},ns=hs(_t+"in vec4 c;layout(location=3)in mat4 e;uniform mat4 o,q;void main(){gl_Position=o*q*e*c;}",_t+"out vec4 f;void main(){f=vec4(1);}"),as=is(ns,"q"),os=is(ns,"o"),fs=hs(ts,Jt),cs=is(fs,"q"),ls=is(fs,"o"),us=is(fs,"p"),vs=is(fs,"k"),$s=is(fs,"g"),ms=is(fs,"i"),xs=is(fs,"n"),ds=is(fs,"m"),ws=hs(Yt,Ot),Ms=is(ws,"j"),bs=is(ws,"l"),gs=hs(es,ss),ys=is(gs,"j"),As=is(gs,"k"),ps=is(gs,"h"),Ps=pt.createVertexArray(),Qs=(pt.bindVertexArray(Ps),pt.createBuffer()),Ts=(pt.bindBuffer(Kt,Qs),pt.bufferData(Kt,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),Ut),pt.enableVertexAttribArray(0),pt.vertexAttribPointer(0,2,Wt,!1,0,0),pt.createBuffer());pt.bindBuffer(Kt,Ts),pt.bufferData(Kt,new Float32Array([0,0,1,0,0,1,1,0,1,1,0,1]),Ut),pt.enableVertexAttribArray(1),pt.vertexAttribPointer(1,2,Wt,!1,0,0);class Is{constructor(t,e,i){this.g=t,this.A=e.length/6,this.b=pt.createVertexArray(),pt.bindVertexArray(this.b),this.T=pt.createBuffer(),pt.bindBuffer(Kt,this.T),pt.bufferData(Kt,e,Ut),pt.enableVertexAttribArray(0),pt.vertexAttribPointer(0,3,Wt,!1,24,0),pt.enableVertexAttribArray(2),pt.vertexAttribPointer(2,3,Wt,!1,24,12),this.k=new Uint32Array(17*i),this.z=pt.createBuffer(),pt.bindBuffer(Kt,this.z),pt.bufferData(Kt,this.k,t),pt.enableVertexAttribArray(1),pt.vertexAttribPointer(1,4,5121,!0,68,0),pt.vertexAttribDivisor(1,1),this.F=Array(i);for(let t=0;i>t;t++)this.F[t]=new Float32Array(this.k.buffer,4+68*t,16);pt.enableVertexAttribArray(3);for(let t=0;t<4;t++){const e=3+t;pt.enableVertexAttribArray(e),pt.vertexAttribPointer(e,4,Wt,!1,68,4+16*t),pt.vertexAttribDivisor(e,1)}this.P=0}C(){this.P=0}B(t){var e=this.P++;return this.k[17*e]=t,kt(this.F[e])}O(){pt.bindBuffer(Kt,this.z),pt.bufferSubData(Kt,0,this.k,0,17*this.P)}q(){pt.bindVertexArray(this.b),pt.drawArraysInstanced(4,0,this.A,this.P)}}const Bs=t=>{var e=pt.createTexture(),i=(pt.bindTexture(Nt,e),pt.texImage2D(Nt,0,6408,t,t,0,6408,5121,null),pt.texParameteri(Nt,10241,9729),pt.texParameteri(Nt,10242,Xt),pt.texParameteri(Nt,10243,Xt),pt.createTexture()),s=(pt.bindTexture(Nt,i),pt.texImage2D(Nt,0,36012,t,t,0,6402,Wt,null),pt.texParameteri(Nt,10240,9728),pt.texParameteri(Nt,10241,9728),pt.texParameteri(Nt,10242,Xt),pt.texParameteri(Nt,10243,Xt),pt.createFramebuffer());return pt.bindFramebuffer(Zt,s),pt.framebufferTexture2D(Zt,36064,Nt,e,0),pt.framebufferTexture2D(Zt,36096,Nt,i,0),{E:t,S:e,D:i,j:s}},ks=t=>{pt.bindFramebuffer(Zt,t.j),pt.viewport(0,0,t.E,t.E)},Ss=[Y(-1,1,-1),Y(1,1,-1),Y(1,1,1),Y(-1,1,1),Y(-1,-1,-1),Y(1,-1,-1),Y(1,-1,1),Y(-1,-1,1)],Ds=(t,e,i,s,r,n)=>{Fs(t,e,i,s,n,n,n),Fs(t,e,s,r,n,n,n)},Fs=(t,e,i,s,r,n,h)=>{Hs(t,e),Hs(t,r),Hs(t,i),Hs(t,n),Hs(t,s),Hs(t,h)},Hs=(t,e)=>t.push(...e),qs=Lt(),Rs=Lt(),Cs=Bt(),Es=Bt(),zs=Y(),Ls=Bt(),Vs=Bt(),Ks=Bt(),Us=(()=>{var t=[],[e,i,s,r,n,h,a,o]=Ss;return Ds(t,e,i,s,r,Y(0,1,0)),Ds(t,o,a,h,n,Y(0,-1,0)),Ds(t,i,e,n,h,Y(0,0,-1)),Ds(t,r,s,a,o,Y(0,0,1)),Ds(t,e,r,o,n,Y(-1,0,0)),Ds(t,s,i,h,a,Y(1,0,0)),new Float32Array(t)})(),js=(()=>{const h=[],t=Y(-1,0,0),e=Y(1,0,0),i=Y(0,-1,0),s=Y(0,1,0),r=Y(0,0,-1),n=Y(0,0,1),a=(t,e,i,s=0)=>{if(3===s)Fs(h,t,e,i,t,e,i);else{const h=Y(),r=Y(),n=Y();$t(h,ht(h,t,e)),$t(r,ht(r,e,i)),$t(n,ht(n,i,t)),a(t,h,n,s+1),a(h,e,r,s+1),a(n,r,i,s+1),a(h,r,n,s+1)}};return a(t,n,i),a(n,e,i),a(e,r,i),a(r,t,i),a(n,t,s),a(e,n,s),a(r,e,s),a(t,r,s),new Float32Array(h)})(),Ws=[new Is(Ut,Us,4096),new Is(Ut,js,4096),new Is(jt,Us,4096),new Is(jt,js,4096)],Ns=Bs(1024),Gs=Bs(1024),Xs=Bs(512),Zs=Bs(512),_s=t=>{for(const e of Ws)e.g===t&&e.C()},Os=t=>{for(const e of Ws)e.g===t&&e.O()},Ys=()=>{for(const t of Ws)t.q()},Js=()=>{pt.clearColor(0,0,0,1),pt.clear(16640),pt.enable(2884),pt.enable(2929),pt.depthFunc(515),pt.enable(3042),pt.blendFunc(770,771)},te=(t,e,i)=>{var s=Cs,r=t.y;e/=i,r=1/Math.tan(r/2),s[0]=r/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/-999.9*-1000.1,s[11]=1,s[12]=0,s[13]=0,s[14]=1/-999.9*200,s[15]=0,Rt(Ls,kt(Ls),t.v),Ct(Vs,kt(Vs),-t.p),Dt(Es,Ls,Vs),vt(zs,t.l),Ft(Es,Es,zs)},se=(t=0,e=0,i=0,s=1)=>new Float32Array([t,e,i,s]),ee=t=>(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t),ie=(t,e,i)=>{var s=e[0],r=e[1],n=e[2],h=(e=e[3],Math.sin(i*=.5));return i=Math.cos(i),t[0]=s*i+e*h,t[1]=r*i+n*h,t[2]=n*i-r*h,t[3]=e*i-s*h,t},re=(t,e,i)=>{var s=e[0],r=e[1],n=e[2],h=(e=e[3],Math.sin(i*=.5));return i=Math.cos(i),t[0]=s*i-n*h,t[1]=r*i+e*h,t[2]=n*i+s*h,t[3]=e*i-r*h,t},he=Y(),ne=se();class ae{constructor(t){this.I=100,this.R=0,this.U=0,this.N=!1,this.G=100,this._=0,this.H=4286611584,this.L=!1,this.V=!1,this.$=t,oe.push(this)}W(){return Ji-this._<.5}Y(){return this.W()&&(5*Ji|0)%2==0}Z(t){return this.Y()?4278190208:t}J(t){var e;t[1]=0,$t(t,t),.5<st(t)&&(ft(this.$.K,this.$.K,.5*tr),ct(this.$.Q,this.$.Q,t,tr*this.G),48<(e=st(this.$.Q))&&ft(this.$.Q,this.$.Q,48/e),this.X(t[0],t[2],.07),this.N=!0)}tt(t){nt(he,t,this.$.st),this.J(he)}it(){return lt(this.$.st,Li.$.st)}X(f,c,l=.2){ee(ne),re(ne,ne,Math.atan2(f,c));{f=this.$.et;var u=(c=this.$.et)[0],v=c[1],p=c[2];c=c[3];let t,e,i,s,r,n=ne[0],h=ne[1],a=ne[2],o=ne[3];(e=u*n+v*h+p*a+c*o)<0&&(e=-e,n=-n,h=-h,a=-a,o=-o),r=1-e>O?(t=Math.acos(e),i=Math.sin(t),s=Math.sin((1-l)*t)/i,Math.sin(l*t)/i):(s=1-l,l),f[0]=s*u+r*n,f[1]=s*v+r*h,f[2]=s*p+r*a,f[3]=s*c+r*o}}nt(t,e=.2){nt(he,t,this.$.st),this.X(he[0],he[2],e)}ht(){this.ot?.(this)}q(){var t,e,i,s=this.H;0!==s&&(s=this.rt(2,s),[t,e,i]=this.$.ct,qt(s,s,t,e,i))}rt(t,e){return t=Ws[t].B(e),Dt(t,t,this.$.ft),t}lt(t,e,i,s,r,n,h,a){return t=Ws[t].B(e),Dt(t,t,this.$.ft),Ht(t,t,i,s,r),qt(t,t,n,h,a),t}}const oe=[],fe="#000",ce="#0f0",le=t=>Qt.globalAlpha=t,ue=(t,e,i,s=fe)=>{Qt.fillStyle=s,Qt.fillText(t,e,i)},ve=(t,e,i,s="#fff")=>{for(const r of t.split("\n"))ue(r,e+1,i+1),ue(r,e,i,s),i+=24},$e=(t,e="bold")=>{Qt.font=e+` ${t}px sans-serif`},me=t=>{Qt.textAlign=t},xe=(t,e,i,s,r)=>{Qt.fillStyle=r,Qt.beginPath(),Qt.ellipse(t,e,i,s,0,0,2*Math.PI),Qt.fill()},de=Bt(),we=Y(),Me=(t,e,i)=>4278190080+(i<<16)+(e<<8)+t,be=4281545523,ge=4293980400,ye=1e4,Ae=se();class pe{constructor(t){this.ut=.01,this.wt=.01,this.Mt=!1,this.dt=0,this.vt=t>=ye,this.yt=t,this.xt=ye>t?1/t:0,this.st=Y(),this.et=se(),this.Q=Y(),this.K=Y(),this.gt=Bt(),this.ft=Bt(),this.At=Bt(),this.bt=Y(),this.Tt=Y()}ht(){var t,e,i,s,r,n,h=1/60/10,a=(this.vt||(this.Q[1]-=60*h),ct(this.st,this.st,this.Q,h),this.K[0]),o=this.K[1],f=this.K[2],c=st(this.K);c>O&&(h*=.5*c,n=Math.sin(h),[a,o,f,c,n=0]=[Ae,a/c*n,o/c*n,f/c*n,Math.cos(h)],a[0]=o,a[1]=f,a[2]=c,a[3]=n,h=this.et,f=(o=this.et)[0],c=o[1],a=o[2],o=o[3],n=Ae[0],i=Ae[1],s=Ae[2],r=Ae[3],h[0]=f*r+o*n-c*s+a*i,h[1]=c*r+o*i-a*n+f*s,h[2]=a*r+o*s-f*i+c*n,h[3]=o*r-f*n-c*i-a*s,h=this.et,o=this.et,0<(r=Math.hypot(o[0],o[1],o[2],o[3]))?((t=h)[0]=(e=o)[0]*(r=1/r),t[1]=e[1]*r,t[2]=e[2]*r):((e=h)[0]=(t=o)[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}kt(){var t,e,i,s,r,n,h,a,o,f,c,l,u,v,p,$,x,w,m,d,M,b,g,Y,y,L,G,A,Q,P;zt(this.ft,this.et,this.st),t=this.At,i=(e=this.ft)[0],r=e[2],n=e[3],o=e[6],f=e[7],c=e[8],l=e[9],v=e[11],p=e[12],$=e[13],x=e[14],(P=(w=i*(a=e[5])-(s=e[1])*(h=e[4]))*(Q=(u=e[10])*(e=e[15])-v*x)-(m=i*o-r*h)*(A=l*e-v*$)+(d=i*f-n*h)*(G=l*x-u*$)+(M=s*o-r*a)*(L=c*e-v*p)-(b=s*f-n*a)*(y=c*x-u*p)+(g=r*f-n*o)*(Y=c*$-l*p))&&(t[0]=(a*Q-o*A+f*G)*(P=1/P),t[1]=(r*A-s*Q-n*G)*P,t[2]=($*g-x*b+e*M)*P,t[3]=(u*b-l*g-v*M)*P,t[4]=(o*L-h*Q-f*y)*P,t[5]=(i*Q-r*L+n*y)*P,t[6]=(x*d-p*g-e*m)*P,t[7]=(c*g-u*d+v*m)*P,t[8]=(h*A-a*L+f*Y)*P,t[9]=(s*L-i*A-n*Y)*P,t[10]=(p*b-$*d+e*w)*P,t[11]=(l*d-c*b-v*w)*P,t[12]=(a*y-h*G-o*Y)*P,t[13]=(i*G-s*y+r*Y)*P,t[14]=($*m-p*M-x*w)*P,t[15]=(c*M-l*m+u*w)*P)}zt(t){return Mt(this.bt,t.Tt)&&Mt(t.bt,this.Tt)}Ft(t){return Mt(this.bt,t)&&Mt(t,this.Tt)}}const Pe=Y();class Qe extends pe{constructor(t,e){super(t),this.ct=e,this.Pt=Ss.map(tt),ye>t?(this.gt[0]=12/(t*(e[1]*e[1]+e[2]*e[2])),this.gt[5]=12/(t*(e[0]*e[0]+e[2]*e[2])),this.gt[10]=12/(t*(e[0]*e[0]+e[1]*e[1]))):(this.gt[0]=0,this.gt[5]=0,this.gt[10]=0)}Ct(){it(this.bt,this.st),it(this.Tt,this.st);for(let t=0;t<8;t++)(e=this.Pt[t])[0]=(i=this.ct)[0]*(s=Ss[t])[0],e[1]=i[1]*s[1],e[2]=i[2]*s[2],wt(this.Pt[t],this.Pt[t],this.ft),at(this.bt,this.bt,this.Pt[t]),ot(this.Tt,this.Tt,this.Pt[t]);var e,i,s}Bt(t){return wt(Pe,t,this.At),this.ct[0]>=Math.abs(Pe[0])&&this.ct[1]>=Math.abs(Pe[1])&&this.ct[2]>=Math.abs(Pe[2])}}class Te extends ae{constructor(t){super(new Qe(1,Y(1,1,1))),it(this.$.st,t),this.E=.6,this.Ot=100,this.H=ge,this.qt=Y(),this.$.Mt=!0}ht(){ct(this.$.Q,this.$.Q,this.qt,tr),ct(this.$.st,this.$.st,this.$.Q,tr),this.I-=tr*this.Ot}q(){var t=this.E*(this.I/100),e=this.rt(3,this.H);qt(e,e,t,t,t)}}class Ie extends Te{constructor(t,e,i){super(t),this.Et=e,this.St=i,this.$.st[1]+=4,this.$.Q[1]=2,this.qt[1]=2}q(){var t=this.Et,e=this.$.st,i=this.St;$e(16),Dt(de,Cs,Es),wt(we,e,de),0<we[2]&&(me("center"),ve(t,.5*(1+we[0])*bt,.5*(1-we[1])*gt,i))}}class Be extends ae{constructor(t,e,i){super(new Qe(10,Y(2.5,2,2.5))),rt(this.$.st,t,e,i),this.$.wt=1e-4,this.G*=.2}q(){const t=this.$.ct[0]/2.5;qt(this.$.ft,this.$.ft,t,t,t);var e=.1*Math.sin(4*Ji),i=.1*Math.sin(3*Ji),s=3.3+.3*Math.sin(4*Ji),r=this.L?4278190335:4278255360,n=(this.lt(3,4292927712,0,4+e,0,4.2,3.5,4.2),this.lt(3,4292927712,0,3.6+i,0,3.9,3.8,3.8),this.rt(3,r));Ht(n,n,-1,5+e,3.7),r=this.rt(3,r),Ht(r,r,1,5+e,3.7),this.L&&(Et(n,n,.8),Et(r,r,-.8)),qt(n,n,.3,.9,.3),qt(r,r,.3,.9,.3),this.lt(3,4282400832,0,3+i,.2,3.4,2.7,3.7);{const t=this.rt(3,4278190320);Ht(t,t,0,3.5+i,2),Ct(t,t,.3*Math.sin(7*Ji)),Rt(t,t,Math.PI/4),qt(t,t,1.5,.5,s)}}}class ke{constructor(e){this.Dt=e,this.jt=Array(e);for(let t=0;e>t;t++)this.jt[t]={It:!1,Rt:0,Ut:2}}clear(){for(let t=0;this.Dt>t;t++)this.jt[t].It=!1,this.jt[t].Rt=0}Nt(t){return this.jt[t]}Gt(){for(let t=0;this.Dt>t;t++)(e=this.jt[t]).It?(e.Rt++,e.Ut=0):(e.Rt=0,e.Ut++);var e}_t(){for(let t=0;this.Dt>t;t++)if(this.jt[t].It)return!0;return!1}}const Se=new ke(16),De=new ke(256),Fe=t=>De.Nt(t).It,He=t=>1===De.Nt(t).Rt,qe=(document.addEventListener("keydown",t=>{De.Nt(t.keyCode).It=!0}),document.addEventListener("keyup",t=>{De.Nt(t.keyCode).It=!1}),window.addEventListener("blur",()=>{De.clear()}),()=>{De.clear(),Se.clear()}),Re=t=>{t.it()<32&&t.nt(Li.$.st)},Ce=t=>{var e=t.it();e<6?(t.I=0,Li.R+=t.R,Li.U+=t.U,C.c(),new Ie(t.$.st,""+t.R,ce),t.Ht&&(t.Ht.Lt=!1)):e<8&&dt(t.$.st,t.$.st,Li.$.st[0],Li.$.st[1],Li.$.st[2],.1)};class Ee extends ae{constructor(t,e,i,s){super(new Qe(5,Y(.1,.1,.1))),this.Ht=s,rt(this.$.st,t,e,i),this.H=Me(244,244,0),this.R=100,this.ot=Ce}q(){var t=5+.2*Math.sin(4*Ji);Ct(this.$.ft,this.$.ft,2*Ji),this.lt(2,this.H,0,t,0,1.5,.25,.25),this.lt(2,this.H,-1.25,t-.5,0,.25,.5,.25),this.lt(2,this.H,-.25,t-.5,0,.25,.5,.25),this.lt(2,this.H,1.5,t,0,.25,.75,.25),this.lt(2,this.H,2.5,t,0,.25,.75,.25),this.lt(2,this.H,2,.75+t,0,.75,.25,.25),this.lt(2,this.H,2,t-.75,0,.75,.25,.25)}}class ze extends ae{constructor(t,e,i,s){super(new Qe(ye,Y(.1,.1,.1))),this.Vt=!1,this.$t=s,rt(this.$.st,t,e,i),this.X(0,-1,1),this.H=Me(244,244,0),this.ot=Re}ht(){super.ht(),O>Gi.Wt&&!this.Vt&&this.it()<32&&(this.$t(),this.Vt=!0)}q(){var t=.2*Math.sin(4*Ji);this.lt(3,4293980400,0,4+t,0,1.5,1.5,1.5),this.lt(3,4288069610,0,6+t,0,1.5,1,1.5),this.lt(3,4291021703,-.75,6.2+t,1.25,.7,.7,.2),this.lt(3,4291021703,.75,6.2+t,1.25,.7,.7,.2),this.lt(3,4293980400,0,6.5+t,0,.25,1.5,.25)}}const Le=t=>{t.tt(Li.$.st),t.V||Li.W()||8<=t.it()||(Gi.Yt=Ji+.5,Li._=Ji+.5,Li.I-=10,V.c())},Ve=i=>{let s=0;return t=>{var e;t.it()<32?(t.$.Q[1]=20,t.ot=Le,t.L=!0):(e=i[s],ut(t.$.st,e)<4?(s=(s+1)%i.length,ft(t.$.Q,t.$.Q,.3)):t.tt(e))}};class Ke extends ae{constructor(t,e,i){super(new Qe(5,Y(.1,.1,.1))),rt(this.$.st,t,e,i),this.H=Me(244,244,0),this.R=100,this.U=10,this.ot=Ce}q(){var t=this.rt(2,this.H);Ht(t,t,0,5+.2*Math.sin(4*Ji),0),Ct(t,t,2*Ji),Rt(t,t,Math.PI/4),Et(t,t,Math.PI/4),qt(t,t,.5,.5,.5)}}class Ue extends ae{constructor(t,e,i,s,r,n=!1){super(new Qe(ye,Y(6,6,3))),this.Zt=s,this.Jt=r,this.Lt=n,rt(this.$.st,t,e,i);for(let t=0;t<16;t++){const e=Ws[0].B(4282441792);Ft(e,e,this.$.st),Et(e,e,t*Math.PI/8),Ht(e,e,0,5,0),qt(e,e,1.195,1,3)}{const t=Ws[1].B(4278190080);Ft(t,t,this.$.st),Ht(t,t,0,0,-1),qt(t,t,4,4,.25)}}ht(){!Li.ot&&!this.Lt&&this.Zt&&ut(this.Zt[0],Li.$.st)<4&&(this.Jt&&this.Jt(),Li.ot=((i,s)=>{let r=0;return t=>{var e;r>=s.length?(t.ot=i,t.$.Mt=!1,U.c()):(e=s[r],lt(t.$.st,e)<2?r++:(nt(t.$.Q,e,t.$.st),t.X(t.$.Q[0],t.$.Q[2],.1),$t(t.$.Q,t.$.Q),ft(t.$.Q,t.$.Q,50),ct(t.$.st,t.$.st,t.$.Q,tr)))}})(Li.ot,this.Zt),Li.$.Mt=!0,X.w(),U.c())}q(){this.Lt&&(this.lt(2,4282446064,0,0,-4,1,.8,.5),this.lt(2,4282446064,-.6,1.3,-4,.2,.6,.2),this.lt(2,4282446064,.6,1.3,-4,.2,.6,.2),this.lt(2,4282446064,0,1.8,-4,.6,.2,.2))}}const je=(t,e)=>{oe.length=0,qe(),_s(jt),_s(Ut),Gi.Kt=!1,Gi.Qt=0,Gi.Xt=0,Gi.Wt=0,Gi.ts=0,Li.I=100,Li.U=0,Li.ot=void 0,Li.$.Mt=!1,rt(Li.$.st,t,4,e),rt(Li.$.Q,0,0,0),rt(Li.$.K,0,0,0),ee(Li.$.et),oe.push(Li),Gi.ss=40,Gi.es=-50,Gi.ns=.1,rt(qs.l,t,200,e-50),it(qs.m,Li.$.st),Rs.x=.6},We=(t,e,i,s,r=4281352272)=>{(i=new ae(new Qe(ye,Y(i,4,s)))).H=r,rt(i.$.st,t,-4,e)},Ne=()=>{for(let e=-200;e<=200;e+=8)for(let t=-200;t<=200;t+=8){var i;(e+t)%16==0&&(i=Ws[0].B(4278190080),Ht(i,i,e,0,t),qt(i,i,4,.01,4))}},Ge=(t,e,i,s,r=4285563024)=>{(i=new ae(new Qe(ye,Y(i,16,s)))).H=r,rt(i.$.st,t,16,e)},Xe=(e,i,s,r,n)=>{for(let t=0;n>t;t++)new Ke(e+t*s,4,i+t*r)},Ze=(t,e)=>new Ue(t,6,e),_e=(t,e,i)=>new Ue(t,6,e,[Y(t,5,e-4),Y(t,5,e+12),Y(i,5,e+12),Y(i,5,e-13)]),Oe=(t,e,i)=>(_e(i,e,t),_e(t,e,i)),Ye=(t,e)=>new Ue(t,6,e,[Y(t,5,e-4),Y(t,5,e+200)],ir,!0),Je=(t,e,i,s)=>{var r=new Be(t,4,e);return r.ot=Ve([Y(t,4,e),Y(i,4,e),Y(i,4,s),Y(t,4,s)]),r},ti=()=>{{let t,i,s,r=e(),n=.95,h=6*r|0,a=n*(1-.6*(r=6*r-h)),o=n*(1-.6*(1-r));switch(h%6){case 0:t=n,i=o,s=.38;break;case 1:t=a,i=n,s=.38;break;case 2:t=.38,i=n,s=o;break;case 3:t=.38,i=a,s=n;break;case 4:t=o,i=.38,s=n;break;default:t=n,i=.38,s=a}return Me(255*t|0,255*i|0,255*s|0)}},si=(s,r,n,h)=>{for(let t=0;r>t;t++){const r=new ae(new Qe(h,Y(n,n,n)));r.$.Q[1]=10,r.H=ti(),rt(r.$.st,s[0]+4*i(),s[1]+4*t,s[2]+4*i()),ie(r.$.et,r.$.et,e()),re(r.$.et,r.$.et,e())}},ei=(i,s,r,n=2,h=2)=>{for(let e=0;e<3;e++)for(let t=i;s>=t;t+=2*h){const i=new ae(new Qe(n,Y(h,h,h)));i.H=ti(),rt(i.$.st,t,1+2*e*h,r)}},ii=(t,e)=>{We(0,0,t,e),Ge(0,e,t,1),Ge(-t,0,1,e),Ge(0,-e,t,1,0),Ge(t,0,1,e)},ri=e=>{je(0,4-e),ii(e,e),Ne(),Xe(8-e,4-e,8,0,2*(e-8)/8);const r=Ye(0,e-4),n=e/10|0;for(let t=0;n>t;t++){const n=Y(i()*e,10,i()*e*.5),h=Y(i()*e,10,i()*e*.5),a=new Be(n[0],n[1],n[2]);a.ot=Ve([n,h]),0===t&&(a.hs=()=>{L.c(),new Ee(a.$.st[0],10,s(a.$.st[2]+8,4,e-4),r)})}},hi=t=>{je(0,4-t),ii(t,t),Xe(8-t,4-t,0,8,e=(t-4)/4|0),Xe(t-8,4-t,0,8,e);var e=Ye(0,t-4);new Ee(0,8,0,e)},ni=t=>{if(t.it()<32&&(Gi.Kt=!0),Gi.Kt&&!Gi.os){if(t.nt(Li.$.st),Ji>Gi.Qt&&Gi.Xt<7){Gi.Xt++;const t=new Be(-40,4,40);t.L=!0,t.ot=Le;var e=new Be(40,4,40);e.L=!0,e.ot=Le,Gi.Qt=Ji+3}7<=Gi.Xt&&1===oe.filter(t=>t instanceof Be).length&&(Gi.os=Ji,t.I=0,t.L=!1,L.c(),Rs.x=.8,e=100*Math.max(0,500-(0|Ji)),$r(["Wow, you did it!  All the ghosts are gone!","Time bonus: "+e.toLocaleString(),"Total score: "+(Li.R+e).toLocaleString()]))}},ai=()=>{je(0,-32);const t=new ae(new Qe(ye,Y(400,1,400)));t.H=4281352272,rt(t.$.st,0,-1,0),new Ue(0,6,-4,[Y(0,4,-4)]);{const t=Ws[0].B(4286611584);Ht(t,t,0,100,10),qt(t,t,100,100,10)}for(let e=-80;e<=80;e+=20)for(let t=22;t<=190;t+=40){var i=Ws[0].B(Math.random()<.5?4278231200:4278255615);Ht(i,i,e,t,0),qt(i,i,4,4,.5)}Os(Ut),rt(qs.l,0,300,-200),Gi.ss=40,Gi.es=-50,Gi.ns=.02},oi=[ai,()=>{je(0,4),We(0,40,30,40),Ge(-30,40,1,40),Ge(30,40,1,40),Xe(0,20,0,4,3),Xe(0,40,0,4,3),We(0,120,80,40),Ge(-80,120,1,40),Ge(80,120,1,40),Ge(0,140,80,1),Xe(-70,84,4,0,8),Xe(70,84,-4,0,8),Ge(0,0,80,1,0),Ge(-55,80,25,1,0),Ge(55,80,25,1,0),new ze(0,0,130,()=>$r(["Oh, thank goodness you are here!","Use your ghost-vacuum to capture ghosts.","Then take the pipe to the next floor. Hurry!"]));var t=new ae(new Qe(ye,Y(8,1.5,4)));rt(t.$.st,0,1.5,124);const e=Ye(40,136),i=new Be(-50,6,115);i.ot=Re,re(i.$.et,i.$.et,2),i.hs=()=>{L.c(),new Ee(-67,8,117,e)},Gi.ss=30,Gi.es=-40},()=>{je(-80,0),re(Li.$.et,Li.$.et,1.6),ii(100,25),Xe(0,0,5,0,12),Ze(-80,21),new ze(-50,0,20,()=>$r(["Pardon the mess!","The key is around here somewhere.","Try vacuuming up the boxes."]));var t=Ye(60,21);new Ee(60,6,0,t),si(Y(0,8,0),20,1.5,.5),si(Y(30,8,0),20,1.5,.5),si(Y(60,8,0),20,1.5,.5)},()=>{je(-160,-24),We(0,0,200,50),Ge(0,4,200,1),Ge(0,-50,200,1,0);for(let t=-200;t<=200;t+=100)Ge(t,-25,1,25);Ze(-165,0),Oe(-135,0,-75),Xe(-165,-30,0,-5,4),Xe(-135,-30,0,-5,4),Oe(-35,0,35),Xe(-75,-30,0,-5,4),Xe(-35,-30,0,-5,4);const t=Ye(65,0);Je(20,-40,80,-40).hs=()=>{L.c(),new Ee(65,8,-12,t)}},()=>{ri(40)},()=>{je(0,-16),ii(40,20),Oe(-30,16,0),Ye(30,16).Lt=!1},()=>{hi(50)},()=>{ri(80)},()=>{je(0,-16),ii(80,20),Oe(-60,16,60),Oe(-30,16,0),Ye(30,16).Lt=!1},()=>{je(0,-40),ii(50,50),Xe(-45,-20,5,0,18),ei(-40,-20,10,5),ei(-10,10,10,5),ei(20,40,10,5),Je(30,16,30,16);var t=Ye(0,46);new Ee(-30,8,15,t)},()=>{ri(80)},()=>{je(0,-16),ii(80,20),Oe(-60,16,60),Oe(0,16,30),Ye(-30,16).Lt=!1},()=>{hi(50)},()=>{je(0,-45),Rs.x=.2,ii(50,50),Ne(),Xe(-40,-20,0,5,8),Xe(0,-20,0,5,8),Xe(40,-20,0,5,8);var t=new Be(0,0,45);t.$.Mt=!0,rt(t.$.ct,8,8,8),t.ot=ni,t.L=!0,Os(Ut),vr("Hmm, the lights are out")}],fi=J(15),ci=Y(),li=(t,e)=>{let i=1/0,s=-1/0;for(const r of t.Pt){const t=mt(r,e);i=Math.min(i,t),s=Math.max(s,t)}return[i,s]},ui=(t,e,i,s)=>e<i||s<t,vi=(t,e)=>{ht(t.rs,t.rs,e),it(t.cs[t.fs],e),t.fs++},$i=Y(),mi=Y(),xi=Y(),di=Y(),wi=Y(),Mi=Y(),bi=Y(),gi=Bt(),yi=Bt(),Ai=Bt(),pi=Bt(),Pi=Y(),Qi=Y(),Ti=Y(),Ii=Y(),Bi=Y(),ki=Y(),Si=Y(),Di=Y(),Fi=Y(),Hi=Y(),qi=Y(),Ri=(e,i,s)=>{var{ls:t,us:r}=s,n=i.xt/(e.xt+i.xt);ct(e.st,e.st,t,r*(e.xt/(e.xt+i.xt))),e.kt(),e.Ct(),ct(i.st,i.st,t,-r*n),i.kt(),i.Ct(),it(Di,e.Q),it(Fi,i.Q),it(Hi,e.K),it(qi,i.K);for(let t=0;s.fs>t;t++)Ci(e,i,s,t);it(e.Q,Di),it(i.Q,Fi),it(e.K,Hi),it(i.K,qi)},Ci=(t,e,i,s)=>{var r,n=i.ls;s=i.cs[s],nt($i,s,t.st),nt(mi,s,e.st),xt(di,$i,t.K),xt(Mi,mi,e.K),ht(xi,e.Q,Mi),nt(xi,xi,t.Q),nt(xi,xi,di),mt(xi,n)<0||(zt(gi,t.et,et),St(yi,gi),Dt(Ai,gi,t.gt),Dt(Ai,Ai,yi),zt(gi,e.et,et),St(yi,gi),Dt(pi,gi,e.gt),Dt(pi,pi,yi),xt(di,$i,n),wt(wi,di,Ai),s=mt(wi,di),xt(Mi,mi,n),wt(bi,Mi,pi),r=mt(bi,Mi),r=-(1+Math.min(t.ut,e.ut))*mt(xi,n)/(t.xt+e.xt+s+r),ft(Pi,n,r),ct(Di,Di,Pi,-t.xt),ct(Fi,Fi,Pi,e.xt),xt(di,$i,Pi),wt(wi,di,Ai),ht(Hi,Hi,wi),xt(Mi,mi,Pi),wt(bi,Mi,pi),nt(qi,qi,bi),ft(Qi,n,mt(xi,n)),nt(Ti,xi,Qi),1e-6<(n=st(Ti))&&(ft(Ii,Ti,1/n),ft(Bi,Ii,-Math.min(Math.min(t.wt,e.wt)*Math.max(Math.abs(r)/i.cs.length,9.8),n)),Ei(Di,Bi,t.xt),Ei(Fi,Bi,-e.xt),xt(ki,$i,Bi),xt(Si,mi,Bi),wt(ki,ki,t.gt),wt(Si,Si,e.gt),Ei(Hi,ki,1),Ei(qi,Si,-1)))},Ei=(i,s,r)=>{for(let e=0;e<3;e++){let t=s[e]*r;Math.sign(i[e])!==Math.sign(t)&&(t=-t),Math.abs(t)>Math.abs(i[e])&&(t=i[e]),i[e]-=t}},zi="PRESS ENTER TO CONTINUE",Li=new class extends ae{constructor(){super(...arguments),this.ws=0,this.Ms=0,this.ds=0}q(){const t=20*Ji,e=Math.hypot(this.$.Q[0],this.$.Q[2]),i=.005*e;Ht(this.$.ft,this.$.ft,0,.005*Math.sin(t)*e,0),Rt(this.$.ft,this.$.ft,i),this.N?(this.ds=.02*e*Math.sin(Ji%.8/.8*2*Math.PI),this.ws=this.Ms=-this.ds):(this.ws=r(this.ws,0,.1),this.Ms=r(this.Ms,0,.1),this.ds=r(this.ds,0,.1));var s=this.Z(4286160833),n=this.Z(4293980400),h=this.Z(4289773784),a=this.Z(4285301131),o=this.Z(4280295632),f=this.Z(4281356384);this.lt(3,s,0,5.9,0,.6,.8,.6);{const t=this.rt(3,n);Ht(t,t,0,6.2,0),Rt(t,t,-.6),qt(t,t,.6,.5,.75)}{const t=this.rt(3,n);Ht(t,t,0,5.5,.15),Rt(t,t,.75),qt(t,t,.55,.4,.75)}this.lt(3,be,-.2,6,.5,.15,.15,.2),this.lt(3,be,.2,6,.5,.15,.15,.2),this.lt(3,h,0,3.9,.2,1.3,1.5,1),this.lt(3,h,.7,4.7,.1,.9,.6,.6),this.lt(3,h,-.7,4.7,.1,.9,.6,.6),this.lt(3,o,-.4,4,-.8,.6,1.2,.6),this.lt(3,o,.4,4,-.8,.6,1.2,.6),this.lt(3,f,0,2.9,.2,1.25,.5,1);{const t=this.rt(3,f);Ht(t,t,.65,4.5,.2),Et(t,t,.5),qt(t,t,.3,1.1,.8)}{const t=this.rt(3,f);Ht(t,t,-.65,4.5,.2),Et(t,t,-.5),qt(t,t,.3,1.1,.8)}{const t=this.rt(3,h);Ht(t,t,1,4.5,0),Rt(t,t,-1),Et(t,t,-1.3),Ht(t,t,.75,0,0),qt(t,t,1.4,.4,.4)}this.lt(3,o,_,3.2,1.2,.4,.4,1.5),this.lt(3,4286644223,_,3.2,2.4,.4,.4,.4),this.lt(2,ge,1.4,2.4,2,.4,.3,.2);{const t=this.rt(3,h);Ht(t,t,-1,4.5,0),Rt(t,t,this.ws),Et(t,t,1.2),Ht(t,t,-.75,0,0),qt(t,t,1.4,.4,.4)}{const t=this.rt(3,a);Ht(t,t,0,3,0),Rt(t,t,this.Ms),Ht(t,t,.7,-1.6,0),qt(t,t,.6,1.6,.6)}{const t=this.rt(3,f);Ht(t,t,0,3,0),Rt(t,t,this.Ms),Ht(t,t,.7,-3.1,.4),Rt(t,t,-this.Ms),qt(t,t,.5,.5,.8)}{const t=this.rt(3,a);Ht(t,t,0,3,0),Rt(t,t,this.ds),Ht(t,t,-.7,-1.6,0),qt(t,t,.6,1.6,.6)}{const t=this.rt(3,f);Ht(t,t,0,3,0),Rt(t,t,this.ds),Ht(t,t,-.7,-3.1,.4),Rt(t,t,-this.ds),qt(t,t,.5,.5,.8)}}}(new Qe(10,Y(2,2,2))),Vi=(Li.G*=1.3,Y()),Ki={us:0,ls:Y(),rs:Y(),cs:J(16),fs:0},Ui=Y(),ji=Y(),Wi=Y(),Ni=Y(),Gi={vs:0,ps:!1,ss:50,es:-60,ns:.01,Yt:0,ys:"",xs:0,Wt:0,ts:0,gs:void 0,Kt:!1,Qt:0,Xt:0,os:0};let Xi,Zi=!1,_i=0,Oi=!1,Yi=0,Ji=0,tr=0,sr=0;const er=()=>{Xi=oi[Gi.vs]},ir=()=>{Gi.vs++,er()},rr=t=>{tr=Math.min((t*=.001)-Yi,1/30),Yi=t,Gi.ps||(Ji+=tr),De.Gt(),Qt.clearRect(0,0,bt,gt),Qt.textBaseline="top",_s(jt),Oi?Zi?hr():(Qt.textBaseline="middle",$e(16),me("center"),ve(zi,480,270),(De._t()||Se._t())&&(Zi=!0,F.a(),ai(),qe())):(Qt.textBaseline="middle",$e(16),me("center"),ve("LOADING...",480,270),Qt.strokeStyle="white",Qt.lineWidth=1,Qt.strokeRect(400,300,160,10),Qt.fillStyle="white",Qt.fillRect(400,300,160*_i,10));{Os(jt),ks(Ns),Js(),te(Rs,Ns.E,Ns.E),pt.useProgram(ns),pt.uniformMatrix4fv(os,!1,Cs),pt.uniformMatrix4fv(as,!1,Es),Ys(),kt(Ks),Ht(Ks,Ks,.5,.5,.5),qt(Ks,Ks,.5,.5,.5),Dt(Ks,Ks,Cs),Dt(Ks,Ks,Es),ks(Gs),Js(),te(qs,bt,gt),pt.useProgram(fs),pt.uniformMatrix4fv(ls,!1,Cs),pt.uniformMatrix4fv(cs,!1,Es),pt.uniformMatrix4fv(us,!1,Ks),pt.uniform3fv(ms,qs.l),pt.uniform3fv(xs,Rs.l),pt.uniform3fv(ds,Rs.direction),pt.activeTexture(Gt),pt.bindTexture(Nt,Ns.D),pt.uniform1i(vs,0),pt.uniform1f($s,Rs.x),Ys();let e=Gs,i=Xs;pt.useProgram(ws);for(let t=0;t<5;t++)ks(i),Js(),pt.bindVertexArray(Ps),pt.activeTexture(Gt),pt.bindTexture(Nt,e.S),pt.uniform1i(Ms,0),pt.uniform1i(bs,t),pt.drawArrays(4,0,6),i=t%2==0?(e=Xs,Zs):(e=Zs,Xs);pt.bindFramebuffer(Zt,null),pt.viewport(0,0,bt,gt),pt.useProgram(gs),pt.clearColor(0,0,0,1),pt.clear(16640),pt.bindVertexArray(Ps),pt.activeTexture(Gt),pt.bindTexture(Nt,Gs.S),pt.uniform1i(ys,0),pt.activeTexture(33985),pt.bindTexture(Nt,Gs.D),pt.uniform1i(As,1),pt.activeTexture(33986),pt.bindTexture(Nt,Xs.S),pt.uniform1i(ps,2),pt.drawArrays(4,0,6)}requestAnimationFrame(rr)},hr=(requestAnimationFrame(rr),()=>{nr(),fr(),cr(),lr(),dr(),Mr(),br()}),nr=()=>{(0===Gi.vs?ar:or)()},ar=()=>{He(13)&&(F.w(),D.a(),z.c(),ir())},or=()=>{if(Li.N=!1,rt(Vi,0,0,0),Fe(32)&&0<Li.U){let t,r=(Li.U-=10*tr,G.a(),Li.$.kt(),rt(Ui,1.4,3.2,2.4),wt(Ui,Ui,Li.$.ft),rt(ji,1.4,1,10),wt(ji,ji,Li.$.ft),nt(ji,ji,Ui),20);for(const h of oe)if(!h.$.vt&&!h.$.Mt&&h!==Li&&(nt(Wi,h.$.st,Ui),0<mt(Wi,ji))){var n=st(Wi);if(n<20)if(h.V=!0,n<3){it(h.$.Q,Li.$.Q);const n=h.$;if(ft(n.ct,n.ct,.8),n.ct[0]<.3){h.I=0,j.c(),Gi.Yt=Ji+.5;const n=h instanceof Be?1e3:10;Li.R+=n,new Ie(h.$.st,""+n,ce)}}else{const e=s(1e4/n,1e3,5e3)/h.$.yt,i=($t(Ni,Wi),ct(h.$.Q,h.$.Q,Ni,-tr*e),h.$.dt=0,st(h.$.Q));24<i&&ft(h.$.Q,h.$.Q,12/i)}r>n&&(t=h,r=n)}t&&Li.nt(t.$.st,.05)}else G.w();He(82)&&!Gi.os&&er(),He(77)&&D.M(),Xi?(sr+=.02)<1||(Xi(),Xi=void 0,Os(Ut)):sr=s(sr-.02,0,1);const h=1e-4;if((Fe(38)||Fe(87))&&(Vi[2]+=h),(Fe(40)||Fe(83))&&(Vi[2]-=h),(Fe(37)||Fe(65))&&(Vi[0]-=h),(Fe(39)||Fe(68))&&(Vi[0]+=h),0<st(Vi))Li.J(Vi);else{const n=.001**tr;Li.$.Q[0]*=n,Li.$.Q[2]*=n}if(20<st(Li.$.Q)){if(e()<.15){const n=new Te(Li.$.st);n.$.st[0]+=i(),n.$.st[2]+=i(),n.$.Q[1]=2,n.qt[1]=2}Li.ot||X.a()}else X.w();Gi.os&&oe.length<100&&Math.random()<.1&&si(Y(0,20,0),1,1,1)},fr=()=>{for(const t of oe)t.ht()},cr=()=>{Li.$.dt=0;const i=s(Math.round(600*tr),1,20);for(let t=0;i>t;t++){for(let t=0;oe.length>t;t++){const s=oe[t].$;s.Mt||s.vt||100<=s.dt||s.ht(),s.kt(),s.Ct()}for(let e=0;oe.length>e;e++){const s=oe[e];if(!s.$.Mt)for(let t=e+1;oe.length>t;t++){const i=oe[t];!i.$.Mt&&(!s.$.vt&&s.$.dt<100||!i.$.vt&&i.$.dt<100)&&s.$.zt(i.$)&&(n=i.$,(r=s.$)instanceof Qe)&&n instanceof Qe&&((t,e,i)=>{nt(fi[0],e.Pt[0],e.Pt[1]),nt(fi[1],e.Pt[0],e.Pt[3]),nt(fi[2],e.Pt[0],e.Pt[4]),nt(fi[3],i.Pt[0],i.Pt[1]),nt(fi[4],i.Pt[0],i.Pt[3]),nt(fi[5],i.Pt[0],i.Pt[4]);let s=6;for(let e=0;e<3;e++)for(let t=3;t<6;t++)xt(fi[s++],fi[e],fi[t]);let r,n=1/0;for(const t of fi)if(0!==t[0]||0!==t[1]||0!==t[2]){$t(t,t);var[h,a]=li(e,t),[o,f]=li(i,t);if(ui(h,a,o,f))return!1;n>(a=Math.min(a,f)-Math.max(h,o))&&(n=a,r=t)}nt(ci,e.st,i.st),mt(ci,r)<0&&vt(r,r),rt(t.rs,0,0,0),t.fs=0;for(const s of e.Pt)i.Ft(s)&&i.Bt(s)&&vi(t,s);for(const s of i.Pt)e.Ft(s)&&e.Bt(s)&&vi(t,s);return 0<t.fs?ft(t.rs,t.rs,1/t.fs):(ht(t.rs,e.st,i.st),ft(t.rs,t.rs,.5)),t.us=n,it(t.ls,r),!0})(Ki,r,n)&&Ri(s.$,i.$,Ki)}}}var r,n;for(const i of oe){i.V=!1;const s=i.$;s.vt||st(s.Q)<.5&&st(s.K)<.5&&s.dt++}},lr=()=>{0===Gi.vs?ur():Xi||mr()},ur=()=>{me("center"),$e(32),ve("PHANTOMICUS",480,80),le(.5*(Math.sin(5*Yi)+1)),$e(12),ve(zi,480,500),le(1)},vr=(t,e)=>{Gi.ys=t,Gi.xs=Ji,Gi.ts=1,Gi.gs=e,z.c(),N.c()},$r=e=>{let i;for(let t=e.length-1;0<=t;t--){const s=e[t],r=i;i=()=>vr(s,r)}i()},mr=()=>{Gi.Kt&&!Gi.os&&(me("center"),$e(20),ve(`WAVE ${Gi.Xt} / 7`,460,60)),me("left"),$e(20),ve("🏨 "+Gi.vs,10,20),ve("❤️ "+Li.I,10,60),ve("⚡ "+(0|Li.U),10,100),ve("💰 "+Li.R.toLocaleString(),10,140),ve("⏱️ "+Ji.toFixed(1),10,180),$e(12),ve("SPACEBAR - VACUUM    R - RESTART    M - MUSIC",10,520),xr()},xr=()=>{var t;Gi.Wt=r(Gi.Wt,Gi.ts,10*tr),.01<Gi.Wt&&(le(Gi.Wt),t=s(30*(Ji-Gi.xs),1,Gi.ys.length),He(13)&&(Gi.ys.length>t?Gi.xs=-1e3:(Gi.ts=0,Gi.gs&&Gi.gs())),Qt.fillStyle="rgba(60, 100, 210, 0.5)",Qt.fillRect(200,400,560,100),$e(20),ve(Gi.ys.substring(0,t),280,420),xe(210,445,6,40,"#f0f0f0"),xe(210,460,40,32,"#eabf96"),xe(190,455,18,18,"#76a190"),xe(230,455,18,18,"#76a190"),xe(210,470,10,8,"#e49076"),Gi.ys.length>t||(Qt.globalAlpha=(Math.sin(5*Ji)+1)*Gi.Wt,$e(12),ve(zi,560,480)),le(1))},dr=()=>{for(let t=oe.length-1;0<=t;t--){const e=oe[t];if(0<e.I)e.q();else if(e===Li)Xi||(E.c(),er());else{oe.splice(t,1);const i=e.hs;i&&setTimeout(()=>i(e),500)}}Fe(32)&&0<Li.U&&(wr(0),wr(5),wr(10),wr(15))},wr=t=>{var e=821096688,i=2+.3*(t=20-(30*Ji+t)%20),s=2+.2*t,r=.01*t;Li.lt(2,e,1.4-i,2.4,t,r,s,r),Li.lt(2,e,1.4+i,2.4,t,r,s,r),Li.lt(2,e,1.4,2.4+s,t,i,r,r),Li.lt(2,e,1.4,2.4-s,t,i,r,r)},Mr=()=>{var t;dt(qs.l,qs.l,Li.$.st[0],Li.$.st[1]+Gi.ss,Li.$.st[2]+Gi.es,Gi.ns),dt(qs.m,qs.m,Li.$.st[0],Li.$.st[1]+6,Li.$.st[2],Gi.ns),Gi.Yt>Ji&&(t=Gi.Yt-Ji,qs.m[0]+=t*i(),qs.m[1]+=t*i(),qs.m[2]+=t*i()),Vt(qs,qs.m,Math.PI/4),rt(Rs.l,_,3.2,2),wt(Rs.l,Rs.l,Li.$.ft),rt(Rs.m,_,1,10),wt(Rs.m,Rs.m,Li.$.ft),Vt(Rs,Rs.m,1)},br=()=>{var t;.001<sr&&(t=s(bt*(1-sr),1,bt),Qt.fillStyle=fe,Qt.beginPath(),Qt.arc(480,270,t,0,2*Math.PI),Qt.rect(bt,0,-960,gt),Qt.fill())};(async t=>{for(const e of Z)await e.o(t)})(t=>_i=t).then(()=>Oi=!0).catch(console.error)</script>