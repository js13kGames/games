<title>Flykt - js13kGames 2025</title><style>body{margin:0}canvas{margin:0;image-rendering:pixelated}</style><body><script>function A(A,t,e,s=0,o=0){const n=I[A];return n?{name:A,frameCount:e&&e>0?0|e:Math.max(1,n.srcW/32|0),fps:t,dx:s,dy:o}:null}function t(A){c.anim.load.then(()=>{A(new r(c.anim.image,I,32,32,f))})}function e(A,t,e,s,o=2,n="#fff"){const g=" !/0123456789:ACDEFGHIKLMNOPRSTUY".indexOf(t);if(0>g)return;const i=BigInt(parseInt("000000021bllok0ixw9a876cgs3225rf3wu7626cynetb7xha8nmkahtfjnu4am75s48xafb2xgn876ceo8e76cf0ha027wu8076cqm2976btkxaf2gwzzyfjv2bkvfjv2bkg76bvpke8nmknjlfcs3z4v8od5xkh85aef4v8t8nepd8s4nmlt76cgs32f2h63v4f2h672p7nj2numfcs3z448nmatke8nho2o4".slice(7*g,7*g+7),36));A.fillStyle=n;for(let t=0,n=34;7>t;t++)for(let g=0;5>g;g++,n--)i>>BigInt(n)&1n&&A.fillRect(e+g*o,s+t*o,o,o)}function s(A,t,s,o,n=2,g="#fff"){for(let i=0;t.length>i;i++)e(A,t[i].toUpperCase(),s+6*i*n,o,n,g)}function o(A,t,e,s,o){const n=s.colsLeft,g=s.colsRight??n,i=8*n+6*(n-1),C=8*g+6*(g-1),l=s.h,a=.5*i,h=.03*l;((A,t,e,s,o,n,g,i,C,l,a)=>{const h=o+s;b(A,15,[[t+o-l,e+g],[t+h,e],[t+h,e+n+a],[t+o-l,e+n+g]]),b(A,16,[[t,e],[t,e+n+a],[t+o+l,e+n+g],[t+o+l,e+g]])})(A,t,e,C,a,l,h,0,0,.5/o,.5/o);const B=.75/o,r=e+B+1/o,c=e+h+B+1/o,Q=e+l-1/o;s.columns&&((A,t,e,s,o,n,g,i,C,l,a,h)=>{const B=(t,s,o,n,g,i)=>{const l=i,a=h;for(let i=1;t>i;i++){const t=14*i-3;D(A,s,e,o,n,t/o,(t+.5)/o,l,a-l,g,C)}};B(s,t,n,1,17,l),B(o,t+i,g,-1,16,a)})(A,t,e,n,g,i,C,a,h,r,c,Q);const E=s.wallLeftColor??"#2a2a2f",I=s.wallRightColor??"#232327",f="#1b1b20",w="#34343b",d="#2a2a30",u=.08*l,y=l-2*u;if(null==s.C){const A=(43758.5453*Math.sin(12.9898*(.73*n+.41*g+.19*s.rows))%1+1)%1*997|0;s.I=A,s.C=A%5}const p=s.I,m=s.C,v=(t,e,s,o,n,g,i)=>{const C=Math.max(s+u,i),l=Math.min(s+u+y,Q)-C;if(0>=l)return;k(A,e,s,o,n,C,l,g,h);const a=1===m?12+p%8:0===m?4+p%3:4===m?2+p%2:2===m?3+p%4:0,B=1===m?l/(1.8*a):0===m?.12*l:4===m?.09*l:2===m?.13*l:0;for(let t=0;a>t;t++)k(A,e,s,o,n,1===m?C+(t+.5)*(l/a)-.5*B:C+(t+1)/(a+1)*l-.5*B,B,1===m?t%3?"#16161a":d:0===m?1&t?w:f:d,h);if(2===m){const t=Math.max(2,.22*B);D(A,e,s,o,n,.06,.94,C+.5*l-.5*t,t,w,h)}const r=3===m?x(t>>1||3,2,5):4===m?2+p%3:0,c=3===m?.05+2e-4*p:.04;for(let t=1;r>=t;t++){const g=t/(r+1);D(A,e,s,o,n,g-.5*c,g+.5*c,C,l,f,h)}if(3===m){const t=.06*l;k(A,e,s,o,n,C,t,"#0003",h),k(A,e,s,o,n,C+l-t,t,"#0003",h)}const E=Math.max(2,.04*l),I=.02*o;k(A,e,s,o,n,C-.5*E,E,"#0003",h),k(A,e,s,o,n,C+l-.5*E,E,"#0003",h),D(A,e,s,o,n,0,I/o,C,l,"#0004",h),D(A,e,s,o,n,1-I/o,1,C,l,"#0004",h)};v(n,t,e,i,1,E,r),v(g,t+a,e+h,C,-1,I,c);const M=a+C;if(b(A,19,[[t,e+B],[t+i,e-h],[t+M,e+B],[t+a,e+h+B]]),!s.hat)return;const R=s.hatOverhangPx??x(Math.round(.08*a),3,8),F=s.hatHeightPx??x(Math.round(.55*h),6,12);b(A,17,[[t-R,e-F],[t,e+B],[t+a,e+h+B],[t+a,e-F+h]]),b(A,16,[[t+a,e-F+h],[t+a,e+h+B],[t+M,e+B],[t+M+R,e-F]]),b(A,18,[[t-R,e-F+B],[t+i,e-F-h+B],[t+M+R,e-F+B],[t+a,e-F+h+B]])}function n(A,t,e,s=1){const o=[];for(let n=0;A>n;n++){const A=j(),n=P(.7)?void 0:A+(P(.5)?1:-1),g=t+Math.pow(L(),.65)*(e-t),i=U(g*s),C=Math.max(1,U(i/28)),l=P(.5),a=P(.6),h=P(.8),B=Y(-5,5),r=H[Y(0,H.length-1)],c=O(r.h+Y(-3,3),r.s+Y(-2,2),r.ll+Y(-2,2)),Q=O(r.h+Y(-3,3),r.s+Y(-2,2),r.lr+Y(-2,2));o.push({h:i,rows:C,colsLeft:A,colsRight:n,hat:l,columns:a,sills:h,groundOffset:B,wallLeftColor:c,wallRightColor:Q})}return o}function g(A){if(!N)return void requestAnimationFrame(g);X||(X=A);let t=(A-X)/1e3;t>.25&&(t=.25),X=A,W+=t;let e=0;for(;W>=V&&10>e++;)N.update(),W-=V;N.draw(A,W/V),requestAnimationFrame(g)}function i(A){const t="menu"===A;return{i:null,onClick:void 0,m:null,p:null,v:0,F:0,G:0,Y:36,H:new J,setCanvas(A){this.i=A},setAnimator(A){this.m=A,this.p=null},start(){this.H.start(),this.v=0,this.F=this.G=0;const A=this.i;A&&(A.imageSmoothingEnabled=0),t?addEventListener("click",()=>this.onClick?.(),{once:1}):addEventListener("click",()=>{dispatchEvent(new Event("scene:stop-music")),K(q)},{once:1})},update(){this.F=this.G,this.G+=this.Y*(1/40)},draw(A,e){const o=this.i,n=this.m;if(!o)return;this.v||(this.v=A);const g=(A-this.v)/1e3,i=e||0,C=Math.sin,l=globalThis,{width:a,height:h}=o.canvas;if(this.H.draw(o,g,this.F+(this.G-this.F)*i),n){this.p||(this.p={x:a-(0|n.fw)>>1,y:h-(0|n.fh)>>1});const A=0|this.p.x,t=this.p.y+6*C(1.7*g)|0,e=n.getMeta("dash")||n.getMeta("idle"),s=e?.frameCount||1,i=e?.fps||8;n.drawFrame(o,e?.name||"dash",(g*i|0)%s,A,t)}if(((A,t,e,n)=>{const i=(a-58)/2|0;for(let e=0;5>e;e++){const l=i+12*e,a=t+2*C(5*g+e)|0;s(o,A[e],l+1,a+1,2,"#000"),s(o,A[e],l,a,2,n)}})("FLYKT",.22*h|0,0,t?"#7aa2ff":"#a9b8ff"),!t){const A=l.T/1e3|0,t=A%60|0,e=["THANKS FOR PLAYING!","DEATHS "+(0|l.D),"TIME "+(A/60|0)+":"+(10>t?"0":"")+t];let n=.48*h|0;for(const A of e){const t=(a-(6*A.length-1))/2|0;s(o,A,t+1,n+1,1,"#000"),s(o,A,t,n,1,"#e5e7eb"),n+=18}}const B=t?"CLICK / TAP TO START!":"CLICK / TAP TO RETURN",r=t?2:1,c=t?.74*h|0:.88*h|0,Q=(a-(6*B.length*r-r))/2|0;o.globalAlpha=t?.6+.4*C(4*g):.5+.5*C(3.2*g),s(o,B,Q+1,c+1,r,"#000"),s(o,B,Q,c,r,"#cbd5e1"),o.globalAlpha=1}}}function C(A=1,t=.05,e=220,s=0,o=0,n=.1,g=0,i=1,C=0,l=0,a=0,h=0,B=0,r=0,c=0,Q=0,E=0,I=1,f=0,w=0,d=0){let u=Math,y=2*u.PI,p=44100,x=C*=500*y/p/p,m=e*=(1-t+2*t*u.random())*y/p,v=0,M=0,b=0,D=1,k=0,R=0,F=0,T=0>d?-1:1,G=y*T*d*2/p,S=u.cos(G),L=u.sin,U=L(G)/4,Y=1+U,P=-2*S/Y,O=(1-U)/Y,H=(1+T*S)/2/Y,j=-(T+S)/Y,Z=H,J=0,N=0,V=0,W=0;l*=500*y/p**3,c*=y/p,a*=y/p,h*=p*h,B=p*B|0;const X=[];for(T=(s=p*s+9)+(f*=p)+(o*=p)+(n*=p)+(E*=p)|0;T>b;X[b++]=F*A)++R%(100*Q|0)||(F=g?g>1?g>2?g>3?L(v**3):u.max(u.min(u.tan(v),1),-1):1-(2*v/y%2+2)%2:1-4*u.abs(u.round(v/y)-v/y):L(v),F=(B?1-w+w*L(y*b/B):1)*(0>F?-1:1)*u.abs(F)**i*(s>b?b/s:s+f>b?1-(b-s)/f*(1-I):s+f+o>b?I:T-E>b?(T-b-E)/n*I:0),F=E?F/2+(E>b?0:(T-E>b?1:(T-b)/E)*X[b-E|0]/2/A):F,d&&(F=W=Z*J+j*(J=N)+H*(N=F)-O*V-P*(V=W))),G=(e+=C+=l)*Math.cos(c*M++),v+=G+G*r*L(b**5),D&&++D>h&&(e+=a,m+=a,D=0),!B||++k%B||(e=m,C=x,D=D||1);return X}function l(...A){const t=C(...A),e=xA.createBuffer(1,t.length,pA),s=xA.createBufferSource();return e.getChannelData(0).set(t),s.buffer=e,s.connect(mA),s.start(),t}function a(A,t,e,s=125){let o,n,g,i,l,a,h,B,r,c,Q,E,I,f,w=0,d=[],u=[],y=[],p=0,x=0,m=1,v={},M=pA/s*60>>2;for(;m;p++)d=[m=B=E=0],e.map((s,b)=>{for(h=t[s][p]||[0,0,0],m=+m|+!!t[s][p],f=E+(t[s][0].length-2-+!B)*M,I=b==e.length-1,n=2,i=E;h.length+I>n;B=++n){for(l=h[n],r=(n==h.length+I-1&&I?1:0)||(c!=(h[0]||0)?1:0)|(l?1:0),g=0;M>g&&B;g++>M-99&&r?Q+=(1>Q?1:0)/99:0)a=(1-Q)*d[w++]/2||0,u[i]=(u[i]||0)-a*x+a,y[i]=(y[i++]||0)+a*x+a;l&&(Q=l%1,x=h[1]||0,(l|=0)&&(d=v[`${c=h[w=0]||0},${l}`]=v[`${c},${l}`]||(o=[...A[c]],o[2]*=2**((l-12)/12),l>0?C(...o):[])))}E=f});return[new Float32Array(u),new Float32Array(y)]}function h(A,t,e=1){const s=xA.createBufferSource(),o=xA.createBuffer(2,A.length,pA);return o.getChannelData(0).set(A),o.getChannelData(1).set(t),s.buffer=o,s.loop=e,s.connect(mA),s.start(),s}function B(A=0){YA=Math.max(0,Math.min(QA-1,YA+A)),EA(YA),OA.start(),VA=0,WA=0;const t=eA();PA&&jA&&t&&(jA.respawn(),jA.setLevelBounds(t.width,t.height,PA.canvas.height,UA),jA.setSpawn(64,24),jA.body.pos={x:64,y:24}),HA.reset?.()??HA.clear(),JA=NA=jA?jA.body.pos.x:0,dispatchEvent(new CustomEvent("scene:start-music",{detail:{level:YA}}))}class r{constructor(A,t,e,s,o){this.img=A,this.meta=t,this.fw=e,this.fh=s,this.anims=o}getMeta(A){return this.anims.find(t=>t.name===A)}clampFrame(A,t){const e=t.offX/this.fw|0,s=(t.offX+t.w-1)/this.fw|0;return e>A?e:A>s?s:0|A}drawFrame(A,t,e,s,o){const n=this.meta[t];if(!n)return;const g=(e=this.clampFrame(e,n))*this.fw,i=g+this.fw,C=this.fh,l=n.offX+n.w,a=n.offY,h=n.offY+n.h,B=Math.max(g,n.offX),r=Math.min(i,l),c=Math.max(0,a),Q=r-B|0,E=Math.min(C,h)-c|0;Q>0&&E>0&&A.drawImage(this.img,n.x+(B-n.offX)|0,n.y+(c-n.offY)|0,Q,E,s+(B-g)|0,o+(c-0)|0,Q,E)}}const c={anim:(()=>{const A=new Image;let t=0;const e=new Promise(e=>{A.onload=()=>{t=1,e()}});return A.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+wAAAAWBAMAAACoFgtZAAAAJ1BMVEUAAABuVld2QooGAykjQUIXTG7s7OwcXIOokZEjFhgAWf/om5v/mwBGQYo5AAAAAXRSTlMAQObYZgAAA2NJREFUaN7t2c1u00AUBeAZ7A4SYuErWtHSTZUniGQxbLMIe1DxPlIk7xGqsoVdWXbHGyB1xxvwaIynP/f6xJ3euslEFR3RoO94DG3PzDhVTRhEVBkeOtvDH4ffOdM63CjCPLbhr9QkOUFex2kL43qemmIDfmF2M6gbwhZMgya6OKo4VNr+MccizGNbGTJyUIgSDqCBf8u1ppUualNvxhMOwTjw+sj7NTXbIVuo9T7TTe10LNI8tmRIhjrH2iuofQG1TTfhF5MTTtFYI14ffz+F85dDnYno8JesWWeCB0YW47pVGpeQa1uovYYa0V5hqCmju43Ioc74DSawHS6E4ImfxSNrx6+ghdprqHndPm3vffRkMhld4/j740bkUOeR+xCO/jwmOqdzkeq8ndrRWFsGn1z7q/jy1LZEByLTOdZAHOaxpSO6EKHO8aTYYu0u2uWqGa+/o4Om4Uzrl41MdcYnfi5DrUrjEmq7ATXXSfu0u5Fxt2Ptb1crzrS2q9VZxanOeAbkcWXpp3zgoy3YROMScrDbC9jdA/Z9+7Zdm7+z2s3ph16tpgAPX6fV6pusVeW450Wax9VZ03yWrepsiaij7J111Vvavu+lrxdr83d0yJPZO5WLsjJNz+aO61TX7/9yrDTBGZDFNhxPslaliZfQRp7tPtjfyl3Pd4+vcZRp/2MjMgumO65fNs2XimOd454XiyGPuxqnIlWZl+j42tultA/XvfCOD/lyPudIbZqLWO3LsOcrDvP4sqjrTyJVmV79DkvmNe/O+Gx3ty7is7no2Qt3s5dxpbBrLx3vd8G7qR36UdpCrDOFPc9ZJtNe08w4U5rehCVj4Y28gzfiRdLtUtqHZOD+HR3yZm5mHKldQWxVLmExPNb7fVPfRGV0eBWfi9J2r7+EHL+l4+2etu/ZBXPt7nq+29EhD6VqXUGMtgO2WNNDbdM126rE+aNr5/9bbncDz+a0fd/8Tl7O303tY4cFV/fYXtU0M6XIwMaCCV32bCuw6dvceFaKWrXmJbShH+A83P8Uax83yvhHGmpMG+9XetyRNoN40X0IT7uPpB16ff7/UfsTGmV8Ybv4wi7iS9IuZRftVL8xmzzQJ+jn2jMOpzHWkra+ZjSz8/OAka9259xgDdv2c+3bHU5p3ry5/A89ic/oxGWSYgAAAABJRU5ErkJggg==",{image:A,get ready(){return t},load:e}})()},Q={idle:"a",jump:"b",fall:"c",dash:"d",death:"e",portal:"f"},E=(()=>{const A={},t={a:{f:{x:217,y:0,w:237,h:18},sss:{x:8,y:10,w:237,h:18},src:{w:256,h:32}},b:{f:{x:110,y:0,w:107,h:17},sss:{x:9,y:11,w:107,h:17},src:{w:128,h:32}},c:{f:{x:454,y:0,w:107,h:18},sss:{x:10,y:9,w:107,h:18},src:{w:128,h:32}},d:{f:{x:0,y:0,w:110,h:16},sss:{x:8,y:12,w:110,h:16},src:{w:128,h:32}},e:{f:{x:561,y:0,w:210,h:22},sss:{x:8,y:8,w:210,h:22},src:{w:224,h:32}},f:{f:{x:771,y:0,w:233,h:22},sss:{x:9,y:6,w:233,h:22},src:{w:256,h:32}}}||{};for(const e in t){const s=t[e],o=s?.f??s?.frame,n=s?.sss??s?.spriteSourceSize,g=s?.src??s?.sourceSize;if(!o)continue;const i=n??{x:0,y:0,w:o.w,h:o.h},C=g??{w:o.w,h:o.h};A[e]={x:0|o.x,y:0|o.y,w:0|o.w,h:0|o.h,offX:0|i.x,offY:0|i.y,srcW:0|C.w||0|o.w,srcH:0|C.h||0|o.h}}return A})(),I={};for(const A in Q){const t=E[Q[A]];t&&(I[A]=t)}const f=[A("idle",8),A("jump",10),A("fall",10),A("dash",12),A("death",6,7),A("portal",8)].filter(Boolean),w={},d={l:[65,37],r:[68,39],u:[87,38],d:[83,40],j:[32],rs:[82]},u="#fff,#d6e8f5,#a7c7de,#7da8c5,#090016,#250040,#1a1d2f,#0b0c12,#0b0e19,#0a0b13,#121624,#0e111c,#eef1fb,#d9dcec,#b7bed2,#222,#333,#444,#555,#666,#0003,#0004".split(","),{sin:y,cos:p}=Math,x=(A,t,e)=>t>A?t:A>e?e:A,m=(A,t=.001)=>A>t?A:t,v=A=>{const t=43758.5453*y(12.9898*A);return t-(0|t)},M=A=>u[A],b=(A,t,e)=>{A.fillStyle=M(t),A.beginPath(),A.moveTo(...e[0]);for(let t=1;e.length>t;t++)A.lineTo(...e[t]);A.closePath(),A.fill()},D=(A,t,e,s,o,n,g,i,C,l,a)=>{const h=n*s,B=g*s,r=t+(o>0?.5*h:h),c=t+(o>0?.5*B:B),Q=h/s*a*o,E=B/s*a*o;A.fillStyle="number"==typeof l?M(l):l,A.beginPath(),A.moveTo(r,i+Q),A.lineTo(c,i+E),A.lineTo(c,i+E+C),A.lineTo(r,i+Q+C),A.closePath(),A.fill()},k=(A,t,e,s,o,n,g,i,C)=>D(A,t,0,s,o,0,1,n,g,i,C),R=[],F=[],T=[],G=A=>R.push(A);let S=0;const L=Math.random,U=Math.floor,Y=(A,t)=>U(A+L()*(t-A+1)),P=A=>L()<A,O=(A,t,e)=>`hsl(${A},${t}%,${e}%)`,H=[{h:0,s:0,ll:20,lr:13},{h:220,s:8,ll:24,lr:16},{h:30,s:8,ll:22,lr:14},{h:250,s:10,ll:23,lr:15}],j=()=>{const A=L();return.45>A?3:.8>A?4:.95>A?5:6},Z=[{min:190,max:240,sc:1.2,sp:.48,gap:130,drop:20},{min:80,max:150,sc:1,sp:.5,gap:120,drop:10}].map(A=>({...A,M:new Map}));class J{constructor(){this.O=0}start(){S||(S=1,G((A,t,e,s,o)=>{const n=.35*e;A.fillStyle=M(0),A.globalAlpha=.65;for(let e=60;e--;){const s=1+73*e%10/20;A.fillRect(((89*e+.15*o)%t+t)%t,n*(97*e%100/100)**2,s,s)}A.globalAlpha=1}),G((A,t,e,s,o)=>{const n=.18*t-.03*o,g=.22*e,i=m(.12*e);let C=A.createRadialGradient(n-.25*i,g-.25*i,m(.2*i),n,g,i);C.addColorStop(0,M(12)),C.addColorStop(.7,M(13)),C.addColorStop(1,M(14)),A.fillStyle=C,A.beginPath(),A.arc(n,g,i,0,7),A.fill();for(let t=12;t--;){const e=6.283*v(t),s=i*(.18+.68*v(t+1)),o=n+p(e)*s,C=g+y(e)*s;if((o-n)**2+(C-g)**2>i*i*.83)continue;const l=m(i*(.02+.05*v(t+2))),a=.35+.65*v(t+3);A.fillStyle="rgba(40,45,60,.26)",A.beginPath(),A.arc(o,C,l,0,7),A.fill(),A.strokeStyle="rgba(230,235,255,.10)",A.lineWidth=m(.34*l),A.beginPath(),A.arc(o,C,m(l*a),0,7),A.stroke()}})),Z.forEach(A=>A.M.clear())}draw(A,t,e){const{width:s,height:o}=A.canvas;if(this.O!==o){const t=A.createLinearGradient(0,0,0,o);t.addColorStop(0,M(4)),t.addColorStop(.4,M(5)),t.addColorStop(.8,M(6)),t.addColorStop(1,M(7)),this.N=t,this.O=o}A.fillStyle=this.N,A.fillRect(0,0,s,o),R.forEach(n=>n(A,s,o,t,e)),this.P(A,s,o,e,Z[0]),F.forEach(n=>n(A,s,o,t,e)),this.P(A,s,o,e,Z[1]),T.forEach(n=>n(A,s,o,t,e))}P(A,t,e,s,g){const{min:i,max:C,sc:l,sp:a,gap:h,drop:B,M:r}=g,c=1/l,Q=s*a*.6,E=Q/h|0,I=Q-E*h,f=3+(t*c/h|0);A.save(),A.scale(l,l),A.translate(-I,0);const w=(e+B)*c;for(let t=-f;f>t;t++){const e=E+t;let s=r.get(e);s||(s=n(1,i,C,c)[0],r.set(e,s)),o(A,t*h,w-s.h,s,l)}A.restore()}}let N=null,V=.02,W=0,X=0;const K=A=>{N?.stop?.(),N=A,N.start?.()},q=i("menu"),z=i("go");let $=null,_=null;const AA=(A,t=11)=>{const e=document.createElement("canvas"),s=e.getContext("2d");return e.width=e.height=t,s.font=t+"px serif",s.textAlign="center",s.textBaseline="middle",s.fillStyle=A,s.fillText("⬛",t/2,t/2),s.createPattern(e,"repeat")};let tA=null;const eA=()=>tA,{cos:sA,sin:oA,abs:nA,PI:gA}=Math,iA=["idle","dash","jump","fall","death"],CA=(A,t,e)=>t>A?t:A>e?e:A,lA=(A,t)=>{A.m!==t&&(A.m=t,A.setAnimation?.(iA[t]))},aA=(A,t,e)=>{const s=A.body;if(A.J=t,A.Z=0,0===t)return s.gravity=void 0,void lA(A,nA(s.vel.x)>.05?1:0);if(s.grounded=0,s.gravity=void 0,e){const t=A._,e=.85*A.V;s.vel.x=sA(t)*e,s.vel.y=-oA(t)*e,lA(A,1),A.V=A.K}else lA(A,s.vel.y>0?3:2)},hA=A=>A.hit||{x:0,y:0,w:A.width,h:A.height},BA=A=>{const t=hA(A);return{h:t,cx:A.pos.x+t.x+.5*t.w,cy:A.pos.y+t.y+.5*t.h,hw:.5*t.w,hh:.5*t.h}},rA=new Set,cA=[[28,35,"ABwCAgMKAgIADgIBAAwCAQAOAgEADAIBAAECDgAMAgMACwICABoCAgAaAgIAGgICABoCAgAYAgQAAgIEAQMEBAALAgIAAQIBAAICCwALAgIAAQIBAAICCAAOAgIAAQIBAAICAwATAgIAAQIBAAICAgAQAgYAAQIBAAICAQARAQECAQAFAgEAFAEBAgEABQIBABQBAQIBAAUCAQAKBAICAQAHAgIABQIBAAoCBgQEAgIABQIBAAoCAwECAgcAEAIDAQECCAAQAggACQIBAQECBAAFAggACQIGAAUCAwEBAgQACQIBAQMCAgAFAgIBAgIEAAkCBgAFAgYBAQIBAAkCAwEBAgIABQIGAQECAQAJAgMBAQICAAUCAQECAgUACQIGAAUCCAAJAgYABQIIAAkCBgAFAggACQIGAAUCCAAJAgYABQIIAAkCBgAFAggACQ=="],[40,31,"AP8AQQINAwcCAwARAgwACgIBABECAgAGAgQACgIBABECAgAHAgMACgIBABECAgAHAgEBAgAKAgEAEQICAAcCAQECAAoCAQARAgIABwIDAAkEAQIBABECAgATAgIAEQICABMCAgARAgIADAIBAQICAQADAgIAEQICAAwCBAADAgIAEQICABMCAgARAgsACwIBABECAQEDAgcABwIBAQICAgARAgsABwIFABECAwEBAgcABwIFABECAwEBAgcABwIDAAECAQARAgsEBwIFABECFwARAhABAQIGABECFwARAgUBBgICAQUCBAASAhYAEg=="],[28,32,"AhIACgIEAA0CCwARAQECAQAHAgIAEQEBAgEABwICABECAgAHAgIAGgEBAgEADAQCAAQEAgAGAQECAQAMAgIABAICAAYBAQICAQICBAQFAgEABQICAAYCAwECAgEBAgIHAAUBAQIBAAYCAQABAgEBBgIBAAoBAQIBAAYCAQABAggACgICAAYCAQALAgEABAQDAgIABgIBAAsCCgAGAgEACwIBAQMCAgACAgIABgIBAAsCAQECAgIAAwICAAYCAQALAgQABAICAAYCAQATAgIABgIBABMCAgAGAgEAFAIBAAYCAQAUAgEABgIBAAECCAECAgUABAIBAAYCAQABAgEBAQIDAQECBQEBAgMABAIBAwYCAQABAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAAQCAQMGAgEAAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQAEAgEDBgIBAAECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgMBAQICAwYCAQABAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgkAAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIJAAECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECCQABAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgEBAQIBAQECAQEBAgcBAQIBAAECAQEZAgEAAQIbAAE="],[26,27,"AAcCGwARAgIAGAECABgBAgAKBAEADQICAAoCAQANAgIABwECAgIADQICAAoCAQAMBAECAgAKAgEADAIDAAoCAQALBAECAwQFAAQEAQIBAAoEAQIJAAQCAgAKAgIAAQICAAoCAQAKAgEAAgICAAoCAQAKAgEAAgIJAQICAgAKAgEAAgILAAwCAQACAgIBBAIFAA8CCgEBAgQACwIEAQICBwANAgEBAQIIAQECAgQBAAwCAQEBAggBAQIDBAEACwIHAQECAQECAgQEAQAHBAEAAgINAwECAgQHAgEAAgINAwICCQMCAg0DDQINAw0CGw=="],[35,39,"AAUCFwAMAgIAEwICAAwCAgATAgIADAIBAQEAEwICAAwCAQEBABMCAgAMAgEBAQAFAwECAQAMAgIADAIBAQEABQMBAgEADAICAAwCAQEBAAUDAQIBAAwCAgAHAgcABQMBAgEADAICAAcCAQALAwECAQAMAgIABwIBAAsDAQIBAAwCAgAHAgEACwMBAgEADAICAAcCAQALAwECAQQBAAsCAgAHAgEACwMBAgIAAgQDAQUCAwAHAgEDDAICAAICCwAHAg4ABAICAA8CAwADAgcABQICAA8CAwAPAgIADwICAQEADwICAA8CAgEBAAcEAQAHAgIADwICAQEABwIBBAIABQICAA8CAwADBAECBgAFAgIAEAICAAMCAgAEAgEEAgADAgIAEAICAAkCAwECAgMAGwIIABsCBwAcAgMBAQICAB0CAwEBAgIAHQIGABECAgECAg4AEQILAQMCBAARAQECAwEEAgkAEgEBAg8AEwIGAQECAQEBAgcAEwILAQICAwATAgEBBgIJABMCEAATAhAAEwIQABM="],[38,34,"ACYCKgEBAiIBBAIKAQoCFQELAiEBAwICAAUCCgECAhABAQICAAgCFgAEAgMACwITABQCEgAVAgwAAQIDABYCAgEGAgQACwICAA0CCwEBAAwCAQQBAAwCCwEBAAwCAgQCAAoCAQEGAgQBAQAMAgQABQIRAAwCAwAJAg4ABQICAAQCAwEBAAgEAQIOAAYCCAEBAAgCDwAIAgYBAQAFBAMCAwEHAgIBAQICAAgCBwAFAgcBBQIDAQECAgAHAggABgMFAhsABwMEAgQBAwIUBAEABwMDAgUBAgIDAQECCwEFAgEACAMCAhYBAQIFAAgDAgIFAQICEgEBAgIAAgQCAAQDAgIDAQMCCwEEAgcAAgIBAwcCAQEDAhgAAgIkAAICJAACAiQAAgIkAAICJAACAiQAAgIR"],[40,50,"ABECBAEEAg8AEQICABQCAQARAgIAFAIBABECAgAUAgEAEQICABQCAQARAgIAFAIBABECAgAUAgEAEQICABQCAQARAgIDDgQCAAIEAgIBABECEgACAgMAEQIEAAMCCgAEAgIAEQICAQIABQIHAAUCAgARAgIBAgARAgIAEQICAQIAEQICAAsCCgARAgIACwICAQUCAwARAgIACwIJAAUEBAIDAAYCAgALAgQACgIIAAUCAgALAgEBAQICAA8CBQECAgMACwIBAQECAgAQAgkACwIBAQECAgAQAgkACwIBAQECAgAQAgQBAQIEAAsCAQEBAgIAEAIEAQECBAALAgEBAQICABACFQEBAgIADwILAQMCAwEGAgIAAgQDAgIBAgIHAQMCBwEBAgwAAwIIAQMCDAECAgEAAwIHAAUCAgEBABMBAQICAA8CAwATAQECAQEBAA8CAwATAQECAQEBAA8CAwATAQECAQEBAA8CAwATAQECAgADBAECBQAGAgMAEwIDAAMCBwAFAgMAEwIDAAgCBAECAgQAHwIJAB8CAwAlAgMAJQIDACUCAwAZAgIBAgILABkCCwEDAgEAGQEBAgMBBAIHABkBAQIOABkCBgEBAgEBAQIGABkCCwECAgIAGQIBAQYCCAAZAg8AGQIPABkCDwAZ"],[32,30,"AAECEAADAgYABwIBAA4CAQACAgIABAIBAAcCAQAOAgEAAQICAAUCBgACAgEADgIDAAYCAQADAgIAAgIBAA4BAQIBAAcCAQADAgIAAgIBAA4BAQIBAAsBAQIBAAICAQAOAgIACwEBAgEAAgIBAA4CAgALAgMAAQIBAAoEBAICAAcEAQAFAgMAAgQBAwcCBgQCAgMAAgIBAAUCAgADAgEDBwIBAAQCBgACAgEABQICAAMCAQMHAgEABwIDAAICAQAFAgIAAwIJAAgCAgACAgEABQICAAMCAQARAgEAAgICAAQCAwACAgEAGgIDAB0CAwAdAgMAHQIDABAEAQAJAgIEAQIDABACAQQBAAgCBQAQBAECAgQBAAcCAQADAgEADwQBAgQEAQAGAgEAAwIBAA4EAQICAQICAgAGAgEAAwICAQICDQEBAgYBAQIBAAICAQADAgcBAQIBAQICBQEBAgkEAgIBAAMCAQEBAgUBAQIDAQECAgECAgMABgIEAAMCAQEBAggBAgIHAA0CAQEBAggBAgICAQQCAQANAgEBAQIFAQECAwEBAgcADQIBAQQCAgEBAgEBAgIDAQMCAgAN"],[66,27,"ABgCCAA5AgIABgICADYCAwAIAgUAMQICAA0CAQEBADECAQEBAA0CAQEBADACAgEBAA0CAgArAggALwIGAAQCAwAFAgEALAIEAAQCBwAZBAEAGQICAAkCAwAEBAEACQQBAAsCAQQBABgCAQALAgEABQIBBAEACAIBBAEACgICBAEAFwIBAAsCAQAEBAECAgQBAAYEAQICBAEACQIDBAEAFgIBAA8EAQIEBAEABAQBAgQEAwIKBAEAFQIBAA4EAQIGAAMEAQITBAEAFAINAQICHwQBABMCLwQBABICMAQBABEBLwICBAYDCwIBAQECKwEBAgkDCwIBAQECKwEBAgIDEgIBAQECKwEBAgIDEgIBAQECKwEBAhUBAQIrAQECFAD/AAk="]],QA=cA.length,EA=A=>(A=>{const[t,e,s]=cA[0|A],o=atob(s),n=o.length;let g=0;for(let A=1;n>A;A+=2)g+=o.charCodeAt(A);const i=new Uint32Array(g);let C=0;const l={};for(let A=0;n>A;A+=2){let t=o.charCodeAt(A+1),e=o.charCodeAt(A);for(;t--;)i[C++]=e,e&&e-3&&e-4&&(l[e]=1)}(A=>{tA=A})({width:t,height:e,tiles:i}),(A=>{rA.clear();for(const t of A)rA.add(t)})(Object.keys(l).map(Number))})(A),{max:IA,min:fA,pow:wA,round:dA}=Math,uA={R:[1,0,0,1],L:[-1,0,0,1],U:[0,-1,1,0],D:[0,1,1,0]},yA=(A,t,e)=>{const[s,o,n,g]=uA[e];return{n:A*s+t*o,t:A*n+t*g}};let pA=44100,xA=new AudioContext;const mA=xA.createGain();mA.gain.value=.2,mA.connect(xA.destination);const vA=[,.02,1200,.01,.06,.26,4,1.8,-11.5,9.2,220,.03,.08,,.5,,.02,.65,.02,.28],MA=[,.03,740,,,.05,,1.2,,,,,,.25,,,,.9,.02],{min:bA,sign:DA,hypot:kA,PI:RA}=Math,FA=A=>"R"===A?RA:"L"===A?0:"U"===A?RA/2:-RA/2,TA=[[[,0,223,.03,.01,.05,2,,.1,,,.03,,,,,,,,.1]],[[[,-1,1.02,.05,.08,.11,2.02,.05,.08,.11,3.02,.05,.08,.11,4.02,.05,.08,.11,4.09,4,.23,4,.23,,4,.23,4,,,.23,,,,,],[,1,,8.02,.05,.08,.11,9.02,.05,.08,.11,10.02,.05,.08,.11,11.02,.05,.08,17.09,17,.23,17,.23,,17,.23,17,,,.23,,,,,],[,-1,,,13.02,.05,.08,.11,14.02,.05,.08,.11,15.02,.05,.08,.11,16.02,.05,12.09,12,.23,12,.23,,12,.23,12,,,.23,,,,,],[,1,,,17.02,.05,.08,.11,18.02,.05,.08,.11,19.02,.05,.08,.11,20.02,22.09,22,.23,22,.23,,22,.23,21,,,.23,,,,,]]],[0],135];let GA=null;const SA=()=>{try{GA||(GA=a(...TA));const[A,t]=GA;return h(A,t,0)}catch{}},LA=[.2,,170,.29,.01,.24,3,2.4,3,,50,-.01,,,.6,,,.54,,.16,476],UA=16;let YA=0,PA=null,OA=new J,HA=new class{constructor(){this.Q=[],this.pl=null,this.cool=0,this.sc=document.createElement("canvas"),this.sx=this.sc.getContext("2d"),this.anim=null,this.n=1,this.fps=10,this.fw=32,this.fh=32,this.sc.width=32,this.sc.height=32}reset(){this.A=this.B=void 0,this.Q.length=this.cool=0,this.last=void 0}clear(){this.reset()}setPlayer(A){this.pl=A}setAnimator(A){this.anim=A,this.fw=A?.fw??32,this.fh=A?.fh??32;const t=A?.getMeta?.("portal");this.n=0|t?.frameCount||1,this.fps=0|t?.fps||10}attachInput(A,t){A.oncontextmenu=A=>A.preventDefault(),this.h=e=>{const s=eA();if(!s)return;const{wx:o,wy:n}=((A,t,e,s)=>{const o=e.getBoundingClientRect(),n=e.width,g=e.height;return{wx:(A-o.left)*n/(o.width||1)+(s.x-.5*n),wy:(t-o.top)*g/(o.height||1)+(s.y-.5*g)}})(e.clientX,e.clientY,A,t),g=this.pl?.body,i=g?BA(g):0,C=i?i.cx:o,l=i?i.cy:n;this.spawn(2===e.button?"B":"A",C,l,o-C,n-l,s,A.height)},A.addEventListener("mousedown",this.h)}detachInput(A){this.h&&(A.removeEventListener("mousedown",this.h),this.h=void 0),A.oncontextmenu=null}cast(A,t,e,s,o,n){let g=kA(e,s)||1;s/=g;const i=n-16*o.height,C=(A,t)=>A>=0&&t>=0&&o.width>A&&o.height>t,l=(A,t)=>C(A,t)?0|o.tiles[t*o.width+A]:0,a=(A,t)=>l(A,t)>0;let h=A/16|0,B=(t-i)/16|0,r=DA(e/=g),c=DA(s),Q=r?(16*(r>0?h+1:h)-A)/e:1e30,E=c?(i+16*(c>0?B+1:B)-t)/s:1e30,I=r?16/Math.abs(e):1e30,f=c?16/Math.abs(s):1e30;for(let o=0;2e3>=o;)if(E>Q){if(o=Q,h+=r,Q+=I,!C(h,B))break;if(a(h,B)){const n=l(h,B);return{hx:A+e*o,hy:t+s*o,ax:"x",sX:r,sY:c,ban:2===n||3===n||4===n}}}else{if(o=E,B+=c,E+=f,!C(h,B))break;if(a(h,B)){const n=l(h,B);return{hx:A+e*o,hy:t+s*o,ax:"y",sX:r,sY:c,ban:2===n||3===n||4===n}}}return null}spawn(A,t,e,s,o,n,g){const i=this.cast(t,e,s,o,n,g);if(!i)return;if(!i.ban)try{l?.(...MA)}catch{}const C=kA(s,o)||1,a=kA(i.hx-t,i.hy-e),h="x"===i.ax?i.sX>0?"L":"R":i.sY>0?"U":"D";this.Q.push({k:A,x:t,y:e,dx:s/C,dy:o/C,hx:i.hx,hy:i.hy,a:FA(h),o:h,t:0,th:bA(a,2e3)/640,ban:i.ban})}inP(A,t,e,s,o){const n=yA(t-A.x,e-A.y,A.o),g=15.36+("R"===A.o||"L"===A.o?.35*s:0),i=14.72+("U"===A.o||"D"===A.o?.35*o:0);return 1>=n.n*n.n/(g*g)+n.t*n.t/(i*i)}tp(){const A=this.pl,t=this.A,e=this.B;if(!(A&&t&&e))return;if(this.cool>0)return void this.cool--;const{cx:s,cy:o,hw:n,hh:g}=BA(A.body);if(this.last&&this.inP("A"===this.last?t:e,s,o,n,g))return;const i=this.inP(t,s,o,n,g)?t:this.inP(e,s,o,n,g)?e:0;if(!i)return void(this.last=void 0);const C=i===t?e:t,a=A.body,h=yA(a.vel.x,a.vel.y,i.o),B=((A,t,e)=>{const[s,o,n,g]=uA[e];return{vx:A*s+t*n,vy:A*o+t*g}})(-h.n,h.t,C.o),r=((A,t,e,s=2)=>((A,t)=>{const[e,s]=uA[A];return{dx:e*t,dy:s*t}})(A,("R"===A||"L"===A?t:e)+s))(C.o,n,g,2),c=C.y+r.dy;a.pos.x+=C.x+r.dx-s,a.pos.y+=c-o,a.vel.x=B.vx,a.vel.y=B.vy,a.grounded=0;try{l?.(...vA)}catch{}this.cool=8,this.last=C===t?"A":"B"}tick(){for(let A=this.Q.length;A--;){const t=this.Q[A];t.t+=1/60,t.th>t.t||(t.ban||(this[t.k]={k:t.k,x:t.hx,y:t.hy,a:t.a,o:t.o}),this.Q.splice(A,1))}this.tp()}draw(A,t){for(const t of this.Q){const e=640*bA(t.t,t.th),s=t.x+t.dx*e,o=t.y+t.dy*e,n=A.globalAlpha;A.globalAlpha=.9,A.strokeStyle="A"===t.k?"#28f":"#f80",A.beginPath(),A.moveTo(t.x,t.y),A.lineTo(s,o),A.stroke(),A.globalAlpha=1,A.fillStyle=t.ban?"#f44":"#fff",A.beginPath(),A.arc(s,o,2.5,0,2*RA),A.fill(),t.t>.9*t.th&&(A.globalAlpha=.6,A.fillStyle=t.ban?"#f66":"A"===t.k?"#28f":"#f80",A.beginPath(),A.arc(t.hx,t.hy,4.5,0,2*RA),A.fill(),A.globalAlpha=n)}const e=this.anim;if(!e)return;const s=(.001*t*this.fps|0)%this.n,o=this.sx,n=this.sc;o.setTransform(32/this.fw,0,0,32/this.fh,0,0);const g=t=>{t&&(o.clearRect(0,0,32,32),e.drawFrame(o,"portal",s,0,0),o.globalCompositeOperation="source-atop",o.fillStyle="A"===t.k?"#28f":"#f80",o.fillRect(0,0,32,32),o.globalCompositeOperation="source-over",A.save(),A.translate(t.x,t.y),A.rotate(t.a),A.drawImage(n,0,0,32,32,-16,-16,32,32),A.restore())};g(this.A),g(this.B)}},jA=null,ZA={x:0,y:0},JA=0,NA=0,VA=0,WA=0;const XA=globalThis;let KA=0;const qA=(A,t,e,s)=>{const o=s>>1;A.fillStyle="#fff",A.fillRect(t,e,o,o),A.fillStyle="#000",A.fillRect(t+o,e,o,o),A.fillRect(t,e+o,o,o),A.fillStyle="#fff",A.fillRect(t+o,e+o,o,o)},zA={setCanvas(A){PA=A},start(){if(!PA)return;const A=PA.canvas;ZA.x=.5*A.width,ZA.y=.5*A.height,OA.start(),EA(0),t(A=>{jA=((A,t={})=>{const e={pos:{x:32,y:32},vel:{x:0,y:0},width:32,height:32,hit:{x:10,y:10,w:12,h:18},grounded:0},s=hA(e),o={top:0,bottom:1e9,right:1e9,on:0},n={body:e,J:0,m:0,S:1,W:0,Z:0,_:.6*Math.PI,V:3,K:1.8,X:6.5,q:.11,$:.0349,AA:0,tA:0,sA:55,gA:{x:64,y:24},v:performance.now(),CA:0,setAnimation(){n.v=performance.now()}},g=()=>{e.pos.x=n.gA.x,e.pos.y=n.gA.y,e.vel.x=e.vel.y=0,e.gravity=void 0,e.grounded=0,n.Z=0,n.AA=0,n.CA=0,lA(n,0),n.J=0,t.onRespawn?.()},i=A=>{n.AA||(n.AA=1,n.tA=0|n.sA,e.pos.x=n.gA.x,e.pos.y=n.gA.y,lA(n,4),e.vel.x=e.vel.y=0,e.gravity=0,e.grounded=0,t.onDeath?.(A))};return{body:e,update(A,t){const C=!!A.left,l=!!A.right,a=!!A.up,h=!!A.down,B=!!A.jump;if(n.CA>0)return n.CA--,void(n.W=B);if(n.AA)return n.tA>0?n.tA--:g(),void(n.W=B);if(((A,t)=>{const e=A.body;0===A.J&&(t.jump&&(((A,t)=>{const e=A.body;A.Z=1,lA(A,0),e.vel.x=e.vel.y=0;const s=A.$,o=A.q;A._=CA(A._+(t.left?+s:0)-(t.right?+s:0),.05,gA-.05);let n=o;t.down&&(n-=2*o),A.V=CA(A.V+n,A.K,A.X)})(A,t),1)||!t.jump&&A.W&&A.Z&&(aA(A,1,1),1)||lA(A,nA(e.vel.x)>.05?1:0))})(n,{left:C,right:l,up:a,down:h,jump:B}),((A,t,e,s=0)=>{const o=eA(),n=A.acc,g=A.gravity??.14;n&&(A.vel.x+=n.x,A.vel.y+=n.y),A.vel.y+=g,A.vel.x*=1-(A.grounded?.08:.002);let i=A.vel.x;-5>i?i=-5:i>5&&(i=5),A.vel.x=i,i=A.vel.y,-8>i?i=-8:i>8&&(i=8),A.vel.y=i;const C=!!o,l=hA(A),a=l.x,h=l.y,B=l.w,r=l.h;let c=()=>0;if(C){const e=o.tiles,n=0|o.width,g=0|o.height,i=s?0:t.canvas.height-16*g;c=()=>{let t=(A.pos.x+a|0)/16|0,s=(A.pos.x+a+B-1|0)/16|0,o=((A.pos.y+h|0)-i)/16|0,C=((A.pos.y+h+r-1|0)-i)/16|0;0>t&&(t=0),0>o&&(o=0),n>s||(s=n-1),g>C||(C=g-1);for(let A=o;C>=A;A++){const o=A*n;for(let A=t;s>=A;A++)if(rA.has(e[o+A]))return 1}return 0}}const Q=A.vel.x;Q&&(A.pos.x+=Q,c()&&(A.pos.x-=Q,A.vel.x=0,A.grounded=0));const E=A.vel.y;if(E)if(A.pos.y+=E,c())if(A.pos.y-=E,E>0)A.vel.y=0,A.grounded=1;else{const t=-E*(A.bounce??.25);A.vel.y=.2>Math.abs(t)?0:t,A.grounded=0}else A.grounded=0})(e,t),(A=>{const t=A.body;if(1===A.J)return t.vel.y>0&&3!==A.m&&lA(A,3),void(t.grounded&&aA(A,0));t.grounded?0!==A.m&&.05>=nA(t.vel.x)&&lA(A,0):aA(A,1,0)})(n),o.on){const A=e.pos.x+s.x|0,t=e.pos.y+s.y|0;(0>A+(0|s.w)||A>o.right||t+(0|s.h)>o.bottom||o.top>t)&&i("out_of_bounds")}n.S=((A,t,e,s,o,n,g)=>e&&t?0>sA(s)?-1:1:n!==g&&t?g?1:-1:o*o>.0025?0>o?-1:1:A)(0>n.S?-1:1,e.grounded,n.Z,n._,e.vel.x,C,l),n.W=B},draw(t,s){const o=iA[n.m],g=A.getMeta(o),i=g?.fps??6,C=g?.frameCount??1,l=(Math.max(0,.001*(s-n.v))*i|0)%C,a=0>n.S,h=a?-1*e.width-e.pos.x:e.pos.x;if(t.save(),a&&t.scale(-1,1),A.drawFrame(t,o,l,h,e.pos.y),t.restore(),!n.AA&&n.Z&&e.grounded){const{cx:A,cy:s}=BA(e),o=sA(n._)*n.V,g=-oA(n._)*n.V;t.save(),t.fillStyle="#fff";for(let e=15;e--;)t.fillRect(0|A+o*e,0|s+g*e+.07*e*e,1,1);t.restore()}},onTeleported(A){n.AA||(e.grounded=0,e.gravity=void 0,n.Z=0,n.J=1)},setSpawn(A,t){n.gA.x=0|A,n.gA.y=0|t},setLevelBounds(A,t,e,s=16){const n=e-t*s;o.top=0|n,o.bottom=n+t*s|0,o.right=A*s|0,o.on=1},respawn:g,celebrateWin(A=55){n.CA>0||n.AA||(n.CA=0|A,e.vel.x=e.vel.y=0,e.gravity=0,e.grounded=0,lA(n,4))},spike:()=>i("spikes"),reset:()=>i("reset")}})(A,{onDeath(){XA.D=1+(0|XA.D);try{l(...LA)}catch{}}}),PA&&(jA.body.pos={x:64,y:24}),HA.setAnimator(A),HA.setPlayer(jA);const t=eA();t&&PA&&jA.setLevelBounds(t.width,t.height,PA.canvas.height,UA),JA=NA=jA?jA.body.pos.x:0}),addEventListener("resize",()=>{if(!PA||!jA)return;const A=eA();A&&jA.setLevelBounds(A.width,A.height,PA.canvas.height,UA)}),HA.attachInput(A,ZA),globalThis.lvl={n(A){YA=Math.max(0,Math.min(QA-1,(0|A)-1)),B(0)}}},update(){if(!PA)return;const A=PA,t={left:d.l.some(A=>w[A]),right:d.r.some(A=>w[A]),up:d.u.some(A=>w[A]),down:d.d.some(A=>w[A]),jump:d.j.some(A=>w[A]),reset:d.rs.some(A=>w[A])};if(t.reset&&!KA&&jA?.reset?.(),KA=!!t.reset,VA>0)0==--VA&&(WA?K(z):B(1));else if(jA?.update(t,A),HA.tick(),jA){const t=eA();if(t){const e=jA.body,s=hA(e),o=A.canvas.height-t.height*UA,n=e.pos.x+s.x|0,g=e.pos.x+s.x+s.w-1|0,i=e.pos.y+s.y|0,C=i+s.h-1|0;let l=n/UA|0,a=g/UA|0,h=(i-o)/UA|0,B=(C-o)/UA|0;0>l&&(l=0),0>h&&(h=0),t.width>a||(a=t.width-1),t.height>B||(B=t.height-1);A:for(let A=h;B>=A;A++){const e=A*t.width,s=o+A*UA;for(let A=l;a>=A;A++){const o=t.tiles[e+A];if(3===o){WA=YA===QA-1;try{globalThis.BA?.stop?.(0)}catch{}globalThis.BA=void 0;try{SA()}catch{}dispatchEvent(new CustomEvent("scene:stop-music")),jA.celebrateWin?.(66),VA=66,HA.reset?.()??HA.clear();break A}if(4===o){const t=A*UA,e=UA,o=t+e/2,l=Math.max(n,t),a=Math.min(g,t+e);if(a>l&&C>s+(2*Math.abs((l>o?l:o>a?a:o)-o)|0)&&s+e>i){jA.spike?.();break A}}}}}}const e=eA();((A,t,e,s,o,n,g,i=.14,C=1/60,l=1)=>{const a=.5*s,h=.5*o,B=1-wA(1-i,60*C);let r=A.x+(t-A.x)*B;const c=.62*o;let Q=(h-A.y+e-56)/(c-56);Q=0>Q?0:Q>1?1:Q;const E=Q*Q*(3-2*Q),I=(e-(h-56))*(1-E)+(e-(h-c))*E;let f=A.nA||0,w=A.y;const d=A.y>I?l?6:4.5:l?3.2:4.5;d&&(f+=(-2*d*f-d*d*(w-I))*C,f>900?f=900:-900>f&&(f=-900),w+=f*C),r=dA(r),w=dA(w),A.nA=dA(10*f)/10;const u=g-h+o;A.x=IA(a,fA(n>s?n-a:a,r)),A.y=fA(u,w)})(ZA,jA?jA.body.pos.x:ZA.x,jA?jA.body.pos.y:ZA.y,A.canvas.width,.7*A.canvas.height,e?e.width*UA:1e4,e?e.height*UA:1e4,.14,.016666666666666666,1),NA=JA,JA+=.18*((jA?jA.body.pos.x:ZA.x)-JA)},draw(A,t){if(!PA)return;const e=PA,o=e.canvas,n=o.width,g=o.height;XA.T=(XA.T||0)+(A-(XA.QA||A)|0),XA.QA=A,OA.draw(e,A/1e3,NA+(JA-NA)*(t||0)),e.save(),e.translate(.5*n-ZA.x|0,.5*g-ZA.y|0);const i=eA();if(i){((A,t,e)=>{const s=A,{width:o,height:n,tiles:g}=t,i=s.canvas.height-n*e|0;$??($=AA("#0006")),_??(_=AA("#fff2"));for(let A=0,t=0;n>A;A++)for(let C=0;o>C;C++,t++){const l=g[t];if(!l)continue;const a=C*e|0,h=i+A*e|0;if(4==l){s.fillStyle="#5d5d5d",s.beginPath(),s.moveTo(a,h+e),s.lineTo(a+e/2,h),s.lineTo(a+e,h+e),s.fill(),s.strokeStyle="#777",s.stroke();continue}const B=2==l;s.fillStyle=B?"#777":"#000",s.fillRect(a,h,e,e),s.fillStyle=B?$:_,s.fillRect(a,h,e,e),B&&(s.fillStyle="#fff3",(A?g[t-o]:0)-2&&s.fillRect(a,h,e,1),(n-1>A?g[t+o]:0)-2&&s.fillRect(a,h+e-1,e,1),(C?g[t-1]:0)-2&&s.fillRect(a,h,1,e),(o-1>C?g[t+1]:0)-2&&s.fillRect(a+e-1,h,1,e))}})(e,i,UA);const A=e.canvas.height-i.height*UA;for(let t=0;i.height>t;t++){const s=t*i.width,o=A+t*UA|0;for(let A=0;i.width>A;A++)3===i.tiles[s+A]&&qA(e,A*UA|0,o,UA)}}jA?.draw(e,A),HA.draw(e,A),e.restore();const C=XA.T/1e3|0,l=C%60|0,a="DEATHS "+(0|XA.D)+"  TIME "+(C/60|0)+":"+(10>l?"0":"")+l,h=6*a.length-1,B=n-h-6|0;e.fillStyle="#0007",e.fillRect(B-3,2,h+6,11),s(e,a,B+1,5,1,"#000"),s(e,a,B,4,1,"#cbd5e1")}},{ctx:$A}=(()=>{const A=document.createElement("canvas");A.width=580,A.height=272,A.style.width="100%",A.style.height="100%",document.body.appendChild(A);const t=A.getContext("2d");return{canvas:A,ctx:t}})();addEventListener("keydown",A=>w[A.keyCode]=1),addEventListener("keyup",A=>w[A.keyCode]=0),[q,zA,z].forEach(A=>A.setCanvas($A));const[_A,At]=(()=>{const[A,t,e,s=125]=[[[,0,240,,,.15,1,.3,,,10],[,0,123,,,.2,,5]],[[[1,-.2,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,,,],[1,.2,,,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,]],[[1,-.2,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,,,],[,-.2,18,,,,,,,,11,,,,.02,,.04,,11.41,,13,,14,,,,,,,17,18,,,,18,,,,,,,,16,,,,16,,,,.02,,.04,,16.41,,,,18,,16,,18,,16,,],[1,.2,,,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,]],[[1,-.2,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,,,],[,.2,14,,,,,,,,.02,.04,.06,,13.41,,14,,13,,,,,,,,,,,,9.41,,10,,11,,,,,,,,,,,,9.41,,11,,9,,,,,,,,,,,,6.41,,9,,],[1,.2,,,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,]],[[1,-.2,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,,,],[,-.2,14,,,,,,,,.02,.04,.06,,13,,14,,13,,,,,,,,,.02,.04,.06,9,,10,,11,,,,,,.02,.04,9,,11,,9,,,,11,,,,,,.02,,.04,,.06,,.08,.1,.13,.16],[1,.2,,,23,,,,30,,,,35,,,,30,,,,23,,,,30,,,,33,,,,30,,,,21,,,,28,,,,33,,,,28,,,,21,,,,28,,,,32,,,,28,,]]],[0,0,1,1,2,3],185];return a(A,t,e,s)})();let tt;const et=globalThis,st=A=>(tt=A,et.BA=A),ot=()=>{try{tt?.stop(0)}catch{}st()},nt=A=>{st(h(_A,At))};addEventListener("scene:stop-music",ot),addEventListener("scene:start-music",A=>{ot(),nt()}),t(A=>{q.setAnimator(A),z.setAnimator(A),q.onClick=()=>{l(),et.D=et.T=et.QA=0,K(zA),nt()},K(q),requestAnimationFrame(g)})</script>