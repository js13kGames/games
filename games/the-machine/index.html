<!doctype html><html><head><title>Machine</title><style>body{margin:0;background:#050505;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;overflow:hidden}canvas{background-color:#111;width:100vw}#gui{position:absolute;top:0;left:0}#gui>div>div{background:#222}</style></head><body><canvas width="1416" height="800"></canvas><div id="gui"></div><script>let t,e,n={};function s(t,...e){(n[t]||[]).map(t=>t(...e))}function h(){return t}function o(){return e}function a(t,e,i){return Math.min(Math.max(t,i),e)}class r{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new r(this.x+t.x,this.y+t.y,this)}subtract(t){return new r(this.x-t.x,this.y-t.y,this)}scale(t){return new r(this.x*t,this.y*t)}normalize(t=this.length()){return new r(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?a(this._a,this._d,t):t}set y(t){this._y=this._c?a(this._b,this._e,t):t}}function l(){return new r(...arguments)}l.prototype=r.prototype,l.class=r;const c=()=>{};class d extends class{constructor(t){return this.init(t)}init(t={}){this.position=l(),this.velocity=l(),this.acceleration=l(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=o(),render:n=this.draw,update:s=this.advance,children:h=[],anchor:a={x:0,y:0},sx:r=0,sy:l=0,opacity:c=1,rotation:d=0,scaleX:u=1,scaleY:x=1,...g}={}){this.children=[],super.init({width:t,height:e,context:i,anchor:a,sx:r,sy:l,opacity:c,rotation:d,scaleX:u,scaleY:x,...g}),this._di=!0,this._uw(),h.map(t=>this.addChild(t)),this._rf=n,this._uf=s}update(t){this._uf(t),this.children.map(t=>t.update&&t.update())}render(t){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.sx||this.sy)&&e.translate(-this.sx,-this.sy),1==this.scaleX&&1==this.scaleY||e.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,n=-this.height*this.anchor.y;(i||n)&&e.translate(i,n),this.context.globalAlpha=this.opacity,this._rf(),(i||n)&&e.translate(-i,-n);let s=this.children;t&&(s=s.filter(t)),s.map(t=>t.render&&t.render()),e.restore()}draw(){}_pc(t,e){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:n=0,_wsx:s=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wr=n+this.rotation;let{x:o,y:a}=function(t,e){let i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}}({x:this.x,y:this.y},n);this._wx=o,this._wy=a,this._wsx=s*this.scaleX,this._wsy=h*this.scaleY,this._wx=this.x*s,this._wy=this.y*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}addChild(t,{absolute:e=!1}={}){this.children.push(t),t.parent=this,t._pc=t._pc||c,t._pc()}removeChild(t){let e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null,t._pc())}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function u(){return new d(...arguments)}u.prototype=d.prototype,u.class=d;class x extends u.class{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function g(){return new x(...arguments)}g.prototype=x.prototype,g.class=x;let y=/(\d+)(\w+)/;class f extends u.class{init({text:t="",textAlign:e="",lineHeight:i=1,font:n=o().font,...s}={}){super.init({text:t,textAlign:e,lineHeight:i,font:n,...s}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(y),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,n=2;for(;n<=e.length;n++){let s=e.slice(i,n).join(" ");t.measureText(s).width>this._fw&&(this._s.push(e.slice(i,n-1).join(" ")),i=n-1)}this._s.push(e.slice(i,n).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map(i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"===i.canvas.dir?"right":"left"),t="right"===e?this.width:"center"===e?this.width/2|0:0,this._s.map((n,s)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(n,t,this._fs*this.lineHeight*s)})}}function p(){return new f(...arguments)}p.prototype=f.prototype,p.class=f;let v=new WeakMap,m={},w={},_={0:"left",1:"middle",2:"right"};function k(t,e){let{x:i,y:n,width:s,height:h}=function(t){let e=t.world||t,i=e.x,n=e.y,s=e.width,h=e.height;return t.anchor&&(i-=s*t.anchor.x,n-=h*t.anchor.y),{x:i,y:n,width:s,height:h}}(t);do{i-=t.sx||0,n-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(i,Math.min(e.x,i+s)),a=e.y-Math.max(n,Math.min(e.y,n+h));return o*o+a*a<e.radius*e.radius}function b(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.collidesWithPointer?n.collidesWithPointer(t):k(n,t))return n}}function S(t,e){return parseFloat(t.getPropertyValue(e))||0}function M(t){let e=void 0!==t.button?_[t.button]:"left";w[e]=!0,A(t,"onDown")}function z(t){let e=void 0!==t.button?_[t.button]:"left";w[e]=!1,A(t,"onUp")}function E(t){A(t,"onOver")}function V(t){v.get(t.target)._oo=null,w={}}function A(t,e){t.preventDefault();let i=t.target,n=v.get(i),{scaleX:s,scaleY:h,offsetX:o,offsetY:a}=function(t){let{canvas:e,_s:i}=t,n=e.getBoundingClientRect(),s="none"!==i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(s[0]),o=parseFloat(s[3]),a=(S(i,"border-left-width")+S(i,"border-right-width"))*h,r=(S(i,"border-top-width")+S(i,"border-bottom-width"))*o,l=(S(i,"padding-left")+S(i,"padding-right"))*h,c=(S(i,"padding-top")+S(i,"padding-bottom"))*o;return{scaleX:(n.width-a-l)/e.width,scaleY:(n.height-r-c)/e.height,offsetX:n.left+(S(i,"border-left-width")+S(i,"padding-left"))*h,offsetY:n.top+(S(i,"border-top-width")+S(i,"padding-top"))*o}}(n);if(-1!==["touchstart","touchmove","touchend"].indexOf(t.type)){n.touches={};for(var r=0;r<t.touches.length;r++)n.touches[t.touches[r].identifier]={id:t.touches[r].identifier,x:(t.touches[r].clientX-o)/s,y:(t.touches[r].clientY-a)/h,changed:!1};for(r=t.changedTouches.length;r--;){const i=t.changedTouches[r].identifier;void 0!==n.touches[i]&&(n.touches[i].changed=!0);let l=t.changedTouches[r].clientX,c=t.changedTouches[r].clientY;n.x=(l-o)/s,n.y=(c-a)/h;let d=b(n);d&&d[e]&&d[e](t),m[e]&&m[e](t,d)}}else{n.x=(t.clientX-o)/s,n.y=(t.clientY-a)/h;let i=b(n);i&&i[e]&&i[e](t),m[e]&&m[e](t,i),"onOver"==e&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(t),n._oo=i)}}function X(...t){t.map(t=>{let e=t.context?t.context.canvas:h(),i=v.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}class Y extends g.class{init({padX:t=0,padY:e=0,text:i,onDown:n,onUp:s,...h}={}){super.init({padX:t,padY:e,...h}),this.textNode=p({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),X(this),this.addChild(this.textNode),this._od=n||c,this._ou=s||c;const o=this._dn=document.createElement("button");o.style="position:absolute;left:-9999px",o.textContent=this.text,o.addEventListener("focus",()=>this.focus()),o.addEventListener("blur",()=>this.blur()),o.addEventListener("keydown",t=>this._kd(t)),o.addEventListener("keyup",t=>this._ku(t)),function(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let n=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,n.nextSibling)}else document.body.appendChild(t)}(o,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!==this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}_ku(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}function P(){return new Y(...arguments)}function C(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}P.prototype=Y.prototype,P.class=Y;const R=[{components:[{key:"toggle-1",x:587,y:557,value:0,max:50},{key:"toggle-2",x:750,y:558,value:0,max:50},{key:"gridScreen-1",x:551,y:197,goal:{x:50,y:50},width:300,height:300,resolution:100}],connections:["toggle-1.value:gridScreen-1.x","toggle-2.value:gridScreen-1.y"]},{components:[{key:"knob-1",x:507,y:528,value:39,max:100},{key:"knob-2",x:854,y:530,value:60,max:100},{key:"gridScreen-1",x:419,y:174,isValid:!1,goal:{x:50,y:50},width:590,height:300,resolution:40}],connections:["knob-1.value:gridScreen-1.x","knob-2.value:gridScreen-1.y"]},{components:[{key:"toggle-1",x:1012,y:168,max:6},{key:"toggle-2",x:421,y:173,max:12},{key:"toggle-3",x:1012,y:273,max:24},{key:"toggle-4",x:419,y:279,max:48},{key:"toggle-5",x:1012,y:384,max:6},{key:"toggle-6",x:420,y:393,max:12},{key:"toggle-7",x:1011,y:507,max:24},{key:"toggle-8",x:417,y:506,max:48},{key:"gridScreen-1",x:535,y:164,goal:{x:58,y:40},width:400,height:400,resolution:24}],connections:["toggle-1.value:gridScreen-1.x","toggle-2.value:gridScreen-1.x","toggle-3.value:gridScreen-1.x","toggle-4.value:gridScreen-1.x","toggle-5.value:gridScreen-1.y","toggle-6.value:gridScreen-1.y","toggle-7.value:gridScreen-1.y","toggle-8.value:gridScreen-1.y"]},{components:[{key:"knob-1",x:417,y:588,value:150,min:90,max:150},{key:"knob-2",x:564,y:585,value:10,min:-25,max:10},{key:"knob-3",x:725,y:584,value:-5.4109570312500015,min:-25,max:10},{key:"knob-4",x:890,y:583,value:10,min:-25,max:10},{key:"toggle-1",x:1076,y:427,max:10},{key:"toggle-2",x:282,y:435,max:40},{key:"toggle-3",x:278,y:347,max:100},{key:"toggle-4",x:284,y:163,max:20},{key:"toggle-5",x:282,y:249,value:30,max:30},{key:"toggle-6",x:1075,y:339,max:50},{key:"toggle-7",x:1067,y:158,max:-30},{key:"toggle-8",x:1074,y:243,max:-90},{key:"waveScreen-1",x:405,y:138,goal:{amplitude:20.07,wavelength:40.33},isValid:!1,amplitude:100,wavelength:30,width:590,height:300}],connections:["knob-1.value:waveScreen-1.amplitude","knob-2.value:waveScreen-1.amplitude","knob-3.value:waveScreen-1.amplitude","knob-4.value:waveScreen-1.amplitude","toggle-1.value:waveScreen-1.wavelength","toggle-2.value:waveScreen-1.wavelength","toggle-3.value:waveScreen-1.wavelength","toggle-4.value:waveScreen-1.wavelength","toggle-5.value:waveScreen-1.wavelength","toggle-6.value:waveScreen-1.wavelength","toggle-7.value:waveScreen-1.wavelength","toggle-8.value:waveScreen-1.wavelength"]},{components:[{key:"toggle-1",x:1100,y:431,max:1},{key:"speaker-1",x:213,y:67,max:100},{key:"toggle-2",x:1245,y:288,max:2},{key:"speaker-2",x:325,y:70,max:100},{key:"toggle-3",x:395,y:282,max:3},{key:"speaker-3",x:442,y:70,max:100},{key:"toggle-4",x:275,y:425,max:4},{key:"speaker-4",x:559,y:71,max:100},{key:"toggle-5",x:394,y:577,max:5},{key:"speaker-5",x:678,y:71,max:100},{key:"toggle-6",x:1239,y:595,max:6},{key:"speaker-6",x:797,y:73,max:100},{key:"toggle-7",x:974,y:601,max:7},{key:"speaker-7",x:917,y:77,max:100},{key:"toggle-8",x:272,y:290,max:8},{key:"speaker-8",x:1047,y:76,max:100},{key:"toggle-9",x:969,y:292,max:9},{key:"speaker-9",x:1173,y:74,max:100},{key:"gridScreen-1",x:520,y:276,goal:{x:30,y:80},width:400,height:400,resolution:40},{key:"toggle-10",x:1100,y:288,max:10},{key:"toggle-11",x:978,y:433,max:10},{key:"toggle-12",x:1246,y:424,max:20},{key:"toggle-13",x:1104,y:598,max:30},{key:"toggle-14",x:396,y:425,max:10},{key:"toggle-15",x:154,y:290,max:10},{key:"toggle-16",x:155,y:429,max:20},{key:"toggle-17",x:158,y:570,max:20},{key:"toggle-18",x:278,y:573,max:30}],connections:["toggle-1.value:speaker-1.value","toggle-2.value:speaker-2.value","toggle-3.value:speaker-3.value","toggle-4.value:speaker-4.value","toggle-5.value:speaker-5.value","toggle-6.value:speaker-6.value","toggle-7.value:speaker-7.value","toggle-8.value:speaker-8.value","toggle-9.value:speaker-9.value","toggle-10.value:gridScreen-1.x","toggle-11.value:gridScreen-1.x","toggle-12.value:gridScreen-1.x","toggle-13.value:gridScreen-1.x","toggle-14.value:gridScreen-1.y","toggle-15.value:gridScreen-1.y","toggle-16.value:gridScreen-1.y","toggle-17.value:gridScreen-1.y","toggle-18.value:gridScreen-1.y"]},{components:[{key:"toggle-1",x:498,y:284,max:3},{key:"speaker-1",x:479,y:107,max:100},{key:"toggle-2",x:664,y:281,max:9},{key:"speaker-2",x:656,y:106,max:100},{key:"toggle-3",x:851,y:291,max:2},{key:"speaker-3",x:838,y:112,max:100},{key:"numberScreen-1",x:605,y:399,value:[0,0,0],goal:[3,9,2]},{key:"knob-1",x:488,y:638,max:100},{key:"knob-2",x:654,y:639,max:100},{key:"knob-3",x:834,y:643,max:100}],connections:["toggle-1.value:speaker-1.value","toggle-2.value:speaker-2.value","toggle-3.value:speaker-3.value","knob-1.value:numberScreen-1.value.0","knob-2.value:numberScreen-1.value.1","knob-3.value:numberScreen-1.value.2"]}],D=[[[[.5,0,120,1.5,,2.5,,,-.001,,3,,,,,,,,,1]],[[[,-1,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,1,,,,,,,,,23,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,-1,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,],[,1,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,,]],[[,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,18,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-1,18,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,,4,,,,,,,,,,,,,,,,],[,1,20,,,,,,,,,,,,,,,,25,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,]],[[,,,,,,,,,,11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,7,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,9,,,,,,,,,]],[[,,12,,,,,,,,,,,,,,,,10,,,,,,,,,,,,,,,,8,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,,],[,,13,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,,10,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]],[0,3,2,4,1,3],50,{title:"New Song",instruments:["Synth Wave"],patterns:["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4"]}]],L=[,,167,,,.08,,2.96,,,171,.35,,.1,-5,,,.1,.03],T=[,,,,.01,,,,.1,,,,.01],N=[,0,0,.24,.3,.3,3,0,,,4,.01,.02,,1,,.04,.7,.09,.4],B=[,,300,.04,3,.53,1,1.35,,,34,.06,.01,.1,,,.14,.63,.11],O=t=>{let e=p({text:"The Machine",font:"150px Arial",color:"#555",x:708,y:200,anchor:{x:.5,y:.5},textAlign:"center"}),i=p({text:"By Daniel Whiffing",font:"24px Arial",color:"#333",x:708,y:370,anchor:{x:.5,y:.5},textAlign:"center"}),n=P({x:600,y:550,text:{text:"Start Game",color:"white",font:"40px Arial, sans-serif",anchor:{x:0,y:.5}},onDown(){t()}});return{shutdown(){},space:{update(){},render(){e.render(),i.render(),n.render()}}}},I=(t,e)=>Math.floor(Math.random()*e)+t,W=(t,e)=>Math.floor(t/e)*e,U=(t,e,i)=>t<e?e:t>i?i:t,j=(t,e,i)=>(1-i)*t+i*e,F={x:.5,y:.5},J=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),H=(t,e)=>({x:t.x*e,y:t.y*e}),q=t=>Math.sqrt(t.x*t.x+t.y*t.y),G=(t,e,i)=>{const n=U((i-t)/(e-t),0,1);return n*n*(3-2*n)},$={x:1,y:1},K=(t=1,e=1,i=1,n=1)=>({r:t,g:e,b:i,a:n}),Q=K(1,1,1,1),Z=(t,e,i)=>{const[n,s]=((t,e)=>{const i=document.createElement("canvas");i.width=t,i.height=e;const n=i.getContext("2d");return[i,n]})(t,e),h=s.getImageData(0,0,t,e),o=new ArrayBuffer(h.data.length),a=new Uint8ClampedArray(o),r=new Uint32Array(o),l={};for(let n=0;n<e;n++)for(let s=0;s<t;s++){l.x=s/(t-1),l.y=n/(e-1);const h=i(l);r[n*t+s]=U(255*h.a,0,255)<<24|U(255*h.b,0,255)<<16|U(255*h.g,0,255)<<8|U(255*h.r,0,255)}return h.data.set(a),s.putImageData(h,0,0),n},tt=(t,e)=>({r:t.r+e.r*e.a,g:t.g+e.g*e.a,b:t.b+e.b*e.a,a:t.a+e.a}),et=()=>Z(21,21,t=>{const e=J(t,F),i=(t=>{const e=2*q(t),i=2*q(J(t,H($,.05))),n=.2*G(1,.5,.8*i),s=G(1,.85,e);return K(n,n,n,s)})(e),n=(t=>{const e=2*q(t)*1.2,i=.25*G(1,0,e),n=G(.99,.9,e);return K(i,i,i,n)})(e),s=(t=>{const e=2*q(t)*1.5,i=1.01*q(J(t,H($,.14))),n=G(1,.6,e)*G(.2,.5,i);return K(n,n,n,n)})(e);return tt(tt(i,n),s)}),it=(t,e,i,n)=>Z(n,n,n=>{const s=J(n,F),h=1-2*q(s),o=((t,e,i)=>({r:j(t.r,e.r,i),g:j(t.g,e.g,i),b:j(t.b,e.b,i),a:j(t.a,e.a,i)}))(K(t,e,i),Q,G(.6,.89,h)),a=G(0,1,h);return K(o.r,o.g,o.b,a*a*a)}),nt=[[,,350,,,.35,2,1.83,,,,,,1.2,.4,.1,.13,.87,.05],[,,383,.41,.38,.34,1,1.28,,,3,.06,.07,,,.1,,.71,.07],[,,540,.04,.04,.19,1,1.83,8.1,,,,,,1.3,,,.81,.08],[,,655,.04,,,1,1.95,51,,,,,.4,-1.1,.3,,,.02],[,,248,,.06,.28,1,1.71,,,,,,.2,.6,.1,.12,.62,.05,.08],[,,1375,,.01,.26,,.97,,,,,,.1,,,,.62,.02],[,,463,,.02,.17,,2.07,-7,,,,,.9,,.4,.03,.69,.01,.18],[,,20,.04,,.07,4,2.67,,-82,,,,,,,.02,.07,,.64],[,,133,,,.44,1,.66,,-.7,,,,,,,,.89,.07,.23]],st=({key:t,x:e,y:i,width:n,height:s,render:h,updateValue:o,onMove:a,onUp:r,onDown:l,value:c=0,...d})=>g({key:t,x:e,y:i,lastX:0,lastY:0,clickX:0,clickY:0,width:n,height:s,value:c,render:function(){this.draggable&&(this.context.fillStyle="#fff",this.context.fillText(this.key,0,-10)),h.call(this)},updateValue:function(t,e){o?o.call(this,t,e):this[t]=e},...d,onMove:function(t){if(a&&a.call(this,t),this.pointerDown&&this.draggable){const e=t.offsetX-this.clickX,i=t.offsetY-this.clickY;this.x=this.lastX+e,this.y=this.lastY+i}},onUp:function(t){a&&a.call(this,t),this.pointerDown=!1},onDown:function(t){l&&l.call(this,t),this.pointerDown=!0,this.lastX=this.x,this.lastY=this.y,this.clickX=t.offsetX,this.clickY=t.offsetY}});var ht=Object.freeze({__proto__:null,createComponent:st,knob:({key:t,x:e=0,y:i=0,width:n=50,height:s,value:h=0,min:o=0,max:r=100})=>{const l=a(o,r,h);return st({key:t,x:e,y:i,min:o,max:r,width:2*n,height:2*(s||n),angle:0,value:l,toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),value:this.value?this.value:void 0,min:this.min?this.min:void 0,max:this.max?this.max:void 0}},onDown:function(t){this.__lastX=t.offsetX||t.touches[0].pageX,this.__lastY=t.offsetY||t.touches[0].pageY,this.lastValue=this.value},onMove:function(t){if(!this.pointerDown||this.draggable)return;const e=this.max-this.min,i=this.__lastX-t.offsetX,n=this.__lastY-t.offsetY,s=1e3/e,h=Math.abs(i)>Math.abs(n)?i:n;let o=this.lastValue-h/s;o=a(this.min,this.max,o),W(Math.floor(o),5)!==W(Math.floor(this.value),5)&&playSound(L),this.value=o},render:function(){const t=(this.value-this.min)/(this.max-this.min);this.angle=5.7*-t-.3,this.context.strokeStyle="#999",this.context.fillStyle="#999",this.context.lineWidth=n/20,this.context.translate(n,n),this.context.rotate(this.angle),this.context.translate(-n,-n),this.context.strokeStyle="#fff",this.context.beginPath(),this.context.arc(n,n,n,0,2*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.moveTo(n-.2*n,-.001*n),this.context.lineTo(n,-.2*n),this.context.lineTo(n+.2*n,-.001*n),this.context.closePath(),this.context.fill()}})},gridScreen:({key:t,x:e,y:i,isValid:n,value:s,goal:h,width:o=400,height:r=400,resolution:l=40})=>{const c=et(),d=it(0,1,0,160),u=it(1,0,0,80);return st({key:t,x:e,y:i,width:o,height:r,isValid:n,resolution:l,value:s||{x:0,y:0,color:"#ffffff",alpha:.75},goal:{x:h&&h.x||I(0,100),y:h&&h.y||I(0,100),color:"#fff",alpha:.05},toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),isValid:!!this.isValid,goal:{x:this.goal.x,y:this.goal.y},width:this.width,height:this.height,resolution:this.resolution}},updateValue:function(t,e){"x"===t||"y"===t?this.value[t]=Math.floor(e):"resolution"===t&&(this[t]=e);const i=this.getCoords(this.value),n=this.getCoords(this.goal),s=i.x===n.x&&i.y===n.y;this.isValid!==s&&s&&playSound(N),this.isValid=s},render:function(){this.context.lineWidth=10,this.context.beginPath(),this.context.strokeStyle="#444",this.context.roundRect(0,0,o+9,r+9,20),this.context.stroke(),this.context.lineWidth=5,this.context.strokeStyle="white",this.context.drawImage(c,this.width+20,this.height+20),this.context.drawImage(this.isValid?d:u,this.width-(this.isValid?50:10),this.height-(this.isValid?50:10));[this.goal,this.value].forEach(t=>{const e=this.getCoords(t);this.context.save(),this.context.globalAlpha=t.alpha||1,this.context.beginPath(),this.context.fillStyle=t.color,this.context.roundRect(e.x*this.resolution+5,e.y*this.resolution+5,this.resolution-2,this.resolution-2,50),this.context.fill(),this.context.restore()})},getCoords:function({x:t,y:e}){const i=(this.width-this.resolution)/this.resolution,n=(this.height-this.resolution)/this.resolution;return{x:a(0,i,Math.floor(t/100*this.width/this.resolution)),y:a(0,n,Math.floor(e/100*this.height/this.resolution))}}})},waveScreen:({key:t,x:e,y:n,goal:s,amplitude:h=20,wavelength:o=9.5,isValid:a,width:r=600,height:l=300})=>{const c=et(),d=it(0,1,0,160),u=it(1,0,0,80);return st({key:t,x:e,y:n,width:r,height:l,isValid:a,active:{wavelength:o,amplitude:h,color:"#ffffff"},goal:{wavelength:s&&s.wavelength||5*I(0,20),amplitude:s&&s.amplitude||5*I(0,20),color:"white",alpha:.1},toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),goal:{amplitude:this.goal.amplitude,wavelength:this.goal.wavelength},isValid:!!this.isValid,amplitude:this.active.amplitude,wavelength:this.active.wavelength,width:this.width,height:this.height}},updateValue:function(t,e){"amplitude"===t&&(this.active[t]=U(W(e,5),0,100)),"wavelength"===t&&(this.active[t]=U(W(e,5),0,100));const i=Math.floor(this.active.wavelength)===Math.floor(this.goal.wavelength)&&Math.floor(this.active.amplitude)===Math.floor(this.goal.amplitude);this.isValid!==i&&i&&playSound(N),this.isValid=i},render:function(){this.context.lineWidth=10,this.context.beginPath(),this.context.strokeStyle="#444",this.context.roundRect(0,30,r+9,l+9,20),this.context.stroke(),this.context.lineWidth=5,this.context.strokeStyle="white",this.context.drawImage(c,this.width+40,this.height+40),this.context.drawImage(this.isValid?d:u,this.width+(this.isValid?-30:10),this.height+(this.isValid?-30:10));[this.active,this.goal].forEach(t=>{this.context.save(),this.context.globalAlpha=t.alpha||1,this.context.beginPath();const e=l/2-100+5;var s=0,h=0,o=n+e;this.context.moveTo(h,o);const a=5*Math.floor((t.amplitude-50)/2),c=3*Math.floor(t.wavelength/6+3);var d=90/n*Math.PI/c*(500/r);for(i=0;i<=0+r+5;i+=5)h=i,o=n+e-Math.sin(s)*a*(l/300),s+=d,this.context.lineTo(h,o);this.context.strokeStyle=t.color,this.context.stroke(),this.context.restore()})}})},numberScreen:({key:t,x:e,y:i,goal:n,value:s,isValid:h})=>{let o=p({text:s,font:"52px Arial",color:"#fff",x:103,y:55,anchor:{x:.5,y:.5},textAlign:"center"});const a=et(),r=it(0,1,0,160),l=it(1,0,0,80);return st({key:t,x:e,y:i,width:200,height:150,value:s||[0,0,0],isValid:h,goal:n||[1,2,3],toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),isValid:!!this.isValid,value:s,goal:{x:this.goal.x,y:this.goal.y}}},updateValue:function(t,e){((t,e,i)=>{for(var n,s=t.split("."),h=i||window;(n=s.shift())&&s.length;)h=h[n];h[n]=e})(t,Math.floor(e/11),this),o.text=this.value.reduce((t,e)=>`${t} ${e}`);const i=this.value.every((t,e)=>this.goal[e]===t);this.isValid!==i&&i&&playSound(N),this.isValid=i},render:function(){this.context.strokeStyle="white",this.context.drawImage(a,this.width+20,this.height+20),this.context.drawImage(this.isValid?r:l,this.width-(this.isValid?50:10),this.height-(this.isValid?50:10)),this.context.lineWidth=8,this.context.beginPath(),this.context.strokeStyle="#444",this.context.roundRect(0,0,this.width+9,this.height+9,20),this.context.stroke(),o.render()}})},toggle:({key:t,x:e,y:i,width:n=30,height:s,value:h=0,min:o=0,max:a=100})=>st({key:t,x:e,y:i,value:h,width:2*n,height:2*(s||n),min:o,max:a,toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),value:this.value?this.value:void 0,min:this.min?this.min:void 0,max:this.max?this.max:void 0}},onDown:function(t){this.draggable||(this.value=this.value?this.min:this.max,playSound(T))},render:function(){this.context.strokeStyle=this.draggable?"gray":"white",this.context.fillStyle=this.draggable?"gray":"white",this.context.lineWidth=n/5,this.context.beginPath(),this.context.arc(n,n,n,0,2*Math.PI),this.context.stroke(),this.value&&this.context.fill()}}),speaker:({key:t,x:e,y:i,width:n=80,height:s=120,value:h=0,min:o=0,max:a=100})=>st({key:t,x:e,y:i,value:h,width:n,height:s,min:o,max:a,toJSON:function(){return{key:this.key,x:Math.floor(this.x),y:Math.floor(this.y),value:this.value?this.value:void 0,min:this.min?this.min:void 0,max:this.max?this.max:void 0}},updateValue:function(t,e){this.draggable||(0===this[t]&&e>0&&setTimeout(()=>{playSound(nt[e-1])},100),this[t]=e)},render:function(){this.context.strokeStyle=this.draggable?"gray":"#444",this.context.fillStyle=this.draggable?"gray":"#444",this.context.lineWidth=8,this.context.beginPath(),this.context.roundRect(0,0,n,s,30),this.context.stroke(),this.value&&this.context.fill()}})});const ot=()=>{const t=[],e=[];return{createEntity:function(t,i){const n=e.filter(e=>e.key.match(new RegExp(t))).length+1,s=ht[t]({key:i.key||`${t}-${n}`,...i});if(s)return this.addEntity(s),s},connections:[],addConnection:function(e=""){const[i="",n=""]=e.split(":"),s={input:{key:i.split(".")[0],prop:i.split(".").slice(1).join(".")},output:{key:n.split(".")[0],prop:n.split(".").slice(1).join(".")}};this.connections.push(s),t.forEach(t=>{t.addConnection&&t.addConnection(s)})},addSystem:function(e){t.push(e)},addEntity:function(i){e.push(i),t.forEach(t=>{t.addEntity(i)})},update:function(){t.forEach(t=>t.update())},render:function(){t.forEach(t=>t.render())},shutdown:function(){t.forEach(t=>t.shutdown&&t.shutdown())},entities:e}},at={color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}},rt=(t=0,e,i)=>{const n=R[t],{connections:s,components:h}=n,o=ot();o.index=t;const a=(t=>{const e=e=>t.entities.forEach(t=>t.onMove&&t.onMove(e)),i=e=>t.entities.forEach(t=>t.onUp&&t.onUp(e));return document.addEventListener("pointermove",e),document.addEventListener("pointerup",i),{addEntity:t=>{X(t)},update:()=>{t.entities.forEach(t=>t.update())},render:()=>{t.entities.forEach(t=>{t.render()})},shutdown:()=>{document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",i)}}})(o);o.addSystem(a);const r=(t=>{function e(t,e,i){return i.indexOf(t)===e}return{addEntity:t=>{},update:()=>{t.entities.forEach(i=>{t.connections.filter(t=>t.output.key===i.key).map(t=>t.output.prop).filter(e).forEach(e=>{const n=t.connections.reduce((n,{input:s,output:h})=>{const o=t.entities.find(t=>t.key===s.key);return h.key===i.key&&h.prop===e?n+o[s.prop]:n},0);i.updateValue(e,n)})})},render:()=>{},shutdown:()=>{}}})(o);o.addSystem(r);const l=()=>{o.entities.forEach(e=>{const i=R[t].components.findIndex(t=>t.key===e.key);if(-1!==i){const n=R[t].components[i];R[t].components[i]={...n,value:e.value,isValid:!!e.isValid}}})};return t>0&&(o.prevLevelButton=P({x:70,y:750,text:{...at,text:"Prev"},onDown(){l(),i()}}),o.prevLevelButton.key="prevLevelButton",o.addEntity(o.prevLevelButton)),o.nextLevelButton=P({x:1300,y:750,text:{...at,text:"Next"},onDown(){l(),e()}}),o.nextLevelButton.key="nextLevelButton",o.addEntity(o.nextLevelButton),h.forEach(t=>{const e=t.key.split("-")[0];o.createEntity(e,t)}),s.forEach(t=>{o.addConnection.call(o,t)}),{space:o,shutdown:()=>o.shutdown()}};zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),i=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,i=220,n=0,s=0,h=.1,o=0,a=1,r=0,l=0,c=0,d=0,u=0,x=0,g=0,y=0,f=0,p=1,v=0,m=0)=>{let w,_,k=2*Math.PI,b=r*=500*k/zzfxR**2,S=(0<g?1:-1)*k/4,M=i*=(1+2*e*Math.random()-e)*k/zzfxR,z=[],E=0,V=0,A=0,X=1,Y=0,P=0,C=0;for(n=99+zzfxR*n,v*=zzfxR,s*=zzfxR,h*=zzfxR,f*=zzfxR,l*=500*k/zzfxR**3,g*=k/zzfxR,c*=k/zzfxR,d*=zzfxR,u=zzfxR*u|0,_=n+v+s+h+f|0;A<_;z[A++]=C)++P%(100*y|0)||(C=o?1<o?2<o?3<o?Math.sin((E%k)**3):Math.max(Math.min(Math.tan(E),1),-1):1-(2*E/k%2+2)%2:1-4*Math.abs(Math.round(E/k)-E/k):Math.sin(E),C=(u?1-m+m*Math.sin(2*Math.PI*A/u):1)*(0<C?1:-1)*Math.abs(C)**a*t*zzfxV*(A<n?A/n:A<n+v?1-(A-n)/v*(1-p):A<n+v+s?p:A<_-f?(_-A-f)/h*p:0),C=f?C/2+(f>A?0:(A<_-f?1:(_-A)/f)*z[A-f|0]/2):C),w=(i+=r+=l)*Math.sin(V*g-S),E+=w-w*x*(1-1e9*(Math.sin(A)+1)%2),V+=w-w*x*(1-1e9*(Math.sin(A)**2+1)%2),X&&++X>d&&(i+=c,M+=c,X=0),!u||++Y%u||(i=M,r=b,X=X||1);return z},zzfxV=.3,zzfxR=44100,zzfxX=new(top.AudioContext||webkitAudioContext),
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(t,e,i,n=125)=>{let s,h,o,a,r,l,c,d,u,x,g,y,f,p,v,m=0,w=[],_=[],k=[],b=0,S=0,M=1,z={},E=zzfxR/n*60>>2;for(;M;b++)w=[M=d=g=f=0],i.map((n,g)=>{for(c=e[n][b]||[0,0,0],M|=!!e[n][b],v=f+(e[n][0].length-2-!d)*E,p=g==i.length-1,h=2,a=f;h<c.length+p;d=++h){for(r=c[h],u=h==c.length+p-1&&p||x!=(c[0]||0)|r|0,o=0;o<E&&d;o++>E-99&&u?y+=(y<1)/99:0)l=(1-y)*w[m++]/2||0,_[a]=(_[a]||0)-l*S+l,k[a]=(k[a++]||0)+l*S+l;r&&(y=r%1,S=c[1]||0,(r|=0)&&(w=z[[x=c[m=0]||0,r]]=z[[x,r]]||(s=[...t[x]],s[2]*=2**((r-12)/12),r>0?zzfxG(...s):[])))}f=v});return[_,k]},function(i){if(t=document.getElementById(i)||i||document.querySelector("canvas"),!t)throw Error("You must provide a canvas element for the game");e=t.getContext("2d"),e.imageSmoothingEnabled=!1,s("init")}(),function(t=h()){let e=v.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:5,touches:{},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},v.set(t,e)}var i,s;t.addEventListener("mousedown",M),t.addEventListener("touchstart",M),t.addEventListener("mouseup",z),t.addEventListener("touchend",z),t.addEventListener("touchcancel",z),t.addEventListener("blur",V),t.addEventListener("mousemove",E),t.addEventListener("touchmove",E),e._t||(e._t=!0,s=()=>{e._lf.length=0,e._cf.map(t=>{e._lf.push(t)}),e._cf.length=0},n[i="tick"]=n[i]||[],n[i].push(s))}();let lt,ct=-1;const dt=JSON.parse(JSON.stringify(R));let ut=!1,xt=!1;window.playSound=t=>!ut&&zzfx(...t),window.toggleMute=()=>ut=!ut,CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,n,s){return i<2*s&&(s=i/2),n<2*s&&(s=n/2),this.beginPath(),this.moveTo(t+s,e),this.arcTo(t+i,e,t+i,e+n,s),this.arcTo(t+i,e+n,t,e+n,s),this.arcTo(t,e+n,t,e,s),this.arcTo(t,e,t+i,e,s),this.closePath(),this};const gt=()=>{if(lt&&lt.shutdown(),0===ct&&!ut&&!xt){xt=!0,zzfxP(...zzfxM(...D[0])).loop=!0}ct>=R.length&&(ct=R.length-1);var t;0===R.filter(t=>!t.components.every(t=>!t.goal||t.goal&&t.isValid)).length?(R.forEach((t,e)=>{R[e]=dt[e]}),ct=-1,t=()=>{lt=O(yt)},playSound(B),lt={shutdown(){},space:{update(){},render(){let e=p({text:"You win!",font:"68px Arial",color:"#333",x:708,y:200,anchor:{x:.5,y:.5},textAlign:"center"}),i=P({x:650,y:550,text:{text:"Back to Menu",color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}},onDown(){t()}});e.render(),i.render()}}}):lt=rt(ct,yt,ft)},yt=()=>{ct++,gt()},ft=()=>{ct>0&&ct--,gt()};lt=O(yt),function({fps:t=60,clearCanvas:e=!0,update:i=c,render:n,context:h=o()}={}){if(!n)throw Error("You must provide a render() function");let a,r,l,d,u,x=0,g=1e3/t,y=1/t,f=e?C:c;function p(){if(r=requestAnimationFrame(p),l=performance.now(),d=l-a,a=l,!(d>1e3)){for(s("tick"),x+=d;x>=g;)u.update(y),x-=g;f(h),u.render()}}return u={update:i,render:n,isStopped:!0,start(){a=performance.now(),this.isStopped=!1,requestAnimationFrame(p)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:p,set _last(t){a=t}},u}({update:()=>lt&&lt.space.update(),render:()=>lt&&lt.space.render()}).start();</script></body></html>