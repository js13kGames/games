<!doctype html><title>Triska the Ninja Cat - js13kGames 2025</title><style>body{height:100vh;padding:0;margin:0;overflow:hidden;background:#7e1f23}canvas{background:0 0;width:100%;height:100%}body,canvas{touch-action:none;user-select:none}#t{pointer-events:none}</style><meta content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no" name=viewport><body onContextMenu="return false" ondragstart=return!1><canvas id=g></canvas><canvas id=t></canvas><script>function t(t,s,i){return t*(1-i)+s*i}function s(t,s){Y[t]=Y[t]||[],Y[t].push(s)}function i(t,s){Y[t]=(Y[t]||[]).filter(t=>t!=s)}function e(t,...s){(Y[t]||[]).map(t=>t(...s))}function o(){return R}function h(t,{contextless:s=!1}={}){if(H=document.getElementById(t)||t||document.querySelector("canvas"),s&&(H=H||new Proxy({},W)),!H)throw Error("You must provide a canvas element for the game");return R=H.getContext("2d")||new Proxy({},W),R.imageSmoothingEnabled=!1,e("init"),{canvas:H,context:R}}function n(t){let s=t.canvas;t.clearRect(0,0,s.width,s.height)}function a({fps:t=60,clearCanvas:i=!0,update:h=E,render:a,context:r=o(),blur:l=!1}={}){function p(){if(d=requestAnimationFrame(p),b&&(u=performance.now(),g=u-c,c=u,1e3>=g)){for(f+=g;f>=x;)e("tick"),P.update(v),f-=x;y(P.context),P.render()}}if(!a)throw Error("You must provide a render() function");let c,d,u,g,P,f=0,x=1e3/t,v=1/t,y=i?n:E,b=!0;return l||(window.addEventListener("focus",()=>{b=!0}),window.addEventListener("blur",()=>{b=!1})),s("init",()=>{P.context??(P.context=o())}),P={update:h,render:a,isStopped:!0,context:r,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},t:p,set i(t){c=t}},P}function r(t,s){return new X(t,s)}function l(){K.forEach(t=>{const s=window.devicePixelRatio||1;t.width=window.innerWidth*s*2,t.height=window.innerHeight*s*2,t.style.position="absolute",t.style.left="0",t.style.top="0",t.getContext("2d").scale(2*s,2*s)})}function p(t,s){K=t,window.addEventListener("resize",function(){l(),null==s||s.forEach(t=>t())}),l(),null==s||s.forEach(t=>t())}function c(){tt(...[.07,,457,.05,.12,.28,,.4,,,233,.13,,,,,,.55,.28])}function d(){if(ot)return void et.resume();let t=((t,s,i,e=125)=>{let o,h,n,a,r,l,p,c,d,u,g,P,f,x,v=0,y=[],b=[],w=[],C=0,k=0,m=1,S={},T=Q/e*60>>2;for(;m;C++)y=[m=c=P=0],i.map((e,M)=>{for(p=s[e][C]||[0,0,0],m|=!!s[e][C],x=P+(s[e][0].length-2-!c)*T,f=M==i.length-1,h=2,a=P;h<p.length+f;c=++h){for(r=p[h],d=h==p.length+f-1&&f||u!=(p[0]||0)|r|0,n=0;T>n&&c;n++>T-99&&d?g+=(1>g)/99:0)l=(1-g)*y[v++]/2||0,b[a]=(b[a]||0)-l*k+l,w[a]=(w[a++]||0)+l*k+l;r&&(g=r%1,k=p[1]||0,(r|=0)&&(y=S[[u=p[v=0]||0,r]]=S[[u,r]]||(o=[...t[u]],o[2]*=2**((r-12)/12),r>0?it(...o):[])))}P=x});return[b,w]})(...ht);ot=st(Z,...t),ot.loop=!0}function u(t){nt=t,nt.addEventListener("mousedown",g),nt.addEventListener("mouseup",P),nt.addEventListener("mousemove",f),nt.addEventListener("wheel",b,{passive:!1}),nt.addEventListener("touchstart",x,{passive:!1}),nt.addEventListener("touchend",v),nt.addEventListener("touchmove",y),document.addEventListener("keydown",w),document.addEventListener("keyup",C)}function g(t){at=!0;const s=nt.getBoundingClientRect(),i=nt.width/s.width,o=nt.height/s.height;rt=(t.clientX-s.left)*i,lt=(t.clientY-s.top)*o,e(L.down,r(rt,lt))}function P(t){const s=nt.getBoundingClientRect(),i=nt.width/s.width,o=nt.height/s.height,h=(t.clientX-s.left)*i,n=(t.clientY-s.top)*o;e(L.up,r(h,n)),at=!1,d()}function f(t){if(at){const s=nt.getBoundingClientRect(),i=nt.width/s.width,e=nt.height/s.height;pt=(t.clientX-s.left)*i,ct=(t.clientY-s.top)*e,k()}}function x(t){at=!0;const s=t.touches[0],i=nt.getBoundingClientRect(),o=nt.width/i.width,h=nt.height/i.height;return rt=(s.clientX-i.left)*o,lt=(s.clientY-i.top)*h,e(L.down,r(rt,lt)),t.preventDefault(),d(),!1}function v(t){const s=t.changedTouches[0],i=nt.getBoundingClientRect(),o=nt.width/i.width,h=nt.height/i.height,n=(s.clientX-i.left)*o,a=(s.clientY-i.top)*h;e(L.up,r(n,a)),at=!1}function y(t){if(at){const s=t.touches[0],i=nt.getBoundingClientRect(),e=nt.width/i.width,o=nt.height/i.height;pt=(s.clientX-i.left)*e,ct=(s.clientY-i.top)*o,k()}}function b(t){t.preventDefault();const s=nt.getBoundingClientRect(),i=nt.width/s.width,o=nt.height/s.height,h=(t.clientX-s.left)*i,n=(t.clientY-s.top)*o;e(L.wheel,{deltaY:t.deltaY,x:h,y:n})}function w(t){if(" "==t.key&&(t.preventDefault(),!at)){at=!0;const t=nt.width/2,s=nt.height/2;e(L.down,r(t,s)),d()}}function C(t){if(" "==t.key&&(t.preventDefault(),at)){const t=nt.width/2,s=nt.height/2;e(L.up,r(t,s)),at=!1}}function k(){const t=pt-rt,s=ct-lt;e(L.drag,{detail:{diffX:t,diffY:s}})}function m(t){let s;try{const i=localStorage.getItem(dt+t);i&&(s=JSON.parse(i))}catch(i){try{s=localStorage.getItem(dt+t)}catch(t){}}return s}function S(t){return 1-Math.pow(1-t,3)}function T(t,s,i,e,o){const h=Math.max(i.x,Math.min(t.x,i.x+e)),n=Math.max(i.y,Math.min(t.y,i.y+o)),a=t.x-h,r=t.y-n;return s*s>a*a+r*r}function M(t,s){const i=t.radius,e={x:t.pos.x-t.radius,y:t.pos.y+t.radius},o=s.pos.x,h=s.pos.x+s.width,n=s.pos.y,a=s.pos.y+s.height;if(!(o>e.x||e.x>h||n>e.y||e.y>a)){const s=e.x-o,r=e.y-n,l=a-e.y,p=Math.min(s,h-e.x,r,l);p==r?(t.pos.y=n-i,t.velocity.y>0&&(t.velocity.y=0)):p==l?(t.pos.y=a+i,0>t.velocity.y&&(t.velocity.y=0)):p==s?(t.pos.x=o-i,t.velocity.x>0&&(t.velocity.x=0)):(t.pos.x=h+i,0>t.velocity.x&&(t.velocity.x=0))}const r=e.x-Math.max(o,Math.min(e.x,h)),l=e.y-Math.max(n,Math.min(e.y,a)),p=Math.sqrt(r*r+l*l);if(p>0&&i>p){const e=i-p,o=r/p,h=l/p;t.pos.x+=o*e,t.pos.y+=h*e;const n=t.velocity.x*o+t.velocity.y*h;0>n&&(s.canBounce&&t instanceof gt?(t.velocity.x-=2*n*o,t.velocity.y-=2*n*h,s.triggerBounce()):(t.velocity.x-=n*o,t.velocity.y-=n*h))}}async function B(t="l",s){Bt=t,Rt=s,Et||(p([mt,kt],[]),u(kt),Dt=new z(kt));const{player:i,goal:e,gameObjects:o,background:h}=function(t,s=1){const i=[];let e=wt[s-1]();const o=new gt(r(e.playerPos.x,e.playerPos.y)),h=new ut(r(e.goalPos.x,e.goalPos.y));return t.pos=r(o.pos.x,o.pos.y),e.objects.forEach(t=>{if(t.box)i.push(new Pt(t.box.pos,t.box.width,t.box.height,t.box.canBounce||!1));else if(t.ropeContactPoint)i.push(new ft(t.ropeContactPoint.pos,t.ropeContactPoint.isActive,t.ropeContactPoint.canActivate,t.ropeContactPoint.endPos));else if(t.pickup)i.push(new xt(t.pickup.pos));else if(t.shuriken)i.push(new vt(t.shuriken.pos));else if(t.text){const s=new yt(r(t.text.pos.x,t.text.pos.y),t.text.text,G);i.push(s)}else t.laser&&i.push(new bt(r(t.laser.startPoint.x,t.laser.startPoint.y),r(t.laser.endPoint.x,t.laser.endPoint.y)))}),{player:o,goal:h,gameObjects:i,background:e.background}}(Dt,Rt);Ht.length=0,null==It||It.destroy(),It=i,Ot=e,Ht=o,zt=h,h&&h.positions&&(jt=new Ft(h.positions)),Ht.splice(0,0,It),Ht.splice(0,0,Ot),Et=!0,Nt.start()}function A(t){let s=null,i=1/0;return Ht.forEach(e=>{if(e.type!==I.RopeContactPoint)return;if(!e.isActive)return;const o=e.pos.distance(t);i>o&&(i=o,s=e)}),s}var L,I,O=Object.defineProperty,D=(t,s,i)=>((t,s,i)=>s in t?O(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);let H,R,E=()=>{},Y={},W={get:(t,s)=>"_proxy"==s||E};class X{constructor(t=0,s=0){D(this,"x",0),D(this,"y",0),this.x=t,this.y=s}add(t){return new X(this.x+t.x,this.y+t.y)}subtract(t){return new X(this.x-t.x,this.y-t.y)}scale(t){return new X(this.x*t,this.y*t)}normalize(t=this.length()||1){return new X(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}}class z{constructor(t){D(this,"pos",r(0,0)),D(this,"canvas"),D(this,"lerpFactor",.04),this.canvas=t,this.pos=r(t.width,t.height)}follow(s){const i=s.pos.x-this.canvas.width/2,e=s.pos.y-this.canvas.height/2;this.pos=r(t(this.pos.x,i,this.lerpFactor),t(this.pos.y,e,this.lerpFactor))}apply(t){t.setTransform(1,0,0,1,0,0),t.translate(-this.pos.x,-this.pos.y)}clear(t){t.clearRect(-1e3+this.pos.x,-1e3+this.pos.y,this.canvas.width+2e3,this.canvas.height+2e3)}}const j="#7e1f23",F="#c4181f",G="#000",V="#aaa",q="#ccc",N="#fff",U="#222",$="rgba(0, 0, 0, 0.5)",J="#888",_="Impact";let K;L=(t=>(t.up="u",t.down="d",t.play="p",t.selectLevel="l",t.drag="dr",t.wheel="w",t.kill="k",t.goal="g",t))(L||{});const Q=44100,Z=new(window.AudioContext||webkitAudioContext),tt=(...t)=>st(Z,it(...t)),st=(t,...s)=>{let i=t.createBufferSource(),e=t.createBuffer(s.length,s[0].length,Q);return s.map((t,s)=>e.getChannelData(s).set(t)),i.buffer=e,i.connect(t.destination),i.start(),i},it=(t=1,s=.05,i=220,e=0,o=0,h=.1,n=0,a=1,r=0,l=0,p=0,c=0,d=0,u=0,g=0,P=0,f=0,x=1,v=0,y=0)=>{let b,w,C=2*Math.PI,k=r*=500*C/Q**2,m=(g>0?1:-1)*C/4,S=i*=(1+2*s*Math.random()-s)*C/Q,T=[],M=0,B=0,A=0,L=1,I=0,O=0,D=0;for(l*=500*C/Q**3,g*=C/Q,p*=C/Q,c*=Q,d=Q*d|0,w=(e=99+Q*e)+(v*=Q)+(o*=Q)+(h*=Q)+(f*=Q)|0;w>A;T[A++]=D)++O%(100*P|0)||(D=n?n>1?n>2?n>3?Math.sin((M%C)**3):Math.max(Math.min(Math.tan(M),1),-1):1-(2*M/C%2+2)%2:1-4*Math.abs(Math.round(M/C)-M/C):Math.sin(M),D=(d?1-y+y*Math.sin(2*Math.PI*A/d):1)*(D>0?1:-1)*Math.abs(D)**a*t*.3*(e>A?A/e:e+v>A?1-(A-e)/v*(1-x):e+v+o>A?x:w-f>A?(w-A-f)/h*x:0),D=f?D/2+(f>A?0:(w-f>A?1:(w-A)/f)*T[A-f|0]/2):D),b=(i+=r+=l)*Math.sin(B*g-m),M+=b-b*u*(1-1e9*(Math.sin(A)+1)%2),B+=b-b*u*(1-1e9*(Math.sin(A)**2+1)%2),L&&++L>c&&(i+=p,S+=p,L=0),!d||++I%d||(i=S,r=k,L=L||1);return T};let et=Z,ot=null;const ht=[[[.4,0,440,.11,.2,.15,,2,,,,,,,,,.06,.53,.01],[.1,0,110,.03,.2,.16,2,.3,,,,,,,,,,.81,.08],[.15,,237,.02,.07,.04,4,3.1,1,,,,,1.1,,.2,.14,.87,.01],[.04,,132,.01,.01,,4,3.1,2,,,,,1.9,10,,,.77,.04]],[[[,-.3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,7,,10,,12,,],[1,.3,7,,,,,,10,,,,7,,10,,12,,13,,13,,,,12,,,,13,,12,,13,,7,,,,,,10,,,,7,,10,,12,,13,,13,,,,13,,,,1,,,,,,],[2,-.3,13,,,,17,,,,13,,,,17,,,,13,,,,18,,,,13,,,,18,,,,13,,,,18,,,,13,,,,18,,,,13,,,,18,,,,13,,,,18,,,,],[3,.3,17,15,17,15,17,,,,,,,,15,17,15,17,15,17,,,15,17,15,17,,,,15,17,15,17,,,,15,17,15,17,,,15,17,15,17,15,17,15,17,,,15,17,15,17,,,15,17,15,17,,15,17,15]],[[,-.3,14,,,,14,,,,14,,,,,,,,,,,,,,,,,,7,,10,,12,,14,,,,14,,,,14,,,,14,,,,,,,,,,10,,10,,,,10,,,,12,,,,12,,,,12,,5,,7,,,,,,,,,,,,,,,,7,,7,,7,,10,,,,10,,10,,,,,,,,,,,,,,,,,,7,,14,,17,,],[1,.3,7,,,,,,14,,,,,,,,,,7,,,,,,14,,,,,,,,,,10,,,,,,17,,,,,,,,,,10,,,,,,17,,,,,,,,,,3,,,,,,10,,,,,,,,,,5,,,,,,12,,,,,,,,,,7,,,,,,14,,,,,,,,,,7,,,,,,14,,,,,,,,,,],[2,-.3,13,,,,,,15,,13,,,,17,,,,13,,,,15,,15,,13,,,,14,,,,13,,,,,,15,,13,,,,13,,,,13,,,,13,,15,,13,,,,18,,,,14,,13,,13,,,,13,,,,13,,,,14,,13,,13,,,,13,,,,13,,,,,,13,,13,,,,13,,,,,,13,,13,,,,14,,,,13,,,,14,,13,,],[3,.3,,,17,17,,,17,17,,,,17,,,,17,,,17,17,,,17,,,,17,17,,,17,,,,17,17,,,17,,,,17,17,,,17,17,,,17,17,,,17,17,,,17,17,,,17,,,,17,,,,17,,,,17,17,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,,,,17,17,,,17,17,,,17,,]],[[,-.3,19,,,,19,,,,19,,,,19,,17,,,,,,,,,,,,,,,,,,17,,,,17,,,,17,,,,17,,14,,,,,,,,,,,,,,,,,,19,,,,19,,,,19,,,,19,,17,,,,,,,,,,,,,,,,,,17,,,,17,,,,17,,,,17,,18,,,,,,,,,,,,,,,,,,],[1,.3,7,,,,,,14,,,,,,,,,,7,,,,,,14,,,,,,,,,,10,,,,,,17,,,,,,,,,,10,,,,,,17,,,,,,,,,,3,,,,,,10,,,,,,,,,,5,,,,,,12,,,,,,,,,,10,,,,10,,,,10,,,,5,,6,,,,,,6,,,,2,,,,5,,,,],[2,-.3,13,,,,17,,,,13,,,,17,,,,13,,,,15,,15,,13,,,,14,,,,13,,,,18,,,,13,,,,13,,18,,13,,,,13,,15,,13,,,,18,,,,14,,,,13,,,,13,,18,,13,,,,14,,13,,13,,,,13,,,,,,,,15,,13,,13,,17,,13,,17,,15,,15,,13,,,,14,,,,,,,,,,,,],[3,.3,27,,,,29,,,25,27,,,,29,,,,27,,,25,29,,,,27,,,,29,,,25,27,,,,29,,,,27,,,25,29,,,,27,,,,29,,,25,27,,,,29,,,,27,,,25,29,,,,27,,,,29,,,25,27,,,,29,,,,27,,,,,,,,,29,27,29,29,29,27,29,27,27,29,29,27,27,29,29,27,,,,,,,,,,,,,,,,]]],[0,1,1,2],130];let nt,at=!1,rt=0,lt=0,pt=0,ct=0;const dt="p-";I=(t=>(t.Player="p",t.Enemy="e",t.Platform="pl",t.RopeContactPoint="r",t.Goal="g",t.Pickup="up",t.Shuriken="s",t.Ball="b",t.MainMenu="m",t.Text="t",t.Laser="l",t))(I||{});class ut{constructor(t){D(this,"pos"),D(this,"type",I.Goal),D(this,"width",200),D(this,"height",150),D(this,"radiusX",100),D(this,"radiusY",150),this.pos=t}update(){}render(t){t.save(),t.beginPath(),t.ellipse(this.pos.x+this.width/2,this.pos.y,this.radiusX,this.radiusY,0,0,2*Math.PI),t.fillStyle=N,t.fill(),t.restore()}}class gt{constructor(t){D(this,"rot",0),D(this,"pos",r(0,0)),D(this,"velocity",r(0,0)),D(this,"state","a"),D(this,"type",I.Player),D(this,"radius",79),D(this,"catCenterX",-58),D(this,"catCenterY",95),D(this,"leftThread",[]),D(this,"rightThread",[]),D(this,"threadSegmentLength",16),D(this,"threadCount",8),D(this,"catBodyCanvas",null),D(this,"catShadowCanvas",null),D(this,"isGrappling",!1),D(this,"ropeContactPoint",null),D(this,"ropeLength",0),D(this,"targetRopeLength",0),D(this,"initialRopeLength",0),D(this,"ropeTweenProgress",0),D(this,"ropeTweenDuration",60),D(this,"ropeShootProgress",0),D(this,"ropeShootDuration",20),D(this,"fullRopeDistance",0),D(this,"spinVelocity",0),D(this,"spinDamping",.9),D(this,"gravity",.3),D(this,"damping",.999),D(this,"maxSpeed",25),D(this,"startPos",r(0,0)),D(this,"onStartGrapple",()=>{tt(...[.1,,204,.04,.03,.07,1,.8,7,10,,,,,,,,.58,.04,,-1327]);const t=A(this.pos);if(this.ropeContactPoint=t,!t)return;this.isGrappling=!0;const s=this.getRopeAttachmentPosition();this.fullRopeDistance=s.distance(t.pos),this.ropeShootProgress=0,this.ropeLength=this.fullRopeDistance,this.initialRopeLength=this.ropeLength,this.targetRopeLength=.8*this.ropeLength,this.ropeTweenProgress=0;const i=t.pos.subtract(s),e=Math.sign(i.x);this.velocity=this.velocity.add(r(9*e,0))}),D(this,"onStopGrapple",()=>{const t=this.velocity.length();if(this.spinVelocity=.8*t,this.spinVelocity>2){const t=Math.sign(this.velocity.x);this.spinVelocity=Math.abs(this.spinVelocity)*t}this.isGrappling=!1,this.ropeContactPoint=null}),this.startPos=t,this.pos=t,this.initializeCatBodyCache(),this.initializeHeadbandThreads(),this.listenForEvents()}initializeCatBodyCache(){this.catBodyCanvas=new OffscreenCanvas(300,300);const t=this.catBodyCanvas.getContext("2d");this.catShadowCanvas=new OffscreenCanvas(300,300);const s=this.catShadowCanvas.getContext("2d");this.renderCatBodyToCanvas(t,!1),this.renderCatBodyToCanvas(s,!0)}initializeHeadbandThreads(){const t=this.getCenterPosition(),s=r(t.x-30,t.y-30);this.leftThread=[];for(let t=0;t<this.threadCount;t++){const i={pos:r(s.x,s.y+t*this.threadSegmentLength),oldPos:r(s.x,s.y+t*this.threadSegmentLength),pinned:0==t};this.leftThread.push(i)}const i=r(t.x+10,t.y-30);this.rightThread=[];for(let t=0;t<this.threadCount;t++){const s={pos:r(i.x,i.y+t*this.threadSegmentLength),oldPos:r(i.x,i.y+t*this.threadSegmentLength),pinned:0==t};this.rightThread.push(s)}}renderCatBodyToCanvas(t,s){t.translate(150,100),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(20,-32,11,134,0,149),t.bezierCurveTo(-18,172,-93,174,-113,145),t.bezierCurveTo(-126,126,-128,-24,-113,0),t.bezierCurveTo(-79,41,-37,48,0,0),t.closePath(),t.fillStyle=s?$:G,t.fill(),t.save(),t.fillStyle=s?$:F,t.fillRect(-125,45,137,41),t.restore(),t.save();const i=(i,e,o=.8)=>{t.beginPath();const h=o;t.moveTo(i-30*h,e),t.bezierCurveTo(i-31*h,e-23*h,i-16*h,e-30*h,i,e-30*h),t.bezierCurveTo(i+16*h,e-30*h,i+29*h,e-14*h,i+29*h,e+2*h),t.bezierCurveTo(i+29*h,e+18*h,i+16*h,e+30*h,i,e+30*h),t.bezierCurveTo(i-16*h,e+30*h,i-28*h,e+24*h,i-30*h,e),t.closePath(),t.fillStyle=s?$:N,t.fill(),t.beginPath(),t.arc(i,e,6,0,2*Math.PI),t.fillStyle=G,t.fill()};i(-80,66),i(-30,66),t.restore()}renderCat(t){this.catBodyCanvas&&this.catShadowCanvas&&(t.save(),t.translate(this.pos.x+this.catCenterX+14,this.pos.y+this.catCenterY+14),t.rotate(this.rot),t.translate(-this.catCenterX,-this.catCenterY),t.drawImage(this.catShadowCanvas,-150,-100),t.restore(),t.save(),t.translate(this.pos.x+this.catCenterX,this.pos.y+this.catCenterY),t.rotate(this.rot),t.translate(-this.catCenterX,-this.catCenterY),t.drawImage(this.catBodyCanvas,-150,-100),t.restore())}setState(t){this.state=t}listenForEvents(){s(L.down,this.onStartGrapple),s(L.up,this.onStopGrapple)}removeEventListeners(){i(L.down,this.onStartGrapple),i(L.up,this.onStopGrapple)}destroy(){this.removeEventListeners(),this.catBodyCanvas=null,this.catShadowCanvas=null}render(t){"d"!=this.state&&(this.renderHeadbandThreads(t),this.isGrappling&&this.ropeContactPoint&&this.renderRope(t),this.renderCat(t))}renderHeadbandThreads(t){this.renderThread(t,this.leftThread),this.renderThread(t,this.rightThread)}renderThread(t,s){t.save(),t.strokeStyle=G,t.lineWidth=30,this.drawSpline(t,s,4,4),t.strokeStyle=F,t.lineWidth=30,this.drawSpline(t,s,0,0),t.restore()}drawSpline(t,s,i,e){if(t.beginPath(),t.moveTo(s[0].pos.x+i,s[0].pos.y+e),2==s.length)t.lineTo(s[1].pos.x+i,s[1].pos.y+e);else{for(let o=1;o<s.length-1;o++){const h=s[o],n=s[o+1],a=(h.pos.x+n.pos.x)/2+i,r=(h.pos.y+n.pos.y)/2+e;t.quadraticCurveTo(h.pos.x+i,h.pos.y+e,a,r)}const o=s[s.length-1];t.quadraticCurveTo(o.pos.x+i,o.pos.y+e,o.pos.x+i,o.pos.y+e)}t.stroke()}getCenterPosition(){return r(this.pos.x+this.catCenterX,this.pos.y+this.catCenterY)}getRopeAttachmentPosition(){return r(this.pos.x+this.catCenterX,this.pos.y+this.catCenterY+40)}updateHeadbandThreads(){const t=r(0,.2),s=this.getCenterPosition(),i=r(-30,-30),e=r(10,-30),o=Math.cos(this.rot),h=Math.sin(this.rot),n=r(i.x*o-i.y*h,i.x*h+i.y*o),a=r(e.x*o-e.y*h,e.x*h+e.y*o);this.updateThread(this.leftThread,r(s.x+n.x,s.y+n.y),t),this.updateThread(this.rightThread,r(s.x+a.x,s.y+a.y),t)}updateThread(t,s,i){for(let e=0;e<t.length;e++){const o=t[e];if(o.pinned)o.pos=s.add(r(0,0)),o.oldPos=o.pos;else{const t=o.pos.subtract(o.oldPos);o.oldPos=o.pos,o.pos=o.pos.add(t).add(i)}}for(let s=0;3>s;s++)for(let s=0;s<t.length-1;s++){const i=t[s],e=t[s+1],o=e.pos.subtract(i.pos),h=o.length();if(h>0){const t=(this.threadSegmentLength-h)/h/2,s=o.scale(t);i.pinned||(i.pos=i.pos.subtract(s)),e.pinned||(e.pos=e.pos.add(s))}}}renderRope(t){if(!this.ropeContactPoint)return;const s=this.getRopeAttachmentPosition(),i=this.ropeContactPoint.pos.x,e=this.ropeContactPoint.pos.y,o=S(this.ropeShootProgress),h=s.x+(i-s.x)*o,n=s.y+(e-s.y)*o;t.save(),t.strokeStyle=$,t.lineWidth=25,t.beginPath(),t.moveTo(s.x+12,s.y+8),t.lineTo(h+12,n+8),t.stroke(),t.restore(),t.save(),t.strokeStyle=G,t.lineWidth=25,t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(h,n),t.stroke(),t.restore()}update(){if("d"==this.state)return;this.updateHeadbandThreads();const t=this.velocity.length();if(t>2&&Math.abs(this.velocity.x)>1){const s=.1*t*Math.sign(this.velocity.x)-this.spinVelocity;let i=.05;this.spinVelocity+=s*i}else this.spinVelocity*=this.spinDamping;this.rot+=.02*this.spinVelocity,this.isGrappling&&1>this.ropeShootProgress&&(this.ropeShootProgress+=1/this.ropeShootDuration,1>this.ropeShootProgress||(this.ropeShootProgress=1)),this.isGrappling&&this.ropeContactPoint&&!this.ropeContactPoint.isActive&&this.onStopGrapple(),this.isGrappling&&this.ropeContactPoint?this.applyRopePhysics():this.velocity=this.velocity.add(r(0,this.gravity));const s=this.isGrappling?1.01:this.damping;this.velocity=this.velocity.scale(s),this.velocity.length()>this.maxSpeed&&(this.velocity=this.velocity.normalize().scale(this.maxSpeed)),this.pos=this.pos.add(this.velocity)}applyRopePhysics(){if(!this.ropeContactPoint)return;if(1>this.ropeTweenProgress){this.ropeTweenProgress+=1/this.ropeTweenDuration,this.ropeTweenProgress=Math.min(1,this.ropeTweenProgress);const t=S(this.ropeTweenProgress);this.ropeLength=this.initialRopeLength+(this.targetRopeLength-this.initialRopeLength)*t}const t=this.getRopeAttachmentPosition().subtract(this.ropeContactPoint.pos);if(t.length()>this.ropeLength){const s=t.normalize(),i=this.ropeContactPoint.pos.add(s.scale(this.ropeLength));this.pos=r(i.x-this.catCenterX,i.y-this.catCenterY-40);const e=r(-s.y,s.x),o=this.velocity.dot(e);this.velocity=e.scale(o)}this.velocity=this.velocity.add(r(0,this.gravity))}}class Pt{constructor(t,s,i,e=!1){D(this,"pos"),D(this,"width"),D(this,"height"),D(this,"type",I.Platform),D(this,"canBounce",!1),D(this,"strokeWidth",10),D(this,"maxStrokeWidth",35),D(this,"minStrokeWidth",5),D(this,"bounceDecay",.8),this.pos=t,this.width=s,this.height=i,this.canBounce=e}update(){this.strokeWidth>this.minStrokeWidth?this.strokeWidth*=this.bounceDecay:this.strokeWidth=this.minStrokeWidth}triggerBounce(){this.strokeWidth=this.maxStrokeWidth}render(t){t.save(),t.fillStyle=G,t.fillRect(this.pos.x+14,this.pos.y+14,this.width,this.height),this.canBounce&&(t.fillStyle=N,t.fillRect(this.pos.x-this.strokeWidth/2,this.pos.y-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth)),t.fillStyle=j,t.fillRect(this.pos.x,this.pos.y,this.width,this.height),t.restore()}}class ft{constructor(t,s=!0,i=!1,e,o=2e3){var h;D(this,"pos"),D(this,"radius",40),D(this,"rotation",0),D(this,"type",I.RopeContactPoint),D(this,"isHighlighted",!1),D(this,"isActive",!0),D(this,"canActivate",!0),D(this,"activationTime",3),D(this,"timeSinceActivated",0),D(this,"canMove",!1),D(this,"startPos"),D(this,"endPos"),D(this,"moveTime",2e3),D(this,"moveElapsed",0),D(this,"moveDirection",1),this.pos=t,this.isActive=s,this.canActivate=i,this.startPos=t,this.endPos=e||t,this.moveTime=o,(null==e?void 0:e.x)&&(null==(h=this.startPos)?void 0:h.x)&&(this.canMove=e.x!=this.startPos.x||e.y!=this.startPos.y)}update(){if(this.rotation+=.02,this.canMove){this.moveElapsed+=16.67;let s=this.moveElapsed/this.moveTime,i=1==this.moveDirection?s:1-s;i=function(t){return t*t*(3-2*t)}(i),this.pos=r(t(this.startPos.x,this.endPos.x,i),t(this.startPos.y,this.endPos.y,i)),1>s||(s=1,this.moveElapsed=0,this.moveDirection*=-1)}this.canActivate&&(this.timeSinceActivated+=.02,this.timeSinceActivated<this.activationTime||(this.toggleActive(),this.timeSinceActivated=0))}render(t){this.canMove&&(t.save(),t.strokeStyle=V,t.lineWidth=12,t.setLineDash([8,8]),t.beginPath(),t.moveTo(this.startPos.x,this.startPos.y),t.lineTo(this.endPos.x,this.endPos.y),t.stroke(),t.setLineDash([]),t.restore()),t.save(),this.isHighlighted&&(t.fillStyle=N,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius+10,0,2*Math.PI),t.fill());const s=this.isActive?F:V;if(t.strokeStyle=s,t.lineWidth=5,t.setLineDash([8,6]),t.lineDashOffset=20*-this.rotation,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.stroke(),t.setLineDash([]),this.canActivate){const s=this.timeSinceActivated/this.activationTime,i=this.radius+15,e=-Math.PI/2,o=e+2*s*Math.PI;t.strokeStyle=F,t.lineWidth=6,t.beginPath(),t.arc(this.pos.x,this.pos.y,i,e,o),t.stroke(),t.strokeStyle=V,t.lineWidth=2,t.beginPath(),t.arc(this.pos.x,this.pos.y,i,o,e+2*Math.PI),t.stroke()}this.isActive&&(t.fillStyle=G,t.beginPath(),t.arc(this.pos.x+3,this.pos.y+2,.5*this.radius,0,2*Math.PI),t.fill(),t.fillStyle=j,t.beginPath(),t.arc(this.pos.x,this.pos.y,.5*this.radius,0,2*Math.PI),t.fill()),t.restore()}setHighlight(t){this.isHighlighted=t}setActive(t){this.isActive=t}toggleActive(){this.isActive=!this.isActive}}class xt{constructor(t,s=F){D(this,"type",I.Pickup),D(this,"pos",r(0,0)),D(this,"width",128),D(this,"height",128),D(this,"animationTime",0),D(this,"baseScale",1),D(this,"currentScale",1),D(this,"currentRotation",0),D(this,"burstStartTime",0),D(this,"burstDuration",1),D(this,"cloverCanvas",null),D(this,"cloverContext",null),D(this,"cloverShadowCanvas",null),D(this,"cloverShadowContext",null),D(this,"state","a"),D(this,"collected",!1),this.color=s,this.pos=t,this.initializeCloverCache()}setScale(t){this.baseScale=t,this.update()}initializeCloverCache(){this.cloverCanvas=new OffscreenCanvas(200,200),this.cloverContext=this.cloverCanvas.getContext("2d"),this.cloverShadowCanvas=new OffscreenCanvas(200,200),this.cloverShadowContext=this.cloverShadowCanvas.getContext("2d"),this.renderCloverToCanvas(this.cloverContext,!1),this.renderCloverToCanvas(this.cloverShadowContext,!0)}renderCloverToCanvas(t,s){t.translate(100,100);const i=(i,e,o)=>{t.save(),t.translate(e,o),t.rotate(i),t.fillStyle=s?$:this.color,t.beginPath(),t.moveTo(3,-14),t.bezierCurveTo(-9,-16,-18,-3,-14,8),t.lineTo(10,16),t.lineTo(19,4),t.closePath(),t.fill(),t.restore()};(()=>{t.save(),t.strokeStyle=s?$:this.color,t.lineWidth=10,t.beginPath(),t.moveTo(20,0),t.quadraticCurveTo(5,45,45,50),t.stroke(),t.restore()})(),i(0,0,0),i(-Math.PI/2,0,23),i(-Math.PI,30,19),i(-3*Math.PI/2,26,-3)}update(){this.animationTime+=.02;const t=.1*Math.sin(3*this.animationTime);this.currentScale=this.baseScale+t;const s=Math.PI/18,i=-Math.PI/20;this.currentRotation=Math.sin(2*this.animationTime)*s+i}render(t){"a"==this.state?this.renderClover(t):"c"==this.state&&this.renderCloverBurst(t)}renderCloverBurst(t){const s=(this.animationTime-this.burstStartTime)/this.burstDuration;if(s>=1)return void(this.state="d");t.save(),t.translate(this.pos.x+this.width/2,this.pos.y+this.height/2);const i=1-.5*s,e=180*s,o=(s,o,h,n)=>{t.save();const a=n.x*e,r=n.y*e;t.translate(o+a,h+r),t.rotate(s),t.scale(i,i),t.fillStyle=F,t.beginPath(),t.moveTo(3,-14),t.bezierCurveTo(-9,-16,-18,-3,-14,8),t.lineTo(10,16),t.lineTo(19,4),t.closePath(),t.fill(),t.restore()};o(0,0,0,r(0,-1)),o(-Math.PI/2,0,23,r(1,0)),o(-Math.PI,30,19,r(0,1)),o(-3*Math.PI/2,26,-3,r(-1,0)),(s=>{t.save();const o=s.x*e,h=s.y*e;t.translate(o,h),t.scale(i,i),t.strokeStyle=F,t.lineWidth=10,t.beginPath(),t.moveTo(20,0),t.quadraticCurveTo(5,45,45,50),t.stroke(),t.restore()})(r(0,1)),t.restore()}renderClover(t){if(!this.cloverCanvas||!this.cloverShadowCanvas)return;t.save(),t.translate(this.pos.x+this.width/2,this.pos.y+this.height/2),t.rotate(this.currentRotation),t.save();const s=.14*Math.sin(3*this.animationTime),i=this.baseScale+s+.1;t.scale(i,i),t.drawImage(this.cloverShadowCanvas,-100+i,-100+i+1),t.restore(),t.save(),t.scale(this.currentScale,this.currentScale),t.drawImage(this.cloverCanvas,-100,-100),t.restore(),t.restore()}collect(){"c"!=this.state&&"d"!=this.state&&(this.collected=!0,tt(...[.2,,545,.01,.09,.14,1,3.4,,,497,.06,,,,,,.52,.03]),this.state="c",this.burstStartTime=this.animationTime)}}class vt{constructor(t){D(this,"pos"),D(this,"type",I.Shuriken),D(this,"width",40),D(this,"height",50),D(this,"radius",55),D(this,"rotation",0),D(this,"rotationSpeed",.08),D(this,"bladeCanvas",null),D(this,"bladeContext",null),this.pos=t,this.initializeBladeCache()}initializeBladeCache(){this.bladeCanvas=new OffscreenCanvas(400,400),this.bladeContext=this.bladeCanvas.getContext("2d"),this.renderBladeToCanvas(this.bladeContext)}renderBladeToCanvas(t){t.translate(233,182),[{rotation:Math.PI/2,translateX:-1,translateY:0},{rotation:Math.PI,translateX:14,translateY:-50},{rotation:3*Math.PI/2,translateX:-34,translateY:-64},{rotation:0,translateX:-50,translateY:-14}].forEach(s=>{t.save(),t.rotate(s.rotation),t.translate(s.translateX,s.translateY),(()=>{const s=[{x:0,y:0},{x:-69.5,y:31},{x:0,y:63.5},{x:0,y:47.5},{x:-5.5,y:31},{x:0,y:16.5}];t.fillStyle=G,t.beginPath(),t.moveTo(s[0].x,s[0].y);for(let i=1;s.length>i;i++)t.lineTo(s[i].x,s[i].y);t.closePath(),t.fill(),t.strokeStyle=G,t.lineWidth=2,t.stroke()})(),t.restore()})}update(){this.rotation+=this.rotationSpeed}render(t){t.save(),t.translate(this.pos.x+this.width,this.pos.y+this.height),t.rotate(this.rotation),this.renderShuriken(t),t.restore()}renderShuriken(t){this.bladeCanvas&&t.drawImage(this.bladeCanvas,-200,-200)}}class yt{constructor(t,s,i=N){D(this,"pos"),D(this,"type",I.Text),D(this,"text"),D(this,"color"),this.pos=t,this.text=s,this.color=i}update(){}render(t){t.save(),t.fillStyle=this.color,t.font="62px "+_,t.fillText(this.text,this.pos.x,this.pos.y),t.restore()}}class bt{constructor(t,s){D(this,"type",I.Laser),D(this,"pos",r(0,0)),D(this,"width",0),D(this,"height",0),D(this,"radius",0),D(this,"startPoint"),D(this,"endPoint"),D(this,"beamWidth",20),D(this,"isActive",!0),D(this,"toggleTimer",0),D(this,"toggleDuration",350),D(this,"onDuration",120),D(this,"beamProgress",0),D(this,"beamGrowthSpeed",.15),D(this,"wasActive",!1),D(this,"fadeProgress",0),D(this,"fadeSpeed",.2),D(this,"warningFrames",45),D(this,"isWarning",!1),this.startPoint=t,this.endPoint=s,this.startPoint.y===this.endPoint.y?(this.width=Math.abs(this.endPoint.x-this.startPoint.x),this.height=5):(this.width=5,this.height=Math.abs(this.endPoint.y-this.startPoint.y)),this.pos=r(Math.min(this.startPoint.x,this.endPoint.x)-20,Math.min(this.startPoint.y,this.endPoint.y))}update(){this.toggleTimer=(this.toggleTimer+1)%this.toggleDuration;const t=this.toggleTimer<this.onDuration,s=this.toggleTimer<this.onDuration?0:this.toggleDuration-this.toggleTimer;this.isWarning=!this.isActive&&s<=this.warningFrames&&s>0,t&&!this.wasActive&&(this.beamProgress=0,this.fadeProgress=1),this.wasActive=this.isActive,this.isActive=t,this.isActive?(this.beamProgress=Math.min(1,this.beamProgress+this.beamGrowthSpeed),this.fadeProgress=1):(this.beamProgress=0,this.fadeProgress=Math.max(0,this.fadeProgress-this.fadeSpeed))}render(t){t.save();const s=this.startPoint.y===this.endPoint.y,i=Math.abs(s?this.endPoint.x-this.startPoint.x:this.endPoint.y-this.startPoint.y),e=Math.min(1,15/i),o=s?this.startPoint.x+(this.endPoint.x-this.startPoint.x)*e:this.startPoint.x,h=s?this.startPoint.y:this.startPoint.y+(this.endPoint.y-this.startPoint.y)*e,n=3*this.beamWidth;t.strokeStyle=G,t.lineWidth=n,t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.lineTo(o,h),t.stroke();const a=Math.min(1,15/i),r=s?this.endPoint.x-(this.endPoint.x-this.startPoint.x)*a:this.endPoint.x,l=s?this.endPoint.y:this.endPoint.y-(this.endPoint.y-this.startPoint.y)*a;t.beginPath(),t.moveTo(r,l),t.lineTo(this.endPoint.x,this.endPoint.y),t.stroke(),this.isWarning&&(t.strokeStyle="#f00",t.lineWidth=3,t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.lineTo(this.endPoint.x,this.endPoint.y),t.stroke()),t.restore();const p=i,c=this.isActive?this.beamProgress:1,d=s?this.startPoint.x+(this.endPoint.x-this.startPoint.x)*c:this.startPoint.x,u=s?this.startPoint.y:this.startPoint.y+(this.endPoint.y-this.startPoint.y)*c,g=Math.max(5,Math.floor(p*c/20));for(let s=0;g>s;s++){const i=s/g,e=(s+1)/g,o=this.startPoint.x+(d-this.startPoint.x)*i,h=this.startPoint.y+(u-this.startPoint.y)*i,n=this.startPoint.x+(d-this.startPoint.x)*e,a=this.startPoint.y+(u-this.startPoint.y)*e,r=3*this.beamWidth;t.strokeStyle="#f00",t.lineWidth=r*this.fadeProgress,t.beginPath(),t.moveTo(o,h),t.lineTo(n,a),t.stroke(),t.strokeStyle="#f44",t.lineWidth=r*this.fadeProgress*.5,t.beginPath(),t.moveTo(o,h),t.lineTo(n,a),t.stroke()}t.restore()}}const wt=[function(){return{playerPos:r(0,-500),goalPos:r(2265,120),background:{positions:[r(-490,-940),r(2810,-940),r(2810,160),r(-490,160)]},objects:[{box:{pos:r(-500,-950),width:3300,height:200}},{box:{pos:r(-500,-750),width:200,height:1100}},{pickup:{pos:r(100,-200)}},{pickup:{pos:r(1100,-200)}},{pickup:{pos:r(2100,-200)}},{box:{pos:r(-500,150),width:3300,height:200}},{box:{pos:r(2600,-750),width:200,height:1100}},{text:{pos:r(0,-200),text:"Tap and hold anywhere"}},{text:{pos:r(2315,230),text:"Goal"}},{ropeContactPoint:{pos:r(300,-500)}},{ropeContactPoint:{pos:r(1e3,-500)}},{ropeContactPoint:{pos:r(1800,-500)}}]}},function(){return{playerPos:r(1650,750),goalPos:r(1e3,1370),background:{positions:[r(760,310),r(4040,310),r(4040,1410),r(760,1410)]},objects:[{box:{pos:r(750,300),width:3300,height:200}},{box:{pos:r(750,500),width:200,height:1100}},{pickup:{pos:r(1350,1050)}},{pickup:{pos:r(2350,1050)}},{pickup:{pos:r(3350,1050)}},{box:{pos:r(750,1400),width:3300,height:200}},{box:{pos:r(3850,500),width:200,height:1100}},{ropeContactPoint:{pos:r(1950,750)}},{ropeContactPoint:{pos:r(3050,750)}}]}},function(){return{playerPos:r(400,-500),goalPos:r(-250,120),background:{positions:[r(-490,-940),r(2790,-940),r(2790,160),r(-490,160)]},objects:[{box:{pos:r(-500,-950),width:3300,height:200}},{box:{pos:r(-500,-750),width:200,height:1100}},{pickup:{pos:r(100,-300)}},{pickup:{pos:r(1100,-200)}},{pickup:{pos:r(1900,-300)}},{shuriken:{pos:r(100,20)}},{shuriken:{pos:r(1100,-450)}},{shuriken:{pos:r(2100,20)}},{box:{pos:r(-500,150),width:3300,height:200}},{box:{pos:r(2600,-750),width:200,height:1100}},{ropeContactPoint:{pos:r(700,-500)}},{ropeContactPoint:{pos:r(1800,-500),radius:40}}]}},function(){return{playerPos:r(-800,0),goalPos:r(1150,-650),background:{positions:[r(-1180,-1980),r(1580,-1980),r(1580,580),r(-1180,580)]},objects:[{box:{pos:r(900,-600),width:550,height:200}},{ropeContactPoint:{pos:r(-300,-150)}},{ropeContactPoint:{pos:r(600,-150)}},{ropeContactPoint:{pos:r(100,-600)}},{ropeContactPoint:{pos:r(-300,-1050)}},{ropeContactPoint:{pos:r(600,-1050)}},{ropeContactPoint:{pos:r(100,-1500)}},{ropeContactPoint:{pos:r(1e3,-1500)}},{pickup:{pos:r(100,-200)}},{pickup:{pos:r(-500,-1500)}},{pickup:{pos:r(500,-900)}},{box:{pos:r(-1200,-2e3),width:2800,height:200}},{box:{pos:r(-1200,-1800),width:200,height:2400}},{box:{pos:r(1400,-2e3),width:200,height:2600}},{box:{pos:r(-1200,400),width:2800,height:368}}]}},function(){return{playerPos:r(400,585),goalPos:r(4248,2685),background:{positions:[r(100,100),r(4696,92),r(4696,2912),r(916,2912),r(908,1424),r(100,1392)]},objects:[{box:{pos:r(0,0),width:200,height:1500}},{shuriken:{pos:r(1148,1382)}},{shuriken:{pos:r(1593,1597)}},{shuriken:{pos:r(2398,2003)}},{pickup:{pos:r(711,892)}},{pickup:{pos:r(2199,809)}},{pickup:{pos:r(3211,1394)}},{ropeContactPoint:{pos:r(2413,1395)}},{ropeContactPoint:{pos:r(1593,795)}},{ropeContactPoint:{pos:r(751,448)}},{ropeContactPoint:{pos:r(3812,1400)}},{shuriken:{pos:r(3816,1812)}},{box:{pos:r(0,1300),width:1e3,height:1700}},{box:{pos:r(200,0),width:4600,height:200}},{box:{pos:r(800,1300),width:200,height:1700}},{box:{pos:r(800,2800),width:4e3,height:200}},{box:{pos:r(4600,0),width:200,height:3e3}}]}},function(){return{playerPos:r(760,604),goalPos:r(1922,2524),background:{positions:[r(264,272),r(2340,260),r(2332,2716),r(272,2720)]},objects:[{box:{pos:r(200,200),width:200,height:2600}},{shuriken:{pos:r(1236,2156)}},{shuriken:{pos:r(1e3,1100)}},{shuriken:{pos:r(1428,1600)}},{pickup:{pos:r(1792,804)}},{pickup:{pos:r(608,1788)}},{pickup:{pos:r(608,2404)}},{box:{pos:r(388,1024),width:528,height:120}},{box:{pos:r(392,2100),width:724,height:120}},{ropeContactPoint:{pos:r(1336,608)}},{ropeContactPoint:{pos:r(1872,1316)}},{ropeContactPoint:{pos:r(1812,2004)}},{ropeContactPoint:{pos:r(924,1624)}},{box:{pos:r(200,2600),width:2100,height:200}},{box:{pos:r(400,200),width:2e3,height:200}},{box:{pos:r(2200,200),width:200,height:2600}}]}},function(){return{playerPos:r(760,1988),goalPos:r(4066,2744),background:{positions:[r(88,164),r(4508,176),r(4496,2920),r(96,2904)]},objects:[{box:{pos:r(0,100),width:200,height:2900}},{shuriken:{pos:r(1128,2488)}},{shuriken:{pos:r(1408,2488)}},{shuriken:{pos:r(1692,2484)}},{shuriken:{pos:r(1956,2488)}},{shuriken:{pos:r(2216,2492)}},{shuriken:{pos:r(2490,2492)}},{shuriken:{pos:r(2712,2496)}},{shuriken:{pos:r(2972,2496)}},{shuriken:{pos:r(3200,2496)}},{shuriken:{pos:r(3412,2488)}},{shuriken:{pos:r(3632,2480)}},{shuriken:{pos:r(3864,2484)}},{ropeContactPoint:{pos:r(1076,1720)}},{shuriken:{pos:r(1280,2660)}},{shuriken:{pos:r(1564,2656)}},{shuriken:{pos:r(3772,2656)}},{shuriken:{pos:r(3524,2660)}},{shuriken:{pos:r(2348,2356)}},{shuriken:{pos:r(2612,2368)}},{shuriken:{pos:r(2092,2360)}},{shuriken:{pos:r(2876,2368)}},{shuriken:{pos:r(2490,2228)}},{shuriken:{pos:r(2216,2240)}},{shuriken:{pos:r(2780,2252)}},{shuriken:{pos:r(2648,2112)}},{shuriken:{pos:r(2336,2116)}},{shuriken:{pos:r(2490,1996)}},{pickup:{pos:r(1304,2008)}},{pickup:{pos:r(2480,1576)}},{pickup:{pos:r(4092,1324)}},{ropeContactPoint:{pos:r(3648,1700)}},{box:{pos:r(200,100),width:4300,height:200}},{box:{pos:r(4400,100),width:200,height:2900}},{box:{pos:r(0,2300),width:900,height:700}},{box:{pos:r(500,2800),width:4100,height:200}}]}},function(){return{playerPos:r(512,964),goalPos:r(3004,1888),background:{positions:[r(264,480),r(1832,484),r(3332,512),r(3352,2356),r(296,2356),r(276,1060)]},objects:[{ropeContactPoint:{pos:r(1012,1004),canActivate:!0}},{ropeContactPoint:{pos:r(1628,1204),canActivate:!0,isActive:!1}},{ropeContactPoint:{pos:r(2208,1388),canActivate:!0}},{ropeContactPoint:{pos:r(2812,1404),canActivate:!0,isActive:!1}},{shuriken:{pos:r(1600,2084)}},{shuriken:{pos:r(2200,2084)}},{shuriken:{pos:r(2804,2076)}},{pickup:{pos:r(1352,1244)}},{pickup:{pos:r(1992,1580)}},{pickup:{pos:r(2584,1660)}},{shuriken:{pos:r(1e3,2080)}},{box:{pos:r(200,400),width:200,height:1600}},{box:{pos:r(3200,400),width:200,height:2e3}},{box:{pos:r(200,1100),width:400,height:1300}},{box:{pos:r(200,1400),width:600,height:1e3}},{box:{pos:r(300,2200),width:3e3,height:200}},{box:{pos:r(400,400),width:3e3,height:200}},{box:{pos:r(2950,2e3),width:450,height:400}}]}},function(){return{playerPos:r(872,1624),goalPos:r(3804,1376),background:{positions:[r(392,300),r(4484,336),r(4512,2896),r(436,2900)]},objects:[{box:{pos:r(1668,884),width:200,height:200}},{box:{pos:r(2544,920),width:200,height:200}},{box:{pos:r(1724,1744),width:200,height:200}},{box:{pos:r(2796,1772),width:200,height:200}},{shuriken:{pos:r(2308,1408)}},{pickup:{pos:r(2260,944)}},{pickup:{pos:r(2416,2288)}},{pickup:{pos:r(1204,1408)}},{ropeContactPoint:{pos:r(1204,1004)}},{ropeContactPoint:{pos:r(3220,1004)}},{ropeContactPoint:{pos:r(1812,2212)}},{ropeContactPoint:{pos:r(3624,2216)}},{box:{pos:r(3764,1460),width:200,height:200}},{box:{pos:r(300,200),width:4300,height:200}},{box:{pos:r(760,1868),width:200,height:200}},{ropeContactPoint:{pos:r(2308,592)}},{box:{pos:r(300,400),width:200,height:2600}},{box:{pos:r(300,2800),width:4200,height:200}},{box:{pos:r(4400,200),width:200,height:2800}}]}},function(){return{playerPos:r(1008,936),goalPos:r(1982,636),background:{positions:[r(264,272),r(2340,260),r(2332,2716),r(272,2720)]},objects:[{box:{pos:r(263,1580),width:200,height:876,canBounce:!0}},{shuriken:{pos:r(1992,2340)}},{shuriken:{pos:r(608,1480)}},{shuriken:{pos:r(612,1036)}},{pickup:{pos:r(1720,564)}},{pickup:{pos:r(1412,2028)}},{pickup:{pos:r(608,2404)}},{ropeContactPoint:{pos:r(1792,1204),endPos:r(1792,1204)}},{ropeContactPoint:{pos:r(1344,796),endPos:r(1344,796)}},{ropeContactPoint:{pos:r(784,1932),endPos:r(784,1932)}},{ropeContactPoint:{pos:r(1991.4375,1792),endPos:r(1991.4375,1792)}},{ropeContactPoint:{pos:r(1343,1524),endPos:r(1343,1524)}},{box:{pos:r(200,200),width:200,height:2600}},{box:{pos:r(2147,1408),width:200,height:944,canBounce:!0}},{box:{pos:r(915,1160),width:200,height:200,canBounce:!0}},{box:{pos:r(1831,756),width:420,height:200}},{box:{pos:r(915,1828),width:200,height:200,canBounce:!0}},{box:{pos:r(1072,2396),width:724,height:120,canBounce:!0}},{box:{pos:r(400,2600),width:1800,height:200,canBounce:!0}},{box:{pos:r(400,200),width:2e3,height:200}},{box:{pos:r(2200,200),width:200,height:2600}}]}},function(){return{playerPos:r(496,1612),goalPos:r(1982,636),background:{positions:[r(264,272),r(2732,260),r(2708,2716),r(272,2720)]},objects:[{box:{pos:r(200,200),width:200,height:2600}},{shuriken:{pos:r(996,1528)}},{shuriken:{pos:r(472,476)}},{shuriken:{pos:r(2436,880)}},{pickup:{pos:r(1620,740)}},{pickup:{pos:r(964,736)}},{pickup:{pos:r(608,2404)}},{ropeContactPoint:{pos:r(1276,536)}},{ropeContactPoint:{pos:r(1824,1176),endPos:r(1824,1176)}},{ropeContactPoint:{pos:r(1812,2004),endPos:r(1812,1604)}},{ropeContactPoint:{pos:r(796,1896),endPos:r(1396,1896)}},{ropeContactPoint:{pos:r(800,1196),endPos:r(1299,796)}},{ropeContactPoint:{pos:r(2171,1732),endPos:r(2171,1732)}},{ropeContactPoint:{pos:r(1307.4375,1348),endPos:r(1307.4375,1348)}},{box:{pos:r(1831,756),width:420,height:200}},{box:{pos:r(400,1800),width:200,height:200}},{box:{pos:r(400,2176),width:1285,height:120}},{box:{pos:r(400,2600),width:2235,height:200}},{box:{pos:r(400,200),width:2400,height:200}},{box:{pos:r(2600,200),width:200,height:2600}}]}},function(){return{playerPos:r(316,464),goalPos:r(3604,2912),background:{positions:[r(100,100),r(4244,100),r(4128,3160),r(100,3084)]},objects:[{box:{pos:r(92,700),width:308,height:548,canBounce:!0}},{shuriken:{pos:r(500,1044)}},{shuriken:{pos:r(708,1248)}},{shuriken:{pos:r(1104,1492)}},{shuriken:{pos:r(1528,1864)}},{shuriken:{pos:r(1896,2076)}},{shuriken:{pos:r(2136,2268)}},{shuriken:{pos:r(2344,2464)}},{shuriken:{pos:r(2712,2676)}},{shuriken:{pos:r(2968,2892)}},{ropeContactPoint:{pos:r(732,464),endPos:r(732,464),canActivate:!0}},{ropeContactPoint:{pos:r(1288,700),endPos:r(1288,700),canActivate:!0,isActive:!1}},{ropeContactPoint:{pos:r(1916,1116),endPos:r(1916,1116),canActivate:!0}},{ropeContactPoint:{pos:r(2512,1500),endPos:r(2512,1500),canActivate:!0,isActive:!1}},{ropeContactPoint:{pos:r(2912,1868),endPos:r(2912,1868),canActivate:!0,isActive:!1}},{ropeContactPoint:{pos:r(3476,2180),endPos:r(3476,2180),canActivate:!0}},{pickup:{pos:r(952,968)}},{pickup:{pos:r(1772,1652)}},{pickup:{pos:r(2516,2308)}},{box:{pos:r(0,0),width:200,height:1300}},{box:{pos:r(0,1200),width:580,height:300}},{box:{pos:r(0,1404),width:800,height:200}},{box:{pos:r(0,1600),width:1200,height:1424}},{box:{pos:r(1200,1816),width:200,height:200}},{box:{pos:r(1188,2e3),width:408,height:258}},{box:{pos:r(1192,2188),width:784,height:898}},{box:{pos:r(1928,2408),width:256,height:600}},{box:{pos:r(200,0),width:3892,height:300}},{box:{pos:r(1008,286),width:2836,height:262}},{box:{pos:r(1800,508),width:2020,height:276}},{box:{pos:r(2e3,768),width:1880,height:260}},{box:{pos:r(2596,1004),width:1256,height:196}},{box:{pos:r(2776,1176),width:1048,height:212}},{box:{pos:r(2156,2600),width:260,height:248}},{box:{pos:r(2160,2812),width:632,height:200}},{box:{pos:r(0,3e3),width:3952,height:200}},{box:{pos:r(2956,1384),width:1020,height:200}},{box:{pos:r(3420,1526),width:488,height:258}},{box:{pos:r(3532,1734),width:520,height:254}},{box:{pos:r(3816,0),width:788,height:3200}}]}},function(){return{playerPos:r(3472,2820),goalPos:r(232,624),background:{positions:[r(100,100),r(4244,100),r(4128,3160),r(100,3084)]},objects:[{shuriken:{pos:r(500,1044)}},{shuriken:{pos:r(732,1436)}},{shuriken:{pos:r(1668,668)}},{shuriken:{pos:r(1348,2040)}},{shuriken:{pos:r(2220,1368)}},{shuriken:{pos:r(2468,2660)}},{shuriken:{pos:r(3284,1728)}},{ropeContactPoint:{pos:r(796,448),endPos:r(796,448)}},{ropeContactPoint:{pos:r(1260,912),endPos:r(1260,912)}},{ropeContactPoint:{pos:r(1912,1196),endPos:r(1912,1196)}},{ropeContactPoint:{pos:r(2512,1500),endPos:r(2512,1500)}},{ropeContactPoint:{pos:r(3476,2180),endPos:r(3476,2180)}},{pickup:{pos:r(1140,1156)}},{pickup:{pos:r(1772,1652)}},{pickup:{pos:r(3088,2796)}},{box:{pos:r(0,0),width:200,height:1300}},{box:{pos:r(92,700),width:308,height:548}},{box:{pos:r(0,1196),width:580,height:810}},{box:{pos:r(0,1600),width:1200,height:1424}},{box:{pos:r(1192,2188),width:784,height:898}},{box:{pos:r(200,0),width:3892,height:300}},{box:{pos:r(1008,286),width:2836,height:262}},{box:{pos:r(1800,508),width:2020,height:276}},{box:{pos:r(2e3,764),width:1880,height:416}},{box:{pos:r(2772,1176),width:1048,height:376}},{box:{pos:r(2160,2812),width:632,height:200}},{box:{pos:r(0,3e3),width:3952,height:200}},{box:{pos:r(3420,1526),width:488,height:258}},{box:{pos:r(3532,1734),width:520,height:254}},{box:{pos:r(3816,0),width:788,height:3200}}]}},function(){return{playerPos:r(876,2728),goalPos:r(3e3,2888),background:{positions:[r(100,100),r(4244,100),r(4336,3056),r(100,3084)]},objects:[{box:{pos:r(1212,632),width:200,height:2460,canBounce:!0}},{pickup:{pos:r(1324,400)}},{pickup:{pos:r(1896,2680)}},{pickup:{pos:r(3492,780)}},{ropeContactPoint:{pos:r(484,2052),endPos:r(484,2052)}},{ropeContactPoint:{pos:r(1040,1324),endPos:r(1040,1324)}},{ropeContactPoint:{pos:r(604,608),endPos:r(604,608)}},{ropeContactPoint:{pos:r(2208,2320),endPos:r(2208,2320)}},{ropeContactPoint:{pos:r(1652,1600),endPos:r(1652,1600)}},{ropeContactPoint:{pos:r(1932,716),endPos:r(1932,716)}},{ropeContactPoint:{pos:r(3820,420),endPos:r(3820,420)}},{ropeContactPoint:{pos:r(2984,1280),endPos:r(2984,1280)}},{ropeContactPoint:{pos:r(3812,2084),endPos:r(3812,2084)}},{shuriken:{pos:r(3856,2816)}},{shuriken:{pos:r(2872,364)}},{shuriken:{pos:r(2252,328)}},{shuriken:{pos:r(376,352)}},{box:{pos:r(2450,200),width:200,height:700,canBounce:!0}},{box:{pos:r(2450,1300),width:200,height:1700,canBounce:!0}},{box:{pos:r(200,0),width:3800,height:200,canBounce:!0}},{box:{pos:r(200,3e3),width:3800,height:200,canBounce:!0}},{box:{pos:r(0,0),width:200,height:3200,canBounce:!0}},{box:{pos:r(4e3,0),width:400,height:3200,canBounce:!0}}]}},function(){return{playerPos:r(1106,842),goalPos:r(4424,738),background:{positions:[r(788,102),r(4700,112),r(4708,2442),r(824,2442)]},objects:[{box:{pos:r(3496,796),width:1156,height:200}},{pickup:{pos:r(2842,334)}},{pickup:{pos:r(2318,2162)}},{pickup:{pos:r(4258,1202)}},{ropeContactPoint:{pos:r(1638,718),endPos:r(1638,718)}},{ropeContactPoint:{pos:r(3014,606),endPos:r(3014,606)}},{laser:{startPoint:r(1400,510),endPoint:r(1400,1400)}},{laser:{startPoint:r(2800,1800),endPoint:r(1700,1800)}},{laser:{startPoint:r(3600,1010),endPoint:r(3600,1400)}},{ropeContactPoint:{pos:r(2256,1204),endPos:r(2256,1204)}},{ropeContactPoint:{pos:r(4052,420),endPos:r(4052,420)}},{box:{pos:r(1e3,1200),width:200,height:200,canBounce:!0}},{box:{pos:r(700,0),width:1900,height:500}},{box:{pos:r(2600,0),width:2200,height:200}},{box:{pos:r(700,500),width:200,height:1100}},{box:{pos:r(700,1400),width:1e3,height:1800}},{box:{pos:r(1616,2400),width:1236,height:800}},{box:{pos:r(4600,0),width:200,height:3200}},{box:{pos:r(2800,1400),width:2e3,height:1800}}]}},function(){return{playerPos:r(760,604),goalPos:r(310,2028),background:{positions:[r(76,100),r(2336,104),r(2332,2716),r(76,2736)]},objects:[{pickup:{pos:r(1524,932)}},{pickup:{pos:r(364,864)}},{pickup:{pos:r(596,2404)}},{ropeContactPoint:{pos:r(1032,464),endPos:r(1032,464)}},{ropeContactPoint:{pos:r(1968,640),endPos:r(1968,640)}},{ropeContactPoint:{pos:r(1604,1600),endPos:r(1604,1600)}},{ropeContactPoint:{pos:r(604,1576),endPos:r(604,1576)}},{laser:{startPoint:r(1110,2150),endPoint:r(2200,2150)}},{laser:{startPoint:r(932,1100),endPoint:r(2200,1100)}},{laser:{startPoint:r(600,2100),endPoint:r(600,210)}},{box:{pos:r(96,2600),width:2204,height:200}},{box:{pos:r(0,0),width:200,height:2800}},{box:{pos:r(200,1044),width:720,height:120,canBounce:!0}},{box:{pos:r(200,2100),width:900,height:120,canBounce:!0}},{box:{pos:r(200,0),width:2200,height:200}},{box:{pos:r(2200,68),width:200,height:2732}}]}},function(){return{playerPos:r(1540,1984),goalPos:r(-9999,-9999),background:{positions:[r(100,100),r(4680,136),r(4688,3076),r(120,3088)]},objects:[{box:{pos:r(50,0),width:4550,height:200}},{box:{pos:r(4600,0),width:200,height:3e3}},{box:{pos:r(50,200),width:200,height:2800}},{box:{pos:r(724,2600),width:2200,height:400,canBounce:!0}},{box:{pos:r(50,3e3),width:4750,height:200}},{shuriken:{pos:r(1808,1200)}},{box:{pos:r(3136,920),width:200,height:200,canBounce:!0}},{ropeContactPoint:{pos:r(1016,604),endPos:r(1016,604)}},{ropeContactPoint:{pos:r(2588,1812),endPos:r(2588,1812)}},{ropeContactPoint:{pos:r(2764,944),endPos:r(2764,944)}},{ropeContactPoint:{pos:r(2164,456),endPos:r(2164,456)}},{ropeContactPoint:{pos:r(716,1644),endPos:r(716,1644)}},{ropeContactPoint:{canActivate:!0,isActive:!1,pos:r(3832,2196),endPos:r(3832,2196)}},{box:{pos:r(3752,2532),width:200,height:200,canBounce:!0}},{ropeContactPoint:{pos:r(3984,1228),endPos:r(2984,1228)}},{text:{pos:r(1500,2e3),text:"Thanks for playing!"}}]}}];class Ct{constructor(t,s){D(this,"type",I.Ball),D(this,"pos",r(0,0)),D(this,"velocity",r(0,0)),D(this,"radius",15),D(this,"gravity",.3),D(this,"shadowColor"),this.color=s,this.pos=t||r(0,0),this.shadowColor=G;const i=10*(Math.random()-.5),e=10*(Math.random()-.5);this.velocity=r(i,e)}update(){this.velocity=this.velocity.add(r(0,this.gravity)),this.pos=this.pos.add(this.velocity)}render(t){t.fillStyle=this.shadowColor,t.beginPath(),t.arc(this.pos.x+3,this.pos.y+3,this.radius,0,2*Math.PI),t.fill(),t.fillStyle=this.color,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.fill()}}const{canvas:kt}=h("g"),{canvas:mt}=h("t"),St=kt.getContext("2d"),Tt=mt.getContext("2d"),Mt=new class{constructor(t){D(this,"type",I.MainMenu),D(this,"pos",r(0,0)),D(this,"width",1e3),D(this,"height",800),D(this,"radius",0),D(this,"state","v"),D(this,"canvas"),D(this,"scrollOffset",0),D(this,"targetScrollOffset",0),D(this,"scrollSpeed",.15),D(this,"maxVisibleButtons",5),D(this,"buttonHeight",120),D(this,"buttonSpacing",60),D(this,"totalLevels",0),D(this,"scrollAreaTop",380),D(this,"scrollAreaHeight",0),D(this,"scrollButtonHeight",40),D(this,"scrollButtonWidth",100),D(this,"isDragging",!1),D(this,"lastMouseY",0),D(this,"offscreenCanvas",null),D(this,"offscreenCtx",null),D(this,"buttonPickups",[]),D(this,"pressedLevelButton",null),D(this,"pressedScrollButton",null),D(this,"isMouseDown",!1),this.canvas=t,this.totalLevels=wt.length,this.updatePosition(),this.createOffscreenCanvas()}updatePosition(){var t;this.pos=r((this.canvas.width-.8*(null==(t=this.canvas)?void 0:t.width))/2,0),this.scrollAreaHeight=this.maxVisibleButtons*this.buttonHeight+(this.maxVisibleButtons-1)*this.buttonSpacing}createOffscreenCanvas(){const t=this.totalLevels*this.buttonHeight+(this.totalLevels-1)*this.buttonSpacing;this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=412,this.offscreenCanvas.height=t+12,this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.renderAllButtonsToOffscreen()}renderAllButtonsToOffscreen(){if(!this.offscreenCtx||!this.offscreenCanvas)return;const t=this.offscreenCtx;t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);for(let s=0;s<this.totalLevels;s++){const i=s+1,e=s*(this.buttonHeight+this.buttonSpacing),o=0,h=m("c-"+i),n=!!h,a=h?parseInt(h,10):0,r=this.isLevelPlayable(i),l=this.isMouseDown&&this.pressedLevelButton==i?12:0;t.fillStyle=G,t.fillRect(o+12,e+12,400,this.buttonHeight),t.fillStyle=n||r?N:U,t.fillRect(o+l,e+l,400,this.buttonHeight),t.fillStyle=F,t.font=`${Math.min(.6*this.buttonHeight,48)}px ${_}`;const p=i.toString().padStart(3,"0");t.fillText(p,o+20+l,e+this.buttonHeight/2+20+l),this.createPickupsForLevel(i,o,e,a,l),this.renderPickupsOnButton(t,i-1,l)}}createPickupsForLevel(t,s,i,e,o=0){const h=s+200+o,n=i+this.buttonHeight/2-15+o,a=t-1;this.buttonPickups[a]=[];const l=[];for(let t=0;3>t;t++){const s=e>t?F:V,i=new xt(r(h+60*t-64,n-64),s);i.setScale(.7),l.push(i)}this.buttonPickups[a]=l}renderPickupsOnButton(t,s,i=0){const e=this.buttonPickups[s];if(e)for(const s of e){t.save();const e=s.pos.x+i,o=s.pos.y+i;s.pos.x=e,s.pos.y=o,s.render(t),s.pos.x=e-i,s.pos.y=o-i,t.restore()}}getVisibleLevels(){const t=this.totalLevels*this.buttonHeight+(this.totalLevels-1)*this.buttonSpacing,s=Math.max(0,t-this.scrollAreaHeight);this.scrollOffset=Math.max(0,Math.min(this.scrollOffset,s));const i=this.buttonHeight+this.buttonSpacing,e=Math.floor(this.scrollOffset/i),o=Math.min(this.totalLevels-1,Math.ceil((this.scrollOffset+this.scrollAreaHeight)/i)),h=[];for(let t=e;o>=t;t++)t>=0&&t<this.totalLevels&&h.push({levelId:t+1,index:t,yOffset:t*i-this.scrollOffset});return h}getMaxScrollOffset(){const t=this.totalLevels*this.buttonHeight+(this.totalLevels-1)*this.buttonSpacing;return Math.max(0,t+12-this.scrollAreaHeight)}handleScroll(t){this.targetScrollOffset+=t;const s=this.getMaxScrollOffset();this.targetScrollOffset=Math.max(0,Math.min(this.targetScrollOffset,s))}handleDragStart(t){this.isDragging=!0,this.lastMouseY=t}handleDragMove(t){if(this.isDragging){const s=this.lastMouseY-t;this.targetScrollOffset+=s;const i=this.getMaxScrollOffset();this.targetScrollOffset=Math.max(0,Math.min(this.targetScrollOffset,i)),this.scrollOffset=this.targetScrollOffset,this.lastMouseY=t}}handleDragEnd(){this.isDragging=!1}isPointInScrollArea(t,s){if(!this.canvas)return!1;const i=this.canvas.width/2-200,e=i+400,o=this.scrollAreaTop+this.scrollAreaHeight;return!(i>t||t>e||s<this.scrollAreaTop||s>o)}isPointInMainMenu(t,s){if(!this.canvas)return!1;const i=.8*this.canvas.width,e=this.pos.x,o=e+i,h=this.pos.y,n=h+this.canvas.height;return!(e>t||t>o||h>s||s>n)}isPointInLevelButton(t,s){if(!this.canvas)return null;const i=this.canvas.width/2-200;if(i>t||t>i+400||s<this.scrollAreaTop||s>this.scrollAreaTop+this.scrollAreaHeight)return null;const e=s-this.scrollAreaTop+this.scrollOffset,o=this.buttonHeight+this.buttonSpacing,h=Math.floor(e/o),n=h*o,a=n+this.buttonHeight;return 0>h||h>=this.totalLevels||n>e||e>a?null:h+1}isLevelPlayable(t){if(1==t)return!0;let s=0;for(let i=1;t>i;i++)m("c-"+i)&&(s=i);return s+1>=t}handleClick(t,s){const i=this.isPointInScrollButton(t,s);if(i)return"u"==i?this.handleScroll(-750):"d"==i&&this.handleScroll(750),!0;const o=this.isPointInLevelButton(t,s);return null!=o&&(this.isLevelPlayable(o)?(c(),e(L.play,{levelId:o}),!0):(tt(...[.2,,276,,.09,.06,,2.4,-8,,350,.08,,,,,,.88,.02]),!1))}handleMouseDown(t,s){const i=this.isPointInScrollButton(t,s);if(i)return this.startPress("s",i),!0;const e=this.isPointInLevelButton(t,s);return null!=e&&(this.startPress("l",e),!0)}handleMouseUp(){this.endPress()}isPointInScrollButton(t,s){if(!this.canvas)return null;const i=this.canvas.width/2;if(i-35>t||t>i+35)return null;const e=this.scrollAreaTop-this.scrollButtonHeight-60+this.scrollButtonHeight/2;if(s>=e-35&&e+35>=s)return"u";const o=this.scrollAreaTop+this.scrollAreaHeight+60+this.scrollButtonHeight/2;return o-35>s||s>o+35?null:"d"}startPress(t,s){this.isMouseDown=!0,"l"==t?this.pressedLevelButton=s:this.pressedScrollButton=s,this.renderAllButtonsToOffscreen()}endPress(){this.isMouseDown=!1,this.pressedLevelButton=null,this.pressedScrollButton=null,this.renderAllButtonsToOffscreen()}update(){const t=this.targetScrollOffset-this.scrollOffset;Math.abs(t)>.5?this.scrollOffset+=t*this.scrollSpeed:this.scrollOffset=this.targetScrollOffset}refreshButtons(){this.buttonPickups=[],this.renderAllButtonsToOffscreen()}render(t){var s,i;this.updatePosition(),t.save(),t.setTransform(1,0,0,1,0,0),t.fillStyle=j,t.fillRect(this.pos.x,this.pos.y,.8*(null==(s=this.canvas)?void 0:s.width),null==(i=this.canvas)?void 0:i.height),this.drawTitle(t),this.drawLevelList(t),this.drawScrollButtons(t),t.restore()}drawLevelList(t){if(!this.canvas||!this.offscreenCanvas)return;const s=this.canvas.width/2-200;t.save(),t.beginPath(),t.rect(s,this.scrollAreaTop,412,this.scrollAreaHeight),t.drawImage(this.offscreenCanvas,0,this.scrollOffset,412,this.scrollAreaHeight,s,this.scrollAreaTop,412,this.scrollAreaHeight),t.restore()}drawTitle(t){if(!this.canvas)return;const s=this.canvas.width/2-550,i="148px "+_,e="Triska the Ninja Cat";t.fillStyle=G,t.font=i,t.fillText(e,s+16,236),t.fillStyle=N,t.font=i,t.fillText(e,s,220)}drawTriangle(t,s,i,e,o,h){t.save(),t.translate(s,i),t.rotate(o),t.fillStyle=h,t.beginPath(),t.moveTo(0,.5*-e),t.lineTo(-e,e),t.lineTo(e,e),t.closePath(),t.fill(),t.restore()}drawScrollButtons(t){if(!this.canvas)return;const s=this.canvas.width/2,i=10,e=this.getMaxScrollOffset(),o=this.scrollOffset>0,h=this.scrollOffset<e,n=this.scrollAreaTop-this.scrollButtonHeight-60+this.scrollButtonHeight/2;this.drawTriangle(t,s+i,n+i,50,0,G);const a=this.isMouseDown&&"u"==this.pressedScrollButton?i:0,r=this.isMouseDown&&"u"==this.pressedScrollButton?i:0;this.drawTriangle(t,s+a,n+r,50,0,o?N:U);const l=this.scrollAreaTop+this.scrollAreaHeight+60+this.scrollButtonHeight/2;this.drawTriangle(t,s+i,l+i,50,Math.PI,G);const p=this.isMouseDown&&"d"==this.pressedScrollButton?i:0,c=this.isMouseDown&&"d"==this.pressedScrollButton?i:0;this.drawTriangle(t,s+p,l+c,50,Math.PI,h?N:U)}}(kt);let Bt="s",At="s";const Lt=new class{constructor(t){D(this,"targetY",-10),D(this,"lerpFactor",.15),D(this,"pos",r(0,0)),D(this,"state","i"),this.canvas=t,this.pos.y=t.height}update(){this.pos.y-10<this.targetY?this.pos.y=t(this.pos.y,this.targetY-this.canvas.height,this.lerpFactor):this.pos.y=t(this.pos.y,this.targetY,this.lerpFactor),this.handleState()}handleState(){"i"==this.state&&this.isFadeInComplete()?this.state="o":"o"==this.state&&this.isFadeOutComplete()&&(this.state="c")}render(t){const{width:s,height:i}=this.canvas;t.save(),t.clearRect(0,0,s,i),t.fillStyle=G,t.fillRect(0,this.pos.y,s,i),t.restore()}isFadeInComplete(){return this.pos.y<=this.targetY}isFadeOutComplete(){return this.pos.y-2<=this.targetY-this.canvas.height}reset(){this.state="i",this.pos.y=this.canvas.height}}(mt);let It,Ot,Dt,Ht=[],Rt=1,Et=!1,Yt=!1;const Wt=[];let Xt=!1,zt=null,jt=null;class Ft{constructor(t){if(D(this,"positions",[]),D(this,"buildings",[]),D(this,"levelCenterX",0),D(this,"lastPlayerX",0),D(this,"cachedParallaxOffset",0),this.positions=t,this.generateBuildings(),this.positions&&this.positions.length>0){const t=Math.min(...this.positions.map(t=>t.x)),s=Math.max(...this.positions.map(t=>t.x));this.levelCenterX=(t+s)/2}}generateBuildings(){if(!this.positions||0===this.positions.length)return;const t=Math.min(...this.positions.map(t=>t.x)),s=Math.max(...this.positions.map(t=>t.x)),i=Math.min(...this.positions.map(t=>t.y)),e=Math.max(...this.positions.map(t=>t.y)),o=e+50,h=.5*(e-i);this.buildings=[];let n=t;for(;s>n;){const t=100+250*Math.random(),s=55*Math.random()-20,i=h*(.3+.7*Math.random()),e=o-i,a=[],r=12,l=30;for(let s=e+20;o-20>s;s+=l)for(let i=n+20;n+t-20>i;i+=l)Math.random()>.4&&a.push({x:i,y:s,size:r});this.buildings.push({x:n,top:e,width:t,height:i,windows:a}),n+=t+s}}render(t,s){this.positions&&0!==this.positions.length&&0!==this.buildings.length&&(s&&Math.abs(s.x-this.lastPlayerX)>5&&(this.cachedParallaxOffset=-.025*(s.x-this.levelCenterX),this.lastPlayerX=s.x),this.renderCachedBuildings(t,this.cachedParallaxOffset))}renderCachedBuildings(t,s=0){t.fillStyle=J;for(let i=1;i<this.buildings.length-1;i++){const e=this.buildings[i];t.fillRect(e.x+s,e.top,e.width,e.height),t.fillStyle=q;for(const i of e.windows)t.fillRect(i.x+s,i.y,i.size,i.size);t.fillStyle=J}}}const Gt=[],Vt=[];let qt=null;s(L.play,({levelId:t})=>{Rt=t,At="l",Lt.reset(),Ut.start()}),s(L.kill,()=>{It&&"a"==It.state&&(It.setState("d"),function(){if(It){const t=[N,G,F];tt(...[.2,,480,.01,.08,.16,,3.1,-8,24,447,.08,.06,,,,,.52,.02]);for(let s=0;10>s;s++){const i=t[Math.floor(Math.random()*t.length)],e=new Ct(r(It.pos.x,It.pos.y),i),o=s/10*Math.PI*2+.5*(Math.random()-.5),h=8+6*Math.random();e.velocity=r(Math.cos(o)*h,Math.sin(o)*h-3),Wt.push(e)}}setTimeout(()=>{Ht.length=0,Nt.stop(),B("l",Rt)},750)}())}),s(L.goal,()=>{Yt||(Yt=!0,At="l",Lt.reset(),Ut.start(),function(){c(),Wt.length=0;const t=Ht.filter(t=>t.type==I.Pickup);let s=0;t.forEach(t=>{t.collected&&s++});const i=m("c-"+Rt);s>(i?parseInt(i,10):0)&&function(t,s){try{localStorage.setItem(dt+t,s)}catch(t){}}("c-"+Rt,""+s),Rt++,Lt.reset(),Ut.start()}())}),s(L.up,({x:t,y:s})=>{"s"==Bt&&(Mt.handleClick(t,s),Mt.handleDragEnd(),Mt.handleMouseUp())}),s(L.down,({x:t,y:s})=>{"s"==Bt&&(Mt.handleMouseDown(t,s),Mt.isPointInMainMenu(t,s)&&Mt.handleDragStart(s))}),s(L.drag,({detail:t})=>{"s"==Bt&&Mt.isDragging&&Mt.handleDragMove(t.diffY+Mt.lastMouseY)}),s(L.wheel,({deltaY:t,x:s,y:i})=>{"s"==Bt&&Mt.isPointInMainMenu(s,i)&&Mt.handleScroll(t)});const Nt=a({blur:!0,update:function(){if("s"==Bt)Mt.update(),Vt.forEach(t=>t.update());else{Ht.forEach(t=>t.update()),Wt.forEach(t=>t.update()),null==Dt||Dt.follow(It);const t=Ht.concat(Wt);!function(t,s){for(const i of s)i!=t&&T(t.pos.add(r(-t.radius,t.radius)),t.radius,i.pos||r(0,0),i.width,i.height)&&(i.type==I.Platform||i.type==I.Ball?M(t,i):i.type==I.Pickup?i.collect():i.type==I.Shuriken?e(L.kill):i.type==I.Goal?e(L.goal):i.type==I.Laser&&i.isActive&&e(L.kill))}(It,t),function(t){for(const s of t)s.type==I.Ball&&t.forEach(t=>{const i=s;i!=t&&T(i.pos.add(r(-i.radius,i.radius)),i.radius,t.pos||r(0,0),t.width,t.height)&&t.type==I.Platform&&M(i,t)})}(t),function(){if(!It)return;const t=A(It.pos);t&&qt!==t&&(null==qt||qt.setHighlight(!1),t.setHighlight(!0),qt=t)}()}},render:function(){Dt.clear(St),Dt.apply(St),"s"==Bt?(Mt.render(St),Vt.forEach(t=>t.render(St))):(function(t){if(zt&&zt.positions){t.save();const s=zt.positions;t.fillStyle=q,t.beginPath(),t.moveTo(s[0].x,s[0].y);for(let i=1;i<s.length;i++)t.lineTo(s[i].x,s[i].y);t.closePath(),t.fill(),t.restore()}jt&&It&&jt.render(t,{x:It.pos.x,y:It.pos.y})}(St),Wt.forEach(t=>t.render(St)),Ht.forEach(t=>t.render(St)))}}),Ut=a({blur:!0,update:function(){null==Lt||Lt.update(),!Xt&&Lt.isFadeInComplete()?(Xt=!0,"s"==At?(Bt="s",Mt.refreshButtons(),Gt.forEach(t=>{t&&t.destroy&&t.destroy()}),Gt.length=0):"l"==At&&(Bt="l",B("l",Rt),Vt.forEach(t=>{(null==t?void 0:t.destroy)&&t.destroy()}))):Lt.isFadeOutComplete()&&(Xt=!1,Yt=!1,null==Lt||Lt.reset(),Ut.stop())},render:function(){null==Lt||Lt.render(Tt)}});Bt="s",p([mt,kt],[]),u(kt),Dt=new z(kt),Nt.start(),Et=!0</script>