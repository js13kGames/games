<!doctype html><title>Eat My Dust!</title><style>body,html{margin:0;padding:0;font-family:monospace}canvas{background:#5ebfff}#g-bg{top:270px;height:270px;background:#936c3e}#g,#g-bg{position:absolute;width:960px;left:0}#g{height:54px;top:0;background:url(images/g.png) repeat-x}#d-d{left:30px;text-shadow:1px 1px 1px #936c3e}#d-d,#d-e{display:none;position:absolute;color:#fff;top:24px;font-size:18px}#d-e{left:720px}#d-e span{text-shadow:1px 1px 1px #936c3e}#d-e span,#ef{display:inline-block;height:20px;vertical-align:middle}#ef{border:1px solid #fff;width:120px;background:rgba(0,0,0,.3)}.eb{position:absolute;height:20px;background:linear-gradient(90deg,rgba(151,226,30,.8),#e3ca29 47%,#ff8600)}.eb.e{transition:all 1s ease-in}.eb.e.d{height:20px;animation:drop 1s ease-in}#d-t{display:none;position:absolute;margin:10px 30px;padding:15px 30px;top:340px;left:0;width:900px;height:130px;box-sizing:border-box;background:rgba(0,0,0,.6);border-radius:10px}#t{color:#fff}#st,#t{font-size:32px}#st{color:#888c90;margin-top:10px}.correct{color:#90ee90}.cursor{color:#ff0;text-decoration:underline;white-space:pre}.cursor.w{animation:blink-once .5s}#d-l{top:0;left:0;width:960px;height:270px}#d-l,div.name{display:none;position:absolute}div.name{color:#fff;text-shadow:1px 1px 1px #936c3e;z-index:1;font-size:22px;top:112px}div.name.bot{text-indent:-10px;font-size:18px}div.arrow{width:15px;height:9px;background:url(images/a.png);background-size:cover;transform-origin:50% -20px;top:144px}#d-tt,div.arrow{display:none;position:absolute}#d-tt{top:150px;left:470px}.title{width:400px}#d-c{display:none;top:420px;left:50px;width:860px;color:#fff}#d-c,.dev{position:absolute}.dev{left:0}.art{position:absolute;right:0}.art div,.dev div{font-size:24px;font-weight:700}.art li,.dev li{list-style:none;font-size:20px;text-align:right}#d-m{top:340px;font-size:30px;text-align:center}#d-m,#d-sp{display:none;position:absolute;left:50px;width:860px;color:#fff}#d-sp{top:50px;height:440px;background:grey;border-radius:14px;padding:15px 20px;box-sizing:border-box}#d-sp div{font-size:24px}#d-sp div.desc{text-align:center}#sl{background:#525252;height:330px;overflow-y:auto;margin:10px 0;padding:0;border-radius:14px}#sl li{white-space:nowrap;word-break:break-all;text-overflow:ellipsis;font-size:24px;list-style:none;padding:13px 20px 8px;margin:0;box-sizing:border-box;border-bottom:1px solid #656565}#sl li.s{background:#04b440}#d-pm{display:none;top:130px;left:270px;font-size:20px}#d-pm,.e.p{position:absolute;color:#fff}.e.p{font-size:16px;top:3px;letter-spacing:-1px;animation:fadeUp 1s ease-in}#d-r{top:150px;left:470px;font-size:40px}#d-gm,#d-r{display:none;position:absolute;color:#fff}#d-gm{top:500px;left:690px;font-size:22px}.wind{position:absolute;width:500px;height:6px;background:#fff;top:-100px;transition:1s ease-in}.wind.m{transform:translateX(-1500px)}.blink{animation:blinker 1s step-start infinite}@keyframes blinker{50%{opacity:0}}@keyframes blink-once{0%{background-color:transparent}10%{background-color:#cd5c5c}to{background-color:transparent}}@keyframes drop{0%{transform:translateY(0) rotate(0);opacity:1}5%{transform:translateY(2px) rotate(0);opacity:1}10%{transform:translateY(1px) rotate(0);opacity:1}to{transform:translateY(20px) rotate(10deg);opacity:0}}@keyframes fadeUp{to{transform:translateY(-10px);opacity:0}}</style><canvas width=960 height=540></canvas><div id=g-bg><div id=g></div></div><div id=d-d><span>Distance</span> <span id=d>0</span></div><div id=d-e><span>Energy</span>Â <div id=ef><div class=eb></div></div></div><div id=d-t><div id=t></div><div id=st></div></div><div id=d-l></div><div id=d-tt><img class=title src=images/t.png></div><div id=d-c><div class=dev><div>Developed by</div><ul><li>Junsik Shim<li>Juhyun Choi</ul></div><div class=art><div>Artworks by</div><ul><li>wabie</ul></div></div><div id=d-m class=blink>Press Space to start!</div><div id=d-sp><div>Select a story</div><ul id=sl></ul><div class=desc>Up/Down arrows to choose, Enter to select</div></div><div id=d-pm>Type to start!</div><div id=d-r></div><div id=d-gm>ESC - Title screen</div><div class=wind></div><script>!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(){},function(t,e,i){"use strict";i.r(e);let s=/^\//,n=/\/$/,r=new WeakMap,a="";function o(t,e){return new URL(t,e).href}function h(t,e){return[t.replace(n,""),t?e.replace(s,""):e].filter((t=>t)).join("/")}function l(t){let e=t.replace("."+function(t){return t.split(".").pop()}(t),"");return 2==e.split("/").length?e.replace(s,""):e}let d,c,u={};function m(t){return window.__k||(window.__k={dm:r,u:o,i:u}),new Promise(((e,i)=>{let s,n,r;if(s=h(a,t),u[s])return e(u[s]);(n=new Image).onload=function(){r=o(s,window.location.href),u[l(t)]=u[s]=u[r]=this,e(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s}))}function p(){return c}const f=()=>{};function g(){let t=d;p().clearRect(0,0,t.width,t.height)}function y({fps:t=60,clearCanvas:e=!0,update:i,render:s}={}){let n,r,a,o,h,l=0,d=1e3/t,c=1/t,u=e?g:f;function m(){if(r=requestAnimationFrame(m),a=performance.now(),o=a-n,n=a,!(o>1e3)){for(l+=o;l>=d;)h.update(c),l-=d;u(),h.render()}}return h={update:i,render:s,isStopped:!0,start(){n=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:m,set _last(t){n=t}}}class x{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=e}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();return e.init(t),this.objects.push(e),this._i++,e}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}update(t){let e,i=this.size-1,s=Math.max(this.objects.length-this._i,0);for(;i>=s;)(e=this.objects[i]).update(t),e.isAlive()?i--:(this.objects=this.objects.splice(i,1).concat(this.objects),this._i--,s++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}function w(t){return new x(t)}w.prototype=x.prototype,w.class=x;class b{constructor(t=0,e=0){this._x=t,this._y=e}add(t,e=1){return v(this.x+(t.x||0)*e,this.y+(t.y||0)*e,this)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function v(t,e,i={}){let s=new b(t,e);return i._c&&(s.clamp(i._a,i._b,i._d,i._e),s.x=t,s.y=e),s}v.prototype=b.prototype,v.class=b;class _{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:s,dy:n,ddx:r,ddy:a,width:o,height:h,image:l}=t;this.position=v(e,i),this.velocity=v(s,n),this.acceleration=v(r,a),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=p();for(let e in t)this[e]=t[e];l&&(this.width=void 0!==o?o:l.width,this.height=void 0!==h?h:l.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}isAlive(){return this.ttl>0}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function S(t){return new _(t)}S.prototype=_.prototype,S.class=_;class T{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;let{width:n,height:r,margin:a=0}=t.frame;this.width=n,this.height=r,this.margin=a,this._f=0,this._a=0}clone(){return L(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:n=p()}={}){let r=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;n.drawImage(this.spriteSheet.image,a*this.width+(2*a+1)*this.margin,r*this.height+(2*r+1)*this.margin,this.width,this.height,t,e,i,s)}}function L(t){return new T(t)}function k(t){if(+t===t)return t;let e=[],i=t.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)e.push(r);else for(;r>=n;r--)e.push(r);return e}L.prototype=T.prototype,L.class=T;class E{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:n}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(n)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:n,loop:r}=t[i];if(e=[],void 0===s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map((t=>{e=e.concat(k(t))})),this.animations[i]=L({spriteSheet:this,frames:e,frameRate:n,loop:r})}}}function P(t){return new E(t)}P.prototype=E.prototype,P.class=E;let A=null,C={},M=(t,e)=>{A&&A.unmount(),(A=C[t])&&A.mount(e)},j=(t,e)=>C[t]=e;var O=class{constructor(t,e){this.name=t,this.O=e}mount(){}unmount(){}};const I=window,H=document;let D=t=>t.style.display="inline",R=t=>t.style.display="none",z=H.querySelector.bind(H),F=H.createElement.bind(H),N=requestAnimationFrame.bind(I),W=setTimeout.bind(I),B=clearTimeout.bind(I),$=setInterval.bind(I),q=clearInterval.bind(I),U=addEventListener.bind(I),J=removeEventListener.bind(I),Y=Math.random.bind(Math),X=Math.max.bind(Math),G=Math.min.bind(Math),K=(t,...e)=>t.classList.add(...e),Q=(t,e)=>t.classList.remove(e),V=t=>t.replace(/^\s+/,""),Z="keypress",tt="keydown",et="w",it=t=>{t.cP=w({create:S,maxSize:100})},st=t=>{t.createClouds=()=>{nt(t),t.cT=W((()=>{t.createClouds(t)}),1e3*Y()+2e3)},t.createClouds()},nt=t=>{t.cP.get({x:1e3,y:100*Y()+20,dx:-2*Y()-.3,dy:0,width:52,height:32,image:u.c,ttl:3e3,type:"cloud"})},rt=(t,e)=>{t.cP.update(e)},at=t=>{let e=t.O.context;t.cP.getAliveObjects().forEach((t=>{let i=t.dx/-2;e.save(),e.globalAlpha=i,t.render(),e.restore()}))},ot=t=>{q(t.cT)},ht=t=>{t.dP=w({create:S,maxSize:100})},lt=t=>(e,i)=>{let s=5*Y();t.dP.get({x:e+50-20,y:i+100-2,dx:-1*Y()-1,dy:-.5*Y(),width:s,height:s,image:u.d,ttl:100,type:"dust"})},dt=t=>{t.dP.update()},ct=t=>{let e=t.O.context;t.dP.getAliveObjects().forEach((t=>{let i=t.ttl/80;e.save(),e.globalAlpha=i,t.render(),e.restore()}))};let ut=(t,e)=>{t.style.backgroundPositionX=e%960+"px"},mt=t=>{" "===t.key&&M("story")};var pt=class extends O{constructor(t){super("title",t)}mount(){let t=this;D(z("#d-tt")),D(z("#d-m")),D(z("#d-c"));let e=S({x:300,y:170,width:100,height:100,animations:P({image:u.m,frameWidth:32,frameHeight:32,animations:{run:{frames:"0..9",frameRate:20}}}).animations});e.playAnimation("run"),ht(t),U(Z,mt);let i=lt(t);t.dT=$((()=>{i(e.x,e.y)}),50),it(t),st(t);let s=z("#g"),n=0;t.L=y({update:function(){e.update(),dt(t),rt(t,1),ut(s,n-=4)},render:function(){e.render(),ct(t),at(t)}}),t.L.start()}unmount(){let t=this;t.L&&(t.L.stop(),t.L=null),J(Z,mt),t.dT&&q(t.dT),ot(t),R(z("#d-tt")),R(z("#d-m")),R(z("#d-c"))}};var ft=class{constructor(t){let e=this;e.O=t,e.image=t.image,e.x=t.x,e.dx=t.dx||0,e.E=0,e.mode=0,e.play("stand")}update(){let t=this;switch(t.x+=t.dx,t.mode){case 0:t.dx<.2?t.play("stand"):t.play("run");break;case 2:t.dx<.2?(t.play("stand"),t.mode=3,t.onFinish()):t.play("run")}t.image.update()}render(){this.image.render()}acc(){let t=this;if(0===t.mode)t.dx=G(t.dx+3,t.O.maxDx),t.image.animations.run.frameRate=G(t.dx,10)}dec(){let t=this;switch(t.mode){case 0:case 2:t.dx=X(t.dx-.2,0),t.image.animations.run.frameRate=X(t.dx,0)}}finish(t){this.mode=2,this.onFinish=t}useSkill(){let t=this;t.mode=1,t.dx=20,t.play("skill"),t.O.scene&&t.O.scene.showSkillEffect(),W((()=>{t.mode=0,t.rE(),t.O.onSkillEnd&&t.O.onSkillEnd()}),3500)}isInSkill(){return 1===this.mode}play(t){this.image.playAnimation(t)}incE(){let t=this;if(0===t.mode)t.E+=2,t.E>=100&&t.useSkill()}rE(){if(0===this.mode)this.E=0}};let gt=t=>{let e=[0,1];for(let i=0;i<t-1;i++){let t=Math.floor(200*Y())+100,i=100*Y()<1?Pt:Et;e.push(t,i)}return e.push(0,At),{d:-1,l:e,isBot:!0}};var yt=[{id:"the-hare-and-the-tortoise",title:"The Hare and the Tortoise",text:'Once, a hare saw a tortoise walking slowly with a heavy shell on his back. The hare was very proud of himself and he asked the tortoise. "Shall we have a race?" The tortoise agreed. They started the running race. The hare ran very fast. But the tortoise walked very slowly. The proud hare rested under a tree and soon slept off. But the tortoise walked very fast, slowly and steadily and reached the goal. At last, the tortoise won the race.'}];let xt="EAT_MY_DUST_",wt=localStorage,bt=60;let vt=t=>{let e=F("div");return K(e,"name"),e.innerHTML=t,e},_t=()=>{let t=F("div");return K(t,"arrow"),t},St=t=>t<bt?bt:t>900?900:t,Tt=t=>t>=bt&&t<=900?t:t<bt?bt:t>900?900:void 0,Lt=(t,e,i,s)=>{let n=Math.atan2(s-e,i-t)-Math.PI/2;return n<-1.4?-1.4:n>1.4?1.4:n};var kt=class extends ft{constructor(t){super(t);let e=this;e.logs=t.logs,e.player=t.player;let i=e.label=vt(t.name);t.lP.appendChild(i),e.logs.isBot&&K(i,"bot");let s=e.arrow=_t();t.lP.appendChild(s)}render(){let t=this;t.image.x=t.x-t.player.x+t.O.offset,t.image.render();let e=t.image.x+50,i=St(e);t.label.style.left=i+"px";let s=t.arrow.style;s.left=Tt(e)+"px",s.transform=`rotate(${Lt(i,120,e,250)}rad)`}showLabel(){D(this.label),D(this.arrow)}};let Et=1,Pt=2,At=3,Ct=100,Mt=40,jt={ground:z("#g"),D:z("#d"),tC:z("#d-t"),text:z("#t"),subText:z("#st"),frame:z("#ef"),bar:z(".eb"),lP:z("#d-l")};let Ot=t=>t.replace(/(\r\n|\n|\r)/gm," ").replace(/\s+/g," ").split(" ");function It(t,e,i){let s=Ht(t.L.sCI+t.L.P.length-1,e,i);Dt(s.P);let n=Ht(-1,e,s.lWI+1);return Rt(n.P),s}function Ht(t,e,i){let s=i,n="";for(let r=i;r<e.length;r++){let i=0===r?e[r]:n+" "+e[r];if(i.length>Mt)return{P:V(n+" "),sCI:t+1,lWI:s};n=i,s=r}return{P:V(n),sCI:t+1,lWI:s}}let Dt=t=>jt.text.innerHTML=t,Rt=t=>jt.subText.innerHTML=t;function zt(t,e){let{P:i,sCI:s}=t,n=e-s,r=i.slice(0,n),a=i.slice(n+1),o=i.charAt(n);return Dt('<span class="correct">'+r+'</span><span class="cursor">'+o+"</span>"+a),e}function Ft(t,e=!1){let i=jt.bar;if(e){let t=i.cloneNode(),e=i.parentNode;t.removeAttribute("id"),e.appendChild(t),K(t,"e"),N((()=>{K(t,"d")})),W((()=>{e.removeChild(t)}),1e3)}let s=jt.frame.offsetWidth-2,n=G(t*(s/100),s);i.style.width=n+"px"}var Nt=class extends O{constructor(t){super("game",t)}mount(t){let e=this;D(z("#d-t")),D(z("#d-d")),D(z("#d-e")),D(z("#d-l")),D(z("#d-pm")),D(z("#d-gm")),z("#d-l").innerHTML="";let i=P({image:u.m,frameWidth:32,frameHeight:32,animations:{run:{frames:"0..9",frameRate:10},stand:{frames:[3,8],frameRate:3},skill:{frames:"10..19",frameRate:15}}}),s=S({x:300,y:170,width:100,height:Ct,animations:i.animations}),n=new ft({scene:e,image:s,x:0,maxDx:10,onSkillEnd:()=>{Ft(n.E)}});Ft(n.E);let r={C:0,L:{sCI:0,P:""},iS:!1,iF:!1,lT:null,sT:null},a=(t=>e=>{let i=wt.getItem(xt+t);return i?JSON.parse(i).slice(0,e):[gt(441)]})(t.story.id)(3);a.sort(((t,e)=>e.d-t.d));let o=a.map(((t,e)=>{let s=S({x:0,y:170,width:100,height:Ct,animations:i.animations});return new kt({image:s,x:0,maxDx:10,logs:t,player:n,offset:300,name:t.isBot?"Bot":e+1,lP:jt.lP})}));ht(e),it(e),st(e);let h={d:0,l:[]},l=Ot(t.story.text);r.L=It(r,l,r.C),r.C=zt(r.L,r.C);let d=lt(this);this.keyPressHandler=e=>{e.preventDefault();let{L:i,C:c}=r,{P:u,sCI:m}=i,p=e.key;if("Enter"===p)return;if(r.iF)return;let f=Date.now();if(u.charAt(c-m)===p){r.iS||(r.iS=!0,r.sT=f,r.lT=r.sT,function(t){t.forEach((t=>{let e=t.O.logs.l,i=0;for(let s=0;s<e.length;s+=2)i+=e[s],((e,s)=>{W((()=>{switch(s){case Et:t.incE(),t.acc();break;case Pt:t.rE()}}),i)})(0,e[s+1]);t.showLabel()}))}(o),R(z("#d-pm")));let e=c+1;r.C=zt(i,e),r.C>=i.sCI+i.P.length&&(r.L=It(r,l,i.lWI+1),r.C=zt(r.L,r.C)),n.isInSkill()?(r.D+=1,function(t){let e=t.offsetLeft,i=F("span");K(i,"e","p"),i.innerHTML="+1",i.style.left=e-23+"px",jt.tC.appendChild(i),W((()=>{jt.tC.removeChild(i)}),1e3)}(z(".cursor"))):(n.incE(),Ft(n.E),n.acc()),h.l.push(f-r.lT),h.l.push(Et),d(s.x,s.y),r.L.P||(r.iF=!0,W((()=>{let e=a.map((t=>+t.d));e.sort(((t,e)=>e-t));let i=e[0],s=z("#d-r");r.D>i?s.innerHTML=`New Record!<br />${r.D}m`:s.innerHTML=`You ran<br />${r.D}m`,D(s),h.d=r.d,n.finish((()=>{h.l.push(f-r.lT),h.l.push(At),h.n=new Date(r.sT).toLocaleDateString(),h.d=r.D,(t=>e=>{let i=wt.getItem(xt+t),s=i?JSON.parse(i):[];s.push(e),s.sort(((t,e)=>e.d-t.d));let n=s.slice(0,10),r=JSON.stringify(n);wt.setItem(xt+t,r)})(t.story.id)(h)}))}),n.isInSkill()?4500:1e3))}else n.rE(),Ft(n.E,!0),function(t,e){e.cT&&(B(e.cT),Q(t,et)),N((()=>{N((()=>{K(t,et),e.cT=W((()=>{Q(t,et)}),500)}))}))}(z(".cursor"),r),h.l.push(f-r.lT),h.l.push(Pt);r.lT=f},U(Z,e.keyPressHandler),e.keyDownHandler=t=>"Escape"===t.key&&M("title"),U(tt,e.keyDownHandler);let c=e.O.context;e.L=y({update:function(){n.dec(),n.update(),r.iS&&o.forEach((t=>{t.dec(),t.update()})),r.D=(n.x/200).toFixed(2),function(t){jt.D.innerHTML=t+"m"}(r.D),function(t){jt.ground.style.backgroundPositionX=-t%960+"px"}(n.x),rt(e,n.isInSkill()?3:1),dt(e)},render:function(){c.save(),c.globalAlpha=.4,o.forEach((t=>t.render(n))),c.restore(),n.render(),at(e),ct(e)}}),e.L.start()}unmount(){let t=this;t.L&&(t.L.stop(),t.L=null),J(Z,t.keyPressHandler),J(tt,t.keyDownHandler),ot(t),R(z("#d-t")),R(z("#d-d")),R(z("#d-e")),R(z("#d-l")),R(z("#d-pm")),R(z("#d-r")),R(z("#d-gm"))}showSkillEffect(){let t=z(".wind"),e=t.parentNode;for(let i=0;i<15;i++)W((()=>{let i=t.cloneNode(),s=960*Y(),n=300*Y()+30,r=.4*Y()+.2;e.appendChild(i),i.style.left=s+"px",i.style.top=n+"px",i.style.opacity=r,(t=>{W((()=>{K(t,"m")}),100),W((()=>{e.removeChild(i)}),1e3)})(i)}),200*i)}};let Wt=0;let Bt=(t,e)=>{let i=F("li");return K(i,"story"),i.innerHTML=`${e+1}. ${t.title}`,0===e&&K(i,"s"),i},$t=t=>e=>{t[e.key]&&t[e.key]()};var qt=class extends O{constructor(t){super("story",t)}mount(){let t=this;D(z("#d-sp")),D(z("#d-gm"));let e=z("#sl");e.innerHTML="",yt.forEach(((t,i)=>{let s=Bt(t,i);e.appendChild(s)})),t.keyHandler=$t({ArrowUp:()=>{--Wt<0&&(Wt=yt.length-1),t.updateStoryList()},ArrowDown:()=>{++Wt>=yt.length&&(Wt=0),t.updateStoryList()},Enter:()=>t.selectStory(),Escape:()=>M("title")}),U(tt,t.keyHandler)}updateStoryList(){z("#sl").childNodes.forEach(((t,e)=>{e===Wt?K(t,"s"):Q(t,"s")}))}selectStory(){M("game",{story:yt[Wt]})}unmount(){R(z("#d-sp")),R(z("#d-gm")),J(tt,this.keyHandler)}};i(0),U("DOMContentLoaded",(()=>{let{context:t}=function(t){return d=document.getElementById(t)||t||document.querySelector("canvas"),(c=d.getContext("2d")).imageSmoothingEnabled=!1,{canvas:d,context:c}}();(function(t){a=t})("images"),Promise.all([m("m.png"),m("c.png"),m("d.png")]).then((()=>{j("title",new pt({context:t})),j("story",new qt),j("game",new Nt({context:t})),M("title")}))}))}])</script>