<!doctype html><style>@font-face{font-family:emoji;src:url(https://cdn.jsdelivr.net/npm/twemoji-colr-font@14.0.2/twemoji.woff2)}#c{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;touch-action:none}</style><title>Tut's Tomb</title><script src=/2022/webxr/babylon.js></script><div id=intro style="text-align:center;font-family:Helvetica,sans-serif;max-width:420px;margin:0 auto"><h1>Tut's Tomb</h1><h2>Created By Alex Swan</h2><h2>For JS13KGames 2022</h2><p>You are tasked with preparing King Tut to make the journey from death to the afterlife. Solve the two puzzles to complete the task.<p>Use a WebXR Pointer or WASD/Mouse to move and interact.</p><button id=playButton style="color:#fff;background:#000;border-radius:12px;padding:15px 25px;font-size:32px;border:0 solid #000">PLAY</button></div><canvas id=c style=display:none></canvas><script>(()=>{"use strict";const e=["𓀀","𓀁","𓀂","𓀃","𓀄","𓀅","𓀆","𓀇","𓀈","𓀉","𓀊","𓀋","𓀌","𓀍","𓀎","𓀏","𓃒","𓃓","𓃔","𓃕","𓃖","𓃗","𓃘","𓃙","𓃚","𓃛","𓃜","𓃝","𓃞","𓃟","𓃠","𓃡","𓃢","𓃣","𓃤","𓃥","𓃦","𓃧","𓃨","𓃩","𓃪","𓃫","𓃬","𓃭","𓃮","𓃯","𓃰","𓃱","𓃲","𓃳","𓃴","𓃵","𓃶","𓃷","𓃸","𓃹","𓃺","𓃻","𓃼","𓃽","𓆓","𓍢","𓍣","𓍤","𓍥","𓍦","𓍧","𓍨","𓍩","𓍪","𓐑","𓐒","𓐓","𓐔","𓐕","𓋴","𓆦","𓆄","𓆃","𓆙","𓅓"],t=["𓃻","𓁢","𓁵","𓁛"],n=t=>{let n="";for(let i=0;i<t;i++)n+=e[Math.floor(Math.random()*e.length)];return n};function i(...e){return o.play(...e)}const o={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),n=this.x.createBufferSource();return e.map(((e,n)=>t.getChannelData(n).set(e))),n.buffer=t,n.connect(this.x.destination),n.start(),n},buildSamples:function(e=1,t=.05,n=220,i=0,o=0,s=.1,a=0,r=1,l=0,c=0,h=0,u=0,p=0,d=0,m=0,B=0,b=0,w=1,f=0,g=0){const v=2*Math.PI;let O,T,I=this.sampleRate,y=l*=500*v/I/I,x=n*=(1+2*t*Math.random()-t)*v/I,M=[],L=0,k=0,A=0,S=1,N=0,C=0,Y=0;for(c*=500*v/I**3,m*=v/I,h*=v/I,u*=I,p=p*I|0,T=(i=i*I+9)+(f*=I)+(o*=I)+(s*=I)+(b*=I)|0;A<T;M[A++]=Y)++C%(100*B|0)||(Y=a?a>1?a>2?a>3?Math.sin((L%v)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/v%2+2)%2:1-4*Math.abs(Math.round(L/v)-L/v):Math.sin(L),Y=(p?1-g+g*Math.sin(v*A/p):1)*(Y>0?1:-1)*Math.abs(Y)**r*e*this.volume*(A<i?A/i:A<i+f?1-(A-i)/f*(1-w):A<i+f+o?w:A<T-b?(T-A-b)/s*w:0),Y=b?Y/2+(b>A?0:(A<T-b?1:(T-A)/b)*M[A-b|0]/2):Y),O=(n+=l+=c)*Math.cos(m*k++),L+=O-O*d*(1-1e9*(Math.sin(A)+1)%2),S&&++S>u&&(n+=h,x+=h,S=0),!p||++N%p||(n=x,l=y,S=S||1);return M},getNote:function(e=0,t=440){return t*2**(e/12)}},{StandardMaterial:s,Texture:a,Scene:r}=BABYLON;let l=0;const{TransformNode:c,Engine:h,Scene:u,MeshBuilder:p,HemisphericLight:d,FreeCamera:m,Vector3:B,PointerEventTypes:b,PointerInfo:w,StandardMaterial:f}=BABYLON;class g{constructor(e){this.width=3,this.height=3,this.tileCount=8,this.openSlot=8,this.tiles=[],this.solved=!1,this.scene=e,this.parent=new c("SlideTilePuzzle",this.scene),this.reset()}set position(e){this.parent.position=e}shuffle(){const e=this.openSlot;if(void 0===e)return;const t=(n=[e-this.width,e+this.width,e-1,e+1].filter((t=>this.isValidSwap(e,t))))[Math.floor(Math.random()*n.length)];var n;const i=this.tiles.find((e=>e.slot===t));i&&(this.openSlot=i.slot,i.slot=e)}isValidSwap(e,t){return!(e<0||e>=this.width*this.height||t<0||t>=this.width*this.height||1!==Math.abs(Math.floor(t/this.width)-Math.floor(e/this.width))+Math.abs(t-e)%this.width)}attemptMove(e){if(this.solved)return;if(!this.isValidSwap(e.slot,this.openSlot))return;const t=this.openSlot;this.openSlot=e.slot,e.slot=t,i(...[,,76,.02,.02,.01,1,.44,,,,,,.5,,,,,.01,.57]),this.isSolved()}isSolved(){return!!this.solved||(this.solved=this.tiles.every(((e,t)=>e.slot===e.face)),this.solved&&i(...[2.07,0,130.81,.01,.26,.47,3,1.15,,.1,,,.05,,,,.14,.26,.15,.02]),this.solved)}reset(){this.solved=!1,this.tiles=[],this.openSlot=this.width*this.height-1;const e=p.CreateBox("coffin",{width:2.33,height:1,depth:.8},this.scene);e.position=new B(0,.5,0),e.checkCollisions=!0,e.setParent(this.parent),e.material=(e=>{const t=document.createElement("canvas");t.width=512,t.height=512;const n=t.getContext("2d");if(!n)return null;n.fillStyle="#f0bd2c",n.fillRect(0,0,t.width,t.height);const i=new s("coffinMaterial"+ ++l,e),o=a.LoadFromDataString("coffinTexture"+ ++l,t.toDataURL(),e);return i.diffuseTexture=o,i})(this.scene);const t=document.createElement("canvas");t.width=320,t.height=320;const n=t.getContext("2d");if(!n)throw new Error("ctx missing");n.font="260px emoji",n.fillStyle="black",n.textBaseline="top";const i=n.measureText("𓀾").width;n.fillText("𓀾",.5*(320-i),60);const o=new f("mummyMat",this.scene);o.diffuseTexture=BABYLON.Texture.LoadFromDataString("mummyTexture",t.toDataURL(),this.scene),o.diffuseTexture.hasAlpha=!0,o.zOffset=-2;const r=p.CreateDecal("decal",e,{position:new B(0,1,0),normal:B.Up(),size:new B(-2.92,2.92,.2)});r.material=o,r.setParent(e),r.isPickable=!1;const h=document.createElement("canvas");h.width=320,h.height=320;const u=h.getContext("2d");if(!u)throw new Error("ctx missing");u.fillStyle="#009e69",u.arc(160,160,140,0,2*Math.PI),u.fill(),u.font="320px emoji",u.fillStyle="black",u.textBaseline="top";const d=u.measureText("𓆣").width;u.fillText("𓆣",.5*(320-d),0);const m=new c("SlideTilePuzzle",this.scene);m.setParent(this.parent);for(let e=0;e<8;e++){const t={face:e,slot:e,mesh:p.CreateBox(`Tile${e}`,{size:.96,depth:.2},this.scene)},n=e%this.width-.5*this.width+.5,i=-1*Math.floor(t.slot/this.width)+.5*this.height-.5;t.mesh.checkCollisions=!0,t.mesh.onPointerPick=e=>{this.attemptMove(t)};const o=new f(`decalMat${e}`,this.scene);o.diffuseTexture=BABYLON.Texture.LoadFromDataString(`canvasTexture${e}`,h.toDataURL(),this.scene),o.diffuseTexture.hasAlpha=!0,o.zOffset=-2;const s=p.CreateDecal("decal",t.mesh,{position:new B(-1*n,-1*i,0),normal:B.Backward(),size:new B(-2.92,2.92,.2)});s.material=o,s.setParent(t.mesh),s.isPickable=!1,t.mesh.setParent(m),t.mesh.registerBeforeRender((e=>{t.mesh.position.x=t.slot%this.width-.5*this.width+.5,t.mesh.position.y=-1*Math.floor(t.slot/this.width)+.5*this.height-.5})),this.tiles.push(t)}m.rotation=new B(Math.PI/2,3*Math.PI/2,0),m.position=new B(0,1,0),m.scaling=new B(.25,.25,.25);for(let e=0;e<100;e++)this.shuffle()}}const{TransformNode:v,Engine:O,Scene:T,MeshBuilder:I,HemisphericLight:y,FreeCamera:x,Vector3:M,PointerEventTypes:L,PointerInfo:k,StandardMaterial:A}=BABYLON;class S{constructor(e){this.jars=[],this.solved=!1,this.scene=e,this.parent=new v("JarPuzzle",this.scene),this.reset()}set position(e){this.parent.position=e}attemptMove(e){if(this.solved)return!0;e.orientation=(e.orientation+1)%4,i(...[,,651,.01,.02,0,1,2.52,,38,-34,.03,,,-31]),this.isSolved()}isSolved(){return!!this.solved||(this.solved=this.jars.every(((e,t)=>e.orientation===t)),this.solved&&i(...[2.07,0,130.81,.01,.26,.47,3,1.15,,.1,,,.05,,,,.14,.26,.15,.02]),this.solved)}reset(){this.solved=!1,this.jars=[];const e=I.CreateBox("jar",{size:.6},this.scene);e.position=new M(0,.3,0),e.checkCollisions=!0,e.setParent(this.parent),e.material=(e=>{const t=document.createElement("canvas");t.width=512,t.height=512;const n=t.getContext("2d");if(!n)return null;n.fillStyle="#e7c482",n.fillRect(0,0,t.width,t.height);const i=new s("material"+ ++l,e),o=a.LoadFromDataString("texture"+ ++l,t.toDataURL(),e);return i.diffuseTexture=o,i})(this.scene),t.forEach(((e,t)=>{const n=t%2*.3-.15,i=.15-.3*Math.floor(t/2),o={orientation:(t+Math.floor(3*Math.random())+1)%4,mesh:I.CreateCapsule(`Jar${t}`,{radius:.125,height:.5},this.scene)},s=document.createElement("canvas");s.width=512,s.height=512;const a=s.getContext("2d");if(!a)throw new Error("ctx missing");a.font="320px Arial",a.fillStyle="black",a.textBaseline="top",a.fillText(e,.5*(s.width-a.measureText(e).width),80);const r=new A(`jarDecalMat${t}`,this.scene);r.diffuseTexture=BABYLON.Texture.LoadFromDataString(`jarCanvasTexture${t}`,s.toDataURL(),this.scene),r.diffuseTexture.hasAlpha=!0,r.zOffset=-2;const l=I.CreateDecal(`jardecal${t}`,o.mesh,{position:new M(0,0,0),normal:M.Backward(),size:new M(.5,.5,.5)});l.material=r,l.setParent(o.mesh),l.isPickable=!1,o.mesh.position=new M(n,.6,i),o.mesh.setParent(this.parent),o.mesh.checkCollisions=!0,o.mesh.onPointerPick=e=>{this.attemptMove(o)},o.mesh.registerBeforeRender((e=>{o.mesh.rotation.y=Math.PI/2*o.orientation})),this.jars.push(o)}))}}const{TransformNode:N,Engine:C,Scene:Y,MeshBuilder:P,HemisphericLight:F,FreeCamera:z,Vector3:E,PointerEventTypes:D,PointerInfo:R,StandardMaterial:V,Color4:j}=BABYLON;let U=0;class ${constructor(e,t){this.lines=[],this.billboardOpenScale=new E(.125,.125,.125),this.billboardClosedScale=new E(.0125,.0125,.0125),this.open=!1,this.scene=t,this.lines=e,this.parent=new N("InfoBubble"+ ++U,this.scene),this.lookAtPos=new E(0,0,0),this.bubbleMesh=P.CreateCylinder("bubble"+ ++U,{diameter:.25,height:.06},this.scene),this.bubbleMesh.material=function(e){const t=e.baseColor||new BABYLON.Color4(.1450980392156863,.23921568627450981,.6470588235294118,1),n=e.rippleColor||new BABYLON.Color4(.0392156862745098,.8352941176470589,.8784313725490196,1),i=e.frozen||!1,o=new BABYLON.NodeMaterial("node"),s=new BABYLON.InputBlock("position");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1,s.setAsAttribute("position");const a=new BABYLON.TransformBlock("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;const r=new BABYLON.InputBlock("World");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=1;const c=new BABYLON.InputBlock("ViewProjection");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const h=new BABYLON.VertexOutputBlock("VertexOutput");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1;const u=new BABYLON.InputBlock("TwirlCenter");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.value=new BABYLON.Vector2(.5,.5),u.isConstant=!1;const p=new BABYLON.VectorSplitterBlock("VectorSplitter");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;const d=new BABYLON.AddBlock("Add");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1;const m=new BABYLON.VectorMergerBlock("VectorMerger");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.xSwizzle="x",m.ySwizzle="y",m.zSwizzle="z",m.wSwizzle="w";const B=new BABYLON.SubtractBlock("Subtract (x)");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=1;const b=new BABYLON.MultiplyBlock("Multiply");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1;const w=new BABYLON.TrigonometryBlock("Cos");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=4,w.operation=BABYLON.TrigonometryBlockOperations.Cos;const f=new BABYLON.MultiplyBlock("Strength x Delta Lergth");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1;const g=new BABYLON.InputBlock("TwirlStrength");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.value=2,g.min=0,g.max=0,g.isBoolean=!1,g.matrixMode=0,g.animationType=BABYLON.AnimatedInputBlockTypes.None,g.isConstant=!1;const v=new BABYLON.LengthBlock("Delta (Length)");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1;const O=new BABYLON.SubtractBlock("Delta (Subtract)");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=1;const T=new BABYLON.InputBlock("uv");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,T.setAsAttribute("uv");const I=new BABYLON.VectorSplitterBlock("VectorSplitter");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1;const y=new BABYLON.MultiplyBlock("Multiply");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1;const x=new BABYLON.TrigonometryBlock("Sin");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=1,x.operation=BABYLON.TrigonometryBlockOperations.Sin;const M=new BABYLON.AddBlock("Add (y)");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=1;const L=new BABYLON.MultiplyBlock("Multiply");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=1;const k=new BABYLON.TrigonometryBlock("Cos");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=1,k.operation=BABYLON.TrigonometryBlockOperations.Cos;const A=new BABYLON.MultiplyBlock("Multiply");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1;const S=new BABYLON.TrigonometryBlock("Sin");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=4,S.operation=BABYLON.TrigonometryBlockOperations.Sin;const N=new BABYLON.VoronoiNoiseBlock("VoronoiNoise");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=4;const C=new BABYLON.AddBlock("Add");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=4;const Y=new BABYLON.InputBlock("Time");Y.visibleInInspector=!1,Y.visibleOnFrame=!1,Y.target=1,Y.value=0,Y.min=0,Y.max=0,Y.isBoolean=!1,Y.matrixMode=0,Y.animationType=i?BABYLON.AnimatedInputBlockTypes.Time:BABYLON.AnimatedInputBlockTypes.None,Y.isConstant=i;const P=new BABYLON.InputBlock("Offset");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=1,P.value=666,P.min=0,P.max=0,P.isBoolean=!1,P.matrixMode=0,P.animationType=BABYLON.AnimatedInputBlockTypes.None,P.isConstant=!0;const F=new BABYLON.InputBlock("Scale");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=1,F.value=12,F.min=0,F.max=0,F.isBoolean=!1,F.matrixMode=0,F.animationType=BABYLON.AnimatedInputBlockTypes.None,F.isConstant=!1;const z=new BABYLON.ColorMergerBlock("ColorMerger");z.visibleInInspector=!1,z.visibleOnFrame=!1,z.target=4,z.rSwizzle="r",z.gSwizzle="g",z.bSwizzle="b",z.aSwizzle="a";const E=new BABYLON.InputBlock("ColorAlpha");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.value=1,E.min=0,E.max=0,E.isBoolean=!1,E.matrixMode=0,E.animationType=BABYLON.AnimatedInputBlockTypes.None,E.isConstant=!0;const D=new BABYLON.MultiplyBlock("Multiply");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=4;const R=new BABYLON.InputBlock("RippleColor");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,R.value=n,R.isConstant=!1;const V=new BABYLON.MaxBlock("Max");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=4;const j=new BABYLON.InputBlock("BaseColor");j.visibleInInspector=!1,j.visibleOnFrame=!1,j.target=1,j.value=t,j.isConstant=!1;const U=new BABYLON.FragmentOutputBlock("FragmentOutput");U.visibleInInspector=!1,U.visibleOnFrame=!1,U.target=2,U.convertToGammaSpace=!1,U.convertToLinearSpace=!1,U.useLogarithmicDepth=!1;const $=new BABYLON.InputBlock("Opacity");return $.visibleInInspector=!1,$.visibleOnFrame=!1,$.target=1,$.value=1,$.min=0,$.max=0,$.isBoolean=!1,$.matrixMode=0,$.animationType=BABYLON.AnimatedInputBlockTypes.None,$.isConstant=!1,s.output.connectTo(a.vector),r.output.connectTo(a.transform),a.output.connectTo(l.vector),c.output.connectTo(l.transform),l.output.connectTo(h.vector),u.output.connectTo(p.xyIn),p.xyOut.connectTo(d.left),g.output.connectTo(f.left),T.output.connectTo(O.left),p.xyOut.connectTo(O.right),O.output.connectTo(v.value),v.output.connectTo(f.right),f.output.connectTo(w.input),w.output.connectTo(b.left),O.output.connectTo(I.xyIn),I.x.connectTo(b.right),b.output.connectTo(B.left),f.output.connectTo(S.input),S.output.connectTo(A.left),I.y.connectTo(A.right),A.output.connectTo(B.right),B.output.connectTo(m.x),I.x.connectTo(y.left),f.output.connectTo(x.input),x.output.connectTo(y.right),y.output.connectTo(M.left),f.output.connectTo(k.input),k.output.connectTo(L.left),I.y.connectTo(L.right),L.output.connectTo(M.right),M.output.connectTo(m.y),m.xy.connectTo(d.right),d.output.connectTo(N.seed),Y.output.connectTo(C.left),P.output.connectTo(C.right),C.output.connectTo(N.offset),F.output.connectTo(N.density),N.output.connectTo(z.r),N.output.connectTo(z.g),N.output.connectTo(z.b),E.output.connectTo(z.a),z.rgba.connectTo(D.left),R.output.connectTo(D.right),D.output.connectTo(V.left),j.output.connectTo(V.right),V.output.connectTo(U.rgba),$.output.connectTo(U.a),o.addOutputNode(h),o.addOutputNode(U),o.build(),o}({baseColor:new j(0,.65,.42,1),rippleColor:new j(.4,1,.9,1)}),this.bubbleMesh.rotation=new E(Math.PI/2,0,0),this.bubbleMesh.setParent(this.parent),this.billboardMesh=P.CreatePlane("billboard"+ ++U,{width:1.6,height:.9,sideOrientation:BABYLON.Mesh.DOUBLESIDE}),this.billboardMesh.setEnabled(!1),this.billboardMesh.position=new E(0,.45,0),this.billboardMesh.setParent(this.parent),this.reset()}set position(e){this.parent.position=e}set rotation(e){this.parent.rotation=e}blur(){this.open=!1,this.billboardMesh.setEnabled(!1),this.bubbleMesh.setEnabled(!0)}reset(){this.open=!1,this.bubbleMesh.registerBeforeRender((e=>{this.bubbleMesh.rotate(E.Up(),Math.PI/180,BABYLON.Space.WORLD)})),this.bubbleMesh.onPointerPick=e=>{console.log("clicked!",this.open),this.billboardMesh.setEnabled(!0),this.bubbleMesh.setEnabled(!1),this.open=!0,i(...[1.01,,275,.01,.01,.15,1,1.03,-3.7,,-93,.07,,,,-.1,,.5,.04,.09])},this.billboardMesh.material=((e,t)=>{const n=document.createElement("canvas");n.width=1920,n.height=1080;const i=n.getContext("2d");if(!i)return null;i.fillStyle="#e7c482",i.fillRect(0,0,n.width,n.height),i.fillStyle="#2bafbb",i.fillRect(0,0,n.width,52),i.fillRect(0,n.height-64,n.width,64),i.font="bold 118px serif",i.fillStyle="black",i.textBaseline="top",e.forEach(((e,t)=>{i.fillText(e,128,64+118*t)}));const o=new s("billboardMaterial"+ ++l,t),r=a.LoadFromDataString("billboardTexture"+ ++l,n.toDataURL(),t);return o.diffuseTexture=r,o})(this.lines,this.scene)}}const{Engine:W,Scene:G,MeshBuilder:H,HemisphericLight:Z,UniversalCamera:J,Vector3:X,Color4:q,PointerEventTypes:K}=BABYLON,Q=async()=>{document.getElementById("intro").style.display="none";const e=document.getElementById("c");e.style.display="block";const i=new W(e,!0),o=new G(i),r=[];o.gravity=new X(0,-.15,0),o.collisionsEnabled=!0,i.displayLoadingUI();const c=new J("MainCamera",new X(0,1.615,0),o);c.inertia=.5,c.speed=1,c.keysUp.push(87),c.keysDown.push(83),c.keysLeft.push(65),c.keysRight.push(68),c.keysUpward.push(69),c.keysDownward.push(81),c.attachControl(e,!0),c.angularSensibility=500,c.applyGravity=!0,c.ellipsoid=new X(.4,.8,.4),c.checkCollisions=!0,c.minZ=.5,new Z("light",new X(0,1,0),o);const h=H.CreateGround("ground",{width:100,height:100,subdivisions:100},o);h.checkCollisions=!0,h.position.y=-.01;const u=H.CreateGround("floor",{width:12,height:8,subdivisions:100},o);u.material=(e=>{const t=document.createElement("canvas");t.width=512,t.height=512;const i=t.getContext("2d");if(!i)return null;i.fillStyle="#7c644a",i.fillRect(0,0,t.width,t.height),i.textBaseline="middle",i.fillStyle="#392c20";let o=128;for(let e=0;e<10;e++)i.save(),o=128+60*Math.random(),i.font=`${o}px emoji`,i.translate(Math.random()*t.width,Math.random()*t.height),i.rotate(2*Math.random()*Math.PI),i.fillText(n(16),-8*o,0),i.fillText(n(16),-8*o,o),i.fillText(n(16),-8*o,-1*o),i.restore();const r=new s("material"+ ++l,e),c=a.LoadFromDataString("texture"+ ++l,t.toDataURL(),e);return r.diffuseTexture=c,r})(o),u.position=new X(0,0,3),u.checkCollisions=!0;const p=u.clone("ceiling");p.position.y=3.14,p.rotate(X.Right(),Math.PI,BABYLON.Space.WORLD),[{x:0,z:-1.5,width:12,depth:1},{x:0,z:7.5,width:12,depth:1},{x:-6.5,z:3,width:1,depth:8},{x:6.5,z:3,width:1,depth:8}].forEach(((e,t)=>{const n=H.CreateBox(`wall${t}`,{width:e.width,depth:e.depth,height:3.14},o);n.checkCollisions=!0,n.position=new X(e.x,1.57,e.z),n.material=((e,t)=>{const n=document.createElement("canvas");n.width=512,n.height=512;const i=n.getContext("2d");if(!i)return null;i.fillStyle="#f0e2bb",i.fillRect(0,0,n.width,n.height);const o=new s("wallMaterial"+ ++l,t),r=a.LoadFromDataString("wallTexture"+ ++l,n.toDataURL(),t);return o.diffuseTexture=r,o})(0,o)})),[{x:4.5,z:.5,rotation:Math.PI},{x:-4.5,z:.5,rotation:3*Math.PI/2},{x:-4.5,z:5.5,rotation:0},{x:4.5,z:5.5,rotation:Math.PI/2}].forEach(((e,i)=>{const r=H.CreateCylinder(`column${i}`,{diameter:1,height:3.14});r.checkCollisions=!0,r.position=new X(e.x,1.5,e.z),r.material=((e,t)=>{const i=document.createElement("canvas");i.width=512,i.height=512;const o=i.getContext("2d");if(!o)return null;o.fillStyle="#e7c482",o.fillRect(0,0,i.width,i.height),o.fillStyle="#2bafbb",o.fillRect(0,0,512,52),o.fillRect(0,448,512,64),o.font="48px emoji",o.fillStyle="#b76324";for(let e=48;e<448;e+=48)o.fillText(n(32),0,e);o.font="256px emoji",o.fillStyle="black",o.textBaseline="top",e.forEach(((e,t)=>{o.fillText(e,64,64+256*t)}));const r=new s("columnMaterial"+ ++l,t),c=a.LoadFromDataString("columnTexture"+ ++l,i.toDataURL(),t);return r.diffuseTexture=c,r})([t[i]],o),r.rotation=new X(0,e.rotation,0)})),o.onPointerObservable.add((t=>{switch(t.type){case K.POINTERDOWN:if(t&&t.pickInfo&&t.pickInfo.pickedMesh){const e=t.pickInfo.pickedMesh;r.forEach((e=>{e.blur()})),e.onPointerPick&&(e.onPointerPick(t),c.detachControl())}break;case K.POINTERUP:c.inputs.attachedToElement||c.attachControl(e,!0)}})),await o.createDefaultXRExperienceAsync({floorMeshes:[u]}),i.hideLoadingUI(),i.runRenderLoop((()=>{o.render()})),window.addEventListener("resize",(()=>{i.resize()})),new S(o).position=new X(3,0,3),new g(o).position=new X(0,0,4),[{x:0,y:2,z:3,angle:0,lines:["Tut's tomb was not actually","this big, it was roughly half","the length, width, and height","of what you see. This token","marks the halfway point."]},{x:3.6,y:.7,z:2.7,angle:Math.PI/2,lines:["Four canopic jars hold Tut's","stomach, intestines, lungs,","and liver. These were","considered necessary for the","afterlife, and preserved here."]},{x:5.6,y:2,z:5,angle:Math.PI/2,lines:["This wall lead to the Treasury","where Tut's canopic jars were","actually kept. It also held a","statue of Anubis on a golden","shrine, keeping guard."]},{x:0,y:1,z:5,angle:0,lines:["Scarabs are a symbol of new","life. Funerary workers place","a scarab over the mummy's","chest to provide protection","and guidance being reborn","in the afterlife"]}].forEach((e=>{const t=new $(e.lines,o);console.log("placing bubble at ",e.x,e.y,e.z),t.position=new X(e.x,e.y,e.z),t.rotation=new X(0,e.angle,0),r.push(t)}))};window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("playButton").onclick=Q}))})()</script>