<!doctype html><title>Loadshedding</title><style>*{margin:0;padding-left:0}body,html{width:100%;height:100%;background-color:#909090}canvas{width:100%;height:100%;display:block}</style><canvas id=game></canvas><script>kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){let e,n,o,a,r=(t=t||{}).fps||60,i=0,c=1e3/r,s=1/r,p=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function d(){if(n=requestAnimationFrame(d),o=performance.now(),a=o-e,e=o,!(a>1e3)){for(kontra._tick(),i+=a;i>=c;)u.update(s),i-=c;p(),u.render()}}let u={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(d)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return u}</script><script>kontra.init();let canvasHeight,canvasWidth,drawingScale,loop,gameState,canvas=document.querySelector("canvas"),context=canvas.getContext("2d"),highscores=loadHighscores();function resizeCanvas(){if(canvas.height=window.innerHeight,canvas.width=window.innerWidth,canvasHeight=canvas.height,canvasWidth=canvas.width,drawingScale=canvasWidth/384,null!=gameState){defaultSidebar.rescale();let t=gameState.buildings.length;for(let e=0;e<t;e++)gameState.buildings[e].rescale()}}function getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}function addHighscore(t,e){highscores.push([t,e]);let i=highscores.length,n=!0;for(;n;){n=!1;for(let t=i-1;t>0;t--)if(highscores[t][0]>highscores[t-1][0]){let e=highscores[t-1];highscores[t-1]=highscores[t],highscores[t]=e,n=!0}else if(highscores[t][0]==highscores[t-1][0]&&highscores[t][1]<highscores[t-1][1]){let e=highscores[t-1];highscores[t-1]=highscores[t],highscores[t]=e,n=!0}}i>10&&highscores.pop()}function storeHighscores(t){localStorage.setItem("LNLSHighScores",JSON.stringify(t))}function loadHighscores(){return JSON.parse(localStorage.getItem("LNLSHighScores"))||[]}function beginScreen(){this.color="#0077c2",this.buttonColor="#00bcd4",this.buttonColor2="#008ba3",this.textColor="#fafafa",this.font="px Nova Flat",beginLoop=kontra.gameLoop({update:function(){},render:function(){context.fillStyle=color,context.fillRect(50*drawingScale,30*drawingScale,canvasWidth-100*drawingScale,110*drawingScale),context.fillStyle=buttonColor2,context.fillRect(154*drawingScale,122*drawingScale,canvasWidth-307*drawingScale,11*drawingScale),context.fillStyle=buttonColor,context.fillRect(154*drawingScale,122*drawingScale,canvasWidth-308*drawingScale,10*drawingScale),context.fillStyle=textColor,context.font=Math.round(6*drawingScale)+font,context.fillText("How to play:",60*drawingScale,40*drawingScale),context.fillText("1: Deliver as many kWH of power as possible.",65*drawingScale,47*drawingScale),context.fillText("2: The more power being consumed, the faster your score will increase.",65*drawingScale,54*drawingScale),context.fillText("3: Generation and consumption vary with the weather and time of day.",65*drawingScale,61*drawingScale),context.fillText("4: Keep an eye on the clock and weather forecast.",65*drawingScale,68*drawingScale),context.fillText("5: Toggle buildings on and offline, to manage consumption.",65*drawingScale,75*drawingScale),context.fillText("6: Don't let consumption exceed generation or the grid will go offline and the game will end.",65*drawingScale,82*drawingScale),context.fillText("New Game",180*drawingScale,129*drawingScale)}}),canvas.addEventListener("mousedown",beginClick=function(t){1==t.which&&t.x>=154*drawingScale&&t.x<=canvasWidth-154*drawingScale&&t.y>=122*drawingScale&&t.y<=132*drawingScale&&(canvas.removeEventListener("mousedown",beginClick),beginLoop.stop(),newGame())}),beginLoop.start()}function endGame(t,e){this.color="#0077c2",this.buttonColor="#00bcd4",this.buttonColor2="#008ba3",this.textColor="#fafafa",this.font="px Nova Flat",this.dayPlural=function(t){return 1==t?"1 day":t+" days"},canvas.removeEventListener("mousedown",gameClick),loop.stop(),addHighscore(gameState.score,gameState.day),storeHighscores(highscores),endLoop=kontra.gameLoop({update:function(){},render:function(){context.fillStyle=color,context.fillRect(50*drawingScale,30*drawingScale,canvasWidth-100*drawingScale,110*drawingScale),context.fillStyle=buttonColor2,context.fillRect(154*drawingScale,122*drawingScale,canvasWidth-307*drawingScale,11*drawingScale),context.fillStyle=buttonColor,context.fillRect(154*drawingScale,122*drawingScale,canvasWidth-308*drawingScale,10*drawingScale),context.fillStyle=textColor,context.font=Math.round(6*drawingScale)+font,context.fillText("The grid is",60*drawingScale,40*drawingScale),context.fillText("Your score:",60*drawingScale,65*drawingScale),context.fillText("in "+dayPlural(gameState.day),60*drawingScale,83*drawingScale),context.fillText("New Game",180*drawingScale,129*drawingScale),context.fillText("Highscores:",canvasWidth-140*drawingScale,40*drawingScale);var t=highscores.length;for(let e=0;e<t;e++)context.fillText(e+1+": "+Math.floor(highscores[e][0])+"kWH in "+dayPlural(highscores[e][1]),canvasWidth-135*drawingScale,(47+7*e)*drawingScale);context.font=Math.round(12*drawingScale)+font,context.fillText("Offline",60*drawingScale,51*drawingScale),context.fillText(Math.floor(gameState.score)+"kWH",60*drawingScale,76*drawingScale)}}),canvas.addEventListener("mousedown",endClick=function(t){1==t.which&&t.x>=154*drawingScale&&t.x<=canvasWidth-154*drawingScale&&t.y>=122*drawingScale&&t.y<=132*drawingScale&&(canvas.removeEventListener("mousedown",endClick),endLoop.stop(),newGame())}),endLoop.start()}function Element(){this.function=function(){},this.set=function(t,e,i,n){this.x=t,this.y=e,this.x2=i,this.y2=n,this.active=!0},this.clear=function(){this.active=!1},this.onClick=function(){this.function()},this.set(-1,-1,-1,-1,""),this.clear()}function defSidebar(){this.color="#0077c2",this.color2="#0d47a1",this.color3="#0d47a1",this.buttonColor="#00bcd4",this.buttonColor2="#008ba3",this.buttonColor3="#e0f7fa",this.textColor="#fafafa",this.font="px Nova Flat",this.selectionColor="#ef5350",this.cursorAnimation=0,this.cursorExpanding=!0,this.elements=[new Element],this.rescale=function(){this.width=70*drawingScale},this.rescale(),this.relScale=function(t,e,i,n){let a=i-t,o=n-e;return a>=o?[9*drawingScale,30*drawingScale+(a-o)/2*drawingScale,51*drawingScale*drawingScale/a]:[9*drawingScale+(o-a)/2*drawingScale,30*drawingScale,48*drawingScale*drawingScale/o]},this.backdrop=function(){context.save(),context.translate(0,8*drawingScale),context.fillStyle=this.color,context.fillRect(0,0,this.width,canvasHeight),context.fillStyle=this.color2,context.fillRect(this.width,0,drawingScale/-2,canvasHeight),context.restore()},this.building=function(t,e,i,n,a){if(this.backdrop(),context.save(),context.translate(0,8*drawingScale),context.fillStyle=this.color3,context.fillRect(drawingScale,drawingScale,this.width-3*drawingScale,13*drawingScale),context.font=Math.round(6*drawingScale)+this.font,context.fillStyle=this.textColor,context.fillText(t,2*drawingScale,6*drawingScale),context.fillStyle="#909090",context.fillRect(5.5*drawingScale,18.5*drawingScale,this.width-12*drawingScale,55*drawingScale),context.fillStyle=gameState.backgroundColor,context.fillRect(6*drawingScale,19*drawingScale,this.width-13*drawingScale,54*drawingScale),context.fillStyle=this.color3,context.fillRect(drawingScale,78*drawingScale,this.width-3*drawingScale,40*drawingScale),context.fillStyle=this.textColor,context.fillText("Stats:",2*drawingScale,83*drawingScale),e)var o="Online";else o="Offline";context.fillText("Status:         "+o,7*drawingScale,89*drawingScale),context.fillText("Generating:  "+Math.floor(10*i)/10,7*drawingScale,95*drawingScale),context.fillText("Consuming: "+Math.floor(10*n)/10,7*drawingScale,101*drawingScale),context.fillStyle=this.buttonColor2,context.fillRect(15*drawingScale,122*drawingScale,this.width-34.5*drawingScale,10.5*drawingScale),context.fillStyle=!1!==a?this.buttonColor3:this.buttonColor,context.fillRect(15*drawingScale,122*drawingScale,this.width-35*drawingScale,10*drawingScale),context.font=Math.round(6*drawingScale)+this.font,context.fillStyle=this.buttonColor3,context.fillText("SWITCH",21*drawingScale,129*drawingScale),!1!==a&&(context.fillStyle="#e53935",context.fillRect(15*drawingScale,122*drawingScale,(this.width-35*drawingScale)/100*a,10*drawingScale)),context.restore()},this.update=function(){!1===gameState.buildingSelected?this.elements[0].clear():(this.elements[0].set(15*drawingScale,130*drawingScale,this.width-20*drawingScale,140*drawingScale),this.elements[0].function=function(){gameState.buildings[gameState.buildingSelected].inertia=100,defaultSidebar.buttonAnimation=5}),1==this.cursorExpanding?(this.cursorAnimation=this.cursorAnimation+drawingScale/60,this.cursorAnimation>=drawingScale/2&&(this.cursorExpanding=!1)):(this.cursorAnimation=this.cursorAnimation-drawingScale/60,this.cursorAnimation<=0&&(this.cursorExpanding=!0))},this.render=function(){this.backdrop(),context.save(),context.translate(0,8*drawingScale),context.fillStyle=this.color2,context.fillRect(drawingScale,drawingScale,this.width-3*drawingScale,13*drawingScale),context.fillRect(drawingScale,15*drawingScale,this.width-3*drawingScale,31*drawingScale),context.fillRect(drawingScale,47*drawingScale,this.width-3*drawingScale,38*drawingScale),context.font=Math.round(6*drawingScale)+this.font,context.fillStyle=this.textColor,context.fillText("Score",2*drawingScale,6*drawingScale),context.fillText(Math.floor(gameState.score)+" kWH",7*drawingScale,12*drawingScale),context.fillText("Weather Forecast",2*drawingScale,20*drawingScale),context.fillText("1hr - "+gameState.weatherAtTime(750),7*drawingScale,26*drawingScale),context.fillText("2hr - "+gameState.weatherAtTime(1500),7*drawingScale,32*drawingScale),context.fillText("5hr - "+gameState.weatherAtTime(3750),7*drawingScale,38*drawingScale),context.fillText("12hr - "+gameState.weatherAtTime(9e3),4*drawingScale,44*drawingScale),context.fillText("Building Contribution",2*drawingScale,52*drawingScale),context.fillText("Houses           "+Math.floor(gameState.netPowerList[0]),7*drawingScale,58*drawingScale),context.fillText("Offices           "+Math.floor(gameState.netPowerList[1]),7*drawingScale,64*drawingScale),context.fillText("Factories        "+Math.floor(gameState.netPowerList[2]),7*drawingScale,70*drawingScale),context.fillText("Wind Turbines  "+Math.floor(gameState.netPowerList[3]),7*drawingScale,76*drawingScale),context.fillText("Solar Panels   "+Math.floor(gameState.netPowerList[4]),7*drawingScale,82*drawingScale),context.restore()},this.cursor=function(t,e,i,n){let a=i-t,o=n-e;context.save(),context.translate(t,e),context.fillStyle=this.selectionColor,context.fillRect(-drawingScale-this.cursorAnimation,-drawingScale-this.cursorAnimation,2*drawingScale,drawingScale/2),context.fillRect(-drawingScale-this.cursorAnimation,-drawingScale-this.cursorAnimation,drawingScale/2,2*drawingScale),context.fillRect(a+drawingScale+this.cursorAnimation,-drawingScale-this.cursorAnimation,-2*drawingScale,drawingScale/2),context.fillRect(a+drawingScale+this.cursorAnimation,-drawingScale-this.cursorAnimation,drawingScale/-2,2*drawingScale),context.fillRect(-drawingScale-this.cursorAnimation,o+drawingScale+this.cursorAnimation,2*drawingScale,drawingScale/-2),context.fillRect(-drawingScale-this.cursorAnimation,o+drawingScale+this.cursorAnimation,drawingScale/2,-2*drawingScale),context.fillRect(a+drawingScale+this.cursorAnimation,o+drawingScale+this.cursorAnimation,-2*drawingScale,drawingScale/-2),context.fillRect(a+drawingScale+this.cursorAnimation,o+drawingScale+this.cursorAnimation,drawingScale/-2,-2*drawingScale),context.restore()}}function game(){this.color="#0d47a1",this.textColor="#fafafa",this.font="px Nova Flat",this.buildings=[],this.buildingSelected=!1,this.score=0,this.time=9e3,this.day=1,this.backgroundColor="",this.sunlight=10,this.weather="",this.wind=0,this.clouds=0,this.weatherDelay=0,this.futureWeather=[[7,2,"Windy, Clear",1800]],this.powerGenerated=1,this.powerConsumed=0,this.netPowerList=[],this.gridFailTime=360,this.gridFail=this.gridFailTime,this.friendlyTime=function(){return this.hours=Math.floor(this.time/750),this.hours<10&&(this.hours="0"+this.hours),this.mins=Math.floor(this.time/12.5)%60,this.mins<10&&(this.mins="0"+this.mins),this.hours+":"+this.mins},this.friendlyWeather=function(t,e){return frWeather=t<2?"Calm":t<5?"Breezy":t<7?"Windy":"Gale",frWeather+=e>7?", Overcast":e>3?", Cloudy":", Clear",frWeather},this.weatherAtTime=function(t){let e=this.weatherDelay;if(e>=t)return this.weather;let i=this.futureWeather.length;for(let n=0;n<i;n++)if(e+=this.futureWeather[n][3],e>=t)return this.futureWeather[n][2]},this.futureWeatherDuration=function(){let t=0,e=this.futureWeather.length;for(let i=0;i<e;i++)t+=this.futureWeather[i][3];return t},this.generate=function(t,e){this.powerGenerated+=t,this.netPowerList[e]+=t},this.consume=function(t,e){this.powerConsumed+=t,this.netPowerList[e]-=t},this.update=function(){this.time++,this.time>=18e3&&(this.day++,this.time=this.time-18e3);const t=[[0,3e3,"#0d3010",0],[3001,3750,"#154f1a",3],[3751,4500,"#1f7827",6],[4501,5250,"#279931",8],[5251,6e3,"#2aa835",9],[6001,12e3,"#4bbf4d",10],[12001,12750,"#2aa835",8],[12751,13500,"#279931",6],[13501,14250,"#1f7827",4],[14251,15e3,"#154f1a",2],[15001,18e3,"#0d3010",0]],e=t.length;for(let i=0;i<e;i++)if(this.time>=t[i][0]&&this.time<=t[i][1]){this.backgroundColor=t[i][2],this.sunlight=t[i][3];break}for(this.powerGenerated<this.powerConsumed?(this.gridFail<=0&&endGame(this.day,this.time),this.gridFail--):(this.gridFail=this.gridFailTime,this.score=this.score+this.powerConsumed/750),this.powerGenerated=1,this.powerConsumed=0,this.netPowerList=[0,0,0,0,0],this.weatherDelay--;this.futureWeatherDuration()<9e3;){let t=getRandomInt(11),e=getRandomInt(11);this.futureWeather.push([t,e,this.friendlyWeather(t,e),getRandomInt(18e3)+360])}this.weatherDelay<=0&&(this.wind=this.futureWeather[0][0],this.clouds=this.futureWeather[0][1],this.weather=this.futureWeather[0][2],this.weatherDelay=this.futureWeather[0][3],this.futureWeather.shift())},this.backLayer=function(){context.fillStyle=this.backgroundColor,context.fillRect(0,0,canvasWidth,canvasHeight)},this.gui=function(){if(this.gridFail<this.gridFailTime){let t=Math.floor(this.gridFail/60*10)/10;t%1==0&&(t+=".0"),t<0&&(t="0.0"),context.fillStyle="#e53935",context.fillRect(0,0,canvasWidth,8*drawingScale),context.font=Math.round(6*drawingScale)+this.font,context.fillStyle=this.textColor,context.fillText("Warning! Grid going offline in "+t+"s",165*drawingScale,6*drawingScale)}context.save(),context.fillStyle=this.color,context.beginPath(),context.moveTo(0,8*drawingScale),context.lineTo(100*drawingScale,8*drawingScale),context.lineTo(104*drawingScale,4*drawingScale),context.lineTo(104*drawingScale,0),context.lineTo(0,0),context.fill(),context.font=Math.round(6*drawingScale)+this.font,this.powerGenerated<=this.powerConsumed?context.fillStyle="#e53935":context.fillStyle=this.textColor,context.fillText(Math.floor(this.powerGenerated)+" / "+Math.floor(this.powerConsumed)+"  "+Math.floor(this.powerConsumed/this.powerGenerated*100)+"%",5*drawingScale,6*drawingScale),context.fillStyle=this.textColor,context.fillText(this.weather,58*drawingScale,6*drawingScale),context.save(),context.translate(canvasWidth,0),context.fillStyle=this.color,context.beginPath(),context.moveTo(0,8*drawingScale),context.lineTo(-60*drawingScale,8*drawingScale),context.lineTo(-64*drawingScale,4*drawingScale),context.lineTo(-64*drawingScale,0),context.lineTo(0,0),context.fill(),context.font=Math.round(6*drawingScale)+this.font,context.fillStyle=this.textColor,context.fillText(this.friendlyTime()+"  Day "+this.day,-54*drawingScale,6*drawingScale),context.restore()}}function House(t,e){this.rawX=t,this.rawY=e,this.color="grey",this.color2="",this.powered=!0,this.inertia=!1,this.lights=[!1,0,9002],this.consumption=0,this.color2Possibles=["#3949ab","#d32f2f","#d4e157","#c56000"],this.color2=this.color2Possibles[getRandomInt(4)],this.rescale=function(){this.x=this.rawX*drawingScale,this.y=this.rawY*drawingScale,this.x2=this.x+8*drawingScale,this.y2=this.y+6*drawingScale},this.rescale(),this.update=function(){!1!==this.inertia&&(this.inertia>0?this.inertia-=1.5:(this.inertia=!1,this.togglePwd())),gameState.time==this.lights[1]&&(this.lights[0]=!0),gameState.time==this.lights[2]&&(this.lights[0]=!1,this.lights[1]=getRandomInt(1500)+13500,this.lights[2]=getRandomInt(3e3)+3e3),this.powered?(this.consumption=2,this.lights[0]&&(this.consumption+=1),gameState.consume(this.consumption,0)):this.consumption=0},this.render=function(){this.sprite(this.x,this.y,drawingScale)},this.sprite=function(t,e,i){context.save(),context.translate(t,e),context.fillStyle=this.color,context.fillRect(i,0,i,2*i),context.fillStyle=this.color2,context.beginPath(),context.moveTo(0,2*i),context.lineTo(4*i,0),context.lineTo(8*i,2*i),context.fill(),context.fillStyle=this.color,context.fillRect(0,2*i,8*i,4*i),this.lights[0]&&this.powered?context.fillStyle="#ffff8b":context.fillStyle="#000000",context.fillRect(i,3*i,2*i,2*i),context.fillStyle="#000000",context.fillRect(5*i,3*i,2*i,3*i),context.restore()},this.sidebar=function(){defaultSidebar.building("House",this.powered,0,this.consumption,this.inertia);var t=defaultSidebar.relScale(this.x,this.y,this.x2,this.y2);this.sprite(t[0],t[1],t[2])},this.togglePwd=function(){this.powered?this.powered=!1:this.powered=!0},this.onClick=function(){}}function Office(t,e){this.rawX=t,this.rawY=e,this.color="grey",this.powered=!0,this.inertia=!1,this.lights=[[!1,0,9002]],this.consumption=0;for(var i=0;i<9;i++)this.lights.push([!1,0,9002]);this.rescale=function(){this.x=this.rawX*drawingScale,this.y=this.rawY*drawingScale,this.x2=this.x+13*drawingScale,this.y2=this.y+12*drawingScale},this.rescale(),this.update=function(){!1!==this.inertia&&(this.inertia>0?this.inertia-=.5:(this.inertia=!1,this.togglePwd()));for(var t=this.lights.length,e=0;e<t;e++)gameState.time==this.lights[e][1]&&(this.lights[e][0]=!0),gameState.time==this.lights[e][2]&&(this.lights[e][0]=!1,this.lights[e][1]=getRandomInt(1500)+13500,this.lights[e][2]=getRandomInt(3e3)+3e3);if(this.powered){this.consumption=2;for(e=0;e<t;e++)this.lights[e][0]&&(this.consumption+=.5);gameState.consume(this.consumption,1)}else this.consumption=0},this.render=function(){this.sprite(this.x,this.y,drawingScale)},this.sprite=function(t,e,i){context.save(),context.translate(t,e),context.fillStyle=this.color,context.fillRect(0,0,13*i,12*i);const n=[[i,i,2*i,2*i],[4*i,i,2*i,2*i],[7*i,i,2*i,2*i],[10*i,i,2*i,2*i],[i,5*i,2*i,2*i],[4*i,5*i,2*i,2*i],[7*i,5*i,2*i,2*i],[10*i,5*i,2*i,2*i],[i,9*i,2*i,2*i],[10*i,9*i,2*i,2*i]],a=this.lights.length;if(this.powered){context.fillStyle="#ffff8b";for(let t=0;t<a;t++)this.lights[t][0]&&context.fillRect(n[t][0],n[t][1],n[t][2],n[t][3])}context.fillStyle="#000000";for(let t=0;t<a;t++)this.powered&&this.lights[t][0]||context.fillRect(n[t][0],n[t][1],n[t][2],n[t][3]);context.fillStyle="#000000",context.fillRect(5*i,8*i,3*i,4*i),context.restore()},this.sidebar=function(){defaultSidebar.building("Office",this.powered,0,this.consumption,this.inertia);let t=defaultSidebar.relScale(this.x,this.y,this.x2,this.y2);this.sprite(t[0],t[1],t[2])},this.togglePwd=function(){this.powered?this.powered=!1:this.powered=!0},this.onClick=function(){}}function Factory(t,e){this.rawX=t,this.rawY=e,this.color="grey",this.color2="",this.powered=!0,this.inertia=!1,this.consumption=0,this.color2Possibles=["#3949ab","#d32f2f","#d4e157","#c56000"],this.color2=this.color2Possibles[getRandomInt(4)],this.rescale=function(){this.x=this.rawX*drawingScale,this.y=this.rawY*drawingScale,this.x2=this.x+12*drawingScale,this.y2=this.y+10*drawingScale},this.rescale(),this.update=function(){!1!==this.inertia&&(this.inertia>0?this.inertia-=.25:(this.inertia=!1,this.togglePwd())),this.powered?(this.consumption=30,gameState.consume(this.consumption,2)):this.consumption=0},this.render=function(){this.sprite(this.x,this.y,drawingScale)},this.sprite=function(t,e,i){context.save(),context.translate(t,e),context.fillStyle=this.color,context.fillRect(i,0,i,4*i),context.fillRect(4*i,0,i,4*i),context.fillStyle=this.color,context.fillRect(0,4*i,12*i,6*i),context.fillStyle="black",context.fillRect(9*i,7*i,2*i,3*i),(gameState.time>=13500||gameState.time<=4875)&&this.powered?context.fillStyle="#ffff8b":context.fillStyle="#000000",context.fillRect(i,5*i,2*i,i),context.fillRect(4*i,5*i,2*i,i),context.fillRect(7*i,5*i,2*i,i),context.fillStyle=this.color2,context.beginPath(),context.moveTo(0,4*i),context.lineTo(0,2*i),context.lineTo(3*i,4*i),context.lineTo(3*i,2*i),context.lineTo(6*i,4*i),context.lineTo(6*i,2*i),context.lineTo(9*i,4*i),context.lineTo(9*i,2*i),context.lineTo(12*i,4*i),context.fill(),context.restore()},this.sidebar=function(){defaultSidebar.building("Factory",this.powered,0,this.consumption,this.inertia);let t=defaultSidebar.relScale(this.x,this.y,this.x2,this.y2);this.sprite(t[0],t[1],t[2])},this.togglePwd=function(){this.powered?this.powered=!1:this.powered=!0},this.onClick=function(){}}function WindTurbine(t,e){this.rawX=t,this.rawY=e,this.color="grey",this.color2="darkgrey",this.frame=15*getRandomInt(8),this.powered=!0,this.inertia=!1,this.generation=0,this.consumption=0,this.rescale=function(){this.x=this.rawX*drawingScale,this.y=this.rawY*drawingScale,this.x2=this.x+5*drawingScale,this.y2=this.y+9*drawingScale},this.rescale(),this.update=function(){!1!==this.inertia&&(this.inertia>0?this.inertia-=1.5:(this.inertia=!1,this.togglePwd())),this.powered&&gameState.wind>0&&(this.frame+=gameState.wind,this.frame>=120&&(this.frame=0)),this.powered?(this.generation=1.5*gameState.wind,this.consumption=1):(this.generation=0,this.consumption=0),gameState.generate(this.generation,3),gameState.consume(this.consumption,3)},this.render=function(){this.sprite(this.x,this.y,drawingScale)},this.sprite=function(t,e,i){context.save(),context.translate(t,e),context.fillStyle=this.color,context.fillRect(2*i,2*i,i,7*i),context.fillStyle=this.color2,context.fillRect(3*i,8*i,i,i),context.translate(2.5*i,2.5*i),context.rotate(15*Math.floor(this.frame/20)*(Math.PI/180));for(var n=0;n<4;n++)context.fillStyle=this.color,context.beginPath(),context.moveTo(-2.5*i,-2.5*i),context.lineTo(-1.5*i,-2.5*i),context.lineTo(.5*i,-.5*i),context.lineTo(-.5*i,.5*i),context.lineTo(-2.5*i,-1.5*i),context.fill(),context.rotate(Math.PI/180*90);for(let t=0;t<4;t++)context.fillStyle=this.color2,context.beginPath(),context.moveTo(-1.5*i,-2.5*i),context.lineTo(.5*i,-.5*i),context.lineTo(-.5*i,-.5*i),context.lineTo(-1.5*i,-1.5*i),context.fill(),context.rotate(90*Math.PI/180);context.fillStyle=this.color,context.fillRect(-.5,-.5,.5,.5),context.restore()},this.sidebar=function(){defaultSidebar.building("Wind Turbine",this.powered,this.generation,this.consumption,this.inertia);let t=defaultSidebar.relScale(this.x,this.y,this.x2,this.y2);this.sprite(t[0],t[1],t[2])},this.togglePwd=function(){this.powered?this.powered=!1:this.powered=!0},this.onClick=function(){}}function SolarPanel(t,e){this.rawX=t,this.rawY=e,this.color="grey",this.color2="blue",this.color3="lightblue",this.powered=!0,this.inertia=!1,this.generation=0,this.consumption=0,this.rescale=function(){this.x=this.rawX*drawingScale,this.y=this.rawY*drawingScale,this.x2=this.x+2*drawingScale,this.y2=this.y+3*drawingScale},this.rescale(),this.update=function(){!1!==this.inertia&&(this.inertia>0?this.inertia-=2:(this.inertia=!1,this.togglePwd())),this.powered?(0==gameState.clouds?this.generation=gameState.sunlight:this.generation=gameState.sunlight/gameState.clouds,this.consumption=1):(this.generation=0,this.consumption=0),gameState.generate(this.generation,4),gameState.consume(this.consumption,4)},this.render=function(){this.sprite(this.x,this.y,drawingScale)},this.sprite=function(t,e,i){context.save(),context.translate(t,e),context.fillStyle=this.color,context.fillRect(0,i,i,2*i),context.fillStyle=this.color2,context.beginPath(),context.moveTo(0,0),context.lineTo(i,i),context.lineTo(0,i),context.fill(),context.beginPath(),context.moveTo(i,i),context.lineTo(2*i,2*i),context.lineTo(i,2*i),context.fill(),context.beginPath(),context.fillStyle=this.color3,context.moveTo(0,i),context.lineTo(i,i),context.lineTo(i,2*i),context.fill(),context.restore()},this.sidebar=function(){defaultSidebar.building("Solar Panel",this.powered,this.generation,this.consumption,this.inertia);let t=defaultSidebar.relScale(this.x,this.y,this.x2,this.y2);this.sprite(t[0],t[1],t[2])},this.togglePwd=function(){this.powered?this.powered=!1:this.powered=!0},this.onClick=function(){}}function newGame(){gameState=new game,defaultSidebar=new defSidebar,gameState.buildings=[new WindTurbine(85,15),new WindTurbine(95,15),new WindTurbine(105,15),new WindTurbine(80,25),new WindTurbine(90,25),new WindTurbine(100,25),new WindTurbine(85,35),new WindTurbine(95,35),new WindTurbine(105,35),new House(200,40),new House(210,40),new House(220,40),new House(230,40),new House(200,50),new House(210,50),new House(220,50),new House(230,50),new House(240,45),new Office(150,43),new Office(150,58),new Office(150,80),new Office(165,80),new Office(180,80),new SolarPanel(227.5,15),new SolarPanel(232.5,15),new SolarPanel(237.5,15),new SolarPanel(242.5,15),new SolarPanel(247.5,15),new SolarPanel(230,20),new SolarPanel(235,20),new SolarPanel(240,20),new SolarPanel(245,20),new SolarPanel(250,20),new Factory(80,60),new Factory(100,60),new Factory(115,60)];const t=gameState.buildings.length;loop=kontra.gameLoop({update:function(){gameState.update(),defaultSidebar.update();for(let e=0;e<t;e++)gameState.buildings[e].update()},render:function(){context.setTransform(1,0,0,1,0,0),gameState.backLayer();for(let e=0;e<t;e++)gameState.buildings[e].render();!1!==gameState.buildingSelected?(defaultSidebar.cursor(gameState.buildings[gameState.buildingSelected].x,gameState.buildings[gameState.buildingSelected].y,gameState.buildings[gameState.buildingSelected].x2,gameState.buildings[gameState.buildingSelected].y2),gameState.buildings[gameState.buildingSelected].sidebar()):defaultSidebar.render(),gameState.gui()}}),canvas.addEventListener("mousedown",gameClick=function(e){if(1==e.which)if(e.pageX>defaultSidebar.width){for(let i=0;i<t;i++)if(e.pageX>=gameState.buildings[i].x&&e.pageX<=gameState.buildings[i].x2&&e.pageY>=gameState.buildings[i].y&&e.pageY<=gameState.buildings[i].y2)return gameState.buildings[i].onClick(),void(gameState.buildingSelected===i?(gameState.buildingSelected=!1,defaultSidebar.elements[0].clear()):gameState.buildingSelected=i);gameState.buildingSelected=!1}else{var i=defaultSidebar.elements.length;for(let t=0;t<i;t++)if(e.pageX>=defaultSidebar.elements[t].x&&e.pageX<=defaultSidebar.elements[t].x2&&e.pageY>=defaultSidebar.elements[t].y&&e.pageY<=defaultSidebar.elements[t].y2)return void defaultSidebar.elements[t].onClick()}}),loop.start()}resizeCanvas(),beginScreen(),window.addEventListener("resize",resizeCanvas)</script>