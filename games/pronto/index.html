<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=0"><meta name=theme-color content=#111><title>Pronto</title><style>body,html{margin:0;padding:0;background:#111;font:5vw sans-serif;color:#555;overflow:hidden;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-ms-touch-action:none;user-select:none}canvas{position:fixed;width:100%;height:100%}#Message{position:fixed;width:100%;padding-top:20vh;font-weight:700;text-align:center}.Score{font-size:20vw}p{margin:0;padding:0}</style><canvas id=Canvas>Sorry, this browser cannot render this content.</canvas><div id=Message></div><script id=LightVertexShader type=x-shader/x-vertex>attribute vec3 vertex;
uniform mat4 lightProjMat;
uniform mat4 lightModelViewMat;
void main() {
gl_Position = lightProjMat * lightModelViewMat * vec4(vertex, 1.0);
}</script><script id=LightFragmentShader type=x-shader/x-fragment>precision mediump float;
vec4 encodeFloat(float depth) {
const vec4 bitShift = vec4(
256 * 256 * 256,
256 * 256,
256,
1.0
);
const vec4 bitMask = vec4(
0,
1.0 / 256.0,
1.0 / 256.0,
1.0 / 256.0
);
vec4 comp = fract(depth * bitShift);
comp -= comp.xxyz * bitMask;
return comp;
}
void main() {
gl_FragColor = encodeFloat(gl_FragCoord.z);
}</script><script id=VertexShader type=x-shader/x-vertex>attribute vec3 vertex;
attribute vec3 normal;
uniform mat4 projMat;
uniform mat4 modelViewMat;
uniform mat4 normalMat;
uniform mat4 lightModelViewMat;
uniform mat4 lightProjMat;
uniform vec3 lightDirection;
varying mediump float intensity;
varying mediump float z;
varying vec4 shadowPos;
const mat4 texUnitConverter = mat4(
0.5, 0.0, 0.0, 0.0,
0.0, 0.5, 0.0, 0.0,
0.0, 0.0, 0.5, 0.0,
0.5, 0.5, 0.5, 1.0
);
void main() {
gl_Position = projMat * modelViewMat * vec4(vertex, 1.);
z = gl_Position.z;
intensity = max(0., dot(normalize(mat3(normalMat) * normal),
lightDirection));
shadowPos = texUnitConverter * lightProjMat * lightModelViewMat *
vec4(vertex, 1.0);
}</script><script id=FragmentShader type=x-shader/x-fragment>#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform float far;
uniform vec4 sky;
uniform vec4 color;
uniform sampler2D shadowDepthTexture;
varying mediump float intensity;
varying mediump float z;
varying vec4 shadowPos;
float decodeFloat(vec4 c) {
const vec4 bitShift = vec4(
1.0 / (256.0 * 256.0 * 256.0),
1.0 / (256.0 * 256.0),
1.0 / 256.0,
1
);
return dot(c, bitShift);
}
void main() {
vec3 fragmentDepth = shadowPos.xyz;
fragmentDepth.z -= 0.007;
float texelSize = 1.0 / 1024.0;
float amountInLight = 0.0;
for (int x = -1; x <= 1; ++x) {
for (int y = -1; y <= 1; ++y) {
float texelDepth = decodeFloat(texture2D(shadowDepthTexture,
fragmentDepth.xy + vec2(x, y) * texelSize));
if (fragmentDepth.z < texelDepth) {
amountInLight += 1.0;
}
}
}
amountInLight /= 9.0;
amountInLight *= intensity;
float f = z / far;
gl_FragColor = vec4(
(1. - f) * color.rgb * (.5 + amountInLight * .5) + f * sky.rgb,
color.a);
}</script><script>var gl,message,messageVisible,shadowFramebuffer,shadowDepthTexture,shadowProgram,program,setModel,drawModel,width,height,ymax,widthToGl,heightToGl,pointersLength,stop,ready,lost,jump,wayX,wayY,wayZ,wayStraights,wayDir,wayIndex,speed,shift,targetX,score,cursor,M=Math,D=document,W=window,FA=Float32Array,idMat=new FA([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),camMat=new FA(16),projMat=new FA(idMat),viewMat=new FA(idMat),modelViewMat=new FA(16),horizon=50,staticLightViewMat=new FA(16),lightProjMat=new FA(idMat),lightViewMat=new FA(idMat),lightDirection=[0,0,0],skyColor=[.9,.9,.9,1],shadowDepthTextureSize=1024,entitiesLength=0,entities=[],pointersX=[],pointersY=[],keysDown=[],tilesLength=8,tileMag=.5,tileSize=2*tileMag,tileSizeSq=tileSize*tileSize,tileHeight=.2*tileMag,tileColorEven=[0,.58,1,1],tileColorOdd=[0,.48,.9,1];function invert(e,t){var r=t[0],i=t[1],a=t[2],o=t[3],n=t[4],l=t[5],g=t[6],s=t[7],d=t[8],h=t[9],u=t[10],c=t[11],f=t[12],m=t[13],w=t[14],M=t[15],p=r*l-i*n,E=r*g-a*n,T=r*s-o*n,R=i*g-a*l,D=i*s-o*l,F=a*s-o*g,v=d*m-h*f,A=d*w-u*f,b=d*M-c*f,S=h*w-u*m,y=h*M-c*m,P=u*M-c*w,x=p*P-E*y+T*S+R*b-D*A+F*v;if(!x)return null;x=1/x,e[0]=(l*P-g*y+s*S)*x,e[1]=(a*y-i*P-o*S)*x,e[2]=(m*F-w*D+M*R)*x,e[3]=(u*D-h*F-c*R)*x,e[4]=(g*b-n*P-s*A)*x,e[5]=(r*P-a*b+o*A)*x,e[6]=(w*T-f*F-M*E)*x,e[7]=(d*F-u*T+c*E)*x,e[8]=(n*y-l*b+s*v)*x,e[9]=(i*b-r*y-o*v)*x,e[10]=(f*D-m*T+M*p)*x,e[11]=(h*T-d*D-c*p)*x,e[12]=(l*A-n*S-g*v)*x,e[13]=(r*S-i*A+a*v)*x,e[14]=(m*E-f*R-w*p)*x,e[15]=(d*R-h*E+u*p)*x}function multiply(e,t,r){var i=t[0],a=t[1],o=t[2],n=t[3],l=t[4],g=t[5],s=t[6],d=t[7],h=t[8],u=t[9],c=t[10],f=t[11],m=t[12],w=t[13],M=t[14];t=t[15];var p=r[0],E=r[1],T=r[2],R=r[3];e[0]=p*i+E*l+T*h+R*m,e[1]=p*a+E*g+T*u+R*w,e[2]=p*o+E*s+T*c+R*M,e[3]=p*n+E*d+T*f+R*t,p=r[4],E=r[5],T=r[6],R=r[7],e[4]=p*i+E*l+T*h+R*m,e[5]=p*a+E*g+T*u+R*w,e[6]=p*o+E*s+T*c+R*M,e[7]=p*n+E*d+T*f+R*t,p=r[8],E=r[9],T=r[10],R=r[11],e[8]=p*i+E*l+T*h+R*m,e[9]=p*a+E*g+T*u+R*w,e[10]=p*o+E*s+T*c+R*M,e[11]=p*n+E*d+T*f+R*t,p=r[12],E=r[13],T=r[14],R=r[15],e[12]=p*i+E*l+T*h+R*m,e[13]=p*a+E*g+T*u+R*w,e[14]=p*o+E*s+T*c+R*M,e[15]=p*n+E*d+T*f+R*t}function rotate(e,t,r,i,a,o){var n,l,g,s,d,h,u,c,f,m,w,p,E,T,R,D,F,v,A,b,S=M.sqrt(i*i+a*a+o*o);1e-6>M.abs(S)||(i*=S=1/S,a*=S,o*=S,n=M.sin(r),g=1-(l=M.cos(r)),r=t[0],S=t[1],s=t[2],d=t[3],h=t[4],u=t[5],c=t[6],f=t[7],m=t[8],w=t[9],p=t[10],E=t[11],T=i*i*g+l,R=a*i*g+o*n,D=o*i*g-a*n,F=i*a*g-o*n,v=a*a*g+l,A=o*a*g+i*n,b=i*o*g+a*n,i=a*o*g-i*n,o=o*o*g+l,e[0]=r*T+h*R+m*D,e[1]=S*T+u*R+w*D,e[2]=s*T+c*R+p*D,e[3]=d*T+f*R+E*D,e[4]=r*F+h*v+m*A,e[5]=S*F+u*v+w*A,e[6]=s*F+c*v+p*A,e[7]=d*F+f*v+E*A,e[8]=r*b+h*i+m*o,e[9]=S*b+u*i+w*o,e[10]=s*b+c*i+p*o,e[11]=d*b+f*i+E*o,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}function scale(e,t,r,i,a){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}function translate(e,t,r,i,a){var o,n,l,g,s,d,h,u,c,f,m,w;t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],n=t[1],l=t[2],g=t[3],s=t[4],d=t[5],h=t[6],u=t[7],c=t[8],f=t[9],m=t[10],w=t[11],e[0]=o,e[1]=n,e[2]=l,e[3]=g,e[4]=s,e[5]=d,e[6]=h,e[7]=u,e[8]=c,e[9]=f,e[10]=m,e[11]=w,e[12]=o*r+s*i+c*a+t[12],e[13]=n*r+d*i+f*a+t[13],e[14]=l*r+h*i+m*a+t[14],e[15]=g*r+u*i+w*a+t[15])}function transpose(e,t){if(e===t){var r=t[1],i=t[2],a=t[3],o=t[6],n=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=a,e[13]=n,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}function setOrthogonal(e,t,r,i,a,o,n){var l=1/(t-r),g=1/(i-a),s=1/(o-n);e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*s,e[11]=0,e[12]=(t+r)*l,e[13]=(a+i)*g,e[14]=(n+o)*s,e[15]=1}function setPerspective(e,t,r,i,a){t=1/M.tan(t);var o=i-a;e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+i)/o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*i/o,e[15]=0}function setLight(e,t,r){translate(lightViewMat,staticLightViewMat,e,t,r),lightDirection[0]=lightViewMat[2],lightDirection[1]=lightViewMat[6],lightDirection[2]=lightViewMat[10]}function setCamera(e,t,r){translate(viewMat,camMat,e,t,r),setLight(e,t,r)}function drawCameraModel(e,t,r){gl.uniform4fv(t.color,r),gl.drawElements(gl.TRIANGLES,e,gl.UNSIGNED_SHORT,0)}function drawShadowModel(e){gl.drawElements(gl.TRIANGLES,e,gl.UNSIGNED_SHORT,0)}function setCameraModel(e,t){multiply(modelViewMat,lightViewMat,t),gl.uniformMatrix4fv(e.lightModelViewMat,!1,modelViewMat),multiply(modelViewMat,viewMat,t),gl.uniformMatrix4fv(e.modelViewMat,!1,modelViewMat),invert(modelViewMat,t),transpose(modelViewMat,modelViewMat),gl.uniformMatrix4fv(e.normalMat,!1,modelViewMat)}function setShadowModel(e,t){multiply(modelViewMat,lightViewMat,t),gl.uniformMatrix4fv(e.lightModelViewMat,!1,modelViewMat)}function bindModel(e,t){gl.bindBuffer(gl.ARRAY_BUFFER,t.vertices),gl.vertexAttribPointer(e.vertex,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t.normals),gl.vertexAttribPointer(e.normal,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,t.indicies)}function drawEntities(e,t){for(var r,i=entitiesLength;i--;){var a=entities[i];r!=a.model&&bindModel(t,r=a.model),setModel(e,a.matrix),drawModel(r.count,e,a.color)}}function drawCameraView(){var e=program.uniforms,t=program.attribs;gl.useProgram(program),gl.viewport(0,0,width,height),gl.clearColor(skyColor[0],skyColor[1],skyColor[2],skyColor[3]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.uniformMatrix4fv(e.projMat,!1,projMat),gl.uniformMatrix4fv(e.lightProjMat,!1,lightProjMat),gl.uniform3fv(e.lightDirection,lightDirection),gl.uniform4fv(e.sky,skyColor),gl.uniform1f(e.far,horizon),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,shadowDepthTexture),gl.uniform1i(e.shadowDepthTexture,0),drawEntities(e,t)}function drawShadowMap(){var e=shadowProgram.attribs,t=shadowProgram.uniforms;gl.useProgram(shadowProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,shadowFramebuffer),gl.viewport(0,0,shadowDepthTextureSize,shadowDepthTextureSize),gl.clearColor(0,0,0,1),gl.clearDepth(1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.uniformMatrix4fv(t.lightProjMat,!1,lightProjMat),drawEntities(t,e),gl.bindFramebuffer(gl.FRAMEBUFFER,null)}function draw(){setModel=setShadowModel,drawModel=drawShadowModel,drawShadowMap(),setModel=setCameraModel,drawModel=drawCameraModel,drawCameraView()}function setMessage(e){message.innerHTML=e}function gameOver(){messageVisible||(messageVisible=!0,setMessage('<p>You made</p><p class="Score">'+score+"</p><p>points!</p>"))}function pursue(){0<--wayStraights||.5<M.random()?(wayDir=M.random(),wayZ-=tileSize):(wayX+=.5<wayDir?tileSize:-tileSize,wayStraights=2+M.round(4*M.random())),++wayIndex}function getTileColor(){return wayIndex%2?tileColorEven:tileColorOdd}function distSq(e,t,r,i,a,o){return(e-=i)*e+(t-=a)*t+(r-=o)*r}function isTileNear(e,t,r){for(var i=tilesLength;i--;){var a=entities[i].origin;if(distSq(a[12],a[13],a[14],e,t,r)<tileSizeSq)return!0}return!1}function update(){for(var e=Date.now(),t=entitiesLength;t--;)entities[t].update(e);if(ready){var r=cursor.origin,i=r[12],a=r[13],o=r[14];!lost&&jump&&(jump=!1,targetX=i,isTileNear(i-tileSize,r[13],r[14])?(shift=-.3,targetX-=tileSize):(shift=.3,targetX+=tileSize)),.1>(t=M.abs(i-targetX))&&(shift=t*(0<shift?4:-4)),translate(r,r,shift,0,speed),.1>t&&(shift=0),-.35<speed&&(speed-=.001),setCamera(-i,0,-o);var n=!1,l=!0;for(t=tilesLength;t--;){var g=entities[t],s=g.origin,d=s[12],h=s[13],u=s[14],c=u-o;!n&&distSq(d,h,u,i,a,o)<tileSizeSq&&(n=!0),l&&-100<g.base&&(l=!1),!lost&&3<c?(translate(s,idMat,wayX,wayY,wayZ),scale(s,s,tileMag,tileHeight,tileMag),g.base=10/M.abs(speed),g.drop=!1,g.color=getTileColor(),pursue()):1<c&&(g.drop=!0,--g.base)}l&&(stop=!0),lost||n||(lost=e,score=M.abs(M.round(o/(2*tileSize)))),lost&&(-15>a?gameOver():translate(r,r,0,-.5,0))}}function run(){!stop&&requestAnimationFrame(run),update(),draw()}function tryJump(){if(lost){if(2e3<Date.now()-lost){var e=stop;reset(),e&&run()}}else jump=!0}function setPointer(e,t){var r=e.touches;if(t)if(e.touches)for(var i=pointersLength=r.length;i--;){var a=r[i];pointersX[i]=a.pageX,pointersY[i]=a.pageY}else pointersLength=1,pointersX[0]=e.pageX,pointersY[0]=e.pageY;else pointersLength=r?r.length:0;if(t)for(i=pointersLength;i--;)pointersX[i]=pointersX[i]*widthToGl-1,pointersY[i]=-(pointersY[i]*heightToGl-ymax);e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1}function pointerCancel(e){setPointer(e,!1)}function pointerUp(e){setPointer(e,!1),tryJump()}function pointerMove(e){setPointer(e,pointersLength)}function pointerDown(e){setPointer(e,!0)}function setKey(e,t){keysDown[e.keyCode]=t,e.preventDefault()}function keyUp(e){keysDown[82]?W.location.reload(!0):keysDown[83]?stop?(stop=!1,run()):stop=!0:keysDown[32]&&tryJump(),setKey(e,!1)}function keyDown(e){setKey(e,!0)}function resize(){width=gl.canvas.clientWidth,height=gl.canvas.clientHeight,gl.canvas.width=width,gl.canvas.height=height,widthToGl=2/width,heightToGl=2*(ymax=height/width)/height,setPerspective(projMat,.125*M.PI,width/height,.1,horizon)}function calculateNormals(e,t){for(var r=[],i=0,a=t.length;i<a;){var o=3*t[i++],n=3*t[i++],l=3*t[i++],g=e[o],s=e[o+1],d=e[o+2],h=e[n]-g,u=e[n+1]-s,c=e[n+2]-d,f=(g=e[l]-g,s=e[l+1]-s,e[l+2]-d);d=u*f-c*s,c=c*g-h*f,h=h*s-u*g;r[o]=d,r[o+1]=c,r[o+2]=h,r[n]=d,r[n+1]=c,r[n+2]=h,r[l]=d,r[l+1]=c,r[l+2]=h}return r}function createModel(e,t){var r={count:t.length};return r.vertices=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r.vertices),gl.bufferData(gl.ARRAY_BUFFER,new FA(e),gl.STATIC_DRAW),r.normals=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r.normals),gl.bufferData(gl.ARRAY_BUFFER,new FA(calculateNormals(e,t)),gl.STATIC_DRAW),r.indicies=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,r.indicies),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),gl.STATIC_DRAW),r}function createCube(){return createModel([-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,1,-1,1,1,-1],[0,1,3,0,3,2,4,5,7,4,7,6,8,9,11,8,11,10,12,13,15,12,15,14,16,17,19,16,19,18,20,21,23,20,23,22])}function createEntities(){entities=[];for(var e=createCube(),t=tilesLength;t--;){var r=new FA(idMat);translate(r,r,wayX,wayY,wayZ),scale(r,r,tileMag,tileHeight,tileMag),entities.push({origin:new FA(r),matrix:r,model:e,color:getTileColor(),delta:M.sin(t),base:-256,drop:!1,update:function(e){translate(this.matrix,this.origin,0,this.base+M.sin(this.delta+.002*e),0),this.drop||0==this.base||(this.base*=.9,.1>M.abs(this.base)&&(this.base=0,ready||(ready=!0)))}}),pursue()}translate(r=new FA(idMat),r,0,.5,0),scale(r,r,.25,.25,.25),entities.push(cursor={origin:r,matrix:new FA(r),model:e,color:[1,1,1,1],roll:8,update:function(e){ready&&(this.roll+=speed/-.1),rotate(this.matrix,this.origin,-.05*this.roll,1,.1,.1)}}),entitiesLength=entities.length}function reset(){score=0,speed=-.1,targetX=shift=0,jump=ready=stop=!1,wayX=wayY=wayZ=lost=0,wayStraights=3,wayDir=M.random(),wayIndex=0,setLight(0,0,0),setCamera(0,0,0),createEntities(),messageVisible=!1,setMessage("")}function cacheUniformLocations(e,t){void 0===e.uniforms&&(e.uniforms={});for(var r=0,i=t.length;r<i;++r){var a=t[r],o=gl.getUniformLocation(e,a);if(!o)throw'uniform "'+a+'" not found';e.uniforms[a]=o}}function cacheAttribLocations(e,t){void 0===e.attribs&&(e.attribs={});for(var r=0,i=t.length;r<i;++r){var a=t[r],o=gl.getAttribLocation(e,a);if(0>o)throw'attribute "'+a+'" not found';gl.enableVertexAttribArray(o),e.attribs[a]=o}}function cacheLocations(e,t,r){cacheAttribLocations(e,t),cacheUniformLocations(e,r)}function compileShader(e,t){var r=gl.createShader(t);gl.shaderSource(r,e),gl.compileShader(r);var i=gl.getShaderInfoLog(r);if(0<i.length)throw i;if(!gl.getShaderParameter(r,gl.COMPILE_STATUS))throw"cannot compile shader";return r}function linkProgram(e,t){var r=gl.createProgram();if(gl.attachShader(r,e),gl.attachShader(r,t),gl.linkProgram(r),!gl.getProgramParameter(r,gl.LINK_STATUS))throw Error(gl.getProgramInfoLog(r));return r}function buildProgram(e,t){return linkProgram(compileShader(e,gl.VERTEX_SHADER),compileShader(t,gl.FRAGMENT_SHADER))}function createPrograms(){cacheLocations(shadowProgram=buildProgram(D.getElementById("LightVertexShader").textContent,D.getElementById("LightFragmentShader").textContent),["vertex"],["lightProjMat","lightModelViewMat"]),cacheLocations(program=buildProgram(D.getElementById("VertexShader").textContent,D.getElementById("FragmentShader").textContent),["vertex","normal"],"projMat modelViewMat normalMat lightProjMat lightModelViewMat lightDirection far sky color shadowDepthTexture".split(" ")),shadowProgram.attribs.normal=1}function createShadowBuffer(){shadowFramebuffer=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,shadowFramebuffer),shadowDepthTexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,shadowDepthTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,shadowDepthTextureSize,shadowDepthTextureSize,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var e=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,e),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,shadowDepthTextureSize,shadowDepthTextureSize),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,shadowDepthTexture,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,e),gl.bindTexture(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null)}function createLight(){setOrthogonal(lightProjMat,-10,10,-10,10,-20,60),translate(staticLightViewMat,idMat,0,0,-55),rotate(staticLightViewMat,staticLightViewMat,.25*M.PI2,1,.5,0)}function createCamera(){translate(camMat,idMat,0,0,-10),rotate(camMat,camMat,.9,1,0,0)}function getContext(){for(var e,t=D.getElementById("Canvas"),r=["webgl","experimental-webgl"],i=r.length,a=0;a<i;++a)if(e=t.getContext(r[a],{alpha:!1}))return e}function init(){(gl=getContext())?(message=D.getElementById("Message"),createCamera(),createLight(),createShadowBuffer(),createPrograms(),reset(),gl.enable(gl.DEPTH_TEST),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),W.onresize=resize,resize(),D.onkeydown=keyDown,D.onkeyup=keyUp,D.onmousedown=pointerDown,D.onmousemove=pointerMove,D.onmouseup=pointerUp,D.onmouseout=pointerCancel,"ontouchstart"in D&&(D.ontouchstart=pointerDown,D.ontouchmove=pointerMove,D.ontouchend=pointerUp,D.ontouchleave=pointerCancel,D.ontouchcancel=pointerCancel),run()):alert("WebGL not available")}M.PI2=M.PI2||M.PI/2,M.TAU=M.TAU||2*M.PI,W.onload=init</script>