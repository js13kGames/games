<!doctype html><title>SHAKE</title><style>body,html{margin:0;padding:0;width:100%;height:100%}canvas{position:absolute;margin:0}</style><canvas id=c></canvas><script>var snakeColor,snakeTailColor,snakeHeadColor,meatColor,canvas,ctx,canvas_jeu,ctx_jeu,boardTab,snakeHead,snakeTail,timeCompteur,timeForAction,timeForGlitch,statut,iLoop,action,lastAction,tailleSerpent,glitches,affGlitch,imgTitre,displayOrder,partsSwap,audio,oscillator1,oscillator2,gainAudio,gainAudio2,score,imgScore,nbCasesWidth=20,nbCasesHeight=20,snakeBodyWidth=16,width=nbCasesWidth*snakeBodyWidth+nbCasesWidth-1,height=nbCasesHeight*snakeBodyWidth+nbCasesHeight-1,midWidth=width/2|0,midHeight=height/2|0,backGroundColor="#554",snakeFailColor="#777",lastChance=0,titrePix=[5,0],selec=0;function init(){snakeHeadColor="#191",snakeColor=snakeTailColor="#272",meatColor="#fff",statut="t",drawTitre(),iLoop=setInterval(loop,30),oscillator2.frequency.value=110}function changeTitre(){document.title="N"==document.title[1]?"SHAKE":"SNAKE","t"==statut&&(timeForGlitch=6,titrePix[1]=1+titrePix[1]%2,playGlitch()),setTimeout(changeTitre,2500)}function drawTitre(){ctx_jeu.drawImage(imgTitre,0,0),ctx_jeu.fillStyle=snakeColor,ctx_jeu.fillRect(titrePix[0]*(snakeBodyWidth+1)-1,titrePix[1]*(snakeBodyWidth+1)-1,snakeBodyWidth+1,snakeBodyWidth+1);for(var e=selec*midWidth,t=ctx_jeu.getImageData(e,midHeight,midWidth,midHeight),i=t.data,a=i[0],n=0;n<i.length;n+=4)i[n]!=a&&(i[n+1]+=50,change=!0);ctx_jeu.putImageData(t,e,midHeight),ctx.drawImage(canvas_jeu,0,0)}function initJeu(){score=0,(boardTab=new Array(nbCasesWidth)).fill(!1),boardTab.forEach((function(e,t){boardTab[t]=new Array(nbCasesHeight)})),displayOrder=[[{x:0,y:0},{x:0,y:1}],[{x:1,y:0},{x:1,y:1}]],tailleSerpent=0,snakeTail=new serpentBody(3,8,1),new serpentBody(4,8,1,snakeTail),new serpentBody(5,8,1,boardTab[4][8]),snakeHead=new serpentBody(6,8,0,boardTab[5][8]),timeCompteur=0,timeForAction=5.3,timeForGlitch=selec?24:12,action=[],setMeat(),display(),statut="p",selec&&(oscillator2.frequency.value=830)}function display(){if(ctx_jeu.fillStyle=backGroundColor,ctx_jeu.clearRect(0,0,width,height),ctx_jeu.fillRect(0,0,width,height),ctx.fillRect(0,0,width,height),ctx_jeu.fillStyle=snakeColor,boardTab.forEach((function(e){e.forEach((function(e){e&&drawBody(e)}))})),affGlitch)shake();else if(selec){var e;if("g"==statut&&timeCompteur){var t=1-timeCompteur/timeForGlitch;t<0&&(t=0),partsSwap.forEach((function(i){e=displayOrder[i.x][i.y],ctx.drawImage(canvas_jeu,e.x*midWidth,e.y*midHeight,midWidth,midHeight,i.x*midWidth+i.dirX*midWidth*t,i.y*midHeight+i.dirY*midHeight*t,midWidth,midHeight)}))}else for(var i=0;i<2;i++)for(var a=0;a<2;a++)e=displayOrder[i][a],ctx.drawImage(canvas_jeu,e.x*midWidth,e.y*midHeight,midWidth,midHeight,i*midWidth,a*midHeight,midWidth,midHeight)}else ctx.drawImage(canvas_jeu,0,0)}function drawBody(e){if(e.meat)return ctx_jeu.fillStyle=meatColor,void ctx_jeu.fillRect(e.x*(snakeBodyWidth+1),e.y*(snakeBodyWidth+1),snakeBodyWidth,snakeBodyWidth);ctx_jeu.fillStyle=e==snakeTail?snakeTailColor:e==snakeHead?snakeHeadColor:e.meat?meatColor:snakeColor,ctx_jeu.fillRect(e.x*(snakeBodyWidth+1)-e.testDir(4),e.y*(snakeBodyWidth+1)-e.testDir(8),snakeBodyWidth+e.testH(),snakeBodyWidth+e.testV())}function loop(){if("t"==statut)return drawTitre(),void(timeForGlitch>0&&(shake(),timeForGlitch--));if("g"==statut){if(0==timeCompteur)return void(statut="p");if(!selec)if(timeCompteur<timeForGlitch-6){snakeHead.dir=snakeHead.prec.dir;for(var e,t,i,a=getDest(snakeHead),n=0;n<glitches.length;n++)t=((e=glitches[n]).x+rand(3)-1)%nbCasesWidth,i=(e.y+rand(3)-1)%nbCasesHeight,t<0&&(t+=nbCasesWidth),i<0&&(i+=nbCasesHeight),boardTab[t][i]||t==a.x&&i==a.y||e.setCoor(t,i);snakeHead.dir=0}else affGlitch=0}else if(0==timeCompteur){var o=snakeHead.prec.dir;snakeHead.dir=lastAction&&lastAction!=(o>>2||o<<2)?lastAction:o;a=getDest(snakeHead);var r=boardTab[a.x][a.y];if(r&&!r.meat&&r!=snakeTail){if(lastChance<10)return void lastChance++;snakeColor=snakeTailColor=snakeHeadColor=snakeFailColor,meatColor=backGroundColor,statut="f",clearInterval(iLoop),display();var s=(width-(48*(score=""+score).length+score.length-1))/2|0,d=(height-80)/2|0;for(n=0;n<score.length;n++)console.log("i: "+score[n]+" x : "+3*"0123456789".indexOf(score[n])),ctx.drawImage(imgScore,48*"0123456789".indexOf(score[n]),0,48,80,s+49*n,d,48,80);return}lastChance&&(lastChance=0),r&&r!=snakeTail?getMeat():snakeTail=snakeTail.supp(),snakeHead=new serpentBody(a.x,a.y,0,snakeHead),lastAction=0}timeCompteur="p"==statut&&timeCompteur>timeForAction||"g"==statut&&timeCompteur>timeForGlitch?0:timeCompteur+1,display()}function testKeyDown(e){var t=testKey(e.keyCode);"t"==statut?1&t||4&t?selec=(selec+1)%2:13!=e.keyCode&&32!=e.keyCode||initJeu():"f"==statut?13!=e.keyCode&&32!=e.keyCode||init():t&&(lastAction=t,action.indexOf(t)<0&&action.unshift(t))}function testKeyUp(e){var t=testKey(e.keyCode);if("t"!=statut&&t){var i=action.indexOf(t);i>-1&&(action.splice(i,1),lastAction==t&&action.length>0&&(lastAction=action[0]))}}function testKey(e){switch(e){case 39:return 1;case 40:return 2;case 37:return 4;case 38:return 8}}function getDest(e){var t={};return t.x=e.x+e.testDir(1)-e.testDir(4),t.y=e.y+e.testDir(2)-e.testDir(8),t.x<0&&(t.x=nbCasesWidth-1),t.y<0&&(t.y=nbCasesHeight-1),t.x==nbCasesWidth&&(t.x=0),t.y==nbCasesHeight&&(t.y=0),t}function setMeat(){var e,t;do{e=rand(nbCasesWidth),t=rand(nbCasesHeight)}while(boardTab[e][t]);boardTab[e][t]={meat:1,x:e,y:t}}function getMeat(){if(statut="g",score++,setMeat(),timeForAction>1&&(timeForAction-=.1),playGlitch(),selec){var e,t=snakeHead.x/(nbCasesWidth/2)|0,i=snakeHead.y/(nbCasesHeight/2)|0;for(o=0;o<displayOrder.length;o++)for(var a=0;a<displayOrder[o].length;a++)if((e=displayOrder[o][a]).x==t&&e.y==i)return void swap(o,a)}else{glitches=[];for(var n=snakeHead.prec,o=0;o<tailleSerpent/4;o++)n=n.prec;for(;glitches.length<tailleSerpent/4;)glitches.push(n),n=n.prec;affGlitch=1}}function rand(e){return Math.random()*e|0}function shake(){var e=height/4+rand(height/2)|0,t=height-e;ctx.drawImage(canvas_jeu,0,0,width,t,0,e,width,t),ctx.drawImage(canvas_jeu,0,e,width,e,0,0,width,e)}function swap(e,t){var i=displayOrder[e][t],a=rand(2),n=(e+a)%2,o=(t+a+1)%2;displayOrder[e][t]=displayOrder[n][o],displayOrder[n][o]=i,dirSwapX=n-e,dirSwapY=o-t,partsSwap=[{x:(e+1)%2,y:(t+1)%2,dirX:0,dirY:0},{x:(n+1)%2,y:(o+1)%2,dirX:0,dirY:0},{x:e,y:t,dirX:dirSwapX,dirY:dirSwapY},{x:n,y:o,dirX:-dirSwapX,dirY:-dirSwapY}]}function createAudio(){audio=new(window.AudioContext||window.webkitAudioContext),oscillator1=audio.createOscillator(),oscillator2=audio.createOscillator(),gainAudio=audio.createGain(),gainAudio2=audio.createGain(),oscillator1.type="square",oscillator2.detune=10,oscillator2.type="triangle",oscillator2.connect(gainAudio),oscillator2.frequency.value=110,gainAudio.connect(oscillator1.frequency),gainAudio.gain.value=1e3,oscillator1.connect(gainAudio2),gainAudio2.connect(audio.destination),oscillator2.start(),oscillator1.start(),gainAudio2.gain.value=0}function playGlitch(){gainAudio2.gain.value=.2,setTimeout((function(){gainAudio2.gain.value=0}),selec?500:250)}window.onload=function(){canvas=document.getElementById("c"),(canvas_jeu=document.createElement("canvas")).width=canvas.width=width,canvas_jeu.height=canvas.height=height,canvas.style.left=(window.innerWidth-width)/2+"px",canvas.style.top=(window.innerHeight-height)/2+"px",(ctx=canvas.getContext("2d")).fillStyle=backGroundColor,(ctx_jeu=canvas_jeu.getContext("2d")).imageSmoothingEnabled=ctx.imageSmoothingEnabled=!0,(imgTitre=document.createElement("img")).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVMAAAFTCAMAAACzlR9GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFInciVVVEcsCGWwAAAjhJREFUeNrs3DEOhDAMRUHn/pempwGi2LHCvDpI1pR/pY343Lj3/GLikyg5LOWOYMqUKVOmTJkyZcqUKVOmTJkyZcqU6Zmm43s1pm1frPiEKVOmTJkyZcqUKVOmTJkyZcqUKVOmTP9pWjOnd9noVwAxZcqUKVOmTJkyZcqUKVOmTJkyZcqUKdO3p5dM8ikefXd+pkyZMmXKlClTpkyZMmXKlClTpkyZMmU6OWN3Me3yIiWmTJkyZcqUKVOmTJkyZcqUKVOmTJky/Yfp0OqYMmXKVEyZMhVTpkzFlClTMWXKVEyZMhVTpkyZiilTpmLKlKmYMmUqpkyZiilTpmLKlKmYMmXKVEyZMhVTpkzFlClTMWXKVEyZMhVTpkzFlClTpmLKlKmYMmUqpkyZiilTpmLKlKmYMmUqpkyZMhVTpkzFlClTMWXKVEyZMlWuaSxonHQHU6ZMmTJlypQpU6ZMmTJlypQpU6ZMmTKtM921r3e5gylTpkyZMmXKlClTpkyZMmXKlClTpkyZbjS18zNlypQpU6ZMmTJlypQpU6ZMmTJlypQp0207/9E/DTBlypQpU6ZMmTJlypQpU6ZMmTJlypQp00JT/4fClClTpkyZMmXKlClTpkyZMmXKlClTpkyTTMWUKVMxZcqUqZgyZSqmTJmKKVOmYsqUqZgyZSqmTJmKKVOmTMWUKVMxZcpUTJkyFVOmTMWUKVMxZcqUqZgyZSqmTJmKKVOmYsqUqZgyZSqmTJmKaV6XAAMAqcJlhzVSd0gAAAAASUVORK5CYII=",(imgScore=document.createElement("img")).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAABQCAMAAAD2t1ZmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////////VXz1bAAAAAJ0Uk5T/wDltzBKAAAA+UlEQVR42uzaMQ7AIAwDwPT/n+4TKhSgpj2vLBY3OlWDuR5SLye9X3wAA9YPMGDAgH0gYMCAAQtgwIAB6wcYMGDAgAEDFsC/ARx97354Fyit3+7+gAEDBgwYMGDAgAEDBgwYMGDAgAEDBgwYMGDAgAEDBjwLePagfvpAH39wABgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCbBvnRdPusPijY/R43+AMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDDgW+LRBO73PcQcNgAHrAxgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMG/BXgW4ABAOlBLwE+OkCgAAAAAElFTkSuQmCC",createAudio(),document.addEventListener("keydown",testKeyDown),document.addEventListener("keyup",testKeyUp),init(),changeTitre()};var serpentBody=function(e,t,i,a,n){this.x=e,this.y=t,this.dir=i,a&&(a.suiv=this),this.prec=a,this.suiv=n,boardTab[e][t]=this,tailleSerpent++};serpentBody.prototype={testDir:function(e){return Boolean(this.dir&e)},testH:function(){return Boolean(5&this.dir)},testV:function(){return Boolean(10&this.dir)},supp:function(){return boardTab[this.x][this.y]=null,tailleSerpent--,this.suiv},setCoor:function(e,t){boardTab[this.x][this.y]=null,boardTab[e][t]=this,this.x=e,this.y=t}}</script>