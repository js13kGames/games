<!doctype html><meta name=viewport content="width=device-width"><title>Area 404 - Signal Not Found - js13kGames 2020</title><style>body{margin:0;padding:0}canvas{display:block}</style><body><script type=module>import*as n from"/2020/webxr/three.js";function r(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},o[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var o=[function(e,t){e.exports=n},function(e,t,n){n.r(t);var o,r,f=n(0);function i(){(e=new f.Shape).moveTo(0,-1),e.lineTo(.3,-1),e.lineTo(.6,-.6),e.lineTo(.9,-.2),e.lineTo(1.1,0),e.lineTo(1,.1),e.lineTo(.8,0),e.lineTo(.6,-.1),e.lineTo(.4,1),e.lineTo(-.3,1),e.lineTo(-.5,0),e.lineTo(-.5,-.6),e.lineTo(-.3,-1);var e=new f.ExtrudeBufferGeometry(e,{steps:1,depth:.2,bevelEnabled:!1}),t=(e.computeBoundingBox(),new f.MeshLambertMaterial({color:6710886}));return(e=new f.Mesh(e,t)).scale.set(.08,.08,.08),e.rotation.x=-.75*Math.PI,e.rotation.y=-Math.PI/2,e.castShadow=!0,e.name="hand",e}function w(e,t){var{depth:t,close:n,cap:o,direction:r}=t;return e=function(t,n,o,r){const a=[],s=[],l=[];function i(e,t,n){var o=new f.Vector3(t.x+n[0],t.y+n[1],t.z+n[2]),r=(n=new f.Vector3(e.x+n[0],e.y+n[1],e.z+n[2]),(new f.Vector3).subVectors(t,e)),i=(new f.Vector3).subVectors(o,t),r=r.cross(i),i=a.length/3;a.push(...e.toArray()),a.push(...t.toArray()),a.push(...o.toArray()),a.push(...n.toArray()),e=r.toArray(),s.push(...e,...e,...e,...e),l.push(i,1+i,3+i),l.push(1+i,2+i,3+i)}for(let e=0;e<t.length-3;e+=3)i(new f.Vector3(t[e],t[e+1],t[e+2]),new f.Vector3(t[e+3],t[e+4],t[e+5]),n);if(o){const o=t.length-3;i(new f.Vector3(t[o],t[1+o],t[2+o]),new f.Vector3(t[0],t[1],t[2]),n)}if(r){const o=[],r=new f.Vector3(...n).normalize(),i=r.clone().multiplyScalar(-1),c=a.length/3;for(let e=0;e<t.length;e+=3)o.push(new f.Vector2(t[e],t[e+1])),a.push(t[e],t[e+1],t[e+2]),s.push(...i.toArray());const d=a.length/3;for(let e=0;e<t.length;e+=3)a.push(t[e]+n[0],t[e+1]+n[1],t[e+2]+n[2]),s.push(...r.toArray());o.push(new f.Vector2(t[0],t[1])),a.push(t[0],t[1],t[2]);var e=f.ShapeUtils.triangulateShape(o,[]);e.forEach(e=>{l.push(e[0]+c),l.push(e[2]+c),l.push(e[1]+c)}),e.forEach(e=>{l.push(e[0]+d),l.push(e[1]+d),l.push(e[2]+d)})}return{vertices:a,normals:s,indices:l}}(e,r||[0,0,t],n,o),(r=new f.BufferGeometry).setIndex(e.indices),r.setAttribute("position",new f.BufferAttribute(new Float32Array(e.vertices),3)),r.setAttribute("normal",new f.BufferAttribute(new Float32Array(e.normals),3)),r}let m,b,d;function v(e,t){let n=t.hubs,o=new f.Vector3;e.grip.getWorldPosition(o);var r=function(o,r,e){const i=[null,Number.MAX_VALUE];return e.forEach(e=>{null!=(t=r.geometry.boundingBox.clone())&&t.applyMatrix4(r.matrixWorld),null!=(n=e.geometry.boundingBox.clone())&&n.applyMatrix4(e.matrixWorld);var t=null==t?void 0:t.intersectsBox(n),n=o.distanceTo(e.position);t&&n<i[1]&&(i[0]=e,i[1]=n)}),i[0]}(o,e.grip.children[0],n);if(r){if(e.selecting){if(!e.wasSelecting){e.wasSelecting=!0;const t=new f.Quaternion,n=(t.copy(e.grip.quaternion),e.grip.userData.startQuaternion=t,new f.Quaternion);n.copy(r.quaternion),e.grip.userData.hubStartQuaternion=n}const t=new f.Quaternion,n=(t.copy(e.grip.userData.startQuaternion),new f.Quaternion),o=(n.copy(e.grip.userData.hubStartQuaternion),new f.Quaternion);o.copy(e.grip.quaternion),t.inverse();var i=new f.Quaternion;i.copy(o),i.multiply(t),i.multiply(n),r.setRotationFromQuaternion(i)}}else e.wasSelecting=!1}const x=new f.Raycaster;function M(e,t,n){var o=new f.Group,r=(r=n.dimensions.x,w([0,0,-(i=(l=n.dimensions.z)/2),(r/=2)-.5,0,-i,r,.5,-i,r,2.5,-i,r-.5,3,-i,.5-r,3,-i,-r,2.5,-i,-r,.5,-i,.5-r,0,-i,0,0,-i],{depth:l})),i=new f.MeshLambertMaterial({color:13421772,side:f.BackSide}),a=n.dimensions.x/2,s=n.dimensions.z/2,l=new f.MeshLambertMaterial({color:13421772}),c=new f.Mesh(new f.BoxGeometry(n.dimensions.x,3,.125),l),d=new f.Mesh(new f.BoxGeometry(a-1,3,.15),l),u=(l=new f.Mesh(new f.BoxGeometry(a-1,3,.15),l),o.add(c),o.add(d),o.add(l),(r=new f.Mesh(r,i)).name="Corridor",o.add(r),w([.25,3,0,1.5,2.75,0,1.75,2.375,0,1.75,1.25,0,1.5,1,0,1.5,.5,0,1,0,0,2,0,0,2,3,0],{depth:.25,cap:r.receiveShadow=!0})),p=new f.MeshLambertMaterial({color:267807795}),h=[];c.position.set(0,1.5,s),d.position.set(-a/2-1,1.5,-s),l.position.set(a/2+1,1.5,-s),t.rig.position.set(0,t.rig.position.y,s-1);for(let e=-s;e<=s;e+=5){const t=new f.Mesh(u,p),n=(t.position.set(a-2,0,e-.125),o.add(t),t.userData.obstacle=!0,h.push(t),new f.Mesh(u,p));n.scale.set(-1,1,1),n.position.set(2-a,0,e-.125),n.userData.obstacle=!0,o.add(n),h.push(n)}var g=new f.BoxGeometry(2,3,2);for(let e=0;e<n.pillarPositions.length;e+=2){const t=new f.Mesh(g,p);t.position.set(n.pillarPositions[e],1.5,n.pillarPositions[e+1]),o.add(t),t.userData.obstacle=!0,h.push(t)}i=new f.BoxGeometry(2,3,.125),r=new f.MeshLambertMaterial({color:13421772}),c=new f.Mesh(i,r),i=new f.Mesh(i,r),(r=new f.Group).add(c),r.add(i),c.position.set(-1,1.5,0),i.position.set(1,1.5,0),(d={open:!1,delta:.01,value:0,group:r,leftDoor:c,rightDoor:i}).group.position.setZ(-s),o.add(d.group),l=new f.BoxGeometry(.25,.25,.25),t=new f.MeshLambertMaterial({color:16711680}),l=new f.Mesh(l,t),t=new f.BoxGeometry(.25,1,.25);var r=new f.MeshLambertMaterial({color:16777215}),[c,i]=[new f.Mesh(t,r),l];return c.position.set(-1,.5,1-s),i.position.set(-1,1.125,1-s),o.add(c),o.add(i),{obstacles:h,trigger:i,door:d,hubs:function(t,n){var o=new f.BoxGeometry(.02,.25,.25),r=(o.computeBoundingBox(),[]);for(let e=0;e<n.length;e+=3){var i=new f.MeshLambertMaterial({color:3355443});(i=new f.Mesh(o,i)).castShadow=!0,i.position.set(n[e],n[e+1],n[e+2]),i.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),t.add(i),r.push(i)}return r}(o,n.hubPositions),group:o}}const S=new Float32Array(33);function B(e,t,n,o){return(t=t.clone()).addScaledVector(n,e),t.addScaledVector(o,.5*Math.pow(e,2)),t}const V=function(){function e(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}d=new f.Group,(b=new f.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,1e3)).position.y=1.75,(b.userData.rig=d).add(b),(m=new f.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),document.body.appendChild(m.domElement),document.body.appendChild((r=m,"xr"in navigator?((i=document.createElement("button")).id="VRButton",i.style.display="none",e(i),navigator.xr.isSessionSupported("immersive-vr").then(function(e){if(e){let t=null;function n(e){e.addEventListener("end",o),r.xr.setSession(e),i.textContent="EXIT VR",t=e}function o(){t.removeEventListener("end",o),i.textContent="ENTER VR",t=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===t?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking"]}).then(n):t.end()}}else i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,i.textContent="VR NOT SUPPORTED"}),i):(t=document.createElement("a"),!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",e(t),t))),m.xr.enabled=!0,m.shadowMap.enabled=!0,m.shadowMap.type=f.PCFSoftShadowMap;var r,i,[t,n]=[m,b],o=new f.Scene,a=(o.add(n.userData.rig),t.xr.getController(0)),s=(a.addEventListener("connected",function(e){}),t.xr.getControllerGrip(0));n.userData.rig.add(s);const l={grip:s,selecting:!1,squeezing:!1,wasSelecting:!1,wasSqueezing:!1},c=(a.addEventListener("selectstart",()=>{l.selecting=!0}),a.addEventListener("selectend",()=>{l.selecting=!1}),(s=t.xr.getController(1)).addEventListener("connected",function(e){}),a=t.xr.getControllerGrip(1),n.userData.rig.add(a),{grip:a,selecting:!1,squeezing:!1,wasSelecting:!1,wasSqueezing:!1});return s.addEventListener("selectstart",()=>{c.selecting=!0}),s.addEventListener("selectend",()=>{c.selecting=!1}),{renderer:t,camera:n,scene:o,rig:n.userData.rig,left:l,right:c}}();V.left.grip.add(i()),V.right.grip.add(i());let P=2;const D=[{dimensions:{x:4,z:5},hubPositions:[.5,1,-.5,-.5,1,-1.5],pillarPositions:[],beam:{origin:new f.Vector3(-1.5,2.5,2.5)}},{dimensions:{x:10,z:8},hubPositions:[-1,1,1,2,1,-1,-.5,1.5,-3,1,1.5,-3],pillarPositions:[2.5,-3,2.5,3,-2.5,-3,-2.5,3],beam:{origin:new f.Vector3(-5,3,-2)}},{dimensions:{x:6,z:5},hubPositions:[1,1,1,-.5,1.5,-3,1,1.5,-3],pillarPositions:[-2.5,-2,2.5,-0,-2.5,2],beam:{origin:new f.Vector3(0,1,2.5)}}];(t=V.scene).fog=new f.FogExp2(2241416,.1),t.background=new f.Color(2241416),t.add(new f.HemisphereLight(8947763,3355494,.3)),(n=new f.DirectionalLight(16777215,.75)).position.set(0,4,.1).normalize(),n.castShadow=!0,n.shadow.mapSize.set(4096,4096),n.shadow.camera.near=-1,n.shadow.camera.far=5,n.shadow.camera.left=-10,n.shadow.camera.right=10,n.shadow.camera.top=10,n.shadow.camera.bottom=-10,t.add(n);let A=M(V.scene,V,D[P]);V.scene.add(A.group),t=V.scene,(n=new f.LineBasicMaterial({color:16711680})).linewidth=3,o=new Float32Array(30),(r=new f.BufferGeometry).setAttribute("position",new f.BufferAttribute(o,3)),r.setDrawRange(0,0),o=new f.Line(r,n),t.add(o);const E=r,L=(V.scene,n=new f.MeshBasicMaterial({color:8930321,opacity:.75,blending:f.AdditiveBlending,side:f.DoubleSide,depthWrite:!1,transparent:!0}),t=new f.CylinderGeometry(.25,.25,.5,void 0,void 0,!0),new f.Mesh(t,n)),T=(V.rig.add(L),L.position.z=-4,L.position.y=0,L.visible=!1,o=new f.BufferGeometry,S.fill(0),o.setAttribute("position",new f.BufferAttribute(S,3)),r=new f.LineBasicMaterial({color:8930321,opacity:.75,blending:f.AdditiveBlending,side:f.DoubleSide,depthWrite:!1,transparent:!0,linewidth:5}),(o=new f.Line(o,r)).frustumCulled=!1,o);V.rig.add(T);let z=!1,C=0;V.renderer.setAnimationLoop(()=>{C++,v(V.left,A),v(V.right,A);var e,t=V.camera,a=V.renderer,s=T,n=L,o=new f.Vector3;if(a.xr.getSession()){a.xr.getCamera(t).getWorldPosition(o).y=0;var t=a.xr.getController(0),r=new f.Vector3,i=(t.getWorldPosition(r),new f.Vector3),l=(t.getWorldDirection(i),i.multiplyScalar(6),new f.Vector3(0,-9.8,0)),c=(-i.y+Math.sqrt(Math.pow(i.y,2)-2*r.y*l.y))/l.y,d=(a=s.geometry,o.set(0,0,0));for(let e=0;e<11;e++)d.copy(B(e*c/10,r,i,l)),d.toArray(S,3*e);n.position.copy(B(c,r,i,l)),a.attributes.position.needsUpdate=!0}{var u=A,p=D[P],h=E;let e,{trigger:t,hubs:n}=u,o=new f.Vector3(p.hubPositions[0],p.hubPositions[1],p.hubPositions[2]),r=(o.addScaledVector(p.beam.origin,-1).normalize(),p=new f.Ray(p.beam.origin,o),null),i=(x.ray.origin.copy(p.origin),x.ray.direction.copy(p.direction),h.attributes.position.setXYZ(0,x.ray.origin.x,x.ray.origin.y,x.ray.origin.z),1);for(t.userData.activated=!1;;){var g=[...n.filter(e=>e!==r),...u.obstacles,t],w=x.intersectObjects(g),g=0<w.length?w[0].distance:50;if(h.attributes.position.setXYZ(i,x.ray.origin.x+x.ray.direction.x*g,x.ray.origin.y+x.ray.direction.y*g,x.ray.origin.z+x.ray.direction.z*g),i++,!(0<w.length))break;{if(w[0].object===t){t.userData.activated=!0;break}if(1==w[0].object.userData.obstacle)break;const a=w[0],s=(x.ray.origin.copy(a.point),r=a.object,null==(e=a.face)?void 0:e.normal.clone());null!=s&&s.applyQuaternion(r.quaternion),x.ray.direction.reflect(s)}if(0==w.length||10<i)break}h.setDrawRange(0,i),h.attributes.position.needsUpdate=!0}var{door:a,trigger:p}=A,y=(a.open=p.userData.activated,128+127*Math.sin(.15*C));if(p.material.emissive.setHex(p.userData.activated?y<<8:y<<16),a.open&&a.value<1?a.value+=a.delta:!a.open&&0<a.value&&(a.value-=a.delta),a.leftDoor.position.setX(-1-a.value),a.rightDoor.position.setX(1+a.value),t=V.renderer.xr.getSession()){if(p=(null==(e=t.inputSources[0].gamepad)?void 0:e.axes[3])||0,y=.2<Math.abs(p),z){if(!y){const e=new f.Vector3;L.getWorldPosition(e),V.rig.position.copy(e),z=!1,a.open=!a.open}}else y&&(z=!0);L.visible=y,T.visible=y}s=V.rig,o=D[P].dimensions.z/2,s.position.z<-o&&(++P==D.length&&(P=0),V.scene.remove(A.group),A=M(V.scene,V,D[P]),V.scene.add(A.group)),n=V.scene,m.render(n,b)})}],i={};r.m=o,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)</script>