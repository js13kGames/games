!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=THREE},function(e,t,n){"use strict";n.r(t);var o=n(0);function r(e){const t=function(){const e=new o.Shape;return e.moveTo(0,-1),e.lineTo(.3,-1),e.lineTo(.6,-.6),e.lineTo(.9,-.2),e.lineTo(1.1,0),e.lineTo(1,.1),e.lineTo(.8,0),e.lineTo(.6,-.1),e.lineTo(.4,1),e.lineTo(-.3,1),e.lineTo(-.5,0),e.lineTo(-.5,-.6),e.lineTo(-.3,-1),new o.ExtrudeBufferGeometry(e,{steps:1,depth:.2,bevelEnabled:!1})}();t.computeBoundingBox();const n=new o.MeshLambertMaterial({color:6710886}),r=new o.Mesh(t,n);return r.scale.set(.08,.08,.08),r.rotation.x=-.75*Math.PI,r.rotation.y=-Math.PI/2,r.castShadow=!0,r.name="hand",r}function i(e,t){const{depth:n,close:r,cap:i,direction:s}=t,a=function(e,t,n,r,i){const s=[],a=[],c=[];function l(e,t,n){const r=new o.Vector3(t.x+n[0],t.y+n[1],t.z+n[2]),i=new o.Vector3(e.x+n[0],e.y+n[1],e.z+n[2]),l=(new o.Vector3).subVectors(t,e),u=(new o.Vector3).subVectors(r,t),d=l.cross(u),p=s.length/3;s.push(...e.toArray()),s.push(...t.toArray()),s.push(...r.toArray()),s.push(...i.toArray());const h=d.toArray();a.push(...h,...h,...h,...h),c.push(p,p+1,p+3),c.push(p+1,p+2,p+3)}for(let n=0;n<e.length-3;n+=3){l(new o.Vector3(e[n],e[n+1],e[n+2]),new o.Vector3(e[n+3],e[n+4],e[n+5]),t)}if(n){const n=e.length-3;l(new o.Vector3(e[n],e[n+1],e[n+2]),new o.Vector3(e[0],e[1],e[2]),t)}if(r){const n=[],r=new o.Vector3(...t).normalize(),i=r.clone().multiplyScalar(-1),l=s.length/3;for(let t=0;t<e.length;t+=3)n.push(new o.Vector2(e[t],e[t+1])),s.push(e[t],e[t+1],e[t+2]),a.push(...i.toArray());const u=s.length/3;for(let n=0;n<e.length;n+=3)s.push(e[n]+t[0],e[n+1]+t[1],e[n+2]+t[2]),a.push(...r.toArray());n.push(new o.Vector2(e[0],e[1])),s.push(e[0],e[1],e[2]);const d=o.ShapeUtils.triangulateShape(n,[]);d.forEach(e=>{c.push(e[0]+l),c.push(e[2]+l),c.push(e[1]+l)}),d.forEach(e=>{c.push(e[0]+u),c.push(e[1]+u),c.push(e[2]+u)})}return{vertices:s,normals:a,indices:c}}(e,s||[0,0,n],r,i),c=new o.BufferGeometry;return c.setIndex(a.indices),c.setAttribute("position",new o.BufferAttribute(new Float32Array(a.vertices),3)),c.setAttribute("normal",new o.BufferAttribute(new Float32Array(a.normals),3)),c}var s=function(e){function t(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null,o.textContent="VR NOT SUPPORTED"}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator){var o=document.createElement("button");return o.id="VRButton",o.style.display="none",n(o),navigator.xr.isSessionSupported("immersive-vr").then((function(n){n?function(){let t=null;function n(n){n.addEventListener("end",r),e.xr.setSession(n),o.textContent="EXIT VR",t=n}function r(){t.removeEventListener("end",r),o.textContent="ENTER VR",t=null}o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){if(null===t){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking"]}).then(n)}else t.end()}}():t()})),o}var r=document.createElement("a");return!1===window.isSecureContext?(r.href=document.location.href.replace(/^http:/,"https:"),r.innerHTML="WEBXR NEEDS HTTPS"):(r.href="https://immersiveweb.dev/",r.innerHTML="WEBXR NOT AVAILABLE"),r.style.left="calc(50% - 90px)",r.style.width="180px",r.style.textDecoration="none",n(r),r};let a,c,l;function u(e,t){const{hubs:n}=t,r=new o.Vector3;e.grip.getWorldPosition(r);const i=function(e,t,n){const o=[null,Number.MAX_VALUE];return n.forEach(n=>{const r=t.geometry.boundingBox.clone();null==r||r.applyMatrix4(t.matrixWorld);const i=n.geometry.boundingBox.clone();null==i||i.applyMatrix4(n.matrixWorld);const s=null==r?void 0:r.intersectsBox(i),a=e.distanceTo(n.position);s&&a<o[1]&&(o[0]=n,o[1]=a)}),o[0]}(r,e.grip.children[0],n);if(i){if(e.selecting){if(!e.wasSelecting){e.wasSelecting=!0;const t=new o.Quaternion;t.copy(e.grip.quaternion),e.grip.userData.startQuaternion=t;const n=new o.Quaternion;n.copy(i.quaternion),e.grip.userData.hubStartQuaternion=n}const t=new o.Quaternion;t.copy(e.grip.userData.startQuaternion);const n=new o.Quaternion;n.copy(e.grip.userData.hubStartQuaternion);const r=new o.Quaternion;r.copy(e.grip.quaternion),t.inverse();const s=new o.Quaternion;s.copy(r),s.multiply(t),s.multiply(n),i.setRotationFromQuaternion(s)}}else e.wasSelecting=!1}const d=new o.Raycaster;function p(e,t,n){const r=new o.Group,s=function(e,t){const n=e/2,o=t/2;return i([0,0,-o,n-.5,0,-o,n,.5,-o,n,2.5,-o,n-.5,3,-o,.5-n,3,-o,-n,2.5,-o,-n,.5,-o,.5-n,0,-o,0,0,-o],{depth:t})}(n.dimensions.x,n.dimensions.z),a=new o.MeshLambertMaterial({color:13421772,side:o.BackSide}),c=n.dimensions.x/2,l=n.dimensions.z/2,u=new o.MeshLambertMaterial({color:13421772}),d=new o.Mesh(new o.BoxGeometry(n.dimensions.x,3,.125),u),p=new o.Mesh(new o.BoxGeometry(c-1,3,.15),u),h=new o.Mesh(new o.BoxGeometry(c-1,3,.15),u);r.add(d),r.add(p),r.add(h);const g=new o.Mesh(s,a);g.name="Corridor",r.add(g),g.receiveShadow=!0;const f=i([.25,3,0,1.5,2.75,0,1.75,2.375,0,1.75,1.25,0,1.5,1,0,1.5,.5,0,1,0,0,2,0,0,2,3,0],{depth:.25,cap:!0}),w=new o.MeshLambertMaterial({color:267807795}),y=[];d.position.set(0,1.5,l),p.position.set(-c/2-1,1.5,-l),h.position.set(c/2+1,1.5,-l),t.rig.position.set(0,t.rig.position.y,l-1);for(let e=-l;e<=l;e+=5){const t=new o.Mesh(f,w);t.position.set(c-2,0,e-.125),r.add(t),t.userData.obstacle=!0,y.push(t);const n=new o.Mesh(f,w);n.scale.set(-1,1,1),n.position.set(2-c,0,e-.125),n.userData.obstacle=!0,r.add(n),y.push(n)}const m=new o.BoxGeometry(2,3,2);for(let e=0;e<n.pillarPositions.length;e+=2){const t=new o.Mesh(m,w);t.position.set(n.pillarPositions[e],1.5,n.pillarPositions[e+1]),r.add(t),t.userData.obstacle=!0,y.push(t)}const b=function(){const e=new o.BoxGeometry(2,3,.125),t=new o.MeshLambertMaterial({color:13421772}),n=new o.Mesh(e,t),r=new o.Mesh(e,t),i=new o.Group;return i.add(n),i.add(r),n.position.set(-1,1.5,0),r.position.set(1,1.5,0),{open:!1,delta:.01,value:0,group:i,leftDoor:n,rightDoor:r}}();b.group.position.setZ(-l),r.add(b.group);const[x,v]=function(){const e=new o.BoxGeometry(.25,.25,.25),t=new o.MeshLambertMaterial({color:16711680}),n=new o.Mesh(e,t),r=new o.BoxGeometry(.25,1,.25),i=new o.MeshLambertMaterial({color:16777215});return[new o.Mesh(r,i),n]}();x.position.set(-1,.5,1-l),v.position.set(-1,1.125,1-l),r.add(x),r.add(v);return{obstacles:y,trigger:v,door:b,hubs:function(e,t){const n=new o.BoxGeometry(.02,.25,.25);n.computeBoundingBox();const r=[];for(let i=0;i<t.length;i+=3){const s=new o.MeshLambertMaterial({color:3355443}),a=new o.Mesh(n,s);a.castShadow=!0,a.position.set(t[i],t[i+1],t[i+2]),a.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),e.add(a),r.push(a)}return r}(r,n.hubPositions),group:r}}const h=new Float32Array(33);function g(e,t,n,o){const r=t.clone();return r.addScaledVector(n,e),r.addScaledVector(o,.5*Math.pow(e,2)),r}const f=function(){const[e,t]=(l=new o.Group,c=new o.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,1e3),c.position.y=1.75,c.userData.rig=l,l.add(c),a=new o.WebGLRenderer,a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement),document.body.appendChild(s(a)),a.xr.enabled=!0,a.shadowMap.enabled=!0,a.shadowMap.type=o.PCFSoftShadowMap,[a,c]),n=new o.Scene;n.add(t.userData.rig);const r=e.xr.getController(0);r.addEventListener("connected",(function(e){}));const i=e.xr.getControllerGrip(0);t.userData.rig.add(i);const u={grip:i,selecting:!1,squeezing:!1,wasSelecting:!1,wasSqueezing:!1};r.addEventListener("selectstart",()=>{u.selecting=!0}),r.addEventListener("selectend",()=>{u.selecting=!1});const d=e.xr.getController(1);d.addEventListener("connected",(function(e){}));const p=e.xr.getControllerGrip(1);t.userData.rig.add(p);const h={grip:p,selecting:!1,squeezing:!1,wasSelecting:!1,wasSqueezing:!1};return d.addEventListener("selectstart",()=>{h.selecting=!0}),d.addEventListener("selectend",()=>{h.selecting=!1}),{renderer:e,camera:t,scene:n,rig:t.userData.rig,left:u,right:h}}();f.left.grip.add(r()),f.right.grip.add(r());let w=2;const y=[{dimensions:{x:4,z:5},hubPositions:[.5,1,-.5,-.5,1,-1.5],pillarPositions:[],beam:{origin:new o.Vector3(-1.5,2.5,2.5)}},{dimensions:{x:10,z:8},hubPositions:[-1,1,1,2,1,-1,-.5,1.5,-3,1,1.5,-3],pillarPositions:[2.5,-3,2.5,3,-2.5,-3,-2.5,3],beam:{origin:new o.Vector3(-5,3,-2)}},{dimensions:{x:6,z:5},hubPositions:[1,1,1,-.5,1.5,-3,1,1.5,-3],pillarPositions:[-2.5,-2,2.5,-0,-2.5,2],beam:{origin:new o.Vector3(0,1,2.5)}}];!function(e){e.fog=new o.FogExp2(2241416,.1),e.background=new o.Color(2241416),e.add(new o.HemisphereLight(8947763,3355494,.3));const t=new o.DirectionalLight(16777215,.75);t.position.set(0,4,.1).normalize(),t.castShadow=!0,t.shadow.mapSize.set(4096,4096),t.shadow.camera.near=-1,t.shadow.camera.far=5;t.shadow.camera.left=-10,t.shadow.camera.right=10,t.shadow.camera.top=10,t.shadow.camera.bottom=-10,e.add(t)}(f.scene);let m=p(f.scene,f,y[w]);f.scene.add(m.group);const b=function(e){const t=new o.LineBasicMaterial({color:16711680});t.linewidth=3;const n=new Float32Array(30),r=new o.BufferGeometry;r.setAttribute("position",new o.BufferAttribute(n,3)),r.setDrawRange(0,0);const i=new o.Line(r,t);return e.add(i),r}(f.scene),x=function(e){const t=new o.MeshBasicMaterial({color:8930321,opacity:.75,blending:o.AdditiveBlending,side:o.DoubleSide,depthWrite:!1,transparent:!0}),n=new o.CylinderGeometry(.25,.25,.5,void 0,void 0,!0);return new o.Mesh(n,t)}(f.scene);f.rig.add(x),x.position.z=-4,x.position.y=0,x.visible=!1;const v=function(){const e=new o.BufferGeometry;h.fill(0),e.setAttribute("position",new o.BufferAttribute(h,3));const t=new o.LineBasicMaterial({color:8930321,opacity:.75,blending:o.AdditiveBlending,side:o.DoubleSide,depthWrite:!1,transparent:!0,linewidth:5}),n=new o.Line(e,t);return n.frustumCulled=!1,n}();f.rig.add(v);let M=!1,S=0;function B(){var e;S++,u(f.left,m),u(f.right,m),function(e,t,n,r){const i=new o.Vector3;if(t.xr.getSession()){t.xr.getCamera(e).getWorldPosition(i).y=0;const s=t.xr.getController(0),a=new o.Vector3;s.getWorldPosition(a);const c=new o.Vector3;s.getWorldDirection(c),c.multiplyScalar(6);const l=new o.Vector3(0,-9.8,0),u=(-c.y+Math.sqrt(Math.pow(c.y,2)-2*a.y*l.y))/l.y,d=n.geometry,p=i.set(0,0,0);for(let e=0;e<11;e++)p.copy(g(e*u/10,a,c,l)),p.toArray(h,3*e);r.position.copy(g(u,a,c,l)),d.attributes.position.needsUpdate=!0}}(f.camera,f.renderer,v,x),function(e,t,n){var r;const{trigger:i,hubs:s}=e,a=new o.Vector3(t.hubPositions[0],t.hubPositions[1],t.hubPositions[2]);a.addScaledVector(t.beam.origin,-1).normalize();const c=new o.Ray(t.beam.origin,a);let l=null;d.ray.origin.copy(c.origin),d.ray.direction.copy(c.direction),n.attributes.position.setXYZ(0,d.ray.origin.x,d.ray.origin.y,d.ray.origin.z);let u=1;for(i.userData.activated=!1;;){let t=50,o=s.filter(e=>e!==l);o=[...o,...e.obstacles,i];const a=d.intersectObjects(o);if(a.length>0){t=a[0].distance}else t=50;if(n.attributes.position.setXYZ(u,d.ray.origin.x+d.ray.direction.x*t,d.ray.origin.y+d.ray.direction.y*t,d.ray.origin.z+d.ray.direction.z*t),u++,!(a.length>0))break;{if(a[0].object===i){i.userData.activated=!0;break}if(1==a[0].object.userData.obstacle)break;const e=a[0];d.ray.origin.copy(e.point),l=e.object;const t=null===(r=e.face)||void 0===r?void 0:r.normal.clone();null==t||t.applyQuaternion(l.quaternion),d.ray.direction.reflect(t)}if(0==a.length||u>10)break}n.setDrawRange(0,u),n.attributes.position.needsUpdate=!0}(m,y[w],b);const{door:t,trigger:n}=m;t.open=n.userData.activated;let r=128+127*Math.sin(.15*S);n.material.emissive.setHex(n.userData.activated?r<<8:r<<16),t.open&&t.value<1?t.value+=t.delta:!t.open&&t.value>0&&(t.value-=t.delta),t.leftDoor.position.setX(-1-t.value),t.rightDoor.position.setX(1+t.value);const i=f.renderer.xr.getSession();if(i){const n=(null===(e=i.inputSources[0].gamepad)||void 0===e?void 0:e.axes[3])||0,r=Math.abs(n)>.2;if(M){if(!r){const e=new o.Vector3;x.getWorldPosition(e),f.rig.position.copy(e),M=!1,t.open=!t.open}}else r&&(M=!0);x.visible=r,v.visible=r}(function(e,t){const{rig:n}=e,o=t.dimensions.z/2;return n.position.z<-o})(f,y[w])&&(w++,w==y.length&&(w=0),f.scene.remove(m.group),m=p(f.scene,f,y[w]),f.scene.add(m.group))}f.renderer.setAnimationLoop(()=>{var e;B(),e=f.scene,a.render(e,c)})}]);