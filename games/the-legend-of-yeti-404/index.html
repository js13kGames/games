<meta name=monetization content=$ilp.uphold.com/qEBzYpLKbWr2><body style=background:#000;cursor:none><svg id="c" viewBox="0 0 640 640" style="position:absolute;top:0;left:0;height:100%;width:100%"><style>.t0{font:20px monospace}.t1{font:25px monospace}.t2{font:40px monospace}.a{fill:#000;stroke:#ffa}.b{fill:#0ff}.c{fill:#ffa}.d{fill:#fe9}.e{fill:#fff}</style><clipPath id="clip"><path d="M0 0h640v640H0z"/></clipPath><filter id="g" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="z1"/><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="z2"/><feGaussianBlur in="SourceGraphic" stdDeviation="8" result="z3"/><feMerge><feMergeNode in="z1"/><feMergeNode in="z2"/><feMergeNode in="z3"/></feMerge></filter><filter id="f1" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="1"/></filter><filter id="f3" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="3"/></filter><filter id="f10" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="10"/></filter><g clip-path="url(#clip)"><g id="orbit" filter="url(#f1)"><circle fill="#000" stroke-width="1.5" id="orbit_planet"/><circle fill="#000" stroke-width="1.5" id="orbit_moon"/><text x="20" y="40" fill="#fff" class="t1">Currently in orbit at</text><text id="orbitcoords" x="400" y="40" fill="#fff" class="t1">[0:0]</text><text x="20" y="500" fill="#fff" class="t1">System Information</text><text x="60" y="530" fill="#fff" class="t1">Faction:</text><text id="infofaction" x="300" y="530" fill="#fff" class="t1"/><text x="60" y="560" fill="#fff" class="t1">Economy:</text><text id="infotrade" x="300" y="560" fill="#fff" class="t1"/><text x="60" y="590" fill="#fff" class="t1">Discovery:</text><text id="infopoi" x="300" y="590" fill="#fff" class="t1"/></g><g id="base" filter="url(#f1)"><circle id="base_moon" stroke="#fff" stroke-width="1.5" fill="#000"/><ellipse id="base_planet" stroke="#fff" ry="200" rx="500" cy="478" cx="320" stroke-width="1.5" fill="#000"/><path id="base_sc1" stroke-width="1.5" stroke="#555" d="M0 350H150c-5-1e2-10-165-10-190 0-4-5-10-10-10 0 0 0 0 0 0 0 0 0 0 0 0 0-5 5-10 10-10 18 0 62 0 80 0 5 0 10 5 10 10 0 0 0 0 0 0 0 0 0 0 0 0-5 0-10 5-10 10 0 25-5 90-10 190H680V750H-320V350z"/><path id="base_sc2" stroke-width="1.5" stroke="#888" d="M0 3e2H275v60h10V310h30v70h10V290l1e2 10v40H575V440h10V240h50V370h20V320l1e2-10v30h10V3e2h60v60h5V260h220V660H50V3e2z"/><path id="base_sc3" stroke-width="1.5" stroke="#bbb" d="M0 310H40V410h90V374h70v50H385V334l60-20v40h25v60h40V314h50V444h20V394l10 5v30h10V389h20v60h45V349H845V749H-155l5-439z"/><path id="base_sc4" stroke-width="1.5" stroke="#eee" d="M0 480H290c5-35 10-55 10-65 0-10 5-15 15-20 5-5 15-5 20-10 10-5 20-5 25 0 10 5 20 5 25 10 10 5 15 10 15 20 0 10 5 30 10 65H850V880H-150V480z"/><path id="base_sc5" stroke-width="1.5" stroke="#888" d="M0 655c-45-5 295 0 855 5l5-240-110-10-20-10-5-15-20 5-10-30-10-10-40 60H610l-25-10-75 15-20-15-25-15-15 25-35 15-35-25-25-10-25-20-15 30-5 10-45-5-20-15-60 20-30-10-15-10-25 20-65-30-15 35L5 4e2-30 415-150 405"/><text x="20" y="40" fill="#fff" class="t1">Discovered</text><text id="tradename" x="200" y="40" fill="#fff" class="t1">???</text></g><g id="game"><g filter="url(#g)" id="l1"><g id="l10">.</g><g id="l11">.</g><path d="M0 0H640V640H-640z" fill="#000" fill-opacity=".1"/><g id="l12">.</g><g id="ship"><path id="shipd" d="M0 0" stroke-width=".2" stroke="#fff" fill-opacity="0"/><circle id="ships" x="0" y="0" r="6" stroke="#00f" stroke-width=".2" fill-opacity=".3" fill="#00f" transform="translate(0,4)"/></g><path id="combocount" stroke-width="1" stroke="#fff" fill-opacity="0"/><text id="combocounttext" x="550" y="90" fill="#fff" class="t2" text-anchor="middle"/><text id="tutorial" x="320" y="250" fill="#fff" class="t2" text-anchor="middle" style="pointer-events:none"/></g></g><g filter="url(#f1)" id="map"><path id="galaxy" filter="url(#f10)" fill="#fff1" d="M-20 355c0-160 125-310 3e2-310 135 0 245 95 245 230 0 85-65 175-165 175-90 0-135-55-135-125-15 0-25 25-25 50 0 65 80 135 170 135 120 0 250-110 250-275 0-1e2-50-190-90-240 50 45 130 130 130 270 0 160-125 310-295 310-135 0-245-95-245-230 0-85 65-175 165-175 90 0 135 55 135 125 15 0 25-25 25-50 0-65-80-135-170-135-120 0-250 110-250 275 0 1e2 50 190 90 240C55 580-20 495-20 355z"/><g id="mapexit" transform="translate(0 0)"><path d="M0 0h640v30H0z" fill="#000"/><text x="10" y="25" fill="#fff" class="t1">&lt; Cancel</text></g></g><g id="title" filter="url(#f1)"><path d="M0 0h640v640H0z" fill="#000"/><path class="a" d="m0 404 306-161c34-18 67-39 98-62 15-11-9 7 0 0 49-38 89-85 118-139l21-41"/><path class="a" d="m-2 181L233 48c26-14 55-23 85-24l132-5c14 0 23 16 15 27l-47 68c-19 29-45 52-74 70L4 384"/><path class="b" d="m572 422a95 95 0 1 1 0-190 95 95 0 0 1 0 190z"/><path d="m328 704c-215 0-390-67-390-150s175-150 390-150 390 67 390 150-175 150-390 150z"/><path fill="red" d="m328 704c-215 0-390-67-390-150s175-150 390-150 390 67 390 150-175 150-390 150z"/><path class="c" d="m360 143c32-20 59-46 79-77l19-29V23c0-4-5-5-7-2a2962 2962 0 0 1-4 9c-27 45-65 83-110 110L139 260l-58 56 279-173z"/><path stroke="#ffa" d="m-2 370 139-85c16-12 51-88 51-88-2-2-10-3-26-3-20 0-40 5-57 16L-2 274"/><path class="c" d="m138 272h-29l-130 60 10 40 149-1e2z"/><path class="a" d="m147 274 1-2 26-46 11-23-34-1c-10-1-19 2-28 7l-36 19c-3 1-3 4-2 6l22 36c3 4 7 7 12 7l18 1c4 1 7-1 10-4z"/><path d="m283 213c-44-32-83-71-115-115l-2-2-17 9 12 17a397 397 0 0 0 107 99l15-8z"/><path class="a" d="m283 213c-44-32-83-71-115-115l-2-2-17 9 12 17a397 397 0 0 0 107 99l15-8z"/><path d="m158 307c-4 15 3 31 18 37l6 3-164 83c-6 3-14 3-20 0l-3-2c-4-2-5-7-3-12 2-2-1 2 0 0 6-8 13-15 21-20l145-89z"/><path class="a" d="m158 307c-4 15 3 31 18 37l6 3-164 83c-6 3-14 3-20 0l-3-2c-4-2-5-7-3-12 2-2-1 2 0 0 6-8 13-15 21-20l145-89z"/><path stroke="#fe9" d="m82 44C60 40 45 22 45 0l1-9-205 148c-8 6-13 15-12 25l1 4c0 7 6 12 13 11h2c13-1 26-6 38-13L84 45l-2-1z"/><path d="m187 347c-6 4-18-1-27-13-8-11-10-25-3-29 6-5 19 0 27 12s10 25 3 30z"/><path class="c" d="m187 347c-6 4-18-1-27-13-8-11-10-25-3-29 6-5 19 0 27 12s10 25 3 30z"/><path class="d" d="m93 42c-10 8-28 0-40-16s-13-36-3-44c11-7 29 0 41 17 12 16 13 36 2 43z"/><path class="a" d="m322 187c-44-32-83-71-115-114l-2-3-17 9 12 17c27 37 60 68 98 94 2 0 4 2 9 6l15-9z"/><path class="a" d="m365 162A534 534 0 0 1 247 45l-17 10 13 16a397 397 0 0 0 107 1e2l15-9z"/><path d="m578 432c-54 0-97-43-97-97a97 97 0 0 1 195 0c0 54-44 97-98 97z"/><path class="e" d="m380 247-4 2 1 5-3-5-6 1 5-3-1-6 3 6h5z"/><path d="m350 734c-215 0-390-73-390-163 0-89 175-162 390-162s390 73 390 162c0 90-175 163-390 163z"/><path class="e" d="m388 265-5-3-3 4 2-5-4-4 5 2 4-5-3 7 4 4z"/><path class="e" d="m349 289-5-2-2 4 1-5-4-4 5 2 3-5-1 7 3 3z"/><path class="e" d="m389 335-5-1-1 5-1-5-5-3h5l2-5 1 7 4 2z"/><path class="e" d="m565 124h-5l-1 5v-6l-5-2h5l2-6v7l4 2z"/><path class="e" d="m269 368-5 1 1 5-2-5h-6l5-2v-6l2 6 5 1z"/><path class="e" d="m555 58-5 2 1 5-2-5-6-1 5-2v-6l2 7h5z"/><path class="e" d="m453 392-4-3-3 3 2-4-3-5 5 3 4-4-3 6 2 4z"/><path class="c" d="m248 185-18 9-12-9 18-11 12 11z"/><path class="c" d="m288 161-17 9-12-9 18-12 11 12z"/><path class="c" d="m330 136-17 9-12-9 17-12 12 12z"/><path class="c" d="m165 232 1-8c1-4-3-6-6-4l-9 6-28 32-14 15c-2 2-1 5 2 5l16 2 38-48z"/><path class="c" d="m172 343-9-13-179 109 188-96z"/><path class="d" d="m68 32L56 7-158 174 68 32z"/><text x="300" y="510" fill="#fff" class="t2" text-anchor="middle">The Legend of Yeti-404</text><text x="500" y="530" fill="#fff" class="t0" text-anchor="end">#js13k 2020</text><text x="550" y="590" fill="#fff" class="t0" text-anchor="end">A game by Richard Munn</text><text x="550" y="610" fill="#fff" class="t0" text-anchor="end">Music by Mattia Fortunati</text></g><path id="titlef" d="M0 0h640v640H0z" fill="#000c"/><g id="menu" filter="url(#f1)"><g transform="translate(0 80)"><path d="M45 3h550v27H45z" fill="#000" fill-opacity=".4"/><text x="50" y="25" fill="#fff" class="t1"/></g></g><text filter="url(#f1)" id="bottomtext" x="10" y="630" fill="#ff0" class="t1"/><path id="vsync" filter="url(#f10)" d="M-10 0H650V2e2H-640z" fill="#303" fill-opacity=".2" style="pointer-events:none"/><g id="cursor" style="pointer-events:none"><path filter="url(#g)" d="M-5 0h-30M5 0h30M0 5v30M0-5v-30" stroke-width=".7" stroke="#fff" fill-opacity="0"/><text filter="url(#f1)" id="cursorText1" x="8" y="20" fill="#ff0" class="t0"/><text filter="url(#f1)" id="cursorText2" x="8" y="40" fill="#ff0" class="t0"/><text filter="url(#f1)" id="cursorText3" x="8" y="60" fill="#ff0" class="t0"/><text filter="url(#f1)" id="cursorText4" x="8" y="80" fill="#ff0" class="t0"/></g><g style="visibility:hidden"><path id="star" d="M-2-2h2v2h-2z"/><path id="box" d="M-10-10h20v20h-20z" fill-opacity="0"/><path id="enemybox" d="M0 0"/><path id="mapcell" d="M0 0h12v12H0z" fill-opacity="0"/><circle id="transponder" cx="6" cy="6" r="4" stroke="#fff" fill-opacity="0" style="pointer-events:none"/><path id="yeti" d="M0 0l12 12M0 12 12 0" stroke="#fff" fill-opacity="0" stroke-width="2" style="pointer-events:none"/><path id="ground" d="M0 0" stroke-width=".6" stroke="#fff" fill-opacity="0"/></g></g></svg><script>bonus=0;document.monetization?.addEventListener('monetizationstart',_=>{if(bonus++==0)pz.push(it_.length-1)});SN=function(){this.g3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var r=0;r<256;r++)this.p[r]=Math.floor(256*Math.random());this.m=[];for(r=0;r<512;r++)this.m[r]=this.p[255&r]};SN.prototype.n=function(t,r){var i,h,o=(t+r)*(.5*(Math.sqrt(3)-1)),s=Math.floor(t+o),e=Math.floor(r+o),p=(3-Math.sqrt(3))/6,a=(s+e)*p,m=t-(s-a),n=r-(e-a);m>n?(i=1,h=0):(i=0,h=1);var d=m-i+p,f=n-h+p,l=m-1+2*p,u=n-1+2*p,M=255&s,g=255&e,v=this.m[M+this.m[g]]%12,c=this.m[M+i+this.m[g+h]]%12,x=this.m[M+1+this.m[g+1]]%12,N=.5-m*m-n*n,S=.5-d*d-f*f,q=.5-l*l-u*u;return 70*((N<0?0:(N*=N)*N*dot(this.g3[v],m,n))+(S<0?0:(S*=S)*S*dot(this.g3[c],d,f))+(q<0?0:(q*=q)*q*dot(this.g3[x],l,u)))};sn=new SN();arcp=(a,r,n,o)=>{return{x:a+n*Math.cos((o-90)*Math.PI/180),y:r+n*Math.sin((o-90)*Math.PI/180)}};arc=(a,r,n,o,t)=>{i=arcp(a,r,n,t),e=arcp(a,r,n,o),s=t-o<=180?"0":"1";return`M${i.x} ${i.y}A${n} ${n} ${0} ${s} ${0} ${e.x} ${e.y}`};kr=decodeURI("%E2%93%9A");a_=_=>{p="";f=m=>p+=`M${((i>>5&1)-X*m/7)} ${(j>>8)-4+Y}h1v1h-1v-1  `;for(j=30;j--;Math.random()>(X**2+(Y-4)**2)**.5/5&&f(7)+f(-7))X=j&3,Y=j>>2&7;return p};d_=o=>{s=o.getAttribute("d").split("  ");for(i=0;i<s.length;++i){p=o.cloneNode();p.removeAttribute("id");p.setAttribute("d",s[i]);p.d={x:o.d.x,ry:o.d.ry,r:o.d.r,s:o.d.s,z:o.d.z,dx:o.d.dx+Math.random()*6-3,dy:o.d.dy+Math.random()*6-3,a:1,p:true,u_:(o,g)=>{o.d.x+=o.d.dx;o.d.ry+=o.d.dy;o.d.y=250-o.d.ry+gh*(o.d.z*2);o.d.a-=0.01;if(o.d.a<=0){o.d.d_=true};o.setAttribute("fill-opacity",o.d.a);u_(o)}};l12.appendChild(p);$.push(p)}};iz=(i,n,x)=>i<n?n:i>x?x:i;dot=(t,r,i)=>t[0]*r+t[1]*i;sz=x=>x*x;wz=(i,f)=>(i.z*f.z)+(i.y*f.y)+(i.x*f.x);item=menu.getElementsByTagName("g")[0];text=item.getElementsByTagName("text")[0];path=item.getElementsByTagName("path")[0];for(i=1;i<=16;++i){item2=item.cloneNode();item2.setAttribute("transform",`translate(0 ${80+(i*30)})`);item2.appendChild(path.cloneNode());item2.appendChild(text.cloneNode());menu.appendChild(item2)};am=(t,i,d,f)=>{if(i<=16){item=menu.getElementsByTagName("g")[i];item.d=d;s_(item);el=item.getElementsByTagName("text")[0];el.textContent=t;t_(item,f==null?null:_=>f(_.target.parentElement.d))}};hm=i=>{if(i<=16)h_(menu.getElementsByTagName("g")[i])};em=i=>{while(i<=16)hm(i++)};u_=o=>o.setAttribute("transform","translate("+o.d.x+" "+o.d.y+") rotate("+o.d.r+") scale("+o.d.z+")");s_=o=>o.removeAttribute("style");h_=o=>o.setAttribute("style","visibility:hidden");text=o=>bottomtext.textContent=o;clearcursor=_=>cursorText1.textContent=cursorText2.textContent=cursorText3.textContent=cursorText4.textContent="";fz=_=>{gameloop=false;em(0);h_(game);h_(orbit);h_(map);s_(title);h_(base);text()};_showintro_=_=>{s_(titlef);for(i=0;i<v_.length;++i){am(v_[i],i,{},_=>dz())}};bz=_=>{gameloop=false;em(0);h_(game);h_(orbit);s_(map);h_(title);h_(base);text();ez(ship.d.mx,ship.d.my)};dz=_=>{gameloop=true;em(0);s_(game);h_(orbit);h_(map);h_(title);h_(base);h_(titlef);text();combocount.d.v=0;combocount.d.c=0;maxlock=iz(ship.d.weapons,1,8);f=fmp[ship.d.my][ship.d.mx];waves=f.e?0:f.waves;if(!inwarp)rundistance=waves*1000;if(e_.length>0)waves=2;wavecount=0;enemies=0;missiles=0;maxmissiles=8;targetc=0;bestlock=0;hasfired=false;wavetime=100};mz=_=>{if(ship.d.scanner>0)lrs(ship.d.mx,ship.d.my,ship.d.scanner+1);cz()};cz=_=>{gameloop=false;clearcursor();h_(game);s_(orbit);h_(map);h_(title);h_(base);text();orbitcoords.textContent=`[${ship.d.mx},${ship.d.my}]`;f=fmp[ship.d.my][ship.d.mx];f.v=true;warprange=ship.d.engines*2;orbit_planet.setAttribute("cx",f.random[0]*640);orbit_planet.setAttribute("cy",f.random[1]*640);orbit_planet.setAttribute("r",f.pradius);orbit_planet.setAttribute("stroke",f.pcol);orbit_moon.setAttribute("cx",f.random[2]*640);orbit_moon.setAttribute("cy",f.random[3]*640);orbit_moon.setAttribute("r",f.mradius);orbit_moon.setAttribute("stroke",f.mcol);if(f.n){infofaction.textContent=x_[f.faction].name;infotrade.textContent=f.t;infopoi.textContent=f.e?w_[f.p].name:"???"}else{infofaction.textContent="???";infotrade.textContent="???";infopoi.textContent="???"};ez(ship.d.mx,ship.d.my);next=0;am("> Galaxy Map",next++,{},_=>bz());hm(next++);if(!f.n){am("> Scan System",next++,{},_=>{fmp[ship.d.my][ship.d.mx].n=true;ez(ship.d.mx,ship.d.my);cz()});hm(next++)};am("> Enter Atmosphere",next++,{},_=>{inwarp=false;dz()});hm(next++);am("> Ship status",next++,{},_=>{next=0;am("< Exit",next++,{},_=>cz());hm(next++);am(`Weapons: ${ship.d.weapons}`,next++);am(`Shields: ${ship.d.shields}`,next++);am(`Engines: ${ship.d.engines}`,next++);am(`Scanner: ${ship.d.scanner}`,next++);am(`Science: ${ship.d.science}`,next++);hm(next++);am(`Shield Power: ${shields.toFixed(0)}%`,next++);am(`Warp fuel: ${fuel}/${maxfuel}`,next++);am(`Warp range: ${warprange}`,next++);hm(next++);if(ship.d.clue>0){am(`${ship.d.clue} transponder clue${ship.d.clue==1?"":"s"} collected`,next++)};em(next)});hm(next++);skip=0;for(var i=0;i<pz.length;++i){if(it_[pz[i]].v!=null){skip++;am(`> Install ${it_[pz[i]].name}`,next++,{i:pz[i]},d=>{v=it_[d.i].v;next=0;if(!v.clue){next=2;am(`Weapons: ${ship.d.weapons}`,next++);am(`Shields: ${ship.d.shields}`,next++);am(`Engines: ${ship.d.engines}`,next++);am(`Scanner: ${ship.d.scanner}`,next++);am(`Science: ${ship.d.science}`,next++);i=1;if(v.weapons)setTimeout(_=>{{fxD();am(`Weapons: +${v.weapons} : ${ship.d.weapons+v.weapons}`,2);ship.d.weapons+=v.weapons}},1000*i++);if(v.shields)setTimeout(_=>{{fxD();am(`Shields: +${v.shields} : ${ship.d.shields+v.shields}`,3);ship.d.shields+=v.shields}},1000*i++);if(v.engines)setTimeout(_=>{{fxD();am(`Engines: +${v.engines} : ${ship.d.engines+v.engines}`,4);ship.d.engines+=v.engines}},1000*i++);if(v.scanner)setTimeout(_=>{{fxD();am(`Scanner: +${v.scanner} : ${ship.d.scanner+v.scanner}`,5);ship.d.scanner+=v.scanner}},1000*i++);if(v.science)setTimeout(_=>{{fxD();am(`Science: +${v.science} : ${ship.d.science+v.science}`,6);ship.d.science+=v.science}},1000*i++);setTimeout(_=>{am("< Exit",0,{},_=>cz())},1000*(i-1))}else{next=0;ship.d.clue++;if(ship.d.clue!=3){am("< Exit",next++,{},_=>cz());hm(next++)}else{hm(next++);hm(next++)};am("Found ancient transponder!",next++);if(ship.d.clue>3){am("Not that we need any more!",next++)}else if(ship.d.clue==3){am("We can now triangulate the Yeti's",next++);am("location...",next++);j=6;for(i=1;i<4;++i){setTimeout(_=>{am("... scanning ...",j++)},250*i)};setTimeout(_=>{am("... LOCATION FOUND",10);x=ship.d.mx;y=ship.d.my;while((nz(x,y)<10)||(nz(x,y)>20)){x=2+Math.floor(Math.random()*28);y=2+Math.floor(Math.random()*28)};o=yeti.cloneNode();o.removeAttribute("id");o.setAttribute("transform","translate("+((x*16)+40)+" "+((y*16)+34)+")");map.appendChild(o);fmp[y][x].yeti=true;am("> Galaxy Map",0,{},_=>bz())},1250)}else{am(`With ${3-ship.d.clue} more we can triangulate the`,next++);am("Yeti's location",next++)}};em(next);pz.splice(pz.indexOf(d.i),1)});if(skip==3)break}};if(skip>0)hm(next++);if(research!=null){if(researchtime>0){j=iz(Math.floor(researchtime/500),1,20);am(`Researching ${it_[research].name} ${"#".repeat(j)}`,next++)}else{am("> Research complete!",next++,{},_=>{next=0;am("< Exit",next++,{},_=>cz());hm(next++);w=iz(25-it_[research].r-ship.d.science,4,20);k=az(it_,w);if(k==null){am("Discovered nothing of value",next++)}else{am(`Discovered ${it_[k].name}`,next++);pz.push(k)};em(next);research=null})}}else{i=0;seen=[];for(j=0;j<pz.length;++j){if(it_[pz[j]].r<=ship.d.science&&!seen.includes(pz[j])){am(`> Research ${it_[pz[j]].name}`,next++,{i:pz[j]},d=>{research=d.i;pz.splice(pz.indexOf(d.i),1);researchtime=it_[d.i].r*1000;cz()});i++;seen.push(pz[j]);if(i==3)break}}};em(next)};gz=_=>{inwarp=true;fx8();mz();dz();for(i=0;i<200;++i){o=star.cloneNode();o.setAttribute("fill",cols[i%cols.length]);o.setAttribute("fill-opacity",0.1+(Math.random()*0.7));o.removeAttribute("id");o.d={r:Math.random(),rx:300+(Math.random()*40),ry:300+(Math.random()*40),z:0.1,p:true,u_:(o,g)=>{m=1.1+((Math.abs(o.d.rx-320))/500);o.d.z+=m/10;o.d.r+=1;o.d.rx=((o.d.rx-320)*m)+320;o.d.ry=((o.d.ry-320)*m)+320;if(o.d.rx<0||o.d.rx>640||o.d.ry<0||o.d.ry>640){o.d.rx=305+(Math.random()*30);o.d.ry=305+(Math.random()*30);o.d.z=0.5};o.d.x=((320-ship.d.x)*0.1)+o.d.rx;o.d.y=((320-ship.d.y)*0.1)+o.d.ry;u_(o)}};$.push(o);l10.appendChild(o)}};lz=_=>{gameloop=false;clearcursor();h_(game);h_(orbit);h_(map);h_(title);s_(base);text();f=fmp[ship.d.my][ship.d.mx];f.e=true;next=0;base_planet.setAttribute("rx",f.pradius*5);base_planet.setAttribute("stroke",f.pcol);base_moon.setAttribute("cx",f.random[2]*640);base_moon.setAttribute("cy",f.random[3]*340);base_moon.setAttribute("r",f.mradius*2);base_moon.setAttribute("stroke",f.mcol);base_sc1.setAttribute("transform",`translate(${-20+(f.random[0]*340)} 0)`);base_sc2.setAttribute("transform",`translate(${-200+(f.random[1]*340)} 0)`);base_sc3.setAttribute("transform",`translate(${-200+(f.random[2]*340)} 0)`);base_sc4.setAttribute("transform",`translate(${-200+(f.random[3]*340)} 0)`);base_sc5.setAttribute("transform",`translate(${-210+(f.random[4]*340)} 0)`);h_(base_sc1);h_(base_sc2);h_(base_sc3);h_(base_sc4);h_(base_sc5);if(f.y==0)s_(base_sc5);if(f.y>=1)s_(base_sc4);if(f.y>=3)s_(base_sc2);if(f.y>=5)s_(base_sc3);if(f.y>=8)s_(base_sc1);if(fmp[ship.d.my][ship.d.mx].yeti){tradename.textContent="Yeti Location";fmp[ship.d.my][ship.d.mx].yeti=false;for(next=0;next<y_.length;){am(y_[next],next++,{},_=>lz())}}else{tradename.textContent=w_[f.p].name;pz.sort((a,b)=>wz(it_[b],f)-wz(it_[a],f));maxfuel=ship.d.engines*25;text(`kredits: ${kr} ${kredits}   fuel: ${fuel}/${maxfuel}`);am("< Return to orbit",next++,{},_=>cz());hm(next++);if(f.y==0){am("Search for scrap",next++,{},_=>{next=2;for(i=0;i<f.it_.length;++i){am(`Found ${it_[f.it_[i]].name}!`,next++);pz.push(f.it_[i])};f.it_=[]});hm(next++)}else{if(fuel<maxfuel){fuelcost=5+Math.floor(f.random[3]*10);am(`> Buy fuel : ${kr} ${fuelcost}`,next++,{v:fuelcost},d=>{if(kredits>=d.v){kredits-=d.v;fuel++;lz()}})};if(shields<100){shieldcost=iz(Math.round((0.5+f.random[2])*(100-shields)/2),3,100);am(`> Recharge shields : ${kr} ${shieldcost}`,next++,{v:shieldcost},d=>{if(kredits>=d.v){kredits-=d.v;shields=100;lz()}})};for(i=0;i<f.it_.length;++i){v=wz(it_[f.it_[i]],f);am(`> Buy ${it_[f.it_[i]].name} : ${kr} ${v}`,next++,{i:f.it_[i],v:v},d=>{if(kredits>=d.v){pz.push(d.i);kredits-=d.v;f.it_.splice(f.it_.indexOf(d.i),1);lz()}})};if(f.it_.length>0)hm(next++);for(i=0;i<pz.length;++i){v=Math.round(wz(it_[pz[i]],f)*0.8);if(v>0&&it_[pz[i]].v==null){am(`> Sell ${it_[pz[i]].name} : ${kr} ${v}`,next++,{i:pz[i],v:v},d=>{kredits+=d.v;pz.splice(pz.indexOf(d.i),1);lz()})}}}};em(next)};cols=["#f00","#f70","#ff0","#7f0","#0f0","#0f7","#0ff","#07f","#00f","#70f","#f0f","#f07"];factionCol=["#333","#f0f","#ff0","#05f"];x_=[{name:"Unclaimed sector",x:1,y:1,z:1},{name:"Trade Federation",x:3,y:6,z:1},{name:"Union of Science",x:5,y:4,z:1},{name:"The Empire",x:1,y:3,z:6}];it_=[{w:1,name:"Weapons upgrade",x:4,y:4,z:8,v:{weapons:1}},{w:2,name:"Shields upgrade",x:6,y:4,z:6,v:{shields:1}},{w:3,name:"Science upgrade",x:8,y:4,z:4,v:{science:1}},{w:4,name:"Engines upgrade",x:5,y:6,z:5,v:{engines:1}},{w:5,name:"Scanner upgrade",x:8,y:4,z:4,v:{scanner:1}},{w:30,name:"Assorted junk",x:1,y:1,z:1,r:1},{w:40,name:"Salvage",x:2,y:2,z:1,r:2},{w:45,name:"Strange foodstuffs",x:1,y:2,z:1},{w:60,name:"Mysterious boxes",x:6,y:3,z:1,r:3},{w:63,name:"Odd trinkets",x:1,y:4,z:1},{w:65,name:"Small furry creatures",x:5,y:7,z:1},{w:68,name:"Lab grown meat",x:3,y:2,z:4},{w:72,name:"Service robots",x:5,y:4,z:2},{w:75,name:"Entertainment devices",x:2,y:6,z:2},{w:78,name:"Medical supplies",x:4,y:6,z:6},{w:80,name:"Exotic weapons",x:4,y:6,z:9,r:6},{w:90,name:"Luxury goods",x:4,y:8,z:5},{w:100,name:"Advanced technology",x:7,y:9,z:8,r:10},{w:999,name:"Ancient transponder",x:3,y:3,z:3,v:{clue:1}},{w:9999,name:"Bonus upgrade",x:0,y:0,z:0,v:{weapons:2,shields:2,science:2,engines:2,scanner:2}}];w_=[{w:40,name:"Abandoned colony",y:0,s:2,x:1},{w:50,name:"Trading Post",y:1,s:0,x:1},{w:70,name:"Small colony",y:2,s:0,x:1},{w:88,name:"Crashsite",y:0,s:3,x:1},{w:90,name:"Medium colony",y:3,s:0,x:2},{w:95,name:"Ancient Ruins",y:0,s:5,x:1},{w:100,name:"Large colony",y:4,s:0,x:3}];v_=["A millennia ago, the great Ark Fleet","set out across the galaxy to escape the","certain doom of the ancient homeworld.",,"Many colonies prospered, many failed,","and some vanished without trace,","disappearing into fokelaw and legend.",,"Whilst an alien curse sweeps across","the galaxy, threatening humanity's","existence, you form a crew to seek out","Ark Ship YTI-404, long thought lost,","but which now might carry the answer to","defeating the alien threat.",,"Good luck Commander, the whole galaxy","depends on what you may find.",];y_=["And so the lost colony was found!","","Much old data was restored, and the","three factions united in the quest","to decypher all the ancient knowledge","required to finally defeat the enemy","threat once and for all.","","As for your crew, you decide to","continue your journey across the","galaxy..."];tutorialt=0;e_=[{t:"Welcome...",e:_=>(wavecount>0)},{t:"Watch out for the critters",e:_=>(tutorialt>100)},{t:"Hold LMB to lock on",e:_=>(bestlock>0)},{t:"Release LMB to fire",e:_=>hasfired},{t:"Lock mutiple for multiplier",e:_=>(bestlock>1)},{t:"Good luck!",e:_=>(tutorialt>100)}];az=(i,x)=>{r=Math.random()*(x==null?100:x);for(j=0;j<i.length;++j){if(i[j].w>r)return j};return null};targets=[];shipcell=null;$=[];$_=[];pz=[];mousedown=false;kredits=25;shields=100;wavec=0;shieldhit=0;research=null;researchtime=0;fuel=25;maxfuel=50;warprange=5;rundistance=0;inwarp=false;hz=d=>Math.abs(d.x-ship.d.mx)+Math.abs(d.y-ship.d.my);nz=(x,y)=>Math.sqrt((x-ship.d.mx)*(x-ship.d.mx)+(y-ship.d.my)*(y-ship.d.my));titleclick=0;h_(titlef);title.onclick=_=>{fx(...[0,,,,,,,,,,,,,,,,,]);setTimeout(_=>{music=fxP(...fx0);music.loop=true},500);_showintro_()};titlef.onclick=_=>{dz()};em(0);ship.d={r:0,x:320,y:550,z:10,mx:10+Math.floor(Math.random()*12),my:10+Math.floor(Math.random()*12),weapons:2+Math.floor(Math.random()*3),shields:1+Math.floor(Math.random()*3),science:1+Math.floor(Math.random()*3),engines:1+Math.floor(Math.random()*3),scanner:0+Math.floor(Math.random()*3),clue:0,u_:(o,g)=>{o.d.x=(o.d.x*0.8+(320+(mx*320))*0.2);o.d.y=(o.d.y*0.8+(400+(my*100))*0.2);gh=27.5-(my*12.5);gx-=((o.d.x-320)/3000);shipd.setAttribute("d",`M${(320-o.d.x)/100} ${(o.d.y-400)/50} L-5 4 L0 8 L5 4 Z M-5 4 L0 1 L5 4`);if(shieldhit>0||shields<=10){s_(ships);if(shields>=10){ships.setAttribute("stroke","#00f");ships.setAttribute("fill","#00f")}else{ships.setAttribute("stroke","#f00");ships.setAttribute("fill","#f00")};shieldhit--}else{h_(ships)};u_(o)}};$.push(ship);u_(ship);combocount.d={v:0,c:0,u_:(o,g)=>{if(o.d.v<=0){combocount.setAttribute("d","");combocounttext.textContent="";o.d.c=0}else{combocount.setAttribute("d",arc(550,80,40,360-o.d.v,359.9));combocounttext.textContent=`x${o.d.c}`};o.d.v-=((targetc+missiles==0)?5:0.5)}};$.push(combocount);fmp=[];for(y=0;y<32;++y){fmp[y]=[];for(x=0;x<32;++x){dist=nz(x,y);f={faction:0,v:false,e:false,n:dist<5,p:az(w_),it_:[],pradius:100+Math.random()*300,pcol:cols[Math.floor(Math.random()*cols.length)],mradius:10+Math.random()*100,mcol:cols[Math.floor(Math.random()*cols.length)],random:[Math.random(),Math.random(),Math.random(),Math.random(),Math.random()]};f.x=Math.floor(Math.random()*3*x_[f.faction].x*w_[f.p].x);f.y=Math.round((1+Math.random()*2)*x_[f.faction].y*w_[f.p].y);f.z=Math.floor(Math.random()*4*x_[f.faction].z);f.s=Math.round(Math.random()*3*x_[f.faction].y*w_[f.p].s);f.waves=Math.min(f.z*f.z,Math.floor(dist/3)+1);if(f.waves<=2){f.critters="low"}else if(f.waves<=4){f.critters="med"}else{f.critters="high"};if(f.x==f.y&&f.x==f.z){f.t="Balanced"}else if(f.x==f.y&&f.x>f.z){f.t="Technology"}else if(f.x>f.y&&f.x>f.z){f.t="Science"}else if(f.y>f.x&&f.y>f.z){f.t="Trade"}else if(f.y>f.x&&f.y==f.z){f.t="Arms"}else if(f.z>f.y&&f.z>f.x){f.t="Warfare"}else if(f.x==f.z&&f.z>f.y){f.t="Espionage"};combo=f.x+f.y+f.z;if(combo<5){f.t+=" (D)"}else if(combo<8){f.t+=" (C)"}else if(combo<13){f.t+=" (B)"}else{f.t+=" (A)"};for(i=0;i<Math.min(1+(f.y+f.s),8);++i){f.it_.push(az(it_))};fmp[y][x]=f}};clue=it_.findIndex(_=>_.w==999);for(i=0;i<10;++i){if(i==0){x=ship.d.mx-4+Math.floor(Math.random()*8);y=ship.d.my-4+Math.floor(Math.random()*8)}else{while(nz(x,y)<5||fmp[y][x].it_.includes(clue)){x=Math.floor(Math.random()*32);y=Math.floor(Math.random()*32)}};fmp[y][x].it_.push(clue)};x=10+Math.floor(Math.random()*22);y=10+Math.floor(Math.random()*22);for(i=1;i<4;++i){factionSize=50+Math.floor(Math.random()*250);while(fmp[y][x].faction!=0){x=10+Math.floor(Math.random()*22);y=10+Math.floor(Math.random()*22)};fmp[y][x].faction=i;seeds=[];seeds.push([x,y]);j=0;fail=0;while(j<factionSize&&fail<500){v=seeds[Math.floor(Math.random()*seeds.length)];x=iz(v[0]-5+Math.floor(Math.random()*10),0,31);y=iz(v[1]-5+Math.floor(Math.random()*10),0,31);if(fmp[y][x].faction==0){fmp[y][x].faction=i;seeds.push([x,y]);++j}else{fail++}}};t_=(e,f)=>{if(f){e.onmouseenter=_=>_.target.getElementsByTagName("text")[0].setAttribute("fill","#990");e.onmouseleave=_=>_.target.getElementsByTagName("text")[0].setAttribute("fill","#fff");e.onclick=_=>{fxA();f(_)}}else{e.getElementsByTagName("text")[0].setAttribute("fill","#fff");e.onmouseenter=null;e.onmouseleave=null;e.onclick=null}};t_(mapexit,_=>cz());ez=(x,y)=>{if(fmp[y][x].n){if(x==ship.d.mx&&y==ship.d.my){fmp[y][x].mapcell.setAttribute("stroke","#fff")}else{fmp[y][x].mapcell.setAttribute("stroke","#fff5")};fmp[y][x].mapcell.setAttribute("fill",factionCol[fmp[y][x].faction]);fmp[y][x].mapcell.setAttribute("fill-opacity",fmp[y][x].v?"0.9":"0.4");if(fmp[y][x].clue){if(fmp[y][x].it_.includes(clue)){s_(fmp[y][x].clue)}else{h_(fmp[y][x].clue)}}}};lrs=(x,y,r)=>{for(y1=iz(y-r,0,32);y1<iz(y+r,0,32);++y1){for(x1=iz(x-r,0,32);x1<iz(x+r,0,32);++x1){if(Math.sqrt(sz(x-x1)+sz(y-y1))<=r){fmp[y1][x1].n=true;ez(x1,y1)}}}};for(y=0;y<32;++y){for(x=0;x<32;++x){o=mapcell.cloneNode();o.removeAttribute("id");o.setAttribute("transform","translate("+((x*16)+40)+" "+((y*16)+34)+")");o.d={x:x,y:y};if(x==ship.d.mx&&y==ship.d.my){o.setAttribute("stroke","#fff");o.setAttribute("stroke-width",3);shipcell=o}else{o.setAttribute("stroke",fmp[y][x].n?"#fff5":"#000")};fmp[y][x].mapcell=o;ez(x,y);o.onmouseenter=_=>{d=_.target.d;f=fmp[d.y][d.x];fuelneed=hz(d);dist=nz(d.x,d.y);if(dist>warprange){text("Beyond engine warp range ( "+warprange+" sectors )")}else{text("Warp requires "+fuelneed+" fuel. "+fuel+" available")};if(fuelneed<=fuel&&dist<=warprange){f.mapcell.setAttribute("stroke","#fff")}else{f.mapcell.setAttribute("stroke","#f00")};cursorText1.textContent=`[${d.x},${d.y}]`;cursorText2.textContent=f.n?x_[f.faction].name:"";cursorText3.textContent=f.n?f.t:"";cursorText4.textContent=f.e?w_[f.p].name:(f.n&&ship.d.scanner>1?"Critters: "+f.critters:"");if(f.n&&f.it_.includes(clue))cursorText4.textContent="Transponder Signal!";if(f.yeti)cursorText4.textContent="YETI LOCATION!"};o.onmouseleave=_=>{d=_.target.d;f=fmp[d.y][d.x];if(_.target.d.x==ship.d.mx&&_.target.d.y==ship.d.my){f.mapcell.setAttribute("stroke","#fff");o.setAttribute("stroke-width",3)}else{f.mapcell.setAttribute("stroke",fmp[_.target.d.y][_.target.d.x].n?"#fff5":"#000");o.setAttribute("stroke-width",1)}};o.onclick=_=>{d=_.target.d;f=fmp[d.y][d.x];fuelneed=hz(_.target.d);if(fuelneed==0){cz()}else if(fuelneed<=fuel){fuel-=fuelneed;rundistance=Math.max(100,fuelneed*75);ship.d.mx=_.target.d.x;ship.d.my=_.target.d.y;f.mapcell.setAttribute("stroke","#ff0");shipcell.setAttribute("stroke","#fff2");shipcell=f.mapcell;gz()}};map.appendChild(o);if(fmp[y][x].it_.includes(clue)){o=transponder.cloneNode();o.removeAttribute("id");o.setAttribute("transform","translate("+((x*16)+40)+" "+((y*16)+34)+")");map.appendChild(o);if(!fmp[y][x].n){h_(o)};fmp[y][x].clue=o;o.d=fmp[y][x].mapcell.d;o.onclick=fmp[y][x].mapcell.onclick;o.onmouseenter=fmp[y][x].mapcell.onmouseenter;o.onmouseleave=fmp[y][x].mapcell.onmouseleave}}};for(i=0;i<8;++i){o=box.cloneNode();o.setAttribute("stroke","#fff");o.setAttribute("stroke-width","0.3");o.removeAttribute("id");o.d={r:90,x:-200,y:-200,z:1,t:null,u_:(o,g)=>{if(mousedown||missiletime>0){if(o.d.t){o.d.x=o.d.t.x;o.d.y=o.d.t.y;o.d.r=o.d.r*0.75;o.d.z=(4+o.d.z)/2}}else{if(o.d.t!=null){if(maxmissiles-missiles>0){if(missiletime==0){m=vz();m.d.x=ship.d.x;m.d.y=ship.d.y;m.d.t=o.d.t;m.d.to=o.d.to;o.d.t=null;o.d.x=-100;o.d.y=-100;targets.push(o)}}}};u_(o)}};targets.push(o);u_(o);l11.appendChild(o)};vz=_=>{missiles++;hasfired=true;o=box.cloneNode();o.setAttribute("stroke","#fff");o.setAttribute("stroke-width","2");o.removeAttribute("id");o.d={r:0,x:-200,y:-200,z:1,t:null,f:0,l:100,p:true,u_:(o,g)=>{if(o.d.t&&!o.d.t.d_){o.d.x=(o.d.x*0.85)+(o.d.t.x*0.15);o.d.y=(o.d.y*0.85)+(o.d.t.y*0.15);o.d.z=o.d.z*0.95;o.d.f++;if(o.d.z<0.001||o.d.l--==0){o.d.d_=true;missiles--};if(o.d.f>20||(Math.abs(o.d.x-o.d.t.x)+Math.abs(o.d.y-o.d.t.y))<50){fx2();o.d.d_=true;o.d.t.d_=true;d_(o.d.to);if(combocount.d.v>0){combocount.d.c++}else{combocount.d.c=1};combocount.d.v=360;enemies--;missiles--};u_(o)}}};u_(o);l11.appendChild(o);$.push(o);fx3();missiletime=4;return o};rz=_=>{if(mousedown){if(targets.length>0&&targetc<maxlock){t=targets.pop();t.d.t=_.target.d;t.d.to=_.target;t.d.z=1000;t.d.r=90;$.push(t);fx1(700+(50*targetc));_.target.onmouseenter=null;targetc++;bestlock=Math.max(bestlock,targetc);cursorText1.textContent=`Lock: ${targetc} / ${maxlock}`}}};tz=o=>{zap=ground.cloneNode();zap.removeAttribute("id");zap.setAttribute("filter","url(#g)");p="M0 0";for(k=1;k<65;k++)p+=`L${(Math.random()*k*2)-k} ${k*10}`;zap.setAttribute("d",p);zap.d={x:o.d.x,y:o.d.y,r:0,s:1,z:1,d_:true,p:true,u_:_=>{}};$.push(zap);u_(zap);l12.appendChild(zap);if(Math.abs(o.d.x-ship.d.x)<25){shields-=(1+(wavecount/3));shieldhit+=5;fx6()}else{fx5()}};uz=(i,r,s,wave,u)=>{o=enemybox.cloneNode();o.removeAttribute("id");o.setAttribute("d",a_());o.setAttribute("fill",cols[(i+r)%cols.length]);o.onmouseenter=rz;o.d={wave:wave,r:0,x:Math.random()*640,ry:Math.random()*640,s:s,z:0.1,dx:0,dy:0,p:true,u_:u};$.push(o);enemies++;l12.appendChild(o);return o};oz=_=>{wave=wavec<3?0:Math.round(Math.random()*3);fx4();s=0.1;wavecount++;wavec++;r=Math.floor(Math.random()*10);for(i=0;i<wavecount*2;++i){o=uz(i,r,s,wave,(o,g)=>{o.d.dx=o.d.x;o.d.dy=o.d.ry;tx=0;ty=0;if(o.d.wave==0){tx=g.x;ty=g.y}else if(o.d.wave==1){tx=(ship.d.x+g.x)/2;ty=g.y}else if(o.d.wave==2){tx=g.x1;ty=g.y1}else if(o.d.wave==3){tx=g.x2;ty=g.y2};o.d.x=(o.d.x*(1-o.d.s))+(tx*o.d.s);o.d.ry=(o.d.ry*(1-o.d.s))+(ty*o.d.s);o.d.dx=o.d.x-o.d.dx;o.d.dy=o.d.ry-o.d.dy;o.d.z=(o.d.z*0.95)+(5.0+Math.sin(n-(o.d.s*500)))*0.05;if(Math.random()*1000<wavecount*10)tz(o);if(!o.d.d_){o.d.y=250-o.d.ry+gh*(o.d.z*2);if(o.d.wave<=1){g.x=o.d.x;g.y=o.d.ry}else if(o.d.wave==2){g.x1=o.d.x;g.y1=o.d.y}else if(o.d.wave==3){g.x2=o.d.x;g.y2=o.d.y}}else{o.d.y=-100};u_(o)});s+=0.0005}};slices=20;div=10;for(i=0;i<slices;++i){o=ground.cloneNode();o.removeAttribute("id");o.d={i:i+2,sq:sz(i+2),u_:(o,g)=>{s="";if(!inwarp){for(x=0;x<=64;++x){rx=((32-x)*((slices+1-o.d.i)/10))/div;hrz=sn.n((g.gx+rx)*(0.5+g.f.random[0]),((o.d.i+g.gy)/div)*(0.5+g.f.random[1]));s+=`${x==0?"M":"L"}${x*10} ${(100-(gh*3))+((gh/slices)*o.d.sq)+(hrz*o.d.sq/2)}`}}else{wx=sn.n(g.gx,g.gy/100)*200;for(i=0;i<64;++i){x=Math.sin(i/63*(Math.PI*2));y=Math.cos(i/63*(Math.PI*2));rx=((32-(i%63))*((slices+1-o.d.i)/10))/div;r=1+(sn.n((g.gx+rx)*(0.5+g.f.random[3]),((o.d.i+g.gy)/div)*(0.5+g.f.random[2])))/10;s+=`${i==0?"M":"L"}${320+((320-ship.d.x+wx)*(o.d.i/15))+(x*((r*o.d.i*30)))} ${320+((320-ship.d.y)*(o.d.i/15))+(y*((r*o.d.i*30)))}`}};o.setAttribute("d",s);o.setAttribute("stroke",fmp[ship.d.my][ship.d.mx].pcol);l10.appendChild(o)}};$.push(o)};missiletime=0;gameloop=false;focus=true;window.onfocus=_=>{focus=true;fxX.resume()};window.onblur=_=>{focus=false;fxX.suspend()};n=0;cursor.d={r:0,x:320,y:320,z:1,u_:(o,g)=>{o.d.x=320+(mx*320);o.d.y=320+(my*320);u_(o)}};$_.push(cursor);u_(cursor);vsync.d={r:0,x:0,y:0,z:1,u_:(o,g)=>{o.d.y+=16;if(o.d.y>640)o.d.y=-200;u_(o)}};$_.push(vsync);fz();c.onmousedown=_=>{focus=true;mousedown=gameloop};c.onmouseup=_=>{if(gameloop){mousedown=false;missiletime=0;targetc=0;clearcursor()}};mx=0;my=0;rect=c.getBoundingClientRect();window.onresize=_=>rect=c.getBoundingClientRect();c.onmousemove=_=>{size=Math.min(rect.width,rect.height)/2;mx=iz(((_.clientX-rect.left)-(rect.width/2))/size,-1,1);my=iz(((_.clientY-rect.top)-(rect.height/2))/size,-1,1)};gx=100;gy=0;gh=10;qz=_=>{x=$.length;_=$;$=[];_.forEach(o=>{if(o.d.p){o.remove()}else{$.push(o)}})};g={x2c:320,y2c:200};setInterval(_=>{if(!focus)return;$_.forEach(o=>o.d.u_(o,g));if(researchtime>0)researchtime--;shields=iz(shields+(ship.d.shields/200),0,100);if(!gameloop)return;if(shields>0&&shields<100){text(`Shields: ${shields.toFixed(0)}%`)}else{if(shields<=0){s_(tutorial);tutorial.textContent="G A M E O V E R";ship.d.d_=true;fx7();shields=0;gameloop=false;setTimeout(_=>location.reload(),10000);return}};if(shields<=10&&(Math.floor(n*10)%10)==0)fxC();n+=0.025;rundistance-=1;if(Math.random()<0.05){if(inwarp){fx9()}else{fxB()}};gy-=1;if(missiletime>0)missiletime--;g.x=320+(Math.sin(n)*150);g.y=200+(Math.cos(n)*150);g.x1=320+(Math.sin(n*2)*315);g.y1=100+n;if(Math.random()<0.01){g.x2c=110+(Math.random()*420);g.y2c=110+(Math.random()*300)};g.x2=g.x2c+(Math.sin(n*3)*100);g.y2=g.y2c+(Math.cos(n*3)*100);g.f=fmp[ship.d.my][ship.d.mx];g.gy=gy;g.gx=gx;g.gh=gh;_=$;$=[];_.forEach(o=>{o.d.u_(o,g);if(o.d.d_){o.remove()}else{$.push(o)}});if(enemies==0){wavetime--;if(wavetime==0){if(inwarp){if(rundistance<=0){qz();cz()}else{wavetime=25;oz()}}else{rundistance=1000;if(waves==0){qz();lz();return}else{waves--;wavetime=25;oz()}}}};if(e_.length>0){tutorialt++;tutorial.textContent=e_[0].t;if(e_[0].e!=null){if(e_[0].e()){e_.shift();tutorialt=0;if(e_.length==0)h_(tutorial)}}}},50);fx=(...t)=>fxP(fxG(...t));fxP=(...t)=>{let e=fxX.createBufferSource(),f=fxX.createBuffer(t.length,t[0].length,fxR);t.map((d,i)=>f.getChannelData(i).set(d)),e.buffer=f,e.connect(fxX.destination),e.start();return e};fxG=(q=1,k=.05,c=220,e=0,t=0,u=.1,r=0,F=1,v=0,z=0,w=0,A=0,l=0,B=0,x=0,G=0,d=0,y=1,m=0,C=0)=>{let b=2*Math.PI,H=v*=500*b/fxR**2,I=(0<x?1:-1)*b/4,D=c*=(1+2*k*Math.random()-k)*b/fxR,Z=[],g=0,E=0,a=0,n=1,J=0,K=0,f=0,p,h;e=99+fxR*e;m*=fxR;t*=fxR;u*=fxR;d*=fxR;z*=500*b/fxR**3;x*=b/fxR;w*=b/fxR;A*=fxR;l=fxR*l|0;for(h=e+m+t+u+d|0;a<h;Z[a++]=f)++K%(100*G|0)||(f=r?1<r?2<r?3<r?Math.sin((g%b)**3):Math.max(Math.min(Math.tan(g),1),-1):1-(2*g/b%2+2)%2:1-4*Math.abs(Math.round(g/b)-g/b):Math.sin(g),f=(l?1-C+C*Math.sin(2*Math.PI*a/l):1)*(0<f?1:-1)*Math.abs(f)**F*q*fxV*(a<e?a/e:a<e+m?1-(a-e)/m*(1-y):a<e+m+t?y:a<h-d?(h-a-d)/u*y:0),f=d?f/2+(d>a?0:(a<h-d?1:(h-a)/d)*Z[a-d|0]/2):f),p=(c+=v+=z)*Math.sin(E*x-I),g+=p-p*B*(1-1E9*(Math.sin(a)+1)%2),E+=p-p*B*(1-1E9*(Math.sin(a)**2+1)%2),n&&++n>A&&(c+=w,D+=w,n=0),!l||++J%l||(c=D,v=H,n=n||1);return Z};fxV=.3;fxR=44100;fxX=new(top.AudioContext);fxM=(n,f,t,e=125)=>{let l,o,z,r,g,h,x,a,u,c,d,i,m,p,G,M=0,R=[],b=[],j=[],k=0,q=0,s=1,v={},w=fxR/e*60>>2;for(;s;k++)R=[s=a=d=m=0],t.map((e,d)=>{for(x=f[e][k]||[0,0,0],s|=!!f[e][k],G=m+(f[e][0].length-2-!a)*w,p=d==t.length-1,o=2,r=m;o<x.length+p;a=++o){for(g=x[o],u=o==x.length+p-1&&p||c!=(x[0]||0)|g|0,z=0;z<w&&a;z++>w-99&&u?i+=(i<1)/99:0)h=(1-i)*R[M++]/2||0,b[r]=(b[r]||0)-h*q+h,j[r]=(j[r++]||0)+h*q+h;g&&(i=g%1,q=x[1]||0,(g|=0)&&(R=v[[c=x[M=0]||0,g]]=v[[c,g]]||(l=[...n[c]],l[2]*=2**((g-12)/12),g>0?fxG(...l):[])))}m=G});return[b,j]};fx1=f=>fx(...[,,f,.02,,.08,1,1.19,11,,-344,.02,,,,,,.04,.02]);fx2=_=>fx(...[,,585,.01,.23,.21,4,4.87,,,,,,.4,,.3,,.76,.13,.44]);fx3=_=>fx(...[,,169,.02,,.24,1,.77,.2,,,,,2.1,,.1,,.93,.09,.02]);fx4=_=>fx(...[,,388,.38,.4,.66,,1.46,.5,-3.8,4,.02,.15,,,,,.61,.02]);fx6=_=>fx(...[,,603,.02,,.14,4,1.36,-0.6,.5,,,,,,,.05,.68,.08,.39]);fx5=_=>fx(...[,,409,.02,,.21,,.64,-0.4,.3,,,,,,,.2,.61,.05,.21]);fx8=_=>fx(...[,.3,1016,.38,.5,.5,1,.7,4.8,-6.7,-6,.01,.04,1.2,.1,,.05,1.9,1]);fx9=_=>fx(...[.25,25,51,.33,.03,.52,1,0,,-2.6,-318,.04,.01,,,.1,.13,1.1,.1,.43]);fxA=_=>fx(...[2.8,,403,.01,,.07,,1.87,,,,,,.2,4.3,,.11,.66,,.02]);fxB=_=>fx(...[,,43,,.19,1.72,1,1.53,,,,,,.3,,.9,.23,.92,.01,.01]);fx7=_=>fx(...[,,533,,3,3,3,3.49,.5,.4,,,,.6,.2,.2,,.6,1]);fxC=_=>fx(...[,,150,,.9,0,,.1,,3.5,,,,,1.4,,.33,,.14]);fxD=_=>fx(...[,,688,.28,.32,.38,2,,,-5.8,-827,.02,.09,,.1,,.14,.69,.03]);fx0=fxM(...[[[1.5,0,84,,,,,.7,,,,.5,,6.7,1,.05],[,0,655,,,.09,3,1.65,,,,,,3.8,,,1],[.5,0,80,,,1,3],[.3,0,80,,1,.35,3,,,,,,,,,,,,,1],[.3,0,240,,1,.35,3,,,,,,,,,,,,,1],[.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.3],[.3,0,80,,.5,.35,3,,,,,.09,.05]],[[[,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,1,,],[1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1],[5,,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5],[2,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,8,15,12,15,8,15,12,15,8,15,12,15,8,15,12,15],[3,,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,8,8,8,,8,8,8,,8,8,8,,8,8,8],[4,,1,,,,,,,,,,,,10,,,,5,,,,,,,,,,,,6,,5,,1,,,,,,1,,5,,1,,5,,10,,8,,,,,,,,,,,,,6,5,3]],[[,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,1,,],[1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1],[5,,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5],[2,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,8,15,12,15,8,15,12,15,8,15,12,15,8,15,12,15],[3,,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,8,8,8,,8,8,8,,8,8,8,,8,8,8],[4,,1,8,5,8,1,,,,,,,,,,,,5,12,8,12,5,,,,,,,,,,,,1,5,8,10,8,,,,,,,,,,,,12,,,,8,,,,,,,,,,,,]],[[,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,1,,],[6,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,8,15,12,15,8,15,12,15,8,,,,,,,,],[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,5,,5,,,,5,5],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,5,,,5],[6,,,,,,,,,,,,,,,,,,,5,5,5,,5,5,5,,,,,,,,,,,,,,,,,,,,,,,,,,8,8,8,,8,8,8,,,,,,,,,]],[[,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,1,,,,1,,],[1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,1],[5,,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,5,5,5],[2,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,8,15,12,15,8,15,12,15,8,15,12,15,8,15,12,15],[3,,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,8,8,8,,8,8,8,,8,8,8,,8,8,8]],[[6,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,8,15,12,15,8,15,12,15,8,15,12,15,8,15,12,15],[3,,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,5,5,5,,5,5,5,,5,5,5,,5,5,5,,1,1,1,,1,1,1,,1,1,1,,1,1,1,,8,8,8,,8,8,8,,8,8,8,,8,8,8],[4,,1,,,,,,,,,,,,10,,,,5,,,,,,,,,,,,6,,5,,1,,,,,,,,,,,,10,,,,8,,,,,,,,,,,,,,,,],[,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,1,,,,1,,],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,1],[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,1,,1,,1,,]],[[4,,1,,,,,,,,,,,,10,,,,5,,,,,,,,,,,,,,,,1,,,,,,,,,,,,5,,,,3,,,,,,,,1,,,,,,,,],[,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,1,,1,,1,,1,,1,,1,,1,,1,,1,,,,1,,,,1,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[6,,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,12,8,12,1,8,5,8,1,8,5,8,1,8,5,8,1,8,5,8,5,12,8,12,5,12,8,12,5,12,8,12,5,,8,,],[3,,,1,1,1,,1,1,1,,,,,,,,,,5,5,5,,5,5,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]],[2,3,0,0,1,1,4,0,1,5],85,])</script>