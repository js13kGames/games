<!doctype html><title>Learn to Code Cat - js13kGames 2025</title><style>body{margin:0;padding:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#111;font-family:Arial}canvas{border:2px solid #444;background:#222}</style><canvas id=gameCanvas></canvas><script>let t,i;var e={x:64,y:64},l=0,h=!1,o=!1,s=!1,a="";let n={},r=Math.sqrt(25),c=(console.log(0===r?{x:0,y:0}:{x:3/r,y:4/r}),0);function g(n){var r,d,f=(n-c)/1e3;if(c=n,P&&"playing"===P.u&&((isNaN(T.m.x)||isNaN(T.m.y))&&(T.m.x=0,T.m.y=0),r=(n=T).F*T.o/2,d=T.D*T.o/2,isNaN(r)||isNaN(d)?console.warn("Invalid camera target:",r,d):(d-=.5*n.M,n.m.targetX=Math.max(0,Math.min(r-.5*n.N,n.F*n.o-n.N)),n.m.targetY=Math.max(0,Math.min(d,n.D*n.o-n.M)),isNaN(n.m.targetX)||isNaN(n.m.targetY)?console.warn("Camera target became NaN:",n.m.targetX,n.m.targetY):(n.m.x+=(n.m.targetX-n.m.x)*n.ia,n.m.y+=(n.m.targetY-n.m.y)*n.ia)),isNaN(T.m.x)&&(T.m.x=0),isNaN(T.m.y)&&(T.m.y=0),n=C(T,2,2),e.x=n.x+16,e.y=n.y+16,l+=f,S.update(f),0<S.v.length)&&!o&&!s&&(f=(n=S.v[0]).h,n=n.i,f<0||f>=T.F||n<0||n>=T.D?(s=!0,a="Cat went off the screen!",S.script.stop(),console.log("Game Over! Cat went off screen at:",f,n)):2===f&&2===n&&(h=o=!0,S.script.stop(),console.log("Level Complete! Cat reached home!"))),P&&P.H(i),P&&"playing"===P.u){if(i.save(),i.beginPath(),i.rect(0,0,800,t.height),i.clip(),f=i,n=(r=A()).T,r=r.sa||"#222",d=f.createLinearGradient(0,0,0,t.height),"futuristic"===n)for(d.addColorStop(0,"#000033"),d.addColorStop(1,r),f.fillStyle=d,f.fillRect(0,0,t.width,t.height),f.fillStyle="#FFFFFF",r=0;r<20;r++)f.fillRect(Math.random()*t.width,t.height/2*Math.random(),2,2);else"industrial"===n?(d.addColorStop(0,"#8B7D6B"),d.addColorStop(1,r),f.fillStyle=d,f.fillRect(0,0,t.width,t.height)):"residential"===n?(d.addColorStop(0,"#FF6B6B"),d.addColorStop(.3,"#FFE66D"),d.addColorStop(1,r),f.fillStyle=d,f.fillRect(0,0,t.width,t.height)):(d.addColorStop(0,"#87CEEB"),d.addColorStop(1,r),f.fillStyle=d,f.fillRect(0,0,t.width,t.height),"futuristic"!==n&&"industrial"!==n&&(f.fillStyle="rgba(255, 255, 255, 0.8)",f.beginPath(),f.arc(150,80,30,0,2*Math.PI),f.arc(180,80,40,0,2*Math.PI),f.arc(210,80,30,0,2*Math.PI),f.fill(),f.beginPath(),f.arc(450,60,25,0,2*Math.PI),f.arc(475,60,35,0,2*Math.PI),f.arc(500,60,25,0,2*Math.PI),f.fill()));for(var y of(function(i,e){i.fillStyle="rgba(0, 0, 0, 0.3)",[{x:-50,width:60,height:150},{x:20,width:40,height:120},{x:70,width:80,height:180},{x:160,width:50,height:140},{x:220,width:70,height:200},{x:300,width:90,height:160},{x:400,width:60,height:190},{x:470,width:100,height:170},{x:580,width:80,height:150},{x:670,width:60,height:130},{x:740,width:90,height:160}].forEach(e=>{i.fillRect(e.x,t.height-e.height-100,e.width,e.height)}),i.fillStyle="futuristic"===e?"rgba(25, 25, 112, 0.2)":"industrial"===e?"rgba(139, 125, 107, 0.2)":"rgba(135, 206, 235, 0.2)",i.fillRect(0,0,t.width,t.height-200)}(f,n),i.translate(-T.m.x,-T.m.y),f=i,0===G.length&&console.log("No blockades found to render!"),G))y.H(f);if(f=i,(y=T).ha){for(f.strokeStyle="rgba(255, 255, 255, 0.1)",f.lineWidth=1,r=0;r<=y.F;r++)0<=(n=r*y.o-y.m.x)&&n<=y.N&&(f.beginPath(),f.moveTo(n,0),f.lineTo(n,y.M),f.stroke());for(r=0;r<=y.D;r++)0<=(n=r*y.o-y.m.y)&&n<=y.M&&(f.beginPath(),f.moveTo(0,n),f.lineTo(y.N,n),f.stroke())}S.H(i),y=i,T.isVisible(e.x-25,e.y-25,50,50)&&(n=25*(1+.3*Math.sin(1.5*l)),f=h?"#FFD700":"#00FF00",r=h?"#FFA500":"#FFFFFF",y.fillStyle=f,y.beginPath(),y.arc(e.x,e.y,n,0,2*Math.PI),y.fill(),y.strokeStyle=r,y.lineWidth=4,y.beginPath(),y.arc(e.x,e.y,n,0,2*Math.PI),y.stroke(),y.fillStyle="#FFFFFF",y.fillRect(e.x-(n*=.6)/2,e.y-n/4,n,n/2),y.beginPath(),y.moveTo(e.x-n/2,e.y-n/4),y.lineTo(e.x,e.y-n/2),y.lineTo(e.x+n/2,e.y-n/4),y.closePath(),y.fill(),y.fillStyle=f,y.fillRect(e.x-(f=.2*n)/2,e.y-(n*=.3)/2,f,n)),i.restore(),P&&P.H(i),y=i,(o||s)&&(y.save(),y.fillStyle="rgba(0, 0, 0, 0.7)",y.fillRect(0,0,800,t.height),y.textAlign="center",y.textBaseline="middle",f=t.height/2,o?(y.fillStyle="#00ff00",y.font="bold 48px Arial",y.fillText("GAME DONE!",400,f-30),y.fillStyle="#ffffff",y.font="bold 24px Arial",y.fillText("🎉 The cat made it home! 🎉",400,f+20),y.font="18px Arial",y.fillText("Great job placing the blocks!",400,f+50),y.fillStyle="#FFD700",y.font="bold 20px Arial",y.fillText("🚀 More levels coming soon! 🚀",400,f+85),y.fillStyle="#CCCCCC",y.font="16px Arial",y.fillText("Stay tuned for more programming challenges!",400,f+110)):s&&(y.fillStyle="#ff0000",y.font="bold 48px Arial",y.fillText("GAME OVER",400,f-30),y.fillStyle="#ffffff",y.font="bold 20px Arial",y.fillText(a||"Try again!",400,f+10),y.font="16px Arial",y.fillText('Use "Reset Level" to try again',400,f+40)),y.restore())}requestAnimationFrame(g)}window.onload=function(){t=document.getElementById("gameCanvas"),i=t.getContext("2d"),t.width=1200,t.height=600,(P=new L).init(t),document.addEventListener("keydown",()=>{}),document.addEventListener("keyup",()=>{}),M(R,1),g()};let d=null,f=!1;function y(t){var i=(t.direction+2)%4;let e;for(;(e=Math.floor(4*Math.random()))===i&&Math.random()<.7;);t.direction=e}function x(t){var i=t.h;let e=t.i;switch(t.direction){case 0:e--;break;case 1:i++;break;case 2:e++;break;case 3:i--}if(i<0||i>=T.F||e<0||e>=T.D)return!1;var l,h=i+","+e;if(!(l=t.S.includes(h)&&2<t.S.length))t:{for(var o of G)if(("building"===o.type||"smokestack"===o.type)&&i>=o.h&&i<o.h+o.l&&e>=o.i&&e<o.i+o.j){l=!0;break t}l=!1}return!l&&(t.h=i,t.i=e,i=C(T,i,e),t.g.x=i.x+6,t.g.y=i.y+6,t.S.push(h),t.S.length>t.qa&&t.S.shift(),!0)}function u(t,i,e){var l=t.h+i,h=t.i+e;console.log(`Trying to move from (${t.h}, ${t.i}) to (${l}, ${h})`);t:{if(void 0!==G)for(o of G)if(("building"===o.type||"smokestack"===o.type||"platform"===o.type)&&l>=o.h&&l<o.h+o.l&&h>=o.i&&h<o.i+o.j)break t;var o=null}return o?(console.log(`Movement blocked: collision at (${l}, ${h})`),void 0!==S&&S.script.W[S.script.V]?.ea&&(o.id&&o.id.startsWith("user_")?(console.log("Hit player block - turning right"),i=t.direction,t.direction=(t.direction+3)%4,e=["up","right","down","left"],console.log(`Cat turned RIGHT from ${e[i]} to ${e[t.direction]} (${i} -> ${t.direction})`)):(console.log("Hit building - reversing"),t.direction=(t.direction+2)%4,console.log("Cat reversed, now facing direction "+t.direction))),!1):(t.h=l,t.i=h,l=C(T,l,h),t.g.x=l.x+6,t.g.y=l.y+6,console.log(`Cat moved to grid (${t.h}, ${t.i}), world (${t.g.x}, ${t.g.y})`),0<i?t.direction=1:i<0?t.direction=3:0<e?t.direction=2:e<0&&(t.direction=0),!0)}function p(t){return[{x:0,y:-3},{x:3,y:0},{x:0,y:3},{x:-3,y:0}][t.direction]}d||((d=new Image).onload=function(){f=!0,console.log("Cat image loaded successfully:",d.width+"x"+d.height)},d.onerror=function(){f=!1},d.src="c.png");class b{constructor(t,i,e="#FF6B35"){this.h=t,this.i=i,t=C(T,t,i),this.g={x:t.x+6||0,y:t.y+6||0},this.height=this.width=24,this.color=e,this.direction=Math.floor(4*Math.random()),this.R=0,this.ga=1+2*Math.random(),this.X=0,this.fa=2+4*Math.random(),this.B=Math.random()<.3,this.da=this.$=0,this.la=Math.random(),this.oa=Math.random(),this.speed=.8+.4*Math.random(),this.S=[],this.qa=5,this.Y=!1}update(t){if(this.da+=3*t,this.B)this.X+=t,(this.X>=this.fa||Math.random()<.01)&&(this.B=!1,this.X=0,this.fa=2+4*Math.random(),y(this));else t:if(this.R+=t,this.R>=this.ga){if(this.Y)this.B=!0;else{if(Math.random()<.3*this.oa){this.B=!0,this.R=0;break t}x(this)||(y(this),x(this)),Math.random()<.2*this.la&&y(this)}this.R=0,this.ga=.8+1.5*Math.random()}this.B||(this.$+=4*t)}H(t){var i,e,l,h,o,s,a;T.isVisible(this.g.x-10,this.g.y-10,this.width+20,this.height+20)&&(i=this.g.x+this.width/2,e=this.g.y+this.height/2,f&&d&&d.complete?(t.save(),t.translate(i,e),this.B||t.rotate([0,Math.PI/2,Math.PI,-Math.PI/2][this.direction]),l=0,this.B||(l=+Math.sin(this.$)),t.drawImage(d,-14,-14+l,28,28),t.restore(),t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.ellipse(i,e+12,this.width/3,this.height/6,0,0,2*Math.PI),t.fill()):(t.fillStyle=this.color,t.beginPath(),t.ellipse(i,e,this.width/2,this.height/2.5,0,0,2*Math.PI),t.fill(),l=i+(h=p(this)).x,h=e+h.y-8,t.beginPath(),t.arc(l,h,8,0,2*Math.PI),t.fill(),t.fillStyle=this.color,t.beginPath(),t.moveTo(l-5,h-6),t.lineTo(l-2,h-10),t.lineTo(l-1,h-6),t.fill(),t.beginPath(),t.moveTo(l+5,h-6),t.lineTo(l+2,h-10),t.lineTo(l+1,h-6),t.fill(),t.fillStyle="#FFB6C1",t.beginPath(),t.arc(l-3,h-7,1.5,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(l+3,h-7,1.5,0,2*Math.PI),t.fill(),s=i-8+3*(o=.5*Math.sin(this.da)),a=e+6+2*Math.abs(o),t.strokeStyle=this.color,t.lineWidth=4,t.lineCap="round",t.beginPath(),t.moveTo(i-6,e+4),t.quadraticCurveTo(s,a,s-4+2*o,a+4),t.stroke(),t.fillStyle="#000",o=p(this),t.beginPath(),t.arc(l-3+.3*o.x,h-2,1.5,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(l+3+.3*o.x,h-2,1.5,0,2*Math.PI),t.fill(),t.fillStyle="#FFB6C1",t.beginPath(),t.arc(l+.2*o.x,1+h,1,0,2*Math.PI),t.fill(),this.B||(l=2*Math.sin(this.$),t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.arc(i-4+l,e+8,1,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(i+4-l,e+8,1,0,2*Math.PI),t.fill())),T.ha)&&(t.fillStyle="rgba(255, 255, 255, 0.8)",t.font="10px Arial",t.textAlign="center",t.fillText(["↑","→","↓","←"][this.direction],i,e-20))}}class v{constructor(){this.O=[],this.K=0,this.P=!1,this.ka=.5,this.J=0,this.W={collision_smart:{name:"Smart Collision Cat",description:"Reverses when hitting buildings, turns left when hitting player blocks.",script:["move right"],ua:1,ea:!0}},this.V="collision_smart",this.ma=this.W[this.V].script,this.O=[...this.ma],this.J=this.K=0}start(){this.P=!0,this.J=this.K=0,console.log("Cat script started")}stop(){this.P=!1,console.log("Cat script stopped")}reset(){this.J=this.K=0,this.P=!1,console.log("Cat script reset")}aa(){return this.W[this.V]}update(t,i){if(this.P&&0!==this.O.length&&(this.J+=t,this.J>=this.ka)){if(this.W[this.V]?.ea){var e=t=0,l="";switch(i.direction){case 0:e=-1,l="up";break;case 1:t=1,l="right";break;case 2:e=1,l="down";break;case 3:t=-1,l="left"}console.log(`Cat moving ${l} from position (${i.h}, ${i.i})`),0===t&&0===e||(t=u(i,t,e),console.log(`Move result: ${t}, new position: (${i.h}, ${i.i})`))}else{if(!(this.K>=this.O.length)&&(t=this.O[this.K].toLowerCase().trim(),console.log("Executing command: "+t),t.startsWith("move "))){switch(t=t.substring(5),l=e=0,console.log(`Moving cat ${t} from position (${i.h}, ${i.i})`),t){case"up":l=-1,i.direction=0;break;case"right":i.direction=e=1;break;case"down":l=1,i.direction=2;break;case"left":e=-1,i.direction=3}0===e&&0===l||(t=u(i,e,l),console.log(`Move result: ${t}, new position: (${i.h}, ${i.i})`))}this.K=(this.K+1)%this.O.length}this.J=0}}}function m(t){var i=4,e=4,l=(void 0!==n&&(e=i=45),i=(e=k(i,e)).x,e=e.y,["#FF6B35","#8B4513","#FFA500"]);(l=new b(i,e,l[Math.floor(Math.random()*l.length)])).Y=!1,l.B=!0,t.v.push(l),console.log(`Spawned scripted cat at (${i}, ${e})`)}function w(){var t,i=S;i.script.reset(),0<i.v.length&&((i=i.v[0]).h=4,i.i=4,t=C(T,i.h,i.i),i.g.x=t.x+6,i.g.y=t.y+6)}function F(t,i){if(void 0!==G)for(var e of G)if(("building"===e.type||"smokestack"===e.type||"platform"===e.type)&&t>=e.h&&t<e.h+e.l&&i>=e.i&&i<e.i+e.j)return!1;return!0}function k(t,i){if(!F(t,i)){for(var e=1;e<=5;e++)for(var l=-e;l<=e;l++)for(let s=-e;s<=e;s++)if(Math.abs(l)===e||Math.abs(s)===e){var h=t+l,o=i+s;if(0<=h&&h<T.F&&0<=o&&o<T.D&&F(h,o))return{x:h,y:o}}for(e=0;e<T.D;e++)for(l=0;l<T.F;l++)if(F(l,e))return{x:l,y:e};console.warn("No valid spawn position found, using preferred position anyway")}return{x:t,y:i}}let S=new class{constructor(){this.v=[],this.ba=!1,this.script=new v}update(t){for(var i of this.v)i.Y=!1,i.B=!this.script.P,this.script.update(t,i),i.update(t);this.ba||0!==this.v.length||(m(this),this.ba=!0)}H(t){for(var i of this.v)i.H(t)}aa(){return this.script.aa()}};function C(t,i,e){return{x:i*t.o,y:e*t.o}}let T=new class{constructor(){this.o=32,this.D=this.F=50,this.N=800,this.M=600,this.m={x:0,y:0,targetX:0,targetY:0,ia:.15},this.ha=!0}isVisible(t,i,e=this.o,l=this.o){return t-=this.m.x,i-=this.m.y,0<=t+e&&t<=this.N&&0<=i+l&&i<=this.M}};function A(){var t=R;return t.ca[t.C]}function M(t,i){var e;i<1||i>t.Z?console.error(`Level ${i} does not exist!`):(t.C=i,e=t.ca[i],G=[],function(){var t=S;t.v=[],t.ba=!1}(),e.na.forEach(t=>{var i=(t=function(t,i,e,l,h,o="building"){var s=T,a=C(s,t,i);return{h:t,i:i,l:e,j:l,x:a.x,y:a.y,width:e*s.o,height:l*s.o,color:h,type:o}}(t.h,t.i,t.l,t.j,t.color,t.type)).x,l=t.y,h=t.width,o=t.height,s=new W(i,l,h,o,t.color);G.push(s),console.log(`Created blockade at (${i}, ${l}) with size ${h}x${o}. Total blockades: `+G.length),s.h=t.h,s.i=t.i,s.l=t.l,s.j=t.j,s.type=t.type,s.T=e.T}),console.log(`Loaded level ${i}: `+e.name))}let P,R=new class{constructor(){this.Z=this.C=1,this.ca={1:{name:"Cat Navigation Challenge",description:"Help the cat reach home by placing blocks to guide its path",T:"educational",sa:"#87CEEB",na:[{h:0,i:0,l:50,j:50,color:"#2F4F4F",type:"ground"},{h:5,i:5,l:6,j:8,color:"#8B4513",type:"building"},{h:15,i:3,l:7,j:12,color:"#A0522D",type:"building"},{h:25,i:6,l:5,j:9,color:"#8B4513",type:"building"},{h:35,i:4,l:8,j:11,color:"#654321",type:"building"},{h:3,i:18,l:7,j:6,color:"#A0522D",type:"building"},{h:14,i:20,l:6,j:8,color:"#8B4513",type:"building"},{h:24,i:17,l:8,j:10,color:"#654321",type:"building"},{h:36,i:19,l:5,j:7,color:"#A0522D",type:"building"},{h:6,i:30,l:5,j:6,color:"#8B4513",type:"building"},{h:16,i:32,l:7,j:8,color:"#654321",type:"building"},{h:28,i:31,l:6,j:7,color:"#A0522D",type:"building"},{h:38,i:33,l:5,j:5,color:"#8B4513",type:"building"},{h:12,i:8,l:2,j:3,color:"#696969",type:"building"},{h:32,i:12,l:2,j:4,color:"#696969",type:"building"},{h:8,i:26,l:3,j:2,color:"#696969",type:"building"},{h:21,i:28,l:2,j:3,color:"#696969",type:"building"},{h:42,i:28,l:3,j:3,color:"#696969",type:"building"},{h:1,i:40,l:8,j:4,color:"#2F4F4F",type:"building"},{h:12,i:42,l:6,j:5,color:"#2F4F4F",type:"building"},{h:22,i:41,l:9,j:6,color:"#2F4F4F",type:"building"},{h:35,i:40,l:7,j:4,color:"#2F4F4F",type:"building"},{h:4,i:35,l:1,j:8,color:"#4A4A4A",type:"smokestack"},{h:19,i:38,l:1,j:6,color:"#4A4A4A",type:"smokestack"},{h:29,i:36,l:1,j:7,color:"#4A4A4A",type:"smokestack"},{h:41,i:37,l:1,j:5,color:"#4A4A4A",type:"smokestack"},{h:11,i:15,l:2,j:2,color:"#228B22",type:"park"},{h:33,i:22,l:2,j:2,color:"#228B22",type:"park"}],va:{h:2,i:2}}}}};function $(t,i){return t=t.canvas.getBoundingClientRect(),{x:i.clientX-t.left,y:i.clientY-t.top}}function B(t,i){return t.x>=i.x&&t.x<=i.x+i.width&&t.y>=i.y&&t.y<=i.y+i.height}function E(t){if(void 0!==G&&0<t.I.length){let i=t.I.map(t=>t.id);G=G.filter(t=>!i.includes(t.id)),t.I=[],t.L=0,console.log(`Reset ${i.length} user-placed blocks`),console.log("Remaining blockades: "+G.length)}}function j(t,i,e,l,h,o=!1){t=t.U===e.id,i.fillStyle=t?h:l,i.fillRect(e.x,e.y,e.width,e.height),i.strokeStyle=t?"#ffffff":"#dddddd",i.lineWidth=t?3:2,i.strokeRect(e.x,e.y,e.width,e.height),i.fillStyle="#ffffff",i.font=o?"14px Arial":"bold 18px Arial",i.textAlign="center",i.fillText(e.text,e.x+e.width/2,e.y+e.height/2+(o?4:6))}function I(t,i){let e=t.A+20,l=80;if(i.fillStyle="#FFFFFF",i.font="bold 18px Arial",i.textAlign="left",i.fillText("Objective",e,l),l+=30,i.font="14px Arial",i.fillStyle="#FFD700",i.fillText("Help the cat reach home!",e,l),l+=25,i.fillStyle="#FFFFFF",i.font="bold 16px Arial",i.fillText("Instructions",e,l),l+=25,i.font="13px Arial",i.fillStyle="#CCCCCC",["1. Click to place blocks","2. Click blocks to remove them",'3. Press "Start Cat" to begin',"4. Watch the cat follow its path"].forEach(t=>{i.fillText(t,e,l),l+=20}),l+=15,i.fillStyle="#FFFFFF",i.font="bold 16px Arial",i.fillText("Cat Behavior",e,l),l+=25,void 0!==S&&(h=S.aa())){i.font="bold 14px Arial",i.fillStyle="#4CAF50",i.fillText(h.name,e,l),l+=20,i.font="12px Arial",i.fillStyle="#CCCCCC";let o="",s=t.G-60;h.description.split(" ").forEach(t=>{var h=o+t+" ";i.measureText(h).width>s&&""!==o?(i.fillText(o,e,l),o=t+" ",l+=16):o=h}),i.fillText(o,e,l),l+=25}var h,r={id:"startEducationalCat",x:e,y:l,width:100,height:30,text:"Start Cat",action:(h=!(void 0!==n&&(s||o)))?"startEducationalCat":null};h&&t.buttons.push(r),j(t,i,r,h?"#4CAF50":"#757575",h?"#45a049":"#616161",!0),h={id:"resetEducationalLevel",x:e+100+10,y:l,width:100,height:30,text:"Reset Level",action:"resetEducationalLevel"},t.buttons.push(h),j(t,i,h,"#FF5722","#E64A19",!0),l+=40,h={id:"resetBlocks",x:e+55,y:l,width:100,height:30,text:"Reset Blocks",action:"resetBlocks"},t.buttons.push(h),j(t,i,h,"#9C27B0","#7B1FA2",!0),l+=50,void 0!==n&&(o?(i.fillStyle="#FFD700",i.font="bold 20px Arial",i.textAlign="center",i.fillText("🎉 LEVEL COMPLETE! 🎉",t.A+t.G/2,l),l+=30,i.font="14px Arial",i.fillStyle="#4CAF50",i.fillText("The cat made it home!",t.A+t.G/2,l)):s&&(i.fillStyle="#FF5722",i.font="bold 20px Arial",i.textAlign="center",i.fillText("💀 GAME OVER 💀",t.A+t.G/2,l),l+=30,i.font="14px Arial",i.fillStyle="#FF8A80",i.fillText(a,t.A+t.G/2,l),l+=25,i.font="12px Arial",i.fillStyle="#CCCCCC",i.fillText("Try placing blocks to keep the cat on screen!",t.A+t.G/2,l)))}class L{constructor(){this.u="menu",this.U=null,this.buttons=[],this.canvas=null,this.G=400,this.A=800,this.ra={id:"building",name:"Building",color:"#8B4513",l:1,j:1},this.L=0,this.I=[]}init(t){this.canvas=t,function(t){t.canvas.addEventListener("click",i=>{t:{for(e of(i=$(t,i),t.buttons))if(B(i,e)){switch(i=t,e.action){case"startGame":i.u="playing";break;case"levelSelect":i.u="levelSelect";break;case"loadLevel":M(R,e.pa),i.u="playing";break;case"nextLevel":var e=R;e.C<e.Z&&M(e,e.C+1);break;case"prevLevel":1<(e=R).C&&M(e,e.C-1);break;case"backToMenu":i.u="menu";break;case"runCatScript":var l;void 0!==S&&(0===(e=S).v.length?m(e):((i=e.v[0]).Y=!1,i.B=!0,i.h=4,i.i=4,l=C(T,i.h,i.i),i.g.x=l.x+6,i.g.y=l.y+6,console.log(`Using existing cat at (${i.h}, ${i.i})`)),e.script.start());break;case"resetCatScript":void 0!==S&&w();break;case"startEducationalCat":var r;void 0!==S&&(0<(e=S).v.length&&(i=e.v[0],void 0!==n)&&(l=k(45,45),i.h=l.x,i.i=l.y,r=C(T,i.h,i.i),i.g.x=r.x+6,i.g.y=r.y+6,console.log(`Cat repositioned to valid spawn at (${l.x}, ${l.y})`)),void 0!==n&&(s=o=!1,a="",h=!1),e.script.start(),console.log("Educational level started"));break;case"resetEducationalLevel":void 0!==S&&(w(),void 0!==n)&&(s=o=!1,a="",h=!1);break;case"resetBlocks":E(i)}e=void 0;break t}if(i.x>=t.A)console.log("Side panel clicked at:",i.x-t.A,i.y);else if("playing"===t.u){console.log("Handling block click at screen position:",i),console.log("Camera position:",T.m.x,T.m.y),e=i.x+(isNaN(T.m.x)?0:T.m.x),l=i.y+(isNaN(T.m.y)?0:T.m.y),console.log("World position:",e,l),i=T,e={x:Math.floor(e/i.o),y:Math.floor(l/i.o)},console.log("Grid position:",e);i:{for(i=0;i<t.I.length;i++)if((l=t.I[i]).h===e.x&&l.i===e.y)break i;i=-1}-1!==i?(e=t.I[i],console.log(`Deleting user block at (${e.h}, ${e.i})`),t.I.splice(i,1),-1!==(e=G.indexOf(e.ja))&&G.splice(e,1),t.L--,console.log("Blocks placed: "+t.L)):(i=t.ra,l=e.x,e=e.y,console.log(`Attempting to place ${i.name} at grid (${l}, ${e})`),console.log("Block size:",i.l,"x",i.j),console.log("World bounds:",T.F,"x",T.D),e=l<0||e<0||l+i.l>T.F||e+i.j>T.D?(console.log("Block placement failed: out of bounds"),!1):(r=C(T,l,e),console.log("Creating blockade at world position:",r),(r=new W(r.x,r.y,i.l*T.o,i.j*T.o,i.color)).type=i.id,r.h=l,r.i=e,r.l=i.l,r.j=i.j,r.id="user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),G.push(r),t.I.push({id:r.id,h:l,i:e,ja:r}),t.L++,console.log(`Successfully placed ${i.name} at grid (${l}, ${e})`),console.log("Total blockades:",G.length),console.log("Blocks placed: "+t.L),!0),console.log("Block placement result:",e))}e=void 0}return e}),t.canvas.addEventListener("mousemove",i=>{t:{for(e of(i=$(t,i),t.U=null,t.buttons))if(B(i,e)){t.U=e.id,t.canvas.style.cursor="pointer";var e=void 0;break t}t.canvas.style.cursor="default",e=void 0}return e}),t.canvas.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("keydown",i=>{"Escape"!==i.code||"playing"!==t.u&&"levelSelect"!==t.u||(t.u="menu"),"Enter"===i.code&&"menu"===t.u&&(t.u="playing")})}(this)}H(i){switch(this.u){case"menu":this.buttons=[];var e=i.createLinearGradient(0,0,0,t.height);e.addColorStop(0,"#1a1a2e"),e.addColorStop(1,"#16213e"),i.fillStyle=e,i.fillRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="#ffffff",i.font="bold 48px Arial",i.textAlign="center",i.fillText("Blockade Runner",this.canvas.width/2,120),i.fillStyle="#cccccc",i.font="20px Arial",i.fillText("Navigate the platforms and reach your goals!",this.canvas.width/2,160),e={id:"start",x:this.canvas.width/2-100,y:220,width:200,height:50,text:"Start Game",action:"startGame"},this.buttons.push(e),j(this,i,e,"#4CAF50","#45a049"),e={id:"levelSelect",x:this.canvas.width/2-100,y:290,width:200,height:50,text:"Select Level",action:"levelSelect"},this.buttons.push(e),j(this,i,e,"#2196F3","#1976D2"),i.fillStyle="#aaaaaa",i.font="16px Arial",i.fillText("Player is now stationary (attached to map)",this.canvas.width/2,420),i.fillText("Use Run Cat and Reset Cat buttons to control cat",this.canvas.width/2,450),i.fillText("Press ESC to return to menu",this.canvas.width/2,480),i.fillText("Click to place/delete blocks in game",this.canvas.width/2,510);break;case"levelSelect":this.buttons=[],(e=i.createLinearGradient(0,0,0,t.height)).addColorStop(0,"#2e1a1a"),e.addColorStop(1,"#3e1616"),i.fillStyle=e,i.fillRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="#ffffff",i.font="bold 36px Arial",i.textAlign="center",i.fillText("Select Level",this.canvas.width/2,80),e=(this.canvas.width-460)/2;for(let t=1;t<=R.Z;t++){var l=R.ca[t],h=R.C===t,o={id:"level"+t,x:e+(t-1)%3*160,y:140+120*Math.floor((t-1)/3),width:140,height:100,text:"Level "+t,ta:l.name,description:l.description,action:"loadLevel",pa:t},s=(this.buttons.push(o),this.U===o.id);(l=i).fillStyle=s?h?"#F57C00":"#546E7A":h?"#FF9800":"#607D8B",l.fillRect(o.x,o.y,o.width,o.height),l.strokeStyle=h?"#FFC107":s?"#ffffff":"#dddddd",l.lineWidth=h?4:s?3:2,l.strokeRect(o.x,o.y,o.width,o.height),l.fillStyle="#ffffff",l.font="bold 24px Arial",l.textAlign="center",l.fillText(o.text,o.x+o.width/2,o.y+30),l.font="bold 14px Arial",l.fillText(o.ta,o.x+o.width/2,o.y+55),l.font="12px Arial",l.fillStyle="#e0e0e0",l.fillText(o.description,o.x+o.width/2,o.y+75),h&&(l.fillStyle="#FFC107",l.font="bold 10px Arial",l.fillText("CURRENT",o.x+o.width/2,o.y+90))}e={id:"back",x:50,y:this.canvas.height-80,width:120,height:40,text:"Back to Menu",action:"backToMenu"},this.buttons.push(e),j(this,i,e,"#757575","#616161"),i.fillStyle="#cccccc",i.font="16px Arial",i.textAlign="center",i.fillText("Click on a level to play it",this.canvas.width/2,this.canvas.height-40);break;case"playing":this.buttons=[],i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(0,0,this.canvas.width,60),e=A(),i.fillStyle="#ffffff",i.font="bold 20px Arial",i.textAlign="left",i.fillText(`Level ${R.C}: `+e.name,20,25),i.font="14px Arial",i.fillStyle="#cccccc",i.fillText(e.description,20,45),1!==R.C&&(e={id:"prev",x:this.canvas.width-200,y:10,width:80,height:40,text:"Previous",action:"prevLevel"},this.buttons.push(e),j(this,i,e,"#FF5722","#E64A19",!0)),(e=R).C!==e.Z&&(e={id:"next",x:this.canvas.width-110,y:10,width:80,height:40,text:"Next",action:"nextLevel"},this.buttons.push(e),j(this,i,e,"#4CAF50","#45a049",!0)),e={id:"menu",x:20,y:this.canvas.height-50,width:60,height:30,text:"Menu",action:"backToMenu"},this.buttons.push(e),j(this,i,e,"#9E9E9E","#757575",!0),e={id:"runScript",x:100,y:this.canvas.height-50,width:80,height:30,text:"Run Cat",action:"runCatScript"},this.buttons.push(e),j(this,i,e,"#4CAF50","#45a049",!0),e={id:"resetScript",x:190,y:this.canvas.height-50,width:80,height:30,text:"Reset Cat",action:"resetCatScript"},this.buttons.push(e),j(this,i,e,"#FF5722","#E64A19",!0),i.fillStyle="#ffffff",i.font="14px Arial",i.textAlign="right",i.fillText("Click to place/delete blocks",this.canvas.width-20,this.canvas.height-40),i.fillStyle="#FFD700",i.font="bold 16px Arial",i.fillText("Blocks: "+this.L,this.canvas.width-20,this.canvas.height-20),i.fillStyle="rgba(0, 0, 0, 0.9)",i.fillRect(this.A,0,this.G,this.canvas.height),i.strokeStyle="#4CAF50",i.lineWidth=2,i.beginPath(),i.moveTo(this.A,0),i.lineTo(this.A,this.canvas.height),i.stroke(),i.fillStyle="#4CAF50",i.font="bold 24px Arial",i.textAlign="center",i.fillText("Programming Puzzle",this.A+this.G/2,40),I(this,i)}}}function N(t,i){i.fillStyle=t.color,i.fillRect(t.g.x,t.g.y,t.width,t.height),i.strokeStyle=D(t.color),i.lineWidth=2,i.strokeRect(t.g.x,t.g.y,t.width,t.height);var e=t.g.x+t.width/2,l=t.g.y+t.height/2;if(64<t.width&&64<t.height){i.strokeStyle=D(t.color),i.lineWidth=1;for(var h=Math.floor(t.width/32),o=Math.floor(t.height/32),s=1;s<h;s++){var a=t.g.x+32*s;i.beginPath(),i.moveTo(a,t.g.y+4),i.lineTo(a,t.g.y+t.height-4),i.stroke()}for(h=1;h<o;h++)s=t.g.y+32*h,i.beginPath(),i.moveTo(t.g.x+4,s),i.lineTo(t.g.x+t.width-4,s),i.stroke()}if(96<t.width&&96<t.height&&(o=Math.min(.3*t.width,.3*t.height),i.fillStyle=D(t.color),i.fillRect(e-o/2,l-o/2,o,o)),"futuristic"===t.T){if(e=t.g.x+t.width/2,l=t.g.y+t.height/2,i.strokeStyle="#00CED1",i.lineWidth=4,i.strokeRect(t.g.x+2,t.g.y+2,t.width-4,t.height-4),128<t.width&&128<t.height)for(t=Math.min(.4*t.width,.4*t.height),i.fillStyle="rgba(0, 206, 209, 0.3)",i.fillRect(e-t/2,l-t/2,t,t),i.strokeStyle="#00FFFF",o=t/4,h=i.lineWidth=1;h<4;h++)s=e-t/2+h*o,a=l-t/2+h*o,i.beginPath(),i.moveTo(s,l-t/2),i.lineTo(s,l+t/2),i.stroke(),i.beginPath(),i.moveTo(e-t/2,a),i.lineTo(e+t/2,a),i.stroke()}else if("industrial"===t.T)128<t.width&&128<t.height&&(e=Math.min(.6*t.width,.6*t.height),l=t.g.x+t.width/2,o=t.g.y+t.height/2,i.fillStyle="#A0522D",i.fillRect(l-e/2,o-e/2,e,e),i.strokeStyle="#8B4513",i.lineWidth=6,i.beginPath(),i.moveTo(t.g.x,o),i.lineTo(t.g.x+t.width,o),i.stroke(),i.beginPath(),i.moveTo(l,t.g.y),i.lineTo(l,t.g.y+t.height),i.stroke()),i.strokeStyle="#CD853F",i.lineWidth=3,i.beginPath(),i.moveTo(t.g.x+8,t.g.y+8),i.lineTo(t.g.x+t.width-8,t.g.y+8),i.lineTo(t.g.x+t.width-8,t.g.y+t.height-8),i.stroke();else if(e=t.g.x+t.width/2,64<t.height&&(i.fillStyle=D(t.color),l=Math.min(.4*t.width,32),i.fillRect(e-l/2,t.g.y+t.height-8,l,8)),96<t.width&&96<t.height)for(i.fillStyle="#FFFF99",e=t.g.x+12;e<t.g.x+t.width-4;e+=12)for(l=t.g.y+12;l<t.g.y+t.height-4;l+=12)i.fillRect(e,l,4,4)}function D(t){return t.startsWith("#")?(t=t.substring(1),`rgb(${Math.max(0,parseInt(t.substring(0,2),16)-40)}, ${Math.max(0,parseInt(t.substring(2,4),16)-40)}, ${Math.max(0,parseInt(t.substring(4,6),16)-40)})`):"#000000"}class W{constructor(t,i,e=80,l=40,h="#D2691E"){this.g={x:t||0,y:i||0},this.width=e,this.height=l,this.color=h}H(t){if("building"===(i=this.type||"building"))N(this,t);else if("platform"===i)t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#00FFFF",t.lineWidth=3,t.strokeRect(this.g.x,this.g.y,this.width,this.height),t.fillStyle="rgba(0, 255, 255, 0.3)",t.fillRect(this.g.x+2,this.g.y+2,this.width-4,this.height-4);else if("special"===i)for(t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#FFD700",t.lineWidth=4,t.strokeRect(this.g.x,this.g.y,this.width,this.height),t.fillStyle="rgba(255, 215, 0, 0.5)",t.fillRect(this.g.x+3,this.g.y+3,this.width-6,this.height-6),t.fillStyle="#FFFFFF",i=0;i<3;i++)t.fillRect(this.g.x+this.width/4*(i+1)-2,this.g.y+this.height/2-2,4,4);else if("ground"===i){for(t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#444444",t.lineWidth=1,i=this.g.x;i<=this.g.x+this.width;i+=32)t.beginPath(),t.moveTo(i,this.g.y),t.lineTo(i,this.g.y+this.height),t.stroke();for(i=this.g.y;i<=this.g.y+this.height;i+=32)t.beginPath(),t.moveTo(this.g.x,i),t.lineTo(this.g.x+this.width,i),t.stroke();for(t.strokeStyle="#FFFF00",t.lineWidth=2,t.setLineDash([15,10]),i=this.g.y+16;i<this.g.y+this.height;i+=64)t.beginPath(),t.moveTo(this.g.x,i),t.lineTo(this.g.x+this.width,i),t.stroke();for(i=this.g.x+16;i<this.g.x+this.width;i+=64)t.beginPath(),t.moveTo(i,this.g.y),t.lineTo(i,this.g.y+this.height),t.stroke();t.setLineDash([])}else if("park"===i){t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#006400",t.lineWidth=2,t.strokeRect(this.g.x,this.g.y,this.width,this.height),t.fillStyle="#228B22";for(var i=Math.floor(this.width*this.height/2e3),e=0;e<i;e++){var l=this.g.x+Math.random()*(this.width-16)+8,h=this.g.y+Math.random()*(this.height-16)+8;t.beginPath(),t.arc(l,h,6,0,2*Math.PI),t.fill()}}else if("plaza"===i)t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#A0A0A0",i=this.g.x+this.width/(t.lineWidth=2),e=this.g.y+this.height/2,l=.4*Math.min(this.width,this.height),t.beginPath(),t.moveTo(i,e-l/2),t.lineTo(i+l/2,e),t.lineTo(i,e+l/2),t.lineTo(i-l/2,e),t.closePath(),t.stroke();else if("smokestack"===i)for(t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#654321",t.lineWidth=3,t.strokeRect(this.g.x,this.g.y,this.width,this.height),t.fillStyle="rgba(128, 128, 128, 0.5)",i=0;i<3;i++)e=this.g.x+this.width/2+20*(Math.random()-.5),l=this.g.y-10-8*i,h=4+2*i,t.beginPath(),t.arc(e,l,h,0,2*Math.PI),t.fill();else if("hologram"===i)for(t.fillStyle=this.color,t.fillRect(this.g.x,this.g.y,this.width,this.height),t.strokeStyle="#FF00FF",t.lineWidth=3,t.strokeRect(this.g.x,this.g.y,this.width,this.height),t.fillStyle="rgba(255, 0, 255, 0.3)",t.fillRect(this.g.x+2,this.g.y+2,this.width-4,this.height-4),t.strokeStyle="rgba(255, 0, 255, 0.6)",t.lineWidth=1,i=this.g.y;i<this.g.y+this.height;i+=4)t.beginPath(),t.moveTo(this.g.x,i),t.lineTo(this.g.x+this.width,i),t.stroke();else N(this,t)}}let G=[]</script>