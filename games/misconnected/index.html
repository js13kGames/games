<!doctype html><html style=height:100%;width:100%;padding:0;margin:0><title>Misconnected!</title><body style=height:100%;width:100%;padding:0;margin:0;display:flex;justify-content:center;align-items:center><div id=container><canvas id=textarea></canvas><canvas id=gamearea style="width:800px;height:800px;display:block;border:1px solid #0a483f"></canvas></div><script>var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,o){e!=Array.prototype&&e!=Object.prototype&&(e[t]=o.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.Symbol=function(){var e=0;return function(t){return $jscomp.SYMBOL_PREFIX+(t||"")+e++}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.makeIterator=function(e){$jscomp.initSymbolIterator(),$jscomp.initSymbol(),$jscomp.initSymbolIterator();var t=e[Symbol.iterator];return t?t.call(e):$jscomp.arrayIterator(e)};var canvas=document.getElementById("gamearea"),context=canvas.getContext("2d"),canvasHeight=canvas.height=1e3,canvasWidth=canvas.width=1e3;context.imageSmoothingEnabled=!1;var Viewport=function(e){this.size=e,this.y=this.x=0},Cell=function(e,t,o,r){this.x=e,this.y=t,this.size=o,this.type=r,this.prop=null};Cell.prototype.renderBackground=function(e){var t=$jscomp.makeIterator("floor"==this.type?[0,71]:[20,71]),o=t.next().value;t=t.next().value,context.drawImage(sprites,o,t,20,20,this.x*this.size-e.x,this.y*this.size-e.y,this.size,this.size)},Cell.prototype.render=function(e){this.prop&&(context.globalAlpha=this.prop.alpha,context.drawImage(sprites,this.prop.oX,this.prop.oY,20,20,this.x*this.size-e.x,this.y*this.size-e.y,this.size,this.size),context.globalAlpha=1)};var Grid=function(e,t){this.gridSize=e,this.cellSize=t,this.cells=[],this.collidableCells=[],this.objectRenderStack=[],this.viewport=new Viewport(1e3);for(var o=0;o<this.gridSize;o++){this.cells[o]=[];for(var r=0;r<this.gridSize;r++)this.cells[o][r]=new Cell(o,r,t,0==r?"wall":"floor")}};Grid.prototype.getCellAtPosition=function(e,t){return this.cells[e/this.cellSize|0][t/this.cellSize|0]},Grid.prototype.getCellsInRange=function(e,t,o,r){return[this.getCellAtPosition(e,t),this.getCellAtPosition(e,r),this.getCellAtPosition(o,t),this.getCellAtPosition(o,r)].filter((function(e,t,o){return 0>o.indexOf(e,t+1)}))},Grid.prototype.render=function(){var e=this;this.objectRenderStack=[],this.cells.forEach((function(t){t.forEach((function(t){t.renderBackground(e.viewport),t.prop&&(-1==t.prop.zIndex?t.render(e.viewport):(t.prop.zIndex=t.prop.isCompound&&!t.prop.isCompoundBase?t.y+t.prop.compoundCellPosition[1]:t.y,e.objectRenderStack.push(t)),void 0!==t.prop.color&&(context.fillStyle=t.prop.color,195==t.prop.oY?context.fillRect(t.x*t.size+45,t.y*t.size+65,10,10):235==t.prop.oY&&context.fillRect(t.x*t.size+45,t.y*t.size+63,10,10)))}))}));var t=store.player.cellInGrid();store.player.zIndex=t.y-1,this.objectRenderStack.push(store.player),this.objectRenderStack.sort((function(e,t){return void 0!==e.zIndex?e.zIndex-t.prop.zIndex:void 0!==t.zIndex?e.prop.zIndex-t.zIndex:e.prop.zIndex-t.prop.zIndex}));var o=[-1,0,1];this.objectRenderStack.forEach((function(r){if(r.prop){var i=r.prop.isCompound&&!r.prop.isCompoundBase?r.y+r.prop.compoundCellPosition[1]-t.y:r.y-t.y;o.includes(r.x-t.x)&&o.includes(i)&&r.prop.zIndex>store.player.zIndex?r.prop.alpha=.5:r.prop.alpha=r.prop.defaultAlpha}r.render(e.viewport)})),store.player.cable&&store.player.cable.render(),0!==store.cables.length&&store.cables.forEach((function(e){e.render()})),store.game.blackout&&(context.fillStyle="rgba(0, 0, 0, 0.95)",context.fillRect(0,0,canvasHeight,canvasWidth))};var Player=function(e,t){this.x=e,this.y=t,this.speed=5,this.zIndex=0,this.cable=void 0,this.activeAnimation=playerAnimations.standing,this.orientation=0,this.boundingBox=[0,55,70,80]};Player.prototype.cellInGrid=function(){return store.grid.getCellAtPosition(this.x+this.boundingBox[2],this.y+this.boundingBox[3])},Player.prototype.move=function(e){var t=this,o=[this.x,this.y,this.x,this.y].map((function(e,o){return e+t.boundingBox[o]}));if(0==e){if(void 0!==this.cable&&0==this.cable.disabledAxis)return void console.log("up");var r=store.grid.collidableCells.filter((function(e){var t=e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}));return o[0]<t[2]&&o[2]>t[0]&&o[1]>t[3]})),i=r.map((function(e){return e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}))}));if(0!=r.length)for(r=i.map((function(e){return e[3]})).reduce((function(e,t){return e>t?e:t})),i=0;i<this.boundingBox[1]+this.y-r-1&&i<this.speed;i++)50<this.y&&this.y--;else 50<this.y&&(this.y-=this.speed)}if(1==e){if(void 0!==this.cable&&0==this.cable.disabledAxis)return void console.log("down");if(r=store.grid.collidableCells.filter((function(e){var t=e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}));return o[0]<t[2]&&o[2]>t[0]&&o[3]<t[1]})),i=r.map((function(e){return e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}))})),0!=r.length)for(r=i.map((function(e){return e[1]})).reduce((function(e,t){return e<t?e:t})),i=0;i<r-o[3]-1&&i<this.speed;i++)this.y<store.grid.gridSize*store.grid.cellSize&&this.y++;else this.y<store.grid.gridSize*store.grid.cellSize-90&&(this.y+=this.speed)}if(2==e){if(void 0!==this.cable&&1==this.cable.disabledAxis)return void console.log("left");if(r=store.grid.collidableCells.filter((function(e){var t=e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}));return o[1]<t[3]&&o[3]>t[1]&&o[0]>t[2]})),i=r.map((function(e){return e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}))})),0!=r.length)for(r=i.map((function(e){return e[2]})).reduce((function(e,t){return e>t?e:t})),i=0;i<o[0]-r-1&&i<this.speed;i++)0<this.x&&this.x--;else this.x>this.speed&&(this.x-=this.speed)}if(3==e)if(void 0!==this.cable&&1==this.cable.disabledAxis)console.log("right");else if(e=store.grid.collidableCells.filter((function(e){var t=e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}));return o[1]<t[3]&&o[3]>t[1]&&o[2]<t[0]})),r=e.map((function(e){return e.prop.boundingBox.map((function(t,o){return 5*t+[e.x,e.y][o%2]*e.size}))})),0!=e.length)for(e=r.map((function(e){return e[0]})).reduce((function(e,t){return e<t?e:t})),r=0;r<e-o[2]-1&&r<this.speed;r++)this.x<store.grid.gridSize*store.grid.cellSize&&this.x++;else this.x<store.grid.gridSize*store.grid.cellSize-76&&(this.x+=this.speed)},Player.prototype.render=function(){context.drawImage(sprites,this.activeAnimation.sequence[this.activeAnimation.frame],91+16*this.orientation,14,16,this.x,this.y,70,80),this.activeAnimation.frame=(this.activeAnimation.tick/this.activeAnimation.duration|0)%this.activeAnimation.sequence.length,this.activeAnimation.tick++};var Cable=function(e,t){this.start=e,this.color=t,this.disabledAxis=0,this.isPickedUp=!1,this.points=[]};Cable.prototype.render=function(){context.beginPath(),context.moveTo(this.start[0],this.start[1]),this.points.forEach((function(e){context.lineTo(e[0],e[1])})),this.isPickedUp&&context.lineTo(store.player.x+10,store.player.y+50),context.strokeStyle=this.color,context.stroke()};var playerAnimations={standing:{frame:0,duration:1,sequence:[0],tick:0},walking:{frame:0,duration:4,sequence:[14,0,28,0],tick:0}},gameProps={serverMachineBottom1:{oX:0,oY:175,boundingBox:[0,10,20,20],isCompound:!0,isCompoundBase:!0,compoundCellPosition:[0,-1],zIndex:0,alpha:1,defaultAlpha:1,type:"static"},serverMachineTop1:{oX:0,oY:155,isCompound:!0,isCompoundBase:!1,compoundCellPosition:[0,1],zIndex:0,aplpha:1,defaultAlpha:1,type:"static"},cableHook:{oX:0,oY:276,isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,type:"hook",connected:!1},powerSwitch:{oX:20,oY:276,boundingBox:[0,10,20,20],isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,type:"switch"},wallPlugIn0:{oX:0,oY:195,boundingBox:[0,9,20,20],isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,color:"#ae3030",type:"plugIn",orientation:0},wallPlugOut0:{oX:20,oY:195,boundingBox:[0,12,20,20],isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,color:"#ae3030",type:"plugOut",orientation:0},wallSocketOut0:{oX:40,oY:195,boundingBox:[0,12,20,20],isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,color:"#ae3030",type:"socketOut",orientation:0},wallSocketIn0:{oX:60,oY:195,boundingBox:[0,12,20,20],isCompound:!1,zIndex:-1,alpha:1,defaultAlpha:1,color:"#ae3030",type:"socketIn",orientation:0}};gameProps.wallPlugIn1=Object.assign({},gameProps.wallPlugIn0,{oY:235,boundingBox:[0,0,20,8],orientation:1}),gameProps.wallPlugOut1=Object.assign({},gameProps.wallPlugOut0,{oY:235,boundingBox:[0,0,20,8],orientation:1}),gameProps.wallSocketOut1=Object.assign({},gameProps.wallSocketOut0,{oY:235,boundingBox:[0,0,20,8],orientation:1}),gameProps.wallSocketIn1=Object.assign({},gameProps.wallSocketIn0,{oY:235,boundingBox:[0,0,20,8],orientation:1}),gameProps.wallPlugIn2=Object.assign({},gameProps.wallPlugIn0,{oY:215,boundingBox:[0,0,8,20],orientation:1}),gameProps.wallPlugOut2=Object.assign({},gameProps.wallPlugOut0,{oY:215,boundingBox:[0,0,8,20],orientation:1}),gameProps.wallSocketOut2=Object.assign({},gameProps.wallSocketOut0,{oY:215,boundingBox:[0,0,8,20],orientation:1}),gameProps.wallSocketIn2=Object.assign({},gameProps.wallSocketIn0,{oY:215,boundingBox:[0,0,8,20],orientation:1}),gameProps.wallPlugIn3=Object.assign({},gameProps.wallPlugIn0,{oY:245,boundingBox:[8,0,20,20],orientation:1}),gameProps.wallPlugOut3=Object.assign({},gameProps.wallPlugOut0,{oY:245,boundingBox:[8,0,20,20],orientation:1}),gameProps.wallSocketOut3=Object.assign({},gameProps.wallSocketOut0,{oY:245,boundingBox:[8,0,20,20],orientation:1}),gameProps.wallSocketIn3=Object.assign({},gameProps.wallSocketIn0,{oY:245,boundingBox:[8,0,20,20],orientation:1});var playerStore={menu:{x:0,y:410,stopX:canvasWidth-200,speed:3,animations:{walking:{width:34,height:40,scale:5,ticksPerAnimationFrame:8,sequence:[2,3,4,3]},standing:{width:34,height:40,scale:5,ticksPerAnimationFrame:12,sequence:[0,1,2,1]}}}},cable={menu:{sprite:{width:15,height:4,scale:5,count:2}}},text={end:{x:150,y:500,boxWidth:50,duration:0,holdTime:0,elapsed:0,scale:7,value:"Thanks for playing!"},menu:[{x:260,y:50,boxWidth:50,duration:50,holdTime:0,elapsed:0,scale:7,value:"Misconnected"},{x:345,y:120,boxWidth:50,duration:0,delay:55,elapsed:0,scale:2,value:"Press spacebar to start"},{x:260,y:950,boxWidth:50,elapsed:0,delay:55,duration:0,scale:2,value:"A game by: Kamil Solecki and Matei Copot"},{x:420,y:120,boxWidth:50,elapsed:0,duration:0,scale:2,value:"Good Luck!"}],tutorial:[{x:30,y:30,boxWidth:30,elapsed:0,duration:500,scale:2,value:"Welcome to Misconnected!\n\nYou can use arrows to\nmove around.\nPress spacebar to interact with\nthings you encounter.\n\nSee those wireframey things?\n\nThose are ceiling hooks.\nYou can use them to turn your\ncable 90 degrees!\n\nUse them to get the plugs to\nthe sockets.\nBut remember!\nThey are color coded, so you\nneed to plan them accordingly!\n\n\nJust a tip: cables cannot cross\nand you can only use\nthe same hook once!\n\nWhen you are finished placing\ncables: pull the power switch.\n\n\nGood luck and have fun!\n\n\n\n\n\nMute music with M."}]},store={lastTime:Date.now(),keys:{},grid:new Grid(10,100),player:new Player(500,300),cables:[],audio:null,music:!0,game:{phase:"",tick:0,fpsInterval:getFps(60),blackout:!1,level:2},transition:{active:!1,tick:0,type:"fadeIn",fade:!1}},keyset={32:{press:function(){if("menu"==store.game.phase&&nextLevel((function(){store.grid=new Grid(10,100),store.grid.cells[5][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[5][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[6][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[6][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[7][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[7][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[8][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[8][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[5][6].prop=Object.assign({},gameProps.cableHook),store.grid.cells[9][6].prop=Object.assign({},gameProps.cableHook),store.grid.cells[5][9].prop=Object.assign({},gameProps.wallPlugIn0),store.grid.cells[9][0].prop=Object.assign({},gameProps.wallSocketOut1),store.grid.cells[7][9].prop=Object.assign({},gameProps.powerSwitch),store.grid.collidableCells.push(store.grid.cells[5][4]),store.grid.collidableCells.push(store.grid.cells[6][4]),store.grid.collidableCells.push(store.grid.cells[7][4]),store.grid.collidableCells.push(store.grid.cells[8][4]),store.grid.collidableCells.push(store.grid.cells[5][9]),store.grid.collidableCells.push(store.grid.cells[9][0]),store.grid.collidableCells.push(store.grid.cells[7][9]),store.game.phase="game",store.game.level=0})),"game"==store.game.phase){var e=store.grid.cells[(store.player.x+store.player.boundingBox[2]/2)/store.grid.cellSize|0][(store.player.y+store.player.boundingBox[3]/2)/store.grid.cellSize|0];if(void 0!==e&&e.prop){if("plugIn"==e.prop.type&&null==store.player.cable){e.prop=Object.assign({},gameProps.wallPlugOut0,{color:e.prop.color});var t=new Cable([e.x*e.size+50,e.y*e.size+80],e.prop.color);t.isPickedUp=!0,t.disabledAxis=e.prop.orientation=1,store.player.cable=t}if("hook"==e.prop.type&&void 0!==store.player.cable&&(e.prop.connected?(store.player.cable.points.splice(store.player.cable.points.indexOf([e.x*e.size+50,e.y*e.size+45]),1),store.player.cable.disabledAxis=0==store.player.cable.disabledAxis?1:0,e.prop.connected=!1):(store.player.cable.points.push([e.x*e.size+50,e.y*e.size+45]),store.player.cable.disabledAxis=0==store.player.cable.disabledAxis?1:0,e.prop.connected=!0)),"socketOut"==e.prop.type&&void 0!==store.player.cable&&e.prop.color==store.player.cable.color&&(e.prop=Object.assign({},Object.values(gameProps).find((function(t){return t.oY==e.prop.oY&&t.oX!==e.prop.oX})),{color:e.prop.color}),1==e.prop.orientation?store.player.cable.points.push([e.x*e.size+50,e.y*e.size+70]):store.player.cable.points.push([e.x*e.size+50,e.y*e.size+45]),store.player.cable.isPickedUp=!1,store.cables.push(store.player.cable),store.player.cable=void 0),"switch"==e.prop.type){var o=!0;store.grid.cells.forEach((function(e){e.forEach((function(e){e.prop&&"socketOut"==e.prop.type&&(o=!1)}))})),o?(store.game.blackout=!1,0==store.game.level&&nextLevel((function(){store.grid=new Grid(10,100),store.player=new Player(200,800);for(var e=2;8>e;e++)store.grid.cells[e][2].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[e][3].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[e][5].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[e][6].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.collidableCells.push(store.grid.cells[e][3]),store.grid.collidableCells.push(store.grid.cells[e][6]);store.grid.cells[0][4].prop=Object.assign({},gameProps.cableHook),store.grid.cells[9][4].prop=Object.assign({},gameProps.cableHook),store.grid.cells[9][8].prop=Object.assign({},gameProps.cableHook),store.grid.cells[5][8].prop=Object.assign({},gameProps.cableHook),store.grid.cells[0][9].prop=Object.assign({},gameProps.wallPlugIn0,{color:"#264cc4"}),store.grid.cells[5][9].prop=Object.assign({},gameProps.wallSocketOut0,{color:"#264cc4"}),store.grid.cells[7][9].prop=Object.assign({},gameProps.powerSwitch),store.grid.collidableCells.push(store.grid.cells[0][9]),store.grid.collidableCells.push(store.grid.cells[5][9]),store.grid.collidableCells.push(store.grid.cells[7][9]),store.game.level=1})),1==store.game.level&&nextLevel((function(){store.grid=new Grid(10,100),store.player=new Player(200,800);for(var e=0;10>e;e++)e%2&&(store.grid.cells[e][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[e][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.cells[e][6].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[e][7].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.collidableCells.push(store.grid.cells[e][4]),store.grid.collidableCells.push(store.grid.cells[e][7]));store.grid.cells[0][9].prop=Object.assign({},gameProps.wallPlugIn0),store.grid.cells[4][9].prop=Object.assign({},gameProps.wallPlugIn0,{color:"#264cc4"}),store.grid.cells[8][9].prop=Object.assign({},gameProps.wallPlugIn0,{color:"#0ea821"}),store.grid.cells[0][0].prop=Object.assign({},gameProps.wallSocketOut1),store.grid.cells[4][0].prop=Object.assign({},gameProps.wallSocketOut1,{color:"#264cc4"}),store.grid.cells[6][0].prop=Object.assign({},gameProps.powerSwitch),store.grid.cells[8][0].prop=Object.assign({},gameProps.wallSocketOut1,{color:"#0ea821"}),store.grid.collidableCells.push(store.grid.cells[0][9]),store.grid.collidableCells.push(store.grid.cells[4][9]),store.grid.collidableCells.push(store.grid.cells[8][9]),store.game.level=2}))):store.game.blackout=!0,2==store.game.level&&nextLevel((function(){store.grid=new Grid(10,100),store.player=new Player(200,800);for(var e=0;9>=e;e++)store.grid.cells[e][3].prop=Object.assign({},gameProps.serverMachineTop1),store.grid.cells[e][4].prop=Object.assign({},gameProps.serverMachineBottom1),store.grid.collidableCells.push(store.grid.cells[e][4]);store.grid.cells[1][9].prop=Object.assign({},gameProps.wallPlugIn0,{color:"#264cc4"}),store.grid.cells[3][9].prop=Object.assign({},gameProps.wallPlugIn0,{color:"#0ea821"}),store.grid.collidableCells.push(store.grid.cells[1][9]),store.grid.collidableCells.push(store.grid.cells[3][9]),store.grid.cells[6][9].prop=Object.assign({},gameProps.wallSocketOut0,{color:"#0ea821"}),store.grid.cells[8][9].prop=Object.assign({},gameProps.wallSocketOut0,{color:"#264cc4"}),store.grid.collidableCells.push(store.grid.cells[6][9]),store.grid.collidableCells.push(store.grid.cells[8][9]),store.grid.cells[3][7].prop=Object.assign({},gameProps.cableHook),store.grid.cells[6][7].prop=Object.assign({},gameProps.cableHook),store.grid.cells[1][5].prop=Object.assign({},gameProps.cableHook),store.grid.cells[8][5].prop=Object.assign({},gameProps.cableHook),store.grid.cells[5][9].prop=Object.assign({},gameProps.powerSwitch),store.game.level=3})),3==store.game.level&&nextLevel((function(){store.game.phase="end"}))}}}},hold:function(){},release:function(){"start"==store.game.phase&&(store.transition.active=!0,playerStore.menu.stopX=canvasWidth+200)}},37:{press:function(){},hold:function(){store.player.activeAnimation=playerAnimations.walking,store.player.move(2),store.keys[38]||store.keys[40]||(store.player.orientation=2)},release:function(){store.player.activeAnimation=playerAnimations.standing}},38:{press:function(){store.player.orientation=0},hold:function(){store.player.activeAnimation=playerAnimations.walking,store.player.move(0)},release:function(){store.player.activeAnimation=playerAnimations.standing}},39:{press:function(){},hold:function(){store.player.activeAnimation=playerAnimations.walking,store.player.move(3),store.keys[38]||store.keys[40]||(store.player.orientation=3)},release:function(){store.player.activeAnimation=playerAnimations.standing}},40:{press:function(){store.player.orientation=1},hold:function(){store.player.activeAnimation=playerAnimations.walking,store.player.move(1)},release:function(){store.player.activeAnimation=playerAnimations.standing}},77:{press:function(){store.music?store.audio.pause():store.audio.play()},hold:function(){},release:function(){}}};window.onkeydown=function(e){return!((e=(e||window.event).keyCode)in keyset)||(e in store.keys||(store.keys[e]=!0,keyset[e].press(),keyset[e].hold()),!1)},window.onkeyup=function(e){(e=(e||window.event).keyCode)in store.keys&&(store.keys[e]&&keyset[e].release(),delete store.keys[e])},window.onblur=function(){return store.keys={}},document.onmouseup=function(e){return 3===e.which&&(store.keys={})},store.game.phase="menu",context.fillStyle="#b8b8b8",context.fillRect(0,0,canvasWidth,canvasHeight);var sprites=new Image;function selectAnimationFrame(e){return e.ticksPerAnimationFrame?e.sequence[store.game.tick/e.ticksPerAnimationFrame%e.sequence.length|0]:e.sequence[store.game.tick%e.sequence.length]}function animate(){requestAnimationFrame(animate);var e=Date.now(),t=Date.now()-store.lastTime;if(t>store.game.fpsInterval){for(var o in store.lastTime=e-t%store.game.fpsInterval,store.keys)keyset[o].hold();if("menu"==store.game.phase){for(context.fillStyle="#b8b8b8",context.fillRect(0,0,canvasWidth,canvasHeight),playerStore.menu.x<playerStore.menu.stopX&&(playerStore.menu.x+=playerStore.menu.speed),context.fillStyle="#757575",context.fillRect(0,580,canvasWidth,canvasHeight-580),e=playerStore.menu.x<playerStore.menu.stopX?playerStore.menu.animations.walking:playerStore.menu.animations.standing,context.drawImage(sprites,selectAnimationFrame(e)*e.width,0,e.width,e.height,playerStore.menu.x,playerStore.menu.y,e.width*e.scale,e.height*e.scale),e=0;e<playerStore.menu.x-cable.menu.sprite.width;e+=cable.menu.sprite.width)context.drawImage(sprites,e%cable.menu.sprite.count*15,40,cable.menu.sprite.width,cable.menu.sprite.height,playerStore.menu.x-40-cable.menu.sprite.width*cable.menu.sprite.scale*e/(cable.menu.sprite.width+2),playerStore.menu.y+104,cable.menu.sprite.width*cable.menu.sprite.scale,cable.menu.sprite.height*cable.menu.sprite.scale);writeText(text.menu[0],!0),writeText(text.menu[2],!0),store.game.tick++}"end"==store.game.phase&&(context.fillStyle="#2b75a0",context.fillRect(0,0,canvasWidth,canvasHeight),writeText(text.end,!0)),"game"==store.game.phase&&(store.grid.render(),0==store.game.level&&(context.strokeStyle="#0f4666",context.lineWidth=8,context.fillStyle="#2b75a0",context.fillRect(20,20,400,canvasHeight-40),context.strokeRect(20,20,400,canvasHeight-40),writeText(text.tutorial[0],!0))),store.transition.active&&"fadeIn"==store.transition.type&&(e=.02*store.transition.tick,context.fillStyle="rgba(200, 200, 200, "+e+")",context.fillRect(0,0,canvasWidth,canvasHeight),store.transition.tick++,1==e&&(store.transition.tick=0,store.transition.fade=!0,store.transition.type="fadeOut")),store.transition.active&&"fadeOut"==store.transition.type&&(e=1-.02*store.transition.tick,context.fillStyle="rgba(200, 200, 200, "+e+")",context.fillRect(0,0,canvasWidth,canvasHeight),store.transition.tick++,0==e&&(store.transition.tick=0,store.transition.fade=!1,store.transition.active=!1,store.transition.type="fadeIn"))}}function nextLevel(e){store.transition.active=!0,setTimeout((function(){store.cables=[],e()}),850)}function getFps(e){return 1e3/e}sprites.src="sprites.png";var textCanvas=document.createElement("canvas"),textContext=textCanvas.getContext("2d"),textColorCanvas=document.createElement("canvas"),textColorContext=textColorCanvas.getContext("2d");function writeText(e,t,o){o=void 0===o?"black":o;var r=0<e.duration?Math.min(e.value.length,e.elapsed/(e.duration/e.value.length)|0):e.value.length,i=0,s=0;if((0==e.delay||!e.delay)&&(e.elapsed<e.duration+e.holdTime||t)){for(t=0;t<r;t++)10==e.value.charCodeAt(t)&&(i++,s=t+1),writeLetter(e.value[t],e.x+(t-s)*e.scale*6,e.y+9*e.scale*i,e.scale,o);e.elapsed++}0<e.delay&&e.delay--}function writeLetter(e,t,o,r,i){textCanvas.width=textColorCanvas.width=6*r,textCanvas.height=textColorCanvas.height=9*r,e=e.charCodeAt(0),e=(i=$jscomp.makeIterator(33==e?[50,62]:35==e?[55,62]:63==e?[60,62]:46==e?[65,62]:58==e?[70,62]:47<e&&58>e?[5*(e-48),62]:64<e&&91>e?[5*(e-65)+1,53]:96<e&&123>e?[5*(e-97)+1,44]:[0,0])).next().value,i=i.next().value,context.drawImage(sprites,e,i,5,9,t,o,5*r,9*r)}var CPlayer=function(){var e,t,o,r,i,s=function(e){return Math.sin(6.283184*e)},n=[s,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){return 2>(e=e%1*4)?e-1:3-e}];this.init=function(s){e=s,t=s.endPattern,o=0,r=s.rowLen*s.patternLen*(t+1)*2,i=new Int32Array(r)},this.generate=function(){var a,l,c,p,d,g,u=new Int32Array(r),m=e.songData[o],h=e.rowLen,b=e.patternLen,y=0,f=0,v=!1,x=[];for(l=0;l<=t;++l){var w=m.p[l];for(c=0;c<b;++c){(d=w?m.c[w-1].f[c]:0)&&(m.i[d-1]=m.c[w-1].f[c+b]||0,16>d&&(x=[]));var P=n[m.i[15]],k=m.i[16]/512,j=Math.pow(2,m.i[17]-9)/h,S=m.i[18],O=m.i[19],C=135.82764118168*m.i[20]/44100,I=1-m.i[21]/255,A=1e-5*m.i[22],z=m.i[23]/32,B=m.i[24]/512,$=6.283184*Math.pow(2,m.i[25]-9)/h,M=m.i[26]/255,T=m.i[27]*h&-2;for(d=(l*b+c)*h,p=0;4>p;++p)if(a=w?m.c[w-1].n[c+p*b]:0){if(!x[a]){var Y,E,R=x,H=a,W=g=void 0,L=m,X=a,G=n[L.i[0]],U=L.i[1],_=L.i[3],q=n[L.i[4]],F=L.i[5],D=L.i[8],N=L.i[9],V=L.i[10]*L.i[10]*4,J=L.i[11]*L.i[11]*4,K=L.i[12]*L.i[12]*4,Q=1/K,Z=L.i[13],ee=h*Math.pow(2,2-L.i[14]),te=new Int32Array(V+J+K),oe=0,re=0;for(Y=E=0;E<V+J+K;E++,Y++){0<=Y&&(Z=Z>>8|(255&Z)<<4,Y-=ee,W=.003959503758*Math.pow(2,(X+(15&Z)+L.i[2]-128-128)/12),g=.003959503758*Math.pow(2,(X+(15&Z)+L.i[6]-128-128)/12)*(1+8e-4*L.i[7]));var ie=1;E<V?ie=E/V:E>=V+J&&(ie-=(E-V-J)*Q);var se=W;_&&(se*=ie*ie);var ne=G(oe+=se)*U;se=g,D&&(se*=ie*ie),ne+=q(re+=se)*F,N&&(ne+=(2*Math.random()-1)*N),te[E]=80*ne*ie|0}R[H]=te}for(H=x[a],a=0,R=2*d;a<H.length;a++,R+=2)u[R]+=H[a]}for(a=0;a<h;a++)(R=u[p=2*(d+a)])||v?(v=C,S&&(v*=P(j*p)*k+.5),f+=(v=1.5*Math.sin(v))*(R=I*(R-f)-(y+=v*f)),R=3==O?f:1==O?R:y,A&&(R=1>(R*=A)?-1<R?s(.25*R):-1:1,R/=A),v=1e-5<(R*=z)*R,g=R*(1-(H=Math.sin($*p)*B+.5)),R*=H):g=0,p>=T&&(g+=u[p-T+1]*M,R+=u[p-T]*M),u[p]=0|g,u[p+1]=0|R,i[p]+=0|g,i[p+1]+=0|R}}return++o/e.numChannels},this.createWave=function(){var e=44+2*r-8,t=e-36,o=new Uint8Array(44+2*r);for(o.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]),e=0,t=44;e<r;++e){var s=i[e];s=-32767>s?-32767:32767<s?32767:s,o[t++]=255&s,o[t++]=s>>8&255}return o},this.getData=function(e,t){for(var o=2*Math.floor(44100*e),r=Array(t),s=0;s<2*t;s+=1){var n=o+s;r[s]=0<e&&n<i.length?i[n]/32768:0}return r}},song={songData:[{i:[3,194,128,0,2,198,128,6,0,0,12,100,33,0,0,0,93,4,1,2,109,86,0,32,112,3,61,2],p:[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,2,2,2,2],c:[{n:[],f:[]},{n:[,125,,,,149,,,147,,,,149,,,,142,,,,144,,142,,144,,147],f:[,12,,,12,,,12,,,,12,,,,,,,,,12,,,,,,,,,,,,,48,,,39,,,41,,,,39,,,,,,,,,33]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,125,,125,,149,149,,147,147,,,149,149,,,142,,142,,144,144,142,142,144,144,147,147],f:[]}]},{i:[0,255,138,1,0,255,92,0,1,14,4,6,45,0,0,0,0,0,0,2,9,81,0,45,88,0,31,1],p:[,,,,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[,125,,,,,,,,135,,,,,,,,125,,,,,,,,135],f:[]}]},{i:[3,100,128,0,3,201,128,2,0,0,0,6,49,0,0,0,139,4,1,3,30,184,119,27,147,6,0,6],p:[,,,,,,,,4,4,4,4,4,4,4,4,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,76,6,58,0,0,0,195,6,1,3,1,141,34,95,43,2,121,6],p:[,,,,,,,,5,5,5,5,5,5,5,5,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152,,152],f:[]}]}],rowLen:4410,patternLen:32,endPattern:20,numChannels:4};sprites.onload=function(){var e=new CPlayer;e.init(song),e.generate(),setTimeout((function(){var t=e.createWave();store.audio=document.createElement("audio"),store.audio.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),store.audio.play(),animate()}),1e3)}</script>