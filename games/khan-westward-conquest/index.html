<!doctype html><meta content="width=device-width,maximum-scale=1,user-scalable=0" name=viewport><title>Khan - Westward Conquest - js13kGames 2023</title><style>#context{position:absolute;inset:0;background-color:#000000bf;opacity:0;transition:1s;z-index:1000}#context.show{opacity:1}#context.hide,#message.hide{display:block;z-index:-1;opacity:0}#message{color:#000;position:absolute;inset:20% 10%;padding:50px;background-color:#c0ae92;font-size:2.75rem;display:flex;flex-direction:column;justify-content:space-between}#context-close{font-size:3rem}@keyframes changed{0%,30%,to{transform:scale(1)}70%{transform:scale(1.5)}}@keyframes bumpUp{0%,to{top:0}10%{top:10px}20%{top:-20px}}@keyframes bumpLeft{0%,to{left:0}10%{left:-50px}}@keyframes bumpRight{0%,to{left:0}10%{left:50px}}@keyframes dead{0%{opacity:100%}50%{opacity:0%;width:13px}to{width:0;opacity:0%}}#enemy{position:absolute;top:36%;left:0;width:60%;display:flex;justify-content:space-evenly}#player{position:absolute;top:36%;left:50%;width:50%;display:flex;justify-content:space-evenly}.sprite-wrapper{display:flex;transform:scale(8);width:13px;height:13px;justify-content:center;position:relative;animation-duration:1s;animation-iteration-count:1}.sprite-wrapper.enemy{transform:scale(-8,8)}.sprite-wrapper.mounted{width:26px}.sprite{width:13px;height:13px;position:absolute;z-index:5;display:flex;justify-content:center;align-items:flex-end}.mounted .horse{width:26px;height:13px;z-index:4}.mounted .sprite:not(.horse){top:-7px;left:7px}.khan{background:url(s.png) -52px 0}.horse{background:url(s.png) -65px 0}.king{background:url(s.png)}.archer{background:url(s.png) -13px 0}.knight{background:url(s.png) -26px 0}.dervish{background:url(s.png) -39px 0}.snake{background:url(s.png) 0 -13px}.rok{background:url(s.png) -13px -13px}.wolf{background:url(s.png) -26px -13px}.bear1{background:url(s.png) -39px -13px}.bear2{background:url(s.png) -52px -13px}.intent{width:8px;height:13px;transform:scale(-.33,.33);position:relative;top:-10px;left:1px}.assault{background:url(s.png) -65px -13px}.ability:hover:before,.assault:hover:before,.defense:hover:before{font-size:.5rem;position:absolute;display:block;top:-10px;width:150px}.assault:hover:before{content:"Planning to attack you!"}.assault-value{display:block;position:relative;left:8px;top:-3px}.intent:not(.assault) .assault-value{display:none}.defense:hover:before{content:"Planning to defend itself!"}.defense{background:url(s.png) -73px -13px}.ability:hover:before{content:"Planning something unpleasant!"}.ability{background:url(s.png) -81px -13px}.affects,.hp{position:absolute;border:1px solid #000;min-width:90px;width:90px;height:5px;text-align:center;display:flex;justify-content:center;align-items:center;bottom:-6px;transform:scale(.25);z-index:2;text-shadow:0 0 5px #000;transition:.25s}.affects{bottom:-10px;border:none;font-size:.75rem}.affects div.changed{animation-name:changed;animation-duration:1s}.affects div{text-shadow:0 0 0 0 #fff;transition:.5s;margin:0 5px}.affects div:hover:before{position:absolute;top:10px;width:160px;text-align:left}.affects div.armor:hover:before{position:absolute;top:0;left:-40px;width:250%}.stats .number{position:relative;z-index:2}.stats .fill{position:absolute;left:0;top:0;bottom:0;width:100%;background:red;z-index:1;transition:width .5s}.stats .fill.armored{background:#87cefa}.armor{position:absolute;left:-15px;top:-35px}.armor:hover:before{content:"Defend: block X attack damage";top:20px;width:200%}.weak:hover:before{content:"Weaken: Do 25% less damage and gain 50% less defence for X turns"}.enrage:hover:before{content:"Enrage: do 50% more damage for X turns"}.enemy .stats{transform:scale(-.25,.25)}.targeting.targeted{box-shadow:0 0 12px 10px #c0ae92;width:0;height:0;margin-top:6px}@keyframes pulse{0%,to{opacity:100%}50%{opacity:75%}}*{touch-action:manipulation;user-select:none;touch-action:none}body,html{margin:0;background-color:#000;color:#fff;display:flex;justify-content:center;align-items:center;height:100%;font-size:14px;font-family:luminari,Georgia;image-rendering:pixelated}.hide{display:none}button{font-family:luminari,Georgia;border:none;background:0 0;color:#000;display:inline;font-size:8rem;align-self:flex-start;margin:0 auto;padding:0 50px;opacity:1}button:disabled{opacity:.75}button:hover:not(:disabled){text-shadow:0 0 10px #fff}button:active:not(:disabled){text-shadow:0 0 10px #999}#endturn{position:absolute;font-size:2rem;right:25px;top:60px}#viewdeck{position:absolute;font-size:1.25rem;right:25px;top:200px}#menu{position:absolute;bottom:0;left:0;right:0;height:60%;display:flex;flex-direction:column;justify-content:space-around;align-items:center}#difficulty-wrapper{padding:0 10px;font-size:2rem;color:#000}#difficulty{background-color:#c0ae92;font-family:inherit;color:#000;text-align:center;min-width:300px;font-size:2rem}#title{z-index:2;text-align:center;width:100%}#board{width:1600px;height:900px;outline:0;position:relative;display:flex;touch-action:manipulation;user-select:none;background:url(b.png) 0 0/66%;overflow:hidden}#menubuttons{position:absolute;left:10px;top:20px;z-index:20000}#menubuttons button{font-size:1.5rem;padding:0 5px;margin:0 5px}#menubuttons button.stopped{text-shadow:0 0 4px red}button#gotit{position:absolute;left:50%;top:75%;transform:translate(-50%,-50%);font-size:3rem;z-index:20000}#overlay{inset:0;position:absolute;z-index:10000;box-shadow:inset 0 0 100px 50px #000;pointer-events:none}#game{position:relative;width:100%}#game h2{width:100%;text-align:center}#stage{font-size:2.5rem}#round{font-size:1.5rem}#alert{margin-top:20px;font-size:3rem;animation-name:pulse;animation-duration:1s;animation-iteration-count:infinite}#playing{display:none}#ground{position:absolute;bottom:0;left:0;right:0;height:60%;background:url(g.png) 0 0/50%}h1{font-size:10rem;margin:0 0 .67em}@keyframes flash{0%,to{background-color:#fff}50%{background-color:red}}.flash{animation-name:flash;animation-duration:.25s}#confirmcard{position:absolute;font-size:2rem;top:45%;left:50%;transform:translate(-50%);z-index:10;opacity:1}#confirmcard.hide{display:none}#confirmcard:disabled{opacity:.75}#deckdisplay{position:absolute;inset:0;background-color:#000000bf;padding:50px 100px;display:flex;flex-direction:row;flex-wrap:wrap;z-index:20001;overflow:hidden}#deckdisplay.hide{display:none}#deck-done{position:absolute;left:0;right:0;bottom:30%;height:10%;display:flex;text-align:center;justify-content:space-between;align-items:center;flex-shrink:0;padding:0 50px;font-size:2rem}#card-holder{position:absolute;left:0;right:0;bottom:0;height:30%;display:flex;justify-content:center;align-items:flex-end;flex-shrink:0}.card{width:190px;min-width:190px;height:285px;max-height:285px;margin:0 -15px;display:flex;font-family:monospace;justify-content:flex-start;align-items:center;flex-direction:column;color:#000;transform:scale(.75);transition:.25s;z-index:10;position:relative;touch-action:none;padding:0 10px;bottom:0}.card.innate:not(:last-child){margin-left:190px}#deckdisplay .card.innate{margin:0 -15px}.card:hover{bottom:60px;transform:scale(1.25);z-index:20}.card.selected{bottom:85px;transform:scale(1.3);z-index:15}.card div{margin:0 0 5px}.detail{flex-grow:1}.flavor{font-style:italic;font-size:.9rem}.body,.title{width:calc(100% - 20px);padding:10px;border:1px solid #000;background-color:#d8cab3}.title{text-transform:uppercase;display:flex;justify-content:center;align-items:center;text-align:center;font-size:1.66rem;margin-bottom:10px;font-weight:700;height:45px}.body{display:flex;flex-direction:column;font-size:1.25rem;flex-grow:1}.bottom,.top{width:80%;height:35%;border:1px solid #fff;text-align:center;padding:1%}.cost{font-size:2.5rem;font-weight:700;position:absolute;left:-20px;top:-30px;width:40px;height:40px;display:flex;justify-content:center;align-items:center;border-radius:25px;background-color:#d8cab3;box-shadow:inset 0 0 0 2px #000,inset 0 0 0 4px #fff}:root{--pixel-bg:#c0ae92;--pixel-border:black;--pixel-border-2:white;--pixel-border-3:var(--pixel-border);--pixel:.125rem}.pixel-border{background:var(--pixel-bg);box-shadow:0 calc(var(--pixel) * -3) 0 calc(var(--pixel) * -1) var(--pixel-bg),0 calc(var(--pixel) * 3) 0 calc(var(--pixel) * -1) var(--pixel-bg),0 calc(var(--pixel) * -6) 0 calc(var(--pixel) * -2) var(--pixel-bg),0 calc(var(--pixel) * 6) 0 calc(var(--pixel) * -2) var(--pixel-bg),0 calc(var(--pixel) * -9) 0 calc(var(--pixel) * -4) var(--pixel-bg),0 calc(var(--pixel) * 9) 0 calc(var(--pixel) * -4) var(--pixel-bg),0 calc(var(--pixel) * -12) 0 calc(var(--pixel) * -6) var(--pixel-bg),0 calc(var(--pixel) * 12) 0 calc(var(--pixel) * -6) var(--pixel-bg),calc(var(--pixel) * -1) 0 0 0 var(--pixel-border),var(--pixel) 0 0 0 var(--pixel-border),0 calc(var(--pixel) * -2) 0 0 var(--pixel-border),0 calc(var(--pixel) * 2) 0 0 var(--pixel-border),0 calc(var(--pixel) * -5) 0 calc(var(--pixel) * -1) var(--pixel-border),0 calc(var(--pixel) * 5) 0 calc(var(--pixel) * -1) var(--pixel-border),0 calc(var(--pixel) * -7) 0 calc(var(--pixel) * -2) var(--pixel-border),0 calc(var(--pixel) * 7) 0 calc(var(--pixel) * -2) var(--pixel-border),0 calc(var(--pixel) * -10) 0 calc(var(--pixel) * -4) var(--pixel-border),0 calc(var(--pixel) * 10) 0 calc(var(--pixel) * -4) var(--pixel-border),0 calc(var(--pixel) * -13) 0 calc(var(--pixel) * -6) var(--pixel-border),0 calc(var(--pixel) * 13) 0 calc(var(--pixel) * -6) var(--pixel-border),calc(var(--pixel) * -2) 0 0 0 var(--pixel-border-2),calc(var(--pixel) * 2) 0 0 0 var(--pixel-border-2),0 calc(var(--pixel) * -1) 0 var(--pixel) var(--pixel-border-2),0 var(--pixel) 0 var(--pixel) var(--pixel-border-2),0 calc(var(--pixel) * -4) 0 0 var(--pixel-border-2),0 calc(var(--pixel) * 4) 0 0 var(--pixel-border-2),0 calc(var(--pixel) * -6) 0 calc(var(--pixel) * -1) var(--pixel-border-2),0 calc(var(--pixel) * 6) 0 calc(var(--pixel) * -1) var(--pixel-border-2),0 calc(var(--pixel) * -8) 0 calc(var(--pixel) * -2) var(--pixel-border-2),0 calc(var(--pixel) * 8) 0 calc(var(--pixel) * -2) var(--pixel-border-2),0 calc(var(--pixel) * -11) 0 calc(var(--pixel) * -4) var(--pixel-border-2),0 calc(var(--pixel) * 11) 0 calc(var(--pixel) * -4) var(--pixel-border-2),0 calc(var(--pixel) * -14) 0 calc(var(--pixel) * -6) var(--pixel-border-2),0 calc(var(--pixel) * 14) 0 calc(var(--pixel) * -6) var(--pixel-border-2),calc(var(--pixel) * -3) 0 0 0 var(--pixel-border-3),calc(var(--pixel) * 3) 0 0 0 var(--pixel-border-3),0 0 0 calc(var(--pixel) * 2) var(--pixel-border-3),0 calc(var(--pixel) * -3) 0 var(--pixel) var(--pixel-border-3),0 calc(var(--pixel) * 3) 0 var(--pixel) var(--pixel-border-3),0 calc(var(--pixel) * -5) 0 0 var(--pixel-border-3),0 calc(var(--pixel) * 5) 0 0 var(--pixel-border-3),0 calc(var(--pixel) * -7) 0 calc(var(--pixel) * -1) var(--pixel-border-3),0 calc(var(--pixel) * 7) 0 calc(var(--pixel) * -1) var(--pixel-border-3),0 calc(var(--pixel) * -9) 0 calc(var(--pixel) * -2) var(--pixel-border-3),0 calc(var(--pixel) * 9) 0 calc(var(--pixel) * -2) var(--pixel-border-3),0 calc(var(--pixel) * -12) 0 calc(var(--pixel) * -4) var(--pixel-border-3),0 calc(var(--pixel) * 12) 0 calc(var(--pixel) * -4) var(--pixel-border-3),0 calc(var(--pixel) * -15) 0 calc(var(--pixel) * -6) var(--pixel-border-3),0 calc(var(--pixel) * 15) 0 calc(var(--pixel) * -6) var(--pixel-border-3)}.tutorial{opacity:1!important}.tutorial #deck:before,.tutorial #done:before,.tutorial #tutorialtext{font-size:2rem;position:absolute;z-index:15000}#tutorialtext{display:none;position:absolute;inset:0}.tutorial #tutorialtext{display:block}#overviewtext{position:absolute;left:50%;transform:translate(-50%);width:60%;top:5%}</style><div id=board><div id=menubuttons><button class="pixel-border stopped" id=music>Music</button><button class=pixel-border id=sfx>SFX</button><button class="pixel-border hide" id=tutorial>Help/Info</button></div><div id=deckdisplay class=hide></div><button class="pixel-border hide" id=confirmcard disabled=disabled>Confirm Card</button><div id=tutorialtext><button class="pixel-border hide" id=gotit>Ok, got it!</button><div id=overviewtext>Goal: Click/tap your cards to defeat enemies or buff yourself, the Khan! Plan based on enemy intentions: they may attack, defend, or use an ability. Each new stage, choose a new card to add to your deck, or a new ability. Can you make it all the way and defeat the King of the West?<br><br>Abilities:<br>DEFEND/D - block X attack damage, lasts 1 turn.<br>ENRAGE/E - boost attack damage 25% for X turns.<br>WEAKEN/W - reduce attack damage 25% and defense gain 50% for X turns.<br><br>Hover/tap D, E, W, and enemy intention icons for a reminder!</div></div><div id=overlay></div><div id=context class=hide><div id=message class="pixel-border hide"><div id=content></div><button class=pixel-border id=context-close>Continue ...</button></div></div><div id=ground></div><div id=title><h1>KHAN</h1><section id=menu><button class=pixel-border id=new>new game</button><div id=difficulty-wrapper class=pixel-border>Difficulty<br><br><select id=difficulty><option value=1>Normal<option value=2>Challenging - Enemy Damage & Defense Gain +50%<option value=3>Really Hard - Enemy Life, Damage & Defense Gain +50%<option value=4>Maybe Impossible - Enemy Life, Attack, Defense Gain +100%<option value=5>Probably Impossible - Enemy Life, Attack, Defense Gain +150%</select></div></section></div><div id=game class=hide><h2><div id=stage>Stage: 1 / 8</div><div id=round>Round: 1</div><div id=alert></div></h2><div id=enemy></div><div id=player><button class=pixel-border id=endturn>End Turn</button><button class=pixel-border id=viewdeck>View Deck</button></div><div id=deck-done><div id=deck>Draw: 0</div><div id=stamina>Stamina: 0</div><div id=done>Discard: 0</div></div><div id=card-holder></div></div></div><script>function r(t,e){return t=Math.ceil(t),e=Math.floor(e)+1,Math.floor(Math.random()*(e-t)+t)}function o(t){let e=1;for(t.t.style.transform=`scale(${e})`;t.t?.getBoundingClientRect().width>window.innerWidth||t.t.getBoundingClientRect().height>window.innerHeight;)e-=.05,t.t.style.transform=`scale(${e})`}function h(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function i(t,e){return e?Math.ceil(t*(e.e?1.5:1)*(e.w?.75:1)):t}function s(t,e){return e?Math.ceil(t*(e.w?.5:1)):t}function a(t){var e=v("card pixel-border");e.id=t.id;const s=v("detail");t.attributes.forEach(t=>{s.appendChild(v("x",t))});var i=v("body");return i.appendChild(s),t.data.i&&i.appendChild(v("flavor",t.data.i)),t.type!==L.innate?e.appendChild(v("cost",""+t.data.c)):e.classList.add("innate"),e.appendChild(v("title",t.name)),e.appendChild(i),e}function l(...t){{t=[((t=1,e=.05,s=220,i=0,a=0,n=.1,h=0,r=1,d=0,o=0,l=0,c=0,u=0,p=0,m=0,f=0,v=0,y=1,g=0,w=0)=>{let b,k,L=2*Math.PI,T=44100,E=d*=500*L/T/T,M=[],C=s*=(1+2*e*Math.random()-e)*L/T,N=0,A=0,x=0,R=1,H=0,S=0,D=0;for(o*=500*L/T**3,m*=L/T,l*=L/T,c*=T,u=u*T|0,k=(i=i*T+9)+(g*=T)+(a*=T)+(n*=T)+(v*=T)|0;k>x;M[x++]=D)++S%(100*f|0)||(D=h?1<h?2<h?3<h?Math.sin((N%L)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/L%2+2)%2:1-4*Math.abs(Math.round(N/L)-N/L):Math.sin(N),D=(u?1-w+w*Math.sin(L*x/u):1)*(0<D?1:-1)*Math.abs(D)**r*t*.3*(i>x?x/i:i+g>x?1-(x-i)/g*(1-y):i+g+a>x?y:k-v>x?(k-x-v)/n*y:0),D=v?D/2+(v>x?0:(k-v>x?1:(k-x)/v)*M[x-v|0]/2):D),b=(s+=d+=o)*Math.cos(m*A++),N+=b-b*p*(1-1e9*(Math.sin(x)+1)%2),R&&++R>c&&(s+=l,C+=l,R=0),!u||++H%u||(s=C,d=E,R=R||1);return M})(...t)];const s=M.createBuffer(t.length,t[0].length,44100),e=M.createBufferSource();return t.map((t,e)=>s.getChannelData(e).set(t)),e.buffer=s,e.connect(M.destination),e.start(),e}}function n(t){t.classList.remove("changed"),t.classList.add("changed"),setTimeout(()=>{t.classList.remove("changed")},1500)}function d(i,a,n,t){let h=[];for(i.forEach((t,e)=>{let s=t;for(;a.includes(s)||h.includes(s);)s=r(0,n.length-1);h.push(s),i[e]=s}),h.forEach(t=>{a.push(t)});a.length>t;)a.shift()}function c(t,e,s=!1){b("tutorial").disabled=!0,b("context").classList.remove("hide"),b("message").classList.remove("hide"),b("context").classList.add("show"),b("content").innerHTML=t,(t=document.createElement("button")).classList.add("pixel-border"),t.innerHTML="Continue ...",t.id="context-close";const i=()=>{b("context-close").removeEventListener("click",i),s||(b("tutorial").disabled=!1,b("context").classList.remove("show"),b("context").classList.add("hide"),b("message").classList.add("hide")),e()};b("context-close").replaceWith(t),b("context-close").addEventListener("click",i)}function u(t){K.h=void 0,t?.o.classList.remove("selected")}function p(t){t.forEach(t=>{t.classList.remove("targeted")})}function m(t,e){return e.data.a||e.data.l||e.data.w||e.data.u?t.filter(t=>t.data.type===k.enemy):[t.find(t=>t.data.type===k.player)]}function t(e){y[e.level].m().forEach(t=>{t=new _(e.p[t],e),e.m.push(t)})}const b=t=>document.getElementById(t),f=(t,e)=>t.querySelector(e),v=(t="x",e="")=>{var s=document.createElement("div");return s.classList.add(...t.trim().split(" ")),s.innerHTML=e,s},y={1:{m:()=>[r(9,9)]},2:{m:()=>[r(9,9),r(9,9)]},3:{m:()=>[r(7,8)]},4:{m:()=>[r(7,8),r(6,9)]},5:{m:()=>[r(7,9),r(5,7),r(5,7)]},6:{m:()=>[4,r(5,9),r(5,9)]},7:{m:()=>[4,4,r(5,7)]},8:{m:()=>[3,2,r(7,9)]},9:{m:()=>[3,2,3]},10:{m:()=>[1,2,3,5]}};class e{constructor(t){t&&this.register(t)}register(t){this.g=t}}var g={HAND:"HAND",DRAW:"DRAW",DONE:"DONE",INNATE:"INNATE"},w=g,k=((g={}).player="player",g.enemy="enemy",g.mount="mount",g),L=((g={}).assault="assault",g.ability="ability",g.defense="defense",g.innate="innate",g),T=((g={}).round="round",g.turn="turn",g.buff="buff",g),E=((g={}).PLAYER_TURN="player_turn",g.ENEMY_TURN="enemy_turn",g.PICKING_CARD="picking_card",g.GAME_OVER="game_over",g.TRANSITION="TRANSITION",g);const M=new AudioContext,C=()=>P.v?l(.5,void 0,1500,.01,void 0,.23,4,5,void 0,void 0,void 0,void 0,void 0,1,-30,void 0,void 0,.5,void 0,1):()=>{},N=()=>P.v?l(.5,void 0,1836,.14,.01,.07,4,2.9,28,74,void 0,void 0,.19,void 0,void 0,void 0,void 0,.33,void 0,.91):()=>{};class Y extends e{constructor(t,e){super(e);var s,{name:i,type:a,k:n}=t;this.id=h(),this.data={...t},this.T=t.k,this.o=(t=t.M,s=this.id,(a=v(`sprite-wrapper ${a===k.enemy?"enemy":"x"} `+(t?"mounted":"x"))).id=s,t&&a.appendChild(v("sprite horse")),s=v("sprite "+i),t=v("intent"),i=v("assault-value"),t.appendChild(i),s.appendChild(t),a.appendChild(s),(i=v("stats hp")).appendChild(v("number",n+"/"+n)),i.appendChild(v("fill")),a.appendChild(i),(t=v("stats affects")).appendChild(v("armor","D:0")),t.appendChild(v("enrage","E:0")),t.appendChild(v("weak","W:0")),a.appendChild(t),s=v("targeting"),a.appendChild(s),a),this.o.addEventListener("click",()=>{e.A(this.id)}),this.S=this.data.type===k.player}C(){b(this.data.type)?.appendChild(this.o),this.update()}update(t){var e=f(this.o,".hp .fill");e.style.width=Math.round(this.T/this.data.k*100)+"%",0<this.data.d?e.classList.add("armored"):e.classList.remove("armored"),f(this.o,".hp .number").innerHTML=this.T+"/"+this.data.k,(e=f(this.o,".affects .armor")).innerHTML="D:"+this.data.d,t?.d&&n(e),(e=f(this.o,".affects .enrage")).innerHTML="E:"+this.data.e,t?.e&&n(e),(e=f(this.o,".affects .weak")).innerHTML="W:"+this.data.w,t?.w&&n(e)}D(t){var e={},{a:t=0,l:s=0,u:i=0,w:a=0}=t,n=this.data.d;0<t&&0<this.data.d?(e.d=this.data.d,(n-=t)<0?(this.T=Math.min(this.data.k,Math.max(0,this.T-(t-this.data.d))),this.data.d=0):this.data.d=n):this.T=Math.min(this.data.k,Math.max(0,this.T-t)),this.data.w+=a,0<a&&(e.w=a),this.update(e),0<this.T||this.g?.K(this),n={},0<s&&(n.a=s),0<i&&(n.w=i),Object.keys(n).length&&this.g?.R(n)}N(t){var e={},{d:t=0,e:s=0,k:i=0}=t;this.T=Math.min(this.data.k,Math.max(0,this.T+i)),this.data.d+=t,this.data.e+=s,0<t&&(e.d=t),0<s&&(e.e=s),this.update(e),0<this.T||this.g?.K(this)}$(){this.data.d=0,this.update()}F(){this.data.e=Math.max(0,this.data.e-1),this.data.w=Math.max(0,this.data.w-1),this.update()}O(t){let e="";switch(t){case L.ability:P.v&&l(.5,void 0,316,.01,.05,.06,1,.22,-5.6,-2.4,void 0,void 0,void 0,1.8,void 0,.1,void 0,.79,.09),e="bumpUp";break;case L.assault:P.v&&l(1,void 0,255,.02,.04,.09,4,1.31,-.2,void 0,void 0,void 0,void 0,1.3,void 0,.3,.19,.52,.04,.22),e=this.S?"bumpLeft":"bumpRight";break;case L.defense:P.v&&l(.75,0,2838,.01,void 0,.2,2,1.98,void 0,void 0,35,.02,void 0,.1,void 0,.1,.08,.75,.1,.12),e=this.S?"bumpRight":"bumpLeft"}this.o.style.animationName=e,setTimeout(()=>{var t=f(this.o,".intent");t.className="intent",f(t,".assault-value").innerHTML=""},500),setTimeout(()=>{this.o.style.animation=""},1e3)}}class O extends Y{constructor(t,e){super(t,e),this.data={...t},this.G=t.W}L(){this.G=this.data.W}I(){this.data.d=0,this.data.w=0,this.data.e=0}H(){this.I(),this.L()}$(){super.$(),this.L(),this.update()}D(t){super.D(t)}N(t){super.N(t);var{s:t=0,P:e=0,U:s=0,j:i=0}=t;this.G+=t,this.T+=s,this.data.k+=s,0<i&&(this.data.e=0,this.data.w=0),0<e&&this.g?.Y.B(e),this.update(),0<this.T||this.g?.K(this)}_(t,e){let s=[];switch(e){case T.buff:s=t.filter(t=>t.data.V===T.buff),this.g?.q(s);break;case T.round:s=t.filter(t=>t.data.V===T.round);break;case T.turn:s=t.filter(t=>t.data.V===T.turn)}s.forEach(t=>{this.N(t.data),t.data.w&&this.g?.R(t.data)})}play(t){this.G-=t.data.c||0,this.update()}}class G extends e{constructor(t){super();var[t,e,s]=t;this.id=h(),this.name=t,this.type=e,this.data={...s},this.attributes=[]}J(t){return{...this.data,a:i(this.data.a||0,t),l:i(this.data.l||0,t),d:s(this.data.d||0,t)}}}class A extends G{constructor(t,e=!1){super(t),this.X(this.data),this.o=a(this),this.listener=(e?this.Z:this.tt).bind(this),this.o.addEventListener("click",this.listener)}Z(t){t.stopPropagation(),this.g?.state===E.PICKING_CARD&&this.g.Y.et(this)}tt(t){t.stopPropagation(),this.g?.st(this)}X(t,e){this.attributes=[],t.a&&this.attributes.push("ATTACK ENEMY: "+i(t.a,e)),t.j&&this.attributes.push("Remove ENRAGE and WEAKEN from SELF"),t.l&&this.attributes.push("ATTACK ALL: "+i(t.l,e)),t.u&&this.attributes.push("WEAKEN ALL: "+i(t.u,e)),t.d&&this.attributes.push(this.type===L.innate?`Start with +${t.d} defend/TURN`:"DEFEND SELF: "+s(t.d,e)),t.e&&this.attributes.push("ENRAGE SELF: "+t.e),t.w&&this.attributes.push(this.type===L.innate?`Enemies start +${t.w} weak/ROUND`:"WEAKEN ENEMY: "+t.w),t.s&&this.attributes.push(this.type===L.innate?`Gain +${t.s} stamina per TURN`:"STAMINA: +"+t.s),t.P&&this.attributes.push(this.type===L.innate?`Draw ${t.P} extra card${1<t.P?"s":""} per TURN`:"DRAW CARDS: "+t.P),t.U&&this.attributes.push(`Gain +${t.U} max life this ONCE`),t.k&&t.k<0&&this.attributes.push(`Lose ${Math.abs(t.k)} life`),t.k&&0<t.k&&this.attributes.push(this.type===L.innate?`Heal ${t.k} life at the start of each ROUND`:`Heal ${t.k} life`)}update(t){this.X(this.data,t),t=a(this),this.o.replaceChildren(...t.childNodes)}}const x=[["Saber Attack",L.assault,{a:8,c:1,i:"The Khans favored weapon, designed for use from horseback. These swords with slightly curved blades were 30-40 inches long."}],["Bambai Shield",L.defense,{d:10,c:1,i:"The Khans favored shield, round and domed, originally made of woven reeds covered in leather and later from stronger metal."}],["War Cry",L.ability,{c:1,u:1,e:2,i:"Enemies could scarcely move to defend themselves on hearing the screams of the Khans' army."}],["Rally Cry",L.defense,{c:2,d:18,e:1,i:"Such were The Khans regrouping tactics that enemies could find nowhere to strike."}],["Tactical Retreat",L.defense,{c:2,d:14,P:1,i:"Better to retreat, and entice the enemy into a trap or your making."}],["Surgical Strike",L.assault,{c:1,a:12,P:1,i:"Let your plans be dark and impenetrable as night, and when you move, fall like a thunderbolt."}]],R=[["Recharge",L.ability,{c:0,s:2,i:"The Khan's army could rest on the move, allowing them to be where noone thought they could be."}],["Push Through",L.ability,{c:1,P:3,i:"Any obstacle may be overcome with enough force."}],["Clairvoyance",L.ability,{c:0,P:2,i:"The Khan had a preternatural ability with strategy, to know what to do next."}],["Shield Wall",L.defense,{c:3,d:30,e:2,i:""}],["Reluctant Withdrawl",L.defense,{c:1,d:12,e:3,i:"The Khan grew more determined, and more angry, with every forced step backwards."}],["Whirling Dervish",L.assault,{c:2,l:10,u:2,i:"The Persians were a magnificent addition to the Khan's army."}],["Wrath Of Khan",L.assault,{c:3,l:15,e:4,k:-10,i:"The Khan was merciless, sometimes reckless, in pursuit of his enemies."}],["Reckless Assault",L.assault,{c:2,a:25,k:-5,i:"Let your plans be dark and impenetrable as night, and when you move, fall like a thunderbolt."}],["Overpower",L.assault,{c:2,a:18,w:2,i:"Attack where the enemy is unprepared, appear where you are not expected."}],["Cavalry Charge",L.assault,{c:4,l:18,i:"The Khan's cavalry were second to none thanks, in no small part, to the invention of the stirrup."}],["Shock and Awe",L.ability,{c:2,e:3,u:3,i:"Supreme excellence consists of breaking the enemy's resistance without fighting."}],["Combat Medics",L.defense,{c:1,d:8,k:6,i:"A little ginsing, some water, a BIG shield and you'll be back up in no time."}],["Field Hospital",L.ability,{c:2,k:12,i:"He will win who knows when to fight and when not to fight."}],["Meditation",L.ability,{c:1,j:1,i:"It is the unemotional, reserved, calm, detached warrior who wins, not the hothead seeking vengeance."}]],H=[["Strategic Planning",L.innate,{V:T.turn,c:0,P:1,i:"Water flows according to the ground as the soldier plots victory in relation to his foe."}],["Calisthenics",L.innate,{V:T.turn,c:0,s:1,i:"To not prepare is the greatest of crimes; to be prepared for any contingency is the greatest of virtues."}],["Tenger Spirit",L.innate,{V:T.round,c:0,k:10,i:"The Khan was considered the embodiment of this highest deity."}],["Fearsome Reputation",L.innate,{V:T.round,c:0,w:5,i:"Supreme excellence consists of breaking the enemy's resistance without fighting."}],["Scientific Advancement",L.innate,{V:T.buff,c:0,U:10,i:"To fight harder, be stronger, and live longer one must do more than just cross swords."}],["Defensive Perimeter",L.innate,{V:T.turn,c:0,d:5,i:"Supreme excellence consists of breaking the enemy's resistance without fighting."}]],I=[],W=[];class $ extends e{constructor(t){super(t),this.g=t,this.it=[new A(x[0]),new A(x[0]),new A(x[0]),new A(x[1]),new A(x[1]),new A(x[2]),new A(x[3]),new A(x[4]),new A(x[5])],this.Y=[...this.it],this.ht=[],this.nt=[],this.rt=[],this.ot=0,this.update(),this.register(this.g)}register(e){[this.it,this.ht,this.nt].forEach(t=>t?.forEach(t=>t.register(e)))}et(t){this.ht.forEach(t=>{t.o.classList.remove("selected")}),N(),this.ct===t?(b("confirmcard").disabled=!0,this.ct=void 0):(b("confirmcard").disabled=!1,this.ct=t,this.ct.o.classList.add("selected"))}dt(){var t=b("confirmcard");t.removeEventListener("click",this.dt),t.disabled=!0,t.classList.add("hide"),this.ct&&this.g?.state===E.PICKING_CARD&&(this.g?.lt(E.TRANSITION),this.ct.o.classList.remove("selected"),this.ct.o.removeEventListener("click",this.ct.listener),this.ct.listener=this.ct.tt.bind(this.ct),this.ct.o.addEventListener("click",this.ct.listener),this.ct.type===L.innate?this.add(this.ct,w.INNATE):this.add(this.ct),this.ct=void 0)}add(t,e){switch(e){case w.DONE:this.nt.push(t);break;case w.HAND:this.ht.push(t);break;case w.INNATE:this.rt.push(t);break;default:this.it.push(t)}return this.Y.push(t),this.update(),this.g.ut(),this}ft(){for(var t=[];this.it.length;)t.push(this.it.splice(Math.floor(Math.random()*this.it.length),1)[0]);return this.it=t,this}wt(t,e){for(;e.length;){var s=e.splice(Math.floor(Math.random()*e.length),1)[0],i=r(0,t.length);t.splice(i,0,s)}}update(){b("deck").innerHTML="Draw: "+this.it.length,b("done").innerHTML="Discard: "+this.nt.length}P(t){var e;return 0<(this.ot=t)&&this.ht.length<8?(P.v&&l(.25,void 0,323,.03,.02,.08,1,.59,14,void 0,void 0,void 0,void 0,1.5,void 0,void 0,void 0,.64,.09),this.it.length?((e=this.it.pop()).update(this.g.player.data),this.ht.push(e),b("card-holder")?.appendChild(e.o),this.update(),setTimeout(()=>this.P(--t),100)):this.nt.length&&(this.wt(this.it,this.nt),this.P(t))):0<this.ot&&this.g.alert("Your hand is full!"),this}B(t){setTimeout(()=>this.P(t),100)}yt(){var t=(()=>{let t=r(0,R.length-1),e=t,s=t;for(;e===t||e===s;)e=r(0,R.length-1);for(;s===t||s===e;)s=r(0,R.length-1);let i=r(0,H.length-1),a=r(0,H.length-1);for(;i===a;)a=r(0,H.length-1);var n=[t,e,s],h=[i,a];return d(n,I,R,6),d(h,W,H,4),[new A(R[n[0]],!0),new A(R[n[1]],!0),new A(R[n[2]],!0),new A(H[h[0]],!0),new A(H[h[1]],!0)]})(),e=b("confirmcard");e.addEventListener("click",this.dt.bind(this)),e.classList.remove("hide"),t.forEach(t=>{t.register(this.g),this.ht.push(t),b("card-holder")?.appendChild(t.o)})}gt(e){this.ht.forEach(t=>{t.update(e)})}vt(t,e=!0){t.o.parentNode?.removeChild(t.o),e&&this.nt.push(t),this.ht.splice(this.ht.indexOf(t),1),this.update()}kt(e){for(let t=0;this.rt.length>t;t++)-1!==e.indexOf(this.rt[t])&&(this.rt.splice(t,1),t--)}bt(){var t=this.ht[this.ht.length-1];t&&(this.vt(t,!1),setTimeout(()=>this.bt(),100))}F(){var t=this.ht[this.ht.length-1];t&&(this.vt(t),setTimeout(()=>this.F(),100))}Tt(){this.F(),setTimeout(()=>{this.wt(this.it,this.nt)},1e3)}}class _ extends Y{constructor(t,e){super(t,e)}Mt(t){var e=this.o.querySelector(".intent"),s=e.querySelector(".assault-value");e.classList.add(t.type),t.type===L.assault&&(s.innerHTML=""+i(t.data.a,this.data))}At(){this.xt=new G(this.data.actions.get()),this.Mt(this.xt)}D(t){super.D(t),this.xt&&this.Mt(this.xt)}}class S{constructor(t){this.actions=[...t]}get(){return this.actions[r(0,this.actions.length-1)]}}const D={Et:1,$:0,St:5,Ct:{name:"khan",type:k.player,k:50,d:0,w:0,f:0,e:0,M:!0,W:4},Dt:{1:{name:"king",type:k.enemy,k:80,d:0,w:0,e:0,M:!0,actions:new S([["",L.assault,{a:25}],["",L.assault,{a:20,d:10}],["",L.assault,{a:15,d:15}],["",L.defense,{d:25,w:2}],["",L.defense,{d:20,e:2,w:2}]])},2:{name:"archer",type:k.enemy,k:30,d:0,w:0,e:0,M:!1,actions:new S([["",L.assault,{a:15}],["",L.assault,{a:12}],["",L.assault,{a:10}],["",L.assault,{a:8,e:2}],["",L.assault,{a:8,w:2}]])},3:{name:"knight",type:k.enemy,k:40,d:0,w:0,e:0,M:!1,actions:new S([["",L.assault,{a:15}],["",L.assault,{a:12,e:2}],["",L.assault,{a:10,d:10}]])},4:{name:"dervish",type:k.enemy,k:28,d:0,w:0,e:0,M:!1,actions:new S([["",L.assault,{a:15}],["",L.assault,{a:10,e:2}],["",L.assault,{a:10,w:1}]])},5:{name:"bear2",type:k.enemy,k:22,d:0,w:0,e:1,M:!1,actions:new S([["",L.assault,{a:10}],["",L.assault,{a:7,e:2}],["",L.defense,{d:10}],["",L.defense,{d:8,e:2}],["",L.ability,{e:3}]])},6:{name:"bear1",type:k.enemy,k:22,d:0,w:0,e:2,M:!1,actions:new S([["",L.assault,{a:10}],["",L.assault,{a:7,e:2}],["",L.defense,{d:10}],["",L.defense,{d:8,e:2}],["",L.ability,{e:3}]])},7:{name:"rok",type:k.enemy,k:18,d:0,w:0,e:0,M:!1,actions:new S([["",L.assault,{a:8,d:5}],["",L.assault,{a:4,e:2}],["",L.assault,{a:5,e:2}],["",L.defense,{d:10}]])},8:{name:"wolf",type:k.enemy,k:16,d:0,w:0,e:3,M:!1,actions:new S([["",L.assault,{a:10}],["",L.assault,{a:6,e:2}],["",L.ability,{e:2,w:3}]])},9:{name:"snake",type:k.enemy,k:12,d:0,w:0,e:0,M:!1,actions:new S([["",L.assault,{a:9,w:1}],["",L.assault,{a:5,w:1,e:2}],["",L.assault,{a:7,w:1}],["",L.defense,{d:10,e:3}]])}}},K={h:void 0,Kt:[]};class F{constructor(t,e){this.Y=e?.Y||new $(this),e?.Y&&this.Y.register(this),this.e=t,this.level=D.Et,this.turn=D.$,this.m=[],this.player=new O(D.Ct,this),this.state=E.PLAYER_TURN,this.Rt=1,this.p=D.Dt}lt(t){this.state=t}alert(t){const e=h(),s=b("alert");s.setAttribute("data-id",e),s.innerHTML=t,setTimeout(()=>{b("alert").getAttribute("data-id")===e&&(b("alert").innerHTML="")},4e3)}Nt(){const e=b("deckdisplay"),t=b("viewdeck");e.classList.contains("hide")?(e.classList.remove("hide"),this.Y.Y.forEach(t=>{e.appendChild(t.o.cloneNode(!0))}),t.style.zIndex="20001",t.innerHTML="Done"):(e.classList.add("hide"),e.innerHTML="",t.style.zIndex="inherit",t.innerHTML="View Deck")}$t(){this.Rt=+b("difficulty").value,this.p=(a=>{let n=1;switch(a){case 3:case 2:n=1.5;break;case 4:n=2;break;case 5:n=2.5;break;default:n=1}const h={...D.Dt};return Object.keys(h).forEach(t=>{var e={...h[t=+t]},s=(2<a&&(e.k=Math.ceil(e.k*n)),[...e.actions.actions]);const i=[];s.forEach(t=>{var e={...(t=[t[0],t[1],{...t[2]}])[2]};e.a&&(e.a*=n),e.d&&(e.d*=n),t[2]=e,i.push(t)}),e.actions=new S(i),h[t]=e}),h})(this.Rt),this.e.title.classList.add("hide"),this.e.g.classList.remove("hide"),t(this),this.Y.ft(),this.C(),this.Ft()}Tt(){this.Y.Tt(),b("endturn").disabled=!0,setTimeout(()=>{this.lt(E.PICKING_CARD),this.Y.yt(),b("stamina").innerHTML="Pick a card to add to your deck OR an innate ability!"},1e3)}Ot(t=!0){setTimeout(()=>{c(t?"Oh Great Khan! You've done it! The King of the West has fallen and all lands are yours, from sea to sea on all sides! Go \n  forth now and prosper and multiply so that these lands will know the lineage and rule of Khan until the end of time!":"Oh Great Khan, the people mourn you! The Gods must have been mistaken, for it was not your destiny to conquer these lands,\n  but rather it must have been one of your many offspring who is to wear this mantle. We shall wait still for those days of\n  glory to come.",()=>{c("Thank you for playing, hope you enjoyed this tiny game!",()=>{window.location.reload()})},!0)},1e3)}ut(){C(),this.Y.bt(),this.player._(this.Y.rt,T.buff),setTimeout(()=>{this.Gt()},500)}Gt(){this.level+=1,this.turn=0,t(this),this.player._(this.Y.rt,T.round),setTimeout(()=>{this.player.H(),this.Y.ft(),this.C(),this.Ft()},500)}Ft(){this.turn+=1,this.lt(E.PLAYER_TURN),b("endturn").disabled=!1,this.player.$(),this.player._(this.Y.rt,T.turn),this.update(),this.m.forEach(t=>{t.At()}),this.Y.B(D.St)}C(){this.m.forEach(t=>{t.C()}),this.player.C(),b("stamina").innerHTML="Stamina: "+this.player.G,b("stage").innerHTML=`Stage ${this.level} / `+Object.keys(y).length,b("round").innerHTML="Turn "+this.turn}update(){b("stamina").innerHTML="Stamina: "+this.player.G,b("round").innerHTML="Turn "+this.turn}q(t){this.Y.kt(t)}st(t){if(p(K.Kt),N(),K.Kt=[],t.data.c>this.player.G){{const e=t.o.querySelector(".cost");e.classList.add("flash"),setTimeout(()=>e.classList.remove("flash"),250)}this.alert("Not enough stamina!")}else K.h?.id!==t.id?(u(K.h),(K.h=t).o.classList.add("selected"),m([...this.m,this.player],t).forEach(t=>{t=t.o.querySelector(".targeting"),K.Kt.push(t),t.classList.add("targeted")})):u(K.h)}A(e){var t,s,i;!K.h||!(t=m([...this.m,this.player],K.h).find(t=>t?.id===e))||K.h?.data?.c>this.player.G||(s=K.h,u(K.h),p(K.Kt),this.player.play(s),this.player.O(s.type),i=s.J(this.player.data),t&&t!==this.player&&t.D(i),this.player.N(i),this.Y.gt(this.player.data),this.update(),this.Y.vt(s),this.m.length)||(this.level===Object.keys(y).length?(this.lt(E.GAME_OVER),this.Ot()):this.Tt())}R(e){[...this.m].forEach(t=>{t.D(e)})}Wt(){this.state===E.PLAYER_TURN&&(C(),this.lt(E.ENEMY_TURN),b("endturn").disabled=!0,this.player.F(),u(K.h),p(K.Kt),this.m.forEach(t=>{t.$()}),this.Y.F(),setTimeout(()=>this.Lt(),1e3))}Lt(){const e=[...this.m],s=()=>{var t=e.pop();if(t){const e=t.xt.J(t.data);this.player.D(e),t.N(e),t.O(t.xt.type),setTimeout(()=>s(),1e3)}else this.It()};s()}It(){this.state!==E.GAME_OVER&&(this.m.forEach(t=>{t.F()}),this.Ft())}K(t){t.o.style.animationName="dead",setTimeout(()=>{t.o.parentNode?.removeChild(t.o)},750),t.S?(this.lt(E.GAME_OVER),this.Ot(!1)):this.m.splice(this.m.indexOf(t),1)}}const P={Ht:!1,v:!0,Pt:!1};window.addEventListener("load",()=>{function t(){P.Ht||(P.Ht=!0,r.Ht.classList.remove("stopped"),s`50.25\n|C---H---|--------|        |J---A---|--------|        |F---E---|--------|        |H---F---|--------|        |A---C---|--------|        |E---C---|--------|        |F---J---|--------|        |C---F---|--------|     |`)}function e(t){t?(P.Pt=!0,b("board").classList.add("tutorial"),b("context").classList.remove("hide"),b("context").classList.add("show"),b("gotit").classList.remove("hide")):(P.Pt=!1,b("board").classList.remove("tutorial"),b("context").classList.add("hide"),b("context").classList.remove("show"),b("gotit").classList.add("hide"))}v={},y=[...Array(12).keys()].map(()=>new AudioContext),h=(t,e)=>Math.sin(6.28*t+e),g=t=>h(t,h(t,0)**2+.75*h(t,.25)+.1*h(t,.5)),w=(t,e,s)=>{var i=e.createGain();i.gain.value=.1,i.connect(e.destination),(e=e.createBufferSource()).buffer=t,e.connect(i),e.start(),s&&e.stop()};const s=t=>{var u=125,p=.5;i=t[m=0].replace(/[\!\|]/g,"").split("\n").map(c=>0<c?(c=c.split("."),u=c[0],p=c[1]/100||p):c.split("").map((t,e)=>{var s=1;for(t=t.charCodeAt(0),t-=90<t?71:65;"-"==c[e+s];)s++;m<e&&(m=e+1);var i=s*p*u/125,a=44100,n=t+""+i,h=v[n];if(0<=t&&!h){for(var r=65.406*1.06**t/a,d=a*i|0,o=a*(i-.002),l=(h=v[n]=y[0].createBuffer(1,d,a)).getChannelData(0);d--;)l[d]=(d<88?d/88.2:(1-(d-88.2)/o)**(Math.log(1e4*r)/2)**2)*g(d*r);f||y.map(t=>w(h,t,f=1))}return h})),n=0,clearInterval(a),a=setInterval(s=>{i.map((t,e)=>{t[s=n%t.length]&&w(t[s],y[3*e+n%3])}),n++,n%=m},u)};var i,m,a,f,n,v,y,h,g,w;const r={t:b("board"),title:b("title"),g:b("game"),Ut:b("new"),continue:b("continue"),jt:b("endturn"),Ht:b("music"),v:b("sfx"),Pt:b("tutorial"),Bt:b("gotit"),Yt:b("viewdeck")},d=new F(r);document.ondblclick=t=>{t.preventDefault()},r.Pt.addEventListener("click",()=>{e(!P.Pt)}),r.Bt.addEventListener("click",()=>{e(!1)}),r.Ut.addEventListener("click",()=>{l(0),t(),c("Oh Great Khan! The Gods have decreed the world shall know and fear the name, Ghengis Khan.\n  All lands shall be yours, Oh Great Khan...you must simply go forth and seize them.\n  <br /><br />\n  Should you prepare wisely, even the Great King of the West will be no match for your might! Go forth and conquer!",()=>{r.Pt.classList.remove("hide"),d.$t.call(d)})}),r.jt.addEventListener("click",()=>d.Wt()),r.Ht.addEventListener("click",()=>{P.Ht?(P.Ht=!1,r.Ht.classList.add("stopped"),s``):t()}),r.v.addEventListener("click",()=>{P.v?(P.v=!1,r.v.classList.add("stopped")):(P.v=!0,r.v.classList.remove("stopped"))}),r.Yt.addEventListener("click",d.Nt.bind(d)),window.addEventListener("resize",()=>{o(r)}),o(r),navigator.userAgent.match("CriOS")&&alert("Hello iOS Chrome User!\n\nYou may have to rotate your phone orientation back/forth once for correct display.\n\nEnjoy the game!")})</script>