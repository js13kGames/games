function Vector(){arguments.length;this.x=0,this.y=0,this.z=0}function Particle(t){this.pos=new Vector,this.velocity=new Vector,this.force=new Vector,this.mass=t,this.fixed=!1,this.age=0,this.dead=!1}function Spring(t,e,s,i,a){this.constant=s,this.damping=i,this.length=a,this.a=t,this.b=e,this.on=!0}function RungeKuttaIntegrator(t){this.s=t,this.originalPoss=[],this.originalVelocities=[],this.k1Forces=[],this.k1Velocities=[],this.k2Forces=[],this.k2Velocities=[],this.k3Forces=[],this.k3Velocities=[],this.k4Forces=[],this.k4Velocities=[]}function ParticleSystem(){this.particles=[],this.springs=[],this.attractions=[],this.forces=[],this.integrator=new RungeKuttaIntegrator(this),this.hasDeadParticles=!1;var t=arguments.length;2===t?(this.gravity=new Vector(0,arguments[0],0),this.drag=arguments[1]):4===t?(this.gravity=new Vector(arguments[0],arguments[1],arguments[2]),this.drag=arguments[3]):(this.gravity=new Vector(0,ParticleSystem.DEFAULT_GRAVITY,0),this.drag=ParticleSystem.DEFAULT_DRAG)}Vector.prototype.set=function(t,e,s){return 3===arguments.length?extend(this,{x:t,y:e,z:s}):extend(this,t),this},Vector.prototype.add=function(t,e,s){return 3===arguments.length?(this.x+=t,this.y+=e,this.z+=s):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this},Vector.prototype.distanceTo=function(){return Math.sqrt(this.distanceSquaredTo(arguments[0]))},Vector.prototype.distanceSquaredTo=function(t){var e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i},Vector.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},Vector.prototype.clear=function(){this.x=0,this.y=0,this.z=0},Vector.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"},Vector.prototype.cross=function(t){return new Vector(this.y*t.z-this.z*t.y,this.x*t.z-this.z*t.x,this.x*t.y-this.y*t.x)},Vector.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},Particle.prototype.distanceTo=function(t){return this.pos.distanceTo(t.pos)},Particle.prototype.makeFixed=function(){this.fixed=!0,this.velocity.clear()},Particle.prototype.reset=function(){this.age=0,this.dead=!1,this.pos.clear(),this.velocity.clear(),this.force.clear()},Spring.prototype.apply=function(){var t=this.a,e=this.b;if(!(!this.on||t.fixed&&e.fixed)){var s=t.pos.x-e.pos.x,i=t.pos.y-e.pos.y,a=t.pos.z-e.pos.z,r=Math.sqrt(s*s+i*i+a*a);0===r?(s=0,i=0,a=0):(s/=r,i/=r,a/=r);var o=-1*(r-this.length)*this.constant,n=t.velocity.x-e.velocity.x,l=t.velocity.y-e.velocity.y,c=t.velocity.z-e.velocity.z,h=o+-1*this.damping*(s*n+i*l+a*c);s*=h,i*=h,a*=h,t.fixed||t.force.add(s,i,a),e.fixed||e.force.add(-1*s,-1*i,-1*a)}},RungeKuttaIntegrator.prototype.allocateParticles=function(){for(;this.s.particles.length>this.originalPoss.length;)this.originalPoss.push(new Vector),this.originalVelocities.push(new Vector),this.k1Forces.push(new Vector),this.k1Velocities.push(new Vector),this.k2Forces.push(new Vector),this.k2Velocities.push(new Vector),this.k3Forces.push(new Vector),this.k3Velocities.push(new Vector),this.k4Forces.push(new Vector),this.k4Velocities.push(new Vector)},RungeKuttaIntegrator.prototype.step=function(t){var e,s,i,a,r,o,n,l,c,h,d,p,E=this.s;for(this.allocateParticles(),s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(this.originalPoss[s].set(e.pos),this.originalVelocities[s].set(e.velocity)),e.force.clear();for(E.applyForces(),s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(this.k1Forces[s].set(e.force),this.k1Velocities[s].set(e.velocity)),e.force.clear();for(s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(i=this.originalPoss[s],r=this.k1Velocities[s],e.pos.x=i.x+.5*r.x*t,e.pos.y=i.y+.5*r.y*t,e.pos.z=i.z+.5*r.z*t,a=this.originalVelocities[s],c=this.k1Forces[s],e.velocity.x=a.x+.5*c.x*t/e.mass,e.velocity.y=a.y+.5*c.y*t/e.mass,e.velocity.z=a.z+.5*c.z*t/e.mass);for(E.applyForces(),s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(this.k2Forces[s].set(e.force),this.k2Velocities[s].set(e.velocity)),e.force.clear();for(s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(i=this.originalPoss[s],o=this.k2Velocities[s],e.pos.x=i.x+.5*o.x*t,e.pos.y=i.y+.5*o.y*t,e.pos.z=i.z+.5*o.z*t,a=this.originalVelocities[s],h=this.k2Forces[s],e.velocity.x=a.x+.5*h.x*t/e.mass,e.velocity.y=a.y+.5*h.y*t/e.mass,e.velocity.z=a.z+.5*h.z*t/e.mass);for(E.applyForces(),s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(this.k3Forces[s].set(e.force),this.k3Velocities[s].set(e.velocity)),e.force.clear();for(s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(i=this.originalPoss[s],n=this.k3Velocities[s],e.pos.x=i.x+n.x*t,e.pos.y=i.y+n.y*t,e.pos.z=i.z+n.z*t,a=this.originalVelocities[s],d=this.k3Forces[s],e.velocity.x=a.x+d.x*t/e.mass,e.velocity.y=a.y+d.y*t/e.mass,e.velocity.z=a.z+d.z*t/e.mass);for(E.applyForces(),s=0;s<E.particles.length;s++)(e=E.particles[s]).fixed||(this.k4Forces[s].set(e.force),this.k4Velocities[s].set(e.velocity));for(s=0;s<E.particles.length;s++)(e=E.particles[s]).age+=t,e.fixed||(i=this.originalPoss[s],r=this.k1Velocities[s],o=this.k2Velocities[s],n=this.k3Velocities[s],l=this.k4Velocities[s],e.pos.x=i.x+t/6*(r.x+2*o.x+2*n.x+l.x),e.pos.y=i.y+t/6*(r.y+2*o.y+2*n.y+l.y),e.pos.z=i.z+t/6*(r.z+2*o.z+2*n.z+l.z),a=this.originalVelocities[s],c=this.k1Forces[s],h=this.k2Forces[s],d=this.k3Forces[s],p=this.k4Forces[s],e.velocity.x=a.x+t/(6*e.mass)*(c.x+2*h.x+2*d.x+p.x),e.velocity.y=a.y+t/(6*e.mass)*(c.y+2*h.y+2*d.y+p.y),e.velocity.z=a.z+t/(6*e.mass)*(c.z+2*h.z+2*d.z+p.z))},ParticleSystem.DEFAULT_GRAVITY=0,ParticleSystem.DEFAULT_DRAG=.001,ParticleSystem.prototype.setGravity=function(){var t=arguments.length;1===t?this.gravity.set(0,arguments[0],0):3===t&&this.gravity.set(arguments[0],arguments[1],arguments[2])},ParticleSystem.prototype.tick=function(){this.integrator.step(0===arguments.length?1:arguments[0])},ParticleSystem.prototype.makeParticle=function(){var t=1,e=0,s=0,i=0;4===arguments.length&&(t=arguments[0],e=arguments[1],s=arguments[2],i=arguments[3]);var a=new Particle(t);return a.pos.set(e,s,i),this.particles.push(a),a},ParticleSystem.prototype.makeSpring=function(t,e,s,i,a){var r=new Spring(t,e,s,i,a);return this.springs.push(r),r},ParticleSystem.prototype.clear=function(){this.particles.clear(),this.springs.clear(),this.attractions.clear()},ParticleSystem.prototype.applyForces=function(){var t,e;if(!this.gravity.isZero())for(e=0;e<this.particles.length;e++)(t=this.particles[e]).force.add(this.gravity);for(e=0;e<this.particles.length;e++)(t=this.particles[e]).force.add(-1*t.velocity.x*this.drag,-1*t.velocity.y*this.drag,-1*t.velocity.z*this.drag);for(e=0;e<this.springs.length;e++)(t=this.springs[e]).apply();for(e=0;e<this.attractions.length;e++)(t=this.attractions[e]).apply();for(e=0;e<this.forces.length;e++)(t=this.forces[e]).apply()},Array.prototype.remove=function(t){var e;if("number"==typeof t)this.splice(t,1);else for(e=0;e<this.length;e++)this[e]===t&&(this.remove(e),e--)},GUIDES_AMOUNT=18,COUNTDOWN_DURATION=2e3,GAME_DURATION=3e4,KNOCKOUT_DURATION=500,ARENA_RADIUS=.9,HOOKS_AMOUNT=200,BAD_HOOKS_FRQ=5,HOOKS_PAUSE=1,COMBO_DELTA=300,POINTS_BAD=100,POINTS_PERF=200,SPECIAL_HOOK_DURATION=9e3,PHYS_GRAVITY=0,PHYS_DRAG=.2,SPRING_STRENGTH=.2,SPRING_DAMPING=.01,V_OFFSET=22,CABLE_THICKNESS=3,HOOK_RADIUS=8,COLOR_PURPLE="#B788D6",COLOR_LIGHTGRAY="#A7A8AC",COLOR_DARKGRAY="#292929",COLOR_BLACK="#1A1A1A",COLOR_RED="#F33",COLOR_BLUE="#69BAFF",COLOR_WHITE="#FFF",INTRO_TEXT_1="YEAR 2018, STARTUPS HAVE BECOME BIG GLOBAL CORPORATIONS THAT CONTROL THE WORLD THROUGH THE INTERNET.",INTRO_TEXT_2="THE DIGITAL RESISTANCE HAS MANAGED TO SWITCH IT OFF AND IT’S CREATING A NEW OPEN NETWORK FOR THE REBELS, WEIRDOS AND UNDERDOGS.",TUTORIAL_TEXT_1="CONNECT THE DOTS",TUTORIAL_TEXT_2="AVOID CORPORATIONS",TUTORIAL_TEXT_3="HOOK THE REBELS",PI=Math.PI,PI2=2*PI,sin=Math.sin,cos=Math.cos,abs=Math.abs,rand=Math.random,floor=Math.floor,round=Math.round,ceil=Math.ceil,min=Math.min,max=Math.max,clamp=((t,e=0,s=1)=>t<e?e:t>s?s:t),normalize=((t,e,s)=>{var i=t-e;return i/=s-e}),modulate=((t,e,s,i=0,a=1)=>{return(t=normalize(t,i,a))*(s-e)+e}),times=((t,e)=>{Array(t).fill().forEach((t,s)=>e(s))}),range=(t=>Array(t).fill().map((t,e)=>e)),mapN=((t,e)=>range(t).map(e)),easeIn=(t=>t*t*t),easeOut=(t=>{var e=t-1;return e*e*e+1}),easeInOut=(t=>t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1),extend=Object.assign,first=(t=>t[0]),last=(t=>t[t.length-1]),keys=Object.keys,values=Object.values,pxToUnits=(t=>t/W*2),unitsToPx=(t=>t*W/2),nToA=(t=>modulate(round(modulate(t,0,GUIDES_AMOUNT)),0,PI2,0,GUIDES_AMOUNT)),setAllE=(t=>{t.forEach(t=>{extend(t[0].p,t[1]);var e=t[1]._s;e&&t[0].setState(e)})}),tlEStartAt=0,tlETriggers=[],_updateTlE=(t=>{for(var e,s=t-tlEStartAt,i=[];e=tlETriggers.pop();)if(e[0]<s){extend(e[1].p,e[2]);var a=e[2]._s;a&&e[1].setState(a)}else i.push(e);tlETriggers=i,i.length||TICKER.remove(_updateTlE)}),tlE=(t=>{tlETriggers=t,tlEStartAt=performance.now(),TICKER.add(_updateTlE)}),T=[];var canvas=document.getElementById("game"),handleTouch=t=>{t.preventDefault(),Array.prototype.slice.call(t.touches).forEach(t=>{T[0]={x:pxToUnits(t.clientX-W/2),y:pxToUnits(t.clientY-V_OFFSET-H/2),z:0}})};canvas.addEventListener("touchstart",handleTouch),canvas.addEventListener("touchmove",handleTouch),canvas.addEventListener("touchmove",handleTouch),canvas.addEventListener("touchend",()=>{T=[]});class Ticker{constructor(){this.start=this.start.bind(this),this.loop=this.loop.bind(this),this.ticks=[],this.last_ms=0,this.last_real_ms=0,this.playing=!1}add(t){this.ticks.push(t)}remove(t){this.ticks.remove(t)}loop(t){if(this.playing){var e=(t=t||0)-this.last_real_ms;this.last_real_ms=t,this.last_ms+=e,this.ticks.forEach(t=>{t(this.last_ms,e)}),requestAnimationFrame(this.loop)}}start(){this.playing=!0,this.loop()}stop(){this.playing=!1}}W=H=null;class Game{constructor(t){this.render=this.render.bind(this),this.setup=t.setup,this.states=t.states,this.canvas=document.getElementById(t.canvas),this.ctx=this.canvas.getContext("2d"),TICKER.add(this.render),this.setup(),this.resize()}render(t,e){this.states[this.state].loop(this.ctx,t,e)}destroy(){TICKER.stop()}start(){TICKER.start()}setState(t){this.state=t,this.states[this.state].enter(this.ctx)}resize(){W=window.innerWidth,H=window.innerHeight,extend(this.canvas,{width:W,height:H}),W>500&&(this.ctx.beginPath(),this.ctx.fillStyle=COLOR_BLACK,this.ctx.rect(0,0,W,H),this.ctx.fill(),this.ctx.canvas.style.letterSpacing="1.5px",this.ctx.fillStyle="#fff",this.ctx.font="22px DIN Alternate",this.ctx.textAlign="center",this.ctx.fillText("OPEN IN MOBILE",W/2,H/2),this.setState=(()=>{}),TICKER.stop())}}CAMERA_OFF_X=0,CAMERA_OFF_Y=0;class Entity{constructor(t={}){this._animate=this._animate.bind(this),this.p={x:0,y:0,z:0,r:0,s:1,o:1,v:1},this.cacheStates(),this.cacheAnimations(),this.setStateI(t.s)}beginRender(t){t.resetTransform(),t.globalAlpha=this.p.v?this.p.o:0,t.translate(unitsToPx(this.p.x+1)+CAMERA_OFF_X,unitsToPx(this.p.y+H/W)+V_OFFSET+CAMERA_OFF_Y),t.scale(this.p.s,this.p.s)}endRender(t){t.globalAlpha=1,t.resetTransform()}states(){return{}}animations(){return{}}cacheStates(){this._states=this.states()}cacheAnimations(){var t=this.animations();this._animations={};var e=keys(t),s=values(t);e.forEach((t,e)=>{var i=t.split("→")[0],a=t.split("→")[1],r=this._animations[i];r||(r=this._animations[i]={}),r[a]=s[e]})}getState(t){return this._states[t]}getAnimation(t,e){var s=null;return this._animations[t]&&(s=this._animations[t][e]),s}setStateI(t){var e=this.getState(t);extend(this.p,e),this._state=t}setState(t){if(t!==this._state){this.setStateI(this._state),this._a=null,TICKER.remove(this._animate);var e=this.getState(t),s=this.getAnimation(this._state,t);if(!s)return this.setStateI(t);this._state=t,this.animateTo(e,s)}}animateTo(t,e){this._a={p:0,d:e._d,from:this.p,to:t,e:e._e},TICKER.add(this._animate)}_animate(t,e){this._a.p+=10;var s=this._a.p/this._a.d;if(s>1)return TICKER.remove(this._animate),void(this._a=null);s=clamp(s);var i=keys(this._a.to);values(this._a.to).forEach((t,e)=>{var a=i[e],r=this._a.from[a];this.p[a]=modulate("out"===this._a.e?easeOut(s):easeIn(s),r,t)})}}class Pool{constructor(t,e){this.entities=Array(e).fill().map(()=>new t),this._count=e,this.reset()}reset(){this.p=Array(this._count).fill().map(()=>({x:0,y:0,r:0,s:0}))}render(t,e,s){this.entities.forEach((i,a)=>{var r=this.p[a];Object.assign(i.p,r),r&&r.state&&i.setState(r.state),r&&i.render(t,e,s)})}}function wrapText(t,e,s,i,a,r){var o=e.split(" "),n="";o.forEach((e,l)=>{var c=n+e+" ";t.measureText(c).width>a&&l>0?(t.fillText(n,s,i),n=o[l]+" ",i+=r):n=c}),t.fillText(n,s,i)}class TextBox extends Entity{constructor(){super(),this.p.t=""}render(t,e,s){this.beginRender(t),t.canvas.style.letterSpacing="1.5px",t.fillStyle="#fff",t.font=W/23+"px DIN Alternate",t.textAlign="center",wrapText(t,this.p.t,0,0,.9*W,W/15),this.endRender(t)}}class Bg extends Entity{constructor(){super({s:"full"})}states(){return{normal:{rad:1},full:{rad:2.5}}}animations(){return{"normal→full":{_d:200,rad:[0,1,"out"]},"full→normal":{_d:200,rad:[0,1,"out"]}}}render(t,e,s){this.beginRender(t),t.beginPath(),t.fillStyle=COLOR_BLACK,t.rect(-W/2,.7*-H,W,1.4*H),t.fill(),this.drawGuides(t),this.drawMask(t),this.endRender(t)}drawGuides(t){t.strokeStyle=COLOR_DARKGRAY,t.lineWidth=2,times(3*GUIDES_AMOUNT,e=>{t.beginPath();var s=e*PI2/(3*GUIDES_AMOUNT);t.moveTo(unitsToPx(2*sin(s)),unitsToPx(2*cos(s))),t.lineTo(unitsToPx(-2*sin(s)),unitsToPx(-2*cos(s))),t.stroke()})}drawMask(t){t.beginPath(),t.fillStyle=COLOR_BLACK,t.rect(-W/2,.7*-H,W,1.4*H),t.arc(0,0,W/2*ARENA_RADIUS*this.p.rad,0,-PI2,!0),t.fill(),t.beginPath(),t.strokeStyle="white",t.lineWidth=1.5,t.arc(0,0,W/2*ARENA_RADIUS*this.p.rad,0,-PI2),t.stroke(),t.beginPath(),t.strokeStyle=COLOR_DARKGRAY,t.lineWidth=1.5,t.arc(0,0,W/2*ARENA_RADIUS*.2,0,-PI2),t.fill(),t.stroke()}}var spriteImg=document.getElementById("sprite");TITLE_W=1040,TITLE_H=230,BIG_E_S=600;class Sprite extends Entity{render(t,e,s){if(this.beginRender(t),1===this.p.c&&(t.globalCompositeOperation="xor"),"title"===this.p.id&&t.drawImage(spriteImg,0,180,TITLE_W,TITLE_H,-TITLE_W/2,-TITLE_H/2,TITLE_W,TITLE_H),"bigE"===this.p.id){var i=W/(1.1*BIG_E_S);t.scale(i,i),t.drawImage(spriteImg,0,710,BIG_E_S,BIG_E_S,-BIG_E_S/2+20,-BIG_E_S/2,BIG_E_S,BIG_E_S),t.scale(-i,-i)}t.globalCompositeOperation="source-over",this.endRender(t)}}SQUARES_SIZE=24,SQUARES_R=.85*SQUARES_SIZE/2,SQUARES_GUTTER=4,SQUARES_COLUMNS=2,SQUARES_ROWS=3,SQUARES_W=SQUARES_SIZE*SQUARES_COLUMNS+(SQUARES_COLUMNS-1)*SQUARES_GUTTER,SQUARES_H=SQUARES_SIZE*SQUARES_ROWS+(SQUARES_ROWS-1)*SQUARES_GUTTER;class Squares extends Entity{constructor(){super(),this.p.c=0}render(t,e,s){this.beginRender(t);var i=floor(s/1e3);times(SQUARES_ROWS,e=>{times(SQUARES_COLUMNS,s=>this.drawSquare(t,e,s,i++))}),this.endRender(t)}drawSquare(t,e,s,i){var a=modulate(s,-SQUARES_W/2,SQUARES_W/2,0,SQUARES_COLUMNS),r=modulate(e,-SQUARES_H/2,SQUARES_H/2,0,SQUARES_ROWS),o=floor(sin(i))*(PI2/4);t.fillStyle=0===this.p.c?COLOR_BLACK:COLOR_LIGHTGRAY,t.translate(a,r),t.rotate(o),t.fillRect(-SQUARES_SIZE/2,-SQUARES_SIZE/2,SQUARES_SIZE,SQUARES_SIZE),t.fillStyle=0===this.p.c?COLOR_LIGHTGRAY:COLOR_BLACK,t.rotate(-o),t.translate(-a,-r)}}class Btn extends Entity{render(t,e,s){this.beginRender(t),t.beginPath(),t.fillStyle=COLOR_PURPLE,t.arc(0,0,40,0,PI2),t.fill(),t.beginPath(),t.fillStyle=COLOR_WHITE,t.moveTo(-15,-20),t.lineTo(25,0),t.lineTo(-15,20),t.fill(),this.endRender(t)}states(){return{hidden:{s:0},normal:{s:1}}}animations(){return{"hidden→normal":{_d:2e3,_e:"out"},"normal→hidden":{_d:2e3,_e:"out"}}}}class BtnOutline extends Entity{render(t,e,s){floor(s/300)%5>3||(this.beginRender(t),t.beginPath(),t.strokeStyle="white",t.lineWidth=2,t.ellipse(0,0,40,25,.03*-PI2,0,PI2),t.stroke(),t.beginPath(),t.lineWidth=3,t.moveTo(-10,-10),t.lineTo(15,0),t.lineTo(-10,10),t.closePath(),t.stroke(),this.endRender(t))}}COUNTER_GH=160,glyphWidths=[138,87,156,171,183,147,123,142,199,128],glyphsImg=document.getElementById("sprite");class Counter extends Entity{constructor(){super({s:"normal"}),this.p.n=0}render(t,e,s){this.beginRender(t);var i=floor(this.p.n),a=[(i=i.toString().split("")).reduce((t,e)=>t+glyphWidths[~~e],0),COUNTER_GH];i.forEach((e,s)=>{var r=glyphWidths[~~e],o=glyphWidths.slice(0,~~e).reduce((t,e)=>t+e,0),n=-a[0]/2+i.slice(0,s).reduce((t,e)=>t+glyphWidths[~~e],0);1===this.p.c&&(t.globalCompositeOperation="xor"),t.drawImage(glyphsImg,o,0,r,COUNTER_GH,n,-COUNTER_GH/2,r,COUNTER_GH),t.globalCompositeOperation="source-over"}),this.endRender(t)}setNumber(t){this.p.n!==t&&this.animateTo({n:t},{_d:1500})}states(){return{normal:{s:.25},focus:{s:.6},hidden:{s:0}}}animations(){return{"normal→focus":{_d:2e3,s:[0,1,"in"]},"focus→normal":{_d:2e3,s:[0,1,"in"]},"hidden→focus":{_d:2e3,s:[0,1,"in"]}}}}class Timer extends Entity{constructor(){super(),this.p.p=1}render(t,e,s){if(!(this.p.p<.25&&floor(s/100)%2)){this.beginRender(t),t.beginPath(),t.strokeStyle=COLOR_BLACK,t.lineWidth=2;var i=.95*W;t.moveTo(-i/2+20,0),t.lineTo(modulate(this.p.p,-i/2+20,i/2),0),t.stroke(),t.fillStyle=COLOR_BLACK,t.font="16px DIN Alternate",t.textAlign="left";var a=""+ceil(this.p.p*GAME_DURATION/1e3);1===a.length&&(a="0"+a),t.fillText(a,-i/2,5),this.endRender(t)}}}ALERT_W=.8,ALERT_H=.2,COMB_W=580,COMB_H=140,PERF_W=815,PERF_H=140,spriteImg=document.getElementById("sprite");class Alert extends Entity{render(t,e,s){if(!this.p.t)return;this.beginRender(t);const i=ALERT_W*W,a=ALERT_H*W;t.fillStyle=COLOR_BLACK,t.fillRect(-i/2,-a/2,i,a),t.strokeStyle="#fff",t.strokeRect(-i/2+5,-a/2+5,i-10,a-10),t.fillStyle="#fff",t.font="24px DIN Alternate",t.textAlign="left","C"===this.p.t[0]||"P"===this.p.t[0]?"C"===this.p.t[0]?(t.scale(.3,.3),t.drawImage(spriteImg,0,420,COMB_W,COMB_H,-COMB_W/2-80,-COMB_H/2-2,COMB_W,COMB_H),t.scale(1/.3,1/.3),t.beginPath(),t.moveTo(.18*W,-5),t.lineTo(.18*W+10,5),t.stroke(),t.beginPath(),t.moveTo(.18*W+10,-5),t.lineTo(.18*W,5),t.stroke(),t.fillText(this.p.n,.24*W,9)):(t.scale(.3,.3),t.drawImage(spriteImg,0,560,PERF_W,PERF_H,-PERF_W/2,-PERF_H/2,PERF_W,PERF_H),t.scale(1/.3,1/.3)):t.fillText(this.p.t,0,17),this.endRender(t)}}HOOK_SW=120,glyphsImg=document.getElementById("sprite");class Hook extends Entity{constructor(t={}){super(t||{s:"hidden"})}render(t,e,s){this.beginRender(t),this.p.fx&&this.p.fx<1&&(t.strokeStyle="#fff",t.lineWidth=4*HOOK_RADIUS*(1-this.p.fx),t.beginPath(),t.arc(0,0,4*HOOK_RADIUS*this.p.fx,0,PI2),t.stroke()),this.p.special&&t.rotate(s/200),t.beginPath(),this.p.bad?(t.scale(.2,.2),t.drawImage(spriteImg,1020,430,HOOK_SW,HOOK_SW,-HOOK_SW/2,-HOOK_SW/2,HOOK_SW,HOOK_SW),t.scale(4,4)):this.p.special?(t.scale(.25,.25),t.drawImage(spriteImg,900,430,HOOK_SW,HOOK_SW,-HOOK_SW/2,-HOOK_SW/2,HOOK_SW,HOOK_SW),t.scale(4,4)):(t.fillStyle=COLOR_PURPLE,t.arc(0,0,HOOK_RADIUS,0,PI2),t.fill()),this.p.bad&&t.rotate(-s/200),this.endRender(t)}states(){return{hidden:{s:0,fx:0},visible:{s:1,fx:0},used:{s:1,fx:1},small:{s:.25}}}animations(){return{"hidden→visible":{_d:500,_e:"out"},"visible→used":{_d:500,_e:"out"}}}}var centerP=null;class Cable extends Entity{constructor(){super({s:"normal"}),this.p.p0={x:-.4,y:0},this.p.p1={x:.4,y:-.5},centerP||(centerP=PHYS.makeParticle(0,0,0,0)).makeFixed(),this.setupPhysics()}setupPhysics(){this.p.p0,this.p.p1;var t=null;this.points=Array(6).fill().map((e,s)=>{var i=PHYS.makeParticle(1.5,0,0,0);return s>0&&PHYS.makeSpring(t,i,SPRING_STRENGTH,SPRING_DAMPING,0),t=i,i}),first(this.points).makeFixed(),this.target=PHYS.makeParticle(1.5,0,0,0),PHYS.makeSpring(last(this.points),this.target,10*SPRING_STRENGTH,3,0),this.target.makeFixed()}reset(t){t||(t={x:0,y:1}),this.p.p0={x:t.x,y:t.y},this.p.p1={x:t.x,y:t.y},[this.target].concat(this.points).forEach(e=>{e.reset(),extend(e.pos,t)})}updatePhysics(){extend(first(this.points).pos,this.p.p0),extend(this.target.pos,this.p.p1)}render(t,e,s){if(this.p.active){this.updatePhysics();var i=this.points.map(t=>t.pos);this.beginRender(t),t.beginPath(),t.strokeStyle=COLOR_PURPLE,t.lineWidth=CABLE_THICKNESS,t.lineCap="round",t.moveTo(i[0].x*W/2,i[0].y*W/2),i.forEach((e,s)=>{var a=i[s+1];if(s<i.length-2){var r=(e.x+a.x)/2,o=(e.y+a.y)/2;t.quadraticCurveTo(e.x*W/2,e.y*W/2,r*W/2,o*W/2)}else s===i.length-2&&t.quadraticCurveTo(e.x*W/2,e.y*W/2,a.x*W/2,a.y*W/2)}),t.stroke(),this.endRender(t)}}states(){return{normal:{o:1},out:{o:0}}}animations(){return{"normal→out":{_d:1e3,_e:"out"},"out→normal":{_d:8e3,_e:"out"}}}}RadialCache={},RADIAL_SMALL_R=.45,RADIAL_NB=7,RADIAL_DB=10,RADIAL_TB=32,RADIAL_NS=10,RADIAL_TS=RADIAL_SMALL_R/RADIAL_NS,RADIAL_DS=8;class Radial extends Entity{constructor(){super(),this.p.m=1,this.p.fx=0}states(){return{intro:{m:0,s:1},out:{m:1,s:2.1},normal:{m:.99,s:1}}}animations(){return{"intro→out":{_d:1500,_e:"in"}}}render(t,e,s){this.beginRender(t),this.p.m<1&&this.drawSmall(t,s),this.drawBig(t,s),this.p.fx&&this.drawFx(t),this.endRender(t)}drawFx(t){t.globalCompositeOperation="overlay",t.fillStyle="#DEC72D",t.beginPath(),t.rect(-1.3*W/2,.7*-H,1.2*W,1.4*H),t.arc(0,0,.52*W*ARENA_RADIUS,0,-PI2,!0),t.fill(),t.globalCompositeOperation="source-over"}drawSmall(t,e){var s=RADIAL_NS+2;times(RADIAL_NS,i=>{this.renderCircle(t,this.p.m*i*.4+e/1e4+.1*i+.1*i*e/4e3,W*RADIAL_TS*i,W*RADIAL_TS+2,RADIAL_DS,"#1A1A1A","#818181",!0,modulate(this.p.m,0,1,i/s,(i+1)/s))}),times(1,e=>{e+=RADIAL_NS,this.renderCircle(t,this.p.m>0?2.5*this.p.m:0,+W*RADIAL_SMALL_R-9,RADIAL_TB+2,RADIAL_DB,COLOR_LIGHTGRAY,"#838488",!0,modulate(this.p.m,0,1,e/s,(e+1)/s))})}drawBig(t,e){if(!RadialCache.big){var s=document.createElement("canvas");let t=s.getContext("2d");extend(t.canvas,{width:1.2*W,height:1.2*H}),t.translate(1.2*W/2,1.2*H/2),times(RADIAL_NB-1,s=>{s++,this.renderCircle(t,.2*s+.1*(s+1)*e/5e3,+W*RADIAL_SMALL_R+RADIAL_TB*s-9,RADIAL_TB+2,RADIAL_DB,COLOR_LIGHTGRAY,"#838488")}),RadialCache.big=s}t.drawImage(RadialCache.big,-1.2*W/2,-1.2*H/2)}renderCircle(t,e,s,i,a,r,o,n,l=0){const c=[s,i,a].map(round).join("-");if(l>=1)return;let h=RadialCache[c];if(!n||!h){h=document.createElement("canvas");let l=n?h.getContext("2d"):t;n&&(extend(l.canvas,{width:2*(s+i),height:2*(s+i)}),l.translate(s+i,s+i)),times(a,t=>{this.renderArc(l,s,i+2,(n?0:e)+t*PI2/a,.01+PI2/a,r,o)}),RadialCache[c]=h={cached:h,s:2*(s+i)}}n&&(l>.5&&(t.globalCompositeOperation="xor"),t.rotate(e),t.drawImage(h.cached,-h.s/2,-h.s/2,h.s,h.s),t.rotate(-e),t.globalCompositeOperation="source-over")}renderArc(t,e,s,i,a,r,o){t.strokeStyle=this.createGradient(t,e,i,a,r,o),t.lineWidth=s,t.beginPath(),t.arc(0,0,e,i,i+a),t.stroke()}createGradient(t,e,s,i,a,r){var o=e*cos(s),n=e*cos(s+i),l=e*sin(s),c=e*sin(s+i),h=t.createLinearGradient(o,l,n,c);return h.addColorStop(0,a),h.addColorStop(.4,a),h.addColorStop(1,r),h}}class TutorialCables extends Entity{render(t,e,s){this.beginRender(t),t.strokeStyle=COLOR_PURPLE,t.lineWidth=CABLE_THICKNESS,t.beginPath(),t.arc(unitsToPx(-.15),0,unitsToPx(.15),.2*PI,.8*PI,!1),t.stroke(),t.beginPath(),t.arc(unitsToPx(.15),0,unitsToPx(.15),.2*PI,.8*PI,!1),t.stroke(),this.endRender(t)}}var vA=new Vector,vB=new Vector,vC=new Vector;function createHook(t){return lastHookId++,extend({id:lastHookId,batchId:lastBatchId,a:nToA(rand()),x:0,y:0,r:modulate(rand(),.2,.7),currentR:0,active:!0,connected:!1,missed:!1,startAt:0,d:1e3+200*rand(),state:"hidden",bad:!!badHooks.find(t=>t===lastHookId)&&!t.special,special:!1,eased:!0},t)}function resetHooks(){HOOKS=[],lastHookId=0,lastBatchId=0,lastComboHookId=0,badHooks=range(round(HOOKS_AMOUNT/BAD_HOOKS_FRQ)).map(t=>round(t*BAD_HOOKS_FRQ+rand()*BAD_HOOKS_FRQ/3)),badHooks.shift(),specialHookAt=modulate(rand(),.3*GAME_DURATION,.7*GAME_DURATION),E.hooks.p=HOOKS}function addHooksBatch(){lastBatchId++;var e=createHooksBatch[keys(createHooksBatch)[round(rand()*(keys(createHooksBatch).length-2))]](t+500);HOOKS=HOOKS.concat(e)}function addSpecialHooksBatch(){lastBatchId++;var e=createHooksBatch.special(t+500);HOOKS=HOOKS.concat(e)}function getVisibleHooks(){return HOOKS.filter(t=>t.currentR<ARENA_RADIUS+.1)}function resetCables(t){activeCableI=0,CABLES=Array(100).fill().map((t,e)=>({p0:{x:0,y:2},p1:{x:0,y:2},active:!1,id0:null,id1:null,state:"normal"})),E.cables.entities.forEach(t=>t.reset()),E.cables.p=CABLES,E.cables.render(t,0,0)}function updateLogic(e){t=e-startT;const s=t>GAME_DURATION+COUNTDOWN_DURATION;if(COUNTDOWN=modulate(t,4,1,0,COUNTDOWN_DURATION),t>GAME_DURATION+COUNTDOWN_DURATION+2e3)return G.setState("gameover");if(0===getVisibleHooks().length){!HOOKS.filter(t=>t.batchId===lastBatchId&&!t.bad&&!t.special).filter(t=>!t.connected).length&&t>COUNTDOWN_DURATION+1e3&&(extend(LOG,{t:"P",startAt:t}),last(statePerfects)!==lastBatchId&&statePerfects.push(lastBatchId)),CABLES.filter(t=>t.batchId===lastBatchId).forEach(t=>{t.state="out"}),t>COUNTDOWN_DURATION&&t<GAME_DURATION+COUNTDOWN_DURATION&&(nextBatchIsSpecial?(addSpecialHooksBatch(),nextBatchIsSpecial=!1):addHooksBatch())}specialHookAt<t&&(HOOKS.push(createHook({special:!0,startAt:t,eased:!1,d:SPECIAL_HOOK_DURATION})),specialHookAt=1/0);var i=CABLES[activeCableI];i.active&&(T[0]?E.cables.p[activeCableI].p1=T[0]:E.cables.p[activeCableI].p1=E.cables.p[activeCableI].p0),HOOKS.forEach(e=>{var s=modulate(t,0,1,e.startAt,e.startAt+e.d),i=null;if(e.connected){if(e.connected&&e.comboAt){s=modulate(t,0,1,e.comboAt+100,e.comboAt+e.d+100),i=e.currentR=e.hitR+2*easeOut(clamp(s))}}else s<0?e.active=!1:e.eased?s<=1?(extend(e,{active:!0,state:"visible"}),i=e.currentR=e.r*easeOut(clamp(s))):s>HOOKS_PAUSE&&(s-=HOOKS_PAUSE,i=e.currentR=e.r+easeOut(clamp(s))):(extend(e,{active:!0,state:"visible"}),i=e.currentR=2*easeOut(clamp(s)));null!==i&&(e.x=i*sin(e.a),e.y=i*cos(e.a))}),CABLES.forEach(t=>{if(t.id0){var{x:e,y:s}=HOOKS.find(e=>e.id===t.id0);extend(t,{p0:{x:e,y:s}})}if(t.id1){var{x:e,y:s}=HOOKS.find(e=>e.id===t.id1);extend(t,{p1:{x:e,y:s}})}});var a=lastBadTapAt+KNOCKOUT_DURATION>=t,r=t-lastIntersect;if(!a&&!s){if(T[0]){var o=vA.set(T[0]).distanceTo(vB.set(0,0,0));if(o>.25&&o<ARENA_RADIUS)var n=HOOKS.map((t,e)=>({i:e,d:t.active&&"visible"===t.state&&!t.connected?vA.set(t.x,t.y,0).distanceSquaredTo(vB.set(T[0])):1/0})).sort((t,e)=>t.d-e.d)}if(n&&n[0]){var l=n[0].d,c=HOOKS[n[0].i];if(l<.05&&"used"!==c.state&&"hidden"!==c.state)if(c.bad)extend(c,{connected:t,state:"hidden",hitR:c.currentR,currentR:3}),a=!0,lastBadTapAt=t,stateBads++,lastIntersect=-1e4,i.active=!1;else{var h={x:c.x,y:c.y,z:0};extend(c,{connected:t,state:"used",hitR:c.currentR}),stateConnected++,currentCombo.push(c),r<COMBO_DELTA&&(extend(i,{p1:h,id1:c.id,batchId:lastBatchId}),activeCableI++),i=CABLES[activeCableI],extend(i,{active:!0,p0:h,p1:h,id0:c.id}),E.cables.entities[activeCableI].reset(h),lastIntersect=t,c.special&&(nextBatchIsSpecial=!0)}}}(r=t-lastIntersect)>COMBO_DELTA&&onComboDone(t,a),T[0]||(onComboDone(t,a),lastIntersect=-1e4,i.active=!1),T[0]?(POINTER.state="visible",extend(POINTER,T[0])):POINTER.state="hidden"}function onComboDone(t,e){currentCombo.length&&lastComboHookId!==last(currentCombo).id&&(currentCombo.length>1&&!e&&extend(LOG,{t:"COMBO",n:currentCombo.length,startAt:t}),CABLES[activeCableI].active=!1,lastComboHookId=last(currentCombo).id,currentCombo.forEach(e=>e.comboAt=t),stateCombos.push(currentCombo.length-1),currentCombo=[])}function getPoints(){var t=stateConnected+stateCombos.reduce((t,e)=>t+e*e,0);return t-=stateBads*POINTS_BAD,t+=statePerfects.length*POINTS_PERF,clamp(t,0,1/0)}HOOKS=[],CABLES=[],COUNTDOWN=0,POINTER={x:0,y:0,state:"hidden"},LOG={text:"",startAt:0},t=GAME_DURATION,stateConnected=0,stateCombos=[],stateBads=0,statePerfects=[],stateHighscore=0,startT=null,lastIntersect=null,lastBadTapAt=-1e3,nextBatchIsSpecial=!1,lastHookId=0,badHooksAt=[],specialHookAt=0,currentCombo=[],lastComboHookId=null,createHooksBatch={arc:t=>{var e=floor(modulate(rand(),3,6)),s=modulate(rand(),.4,.7),i=nToA(rand());return mapN(e,e=>createHook({a:i+e*PI*4/GUIDES_AMOUNT,r:s,startAt:t}))},polygon:t=>{var e=rand()<.5?3:6,s=nToA(rand()),i=modulate(rand(),.3,.7);return mapN(e,a=>createHook({a:s+a*PI2/e,r:i,startAt:t}))},weird:t=>{var e=nToA(rand());return mapN(3,s=>createHook({a:e+s*PI2/3,r:.4,startAt:t})).concat(mapN(3,s=>createHook({a:PI2/GUIDES_AMOUNT+e+s*PI2*2/GUIDES_AMOUNT,r:.7,startAt:t})))},weirdStar:t=>{var e=nToA(rand());return mapN(3,s=>createHook({a:e+s*PI2/3,r:.4,startAt:t})).concat(mapN(3,s=>createHook({a:PI2/GUIDES_AMOUNT+e+s*PI2/3,r:.7,startAt:t})))},triangle:t=>{var e=nToA(rand());return mapN(3,s=>createHook({a:e+s*PI2/3,r:.4,startAt:t})).concat(mapN(3,s=>createHook({a:3*PI2/GUIDES_AMOUNT+e+s*PI2/3,r:.7,startAt:t})))},star:t=>{var e=nToA(rand());return mapN(6,s=>createHook({a:e+s*PI2/6,r:.4,startAt:t})).concat(mapN(6,s=>createHook({a:2*PI2/GUIDES_AMOUNT+e+s*PI2/6,r:.7,startAt:t})))},doubleArc:t=>{var e=nToA(rand());return mapN(3,s=>createHook({a:e+s*PI2*2/GUIDES_AMOUNT,r:.4,startAt:t})).concat(mapN(3,s=>createHook({a:PI+e+s*PI2*2/GUIDES_AMOUNT,r:.7,startAt:t})))},special:t=>{var e=nToA(rand()),s=GUIDES_AMOUNT;return range(s).map(i=>createHook({a:e+i*PI2/s,startAt:t+20*i,d:8e3,eased:!1,bad:!1}))}},activeCableI=0,StartState={enter:()=>{setAllE([[E.startBtn,{y:0}]]),E.radial.setStateI("out"),E.radial.setState("intro"),E.startBtn.setStateI("hidden"),E.startBtn.setState("normal")},loop:(t,e,s)=>{(E.bg.render(t,s,e),E.radial.render(t,s,e),E.title.render(t,s,e),E.startBtn.render(t,s,e),goReleasedT=!T[0]||goReleasedT,goReleasedT&&T[0])&&(unitsToPx(vA.set(T[0]).distanceTo(vB.set(E.startBtn.p)))<40&&G.setState("intro"))}},IntroState={enter:()=>{goReleasedT=!1,tlE([[0,E.introText,{v:0}],[0,E.introText2,{v:0}],[0,E.continueBtn,{v:0}],[0,E.radial,{_s:"out"}],[50,E.startBtn,{_s:"hidden"}],[850,E.introText,{v:1}],[800,E.introText2,{v:1}],[850,E.continueBtn,{v:1}],[1100,E.title,{c:1}]])},loop:(t,e,s)=>{(E.bg.render(t,s,e),E.introText.render(t),E.introText2.render(t),E.continueBtn.render(t,s,e),E.radial.render(t,s,e),E.startBtn.render(t,s,e),E.title.render(t,s,e),goReleasedT=!T[0]||goReleasedT,goReleasedT&&T[0])&&(unitsToPx(vA.set(T[0]).distanceTo(vB.set(E.continueBtn.p)))<100&&G.setState("tutorial"))}},TutorialState={enter:()=>{goReleasedT=!1,setAllE([[E.tutorialText1,{v:0}],[E.tutorialText2,{v:0}],[E.tutorialText3,{v:0}],[E.tutorialHook1,{v:0}],[E.tutorialHook2,{v:0}],[E.tutorialHook3,{v:0}],[E.tutorialCables,{v:0}],[E.tutorialBad1,{v:0}],[E.tutorialBad2,{v:0}],[E.tutorialSpecial,{v:0}],[E.continueBtn,{v:0}]]),tlE([[0,E.radial,{_s:"out"}],[0,E.startBtn,{_s:"hidden"}],[0,E.introText,{v:1}],[0,E.introText2,{v:1}],[0,E.title,{c:1}],[400,E.tutorialText1,{v:1}],[500,E.tutorialHook1,{v:1}],[500,E.tutorialHook2,{v:1}],[500,E.tutorialHook3,{v:1}],[500,E.tutorialCables,{v:1}],[600,E.tutorialText2,{v:1}],[700,E.tutorialBad1,{v:1}],[700,E.tutorialBad2,{v:1}],[800,E.tutorialText3,{v:1}],[900,E.tutorialSpecial,{v:1}],[1e3,E.continueBtn,{v:1}]])},loop:(t,e,s)=>{(E.bg.render(t,s,e),E.tutorialText1.render(t),E.tutorialText2.render(t),E.tutorialText3.render(t),E.tutorialHook1.render(t,s,e),E.tutorialHook2.render(t,s,e),E.tutorialHook3.render(t,s,e),E.tutorialCables.render(t,s,e),E.tutorialBad1.render(t,s,e),E.tutorialBad2.render(t,s,e),E.tutorialSpecial.render(t,s,e),E.continueBtn.render(t,s,e),E.radial.render(t,s,e),E.title.render(t,s,e),goReleasedT=!T[0]||goReleasedT,goReleasedT&&T[0])&&(unitsToPx(vA.set(T[0]).distanceTo(vB.set(E.continueBtn.p)))<100&&G.setState("game"))}},GameState={enter:t=>{startT=performance.now(),LOG={text:"",startAt:-1e3},stateConnected=0,stateCombos=[],stateBads=0,statePerfects=[],lastBadTapAt=-1e4,nextBatchIsSpecial=!1,lastBatchId=0,resetHooks(t),resetCables(t),tlE([[0,E.bg,{_s:"normal"}],[0,E.radial,{_s:"normal"}],[0,E.pointsCounter,{_s:"normal",c:0,n:0}],[50,E.startBtn,{_s:"hidden"}],[850,E.introText,{v:0}],[800,E.introText2,{v:0}]])},loop:(e,s,i)=>{updateLogic(s),PHYS.tick();const a=easeIn(clamp(modulate(t,1,0,lastBadTapAt,lastBadTapAt+1e3)));CAMERA_OFF_X=15*a*(1+cos(.2*floor(s/3)))*sin(.842*floor(s/3)),CAMERA_OFF_Y=15*a*(1+sin(.2*floor(s/3)))*cos(.123*floor(s/3)),E.bg.render(e,i,s),setAllE([[E.radial,{fx:floor(8*a)%2==1?1:0}],[E.alert,{v:LOG.startAt+500>t,t:LOG.t,n:LOG.n}],[E.bigE,{v:E.radial.p.fx}],[E.countDownCounter,{s:1,v:COUNTDOWN>1,n:COUNTDOWN}],[E.timer,{p:clamp((GAME_DURATION+COUNTDOWN_DURATION-t)/GAME_DURATION)}]]),E.cables.p=CABLES.filter(t=>t.active),E.cables.render(e,i,s),E.hooks.p=HOOKS.filter(t=>t.active),E.hooks.render(e,i,s),E.radial.render(e,i,s),E.alert.render(e,i,s),E.bigE.render(e,i,s),G.points=getPoints(),E.pointsCounter.setNumber(getPoints()),E.pointsCounter.render(e),E.countDownCounter.render(e),E.timer.render(e,i,s)}},goReleasedT=!1,GameoverState={enter:()=>{goReleasedT=!1,stateHighscore=max(clamp(G.points,0,1/0),stateHighscore),CABLES.forEach(t=>t.state="normal"),E.bg.setState("full"),extend(E.pointsCounter.p,{n:clamp(G.points,0,1/0),c:1}),E.hooks.entities.forEach(t=>{})},loop:(t,e,s)=>{(E.bg.render(t,s,e),HOOKS.forEach(t=>{t.bad&&(t.active=!1),t.connected||(t.active=!1);const e=.1+t.id/HOOKS.length*.6,i=t.currentR-=(t.currentR-e)*s/500;extend(t,{x:1*i*sin(t.a),y:i*cos(t.a),s:.6})}),CABLES.forEach(t=>{if(t.id0){var{x:e,y:s}=HOOKS.find(e=>e.id===t.id0);extend(t,{p0:{x:e,y:s}})}if(t.id1){var{x:e,y:s}=HOOKS.find(e=>e.id===t.id1);extend(t,{p1:{x:e,y:s}})}}),PHYS.tick(),E.cables.p=CABLES.filter(t=>t.active),E.cables.render(t,s,e),E.hooks.p=HOOKS.filter(t=>t.active),E.hooks.render(t,s,e),E.pointsCounter.render(t,s,e),extend(E.highscore.p,{t:"HIGHSCORE: "+stateHighscore}),E.highscore.render(t,s,e),E.continueBtn.render(t,s,e),goReleasedT=!T[0]||goReleasedT,goReleasedT&&T[0])&&(unitsToPx(vA.set(T[0]).distanceTo(vB.set(E.continueBtn.p)))<40&&G.setState("game"))}},TICKER=new Ticker,PHYS=new ParticleSystem(PHYS_GRAVITY,PHYS_DRAG),E={},G=new Game({canvas:"game",setup:()=>{E.bg=new Bg,E.title=new Sprite,E.title.p.id="title",extend(E.title.p,{y:-1.1,x:0,s:.28}),E.startBtn=new Btn,E.continueBtn=new BtnOutline,extend(E.continueBtn.p,{y:.8}),E.introText=new TextBox,extend(E.introText.p,{y:-.6,t:INTRO_TEXT_1}),E.introText2=new TextBox,extend(E.introText2.p,{y:-.1,t:INTRO_TEXT_2}),E.tutorialText1=new TextBox,extend(E.tutorialText1.p,{y:-.7,t:TUTORIAL_TEXT_1}),E.tutorialText2=new TextBox,extend(E.tutorialText2.p,{y:-.2,t:TUTORIAL_TEXT_2}),E.tutorialText3=new TextBox,extend(E.tutorialText3.p,{y:.25,t:TUTORIAL_TEXT_3}),E.tutorialHook1=new Hook({s:"visible"}),extend(E.tutorialHook1.p,{y:-.55,x:-.3}),E.tutorialHook2=new Hook({s:"visible"}),extend(E.tutorialHook2.p,{y:-.55,x:0}),E.tutorialHook3=new Hook({s:"visible"}),extend(E.tutorialHook3.p,{y:-.55,x:.3}),E.tutorialCables=new TutorialCables,E.tutorialCables.p.y=-.6,E.tutorialBad1=new Hook({s:"visible"}),extend(E.tutorialBad1.p,{bad:!0,y:-.05,x:-.15}),E.tutorialBad2=new Hook({s:"visible"}),extend(E.tutorialBad2.p,{bad:!0,y:-.05,x:.15}),E.tutorialSpecial=new Hook({s:"visible"}),extend(E.tutorialSpecial.p,{special:!0,y:.4}),E.alert=new Alert,E.bigE=new Sprite,E.bigE.p.id="bigE",E.pointsCounter=new Counter,extend(E.pointsCounter.p,{x:0,y:-1.2,s:.55}),E.countDownCounter=new Counter,extend(E.countDownCounter.p,{y:-.05,c:1}),E.timer=new Timer,extend(E.timer.p,{y:-1.45}),E.hooks=new Pool(Hook,HOOKS_AMOUNT),E.cables=new Pool(Cable,HOOKS_AMOUNT),E.radial=new Radial,E.highscore=new TextBox,extend(E.highscore.p,{y:-.85})},states:{start:StartState,intro:IntroState,tutorial:TutorialState,game:GameState,gameover:GameoverState}}),G.setState("start"),G.start();