<meta content="width=device-width" name=viewport><title>💀 Enchanted Dungeon</title><body style=margin:0;padding:0;overflow:hidden;background-color:0><canvas height=480 id=g width=640></canvas><script>let e=new Array(35).fill(3);e[0]=e[1]=e[2]=e[4]=4,e[3]=5;let t=(e,t,r,a,i,n=!0,l=0)=>{let o=document.createElement("canvas"),u=document.createElement("canvas"),h=a*i;o.width=o.height=a;let s,c,d,v=o.getContext("2d"),x=a,m=a,g=0,f=0;v.drawImage(e,t,r,a,a,0,0,a,a);let y=v.getImageData(0,0,a,a),$=y.data;for(c=0;c<a;c++)for(s=0;s<a;s++)d=4*(s+c*a),0==$[d]?$[d+3]=0:(s<x&&(x=s),c<m&&(m=c),s>g&&(g=s),c>f&&(f=c));return v.putImageData(y,0,0),n?(u.width=(g-x+1)*i+2*l,u.height=(f-m+1)*i+2*l):u.width=u.height=h,v=u.getContext("2d"),v.imageSmoothingEnabled=!1,n?v.drawImage(o,l-x*i,l-m*i,h,h):v.drawImage(o,0,0,h,h),u},r=e=>{let t=document.createElement("canvas");t.style.cssText="display:block;margin:0 auto;height:100%;",t.width=e.clientWidth,t.height=e.clientHeight;let r=t.getContext("webgl"),a=r.FRAMEBUFFER,i=r.getUniformLocation.bind(r),n=e.getContext("2d");e.parentNode.insertBefore(t,e),e.style.opacity="0";let l=(...e)=>{for(let t=0;t<e.length;++t){let i=e[t];switch(i){case a:r.bindFramebuffer(i,null);break;case r.TEXTURE_2D:r.bindTexture(i,null);break;case r.ARRAY_BUFFER:r.bindBuffer(i,null);break;default:r.activeTexture(i),r.bindTexture(r.TEXTURE_2D,null)}}},o=(e,t)=>{let a=r.createShader(t);if(r.shaderSource(a,e),r.compileShader(a),!r.getShaderParameter(a,r.COMPILE_STATUS))throw"could not compile shader:"+r.getShaderInfoLog(a);return a},u=o("#define GLSLIFY 1\nattribute vec4 pos;varying vec2 uv;void main(){gl_Position=vec4(pos.xy,0,1);uv=pos.zw;}",r.VERTEX_SHADER),h=o("precision mediump float;\n#define GLSLIFY 1\nvarying vec2 uv;uniform vec2 resolution;uniform float time;uniform sampler2D backbuffer;uniform sampler2D blurbuffer;vec3 tsample(sampler2D samp,vec2 tc){vec3 s=pow(abs(texture2D(samp,vec2(tc.x,1.0-tc.y)).rgb),vec3(2.2));return s*vec3(1.25);}vec3 filmic(vec3 lcol){vec3 x=max(vec3(0),lcol-vec3(0.004));return(x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06);}vec2 curve(vec2 uv){uv=(uv-0.5)*2.0;uv*=vec2(1.049,1.042);uv-=vec2(-0.008,0.008);uv.x*=1.0+pow(abs(uv.y)/5.0,2.0);uv.y*=1.0+pow(abs(uv.x)/4.0,2.0);uv=uv*0.5+0.5;return uv;}highp float rand(vec2 co){highp float a=12.9898;highp float b=78.233;highp float c=43758.5453;highp float dt=dot(co.xy,vec2(a,b));highp float sn=mod(dt,3.14);return fract(sin(sn)*c);}void main(){vec2 curved_uv=mix(curve(uv),uv,0.4);\n#if 0\nfloat scale=0.04;vec2 scuv=curved_uv*(1.0-scale)+scale*0.5+vec2(0.003,-0.001);\n#else\nvec2 scuv=curved_uv;\n#endif\nvec3 col;float x=sin(0.1*time+curved_uv.y*13.0)*sin(0.23*time+curved_uv.y*19.0)*sin(0.3+0.11*time+curved_uv.y*23.0)*0.0012;float o=sin(gl_FragCoord.y/1.5)/resolution.x;x+=o*0.25;x*=0.2;col.r=tsample(backbuffer,vec2(x+scuv.x+0.0009,scuv.y+0.0009)).x+0.02;col.g=tsample(backbuffer,vec2(x+scuv.x+0.0000,scuv.y-0.0011)).y+0.02;col.b=tsample(backbuffer,vec2(x+scuv.x-0.0015,scuv.y+0.0000)).z+0.02;float i=clamp(col.r*0.299+col.g*0.587+col.b*0.114,0.0,1.0);i=pow(1.0-pow(i,2.0),1.0);i=(1.0-i)*0.85+0.15;float ghs=0.15;vec3 r=tsample(blurbuffer,vec2(x-0.014*1.0,-0.027)*0.85+0.007*vec2(0.35*sin(1.0/7.0+15.0*curved_uv.y+0.9*time),0.35*sin(2.0/7.0+10.0*curved_uv.y+1.37*time))+vec2(scuv.x+0.001,scuv.y+0.001)).xyz*vec3(0.5,0.25,0.25);vec3 g=tsample(blurbuffer,vec2(x-0.019*1.0,-0.020)*0.85+0.007*vec2(0.35*cos(1.0/9.0+15.0*curved_uv.y+0.5*time),0.35*sin(2.0/9.0+10.0*curved_uv.y+1.50*time))+vec2(scuv.x+0.000,scuv.y-0.002)).xyz*vec3(0.25,0.5,0.25);vec3 b=tsample(blurbuffer,vec2(x-0.017*1.0,-0.003)*0.85+0.007*vec2(0.35*sin(2.0/3.0+15.0*curved_uv.y+0.7*time),0.35*cos(2.0/3.0+10.0*curved_uv.y+1.63*time))+vec2(scuv.x-0.002,scuv.y+0.000)).xyz*vec3(0.25,0.25,0.5);vec3 ghost=vec3(0.0);ghost+=vec3(ghs*(1.0-0.299))*pow(clamp(vec3(3.0)*r,vec3(0.0),vec3(1.0)),vec3(2.0))*vec3(i);ghost+=vec3(ghs*(1.0-0.587))*pow(clamp(vec3(3.0)*g,vec3(0.0),vec3(1.0)),vec3(2.0))*vec3(i);ghost+=vec3(ghs*(1.0-0.114))*pow(clamp(vec3(3.0)*b,vec3(0.0),vec3(1.0)),vec3(2.0))*vec3(i);col+=ghost;col*=vec3(0.95,1.05,0.95);col=clamp(1.3*col+0.75*col*col+1.25*col*col*col*col*col,vec3(0.0),vec3(10.0));float vig=0.1+16.0*curved_uv.x*curved_uv.y*(1.0-curved_uv.x)*(1.0-curved_uv.y);\n#if 0\nvig=1.3*pow(vig,0.5);\n#else\nvig=1.5*pow(vig,0.25);vig=(vig>1.0)?(1.0+smoothstep(1.0,1.5,vig)*0.2): vig;\n#endif\ncol*=vig;float scans=clamp(0.35+0.18*sin(6.0*time+curved_uv.y*resolution.y*1.5),0.0,1.0);float s=pow(scans,0.9);col*=s;col*=1.0-0.23*clamp((mod(gl_FragCoord.xy.x,3.0))*0.5,0.0,1.0);col=filmic(col);vec2 seed=curved_uv*resolution.xy;vec3 noise=pow(vec3(rand(seed+time),rand(seed+time*2.0),rand(seed+time*3.0)),vec3(1.5));col-=0.015*noise;col*=(1.0-0.004*(sin(50.0*time+curved_uv.y*2.0)*0.5+0.5));if(curved_uv.x<0.0||curved_uv.x>1.0)col*=0.0;if(curved_uv.y<0.0||curved_uv.y>1.0)col*=0.0;col*=vec3(1.1);gl_FragColor=vec4(col,1.0);}",r.FRAGMENT_SHADER),s=o("precision mediump float;\n#define GLSLIFY 1\nvarying vec2 uv;uniform vec2 blur;uniform sampler2D texture;void main(){vec4 sum=texture2D(texture,uv)*0.2270270270;sum+=texture2D(texture,vec2(uv.x-4.0*blur.x,uv.y-4.0*blur.y))*0.0162162162;sum+=texture2D(texture,vec2(uv.x-3.0*blur.x,uv.y-3.0*blur.y))*0.0540540541;sum+=texture2D(texture,vec2(uv.x-2.0*blur.x,uv.y-2.0*blur.y))*0.1216216216;sum+=texture2D(texture,vec2(uv.x-1.0*blur.x,uv.y-1.0*blur.y))*0.1945945946;sum+=texture2D(texture,vec2(uv.x+1.0*blur.x,uv.y+1.0*blur.y))*0.1945945946;sum+=texture2D(texture,vec2(uv.x+2.0*blur.x,uv.y+2.0*blur.y))*0.1216216216;sum+=texture2D(texture,vec2(uv.x+3.0*blur.x,uv.y+3.0*blur.y))*0.0540540541;sum+=texture2D(texture,vec2(uv.x+4.0*blur.x,uv.y+4.0*blur.y))*0.0162162162;gl_FragColor=sum;}",r.FRAGMENT_SHADER),c=o("precision mediump float;\n#define GLSLIFY 1\nvarying vec2 uv;uniform sampler2D tex0;uniform sampler2D tex1;uniform float modulate;void main(){vec4 a=texture2D(tex0,uv)*vec4(modulate);vec4 b=texture2D(tex1,uv);gl_FragColor=max(a,b*0.96);}",r.FRAGMENT_SHADER),d=o("precision mediump float;\n#define GLSLIFY 1\nvarying vec2 uv;uniform sampler2D tex0;uniform sampler2D tex1;uniform float modulate;void main(){vec4 a=texture2D(tex0,uv)*vec4(modulate);vec4 b=texture2D(tex1,uv);gl_FragColor=max(a,b*0.32);}",r.FRAGMENT_SHADER),v=o("precision mediump float;\n#define GLSLIFY 1\nvarying vec2 uv;uniform sampler2D tex0;void main(){gl_FragColor=texture2D(tex0,uv);}",r.FRAGMENT_SHADER),x=(e,t,a)=>{let i=r.createProgram();if(r.attachShader(i,e),r.attachShader(i,t),r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS))throw"shader "+a+" failed to link:"+r.getProgramInfoLog(i);return i},m=x(u,h,"crt_program"),g=r.getAttribLocation(m,"pos"),f=i(m,"time"),y=i(m,"backbuffer"),$=i(m,"blurbuffer"),p=i(m,"resolution"),E=x(u,s,"blur_program"),T=r.getAttribLocation(E,"pos"),b=i(E,"blur"),w=i(E,"texture"),R=x(u,c,"accumulate_program"),_=r.getAttribLocation(R,"pos"),A=i(R,"tex0"),D=i(R,"tex1"),U=i(R,"modulate"),F=x(u,d,"blend_program"),M=r.getAttribLocation(F,"pos"),S=i(F,"tex0"),I=i(F,"tex1"),P=i(F,"modulate"),C=x(u,v,"copy_program"),X=r.getAttribLocation(C,"pos"),B=i(C,"tex0"),L=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,L),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),r.STATIC_DRAW),l(r.ARRAY_BUFFER);let k=e=>{r.bindBuffer(r.ARRAY_BUFFER,L),r.vertexAttribPointer(e,4,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e)},O=r.createTexture();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,O),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),l(r.TEXTURE_2D);let G=[];for(let e=0;e<4;++e){let e=r.createTexture(),t=r.createFramebuffer();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),l(r.TEXTURE_2D),G.push({tex:e,fbo:t})}let N=G[0],H=G[1],z=G[2],Y=G[3],J=(e,t,i,n)=>{r.bindFramebuffer(a,t),r.useProgram(E),k(T),r.uniform2f(b,i,n),r.uniform1i(w,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e),r.drawArrays(r.TRIANGLE_FAN,0,4),l(r.TEXTURE_2D,r.ARRAY_BUFFER,a)},j=(e,t,r,a,i,n)=>{J(e,r.fbo,a/i,0),J(r.tex,t,0,a/n)},K=-1,q=-1;return i=>{n.resetTransform(),n.clearRect(-1,-1,1,1);let o=Math.ceil(Math.max(e.clientWidth/e.width,e.clientHeight/e.height));o=Math.max(1,Math.min(4,o));let u=e.width*o,h=e.height*o,s=.001*i;if(K!=u||q!=h)for(let e=0;e<G.length;++e){let t=G[e].tex,i=G[e].fbo;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,u,h,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindFramebuffer(a,i),r.framebufferTexture2D(a,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),l(r.TEXTURE_2D,a)}var c,d;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,O),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),l(r.TEXTURE_2D),r.viewport(0,0,u,h),j(Y.tex,N.fbo,H,1,u,h),r.bindFramebuffer(a,z.fbo),r.useProgram(R),k(_),r.uniform1i(A,0),r.uniform1i(D,1),r.uniform1f(U,1),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,O),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,N.tex),r.drawArrays(r.TRIANGLE_FAN,0,4),l(r.TEXTURE0,r.TEXTURE1,r.ARRAY_BUFFER,a),c=z.tex,d=Y.fbo,r.bindFramebuffer(a,d),r.useProgram(C),k(X),r.uniform1i(B,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,c),r.drawArrays(r.TRIANGLE_FAN,0,4),l(r.TEXTURE_2D,r.ARRAY_BUFFER,a),r.bindFramebuffer(a,z.fbo),r.useProgram(F),k(M),r.uniform1i(S,0),r.uniform1i(I,1),r.uniform1f(P,1),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,O),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,Y.tex),r.drawArrays(r.TRIANGLE_FAN,0,4),l(r.TEXTURE0,r.TEXTURE1,r.ARRAY_BUFFER,a),j(z.tex,z.fbo,H,.17,u,h),j(z.tex,N.fbo,H,1,u,h);let v=t.width=e.clientWidth,x=t.height=e.clientHeight;r.viewport(0,0,v,x),r.bindFramebuffer(a,null),r.useProgram(m),k(g),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,z.tex),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,N.tex),r.uniform2f(p,v,x),r.uniform1f(f,1.5*s),r.uniform1i(y,0),r.uniform1i($,1),r.drawArrays(r.TRIANGLE_FAN,0,4),l(r.TEXTURE0,r.TEXTURE1,r.ARRAY_BUFFER,a),K=u,q=h}},a=(e,t)=>{let r=Object.assign({x:0,y:0,border:0,$B:0,$C:0,$w:0,alpha:1,$D:1,$E:1,$F(e){},$l:()=>r.$H?r.x+r.$H.$l():r.x,$m:()=>r.$H?r.y+r.$H.$m():r.y,$g:()=>r.width/2,$d:()=>r.height/2,$n:()=>r.x+r.$g(),$o:()=>r.y+r.$d()},e);return Object.assign(r,t)},i=e=>e*e*(3-2*e),n=e=>Math.sin(e*Math.PI/2),l=e=>1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),o=[],u=(e,t,r,a,i,n)=>{let l=0,u=()=>{if(l<e){let n=a(l/e);i(r*n+t*(1-n)),l+=1}else n&&n(),o.splice(o.indexOf(u),1)};o.push(u)},h=(e,t)=>e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y,s=!1,c=!1,d=!1;onkeydown=e=>{let t=e.keyCode;37==t&&(s=!0),39==t&&(c=!0),32==t&&(d=!0)},onkeyup=e=>{let t=e.keyCode;37==t&&(s=!1),39==t&&(c=!1),32==t&&(d=!1)};let v=(e,t)=>{let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let a=r.getContext("2d");return a.drawImage(e,0,0),a.fillStyle=t,a.globalCompositeOperation="source-in",a.fillRect(0,0,r.width,r.height),r},x=(e,t,r)=>{let i=e.width,n=e.height;r&&(e=v(e,r));let l=a(Object.assign(Object.assign({width:i,height:n},t),{$G(e){e.drawImage(l.image,0,0,i,n,-i*l.$B,-n*l.$C,i,n)}}),{image:e,$I:r,setImage(e,t){t&&(l.$I=t),i=e.width,n=e.height,l.image=l.$I?v(e,l.$I):e,l.width=i-2*l.border,l.height=n-2*l.border}});return l.width-=2*l.border,l.height-=2*l.border,l},m=(e,t,r,a=!1)=>{e=e.map((e=>v(e,t)));let i=0,n=0,l=a,o=e.length,u=x(e[0],Object.assign(Object.assign({},r),{$F(t){l&&(i++,i%4==0&&(n=(n+1)%o,u.image=e[n]))}}));return u.$I=t,Object.assign(u,{play(){l=!0},stop(t=0){l=!1,u.image=e[n=t]}})},f=((e=1)=>{let t=()=>e=16807*e%2147483647,r=()=>t()/2147483647;return{set seed(t){e=t},get seed(){return e},nextInt:()=>t(),nextDouble:r,nextBoolean:()=>t()%2==0,nextIntRange:(e,t)=>Math.round(e+(t-e)*r()),nextDoubleRange:(e,t)=>e+(t-e)*r()}})(),y=(e,t)=>{let r=a(Object.assign(Object.assign({},e),{$G(e){e.fillStyle=r.$I,e.fillRect(0,0,r.width,r.height)}}),{$I:null!=t?t:"0"});return r},p=[...Array(33),29,,,,,,12,,,,"ᇄ",3,"ႄ",1,1118480,"縿",31,"庽","嚿","炟","皷","纷","䈟","线","皿",17,,,"⥊",,"䊼",,"㹏","纮","縱","縮","纵","纐","񴚦","粟","䟱","丿",1020241,"簡",33059359,1024159,"縿","纜","񼙯","繍","皷","䏰","簿",25363672,32541759,18157905,"惸",18470705,,,,,"С"],E=(T=p,(e,t,r,a,i,n)=>[...t].reduce(((t,l)=>{let o=i/5,u=T[l.charCodeAt()]||"",h=((u>0?u:u.codePointAt())||0).toString(2),s=Math.ceil(h.length/5),c=t+o;return h.padStart(5*s,0).match(new RegExp(".{5}","g")).map(((t,i)=>[...t].map(((t,l)=>{e.fillStyle=+t?n:"transparent",e.fillRect(r+c+i*o,a+l*o,o,o)})))),t+(s+1)*o}),0)),$=(e,t,r,i="#fff")=>{let n=a(Object.assign(Object.assign({height:t},r),{$G(e){n.width=E(e,n.value,0,0,n.size,n.$I)}}),{value:e,size:t,$I:i});return n};var T;let b=e=>Object.assign({vx:0,vy:0,$K:0,$L:0},e),w=(e,...t)=>Object.assign(e,...t),R=(e,t)=>w(e,b(),t),_=(e=0)=>new Promise(((t,r)=>{setTimeout(t,e)})),A=(e,t)=>String(t).padStart(e,"0"),D=e=>e[Math.floor(Math.random()*e.length)],U=(e,t)=>Math.floor(f.nextDouble()*(t-e+1))+e,F=({$h:e,$f:t,roomNo:r,numChests:a=5})=>{let i,n=[],l=[],o=[],u=[],h=t*e,s=(t,r)=>t+r*e,c=(e,t)=>n[s(e,t)],d=(e,t,r)=>n[s(e.x+t,e.y+r)],v=(e,t)=>{let r=U(0,t.length-1),a=t[r],i=d(a,-1,0),n=d(a,1,0);return t.splice(r,1),i.$J||n.$J?v(e,t):(a.$J=e,a)},x=e=>e.$J&&(4==e.$J||5==e.$J),m=(e,t)=>{if(0==t.length)return;let r=U(0,t.length-1),a=t[r],i=d(a,-1,0),n=d(a,1,0);return t.splice(r,1),x(i)||x(n)?m(e,t):(a.$J=e,a)},g=0,y=[];if(0==r){for(i=0;i<h;i++){let t={x:i%e,y:Math.floor(i/e),$z:1,isEmpty(){return 1==this.$z}};n.push(t)}n.map((e=>{e.y==t-1&&(e.$z=2)}));let r=t-2;c(2,r).$J=0,c(4,r).$J=c(5,r).$J=c(6,r).$J=c(8,r).$J=1;let a=c(e-5,r-1);return a.$J=2,d(a,1,1).$z=d(a,0,1).$z=d(a,-1,1).$z=3,{map:n,$e:l}}for(i=0;i<h;i++){let t=0==U(0,3)?0:1,r={x:i%e,y:Math.floor(i/e),$z:t,isEmpty(){return 1==this.$z}};n.push(r)}for(n.map((r=>{let a=d(r,0,-1),i=d(r,0,-2);0==r.x||0==r.y||r.x==e-1||r.y==t-1?r.y==t-1?(r.$z=2,y.push(r)):r.$z=1:0==r.$z&&a&&1==a.$z&&(r.$z=3,i&&(0!=i.$z&&3!=i.$z||(i.$z=1)))})),y=y.filter((e=>{if(e.x>0&&e.x<y.length-1){let r,a,i=0;for(a=0;a<t-1;a++)r=n[s(e.x,a)],r.isEmpty()||i++;if(i<2)return!1}return!0}));y.length>3&&g<3;){i=U(1,y.length-2);let e=y[i],t=n[s(e.x,e.y-1)];e.$z=1,t.isEmpty()||(t.$z=1),y.splice(i-1,3),g++}n.map((e=>{if(e.y>1&&3==e.$z){let t=d(e,0,-1);l.push(t)}}));let $=[];for($.push(v(2,l)),i=0;i<a;i++)$.push(v(1,l));$.push(v(0,l)),$.push(v(3,l)),n.map((e=>{if(e.y>1&&(3==e.$z||2==e.$z)){let t=d(e,0,-1),r=d(t,-1,0),a=d(t,1,0),i=d(t,-1,1),n=d(t,1,1);$.indexOf(t)<0&&t.isEmpty()&&(r.isEmpty()&&!i.isEmpty()||a.isEmpty()&&!n.isEmpty())&&o.push(t)}}));let p=Math.floor(r/8)+1,E=Math.floor(r/8),T=Math.round(f.nextDouble()*p),b=Math.round(f.nextDouble()*E),w=0;for(;o.length>0&&w<T;)m(4,o),w++;for(n.map((e=>{if(e.isEmpty()){let t=d(e,-1,0),r=d(e,1,0),a=d(e,0,-1),i=d(e,0,1);(null==a||null==a?void 0:a.isEmpty())&&(null==i||null==i?void 0:i.isEmpty())&&(null==t||null==t?void 0:t.isEmpty())&&(null==r||null==r?void 0:r.isEmpty())&&u.push(e)}})),w=0;u.length>0&&w<b;)m(5,u),w++;return{map:n,$e:l}},M=(...e)=>I(P(...e)),I=(...e)=>{let t=C.createBufferSource(),r=C.createBuffer(e.length,e[0].length,S);return e.map(((e,t)=>r.getChannelData(t).set(e))),t.buffer=r,t.connect(C.destination),t.start(),t},P=(e=1,t=.05,r=220,a=0,i=0,n=.1,l=0,o=1,u=0,h=0,s=0,c=0,d=0,v=0,x=0,m=0,g=0,f=1,y=0,$=0)=>{let p,E,T=2*Math.PI,b=u*=500*T/S**2,w=(0<x?1:-1)*T/4,R=r*=(1+2*t*Math.random()-t)*T/S,_=[],A=0,D=0,U=0,F=1,M=0,I=0,P=0;for(h*=500*T/S**3,x*=T/S,s*=T/S,c*=S,d=S*d|0,E=(a=99+S*a)+(y*=S)+(i*=S)+(n*=S)+(g*=S)|0;U<E;_[U++]=P)++I%(100*m|0)||(P=l?1<l?2<l?3<l?Math.sin((A%T)**3):Math.max(Math.min(Math.tan(A),1),-1):1-(2*A/T%2+2)%2:1-4*Math.abs(Math.round(A/T)-A/T):Math.sin(A),P=(d?1-$+$*Math.sin(2*Math.PI*U/d):1)*(0<P?1:-1)*Math.abs(P)**o*e*X*(U<a?U/a:U<a+y?1-(U-a)/y*(1-f):U<a+y+i?f:U<E-g?(E-U-g)/n*f:0),P=g?P/2+(g>U?0:(U<E-g?1:(E-U)/g)*_[U-g|0]/2):P),p=(r+=u+=h)*Math.sin(D*x-w),A+=p-p*v*(1-1e9*(Math.sin(U)+1)%2),D+=p-p*v*(1-1e9*(Math.sin(U)**2+1)%2),F&&++F>c&&(r+=s,R+=s,F=0),!d||++M%d||(r=R,u=b,F=F||1);return _},X=.3,S=44100,C=new(window.AudioContext||webkitAudioContext),k=[[[.3,0,29,,.07,.2,3,6,,,,.2],[.1,0,230,,.01,.12,3,1.5,,.4,,5.32,.01,,,,,5,.01],[.3,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06],[.2,0,196,,,.74,,0,,.3,,,.29,,,,,.34,.14],[1.3,0,43,,,.25,,,,,,,,2],[.1,0,22,,.07,.07,4,0,,,.5,.01],[.1,0,22,.04,.08,,,0,,,,,,.7,,3,,,.17],[.1,0,2100,,,.2,3,0,,,-400,,,3.2,,,.15],[.1,0,245,.19,.09,1.19,1,0,,1.3,,,.08,,1.5,,.08,0,.17]],[[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,11,,,,6,,,,8,,,,11,,,,10,,,,6,,,,13,,,,10,,,,15,,,,13,,,,6,,,,8,,,,13,,,,11,,,,15,,,,11,,,,],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,6,,,,,,6,,18,,,,6,,,,,,6,,,,6,,18,,,,6,,,,4,,,,,,4,,16,,,,4,,,,,,6,,6,,,,18,,,,6,,,,],[1,,18,,,,13,,,,10,,,,13,,,,11,,,,13,,,,10,,,,13,,,,8,,,,10,,,,11,,,,13,,,,10,,,,,,,,13,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,11,,,,6,,,,8,,,,11,,,,10,,,,6,,,,13,,,,10,,,,15,,,,13,,,,6,,,,8,,,,13,,,,11,,,,15,,,,11,,,,],[2,,15,,14,,15,,14,,,,,,,,,,,,,,,,,,,,,,,,,,19,,17,,15,,10,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,6,,,,,,6,,18,,,,6,,,,,,6,,,,6,,18,,,,6,,,,4,,,,,,4,,16,,,,4,,,,,,6,,6,,,,18,,,,6,,,,],[1,,18,,,,13,,,,10,,,,13,,,,11,,,,13,,,,10,,,,13,,,,8,,,,10,,,,11,,,,13,,,,10,,,,,,,,13,,,,,,,,],[2,,17,,15,,14,,10,,,,,,,,,,,,,,,,,,,,,,,,,,8,,,,10,,,,12,,,,15,,,,10,,,,14,,14,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,11,,,,6,,,,8,,,,11,,,,10,,,,6,,,,13,,,,10,,,,15,,,,13,,,,6,,,,8,,,,13,,,,11,,,,15,,,,11,,,,],[1,,15,,,,,,,,,,,,,,,,,,,,11,,13,,15,,13,,11,,6,,11,,,,,,,,,,,,,,,,,,,,11,,13,,11,,8,,8,,,,]],[[,-.1,6,,,,,,6,,18,,,,6,,,,,,6,,,,6,,18,,,,6,,,,4,,,,,,4,,16,,,,4,,,,,,6,,6,,,,18,,,,6,,,,],[1,-.2,18,,,,13,,,,10,,,,13,,,,11,,,,13,,,,10,,,,13,,,,8,,,,10,,,,11,,,,13,,,,10,,,,,,,,13,,,,,,,,],[1,,1,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,,,,,13,,,,,,,,13,,,,,,,,18,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,11,,,,6,,,,8,,,,11,,,,10,,,,6,,,,13,,,,10,,,,15,,,,13,,,,6,,,,8,,,,13,,,,11,,,,15,,,,11,,,,],[1,,15,,,,,,,,,,,,,,,,,,,,11,,13,,15,,13,,11,,6,,11,,,,,,,,,,,,,,,,,,,,11,,13,,11,,8,,8,,,,],[2,,15,,14,,15,,14,,,,,,,,,,,,,,,,,,,,,,,,,,19,,17,,15,,10,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,6,,,,,,6,,18,,,,6,,,,,,6,,,,6,,18,,,,6,,,,4,,,,,,4,,16,,,,4,,,,,,6,,6,,,,18,,,,6,,,,],[1,-.2,18,,,,13,,,,10,,,,13,,,,11,,,,13,,,,10,,,,13,,,,8,,,,10,,,,11,,,,13,,,,10,,,,,,,,13,,,,,,,,],[1,,1,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,,,,,,,,,,,,,13,,,,,,,,18,,,,,,,,],[2,,17,,15,,14,,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,15,,,,10,,,,14,,14,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,20,,,,22,,,,20,,,,18,,,,20,,,,,,,,15,,,,,,,,13,,,,11,,,,10,,,,6,,,,,,,,,,,,,,,,,,,,],[2,,15,17,15,17,15,,,,,,,,,,,,,,,,,,,,,,,,,,,,15,17,15,17,15,17,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[8,,26,26,26,26,26,,,,,,,25,25,25,,,,,,,29,29,29,,,,,,,24,24,24,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,4,,,,,,4,,16,,,,4,,,,,,4,,,,4,,16,,,,4,,,,6,,,,,,6,,18,,,,6,,,,,,6,,6,,,,18,,,,6,,,,],[1,,16,,,,18,,,,16,,,,11,,,,,,,,,,,,,,,,,,,,18,,,,13,,,,11,,,,10,,,,,,,,,,,,,,,,,,,,],[8,,31,31,31,31,31,,,,,,,30,30,30,,,,,,,34,34,34,,,,,,,29,29,29,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,20,,,,22,,,,20,,,,18,,,,20,,,,,,,,15,,,,,,,,13,,,,11,,,,10,,,,6,,,,,,,,,,,,,,,,,,,,],[2,,15,,14,,15,,14,,,,,,,,,,,,,,,,,,,,,,,,,,19,,17,,15,,10,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,4,,,,,,4,,16,,,,4,,,,,,4,,,,4,,16,,,,4,,,,6,,,,,,6,,18,,,,6,,,,,,6,,6,,,,18,,,,6,,,,],[1,,16,,,,18,,,,16,,,,11,,,,,,,,,,,,,,,,,,,,10,,,,11,,,,12,,,,13,,,,10,,11,,12,,13,,10,,11,,12,,13,,],[2,,17,,15,,14,,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,6,,6,,6,,6,,6,,,,,,,,6,,6,,6,,6,,6,,,,,,,,6,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,10,,11,,12,,20,,,,19,,,,18,,,,17,,,,20,,,,19,,,,18,,,,],[3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,15,,,,14,,,,13,,,,16,,,,15,,,,14,,,,],[4,-.1,6,,6,,6,,6,,6,,,,,,,,6,,6,,6,,6,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[1,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,10,,11,,12,,20,,,,19,,,,18,,,,17,,,,20,,,,19,,,,18,,,,],[3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,15,,,,14,,,,13,,,,16,,,,15,,,,14,,,,],[4,-.1,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,],[5,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[6,,29,,29,,29,,,,,,,,,,,,29,,29,,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,23,,11,,,,11,,23,,,,11,,,,],[1,,11,,,,,,10,,,,,,3,,,,,,11,,,,,,10,,,,3,,,,11,,,,,,10,,,,,,1,,,,,,11,,,,,,10,,,,1,,,,],[3,,30,,,,,,,,,,,,,,,,30,,,,28,,,,26,,,,28,,,,26,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,,26,,,,,,,,,,,,,,,,26,,,,25,,,,23,,,,25,,,,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,4,,,,,,4,,16,,4,,4,,,,,,4,,,,4,,16,,,,4,,,,6,,,,,,6,,18,,6,,6,,,,18,,6,,,,6,,18,,,,6,,,,],[1,,11,,,,,,10,,,,,,4,,,,,,11,,,,,,10,,,,4,,,,11,,,,,,10,,,,,,6,,,,,,11,,,,,,10,,,,6,,,,],[3,,26,,,,,,,,,,,,,,,,,,,,,,,,26,,,,,,,,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,,23,,,,,,,,,,,,,,,,,,,,,,,,23,,,,,,,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,4,,,,,,4,,16,,4,,4,,,,,,4,,,,4,,16,,,,4,,,,6,,,,,,6,,18,,6,,6,,,,18,,6,,,,6,,18,,,,6,,,,],[1,,11,10,11,10,11,10,,,4,,,,11,,,,10,,,,4,,,,11,,,,4,,,,11,10,11,10,11,10,,,6,,,,11,,,,10,,,,6,,,,11,,,,6,,,,],[3,,26,,,,,,,,,,,,,,,,,,,,,,,,26,,,,,,,,28,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,,23,,,,,,,,,,,,,,,,,,,,,,,,23,,,,,,,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,23,,11,,,,11,,23,,,,11,,,,],[1,,11,10,11,10,11,10,,,3,,,,11,,,,10,,,,3,,,,10,,,,3,,,,11,10,11,10,11,10,,,1,,,,11,,,,10,,,,1,,,,11,,,,1,,,,],[3,,30,,,,,,,,,,,,,,,,30,,,,28,,,,26,,,,28,,,,26,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,,26,,,,,,,,,,,,,,,,26,,,,25,,,,23,,,,25,,,,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[7,,,,6,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,6,,,,],[1,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,13,,10,,11,,12,,10,,11,,12,,20,,,,19,,,,18,,,,17,,,,20,,,,19,,,,18,,,,],[3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,15,,,,14,,,,13,,,,16,,,,15,,,,14,,,,],[4,-.1,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,6,,],[5,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,29,,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[6,,,29,,29,,29,,29,,,,,,,,,,29,,29,,29,,29,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,15,,16,,17,,18,,15,,16,,17,,18,,15,,16,,17,,18,,15,,16,,17,,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-.1,8,,,,,,8,,20,,8,,8,,,,,,8,,,,8,,20,,,,8,,,,11,,,,,,11,,23,,11,,11,,,,20,,11,,,,11,,23,,,,11,,,,],[1,,20,,,,22,,,,20,,,,18,,,,20,,,,,,,,15,,,,,,,,13,,,,11,,,,10,,,,6,,,,,,,,,,,,,,,,,,,,],[2,,15,17,15,17,15,,,,,,,,,,,,,,,,,,,,,,,,,,,,15,17,15,17,15,17,15,,,,,,,,,,,,,,,,,,,,,,,,,,],[8,,26,26,26,26,26,26,,,,,,25,25,25,,,,,,,29,29,29,29,,,,,,24,24,24,24,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,16,,,,16,,,,28,,,,16,,,,15,,,,16,,,,28,,,,16,,,,18,,,,18,,,,30,,,,18,,,,13,,,,18,,,,30,,,,18,,,,]]],[0,1,2,3,4,5,6,7,8,9,10,11,12,18,15,14,16,17,12],210,{title:"Death Drop",instruments:["Big B","Piano","Flute","Piano 2","Bass Drum ","Korg Bass","Korg Bass 2","Hihat Open","Korg Filter"],patterns:["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4","Pattern 5","Pattern 6","Pattern 7","Pattern 8","Pattern 9","Pattern 10","Pattern 11","Pattern 12","Pattern 13","Pattern 14","Pattern 15","Pattern 16","Pattern 17","Pattern 18","Pattern 19","Pattern 20"]}],L=()=>M(...[,,1890,.01,.02,.19,,.45,,,,,.02,,,,,.9,.01]),O=e=>new Promise((t=>{setTimeout((()=>t(((e,t,r,a=125)=>{let i,n,l,o,u,h,s,c,d,v,x,m,g,f,y=0,$=[],p=[],E=[],T=0,b=0,w=1,R={},_=S/a*60>>2;for(;w;T++)$=[w=c=m=0],r.map(((a,A)=>{for(s=t[a][T]||[0,0,0],w|=!!t[a][T],f=m+(t[a][0].length-2-!c)*_,g=A==r.length-1,n=2,o=m;n<s.length+g;c=++n){for(u=s[n],d=n==s.length+g-1&&g||v!=(s[0]||0)|u|0,l=0;l<_&&c;l++>_-99&&d?x+=(x<1)/99:0)h=(1-x)*$[y++]/2||0,p[o]=(p[o]||0)-h*b+h,E[o]=(E[o++]||0)+h*b+h;u&&(x=u%1,b=s[1]||0,(u|=0)&&($=R[[v=s[y=0]||0,u]]=R[[v,u]]||(i=[...e[v]],i[2]*=2**((u-12)/12),u>0?P(...i):[])))}m=f}));return[p,E]})(...e))),50)})),G=(e,t,r,a,i=1)=>{let n=0,l=Object.assign(x(e,a,r),{isOff:()=>0==n,isOn:()=>1==n,turnOn(){n=1,l.setImage(t),l.alpha=i}});return l},N=(e,t)=>{let r,o,v,g,p,T,U,S,I,P,C,{$H:X}=e,B=40,k=((e,t)=>{let r,i,n=0,l=t[3],o=a({width:e,height:40,$G(t){E(t,"ROOM "+n,40,5,30,"#FFF"),i=e-160,i+=E(t,r,i,5,30,"#FFF"),t.drawImage(l,i+10,5)}},{setRoomNo(e){n=e},setCoinsCount(e){r=A(3,e)}});return o.setCoinsCount(0),o})(X.width,t),O=y({width:X.width,height:X.height},"#201208"),N=$("YOU WIN!",80,{width:X.width},"#f3e2b1"),H=[],z=0,Y=0,J=-1,j=!1,K=(e="#e05ad1",a=15,i=28,n=0)=>{if(X.hasChildren()&&X.removeAll(),r=[],o=[],v=[],g=[],p=[],C=0,I=S=P=void 0,n in H){let e=H[n];f.seed=e.seed,I=x(t[e.graveTile],{x:e.x,y:e.y},e.$I),P=R(x(t[33],{x:e.x,y:e.y,$B:.5,$C:.5},"#bec4bb"))}else f.seed=Math.floor(2147483646*Math.random());J=f.seed;let l={$h:X.width/B,$f:X.height/B,roomNo:n},u=F(l);u.map.map((e=>{if(1==e.$z)return;let a;switch(e.$z){case 0:a=x(t[2],{x:e.x*B,y:e.y*B},"#cc8e4c"),r.push(a);break;case 3:a=x(t[1],{x:e.x*B,y:e.y*B},"#a26134"),r.push(a);break;case 2:a=x(t[0],{x:e.x*B,y:e.y*B},"#929992"),r.push(a)}})),u.map.map((r=>{if(void 0!==r.$J){let n,l,u,h;switch(r.$J){case 0:n=t[a],u=m([n,t[a+1],t[a],t[a+2]],e,{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height),$B:.5,$C:.5,border:2}),U=((e,t,r,a,i)=>{let n=w(e,b(),{$t:1,$u:1,$A:.3,$v:-6.8,$q:!0}),l=n.$F,o=n.stop,u=!1;return Object.assign(n,{getTile:()=>t,getGraveTile:()=>a,isAlive:()=>!u,die(){u=!0,n.setImage(r),n.vx*=-1,n.vy*=-1,n.$K=0},$F(e){u||l(e)},stop(e){u||o(e)}})})(u,a,t[i],i),U.$D=-1;break;case 1:n=t[12],l=G(n,t[13],"#f7c439",{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height)},.4),o.push(l);break;case 2:n=t[10],T=G(n,t[11],"#ae3737",{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height)});break;case 3:n=t[19],S=x(n,{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height),$B:.5,$C:.5,border:2},"#5fb7f3");break;case 4:n=t[30],v.push(x(n,{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height),$B:.5,$C:1},"#4dd464"));break;case 5:n=t[31],h=R(x(n,{x:r.x*B+(B-n.width)/2,y:r.y*B+(B-n.height),$B:.5},"#929992")),h.vx=1,h.$D=-1,g.push(h)}}})),0==n?p=[1,0,0,0]:(p=new Array(o.length-1).fill(0),Math.random()<.1&&(p[0]=2),p.push(1),(e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}})(p)),X.addMany(k,...r,...o,T,...v,...g,U,I,P)},q=["#f3e2b1","#639bff","#35b23a","#ff880b","#e05ad1","#ff5036"],W=[15,20,25],V=[28,29,24];K(D(q),D(W),D(V)),X.$y(O),u(45,1,0,i,(e=>O.alpha=e),(()=>X.$k(O)));let Q=()=>{k.setRoomNo(z=0),k.setCoinsCount(Y=0),K(D(q),D(W),D(V))},Z=()=>{U.die(),_(1e3).then((()=>{j=!0,X.$y(O),u(30,O.alpha=0,1,i,(e=>{O.alpha=e}),(()=>{z>0&&(H[z]={coins:Y,$I:U.$I,seed:J,x:U.x,y:U.y,graveTile:U.getGraveTile()}),Q(),j=!1,X.$y(O),u(30,O.alpha=1,0,i,(e=>O.alpha=e))}))}))};(e=>{let t={code:82,isDown:!1,isUp:!1,downHandler:e=>{e.keyCode==t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1)},upHandler:e=>{e.keyCode==t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0)}};return addEventListener("keydown",t.downHandler.bind(t),!1),addEventListener("keyup",t.upHandler.bind(t),!1),t})().release=Q;let ee=()=>{X.$y(O),X.$y(N),N.y=(X.height-N.height)/2,u(45,O.alpha=N.alpha=0,1,i,(e=>{O.alpha=N.alpha=e,N.x=(X.width-N.width)/2}),(()=>{X.removeAll(),r=[],o=[],p=[],v=[],g=[],e.changeScreen(2,Y,U.$I)}))};return e=>{if(!j&&(C+=e,S&&S.$H&&(S.$w+=Math.PI/90,S.$D=S.$E=1+.5*Math.sin(C),U.$H&&h(U,S)&&(X.$k(U),ee())),U.$H&&(U.isAlive()&&(s?(U.$K=-.2,U.$D=1):c?(U.$K=.2,U.$D=-1):U.$K=0,d&&U.$q&&(M(...[1.01,,484,,.03,.06,1,1.79,18,-2.5,,,,.3,,,,.98,.01]),U.vy+=U.$v,U.$q=!1,U.$t=1)),U.$q?U.$t=.92:U.$t=.97,U.vx+=U.$K,U.vy+=U.$L,U.vx*=U.$t,U.vy+=U.$A,U.x+=U.vx,U.y+=U.vy,r.map((e=>{let t=((e,t)=>{let r,a,i,n=e.$l()+e.$g()-(t.$l()+t.$g()),l=e.$m()+e.$d()-(t.$m()+t.$d()),o=e.$g()+t.$g(),u=e.$d()+t.$d();return Math.abs(n)<o&&Math.abs(l)<u&&(a=o-Math.abs(n),i=u-Math.abs(l),a>=i?l>0?(r=0,e.y=e.y+i):(r=1,e.y=e.y-i):n>0?(r=2,e.x=e.x+a):(r=3,e.x=e.x-a)),r})(U,e);if(void 0!==t){switch(t){case 1:U.vy>=0&&(U.$q=!0,U.vy=-U.$A);break;case 0:U.vy<=0&&(U.vy=0);break;case 3:U.vx>=0&&(U.vx=0);break;case 2:U.vx<=0&&(U.vx=0)}1!==t&&U.vy>0&&(U.$q=!1)}})),U.x<20-U.width&&(U.x=X.width-B+U.width),U.x>X.width-B+U.width&&(U.x=20-U.width),U.y+U.height>X.height&&(U.y=-U.height),U.isAlive()))){if(U.$q&&Math.abs(U.vx)>.2?U.play():U.stop(),I&&h(U,I)&&(X.$k(I),I=void 0,k.setCoinsCount(Y+=H[z].coins),delete H[z],L()),P){let e=U.x-P.x,t=U.y-P.y;Math.sqrt(e*e+t*t)>=1&&(P.x+=.001*e,P.y+=.001*t),P.$D=Math.sign(P.x-U.x),h(U,P)&&Z()}v.map((e=>{e.$D=Math.sign(e.x-U.x),e.$E=.98+.02*Math.sin(C/100),h(U,e)&&Z()})),g.map((e=>{e.x+=e.vx,e.y=e.y+Math.sin(C);for(let t of r)if(h(e,t)){e.vx*=-1,e.$D*=-1;break}(e.x<0||e.x>X.width-e.width)&&(e.vx*=-1,e.$D*=-1),h(U,e)&&Z()})),o.map((e=>{if(e.isOff()&&h(U,e)){k.setCoinsCount(++Y),L();let r,a,i=e.height;e.turnOn(),e.y-=e.height-i;let o=p.pop();switch(o){case 0:a=t[5],r=m(t.slice(5,9),"#f7c439",{x:e.x+(e.width-a.width)/2+2,y:e.y},!0);break;case 1:a=t[18],r=x(a,{x:e.x+(e.width-a.width)/2+2,y:e.y,border:2},"#f7c439");break;case 2:a=t[23],r=x(a,{x:e.x+(e.width-a.width)/2+2,y:e.y,border:2},"#5fb7f3")}X.$y(r),u(15,r.alpha=0,1,l,(t=>{r.y=e.y-(20+e.height)*t,r.alpha=t}),(()=>{r.y=e.y-(20+e.height),r.alpha=1,_(350).then((()=>{u(15,r.alpha=1,0,n,(e=>{r.alpha=e}),(()=>{r.alpha=0,r.$H&&X.$k(r)}))}))})),1==o?T.turnOn():2==o&&S&&!S.$H&&X.$y(S)}})),T.isOn()&&h(U,T)&&(k.setRoomNo(++z),K(U.$I,U.getTile(),U.getGraveTile(),z))}}},B=[],H=()=>{B.length>100&&(B.length=100),localStorage.setItem("enchanted_dungeon_scores",JSON.stringify(B))},z=(e,t)=>{let r,n=e.getContext("2d"),l=((e,t,r=0,i=0)=>{let n=a({x:r,y:i,width:e,height:t,$F(e){n.$x.map((t=>{t.$F(e)}))},$G(e){n.$x.map((t=>{e.save(),e.translate(n.x+t.x-t.border+(t.width+2*t.border)*t.$B,n.y+t.y-t.border+(t.height+2*t.border)*t.$C),e.rotate(t.$w),e.globalAlpha=t.alpha*n.alpha,e.scale(t.$D,t.$E),t.$G(e),e.restore()}))}},{$x:new Array,$y(e){e.$H=n,n.$x.push(e)},$k(e){n.$x.indexOf(e)<0?console.warn("[Stage] Trying to delete odd child",e):(n.$x.splice(n.$x.indexOf(e),1),e.$H=void 0)},addMany(...e){e.map((e=>e&&n.$y(e)))},removeAll(){n.$x.map((e=>e.$H=void 0)),n.$x=[]},hasChildren:()=>n.$x.length>0});return n})(e.width+40,e.height,-20),h={$H:l,$F(e){l.$F(e),r(e),(e=>{if(o.length>0)for(let e,t=o.length-1;t>=0;t--)e=o[t],e&&e()})()},$G(){n.fillStyle="#201208",n.fillRect(0,0,l.width,l.height),l.$G(n)},changeScreen(e,...a){var n,l;let o,s;switch(e){case 0:r=((e,t)=>{let{$H:r}=e,a=$("ENCHANTED",80,{width:r.width,y:80},"#f3e2b1"),n=$("DUNGEON",80,{width:r.width,y:200},"#f3e2b1"),l=$("START",30,{width:r.width,y:r.height-160}),o=$("SCORES",30,{width:r.width,y:r.height-120+5}),h=x(t[9],{y:l.y},"#ff5036"),s=y({width:r.width,height:r.height},"#201208");r.addMany(a,n,l,o,h,s),r.$y(s),u(30,1,0,i,(e=>s.alpha=e),(()=>r.$k(s)));let c=0,d=[l.y,o.y],v=t=>{let a=t.keyCode;38==a||40==a||37==a||39==a?c=(c+1)%d.length:32!=a&&13!=a||(removeEventListener("keyup",v,!1),u(30,s.alpha=0,1,i,(e=>s.alpha=e),(()=>{r.removeAll(),0==c?e.changeScreen(1):e.changeScreen(2)})))};return addEventListener("keyup",v,!1),()=>{a.x=(r.width-a.width)/2,n.x=(r.width-n.width)/2,l.x=o.x=(r.width-l.width)/2,h.x=l.x-h.width-10,h.y=d[c]}})(h,t);break;case 1:r=N(h,t);break;case 2:o=null!==(n=a[0])&&void 0!==n?n:-1,s=null!==(l=a[1])&&void 0!==l?l:"white",r=((e,t,r,a)=>{let n,l=40,o=!1,h=0,{$H:s}=e,c=$("HIGH SCORES",40,{width:s.width,y:l},"#f3e2b1"),v=x(t[4],{y:l},"#ff880b"),m=x(t[4],{y:l,$B:.5,$D:-1},"#ff880b"),g=$("SPACE",20,{width:s.width,y:s.height-60}),f=y({width:s.width,height:s.height},"#201208");if(l+=80,r>0){let e=prompt("Please, enter your name (8 chars max):","Player 1");e&&B.push([r,e.substring(0,8),a])}for(B.sort(((e,t)=>t[0]-e[0])),H(),n=0;n<Math.min(B.length,6);n++){let[e,t,r]=B[n],a=l+30*n*1.5,i=20,o=s.width-40,u=$(A(2,n+1),30,{width:s.width,x:i+o/10*2,y:a},r),h=$(A(7,e),30,{width:s.width,x:i+o/10*3,y:a},r),c=$(t.toUpperCase(),30,{width:s.width,x:i+o/10*6,y:a},r);s.addMany(u,h,c)}return s.addMany(c,v,m,g,f),u(45,1,0,i,(e=>f.alpha=e),(()=>s.$k(f))),()=>{c.x=(s.width-c.width)/2,v.x=c.x-v.width,m.x=c.x+c.width+5,g.x=(s.width-g.width)/2,h++%40==0&&(g.alpha=0==g.alpha?1:0),!o&&d&&(o=!0,u(45,f.alpha=0,1,i,(e=>f.alpha=e),(()=>{s.removeAll(),e.changeScreen(0)})))}})(h,t,o,s)}}};return h.changeScreen(0),h};(async()=>{(()=>{let e=localStorage.getItem("enchanted_dungeon_scores");e&&(B=JSON.parse(e))})(),(async()=>{let e=await O(k);I(...e).loop=!0,C.resume()})();let a=(r=>{let a,i,n,l=[],o=r.width/10,u=r.height/10;for(i=0;i<u;i++)for(a=0;a<o;a++)n=a+i*o,l[n]=t(r,10*a,10*i,10,e[n],n>=10,n<15?0:2);return l})(await("atlas.png",new Promise(((e,t)=>{let r=new Image;r.src="atlas.png",r.onload=t=>e(r),r.onerror=t})))),i=z(g,a),n=r(g);let l,o,u=!0,h=0;onfocus=()=>u=!0,onblur=()=>u=!1;let s=e=>{requestAnimationFrame(s),u&&(l=performance.now(),o=l-h,h=l,i.$F(o),i.$G(),n(e))};s(0)})()</script>