<!doctype html><title>CatNFish - js13kGames 2025</title><style>body{margin:0;background:#000;overflow:hidden;font-family:monospace}#stage{position:absolute;left:0;top:0;transition:left .3s ease,top .3s ease}canvas{display:block;background:#111;image-rendering:pixelated}footer{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;gap:10px;font-size:14px;color:#ccc}button{background-color:#222;border:none;border-radius:8px;color:#fff;padding:15px 32px;font-size:16px;opacity:.85}button:disabled{opacity:.5;cursor:not-allowed;transform:none}button:hover{background-color:#444;transform:scale(1.05)}button:active{transform:scale(.95)}#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);color:#fff;font-family:monospace;align-items:center;justify-content:center;z-index:1000}#mcontent{background:#111;padding:20px 40px;border:2px solid #444;border-radius:10px;text-align:center}#mcontent h1{margin:0 0 15px;font-size:24px}</style><div id=stage><canvas id=game></canvas></div><div id=modal><div id=mcontent><h1 id=status></h1><p id=mtext></p><button id=restart>Restart</button> <button id=next-level disabled=disabled>Next Level</button></div></div><footer>Arrow keys â€¢ Walls are red â€¢ Exit is yellow â€¢ Find fish â€¢ Eat fish â€¢ Escape <button id=audio-toggle>ðŸ”Š</button></footer><script>const e=new(window.AudioContext||window.webkitAudioContext);let t=!1,n=!0,o=.4,r=!1,l=[],i=0;const a=document.getElementById("audio-toggle");function c(){t||e.resume().then(()=>{t=!0})}function s(){if(!t||!n)return;const o=e.createOscillator(),r=e.createGain();o.type="sine",o.connect(r),r.connect(e.destination),r.gain.setValueAtTime(.4,e.currentTime),r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.7),o.frequency.setValueAtTime(400,e.currentTime),o.frequency.exponentialRampToValueAtTime(700,e.currentTime+.35),o.frequency.exponentialRampToValueAtTime(450,e.currentTime+.7),o.start(),o.stop(e.currentTime+.7)}function m(o=440,r=.05,l="square"){if(!t||!n)return;const i=e.createOscillator(),a=e.createGain();i.type=l,i.frequency.value=o,i.connect(a),a.connect(e.destination),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+r),i.start(),i.stop(e.currentTime+r)}function y(){if(!t||!n)return;const o=performance.now();if(o-i<250)return;i=o;const r=e.createOscillator(),l=e.createGain();r.type="sine",r.frequency.value=300+50*Math.random(),r.connect(l),l.connect(e.destination),l.gain.setValueAtTime(.22,e.currentTime),l.gain.exponentialRampToValueAtTime(.001,e.currentTime+.08),r.start(e.currentTime),r.stop(e.currentTime+.08)}a.addEventListener("click",()=>{n=!n,a.textContent=n?"ðŸ”Š":"ðŸ”‡",n&&c()});const f=[{freq:523},{freq:493},{freq:523},{freq:493},{freq:523},{freq:493},{freq:392},{freq:415}];function d(i,a=o,c=!0){if(!t||!n)return;u(),r=!0,o=a;let s=e.currentTime;if(i.forEach(t=>{if(!r)return;const n=e.createOscillator(),o=e.createGain();n.type="triangle",n.frequency.value=t.freq,n.connect(o),o.connect(e.destination),o.gain.setValueAtTime(.2,s),o.gain.exponentialRampToValueAtTime(.001,s+a),n.start(s),n.stop(s+a),l.push(n),s+=1.1*a}),c){const e=i.reduce(e=>e+1.1*a,0);setTimeout(()=>{r&&d(i,o,c)},1e3*e)}}function u(){r=!1,l.forEach(e=>{try{e.stop()}catch(e){}}),l=[]}window.addEventListener("keydown",c,{once:!0}),window.addEventListener("mousedown",c,{once:!0});const h=[[1,0,0,1,1,0,0,0],[1,0,1,1,1,1,0,0],[1,1,1,1,1,0,1,0],[1,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,0],[1,0,1,1,1,1,0,0],[1,0,0,1,1,0,0,0]],x=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,4,4,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,4,7,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,7,7,7,2,2,2,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,11,11,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,3,3,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,11,4,4,4,12,2,2,2,1,1,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,6,6,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,12,12,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,4,13,13,13,2,2,2,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,4,4,2,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,2,2,2,4,4,4,4,4,8,8,8,2,2,2,0,0,0,0,0,0,0,0,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[0,0,0,0,4,4,4,4,4,4,4,2,2,2,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,9,9,0,0,0,0,0,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],p=[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]]];let g=400,T=300,w=0,v=0,M=!1,E=null,b=0,k=0,A=0,S=!1,q=1,z=0;const L=document.getElementById("stage"),R=document.getElementById("game"),X=R.getContext("2d");let Y={x:100,y:75,speed:4},V={roomX:0,roomY:0,x:0,y:0,size:14,vx:0,vy:0,wanderTimer:0,wanderSpeed:.5,chaseSpeed:1.4,sight:140};function W(){E=Array.from({length:5},()=>Array.from({length:5},()=>({N:!0,S:!0,E:!0,W:!0})));for(let e=0;e<5;e++)for(let t=0;t<5;t++)e+1<5&&Math.random()<.45&&(E[e][t].E=!1,E[e+1][t].W=!1),t+1<5&&Math.random()<.45&&(E[e][t].S=!1,E[e][t+1].N=!1);!function(){for(;;){const e=I(0,0);let t=!0;for(let n=0;n<5;n++){for(let o=0;o<5;o++)if(!e[n][o]){t=!1;break}if(!t)break}if(t)return;let n=!1;for(let t=0;t<5&&!n;t++)for(let o=0;o<5&&!n;o++)if(e[t][o]){if(t+1<5&&!E[t][o].E&&!e[t+1][o]){E[t][o].E=!0,E[t+1][o].W=!0,n=!0;break}if(o+1<5&&!E[t][o].S&&!e[t][o+1]){E[t][o].S=!0,E[t][o+1].N=!0,n=!0;break}if(t>0&&!E[t][o].W&&!e[t-1][o]){E[t][o].W=!0,E[t-1][o].E=!0,n=!0;break}if(o>0&&!E[t][o].N&&!e[t][o-1]){E[t][o].N=!0,E[t][o-1].S=!0,n=!0;break}}if(!n)return}}()}function B(e,t){const n=[];return t>0&&E[e][t].N&&n.push({x:e,y:t-1}),t+1<5&&E[e][t].S&&n.push({x:e,y:t+1}),e+1<5&&E[e][t].E&&n.push({x:e+1,y:t}),e>0&&E[e][t].W&&n.push({x:e-1,y:t}),n}function I(e=0,t=0){const n=Array.from({length:5},()=>Array(5).fill(!1)),o=[{x:e,y:t}];for(n[e][t]=!0;o.length;){const{x:e,y:t}=o.shift();for(const r of B(e,t))n[r.x][r.y]||(n[r.x][r.y]=!0,o.push(r))}return n}const N=3*p[0][0].length,G=3*p[0].length,O=3*h[0].length,C=3*h.length;function F(e,t,n,{scale:o=3,flip:r=!1,colors:l={}}={}){for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][r?n[i].length-1-a:a];0!==c&&l[c]&&(X.fillStyle=l[c],X.fillRect(e+a*o,t+i*o,o,o))}}const $={};function U(){$.collected=!1,$.roomX=Math.floor(5*Math.random()),$.roomY=Math.floor(5*Math.random()),0===$.roomX&&0===$.roomY&&($.roomX<4?$.roomX++:$.roomY++),$.x=Math.floor((g-O)/2),$.y=Math.floor((T-C)/2)}U();const D=[];function H(){const e={...V};do{e.roomX=Math.floor(5*Math.random()),e.roomY=Math.floor(5*Math.random())}while(0===e.roomX&&0===e.roomY);return e.x=Math.random()*(g-e.size),e.y=Math.random()*(T-e.size),e}D.push(H());const P={};function j(){g=Math.floor(window.innerWidth/5),T=Math.floor(window.innerHeight/5),R.width=g,R.height=T;const e=g-N,t=T-G;Y.x<0&&(Y.x=0),Y.y<0&&(Y.y=0),Y.x>e&&(Y.x=e),Y.y>t&&(Y.y=t),D.forEach(e=>{e.x=Math.max(0,Math.min(g-e.size,e.x)),e.y=Math.max(0,Math.min(T-e.size,e.y))}),$.x=Math.max(0,Math.min(g-O,$.x)),$.y=Math.max(0,Math.min(T-C,$.y)),J()}function J(){L.style.left=w*g+"px",L.style.top=v*T+"px"}addEventListener("keydown",e=>P[e.key]=!0),addEventListener("keyup",e=>P[e.key]=!1),window.addEventListener("resize",j);let K=null;function Q(e){if(w!==e.roomX||v!==e.roomY)return;const t=Y.x+.5*N,n=Y.y+.5*G,o=t-(e.x+.5*e.size),r=n-(e.y+.5*e.size),l=Math.hypot(o,r);if(l<e.sight){const t=e.chaseSpeed/(l||1);e.vx=o*t,e.vy=r*t}else if(e.wanderTimer<=0){const t=[-1,0,1];e.vx=t[3*Math.random()|0]*e.wanderSpeed,e.vy=t[3*Math.random()|0]*e.wanderSpeed,e.wanderTimer=60+(60*Math.random()|0)}else e.wanderTimer--;e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.x>g-e.size&&(e.x=g-e.size,e.vx*=-.5),e.y>T-e.size&&(e.y=T-e.size,e.vy*=-.5)}function Z({sameLevel:e=!1}={}){w=0,v=0,Y.x=Math.floor((g-N)/2),Y.y=Math.floor((T-G)/2),J(),U(),K=null,e?(q=1,D.length=0,D.push(H())):(q++,D.push(H())),W(),document.getElementById("next-level").disabled=!0,document.getElementById("modal").style.display="none"}j(),J(),W(),function e(){M||function(){let e=!1;P.ArrowUp&&(Y.y-=Y.speed,e=!0),P.ArrowDown&&(Y.y+=Y.speed,e=!0),P.ArrowLeft&&(Y.x-=Y.speed,e=!0,S=!0),P.ArrowRight&&(Y.x+=Y.speed,e=!0,S=!1);let t=!1;if(Y.x<0&&(w>0&&E[w][v].W?(w--,Y.x+=g,t=!0):Y.x=0),Y.x+N>g&&(w<4&&E[w][v].E?(w++,Y.x-=g,t=!0):Y.x=g-N),Y.y<0&&(v>0&&E[w][v].N?(v--,Y.y+=T,t=!0):Y.y=0),Y.y+G>T&&(v<4&&E[w][v].S?(v++,Y.y-=T,t=!0):Y.y=T-G),t&&J(),e?(k++,k>15&&(k=0,b=1===b?2:1),y()):b=0,D.forEach(Q),D.some(e=>{if(w!==e.roomX||v!==e.roomY)return!1;const t=Y.x,n=Y.y,o=N,r=G,l=e.x,i=e.y,a=e.size,c=e.size;return!(l>t+o||l+a<t||i>n+r||i+c<n)})&&(A=18,m(900,.08,"square"),oe("You were caught!",!1,!0),u(),ee.disabled=!1,M=!0,Y.x=Math.max(0,Math.min(g-N,.5*(g-N))),Y.y=Math.max(0,Math.min(T-G,.5*(T-G)))),!$.collected&&w===$.roomX&&v===$.roomY){const e={x:Y.x,y:Y.y,w:N,h:G},t={x:$.x,y:$.y,w:O,h:C};!(t.x>e.x+e.w||t.x+t.w<e.x||t.y>e.y+e.h||t.y+t.h<e.y)&&($.collected=!0,d(f,.2),s(),function(){const e=[];for(let t=0;t<5;t++)for(let n=0;n<5;n++)0!==t&&4!==t&&0!==n&&4!==n||t===$.roomX&&n===$.roomY||e.push({x:t,y:n});K=e[Math.random()*e.length|0]}(),z=60)}K&&$.collected&&w===K.x&&v===K.y&&(0===K.x&&Y.x<=0||4===K.x&&Y.x+N>=g||0===K.y&&Y.y<=0||4===K.y&&Y.y+G>=T)&&(oe("Next level!",!0,!1),te.disabled=!1,u())}(),function(){X.clearRect(0,0,g,T);const e=40*(w+5*v);X.fillStyle=`hsl(${e},50%,20%)`,X.fillRect(0,0,g,T),X.fillStyle="#ddd",X.font="12px monospace",X.fillText(`Fish: ${$.collected?"âœ“":"âœ—"} â€¢ Level: ${q}`,10,16),$.collected||w===$.roomX&&v===$.roomY&&F($.x,$.y,h,{scale:3,colors:{1:"#4cf"}}),D.forEach(e=>{w===e.roomX&&v===e.roomY&&function(e,t,n,{scale:o=3,flip:r=!1}={}){const l={1:"rgb(0,0,0)",2:"rgb(226,164,122)",3:"rgb(101,45,45)",4:"rgb(37,26,40)",5:"rgb(251,242,54)",6:"rgb(255,255,255)",7:"rgb(120,114,102)",8:"rgb(51,37,59)",9:"rgb(75,42,30)",10:"rgb(52,29,22)",11:"rgb(147,65,60)",12:"rgb(208,138,96)",13:"rgb(68,64,63)"};for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][r?n[i].length-1-a:a];0!==c&&(X.fillStyle=l[c],X.fillRect(e+a*o,t+i*o,o,o))}}(e.x,e.y,x,{scale:2,flip:!1})}),K&&w===K.x&&v===K.y&&(X.strokeStyle="yellow",X.lineWidth=6,X.strokeRect(0,0,g,T)),function(){const e=E[w][v];X.lineWidth=8,X.strokeStyle="rgba(255, 0, 0, 0.6)",X.beginPath(),e.N||(X.moveTo(0,0),X.lineTo(g,0)),e.S||(X.moveTo(0,T),X.lineTo(g,T)),e.W||(X.moveTo(0,0),X.lineTo(0,T)),e.E||(X.moveTo(g,0),X.lineTo(g,T)),X.stroke()}(),function(e,t,n,o=!1){F(e,t,p[b],{scale:3,flip:o,colors:{1:"#000",2:"#FF0000"}})}(Y.x,Y.y,0,S),A>0&&(A--,X.fillStyle="rgba(255,0,0,0.25)",X.fillRect(0,0,g,T)),z>0&&(z--,X.fillStyle="yellow",X.font="24px monospace",X.fillText("GET OUT!",g/2-50,T/2))}(),requestAnimationFrame(e)}();const _=document.getElementById("modal"),ee=document.getElementById("restart"),te=document.getElementById("next-level"),ne=document.getElementById("mtext");function oe(e="Game Over",t=!1,n=!0){ne.textContent=e,te.style.display=t?"inline-block":"none",ee.style.display=n?"inline-block":"none",_.style.display="flex"}ee.addEventListener("click",()=>{_.style.display="none",Z({sameLevel:!0}),M=!1}),te.addEventListener("click",()=>{_.style.display="none",Z({sameLevel:!1})}),document.addEventListener("keydown",e=>{"Enter"===e.key&&("none"!==te.style.display?te.click():"none"!==ee.style.display&&ee.click(),_.style.display="none")})</script>