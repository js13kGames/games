<title>The Mongol Horde - js13kGames 2023</title><body style=display:flex;align-items:center;justify-content:center;background:grey;margin:0;height:100vh><canvas style=image-rendering:pixelated><script>let v=()=>{};function U(t,i){i=t.indexOf(i);return-1!=i&&(t.splice(i,1),1)}let h,y,s={};function w(t,i){s[t]=s[t]||[],s[t].push(i)}function m(t,...i){(s[t]||[]).map(t=>t(...i))}let D={get:(t,i)=>"_proxy"==i||v};function r(){return h}function l(){return y}let Y=/(jpeg|jpg|gif|png|webp)$/,j=/(wav|mp3|ogg|aac)$/,N=/^\//,J=/\/$/,k=new WeakMap;function d(t,i){return new URL(t,i).href}function P(t,i){return[t.replace(J,""),t?i.replace(N,""):i].filter(t=>t).join("/")}function F(t){return t.split(".").pop()}function G(t){t=t.replace("."+F(t),"");return 2==t.split("/").length?t.replace(N,""):t}let c={},u={},e={};function _(){window.t||(window.t={i:k,h:d,d:e,o:c})}function z(t,i){return(Math.random()*(i-t+1)|0)+t}function X(t,i,s){return t*(1-s)+i*s}function K(t,i,s){return Math.min(Math.max(t,s),i)}class Z{constructor(t=0,i=0,s){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new Z(this.x+t.x,this.y+t.y,this)}}function $(){return new Z(...arguments)}class t extends class{constructor(t){return this.init(t)}init(t={}){this.position=$(),this.l=$(),this.acceleration=$(),this.u=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){var i=this.acceleration,i=(this.l=this.l.add(i),this.l);this.position=this.position.add(i),this.p(),this.u--}get dx(){return this.l.x}get dy(){return this.l.y}set dx(t){this.l.x=t}set dy(t){this.l.y=t}get g(){return this.acceleration.x}get m(){return this.acceleration.y}set g(t){this.acceleration.x=t}set m(t){this.acceleration.y=t}M(){return 0<this.u}p(){}}{init({width:t=0,height:i=0,context:s=l(),v:h=this.A,update:e=this.advance,children:n=[],anchor:o={x:0,y:0},opacity:r=1,...a}={}){this.T=[],super.init({width:t,height:i,context:s,anchor:o,opacity:r,...a}),this.L=!0,this.I(),this.O(n),this.S=h,this.R=e,w("init",()=>{this.context??=l()})}update(i){this.R(i),this.children.map(t=>t.update&&t.update(i))}v(){var t=this.context,i=(t.save(),(this.x||this.y)&&t.translate(this.x,this.y),-this.width*this.anchor.x),s=-this.height*this.anchor.y;(i||s)&&t.translate(i,s),this.context.globalAlpha=this.opacity,this.S(),(i||s)&&t.translate(-i,-s),this.children.map(t=>t.v&&t.v()),t.restore()}A(){}p(){this.I(),this.children.map(t=>t.p())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this.p()}set y(t){this.position.y=t,this.p()}get width(){return this._}set width(t){this._=t,this.p()}get height(){return this.k}set height(t){this.k=t,this.p()}I(){var t,i,s;this.L&&({D:t=0,N:i=0,C:s=1}=this.parent||{},this.D=this.x,this.N=this.y,this.F=this.width,this.j=this.height,this.C=s*this.opacity,this.D+=t,this.N+=i)}get G(){return{x:this.D,y:this.N,width:this.F,height:this.j,opacity:this.C}}set children(t){this.removeChild(this.T),this.O(t)}get children(){return this.T}O(...t){t.flat().map(t=>{this.children.push(t),t.parent=this,t.p=t.p||v,t.p()})}removeChild(...t){t.flat().map(t=>{U(this.children,t)&&(t.parent=null,t.p())})}get opacity(){return this.U}set opacity(t){this.U=K(0,1,t),this.p()}}function n(){return new t(...arguments)}class q extends t{init({H:t,V:i=t?[0,0,t.width,t.height]:void 0,width:s=i?i[2]:t?t.width:void 0,height:h=i?i[3]:t?t.height:void 0,...e}={}){super.init({H:t,V:i,width:s,height:h,...e})}A(){this.H&&this.context.drawImage(this.H,this.V[0],this.V[1],this.V[2],this.V[3],0,0,this.V[2],this.V[3]),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function o(){return new q(...arguments)}let Q=/(\d+)(\w+)/,tt=class extends t{init({text:t="",textAlign:i="",lineHeight:s=1,font:h=l()?.font,...e}={}){super.init({text:t=""+t,textAlign:i,lineHeight:s,font:h,...e}),this.context&&this.W(),w("init",()=>{this.font??=l().font,this.W()})}get width(){return this._}set width(t){this.Y=!0,this._=t,this.P=t}get text(){return this.X}set text(t){this.Y=!0,this.X=""+t}get font(){return this.$}set font(t){var i;this.Y=!0,this.$=t,this.K=(t?{size:i=+(t=t.match(Q))[1],unit:t[2],q:i}:{q:0}).q}get lineHeight(){return this.B}set lineHeight(t){this.Y=!0,this.B=t}v(){this.Y&&this.W(),super.v()}W(){this.J=[],this.Y=!1;var t=this.context;this.text,t.font=this.font,this.J.length||(this.J.push(this.text),this._=this.P||t.measureText(this.text).width),this.height=this.K+(this.J.length-1)*this.K*this.lineHeight,this.I()}A(){let s,h=this.textAlign,e=this.context;s="right"==h?this.width:"center"==h?this.width/2|0:0,this.J.map((t,i)=>{e.textBaseline="top",e.textAlign=h,e.fillStyle=this.color,e.font=this.font,e.fillText(t,s,this.K*this.lineHeight*i)})}};function it(){return new tt(...arguments)}let x=new WeakMap,st={},ht={},et={0:"left",1:"middle",2:"right"};function f(t,i){return parseFloat(t.getPropertyValue(i))||0}function nt(t){var i=null!=t.button?et[t.button]:"left";ht[i]=!0,dt(t,"onDown")}function ot(t){var i=null!=t.button?et[t.button]:"left";ht[i]=!1,dt(t,"onUp")}function rt(t){dt(t,"onOver")}function at(t){x.get(t.target).et=null,ht={}}function lt(t,i,s){var h=(i=>{var s=i.nt.length?i.nt:i.rt;for(let t=s.length-1;0<=t;t--){var h=s[t];if(h.ot?h.ot(i):function(t,i){let{x:s,y:h,width:e,height:n}=(t=>{let{x:i=0,y:s=0,width:h,height:e}=t.G||t;return t.Z&&(h=t.Z,e=t.tt),t.anchor&&(i-=h*t.anchor.x,s-=e*t.anchor.y),{x:i,y:s,width:h,height:e}})(t);for(;s-=t.it||0,h-=t.st||0,t=t.parent;);var o=i.x-Math.max(s,Math.min(i.x,s+e)),r=i.y-Math.max(h,Math.min(i.y,h+n));return o*o+r*r<i.ht*i.ht}(h,i))return h}})(t);h&&h[i]&&h[i](s),st[i]&&st[i](s,h),"onOver"==i&&(h!=t.et&&t.et&&t.et.onOut&&t.et.onOut(s),t.et=h)}function dt(e,n){e.preventDefault();let t=e.target,l=x.get(t),{ct:o,lt:r,offsetX:a,offsetY:d}=(()=>{var{canvas:t,J:i}=l,s=t.getBoundingClientRect(),h="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],e=parseFloat(h[0]),h=parseFloat(h[3]),n=(f(i,"border-left-width")+f(i,"border-right-width"))*e,o=(f(i,"border-top-width")+f(i,"border-bottom-width"))*h,r=(f(i,"padding-left")+f(i,"padding-right"))*e,a=(f(i,"padding-top")+f(i,"padding-bottom"))*h;return{ct:(s.width-n-r)/t.width,lt:(s.height-o-a)/t.height,offsetX:s.left+(f(i,"border-left-width")+f(i,"padding-left"))*e,offsetY:s.top+(f(i,"border-top-width")+f(i,"padding-top"))*h}})();e.type.includes("touch")?(Array.from(e.touches).map(({clientX:t,clientY:i,identifier:s})=>{let h=l.touches[s];h||(h=l.touches[s]={start:{x:(t-a)/o,y:(i-d)/r}},l.touches.length++),h.ut=!1}),Array.from(e.changedTouches).map(({clientX:t,clientY:i,identifier:s})=>{var h=l.touches[s];h.ut=!0,h.x=l.x=(t-a)/o,h.y=l.y=(i-d)/r,lt(l,n,e),m("touchChanged",e,l.touches),"onUp"==n&&(delete l.touches[s],l.touches.length--,l.touches.length||m("touchEnd"))})):(l.x=(e.clientX-a)/o,l.y=(e.clientY-d)/r,lt(l,n,e))}function ct(...t){t.flat().map(t=>{let i=t.context?t.context.canvas:h,s=x.get(i);t.dt||(t.dt=t.v,t.v=function(){s.rt.push(this),this.dt()},s.ft.push(t))})}class ut extends q{init({wt:t=0,gt:i=0,text:s,disabled:h=!1,onDown:e,onUp:n,...o}={}){super.init({wt:t,gt:i,...o}),this.yt=it({...s,context:this.context}),this.width||(this.width=this.yt.width,this.height=this.yt.height),ct(this),this.O(this.yt),this.xt=e||v,this.Mt=n||v;t=this.bt=document.createElement("button");t.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",t.textContent=this.text,h&&this.disable(),t.addEventListener("focus",()=>this.focus()),t.addEventListener("blur",()=>this.blur()),t.addEventListener("keydown",t=>this.Et(t)),t.addEventListener("keyup",t=>this.vt(t)),i=t,o=this.context.canvas,s=o.parentNode,i.setAttribute("data-kontra",""),s?(o=s.querySelector("[data-kontra]:last-of-type")||o,s.insertBefore(i,o.nextSibling)):document.body.appendChild(i),this.I(),this.W()}get text(){return this.yt.text}set text(t){this.Y=!0,this.yt.text=t}At(){this.bt.remove()}W(){this.text!=this.bt.textContent&&(this.bt.textContent=this.text),this.yt.W();var t=this.yt.width+2*this.wt,i=this.yt.height+2*this.gt;this.width=Math.max(t,this.width),this.height=Math.max(i,this.height),this.I()}v(){this.Y&&this.W(),super.v()}enable(){this.disabled=this.bt.disabled=!1,this.Tt()}disable(){this.disabled=this.bt.disabled=!0,this.Lt()}focus(){this.disabled||(this.It=!0,document.activeElement!=this.bt&&this.bt.focus(),this.Ot())}blur(){this.It=!1,document.activeElement==this.bt&&this.bt.blur(),this.St()}onOver(){this.disabled||(this.Rt=!0)}onOut(){this.Rt=!1}Tt(){}Lt(){}Ot(){}St(){}onDown(){this.disabled||(this.pressed=!0,this.xt())}onUp(){this.disabled||(this.pressed=!1,this.Mt())}Et(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}vt(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}function xt(){return new ut(...arguments)}function ft(t){var i=t.canvas;t.clearRect(0,0,i.width,i.height)}let gt={set:(t,i,s)=>(i.startsWith("_")||(t.Y=!0),Reflect.set(t,i,s))},pt={start:t=>t?1:0,center:()=>.5,end:t=>t?0:1},vt=class extends t{init({_t:t="column",align:i="start",kt:s="start",Dt:h=0,rowGap:e=0,Nt:n=1,dir:o="",Ct:r=[],...a}={}){return super.init({_t:t,align:i,kt:s,Dt:h,rowGap:e,Nt:n,dir:o,Ct:r,...a}),this.W(),new Proxy(this,gt)}O(t){this.Y=!0,super.O(t)}removeChild(t){this.Y=!0,super.removeChild(t)}v(){this.Y&&this.W(),super.v()}At(){this.children.map(t=>t.At&&t.At())}W(){this.Y=!1,this.Ct.map(t=>{t.Ft.call(this)&&this.jt!==t&&(this.jt=t).Gt.call(this)});let h=this.Ut=[],f=this.Ht=[],g=this.Vt=[],i=this.children,e=this.Wt="column"==this._t?1:"row"==this._t?i.length:this.Nt,n=0,o=0;for(let s,t=0;s=i[t];t++){h[n]=h[n]||[],s.W&&s.W();var{width:r,height:a}=s.G||s;g[n]=Math.max(g[n]||0,a);let t=s.colSpan||1,i=t;for(;f[o]=Math.max(f[o]||0,r/i),h[n][o]=s,o++<=e&&--t;);e>o||(o=0,n++)}for(;0<o&&e>o;)h[n][o++]=!1;let s=h.length,p=[].concat(this.Dt),l=[].concat(this.rowGap);this._=f.reduce((t,i)=>t+i,0);for(let t=0;e-1>t;t++)this._+=p[t%p.length];this.k=g.reduce((t,i)=>t+i,0);for(let t=0;s-1>t;t++)this.k+=l[t%l.length];this.I();var t="rtl"==this.context.canvas.dir&&!this.dir||"rtl"==this.dir;(this.Yt=t)&&(this.Ut=h.map(t=>t.reverse()),this.Ht=f.reverse(),p=p.reverse());let v=-this.anchor.y*this.height,y=[],w=[].concat(this.kt),m=[].concat(this.align);this.Ut.map((t,u)=>{let x=-this.anchor.x*this.width;t.map((d,c)=>{if(d&&!y.includes(d)){y.push(d);let t=pt[d.justifySelf||w[c%w.length]](this.Yt),i=pt[d.alignSelf||m[u%m.length]](),s=d.colSpan||1,h=f[c];if(1<s&&c+s<=this.Wt)for(let t=1;s>t;t++)h+=f[c+t]+p[(c+t)%p.length];let e=h*t,n=g[u]*i,o=0,r=0,{width:a,height:l}=d.G||d;d.anchor&&(o=d.anchor.x,r=d.anchor.y),0==t?e+=a*o:.5==t?e+=(o<.5?-1:.5==o?0:1)*a*t:e-=a*(1-o),0==i?n+=l*r:.5==i?n+=(r<.5?-1:.5==r?0:1)*l*i:n-=l*(1-r),d.x=x+e,d.y=v+n}x+=f[c]+p[c%p.length]}),v+=g[u]+l[u%l.length]})}};function a(){return new vt(...arguments)}let yt={},wt={},mt={},g={Pt:"enter",Escape:"esc",Xt:"space",ArrowLeft:"arrowleft",$t:"arrowup",ArrowRight:"arrowright",Kt:"arrowdown"};function bt(t=v,i){t.qt&&i.preventDefault(),t(i)}function Mt(t){var i=g[t.code],s=yt[i];mt[i]=!0,bt(s,t)}function Et(t){var i=g[t.code],s=wt[i];mt[i]=!1,bt(s,t)}function Vt(){mt={}}function At(t,i,{zt:s="keydown",preventDefault:h=!0}={}){let e="keydown"==s?yt:wt;i.qt=h,[].concat(t).map(t=>e[t]=i)}class St{constructor({create:t,Bt:i=1024}={}){this.T=t,this.Jt=[t()],this.size=0,this.Bt=i}get(t={}){if(this.size==this.Jt.length){if(this.size==this.Bt)return;for(let t=0;t<this.size&&this.Jt.length<this.Bt;t++)this.Jt.push(this.T())}var i=this.Jt[this.size];return this.size++,i.init(t),i}Qt(){return this.Jt.slice(0,this.size)}clear(){this.size=this.Jt.length=0,this.Jt.push(this.T())}update(i){let s,h=!1;for(let t=this.size;t--;)(s=this.Jt[t]).update(i),s.M()||(h=!0,this.size--);h&&this.Jt.sort((t,i)=>i.M()-t.M())}v(){for(let t=this.size;t--;)this.Jt[t].v()}}class Rt{constructor(i={}){var{width:t,height:s,Zt:h,ti:e,ii:n}=i,t=t*h,h=s*e,s=document.createElement("canvas");s.width=t,s.height=h,this.T=s,this.si=s.getContext("2d"),n.map(s=>{var{t,location:h}=window,h=(t?t.i.get(i):"")||h.href,e=s.source;if(e){let i=t.d[t.h(e,h)];Object.keys(i).map(t=>{s[t]=i[t]})}e=s.H;""+e===e&&(t=t.o[t.h(e,h)],s.H=t)}),Object.assign(this,{context:l(),hi:{},ei:{},Z:t,tt:h,ni:0,ri:0,ft:[],...i}),this.context&&this.W(),w("init",()=>{this.context??=l(),this.W()})}get it(){return this.ni}get st(){return this.ri}set it(t){var i=Math.max(0,this.Z-r().width);this.ni=K(0,i,t)}set st(t){var i=Math.max(0,this.tt-r().height);this.ri=K(0,i,t)}set Jt(t){this.remove(this.ft),this.add(t)}get Jt(){return this.ft}add(...t){t.flat().map(t=>{this.ft.push(t),t.parent=this})}remove(...t){t.flat().map(t=>{U(this.ft,t),t.parent=null})}v(t=this.T,i=!0){var{Y:s,context:h,it:e=0,st:n=0}=this,{width:s,height:o}=(s&&this.W(),r()),s=Math.min(t.width,s),o=Math.min(t.height,o);h.drawImage(t,e,n,s,o,0,0,s,o),i&&(h.save(),(e||n)&&h.translate(-e,-n),this.Jt.map(t=>t.v&&t.v()),h.restore())}oi(t){let{ei:i,hi:s}=this,h=s[t],e=i[t],n=void e?.getContext("2d");var o,r;e||({Z:o,tt:r}=this,n=(e=document.createElement("canvas")).getContext("2d"),e.width=o,e.height=r,i[t]=e,this.dt(h,n)),this.v(e,!1)}W(){let{si:e,ai:t=[],hi:n}=this;this.Y=!1,t.map(t=>{var{name:i,data:s,visible:h}=t;t.Y=!1,n[i]=t,s&&0!=h&&this.dt(t,e)})}dt(t,l){let{opacity:i,data:s=[]}=t,{ii:d,width:c,Zt:u,ti:x}=this;l.save(),l.globalAlpha=i,s.map((s,t)=>{if(s){let i;for(let t=d.length-1;0<=t&&s/(i=d[t]).ci<1;t--);var{H:h,margin:e=0,ci:n,columns:o}=i,n=s-n,o=o??h.width/(u+e)|0,r=t%c*u,t=(t/c|0)*x,a=n%o*(u+e),n=(n/o|0)*(x+e);l.drawImage(h,a,n,u,x,r,t,u,x)}}),l.restore()}}function i(t){return[8*t%88,8*Math.floor(t/11),8,8]}const p={li:i(0),ui:i(1),di:i(2),fi:i(3),pi:i(4),wi:i(5),gi:i(6),yi:i(7),xi:i(11),mi:i(12),Mi:i(28),bi:i(29),Ei:i(37),vi:[25,25,6,6],Ai:i(9),Ti:i(10),Li:[41,25,6,6],range:[65,17,6,6],Ii:[73,9,6,6],Oi:[65,9,6,6],Si:[81,17,6,6],Ri:i(43),_i:i(31)},b=new URL("i.png",location.href).href,Ot=(p.gi,p.yi,p.xi,p.mi,{columns:11,H:b,ti:8,Zt:8});function M(...t){return E.play(...t)}const E={volume:.3,sampleRate:44100,x:new AudioContext,play(...t){return this.ki(this.Di(...t))},ki(...t){const s=this.x.createBuffer(t.length,t[0].length,this.sampleRate),i=this.x.createBufferSource();return t.map((t,i)=>s.getChannelData(i).set(t)),i.buffer=s,i.connect(this.x.destination),i.start(),i},Di(t=1,i=.05,s=220,h=0,e=0,n=.1,o=0,r=1,a=0,l=0,d=0,c=0,u=0,x=0,f=0,g=0,p=0,v=1,y=0,w=0){let m,b,M=2*Math.PI,E=this.sampleRate,V=a*=500*M/E/E,A=s*=(1+2*i*Math.random()-i)*M/E,S=[],R=0,O=0,T=0,I=1,H=0,L=0,B=0;for(l*=500*M/E**3,f*=M/E,d*=M/E,c*=E,u=u*E|0,b=(h=h*E+9)+(y*=E)+(e*=E)+(n*=E)+(p*=E)|0;b>T;S[T++]=B)++L%(100*g|0)||(B=o?1<o?2<o?3<o?Math.sin((R%M)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/M%2+2)%2:1-4*Math.abs(Math.round(R/M)-R/M):Math.sin(R),B=(u?1-w+w*Math.sin(M*T/u):1)*(0<B?1:-1)*Math.abs(B)**r*t*this.volume*(h>T?T/h:h+y>T?1-(T-h)/y*(1-v):h+y+e>T?v:b-p>T?(b-T-p)/n*v:0),B=p?B/2+(p>T?0:(b-p>T?1:(b-T)/p)*S[T-p|0]/2):B),m=(s+=a+=l)*Math.cos(f*O++),R+=m-m*x*(1-1e9*(Math.sin(T)+1)%2),I&&++I>c&&(s+=d,A+=d,I=0),!u||++H%u||(s=A,a=V,I=I||1);return S},Ni:(t=0,i=440)=>i*2**(t/12)};class Tt{constructor(t){this.width=t.width,this.height=t.height,this.points=[];for(let i=0;i<this.width;i++){this[i]=[];for(let t=0;t<this.height;t++){var s={x:i,y:t,Ci:[],Fi:!1,ji:null,Gi:!1,Ui:1/0,Hi:[]};this[i][t]=s,this.points.push(s)}}this.Vi=this[20][13]}init(){this.points.forEach(t=>{0<t.y&&t.Ci.push(this[t.x][t.y-1]),t.x<this.width-1&&t.Ci.push(this[t.x+1][t.y]),t.y<this.height-1&&t.Ci.push(this[t.x][t.y+1]),0<t.x&&t.Ci.push(this[t.x-1][t.y])});for(var[t,i]of L.Wi.ai[0].data.entries()){var s=t%this.width,t=Math.floor(t/this.width);[34,35,36].includes(i)?this[s][t].Fi=!0:[16,17,18,19,22,23,24,25,26,27,28].includes(i)&&(this[s][t].Gi=!0)}this.Yi()}Yi(){this.points.forEach(t=>{t.Ui=1/0}),this.Vi.Ui=0;const t=[this.Vi],i=[this.Vi];for(;t.length;){var s=t.shift();for(const h of s.Ci)i.includes(h)||h.Fi||(h.Ui=s.Ui+1,t.push(h),i.push(h))}this.points.forEach(t=>{const i=Math.min(...t.Ci.map(t=>t.Ui));t.Hi=t.Ci.filter(t=>t.Ui==i)}),L.text=[];for(const t of i)L.text.push(it({text:t.Ui,font:"6px Arial",color:"white",x:8*t.x+4,y:8*t.y+4,anchor:{x:.5,y:.5},textAlign:"center"}))}}const It={height:17,ai:[{data:[35,34,35,35,35,34,35,0,15,14,0,0,0,24,0,15,0,35,35,34,34,34,34,35,34,35,34,34,35,34,34,0,0,0,0,35,0,0,24,0,0,0,0,34,34,35,34,35,35,34,34,35,35,0,0,0,0,0,0,0,15,34,0,24,0,0,0,0,0,0,0,34,34,34,34,35,34,35,0,0,0,0,14,14,0,0,0,0,24,0,36,15,14,0,0,0,0,34,34,34,35,34,0,0,0,0,0,35,0,0,25,23,23,28,0,0,0,14,34,34,0,0,0,35,35,35,0,0,0,14,0,34,35,35,0,24,0,0,0,0,35,34,34,35,35,34,15,14,34,34,34,0,0,0,15,34,34,35,35,0,24,15,0,35,35,35,35,35,35,35,0,0,14,0,35,0,0,0,0,0,0,34,34,0,0,24,14,14,0,34,34,35,35,0,0,0,0,0,0,34,23,23,23,23,23,26,34,36,0,0,24,0,0,0,0,14,15,0,0,0,14,0,0,0,34,14,0,0,0,34,24,35,0,0,0,22,23,23,23,23,26,0,0,0,15,14,14,0,0,34,0,0,0,34,34,24,0,0,0,0,24,35,0,0,0,24,0,0,0,0,0,0,0,0,34,0,0,14,34,34,27,23,23,23,23,28,34,15,15,0,24,0,14,15,0,0,0,0,34,34,0,0,0,0,34,35,0,14,0,0,34,34,0,0,0,24,0,0,0,0,0,0,15,35,34,34,0,0,15,14,0,0,15,14,0,36,34,35,0,0,27,23,23,23,17,0,0,34,35,34,34,35,35,0,0,0,0,36,15,0,0,34,35,35,0,0,0,0,0,0,0,34,35,35,34,34,34,34,34,34,35,35,0,0,0,0,15,0,0,0,0,15,0,0,35,35,34,35,34,35,34,35,34,35,35,34,34,35,35,35,35,34,34,34,34,34,34,34,35,34,34,35,35,34,34]}],ti:8,ii:[{ci:1,source:"ts"}],Zt:8,width:25};function V(t){return t[z(0,t.length-1)]}function A(t,i){return[8*Math.floor(t/8),8*Math.floor(i/8)]}function Ht(t,i){i=t.indexOf(i);i<0||t.splice(i,1)}function Lt(t,i,s){var h=t.x-i.x,t=t.y-i.y;return h*h+t*t<=s*s}function S(t,i){return X(t,i,Math.random())}function Bt(i,s){for(let t=0;t<10;t++)L.Pi.get({x:i,y:s,floor:s+4,width:1,height:1,color:"#b74132",dx:S(-.3,.3),dy:S(-.5,.1),m:.02,u:S(5,30),update(){this.advance(),this.y>this.floor&&(this.y=this.floor,this.dy=0,this.m=0)}})}E.volume=.4;const Ct=t=>M(t,.15,166,.05,.06,.05,void 0,.7,-1.6,void 0,void 0,void 0,void 0,3,2);function Wt(){var t=Math.random();t<.3?M(.2,.5,289,.02,void 0,.07,3,.39,-6.4,void 0,void 0,void 0,void 0,.5,34,.1,.02,.91,.04,.15):t<.6?M(.25,.8,400,.02,void 0,.07,void 0,void 0,-6.4,void 0,void 0,void 0,void 0,5,30,void 0,void 0,void 0,.04):M(.3,.5,150,.05,void 0,.05,void 0,1.3,void 0,void 0,void 0,void 0,void 0,3)}function R(t,i){i=n({x:1,y:9,Xi:i.max,max:i.max,$i:"red",Ki:"green",...i,qi(){var s=t();if(0<s&&s<this.max){let{x:t,y:i}=this.G;this.context.fillStyle=this.$i,this.context.fillRect(t,i,6,1),this.context.fillStyle=this.Ki,this.context.fillRect(t,i,Math.round(s/this.max*6),1)}}});return L.Bi.zi.push(i),i}const Ut={[p.ui]:1.5,[p.wi]:2.5,[p.pi]:3.5,[p.Mi]:0},Dt={[p.ui]:2,[p.wi]:5,[p.pi]:3,[p.Mi]:1},Yt={[p.ui]:10,[p.wi]:20,[p.pi]:8,[p.Mi]:30},jt={[p.ui]:3,[p.wi]:6,[p.pi]:2,[p.Mi]:0},Nt={[p.ui]:30,[p.wi]:60,[p.pi]:60,[p.Mi]:1/0},Jt={MNWTVY:6,"I1L<>":4,"!":2},kt={};for(var Pt in Jt)for(var Ft of Pt)kt[Ft]=Jt[Pt];function O(t,i,h){let e=i,n=h;for(const h of t)if("\n"===h)e=i,n+=7;else if(" "==h)e+=2;else{let t=function(t){if("!"==t)return 0;if("%"==t)return 37;let i=t.charCodeAt(0)-47;return 17<i&&(i-=7),i}(h),i=t%19*5+0,s=6*(t/19|0)+32;"<"==h?(i=90,s=20):">"==h&&(i=90,s=26);var o=e,r=n;y.drawImage(c[b],i,s,5,6,o,r,5,6),e+=kt[h]??5}}function T(t){let i=0,s=7,h=0,e=0;for(const n of t)"\n"===n?(i=0,s+=7):i+=" "==n?2:kt[n]??5,h=Math.max(h,i),e=Math.max(e,s);return{x:h-1,y:e-1}}function I(t,i,s){var h=T(t);return n({text:t,x:i,y:s,width:h.x%2?h.x+1:h.x,height:h.y%2?h.y+1:h.y,Ji(t){t=T(this.text=t);this.width=t.x%2?t.x+1:t.x,this.height=t.y%2?t.y+1:t.y},v(){O(this.text,i,s)}})}class Gt extends ut{constructor(r){super({text:{font:"0px none"},H:c[b],V:r,disabled:!0}),this.Qi=o({x:4,y:r==p.Mi?-18:-39,v(){var t=Dt[r].toString(),i=Yt[r].toString(),s=jt[r].toString(),h=Math.floor(Ut[r]).toString(),e=""+Nt[r]/10,n=r==p.Mi?Math.max(T(t).x,T(i).x):Math.max(T(t).x,T(i).x,T(s).x,T(h).x,T(e).x),o=Math.floor(n/-2)-6;this.context.fillStyle="rgb(70, 70, 70)",this.context.fillRect(o,0,12+n,r==p.Mi?16:37),this.context.drawImage(c[b],...p.vi,2+o,2,6,6),this.context.drawImage(c[b],...p.Oi,2+o,9,6,6),O(t,10+o,2),O(i,10+o,9),r!=p.Mi&&(this.context.drawImage(c[b],...p.Li,2+o,16,6,6),this.context.drawImage(c[b],...p.range,2+o,23,6,6),this.context.drawImage(c[b],...p.Ii,2+o,30,6,6),O(s,10+o,16),O(h,10+o,23),O(e,10+o,30))}})}onDown(){this.disabled||(L.Bi.selected=this.V)}A(){this.Rt&&(this.context.fillStyle="rgba(255, 255, 255, 0.1)",this.context.fillRect(-1,-1,this.width+2,this.height+2),this.Qi.v()),L.Bi.selected==this.V&&(this.context.fillStyle="rgba(255, 255, 255, 0.2)",this.context.fillRect(-1,-1,this.width+2,this.height+2)),super.A()}}class _t extends ut{constructor(){super({text:{font:"0px none"},H:c[b],V:p.Ai})}onDown(){L.Bi.selected=p.Ai}A(){this.Rt&&(this.context.fillStyle="rgba(255, 255, 255, 0.1)",this.context.fillRect(-1,-1,this.width+2,this.height+2)),L.Bi.selected==this.V&&(this.context.fillStyle="rgba(255, 255, 255, 0.2)",this.context.fillRect(-1,-1,this.width+2,this.height+2)),super.A()}}class zt{selected=null;zi=[];init(){this.Zi=o({H:c[b],V:p.ui}),this.ts=n({ss:[],visible:!0,setRadius(s){if(this.ss=[],0!=s){var h=Math.ceil(-s),e=Math.floor(s),t=Math.ceil(-s),n=Math.floor(s);for(let i=t;n>=i;i++)for(let t=h;e>=t;t++)Lt(this.position,{x:i,y:t},s)&&this.ss.push({x:i,y:t})}},v(){this.visible&&this.parent.y<r().height-16&&(l().fillStyle="rgba(255, 0, 0, 0.3)",this.ss.forEach(({x:t,y:i})=>{l().fillRect(...A(8*t,8*i),8,8)}))}}),this.Zi.O(this.ts),this.hs=o({H:c[b],V:p.Ti,visible:!1,v(){this.visible&&this.A()}}),this.Zi.O(this.hs);var t=new Gt(p.ui),i=new Gt(p.pi),s=new Gt(p.wi),h=new Gt(p.Mi),e=new _t,t=(this.toolbar=o({y:r().height-8,width:r().width,height:16,anchor:{x:0,y:.5},color:"rgb(60, 60, 60)"}),a({anchor:{x:.5,y:.5},_t:"row",Dt:2,children:[t,i,s,h,e]}));this.es=o({x:r().width/2,y:this.toolbar.y,width:t.width+4,height:12,anchor:{x:.5,y:.5},color:"rgb(70, 70, 70)"}),this.es.O(t),this.ns=o({x:r().width-4,y:this.toolbar.y,width:36,height:10,anchor:{x:1,y:.5},color:"rgb(70, 70, 70)"}),this.ns.O(o({x:-34,H:c[b],V:[1,1,6,6],anchor:{x:0,y:.5}}),o({x:-26,width:24,height:6,anchor:{x:0,y:.5},color:"rgb(65, 65, 65)"}),o({x:-26,height:6,anchor:{x:0,y:.5},color:"rgb(182, 65, 50)"})),this.rs=o({x:4,y:this.toolbar.y,width:36,height:10,anchor:{x:0,y:.5},color:"rgb(70, 70, 70)"}),this.rs.O(o({x:2,H:c[b],V:p.vi,anchor:{x:0,y:.5}})),this.os=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},lines:["THE YEAR IS 1258","THE MONGOL EMPIRE IS RAPIDLY\nEXPANDING WEST","AN ATTACK IS IMMINENT","WE MUST PROTECT THE TREASURE!","CLICK TO BEGIN"],cs:240,next(){this.removeChild(this.children[0]);var t=this.lines.shift();this.O(I(t,0,0)),this.cs=this.lines.length?240:1/0},v(){this.context.fillStyle="#464646",this.context.fillRect(-4,-4,this.width+8,this.height+8),this.A()}}),this.os.next(),this.ls=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},cs:300,rowGap:2,kt:"center",children:[I("WAVE 0 FINISHED",0,0),I("NEXT WAVE IN 5",0,0)],update(){this.children[0].Ji(`WAVE ${L.ds.us} FINISHED`),this.children[1].Ji("NEXT WAVE IN "+Math.ceil(this.cs/60))},v(){this.context.fillStyle="#464646",this.context.fillRect(-4,-4,this.width+8,this.height+8),this.A()}}),this.fs=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},rowGap:3,kt:"center",children:[I("GAME OVER",0,0),I("THE MONGOLS HAVE DEFEATED YOU!",0,0),I("1",0,0),I("1",0,0),I("1",0,0)],Ji(){this.children[2].Ji(`YOU SURVIVED ${L.ds.us-1} WAVE`+(L.ds.us-1==1?"":"S")),this.children[3].Ji(`RECRUITED ${L.ps} TROOPS`),this.children[4].Ji(`AND KILLED ${L.ws} INVADERS`)},v(){this.context.fillStyle="#464646",this.context.fillRect(-4,-4,this.width+8,this.height+8),this.A()}}),this.gs=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},rowGap:2,kt:"center",children:[I("YOU WIN!",0,0),I("WE HAVE DEFENDED AGAINST THE MONGOLS",0,0),I("THE TREASURE IS SAFE FOR NOW",0,0),I("1",0,0)],Ji(){this.children[3].Ji(`YOU KILLED ${L.ws} INVADERS`),this.Y=!0},v(){this.context.fillStyle="#464646",this.context.fillRect(-4,-4,this.width+8,this.height+8),this.A()}}),this.ys=xt({width:40,height:10,color:"#464646",onOver(){this.color="#595959"},onOut(){this.color="#464646"},onDown(){L.xs()},v(){this.A(),O("RESTART",2,2)}}),this.Ms=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},kt:"center",rowGap:22,children:[this.gs,this.ys]}),this.bs=a({x:r().width/2,y:r().height/2,anchor:{x:.5,y:.5},kt:"center",rowGap:6,children:[this.fs,this.ys]}),this.Es=xt({text:{font:"0px none"},x:196,y:4,anchor:{x:1,y:0},H:c[b],V:p.Ri,onDown(){E.volume=E.volume?0:.4,this.V=E.volume?p.Ri:p._i},v(){this.Rt?this.context.fillStyle="#595959":this.context.fillStyle="#464646",this.context.fillRect(-2,-2,this.width+4,this.height+4),this.A()}}),this.vs=a({x:5,y:5,kt:"center",children:[I("WAVE 1",0,0)],Ji(){this.children[0].Ji("WAVE "+L.ds.us),this.Y=!0},v(){this.context.fillStyle="#464646",this.context.fillRect(-3,-3,this.width+6,this.height+6),this.A()}})}update(){0==L.state&&--this.os.cs<0&&this.os.next()}v(){var t,i,s;null!=this.selected&&this.selected!=p.Ai&&(s=r(),[s,t]=A((s=x.get(s)).x,s.y),(i=L.grid[s/8][t/8])?.Fi||i?.ji||i==L.grid.Vi?(this.ts.visible=!1,this.hs.visible=!0):(this.ts.visible=!0,this.hs.visible=!1),this.Zi.x=s,this.Zi.y=t,this.Zi.V=this.selected,this.Zi.v(),this.ts.setRadius(Ut[this.selected])),this.toolbar.v(),this.es.v(),this.ns.children[2].width=Math.max(0,Math.round(X(0,24,L.ns/L.As))),this.ns.v(),this.rs.v(),O(L.Ts.toString(),14,141),0==L.state&&this.os.v(),this.zi.forEach(t=>t.qi()),this.Es.v(),this.vs.v()}}const Xt={[p.gi]:5,[p.yi]:10,[p.mi]:8,[p.xi]:20},Kt={[p.gi]:20,[p.yi]:50,[p.mi]:30,[p.xi]:80},Zt={[p.gi]:1,[p.yi]:3,[p.mi]:2,[p.xi]:5},$t={[p.gi]:40,[p.yi]:35,[p.mi]:25,[p.xi]:60},qt=[[0,72],[104,0],[24,16]],Qt=[{type:p.yi,Ui:2},{type:p.mi,Ui:3},{type:p.xi,Ui:5},{type:p.gi,Ui:1}],ti=[{type:[100,180],Ui:1},{type:[60,160],Ui:2},{type:[40,100],Ui:5},{type:[30,60],Ui:10}];class H{constructor(t,i){this.Ls=i,this.Is=t,this.Os=0}update(){var t;!this.Ss()&&--this.Os<=0&&(this.Os=z(...this.Is),t=V(this.Ls),L.Rs(function(t,i,s){const h=Math.max(.06*Math.E**(.22*L.ds.us)+.8,1),e=o({x:i,y:s,H:c[b],V:t,_s:Xt[t]*h,ks:Xt[t]*h,Ds:Kt[t],Ns:Kt[t],Cs:$t[t],Fs:0,Li:Zt[t]*h,update(){var t=L.grid[this.x/8][this.y/8],i=V(t.Hi);if(i==L.grid.Vi){if(!(0<--this.Fs)){this.Fs=this.Cs,L.ns-=this.Li;var s=8*i.x+4,h=8*i.y+4;for(let t=0;t<10;t++)L.Pi.get({x:s,y:h,floor:4+h,width:2,height:2,color:"#ebb85b",dx:S(-.3,.3),dy:S(-.5,.1),m:.02,u:S(20,40),update(){this.advance(),this.y>this.floor&&(this.y=this.floor,this.dy=0,this.m=0)}});Wt()}}else i.ji?.js?0<--this.Fs||(this.Fs=this.Cs,i.ji._s-=this.Li,Wt(),([p.Mi,p.bi].includes(i.ji.V)?function(i,s){for(let t=0;t<10;t++)L.Pi.get({x:i,y:s,floor:s+4,width:1,height:1,color:"#6f6e72",dx:S(-.3,.3),dy:S(-.5,.1),m:.02,u:S(5,30),update(){this.advance(),this.y>this.floor&&(this.y=this.floor,this.dy=0,this.m=0)}})}:Bt)(i.ji.x+4,i.ji.y+4),0<i.ji._s)||(L.Gs(i.ji),L.Us++):0<--this.Ns||i.ji||(this.Ns=this.Ds,this.x=8*i.x,this.y=8*i.y,t.ji=null,(i.ji=this).V==p.gi||this.V==p.mi?Ct(.05):this.V==p.yi?Ct(.1):Ct(.15))}});return e.O(R(()=>e._s,{max:e.ks})),e.O(R(()=>e.Fs,{y:8,max:e.Cs,$i:"transparent",Ki:"white"})),e}(t.type,...V(qt))),0<--t.count||Ht(this.Ls,t))}Ss(){return!this.Ls.length}}class ii{constructor(){this.us=0,this.list=[new H([180,180],[{type:p.yi,count:2}]),new H([120,240],[{type:p.yi,count:3},{type:p.mi,count:2}]),new H([60,120],[{type:p.gi,count:8}]),new H([30,30],[{type:p.xi,count:2}]),new H([120,180],[{type:p.yi,count:4},{type:p.xi,count:2}]),new H([60,120],[{type:p.gi,count:6},{type:p.yi,count:4},{type:p.mi,count:2}])]}next(){if(this.us++,this.list.length)return this.list.shift();let i,t=32*Math.E**(.1*this.us)-38;i=this.us<8?V(ti):this.us<10?V(ti.slice(1)):this.us<12?V(ti.slice(2)):ti[3],t-=i.Ui;for(var s=[];0<t;){const i=V(Qt);t-=i.Ui;var h=s.find(t=>t.type==i.type);h?h.count++:s.push({type:i.type,count:1})}return new H(i.type,s)}Ss(){return 0==this.list.length}}let L=new class{constructor(){this.Hs=[],this.Vs=[],this.text=[],this.debug=!1,this.Bi=new zt,this.state=0,this.Ws=0,this.ns=20,this.As=20,this.Ts=6,this.ws=0,this.ps=0,this.Us=0}init(){this.Wi=function(){return new Rt(...arguments)}(It),this.grid=new Tt(this.Wi),this.grid.init(),this.Bi.init(),this.ds=new ii,this.Ys=this.ds.next(),this.Pi=function(){return new St(...arguments)}({create:o}),this.li=o({x:8*this.grid.Vi.x,y:8*this.grid.Vi.y,H:c[b],V:p.li}),this.Wi.add(this.li),At("d",()=>{this.debug=!this.debug}),At("esc",()=>{1==this.state&&(this.Bi.selected=null)});const e=(t,i)=>{var s=this.grid[t/8][i/8-1].ji,s=(s?.V==p.Mi&&(s.V=p.bi),this.grid[t/8][i/8+1].ji);s?.V!=p.Mi&&s?.V!=p.bi||(this.Vs[this.Vs.length-1].V=p.bi)};var t=t=>{var i,s,h;0==this.state?(E.x.resume(),this.Bi.os.lines.length?this.Bi.os.next():this.state=1):1==this.state&&([i,s]=A(t.offsetX/r().scale,t.offsetY/r().scale),h=this.grid[i/8][s/8],this.Bi.selected&&0==t.button&&h&&!h.Fi&&h!=this.grid.Vi?this.Bi.selected==p.Ai&&h.ji?.js?(this.Gs(h.ji),this.Ts++):h.ji||(this.Bi.selected==p.Mi?this.Ps(this.Bi.selected,i,s)&&e(i,s):this.Ps(this.Bi.selected,i,s)):2==t.button&&(this.Bi.selected=null))};st.onDown=t}xs(){this.ns=20,this.Ts=6,this.ws=0,this.ps=0,this.Us=0,this.ds=new ii,this.Ys=this.ds.next(),this.state=1,this.li.V=p.li;for(let t=this.Hs.length-1;0<=t;t--)this.Gs(this.Hs[t]);for(let t=this.Vs.length-1;0<=t;t--)this.Gs(this.Vs[t])}Rs(t){this.Hs.push(t),this.Wi.add(t);var[i,s]=A(t.x,t.y);this.grid[i/8][s/8].ji=t}Ps(t,h,e){var i,s;return this.Ts>=Dt[t]&&(t=function(t){const i=o({x:h,y:e,H:c[b],V:t,Xs:Ut[t],Fs:0,Cs:Nt[t],Ui:Dt[t],_s:Yt[t],ks:Yt[t],js:!0,Li:jt[t],$s(){let t=(8*this.Xs)**2,i=null;for(const s of L.Hs)t>Math.abs((this.x-s.x)**2+(this.y-s.y)**2)&&(i=s);return i},onOver(){s.visible=!0,this.Rt=!0},onOut(){s.visible=!1,this.Rt=!1},update(){var t;--this.Fs<=0&&(t=this.$s(this))&&(this.Fs=this.Cs,t._s-=this.Li,Bt(t.x+4,t.y+4),Wt(),0<t._s||(L.Gs(t),L.Ts+=1,L.ws++))},v(){this.A(),this.Rt&&L.Bi.selected==p.Ai&&this.context.drawImage(c[b],...p.Ti,0,0,p.Ti[2],p.Ti[3])}}),s=(ct(i),n({ss:[],visible:!0,setRadius(s){if(this.ss=[],0!=s){var h=Math.ceil(-s),e=Math.floor(s),t=Math.ceil(-s),n=Math.floor(s);for(let i=t;n>=i;i++)for(let t=h;e>=t;t++)Lt(this.position,{x:i,y:t},s)&&this.ss.push({x:i,y:t})}},v(){this.visible&&this.parent.y<r().height-16&&(l().fillStyle="rgba(255, 0, 0, 0.3)",this.ss.forEach(({x:t,y:i})=>{l().fillRect(...A(8*t,8*i),8,8)}))}}));return s.setRadius(i.Xs),s.visible=!1,i.O(s),i.O(R(()=>i._s,{max:i.ks})),i.O(R(()=>i.Fs,{y:8,max:i.Cs,$i:"transparent",Ki:"white"})),i}(t),[i,s]=(this.Ts-=t.Ui,this.Vs.push(t),this.Wi.add(t),A(h,e)),this.grid[i/8][s/8].ji=t,this.ps++,M(.3,.01,300,void 0,.02,.02,void 0,void 0,void 0,-6.4,void 0,void 0,void 0,void 0,void 0,void 0,void 0,.26,.01),!0)}Gs(i){[i].flat().map(t=>{var i=t.context?t.context.canvas:r(),i=x.get(i);t.v=t.dt,t.dt=0,U(i.ft,t)}),Ht(this.Hs,i),Ht(this.Vs,i),this.Wi.remove(i);var[t,s]=A(i.x,i.y);if(this.grid[t/8][s/8].ji=null,i.V==p.Mi||i.V==p.bi){const i=this.grid[t/8][s/8-1].ji;i?.V==p.bi&&(i.V=p.Mi)}for(let t=this.Bi.zi.length-1;0<=t;t--)this.Bi.zi[t].parent==i&&this.Bi.zi.splice(t,1);[p.ui,p.pi,p.wi].includes(i.V)&&(t=i.x+1,s=i.y+1,L.Pi.get({x:t,y:s,H:c[b],V:p.Si,u:60,dy:-.1,opacity:.4,color:null,update(){this.advance(),this.opacity-=.006},v(){this.context.translate(0,Math.round(this.y)-this.y),this.A()}}))}update(){if(1==this.state){for(let t=this.Hs.length-1;0<=t;t--)this.Hs[t].update();for(let t=this.Vs.length-1;0<=t;t--)this.Vs[t].update();if(this.Ys.update(),!(0<this.ns)){this.state=3;{var i=8*this.grid.Vi.x+4;var s=8*this.grid.Vi.y+4;for(let t=0;t<60;t++)L.Pi.get({x:i,y:s,floor:4+s,Ks:!1,width:2,height:2,color:"#ebb85b",dx:S(-.4,.4),dy:S(-.8,.1),m:.01,u:1/0,update(){this.Ks?this.g=-.1*this.dx:this.g=-.01*this.dx,0!=this.dx&&Math.abs(this.dx)<.01&&(this.dx=0,this.g=0),this.advance(),this.y>this.floor&&(this.Ks=!0,this.y=this.floor,this.dy=0,this.m=0,this.u=S(60,120))}})}this.li.V=p.Ei}this.Ys.Ss()&&!this.Hs.length&&(300==this.Bi.ls.cs&&M(.2,void 0,20,.04,void 0,.6,void 0,1.31,void 0,void 0,-990,.06,.17,void 0,void 0,.04,.07),this.Bi.ls.update(),--this.Bi.ls.cs<0)&&(this.Ys=this.ds.next(),this.Bi.ls.cs=300,this.Bi.vs.Ji())}this.Pi.update(),this.Bi.update(),this.state!=this.Ws&&(1==this.state&&(this.Bi.es.children[0].children.forEach(t=>t.disabled=!1),this.Bi.Es.disabled=!1),3==this.state)&&(M(.5,0,440,.1,.3,1,1,.6,-.5,-.3,void 0,void 0,void 0,.4,7,void 0,void 0,void 0,.1,.2),this.Bi.selected=null,this.Bi.es.children[0].children.forEach(t=>t.disabled=!0),this.Bi.fs.Ji()),this.Ws=this.state}v(){l().fillStyle="#7e9432",l().fillRect(0,0,r().width,r().height),this.Wi.v(),this.Pi.v(),this.Bi.v(),1==this.state?this.Ys.Ss()&&!this.Hs.length&&this.Bi.ls.v():2==this.state?this.Bi.Ms.v():3==this.state&&this.Bi.bs.v()}},B=([{qs:C=!1}={}]=[],h=document.getElementById(void 0)||document.querySelector("canvas"),C&&(h=h||new Proxy({},D)),(y=h.getContext("2d")||new Proxy({},D)).imageSmoothingEnabled=!1,m("init"),{canvas:h,context:y}).canvas;var si;function hi(){var t=window.innerWidth/B.width,i=window.innerHeight/B.height;let s=Math.min(t,i);1<s&&(s=Math.min(Math.floor(s),6)),B.style.width=s*B.width+"px",B.style.height=s*B.height+"px",B.scale=s}{let t;for(t=0;t<26;t++)g["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)g["Digit"+t]=g["Numpad"+t]=""+t;window.addEventListener("keydown",Mt),window.addEventListener("keyup",Et),window.addEventListener("blur",Vt)}{var[{ht:C,canvas:W=h}]=[{ht:1}];let i=x.get(W);i||(si=window.getComputedStyle(W),i={x:0,y:0,ht:C,touches:{length:0},canvas:W,rt:[],nt:[],ft:[],et:null,J:si},x.set(W,i)),W.addEventListener("mousedown",nt),W.addEventListener("touchstart",nt),W.addEventListener("mouseup",ot),W.addEventListener("touchend",ot),W.addEventListener("touchcancel",ot),W.addEventListener("blur",at),W.addEventListener("mousemove",rt),W.addEventListener("touchmove",rt),i.X||(i.X=!0,w("tick",()=>{i.nt.length=0,i.rt.map(t=>{i.nt.push(t)}),i.rt.length=0}))}B.width=200,B.height=152,B.oncontextmenu=()=>!1,window.addEventListener("resize",()=>hi()),hi(),e[new URL("ts",location.href).href]=Ot,C=[b],_(),Promise.all(C.map(t=>{var a,n,i=F([].concat(t)[0]);{if(i.match(Y))return n=t,_(),new Promise((t,i)=>{let s,h,e;if(s=P("",n),c[s])return t(c[s]);(h=new Image).onload=function(){e=d(s,window.location.href),m("assetLoaded",c[G(n)]=c[s]=c[e]=this,n),t(this)},h.onerror=()=>{i(s)},h.src=s});if(i.match(j))return a=t,new Promise((t,i)=>{let s,h,e,n,o=a,r;return s=new Audio,h={zs:(r=s).canPlayType('audio/wav; codecs="1"'),Bs:r.canPlayType("audio/mpeg;"),Js:r.canPlayType('audio/ogg; codecs="vorbis"'),Qs:r.canPlayType("audio/aac;")},(a=[].concat(a).reduce((t,i)=>t||(h[F(i)]?i:null),0))?(e=P("",a),u[e]?t(u[e]):(s.addEventListener("canplay",function(){n=d(e,window.location.href),m("assetLoaded",u[G(a)]=u[e]=u[n]=this,a),t(this)}),s.onerror=()=>{i(e)},s.src=e,void s.load())):i(o)});{var h=t;let i,s;return _(),i=P("",h),e[i]?Promise.resolve(e[i]):fetch(i).then(t=>{if(t.ok)return t.clone().json().catch(()=>t.text());throw t}).then(t=>(s=d(i,window.location.href),"object"==typeof t&&k.set(t,s),m("assetLoaded",e[G(h)]=e[i]=e[s]=t,h),t))}}})).then(()=>{L.init(),function({Zs:t=60,th:i=!0,update:s,v:h,context:e=y,blur:n=!1}){let o,r,a,l,d,c=0,u=1e3/t,x=1/t,f=i?ft:v,g=!0;function p(){if(r=requestAnimationFrame(p),g&&(a=performance.now(),l=a-o,o=a,l<=1e3)){for(m("tick"),c+=l;c>=u;)d.update(x),c-=u;f(d.context),d.v()}}return n||(window.addEventListener("focus",()=>{g=!0}),window.addEventListener("blur",()=>{g=!1})),w("init",()=>{d.context??=y}),d={update:s,v:h,ih:!0,context:e,start(){o=performance.now(),this.ih=!1,requestAnimationFrame(p)},stop(){this.ih=!0,cancelAnimationFrame(r)}}}({update(){L.update()},v(){L.v()}}).start()})</script>