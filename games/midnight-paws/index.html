<!doctype html><meta name=viewport content="width=device-width"><title>Midnight Paws - js13kGames 2025</title><style>body,html{margin:0;padding:0;overflow:hidden}body{background-color:#000}</style><canvas><script>!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],e=[,.2,1e3,.02,,.01,2,,18,,475,.02,.01],i=[1.4,,185,,,,3,1.6,-7,,,,,,,,.19,.1,,.38,985],a={i:[3,255,128,0,2,255,128,6,0,0,0,8,43,0,0,0,0,61,4,1,2,109,86,7,32,0,3,67,2],p:[27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},s={i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},n={i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},r={i:[1,128,119,0,1,130,116,9,0,29,128,22,150,0,203,1,0,69,3,1,1,0,0,0,13,0,0,0,0],p:[6,,6,,6,,6,,6,,6,,6,,6],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]},{n:[141],f:[]}]},o={i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,,,,,1,,,,1],c:[{n:[147],f:[]}]},h={i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,,,,,,,,1,1,1,1,1,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},l={i:[1,128,119,0,1,130,116,9,0,29,128,22,52,0,203,1,0,69,3,1,1,0,0,0,13,0,0,0,0],p:[,2,,1,,2,,1,,2,,1,,2,,1],c:[{n:[137,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146],f:[]},{n:[146,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]}]},c={songData:[a,s,n,r,o,h,l,l],rowLen:4725,patternLen:32,endPattern:15,numChannels:8},f={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,192,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[2,1,2,3,2,1,2,3,4,1,2,3,2,1,2,3],c:[{n:[146,158,146,146,158,146,158,146,134,158,146,158,146,146,158,146,149,161,149,149,161,149,161,149,125,161,149,161,149,149,161,149],f:[]},{n:[141,153,141,141,153,141,153,141,129,153,141,153,141,141,153,141,153,141,141,153,141,153,141,141,129,141,153,141,141,153,141,153],f:[]},{n:[137,149,137,137,149,137,149,137,125,149,137,149,137,137,149,137,146,158,146,146,158,146,158,146,122,158,146,158,146,146,158,146],f:[]},{n:[141,153,141,141,153,141,153,141,129,153,141,153,141,141,153,141,153,141,141,153,141,153,141,141,129,141,153,141,141,153,141,153],f:[]}]},a,s,n,r,o,h,{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]},l],rowLen:4725,patternLen:32,endPattern:15,numChannels:9};function d(){var t,e,i,a,s,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},o=function(t,e,i){var a,s,n,o,l,c,f=h[t.i[0]],d=t.i[1],u=t.i[3]/32,m=h[t.i[4]],y=t.i[5],g=t.i[8]/32,w=t.i[9],p=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,b=t.i[12]*t.i[12]*4,M=1/b,x=-t.i[13]/16,S=t.i[14],T=i*2**(2-t.i[15]),P=new Int32Array(p+v+b),I=0,k=0;for(a=0,s=0;a<p+v+b;a++,s++)s>=0&&(s-=T,l=r(e+(15&(S=S>>8|(255&S)<<4))+t.i[2]-128),c=r(e+(15&S)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,a<p?n=a/p:a>=p+v&&(n=(1-(n=(a-p-v)*M))*3**(x*n)),o=f(I+=l*n**u)*d,o+=m(k+=c*n**g)*y,w&&(o+=(2*Math.random()-1)*w),P[a]=80*o*n|0;return P},h=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,i=0,a=n.rowLen*n.patternLen*(e+1)*2,s=new Int32Array(a)},this.generate=function(){var r,l,c,f,d,u,m,y,g,w,p,v,b,M,x=new Int32Array(a),S=t.songData[i],T=t.rowLen,P=t.patternLen,I=0,k=0,A=!1,C=[];for(c=0;c<=e;++c)for(m=S.p[c],f=0;f<P;++f){var O=m?S.c[m-1].f[f]:0;O&&(S.i[O-1]=S.c[m-1].f[f+P]||0,O<17&&(C=[]));var F=h[S.i[16]],L=S.i[17]/512,j=2**(S.i[18]-9)/T,_=S.i[19],R=S.i[20],W=43.23529*S.i[21]*3.141592/44100,B=1-S.i[22]/255,E=1e-5*S.i[23],N=S.i[24]/32,V=S.i[25]/512,D=6.283184*2**(S.i[26]-9)/T,H=S.i[27]/255,z=S.i[28]*T&-2;for(p=(c*P+f)*T,d=0;d<4;++d)if(u=m?S.c[m-1].n[f+d*P]:0){C[u]||(C[u]=o(S,u,T));var G=C[u];for(l=0,r=2*p;l<G.length;l++,r+=2)x[r]+=G[l]}for(l=0;l<T;l++)(w=x[y=2*(p+l)])||A?(v=W,_&&(v*=F(j*y)*L+.5),k+=(v=1.5*Math.sin(v))*(b=B*(w-k)-(I+=v*k)),w=3==R?k:1==R?b:I,E&&(w=(w*=E)<1?w>-1?n(.25*w):-1:1,w/=E),A=(w*=N)*w>1e-5,M=w*(1-(g=Math.sin(D*y)*V+.5)),w*=g):M=0,y>=z&&(M+=x[y-z+1]*H,w+=x[y-z]*H),x[y]=0|M,x[y+1]=0|w,s[y]+=0|M,s[y+1]+=0|w}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,a/2,44100),i=0;i<2;i++)for(var n=e.getChannelData(i),r=i;r<a;r+=2)n[r>>1]=s[r]/65536;return e},this.createWave=function(){var t=44+2*a-8,e=t-36,i=new Uint8Array(44+2*a);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,r=44;n<a;++n){var o=s[n];o=o<-32767?-32767:o>32767?32767:o,i[r++]=255&o,i[r++]=o>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),a=new Array(e),n=0;n<2*e;n+=1){var r=i+n;a[n]=t>0&&r<s.length?s[r]/32768:0}return a}}/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&document;const u=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1,m=()=>document.createElement("audio"),y=(t,e)=>parseFloat(t.toFixed(e)),g=(t,e=1)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0);let i=Promise.resolve();t.paused&&(t.volume=u?.1:0,t.setAttribute("playsinline","playsinline"),i=t.play()),i.then(()=>{let i=t.volume;i<e?(t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeInterval=setInterval(function(){i=y(Math.min(e,i+.1),1),t.volume=i,i>=e&&(t.volume=e,clearInterval(t._fadeInterval),t._fadeInterval=void 0)},100)):t.volume=e}).catch(e=>{console.warn("FadeIn play() failed:",e),t.paused&&(t.volume=1,t.play().catch(t=>console.error("Second play attempt failed:",t))),t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0)})},w=(t,e,i=1)=>{t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeOutInTimeout&&clearTimeout(t._fadeOutInTimeout),e._fadeInterval&&clearInterval(e._fadeInterval),e._fadeOutInTimeout&&clearTimeout(e._fadeOutInTimeout),t._fadeInterval=void 0,t._fadeOutInTimeout=void 0,e._fadeInterval=void 0,e._fadeOutInTimeout=void 0;let a=t.volume;a>0?t._fadeInterval=setInterval(function(){a=y(Math.max(0,a-.1),1),t.volume=a,a<=.1&&(t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=void 0,t._fadeOutInTimeout=setTimeout(()=>{g(e,i),t._fadeOutInTimeout=void 0},500))},100):(t.pause(),t.volume=0,t._fadeOutInTimeout=setTimeout(()=>{g(e,i),t._fadeOutInTimeout=void 0},500))},p=(t,...e)=>M(t,x(t,...e)),v=44100,b=new(window.AudioContext||window.webkitAudioContext),M=(t,...e)=>{let i=b.createBuffer(e.length,e[0].length,v),a=b.createBufferSource();return e.forEach((t,e)=>i.getChannelData(e).set(t)),a.buffer=i,a.connect(b.destination),a.start(),a},x=(t,e=.1,i=.05,a=220,s=0,n=0,r=.1,o=0,h=1,l=0,c=0,f=0,d=0,u=0,m=0,y=0,g=0,w=0,p=1,b=0,M=0,x=0)=>{let S,T,P=2*Math.PI,I=t=>t<0?-1:1,k=l*=500*P/v/v,A=a*=(1+2*i*Math.random()-i)*P/v,C=[],O=0,F=0,L=0,j=1,_=0,R=0,W=0,B=P*Math.abs(x)*2/v,E=Math.cos(B),N=Math.sin(B)/2/2,V=1+N,D=-2*E/V,H=(1-N)/V,z=(1+I(x)*E)/2/V,G=-(I(x)+E)/V,K=z,U=0,$=0,q=0,J=0;for(c*=500*P/v**3,y*=P/v,f*=P/v,d*=v,u=u*v|0,e*=t<0?0:t,T=(s=s*v+9)+(b*=v)+(n*=v)+(r*=v)+(w*=v)|0;L<T;C[L++]=W*(t<0?0:t))++R%(100*g|0)||(W=o?o>1?o>2?o>3?Math.sin(O**3):Math.max(Math.min(Math.tan(O),1),-1):1-(2*O/P%2+2)%2:1-4*Math.abs(Math.round(O/P)-O/P):Math.sin(O),W=(u?1-M+M*Math.sin(P*L/u):1)*I(W)*Math.abs(W)**h*(L<s?L/s:L<s+b?1-(L-s)/b*(1-p):L<s+b+n?p:L<T-w?(T-L-w)/r*p:0),W=w?W/2+(w>L?0:(L<T-w?1:(T-L)/w)*C[L-w|0]/2/e):W,x&&(W=J=K*U+G*(U=$)+z*($=W)-H*q-D*(q=J))),S=(a+=l+=c)*Math.cos(y*F++),O+=S+S*m*Math.sin(L**5),j&&++j>d&&(a+=f,A+=f,j=0),u&&!(++_%u)&&(a=A,l=k,j=j||1);return C},S="start",T="gamestarted",P="chase",I="keyboard",k="gameover",A="mousewalknormal",C=m(),O=m(),F=(t,e,i)=>new Promise(a=>{const s=new d;s.init(e);let n=!1;setInterval(function(){if(!n&&(n=s.generate()>=1,n)){const e=s.createWave();t.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),t.loop=i,a()}},0)}),L=async(a,s=1)=>{if(0!==s)switch(a){case T:w(O,C,.2);break;case k:p(1,...e),w(C,O);break;case S:C.currentTime=0,w(O,C);break;case P:O.currentTime=0,w(C,O);break;case I:p(.5,...t);break;case A:p(s,...i)}};let j={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1};const _=t=>{t.code in j&&(j[t.code]=!0)},R=t=>{t.code in j&&(j[t.code]=!1)},W=t=>new Promise(e=>{const i=a=>{L(I),"Enter"===a.code&&(t&&L(t),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),B={x:0,y:0};function E(t,e){const i=t.x-e.x,a=t.y-e.y;return Math.sqrt(i*i+a*a)}function N(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function V(t,e){return{x:t.x-e.x,y:t.y-e.y}}function D(t,e){return{x:t.x*e,y:t.y*e}}function H(t){return function(t,e){return{x:t.x/e,y:t.y/e}}(t,N(t))}const z=document.querySelector("canvas"),G=z.getContext("2d"),K=(t="black")=>{G.save(),G.fillStyle=t,G.fillRect(0,0,z.width,z.height),G.restore()};let U=0,$=!1;const q=()=>{$=!0,U=0};let J=0,X=10800+10800*Math.random();const Y=t=>{t-J>X&&($=!0,U=0,J=t,X=10800+10800*Math.random()),$&&(U++,U>24&&($=!1))},Q=()=>{if($){G.save();let t=0,e="#fff";U<4?(t=1,e="#fff"):U<8?(t=.7+.3*Math.random(),e="#eaf6ff"):U<12?(t=.4+.2*Math.random(),e="#f9f6e7"):U<16?(t=.3*Math.random(),e="#eaf6ff"):U<20?(t=.2+.2*Math.random(),e="#fff"):(t=.1*Math.random(),e="#eaf6ff"),G.globalAlpha=t,G.fillStyle=e,G.fillRect(0,0,z.width,z.height),G.restore()}},Z=Array.from({length:200},()=>({x:Math.random(),y:Math.random(),speed:2+3*Math.random(),drift:.3*(Math.random()-.5),length:12+10*Math.random(),jitter:2*Math.random()*Math.PI})),tt=(t,e,i,a=1)=>{G.lineWidth=1;for(const s of Z){const n=1.5*Math.sin(.002*t+s.jitter),r=1.5*Math.cos(.003*t+s.jitter),o=((s.x*e+s.drift*t+n)%e+e)%e,h=((s.y*i+s.speed*t+r)%i+i)%i;G.strokeStyle=`rgba(255,255,255,${a})`,G.beginPath(),G.moveTo(o,h),G.lineTo(o,h+s.length*(.7+.6*Math.random())),G.stroke()}};var et,it=((et=it||{})[et.Tiny=16]="Tiny",et[et.Xs=20]="Xs",et[et.Small=24]="Small",et[et.Normal=32]="Normal",et[et.Large=48]="Large",et[et.Xl=64]="Xl",et[et.Huge=80]="Huge",et);const at=(t,e,i=1,a=0,s=!0,n=0,r,o="white")=>{G.save(),G.shadowColor="rgba(0,0,0,0.8)",G.shadowBlur=4,G.shadowOffsetX=2,G.shadowOffsetY=2;const h=Math.floor(e*(z.width/1e3)),l=Math.floor(z.width/1e3*16);G.globalAlpha=Math.max(i,0),G.font=h+"px "+(e>=48?"Impact":"Courier New");const c=r??t,f=G.measureText(c),d=f.actualBoundingBoxAscent??.8*h,u=f.actualBoundingBoxDescent??.2*h,m=f.width,y=(z.width-m)/2+n*l,g=(s?z.height/2:0)+a*l;if(Array.isArray(o)&&2===o.length){const t=G.createLinearGradient(0,g-d,0,g+u);t.addColorStop(.2,o[0]),t.addColorStop(1,o[1]),G.fillStyle=t}else G.fillStyle=o;G.textBaseline="alphabetic",G.fillText(t,y,g),G.restore()},st={movement:{x:0,y:0}},nt=()=>st,rt=(t="continue",e=7.7)=>{const i="Press ENTER to "+t;at(i,it.Small,1,e,!0,0,i)};class ot{constructor(t,e){this.level=t,this.view=e}x=0;y=0;zoom=1;visibleAreaHeight;target=null;getVisibleArea(){const t=this.view.width/this.zoom,e=this.view.height/this.zoom;return{x:this.x-t/2,y:this.y-e/2,width:t,height:e}}follow(t){this.target=t}apply(t,e){t.save(),t.translate(this.view.width/2,this.view.height/2),t.scale(this.zoom,this.zoom),t.translate(-this.x,-this.y),e(),t.restore()}update(){null!=this.visibleAreaHeight&&(this.zoom=this.view.height/this.visibleAreaHeight),this.target&&this.followFrame(this.target)}followFrame(t){let e=t.x+t.width,i=t.y+t.height;const a=this.view.width/this.zoom,s=this.view.height/this.zoom;e-a/2<this.level.x?e=this.level.x+a/2:e+a/2>this.level.width&&(e=this.level.width-a/2),i-s/2<this.level.y?i=this.level.y+s/2:i+s/2>this.level.height&&(i=this.level.height-s/2),this.x=e,this.y=i}}function ht(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}class lt{constructor(t,e,i){this.fullArea=t,this.fractionFromTop=e,this.heightFraction=i}x=0;get y(){return this.fullArea.height*this.fractionFromTop}get width(){return this.fullArea.width}get height(){return this.fullArea.height*this.heightFraction}}var ct=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t))(ct||{});const ft=48/28,dt=(t=1)=>Math.random()*t,ut=t=>Math.floor(Math.random()*t),mt=(t,e)=>Math.random()*(e-t)+t;class yt{x;y;width=vt;height=bt;wobblePhase;constructor(t,e){this.x=t,this.y=e,this.wobblePhase=dt(2*Math.PI)}draw(t){G.save(),G.fillStyle="rgb(90, 174, 90)",G.beginPath(),G.ellipse(this.x+this.width/2,this.y+.5*this.height,.42*this.width,.38*this.height,0,0,2*Math.PI),G.fill(),G.translate(this.x+this.width/2,this.y),this.drawPart(t,.45*this.width,.5*this.width,"rgb(60, 150, 80)"),this.drawPart(t,.35*this.width,.4*this.width,"rgb(55, 145, 75)"),G.restore()}drawPart(t,e,i,a){G.save(),G.rotate(.04*Math.sin(.001*t.t+e*i+this.wobblePhase)),G.translate(0,-i+this.height/2),G.fillStyle=a,G.beginPath(),G.ellipse(0,0,e,i,0,0,2*Math.PI),G.fill(),G.restore()}}const gt=Math.PI/64,wt=2e3;class pt{constructor(t,e,i){this.color=t,this.x=e,this.y=i,this.width=vt*mt(.15,.25),this.height=bt*mt(.15,.25),this.wobblePhase=dt(2*Math.PI)}x;y;width;height;wobblePhase;hitStartTime=-1/0;hit(t){t.t-this.hitStartTime>wt&&(this.hitStartTime=t.t)}draw(t){G.save(),G.save(),G.fillStyle="rgb(80, 164, 80)",G.beginPath(),G.ellipse(this.x+.5*this.width,this.y+.8*this.height,.42*this.width,.38*this.height,0,0,2*Math.PI),G.fill(),G.restore(),G.translate(this.x+.5*this.width,this.y+.5*this.height);const e=t.t-this.hitStartTime<wt?10-(t.t-this.hitStartTime)/wt:1,i=Math.sin(.001*t.t+this.wobblePhase)*gt*e;G.rotate(i);const a=.2*vt,s=.04*vt,n=.5*this.width,r=-a;G.fillStyle="#228b22",G.fillRect(.5*-s,-a,s,a),G.beginPath(),G.arc(0,r,n,0,2*Math.PI),G.fillStyle=this.color,G.fill(),G.beginPath(),G.arc(0,r,.3*n,0,2*Math.PI),G.fillStyle="#ffffe0",G.fill(),G.restore()}}const vt=10,bt=.2*vt,Mt="rgb(100, 220, 100)";var xt=(t=>(t[t.Grass=0]="Grass",t[t.Flower=1]="Flower",t[t.Bush=2]="Bush",t[t.Slate=3]="Slate",t))(xt||{});const St={0:.9,1:.6,2:.2,3:1},Tt={0:.1,1:.5,2:.2,3:.8},Pt={0:1,1:.9,2:.7,3:1.1},It={},kt=(t,e,i)=>{switch(t){case 1:return{type:1,objects:[new pt("#ff69b4",e+vt*mt(0,.4),i+bt*mt(0,.4)),new pt("#ffd700",e+vt*mt(.4,.9),i+bt*mt(0,.4)),new pt("#ff4500",e+vt*mt(0,.4),i+bt*mt(.4,.9)),new pt("#ffffff",e+vt*mt(.4,.9),i+bt*mt(.4,.9))]};case 2:return{type:2,objects:[new yt(e,i)]};case 3:return{type:3,objects:[]};default:return{type:0,objects:[]}}},At=(t,e,i)=>{const a=3===t?"rgb(130, 130, 130)":Mt;G.fillStyle=a,G.fillRect(e,i,vt,bt);const s=function(t,e){const i=`${t}x${e}-a0.55`;if(It[i])return It[i];const a=document.createElement("canvas");a.width=t,a.height=e;const s=a.getContext("2d");if(!s)return null;s.clearRect(0,0,t,e);const n=Math.max(1,Math.floor(.2*e));s.font=`${n}px Courier New`,s.globalAlpha=.55;const r=["#",".","-","+","*"];for(let i=0;i<e;i+=n)for(let e=0;e<t;e+=n){const t=r[Math.floor(Math.random()*r.length)];s.fillStyle=Math.random()>.5?"rgba(40,40,40,0.7)":"rgba(80,80,80,0.7)",s.fillText(t,e,i+n)}const o=s.createPattern(a,"repeat");return It[i]=o,o}(vt,bt);s&&(G.save(),G.fillStyle=s,G.fillRect(e,i,vt,bt),G.restore()),void 0===t&&(G.fillStyle="black",G.fillRect(e,i,vt,bt))},Ct=.001*vt;class Ot{x;y;width=3;height=1;movement=B;direction=B;dir=1;step=0;lastSpeed=0;lastStep=-1;lastFacing="side";constructor(t,e){this.x=t,this.y=e}getMovement(t){return D(nt().movement,t.dt*Ct)}setActualMovement(t,e){this.movement=t,t.x>.05?this.dir=1:t.x<-.05&&(this.dir=-1);const i=N(t),a=this.lastSpeed>0,s=i>0;if(this.lastSpeed=i,s){a||(this.step=0,this.lastStep=-1),this.step+=.25*i;const t=Math.floor(this.step);t!==this.lastStep&&(e(A),this.lastStep=t)}}draw(t){const e=this.movement,i=Math.abs(e.x),a=Math.abs(e.y);let s="side";i>.01||a>.01?(i>.01&&a>.01?(this.dir=e.x>=0?1:-1,s=e.y<0?e.x>0?"up-right":"up-left":e.x>0?"down-right":"down-left"):a>i&&a>.01?s=e.y<0?"up":"down":(s="side",this.dir=e.x>=0?1:-1),this.lastFacing=s):s=this.lastFacing,this.getAnimation(),function(t,e,i,a,s,n,r,o,h,l){const c=l.t,f=a/ft,d=2*Math.PI;t.save(),t.fillStyle="rgba(0,0,0,0.28)",t.beginPath(),t.ellipse(e+a/2,i+f/2+f*(s.startsWith("down")?.7:.5)-.6*f,.45*a,.24*f,0,0,2*Math.PI),t.fill(),t.restore(),t.save(),t.translate(0,.6*-f),t.translate(e+a/2,i+f/2),t.scale("side"===s?r:1,1),t.scale(a/48,f/28);const u=Math.min(1,.8*h),m=Math.sin(c/220+2*o)*(1.5*(.4+u));t.translate(0,m);const y=(e,i,a,s,n,r="#dcdcdc")=>{t.beginPath(),t.ellipse(e,i,a,s,0,0,d),t.fillStyle=n,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=1,t.stroke())};"side"===s?function(t,e,i,a,s){const n=2*Math.PI,r=(e,i,a,s)=>{t.beginPath(),t.ellipse(e,i,a,s,0,0,n)};t.save();const o=Math.sin(e/260+1.6*i)*(6+4*a);t.strokeStyle="#f0c2c2",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(-18,2),t.bezierCurveTo(-28,0,-40,.4*o,-62,o),t.stroke(),t.restore();const h=t=>Math.sin(6*i+t)*(2*(.3+a));t.fillStyle="#ededed",t.strokeStyle="#d7d7d7",r(-8,10+h(0),6,3),t.fill(),t.stroke(),r(10,10+h(Math.PI),6,3),t.fill(),t.stroke(),s(0,0,18,10,"#fff"),t.save();const l=t.createRadialGradient(0,4,2,0,4,18);l.addColorStop(0,"rgba(0,0,0,0.05)"),l.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=l,r(0,4,14,7),t.fill(),t.restore(),s(14,-2,9,7,"#fff"),s(8,-10,5,5,"#ffe2e6"),s(8,-10,3,3,"#ffc8d0","#eec3c9");const c=e/1400%1<.08?.2:1;t.save(),t.translate(18,-4),t.beginPath(),t.ellipse(0,0,1.8,1.8*c,0,0,n),t.fillStyle="#222",t.fill(),c>.5&&(t.beginPath(),t.ellipse(-.4,-.5*c,.5,.35*c,0,0,n),t.fillStyle="rgba(255,255,255,0.9)",t.fill()),t.restore(),s(22+.6*Math.sin(e/120),-1,1.6,1.4,"#ff9aa9","#ef8a99"),t.save(),t.strokeStyle="rgba(0,0,0,0.35)",t.lineWidth=1,t.lineCap="round",[-2,0,2].forEach((e,i)=>{t.beginPath(),t.moveTo(20,e),t.lineTo(28,e-1+i),t.stroke()}),t.restore()}(t,c,o,u,y):s.startsWith("up")?function(t,e,i,a,s,n){const r=2*Math.PI,o="up-left"===s||"up-right"===s,h=s.endsWith("left")?-1:1,l=(e,i,a,s)=>{t.beginPath(),t.ellipse(e,i,a,s,0,0,r)};t.scale(h,1),t.save();const c=Math.sin(e/260+1.6*i)*(6+4*a);t.strokeStyle="#f0c2c2",t.lineWidth=2,t.lineCap="round",t.beginPath(),o?(t.moveTo(-2,6),t.bezierCurveTo(-10,12,-14,14+.7*c,-20,20+c)):(t.moveTo(0,6),t.bezierCurveTo(4,14,2,16+c,0,20+c)),t.stroke(),t.restore();const f=t=>Math.sin(6*i+t)*(1.5*(.3+a));t.fillStyle="#ededed",t.strokeStyle="#d7d7d7",o?(l(6,10+f(0),5.2,2.6),t.fill(),t.stroke(),l(-10,9+f(Math.PI),4.2,2.1),t.fill(),t.stroke()):(l(-8,8+f(0),5,2.5),t.fill(),t.stroke(),l(8,8+f(Math.PI),5,2.5),t.fill(),t.stroke()),n(o?1.5:0,0,12,10,"#fff"),o?(n(-4,-15,4.2,4.2,"#ffe2e6"),n(-4,-15,2.4,2.4,"#ffc8d0","#eec3c9"),n(4,-12,9,7,"#fff"),n(7.5,-14,5.2,5.2,"#ffe2e6"),n(7.5,-14,3.1,3.1,"#ffc8d0","#eec3c9")):(n(-6,-14,5,5,"#ffe2e6"),n(-6,-14,3,3,"#ffc8d0","#eec3c9"),n(6,-14,5,5,"#ffe2e6"),n(6,-14,3,3,"#ffc8d0","#eec3c9"),n(0,-12,9,7,"#fff"))}(t,c,o,u,s,y):function(t,e,i,a,s,n){const r=2*Math.PI,o="down-left"===s||"down-right"===s,h=s.endsWith("left")?-1:1,l=(e,i,a,s)=>{t.beginPath(),t.ellipse(e,i,a,s,0,0,r)},c=t=>Math.sin(6*i+t)*(1.5*(.3+a));if(t.scale(h,1),t.fillStyle="#ededed",t.strokeStyle="#d7d7d7",o){l(6,7+c(0),5.2,2.6),t.fill(),t.stroke(),l(-8,9+c(Math.PI),4.2,2.1),t.fill(),t.stroke();const e=8;l(7.5,e+c(0),4.9,2.4),t.fill(),t.stroke(),l(-8.5,e+c(Math.PI),4.1,2),t.fill(),t.stroke()}else{l(-8,8+c(0),5,2.5),t.fill(),t.stroke(),l(8,8+c(Math.PI),5,2.5),t.fill(),t.stroke();const e=8;l(-7,e+c(Math.PI),4.5,2.2),t.fill(),t.stroke(),l(7,e+c(0),4.5,2.2),t.fill(),t.stroke()}n(o?1.5:0,0,9,10,"#fff"),t.save();const f=t.createRadialGradient(0,4,2,0,4,18);f.addColorStop(0,"rgba(0,0,0,0.05)"),f.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=f,l(0,4,14,7),t.fill(),t.restore();const d=o?3.5:0;n(d-6,6,5,5,"#ffe2e6"),n(d-6,6,3,3,"#ffc8d0","#eec3c9"),n(d+6,6,5,5,"#ffe2e6"),n(d+6,6,3,3,"#ffc8d0","#eec3c9"),n(d,12,9,7,"#fff");const u=e/1400%1<.08?.2:1;t.fillStyle="#222",o?(l(d-2.6,9.9,1.3,1.3*u),t.fill(),l(d+3.8,10.1,1.8,1.8*u),t.fill(),u>.5&&(t.fillStyle="rgba(255,255,255,0.9)",l(d-3,12-2.4*u,.35,.25*u),t.fill())):(l(d-3.2,10,1.6,1.6*u),t.fill(),l(d+3.2,10,1.6,1.6*u),t.fill(),u>.5&&(t.fillStyle="rgba(255,255,255,0.9)",l(d-3.7,12-2.6*u,.4,.3*u),t.fill(),l(d+2.7,12-2.6*u,.4,.3*u),t.fill())),n(d+.6*Math.sin(e/120),18,1.6,1.4,"#ff9aa9","#ef8a99"),t.save(),t.strokeStyle="rgba(0,0,0,0.35)",t.lineWidth=1,t.lineCap="round",[-1.5,0,1.5].map(t=>t+12+6).forEach((e,i)=>{t.beginPath(),t.moveTo(d-2,e),t.lineTo(d-10,e-1+i),t.stroke(),t.beginPath(),t.moveTo(d+2,e),t.lineTo(d+10,e-1+i),t.stroke()}),t.restore()}(t,c,o,u,s,y),t.restore()}(G,this.x,this.y,this.width,s,0,this.dir,this.step,this.lastSpeed,t)}getAnimation(){const t=nt().movement||{x:0,y:0};return Math.sqrt(t.x*t.x+t.y*t.y)>.01?ct.Walk:ct.Stand}}function Ft(t,e,i,a){let s=1;s="number"==typeof a?a:a?1:.1,[[.06*i,.03*i*s,"green"],[.025*i,.018*i*s,"#181818"]].forEach(i=>{const[a,s,n]=i;G.beginPath(),G.ellipse(t,e,a,s,0,0,2*Math.PI),G.fillStyle=n,G.fill()}),s>.5&&(G.beginPath(),G.arc(t-.02*i,e-.01*i,.01*i,0,2*Math.PI),G.fillStyle="#fff",G.fill())}function Lt(t,e,i,a,s,n,r,o,h,l=0){G.save();const c=h.t,f=i/.75;G.fillStyle="rgba(0,0,0,0.20)",G.beginPath(),G.ellipse(t+i/2,e+f/2+.5*f-f,.45*i,.24*f,0,0,2*Math.PI),G.fill();let d=s?1:.6;s&&h.t%3e3<120&&(d=.1);const u=.005*f;let m=0;if(0===l)m=Math.min(Math.sin(c/400)*(2e-4*f),0);else if(1===l)m=.25*-f+Math.sin(c/400)*u,m=Math.max(m,.248*-f);else if(2===l)if(h.t>150)m=2*-f;else{const t=Math.min(h.t/150,1);m=.45*-f-(1-Math.pow(1-t,2))*(1.55*f)}const y=.5*-f;G.translate(0,y+m),G.translate(t+i/2,e+.1*f),G.scale("side"===a?n:1,1),G.translate(0,Math.sin(c/220+2*r)*(.05*f*(.4+Math.min(1,.8*o)))),G.beginPath(),G.ellipse(0,.2*f,.35*i,.28*f,0,0,2*Math.PI),G.fillStyle="#000",G.fill(),G.beginPath(),G.ellipse(0,.18*-f,.28*i,.22*f,0,0,2*Math.PI),G.fill();const g=.5*-f,w=.16*i,p=.18*f;if("side"===a){Ft(.19*i,.18*-f,i,d),[[.03*i,.7*w,.7*p,.1],[.13*i,w,p,0]].forEach(([t,e,i,a])=>{G.beginPath(),G.moveTo(t,g+p*a),G.lineTo(t+e/2,g+i+p*a),G.lineTo(t-e/2,g+i+p*a),G.closePath(),G.fillStyle="#000",G.fill()}),G.fillStyle="#e68686",G.beginPath(),G.ellipse(.28*i,.11*-f,.018*i,.012*f,0,0,2*Math.PI),G.fill(),G.strokeStyle="#e6d6e6",G.lineWidth=Math.max(.1,.012*i);const t=.1*-f,e=.18*i,a=.04*i;[-1,0,1].forEach(s=>{G.beginPath(),G.moveTo(.13*i,t+s*a),G.bezierCurveTo(.22*i,t+s*a+.1*e,.32*i,t+s*a+.3*e,.38*i,t+s*a+.2*e),G.stroke()})}else[[.13*-i,-1],[.13*i,1]].forEach(([t,e])=>{G.beginPath(),G.moveTo(t,g),G.lineTo(t-e*w/2,g+p),G.lineTo(t+e*w/2,g+p),G.closePath(),G.fillStyle="#000",G.fill()});const v=.33*-i,b=.2*f,M=.07*i,x=v+.22*i,S=b+.32*f,T=v-.2*i,P=b-.1*f,I=v-.1*i,k=b+.25*f;if(G.beginPath(),G.moveTo(v,b),G.bezierCurveTo(T,P,I,k,x,S),G.strokeStyle="#000",G.lineWidth=M,G.stroke(),G.beginPath(),G.arc(x,S,M/2,0,2*Math.PI),G.fillStyle="#000",G.fill(),a.includes("down")){G.save(),G.translate(0,.18*-f),[.09*-i,.09*i].forEach(t=>Ft(t,0,i,d)),G.restore(),G.beginPath(),G.ellipse(0,.11*-f,.018*i,.012*f,0,0,2*Math.PI),G.fillStyle="#e68686",G.fill(),G.strokeStyle="#e6d6e6",G.lineWidth=Math.max(.1,.012*i);const t=.1*-f,e=.18*i,a=.04*i;[-1,0,1].forEach(s=>{G.beginPath(),G.moveTo(.13*-i,t+s*a),G.bezierCurveTo(.22*-i,t+s*a+.1*e,.32*-i,t+s*a+.3*e,.38*-i,t+s*a+.2*e),G.stroke(),G.beginPath(),G.moveTo(.13*i,t+s*a),G.bezierCurveTo(.22*i,t+s*a+.1*e,.32*i,t+s*a+.3*e,.38*i,t+s*a+.2*e),G.stroke()})}G.restore()}const jt=(t,e,i)=>t<e?e:t>i?i:t,_t=-1e3,Rt=6.5*vt,Wt=160*Math.PI/180;var Bt=(t=>(t[t.Nothing=0]="Nothing",t[t.HeardSomething=1]="HeardSomething",t[t.Noticed=2]="Noticed",t[t.Jumped=3]="Jumped",t))(Bt||{});class Et{constructor(t,e,i){this.host=t,this.space=e,this.mouse=i,this.host.x=_t,this.host.y=-1e3,this.host.direction={x:0,y:1}}isAlert=!1;fenceState=0;lastMusic=T;heardSomethingTime=0;noticedTime=0;jumpTarget=null;jumpStartTime=0;jumpFinishTime=0;hasJumped=!1;lastHearingTime=0;lastObservation=null;lastHearObservation=null;lastCertainObservation=null;lastVagueObservation=null;lookAroundStartTime=0;lastTurnTime=0;target=null;getMovement(t){const e=ht(this.host);return this.observe(t,e),this.stayOnTheFence(t)??this.jump(t,e)??this.chase(t,e)??this.followVagueObservation(t,e)??this.lookAround(t)??this.idle(e)}observe(t,e){const i=this.lookForMouse(t,e);let a=null;if(i&&i.accuracy>.42&&(this.lastCertainObservation=i),450<t.t-this.lastHearingTime){this.lastHearingTime=t.t;const i=this.host.x!==_t?e:{x:this.space.x+this.space.width/2,y:this.space.y};a=this.space.listen(t,i),a&&(this.lastHearObservation=a)}const s=function(t,e){return t?e?t.accuracy>e.accuracy?t:e:t:e}(i,a);this.lastObservation=s,s&&s.accuracy>.22&&(this.lastVagueObservation=s)}stayOnTheFence(t){if(this.host.x!==_t)return null;if(0===this.fenceState&&this.lastHearObservation&&this.lastHearObservation.accuracy>.04)return this.fenceState=1,this.heardSomethingTime=t.t,B;const e=this.lastObservation;return 1===this.fenceState&&800<t.t-this.heardSomethingTime&&e&&e.accuracy>.14?(this.lastCertainObservation={...e,position:{x:e.position.x,y:e.position.y-8*bt}},this.fenceState=2,this.noticedTime=t.t,B):(2===this.fenceState&&1500<t.t-this.noticedTime&&(this.host.x=this.mouse.x-.5*this.host.width,this.host.y=this.mouse.y-20*bt-.5*this.host.height,this.fenceState=3),B)}jump(t,e){return this.hasJumped?null:(this.jumpStartTime||(this.jumpStartTime=t.t,this.jumpTarget={x:this.mouse.x+mt(-.5,.5)*vt,y:this.mouse.y-5*bt},this.useMusic(P)),this.jumpTarget&&!this.jumpFinishTime?(function(t,e,i,a,s){const n=t.t-e;let r=Math.min(1,n/2300);r=r<.5?2*r*r:(4-2*r)*r-1;const o=a.x+(s.x-a.x)*r,h=a.y+(s.y-a.y)*r;return i.x=o-i.width/2,i.y=h-i.height/2,n>=2300&&(i.x=s.x-i.width/2,i.y=s.y-i.height/2,!0)}(t,this.jumpStartTime,this.host,e,this.jumpTarget)&&(this.jumpTarget=null,this.jumpFinishTime=t.t),B):t.t-this.jumpFinishTime<1e3?(this.hasJumped=!0,B):null)}idle(t){return null==this.target&&(this.target=function(t){const e=2*vt,i=2+bt;return{x:e+dt(t.width-2*e),y:i+dt(t.height-2*i)}}(this.space),this.useMusic(T)),this.goTo(this.target,t,.4)||(this.target=null,B)}followVagueObservation(t,e){if(this.lastVagueObservation&&t.t-this.lastVagueObservation.t<2e3){this.isAlert=!0;const t=E(e,this.lastVagueObservation.position)<vt?this.lastVagueObservation.position:function(t,e){const i=V(e,t),a=N(i);return function(t,e){return{x:t.x+e.x,y:t.y+e.y}}(t,D(H(i),.5*a))}(e,this.lastVagueObservation.position);return this.goTo(t,e,.8)}return this.isAlert=!1,null}chase(t,e){if(this.lastCertainObservation){this.useMusic(P);const i=this.goTo(this.lastCertainObservation.position,e,1);return null==i&&(this.lastCertainObservation=null,this.lookAroundStartTime=t.t),i}return null}lookAround(t){return t.t-this.lookAroundStartTime<8e3?1500<t.t-this.lastTurnTime?(this.lastTurnTime=t.t,(()=>{const t=dt()*Math.PI*2;return{x:Math.cos(t),y:Math.sin(t)}})()):B:null}useMusic(t){t!==this.lastMusic&&(L(t),this.lastMusic=t)}lookForMouse(t,e){const i=this.space.lookForMouse(t),a=E(e,i.position),s=function(t,e){return t.x*e.x+t.y*e.y}(H(V(i.position,e)),this.host.direction),n=s>Math.cos(Wt/2),r=(n?s:0)*i.accuracy*function(t){return jt(1-t/Rt,.3,1)}(a)*function(t){return jt(N(t.movement)/.16,.3,1)}(this.mouse);return i.accuracy>0&&n?{...i,accuracy:r}:null}goTo(t,e,i){return E(e,t)<=.2*this.host.width?null:D(H(V(t,e)),i)}}class Nt{constructor(t,e){this.xCount=t,this.yCount=e,this.values=new Array(t*e)}values;getValue(t,e){if(!(t<0||this.xCount<=t||e<0||this.yCount<=e))return this.values[t*this.yCount+e]}setValue(t,e,i){t<0||this.xCount<=t||e<0||this.yCount<=e||(this.values[t*this.yCount+e]=i)}}const Vt=(t,e)=>({ix:Math.floor(t/vt),iy:Math.floor(e/bt)}),Dt=t=>Vt(t.x+t.width/2,t.y+t.height/2);class Ht{grid;width;height;constructor(t){this.grid=t,this.width=this.grid.xCount*vt,this.height=this.grid.yCount*bt}getTile(t){return this.grid.getValue(t.ix,t.iy)}getVisibility(t){const e=this.getTile(Vt(t.x,t.y))?.type??xt.Grass,i=this.getTile(Vt(t.x+t.width,t.y))?.type??xt.Grass,a=this.getTile(Vt(t.x,t.y+t.height))?.type??xt.Grass,s=this.getTile(Vt(t.x+t.width,t.y+t.height))?.type??xt.Grass;return((t,e,i,a)=>(t+e+i+a)/4)(St[e],St[i],St[a],St[s])}draw(t,e){const i=this.grid,a=Math.floor(t.x/vt),s=Math.ceil((t.x+t.width)/vt),n=Math.floor(t.y/bt),r=Math.ceil((t.y+t.height)/bt)+4,o=Math.max(0,a),h=Math.min(i.xCount,s),l=Math.max(0,n),c=Math.min(i.yCount,r);for(let t=l;t<c;t++){const a=t*bt;for(let s=o;s<h;s++){const n=s*vt,r=i.getValue(s,t),o=r?.objects??[];e.push(...o),At(r?.type,n,a)}}}*getNearbyObjects(t){const e=this.grid,i=Math.max(0,t.ix-1),a=Math.min(t.ix+1,e.xCount),s=Math.max(0,t.iy-1),n=Math.min(t.iy+1,e.yCount);for(let t=s;t<n;t++)for(let s=i;s<a;s++){const i=e.getValue(s,t);if(i)for(let t=0;t<i.objects.length;t++)yield i.objects[t]}}}const zt=.0011*vt;class Gt{x=0;y=0;width=12;height=6;direction=B;dir=1;step=0;lastSpeed=0;ai;constructor(t,e,i,a){this.x=t,this.y=e,this.ai=new Et(this,i,a)}getMovement(t){return D(this.ai.getMovement(t),t.dt*zt)}setActualMovement(t){(0!==t.x||0!==t.y)&&(this.direction=H(t)),t.x>.05?this.dir=1:t.x<-.05&&(this.dir=-1);const e=N(t);this.lastSpeed=e,this.step+=.25*e}draw(t){const e=this.direction,i=Math.abs(e.x),a=Math.abs(e.y);let s="down";i>.01&&a>.01?s=e.y<0?e.x>0?"up-right":"up-left":e.x>0?"down-right":"down-left":a>i&&a>.01?s=e.y<0?"up":"down":(s="side",this.dir=e.x>=0?1:-1);const n=this.ai.isAlert;Lt(this.x,this.y,this.width,s,n,this.dir,this.step,this.lastSpeed,t)}}const Kt=50*bt,Ut=(t,e,i)=>e===Math.floor(t.xCount/2)&&i<6;let $t;const qt=(t,e,i=1)=>{$t||($t=((t,e)=>{const i=t.width,a=t.height,s=e.createRadialGradient(i/2,a/2,0,i/2,a/2,Math.max(i,a)/2);return s.addColorStop(0,"transparent"),s.addColorStop(1,"rgba(0, 0, 0, 1)"),s})(t,e)),e.fillStyle=$t,e.globalAlpha=i,e.fillRect(0,0,t.width,t.height)};let Jt=performance.now();var Xt=(t=>(t[t.Running=0]="Running",t[t.Lose=1]="Lose",t[t.Finished=2]="Finished",t))(Xt||{});class Yt{constructor(t){if(this.number=t,0===t){const t=(()=>{const t=new Nt(10,18),e=Math.floor(9)-1,i=e+8;for(let a=0;a<18;a++)for(let a=0;a<18;a++)for(let s=0;s<10;s++){const n=s*vt,r=a*bt;let o=xt.Grass;2===a&&2===s||2===a&&7===s||4===a&&1===s||4===a&&8===s?o=xt.Bush:(3===a&&1===s||3===a&&8===s||1===a&&3===s||1===a&&6===s)&&(o=xt.Flower),a>=e&&a<i&&(o=xt.Slate),t.setValue(s,a,kt(o,n,r))}return t})();this.tileMap=new Ht(t),this.width=t.xCount*vt,this.height=t.yCount*bt;const e=new Ot(Math.floor(t.xCount/2)*vt+vt/2-1.5,this.height-bt-1);return void this.setupPlayerAndCamera(e)}this.tileMap=new Ht((t=>{const e=new Nt(11,50+5*t),i=Math.max(.1,.8-.05*t),a=Math.max(.1,.35-.05*t),s=[4,12,18,29,34,41,47];let n=3+ut(5),r=n;for(let t=0;t<e.yCount;t++){const o=t*bt;if(s.includes(t)){r=n,n=1+ut(e.xCount-1);const i=Math.min(r,n),a=Math.max(r,n);for(let s=i;s<a+1;s++){const i=s*vt,a=kt(xt.Slate,i,t*bt);e.setValue(s,t,a)}}else if(s.includes(t-1)){const i=Math.min(r,n),a=Math.max(r,n);for(let s=i;s<a+1;s++){const i=s*vt,a=kt(xt.Slate,i,t*bt);e.setValue(s,t,a)}}else{const i=n,a=i*vt,s=kt(xt.Slate,a,o);e.setValue(i,t,s)}for(let s=0;s<e.xCount;s++){if(e.getValue(s,t))continue;const n=s*vt;let r=dt()<i?dt()<a?xt.Bush:xt.Flower:xt.Grass;Ut(e,s,t)&&(r=xt.Grass);const h=kt(r,n,o);e.setValue(s,t,h)}}return e})(t)),this.width=this.tileMap.width,this.height=this.tileMap.height;const e=new Ot(.5*this.width,this.height-bt),i=new Gt(.4*this.width,.3*this.height,this,e);this.setupPlayerAndCamera(e,i)}setupPlayerAndCamera(t,e){this.player=t,this.cat=e,this.animals=e?[t,e]:[t],this.camera=new ot(this,this.levelDrawArea),this.camera.zoom=15,this.camera.follow(this.player)}horizonDrawArea=new lt(z,0,.25);levelDrawArea=new lt(z,.25,.75);tileMap;camera;state=0;x=0;y=0;width;height;player;latestSoundByPlayer;cat;animals;listen(t,e){if(this.latestSoundByPlayer&&t.t-this.latestSoundByPlayer.t<500){const t=E(e,this.latestSoundByPlayer.position),i=Math.max(0,1-t/Kt);return{...this.latestSoundByPlayer,accuracy:this.latestSoundByPlayer.accuracy*i}}return null}lookForMouse(t){const e=this.player;return{t:t.t,position:ht(this.player),accuracy:this.tileMap.getVisibility(e)}}update(t){this.camera.update(),this.calculateMovement(t);const e=vt/2,i=this.player.y<.1*bt&&this.width/2-e/2<=this.player.x&&this.player.x+this.player.width<=this.width/2+e/2;if(0===this.state&&i)return this.state=2,void L(T);this.cat&&E(ht(this.player),ht(this.cat))<.3*(this.player.width+this.cat.width)&&(this.state=1);const a=Dt(this.player),s=ht(this.player);for(const e of this.tileMap.getNearbyObjects(a))e instanceof pt&&E(s,ht(e))<.4*(this.player.width+e.width)&&e.hit(t);Y(t.t)}calculateMovement(t){for(let e=0;e<this.animals.length;e++){const i=this.animals[e];let a=i.getMovement(t);if(i instanceof Ot){const t=Dt(this.player),e=this.tileMap.getTile(t);a=D(a,e?Pt[e.type]:1)}(a.x<0&&this.x<=i.x+a.x||a.x>0&&i.x+a.x+i.width<this.x+this.width)&&(i.x+=a.x),(a.y<0&&this.y<=i.y+a.y||a.y>0&&i.y+a.y+i.height<this.y+this.height)&&(i.y+=a.y);const s=e=>{const a=this.tileMap.getTile(Dt(i)),s=a?Tt[a.type]:1;L(e,s),i instanceof Ot&&(this.latestSoundByPlayer={position:ht(i),accuracy:s,t:t.t})};i.setActualMovement(a,s)}}draw(t){const e=this.camera.getVisibleArea(),i=[...this.animals];K("rgb(0, 0, 0)"),G.save(),G.translate(0,this.levelDrawArea.y),this.camera.apply(G,()=>{G.fillStyle=Mt,G.fillRect(this.x,this.y,this.width,this.height),this.tileMap.draw(e,i)}),G.restore();const a=-(this.camera.x-this.width/2)*this.camera.zoom;let s=1-this.player.y/(this.height-bt);s=Math.max(0,Math.min(1,s)),0===this.number&&(s=1),function(t,e,i,a,s,n){G.save(),G.fillStyle="rgb(0, 150, 255)",G.fillRect(e.x,e.y,e.width,e.height),function(t,e,i){G.save(),G.filter="blur(4px)",G.translate(i/2,0),G.fillStyle="#deb887",G.fillRect(.3*t.width,.4*t.height,.25*t.width,.5*t.height),G.beginPath(),G.moveTo(.28*t.width,.4*t.height),G.lineTo(.425*t.width,.1*t.height),G.lineTo(.57*t.width,.4*t.height),G.closePath(),G.fillStyle="#8b0000",G.fill(),G.restore()}(e,0,a);const r=e.height/1.5,o=e.height/3,h=o+(r-o)*s+8,l=e.y+e.height-h,c=((t,e,i,a,s)=>{if(!t)return;const n=.02*i.width,r=n+(.06*i.width-n)*s,o=r/(3/4),h=z.width/2;let l;switch(t.ai.fenceState){case Bt.Nothing:return;case Bt.HeardSomething:{const t=a+o/2-.1*o,i=a+o/2,s=(Math.sin(e.t/700)+1)/2;l=t*(1-s)+i*s;break}case Bt.Noticed:l=a+o/2-.5*o;break;case Bt.Jumped:{if(null==t.ai.jumpStartTime)return;const i=Math.max(0,e.t-t.ai.jumpStartTime);return i>150?void 0:[h-r/2,a,r,"down",!0,1,0,0,{...e,t:i},2]}default:return}return[h-r/2,l,r,"down",!0,1,0,0,e,0]})(n,t,e,l,s);c&&(G.filter="blur(1.6px)",Lt(...c),G.filter="blur(0)"),function(t,e,i,a,s){G.save();const n=function(t,e,i){const a="#aa4444".match(/#(..)(..)(..)/).slice(1).map(t=>parseInt(t,16)),s="#664848".match(/#(..)(..)(..)/).slice(1).map(t=>parseInt(t,16));return`#${a.map((t,e)=>Math.round(t+(s[e]-t)*i)).map(t=>t.toString(16).padStart(2,"0")).join("")}`}(0,0,1-Math.max(0,Math.min(s,1)));s<1&&(G.filter=`blur(${Math.round(4*(1-s))}px)`),G.fillStyle=n,G.fillRect(t,e,i,a),G.restore()}(e.x,l,e.width,h,s),function(t,e,i,a){if(a>.8){G.save(),G.translate(i,0);const s=20,n=20,r=Math.min((a-.8)/(1-.8),1),o=s*r,h=n*r;G.fillStyle=Mt,G.beginPath(),G.moveTo(t-o/2,e),G.lineTo(t-o/2,e-h),G.lineTo(t,e-1.2*h),G.lineTo(t+o/2,e-h),G.lineTo(t+o/2,e),G.fill(),G.restore()}}(e.width/2,e.y+e.height,a,s),G.restore()}(t,this.horizonDrawArea,0,a,s,this.cat),G.save(),G.translate(0,this.levelDrawArea.y),this.camera.apply(G,()=>{i.sort((t,e)=>t.y+t.height/2-(e.y+e.height/2));for(let a=0;a<i.length;a++){const s=i[a];s.y+.5*s.height<e.y||(s instanceof yt&&Qt(this.player,s)?(G.save(),G.globalAlpha=.3,s.draw(t),G.restore()):s.draw(t))}}),G.restore(),0===this.number&&(at("It is almost midnight. Find the mouse holes to the next backyards.",it.Small),at("Be quiet, hide in bushes or the black cat catches you!",it.Small,1,2),at("Use arrow keys or WASD to move.",it.Small,1,6)),tt(t.t,z.width,z.height);const n=t.t-Jt;G.save(),G.globalAlpha=Math.min(n/24e4,.9),G.fillStyle="#001",G.fillRect(0,0,z.width,z.height),G.restore(),Q(),qt(z,G,.9)}}const Qt=(t,e)=>t.y+t.height/2<e.y+e.height/2&&e.y-4*bt<t.y&&e.x<=t.x&&t.x+t.width<=e.x+e.width,Zt={t:0,thunderTimer:0};let te=0;const ee=1e3/60*5;let ie=0;const ae={t:0,dt:0};let se;const ne="FS-Midnight_Paws";let re=Number(localStorage.getItem(ne)||0),oe=re;const he=t=>{requestAnimationFrame(he),ae.t=t,ae.dt=Math.min(t-ie,ee),ie=t,ce(ae),fe(ae)},le=t=>{switch(te=t,te){case 0:W().then(()=>le(1));break;case 1:q(),W(S).then(()=>le(2));break;case 2:q(),W(T).then(()=>le(3));break;case 3:q(),Jt=performance.now(),se=new Yt(0);break;case 4:q(),L(k),W(S).then(()=>le(2))}},ce=t=>{switch(te){case 3:if((()=>{const t=j,e=t.ArrowLeft||t.KeyA,i=t.ArrowRight||t.KeyD,a=t.ArrowUp||t.KeyW,s=t.ArrowDown||t.KeyS,n=e?-1:i?1:0,r=a?-1:s?1:0;st.movement=0===n&&0===r?B:H({x:n,y:r})})(),se.update(t),se.state===Xt.Lose)le(4);else if(se.state===Xt.Finished){const t=se.number;t+1>re&&(oe=re,re=t+1,function(t){localStorage.setItem(ne,String(t))}(re)),se=new Yt(t+1)}break;case 2:(t=>{Zt.t+=t,Zt.thunderTimer+=t,Y(t)})(t.dt);break;case 1:case 4:(t=>{Y(t)})(t.dt)}},fe=t=>{switch(G.save(),K(),0!==te&&Q(),te){case 0:K("rgb(0, 0, 0)"),at("Loading...",it.Normal);break;case 1:K("rgb(0, 0, 0)"),at("Press ENTER to start",it.Normal),Q();break;case 2:((t,e)=>{K("rgb(20, 20, 20)");const i=Math.sin(.003*Zt.t)*z.height*.02;Lt(z.width/2-.18*z.width,z.height/2+.17*z.width+i,.36*z.width,"down",!0,1,0,0,{t:Zt.t}),at("FROST𖤓SUN",it.Large,1,4,!1,0,"FROST𖤓SUN",["#ACD5F3","orange"]),at("presents",it.Tiny,.5,5.25,!1),at("MIDNIGHT PAWS",it.Xl,1,1.8),rt("start"),tt(e.t,z.width,z.height,.2),Q(),qt(z,t)})(G,t);break;case 3:{se.draw(t);const e=se.number>0?"BACKYARD "+se.number:"ALLEY";at(e,it.Small,1,2,!1,25),re>0&&at(`HIGHSCORE ${re}`,it.Small,1,2,!1,-25);break}case 4:se.draw(t),G.save(),G.globalAlpha=.6,G.fillStyle="#000",G.fillRect(0,0,z.width,z.height),G.restore(),at("The cat catches the mouse ☹",it.Large,1,0,!0,0),at("Backyard #"+se.number+" was reached.",it.Normal,1,3),re>0&&at(re>oe&&se.number===re?"New highscore!":`Highscore ${re}`,it.Small,1,5),rt("try again")}G.restore()},de=()=>{((t,e,i)=>{const a=e/i;let s=window.innerWidth,n=window.innerHeight;s/n>a?s=n*a:n=s/a,s>e&&(s=e,n=720),n>i&&(n=i,s=i*a),t.width=s,t.height=n;const r=window.innerWidth/s,o=window.innerHeight/n,h=Math.min(r,o);t.style.position="absolute",t.style.left=(window.innerWidth-s*h)/2+"px",t.style.top=(window.innerHeight-n*h)/2+"px",t.style.transform=`scale(${h})`,t.style.transformOrigin="top left"})(z,1280,720)};window.addEventListener("resize",de,!1),de(),(async()=>{z.tabIndex=0,z.style.outline="none",window.addEventListener("keydown",_),window.addEventListener("keyup",R),window.addEventListener("blur",()=>{j={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1}}),requestAnimationFrame(he),await Promise.all([F(C,c,!0),F(O,f,!0)]),le(1)})()</script>