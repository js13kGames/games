<!DOCTYPE html><html lang=en><head><meta charset=utf-8><script src=https://aframe.io/releases/0.6.1/aframe.min.js></script><script>function SfxrParams(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var a=.18/e;this.b*=a,this.c*=a,this.e*=a}}}function SfxrSynth(){this._params=new SfxrParams;var t,i,e,a,r,s,h,o,n,l,d,y;this.reset=function(){var t=this._params;a=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),s=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,y=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),n=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var a=this._params;return t=a.b*a.b*1e5,i=a.c*a.c*1e5,e=a.e*a.e*1e5+12,3*((t+i+e)/3|0)},this.synthWave=function(c,x){var p=this._params,g=1!=p.s||p.v,f=p.v*p.v*.1,u=1+3e-4*p.w,w=p.s*p.s*p.s*.1,v=1+1e-4*p.t,b=1!=p.s,m=p.x*p.x,z=p.g,k=p.q||p.r,A=p.r*p.r*p.r*.2,E=p.q*p.q*(p.q<0?-1020:1020),C=p.p?32+((1-p.p)*(1-p.p)*2e4|0):0,L=p.d,S=p.j/2,j=p.k*p.k*.01,M=p.a,D=t,P=1/t,_=1/i,R=1/e,q=5/(1+p.u*p.u*20)*(.01+w);q>.8&&(q=.8),q=1-q;for(var F,V,B,T,N,H,W=!1,O=0,U=0,G=0,I=0,J=0,K=0,Q=0,X=0,Y=0,Z=0,$=new Array(1024),tt=new Array(32),it=$.length;it--;)$[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<x;it++){if(W)return it;if(C&&++Y>=C&&(Y=0,this.reset()),l&&++n>=l&&(l=0,a*=o),s+=h,(a*=s)>r&&(a=r,z>0&&(W=!0)),V=a,S>0&&(Z+=j,V*=1+Math.sin(Z)*S),(V|=0)<8&&(V=8),M||((d+=y)<0?d=0:d>.5&&(d=.5)),++U>D)switch(U=0,++O){case 1:D=i;break;case 2:D=e}switch(O){case 0:G=U*P;break;case 1:G=1+2*(1-U*_)*L;break;case 2:G=1-U*R;break;case 3:G=0,W=!0}k&&((B=0|(E+=A))<0?B=-B:B>1023&&(B=1023)),g&&u&&((f*=u)<1e-5?f=1e-5:f>.1&&(f=.1)),H=0;for(var et=8;et--;){if(++Q>=V&&(Q%=V,3==M))for(var at=tt.length;at--;)tt[at]=2*Math.random()-1;switch(M){case 0:N=Q/V<d?.5:-.5;break;case 1:N=1-Q/V*2;break;case 2:N=.225*(((N=1.27323954*(T=6.28318531*((T=Q/V)>.5?T-1:T))+.405284735*T*T*(T<0?1:-1))<0?-1:1)*N*N-N)+N;break;case 3:N=tt[Math.abs(32*Q/V|0)]}g&&(F=K,(w*=v)<0?w=0:w>.1&&(w=.1),b?(J+=(N-K)*w,J*=q):(K=N,J=0),I+=(K+=J)-F,N=I*=1-f),k&&($[X%1024]=N,N+=$[(X-B+1024)%1024],X++),H+=N}H*=.125*G*m,c[it]=H>=1?32767:H<=-1?-32768:32767*H|0}return x}}var synth=new SfxrSynth,jsfxr=function(t){synth._params.setSettings(t);var i=synth.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),a=2*synth.synthWave(new Uint16Array(e.buffer,44),i),r=new Uint32Array(e.buffer,0,44);r[0]=1179011410,r[1]=a+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=a,a+=44;for(var s=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";s<a;s+=3){var n=e[s]<<16|e[s+1]<<8|e[s+2];o+=h[n>>18]+h[n>>12&63]+h[n>>6&63]+h[63&n]}return o};"function"==typeof require?module.exports=jsfxr:this.jsfxr=jsfxr;var LevelDef={template:{navNode:{type:"a-entity",attr:{geometry:"primitive:circle; radius: 0.5",material:"shader:flat;flatShading:true; color: #800080",lookat:"#player",class:"clickable",navigation:""}},tree:{type:"a-entity",attr:{shadow:""},children:[{type:"a-entity",attr:{geometry:"radius:0.8;height:6;primitive:cylinder",material:"color:#804000;roughness:1",position:"0 3 0"}},{type:"a-entity",attr:{geometry:"radius:2.3;primitive:sphere",position:"0 7.5 0",material:"color:#008000;roughness:1"}}]}},maze:{"hub.json":{width:512,height:512,floor:[{x:0,y:0,width:512,height:512}],solid:[{x:192,y:0,width:160,height:32},{x:320,y:32,width:32,height:96},{x:288,y:128,width:64,height:32},{x:320,y:160,width:64,height:32},{x:352,y:192,width:32,height:64},{x:384,y:192,width:128,height:32},{x:480,y:224,width:32,height:32},{x:384,y:320,width:96,height:32},{x:352,y:288,width:32,height:96},{x:288,y:352,width:64,height:32},{x:320,y:384,width:32,height:128},{x:192,y:480,width:128,height:32},{x:160,y:384,width:32,height:128},{x:128,y:352,width:96,height:32},{x:128,y:288,width:32,height:64},{x:32,y:320,width:96,height:32},{x:0,y:224,width:32,height:32},{x:0,y:192,width:128,height:32},{x:128,y:160,width:32,height:96},{x:160,y:128,width:32,height:64},{x:192,y:128,width:64,height:32},{x:192,y:32,width:32,height:96},{x:0,y:288,width:32,height:64},{x:480,y:288,width:32,height:64}],nav:[{x:272,y:80,start:!0,first:!1},{x:432,y:272,start:!0,first:!1},{x:80,y:272,start:!0,first:!1},{x:256,y:432,start:!1,first:!1},{x:256,y:256,start:!1,first:!1},{x:272,y:176,start:!1,first:!0},{x:336,y:272,start:!1,first:!0},{x:176,y:272,start:!1,first:!0},{x:256,y:336,start:!1,first:!1}],switch:[],door:[{x:224,y:360,width:64,height:16,name:"",openPos:{x:65,y:0},variables:["right_open","left_open"]},{x:8,y:256,width:16,height:32,name:"",openPos:{x:0,y:0},variables:[]},{x:488,y:256,width:16,height:32,name:"",openPos:{x:0,y:0},variables:[]},{x:136,y:256,width:16,height:32,name:"",openPos:{x:0,y:0},variables:[]}],trans:[{x:32,y:240,level:"left.json",side:"r",player:{x:0,y:0}},{x:240,y:128,level:"",side:"u",player:{x:0,y:0}},{x:384,y:240,level:"",side:"r",player:{x:0,y:0}},{x:128,y:304,level:"",side:"l",player:{x:0,y:0}},{x:480,y:304,level:"right.json",side:"l",player:{x:7.813,y:45.313}}],lvlDoor:[{x:256,y:136,width:32,height:16,openPos:{x:33,y:0}},{x:360,y:256,width:16,height:32,openPos:{x:0,y:-33}}]},"left.json":{width:1024,height:1024,floor:[{x:0,y:0,width:160,height:160}],solid:[{x:128,y:32,width:32,height:128},{x:0,y:128,width:64,height:32},{x:0,y:0,width:32,height:128},{x:32,y:0,width:128,height:32},{x:96,y:128,width:32,height:32}],nav:[{x:80,y:80,start:!1,first:!1}],switch:[],door:[{x:64,y:136,width:32,height:16,name:"",openPos:{},variables:["dummy"]}],trans:[{x:48,y:128,level:"",side:"u",player:{}}],lvlDoor:[]},"right.json":{width:1024,height:1024,floor:[{x:0,y:0,width:1024,height:1024}],solid:[{x:0,y:480,width:32,height:352},{x:800,y:0,width:160,height:32},{x:992,y:608,width:32,height:288},{x:512,y:992,width:448,height:32},{x:32,y:512,width:96,height:64},{x:128,y:128,width:64,height:224},{x:192,y:128,width:128,height:64},{x:96,y:64,width:256,height:32},{x:352,y:64,width:64,height:128},{x:256,y:224,width:64,height:128},{x:352,y:288,width:64,height:64},{x:704,y:320,width:96,height:128},{x:832,y:352,width:96,height:96},{x:416,y:704,width:64,height:160},{x:320,y:640,width:64,height:224},{x:288,y:512,width:192,height:96},{x:416,y:608,width:64,height:64},{x:384,y:640,width:32,height:32},{x:288,y:352,width:32,height:64},{x:448,y:320,width:96,height:128},{x:320,y:384,width:96,height:32},{x:416,y:384,width:32,height:64},{x:64,y:64,width:32,height:128},{x:32,y:192,width:96,height:224},{x:384,y:32,width:352,height:32},{x:704,y:64,width:32,height:192},{x:736,y:224,width:64,height:32},{x:736,y:32,width:96,height:160},{x:832,y:128,width:32,height:96},{x:832,y:224,width:96,height:96},{x:896,y:128,width:64,height:64},{x:928,y:32,width:32,height:96},{x:960,y:160,width:32,height:352},{x:896,y:480,width:64,height:64},{x:832,y:448,width:32,height:96},{x:640,y:480,width:192,height:64},{x:640,y:640,width:128,height:128},{x:512,y:768,width:160,height:64},{x:704,y:800,width:64,height:64},{x:224,y:896,width:64,height:64},{x:128,y:800,width:64,height:64},{x:128,y:576,width:64,height:128},{x:32,y:800,width:64,height:96},{x:64,y:896,width:128,height:96},{x:160,y:992,width:192,height:32},{x:320,y:896,width:224,height:96},{x:416,y:864,width:128,height:32},{x:544,y:864,width:64,height:32},{x:576,y:928,width:96,height:32},{x:640,y:832,width:32,height:96},{x:704,y:896,width:128,height:96},{x:896,y:864,width:96,height:32},{x:928,y:896,width:32,height:96},{x:800,y:800,width:64,height:96},{x:864,y:800,width:96,height:32},{x:928,y:672,width:32,height:128},{x:800,y:672,width:128,height:32},{x:800,y:704,width:32,height:64},{x:832,y:736,width:64,height:32},{x:640,y:544,width:352,height:96},{x:576,y:352,width:96,height:128},{x:416,y:480,width:224,height:32},{x:512,y:544,width:96,height:32},{x:512,y:576,width:32,height:96},{x:544,y:608,width:96,height:64},{x:512,y:704,width:32,height:64},{x:544,y:704,width:64,height:32},{x:128,y:480,width:32,height:96},{x:128,y:352,width:32,height:96},{x:320,y:224,width:160,height:32},{x:416,y:288,width:416,height:32},{x:448,y:96,width:32,height:128},{x:480,y:96,width:192,height:32},{x:640,y:128,width:32,height:128},{x:512,y:224,width:128,height:32},{x:512,y:160,width:32,height:64},{x:544,y:160,width:64,height:32},{x:256,y:576,width:32,height:160},{x:64,y:736,width:160,height:32},{x:64,y:608,width:32,height:128},{x:224,y:736,width:64,height:128},{x:0,y:192,width:32,height:256}],nav:[{x:80,y:464,start:!0,first:!1},{x:176,y:464,start:!1,first:!0},{x:224,y:384,start:!1,first:!1},{x:224,y:544,start:!1,first:!1},{x:272,y:464,start:!1,first:!1},{x:400,y:464,start:!1,first:!1},{x:560,y:464,start:!1,first:!1},{x:560,y:336,start:!1,first:!1},{x:688,y:336,start:!1,first:!1},{x:688,y:464,start:!1,first:!1},{x:816,y:464,start:!1,first:!1},{x:816,y:336,start:!1,first:!1},{x:944,y:336,start:!1,first:!1},{x:944,y:464,start:!1,first:!1},{x:880,y:464,start:!1,first:!1},{x:944,y:208,start:!1,first:!1},{x:880,y:208,start:!1,first:!1},{x:880,y:80,start:!1,first:!1},{x:224,y:720,start:!1,first:!1},{x:112,y:720,start:!1,first:!1},{x:112,y:592,start:!1,first:!1},{x:48,y:592,start:!1,first:!1},{x:48,y:784,start:!1,first:!1},{x:112,y:784,start:!1,first:!1},{x:208,y:784,start:!1,first:!1},{x:112,y:880,start:!1,first:!1},{x:208,y:880,start:!1,first:!1},{x:304,y:880,start:!1,first:!1},{x:304,y:976,start:!1,first:!1},{x:208,y:976,start:!1,first:!1},{x:304,y:752,start:!1,first:!1},{x:304,y:624,start:!1,first:!1},{x:400,y:880,start:!1,first:!1},{x:400,y:688,start:!1,first:!1},{x:400,y:784,start:!1,first:!1},{x:496,y:688,start:!1,first:!1},{x:624,y:688,start:!1,first:!1},{x:624,y:752,start:!1,first:!1},{x:560,y:752,start:!1,first:!1},{x:496,y:784,start:!1,first:!1},{x:496,y:848,start:!1,first:!1},{x:624,y:848,start:!1,first:!1},{x:624,y:912,start:!1,first:!1},{x:560,y:912,start:!1,first:!1},{x:560,y:976,start:!1,first:!1},{x:688,y:976,start:!1,first:!1},{x:688,y:880,start:!1,first:!1},{x:688,y:784,start:!1,first:!1},{x:784,y:784,start:!1,first:!1},{x:784,y:880,start:!1,first:!1},{x:912,y:784,start:!1,first:!1},{x:912,y:720,start:!1,first:!1},{x:784,y:656,start:!1,first:!1},{x:976,y:656,start:!1,first:!1},{x:976,y:848,start:!1,first:!1},{x:880,y:848,start:!1,first:!1},{x:880,y:944,start:!1,first:!1},{x:976,y:752,start:!1,first:!1},{x:880,y:656,start:!1,first:!1},{x:224,y:208,start:!1,first:!1},{x:336,y:208,start:!1,first:!1},{x:336,y:112,start:!1,first:!1},{x:208,y:112,start:!1,first:!1},{x:112,y:112,start:!1,first:!1},{x:432,y:208,start:!1,first:!1},{x:432,y:80,start:!1,first:!1},{x:688,y:80,start:!1,first:!1},{x:688,y:272,start:!1,first:!1},{x:496,y:272,start:!1,first:!1},{x:496,y:144,start:!1,first:!1},{x:624,y:144,start:!1,first:!1},{x:624,y:208,start:!1,first:!1},{x:336,y:272,start:!1,first:!1},{x:368,y:368,start:!1,first:!1},{x:432,y:368,start:!1,first:!1},{x:816,y:272,start:!1,first:!1},{x:816,y:208,start:!1,first:!1},{x:496,y:528,start:!1,first:!1},{x:624,y:528,start:!1,first:!1},{x:624,y:592,start:!1,first:!1}],switch:[{x:880,y:976,type:"door",target:"door_1",indicator:"#ind_sub"},{x:880,y:48,type:"variable",target:"right_open",indicator:"#ind_right"}],door:[{x:928,y:256,width:32,height:32,name:"door_1",openPos:{x:-33,y:0},variables:[]},{x:8,y:448,width:16,height:32,name:"",openPos:{x:0,y:0},variables:[]}],trans:[{x:32,y:432,level:"hub.json",side:"r",player:{x:42.188,y:26.563}},{x:128,y:496,level:"",side:"l",player:{}}],lvlDoor:[{x:136,y:448,width:16,height:32,openPos:{x:0,y:-33}}]}},level:{"hub.json":{player:{x:26.563,y:1.6,z:7.813},objects:[{type:"a-entity",attr:{maze:"maze: hub.json; size: 50 50 5",position:"0 0 0"}},{type:"a-plane",attr:{rotation:"90 0 0",width:"50",height:"50",color:"#ccc",shadow:"",position:"25 5 25"}},{type:"a-entity",attr:{position:"30 3 34.5",rotation:"90 180 0",indicator:"variable: right_open; onColour: #f00; offColour: #300"}},{type:"a-entity",attr:{position:"20 3 34.5",rotation:"90 180 0",indicator:"variable: left_open; onColour: #00f; offColour: #003"}},{type:"a-entity",attr:{position:"25 1.6 46",rotation:"0 180 0",text:"width:6;value:The End...\n(this took way longer than anticipated);align:center"}}]},"left.json":{player:{x:0,y:1.6,z:0},objects:[{type:"a-entity",attr:{maze:"maze: left.json; size: 100 100 5",position:"0 0 0"}}]},"right.json":{player:{x:7.8125,y:1.6,z:45.3125},objects:[{type:"a-entity",attr:{maze:"maze: right.json; size: 100 100 5",position:"0 0 0"}},{type:"a-plane",attr:{rotation:"90 0 0",width:"100",height:"100",color:"#ccc",shadow:"",position:"50 5 50"}},{type:"a-entity",attr:{id:"ind_sub",position:"86 3 97",rotation:"90 0 0",indicator:"variable: dummy; onColour: #0f0; offColour: #030"}},{type:"a-entity",attr:{id:"ind_right",position:"86 3 3",rotation:"90 0 0",indicator:"variable: right_open; onColour: #f00; offColour: #300"}}]},"start.json":{player:{x:9,y:1.6,z:30},objects:[{type:"a-sky",attr:{color:"#00AAEE"}},{type:"a-entity",attr:"",children:[{type:"a-plane",attr:{rotation:"-90 0 0",position:"7.813 0 7.813",width:"15.625",height:"15.625",color:"#777"}},{type:"a-plane",attr:{rotation:"90 0 0",position:"7.813 5 7.813",width:"15.625",height:"15.625",color:"#ccc"}},{type:"a-box",attr:{position:"9.375 2.5 1.563",width:"12.5",height:"5",depth:"3.125",color:"#aaa",class:"solid"}},{type:"a-box",attr:{position:"14.063 2.5 9.375",width:"3.125",height:"5",depth:"12.5",color:"#aaa",class:"solid"}},{type:"a-box",attr:{position:"10.938 2.5 14.063",width:"3.125",height:"5",depth:"3.125",color:"#aaa",class:"solid"}},{type:"a-box",attr:{position:"3.125 2.5 14.0625",width:"6.25",height:"5",depth:"3.125",color:"#aaa",class:"solid"}},{type:"a-box",attr:{position:"1.563 2.5 6.25",width:"3.125",height:"5",depth:"12.5",color:"#aaa",class:"solid"}}]},{type:"a-plane",attr:{rotation:"-90 0 0",position:"-10.5 0 17",width:"21",height:"58",color:"#009b00",shadow:""}},{type:"a-plane",attr:{rotation:"-90 0 0",position:"7.813 0 30.813",width:"15.625",height:"30.375",color:"#009b00",shadow:""}},{type:"a-plane",attr:{rotation:"-90 0 0",position:"26 0 17",width:"22",height:"58",color:"#009b00",shadow:""}},{type:"a-box",attr:{position:"4.688 2 12.4",geometry:"depth:0.1;width:0.2;height:0.2",switch:"target:#door; event:close",class:"clickable",clickableupdator:"1500",lostsound:"snd:click; on: click",levelchange:"level: hub.json; position: 26.563 1.6 7.813; delay: 2000"}},{type:"a-box",attr:{position:"4.688 2 15.650",geometry:"depth:0.1;width:0.2;height:0.2",switch:"target:#door; event:open",class:"clickable",clickableupdator:"1500",lostsound:"snd:click; on: click"}},{type:"a-box",attr:{position:"7.813 2.5 14.063",width:"3.125",height:"5",depth:"1.5625",id:"door",class:"solid"},children:[{type:"a-animation",attr:{begin:"open",attribute:"position",from:"7.813 2.5 14.063",to:"4.5 2.5 14.063",duration:"1500",easing:"ease-in",fill:"forwards"}},{type:"a-animation",attr:{begin:"close",attribute:"position",to:"7.813 2.5 14.063",from:"4.5 2.5 14.063",duration:"1500",easing:"ease-in",fill:"forwards"}}]},{type:"a-entity",attr:{position:"-20 0 -11",forest:"55 9"}},{type:"a-entity",attr:{position:"-20 0 0",forest:"18 34"}},{type:"a-entity",attr:{position:"17 0 0",forest:"13 34"}},{type:"a-entity",attr:{position:"-20 0 35",forest:"55 20"}},{type:"a-entity",attr:{position:"-21 4 17",rotation:"0 90 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"37 4 17",rotation:"0 270 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"8 4 -12",rotation:"0 0 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{type:"a-entity",attr:{position:"8 4 46",rotation:"0 180 0",geometry:"width:60;height:8;primitive:plane",material:"color:#391d00;shader:flat"}},{template:"navNode",attr:{position:"7.5 0.5 19",visible:"true"}},{template:"navNode",attr:{position:"7.813 0.5 7.813",visible:"true"}},{template:"navNode",attr:{position:"9 0.5 30",visible:"false"}}]}}};AFRAME.registerComponent("clickableupdator",{schema:{type:"number",default:0},init:function(){this.timer=this.data,this.running=!1;var t=this;this.el.addEventListener("click",function(){t.onClick()}),console.log("updator for "+this.timer)},onClick:function(){this.timer=this.data,this.running=!0,console.log("updator triggered "+this.timer)},tick:function(t,i){if(this.running&&(this.timer-=i,this.timer<=0)){this.running=!1;var e=this.el.sceneEl.querySelector("#player");e.emit("move",e.getAttribute("position")),console.log("update!!!")}}}),AFRAME.registerComponent("forest",{schema:{type:"vec2"},init:function(){this.el;for(var t=this.data.x,i=this.data.y,e=0;e<t;e+=3.6)for(var a=0;a<i;a+=3.6){var r=e+.8+2*Math.random(),s=a+.8+2*Math.random(),h=-3*Math.random(),o=SceneBuilder.buildElement(LevelDef.template.tree);o.setAttribute("position",r+" "+h+" "+s),this.el.appendChild(o)}}}),AFRAME.registerComponent("indicator",{schema:{variable:{type:"string"},onColour:{type:"color"},offColour:{type:"color"}},init:function(){this.el.setAttribute("geometry",{radius:.5,height:.5,primitive:"cylinder"});var t=window.lostVars[this.data.variable];this.setMaterial(t);var i=this;this.el.addEventListener("activated",function(){i.setMaterial(!0)})},setMaterial:function(t){this.el.setAttribute("material",{color:t?this.data.onColour:this.data.offColour})}}),AFRAME.registerComponent("levelchange",{schema:{level:{type:"string"},delay:{type:"number",default:0},position:{type:"vec3"}},init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.transition()}),this.timer=this.data.delay,this.lit=!1,this.triggered=!1},tick:function(t,i){this.lit&&(this.timer-=i,this.timer<=0&&(this.el.sceneEl.emit("changeLevel",{level:this.data.level,position:this.data.position},!1),this.lit=!1))},transition:function(){this.triggered||(this.lit=!0,this.triggered=!0)}}),AFRAME.registerComponent("lookat",{schema:{type:"selector",default:"[camera]"},init:function(){this.target=null},update:function(){if(this.data){if(!this.data.hasLoaded){var t=this;return t.data.addEventListener("loaded",function(){t.target=t.data.object3D})}this.target=this.data.object3D}},tick:function(){if(this.target){var t=this.el.object3D.parent.worldToLocal(this.target.getWorldPosition()),i=null;this.el.getObject3D("camera")?i.subVectors(this.el.object3D.position,t).add(this.el.object3D.position):i=t,this.el.object3D.lookAt(i)}}}),AFRAME.registerComponent("lostsound",{schema:{snd:{type:"string"},on:{type:"string"}},init:function(){this.el.setAttribute("sound","src: url("+SoundLibrary[this.data.snd]+"); on: "+this.data.on)}}),AFRAME.registerComponent("lost",{init:function(){this.clickableList=[],window.lostVars={left_open:!0,right_open:!1},this.mazeCount=0,this.mazeLoaded=0;var t=this;this.el.addEventListener("changeLevel",function(i){t.loadScene(i.detail.level,i.detail.position)}),this.el.addEventListener("setVariable",function(i){t.onSetVariable(i.detail[0],i.detail[1])}),this.el.addEventListener("mazeLoaded",function(i){t.onMazeLoaded()}),this.player=this.el.sceneEl.querySelector("#player"),this.player.addEventListener("move",function(i){t.onPlayerMove(i.detail)}),this.loadScene("start.json")},tick:function(t,i){},loadScene:function(t,i){var e=this.el;this.mazeLoaded=0;for(var a=e.querySelectorAll("a-scene>.vr:not(.global)"),r=0;r<a.length;r++)e.removeChild(a[r]);var s=LevelDef.level[t],h=i||s.player;this.player.setAttribute("position",h),SceneBuilder.buildChildren(e,s.objects);var o=e.querySelectorAll("[maze]");this.mazeCount=o.length,0==this.mazeCount&&(this.clickableList=e.querySelectorAll(".clickable"),this.onPlayerMove(h),e.emit("loaded"))},onMazeLoaded:function(){if(this.mazeLoaded++,this.mazeCount==this.mazeLoaded){this.clickableList=this.el.querySelectorAll(".clickable"),console.log(this.clickableList);var t=this.player.getAttribute("position");this.onPlayerMove(t),this.el.emit("loaded")}console.log("maze loaded "+this.mazeLoaded+" of "+this.mazeCount)},onPlayerMove:function(t){var i=this.el,e=new THREE.Raycaster;e.near=0;for(var a=new THREE.Vector3(t.x,t.y,t.z),r=i.querySelectorAll(".solid"),s=[],h=0;h<r.length;h++)s.push(r[h].object3D);for(h=0;h<this.clickableList.length;h++){var o=this.clickableList[h];if(o.getAttribute("position")){var n=!1,l=new THREE.Vector3;l.setFromMatrixPosition(o.object3D.matrixWorld);var d=a.distanceTo(l);if(d<=20){var y=new THREE.Vector3;y.subVectors(l,a).normalize(),e.far=d,e.set(a,y),0==e.intersectObjects(s,!0).length&&(n=!0)}var c=o.classList.contains("clickable");c&&!n?o.classList.remove("clickable"):!c&&n&&o.classList.add("clickable")}}i.querySelector("#player>.cursor").components.raycaster.refreshObjects()},onSetVariable:function(t,i){window.lostVars[t]=i,console.log("set variable "+t+" to "+i)}}),AFRAME.registerComponent("maze",{schema:{maze:{type:"string"},size:{type:"vec3"}},init:function(){var t=LevelDef.maze[this.data.maze];this.build(t),this.el.sceneEl.emit("mazeLoaded")},build:function(t){console.log(t);for(var i in t.floor)this.buildFloor(t.floor[i],t.width,t.height);for(var i in t.solid)this.buildSolid(t.solid[i],t.width,t.height);for(var i in t.nav)this.buildNav(t.nav[i],t.width,t.height);for(var i in t.door)this.buildDoor(t.door[i],t.width,t.height);for(var i in t.switch)this.buildSwitch(t.switch[i],t.width,t.height);for(var i in t.trans)this.buildTrans(t.trans[i],t.width,t.height);for(var i in t.lvlDoor)this.buildLvlDoor(t.lvlDoor[i],t.width,t.height)},buildFloor:function(t,i,e){var a=t.width/i*this.data.size.x,r=t.height/e*this.data.size.y,s={type:"a-plane",attr:{rotation:"-90 0 0",position:t.x/i*this.data.size.x+a/2+" 0 "+(t.y/e*this.data.size.y+r/2),width:a,height:r,color:"#777",shadow:""}};this.el.appendChild(SceneBuilder.buildElement(s))},buildSolid:function(t,i,e){var a=t.width/i*this.data.size.x,r=t.height/e*this.data.size.y,s=t.x/i*this.data.size.x+a/2,h=t.y/e*this.data.size.y+r/2,o={type:"a-box",attr:{position:s+" "+this.data.size.z/2+" "+h,width:a,height:this.data.size.z,depth:r,color:"#aaa",shadow:"",class:"solid"}};this.el.appendChild(SceneBuilder.buildElement(o))},buildNav:function(t,i,e){var a=t.x/i*this.data.size.x,r=t.y/e*this.data.size.y,s={type:"a-entity",attr:{geometry:"primitive:circle; radius: 0.5",material:"shader:flat;flatShading:true; color: #800080",lookat:"#player",class:"clickable",navigation:"start: "+t.start+"; first: "+t.first,position:a+" 0.5 "+r}};this.el.appendChild(SceneBuilder.buildElement(s))},buildDoor:function(t,i,e){var a=t.width/i*this.data.size.x,r=t.height/e*this.data.size.y,s=t.x/i*this.data.size.x+a/2,h=t.y/e*this.data.size.y+r/2,o=this.data.size.z/2,n=s+t.openPos.x/i*this.data.size.x,l=h+t.openPos.y/e*this.data.size.y;if(t.variables.length>0){for(var d=!0,y=0;y<t.variables.length;y++)if(!window.lostVars[t.variables[y]]){d=!1;break}d&&(s=n,h=l)}var c={type:"a-box",attr:{position:s+" "+o+" "+h,width:a,height:this.data.size.z,depth:r,color:"#ccc",shadow:"",class:"solid",id:t.name},children:[{type:"a-animation",attr:{begin:"open",attribute:"position",from:s+" "+o+" "+h,to:n+" "+o+" "+l,duration:1500,easing:"ease-in",fill:"forwards"}}]};this.el.appendChild(SceneBuilder.buildElement(c))},buildSwitch:function(t,i,e){var a=t.x/i*this.data.size.x,r=t.y/e*this.data.size.y,s=(t.type,{type:"a-entity",attr:{position:a+" 0.5 "+r,shadow:""},children:[{type:"a-box",attr:{width:.5,height:1,depth:.5,color:"#aaa"}},{type:"a-sphere",attr:{position:"0 0.5 0",radius:.2,color:"#f00",switch:"target: "+("variable"==t.type?"a-scene":"#"+t.target)+"; event: "+("door"==t.type?"open":"setVariable")+("variable"==t.type?"; data: "+t.target+", true":"")+(t.indicator?"; indicator: "+t.indicator:""),class:"clickable",lostsound:"snd:click; on: click"}}]});this.el.appendChild(SceneBuilder.buildElement(s))},buildTrans:function(t,i,e){var a=0,r=0;"u"==t.side&&(r=-.1),"r"==t.side&&(a=.1),"d"==t.side&&(r=.1),"l"==t.side&&(a=-.1);var s=t.x/i*this.data.size.x+a,h=t.y/e*this.data.size.y+r,o=.2+a,n=.2+r,l=t.player.x,d=t.player.y,y={type:"a-box",attr:{position:s+" 2 "+h,class:"clickable",lostsound:"snd:click; on: click",geometry:"depth:"+n+";width:"+o+";height:0.2"}};""!=t.level&&(y.attr.levelchange="level: "+t.level+"; position: "+l+" 1.6 "+d),this.el.appendChild(SceneBuilder.buildElement(y))},buildLvlDoor:function(t,i,e){var a=t.width/i*this.data.size.x,r=t.height/e*this.data.size.y,s=t.x/i*this.data.size.x+a/2,h=t.y/e*this.data.size.y+r/2,o=this.data.size.z/2,n=s+t.openPos.x/i*this.data.size.x,l=h+t.openPos.y/e*this.data.size.y,d={type:"a-box",attr:{position:s+" "+o+" "+h,width:a,height:this.data.size.z,depth:r,color:"#ccc",shadow:"",class:"solid",id:t.name},children:[{type:"a-animation",attr:{attribute:"position",from:s+" "+o+" "+h,to:n+" "+o+" "+l,duration:1500,easing:"ease-in",fill:"forwards"}}]};this.el.appendChild(SceneBuilder.buildElement(d))}}),AFRAME.registerComponent("navigation",{schema:{start:{type:"boolean",default:!1},first:{type:"boolean",default:!0}},init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.click()}),this.data.start&&this.el.setAttribute("visible",!1),this.data.first||this.el.classList.remove("clickable")},click:function(){var t=this.el.sceneEl.querySelector("#player"),i=this.el.getAttribute("position"),e=t.getAttribute("position"),a=i.x+" "+e.y+" "+i.z,r=document.createElement("a-animation");r.setAttribute("attribute","position"),r.setAttribute("to",a),r.setAttribute("dur","500"),r.setAttribute("repeat","0"),t.appendChild(r),this.el.setAttribute("visible",!1);for(var s=this.el.sceneEl.querySelectorAll("[navigation]"),h=0;h<s.length;h++){var o=s[h];o!==this.el&&o.setAttribute("visible",!0)}t.emit("move",i)}});var SceneBuilder=function(){function t(t,i){var e={};if("attr"in t)for(var a in t.attr)e[a]=t.attr[a];if("attr"in i)for(var a in i.attr)e[a]=i.attr[a];return e}function i(t,i,e){return t in i?i[t]:e[t]}function e(e){var r={};"template"in e&&(r=LevelDef.template[e.template]);var s=document.createElement(i("type",e,r)),h=t(r,e);for(var o in h)s.setAttribute(o,h[o]);return"children"in r&&a(s,r.children),"children"in e&&a(s,e.children),s.classList.add("vr"),s}function a(t,i){for(var a=0;a<i.length;a++){var r=e(i[a]);t.appendChild(r)}}return{buildElement:e,buildChildren:a}}(),SoundLibrary=function(){var t={click:[0,.16,.184,.944,.144,.272,.16,-.008,-.472,.16,.4479,-.2319,.472,.368,.008,,.04,.328,1,.072,.944,,.008,.5]},i={};for(var e in t)i[e]=jsfxr(t[e]);return i}();AFRAME.registerComponent("switch",{schema:{target:{type:"selector"},event:{type:"string"},data:{type:"array"},indicator:{type:"selector"}},init:function(){var t=this;this.el&&this.el.addEventListener("click",function(){t.onClick()})},onClick:function(){console.log(this.data),this.data.target.emit(this.data.event,this.data.data),this.data.indicator&&this.data.indicator.emit("activated")}});</script></head><body><a-scene lost><a-entity id=player position="9 0 30" camera=userHeight:1.6 rotation="0 0 0" look-controls class=global><a-entity class=cursor cursor="fuse: true; fuseTimeout: 500;" position="0 0 -1" geometry="primitive:circle; radius: 0.2;" material="color: cyan; shader: flat;" scale="0.1 0.1 0.1" raycaster="objects:.clickable; far:20"><a-animation begin=fusing end=mouseleave easing=ease-in attribute=scale from="0.5 0.5 0.5" to="0.1 0.1 0.1" fill=backwards dur=500></a-animation></a-entity></a-entity></a-scene></body></html>