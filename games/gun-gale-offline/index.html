<title>Gun Gale Offline</title><script src=/2018/webxr/aframe.js></script><script>!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("shooter",{schema:{activeBulletType:{type:"string",default:"normal"},bulletTypes:{type:"array",default:["normal"]},cycle:{default:!1}},init:function(){this.el.addEventListener("shoot",this.onShoot.bind(this)),this.el.addEventListener("changebullet",this.onChangeBullet.bind(this)),this.bulletSystem=this.el.sceneEl.systems.bullet},onShoot:function(){this.bulletSystem.shoot(this.data.activeBulletType,this.el.object3D)},onChangeBullet:function(t){var e,i=this.data,o=this.el;if("next"===t.detail){if(-1===(e=i.bulletTypes.indexOf(i.activeBulletType)))return;return e=i.cycle?(e+1)%i.bulletTypes.length:Math.min(i.bulletTypes.length-1,e+1),i.activeBulletType=i.bulletTypes[e],void o.setAttribute("shooter","activeBulletType",i.bulletTypes[e])}if("prev"===t.detail){if(-1===(e=i.bulletTypes.indexOf(i.activeBulletType)))return;return e=i.cycle?(e-1)%i.bulletTypes.length:Math.max(0,e-1),i.activeBulletType=i.bulletTypes[e],void o.setAttribute("shooter","activeBulletType",i.bulletTypes[e])}o.setAttribute("shooter","activeBulletType",t.detail)}}),AFRAME.registerComponent("bullet",{dependencies:["material"],schema:{damagePoints:{default:1,type:"float"},maxTime:{default:4,type:"float"},name:{default:"normal",type:"string"},poolSize:{default:10,type:"int",min:0},speed:{default:8,type:"float"}},init:function(){var t=this.el;t.object3D.visible=!1,t.addEventListener("object3dset",(e=>{t.sceneEl.systems.bullet.registerBullet(this)}))}}),AFRAME.registerSystem("bullet",{init:function(){var t;(t=document.createElement("a-entity")).id="superShooterBulletContainer",this.el.sceneEl.appendChild(t),this.container=t.object3D,this.pool={},this.targets=[]},registerBullet:function(t){var e,i,o,n;if(n=t.el.object3D)for(i=t.data,this.pool[i.name]=[],o=0;o<i.poolSize;o++)(e=n.clone()).damagePoints=i.damagePoints,e.direction=new THREE.Vector3(0,0,-1),e.maxTime=1e3*i.maxTime,e.name=i.name+o,e.speed=i.speed,e.time=0,e.visible=!1,this.pool[i.name].push(e)},registerTarget:function(t,e){var i;this.targets.push(t.el),e&&((i=t.el.object3D).boundingBox=(new THREE.Box3).setFromObject(i))},shoot:function(t,e){var i,o=0,n=0,l=this.pool[t];if(void 0===l)return null;for(i=0;i<l.length;i++){if(!1===l[i].visible)return this.shootBullet(l[i],e);l[i].time>n&&(o=i,n=l[i].time)}return this.shootBullet(l[o],e)},shootBullet:function(t,e){return t.visible=!0,t.time=0,e.getWorldPosition(t.position),e.getWorldDirection(t.direction),t.direction.multiplyScalar(-t.speed),this.container.add(t),t},tick:function(){var t=new THREE.Box3,e=new THREE.Vector3,i=new THREE.Box3;return function(o,n){var l,r,s,a,u;for(r=0;r<this.container.children.length;r++)if((l=this.container.children[r]).visible)if(l.time+=n,l.time>=l.maxTime)this.killBullet(l);else for(e.copy(l.direction).multiplyScalar(n/850),l.position.add(e),t.setFromObject(l),u=0;u<this.targets.length;u++){let e=this.targets[u];if(e.getAttribute("target").active&&(a=e.object3D).visible&&(s=!1,a.boundingBox?s=a.boundingBox.intersectsBox(t):(i.setFromObject(a),s=i.intersectsBox(t)),s)){this.killBullet(l),e.components.target.onBulletHit(l),e.emit("hit",null);break}}}}(),killBullet:function(t){t.visible=!1}}),AFRAME.registerComponent("target",{schema:{active:{default:!0},healthPoints:{default:2,type:"float"},static:{default:!0}},init:function(){var t=this.el;t.addEventListener("object3dset",(e=>{t.sceneEl.systems.bullet.registerTarget(this,this.data.static)}));var e=document.createElement("a-text");e.setAttribute("id","life"),e.setAttribute("value","Life : 2"),e.setAttribute("look-at","#camera"),e.setAttribute("position",{x:.5,y:1,z:-3}),t.appendChild(e)},update:function(t){this.healthPoints=this.data.healthPoints},onBulletHit:function(t){let e="Life : "+(this.healthPoints-1);console.log(e),this.el.children[1].setAttribute("value",e),console.log(this.healthPoints),this.data.active&&(this.lastBulletHit=t,this.healthPoints-=t.damagePoints,this.healthPoints<=0&&this.el.emit("die"))}})}]),function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=t,e.c=i,e.p="",e(0)}([function(t,e){var i=AFRAME.utils.debug,o=AFRAME.utils.coordinates,n=i("components:look-at:warn"),l=o.isCoordinates||o.isCoordinate;delete AFRAME.components["look-at"],AFRAME.registerComponent("look-at",{schema:{default:"",parse:function(t){return l(t)||"object"==typeof t?o.parse(t):t},stringify:function(t){return"object"==typeof t?o.stringify(t):t}},init:function(){this.target3D=null,this.vector=new THREE.Vector3},update:function(){var t,e=this,i=e.data,o=e.el.object3D;return!i||"object"==typeof i&&!Object.keys(i).length?e.remove():"object"==typeof i?o.lookAt(new THREE.Vector3(i.x,i.y,i.z)):(t=e.el.sceneEl.querySelector(i))?t.hasLoaded?e.beginTracking(t):t.addEventListener("loaded",(function(){e.beginTracking(t)})):void n('"'+i+'" does not point to a valid entity to look-at')},tick:function(){var t=new THREE.Vector3;return function(e){var i=this.target3D,o=this.el.object3D,n=this.vector;i&&(o.parent.worldToLocal(i.getWorldPosition(t)),this.el.getObject3D("camera")?n.subVectors(o.position,t).add(o.position):n=t,o.lookAt(n))}}(),beginTracking:function(t){this.target3D=t.object3D}})}])</script><script>AFRAME.registerComponent("click-to-shoot",{init:function(){document.body.addEventListener("mousedown",(()=>{this.el.emit("shoot")}))}}),AFRAME.registerComponent("hit-handler",{dependencies:["material"],init:function(){var e=this.el;e.addEventListener("hit",(()=>{})),e.addEventListener("die",(()=>{e.parentNode.removeChild(e)}))}}),AFRAME.registerPrimitive("a-p",{defaultComponents:{p:{}}}),AFRAME.registerComponent("p",{init:function(){this.el.innerHTML='<a-octahedron id="o" color="#FF926B" radius="5" scale="0.5 0.5 0.5" position="0 0 -5">\n        <a-animation attribute="rotation" dur="5000" fill="forwards" to="0 360 360" easing="ease-in-out" direction="alternate" repeat="indefinite"></a-animation>\n        <a-animation attribute="position" dur="5000" fill="forwards" to="0 2 -10" easing="ease-in-out" direction="alternate" repeat="indefinite"></a-animation>\n      </a-octahedron>'}})</script><body><a-scene light="defaultLightsEnabled: false"><a-entity id=light light="type:point;color:rgb(19, 41, 198);"></a-entity><a-entity id=bulletTemplate bullet geometry="primitive: sphere; radius: 0.1" material="color: orange"></a-entity><a-camera click-to-shoot id=camera position="-1 0 0" shooter></a-camera><a-sky color=#29292d></a-sky></a-scene><script>let light=document.getElementById("light");function getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}function change(){let t="rgb("+getRandomInt(256)+", "+getRandomInt(256)+", "+getRandomInt(256)+")";light.setAttribute("light",{color:t}),setTimeout(change,1e3)}function add(){let t=document.querySelector("a-scene"),e=document.createElement("a-p");var n=20*Math.random()-10,a=20*Math.random()-10,o=20*Math.random()-10;e.setAttribute("position",{x:Math.round(n),y:Math.round(a),z:Math.round(o)}),e.setAttribute("class","target"),e.setAttribute("target",""),e.setAttribute("hit-handler",""),t.appendChild(e)}change();for(var i=0;i<30;i++)add()</script>