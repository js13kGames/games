<!doctype html><title>Onamazu - js13kGames 2025</title><meta content="width=device-width" name=viewport><style>body{margin:0;display:grid;place-items:center;min-width:320px;min-height:100vh;background-color:#242424}#c{background-color:#867edc}</style><canvas height=768 id=c width=1024><script>function t(t){if(t.length>=2){t.unshift(t[0]),t.push(t[t.length-1]),O.moveTo(t[1].x,t[1].y);for(let i=0;t.length-1>i;i++){const e=t[0===i?0:i-1],s=t[i],n=t[i+1],o=t[t.length>i+2?i+2:t.length-1];O.bezierCurveTo(s.x+(n.x-e.x)/6,s.y+(n.y-e.y)/6,n.x-(o.x-s.x)/6,n.y-(o.y-s.y)/6,n.x,n.y)}}}function i(t,i){O.ellipse(t.x,t.y,i,i,0,0,2*Math.PI)}function e(t,i,e,s){O.ellipse(t.x,t.y,i,e,s,0,2*Math.PI)}function s(t,i,e,s){const n=i.x-t.x,o=i.y-t.y,a=s.x-e.x,h=s.y-e.y,r=h*n-a*o;if(0===r)return null;const l=((t.y-e.y)*a-(t.x-e.x)*h)/r,p=((t.y-e.y)*n-(t.x-e.x)*o)/r;return 0>l||l>1||0>p||p>1?null:{t:new B(t.x+n*l,t.y+o*l),i:l}}function n(t,i,e){const s=new B(t.y,-t.x).normalize(),n=new B(-t.y,t.x).normalize(),o=i.o[(e+1)%i.o.length],a=i.o[e].clone().add(o).scale(.5),h=i.o.reduce((t,i)=>t.add(i),new B(0,0)).scale(1/i.o.length).clone().h(a);return s.p(h)<n.p(h)?s:n}function o(t,i,e){let o=null;const a={min:new B(Math.min((h=t).x,(r=i).x),Math.min(h.y,r.y)),max:new B(Math.max(h.x,r.x),Math.max(h.y,r.y))};var h,r;for(const h of e)if(p(a,h.u))for(let e=0;h.o.length>e;e++){const a=h.o[e],r=h.o[(e+1)%h.o.length],l=s(t,i,a,r);if(l&&(!o||o.i>l.i)){const t=n(r.clone().h(a),h,e);o={l:l.t,m:t,i:l.i}}}return o}function a(t,i){const e=t.p(i),s=i.clone().scale(e);return t.clone().h(s)}function h(t,i,e,s=3){let n=t.clone(),h=i.clone(),r=1;const l=1e-4;for(let t=0;s>t&&r>l;t++){const t=n.clone().add(h.clone().scale(r)),i=o(n,t,e);if(!i){n=t;break}const s=h.clone().scale(r*i.i);if(n.add(s),n.add(i.m.clone().scale(l)),r*=1-i.i,h=a(h,i.m),1e-8>h.v)break}return n}function r(t,i,e){const s=e.clone().h(i),n=t.clone().h(i),o=s.v;if(0===o)return i.clone();const a=Math.max(0,Math.min(1,n.p(s)/o));return i.clone().add(s.scale(a))}function l(t,i,e){const s=e.o;let n=1/0;for(let i=0;s.length>i;i++){const e=r(t,s[i],s[(i+1)%s.length]),o=t.clone().h(e).v;n>o&&(n=o)}return i>=Math.sqrt(n)||((t,i)=>{const e=i.o;let s=0;for(let i=0;e.length>i;i++){const n=e[i],o=e[(i+1)%e.length];n.y>t.y?o.y>t.y||0>(o.x-n.x)*(t.y-n.y)-(t.x-n.x)*(o.y-n.y)&&s--:o.y>t.y&&(o.x-n.x)*(t.y-n.y)-(t.x-n.x)*(o.y-n.y)>0&&s++}return 0!==s})(t,e)}function p(t,i){return!(t.min.x>i.max.x||i.min.x>t.max.x||t.min.y>i.max.y||i.min.y>t.max.y)}function c(t,i,e,s){return"boat"===t?{type:"boat",value:1e3,speed:.2,i:0,position:i,path:e,k:s}:{type:"fish",body:new N(Tt[t].body),value:Tt[t].value,speed:Tt[t].speed,position:i,path:e,k:s}}function f(t,i){const e=i.A.position.clone().h(t).normalize().scale(5),s=t.clone().add(e.scale(10));i.S.push(new mt(s,e.angle,1))}function d(t=10){const e=1.2*O.scale;O.T.fillStyle="#867edc",O.T.lineWidth=e,O.T.strokeStyle="#b0acdc";for(let e=0;100/t*2>=e;e+=1)for(let s=0;160/t>=s;s+=1){const n=new B((s+e%2/2)*t*2-80,e*t/2-45);O.T.beginPath();for(let e=0;4>e;e+=1)i(n,t-t/3*e);O.T.fill(),O.T.stroke()}}function y(t=1,i=new B(0,45)){const e=new B(1,1).scale(t);Yt.draw(i,e),Qt.draw(i,e),Ut.draw(i,e)}const u=8*Math.PI,m=1/30,T={catch:.5,B:.5,I:.5},M={D:45,F:[49,56,58,58,53,44,35,26,22,13,13,13],scale:.025,$:10,palette:{outline:"#AAA",N:"#333",body:"#222",P:"skyblue",R:"#AAA",_:"black"},K:!0},w="mzŌ25",x="oklab(0.85 0.02 0.13 / 0.76)",g=["Yaeyama","Kikai","Izu","Jogashima"],b={outline:"#ebec4b",N:"#333",body:"#d9d946",P:"#32a255",R:"#AAA",_:"black"},v={D:45,F:[49,56,58,58,53,44,35,26,22,13,13,13],scale:.012,$:10,palette:{...b}},A={body:v,value:20,speed:.6},k={body:{...v,palette:{...b,outline:"#e47051",body:"#c55335",P:"#7ecedc"}},value:40,speed:.4},_=2*Math.PI,C=t=>{for(;t>=_;)t-=_;for(;0>t;)t+=_;return t},S=(t,i)=>{const e=C(t+Math.PI-i);return Math.PI-e};class P{value;O;next;G=1;duration;j;constructor(t,i=.5,e=K.q){this.value=t,this.O=t,this.next=t,this.j=e,this.duration=i}update(t,i){if(t!==this.next){const i=1>this.G?this.O+(this.next-this.O)*this.j(this.G):this.next;this.O=i,this.next=t,this.G=0}1>this.G&&(this.G+=i/this.duration,1>this.G?this.value=this.O+(this.next-this.O)*this.j(this.G):(this.G=1,this.value=this.next))}}const K={q:t=>1-Math.pow(1-t,3),J:t=>t,W:t=>4*t*(1-t)},I=(t,i)=>{const e=[];return t.forEach(({command:t,points:s})=>{switch(t){case"moveTo":case"lineTo":e.push(s[0].clone().multiply(i));break;case"bezierCurveTo":e.push(s[2].clone().multiply(i))}}),(t=>{const i=t.length;if(3>=i)return t.slice();const e=(t,i,e)=>(i.x-t.x)*(e.y-t.y)-(i.y-t.y)*(e.x-t.x),s=t.reduce((s,n,o)=>s+e(t[o],t[(o+1)%i],t[(o+2)%i]),0)>0,n=[];for(let o=0;i>o;o++){const a=t[o],h=e(t[(o+i-1)%i],a,t[(o+1)%i]);(s&&h>=0||!s&&0>=h)&&n.push(a)}return n})(e)};class Z{seed;constructor(t){this.seed=t}Y(){this.seed|=0,this.seed=this.seed+2654435769|0;let t=this.seed^this.seed>>>16;return t=Math.imul(t,569420461),t^=t>>>15,t=Math.imul(t,1935289751),((t^=t>>>15)>>>0)/4294967296}float(t=0,i=1){return this.Y()*(i-t)+t}U(t,i){return Math.floor(this.Y()*(i-t+1))+t}}const E=t=>t*Math.PI/180;class B{x;y;constructor(t=0,i=0){this.x=t,this.y=i}add(t){return this.x+=t.x,this.y+=t.y,this}h(t){return this.x-=t.x,this.y-=t.y,this}scale(t){return this.x*=t,this.y*=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}get length(){return Math.hypot(this.x,this.y)}get v(){return this.x*this.x+this.y*this.y}normalize(){return this.scale(1/(this.length||1))}get angle(){return Math.atan2(-this.y,-this.x)+Math.PI}p(t){return this.x*t.x+this.y*t.y}X(t,i){const e=Math.cos(i),s=Math.sin(i),n=this.x-t.x,o=this.y-t.y;return this.x=n*e-o*s+t.x,this.y=n*s+o*e+t.y,this}set(t,i){return this.x=t,this.y=i,this}clone(){return new B(this.x,this.y)}tt(t){return this.x=t.x,this.y=t.y,this}get it(){return[this.x,this.y]}static st(t){return new B(Math.cos(t),Math.sin(t))}}const G=(t,i,e)=>{return C(i-(s=S(t,i),Math.max(-e,Math.min(e,s))));var s},V=16/9,O={scale:1,bounds:[0,0,0,0],nt(){this.T.translate(80*O.scale,45*O.scale)},clear(){this.T.clearRect(...O.bounds),O.T.lineCap="round",O.T.lineJoin="round"},T:document.getElementById("c").getContext("2d"),moveTo(t,i){this.T.moveTo(t*O.scale,i*O.scale)},lineTo(t,i){this.T.lineTo(t*O.scale,i*O.scale)},closePath(){this.T.closePath()},bezierCurveTo(t,i,e,s,n,o){const a=[t,i,e,s,n,o].map(t=>t*O.scale);this.T.bezierCurveTo(...a)},ellipse(t,i,e,s,n,o,a,h){const r=[t,i,e,s].map(t=>t*O.scale);this.T.ellipse(...r,n,o,a,h)},fillText(t,i,e,s){const n=[i,e].map(t=>t*O.scale);this.T.fillText(""+t,...n,s)},ot(t,i="sans-serif",e="bold",s="center",n="middle"){this.T.font=`${e} ${Math.floor(O.scale*t)}px ${i}`,this.T.textAlign=s,this.T.textBaseline=n}},L=()=>{const{innerWidth:t,innerHeight:i}=window;let e=t,s=t/V;s>i&&(s=i,e=i*V),O.T.canvas.width=e,O.T.canvas.height=s,O.scale=e/160,O.bounds=[-80,-45,160,90].map(t=>t*O.scale)},z=/[A-Z]|[+-]?\d*\.?\d+/g,$={M:2,L:2,C:6,Z:0,H:1,V:1},q={M:"moveTo",L:"lineTo",C:"bezierCurveTo",Z:"closePath",H:"lineTo",V:"lineTo"},W=(t,i,e,s)=>{if(!i)return[];const n=t.splice(0,i).map(parseFloat);if("H"===e)return[new B(n[0],s?.y||0)];if("V"===e)return[new B(s?.x||0,n[0])];const o=[];for(let t=0;n.length>t;t+=2)o.push(new B(n[t],n[t+1]));return o};class j{et;stroke;fill;constructor(t,i,e){this.et=t.split("\n").map(t=>{const i=[],e=t.trim().match(z);if(!e)return i;let s="";for(;e.length>0;){let t=e[0];switch(t){case"M":case"L":case"C":case"Z":case"H":case"V":s=e.shift();break;default:t="M"===s?"L":s}i.push({command:q[t],points:W(e,$[t],t,i.at(-1)?.points?.at(-1)||new B)})}return i}),this.fill=e,this.stroke=i}draw(t,i=new B(1,1),e=0,s=.3*O.scale*Math.min(i.x,i.y)){O.T.save(),O.T.lineWidth=s,this.et.forEach((s,n)=>{if(O.T.strokeStyle=this.stroke[n]||this.stroke[0],this.fill[n])if(Array.isArray(this.fill[n])){const e=this.fill[n].slice();let o="v";"v"!==e[0]&&"h"!==e[0]||(o=e.shift());const a=s.map(({points:t})=>t.map(t=>"v"===o?t.y:t.x)).flat();let h;h="v"===o?[0,(Math.min(...a)*i.y+t.y)*O.scale,0,(Math.max(...a)*i.y+t.y)*O.scale]:[(Math.min(...a)*i.x+t.x)*O.scale,0,(Math.max(...a)*i.x+t.x)*O.scale,0];const r=O.T.createLinearGradient(...h);for(;e.length>0;)r.addColorStop(...e.splice(0,2));O.T.fillStyle=r}else O.T.fillStyle=this.fill[n];O.T.beginPath(),this.rt(n,t,i,e),this.fill[n]&&O.T.fill(),null!==this.stroke[n]&&O.T.stroke()}),O.T.restore()}rt(t,i,e=new B(1,1),s=0){this.et[t].forEach(({command:t,points:n})=>{O[t](...n.map(t=>t.clone().multiply(e).add(i).X(i,s).it).flat())})}}const F=new j("M10.4.5C10.4.5 11.5-16 29-14.7 46.5-13.3 44.5-7 61.4 2.5 68.5 6.5 76.6 7.8 76.6 7.8\nM7.8-5.9C7.8-5.9 9.3-17.5 16.1-20.9\nM-6.1-5.8C-6.1-5.8-6-16.2-17-17.9\nM-6.1.3C-6.1.3-10.4-13.2-26.7-12-42.2-11-43.3-5.1-55.1 6.4-62.6 13.7-66.1 13-66.1 13\n",[M.palette.N],[]),D=Math.PI/8;class N{chain;scale;$;D;ht;palette;K;constructor({D:t,F:i,scale:e,$:s,palette:n,K:o=!1},a=new B){this.scale=e,this.D=t,this.ht=i.length,this.$=s,this.palette=n,this.K=o,this.chain=Array.from({length:this.ht},(s,n)=>({ct:a.clone().add(new B(0,t*n)),angle:0,get radius(){return i[n]*e}}))}update(t){((t,i,e,s)=>{i[0].ct.h(t).normalize().scale(e).add(t),i[0].angle=i[0].ct.clone().h(t).angle;for(let t=1;i.length>t;t+=1){const n=i[t-1].ct,o=i[t].ct,a=o.clone().h(n).angle;i[t].angle=G(a,i[t-1].angle,s);const h=B.st(i[t].angle).scale(e);o.tt(h).add(n)}})(t,this.chain,this.D*this.scale,D)}draw(){const t=D*(this.ht-1);let i=0;for(let t=1;this.chain.length>t;t++)i+=S(this.chain[t].angle,this.chain[t-1].angle);this.K&&this.ut(),O.T.strokeStyle=this.palette.outline,O.T.fillStyle=this.palette.N,O.T.lineWidth=.1*O.scale,this.lt(),this.ft(),this.yt(i,t),this.Mt(),this.dt(i,t),this.wt()}ut(){F.draw(R(this.chain[0],Math.PI,this.chain[0].radius/2),new B(1,1).scale(.05),this.chain[0].angle-Math.PI/2,.2*O.scale)}lt(){const t=R(this.chain[2],Math.PI/2,this.chain[2].radius),i=R(this.chain[2],-Math.PI/2,this.chain[2].radius);O.T.beginPath(),e(t,.6*this.chain[2].radius,.3*this.chain[2].radius,this.chain[2].angle+.4*Math.PI),e(i,.6*this.chain[2].radius,.3*this.chain[2].radius,this.chain[2].angle-.4*Math.PI),O.T.stroke(),O.T.fill()}ft(){const t=R(this.chain[7],Math.PI/2,this.chain[7].radius),i=R(this.chain[7],-Math.PI/2,this.chain[7].radius);O.T.beginPath(),e(t,.6*this.chain[7].radius,.3*this.chain[7].radius,this.chain[7].angle+.4*Math.PI),e(i,.6*this.chain[7].radius,.3*this.chain[7].radius,this.chain[7].angle-.4*Math.PI),O.T.stroke(),O.T.fill()}yt(i,e){const s=this.chain.slice(-3),n=s.toReversed().map((t,s)=>R(t,Math.PI/2,this.chain[this.chain.length-1].radius*(2.5-.6*s)*i/e)),o=s.map(t=>t.ct).concat(n);O.T.beginPath(),t(o),O.T.fill(),O.T.beginPath(),t(o),O.T.stroke()}Mt(){const i=[.8,1,1.2].map(t=>R(this.chain[0],Math.PI*t,this.chain[0].radius));for(let t=0;this.$>t;t++)i.push(R(this.chain[t],-Math.PI/2,this.chain[t].radius)),i.unshift(R(this.chain[t],Math.PI/2,this.chain[t].radius));i.push(R(this.chain[this.$-1],0,this.chain[this.$-1].radius)),i.unshift(R(this.chain[this.$-1],0,this.chain[this.$-1].radius)),O.T.fillStyle=this.palette.body,O.T.beginPath(),t(i),O.T.fill(),O.T.stroke()}dt(i,e){const s=[this.chain[3].ct,...[4,5].map(t=>R(this.chain[t],Math.PI/2,.05*this.chain[t].radius*i/e)),this.chain[6].ct];O.T.fillStyle=this.palette.N,O.T.beginPath(),t(s),O.T.fill(),O.T.beginPath(),t(s),O.T.stroke()}wt(){[Math.PI,-Math.PI].map(t=>{const i=R(this.chain[0],t/2,.6*this.chain[0].radius);O.T.fillStyle=this.palette.P,O.T.strokeStyle=this.palette.R,O.T.lineWidth=.05*this.chain[0].radius,O.T.beginPath(),e(i,.2*this.chain[0].radius,.25*this.chain[0].radius,this.chain[0].angle-.2*t),O.T.fill(),O.T.stroke(),O.T.fillStyle=this.palette._,O.T.strokeStyle="white";const s=R(this.chain[0],t/2,.63*this.chain[0].radius);O.T.lineWidth=.07*this.chain[0].radius,O.T.beginPath(),e(s,.1*this.chain[0].radius,.125*this.chain[0].radius,this.chain[0].angle-.2*t),O.T.fill(),O.T.stroke()})}}const R=(t,i=0,e=0)=>B.st(C(t.angle+i)).scale(e).add(t.ct);class H{position;points;rotation;scale;o;u;constructor(t,i,e=0,s=1){this.position=t,this.points=i,this.rotation=e,this.scale=s,this.o=i.map(i=>i.clone().scale(s).add(t).X(t,e)),this.u={min:new B(Math.min(...this.o.map(t=>t.x)),Math.min(...this.o.map(t=>t.y))),max:new B(Math.max(...this.o.map(t=>t.x)),Math.max(...this.o.map(t=>t.y)))}}gt(t=this.scale,i=this.rotation){const e=this.points.map(e=>e.clone().scale(t).add(this.position).X(this.position,i));O.T.beginPath(),O.moveTo(e[0].x,e[0].y);for(const t of e)O.lineTo(t.x,t.y);O.closePath()}Ct(){O.T.beginPath(),O.T.strokeStyle="red",O.T.lineWidth=2,O.moveTo(this.o[0].x,this.o[0].y);for(const t of this.o)O.lineTo(t.x,t.y);O.T.closePath(),O.T.stroke()}}const X=new j("M-5.4 2.9C-5.4 2.9-4.9 2.1-4.9 2-4.9 1.9-5.3 1.9-5.3 1.8-5.3 1.7-5.4 0-5.4 0L5.3 0C5.3 0 5.4.9 5.4 1 5.4 1.2 6.7 1.8 6.7 1.9 6.7 2 6.8 2.9 6.8 2.9Z\n  M-5.5-0C-5.5-0-3.5-.3-3.1-.3-2.7-.3-0-.5.3-.4.7-.4 5.4-.2 5.4-.1 5.4 0 4.4.3 4.3.4 4.2.4 2.9.2 2.9.3 2.9.4 3.4.8 3.5.8 3.5.7 1.9.6 1.6.7 1.3.7-.3.4-.5.4-.6.5-2.2.6-2.4.5-2.5.5-2.8.3-3 .3-3.2.2-4.3.2-4.5.1-4.6.1-5.4.1-5.5-0Z\n  M-2.9.3C-2.9.4-3.3 1.2-3.4 1.3-3.6 1.5-4.4 1.5-4.6 1.5-4.8 1.6-4.9 1.9-4.9 1.9\n  M-.4.5-.5 1.8\n  M3.5.8 4.4 2.9\n  M4.3.4 4.5 1.3\n  M5.3 1.1 3.9 1.6\n  M6.6 1.9C6.6 1.9 5.6 2.6 5.4 2.6 5.2 2.6 4.1 2.3 4.1 2.3\n  M5.4 2.6 5.4 2.9\n  M-2.4.6-2.8 2",["#2a1e16"],[[0,"#cbab83",.3,"#67564d"],"#cbab83"]),J=new j("M-2.7.1-2.7-7.1-3.4-7.1-3.7-7.6 3.7-7.6 3.6-7.1 2.7-7.1 2.7.1H2.1L2.2-7.1H-2.1L-2 .1Z\n  M-2.1-6.6 2.1-6.5V-6.1L-2.1-6.1Z",["#2a1e16"],[[.2,"#9b775a",.5,"#916447",.6,"#916447",.9,"#624131"],["h",.3,"#624131",.55,"#916447",.8,"#916447",.9,"#9b775a"]]),Y=["h",0,"#322d29",.25,"#3e3b34",.75,"#3e3b34",1,"#666358"],Q=new j("M-0 .3C.7.3 1 .5 1.2.9 1.5 1.4 1.4 3.9 1.5 4.1 1.7 4.4 1.7 4.4 1.7 4.5 1.7 4.6.2 4.6 0 4.6-.1 4.6-1.8 4.6-1.8 4.4-1.8 4.2-1.5 4.2-1.5 4-1.6 3.8-1.4 1.4-1.2.9-1 .3-0 .3-0 .3Z\n  M-.2.7-.2 4.2\n  M.3.8.3 4.2\n  M-1 .6C-1 .6-.5.7-0 .7.4.7.9.6.9.6\n  M-1.5 4C-1.5 4-.8 4.1 0 4.1.8 4.1 1.4 4.1 1.4 4.1\n  M0 2.9C0 2.9.4 2.9.4 3.3.5 3.7.1 3.7.1 3.7.1 3.7-.4 3.8-.4 3.3-.4 2.9 0 2.9 0 2.9Z\n  M-.2.3C-.2.3-.5-.1 0-.1.5-.1.3.3.3.3",["#2a1e16"],[Y,,,,,Y]),U=new j("M-5 1.9C-5.1 1.9-5.2 1.7-5.1 1.7-4.5 1.5-4.1 1.3-3.7 1-3.1.5-2.2.1-1.3-.2-.8-.4-.5-.4.1-.4 1.5-.4 2.1-.2 3.4.7 4 1.2 4.1 1.3 4.4 1.4 4.8 1.6 4.8 1.7 4.4 1.9 2.3 2.8-2.5 2.6-5 1.9Z\nM-2.8 2C-2.6 1.7-1.8 1.3-1.1 1.1 0 .9 1.6 1.1 2.1 1.7 2.3 1.9 2.3 1.9 2 1.8 1.9 1.8 1.5 1.7 1.2 1.6.2 1.4-1.1 1.5-2.3 1.9-2.7 2.1-3 2.2-3 2.2-3 2.2-3 2.1-2.8 2ZM-5.1 1.8C-5.2 1.7-5.2 1.7-5.1 1.7-4.5 1.5-4.1 1.3-3.7 1-3.1.5-2.2.1-1.3-.2-.8-.4-.5-.4.1-.4 1.5-.4 2.1-.2 3.4.7 4 1.2 4.1 1.3 4.4 1.4 4.8 1.6 4.9 1.8 4.4 1.7 4 1.7 3.9 1.7 3 1.2 1.8.5 1.3.3.2.3-1 .3-1.3.4-2.9 1.1-4.1 1.8-4.8 2-5.1 1.8Z\n",[null,null],["#867edc","#c4c2dc"]),tt=new B(1,1);class it{position;bt;vt=0;i=0;constructor(t){this.position=t,this.bt=new H(t,I(X.et[0],tt))}update(t){this.i+=t}kt(){this.vt=this.i}draw(){X.draw(this.position,tt);const t=K.W(this.i/4%1)/2.5;U.draw(this.position.clone().add(new B(-6,1.5-t).multiply(tt)),new B(.7,1.2).multiply(tt).scale(1),E(4)),U.draw(this.position.clone().add(new B(7,2-t).multiply(tt)),new B(.8,1).multiply(tt).scale(1),E(10)),U.draw(this.position.clone().add(new B(-.5,2.2-t).multiply(tt)),new B(1,1).multiply(tt).scale(1),E(-5))}At(){J.draw(this.position,tt);let t=0;this.vt&&(t=E(30*Math.sin((this.i-this.vt)%3/3*Math.PI*2))),Q.draw(this.position.clone().add(new B(0,-5.6)),tt,t)}}const et={left:["ArrowLeft","KeyA"],right:["ArrowRight","KeyD"],Zt:["ArrowUp","KeyW"],Lt:["ArrowDown","KeyS"],action:["Space"]},st={};for(let t in et)for(let i of et[t])st[i]=t;window.addEventListener("keydown",t=>{st[t.code]&&(nt[st[t.code]]=Date.now(),ot.push([st[t.code],Date.now()]))}),window.addEventListener("keyup",t=>{st[t.code]&&(nt[st[t.code]]=0)});const nt={left:0,right:0,Zt:0,Lt:0,action:0},ot=[];class at{position;G=0;big;constructor(t,i=!1){this.position=t,this.big=i}update(t){this.G+=t/2}draw(){O.T.save(),O.T.beginPath(),i(this.position,15*K.q(this.G)),O.T.lineWidth=9*O.scale*K.q(this.G),O.T.strokeStyle=`oklab(${.64-.1*(1-K.q(this.G))} 0.04 -0.13 / 1)`,O.T.stroke(),O.T.restore()}}const ht={start:new B,St:new B},rt=t=>{-80>t.A.position.x&&(t.A.position.x=-80),-45>t.A.position.y&&(t.A.position.y=-45),t.A.position.x>80&&(t.A.position.x=80),t.A.position.y>45&&(t.A.position.y=45)},lt=new j("M-7.7 6.4C-7.5 5.3-7.6 3.8-6.9 2.2-6.3.7-3.8-5.4-3.5-5.6-3.3-5.8-3-5.7-2.9-5.8-2.6-5.8-2.5-4.4-2.4-4.6-2.3-4.7-1.6-7.1-1.2-7.1-.7-7.1-1.1-7.1-.7-7.1-.5-7.1-.3-6.4-.1-6.3.1-6.3.4-8 1-8 1.5-8 1-8 1.6-8 2.1-8.1 2.3-6.6 2.7-6.4 3.2-6.3 3.2-6.5 3.5-6.4 3.7-6.3 4.4-1.8 4.6-1.6 4.8-1.3 4.9-1.6 5.1-1.3 5.3-1 6.9 6 6.9 6.2 6.9 6.4-7.7 6.4-7.7 6.4Z\n  M1.2-5.7C1.2-5.7 1.7-5.9 1.9-5.6 2.1-5.2 3.9-.2 4 .3 4 .9 3.5.9 3.4 1.2 3.4 1.7 4.1 5.1 4.1 5.1\n  M-0-6.4C-0-6.4-1.6-1.8-1.9-1.5-2.1-1.1-2.5-1.1-2.7-.6-3-.1-2.9 1.2-2.7 1.5-2.5 1.8-1.8 1.9-1.6 2.2-1.3 2.5-1.6 5.3-1.6 5.3\n  M2.1.3C2.1.3 2 1.6 2 2.2 1.9 2.8 1 2.4.8 2.6.6 3 .5 5 .5 5\n  M-1.6-3.9C-1.8-3.8-1.9-3.4-2.2-3.1-2.5-2.9-3-3.1-3.2-2.9-3.4-2.7-3.5-2-3.8-2.1-4.2-2.2-5 .2-5 .6-5.1 1.1-4.7 1.1-4.6 1.6-4.4 2.1-5.7 4.6-5.7 4.6\n  M-.9-1.8C-.9-1.8-.9-2.2-.8-2.4-.7-2.5-.5-2.7-.3-2.5-.1-2.4-.1-1.8-.1-1.8Z\n  M1.2-.5C1.2-.5 1.1-1.1 1.5-1.2 1.9-1.2 1.8-.6 1.8-.6Z\n  M-4.1-2.1C-4.4-1.8-4.9-3.1-4.7-3.3-4.4-3.6-4.1-3.1-4.1-3.1-4.1-3.1-4-3.6-3.8-3.5-3.5-3.5-3.4-2.9-3.4-2.9-3.4-2.9-3.6-2.6-3.7-2.4-3.8-2.2-4.1-2.1-4.1-2.1Z\n",["#2a1e16",,,,,,,"#727a4f"],[[0,"#cbab83",.55,"#67564d",.75,"#40302f"],,,,,,,"#848c60"]),pt=new B(1,1);class ct{position;bt;i=0;constructor(t){this.position=t,this.bt=new H(t,I(lt.et[0],pt))}update(t){this.i+=t}draw(){lt.draw(this.position,pt);const t=K.W(this.i/4%1)/2.5;U.draw(this.position.clone().add(new B(-6,4.5-t).multiply(pt)),new B(.7,1.2).multiply(pt),E(4)),U.draw(this.position.clone().add(new B(7,5.5-t).multiply(pt)),new B(.8,1).multiply(pt),E(10)),U.draw(this.position.clone().add(new B(-.5,6-t).multiply(pt)),new B(1,1).multiply(pt),E(-5))}}const ft=new j("M-3.3-5C-2.9-5.6-2.1-5.7-1.4-5.7-.5-5.6.4-5.4 1.4-5.2 2-5 2.2-4.3 2.7-3.9 3.1-3.4 4-3.3 4.2-2.7 4.5-1.9 4.7-1.2 4.9-.5 5 .5 4.8 1.4 4.7 2.4 4.5 3.1 3.8 3.3 3.3 3.9 2.9 4.4 2.1 4.1 1.5 4.3.9 4.6.5 5.4-.3 5.4-1.6 5.2-2.9 4.5-4 3.7-4.4 3.4-4.8 2.8-4.8 2.2-5 1.1-5.1-0-5-1.1-4.7-2.2-3.9-3.1-3.6-4.2-3.5-4.5-3.4-4.7-3.3-5Z\n  M1.5 4.4C1.7 3.7 2.5 3.5 2.9 3.1 3.1 2.5 3 1.9 3.1 1.3 3.2.8 2.6.2 2.1.3 1 .5-.1.3-1.2.2-1.7.3-1.8 1-2.1 1.4-2.2 1.9-2.8 2.3-2.5 2.8-2.3 3.4-1.9 3.6-1.4 3.8-.8 4.2-.4 4.8-0 5.3\n  M4.4-2.1C3.8-1.9 3.1-1.8 2.7-1.2 2.4-.7 2.4-.1 2 .3\n  M-2.1-5.7C-1.6-5.1-1.1-4.5-.3-4.3-0-3.9.1-3.2-.2-2.7-.6-2-1.1-1.2-1.7-.6-2.1-.4-2.6-.5-3-.5-3.8-.4-4.3-1-4.9-1.3\n  M-3.5-4.6C-3.2-4.1-2.5-3.9-2.2-4.4-2-4.6-1.8-4.9-1.5-5\n  M3.3-3.4C2.2-3.4 1.2-3.3.1-3.2\n  M4.9.6C4.5 1 3.9.9 3.4 1 3.3 1 3.2 1 3.1 1\n  M-1.8-.5C-1.7-.3-1.6-0-1.5.3\n  M-3.2 4.3C-2.9 4-2.5 3.7-2.2 3.4\n  M-4.8 2.6C-4.1 2.6-3.3 2.6-2.6 2.6\n  M-4.9 2C-4.3 1.9-3.8 1.5-3.6.9-3.5.4-3.6-.1-3.7-.5\n",["#2a1e16"],[[0,"#d0af83",.6,"#b08055",.75,"#975e40"]]),dt=new j("M-.3-5.9-.4 11.4C-.4 11.4-.4 11.8 0 11.8.6 11.8.5 11.4.5 11.4L.4-5.9Z\n  M.1-10.4-1.6-5.1C-1.6-5.1-.7-5.9 0-5.9.7-5.9 1.7-5.1 1.7-5.1Z\n  M.1-10.1-.2-5.9.3-5.9Z\n",["#2a1e16"],[[.5,"#824f3d",1,"#6b3a29"],[0,"#9f9e9b",1,"#736f6b"]]);class yt{i=0;xt=!1;Tt=0;Bt=.5;position;rotation;scale;bt;constructor(t,i,e,s=1){this.position=t,this.rotation=i,this.Tt=e,this.scale=s,this.bt=new H(t,I(ft.et[0],new B(s,s)),i,s)}update(t){this.i+=t,this.i>this.Tt&&(this.xt=!0)}zt(){this.i>this.Tt||(O.T.beginPath(),O.T.strokeStyle="rgba(255, 0, 0, 0.3)",O.T.fillStyle="rgba(255, 0, 0, 0.2)",ft.rt(0,this.position,new B(this.scale,this.scale),this.rotation),O.T.fill(),O.T.stroke(),O.T.beginPath(),O.T.fillStyle="rgba(255, 0, 0, 0.1)",ft.rt(0,this.position,new B(1,1).scale(this.scale*this.i/this.Tt),this.rotation),O.T.fill())}draw(){const t=this.Tt-this.Bt;if(t>this.i)return;const i=this.i-t;ft.draw(this.position.clone().add(this.position.clone().normalize().scale(5*O.scale*(1-i/this.Bt))),new B(this.scale,this.scale),this.rotation+Math.PI*(1-i/this.Bt))}}const ut=[[-1,-1],[1,-1],[1,1],[-1,1]].map(t=>new B(...t).multiply(new B(50,2)));class mt{i=0;xt=!1;Tt=0;Bt=.4;position;rotation;scale;bt;constructor(t,i,e,s=1){this.position=t,this.rotation=i,this.bt=new H(t,ut,i,s),this.Tt=e,this.scale=s}update(t){this.i+=t,this.i>this.Tt&&(this.xt=!0)}zt(){O.T.strokeStyle="rgba(255, 0, 0, 0.3)",O.T.fillStyle="rgba(255, 0, 0, 0.2)",this.bt.gt(),O.T.fill(),O.T.stroke();const t=(t,i)=>this.bt.o[t].clone().h(this.bt.o[i]).scale(.5*(1-this.i/this.Tt)).add(this.bt.o[i]),i=[t(1,2),t(2,1),t(3,0),t(0,3)];O.T.fillStyle="rgba(255, 0, 0, 0.1)",O.T.beginPath(),O.moveTo(i[0].x,i[0].y);for(let t=1;i.length>t;t++)O.lineTo(i[t].x,i[t].y);O.T.closePath(),O.T.fill()}draw(){const t=this.Tt-this.Bt;if(t>this.i)return;const i=this.i-t;dt.draw(this.position.clone().add(B.st(this.rotation).scale(10*-O.scale*(.5-i/this.Bt))),new B(this.scale,this.scale),this.rotation+Math.PI/2)}}const Tt={fishA:A,fishB:k};class Mt{i=0;It;Dt=[];Ft;constructor(t,i=1){this.Dt=t.slice(),this.It=new Z(i),this.Ht()}update(t,i){if(!this.Ft)return!0;this.i+=i;for(let i=this.Ft.length-1;i>=0;i--){const e=this.Ft[i];this.getTime(e)>this.i||(this.$t(t,e),this.Ft.splice(i,1))}return this.Ft.length||(this.i=0,this.Ht()),!1}Ht(){const t=this.Dt.shift();if(!t)return void(this.Ft=void 0);const i=Array.isArray(t)?t:[t];this.Ft=[];for(const t of i){const i=this.Nt(t),e=this.Pt(t);if(e>0&&i>1)for(let s=0;i>s;s++)this.Ft.push({...this.Rt(t,s),_t:1,i:this.getTime(t)+s*e});else this.Ft.push(t)}}}class wt extends Mt{getTime(t){return t.i}Nt(t){return t._t??1}Pt(t){return t.Vt??0}Rt(t,i){return{...t,rotation:Array.isArray(t.rotation)?t.rotation[i]:t.rotation,position:Array.isArray(t.position)&&"number"!=typeof t.position[0]?t.position[i]:t.position}}$t(t,i){const e=i._t??1,s=Array.from({length:e},(t,e)=>{let s=0;return void 0!==i.rotation&&(s=Array.isArray(i.rotation)?i.rotation[e]??0:i.rotation),("random"===s?this.It.float():s)*Math.PI}),n=Array.from({length:e},(e,s)=>{let n;return n=(i=>"random"===i?new B(this.It.float(-50,50),this.It.float(-50,50)):"player"===i?t.A.position.clone():new B(i[0],i[1]))(Array.isArray(i.position)&&"number"!=typeof i.position[0]?i.position[s]??"random":i.position??"random"),void 0!==i.Kt&&(n.x+=this.It.float(-i.Kt,i.Kt),n.y+=this.It.float(-i.Kt,i.Kt)),n});for(let o=0;e>o;o++){const e=n[o],a=s[o];"rock"===i.type?t.S.push(new yt(e,a,1+.5*this.It.float())):"spear"===i.type&&t.S.push(new mt(e,a,1+.5*this.It.float()))}}}class xt extends Mt{getTime(t){return t.i}Nt(t){return t._t??1}Pt(t){return t.Vt??0}Rt(t){return t}$t(t,i){const e=i._t??1,s=new B(i.position[0],i.position[1]);for(let n=0;e>n;n++){const e=i.Kt?new B(this.It.float(-i.Kt,i.Kt),this.It.float(-i.Kt,i.Kt)):new B(0,0),n=s.clone().add(e),o=i.path.map(([t,i])=>new B(t,i).add(e)),a=c(i.variant,n,o,i.k??!1);"fish"===a.type&&a.body.update(a.position),t.Ot.push(a)}}}const gt=[{name:"fishA level",Et:[{type:"reef",position:[-30,20]},{type:"reef",position:[30,-20]},{type:"temple",position:[30,20]},{type:"temple",position:[-30,-20]}],Ot:[{i:0,variant:"fishA",position:[100,0],path:[[10,10],[-30,-130]],_t:3,Kt:10},{i:5,variant:"fishA",position:[-100,0],path:[[-10,-10],[40,130]],_t:3,Kt:10},{i:5,variant:"fishA",position:[0,-50],path:[[0,80]],_t:3,Kt:10},{i:3,variant:"fishB",position:[0,50],path:[[-15,-15],[-15,20],[15,25],[20,20]],k:!0,_t:2,Kt:10},{i:4,variant:"fishB",position:[-100,40],path:[[150,40]]},{i:1,variant:"fishB",position:[100,-40],path:[[-150,-40]]},{i:10,variant:"fishA",position:[0,-50],path:[[0,-15],[-15,20],[15,-25],[20,20]],k:!0,_t:3,Kt:15},{i:5,variant:"fishA",position:[-100,0],path:[[-10,-10],[40,130]],_t:3,Kt:10},{i:1,variant:"boat",position:[90,-40],path:[[-110,-40]]},{i:5,variant:"fishA",position:[0,-50],path:[[0,80]],_t:3,Kt:10},{i:5,variant:"fishB",position:[20,-60],path:[[-20,80]],_t:2,Kt:10}],S:[{i:5,type:"rock",position:"random",_t:5,Vt:1},{i:2,type:"rock",position:"player",_t:3,Kt:20},{i:2,type:"rock",position:"player",_t:3,Kt:20},{i:2,type:"rock",position:"player",_t:3,Kt:20},{i:3,type:"rock",position:"player",_t:3,Kt:20},{i:3,type:"rock",position:"random",_t:10},{i:3,type:"spear",position:[0,0],rotation:"random",_t:5,Vt:2},{i:3,type:"rock",position:"random",_t:10},{i:3,type:"rock",position:"player",_t:10,Vt:2}]},{name:"Coral Gardens",Et:[{type:"reef",position:[-40,30]},{type:"reef",position:[40,-30]},{type:"reef",position:[0,-40]},{type:"temple",position:[-35,-25]},{type:"temple",position:[35,25]},{type:"temple",position:[0,0]}],Ot:[{i:0,variant:"fishA",position:[110,10],path:[[20,15],[-40,-140]],_t:4,Kt:12},{i:2,variant:"fishB",position:[-110,-10],path:[[-20,-15],[50,140]],_t:2,Kt:8},{i:1,variant:"boat",position:[95,35],path:[[-115,35]]},{i:3,variant:"fishA",position:[0,-60],path:[[0,-20],[-20,25],[20,30],[0,90]],k:!0,_t:5,Kt:15},{i:4,variant:"fishB",position:[0,60],path:[[25,15],[25,-25],[-25,-30],[-25,15]],k:!0,_t:3,Kt:12},{i:6,variant:"fishA",position:[-110,20],path:[[-15,10],[45,140]],_t:4,Kt:12},{i:7,variant:"boat",position:[-95,-35],path:[[115,-35]]},{i:8,variant:"fishB",position:[110,-25],path:[[-160,-25]],_t:2},{i:9,variant:"fishA",position:[0,60],path:[[0,20],[30,-20],[-30,-25],[0,-90]],k:!0,_t:6,Kt:18},{i:12,variant:"fishB",position:[-110,0],path:[[-25,0],[25,30],[25,-30],[160,0]],_t:3,Kt:10}],S:[{i:2,type:"rock",position:"player",_t:4,Kt:25},{i:3,type:"rock",position:"random",_t:6,Vt:.8},{i:5,type:"spear",position:[0,0],rotation:"random",_t:4,Vt:1.5},{i:4,type:"rock",position:"player",_t:5,Kt:18},{i:6,type:"rock",position:"random",_t:8,Vt:1},{i:7,type:"rock",position:"player",_t:6,Kt:20},{i:8,type:"spear",position:"random",rotation:"random",_t:6,Vt:1},{i:10,type:"rock",position:"player",_t:8,Vt:1.5},{i:11,type:"rock",position:"random",_t:12,Vt:.5},{i:13,type:"spear",position:[0,0],rotation:"random",_t:8,Vt:1}]},{name:"Reef Maze",Et:[{type:"reef",position:[-40,30]},{type:"reef",position:[40,-30]},{type:"reef",position:[0,40]},{type:"reef",position:[-50,-40]},{type:"temple",position:[35,35]},{type:"temple",position:[-35,-35]},{type:"temple",position:[0,-30]}],Ot:[{i:1,variant:"fishA",position:[100,20],path:[[20,20],[-20,-20],[-120,-30]],_t:4,Kt:12},{i:2,variant:"fishA",position:[-100,-20],path:[[-20,-20],[30,30],[120,40]],_t:3,Kt:10},{i:3,variant:"fishB",position:[0,80],path:[[0,20],[-30,10],[-30,-10],[30,-10],[30,10]],k:!0,_t:2,Kt:8},{i:4,variant:"boat",position:[110,10],path:[[-130,10]]},{i:6,variant:"fishA",position:[90,-50],path:[[15,-15],[-15,15],[-110,30]],_t:5,Kt:15},{i:8,variant:"fishB",position:[-90,50],path:[[-15,15],[20,-20],[130,-50]],_t:3,Kt:12},{i:10,variant:"fishA",position:[0,-80],path:[[0,-20],[25,-10],[25,10],[-25,10],[-25,-10]],k:!0,_t:4,Kt:10},{i:12,variant:"boat",position:[-110,-30],path:[[130,-30]]},{i:15,variant:"fishB",position:[100,0],path:[[30,0],[0,20],[-30,0],[0,-20]],k:!0,_t:3,Kt:8},{i:18,variant:"fishA",position:[-100,20],path:[[-30,10],[30,-10],[120,-40]],_t:6,Kt:18},{i:20,variant:"boat",position:[110,40],path:[[-130,40]]},{i:25,variant:"fishB",position:[0,70],path:[[0,10],[-40,0],[0,-10],[40,0]],k:!0,_t:2,Kt:5}],S:[{i:3,type:"rock",position:"random",_t:6,Vt:.8},{i:5,type:"rock",position:"player",_t:4,Kt:25},[{i:7,type:"spear",position:[-60,0],rotation:0,_t:1},{i:7,type:"spear",position:[0,0],rotation:0,_t:1},{i:7,type:"spear",position:[60,0],rotation:0,_t:1}],{i:9,type:"rock",position:"player",_t:6,Kt:20,Vt:.5},[{i:11,type:"rock",position:[-40,-40],_t:1},{i:11.2,type:"rock",position:[-20,-20],_t:1},{i:11.4,type:"rock",position:[0,0],_t:1},{i:11.6,type:"rock",position:[20,20],_t:1},{i:11.8,type:"rock",position:[40,40],_t:1}],{i:14,type:"spear",position:"random",rotation:"random",_t:8,Vt:1},[{i:16,type:"spear",position:[0,0],rotation:0,_t:1},{i:16,type:"spear",position:[0,0],rotation:.5,_t:1},{i:16,type:"spear",position:[0,0],rotation:1,_t:1},{i:16,type:"spear",position:[0,0],rotation:1.5,_t:1}],{i:18,type:"rock",position:"random",_t:12,Vt:.3},{i:22,type:"rock",position:"player",_t:8,Kt:30,Vt:.4},{i:25,type:"spear",position:"player",rotation:"random",_t:6,Kt:35,Vt:.6}]},{name:"Abyssal Gauntlet",Et:[{type:"reef",position:[-45,35]},{type:"reef",position:[45,-35]},{type:"reef",position:[-25,-40]},{type:"reef",position:[25,40]},{type:"reef",position:[0,-15]},{type:"reef",position:[-55,0]},{type:"temple",position:[40,20]},{type:"temple",position:[-40,-20]}],Ot:[{i:1,variant:"fishA",position:[100,30],path:[[30,25],[10,0],[-30,-25],[-120,-35]],_t:4,Kt:12},{i:2,variant:"fishB",position:[-100,-30],path:[[-30,-25],[-10,0],[30,25],[120,35]],_t:2,Kt:10},{i:3,variant:"boat",position:[115,45],path:[[-135,45]]},{i:4,variant:"fishA",position:[0,80],path:[[0,25],[-20,10],[-10,-30],[10,-30],[20,10],[0,-90]],_t:5,Kt:8},{i:5,variant:"fishB",position:[90,-10],path:[[20,-10],[-10,-5],[-20,5],[-130,15]],_t:3,Kt:12},{i:7,variant:"boat",position:[-115,25],path:[[135,25]]},{i:8,variant:"fishA",position:[0,60],path:[[0,30],[35,15],[35,-15],[-35,-15],[-35,15]],k:!0,_t:6,Kt:15},{i:10,variant:"fishB",position:[-90,40],path:[[-20,20],[20,10],[40,-20],[130,-30]],_t:2,Kt:8},{i:12,variant:"boat",position:[115,-40],path:[[-135,-40]]},{i:14,variant:"fishA",position:[0,-80],path:[[0,-30],[30,-10],[15,20],[-15,20],[-30,-10],[0,90]],k:!0,_t:7,Kt:18},{i:16,variant:"fishB",position:[100,0],path:[[30,0],[10,25],[-10,25],[-30,0],[-130,-10]],_t:3,Kt:10},{i:18,variant:"boat",position:[-115,-35],path:[[135,-35]]},{i:20,variant:"fishB",position:[0,70],path:[[0,20],[-40,5],[-20,-20],[20,-20],[40,5]],k:!0,_t:4,Kt:12},{i:25,variant:"fishA",position:[-100,35],path:[[-25,20],[0,0],[25,-20],[120,-40]],_t:8,Kt:20},{i:28,variant:"fishB",position:[100,-25],path:[[25,-15],[0,10],[-25,15],[-120,30]],_t:3,Kt:8},{i:30,variant:"boat",position:[115,20],path:[[-135,20]]}],S:[{i:2,type:"rock",position:"random",_t:8,Vt:.6},[{i:4,type:"spear",position:[-50,-20],rotation:.25,_t:1},{i:4,type:"spear",position:[0,-20],rotation:.25,_t:1},{i:4,type:"spear",position:[50,-20],rotation:.25,_t:1}],{i:5,type:"rock",position:"player",_t:6,Kt:15,Vt:.4},[{i:7,type:"rock",position:[-60,-40],_t:1},{i:7.15,type:"rock",position:[-40,-20],_t:1},{i:7.3,type:"rock",position:[-20,0],_t:1},{i:7.45,type:"rock",position:[0,20],_t:1},{i:7.6,type:"rock",position:[20,40],_t:1},{i:7.75,type:"rock",position:[40,60],_t:1}],[{i:9,type:"spear",position:[0,0],rotation:0,_t:1},{i:9,type:"spear",position:[0,0],rotation:.5,_t:1},{i:9.5,type:"spear",position:[0,0],rotation:1,_t:1},{i:9.5,type:"spear",position:[0,0],rotation:1.5,_t:1}],{i:11,type:"rock",position:"random",_t:15,Vt:.25},{i:13,type:"spear",position:"player",rotation:"random",_t:5,Kt:25,Vt:.8},[{i:15,type:"rock",position:[60,-40],_t:1},{i:15.15,type:"rock",position:[40,-20],_t:1},{i:15.3,type:"rock",position:[20,0],_t:1},{i:15.45,type:"rock",position:[0,20],_t:1},{i:15.6,type:"rock",position:[-20,40],_t:1},{i:15.75,type:"rock",position:[-40,60],_t:1}],{i:17,type:"rock",position:"player",_t:8,Kt:20,Vt:.3},[{i:18,type:"spear",position:[0,0],rotation:0,_t:1},{i:18.2,type:"spear",position:[0,0],rotation:.25,_t:1},{i:18.4,type:"spear",position:[0,0],rotation:.5,_t:1},{i:18.6,type:"spear",position:[0,0],rotation:.75,_t:1},{i:18.8,type:"spear",position:[0,0],rotation:1,_t:1},{i:19,type:"spear",position:[0,0],rotation:1.25,_t:1},{i:19.2,type:"spear",position:[0,0],rotation:1.5,_t:1},{i:19.4,type:"spear",position:[0,0],rotation:1.75,_t:1}],{i:21,type:"rock",position:"random",_t:20,Vt:.2},[{i:23,type:"spear",position:[-60,30],rotation:1.25,_t:1},{i:23.3,type:"spear",position:[-30,30],rotation:1.25,_t:1},{i:23.6,type:"spear",position:[0,30],rotation:1.25,_t:1},{i:23.9,type:"spear",position:[30,30],rotation:1.25,_t:1},{i:24.2,type:"spear",position:[60,30],rotation:1.25,_t:1}],{i:26,type:"rock",position:"player",_t:12,Kt:35,Vt:.2},{i:28,type:"spear",position:"random",rotation:"random",_t:10,Vt:.4},{i:30,type:"rock",position:"random",_t:25,Vt:.15}]}];class bt{Gt;jt;qt;i=0;constructor(t){this.Gt=t.A.Gt,this.jt=new P(t.A.jt,.5,K.J),this.qt=new P(t.A.qt)}update(t,i){this.Gt=t.A.Gt,this.jt.update(t.A.jt,i),this.qt.update(t.A.qt,i),this.i+=i}draw(){O.T.fillStyle=x,O.T.strokeStyle=x,this.Jt(),this.Wt(),this.Yt(),this.Ut()}Ut(){O.ot(3);const t=60-this.i;O.fillText(`${(""+Math.floor(t/60)).padStart(2,"0")}:${(""+Math.floor(t%60)).padStart(2,"0")}`,0,-40)}Jt(){for(let t=0;this.Gt>t;t++)O.T.beginPath(),i(new B(3*t-75,-40),1),O.T.fill()}Wt(){O.ot(3,void 0,void 0,"right"),O.fillText((""+Math.floor(Math.floor(this.jt.value))).padStart(6,"0"),75,-40)}Yt(){O.T.lineWidth=1,O.T.beginPath();const t=[[-30,38],[30,38],[30,43],[-30,43]];O.moveTo(...t[0]),t.forEach(([t,i])=>{O.lineTo(t,i)}),O.T.closePath(),O.T.stroke(),O.T.beginPath();const i=[[-29,39],[58*this.qt.value/100-29,39],[58*this.qt.value/100-29,42],[-29,42]];O.moveTo(...i[0]),i.forEach(([t,i])=>{O.lineTo(t,i)}),O.T.closePath(),O.T.fill()}}const vt=128,At=document.createElement("canvas");At.width=vt,At.height=vt;const kt=At.getContext("2d"),_t=kt.createImageData(vt,vt),Ct=_t.data;for(let t=0;Ct.length>t;t+=1)Math.random()>.8&&(Ct[t]=t%4?Math.floor(60*Math.random())+180:40);kt.putImageData(_t,0,0);const St=O.T.createPattern(At,"repeat"),Pt=()=>{O.T.save(),O.T.fillStyle=St,O.T.globalCompositeOperation="multiply",O.T.globalAlpha=.1,O.T.fillRect(...O.bounds),O.T.restore()},Kt={Qt:[],Xt:!1,...(()=>{try{return JSON.parse(localStorage.getItem(w))}catch{return{}}})()},It="#ccc2ae",Zt=new j("M.2-1.7C.2-1.7 0-1.6-.1-1.8-.3-2.1-.1-2.3.1-2.3.4-2.5.5-1.9.5-1.9Z\nM-.7-2.3.4-2.8 1.1-2C1.1-2 .7-2 .1-2.1-.5-2.2-.7-2.3-.7-2.3Z\nM-.7-1.2C-.7-1.2-.7-1.3-.6-1.3-.5-1.3-.5-1.1-.5-1.1-.5-1.1-.5-1-.6-1.1-.7-1.1-.7-1.2-.7-1.2Z\nM.6.1C.6.1.6 0 .7-0 .8 0 .8.2.8.2.8.2.8.3.7.2.6.2.6.1.6.1Z\nM-.5.1C-.5.1-.5-0-.4-.1-.3-0-.3.1-.3.1-.3.1-.3.2-.4.2-.5.2-.5.1-.5.1Z\nM-.5-1.3-.2-1.7.5-1.9C.5-1.9.7-1.8.8-1.7.8-1.5.7-.8.7-.8L.8-0 .6 0C.6 0 .4-0 .3-.1.2-.3.1-.4.1-.4L-.3-0-.5-.1-.3-.8C-.3-.8-0-1-.2-1.1-.4-1.1-.5-1.1-.5-1.1Z\nM0-.4.2-.7\nM-.2-.8C-.2-.8-.1-.7.1-.7.3-.7.7-.8.7-.8\nM-.1-1C-.1-1-.1-.9.2-.9.4-.9.7-.9.7-.9\nM.5-1.8.2-1\nM-.1-1.6C-.1-1.6-.1-1.5 0-1.4.1-1.3.2-1.2.2-1.2\nM-.1-1.1C-.1-1.1-.1-1.2 0-1.2.2-1.2.2-1 .2-1 .2-1 .1-.9 0-.9-.1-.9-.1-1.1-.1-1.1Z\n",["#222"],[It,"#ddbd99",It,It,It,"#a25049",,,,,,It]),Et="#b3775b",Bt=new j("M-5.9-2.7C-5.9-2.7-4.2-1.9-.2-2 3.9-2.1 3.7-2.3 5.5-2.7 7-3.1 6.5-2.1 6.4-1.7 6.2-1.3 5.3.3 5.2.4 5.1.5 4.9.6 4.9.6 4.9.6 4.5.5 3.5.7 2.6.9 2.2 1.4 2.2 1.4 2.2 1.4 1.1 1 .2 1.1-.7 1.1-1.5 1.6-1.5 1.6-1.5 1.6-2.1 1.3-2.8 1.2-3.6 1-4 1.3-4 1.3-4 1.3-5 .7-5.5-.5-6-1.7-6.6-2.3-6.6-3-6.5-3.5-5.9-2.7-5.9-2.7Z\nM6.1-1.8 5.8-1.2C5.8-1.2 3.6.5.2.6-4 .7-5.5-1.4-5.5-1.4L-6-2.4C-6-2.4-3.7.1 0 .2 3.7.2 6.1-1.8 6.1-1.8Z\nM-5.4-1.4C-5.4-1.4-4.2.6-3.5 1\nM-5.5-2.3C-5.5-2.3-4.2-1.5.3-1.7 4.8-2 5.4-2.4 5.7-2.5 6.1-2.6 6.6-2.7 6-2 5.8-1.8 4.1-.3.1-.1-3.2.1-5.5-2.3-5.5-2.3Z\nM-5.1-1.8C-4.8-1.8-4.5-1.2 0-1.4 4.5-1.5 6.1-2.1 6.2-2.3\nM-1.7-.2-1.9-1.5-.9-1.5-.7-0Z\nM3.9-.7 3.6-1.8 4.5-1.9 4.7-1.1Z\n",[null,null,"#dec2a2",null,"#222","#222","#222"],["#222","#dec2a2",,Et,,Et,Et]),Gt=[new B(0,-.75),new B(2.5,-.75)];class Vt{state;ti;ii;si;level;constructor(t){this.state={i:0,A:{body:new N(M,new B(0,40)),position:new B(0,30),ni:new B(0,-.2),Gt:3,qt:0,jt:0,oi:1,ei:0},Et:[],S:[],ai:{B:0,catch:0,I:0},Ot:[],ri:[],hi:{ci:0,pi:0},ui:{i:0,message:[]}},Lt(this.state,0),this.ti=new bt(this.state),this.level=t;const{ii:i,si:e}=((t,i)=>{const e=gt[i];return e.Et.forEach(i=>{"reef"===i.type&&t.Et.push(new ct(new B(i.position[0],i.position[1]))),"temple"===i.type&&t.Et.push(new it(new B(i.position[0],i.position[1])))}),{ii:new wt(e.S),si:new xt(e.Ot)}})(this.state,t);this.ii=i,this.si=e}update(t){if(this.state.i+=t,this.state.ui.i||(this.ii.update(this.state,t),this.si.update(this.state,t)),((t,i)=>{for(const e of t.Ot){if(!e.path.length)continue;const s=e.path[0].clone().h(e.position).normalize().scale(30*e.speed*i);e.position.tt(h(e.position,s,t.Et.map(t=>t.bt))),"fish"===e.type?e.body.update(e.position):(e.i+=i,3>e.i||t.ui.i||(e.i=0,f(e.position,t))),10>e.position.clone().h(e.path[0]).length&&e.path.push(e.path.shift())}t.Ot=t.Ot.filter(({position:t})=>{const{x:i,y:e}=t;return i>-120&&120>i&&e>-70&&70>e})})(this.state,t),((t,i)=>{((t,i)=>{if((nt.action||t.ai.I)&&(t=>{if(t.ai.I)return t.A.position.tt(h(t.A.position,ht.start.clone().X(ht.St,2*Math.PI*t.ai.I).h(t.A.position),t.Et.map(t=>t.bt))),rt(t),void t.A.body.update(t.A.position);30>t.A.qt||(ht.start.tt(t.A.position),ht.St.tt(t.A.body.chain[1].ct),t.ai.I=1,100>t.A.qt?(t.A.qt-=30,t.ri.push(new at(ht.St))):((t=>{t.Et.filter(t=>t instanceof it).forEach(t=>{20>t.position.clone().h(ht.St).length&&(t.vt||t.kt())})})(t),t.ri.push(new at(ht.St,!0)),t.A.qt=0),(t=>{for(let i=t.Ot.length-1;i>=0;i-=1){const e=t.Ot[i];"boat"===e.type&&20>e.position.clone().h(ht.St).length&&(t.A.jt+=e.value,t.Ot.splice(i,1))}})(t))})(t),t.ai.I||t.ui.i)return;const e=new B(Math.sign(nt.right-nt.left),Math.sign(nt.Lt-nt.Zt));if(e.length){const s=C(t.A.body.chain[0].angle+Math.PI),n=S(s,e.angle),o=s+Math.min(Math.abs(n),Math.abs(i*u))*Math.sign(n),a=Math.min(30*i,t.A.ni.length+20*i*i);t.A.ni.tt(B.st(o)).normalize().scale(a)}else{const e=Math.max(0,t.A.ni.length-20*i*i);t.A.ni.normalize().scale(e)}t.A.position.tt(h(t.A.position,t.A.ni,t.Et.map(t=>t.bt))),rt(t),t.A.body.update(t.A.position)})(t,i),(t=>{for(const i of t.Ot.filter(t=>"fish"===t.type))for(let e=0;i.body.$>e;e++)if(i.body.chain[e].ct.clone().h(t.A.position).length<t.A.body.chain[0].radius/2){t.A.qt=Math.min(100,t.A.qt+i.value),t.A.jt+=1e3,t.hi.ci+=1,t.ai.catch=1,t.Ot.splice(t.Ot.indexOf(i),1);break}})(t)})(this.state,t),this.state.Et.forEach(i=>i.update(t)),Lt(this.state,t),zt(this.state,t),this.state.ui.i)return this.state.i-this.state.ui.i>10||ot.find(t=>"action"===t[0])?(ot.splice(0),this.state.A.jt>(Kt.Qt[this.level]??0)&&(Kt.Qt[this.level]=this.state.A.jt),"menu"):void 0;((t,i)=>{let e;t.S.forEach(s=>{if(s.update(i),s.xt){if(e||(e=(t=>{const i={min:new B(1/0,1/0),max:new B(-1/0,-1/0)};for(const e of t){const{ct:t,radius:s}=e;i.min.x=Math.min(i.min.x,t.x-s),i.min.y=Math.min(i.min.y,t.y-s),i.max.x=Math.max(i.max.x,t.x+s),i.max.y=Math.max(i.max.y,t.y+s)}return i})(t.A.body.chain)),!t.ai.I&&p(e,s.bt.u))for(let i=0;t.A.body.$>i;i++){const e=t.A.body.chain[i];if(l(e.ct,e.radius,s.bt)){t.A.Gt-=1,t.ai.B=1,t.A.oi=1;break}}t.S.splice(t.S.indexOf(s),1)}})})(this.state,t),this.ti.update(this.state,t),Ot(this.state,t),this.li()}li(){if(60>this.state.i||(this.state.ui={i:this.state.i,message:["Disaster"]}),this.state.A.Gt>0||(this.state.ui={i:this.state.i,message:["Ouch."]}),this.state.Et.some(t=>t instanceof it&&!t.vt)||(this.state.ui={i:this.state.i,message:["People warned, quake foretold"]}),this.state.ui.i){ot.splice(0),this.state.ai.B=0;const t=[];this.state.A.Gt>0&&60>this.state.i&&t.push("time remaining - "+1e3*Math.floor(60-this.state.i)),this.state.hi.pi&&t.push(`boats overturned × ${this.state.hi.pi} - ${5e3*this.state.hi.pi}`),this.state.hi.ci&&t.push(`fish eaten × ${this.state.hi.ci} - ${1e3*this.state.hi.ci}`),this.state.ui.message.push("Total Score: "+this.state.A.jt),t.length&&this.state.ui.message.push("Including bonus:",...t)}}draw(){O.T.save(),O.nt(),O.clear(),$t(this.state),this.state.ri.forEach(t=>t.draw()),this.state.Et.forEach(t=>{t.draw()}),this.state.S.forEach(t=>t.zt()),this.state.Ot.filter(t=>"fish"===t.type).forEach(t=>t.body.draw()),qt(this.state),this.state.Ot.filter(t=>"boat"===t.type).forEach(t=>{const i=3*this.state.i,e=.3*Math.sin(i+.1*t.position.x),s=.02*Math.sin(1.2*i+.15*t.position.x),n=new B(t.position.x,t.position.y+e);var o;Bt.draw(o=n,void 0,s),Gt.forEach(t=>{Zt.draw(o.clone().add(t),void 0,0,.2*O.scale)})}),this.state.Et.forEach(t=>{t instanceof it&&t.At?.()}),this.state.S.forEach(t=>t.draw()),this.state.ui.i?this.Wt():this.ti.draw(),Pt(),O.T.restore()}Wt(){O.T.save(),O.T.fillStyle=x,O.ot(5),O.fillText(this.state.ui.message[0],0,0),O.ot(3);for(let t=1;this.state.ui.message.length>t;t++)O.fillText(this.state.ui.message[t],0,4*t+5);O.ot(2),O.fillText("[space]",0,4*this.state.ui.message.length+5),O.T.restore()}}const Ot=(t,i)=>{t.A.ei+=i,.5>t.A.ei||(t.A.jt+=t.A.oi,t.A.oi+=1,t.A.ei-=.5)},Lt=(t,i)=>{for(const e in t.ai)t.ai[e]=Math.max(0,t.ai[e]-i/T[e])},zt=(t,i)=>{for(let e=t.ri.length-1;e>=0;e--){const s=t.ri[e];s.update(i),1>s.G||t.ri.splice(e,1)}},$t=t=>{if(t.ai.B>0){const i=10*t.ai.B,e=(2*Math.random()-1)*i,s=(2*Math.random()-1)*i;O.T.translate(e,s)}},qt=t=>{const i=1+.2*K.W(t.ai.I);O.T.save(),O.T.translate(t.A.position.x,t.A.position.y),O.T.scale(i,i),O.T.translate(-t.A.position.x,-t.A.position.y),t.A.body.draw(),O.T.restore()},Wt=["#e9ce97","#688a9a","#eee","#222"],jt=new j("M-14.9 12.4C-14.5 11.1-13.7 10.4-11.9 10.7-10 11.1-9.4 13.4-9.6 15-9.7 16.3-10 16.8-11.5 17.1-12.7 17.4-14 16.3-14.6 15.2-15.4 13.5-14.9 12.4-14.9 12.4Z\nM-13.8 11.6C-13.2 11.3-11.9 10.9-11 12.6-10.1 14.2-10.2 16-11 16.4-11.8 16.9-12.8 16.5-13.3 16.1-14.6 15.2-14.9 14.2-14.8 13.2-14.6 12.1-13.8 11.6-13.8 11.6Z\nM-14.3 12.9C-14 12.4-13.5 12.3-12.8 12.5-11.9 12.9-11.4 14-11.7 15-11.9 15.5-12.6 16-13.3 15.6-14 15.2-14.5 14.1-14.5 13.6-14.5 13.2-14.3 12.9-14.3 12.9Z\nM-12.7 14C-12.6 14.7-12.7 14.9-13.1 15.1-13.3 15.2-14 15-14.2 14.4-14.5 13.7-14.4 13.3-14.3 13-14.1 12.6-13.6 12.7-13.6 12.7-13 13-12.8 13.5-12.7 14Z\n",[null,"#222",null,null],Wt),Ft=new j("M10.3 12.2C10.3 12.2 11.1 9.6 13.6 10.2 15.3 10.6 14.7 13 13.8 14.2 13 15.4 12.3 16 11.1 15.7 9.4 15.3 10.3 12.2 10.3 12.2Z\nM11.2 12.4C11.2 12.4 12.4 9.9 13.6 10.5 15.2 11.4 13.9 13.7 13.9 13.7 13.9 13.7 12.9 15.6 11.8 15.3 10 15 11.2 12.4 11.2 12.4Z\nM12.2 13.6C12.2 13.6 11.8 11.6 13.5 11.2 14.9 10.8 14 13.4 13.7 13.8 13.5 14.1 13.3 14.3 12.8 14.2 12.2 14.1 12.2 13.6 12.2 13.6Z\nM12.5 13.4C12.3 13.1 12.3 12 13.2 11.6 14 11.2 14.1 11.9 14.1 12.3 14.1 12.7 13.8 13.6 13.3 13.8 12.9 14 12.5 13.6 12.5 13.4Z\n",[null,"#222",null,null],Wt),Dt=new j("M15.5 0C15.5 0 16.9 6.9 16.3 11.1 15.8 14.8 13.4 21.9 9.1 24.2 7.2 25.2-.9 27.7-7.9 24.4-11.2 22.9-16 18.9-16.7 14.4-17.5 9.8-17.5-0-17.5-0Z\n",[null],["#222"]),Nt=new j("M-0 21.9C2 22 4 21.5 5.9 20.8 8 20 10.2 18.2 11 17.1 12 15.8 12.6 16.9 12.4 17.7 12.1 18.8 10.5 21.8 8.7 22.8 6.8 23.9 2.2 24.9 0 24.8-2.1 24.8-5.2 24.9-7.6 23.7-8.9 23-11.7 21.3-12.1 19.9-12.3 18.8-11.3 17.8-10.2 18.3-9 18.9-7.7 20.1-6.3 20.7-3.2 22-0 21.9-0 21.9Z\nM-11.7 19.5C-11.9 19-11.5 18.6-10.9 18.8-10.2 19.1-7.8 21-6.6 21.5-4.8 22.2-1.4 23.2 2.8 22.5 7 21.7 10.9 18.2 11.1 17.8 11.5 17.2 12.3 17.2 11.6 18.5 10.9 19.8 8.5 22.2 7 22.9 5.5 23.6 2.7 24.3 0 24.3-2.7 24.3-6.1 23.9-7.3 23.3-11 21.5-11.7 19.5-11.7 19.5Z\nM-11.4 19.6-10.6 19.4-10.6 20.7-9.6 20.3-9.5 21.4-8.9 21-9 21.9-8.1 21.5-8 22.4-7.1 21.9-7 22.7C-7 22.7-5.6 22.3-5.5 22.4-5.5 22.5-5.1 23.3-5.1 23.3L-4.2 22.7-3.9 23.5-2.9 23-2.4 23.8-1.7 23.2-1.2 23.8C-1.2 23.8-.8 23.1-.7 23.2-.6 23.3.1 23.9.1 23.9L.6 23.1 1.6 23.9 2 23 2.8 23.9 3 23.1 4 23.7 4 22.8 4.9 23.3 5.1 22.4 6.1 23 6.1 22.2 7.3 22.9 7.1 21.7\nM8.6 21.4 8.6 20.6 9.2 20.9 9.3 20.1 10 20.3 9.9 19.4 10.6 19.7 11 18.3\n",[null,null,"#222","#222"],["#eba785","#eee"]),Rt=new j("M-2.4 20C-2.3 19.4-2 19.1-1.7 19.1-1.4 19-.9 19.4-1.1 19.9-1.3 20.5-1.5 20.5-1.9 20.4-2.5 20.3-2.4 20-2.4 20Z\nM-2.1 20C-2.1 20-2 19.3-1.7 19.3-1.3 19.4-1.4 20.1-1.4 20.1\n",[null,"#222"],["#e9ce97"]),Ht=new j("M1.3 19.9C1.3 19.9 1.2 19.4 1.6 19.2 1.9 19.1 2.1 19.1 2.4 19.4 2.7 19.8 2.6 20 2.5 20.2 2.3 20.3 1.9 20.6 1.5 20.4 1.2 20.1 1.3 19.9 1.3 19.9Z\n  M1.6 20.2C1.6 20.2 1.5 19.6 1.8 19.4 2.1 19.3 2.4 19.9 2.4 19.9\n",[null,"#222"],["#e9ce97"]),Xt=new j("M4.5 18.7C4.5 18.7 4.7 18.6 5.1 18.6 5.4 18.6 5.7 18.8 5.7 19.3 5.7 20 5.3 21.6 7.2 22 8.7 22.3 9.4 21.1 10.4 20.6 11.5 20 12.7 19.9 13.6 20.3 14.6 20.7 14.5 21.5 15.4 21.8 16 22 16.7 22 16.7 22\nM-4.1 19.4C-4.1 19.4-4.2 19.1-5.1 19.1-6 19.2-6.4 19.6-6.5 20.3-6.7 21-6 22.1-6.2 22.9-6.3 23.8-7 24-8.4 23.9-9.6 23.8-11.4 22.4-12.2 23.2-13 24-13.1 25.6-13.1 25.6\n",["#222"],[]),Jt=(t,i=new B(0,-45))=>{const e=new B(1,1).scale(t);Dt.draw(i,e),jt.draw(i,e),Ft.draw(i,e),Rt.draw(i,e),Ht.draw(i,e),Nt.draw(i,e),O.T.strokeStyle="#e9ce97",O.T.lineWidth=.9*O.scale*t;for(let t=0;2>t;t+=1)O.T.beginPath(),Xt.rt(t,i,e),O.T.stroke();O.T.strokeStyle="#222",O.T.lineWidth=.6*O.scale*t;for(let t=0;2>t;t+=1)O.T.beginPath(),Xt.rt(t,i,e),O.T.stroke()},Yt=new j("M21.1-54.1C21.1-54.1 12.4-69-24.3-65.8-60.9-62.7-60.4-47.5-59.9-33.2-59.2-14.3-51.7 0-51.7 0L14.3-.2Z\nM-27.1-21.7C-27.1-21.7-25.5-16.2-26.2-8.9-26.9-1.6-27.2.1-27.2.1L.4-.1 6.4-33.6Z\nM-40.3-19.5C-40.3-19.5-39.6-16-39.8-10.9-40-5.8-40.9-.1-40.9-.1\n",["#222"],["#f8a562","#222"]),Qt=new j("M-32.9-99.4C-32.9-99.4-41.6-91.7-45.5-74.6-47.2-67.1-52.1-44.6-51.5-38.3-51.1-33.9-49.6-21.6-40.5-20.7-31.5-19.8-24.1-22.7-24.1-22.7-24.1-22.7-17.9-18.8-9.1-22.7 5.2-29.1 6.3-33.7 6.3-33.7L8.6-57.9 19.5-69.9-2.2-97.9Z\nM-27.5-78C-27.5-78-24.3-80.7-22.3-81.9-19.8-83.2-15.7-84.7-15.7-84.7\nM-35.4-80.7C-35.4-80.7-36-82.9-37.3-84.4-38.4-85.8-40.1-87.7-40.1-87.7\nM-35.6-76.6C-35.6-76.6-35.3-75.7-35.6-73.9-35.8-72.1-46.1-55-44.5-53.1-43.3-51.5-39.1-52-39.1-52\nM-40.1-56.2C-40.1-56.2-36.5-60.2-34.5-60.4-32.4-60.7-31.5-55.2-33.4-53.6-34.6-52.5-36.5-52.6-36.5-52.6\nM-40.3-52.9C-40.3-52.9-39.9-52.6-39.3-53-38.6-53.5-37.3-55.8-36-56.1-34.7-56.4-35.1-55.7-35.1-55.7L-36.6-55.1\nM-45.7-38.3C-45.7-38.3-45.7-37.3-45.1-37.4-44.4-37.5-45.7-39.8-42.4-41.5-39.2-43.2-32-40.5-30-41.5\nM-41.8-34.3C-41.8-34.3-40.3-37.5-38.7-37.4-37.8-37.4-34.1-34.7-34.1-34.7\nM-25.7-75.8C-25.7-75.8-24.4-76.9-21.9-77.9-18.7-79.1-16.7-78.3-16.7-78.3\nM-37.1-76.6C-37.1-76.6-37.4-78.6-39.1-80-40.7-81.5-41.9-81.3-41.9-81.3\nM-26.3-71.5C-26.3-71.5-26.1-74.3-21.7-75.2-17.2-76.2-13.9-74.9-13.9-74.9-13.9-74.9-15.5-72.1-19.5-71.6-23.4-71.1-26.3-71.5-26.3-71.5Z\nM-23.1-74.5C-23.1-74.5-22.6-74.7-22.6-73.2-22.7-71.7-22.8-71.4-22.8-71.4L-26.2-71.5C-26.2-71.5-26.3-73.1-24.9-73.8-23.6-74.5-23.1-74.5-23.1-74.5Z\nM-42.9-79.4C-42.9-79.4-40.2-79.3-39.3-76.6-38.4-73.9-39-72.8-39-72.8L-43.5-74.9\nM-40.9-77.2C-40.9-77.2-39.6-77.2-39.5-75.6-39.5-74.1-41-74.2-41-74.2-41-74.2-42.5-74.3-42.4-75.6-42.3-77.3-40.9-77.2-40.9-77.2Z\nM-24.2-22.7-14.8-27.4\nM.2-63.9C.2-63.9.1-60.1-.9-54.9-2-49.7-5.9-41.5-5.9-41.5\nM8.6-57.9C8.2-57.6 6.8-58.2 4.4-55.9 2.2-53.8 2.3-49.7.2-49.7-.8-49.8-2-51.1-.9-54.9.2-58.8 2.7-59.6 4.1-59.9 5.5-60.2 5.9-59.8 5.9-58.6\n",["#222"],["#fcf3d4",,,,,,,,,,,"#444",,"#444"]),Ut=new j("M-35.3-97.1C-35.3-97.1-29.6-106.6-11.1-107.4 9.8-108.3 15.5-88.3 15.5-88.3L-2.8-84.2C-2.8-84.2-4.5-94.1-12.2-95.1-17.3-95.8-23.7-90.3-27.9-91.1-34.7-92.4-35.3-97.1-35.3-97.1Z\nM14.7-90.7C14.7-90.7 16.7-87.3 18.5-80.1 20.7-71.3 20.8-64.3 20.8-64.3L13.9-54.9C13.9-54.9 14.9-54.6 10.6-59.9 6.2-65.3.2-63.9.2-63.9.2-63.9.4-66.5-.3-71.4-1.2-77.5-3.2-76.2-3.3-79.8-3.4-85.2-2.8-86.5-2.8-86.5-2.8-86.5 1-88.4 6.6-87.5 11.4-86.7 14.7-90.7 14.7-90.7Z\n",[null,null],["#c3e4ca","#222"]),ti=[{from:"Narrator",text:"It was this time again\nthe time for giant black catfish, Ōnamazu, to awaken from its slumber."},{from:"Ōnamazu",text:"Ahh... so it begins once more."},{from:"Ōnamazu",text:"The earth is trembling, but there is no one to warn its people.\nAnd even Ebisu is missing... perhaps asleep again?"},{from:"Ōnamazu",text:"Then I shall thrash about until the temple bells ring!\nThat way, everyone will know what’s coming."},{from:"Ōnamazu",text:"…But first, I’m a little peckish.\nThrashing takes energy, so I’d better eat all the fish around here."},{from:"Fisherman",text:"You sneaky fish!"},{from:"Ōnamazu",text:"Wha..."},{from:"Fisherman",text:"You waited until our guardian gods left for the Grand Shrine,\nand now you dare to wreak havoc again!"},{from:"Narrator",text:"A major misunderstanding has ensued."},{from:"Fisherman",text:"Get him!"},{from:"Ōnamazu",text:"Now you've done it! I'm going to thrash!\nAll over you!"},{from:"Narrator",text:"And so, the story begins."}],ii=.03;class ei{i=0;fi=0;mi="";yi="";get G(){return 1-Math.min(this.i/ti[this.fi].text.length/ii,1)}update(t){this.i+=t;const i=!!ot.find(t=>"action"===t[0]);if(ot.splice(0),this.yi=ti[this.fi].from,this.mi=ti[this.fi].text.slice(0,this.i/ii|0),i)return this.mi===ti[this.fi].text?(this.fi+=1,this.mi="",this.i=0):(this.mi=ti[this.fi].text,this.i=this.mi.length*ii),ti.length>this.fi?void 0:Kt.Xt?"menu":(Kt.Xt=!0,0)}draw(){if(O.T.save(),O.nt(),O.clear(),d(),this.fi>=1){const t=new B(0,-60);1===this.fi&&(t.y-=40*this.G),Jt(2,t)}if(this.fi>=5){const t=new B(75,45);5===this.fi&&(t.x+=20*this.G),y(.4,t)}if(this.fi>=9){const t=new B(85,45);let i=0;9===this.fi&&(t.x+=20*this.G,i=40*this.G),dt.draw(new B(-20,20+i),new B(2,2)),dt.draw(new B(0,15+i),new B(2,2)),dt.draw(new B(20,20+i),new B(2,2)),O.T.save(),O.T.translate(t.x,t.y),O.T.scale(-1,1),y(.4,t),O.T.restore()}O.T.fillStyle="rgba(0,0,0,0.5)",O.T.fillRect(...[-55,15,110,20].map(t=>t*O.scale)),O.ot(3,"sans-serif","bold","left"),O.T.fillStyle=x,O.fillText(this.yi,-50,20),O.T.fillStyle="#fff",this.mi.split("\n").forEach((t,i)=>{O.fillText(t,-50,25+5*i)}),this.mi===ti[this.fi].text&&(O.ot(2),O.T.fillStyle=x,O.fillText("[space]",50,33)),Pt(),O.T.restore()}}L(),window.addEventListener("resize",L);const si=new class{Mi;selected=0;constructor(){Kt.Xt?(this.Mi="continue",this.selected=1):this.Mi="start"}update(t){const i=Date.now();for(;ot.length>0;){const[t,e]=ot.shift();if(1e3>=i-e){if("start"===this.Mi&&"action"===t)return this.Mi="select","intro";if("continue"===this.Mi)if("action"===t)switch(this.selected){case 0:return"intro";case 1:return this.Mi="select",void(this.selected=0)}else this.selected=(this.selected+1)%2;if("select"===this.Mi)if("action"===t){if(this.selected!==g.length)return this.selected;this.Mi="continue",this.selected=1}else switch(t){case"up":case"down":this.selected=this.selected===g.length?0:g.length;break;case"left":this.selected=(this.selected-1+g.length)%g.length;break;case"right":this.selected=(this.selected+1)%(g.length+1)}}}}draw(){switch(O.T.save(),O.nt(),O.clear(),d(),Jt(3),O.ot(14,"Times New Roman, serif"),O.T.fillStyle="#fff",O.fillText("Ōnamazu",0,-28),O.ot(4),this.Mi){case"start":this.di();break;case"continue":this.wi();break;case"select":this.gi()}Pt(),O.T.restore()}di(){O.T.fillStyle=x,O.fillText("Start",0,-5)}wi(){O.T.fillStyle=this.selected?"#fff":x,O.fillText("Intro",0,-5),O.T.fillStyle=this.selected?x:"#fff",O.fillText("Continue",0,0)}gi(){O.ot(3),O.fillText("Select Stage",0,-12),O.ot(2);for(let t=0;g.length>t;t++){const i=10*-(g.length-1)/2+10*t;O.T.fillStyle=this.selected===t?x:"#fff",O.fillText(g[t],i,-7),O.fillText(Kt.Qt[t]??"-",i,-3)}O.ot(3),O.T.fillStyle=this.selected===g.length?x:"#fff",O.fillText("Return",0,5)}};let ni=si,oi=+document.timeline.currentTime;const ai=t=>{const i=Math.min((t-oi)/1e3,m);oi=t,ni.draw();const e=ni.update(i);if(void 0!==e){switch(e){case"menu":ni=si;break;case"intro":ni=new ei;break;default:ni=new Vt(e)}localStorage.setItem(w,JSON.stringify(Kt))}requestAnimationFrame(ai)};ai(oi)</script>