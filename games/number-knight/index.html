<!doctype html><html><meta name=viewport content="width=device-width"><title>Number Knight - js13kGames 2023</title><link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAElBMVEUAAAA/JjHAy9yLm7RSYHy9bEopxh28AAAAAXRSTlMAQObYZgAAAFpJREFUCNdNzYENwCAIBEDcwG/tAMUJlC5g6grsv0pf0xgxkSMEkD0gEmZWyBFZVM1QIhFt4DSzMlEYC7ZatwQFoFckODWQ3trz07imuXsiAjpfFEp54D8O/h8iWAxkGxSwEwAAAABJRU5ErkJggg==" rel="icon shortcut"><style>body{--sx:0px;margin:0;padding:0;min-width:100vw;min-width:100dvw;min-height:100vh;min-height:100dvh;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASBAMAAACk4JNkAAAAD1BMVEXLgV5xqjQ0VVG21TyrYVglCgpzAAAAM0lEQVQI12NQggEkljEMILEEYQAry1FQBIIYXARdIIiBAYYwgAO6AIsDgoXQAGWxoKsGADG/DONhOX+vAAAAAElFTkSuQmCC),url(f.svg),url(b.svg),radial-gradient(circle at top center,rgb(198 239 251) 0,#43c7fe 100%);background-repeat:repeat-x,repeat-x,repeat-x,no-repeat;background-attachment:scroll,scroll,scroll,fixed;background-position:var(--sx) bottom,calc(var(--sx)/ 2) bottom,calc(var(--sx)/ 3) calc(100% - 100px),top center;background-size:32px,auto,auto,auto;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated;image-rendering:optimize-contrast;-ms-interpolation-mode:nearest-neighbor;transform:translateX(var(--sx));transition:transform 333ms ease-in,background-position 333ms ease-in;user-select:none;overscroll-behavior-y:contain}#soundButton,.e,.hit,.t-f .character,body:not(.walking) section:not(#editor) .t-f:not(.destroying)[data-e]::after,body[data-s=menu]::after,body[data-s=title]::after{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABQBAMAAABbkW52AAAAElBMVEUAAAA/JjGLm7TAy9xSYHy9bEpjAft8AAAAAXRSTlMAQObYZgAAAxdJREFUSMeVlVt23CAMhiHJAiRM3wuevo/N9D12ZwPNZf9b6S8piPGZpD2VfeZH4kPcxhA+t3jwuAeGP9Gt3xiBAcKP7caPc1u5UQfv/JAR2JpX3Pkh1VrLqDj6ChTYqDC/Dn8EIA5Mi+noYjm0PG0jU2zM3L5RB9W/bO4DwGAAdNB8Hg3zPl/X0+ag+iXAn+ALsL2/v+etg+ZjaCiID5KveAZovgLqSy5uNMAwLXglPi0NPozx3GgkvFpg+P9v1pL+CuTWtiN47CvubT2RgzqNRjdgrDByEDbVeXEQUmqp5KAXDHRgaEhcUisdNJ3vgaEh58zBQagajUyXnCfq4AAczPWy1m2AqcpTNwcv+/V6+uUggMIVgIN7rvt2ugXFTlsGKBo4bblw6GCIVzXqisGVhMwdREFtaIgUgQ29N7CfRkcJk7kH40y9hLmUG9DDZE0iJlvIweNBJIufGqx08Ng7QvjPF+a0hA7ah8HUgRKSACV0EJZ/obMb4MQZgIOB8yab5EAubcFSOhiX31ySHFpYfwG5ckocHIyXt6VWOWFmVLIeA622AQZ+W0oSQLtxoCsyvEoGcqBOmF0FIKrASymp6hgMSG0F0BVd2DTdOM2tsqseJcx0/LrZdRh/ajTuDjJhk0gjaleFFJkUgALQLgxYUGwkEQOYGEU7P8g2c8I6UfzIEBESQIdoAAwsaUpGRWSKFB0IU0MCVIkFRmt51SUH6AZgyX4AomVADdMxA3fAxsDRxmDfFFPswGSA5NcZAlQkDIB1mgCsfdQc7OuAWm5kExcA5HEdFpL1/novjPpyN/9pdy0RevwegkhYRQildg7RNApwbgo8nB8/gCaAqWaYFQB4NuBxrc8ARDeOWhM++jCg1fp8jqpM0cZgfRjwuAKYo2jhGYDdiq5TqwAeFlGmB8Tiy0/bxNcfJMAqQCjQwlBU6NXsmqoBUE5QCcmPa961iy3vhUXvxkBPApwiPXES7ZebK4UdwLP8AVSRWQ83UwWQQhaKs6qOygBTZNmlgtkUo9LTwNSAp2sAQKZ49dYw/Xy79afrH9hCsH5jm/yQAAAAAElFTkSuQmCC)}#levelList{max-width:1000px;overflow-y:scroll}#levelList::-webkit-scrollbar{display:none}.t-c{min-height:100vh;min-height:100dvh;display:flex;padding-left:calc(50vw - 192px);position:relative;bottom:32px}.tower{display:flex;flex-direction:column;justify-content:flex-end;align-items:center;width:144px;margin:0 24px;flex-shrink:0}.t-f,.tower::before{width:144px;position:relative;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAAC2BAMAAADEnRmgAAAAKlBMVEUAAAAgHEGCJDddSKMVEydDOYZpbbFDMGe2VlZSDRv2r4HhZ2ekbcCEqu5Kz8wYAAAAAXRSTlMAQObYZgAAA8lJREFUaN7tmb1uE0EUhV3kBYzcpAS5AUoXNBTj6FoW/W46yqRLhSU3eYAIqkQ0bqkQJRUSJUUat9D5XZifnRyZM7s7uzsrhWhOsXNnPPeDMWcuuZvJ5EQepCYdRJlSlkVZlofD4XfRDbR6r5N06qosxUzPL4ry0ujQFXSwaaUhmOnlZXFuV666gv7YtAtNSArC0S66gs6Pj2a+bKeuoCpNj6lBshoCKsRlyrFUFzNC4MoKpow3YyE4i/vuYcquZjRDZUgjeKmrh6ySgnA0N8aakY9WGsFLXT1kNQZI/BgHEm9GgISlAs6jpZAhhUzJzlM1ZnQjykiNKeE8FTIjV0jyEhlGBT3kx6QgHA1jwHmKl2orJMaAYVTAQxhTg4RMyc5TITNyhWSpgPOwRAKfTcnOU7zks1FG2JTsPMVLPrsWdFXAMADxEpdaNiU7T9GSH9OC+Gg4NR0NSy2lFmPAeYqW/JgUJClAUu/s0EeqeXcS6cvz6lulLyL9YzU5+3pT6eN8SDw5u3nQfED8tEE/fPxpPiDWoNc/K32fD4g16MWD5gPihKATTET6xyrBXcP/VOv9fr/RTzssp9PpqftTbqf18czvd8lqoiXXi8XiXj/tYBLuXMLLptjvd8nuJ7kPOn4j+qmHpdnkD94Uz9x+sclqTFDM0aJBO5ewq4/DoK2Ot6KferCg053VbVM8c/vFJnuQkdinBkXIgZCWGjRZ61A7a2uGeJDbLzY50BJMoxVoOZzLp70kNrn6C1mXu38u+KRWx9dvZpPhIzjRbWkQ+xKG/PduPG/k4KakB413tJ3b0QDiK8cgXKZGDK5cHaizeoDuyF9xIHag0+1Q0DNvi0cDSna00+rL7guCdkF/je0jFKPWIoRZCIQb23pTMQuBUENaawdmyUCjHg3FqLUIYRYCoRi1FiHMkvkogzIogx4F6Lg+83oUiIsYr0eBuKzy+hig8Y/G9bl5fUb92rKuPjevz6hf6+sjk5sShH6tL4j6tb4g6tf6gnK/lvu13K/lfi33a7lfy/1aBmVQBo3UryEe2K8hHtivheNRQOMfLeb3a1GgmN+v/ceGzKAM6guSfiBhkNcytt13YtD13upeYkDYTW9r1r8WVm83Mf0adtPbmvWi0iamqcFukxsNQpvFIHpb0xdEb2v6Ho3e1jCI+7UQiN7WECjYrzGI3tYwiBUC2eRIEPdrPUHc1IRB4kDmaYJNTJuF3TZZHMhdkW2lKBB222RxLrIr+GjZfrQZdtunqBBI2vs1CYPWNt1/JGG921l9Fivstska9Bdozpbpqzl9fgAAAABJRU5ErkJggg==)}.tower::before{content:"";display:block;height:38px;background-position:top}#editor .tower:not(.current)::before,.t-f.ghost{filter:grayscale(1) brightness(2);pointer-events:all;cursor:pointer}#editor .t-f.ghost .f-v{font-size:5rem;background-color:transparent;pointer-events:none}.d{position:absolute;right:12px;top:12px;background:0 0;border:0;pointer-events:all;cursor:pointer;background:#fff;width:20px;height:20px;text-align:center;padding:0;line-height:20px;border-radius:6px;opacity:.8;z-index:10}.d:focus-visible,.d:hover{opacity:1}.t-f.ghost:focus-visible,.t-f.ghost:hover{filter:sepia(.5)}.tower.d-f::before{top:144px}.t-f{display:flex;flex-direction:column;justify-content:space-between;align-items:center;height:144px;background-position:bottom;background-repeat:no-repeat;pointer-events:none;flex-shrink:0}.t-f.destroying:not(.piece){background-image:none}.t-f.destroying.piece{--ix:0;--iy:0;position:absolute;width:36px;height:36px;left:var(--ix);top:var(--iy);background-position:calc(var(--ix) * -1) calc(var(--iy) * -1);z-index:30}.tower.current .t-f .character,body[data-s=menu]::after,body[data-s=title]::after{--f:0 0;--t:-32px 0;transition:transform 333ms ease-in;z-index:2;position:relative;left:0}.t-f .character,body[data-s=menu]::after,body[data-s=title]::after{display:block;width:16px;height:16px;transform:scale(4);transform-origin:center bottom;background-position:var(--f);animation-name:spriteAnim;animation-timing-function:steps(2);animation-iteration-count:infinite;animation-duration:1s;pointer-events:none;z-index:0}body[data-s=menu]::after,body[data-s=title]::after{content:"";position:absolute!important;bottom:32px;left:calc(50vw - 16px);z-index:0}.e,body:not(.walking) section:not(#editor) .t-f:not(.destroying)[data-e]::after{content:"";display:block;width:15px;height:15px;position:absolute;right:16px;bottom:8px;transform:scale(2);z-index:1;color:transparent}aside .e{position:relative;transform:none;right:auto;bottom:auto;display:inline-block;vertical-align:middle;margin:2px}section:not(#editor) .e{position:relative;vertical-align:middle;display:inline-block;inset:0;transform:none}.t-f[data-e="f"]{color:#e84537}.t-f[data-e="a"]{color:#0099db}.t-f[data-e="p"]{color:#25956a}.e.f,.t-f:not(.destroying)[data-e="f"]::after{background-position:-16px -48px!important;background-color:#e84537}.e.p,.t-f:not(.destroying)[data-e="p"]::after{background-position:-31px -48px!important;background-color:#25956a}.e.a,.t-f:not(.destroying)[data-e="a"]::after{background-position:-46px -48px!important;background-color:#0099db}.e.none{background-image:none;background-color:#8c9ab3;color:#3f2631;border:1px solid #3f2631;text-align:center;font-size:12px;padding-top:2px;box-sizing:border-box;display:flex;align-items:center;justify-content:center}#editor .e,#editor .tower:not(.current) .character{pointer-events:all;cursor:pointer}#editor .e:hover,#editor .tower:not(.current) .character:hover{box-shadow:inset 0 0 2px #fff}.tower.current [data-e] .character .hit{filter:saturate(3) brightness(.7)}[data-e="f"] .character{filter:hue-rotate(125deg) saturate(3)}[data-e="a"] .character{filter:hue-rotate(350deg) saturate(3)}[data-e="p"] .character{filter:hue-rotate(255deg) saturate(3)}.hit{--r:0;display:flex;justify-content:center;align-items:center;width:16px;height:16px;z-index:3;background-position:0 -128px;position:absolute;left:4px;filter:hue-rotate(180deg) sepia(1) saturate(5);transform:scale(var(--s)) rotate(var(--r));transform-origin:center;animation:hit .2s cubic-bezier(0,1.4,.73,1.24) 1;animation-fill-mode:forwards}.hit.drink{--r:0!important;left:6px;bottom:8px;background-position:-16px -32px}.hit.drink+.hit-m{top:-2px}.hit-m{--sh:#fff;position:absolute;z-index:4;font-family:"Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;top:3px;left:8px;filter:brightness(1);font-size:.5rem;color:#000;text-shadow:1px 1px var(--sh),-1px -1px var(--sh),1px -1px var(--sh),-1px 1px var(--sh),1px 0 var(--sh),-1px 0 var(--sh),0 -1px var(--sh),0 1px var(--sh)}body.attacking .tower.current .t-f .character,body.walking .tower.current .t-f .character,body.walking[data-s=menu]::after,body.walking[data-s=title]::after{--f:-32px 0;--t:-64px 0;animation-duration:.5s}body.walking .tower.current .t-f .character{left:41vw;transition:left 2s ease-in}body.walking[data-s=menu]::after,body.walking[data-s=title]::after{left:100vw;transition:left 1s ease-in}.tower.current .t-f .character.dead{--f:0 -32px;--t:0 -32px}.t-f.b .character{--f:0 -16px;--t:-32px -16px}.t-f.s .character{--f:-32px -16px;--t:-64px -16px}.t-f.w .character{--f:-32px -32px;--t:-64px -32px}.t-f.m .character{--f:-32px -64px;--t:-64px -64px}.f-v{font-family:"Comic Sans MS";font-weight:700;font-size:3rem;text-align:center;text-shadow:2px 0 #fff,-2px 0 #fff,0 2px #fff,0 -2px #fff,1px 1px #fff,-1px -1px #fff,1px -1px #fff,-1px 1px #fff;transform-origin:center;opacity:.3;pointer-events:none;position:relative;top:16px}#editor .f-v,.tower.current .f-v{opacity:1}#editor .t-f:not(.destroying,.ghost) .f-v{pointer-events:all;min-width:48px;min-height:66px;background-color:rgba(255,255,255,.3);display:flex;justify-content:center}#editor .f-v span{flex-grow:1}#editor span.sign{min-width:36px}body:not(.attacking):not(.gameover) #game .tower.current+.tower .t-f:not(.destroying){cursor:pointer;pointer-events:all}body:not(.attacking):not(.gameover) #game .tower.current+.tower .t-f:not(.destroying):focus-visible,body:not(.attacking):not(.gameover) #game .tower.current+.tower .t-f:not(.destroying):hover{box-shadow:0 0 22px #fff inset,0 0 22px #fff inset;outline:1px solid #fff}body:not(.gameover) #game .tower.current+.tower:not(.destroying) .f-v{animation:jello 1s ease-in-out infinite;opacity:1}dialog{border:0;background:0 0;overflow:visible;text-align:center;z-index:100;outline:0}dialog::backdrop{background-color:transparent}#game dialog::backdrop{background-color:rgba(0,0,0,.5)}#gameEndMessage,dialog .title{font-size:5rem;text-transform:uppercase;font-family:"Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;font-weight:700;color:#000;text-shadow:4px 0 #fff,-4px 0 #fff,0 4px #fff,0 -4px #fff,3px 0 #fff,-3px 0 #fff,0 3px #fff,0 -3px #fff,2px 2px #fff,-2px -2px #fff,2px -2px #fff,-2px 2px #fff}#gameOverDialog .title{color:#e84537}#endLevelDialog .title,dialog p span{--init-y:-100vh;transform:translateY(var(--init-y));animation:gameOverLetter .8s cubic-bezier(.29,.76,.56,1.33) 1;animation-fill-mode:forwards;display:inline-block}#endLevelDialog .title{color:#1f976a;display:block}#editor .t-f:not(.m) .sign,#endLevelDialog .button span,#endLevelDialog.hideEndMessage #gameEndMessage,#endLevelDialog:not(.end) #gameEndMessage,.destroying .d,.destroying .e,.t-f.destroying .character,.t-f.destroying .f-v,[data-s=editor] #soundButton,[data-s=title] #soundButton,section{display:none}#endLevelDialog.end .menu,#endLevelDialog:not(.end) .next{display:inline-block}.title{margin:0 0 8px 0}#gameEndMessage span{font-size:3rem;animation:dancing 850ms ease-in-out infinite}#titleDialog form{display:flex;gap:32px;align-items:center;flex-direction:column}dialog button{--init-y:100vh;transform:translateY(var(--init-y));animation:gameOverLetter .8s ease-in 1;animation-fill-mode:forwards;display:inline-block}.button{display:inline-block;border:3px solid;border-top-color:#67ffd5;border-bottom-color:#1f976a;border-right-color:#67ffd5;border-left-color:#3ee2b4;border-radius:0;font-size:2rem;cursor:pointer;background-color:#3ee2b4;color:#3f2631;position:relative;text-align:center;text-decoration:none;text-transform:uppercase;letter-spacing:3px;width:200px;padding:8px}.button[disabled]{pointer-events:none;opacity:.3}#menu .button{width:65px;height:65px;box-sizing:border-box;margin:4px}.button:hover{filter:brightness(1.1)}.button::before{content:" ";position:absolute;z-index:-1;inset:-5px;border:3px solid #3f2631}.button small{display:block;font-size:1rem;letter-spacing:1px}.button[value=no-sound]{animation-delay:.1s}.button[value=editor]{animation-delay:.2s}[data-s=editor] #editor,[data-s=game] #game,[data-s=menu] #menu,[data-s=title] #title{display:block}aside{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;font-size:1.5rem;font-weight:400;padding:24px;position:absolute;max-width:400px;width:auto;left:100px;top:100px;pointer-events:none;background-color:rgba(255,255,255,.5);border-radius:20px;display:none;transform:translateX(calc(var(--sx) * -1));transition:transform 333ms ease-in}aside[data-t="21"]{max-width:600px}aside p{margin:0}#editor aside *{pointer-events:all}#editor aside input{height:20px;font-size:1rem;width:100%}#editor aside a,#editor aside a:visited{margin:auto;display:block;margin-top:16px}#soundButton{position:fixed;padding:0;right:16px;top:16px;width:16px;height:16px;z-index:999;border:0;transform:translateX(calc(var(--sx) * -1)) scale(4);transition:transform 333ms ease-in;transform-origin:top right;background-position:-16px -64px;background-color:#e84537;cursor:pointer}#soundButton.on{background-position:0 -64px;background-color:#25956a}@media screen and ((max-height:500px) or (max-width:750px)){aside{font-size:1rem;padding:12px;position:relative;max-width:none;left:0;top:0;border-radius:0}#title{padding-top:8px}#menuDialog,#titleDialog{margin-top:48px}dialog .title,dialog p{font-size:2rem}#gameEndMessage{text-align:left}#gameEndMessage span{font-size:2rem}#titleDialog form{gap:16px}.button{font-size:1rem;padding:4px}#soundButton{position:relative;left:4px;right:0;top:0;transform:none}}@keyframes spriteAnim{0%{background-position:var(--f)}100%{background-position:var(--t)}}@keyframes hit{0%{transform:scale(.5) rotate(var(--r))}100%{transform:scale(1.75) rotate(var(--r))}}@keyframes gameOverLetter{0%{transform:translateY(var(--init-y))}100%{transform:translate(0)}}@keyframes jello{11%,from,to{transform:translate3d(0,0,0)}22%{transform:skew(-2.5deg)}33%{transform:skew(6.2deg)}44%{transform:skew(-3.1deg)}55%{transform:skew(1.5deg)}66%{transform:skew(-.7deg)}77%{transform:skewX(.3deg)}88%{transform:skew(-.1deg)}}@keyframes dancing{0%{transform:translateY(0)}50%{transform:translateY(-20px)}100%{transform:translateY(0)}}</style><style id=s></style><body data-s=title><button type=button id=soundButton></button><section id=title><dialog id=titleDialog><form method=dialog><h1 class=title>Number Knight</h1><button class=button>Play <small>with sound</small></button> <button class=button value=no-sound>Play <small>without sound</small></button> <button class=button value=editor><small>Level editor</small></button></form></dialog></section><section id=menu><dialog id=menuDialog><form method=dialog><h2 class=title>Choose a level</h2><nav id=levelList></nav></form></dialog></section><aside data-t=0><p>Welcome to <b>Number Knight</b>!<p>Your goal is to conquer towers by fighting monsters.<p>Click on this little blob to kill it!</aside><aside data-t=1><p>Well done! When you kill a monster, you gain its power.<p>In order to win a fight, you must have <b>more</b> power than your target: if you have the same power, you'll lose!</aside><aside data-t=3><p>Oh, some elementary blobs!<p>The last one is powerful with its 45 of power... But don't worry: when you kill a monster, you absorb its element and your <b>next</b> attack will use it.<p><span class="e p"></span> monsters are weak against <span class="e f"></span> attacks: your power will count <b>twice</b> against this green blob!</aside><aside data-t=4><p>Don't forget: the element is available only for your <b>next</b> attack.</aside><aside data-t=5><p>If you fight en elementary monster with a weaker element, your power will be <b>divided</b> by two for this duel.<p><b>You start this level with <span class="e f"></span> element</b>, which is weak against <span class="e a"></span>...</aside><aside data-t=6><p>There're three elements: <span class="e f"></span>, <span class="e a"></span> and <span class="e p"></span>.<br>Each element is b against another one:<p><span class="e f"></span> > <span class="e p"></span> > <span class="e a"></span> > <span class="e f"></span></aside><aside data-t=9><p>Hm, beware of these skeletons...<br>When you kill them, you don't gain their power... You <b>lose</b> it!<p>If your own power reaches 0 or below, <b>you die</b>!</aside><aside data-t=11><p>Like blobs, skeletons can be attached to some element.</aside><aside data-t=13><p>These wizards have strange magic...<br>When you kill them, you gain their power... <b>but the other monsters in the same tower gain it too!</b></aside><aside data-t=16><p>What about elementary wizards?</aside><aside data-t=19><p>Oh! Potions!<br>You can't lose against potions: you simply drink them and your power is modified according to their value.</aside><aside data-t=20><p>Well... You still can die if your power reaches 0 or below...</aside><aside data-t=22><p>Potions can also contain some elements!<br>When drinking a <b>positive</b> potion, <b>its effect</b> will be doubled if your element is better, or divided by two if it's weaker.<br>When drinking a <b>negative</b> potion, <b>its effect</b> will be doubled if your element is weaker, or divided by two if it's better.<br>Try to guess your next power before drinking potions in this level!</aside><section id=game><dialog id=gameOverDialog><form method=dialog><p class="title split">Too bad!</p><button class=button>Retry</button></form></dialog><dialog id=endLevelDialog><form method=dialog><p class=title>Congrats!<p id=gameEndMessage class=split>You've finished all the levels, you're the best!</p><button class=button><span class=next>Next</span> <span class=menu>Menu</span></button></form></dialog><div id=c class=t-c></div></section><section id=editor><aside style=display:block;position:fixed;z-index:9><p><b>Build your own level!</b></p><label>Share direct link to your level <input readonly value=133 type=url id=cu onclick=this.select()></label><div><a id=ca class=button target=_blank><small>Test level ⭷</small></a><hr><a id=cs class=button target=_blank rel=opener><small>Save level ⭷</small></a> <a href=https://adrien-gueret.github.io/number_knight/your_levels.html class=button target=_blank rel=opener><small>All your levels ⭷</small></a></div></aside><div id=ce class=t-c><div class="tower current"><div class=t-f data-e=none><div contenteditable class="f-v value">10</div><div class=character></div><div role=button tabindex=1 class="e none">◆</div></div></div></div></section><script>let _=document,h=_.body,y=_.createElement.bind(_),t=s.sheet,e=[];for(var a of _.querySelectorAll("[data-t]"))e.push(`body[data-t="${a.dataset.t}"] aside[data-t="${a.dataset.t}"]`);t.insertRule(e.join(",")+"{display:block;}",t.cssRules.length);let w=!1;for(var n of _.querySelectorAll(".split")){n.innerHTML=`<span>${n.textContent.trim().split("").join("</span><span>")}</span>`.replace(/ /g,"&nbsp;");let t=0;for(var B of n.querySelectorAll("span"))B.style.animationDelay=10*t+++"ms"}let r=["1t0","2t1_2","3t2_4t16_32_8","4t6f_3f_12ft45p","5t5_25p_2f_1","6ft2_5a_1f","7t20p_5f_7a","8at4p_38a_13_8ft70p","9pt7p_7a_7_7ft35a_35f_35p_35t1_300a_950f","10t4st3st2s","11t1_10st1s_1","12at6sa_6sf_6ft5sf","13at3sp_3sf_3ft25f_15a_30ps_10ast10a_10sf","14t2w_2wt10w_10wt40","15t10w_15_10t65","16t10_11s_10wt24","17ft22a_17wp_17aw_17sp","18at7wf_7sf_7wp_7sp","19ft12a_10sf_11wpt24p_28wa_30sft50a_65wf_50_50pt940f","20t+100mt-50mt130_x2m","21t-25m_+5mt-20m_+30m_-10m","22t+28m_40a_40spt20wa_5sp_+20mt100","23ft+30mpt+17mpt/2mft+10matx2mftx2mat/2mft119","24t10f_6a_+10mpt-6mf_10wp_10sat+10m_90_20w","25t+40mf_+40ma_+40mp_30wft100wp_+80pm_+80amt-1000m","26t-8mp_-8m_-8mf_-8mat3p","27t-20mp_15sa_-10mf_6wp_6sp_6wft-30ma","28ft1f_+1mf_13s_30wa_14at90_/2m_90wt-100mf_+10mp_180ft360p","29t+1mf_+1ma_+1mpt+35ma_35bpt1b_-140mat-30mp_30wa_30sft35bp","999t1"],b=r,l=(t,e)=>(e-t)/e,R=t=>9e4<(t=1.3*Math.pow(t,.96))?null:(t+80*Math.sin(t/1900)&128?.05:-.05)*Math.pow(l(t,9e4),5),j=t=>3e3<t?null:3*Math.sin(t/100-Math.sin(t/10)*Math.sin(t/100))*Math.cos(Math.random())*l(t,3e3),F=t=>{var e,a=[0,4,7,12,void 0,7,12];return 35e3<t?null:void 0===(e=a[a.length*t/35e3|0])?0:(a=l(t*a.length%35e3,35e3),t*(.8*Math.pow(2,e/12))&128?a:-a)},O=t=>{var e;return 2e4<t?null:(e=l(t,2e4),Math.sin(.001*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*e*e)},V=t=>5e4<t?null:(20&Math.pow(t+100*Math.sin(.03*t),.6)?.1:-.1)*Math.pow(l(t,5e4),2),o=!1,L=e=>{if(o){var t=new AudioContext,a=t.createBuffer(1,96e3,48e3),n=a.getChannelData(0);for(let t=96e3;t--;)n[t]=e(t);var s=t.createBufferSource();s.buffer=a,s.connect(t.destination),s.start()}},i=t=>{(t=void 0===t?!o:t)!==o&&(o=t,soundButton.classList.toggle("on",o),o?p():d.forEach(t=>{t.onended=null,t.stop()}))},d=(soundButton.onclick=()=>i(),[]);function p(){if(o){d.length=0;let t=[13,13,13,11,10,11,15,16,15,13,13,13,15,16,15,11,10,11,13,13,13,16,17,16,10,9,10,13,13,13,9,8,9,17,18,17,13,13,16,17,10,9,13,13,15,16,11,10,13,13,9,8,17,18,13,13,11,10,15,16],n=t.length,s=new AudioContext,r=s.createGain();r.gain.value=.07,r.connect(s.destination),t.forEach((t,e)=>{var a=s.createOscillator();d.push(a),a.type="sine",a.connect(r),a.onended=o&&e===n-1?p:null,a.start(.35*e),a.frequency.setValueAtTime(340*1.06**(13-t),.35*e),a.stop(.35*e+.34)})}}let M,x,N,k,S=!1;function E(t,e){e=["-","/"].includes(e);var a,n=k.parentNode.dataset.e;return t&&n?(a={f:"p",p:"a",a:"f"})[n]===t?e?.5:2:a[t]===n?e?2:.5:1:1}function C(){h.classList.add("gameover"),h.classList.remove("attacking"),S=!1,k.classList.add("dead"),setTimeout(()=>{L(R),gameOverDialog.showModal()},500)}function g(t,e){return Math.floor(Math.random()*(e-t+1))+t}function T(f){f.classList.add("destroying"),f.parentNode.classList.add("d-f"),f.tabIndex=-1;let m=0;return new Promise(u=>{for(let p=0;p<144;p+=36)for(let c=0;c<144;c+=36){let n=y("div"),s=(n.className="t-f destroying piece",n.style.setProperty("--ix",p+"px"),n.style.setProperty("--iy",c+"px"),f.append(n),g(80,50)),r=g(80,89)*Math.PI/180,l=0,t=[1,-1,0],o=t[Math.floor(Math.random()*t.length)],e=g(-5,10),a=g(9,11)/10,i=g(30,5),d=(n.style.transform=`translateX(var(--x)) translateY(var(--y)) scale(${a}) skew(${e}deg) rotateZ(${i}deg)`,setInterval(()=>{let t,e=Math.cos(r)*s*o,a=(Math.sin(r)*s-9.8*l)*l+-4.9*Math.pow(l,2);requestAnimationFrame(()=>{n.style.setProperty("--x",e*l+"px"),n.style.setProperty("--y",-a+"px")}),l+=.1,a<-30&&(clearInterval(d),n.remove(),16<=++m)&&((t=f.parentNode).classList.remove("d-f"),f.remove(),u(t))},10))}})}function U(v){if(!S){S=!0;let u=v.target,f=u.classList.contains("m"),m=Number(u.dataset.value),g=u.dataset.e,t=u.querySelector(".character"),e=k.getBoundingClientRect(),a=t.getBoundingClientRect(),n=(a.left-e.left)/4-8,s=(a.top-e.top)/4;k.addEventListener("transitionend",()=>{let o=y("div");o.className="hit"+(f?" drink":""),o.style.setProperty("--r",[90,180,270,0][Math.floor(m*Math.random()*100)%4]+"deg");let i,d=E(g,u.dataset.sign),p=(1!==d&&((i=y("div")).className="hit-m",i.innerHTML=2===d?"x2":"/2"),f||(t=m,x*E(g)>t));var t;o.addEventListener("animationend",()=>{setTimeout(()=>{if(o.remove(),i&&i.remove(),p){f?(n=m*d,x=Math.floor({"+":x+n,"-":x-n,x:x*n,"/":x/n}[u.dataset.sign])):x+=m*(u.classList.contains("s")?-1:1),N.innerHTML=x;var t,e,a,n=u.parentNode;if(1===n.childNodes.length)if(u.innerHTML="",h.classList.remove("attacking"),S=!1,_.querySelector(".tower.current").classList.remove("current"),delete k.parentNode.dataset.e,n.classList.add("current"),u.tabIndex=-1,k.style.removeProperty("transform"),u.append(N,k),u.blur(),x<=0)C();else{var s,r=c.querySelector(".current+.tower");if(null===r)setTimeout(()=>{var t=q();w||localStorage.setItem("number-knight-last-level",Math.max(t,M+1)),L(F),u.querySelector(".character").addEventListener("transitionend",t=>{t.target.remove()},{once:!0}),h.classList.add("walking"),u.querySelector(".f-v").style.visibility="hidden",t=M===b.length-1,endLevelDialog.classList.toggle("end",t),endLevelDialog.classList.toggle("hideEndMessage",b.length<2),endLevelDialog.showModal()},500);else{for(s of r.querySelectorAll(".t-f"))s.tabIndex=1;h.style.setProperty("--sx",`-${192*c.querySelectorAll(".t-f:empty").length}px`)}}else{if(u.classList.contains("w"))for(var l of n.querySelectorAll(".t-f"))l!==u&&(t=l.dataset.sign,e=m+Number(l.dataset.value)*("-"===t?-1:1),a=Math.abs(e),"-"===t&&0<=e&&(l.dataset.sign="+"),l.dataset.value=a,l.querySelector(".f-v").innerHTML=""+(l.dataset.sign??"")+a);L(V),T(v.target),g?k.parentNode.dataset.e=g:delete k.parentNode.dataset.e,k.addEventListener("transitionend",()=>{h.classList.remove("attacking"),S=!1,x<=0&&C()},{once:!0}),k.style.removeProperty("transform")}}else C()},1===d?0:200)}),L(f?O:j),k.append(o),i&&k.append(i)},{once:!0}),h.classList.add("attacking"),k.style.transform=`scale(4) translate(${n}px, ${s}px)`}}gameOverDialog.onclose=()=>{D(M)},endLevelDialog.onclose=()=>{var t=M+1;b[t]?D(t):location.href=location.origin+location.pathname},menuDialog.onclose=t=>{A(Number(t.target.returnValue))};let u="t",f="_";function m(t){let e=t.split(u),r={p:"e",a:"e",f:"e",b:"t",s:"t",w:"t",m:"t"};return e.map(t=>t.split(f).map(t=>{let e=["+","-","x","/"].includes(t[0])?t[0]:null,a=Number.parseInt(e?t.substring(1):t,10),n=String(a),s={value:a};return e&&(s.sign=e),n!==t&&t.substring(n.length).split("").forEach(t=>{t in r&&(s[r[t]]=t)}),s}))}function v(t){S=!1,h.classList.remove("gameover","attacking"),c.innerHTML="",h.style.setProperty("--sx","0px"),t.forEach((t,l)=>{let o=y("div"),i=(o.className="tower",0===l);i&&(o.className+=" current"),t.forEach((e,t)=>{let a,n=y("div");n.role="button",n.tabIndex=1===l?1:-1,n.className="t-f",a=e.value,["e","sign","value"].forEach(t=>t in e&&(n.dataset[t]=e[t])),i||n.classList.add(e.t??"b");var s=y("div"),r=(s.innerHTML=""+(e.sign??"")+a,s.className="f-v",n.append(s),o.append(n),y("div"));r.className="character",r.style.animationDelay=100*Math.random()*(l+1)*(t+1)+"ms",n.append(r),i&&(k=r,x=a,N=s),n.addEventListener("click",U)}),c.append(o)})}function q(){return Number(localStorage.getItem("number-knight-last-level")||0)}function D(t){h.classList.remove("walking"),M=t,Number.isInteger(t)?(w||(h.dataset.t=t),v(m(b[t])),_.scrollingElement.scrollTo(0,0)):v(m(t))}function A(t){h.classList.add("walking");var e=()=>{h.style.display="none",h.offsetHeight,h.style.display="block",h.dataset.s="game",D(t)};w?e():h.addEventListener("transitionend",e,{once:!0})}h.onkeydown=t=>{["Enter"," "].includes(t.key)&&"button"===_.activeElement?.role&&_.activeElement.click()};let G=()=>{X(H()),H(),I(),h.dataset.s="editor"},I=(titleDialog.onclose=t=>{if("editor"===t.target.returnValue)G();else{var e=q();if(i("no-sound"!==t.target.returnValue),0===e)A(0);else{var a=_.createDocumentFragment();for(let t=0;t<r.length;t++){var n=y("button");n.value=t,n.innerText=t+1,n.className="button",n.style.animationDelay=10*t+"ms",n.disabled=e<t,a.append(n)}h.dataset.s="menu",menuDialog.showModal(),levelList.append(a)}}},ce.onbeforeinput=t=>{["deleteContentBackward","deleteContentForward"].includes(t.inputType)||"insertText"===t.inputType&&(t.target.classList.contains("value")&&Number.isInteger(parseInt(t.data,10))||"sign"===t.target.className&&["+","-","/","*","x"].includes(t.data))||(t.preventDefault(),t.stopPropagation())},()=>{var t=_.location.origin,e=_.location.pathname,a=(()=>{let a=["p","a","f","b","s","w","m"],t=[];for(var e of ce.querySelectorAll(".tower")){var n,s=[];for(n of e.querySelectorAll(".t-f"))if(!n.classList.contains("ghost")&&!n.classList.contains("destroying")){let e="";n.classList.contains("m")&&(e+=n.dataset.sign);var r=n.querySelector(".f-v .value")||n.querySelector(".f-v");e+=r.textContent,[n.dataset.type,n.dataset.e].forEach(t=>{a.includes(t)&&(e+=t)}),s.push(e)}s.length&&t.push(s.join(f))}return t.join(u)})();cu.value=""+t+e+"?p="+a,ca.href=cu.value,cs.href="https://adrien-gueret.github.io/number_knight/your_levels.html#"+a}),P=t=>{var e;t.classList.contains("value")?t.textContent=Math.max(1,Math.min(999999,Number(t.textContent))):"sign"===t.className&&(e=("*"===t.textContent[0]?"x":t.textContent[0])||"+",t.parentNode.parentNode.dataset.sign=e,t.textContent=e),I()},H=(ce.oninput=t=>{["deleteContentBackward","deleteContentForward"].includes(t.inputType)||P(t.target)},ce.addEventListener("blur",t=>P(t.target),!0),ce.onkeydown=t=>{var e,a;t.target.classList.contains("value")&&(e=Number(t.target.textContent),a={ArrowUp:1,ArrowDown:-1}[t.key])&&(t.target.textContent=e+a,P(t.target))},()=>{var t=y("div");return t.className="tower",t.innerHTML='<div role="button" tabindex="1" class="t-f ghost"><div class="f-v">+</div></div>',ce.append(t),t}),X=t=>{var e=y("div");e.dataset.e="none",e.dataset.type="b",e.dataset.sign="+",e.className="t-f b",e.innerHTML='<button class="d">❌</button><div class="f-v"><span class="sign" contenteditable>+</span><span class="value" contenteditable>10</span></div><div role="button" tabindex="1" class="character"></div><div role="button" tabindex="1" class="e none">◆</div>',t.firstChild.after(e)};ce.onclick=r=>{var t;r.target.classList.contains("d")?T(r.target.parentNode).then(t=>{1===t.children.length&&t.remove(),I()}):((t=(t,e,a,n,s)=>{r.target.classList.contains(t)&&(t=e[e.indexOf(r.target.parentNode.dataset[a])+1]||e[0],r.target.parentNode.dataset[a]=t,n.className=s+" "+t,I())})("e",["none","f","a","p"],"e",r.target,"e"),t("character",["b","s","w","m"],"type",r.target.parentNode,"t-f"),r.target.classList.contains("ghost")&&(X(r.target.parentNode),r.target.parentNode.nextSibling||H(),I()))};var $=new URLSearchParams(location.search);$.has("p")?(w=!0,b=$.getAll("p"),A(0)):$.has("e")?G():titleDialog.showModal()</script>