<!doctype html><title>ROTOGAMEsq - js13kGames 2012</title><style>a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}*,.button.disabled{cursor:default}*{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;user-select:none}body,html{background:#000}body{font-family:Arial,'Liberation Sans','DejaVu Sans',sans-serif;position:relative}#hiscoresTable td input,body{color:#fff}#boardsNavigator>*,.button{cursor:pointer}.button.disabled{color:#777}#arrowCanvas,#boardsNavigator,#boardsNavigator>*,#display,#loadIndicator,#panel,#rotAnimCanvas,#rubberBandCanvas,#tilesCanvas{position:absolute}#display,#loadIndicator,#panel{display:none}h1{display:block;height:13%;padding-top:2%}#rotationsNavigator,h1{width:100%;font-size:2em;text-align:center}#hiscoresTable td span,#rotationsNavigator,h1{font-weight:700}h1 em{font-family:Georgia,'Times New Roman',Times,serif;font-style:italic;font-weight:400}#rotationsNavigator{height:15%}#hiscoresTable{width:90%;font-size:1.5em;margin:0 5%}#boardsNavigator,#hiscoresTable{overflow:hidden}#hiscoresTable td:first-child{text-align:left}#hiscoresTable td:last-child{text-align:right}#hiscoresTable tr.input{border-bottom:.2ex solid #fff}#hiscoresTable td input{border:0;margin:0;padding:0;background:0 0;cursor:text;font-size:1em;width:7em;-webkit-touch-callout:default;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;user-select:text}#hiscoresTable td input:focus{outline-width:0}#boardsNavigator{left:0;bottom:0;padding-bottom:2%}</style><link rel="shortcut icon" href=favicon.gif><meta name=HandheldFriendly content=True><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><div id=display><canvas id=tilesCanvas></canvas><canvas id=arrowCanvas></canvas><canvas id=rotAnimCanvas></canvas><canvas id=rubberBandCanvas></canvas></div><div id=panel><h1>ROTOGAME<em>sq</em></h1><p id=rotationsNavigator><span class="undo button disabled">↶</span><span id=nRotations>0</span><span class="redo button disabled">↷</span><table id=hiscoresTable><tbody></table><div id=boardsNavigator></div></div><div id=loadIndicator><p>…</div><script>!function(){var e,t,n,i,o=function(e,t){var n,i,o,a,r,c,u,s,l,d=t&&t.split("/"),h=f.map,v=h&&h["*"]||{};if(e&&"."===e.charAt(0)&&t){for(e=(d=d.slice(0,d.length-1)).concat(e.split("/")),s=0;s<e.length;s+=1)if("."===(n=e[s]))e.splice(s,1),s-=1;else if(".."===n){if(1===s&&(".."===e[2]||".."===e[0]))break;0<s&&(e.splice(s-1,2),s-=2)}e=e.join("/")}if((d||v)&&h){for(s=(n=e.split("/")).length;0<s;s-=1){if(i=n.slice(0,s).join("/"),d)for(l=d.length;0<l;l-=1)if((o=h[d.slice(0,l).join("/")])&&(o=o[i])){a=o,r=s;break}if(a)break;!c&&v&&v[i]&&(c=v[i],u=s)}!a&&c&&(a=c,r=u),a&&(n.splice(0,r,a),e=n.join("/"))}return e},a=function(e,t){return function(){return i.apply(void 0,v.call(arguments,0).concat([e,t]))}},r=function(e){return function(t){l[e]=t}},c=function(e){if(d.hasOwnProperty(e)){var t=d[e];delete d[e],h[e]=!0,n.apply(void 0,t)}if(!l.hasOwnProperty(e))throw Error("No "+e);return l[e]},u=function(e,t){var n,i,a=e.indexOf("!");return-1!==a?(n=o(e.slice(0,a),t),e=e.slice(a+1),e=(i=c(n))&&i.normalize?i.normalize(e,function(e){return function(t){return o(t,e)}}(t)):o(e,t)):e=o(e,t),{f:n?n+"!"+e:e,n:e,p:i}},s=function(e){return function(){return f&&f.config&&f.config[e]||{}}},l={},d={},f={},h={},v=[].slice;n=function(e,t,n,i){var o,f,v,p,m,g=[];i=i||e;if("function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if("require"===(f=(v=u(t[p],i)).f))g[p]=a(e);else if("exports"===f)g[p]=l[e]={},m=!0;else if("module"===f)o=g[p]={id:e,uri:"",exports:l[e],config:s(e)};else if(l.hasOwnProperty(f)||d.hasOwnProperty(f))g[p]=c(f);else if(v.p)v.p.load(v.n,a(i,!0),r(f),{}),g[p]=l[f];else if(!h[f])throw Error(e+" missing "+f);t=n.apply(l[e],g),e&&(o&&void 0!==o.exports&&o.exports!==l[e]?l[e]=o.exports:void 0===t&&m||(l[e]=t))}else e&&(l[e]=n)},e=i=function(e,t,o,a,r){return"string"==typeof e?c(u(e,t).f):(e.splice||(f=e,t.splice?(e=t,t=o,o=null):e=void 0),t=t||function(){},"function"==typeof o&&(o=a,a=r),a?n(void 0,e,t,o):setTimeout((function(){n(void 0,e,t,o)}),15),i)},i.config=function(e){return f=e,i},(t=function(e,t,n){t.splice||(n=t,t=[]),d[e]=[e,t,n]}).amd={jQuery:!0},t("vendor/almond",[],(function(){})),t("tiles_factory",[],(function(){function e(e,t,n){var i,o,a,r;if(t.widthT!==e.widthT||t.heightT!==e.heightT)return!1;for(i=0;i<t.length;i+=1)for(a=t[i],r=e[i],o=0;o<a.length;o+=1)if(!n(a[o],r[o]))return!1;return!0}var t;return t=Object.create([],{areEqualTo:{value:function(t){return e(this,t,(function(e,t){return e===t}))}},colorsAreEqualTo:{value:function(t){return e(this,t,(function(e,t){return e.color===t.color}))}},widthT:{get:function(){return this.length}},heightT:{get:function(){return 0<this.widthT?this[0].length:0}},copy:{value:function(){var e=Object.create(t);return this.forEach((function(t){e.push(t.slice())})),e}}}),Object.create(null,{load:{value:function(e,n){var i=new Image;i.onload=function(){var e=(u=document.createElement("canvas")).getContext("2d");u.width=i.width,u.height=i.height,e.drawImage(i,0,0);var o,a,r,c,u=Math.min(i.width,i.height),s=e.getImageData(0,0,u,u).data;e=Object.create(t);for(a=0;a<u;a+=1){for(o=[],r=0;r<u;r+=1)c=4*(r*u+a),o.push({color:"rgb("+s[c]+","+s[c+1]+","+s[c+2]+")"});e.push(o)}n(e)},i.src=e}}})})),t("hiscores_factory",[],(function(){function e(e,i){var o=null;return Object.create(null,{forEach:{value:function(n){var i,a,r=e.length,c=!1;if(0===r&&null!==o)n(o,0,!0);else for(i=0;i<r;i+=1)a=e[i],null!==o&&o.nRotations<=a.nRotations&&!c?(n(o,i,!0),i-=1,r=Math.min(r,t-1),c=!0):n(a,i,!1)}},maxNameLen:{get:function(){return 8}},nameInProposal:{set:function(e){null!==o&&(e=e.substring(0,this.maxNameLen),n=o.name=e)}},saveProposal:{value:function(){if(null!==o){e:{var n,a,r=o,c=!1;if(""!==r.name){if(0===e.length){e.push(r);break e}for(n=0;n<e.length;n+=1){if(a=e[n],r.name===a.name&&r.nRotations>=a.nRotations)break e;r.nRotations<=a.nRotations&&!c?(e.splice(n,0,r),c=!0):r.name===a.name&&e.splice(n,1)}}e.length=Math.min(e.length,t)}o=null,localStorage.setItem(i,JSON.stringify(e))}}},propose:{value:function(e){o={name:n,rotations:e.slice(),nRotations:e.length}}},rmProposal:{value:function(){o=null}}})}var t=7,n="";return Object.create(null,{load:{value:function(t,n,i){var o;if(null!==(o=null===(o=localStorage.getItem(n))?null:JSON.parse(o)))i(e(o,n));else{var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?i(e(JSON.parse(a.responseText),n)):i(e([])))},a.open("GET",t+"?"+Date.now(),!0),a.send()}}}})})),t("board_factory",["tiles_factory","hiscores_factory"],(function(e,t){function n(e){return void 0!==e.tiles&&void 0!==e.endTiles&&void 0!==e.hiscores}function i(e,t){Object.defineProperty(e,"sideLenT",{value:e.tiles.length}),t(e)}function o(e,t,n,i){return e[n][i-t]}function a(e,t,n,i,o){return e[o-n][t]}function r(e,t,n,i,o){return e[i-t][o-n]}function c(e,t,n){var i,o,a,r,c=t[0][0],u=t[0][1],s=t[1][0],l=s-c,d=(t=t[1][1])-u;for(a=[],o=c;o<=s;o+=1){for(i=[],r=u;r<=t;r+=1)i.push(e[o][r]);a.push(i)}for(i=c;i<=s;i+=1)for(o=u;o<=t;o+=1)e[i][o]=n(a,i-c,o-u,l,d)}function u(e,t){var n=t.rectT,i=t.cw;n.isSquare?c(e,n,i?o:a):c(e,n,r)}function s(e,t){t.tiles.colorsAreEqualTo(t.endTiles)?e.isFinished||(e.isFinished=!0,t.hiscores.propose(e.rotations)):(e.isFinished=!1,t.hiscores.rmProposal())}var l;return l=Object.create(null,{rotate:{value:function(e,t){e.rotations.push(t),e.futureRotations.length=0,u(this.tiles,t),s(e,this),e.lastRotation=t}},undo:{value:function(e){var t=e.rotations.pop();void 0!==t&&(e.futureRotations.push(t),u(this.tiles,t.inverse),s(e,this),e.lastRotation=t.inverse)}},redo:{value:function(e){var t=e.futureRotations.pop();void 0!==t&&(e.rotations.push(t),u(this.tiles,t),s(e,this),e.lastRotation=t)}}}),Object.create(null,{load:{value:function(o,a){var r,c={rotations:[],futureRotations:[],lastRotation:null,isFinished:!1};r=Object.create(l,{rotate:{value:function(e){l.rotate.call(this,c,e)}},nRotations:{get:function(){return c.rotations.length}},undoIsPossible:{get:function(){return 0<c.rotations.length}},undo:{value:function(){l.undo.call(this,c)}},redoIsPossible:{get:function(){return 0<c.futureRotations.length}},redo:{value:function(){l.redo.call(this,c)}},isFinished:{get:function(){return c.isFinished}},lastRotation:{get:function(){return c.lastRotation}}}),e.load("boards/"+o+"/start.gif",(function(e){Object.defineProperty(r,"tiles",{value:e}),n(r)&&i(r,a)})),e.load("boards/"+o+"/end.gif",(function(e){Object.defineProperty(r,"endTiles",{value:e}),n(r)&&i(r,a)})),t.load("boards/"+o+"/hiscores.json","rotogamejs."+o+".hiscores",(function(e){Object.defineProperty(r,"hiscores",{value:e}),n(r)&&i(r,a)}))}}})})),t("boards",["board_factory"],(function(e){var t,n=0,i=["13","smiley","invaders","house","rgbcmy"];return t=Object.create([],{load:{value:function(n){this.length=i.length,i.forEach((function(o,a){e.load(o,(function(e){t[a]=e;e:{for(e=0;e<i.length;e+=1)if(void 0===t[e]){e=!1;break e}e=!0}e&&n()}))}))}},selected:{get:function(){return this[n]}},selectedI:{get:function(){return n},set:function(e){n=e}}})})),t("util",[],(function(){return Object.create(null,{whenDocumentIsReady:{value:function(e){"complete"===document.readyState?e():document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&e()}))}},clear:{value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}}})})),t("rect_t_factory",[],(function(){var e,t;return t=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e=Object.create([],{isEqualTo:{value:function(e){return t(this[0],e[0])&&t(this[1],e[1])}},widthT:{get:function(){return this[1][0]-this[0][0]}},heightT:{get:function(){return this[1][1]-this[0][1]}},centerT:{get:function(){return[(this[0][0]+this[1][0])/2,(this[0][1]+this[1][1])/2]}},contains:{value:function(e){var t=e[0];e=e[1];return t>=this[0][0]&&e>=this[0][1]&&t<=this[1][0]&&e<=this[1][1]}},isSquare:{get:function(){return this.widthT===this.heightT}}}),Object.create(null,{create:{value:function(t,n){var i=Object.create(e);return i.push(t),i.push(n),i}}})})),t("display_c_sys",["boards"],(function(e){function t(){var e;void 0!==i&&(e=i.sideLenT,o=(n-(a=r?0:.05*n/e)*(e+1))/e)}var n,i,o=0,a=0,r=!1;return Object.create(null,{sideLen:{set:function(e){e!==n&&(n=e,t())}},animStep:{value:function(){e.selected!==i&&(i=e.selected,t())}},posFromPosT:{value:function(e){return e.map((function(e){return e*(o+a)+a}))}},posTFromPos:{value:function(e){return e.map((function(e){return(e-a)/(o+a)}))}},decIfInSpacing:{value:function(e){return e.map((function(e){var t=e%(o+a);return 0<e&&t<a?e-t-o/2:e}))}},incIfInSpacing:{value:function(e){return e.map((function(e){var t=e%(o+a);return 0<e&&t<a?e-t+a+o/2:e}))}},posTInBounds:{value:function(e){return e.map((function(e){return Math.min(Math.max(e,0),i.sideLenT-1)}))}},tileSideLen:{get:function(){return o}},spacing:{get:function(){return a}},disableSpacing:{value:function(){r=!0,t()}},enableSpacing:{value:function(){r=!1,t()}}})})),t("display_canvas_factory",[],(function(){return Object.create(null,{create:{value:function(){var e=!0,t=!0;return Object.create(null,{visibilityNeedsToBeUpdated:{get:function(){return t}},isVisible:{get:function(){return e}},updateVisibility:{value:function(n){n.style.display=e?"block":"none",t=!1}},show:{value:function(){e||(t=e=!0)}},hide:{value:function(){e&&(e=!1,t=!0)}}})}}})})),t("rubber_band_canvas",["util","rect_t_factory","display_c_sys","display_canvas_factory"],(function(e,t,n,i){function o(){var e=n.incIfInSpacing([Math.min(w[0],T[0]),Math.min(w[1],T[1])]),i=n.decIfInSpacing([Math.max(w[0],T[0]),Math.max(w[1],T[1])]);e=n.posTInBounds(n.posTFromPos(e).map(Math.floor)),i=n.posTInBounds(n.posTFromPos(i).map(Math.floor));_=t.create(e,i)}function a(){m=T[0]>w[0]}function r(e){T=w=e,o(),a(),S=E=!0,void 0!==b&&b()}function c(e){T=e,o(),a(),S=!0,void 0!==g&&g(_,m)}function u(){E=!1,S=!0,w=T=[0,0],o(),a(),void 0!==y&&y()}function s(e){r([e.pageX,e.pageY])}function l(e){e.preventDefault(),0<(e=e.changedTouches).length&&r([e[0].pageX,e[0].pageY])}function d(e){E&&c([e.pageX,e.pageY])}function f(e){var t=e.changedTouches;e.preventDefault(),E&&0<t.length&&c([t[0].pageX,t[0].pageY])}function h(){E&&u()}function v(e){e.preventDefault(),E&&u()}var p,m,g,b,y,w=[0,0],T=[0,0],_=t.create([0,0],[0,0]),S=!0,E=!1,I=1;return e.whenDocumentIsReady((function(){var e=document.getElementById("rubberBandCanvas");e.addEventListener("mousedown",s),e.addEventListener("touchstart",l),window.addEventListener("mousemove",d),window.addEventListener("touchmove",f),window.addEventListener("mouseup",h),window.addEventListener("touchend",v),window.addEventListener("touchcancel",v)})),Object.create(i.create(),{animStep:{value:function(){var e=document.getElementById("rubberBandCanvas");if(this.visibilityNeedsToBeUpdated&&(this.updateVisibility(e),this.isVisible&&(S=!0)),S){var t=e.getContext("2d");e.height=e.width=p,I=.005*p,t.strokeStyle="#fff",t.lineWidth=I,t.lineJoin="round",t.strokeRect(w[0],w[1],T[0]-w[0],T[1]-w[1]),S=!1}}},isBeingDragged:{get:function(){return E}},sideLen:{set:function(e){e!==p&&(p=e,S=!0)}},onDragStart:{set:function(e){b=e}},onDrag:{set:function(e){g=e}},onDragEnd:{set:function(e){y=e}}})})),t("rot_anim_canvas",["boards","display_c_sys","display_canvas_factory"],(function(e,t,n){var i,o,a,r,c,u,s,l,d;return Object.create(n.create(),{animStep:{value:function(){var e=document.getElementById("rotAnimCanvas");if(this.visibilityNeedsToBeUpdated&&this.updateVisibility(e),a)if(s=u+.004*l*(Date.now()-c),(0>l?0>=s:0<=s)&&(s=0),0>l?0>=s:0<=s)a=!1,this.hide();else{var n,d=e.getContext("2d");n=r[0][0];var f=r[0][1],h=r[1][0],v=r[1][1],p=[(p=t.posFromPosT(r.centerT))[0]+t.tileSideLen/2,p[1]+t.tileSideLen/2];for(e.width=e.height=i,d.save(),d.translate(p[0],p[1]),d.rotate(s),e=n;e<=h;e+=1)for(n=f;n<=v;n+=1){var m=d,g=[e,n],b=p,y=t.posFromPosT(g),w=t.tileSideLen;m.fillStyle=o[g[0]][g[1]].color,m.fillRect(y[0]-b[0],y[1]-b[1],w,w)}d.restore()}}},sideLen:{set:function(e){i=e}},animIsRunning:{get:function(){return a}},isInRotRect:{value:function(e){return r.contains(e)}},startAnim:{value:function(t){d=e.selected,o=d.tiles.copy(),r=t.rectT,a=!0,c=Date.now(),l=-t.direction,u=t.angleRad,this.show()}}})})),t("arrow_canvas",["display_c_sys","display_canvas_factory"],(function(e,t){var n,i,o,a=!1;return(o=Object.create(t.create(),{animStep:{value:function(){var t=document.getElementById("arrowCanvas");if(this.visibilityNeedsToBeUpdated&&(this.updateVisibility(t),this.isVisible&&(a=!0)),a){var o=t.getContext("2d");if(t.height=t.width=n,void 0!==i&&i.makesSense){var r=i.angleDeg,c=(t=(c=e.posFromPosT(i.rectT[1]))[0],c[1]),u=e.tileSideLen/14;o.lineWidth=u;var s=0,l=90===r||-90===r?Math.PI/2:Math.PI;0<r?s-=Math.PI/8:l+=Math.PI/8,o.beginPath(),o.arc(t+10*u,c+10*u,1.5*u,s,l),o.stroke(),o.beginPath(),90===r||180===r||-180===r?(r=-180===r?-3*u:0,o.moveTo(t+10*u+r,c+10*u),o.lineTo(t+13*u+r,c+10*u),o.lineTo(t+11.5*u+r,c+8*u),o.lineTo(t+10*u+r,c+10*u)):(o.moveTo(t+10*u,c+10*u),o.lineTo(t+8*u,c+11.5*u),o.lineTo(t+10*u,c+13*u),o.lineTo(t+10*u,c+10*u)),o.fill(),o.closePath()}a=!1}}},rotation:{set:function(e){void 0!==i&&i.isEqualTo(e)||(i=e,this.isVisible&&(a=!0))}},sideLen:{set:function(e){e!==n&&(n=e,this.isVisible&&(a=!0))}}})).hide(),o})),t("rotation_factory",[],(function(){var e=Object.create(null,{isEqualTo:{value:function(e){return this.rectT.isEqualTo(e.rectT)&&this.cw===e.cw}},makesSense:{get:function(){return 0<this.rectT.widthT||0<this.rectT.heightT}},direction:{get:function(){return this.cw?-1:1}},angleRad:{get:function(){return this.direction*(this.rectT.isSquare?Math.PI/2:Math.PI)}},angleDeg:{get:function(){return this.direction*(this.rectT.isSquare?90:180)}},inverse:{get:function(){var t=this.rectT,n=!this.cw;return Object.create(e,{rectT:{get:function(){return t}},cw:{get:function(){return n}}})}}});return Object.create(null,{create:{value:function(t,n){return Object.create(e,{rectT:{get:function(){return t}},cw:{get:function(){return n}}})}}})})),t("tiles_canvas","boards rubber_band_canvas rot_anim_canvas arrow_canvas display_c_sys display_canvas_factory rotation_factory rect_t_factory".split(" "),(function(e,t,n,i,o,a,r,c){function u(){p=void 0===f?void 0:r.create(f,h)}var s,l,d,f,h,v,p,m=!0,g=!0;return t.onDragStart=function(){i.show()},t.onDrag=function(e,t){void 0!==f&&e.isEqualTo(f)&&t===h||(f=e,h=t,m=!0,u(),i.rotation=p)},t.onDragEnd=function(){void 0!==p&&p.makesSense&&!e.selected.isFinished&&e.selected.rotate(p),e.selected.isFinished?t.hide():t.show(),i.hide(),f=void 0,u(),m=!0},Object.create(a.create(),{animStep:{value:function(){var a;if(void 0===d||d!==e.selected?(m=!0,d=e.selected,a=!0):a=!1,void 0!==l&&d.tiles.areEqualTo(l)||(l=d.tiles.copy(),a||null!==(a=d.lastRotation)&&n.startAnim(a),e.selected.isFinished?t.hide():t.show(),i.hide(),m=!0),g&&(a=r.create(c.create([0,0],[l.widthT-1,l.heightT-1]),!0),n.startAnim(a),g=!1),void 0!==v&&v===n.animIsRunning||(m=!0,v=n.animIsRunning),m){var u,h;a=d.sideLenT;var p=(u=document.getElementById("tilesCanvas")).getContext("2d"),b=d.isFinished&&!n.animIsRunning;for(u.height=u.width=s,b&&o.disableSpacing(),u=0;u<a;u+=1)for(h=0;h<a;h+=1){var y=p,w=[u,h],T=o.posFromPosT(w),_=l[w[0]][w[1]].color,S=t.isBeingDragged,E=o.tileSideLen,I=0===o.spacing?1:0;n.animIsRunning&&n.isInRotRect(w)||(y.globalAlpha=S&&t.isBeingDragged&&void 0!==f&&w[0]>=f[0][0]&&w[0]<=f[1][0]&&w[1]>=f[0][1]&&w[1]<=f[1][1]?.5:1,y.fillStyle=_,y.fillRect(T[0],T[1],E+I,E+I))}b&&o.enableSpacing(),m=!1}}},sideLen:{set:function(e){e!==s&&(s=e,m=!0)}}})})),t("display",["tiles_canvas","arrow_canvas","rubber_band_canvas","rot_anim_canvas","display_c_sys"],(function(e,t,n,i,o){var a,r=!1,c=!0;return Object.create(null,{animStep:{value:function(){if(r){if(c){var u=document.getElementById("display").style;r&&(u.display="block"),u.width=a+"px",u.height=a+"px",c=!1}o.animStep(),e.animStep(),t.animStep(),n.animStep(),i.animStep()}}},sideLen:{set:function(r){r!==a&&(a=r,o.sideLen=a,e.sideLen=a,t.sideLen=a,n.sideLen=a,i.sideLen=a,c=!0)}},show:{value:function(){c=r=!0}}})})),t("board_thumb_factory",["boards"],(function(e){function t(e,t,n){return e.map((function(e){return e*t/n}))}return Object.create(null,{create:{value:function(n,i){var o=document.createElement("canvas"),a=!0,r=0,c=0,u=0;return o.addEventListener("click",(function(){e.selectedI=n,i()})),Object.create(null,{element:{get:function(){return o}},boardI:{set:function(e){e!==n&&(n=e,a=!0)}},sideLen:{set:function(e){e!==r&&(r=e,a=!0)}},x:{set:function(e){e!==c&&(c=e,a=!0)}},y:{set:function(e){e!==u&&(u=e,a=!0)}},animStep:{value:function(){if(a){var i=e[n],s=r,l=c,d=u,f=i.sideLenT,h=o.getContext("2d");for(o.width=o.height=s,o.style.left=l-s/2+"px",o.style.top=d-s/2+"px",l=0;l<f;l+=1)for(d=0;d<f;d+=1){var v=h,p=[l,d],m=s,g=i.sideLenT,b=i.endTiles,y=t(p,m,g);m=m/g+1;v.fillStyle=b[p[0]][p[1]].color,v.fillRect(y[0],y[1],m,m)}a=!1}}}})}}})})),t("boards_navigator",["boards","board_thumb_factory"],(function(e,t){function n(){var e;u.forEach((function(t,n){e=n-v-s,t.sideLen=o/(4+2*Math.abs(e)),t.x=e*(o/3)+o/2,t.y=o/8}))}function i(n){return t.create(((d+n)%e.length+e.length)%e.length,(function(){r=0<(a=s-n)?-1:1,c=Date.now(),l=!0,d=e.selectedI,u.forEach((function(t,n){t.boardI=((d+(n-v))%e.length+e.length)%e.length}))}))}var o,a,r,c,u=[],s=0,l=!1,d=0,f=!0,h=!0,v=2;return Object.create(null,{animStep:{value:function(){if(h){var e=document.getElementById("boardsNavigator"),t=e.style;t.width=o+"px",t.height=o/4+"px",f&&0<u.length&&(u.forEach((function(t){e.appendChild(t.element)})),f=!1),h=!1}u.forEach((function(e){e.animStep()})),l&&(s=a+.005*r*(Date.now()-c),(0<r&&0<=s||0>r&&0>=s)&&(s=0,l=!1),n(),n())}},activate:{value:function(){var e;for(u.length=0,e=-v;e<=v;e+=1)u.push(i(e));n(),h=!0}},width:{set:function(e){e!==o&&(o=e,n(),h=!0)}}})})),t("hiscores_table",["util","boards"],(function(e,t){function n(e){var t=document.createElement("td");return t.appendChild(document.createTextNode(e)),t}function i(){s.hiscores.nameInProposal=l.value}function o(){h&&(s.hiscores.nameInProposal=l.value,s.hiscores.saveProposal(),v=!0)}function a(){var e;void 0!==d&&(e="submit button"+(h?"":" disabled"),d.className=e)}function r(){h=""!==l.value,a()}function c(e){r(),13===e.keyCode&&o()}function u(e){var t=document.createElement("tr");return t.className="input",t.appendChild(function(e){var t=document.createElement("td");return void 0===l&&((l=document.createElement("input")).type="text",l.maxLength=l.size=s.hiscores.maxNameLen,l.spellcheck=!1,l.addEventListener("blur",i),l.addEventListener("keyup",c),l.addEventListener("propertychange",r),l.addEventListener("input",r),l.addEventListener("paste",r)),l.value=e,t.appendChild(l),r(),t}(e.name)),t.appendChild(function(){var e=document.createElement("td");return void 0===d&&((d=document.createElement("span")).appendChild(document.createTextNode("↵")),d.addEventListener("click",o),a()),e.appendChild(d),e}()),t}var s,l,d,f,h=!1,v=!0;return Object.create(null,{animStep:{value:function(){if(t.selected!==s?(s=t.selected,f=s.isFinished,v=!0):s.isFinished!==f&&(f=s.isFinished,v=!0),v){var i=document.getElementById("hiscoresTable");e.clear(i),s.hiscores.forEach((function(e,t,o){o?i.appendChild(u(e)):i.appendChild(function(e){var t=document.createElement("tr");return t.appendChild(n(e.name)),t.appendChild(n(e.nRotations)),t}(e))})),v=!1}}}})})),t("rotations_navigator",["boards","util"],(function(e,t){function n(e){return document.querySelector("#rotationsNavigator>."+e+".button")}function i(){c.undo()}function o(){c.redo()}function a(e,t){var i=e+" button";t&&(i+=" disabled"),n(e).className=i}var r,c,u=!0;return t.whenDocumentIsReady((function(){n("undo").addEventListener("click",i),n("redo").addEventListener("click",o)})),Object.create(null,{animStep:{value:function(){e.selected!==c&&(c=e.selected,u=!0),c.nRotations!==r&&(r=c.nRotations,u=!0),u&&(document.getElementById("nRotations").textContent=r,a("undo",!c.undoIsPossible),a("redo",!c.redoIsPossible),u=!1)}}})})),t("panel",["boards_navigator","hiscores_table","rotations_navigator"],(function(e,t,n){var i,o,a=!0,r=!1;return Object.create(null,{animStep:{value:function(){if(r){if(a){var c=document.getElementById("panel").style;c.display="block",c.width=i+"px",c.height=o+"px",c.left=o+"px",c.fontSize=Math.ceil(o/25)+"px",a=!1}e.animStep(),t.animStep(),n.animStep()}}},show:{value:function(){r=!0,e.activate(),a=!0}},width:{set:function(t){t!==i&&(i=t,e.width=i,a=!0)}},height:{set:function(e){e!==o&&(o=e,a=!0)}}})})),t("load_indicator",[],(function(){var e,t=!0,n=!0;return Object.create(null,{animStep:{value:function(){if(t&&n){var i=document.getElementById("loadIndicator").style;i.fontSize=Math.ceil(e/20)+"px",i.top=i.left=Math.round(.01*e),i.display="block",n=!1}}},hide:{value:function(){document.getElementById("loadIndicator").style.display="none",t=!1}},width:{set:function(t){t!==e&&(e=t,n=!0)}}})})),t("vendor/rAF",[],(function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout((function(){t(n+i)}),i);return e=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})),t("game","display panel boards load_indicator util vendor/rAF".split(" "),(function(e,t,n,i,o){function a(){i.animStep(),e.animStep(),t.animStep(),window.requestAnimationFrame(a)}function r(){window.innerWidth/window.innerHeight<1.61803398875?(c=window.innerWidth,u=Math.floor(c/1.61803398875)):(u=window.innerHeight,c=Math.floor(1.61803398875*u)),document.body.style.width=c+"px",document.body.style.height=u+"px",e.sideLen=u,t.width=c-u,t.height=u,i.width=c}var c,u;o.whenDocumentIsReady((function(){window.requestAnimationFrame(a),n.load((function(){t.show(),e.show(),i.hide()})),r(),window.addEventListener("resize",r)}))})),e(["game"])}()</script>