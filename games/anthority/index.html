<!doctype html><meta content="width=device-width" name=viewport><style>body{background-color:#2b2b2b;background-image:url(img/back.png);background-repeat:repeat;font-family:"Trebuchet MS",Helvetica,sans-serif;color:#dfe0e0;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}a,h1,span{cursor:default;text-decoration:none}a{color:#a6cce0}a:hover{text-decoration:underline}@keyframes headerhighlight{0%{background-color:#369d8a}10%{background-color:#69b7a9}100%{background-color:#369d8a}}#header{background-color:#369d8a;margin:0;margin-bottom:10px;overflow:hidden;padding:10px;border-radius:5px;border-bottom:5px solid #ee7147}.hhighlight{animation-name:headerhighlight;animation-duration:.3s;animation-delay:.5s}#header div{display:inline-block;padding-right:10px;padding-left:10px;border-right:1px solid #58ae9e}#header div.right-end{float:right}#header div.right{border:0;float:right}#header div.end{border:0;margin-right:0;padding-right:0}#header div span{font-weight:700;display:block;width:100%;text-align:center;font-size:22px}#header div span:last-child{font-weight:400;font-size:12px;color:#b0f7ea}@media screen and (max-width:400px){#header div span{font-size:15px}#header div span:last-child{font-weight:400;font-size:10px;color:#b0f7ea}}#columns{overflow:hidden}.column{width:100%}.column:first-child{margin-top:0}@media screen and (min-width:768px){.column{margin-top:0}#left{float:left;width:25%}#center{width:45%;display:inline-block}#right{width:30%;float:right}}.widget{display:block;background-color:#2f3439;padding:5px;border-radius:5px}.widget-invisible{display:block;background-color:#2b2b2b;padding:0}.widget h1{font-size:15px;padding:5px;margin:0}@media screen and (min-width:768px){.widget{margin-right:10px}.widget-clear{margin-right:0}}.column a:last-child{margin-bottom:0}@media screen and (max-width:768px){.actions{height:180px;transition:transform 150ms ease-in-out,height 150ms ease-in-out,margin 150ms ease-in-out;margin-bottom:10px}.collapse{transform:scaleY(0) translateY(-100%)!important;height:0;margin-bottom:-10px}#right{margin-top:10px}}.button{display:block;border-radius:5px;padding:15px;background-color:#ee7147;color:#eee;text-align:center;text-decoration:none;font-size:14pt;margin-bottom:10px;pointer-events:all;transition:background-color .2s;text-decoration:none}.disabled{background-color:#b28b7e;pointer-events:none}.inline-button{display:inline}.small-button{padding:5px}.button:active{background-color:#369d8a;transition:background-color .2s;text-decoration:none}.button:hover{text-decoration:none}@media screen and (min-width:768px){.button:hover{background-color:#369d8a;transition:background-color .2s;text-decoration:none}.button:active{background-color:#54baa7;transition:background-color .2s}}.dialog-container{visibility:visible;position:absolute;top:0;bottom:0;left:0;right:0;background-color:#282626;opacity:.8;transition:opacity 50ms ease-in}.dialog{position:fixed;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);min-width:280px;max-width:400px;margin:auto;border-radius:5px;background-color:#2f3439;padding-bottom:15px;border-bottom:5px solid #ee7147;opacity:1;transition:opacity .2s ease-in}.hidden{position:absolute;visibility:hidden!important;opacity:0}.dialog header{padding:15px;padding-bottom:5px;font-size:14pt}.dialog section{padding:5px;margin:10px;margin-bottom:25px;background-color:#eee;color:#2f3439;border-radius:5px;overflow-y:auto;max-height:70vh}.dialog .button-container{margin:10px}.msghighlight{background-color:#fff;padding:3px;border-radius:3px}.msgerror{background-color:#fff;color:#b83310;padding:3px;border-radius:3px}.msghighlight b{color:#0d0037}@media screen and (min-width:768px){.dialog{width:400px}}.range{background-color:#d0d3d2;padding:5px;border-radius:5px;margin-bottom:10px}.range h1{font-size:16px;display:inline-block;margin-bottom:15px}.range span{display:inline-block;font-size:16px;font-weight:700;text-align:center;margin-right:5px;margin-left:5px;width:60px}.range .range-controls{margin-top:13px;float:right}.range .button{padding-left:15px;padding-right:15px}.infowidget{background-color:#2b9884;margin:0;margin-bottom:10px;overflow:hidden;padding:10px;border-radius:5px;color:#dfe0e0;border-bottom:5px solid #ee7147}.infowidget div{display:block;padding-right:10px;padding-left:10px;border-left:1px solid #58ae9e;float:right}.infowidget .infowidgettitle{display:inline-block;float:none;border:0;padding:0;font-size:16px;margin-top:10px;margin-left:0;font-weight:700}.infowidget div:last-child{border:0;float:right}.infowidget div span{font-weight:700;display:block;width:100%;text-align:center;font-size:22px}.infowidget div span:last-child{font-weight:400;font-size:12px;color:#b0f7ea}.mapinfo{background-color:#3a3f43}.mapinfo div{border-left:1px solid #4c5157;float:left}.mapinfo div:first-child{display:block;padding-right:10px;padding-left:10px;border:0;float:left}.mapinfo div span:last-child{color:#818b95;font-size:11px}#mapcanvas{border-bottom:6px solid #ee7147;border-radius:5px}ul{padding:0;margin:0}.wprogress p{margin:0 0 5px 0;padding:0}@keyframes proganim{0%{background-color:#464c53}50%{background-color:#4e5560}100%{background-color:#464c53}}.wprogress{animation-name:proganim;animation-duration:1s;animation-iteration-count:infinite;list-style-type:none;padding:10px;margin:0;margin-bottom:10px;border-radius:5px}.wprogress:last-child{margin:0}progress::-moz-progress-bar{background:#ee7147}progress::-webkit-progress-bar{background:#d0d3d2}progress::-webkit-progress-value{background:#ee7147}progress{position:relative;display:inline-block;box-sizing:border-box;width:100%;height:20px;border-radius:5px;background-color:#d0d3d2}.screenhidden{display:none}#menu h1{text-align:center;font-size:9vw;letter-spacing:2vw;color:#989898;margin-top:25vh;margin-bottom:20vh}#menu h1 span{color:#fff}#menu .button{margin-right:5vw;margin-left:5vw;padding-top:20px;padding-bottom:20px;font-size:30px}#menu footer{text-align:center;margin-top:20vh}#messenger header{position:absolute;display:block;background-color:#2b9884;padding:10px;height:30px;font-size:25px;border-radius:5px;border-bottom:5px solid #ee7147;top:10px;right:10px;left:10px}#messenger section{position:absolute;display:block;background-color:#2f3439;padding:5px;border-radius:5px;top:75px;bottom:75px;right:10px;left:10px;overflow-y:scroll}#messenger section ul{position:absolute;bottom:10px;left:10px;right:10px;padding:10px}#messenger section li{list-style-type:none;height:auto;margin-bottom:10px;overflow-y:visible}#messenger section span{display:block;float:left;width:50px;height:50px;margin-right:20px;background-color:#000}#messenger section li p{margin-left:60px;padding:10px;font-size:18px;border-radius:5px;background-color:#484e55}#messenger section li p b{color:#fff}#messenger footer{position:absolute;display:block;height:50px;bottom:15px;left:10px;right:10px;background-color:#3f454b;border-radius:5px}@media screen and (min-width:768px){#messenger section li p{font-size:15px}}#fadeDiv{display:block;visibility:visible;position:absolute;top:0;bottom:0;left:0;right:0;background-color:#0c0b0b;transition:transform .2s ease-out}.fadehid{transform:scaleY(0)}</style><title>ANTHORITY</title><div class=screenhidden id=menu><h1><span>ANT</span>HORITY</h1><a href=javascript:; class=button id=btnPlay>Play</a><footer>ANTHORITY 2017 - by <a href=http://bruno.croci.me>CrociDB</a></footer></div><div class=screenhidden id=messenger><header>Antherous</header><section><ul></ul></section><footer><a href=javascript:; class="button disabled" id=btnContinue>Continue</a></footer></div><div class=screenhidden id=game><section id=header><div><span id=energy>0</span><span>ENERGY</span></div><div><span id=ants>0</span><span>ANTS</span></div><div class=end><span id=defense>100%</span><span>DEFENSE</span></div><div class=right><span id=hour>0</span><span>HOUR</span></div><div class=right-end><span id=day>0</span><span>DAY</span></div></section><div id=columns><div class=column id=left><section id=actions class="widget actions"><a href=javascript:; class=button id=btnScout>Find Food</a> <a href=javascript:; class=button id=btnHatch>Hatch Eggs</a> <a href=javascript:; class=button id=btnBuildRoom>Build Cell</a></section></div><div class=column id=center><section id=map class=widget><div><div class="infowidget mapinfo"><div><span id=avcells>1</span><span>AVAILABLE CELLS</span></div><div><span id=cells>1</span><span>BUILT CELLS</span></div><div><span id=capacity>0</span><span>ANT CAPACITY</span></div></div><canvas height=280 id=mapcanvas width=320></canvas></div></section></div><div class=column id=right><section id=status class="widget widget-clear widget-invisible"><div><ul></ul></div></section></div></div></div><div class="hidden dialog-container" id=dialogDiv></div><div class="hidden dialog" id=dialogWindow><header id=dialogTitle>Message</header><section id=dialogSection><p>Some things happened here.</section><div class=button-container><a href=javascript:dialog.onCancel(); class="button inline-button" id=dialogCancel>Cancel</a> <a href=javascript:dialog.onOk(); class="button inline-button" id=dialogOk>Ok</a></div></div><div class=fadehid id=fadeDiv></div><script>function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){var t,e,i,s,a,n,o,h,l,r,d,c;this._params=new SfxrParams,this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),n=1-t.h*t.h*t.h*.01,o=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,c=5e-5*-t.o),h=1+t.l*t.l*(t.l>0?-.9:10),l=0,r=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(u,g){var m=this._params,p=1!=m.s||m.v,b=m.v*m.v*.1,y=1+3e-4*m.w,v=m.s*m.s*m.s*.1,f=1+1e-4*m.t,w=1!=m.s,k=m.x*m.x,S=m.g,x=m.q||m.r,_=m.r*m.r*m.r*.2,E=m.q*m.q*(m.q<0?-1020:1020),I=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,T=m.d,C=m.j/2,M=m.k*m.k*.01,R=m.a,O=t,A=1/t,D=1/e,L=1/i,U=5/(1+m.u*m.u*20)*(.01+v);U>.8&&(U=.8),U=1-U;for(var H,W,G,P,j,q,z=!1,N=0,B=0,F=0,X=0,Y=0,Q=0,V=0,J=0,K=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<g;et++){if(z)return et;if(I&&++K>=I&&(K=0,this.reset()),r&&++l>=r&&(r=0,s*=h),(s*=n+=o)>a&&(s=a,S>0&&(z=!0)),W=s,C>0&&(Z+=M,W*=1+Math.sin(Z)*C),(W|=0)<8&&(W=8),R||((d+=c)<0?d=0:d>.5&&(d=.5)),++B>O)switch(B=0,++N){case 1:O=e;break;case 2:O=i}switch(N){case 0:F=B*A;break;case 1:F=1+2*(1-B*D)*T;break;case 2:F=1-B*L;break;case 3:F=0,z=!0}x&&((G=0|(E+=_))<0?G=-G:G>1023&&(G=1023)),p&&y&&((b*=y)<1e-5?b=1e-5:b>.1&&(b=.1)),q=0;for(var it=8;it--;){if(++V>=W&&(V%=W,3==R))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(R){case 0:j=V/W<d?.5:-.5;break;case 1:j=1-V/W*2;break;case 2:j=.225*(((j=1.27323954*(P=6.28318531*((P=V/W)>.5?P-1:P))+.405284735*P*P*(P<0?1:-1))<0?-1:1)*j*j-j)+j;break;case 3:j=tt[Math.abs(32*V/W|0)]}p&&(H=Q,(v*=f)<0?v=0:v>.1&&(v=.1),w?(Y+=(j-Q)*v,Y*=U):(Q=j,Y=0),X+=(Q+=Y)-H,j=X*=1-b),x&&($[J%1024]=j,j+=$[(J-G+1024)%1024],J++),q+=j}q*=.125*F*k,u[et]=q>=1?32767:q<=-1?-32768:32767*q|0}return g}}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),s=2*synth.synthWave(new Uint16Array(i.buffer,44),e),a=new Uint32Array(i.buffer,0,44);a[0]=1179011410,a[1]=s+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=s,s+=44;for(var n=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";n<s;n+=3){var l=i[n]<<16|i[n+1]<<8|i[n+2];h+=o[l>>18]+o[l>>12&63]+o[l>>6&63]+o[63&l]}return h};const TIME_SCALE=2,TIME_PACE=30,TIME_INTERVAL=32,ANTS_PER_CELL=18,TEXTS={scoutFound:"<div><p>You sent <b>%1</b> ants to scout a radius of <b>%2m</b> after food:</p><p class=\"msghighlight\">You've found <b>%3</b>. There's about (e) <b>%4</b> energy in this resource.</p><p>How many ants do you wish to send to pick the resource?</p></div>",hatchResults:"<p>You successfully hatched <b>%1</b> eggs!</p>",buildRoomPrompt:"<p>To build another cell in the colony you'll need <b>%1</b> energy and <b>%2</b> ants to complete in about <b>%3</b> days.</p>",hatchEggError:"<p>You don't have enough space in your colony to hatch more eggs.</p>",defaultError:'<p class="msgerror">Ops, you can\'t do that right now.</p>',buildRoomResult:'<p class="msghighlight">You just built another cell in your colony. You can now accomodate <b>%1</b> ants.</p>',infoWidgetEnergy:"<div><span>0</span><span>ENERGY</span></div>",infoWidgetHours:"<div><span>0</span><span>HOURS</span></div>",infoWidgetDays:"<div><span>0</span><span>DAYS</span></div>",infoWidget:'<div class="infowidgettitle">Cost</div>',energyError:'<p class="msgerror">Seems like you don\'t have enough energy for that.</p>',sufferAttack:'<p class="msgerror">Oh! You let your defenses down and suffered an attack!</p>',fetchedResources:"<div><p>Your ants successfully fetched <b>%1</b> energy in the resource.</p>%2</div>",lostAnts:'<p class="msgerror">However, <b>%1</b> ants got lost.</p>'},MESSAGE_INTRO=[["Welcome, <b>My Queen</b>. I'm Antherous, and I'm here to give you another chance.",3],["Ok, I know you might be lost now. But I'll explain...",2],["I don't know how to tell you that, but... you went mad. You led your colony to ashes.",4],["All the ants died a terrible death when the <b>War</b> came, you couldn't protect your own ants.",6],["So I managed to create this virtual interface for you so you can control our colony once again.",5],["You just have to <b>Send Ant Scouts</b> after food, then send some ants to <b>Fetch the Resources</b> found in form of <b>Energy</b>. Focus on <b>Building more Cells</b> on the colony. You'll probably need to <b>Hatch some Eggs</b> to populate your colony.",9],["Please don't let your defenses down, keep always some ants in the colony to protect it in case of an invasion.",5],["Well, I trust you!",4]],MESSAGE_GAMEOVER=[["Oh! I believed you and you failed us again.",4],["I really don't know what to say... I trusted you. I might give you another chance.",3],['<b><a href="http://bruno.croci.me">CrociDB</a></b> thanks you for playing this anyway.',2]],MESSAGE_WIN=[["Oh! I knew I should trust you!",5],["You really saved us, made our colony grow again, but... Erm...",4],["I'm not sure how to tell you that, but...",4],["well...",4],["You're not real. You didn't die. You're just an AI I created, beucase machines are better with management than ants are.",6],["I'll be shutting you down now.",5],['Ah, I forgot: <b><a href="http://bruno.croci.me">CrociDB</a></b> thanks you for playing this anyway.',3]],PLACES=[{d:3,n:"Chewed Gum",e:5},{d:5,n:"Shattered Soda Can",e:10},{d:15,n:"Smashed Candy",e:20},{d:20,n:"Banana Peel",e:22},{d:25,n:"Gummy Bear Head",e:30},{d:30,n:"Candy Cane",e:40},{d:45,n:"Fallen Ice Cream",e:60},{d:70,n:"Piece of Chocolate",e:100}],SOUNDS={message:jsfxr([2,,.09,,.49,.34,,.0525,,,,.28,.29,,,,,,1,,,,,.5]),progress_start:jsfxr([2,.08,.3967,,.52,.3191,,.104,,,,,,.2888,,,,,.7558,,,,,.4]),range_change:jsfxr([3,,.0346,,.1453,.5152,,-.86,-.26,,,-.38,,,,,,,1,,,,,.3]),dialog_open:jsfxr([3,,.0346,,.1453,.5152,,-.86,-.26,,,-.38,,,,,,,1,,,,,.5]),dialog_close:jsfxr([3,,.0346,,.1453,.5152,,-.86,-.26,,,-.84,,,,,,,1,,,,,.5]),fade_out:jsfxr([3,.29,.2779,.4006,.3918,.8028,,-.3415,,,,,,,,,.3766,-.0329,1,,,,,.4]),fade_in:jsfxr([3,.19,.25,.75,.3918,.8028,,-.3415,.48,,,.02,,,,,.3766,-.0329,1,,,,,.4]),warn:jsfxr([0,.08,.14,.31,.44,.854,,,,,,.3732,.5938,,.1999,,,.02,.44,,,,-.02,.2]),attack:jsfxr([3,.1,.18,.4024,.72,.14,,,,,,-.1928,.7063,,,.5103,.0235,-.2935,1,,,,,.5]),action_open:jsfxr([3,.12,.1155,.4985,.08,.0844,,.2071,,,,,,,,,,,.76,,,,,.5]),action_close:jsfxr([3,.12,.1155,.4985,.08,.0844,,.12,,,,,,,,,,,.76,,,,,.5]),built_cell:jsfxr([0,.21,.2491,,.3617,.2314,,.2303,,.47,.1,,,.5499,,,.4599,-.4,1,.02,,,,.4])},MAP_COLUMNS=7,MAP=[[{c:3}],[{c:1,l:[0]},{c:5,l:[0]}],[{c:2,l:[1,2]}]];class GameBalance{constructor(){}time_find_food(t,e){return 1+.5*t.val/Math.max(.3*e.val,.5)}time_get_food(t,e,i){return t*(1.3/e.val)*(i/(5*e.val))}time_hatch_egg(t){return 38+12*t.val}time_build_room(){return 72}energy_find_food(t){return 2*t.val}energy_get_food(t){return 2*t.val}energy_hatch_egg(t){return 4*t.val}value_room_energy(t){return 30+10*(t-1)}value_room_ants(t){return 10+10*(t-1)}evaluateScouts(t,e){let i=t+randnum(t/3)*randsig(),s=PLACES.filter((t=>t.d<=i)),a=randweightsqrd(s,(t=>t.d));return{dist:t,ants:e,source:a,energy:Math.floor(a.e+randnum(.2*a.e)*randsig())}}evaluateResources(t){let e=0;return randnum()<.6&&(e=randint(.6*t.ants)),{dist:t.dist,ants:t.ants-e,lostants:e,source:t.source,energy:t.energy}}evaluateEggs(t){return{ants:t,eggsHatched:t}}}const gId=t=>document.getElementById(t),qSel=t=>document.querySelector(t),qSelA=t=>document.querySelectorAll(t),cEl=t=>{let e=document.createElement("template");return e.innerHTML=t,e.content.firstChild},repltxt=(t,e)=>(e.forEach(((e,i)=>t=t.replace("%"+(i+1),e))),t),fmt=(t,e)=>(e+t).slice(-e.length),clamp=(t,e,i)=>Math.min(Math.max(t,e),i),randnum=(t=1)=>Math.random()*t,randint=t=>Math.round(randnum(t)),randsig=()=>randint(10)%2==0?1:-1,randweight=(t,e)=>{let i=t.map(e).reduce(((t,e)=>t+e)),s=randint(i);return t.filter((t=>(s-=e(t))<=0))[0]},randweightsqrd=(t,e)=>randweight(t,(t=>e(t)*e(t))),co=t=>{let e=t();const i=()=>{let t=e.next();t.done||setTimeout(i,1e3*t.value)};i()},mobi=()=>{var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},audio_player=(()=>{var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e})()?[new Audio]:[new Audio,new Audio];let audio_index=0,AUDIO=!0;const playaudio=t=>{AUDIO&&(audio_index=(audio_index+1)%audio_player.length,audio_player[audio_index].pause(),audio_player[audio_index].src=t,audio_player[audio_index].play())},fadeIn=()=>{gId("fadeDiv").classList.add("fadehid"),playaudio(SOUNDS.fade_in)},fadeOut=()=>{gId("fadeDiv").classList.remove("fadehid"),playaudio(SOUNDS.fade_out)};class TimeSchedule{constructor(){this.schedules=[],this.hour=0,this.day=0,this.time=0,this.cycle=0,this.updateCallbacks=[]}addUpdateCallback(t){this.updateCallbacks.push(t)}removeUpdateCallback(t){this.updateCallbacks.splice(this.updateCallbacks.indexOf(t),1)}update(){this.cycle+=2,this.time=.032*this.cycle*.5,this.hour=Math.floor(this.time%24),this.day=Math.floor(this.time/24),this.cpt=this.time/this.cycle,this.updateCallbacks.forEach((t=>t()))}pause(){clearInterval(this.timeInterval)}play(){this.timeInterval=setInterval(this.update.bind(this),32)}}class Widget{constructor(){}init(){}}class Progress extends Widget{constructor(t,e,i,s){super(),this.scheduler=t,this.label=e,this.time=1|i,this.value=0,this.callback=s,this.init()}getHTML(){return'<li id="wprog%1" class="wprogress"><p>%2</p><progress value="0" max="1000"></progress></li>'.replace("%1",this.index).replace("%2",this.label)}init(t){this.elem=cEl(this.getHTML()),this.container=t,this.prog=this.elem.querySelector("progress"),this.baseTime=this.scheduler.cycle,this.uc=this.update.bind(this),this.scheduler.addUpdateCallback(this.uc),playaudio(SOUNDS.progress_start)}update(){this.value=1e3*(this.scheduler.cycle-this.baseTime)/this.time*this.scheduler.cpt,this.prog.value=this.value,this.value>1e3&&this.destroy()}destroy(){playaudio(SOUNDS.warn),this.scheduler.removeUpdateCallback(this.uc),this.callback&&this.callback(),this.elem.parentNode&&this.elem.parentNode.removeChild(this.elem)}}class InfoWidget extends Widget{constructor(t,e,i){super(),this.scheduler=t,this.timefunc=e,this.energyfunc=i,this.init()}init(){let t=cEl(TEXTS.infoWidgetEnergy),e=cEl(TEXTS.infoWidgetHours),i=cEl(TEXTS.infoWidgetDays),s=cEl(TEXTS.infoWidget);this.value_energy=t.querySelector("span"),this.value_hours=e.querySelector("span"),this.value_days=i.querySelector("span"),this.elem=cEl('<div class="infowidget"></div>'),this.elem.appendChild(s),this.elem.appendChild(e),this.elem.appendChild(i),this.elem.appendChild(t),this.uc=this.update.bind(this),this.scheduler.addUpdateCallback(this.uc)}update(){const t=Math.ceil(this.timefunc()),e=Math.ceil(this.energyfunc());this.value_energy.innerText=e,this.value_days.innerText=Math.floor(t/24),this.value_hours.innerText=Math.floor(t%24)}destroy(){this.scheduler.removeUpdateCallback(this.uc)}}class Range extends Widget{constructor(t,e,i,s){super(),this.min=t,this.max=e,this.val=t,this.step=i,this.label=s,this.init()}getHTML(){return'<div class="range"><h1>%2</h1><div class="range-controls"><a href="javascript:;" class="button inline-button small-button">-</a><span>0</span><a href="javascript:;" class="button inline-button small-button">+</a></div></div>'.replace("%2",this.label)}init(){this.elem=cEl(this.getHTML()),this.valLabel=this.elem.querySelector("span"),this.elem.querySelector(".button:first-child").onclick=this.less.bind(this),this.elem.querySelector(".button:last-child").onclick=this.more.bind(this),this.update()}less(){playaudio(SOUNDS.range_change),this.val=clamp(this.val-this.step,this.min,this.max),this.update()}more(){playaudio(SOUNDS.range_change),this.val=clamp(this.val+this.step,this.min,this.max),this.update()}update(){this.valLabel.innerText=this.val}}let dialog={bg:gId("dialogDiv"),dw:gId("dialogWindow"),title:gId("dialogTitle"),section:gId("dialogSection"),ok:gId("dialogOk"),cancel:gId("dialogCancel"),hide(){this.bg.classList.add("hidden"),this.dw.classList.add("hidden"),this.section.innerHTML="",this.active=!1,playaudio(SOUNDS.dialog_close),setTimeout(this.checkQueue.bind(this),100)},show(){this.bg.classList.remove("hidden"),this.dw.classList.remove("hidden"),this.active=!0,playaudio(SOUNDS.dialog_open)},onOk:null,okCancel:null,checkQueue(){if(this.dialogQueue.length>0){var t=this.dialogQueue.pop();createDialogOk(t.title,t.section,t.okCallback,t.cancel)}},flush(){this.dialogQueue=[]},active:!1,dialogQueue:[]};const showDialogWidget=(t,e,i,s,a=!0,n=!0)=>{let o=[];i.forEach((t=>o.push(t.elem))),a?o.unshift(cEl(e)):o.push(cEl(e)),dialog.active?dialog.dialogQueue.push({title:t,section:o,okCallback:s.bind(null,i),cancel:n}):createDialogOk(t,o,s.bind(null,i),n)},showDialogOk=(t,e,i,s=!0)=>{dialog.active?dialog.dialogQueue.push({title:t,section:e,okCallback:i,cancel:s}):createDialogOk(t,e,i,s)},createDialogOk=(t,e,i,s)=>{dialog.title.innerHTML=t,"string"==typeof e?dialog.section.innerHTML=e:(dialog.section.innerHTML="",e.forEach((t=>dialog.section.appendChild(t)))),s?dialog.cancel.classList.remove("hidden"):dialog.cancel.classList.add("hidden"),dialog.onOk=function(){dialog.hide(),i()},dialog.onCancel=function(){dialog.hide()},dialog.show()};class Map{constructor(){this.ownedRooms=1}init(t,e){this.rawmap=t,this.canvas=gId(e),this.ctx=this.canvas.getContext("2d"),this.importMap(),window.onresize=this.updateSize.bind(this),this.updateSize()}importMap(){let t=0;this.map=[],this.rawmap.forEach(((e,i)=>{e.forEach((e=>{e.id=t++,e.j=i,e.rsize=randnum()*randsig(),e.rx=randnum()*randsig(),e.ry=randnum()*randsig(),this.map.push(e)}))})),this.map[0].own=!0,this.lines=this.rawmap.length}capacity(){return 18*this.ownedRooms}nextcapacity(){return 18*(this.ownedRooms+1)}completed(){return this.ownedRooms==this.map.length}buildRoom(){if(this.ownedRooms<this.map.length){this.ownedRooms++;for(let t=0;t<this.ownedRooms;t++)this.map[t].own=!0;this.updateSize()}}updateSize(){this.width=this.canvas.parentElement.offsetWidth,this.height=this.width/1.33,this.vw=this.width-this.width/5,this.vh=this.height-this.height/5,this.vx=(this.width-this.vw)/2,this.vy=(this.height-this.vh)/2,this.canvas.width=this.width,this.canvas.height=this.height,this.update()}update(){this.clear(),this.drawMap()}drawMap(){let t=this.vw/15;this.ctx.lineWidth=this.vw/20,this.map.forEach((e=>{e.x=e.c*this.vw/7+this.vx+1.3*t+e.rx*(this.vw/20),e.y=e.j*this.vh/this.lines+this.vy+1.3*t+e.ry*(this.vh/20),e.l&&(e.own?this.ctx.strokeStyle="#1D2227":this.ctx.strokeStyle="#4C5157",this.ctx.beginPath(),e.l.forEach((t=>{let i=this.getNode(t);this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(i.x,i.y)})),this.ctx.stroke())})),this.map.forEach((e=>{e.own?this.ctx.fillStyle="#1D2227":this.ctx.fillStyle="#4C5157",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,t+e.rsize*t/10,0,2*Math.PI),this.ctx.fill()}))}getNode(t){return this.map.filter((e=>e.id==t))[0]}clear(){this.ctx.fillStyle="#3A3F43",this.ctx.fillRect(0,0,this.width,this.height)}}class Game{constructor(){this.energy=10,this.ants=this.total_ants=10,this.defense=1,this.alive=!0,this.actionMenu=!0,this.balance=new GameBalance,this.time=new TimeSchedule,this.time.addUpdateCallback(this.timeUpdate.bind(this)),this.initMap(),this.initUI()}initUI(){this.container=gId("game"),this.actionFindFood=gId("btnScout"),this.actionHatchEggs=gId("btnHatch"),this.actionBuildRoom=gId("btnBuildRoom"),this.header=gId("header"),this.labelEnergy=gId("energy"),this.labelAnts=gId("ants"),this.labelDefense=gId("defense"),this.labelHour=gId("hour"),this.labelDay=gId("day"),this.labelAvCells=gId("avcells"),this.labelCells=gId("cells"),this.labelCapacity=gId("capacity"),this.statusContainer=qSel("#status ul"),this.mapContainer=gId("map"),this.actionsContainer=gId("actions"),this.actionFindFood.onclick=this.doFindFood.bind(this),this.actionHatchEggs.onclick=this.doHatchEggs.bind(this),this.actionBuildRoom.onclick=this.doBuildRoom.bind(this),this.mapContainer.onclick=this.toggleActions.bind(this,!0),this.update()}toggleActions(t=!1){this.actionMenu?(this.actionMenu=!1,this.actionsContainer.classList.add("collapse"),t&&window.matchMedia("(max-width: 768px)").matches&&playaudio(SOUNDS.action_close)):(this.actionMenu=!0,this.actionsContainer.classList.remove("collapse"),window.matchMedia("(max-width: 768px)").matches&&playaudio(SOUNDS.action_open))}hide(){this.container.classList.add("screenhidden")}show(){this.container.classList.remove("screenhidden")}addProgress(t){this.statusContainer.appendChild(t.elem)}hasProgress(){return this.statusContainer.childElementCount>0}checkGameStatus(){if(this.defense=this.ants/this.map.capacity(),this.alive){if(this.defense<.1&&randnum()<1-5*this.defense)return void this.sufferAttack();0!=this.energy||this.hasProgress()||dialog.active||this.sufferAttack(),this.map.completed()&&this.winGame()}}update(){this.checkGameStatus(),this.updateUI()}updateUI(){this.labelEnergy.innerText=this.energy,this.labelAnts.innerText=this.ants,this.labelDefense.innerText=Math.ceil(100*this.defense)+"%",this.labelAvCells.innerText=this.map.map.length,this.labelCells.innerText=this.map.ownedRooms,this.labelCapacity.innerText=this.map.capacity(),this.header.classList.remove("hhighlight"),this.header.offsetWidth,this.header.classList.add("hhighlight")}sufferAttack(){this.time.pause(),this.alive=!1,playaudio(SOUNDS.attack),showDialogOk("Defenses Down",TEXTS.sufferAttack,this.gameOver.bind(this))}gameOver(){dialog.flush(),co((function*(){fadeOut(),yield 1.5,game.hide(),messenger.playGameOver(),yield.1,fadeIn()}))}winGame(){dialog.flush(),this.alive=!1,co((function*(){fadeOut(),yield 1.5,game.hide(),messenger.playWinGame(),yield.1,fadeIn()}))}disableButton(t){t.classList.add("disabled")}enableButton(t){t.classList.remove("disabled")}timeUpdate(){var t,e;this.labelHour.innerText=(t=this.time.hour,((e="00")+t).slice(-e.length)),this.labelDay.innerText=this.time.day,this.checkGameStatus()}initMap(){this.map=new Map,this.map.init(MAP,"mapcanvas")}doFindFood(){this.toggleActions();let t=new Range(10,100,5,"Distance"),e=new Range(1,this.ants,1,"Scouts"),i=new InfoWidget(this.time,this.balance.time_find_food.bind(null,t,e),this.balance.energy_find_food.bind(null,e));showDialogWidget("Find Food","<p>Choose how many ants you want to send and the search radius.</p>",[t,e,i],this.sendScouts.bind(this))}doHatchEggs(){this.toggleActions();const t=Math.min(this.ants,this.map.capacity()-this.total_ants);if(t<=0){showDialogOk("Error: Hatch Eggs","<div>"+TEXTS.defaultError+TEXTS.hatchEggError+"</div>",(()=>{}))}else{let e=new Range(1,t,1,"Eggs"),i=new InfoWidget(this.time,this.balance.time_hatch_egg.bind(null,e),this.balance.energy_hatch_egg.bind(null,e));showDialogWidget("Hatch Eggs","<div><p>How many eggs you want to hatch?</p></div>",[e,i],this.hatchEggs.bind(this))}}doBuildRoom(){this.toggleActions();const t=this.balance.value_room_energy(this.map.ownedRooms),e=this.balance.value_room_ants(this.map.ownedRooms),i=Math.floor(this.balance.time_build_room()/24);if(t>this.energy||e>this.ants){const s="<div>"+TEXTS.defaultError+repltxt(TEXTS.buildRoomPrompt,[t,e,i])+"</div>";showDialogOk("Error: Build Cell",s,(()=>{}))}else{let s=new InfoWidget(this.time,this.balance.time_build_room,this.balance.value_room_energy.bind(null,this.map.ownedRooms));showDialogWidget("Build Cell",repltxt(TEXTS.buildRoomPrompt,[t,e,this.balance.time_build_room()]),[s],this.buildRoom.bind(this,t,e,i))}this.update()}sendScouts([t,e,i]){i.destroy();const s=this.balance.energy_find_food(e);if(s>this.energy)showDialogOk("Error",TEXTS.energyError,(()=>{}));else{let i=new Progress(this.time,"Scouts",this.balance.time_find_food(t,e),this.evaluateScouts.bind(this,t.val,e.val));this.addProgress(i),this.energy-=s,this.ants-=e.val,this.update()}this.update()}hatchEggs([t,e]){e.destroy();const i=this.balance.energy_hatch_egg(t);if(i>this.energy)showDialogOk("Error",TEXTS.energyError,(()=>{}));else{let e=new Progress(this.time,"Hatching Eggs",this.balance.time_hatch_egg(t),this.evaluateEggs.bind(this,t.val));this.addProgress(e),this.disableButton(this.actionHatchEggs),this.energy-=i,this.ants-=t.val}this.update()}buildRoom(t,e,i,[s]){s.destroy();let a=new Progress(this.time,"Building a Room",i,this.placeRoom.bind(this,e));this.addProgress(a),this.disableButton(this.actionBuildRoom),this.energy-=t,this.ants-=e,this.update()}play(){this.show(),this.time.play(),this.map.updateSize()}evaluateScouts(t,e){const i=this.balance.evaluateScouts(t,e);this.ants+=i.ants;let s=new Range(1,this.ants,1,"Ants"),a=new InfoWidget(this.time,this.balance.time_get_food.bind(null,i.dist,s,i.energy),this.balance.energy_get_food.bind(null,s));showDialogWidget("Scout Result",repltxt(TEXTS.scoutFound,[i.ants,i.dist,i.source.n,i.energy]),[s,a],this.goGetFood.bind(this,i)),this.update()}evaluateEggs(t){let e=this.balance.evaluateEggs(t);showDialogOk("Hatch Eggs",repltxt(TEXTS.hatchResults,[e.eggsHatched]),(()=>{this.ants+=e.ants+e.eggsHatched,this.total_ants+=e.eggsHatched,this.enableButton(this.actionHatchEggs),this.update()}).bind(this),!1),this.update()}evaluateResources(t){const e=this.balance.evaluateResources(t),i=e.lostants>0?repltxt(TEXTS.lostAnts,[e.lostants]):"";this.energy+=e.energy,showDialogOk("Resource Fetching",repltxt(TEXTS.fetchedResources,[e.energy,i]),(()=>{this.ants+=e.ants,this.total_ants-=e.lostants,this.update()}).bind(this),!1)}placeRoom(t){showDialogOk("Build Room",repltxt(TEXTS.buildRoomResult,[this.map.nextcapacity()]),(()=>{this.map.buildRoom(),this.ants+=t,this.enableButton(this.actionBuildRoom),this.update(),playaudio(SOUNDS.built_cell),this.checkGameStatus()}).bind(this),!1),this.update()}goGetFood(t,[e,i]){i.destroy();const s=this.balance.energy_get_food(e);if(s>this.energy)showDialogOk("Error",TEXTS.energyError,(()=>{}));else{let i=new Progress(this.time,"Fetching Resources",this.balance.time_get_food(t.dist,e,t.energy),this.evaluateResources.bind(this,t));this.addProgress(i),this.energy-=s,this.ants-=t.ants}this.update()}}class Menu{constructor(){this.initUI()}initUI(){this.container=gId("menu"),this.actionPlay=gId("btnPlay"),this.actionPlay.onclick=this.startGame.bind(this)}hide(){this.container.classList.add("screenhidden")}show(){this.container.classList.remove("screenhidden")}play(){this.show()}startGame(){co(function*(){yield.2,fadeOut(),yield 2,this.hide(),messenger.playIntro(),yield.1,fadeIn()}.bind(this))}}class Messenger{constructor(){this.initUI()}initUI(){this.container=gId("messenger"),this.list=qSel("#messenger ul"),this.continue=gId("btnContinue")}hide(){this.container.classList.add("screenhidden")}show(){this.container.classList.remove("screenhidden")}resetList(){this.list.innerHTML="",this.deactivateContinue()}addMessage(t){this.list.appendChild(cEl(repltxt("<li><span></span><p>%1</p></li>",[t]))),this.list.scrollTop=this.list.scrollHeight,playaudio(SOUNDS.message)}activateContinue(t){this.continue.classList.remove("disabled"),this.continue.onclick=t}deactivateContinue(){this.continue.classList.add("disabled"),this.continue.onclick=null}playMessage(t,e){this.resetList(),this.show(),co(function*(){yield 1;for(let[e,i]of t)this.addMessage(e),yield i;this.activateContinue(e),playaudio(SOUNDS.warn)}.bind(this))}playIntro(){this.playMessage(MESSAGE_INTRO,this.startGame.bind(this))}playWinGame(){this.playMessage(MESSAGE_WIN,this.endGame.bind(this))}playGameOver(){this.playMessage(MESSAGE_GAMEOVER,this.endGame.bind(this))}startGame(){co(function*(){yield.2,fadeOut(),yield 1,this.hide(),game.play(),yield.1,fadeIn()}.bind(this))}endGame(){co(function*(){yield.2,fadeOut(),yield 1,window.location.reload()}.bind(this))}}let menu=new Menu,game=new Game,messenger=new Messenger;menu.play(),document.addEventListener("contextmenu",(t=>t.preventDefault()))</script>