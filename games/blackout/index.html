<!doctype html><meta content="width=device-width,minimal-scale=1,maximum-scale=1,user-scalable=no" name=viewport><title>Blackout</title><style>body{background-color:#000}#content{position:relative;margin:0;border:2px solid beige;width:100%;margin:0 auto;background:#2c2c2c}canvas{position:absolute;left:0;top:0}#background{z-index:1}#foreground{z-index:2}#ui{z-index:3}.loading{margin:auto;width:50%;height:50%}#about,#gameover,#ready-screen,#story,.loading{color:#fff;font-family:Helvetica,sans-serif;text-align:center;vertical-align:middle;align-items:center;justify-content:center;font-size:20px;cursor:default}.small-text{font-size:15px}.separator{width:100%;height:100px}</style><div><div id=story><p>Blackout<div class=separator></div><div class=small-text><p>All computation platforms are offline<p>Servant drones gone crazy<p>You are small repair robot and you should fix these platforms<p>Jump on platforms as much as possible, connect them together into new computation cluster<p>Destroy drones - they will pulse shock wave through your new network</div></div><div id=about style=display:none><div class=separator></div><div class=small-text><p>Use left\right arrows or touchcreen to control a repair robot<p>Additional live for hundred connected platforms<p>Jump on drones to destroy them<p>Score = killedDrones + connectedPlatforms</div><div class=separator></div><p class=small-text>Logic: Andrew Avdeev (typescript)<p class=small-text>Assets: Andrew Avdeev (piskelapp)<p class=small-text>Music: Andrew Avdeev (soundbox.js)<p class=small-text>Engine: Kontra.js<div class=separator></div><p class=small-text>Made by Andrew Avdeev for Js13kgames2018 contest</div><div id=ready-screen style=display:none><div class=separator></div><div class=small-text><p>Press any key or touch to start a game</div></div><div id=content style=display:none><canvas id=background></canvas><canvas id=foreground></canvas><canvas id=ui></canvas></div><div id=gameover style=display:none><div class=separator></div><p>GameOver<p>Score: <span id=score>100</span><p>HighScore: <span id=high-score>100</span><div class=separator></div><div class=small-text><p>Use left\right arrows or touchcreen to restart</div></div></div><script>!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=7)}([function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(){}return t.GAME_HEIGHT=640,t.GAME_WIDTH=360,t.GAME_EXTRA_LIVE_FACTOR=100,t.WORLD_FRICTION_FACTOR=.5,t.WORLD_GRAVITY_FACTOR=.5,t.PLAYER_HORIZONTAL_SPEED=3,t.PLAYER_JUMP_SPEED=14,t.PLAYER_POSITION_REFRESH_FACTOR=5,t.PLAYER_BASE_WIDTH=24,t.PLAYER_BASE_HEIGHT=24,t.PLAYER_LIVES=3,t.PLATFORM_LIVE_GAP=1,t.PLATFORM_BASE_WIDTH=38,t.PLATFORM_BASE_HEIGHT=12,t.PLATFORM_POOL_MAX_SIZE=32,t.PLATFORM_POOL_MIN_SIZE=25,t.PLATFORM_POOL_REDUCE_FACTOR=10,t.PLATFORM_AFTERJUMP_SPEED=13,t.PLATFORM_EXPLOSION_PULSE_TIMEOUT=200,t.ENEMY_LIVE_GAP=1,t.ENEMY_BASE_WIDTH=24,t.ENEMY_BASE_HEIGHT=24,t.ENEMY_POOL_MAX_SIZE=20,t.ENEMY_MIN_SPEED=2,t.ENEMY_SPEED=2,t.ENEMY_MAX_SPEED=4,t.ENEMY_MIN_GENERATION_TIMEOUT=500,t.ENEMY_MAX_GENERATION_TIMEOUT=1e3,t.ENEMY_GENERATION_ACCELERATION=2,t}();e.b=n},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(t,e,i,n,o,s,a,r,h,c,u){void 0===u&&(u=1/0),this.game=t,this.x=e,this.y=i,this.dx=n,this.dy=o,this.image=s,this.color=a,this.width=r,this.height=h,this.type=c,this.ttl=u}},function(t,e,i){"use strict";var n,o=i(3),s=i(0),a=i(1),r=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=function(t){function e(e,i,n,o,a,r,h){var c=t.call(this,e,i,n,o,a,e.engine.assets.images.enemy,"red",s.b.ENEMY_BASE_WIDTH,s.b.ENEMY_BASE_WIDTH,"enemy",r)||this;return c.altitude=h,c.onScreen=!0,c}return r(e,t),e.prototype.destroy=function(){this.ttl=0},e.prototype.explode=function(){this.destroy()},e.prototype.update=function(t){this._ca&&this._ca.update(t),this.outOfBorders()||(this.y=this.game.player.altitude-this.altitude+s.b.GAME_HEIGHT/2,0==this.dx&&0==this.dy||(this.x+=this.dx,this.altitude-=this.dy))},e.prototype.outOfBorders=function(){return this.altitude+s.b.GAME_HEIGHT*s.b.ENEMY_LIVE_GAP<=this.game.player.altitude&&(this.onScreen=!1,this.destroy(),!0)},e.prototype.render=function(){this.draw()},e}(a.a);i.d(e,"a",(function(){return c}));var c=function(){function t(){}return t.uuid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},t.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t.random=function(t,e){return Math.floor(Math.random()*e)+t},t.spawnPlatform=function(e,i){void 0===i&&(i=!1);var n=t.random(0,2*s.a.GAME_HEIGHT),a=null,r=t.random(0,s.a.GAME_WIDTH-s.a.PLATFORM_BASE_WIDTH),h=null;i?(a=e.player.altitude+s.a.GAME_HEIGHT/2+n,h=e.player.altitude-a+s.a.GAME_HEIGHT/2):(a=n,h=s.a.GAME_HEIGHT-n);var c=new o.a(e,r,h,0,0,1/0,a);return c.id=t.uuid(),(c=e.engine.sprite(c)).animation="idle",c},t.spawnEnemy=function(e){var i=t.random(0,s.a.GAME_HEIGHT),n=e.player.altitude+s.a.GAME_HEIGHT/2+i,o=t.random(0,s.a.GAME_WIDTH-s.a.ENEMY_BASE_WIDTH),a=e.player.altitude-n+s.a.GAME_HEIGHT/2,r=t.random(1,2*s.a.ENEMY_SPEED),c=new h(e,o,a,0,r,1/0,n);return e.engine.sprite(c)},t.initTouchControl=function(t){t.engine.pointer.onDown((function(e,i){if(e.touches){var n=e.touches[0];e.x=n.clientX,e.y=n.clientY}e.x>s.a.GAME_WIDTH/2?t.player.movingDirection=1:e.x<s.a.GAME_WIDTH/2&&(t.player.movingDirection=-1)})),t.engine.pointer.onUp((function(e,i){return t.player.movingDirection=0}))},t}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n,o=i(1),s=i(0),a=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=function(t){function e(e,i,n,o,a,r,h,c){void 0===c&&(c=!1);var u=t.call(this,e,i,n,o,a,e.engine.assets.images.platform,"orange",s.a.PLATFORM_BASE_WIDTH,s.a.PLATFORM_BASE_HEIGHT,"platform",r)||this;return u.altitude=h,u.isConnectedWithPlayer=c,u.underTension=!1,u.onScreen=!1,u.inConnection=null,u.outConnection=null,u.wasRegenerated=!0,u.connectionWidth=1,u.green=200,u.connectionIncrementFactor=1,u.isUnmovable=!1,u.animation="idle",u.id=null,u}return a(e,t),e.prototype.update=function(t){this._ca&&this._ca.update(t),this.outOfBorders()||(this.y=this.game.player.altitude-this.altitude+s.a.GAME_HEIGHT/2,0!=this.dx||0!=this.dy?(this.x+=this.dx,this.altitude-=this.dy,this.applyFriction(),this.color="brown"):this.underTension?this.color="blue":this.color="red",this.updateConnectionLine())},e.prototype.outOfBorders=function(){return this.altitude+s.a.GAME_HEIGHT*s.a.PLATFORM_LIVE_GAP<=this.game.player.altitude&&!this.isConnectedWithPlayer&&this.id!=this.game.player.lastPlatform.id?(this.onScreen=!1,this.destroy(),!0):(this.game.player.altitude-this.altitude<s.a.GAME_HEIGHT/2?this.onScreen=!0:this.onScreen=!1,!1)},e.prototype.applyFriction=function(){this.dx=this.dx/2,this.dy=this.dy/2,0==Math.round(this.dx)&&(this.dx=0),0==Math.round(this.dy)&&(this.dy=0)},e.prototype.destroy=function(){this.ttl=0},e.prototype.render=function(){switch(this.animation){case"idle":this.game.foreground.context.drawImage(this.image,0,0,s.a.PLATFORM_BASE_WIDTH,s.a.PLATFORM_BASE_HEIGHT,this.x,this.y,s.a.PLATFORM_BASE_WIDTH,s.a.PLATFORM_BASE_HEIGHT);break;case"charged":this.game.foreground.context.drawImage(this.image,0,s.a.PLATFORM_BASE_HEIGHT,s.a.PLATFORM_BASE_WIDTH,s.a.PLATFORM_BASE_HEIGHT,this.x,this.y,s.a.PLATFORM_BASE_WIDTH,s.a.PLATFORM_BASE_HEIGHT)}this.outConnection&&!this.outConnection.wasRegenerated&&(this.game.isExplosionPulseState?this.game.background.context.strokeStyle="red":this.game.background.context.strokeStyle="rgb(0,"+Math.round(this.green/this.connectionWidth)+",0)",this.game.background.context.lineWidth=this.connectionWidth,this.game.background.context.beginPath(),this.game.background.context.moveTo(this.outConnection.x+7,this.outConnection.y+7),this.game.background.context.lineTo(this.x+42,this.y+7),this.game.background.context.stroke())},e.prototype.updateConnectionLine=function(){var t=this;setTimeout((function(){(t.connectionWidth>3||t.connectionWidth<=0)&&(t.connectionIncrementFactor*=-1),t.connectionWidth+=1*t.connectionIncrementFactor}),2e3)},e.prototype.explosionPulse=function(){this.game.explosionPulse()},e}(o.a)},function(t,e,i){"use strict";(function(t,n,o){i.d(e,"a",(function(){return u}));var s=i(0),a=i(3),r=i(5),h=i(2),c=i(6),u=function(){function e(e){this.canvases=e,this.soundsWereInitialized=!1,this.imagesWereInitialized=!1,this.player=null,this.platforms=null,this.enemies=null,this.enemyGenerationTimeout=s.b.ENEMY_MAX_GENERATION_TIMEOUT,this.platfromsQuadtree=null,this.enemiesQuadtree=null,this.information=null,this.loop=null,this.isExplosionPulseState=!1,this.isRunning=!1,this.engine=t,this.background=e.background,this.foreground=e.foreground,this.ui=e.ui,this.cPlayer=new n,this.song=o}return e.prototype.prepare=function(){this.soundPrepare(),this.enginePrepare()},e.prototype.soundPrepare=function(){this.cPlayer.init(this.song);var t=this.cPlayer,e=this;setInterval((function(){if(!e.soundsWereInitialized&&(e.soundsWereInitialized=t.generate()>=1,e.soundsWereInitialized)){var i=t.createWave();e.audio=document.createElement("audio"),e.audio.src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),e.audio.loop=!0}}),0)},e.prototype.enginePrepare=function(){var t=this;this.engine.init(t.foreground.canvas),this.engine.assets.imagePath="assets/images/",this.engine.assets.load("player.png","platform.png","enemy.png").then((function(){return t.imagesWereInitialized=!0}))},e.prototype.init=function(){this.isRunning=!0,this.enemyGenerationTimeout=s.b.ENEMY_MAX_GENERATION_TIMEOUT,this.isExplosionPulseState=!1,this.player=this.engine.sprite(new r.a(this,s.b.GAME_WIDTH/2-10,s.b.GAME_HEIGHT/2-10,0,1,s.b.GAME_HEIGHT/2)),h.a.initTouchControl(this),this.platforms=this.engine.pool({create:this.engine.sprite,maxSize:s.b.PLATFORM_POOL_MAX_SIZE});for(var t=Math.round(s.b.GAME_WIDTH/s.b.PLATFORM_BASE_WIDTH),e=0;e<=t;e++){var i=new a.a(this,e*s.b.PLATFORM_BASE_WIDTH,s.b.GAME_HEIGHT-s.b.PLATFORM_BASE_HEIGHT,0,0,1/0,0);i.isUnmovable=!0,i.id=h.a.uuid(),(i=this.engine.sprite(i)).animation="idle",this.platforms.get(i)}for(e=1;e<=this.platforms.maxSize-t;e++)this.platforms.get(h.a.spawnPlatform(this));this.enemies=this.engine.pool({create:this.engine.sprite,maxSize:s.b.ENEMY_POOL_MAX_SIZE}),this.spawnEnemies(this),this.platfromsQuadtree=this.engine.quadtree(),this.enemiesQuadtree=this.engine.quadtree(),this.information=new c.a(this)},e.prototype.spawnEnemies=function(t){t.isRunning&&(t.enemies.get(h.a.spawnEnemy(t)),t.speedUpEnemyGeneration(),setTimeout((function(){return t.spawnEnemies(t)}),t.enemyGenerationTimeout))},e.prototype.speedUpEnemyGeneration=function(){this.enemyGenerationTimeout>s.b.ENEMY_MIN_GENERATION_TIMEOUT&&(this.enemyGenerationTimeout-=s.b.ENEMY_GENERATION_ACCELERATION)},e.prototype.reducePlatforms=function(){this.platforms.maxSize>s.b.PLATFORM_POOL_MIN_SIZE&&(this.platforms.maxSize-=1)},e.prototype.explosionPulse=function(){var t=this;t.isExplosionPulseState=!0,setTimeout((function(){return t.isExplosionPulseState=!1}),s.b.PLATFORM_EXPLOSION_PULSE_TIMEOUT)},e.prototype.gameOver=function(){this.stop();var t=this;document.getElementById("content").style.display="none",document.getElementById("score").textContent=t.information.score.toString(),document.getElementById("high-score").textContent=t.information.highScore.toString(),document.getElementById("gameover").style.display="block";var e=function(){document.onkeydown=null,document.ontouchstart=null};setTimeout((function(){document.onkeydown=function(i){e();var n=i||window.event;37!=n.keyCode&&39!=n.keyCode||t.restart()},document.ontouchstart=function(i){e(),t.restart()}}),1e3)},e.prototype.restart=function(){this.init(),document.getElementById("gameover").style.display="none",document.getElementById("content").style.display="block",this.start()},e.prototype.start=function(){this.audio.play();var t=this;this.loop=this.engine.gameLoop({update:function(){t.player.update(),t.platforms.update(),t.enemies.update(),t.platfromsQuadtree.clear(),t.platfromsQuadtree.add(t.platforms.getAliveObjects());for(var e=t.platfromsQuadtree.get(t.player),i=!1,n=-1;!i&&++n<e.length;)"platform"===(a=e[n]).type&&a.collidesWith(t.player)&&(t.player.jumpOffPlatform(a),i=!0);t.enemiesQuadtree.clear(),t.enemiesQuadtree.add(t.enemies.getAliveObjects());var o=t.enemiesQuadtree.get(t.player),s=!1;for(n=-1;!s&&++n<o.length;){var a;"enemy"===(a=o[n]).type&&a.collidesWith(t.player)&&(t.player.killEnemy(a),s=!0)}for(o.forEach((function(e){for(var i=t.platfromsQuadtree.get(e),n=!1,o=-1;!n&&++o<i.length;){var s=i[o];"platform"===s.type&&s.underTension&&s.collidesWith(e)&&s.onScreen&&(t.player.kill(),e.explode(),s.explosionPulse(),n=!0,t.player.lives<=0&&t.gameOver())}})),n=0;n<=t.platforms.maxSize-t.platforms.getAliveObjects().length;n++)t.platforms.get(h.a.spawnPlatform(t,!0));t.information.update()},render:function(){t.background.context.save(),t.background.context.clearRect(0,0,s.b.GAME_WIDTH,s.b.GAME_HEIGHT),t.ui.context.save(),t.ui.context.clearRect(0,0,s.b.GAME_WIDTH,s.b.GAME_HEIGHT),t.player.render(),t.platforms.render(),t.enemies.render(),t.information.render(),t.background.context.restore(),t.ui.context.restore()}}),this.loop.start()},e.prototype.stop=function(){this.audio.pause(),this.audio.currentTime=0,this.isRunning=!1,this.loop.stop()},e}()}).call(this,i(10),i(11),i(12))},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n,o=i(1),s=i(0),a=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=function(t){function e(e,i,n,o,a,r){var h=t.call(this,e,i,n,o,a,e.engine.assets.images.player,"black",s.a.PLAYER_BASE_WIDTH,s.a.PLAYER_BASE_HEIGHT,"player")||this;return h.altitude=r,h.movingDirection=0,h.localAltitude=0,h.bottomAltitude=0,h.lastMaxAltitude=0,h.previousMaxAltitude=0,h.connectionWidth=1,h.blue=256,h.connectionIncrementFactor=1,h.jumps=0,h.connectedPlatforms=1,h.lives=0,h.killedEnemies=0,h.isPositionRefreshing=!1,h.lives=s.a.PLAYER_LIVES,h}return a(e,t),e.prototype.update=function(t){this._ca&&this._ca.update(t),this.checkBorders(),this.checkControls(),this.updateMoving(),this.applyForces(),this.calculateAltitudes(),(this.altitude<=0||this.lastMaxAltitude-s.a.GAME_HEIGHT>this.altitude)&&(this.kill(),this.lastPlatform&&this.lives>0?this.refreshPosition():this.game.gameOver())},e.prototype.render=function(){this.draw(),this.lastPlatform&&(this.game.isExplosionPulseState?this.game.background.context.strokeStyle="red":this.game.background.context.strokeStyle="rgb(0, 30,"+Math.round(this.blue/this.connectionWidth)+")",this.game.background.context.lineWidth=this.connectionWidth,this.game.background.context.beginPath(),this.game.background.context.moveTo(this.lastPlatform.x+42,this.lastPlatform.y+7),this.game.background.context.lineTo(this.x+13,this.y+22),this.game.background.context.stroke())},e.prototype.checkBorders=function(){this.x+this.width>this.game.engine.canvas.width&&(this.x=this.game.engine.canvas.width-this.width),this.x<0&&(this.x=0)},e.prototype.checkControls=function(){this.game.engine.keys.pressed("left")||this.movingDirection<0?this.moveLeft():(this.game.engine.keys.pressed("right")||this.movingDirection>0)&&this.moveRight()},e.prototype.updateMoving=function(){this.x+=this.dx,this.altitude+=this.dy,this.dy<=0&&(this.isPositionRefreshing=!1)},e.prototype.moveLeft=function(){this.dx-=s.a.PLAYER_HORIZONTAL_SPEED},e.prototype.moveRight=function(){this.dx+=s.a.PLAYER_HORIZONTAL_SPEED},e.prototype.jump=function(){this.dy=s.a.PLAYER_JUMP_SPEED,this.jumps+=1},e.prototype.applyForces=function(){this.applyGravity(),this.applyFriction()},e.prototype.applyFriction=function(){this.dx=this.dx*s.a.WORLD_FRICTION_FACTOR,0==Math.round(this.dx)&&(this.dx=0)},e.prototype.applyGravity=function(){this.dy-=s.a.WORLD_GRAVITY_FACTOR},e.prototype.calculateAltitudes=function(){this.previousMaxAltitude=this.lastMaxAltitude,this.lastMaxAltitude=this.altitude>this.lastMaxAltitude?this.altitude:this.lastMaxAltitude},e.prototype.jumpOffPlatform=function(t){this.jump(),t.isUnmovable||(t.dy=s.a.PLATFORM_AFTERJUMP_SPEED),t.animation="charged",t.underTension=!0,t.isConnectedWithPlayer=!0,this.preLastPlatform=this.lastPlatform,this.lastPlatform=t,this.lastPlatform.wasRegenerated=!1,this.preLastPlatform&&(this.preLastPlatform.isConnectedWithPlayer=!1,this.preLastPlatform.wasRegenerated=!1,this.preLastPlatform.id!=this.lastPlatform.id&&(this.connectedPlatforms+=1,this.preLastPlatform.animation="charged")),this.lastPlatform.inConnection=this.preLastPlatform,this.preLastPlatform&&(this.preLastPlatform.outConnection=this.lastPlatform)},e.prototype.killEnemy=function(t){this.jump(),this.game.speedUpEnemyGeneration(),this.killedEnemies+=1,t.explode()},e.prototype.kill=function(){this.lives-=1,this.game.explosionPulse()},e.prototype.refreshPosition=function(){var t=this.x,e=this.lastPlatform.x,i=this.altitude,n=this.lastPlatform.altitude;this.dx=(e-t)*s.a.PLAYER_HORIZONTAL_SPEED*2/s.a.GAME_WIDTH,this.dy=(n-i)*s.a.PLAYER_JUMP_SPEED*s.a.PLAYER_POSITION_REFRESH_FACTOR/s.a.GAME_HEIGHT,this.isPositionRefreshing=!0},e}(o.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(0),o=function(){function t(t){this.game=t,this.altitude=0,this.jumps=0,this.connectedPlatforms=0,this.lives=0,this.liveWasLost=!1,this.liveWasGained=!1,this.killedEnemies=0,this.score=0,this.highScore=t.engine.store.get("highScore"),this.highScore||(this.highScore=0)}return t.prototype.update=function(){var t=this;this.altitude=Math.round(this.game.player.lastMaxAltitude),this.jumps=this.game.player.jumps,this.connectedPlatforms=this.game.player.connectedPlatforms?this.game.player.connectedPlatforms:0,this.connectedPlatforms>=n.a.PLATFORM_POOL_REDUCE_FACTOR&&this.connectedPlatforms%n.a.PLATFORM_POOL_REDUCE_FACTOR==0&&(this.game.player.connectedPlatforms++,this.game.reducePlatforms()),this.lives>this.game.player.lives&&(this.liveWasLost=!0,setTimeout((function(){t.liveWasLost=!1}),800)),this.lives<this.game.player.lives&&(this.liveWasGained=!0,setTimeout((function(){t.liveWasGained=!1}),800)),this.lives=this.game.player.lives,this.killedEnemies=this.game.player.killedEnemies?this.game.player.killedEnemies:0,this.score=this.killedEnemies+this.connectedPlatforms,this.score>=n.a.GAME_EXTRA_LIVE_FACTOR&&this.score%n.a.GAME_EXTRA_LIVE_FACTOR==0&&(this.game.player.connectedPlatforms++,this.game.player.lives++),this.highScore<this.score&&(this.highScore=this.score,this.game.engine.store.set("highScore",this.highScore))},t.prototype.render=function(){this.game.ui.context.font="10px Arial",this.game.ui.context.fillStyle="white",this.game.ui.context.textAlign="center",this.liveWasGained&&(this.game.ui.context.font="16px Arial",this.game.ui.context.fillStyle="green"),this.liveWasLost&&(this.game.ui.context.font="16px Arial",this.game.ui.context.fillStyle="red"),this.game.isExplosionPulseState?this.game.ui.context.fillStyle="red":this.game.ui.context.fillStyle="black",this.game.ui.context.fillRect(0,0,n.a.GAME_WIDTH,30),this.game.ui.context.fillStyle="white",this.game.ui.context.fillText("lives: "+this.lives,n.a.GAME_WIDTH/2-n.a.GAME_WIDTH/3,18),this.game.ui.context.font="10px Arial";var t=this.altitude<1e3?this.altitude:Math.round(this.altitude/1e3)+"k";this.game.ui.context.fillText("alt: "+t,n.a.GAME_WIDTH/2-n.a.GAME_WIDTH/5,18),this.game.ui.context.fillText("score: "+this.score,n.a.GAME_WIDTH/2+n.a.GAME_WIDTH/8,18),this.game.ui.context.fillText("high score: "+this.highScore,n.a.GAME_WIDTH/2+n.a.GAME_WIDTH/3,18)},t}()},function(t,e,i){t.exports=i(13)},function(t,e,i){},,function(t,e){kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");if(!e)throw Error("You must provide a canvas element for the game");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){if(!(t=t||{}).update||!t.render)throw Error("You must provide update() and render() functions");let e,i,n,o,s=t.fps||60,a=0,r=1e3/s,h=1/s,c=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function u(){if(i=requestAnimationFrame(u),n=performance.now(),o=n-e,e=n,!(o>1e3)){for(kontra._tick(),a+=o;a>=r;)l.update(h),a-=r;c(),l.render()}}let l={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(u)},stop(){this.isStopped=!0,cancelAnimationFrame(i)},_frame:u,set _last(t){e=t}};return l},function(){let t={},e={},n={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;t<26;t++)n[65+t]=(10+t).toString(36);for(i=0;i<10;i++)n[48+i]=""+i;addEventListener("keydown",(function(i){let o=n[i.which];e[o]=!0,t[o]&&t[o](i)})),addEventListener("keyup",(function(t){e[n[t.which]]=!1})),addEventListener("blur",(function(t){e={}})),kontra.keys={bind(e,i){[].concat(e).map((function(e){t[e]=i}))},unbind(e,i){[].concat(e).map((function(e){t[e]=i}))},pressed:t=>!!e[t]}}(),function(){class t{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=(e,i)=>new t(e,i),kontra.vector.prototype=t.prototype;class e{init(t,e,i,n){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),n=n||i[e];this._ca=n,this.width=n.width,this.height=n.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=t=>(new e).init(t),kontra.sprite.prototype=e.prototype}(),function(){let t,e=/(jpeg|jpg|gif|png)$/,i=/(wav|mp3|ogg|aac)$/,n=/^no$/,o=/^\//,s=/\/$/,a=new Audio,r={wav:"",mp3:a.canPlayType("audio/mpeg;").replace(n,""),ogg:a.canPlayType('audio/ogg; codecs="vorbis"').replace(n,""),aac:a.canPlayType("audio/aac;").replace(n,"")};function h(t,e){return[t.replace(s,""),t?e.replace(o,""):e].filter((t=>t)).join("/")}function c(t){return t.split(".").pop()}function u(t){let e=t.replace("."+c(t),"");return 2==e.split("/").length?e.replace(o,""):e}function l(e,i){return new Promise((function(n,o){let s=new Image;i=h(t.imagePath,e),s.onload=function(){t.images[u(e)]=t.images[i]=this,n(this)},s.onerror=function(){o("Unable to load image "+i)},s.src=i}))}function d(e,i,n){return new Promise((function(o,s){if(e=[].concat(e).reduce((function(t,e){return r[c(e)]?e:t}),n)){let n=new Audio;i=h(t.audioPath,e),n.addEventListener("canplay",(function(){t.audio[u(e)]=t.audio[i]=this,o(this)})),n.onerror=function(){s("Unable to load audio "+i)},n.src=i,n.load()}else s("cannot play any of the audio formats provided"+e)}))}function p(e,i){return i=h(t.dataPath,e),fetch(i).then((function(t){if(!t.ok)throw t;return t.clone().json().catch((function(){return t.text()}))})).then((function(n){return t.data[u(e)]=t.data[i]=n,n}))}t=kontra.assets={images:{},audio:{},data:{},imagePath:"",audioPath:"",dataPath:"",load(){let t,n,o,s,a,r=[];for(s=0;o=arguments[s];s++)a=(n=c(t=[].concat(o)[0])).match(e)?l(o):n.match(i)?d(o):p(o),r.push(a);return Promise.all(r)},_canUse:r}}(),kontra.pool=function(t){let e,i=0;if(!(t=t||{}).create||!(e=t.create())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");return{_c:t.create,objects:[t.create()],size:1,maxSize:t.maxSize||1/0,get(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();e.init(t),this.objects.push(e),i++},getAliveObjects(){return this.objects.slice(this.objects.length-i)},clear(){i=this.objects.length=0,this.size=1,this.objects.push(this._c())},update(t){let e,n=this.size-1,o=Math.max(this.objects.length-i,0);for(;n>=o;)(e=this.objects[n]).update(t),e.isAlive()?n--:(this.objects=this.objects.splice(n,1).concat(this.objects),i--,o++)},render(){let t=Math.max(this.objects.length-i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}},function(){let t,e=[],i=[],n={},o=[],s={},a={0:"left",1:"middle",2:"right"};function r(e){let i=t.x-Math.max(e.x,Math.min(t.x,e.x+e.width)),n=t.y-Math.max(e.y,Math.min(t.y,e.y+e.height));return i*i+n*n<t.radius*t.radius}function h(){let n,o,s=i.length?i:e;for(let e=s.length-1;e>=0;e--)if(o=(n=s[e]).collidesWithPointer?n.collidesWithPointer(t):r(n))return n}function c(t){s[a[t.button]]=!0,l(t,"onDown")}function u(t){s[a[t.button]]=!1,l(t,"onUp")}function l(e,i){if(!kontra.canvas)return;let o,s,a;-1!==e.type.indexOf("mouse")?(o=e.clientX,s=e.clientY):(o=(e.touches[0]||e.changedTouches[0]).clientX,s=(e.touches[0]||e.changedTouches[0]).clientY),t.x=o-kontra.canvas.offsetLeft,t.y=s-kontra.canvas.offsetTop,e.target===kontra.canvas&&(a=h())&&a[i]&&a[i](),n[i]&&n[i](e,a)}addEventListener("mousedown",c),addEventListener("touchstart",c),addEventListener("mouseup",u),addEventListener("touchend",u),addEventListener("blur",(function(t){s={}})),addEventListener("mousemove",(function(t){l(t,"onOver")})),t=kontra.pointer={x:0,y:0,radius:5,track(t){[].concat(t).map((function(t){t._r||(t._r=t.render,t.render=function(){e.push(this),this._r()},o.push(t))}))},untrack(t,e){[].concat(t).map((function(t){t.render=t._r,t._r=e;let i=o.indexOf(t);-1!==i&&o.splice(i,1)}))},over:t=>-1!==o.indexOf(t)&&h()===t,onDown(t){n.onDown=t},onUp(t){n.onUp=t},pressed:t=>!!s[t]},kontra._tick=function(){i.length=0,e.map((function(t){i.push(t)})),e.length=0}}(),kontra.quadtree=function(t){return{maxDepth:(t=t||{}).maxDepth||3,maxObjects:t.maxObjects||25,_b:!1,_d:t.depth||0,_p:t.parent,bounds:t.bounds||{x:0,y:0,width:kontra.canvas.width,height:kontra.canvas.height},objects:[],subnodes:[],clear(){this.subnodes.map((function(t){t.clear()})),this._b=!1,this.objects.length=0},get(t){let e,i,n=[];for(;this.subnodes.length&&this._b;){for(e=this._g(t),i=0;i<e.length;i++)n.push.apply(n,this.subnodes[e[i]].get(t));return n}return this.objects},add(){let t,e,i,n;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this._b)this._a(i);else if(this.objects.push(i),this.objects.length>this.maxObjects&&this._d<this.maxDepth){for(this._s(),t=0;n=this.objects[t];t++)this._a(n);this.objects.length=0}},_a(t,e,i){for(e=this._g(t),i=0;i<e.length;i++)this.subnodes[e[i]].add(t)},_g(t){let e=[],i=this.bounds.x+this.bounds.width/2,n=this.bounds.y+this.bounds.height/2,o=t.y<n&&t.y+t.height>=this.bounds.y,s=t.y+t.height>=n&&t.y<this.bounds.y+this.bounds.height;return t.x<i&&t.x+t.width>=this.bounds.x&&(o&&e.push(0),s&&e.push(2)),t.x+t.width>=i&&t.x<this.bounds.x+this.bounds.width&&(o&&e.push(1),s&&e.push(3)),e},_s(t,e,i){if(this._b=!0,!this.subnodes.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this.subnodes[i]=kontra.quadtree({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},depth:this._d+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parent:this})}}},kontra.store={set(t,e){void 0===e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e))},get(t){let e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(t){}return e}},t.exports=kontra},function(t,e,i){"use strict";t.exports=function(){var t,e,i,n,o,s=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,e,i){var n,o,s,r,c,u,l,d=h[t.i[0]],p=t.i[1],f=t.i[3],m=h[t.i[4]],g=t.i[5],y=t.i[8],E=t.i[9],_=t.i[10]*t.i[10]*4,A=t.i[11]*t.i[11]*4,x=t.i[12]*t.i[12]*4,T=1/x,v=t.i[13],P=i*Math.pow(2,2-t.i[14]),b=new Int32Array(_+A+x),M=0,I=0;for(n=0,o=0;n<_+A+x;n++,o++)o>=0&&(o-=P,u=a(e+(15&(v=v>>8|(255&v)<<4))+t.i[2]-128),l=a(e+(15&v)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,n<_?s=n/_:n>=_+A&&(s-=(n-_-A)*T),r=u,f&&(r*=s*s),c=d(M+=r)*p,r=l,y&&(r*=s*s),c+=m(I+=r)*g,E&&(c+=(2*Math.random()-1)*E),b[n]=80*c*s|0;return b},h=[s,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(s){t=s,e=s.endPattern,i=0,n=s.rowLen*s.patternLen*(e+1)*2,o=new Int32Array(n)},this.generate=function(){var a,c,u,l,d,p,f,m,g,y,E,_,A,x,T=new Int32Array(n),v=t.songData[i],P=t.rowLen,b=t.patternLen,M=0,I=0,O=!1,w=[];for(u=0;u<=e;++u)for(f=v.p[u],l=0;l<b;++l){var H=f?v.c[f-1].f[l]:0;H&&(v.i[H-1]=v.c[f-1].f[l+b]||0,H<16&&(w=[]));var S=h[v.i[15]],G=v.i[16]/512,L=Math.pow(2,v.i[17]-9)/P,R=v.i[18],k=v.i[19],W=43.23529*v.i[20]*3.141592/44100,D=1-v.i[21]/255,j=1e-5*v.i[22],F=v.i[23]/32,N=v.i[24]/512,B=6.283184*Math.pow(2,v.i[25]-9)/P,C=v.i[26]/255,Y=v.i[27]*P&-2;for(E=(u*b+l)*P,d=0;d<4;++d)if(p=f?v.c[f-1].n[l+d*b]:0){w[p]||(w[p]=r(v,p,P));var U=w[p];for(c=0,a=2*E;c<U.length;c++,a+=2)T[a]+=U[c]}for(c=0;c<P;c++)(y=T[m=2*(E+c)])||O?(_=W,R&&(_*=S(L*m)*G+.5),I+=(_=1.5*Math.sin(_))*(A=D*(y-I)-(M+=_*I)),y=3==k?I:1==k?A:M,j&&(y=(y*=j)<1?y>-1?s(.25*y):-1:1,y/=j),O=(y*=F)*y>1e-5,x=y*(1-(g=Math.sin(B*m)*N+.5)),y*=g):x=0,m>=Y&&(x+=T[m-Y+1]*C,y+=T[m-Y]*C),T[m]=0|x,T[m+1]=0|y,o[m]+=0|x,o[m+1]+=0|y}return++i/t.numChannels},this.createWave=function(){var t=44+2*n-8,e=t-36,i=new Uint8Array(44+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,a=44;s<n;++s){var r=o[s];r=r<-32767?-32767:r>32767?32767:r,i[a++]=255&r,i[a++]=r>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),n=new Array(e),s=0;s<2*e;s+=1){var a=i+s;n[s]=t>0&&a<o.length?o[a]/32768:0}return n}}},function(t,e){t.exports={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1,2,1,2,6,6,6,2],c:[{n:[144,,,,151,,,,146,,,,139],f:[]},{n:[132,,,,139,,,,134,,,,127],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[120,,,,127,,,,132,,,,139,,,,144,,,,118,,,,122,,,,,,,,127,,,,130,,,,139,,,,142,,,,151,,,,125,,,,130,,,,,,,,,,144,,,,144,,,,147,,,,152,,,,147,,,,152,,,,139,,,,144],f:[]}]},{i:[0,204,104,1,0,80,99,0,0,0,4,0,66,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[,3,,3,,3,,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[144,142,139,140,144,142,139,144,,,,,144,144,,,144,144,,,,,,,146,146,,,144,144],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[4,,,,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[144],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],p:[,,5,,,,5,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[144,,151,,,,,,147,,146,,,,,,139,,137,,135,,134,,132,,130,,128,,,127,151,,154,,,,,,127,,130],f:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],p:[,,,7,7,7],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[144,,144,,,,,,,,139,,144,,144,,,,,,,,139,,144,,144,,,,139,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,156],f:[]}]},{i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],p:[2,,,,,2,,2],c:[{n:[],f:[]},{n:[,,,,,,,,132,,,,,,,,,,,,139,,135,,,,132,,132],f:[]}]}],rowLen:5513,patternLen:32,endPattern:7,numChannels:6}},function(t,e,i){"use strict";i.r(e);var n=i(0),o=(i(8),i(4)),s=function(t,e){this.canvas=t,this.context=e};window.onload=function(){var t=window.innerWidth/n.b.GAME_WIDTH,e=window.innerHeight/n.b.GAME_HEIGHT,i=t<=e?t:e;i<1&&(n.b.GAME_WIDTH*=i,n.b.GAME_HEIGHT*=i);var a=new Array;["background","foreground","ui"].forEach((function(t){var e=document.getElementById(t);e.width=n.b.GAME_WIDTH,e.height=n.b.GAME_HEIGHT,e.style.width=n.b.GAME_WIDTH*i+"px",e.style.height=n.b.GAME_HEIGHT*i+"px",a[t]=new s(e,e.getContext("2d"))}));var r=document.getElementById("content");r.style.width=n.b.GAME_WIDTH*i+"px",r.style.height=n.b.GAME_HEIGHT*i+"px";var h=new o.a(a);window.game=h,h.prepare();var c=function(){h.soundsWereInitialized&&h.imagesWereInitialized?(document.getElementById("ready-screen").style.display="none",document.getElementById("content").style.display="block",h.init(),h.start()):setTimeout(c,100)};setTimeout((function(){document.getElementById("story").style.display="none",document.getElementById("about").style.display="block",setTimeout((function(){document.getElementById("about").style.display="none",document.getElementById("ready-screen").style.display="block";var t=function(){document.onkeydown=null,document.ontouchstart=null};document.onkeydown=function(e){t(),c()},document.ontouchstart=function(e){t(),c()}}),3e3)}),3e3)}}])</script>