<!doctype html><meta content="width=device-width" name=viewport><title>Shadow Prowler</title><style>body{background-color:#1a1a1a;color:#eee;font-family:'Courier New',Courier,monospace;text-align:center;margin:0;padding:20px}#game-container{display:inline-flex;align-items:flex-start;gap:20px}canvas{background-color:#333;border:2px solid #555;border-radius:8px}#ui{width:200px;text-align:left;font-size:1.2em}.instructions{margin-top:20px;font-size:.9em;color:#aaa}#message{font-weight:700;height:30px;color:#fc0}</style><h1>Shadow Prowler</h1><div id=game-container><canvas id=gameCanvas></canvas><div id=ui><div id=message></div><div>Time: <span id=timer>60</span>s</div><div>Fish: <span id=fish-count>0</span></div><div class=instructions>Use <b>Arrow Keys</b> or <b>WASD</b> to move.<br>Stay in the shadows to avoid dogs!</div></div></div><script type=module>import{WebSocket}from"/2025/online/partysocket.js";const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),TILE_SIZE=40,COLS=15,ROWS=12;canvas.width=COLS*TILE_SIZE,canvas.height=ROWS*TILE_SIZE;const timerEl=document.getElementById("timer"),fishCountEl=document.getElementById("fish-count"),messageEl=document.getElementById("message");let player,level,dogs,fish,otherPlayers,timeLeft,timerInterval,gameState,ws;const myId=Math.random().toString(36).substr(2,9);function setupLevel(){gameState="playing",messageEl.textContent="",timeLeft=60,otherPlayers=new Map,level=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,2,2,2,0,0,0,1,0,0,0,1],[1,0,1,2,2,1,2,1,1,0,1,0,1,0,1],[1,0,1,2,2,1,2,1,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,1,1,0,0,0,1],[1,2,2,1,0,1,1,1,0,1,2,2,1,0,1],[1,2,2,1,0,1,0,0,0,1,2,2,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,1,0,1,2,1],[1,0,0,0,0,1,0,0,0,0,0,0,1,2,1],[1,2,2,2,0,0,0,1,0,0,1,0,0,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],player={x:1,y:1,hidden:!1},fish=[{x:13,y:1},{x:1,y:10},{x:8,y:4}],dogs=[{x:7,y:2,path:[{x:7,y:2},{x:7,y:5}],target:1,speed:.03},{x:2,y:8,path:[{x:2,y:8},{x:10,y:8}],target:1,speed:.05}],timerInterval&&clearInterval(timerInterval),timerInterval=setInterval((()=>{timeLeft--,timeLeft<=0&&gameOver("Time is up!")}),1e3),updateUI(),connectWebSocket()}function update(){"playing"===gameState&&(moveDogs(),checkCollisions(),updateUI())}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let e=0;e<ROWS;e++)for(let t=0;t<COLS;t++){const a=level[e][t];ctx.fillStyle=1===a?"#4a4a4a":2===a?"#2a2a2a":"#383838",ctx.fillRect(t*TILE_SIZE,e*TILE_SIZE,TILE_SIZE,TILE_SIZE)}ctx.fillStyle="#ff8c00",fish.forEach((e=>{ctx.beginPath(),ctx.arc(e.x*TILE_SIZE+TILE_SIZE/2,e.y*TILE_SIZE+TILE_SIZE/2,TILE_SIZE/4,0,2*Math.PI),ctx.fill()})),dogs.forEach((e=>{ctx.fillStyle="#8B4513",ctx.fillRect(e.x*TILE_SIZE+5,e.y*TILE_SIZE+5,TILE_SIZE-10,TILE_SIZE-10),ctx.fillStyle="rgba(255, 255, 0, 0.3)",ctx.beginPath();const t=e.x*TILE_SIZE+TILE_SIZE/2,a=e.y*TILE_SIZE+TILE_SIZE/2,o=Math.sign(e.path[e.target].x-e.x)||Math.sign(e.path[e.target].y-e.y);e.path[e.target].x!==e.path[0].x?(ctx.moveTo(t,a),ctx.lineTo(t+3*o*TILE_SIZE,a-1.5*TILE_SIZE),ctx.lineTo(t+3*o*TILE_SIZE,a+1.5*TILE_SIZE)):(ctx.moveTo(t,a),ctx.lineTo(t-1.5*TILE_SIZE,a+3*o*TILE_SIZE),ctx.lineTo(t+1.5*TILE_SIZE,a+3*o*TILE_SIZE)),ctx.closePath(),ctx.fill()})),ctx.globalAlpha=.5,ctx.fillStyle="#aaa",otherPlayers.forEach((e=>{ctx.beginPath(),ctx.arc(e.x*TILE_SIZE+TILE_SIZE/2,e.y*TILE_SIZE+TILE_SIZE/2,TILE_SIZE/2-5,0,2*Math.PI),ctx.fill()})),ctx.globalAlpha=1,ctx.fillStyle=player.hidden?"#444":"#000",ctx.beginPath(),ctx.arc(player.x*TILE_SIZE+TILE_SIZE/2,player.y*TILE_SIZE+TILE_SIZE/2,TILE_SIZE/2-5,0,2*Math.PI),ctx.fill();const e=player.x*TILE_SIZE+TILE_SIZE/2,t=player.y*TILE_SIZE+TILE_SIZE/2-(TILE_SIZE/2-5);ctx.beginPath(),ctx.moveTo(e-7,t),ctx.lineTo(e-2,t-5),ctx.lineTo(e-5,t+2),ctx.moveTo(e+7,t),ctx.lineTo(e+2,t-5),ctx.lineTo(e+5,t+2),ctx.fill()}function moveDogs(){dogs.forEach((e=>{const t=e.path[e.target];Math.abs(e.x-t.x)<.1&&Math.abs(e.y-t.y)<.1&&(e.target=1-e.target);const a=e.path[e.target];e.x+=Math.sign(a.x-e.x)*e.speed,e.y+=Math.sign(a.y-e.y)*e.speed}))}function checkCollisions(){player.hidden=2===level[player.y][player.x];const e=fish.findIndex((e=>e.x===player.x&&e.y===player.y));-1!==e&&(fish.splice(e,1),0===fish.length&&gameOver("You got all the fish!")),player.hidden||dogs.forEach((e=>{Math.floor(e.x)===player.x&&Math.floor(e.y)===player.y&&gameOver("Caught by a dog!");const t=player.x-Math.floor(e.x),a=player.y-Math.floor(e.y),o=Math.sign(e.path[e.target].x-e.x)||Math.sign(e.path[e.target].y-e.y);e.path[e.target].y===e.path[0].y&&Math.sign(t)===o&&Math.abs(t)<3&&Math.abs(a)<=1&&gameOver("Spotted!"),e.path[e.target].x===e.path[0].x&&Math.sign(a)===o&&Math.abs(a)<3&&Math.abs(t)<=1&&gameOver("Spotted!")}))}function updateUI(){timerEl.textContent=timeLeft,fishCountEl.textContent=3-fish.length+"/3"}function gameOver(e){"playing"===gameState&&(gameState="over",clearInterval(timerInterval),messageEl.textContent=`${e} Press R to restart.`)}function gameLoop(){update(),draw(),requestAnimationFrame(gameLoop)}function connectWebSocket(){ws=new WebSocket("wss://relay.js13kgames.com/shadow-prowler"),ws.onopen=sendPosition,ws.onmessage=e=>{try{const t=JSON.parse(e.data);t.id!==myId&&otherPlayers.set(t.id,{x:t.x,y:t.y})}catch(e){}}}function sendPosition(){ws&&ws.readyState===WebSocket.OPEN&&ws.send(JSON.stringify({id:myId,x:player.x,y:player.y}))}window.addEventListener("keydown",(e=>{if("playing"!==gameState)return void("r"===e.key.toLowerCase()&&setupLevel());let t=player.x,a=player.y;"ArrowUp"!==e.key&&"w"!==e.key.toLowerCase()||a--,"ArrowDown"!==e.key&&"s"!==e.key.toLowerCase()||a++,"ArrowLeft"!==e.key&&"a"!==e.key.toLowerCase()||t--,"ArrowRight"!==e.key&&"d"!==e.key.toLowerCase()||t++,1!==level[a][t]&&(player.x=t,player.y=a,sendPosition())})),setupLevel(),gameLoop()</script>