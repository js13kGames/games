<!doctype html><title>Snooffline</title><meta name=viewport content="width=device-width,minimum-scale=1"><script>!function(){function t(){this.switch=0,this.buildings={color:"#4744FF",count:35,heights:[]},this.lineColor="#9B30FF"}t.prototype.init=function(t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=t.canvas.width,this.canvas.height=t.canvas.height;for(var e=0;e<this.buildings.count;++e)this.buildings.heights.push(15+90*Math.random());this.renderStatic(t)},t.prototype.renderStatic=function(t){this.ctx.shadowBlur=10,this.ctx.shadowColor="white",this.drawBackground(t),this.drawCity(t),this.drawRoad(t)},t.prototype.render=function(t){t.ctx.drawImage(this.canvas,0,0),this.drawRoadLines(t),this.drawScore(t)},t.prototype.drawBackground=function(t){var e=t.geometry.environment;this.ctx.fillStyle="black",this.ctx.fillRect(0,0,e.width,e.height)},t.prototype.drawCity=function(t){this.ctx.strokeStyle=this.buildings.color;for(var e=0;e<this.buildings.count;++e)this.drawBuilding(t,30*e-5,this.buildings.heights[e],30),this.drawBuilding(t,33*e+5,this.buildings.heights[e]+10,30)},t.prototype.drawScore=function(t){this.ctx.shadowBlur=0,t.ctx.fillStyle=this.lineColor,t.ctx.font="22px monospace",t.ctx.textBaseline="middle",t.ctx.textAlign="center",t.ctx.fillText("-snooffline-",this.canvas.width/2,30),t.ctx.font="14px monospace",t.ctx.fillText("Total snooffed: "+(~~t.player.totalScore).toFixed(2)+"mg",this.canvas.width/2,60),t.ctx.fillText((25e-5*~~t.player.score).toFixed(2)+" mg/L",this.canvas.width/2,80);for(var e=1;e<t.config.scoreIncrementFactor;e++)t.ctx.drawImage(t.cache.heroin,this.canvas.width-25-25*e,this.canvas.height-50,40,40);var i=t.player.score/5;t.ctx.strokeStyle=this.lineColor,t.ctx.strokeRect(this.canvas.width/2-200,100,400,15),t.ctx.fillStyle="white",t.ctx.fillRect(this.canvas.width/2-200,100,i,15)},t.prototype.drawPause=function(t){t.ctx.fillStyle="black",t.ctx.fillRect(0,10,this.canvas.width,30),t.ctx.fillStyle=this.lineColor,t.ctx.font="22px monospace",t.ctx.fillText("-paused-press-P-to-continue-",this.canvas.width/2,30)},t.prototype.drawOverdose=function(t){t.ctx.fillStyle="black",t.ctx.fillRect(0,10,this.canvas.width,30),t.ctx.fillStyle=this.lineColor,t.ctx.font="22px monospace",t.ctx.fillText("-overdosed-press-R-to-restart-",this.canvas.width/2,30)},t.prototype.drawUnderdose=function(t){t.ctx.fillStyle="black",t.ctx.fillRect(0,10,this.canvas.width,30),t.ctx.fillStyle=this.lineColor,t.ctx.font="22px monospace",t.ctx.fillText("-depression-kicked-in-press-R-to-restart-",this.canvas.width/2,30)},t.prototype.drawBuilding=function(t,e,i,o){var n=t.geometry.environment,r=[e,n.horizontAtY,e,n.horizontAtY-i,e+o,n.horizontAtY-i,e+o,n.horizontAtY];for(this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]),item=2;item<r.length-1;item+=2)this.ctx.lineTo(r[item],r[item+1]);this.ctx.stroke()},t.prototype.drawRoad=function(t){var e=t.geometry.environment,i=this.ctx;i.shadowBlur=10,i.shadowColor="white",i.strokeStyle=this.lineColor,i.beginPath(),i.moveTo(0,t.canvas.height),i.lineTo(e.horizontLeft.x,e.horizontLeft.y);for(var o=0;o<63;++o){var n=o*(e.width/63),r=pointAtY(e.focalPoint,{x:n,y:e.horizontAtY},t.canvas.height).x;r=r<0?0:r>t.canvas.width?t.canvas.width:r,i.moveTo(n,e.horizontAtY),i.lineTo(r,pointAtX(e.focalPoint,{x:n,y:e.horizontAtY},r).y)}i.moveTo(t.canvas.width,t.canvas.height),i.lineTo(e.horizontRight.x,e.horizontRight.y),i.moveTo(0,e.horizontAtY),i.lineTo(t.canvas.width,e.horizontAtY),i.stroke()},t.prototype.drawRoadLines=function(t){t.ctx.save();var e=t.geometry.environment,i=t.time.now%20;t.ctx.shadowBlur=10,t.ctx.shadowColor="white",t.ctx.strokeStyle=this.lineColor,t.ctx.beginPath();for(var o=0;o<20;++o){var n=e.horizontAtY+20*o+i,r=pointAtY(e.focalPoint,e.bottomLeft,n),s=pointAtY(e.focalPoint,e.bottomRight,n);t.ctx.moveTo(r.x,r.y),t.ctx.lineTo(s.x,s.y)}t.ctx.stroke(),t.ctx.restore()},window.Environment=t,function(t,e,i){function o(t){t&&(t.setTargetAtTime||(t.setTargetAtTime=t.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),AudioContext.prototype.hasOwnProperty("createPeriodicWave")||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var t=this.internal_createGain();return o(t.gain),t},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(t){var e=t?this.internal_createDelay(t):this.internal_createDelay();return o(e.delayTime),e},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var t=this.internal_createBufferSource();return t.start?(t.internal_start=t.start,t.start=function(e,i,o){void 0!==o?t.internal_start(e||0,i,o):t.internal_start(e||0,i||0)}):t.start=function(t,e,i){e||i?this.noteGrainOn(t||0,e,i):this.noteOn(t||0)},t.stop?(t.internal_stop=t.stop,t.stop=function(e){t.internal_stop(e||0)}):t.stop=function(t){this.noteOff(t||0)},o(t.playbackRate),t},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var t=this.internal_createDynamicsCompressor();return o(t.threshold),o(t.knee),o(t.ratio),o(t.reduction),o(t.attack),o(t.release),t},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var t=this.internal_createBiquadFilter();return o(t.frequency),o(t.detune),o(t.Q),o(t.gain),t},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var t=this.internal_createOscillator();return t.start?(t.internal_start=t.start,t.start=function(e){t.internal_start(e||0)}):t.start=function(t){this.noteOn(t||0)},t.stop?(t.internal_stop=t.stop,t.stop=function(e){t.internal_stop(e||0)}):t.stop=function(t){this.noteOff(t||0)},t.setPeriodicWave||(t.setPeriodicWave=t.setWaveTable),o(t.frequency),o(t.detune),t})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext)}(window);var e=new AudioContext;function i(){var t=this;this.pressed={},this.isDown=function(e){return t.controls.pressed[e]},this.onKeydown=function(e){t.pressed[e.keyCode]=!0},this.onKeyup=function(e){delete t.pressed[e.keyCode]}}function o(){this.x=null,this.y=null,this.velocityY=0,this.velocityX=0,this.acceleration=1,this.radius=5,this.score=1e3,this.totalScore=0,this.didJump=!1}function n(t){var e=this;this.items={cocaine:[],decorations:[],bonus:[]},this.updates={cocaine:function(t){return e.updateCocaine(t,"cocaine")},decorations:function(t){return e.updateDecorations(t,"decorations")},bonus:function(t){return e.updateBonus(t,"bonus")}},this.spawn={direction:-1,interval:20,changeInterval:300,lastPosition:void 0,edgeOffset:20},this.spawnIntervalHandler=null,this.changeIntervalHandler=null,this.environmentIntervalHandler=null,this.bonusIntervalHandler=null,this.decoration={interval:1e3,initialX_left:300,initialX_right:500,switch:-1},this.bonus={interval:3e4}}function r(t,e,i){this.x=t,this.y=e,this.startPosX=t,this.startPosY=e,this.width=10,this.height=10,this.radius=10,this.speed=.1,this.previous=i}function s(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.x=t,this.y=e,this.startPosX=t,this.startPosY=e,this.width=200,this.height=200,this.radius=50,this.speed=.1,this.color="#4744FF",this.images=["girl1","cards","dice"],this.image=i||this.images[Math.floor(Math.random()*this.images.length)]}function a(){}function c(){this.restarting=!1,this.cache={},this.assetLoading=Promise.all([this.addToCache("girl1","./girl.svg"),this.addToCache("player","./player.svg"),this.addToCache("cards","./cards.svg"),this.addToCache("dice","./dice.svg"),this.addToCache("heroin","./heroin.svg")])}window.soundEffect=function(t,i,o,n,r,s,a,c,h,d,u,l,p,y){var f,v,m,w,g,x;function P(t){t.gain.value=0,t.gain.linearRampToValueAtTime(0,e.currentTime+a),t.gain.linearRampToValueAtTime(r,e.currentTime+a+i)}function C(t){t.gain.linearRampToValueAtTime(r,e.currentTime+i+a),t.gain.linearRampToValueAtTime(0,e.currentTime+a+i+o)}function A(t){var n=t.frequency.value;h?(t.frequency.linearRampToValueAtTime(n,e.currentTime+a),t.frequency.linearRampToValueAtTime(n+c,e.currentTime+a+i+o)):(t.frequency.linearRampToValueAtTime(n,e.currentTime+a),t.frequency.linearRampToValueAtTime(n-c,e.currentTime+a+i+o))}function T(t){t.start(e.currentTime+a),t.stop(e.currentTime+a+1)}void 0===t&&(t=200),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n="sine"),void 0===r&&(r=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===h&&(h=!1),void 0===d&&(d=0),void 0===u&&(u=0),void 0===l&&(l=void 0),void 0===p&&(p=void 0),void 0===y&&(y=void 0),f=e.createOscillator(),v=e.createGain(),m=e.createStereoPanner?e.createStereoPanner():e.createPanner(),f.connect(v),v.connect(m),m.connect(e.destination),v.gain.value=r,e.createStereoPanner?m.pan.value=s:m.setPosition(s,0,1-Math.abs(s)),f.type=n,d>0?(g=t-d/2,x=t+d/2,w=Math.floor(Math.random()*(x-g+1))+g):w=t,f.frequency.value=w,i>0&&P(v),C(v),c>0&&A(f),u>0&&function(){var t=e.createOscillator(),n=e.createOscillator(),s=e.createGain(),a=e.createGain();s.gain.value=r,a.gain.value=r,t.connect(s),s.connect(e.destination),n.connect(a),a.connect(e.destination),t.type="sawtooth",n.type="sawtooth",t.frequency.value=w+u,n.frequency.value=w-u,i>0&&(P(s),P(a)),o>0&&(C(s),C(a)),c>0&&(A(t),A(n)),l&&(addEcho(s),addEcho(a)),p&&(addReverb(s),addReverb(a)),T(t),T(n)}(),T(f)},window.midiTable=[8.1757989156,8.661957218,9.1770239974,9.7227182413,10.3008611535,10.9133822323,11.5623257097,12.2498573744,12.9782717994,13.75,14.5676175474,15.4338531643,16.3515978313,17.3239144361,18.3540479948,19.4454364826,20.6017223071,21.8267644646,23.1246514195,24.4997147489,25.9565435987,27.5,29.1352350949,30.8677063285,32.7031956626,34.6478288721,36.7080959897,38.8908729653,41.2034446141,43.6535289291,46.249302839,48.9994294977,51.9130871975,55,58.2704701898,61.735412657,65.4063913251,69.2956577442,73.4161919794,77.7817459305,82.4068892282,87.3070578583,92.4986056779,97.9988589954,103.826174395,110,116.5409403795,123.470825314,130.8127826503,138.5913154884,146.8323839587,155.563491861,164.8137784564,174.6141157165,184.9972113558,195.9977179909,207.65234879,220,233.081880759,246.9416506281,261.6255653006,277.1826309769,293.6647679174,311.1269837221,329.6275569129,349.228231433,369.9944227116,391.9954359817,415.3046975799,440,466.1637615181,493.8833012561,523.2511306012,554.3652619537,587.3295358348,622.2539674442,659.2551138257,698.456462866,739.9888454233,783.9908719635,830.6093951599,880,932.3275230362,987.7666025122,1046.5022612024,1108.7305239075,1174.6590716696,1244.5079348883,1318.5102276515,1396.912925732,1479.9776908465,1567.981743927,1661.2187903198,1760,1864.6550460724,1975.5332050245,2093.0045224048,2217.461047815,2349.3181433393,2489.0158697766,2637.020455303,2793.825851464,2959.9553816931,3135.963487854,3322.4375806396,3520,3729.3100921447,3951.066410049,4186.0090448096,4434.92209563,4698.6362866785,4978.0317395533,5274.0409106059,5587.6517029281,5919.9107633862,6271.926975708,6644.8751612791,7040,7458.6201842894,7902.132820098,8372.0180896192,8869.8441912599,9397.272573357,9956.0634791066,10548.0818212118,11175.3034058561,11839.8215267723,12543.853951416],window.ENUMS={SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,PAUSE:19,P:80,RESTART:82},window.collision=function(t,e){var i=t.x-e.x,o=t.y-e.y,n=t.radius+e.radius;return i*i+o*o<=n*n},window.pointAtY=function(t,e,i){if(t.x-e.x==0)return{x:t.x,y:i};var o=(t.y-e.y)/(t.x-e.x);return{x:(i-(t.y-o*t.x))/o,y:i}},window.pointAtX=function(t,e,i){var o=(t.y-e.y)/(t.x-e.x);return{x:i,y:i*o+(t.y-o*t.x)}},window.drawCocaine=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=6,e.height=3;var o=i.createImageData(e.width,e.height);return setPixel(o,2,0,255,255,255,255),setPixel(o,3,0,255,255,255,255),setPixel(o,1,1,255,255,255,255),setPixel(o,2,1,255,255,255,255),setPixel(o,3,1,255,255,255,255),setPixel(o,4,1,255,255,255,255),setPixel(o,0,2,255,255,255,255),setPixel(o,1,2,255,255,255,255),setPixel(o,2,2,255,255,255,255),setPixel(o,3,2,255,255,255,255),setPixel(o,4,2,255,255,255,255),setPixel(o,5,2,255,255,255,255),i.putImageData(o,0,0),e},i.prototype.init=function(t){var e=this;window.addEventListener("keyup",(function(t){t.keyCode!==ENUMS.PAUSE&&t.keyCode!==ENUMS.P?t.keyCode!==ENUMS.RESTART?e.onKeyup(t):e.handleGameRestart():e.handleGamePause()}),!1),window.addEventListener("keydown",(function(t){e.onKeydown(t)}),!1),this.handleGamePause=function(e){t.paused?t.sound.startMusic():t.sound.stopMusic(),t.paused=!t.paused},this.handleGameRestart=function(e){t.restartGame()}},window.Controls=i,o.prototype.init=function(t){this.y=t.geometry.player.y,this.x=t.geometry.player.x,this.radius=t.geometry.player.radius},o.prototype.render=function(t){var e=t.geometry.player;t.ctx.drawImage(t.cache.player,~~(this.x-5),~~(this.y-e.height+5),e.width,e.height)},o.prototype.incrementScore=function(t){this.didJump||(this.score+=t.config.scoreIncrementFactor,this.totalScore++),this.score>=t.config.scoreLimit&&t.hasOverdosed()},o.prototype.decrementScore=function(t){this.score-=1.5*t.config.scoreDecrementFactor,this.score<=0&&t.hasUnderdosed()},o.prototype.bonusPickup=function(t){t.config.scoreIncrementFactor+=1,t.config.scoreDecrementFactor+=.5},o.prototype.update=function(t){!this.didJump&&t.controls.pressed[ENUMS.SPACE]&&(this.jump(t.config.jumpImpulse),t.sound.playSound(t.sound.sounds.JUMP)),t.controls.pressed[ENUMS.RIGHT]&&("right"!==this.direction&&(this.velocityX=0,this.direction="right"),this.velocityX+=this.acceleration),t.controls.pressed[ENUMS.LEFT]&&("left"!==this.direction&&(this.velocityX=0,this.direction="left"),this.velocityX-=this.acceleration),this.y<t.config.groundPoint?(this.y-=t.config.gravity*t.time.delta,this.velocityY+=t.config.gravity*t.time.delta):(this.y=t.config.groundPoint,this.didJump=!1),(this.velocityX>0||this.velocityX<0)&&(this.velocityX+=t.config.friction*("right"===this.direction?-1:1)),this.x<t.config.leftBorder&&(this.x=t.config.leftBorder,this.velocityX=0),this.x>t.config.rightBorder&&(this.x=t.config.rightBorder,this.velocityX=0),this.x+=this.velocityX,this.y+=this.velocityY},o.prototype.jump=function(t){this.didJump=!0,this.velocityY=-t},window.Player=o,n.prototype.init=function(t){var e=this;this.spawn.lastPosition=t.canvas.width/2,this.spawnIntervalHandler=setInterval((function(){t.paused||(e.spawn.lastPosition+=1*e.spawn.direction,(e.spawn.lastPosition<=t.geometry.environment.horizontLeft.x+e.spawn.edgeOffset||e.spawn.lastPosition>=t.geometry.environment.horizontRight.x-e.spawn.edgeOffset)&&(e.spawn.direction=-e.spawn.direction),e.spawn.lastPosition<=t.geometry.environment.horizontLeft.x+e.spawn.edgeOffset&&(e.spawn.lastPosition=t.geometry.environment.horizontLeft.x+e.spawn.edgeOffset),e.spawn.lastPosition>=t.geometry.environment.horizontRight.x-e.spawn.edgeOffset&&(e.spawn.lastPosition=t.geometry.environment.horizontRight.x-e.spawn.edgeOffset),e.create(new Cocaine(e.spawn.lastPosition,t.geometry.environment.horizontAtY,e.items.cocaine[e.items.cocaine.length-1]),"cocaine"))}),this.spawn.interval),this.environmentIntervalHandler=setInterval((function(){if(!t.paused)for(var i=0;i<1;i++)e.decoration.switch>0?e.create(new Decoration(e.decoration.initialX_left-10*i,t.geometry.environment.horizontAtY),"decorations"):e.create(new Decoration(e.decoration.initialX_right+10*i,t.geometry.environment.horizontAtY),"decorations"),e.decoration.switch=-e.decoration.switch}),this.decoration.interval),this.changeIntervalHandler=setInterval((function(){t.paused||(e.spawn.direction=Math.random()>.5?-1:1)}),this.spawn.changeInterval),this.bonusIntervalHandler=setInterval((function(){e.create(new Decoration(t.canvas.width/2-33+33*Math.floor(3*Math.random()),t.geometry.environment.horizontAtY,"heroin"),"bonus")}),this.bonus.interval)},n.prototype.create=function(t,e){this.items[e].push(t)},n.prototype.destroy=function(t,e){var i=this.items[e][t],o=this.items[e][t+1];o&&i===o.previous&&(o.previous=void 0),this.items[e].splice(t,1)},n.prototype.render=function(t){this.renderLine(t,"cocaine"),this.renderArray(t,"decorations"),this.renderArray(t,"bonus")},n.prototype.renderLine=function(t,e){var i=t.ctx;i.save(),i.shadowBlur=20,i.shadowColor="white",i.strokeStyle="white",i.lineCap="round",i.lineWidth=5,this.items[e].forEach((function(t,e){var o=t.previous;o&&(i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(t.x,t.y),i.stroke())})),i.restore()},n.prototype.renderArray=function(t,e){this.items[e].forEach((function(e,i){e.render(t)}))},n.prototype.update=function(t){this.updates.cocaine(t),this.updates.decorations(t),this.updates.bonus(t)},n.prototype.updateCocaine=function(t,e){var i=this;this.items[e].forEach((function(o,n){!t.player.didJump&&o.y<=t.player.y&&collision(o,t.player)?(i.destroy(n,e),t.sound.playSound(t.sound.sounds.PICKUP_COCAINE,t.player.score),t.player.incrementScore(t)):o.y>t.canvas.height?(i.destroy(n,e),t.player.decrementScore(t)):o.update(t)}))},n.prototype.updateDecorations=function(t,e){var i=this;this.items[e].forEach((function(o,n){o.y>t.canvas.height?i.destroy(n,e):o.update(t)}))},n.prototype.updateBonus=function(t,e){var i=this;this.items[e].forEach((function(o,n){!t.player.didJump&&o.y<=t.player.y&&collision(o,t.player)?(i.destroy(n,e),t.sound.playSound(t.sound.sounds.PICKUP_BONUS,t.player.score),t.player.bonusPickup(t)):o.y>t.canvas.height?i.destroy(n,e):o.update(t)}))},window.Generator=n,r.prototype.render=function(t){t.ctx.save(),t.ctx.beginPath(),t.ctx.strokeStyle="green",t.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),t.ctx.stroke(),t.ctx.restore()},r.prototype.update=function(t){var e=t.geometry.environment;this.y+=this.speed*t.time.delta,this.x=pointAtY(e.focalPoint,{x:this.startPosX,y:this.startPosY},this.y).x-this.width/2},window.Cocaine=r,s.prototype.render=function(t){t.ctx.strokeStyle="red";var e=t.cache[this.image],i=this.y/t.geometry.environment.height;t.ctx.drawImage(e,this.x-this.width*i/2,this.y-this.height*i/2,this.width*i,this.height*i)},s.prototype.update=function(t){var e=t.geometry.environment;this.y+=this.speed*t.time.delta,this.x=pointAtY(e.focalPoint,{x:this.startPosX,y:e.horizontAtY},this.y).x},window.Decoration=s,a.prototype.init=function(t){this.sounds={PICKUP_COCAINE:1,JUMP:2,PICKUP_BONUS:3},this.startMusic()},a.prototype.playSound=function(t,e){switch(t){case this.sounds.PICKUP_COCAINE:this.pickupSound(e);break;case this.sounds.PICKUP_BONUS:this.bonusSound();break;case this.sounds.JUMP:this.jumpSound();break;default:console.warn("No such sound:",t)}},a.prototype.startMusic=function(){this.music=setInterval(this.backgroundMusic,4e3)},a.prototype.stopMusic=function(){clearInterval(this.music)},a.prototype.jumpSound=function(){soundEffect(523.25,.05,.2,"sine",3,.8,0,600,!0,100,0,void 0,void 0)},a.prototype.pickupSound=function(t){soundEffect(midiTable[66]+.1*t,.02,.04,"triangle",1,0,0)},a.prototype.bonusSound=function(){soundEffect(587.33,0,.2,"square",1,0,0),soundEffect(880,0,.2,"square",1,0,.1),soundEffect(1174.66,0,.3,"square",1,0,.2)},a.prototype.backgroundMusic=function(){var t=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2;soundEffect(midiTable[e],.05,i,"triangle",1,0,t/4,0),soundEffect(midiTable[e+7],.05,i,"triangle",1,0,t/4,0),soundEffect(midiTable[e+12],.05,i,"triangle",1,0,t/4,0)},e=function(t){return soundEffect(40,0,.1,"triangle",15,0,t/4,0)},i=function(t){return soundEffect(80,0,.1,"triangle",15,0,t/4,0)};e(0),t(0,52),t(1,52),i(2),t(2,50),t(3,52),e(4),t(5,47),i(6),t(6,52),t(7,50,.8),e(8),i(10),e(12),i(14)},window.Sound=a,c.prototype.addToCache=function(t,e){var i=this;return new Promise((function(o,n){var r=document.createElement("canvas"),s=r.getContext("2d"),a=new Image;a.src=e,a.onload=function(){r.width=a.width,r.height=a.height,s.drawImage(a,0,0),i.cache[t]=r,o()}}))},c.prototype.init=function(t){var e=this;this.config={canvasId:t||"display",fps:t||60,mute:!1,gravity:.05,friction:.5,jumpImpulse:20,groundPoint:500,leftBorder:150,rightBorder:650,scoreLimit:2e3,scoreIncrementFactor:1,scoreDecrementFactor:2},this.time={now:0,then:performance.now(),interval:1e3/60,delta:0},this.overdosed=!1,this.underdosed=!1,this.paused=!1,this.canvas=document.getElementById(this.config.canvasId),this.canvas.width=800,this.canvas.height=600,this.ctx=this.canvas.getContext("2d"),this.geometry={player:{x:400,y:200,width:50,height:90,radius:16},environment:this.calculateEnvironment({x:this.canvas.width/2,y:150})},this.windowBlurHandler=window.onblur=function(){e.paused=!0,e.sound.stopMusic()},this.environment=new Environment,this.player=new Player,this.generator=new Generator,this.sound||(this.sound=new Sound,this.sound.init(this)),this.controls||(this.controls=new Controls,this.controls.init(this)),this.assetLoading.then((function(){e.environment.init(e),e.generator.init(e),e.player.init(e),e.loop()}))},c.prototype.calculateEnvironment=function(t){var e={width:this.canvas.width,height:this.canvas.height,horizontAtY:this.canvas.height/3,focalPoint:t,bottomLeft:{x:0,y:this.canvas.height},bottomRight:{x:this.canvas.width,y:this.canvas.height}};return e.horizontLeft=pointAtY(e.focalPoint,e.bottomLeft,e.horizontAtY),e.horizontRight=pointAtY(e.focalPoint,e.bottomRight,e.horizontAtY),e},c.prototype.loop=function(t){var e=this.time;e.now=t||0,e.delta=e.now-e.then,e.delta>e.interval&&(e.then=e.now-e.delta%e.interval),this.paused?this.overdosed?this.renderOverdose():this.underdosed?this.renderUnderdose():this.renderPause():e.delta>e.interval&&(this.update(),this.render()),requestAnimationFrame(this.loop.bind(this))},c.prototype.render=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.environment.render(this),this.generator.render(this),this.player.render(this)},c.prototype.renderPause=function(){this.environment.drawPause(this)},c.prototype.renderOverdose=function(){this.environment.drawOverdose(this)},c.prototype.renderUnderdose=function(){this.environment.drawUnderdose(this)},c.prototype.update=function(t){this.generator.update(this),this.player.update(this)},c.prototype.hasOverdosed=function(){this.paused=!0,this.sound.stopMusic(),this.overdosed=!0},c.prototype.hasUnderdosed=function(){this.paused=!0,this.sound.stopMusic(),this.underdosed=!0},c.prototype.restartGame=function(){delete this.environment,delete this.player,delete this.generator,this.init()},window.Game=c}()</script><style>body,html{width:100%;height:100%;margin:0;padding:0}canvas{display:block;position:fixed;top:0;left:0;right:0;bottom:0;margin:auto;transform:translateZ(0)}</style><canvas id=display></canvas><script>const snooffline=new Game;snooffline.init()</script>