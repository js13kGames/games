<!doctype html><title>Whirled on the Spirit Spiral</title><script src=/2018/webxr/aframe.js></script><script>AFRAME.registerShader("gradient",{schema:{topColor:{type:"vec3",default:{x:255,y:255,z:255},is:"uniform"},bottomColor:{type:"vec3",default:{x:0,y:0,z:0},is:"uniform"},offset:{type:"float",default:400,is:"uniform"},exponent:{type:"float",default:.6,is:"uniform"}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 bottomColor;\nuniform vec3 topColor;\nuniform float offset;\nuniform float exponent;\nvarying vec3 vWorldPosition;\nvoid main() {\nfloat h = normalize( vWorldPosition + offset ).y;\nfloat rB = bottomColor.x/255.0;\nfloat gB = bottomColor.y/255.0;\nfloat bB = bottomColor.z/255.0;\nvec3 bColor = vec3(rB,gB,bB);\nfloat rT = topColor.x/255.0;\nfloat gT = topColor.y/255.0;\nfloat bT = topColor.z/255.0;\nvec3 tColor = vec3(rT,gT,bT);\ngl_FragColor = vec4( mix( bColor, tColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );\n}"}),AFRAME.registerComponent("camera-cursor",{init(){state.ray=document.querySelector("#ray"),state.crosshair=document.querySelector("#crosshair"),state.hud=document.querySelector("#hud")}}),AFRAME.registerComponent("obstacle",{check(){this.el.classList.contains("obs")&&this.el.getAttribute("position").z>state.playerPosZ&&(Game.destroy(this),ins.movePlayer(2))}}),AFRAME.registerComponent("rotation-listener",{init(){this.sky=document.querySelector("#sky")},tick(){this.sky.object3D.rotation.y+=5e-4*this.el.getAttribute("rotation").y}});let ins=null,conf={pc:{ver:"pc",ringDistance:2},mob:{ver:"mob",ringDistance:3},curr:null},state={scene:null,sky:null,menu:null,mc:null,player:null,ev:null,a:null,lastRender:null,playerPosZ:null,crosshair:null,aimTimeout:null,aimLength:500,aimedObj:null,ray:null,int:null,minZ:-45,maxZ:15,rings:[],obstacles:[],obstacleDistance:2.5,effect:null,effectSpeed:.01,incu:!1},effects={wave:{min:.01,max:.6,val:0},skyOpacity:{min:.1,max:.5,val:.1},ringOpacity:{min:.2,max:.8,val:.2},ringScale:{min:2.8,max:5,val:5},ringSpeed:{min:1,max:1,val:1}};class Game{constructor(){ins||(ins=this),state.scene=document.querySelector("a-scene"),state.sky=document.querySelector("a-sky"),state.menu=document.querySelector("#menu"),state.mc=document.querySelector("#mc"),state.player=document.querySelector("#player"),state.ev=document.querySelector("#ev"),state.a=new AudioContext,state.scene.hasLoaded?ins.gameLoop():state.scene.addEventListener("loaded",ins.gameLoop)}start(){state.mc.emit("coff"),state.menu.object3D.visible=!1;for(let e,t=state.minZ;t<state.maxZ;t+=conf.curr.ringDistance)e=new GameObject(state.scene.components.pool__rings.requestEntity(),[0,2,t],.003),state.rings.push(e);for(let e=state.minZ;e<state.maxZ;e+=state.obstacleDistance){let t=state.scene.components.pool__obstacles.requestEntity(),s=document.createElement("a-animation");s.setAttribute("mixin","brot"),t.appendChild(s),e+15>state.playerPosZ?t.object3D.visible=!1:t.setAttribute("class","obs"),state.obstacles.push(new GameObject(t,[4*Math.random()-2,4*Math.random()+1-3,e],.001,1))}ins.movePlayer(),ins.evHurt(),state.incu=!1,state.lastRender=null,state.effect=null}finish(){clearInterval(state.int),state.int=null,ins.emptyPool(state.rings),ins.emptyPool(state.obstacles);for(let e of document.querySelectorAll(".story"))e.setAttribute("value",ins.isWon()?"You reached the end of the Wormhole, very nice, you got the Internet from Evil Enemy, like a fairy. Congratulations, you just made him upset, once you meet with the people tell them do not be happy, the opposed. Download what you just can quickly, he is really evil and perhaps bored being offline and will come back to show how to quackery.":"Evil Enemy shows why his citous is dupli, shews you them of wormhole, you fall back to the people. Falling pretty boring, you want to check some... oh blaspheme, you learnt from the evil, who keep using the people Internet, people are offline and blame you. Very bad, try to go back!");ins.movePlayer(),document.querySelector("#s"+conf.curr.ver).classList.add("obs"),state.mc.emit("con"),state.menu.object3D.visible=!0}update(e){ins.movePool(e,state.rings,conf.curr.ringDistance),ins.movePool(e,state.obstacles,state.obstacleDistance),ins.startEffect()}draw(){for(let e of state.rings)e.redraw();for(let e of state.obstacles)e.redraw(),e.obj.components.obstacle.check();let e=state.player.object3D.position.z;e!=state.playerPosZ&&(e+=e<state.playerPosZ?.1:-.1,state.player.object3D.position.z=.1>Math.abs(state.playerPosZ+e)?state.playerPosZ:parseFloat(parseFloat(e).toFixed(1))),ins.playEffect()}gameLoop(e){0<state.rings.length&&(null==state.lastRender&&(state.lastRender=e),ins.update(e-state.lastRender),ins.draw(),state.lastRender=e,(ins.isWon()||ins.isLost())&&ins.finish()),ins.aim(),window.requestAnimationFrame(ins.gameLoop)}aim(){let e=state.ray.components.raycaster.intersections;0<e.length?state.aimedObj!=e[0].object&&(ins.endAim(),ins.startAim(e[0].object)):ins.endAim()}startAim(e){state.aimedObj=e,state.aimedObj.material.metalness=.8,state.aimTimeout=setTimeout(ins.shoot,state.aimLength),state.crosshair.emit("aim")}endAim(){clearTimeout(state.aimTimeout),state.aimedObj&&(state.crosshair.emit("endAim"),state.crosshair.setAttribute("theta-Length",360),state.aimedObj.material.metalness=.3),state.aimedObj=null}shoot(){if(state.aimedObj){let e=state.aimedObj.el.id;"spc"==e||"smob"==e?(state.aimedObj.el.classList.remove("obs"),conf.curr=conf[e.substr(1)],state.aimedObj.material.metalness=.3,ins.start()):(Game.destroy(state.aimedObj),ins.changeColour(),ins.movePlayer(-1),ins.beep(300,.1),ins.beep(200,.12,.03),ins.beep(100,.1,.1),ins.beep(600,.01,.19)),state.aimedObj=null}}isWon(){return state.playerPosZ<=state.minZ+5}isLost(){return state.playerPosZ>=state.maxZ}getProgress(){let e=state.maxZ-state.minZ,t=-state.playerPosZ+state.maxZ,s=Math.round(t/(e/100));return 0>s?0:s}startEffect(){if(null==state.int){let e=Object.keys(effects),t=e[Math.floor(Math.random()*e.length)];state.effect=effects[t],state.effectSpeed=.005,(state.effect.val<=state.effect.min&&0>state.effectSpeed||state.effect.val>=state.effect.max&&0<state.effectSpeed)&&(state.effectSpeed*=-1),state.int=window.setInterval((()=>{state.effect.val+=state.effectSpeed,(0<state.effectSpeed&&state.effect.val>=state.effect.max||0>state.effectSpeed&&state.effect.val<=state.effect.min)&&(clearInterval(state.int),state.int=null)}),10)}}playEffect(){if(null!=state.effect){state.sky.setAttribute("opacity",effects.skyOpacity.val);for(const[e,t]of state.rings.entries())if(0==t.type){let s=state.rings.length/10*e,a=Math.sin(s*Math.PI/5)*effects.wave.val;t.pos[1]=a,t.obj.setAttribute("opacity",effects.ringOpacity.val),t.obj.setAttribute("scale",`5 0.5 ${effects.ringScale.val}`)}}}changeColour(){let e="#"+("00000"+(0|65536*Math.random()).toString(16)).slice(-6);for(let t of state.rings)t.obj.setAttribute("material","color",e)}evHurt(){state.ev.setAttribute("opacity",(100-ins.getProgress())/100)}beep(e=100,t=.1,s=0){if(state.a){let a=state.a.createOscillator(),o=state.a.createGain();a.connect(o),a.frequency.value=e,a.type="sine",o.connect(state.a.destination),o.gain.value=.1,a.start(state.a.currentTime+s),a.stop(state.a.currentTime+t+s)}}emptyPool(e){for(;0<e.length;){let t=e.pop();void 0===t.parentNode&&(t=t.obj),t.parentNode.removeChild(t)}}static destroy(e){void 0===e.material?e.el.setAttribute("material","metalness",.3):e.material.metalness=.3,e.el.classList.remove("obs"),e.el.object3D.visible=!1}movePool(e,t,s){if(0==t.length)return;let a=null,o=null,n=null;for(let[s,i]of t.entries())(null==a||i.pos[2]<a)&&(a=i.pos[2]),(null==n||i.pos[2]>n)&&(o=s,n=i.pos[2]),i.recalc(e,0==i.type?effects.ringSpeed.val:1);a>=state.minZ+s&&(t[o].pos[2]=state.minZ,t[o].redraw(),!t[o].obj.object3D.visible&&(t[o].obj.object3D.visible=!0,t[o].obj.classList.add("obs")))}movePlayer(e=null){null==e?(state.playerPosZ=0,state.player.object3D.position.z=0):(state.playerPosZ+=e,ins.evHurt()),!state.incu&&state.playerPosZ<=state.minZ+20&&(document.querySelector("#penta").emit("dang"),state.incu=!0)}}class GameObject{constructor(e,t,s,a=0){this.obj=e,this.pos=t,this.speed=s,this.type=a}recalc(e,t=1){this.pos[2]+=e*this.speed*t}redraw(){this.obj.object3D.position.set(...this.pos)}}</script><a-scene background=color:#060606 pool__rings=mixin:ring;size:10;dynamic:true pool__obstacles=mixin:obstacle;size:10;dynamic:true><a-assets><img id=bgPic src=bg.svg><img id=aumPic src=tamil.svg><img id=pentaPic src=penta.svg><a-mixin id=obstacle obstacle geometry=primitive:sphere;radius:0.3;segmentsWidth:8;segmentsHeight:5 material=flatShading:true;color:#830303;metalness:0.3></a-mixin><a-mixin id=ring geometry=primitive:cylinder;segmentsHeight:9;segmentsRadial:36;openEnded:true material=color:#fff;side:back rotation="90 0 0" scale="5 0.8 5"></a-mixin><a-mixin id=brot attribute=rotation from="0 0 0" to="0 25 0" dur=250 direction=alternate repeat=indefinite></a-mixin><a-mixin id=trot attribute=rotation from="-0.5 0 -2" to="0.5 0 2" dur=500 direction=alternate repeat=indefinite></a-mixin><a-mixin id=title text="align:center;width:15;letterSpacing:-4;value:Whirled on the Spirit Spiral" position="0 1.5 -5"></a-mixin><a-mixin id=story text="align:center;width:5;lineHeight:52;letterSpacing:-0.5;value:Evil Enemy, the Duplicitous with a devious blow did toss to his Wormhole the legacy of humans. In a semigloss moment the Elders of the Internet are pangloss about You will reach the dead end corridor and bring it back to their personages, who faces too much play outside not in the places where they enter secrets to databases. Let it go." position="0 -0.6 -5"></a-mixin></a-assets><a-entity light=type:ambient;color:#999></a-entity><a-entity light=type:directional;color:#FFF;intensity:0.6 position="-0.5 1 1"></a-entity><a-entity rotation="90 0 0"><a-sky id=sky src=#bgPic repeat="40 20" material=opacity:0.4></a-sky></a-entity><a-image id=ev src=#aumPic position="0.5 2 -45" width=8 height=8></a-image><a-image id=penta src=#pentaPic position="0.7 2.5 -45.1" width=10 height=10 scale="0 0 0" material=side:front;transparent:true;opacity:1;color:darkred><a-animation begin=dang attribute=position from="0.7 2.5 -45.1" to="0.7 2.5 -10" dur=1800 easing=ease-in direction=alternate repeat=1></a-animation><a-animation begin=dang attribute=scale from="0 0 0" to="5 5 5" dur=1800 easing=ease-in direction=alternate repeat=1></a-animation></a-image><a-circle id=mc material="shader:gradient;side:both;exponent:1.3;offset:2.2;topColor:183 65 14;bottomColor:0 0 0" radius=4 position="0 0 -6" roughness=1><a-animation begin=coff attribute=scale to="0 0 0" dur=500 easing=ease-out></a-animation><a-animation begin=con attribute=scale to="1 1 1" dur=300 easing=ease-in></a-animation></a-circle><a-entity id=menu position="0 1 -0.5"><a-text mixin=title color=#661100 position="0 1.5 -5.1"><a-animation mixin=trot></a-animation></a-text><a-text mixin=title><a-animation attribute=color from=#fff to=#660000 easing=ease-in dur=6000 repeat=indefinite></a-animation></a-text><a-text class=story mixin=story color=#551100 position="0 -0.6 -5.1"><a-animation mixin=trot></a-animation></a-text><a-text class=story mixin=story></a-text><a-cylinder class=obs id=spc position="-5.5 0.5 -6.5" color=#4682B4 height=4 radius=0.9 metalness=0.3 opacity=0.5 roughness=1><a-text position="0 0 0" rotation="5 35 0" value=Station align=center width=8 letter-spacing=10 negate=false></a-text></a-cylinder><a-cylinder class=obs id=smob position="5.5 0.5 -6.5" color=#4682B4 height=4 radius=0.9 metalness=0.3 opacity=0.5 roughness=1><a-text position="0 0 0" rotation="5 -35 0" value=Roaming align=center width=6.3 letter-spacing=10 negate=false></a-text></a-cylinder><a-text align=center color=#444444 width=3 value="by @SubZtep - Js13kGames @ 2018" position="0 -3.5 -5.5"></a-text><a-text align=center color=#333333 width=2.5 value="thx4 Starlin (design ideas) + robot0001 (math ideas)" position="0 -3.85 -5.5"></a-text></a-entity><a-entity id=player><a-camera camera-cursor look-controls rotation-listener wasd-controls=acceleration:500 fov=60><a-triangle material=color:#ff0000;shader:flat;opacity:0.65 position="0 -0.012 -1" scale="0.025 0.025 1"></a-triangle><a-triangle material=color:#ff0000;shader:flat;opacity:0.65 position="0 0.012 -1" scale="0.025 0.025 1" rotation="0 0 180"></a-triangle><a-entity id=ray position="0 0 0" raycaster=objects:.obs;far:60;recursive:false cursor=fuse:true;fuseTimeout:500></a-entity><a-ring id=crosshair position="0 0 -0.99" radius-outer=0.05 radius-inner=0.04 theta-start=90 material=color:#000;shader:flat><a-ring position="0 0 -0.1" radius-outer=0.06 radius-inner=0.04 material=color:#fff;shader:flat;opacity:0.3></a-ring><a-animation begin=aim end=endAim easing=ease-out attribute=theta-Length fill=forwards from=45 to=360 dur=500></a-animation></a-ring></a-camera></a-entity></a-scene><script>new Game</script>