<!doctype html><title>Hold the Cloud - js13kGames 2012</title><meta content="width=device-width" name=viewport><style>html{background:#fff}body{height:100%;background:#4e9dff url('bg.gif') left bottom repeat-x;margin:0!important;font-family:fantasy,sans-serif,serif;text-shadow:1px 1px 1px #888;color:#fff}header{display:table;width:100%}header>section{display:table-cell;min-width:320px;width:45%;float:left}section{padding:1%}section#sky{width:95%;height:300px;padding:0!important}.strip{display:block;background:rgba(0,0,0,.4);border-top:2px #fff dashed;border-bottom:2px #fff dashed}#cloud{padding-left:45%}#points{padding-left:1em}#points-report{color:#7fff00;margin-left:1em}h2{margin-top:0}h2>a{text-decoration:none}h2,h3{text-align:center}a{color:#fff}a:hover{color:azure}</style><body onkeydown=keyEventHandler(event,!1,!0) onkeyup=keyEventHandler(event,!1,!1) ontouchend=keyEventHandler(event,!0,!1) ontouchstart=keyEventHandler(event,!0,!0)><header><section id=info><h1>Hold the Cloud!</h1><p>HTML5 & Javascript game inspired on the exhaled nitric oxide medical test for asthmatics consisting to blow in order to maintain a cloud between a delimited strips for a period of time.</section><section id=controllers><h3>Hold the cloud in the middle between the strips tapping:</h3><h3>√ TAP Background <small>(Tablets & smartphones)</small></h3><h3>↵ ENTER <small>(Desktops)</small></h3></section></header><section id=strip-top class=strip><div><span><a name=play>LEVEL <span id=level-number>1</span></a><span id=points style=display:none>0</span><span id=points-label style=display:none> points</span><span id=points-report></span></div></section><section id=sky><canvas height=300 id=cloud width=130></canvas></section><section id=strip-bottom class=strip><h2 id=levels><a href=#play onclick=initialize()>▶ CLICK HERE TO START</a></h2><h3 id=level-timer></h3></section><script>function Cloud(e){this.image=cloudImage,this.x=0,this.y=$("sky").clientHeight/2-cloudHeight/2,this.hold=!1,this.level=e}function $(e){return document.getElementById(e)}function getHTML(e){return $(e).innerHTML}function setHTML(e,t){$(e).innerHTML=t}function display(e,t){$(e).style.display=t}function hide(e){display(e,"none")}function keyEventHandler(e,t,n){var i;e||(e=window.event),e.keyCode?i=e.keyCode:e.which&&(i=e.which),(i==toHoldKeycode||t)&&(cloud.hold=n)}function getMaxY(e){return-1}function getMinY(e){return $("sky").clientHeight-cloudHeight}function getSkyLevelHeight(e){return canvasHeight-=e/250}function setSkyHeight(e){$("sky").style.height=e+"px"}function randomFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function addPoints(e){setHTML("points",parseInt(getHTML("points"))+e)}function showPoints(e){""==getHTML("points-report")&&(display("points-report","inline"),setHTML("points-report",e),setTimeout("setHTML('points-report', '')",600),setTimeout("hide('points-report')",600))}function initialize(){hide("levels"),setHTML("points",0),display("points","inline"),display("points-label","inline"),canvasHeight=canvasInitHeight,setSkyHeight(canvasInitHeight),startLevel(1)}function startLevel(e){playLevel=!0,cloud=new Cloud(e),setHTML("level-number",e);var t=playTimePerLevel;timerId=setInterval((function(){--t<1?(clearInterval(timerId),endLevel()):setHTML("level-timer","Hold on during "+t.toString()+" seconds!")}),1e3),updateGame()}function endLevel(){if(playLevel=!1,setHTML("level-timer","Well done!"),cloud.level==maxLevels)setHTML("level-timer","Congratulations! You win this time");else{var e=cloud.level+1,t=waitTimePerLevel;timerId=setInterval((function(){--t<1?(clearInterval(timerId),startLevel(e)):(setHTML("level-timer","Get ready! Level "+e+" starts in "+t.toString()+" seconds."),cloud=new Cloud(e),render())}),1e3)}}function updateGame(){processUserInput(),render(),playLevel&&setTimeout(updateGame,24)}function processUserInput(){cloud.y<getMaxY(cloud.level)||cloud.y>getMinY(cloud.level)?gameOver():(cloud.hold?(cloud.y=cloud.y-1+cloud.level/1e3,cloud.x=randomFromInterval(-3,3)):(cloud.y=cloud.y+3,cloud.x=0),addPoints(getPointsFromAccuraty((cloud.y+cloudHeight/2)/2,canvasHeight/2)))}function getPointsFromAccuraty(e,t){var n=Math.round(100*e/t);for(rank in votes)if(n>=votes[rank].min&&n<=votes[rank].max){var i=votes[rank].points;return 5==i&&showPoints("PERFECT!"),i}}function render(){setSkyHeight(getSkyLevelHeight(cloud.level)),context.clearRect(0,0,canvasWidth,canvasHeight),context.drawImage(cloud.image,cloud.x,cloud.y)}function gameOver(){playLevel=!1,clearInterval(timerId),setHTML("level-timer","FAIL! Play one more time and try again ;-)"),display("levels","block")}var maxLevels=13,playTimePerLevel=13,waitTimePerLevel=3,toHoldKeycode=13,canvasWidth=132,canvasHeight=300,canvasInitHeight=300,canvas=$("cloud"),context=canvas.getContext("2d"),cloudImage=new Image;cloudImage.onload=function(){context.drawImage(cloudImage,0,$("sky").clientHeight/2-cloudHeight/2)},cloudImage.src="cloud.png";var cloud,timerId,cloudHeight=78,votes=[{min:0,max:35,points:0},{min:36,max:44,points:1},{min:45,max:55,points:5},{min:56,max:84,points:1},{min:85,max:100,points:0}],playLevel=!1</script>