<!doctype html><meta name=viewport content="width=device-width"><title>Final Lift - js13kGames</title><body style=margin:0;background:#111;color:#666;font-family:Arial;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center><canvas style=background:#000;border-radius:16px></canvas><a style=cursor:pointer;padding-top:8px>mute</a><script>function t(t,e,i){return Math.min(Math.max(t,i),e)}let e=()=>{};function i(t,e){let{x:i,y:n,width:s,height:o}=e;e.anchor&&(i-=s*e.anchor.x,n-=o*e.anchor.y);let r=t.x-Math.max(i,Math.min(t.x,i+s)),h=t.y-Math.max(n,Math.min(t.y,n+o));return r*r+h*h<t.radius*t.radius}let n,s,o={};function r(t,e){o[t]=o[t]||[],o[t].push(e)}function h(t,...e){(o[t]||[]).map((t=>t(...e)))}let a={get:(t,i)=>"_proxy"==i||e};function c(){return n}function l(){return s}class d{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new d(this.x+t.x,this.y+t.y,this)}}class u extends class{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new d(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}{init({width:t=0,height:e=0,context:i=l(),render:n=this.draw,update:s=this.advance,children:o=[],anchor:h={x:0,y:0},...a}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,...a}),this._di=!0,this._uw(),this.addChild(o),this._rf=n,this._uf=s,r("init",(()=>{this.context??=l()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y);let e=this.width,i=this.height,n=-e*this.anchor.x,s=-i*this.anchor.y;(n||s)&&t.translate(n,s),this._rf(),(n||s)&&t.translate(-n,-s),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh}}set children(t){this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||e,t._pc()}))}}class f extends u{init({...t}={}){super.init({...t})}draw(){this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}let w=/(\d+)(\w+)/;class p extends u{init({text:t="",textAlign:e="center",anchor:i={x:0,y:.5},color:n="#fff",lineHeight:s=1,font:o=l()?.font,...h}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:s,font:o,color:n,anchor:i,...h}),this.context&&this._p(),r("init",(()=>{this.font??=l().font,this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(w),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),this._fw&&e.map((e=>{let i=e.split(" "),n=i.shift(),s=n;i.map((e=>{s+=" "+e,t.measureText(s).width>this._fw&&(this._s.push(n),s=e),n=s})),this._s.push(s)})),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=this.textAlign,e=this.context;this._s.map(((i,n)=>{e.textBaseline="top",e.textAlign=t,e.fillStyle=this.color,e.font=this.font,e.fillText(i,0,this._fs*this.lineHeight*n)}))}}function x(){return new p(...arguments)}let g=new WeakMap,m={};function _(t){A(t,"onDown")}function y(t){A(t,"onUp")}function z(t){A(t,"onOver")}function M(t){g.get(t.target)._oo=null}function v(t,e,n){let s=function(t){let e=t._lf.length?t._lf:t._cf;for(let n=e.length-1;n>=0;n--){let s=e[n];if(s.collidesWithPointer?s.collidesWithPointer(t):i(t,s))return s}}(t);s&&s[e]&&s[e](n),m[e]&&m[e](n,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(n),t._oo=s)}function A(t,e){t.preventDefault();let i=t.target,n=g.get(i),s=i.getBoundingClientRect(),o=s.left,r=s.top;t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let s=n.touches[i];s||(s=n.touches[i]={start:{x:(t-o)/1,y:(e-r)/1}},n.touches.length++),s.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:s,identifier:a})=>{let c=n.touches[a];c.changed=!0,c.x=n.x=(i-o)/1,c.y=n.y=(s-r)/1,v(n,e,t),h("touchChanged",t,n.touches),"onUp"==e&&(delete n.touches[a],n.touches.length--,n.touches.length||h("touchEnd"))}))):(n.x=(t.clientX-o)/1,n.y=(t.clientY-r)/1,v(n,e,t))}function b(t,e){let i=t[0].toUpperCase()+t.substr(1);m["on"+i]=e}function C(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}class P extends f{constructor(t,e=!1){super({x:0,y:0,width:0,height:0,anchor:{x:0,y:0}}),this.colors=t,this.horizontal=e}onResize(t,e,i,n,s=0,o=0,r=0,h=0){this.x=t,this.y=e,this.width=i,this.height=n,this.chamferT=s,this.chamferR=o,this.chamferB=r,this.chamferL=h}draw(){const t=this.horizontal?this.width*(this.x<100?0:1):0,e=this.horizontal?this.width*(this.x>100?0:1):0,i=this.horizontal?0:this.height,n=this.context.createLinearGradient(t,0,e,i);this.colors.forEach(((t,e)=>n.addColorStop(e/this.colors.length,t))),this.context.fillStyle=n,this.context.beginPath(),this.context.moveTo(this.chamferT,-this.chamferL),this.context.lineTo(this.width-this.chamferT,-this.chamferR),this.context.lineTo(this.width-this.chamferB,this.height+this.chamferR),this.context.lineTo(this.chamferB,this.height+this.chamferL),this.context.closePath(),this.context.stroke(),this.context.fill()}}let R=[];const S=()=>{const{width:t,height:e}=c();let i=[],n="-1",s=[],o=3;const r=(t="",i="#fff")=>{h.text=t,h.color=i,h.y=.5*e},h=x({text:"",font:"28px Arial",x:t/2,y:e/2,width:190,height:200});return{nextPuzzle:(a=1,c=1)=>{0===R.length&&(R=I([E,D,T,W,$,L]),R.push(O));const l=R.shift()(a,c);i=l.options.map(String),o=l.reward,n=Array.isArray(l.correctAnswer)?l.correctAnswer.map(String):[`${l.correctAnswer}`],r(l.text),s=l.letterCounts&&13!=c?B(l.letterCounts,t/2-50,.32*e):[],h.y=l.letterCounts?.65*e:.5*e},setText:r,reset:()=>{R=[]},getCorrectAnswer:()=>n,getOptions:()=>i,getReward:()=>o,render(){h.render(),s.forEach((t=>t.render()))}}},k=["A","B","C","D","E"],E=(e=1)=>{const i=I(k).slice(0,1+Math.ceil(e/2)),n=t(6,35,4*e),s=Array.from({length:i.length},((t,e)=>e)),o=s.reduce(((t,e)=>t+e)),r=Math.floor((n-o)/i.length),h=I(s.map(((t,e)=>e+r))),a=i.reduce(((t,e,i)=>({...t,[e]:h[i]})),{}),c=Math.random()<.5,l=Object.keys(a).reduce(((t,e)=>c?a[t]>a[e]?t:e:a[t]<a[e]?t:e));return{letterCounts:a,text:`Which are there ${c?"most":"fewest"} of?`,options:I(Object.keys(a)),correctAnswer:l,reward:3+Math.floor(e/2)}},B=(t,e,i)=>{const n=[];let s=0;const o=(7-Math.floor(Object.values(t).reduce(((t,e)=>t+e))/5))/2*26;return Object.entries(t).forEach((([t,r])=>{for(let h=0;h<r;h++)n.push(x({text:t,font:"24px Arial",x:e+s%5*26,y:o+i+26*Math.floor(s/5)})),s++})),n},D=(e=1)=>{const i=J(0,1),n=I(N.slice(0,t(0,N.length,e+1))).slice(0,t(2,5,e+1)),s=J(0,2),o=(t,e)=>(t.match(e)||[]).length,r=n.sort(((t,e)=>t.length-e.length)).at(i?-1:0),h=(0===(a=s)?t=>o(t,/[aeiouy]/gi):1===a?t=>o(t,/[^aeiouy]/gi):t=>t.length)(r);var a;return{text:`${I(n).join(", ")}\n\nHow many ${["vowels","consonants","letters"][s]} in the ${i?"long":"short"}est word?`,options:H(h,2*e,e+2),correctAnswer:h,reward:4+Math.floor(e/2)}},T=(e=1)=>{const i=1+Math.ceil(e/3),n=t(2,9,i),[s,o]=[n+J(0,2),n+J(1,3)],r=s*o,h=G(N),a=s+J(1,i),c=Math.round(r/s*a);return{text:`${s} ${h}s cost $${r}. How much for ${a}?`,options:H(c,2*e,e+2),correctAnswer:c,reward:7+Math.floor(e/2)}},$=(t=1)=>{const e=Math.floor(t/2);let[i,n]=[t+J(e,2+e),1+t+J(e,2+e)],s=i;const o=Array(3).fill(0).map((()=>i+=n));o.unshift(s);const r=o.pop();return{text:o.concat("_").join(", "),options:H(r,2*t,t+2),correctAnswer:r,reward:3+Math.floor(t/2)}},L=(e=1)=>{const i=Math.random()>.5,n=t(0,2,Math.ceil(e/3)-1);let s=1;const o=j(e+3).map(((t,e)=>{let i=e+s;return s+=J(0,n),i})).slice(0,12),r=o.sort(((t,e)=>i?e-t:t-e));return{text:`Press from ${i?"largest":"smallest"} to ${i?"smallest":"largest"}`,options:I(o),correctAnswer:r,reward:3+Math.floor(e/2)}},O=(t=1,e=1)=>{const i=2*t,n=j(2*i+1).map(((t,n)=>e-i+n)).filter((t=>t>0&&t!==e));return{text:"What floor are you on?",options:I([e,...I(n).slice(0,t)]),correctAnswer:e,reward:3+Math.floor(t/2)}},W=(t=1)=>{const e=Math.ceil(t/3),i=["+","-"].slice(0,2),n=j(e).map(((t,e)=>G(i))),s=j(e+1).map((()=>J(1,3*e))),o=Math.floor(s.reduce(((t,e,i)=>({"+":t+e,"-":t-e}[n[i-1]]))));let r=[];for(;s.length;)r.push(s.shift()),n.length&&r.push(n.shift());r=r.concat(["=",`${o}`]);const h=G(r.map(((t,e)=>e)).filter((t=>!isNaN(+r[t]))));return{text:r.map(((t,e)=>e===h?"_":t)).join(" "),options:H(r[h],2*t,t+2),correctAnswer:r[h],reward:4+Math.floor(t/2)}},H=(t,e,i)=>{const n=[+t];let s=0;for(;n.length<i&&s++<99;){const i=+t+J(-e,e);!n.includes(i)&&i>0&&n.push(i)}return I(n.slice(0,9))},j=t=>new Array(t).fill(""),N="kiwi apple banana apricot mandarin pineapple watermelon".split(" ");let U=1;const X={elevator:[.8,,123,.04,.3,.8,1,2.3,,-95,,,.06,,5.7,.2,.1,.97,.2,.38],incorrect:[.5,,412,,.09,.07,3,3.7,,10,,,,1.6,,.5,.01,.45,.08,,101],correct:[.5,,649,.01,,.13,1,1.1,,,139,.06,,,,,,.95,.03,,128],swap:[3,.1,44,.03,.04,.03,,1.4,,40,,,,,,,,.83,.02,,540],doors:[.3,.9,50,.05,.3,.3,4,1.2,1,,,,,2,,.24,.35,.4,.2,,-2150],tick:[.8,,275,.03,,.02,,2.6,,-35,24,.53,,.4,35,,.25,.52,.01,.04,-670],tick2:[.3,,572,.02,.01,.02,,1.6,,84,,,,,321,,,.78,.01],startGame:[2,,950,.02,.03,.004,4,3.3,-83,28,-44,.9,.09,,17,,.35,.67,.03,.36],click:[1.2,,342,,.09,.26,,.9,,3,,,.07,.5,,.1,,.42,.05,.15],tickUrgent:[2,,182,.02,.03,.03,1,.2,,,,,,.1,18,,.42,.72,.03],gameover:[,,387,.06,.23,.26,1,1.7,-8,,-63,.09,.04,,,.2,,.55,.16]};let F=!1;const q=t=>{F||zzfx(X[t][0]||1,...X[t].slice(1))},G=t=>I(t)[0];function I(t){const e=[...t];for(var i=t.length-1;i>0;i--){var n=Math.floor(Math.random()*(i+1)),s=e[i];e[i]=e[n],e[n]=s}return e}function Y(t,e,i){const n=function(t){return t<.5?2*t*t:-2*t*t+4*t-1}(i);return(1-n)*t+n*e}const V=(t,e)=>{const i=Math.floor(e/2),n=13-t,s=[...j(6-i).fill(0),...j(i).fill(1),...j(n<=6?i:0).fill(2)],o=G(s),r=t>11?0:t<9?1:.5,h=2!==o&&Math.random()>=r;let a=0;return 0===o?a=G([1,2,3]):1===o?a=G([4,5,6,7]):2===o&&(a=n),h?-1*a:a};function J(t,e){return(Math.random()*(e-t+1)|0)+t}function K(t,e){const i=t/U;let n=0,s=0,o=0;return new Promise((t=>{requestAnimationFrame((function r(h){n||(n=h);let a=0;if(window.__focused){const t=h-n-s;a=Math.min(t/(i||1),1),e?.(a)}else s+=h-o;a<1?requestAnimationFrame(r):t(0),o=h}))}))}const Q=(e,i,n,s)=>((e,i,n)=>{const s=document.createElement("canvas");s.width=e,s.height=i;const o=s.getContext("2d"),r=o.getImageData(0,0,e,i),h=new ArrayBuffer(r.data.length),a=new Uint8ClampedArray(h),c=new Uint32Array(h);for(let s=0;s<i;s++)for(let o=0;o<e;o++){const r=n({x:o/(e-1)-.5,y:s/(i-1)-.5});c[s*e+o]=t(0,255,255*r.a)<<24|t(0,255,255*r.b)<<16|t(0,255,255*r.g)<<8|t(0,255,255*r.r)}return r.data.set(a),o.putImageData(r,0,0),s})(s,s,(s=>{const o=((e,i,n)=>{const s=t(0,1,(n-0)/1.3);return s*s*(3-2*s)})(0,0,1-2*Math.sqrt(s.x**2+s.y**2));return{r:e,g:i,b:n,a:o*o*o}}));class Z extends f{init({disabled:t=!0,...e}={}){super.init({width:15,height:15,anchor:{x:.5,y:.5},isCorrect:!1,hasColorState:!1,disabled:!0,state:0,render:function(){const t=this.width,e=this.context,i=this.focused||this.hovered,n=this.pressed||1===this.state,s=(this.state>1?5:1===this.state?3:i?2:0)*t,o=this.state<2||!this.hasColorState?[.9,.9,.8]:2===this.state?[.6,1,.6]:[1,.2,.2];if(e.beginPath(),e.arc(t/2,t/2,t/2,0,2*Math.PI),e.fillStyle=this.disabled?"#8885":n?"#666":"#888",e.lineWidth=2,e.strokeStyle=this.disabled?"#aaa5":i?"#eee":"#aaa",e.save(),e.clip(),e.fill(),e.stroke(),e.restore(),!this.disabled&&s>0){const i=Q(...o,s),n=(s-t)/2;e.drawImage(i,-n,-n)}},...e}),this.textNode=x({text:"",font:"7.5px Arial",anchor:{x:0,y:window.safari?.85:.65},context:this.context}),function(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:c(),i=g.get(e);t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))}))}(this),this.addChild(this.textNode),this._uw(),this._p()}_p(){this.textNode._p(),this._uw()}render(){this._d&&this._p(),super.render()}onOver(){this.disabled||(this.hovered=!0,this.pressed=window.__pointerDown)}onOut(){this.hovered=!1,this.pressed=!1}onDown(){this.disabled||(this.pressed=!0)}onUp(){if(!this.disabled&&!window.__disableClick){if(0!==this.state)return;this.pressed=!1,q(this.hasColorState?this.isCorrect?"correct":"incorrect":"click"),this.state=this.isCorrect?2:3,h("press",this.textNode.text),K(1e3).then((()=>{this.hovered=!1,this.state=0}))}}collidesWithPointer(t){const e=c().width/2+at.x,i=c().height/2+at.y,n=(t.x-e)/at.zoom+e,s=(t.y-i)/at.zoom+i+1.5,o=n-this.x,r=s-this.y;return Math.sqrt(o*o+r*r)<this.width/2}}const tt=()=>{const t=function(){return new f(...arguments)}({color:"#000"}),e=x({color:"#ff0000",text:60..toString(),font:"12px Arial"});let i=1;const n=l();return{setDifficulty(t){i=t},onResize(i,n,s,o){t.x=i,t.y=n,t.width=s,t.height=o,e.x=i+s/2,e.y=n+o/2+(window.safari?-2:0)},setText(t){e.text=t},render(){t.render(),e.render();for(let e=0;e<9;e++)n.fillStyle=e>=i?"#400":"#c00",n.beginPath(),n.arc(5.5+t.x+4.6*e,t.y+t.height-3,1,0,360),n.fill()}}},et=["#766656","#615546"],it=["#9B938B","#6A5F54","#584D3F"],nt=["#372C26","#2A211B"],st=["#55493E","#3B3126"],ot=["#423528","#524131"];function rt(t){return t=Math.max(0,Math.min(1,t)),Math.round(255*t).toString(16).padStart(2,"0").toUpperCase()}const ht=t=>{try{navigator.vibrate(t)}catch(t){}};let at={zoom:1.05,x:0,y:0,sx:0,sy:0,i:0,m:0,f:0,shake:async(t,e,i)=>{at.m=t,at.f=e,await K(i),at.m=at.f=at.sy=at.sx=0}},ct=document.getElementsByTagName("a")[0];ct.onclick=()=>{F=!F,ct.innerHTML="mute"===ct.innerHTML?"unmute":"mute"},zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxV=.3,zzfxR=44100,zzfxX=new AudioContext,zzfxP=(...t)=>{let e=zzfxX.createBuffer(t.length,t[0].length,44100),i=zzfxX.createBufferSource();return t.map(((t,i)=>e.getChannelData(i).set(t))),i.buffer=e,i.connect(zzfxX.destination),i.start(),i},zzfxG=(t=1,e=.05,i=220,n=0,s=0,o=.1,r=0,h=1,a=0,c=0,l=0,d=0,u=0,f=0,w=0,x=0,p=0,g=1,m=0,_=0,y=0)=>{let z,M,v=2*Math.PI,P=t=>t<0?-1:1,A=a*=500*v/44100/44100,b=i*=(1+2*e*Math.random()-e)*v/44100,C=[],R=0,S=0,k=0,E=1,B=0,D=0,T=0,$=v*Math.abs(y)*2/44100,L=Math.cos($),I=Math.sin($)/2/2,O=1+I,j=-2*L/O,q=(1-I)/O,H=(1+P(y)*L)/2/O,K=-(P(y)+L)/O,G=H,N=0,W=0,F=0,U=0;for(c*=500*v/44100**3,w*=v/44100,l*=v/44100,d*=44100,u=44100*u|0,t*=.3,M=(n=44100*n+9)+(m*=44100)+(s*=44100)+(o*=44100)+(p*=44100)|0;k<M;C[k++]=T*t)++D%(100*x|0)||(T=r?r>1?r>2?r>3?Math.sin(R**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/v%2+2)%2:1-4*Math.abs(Math.round(R/v)-R/v):Math.sin(R),T=(u?1-_+_*Math.sin(v*k/u):1)*P(T)*Math.abs(T)**h*(k<n?k/n:k<n+m?1-(k-n)/m*(1-g):k<n+m+s?g:k<M-p?(M-k-p)/o*g:0),T=p?T/2+(p>k?0:(k<M-p?1:(M-k)/p)*C[k-p|0]/2/t):T,y&&(T=U=G*N+K*(N=W)+H*(W=T)-q*F-j*(F=U))),z=(i+=a+=c)*Math.cos(w*S++),R+=z+z*f*Math.sin(k**5),E&&++E>d&&(i+=l,b+=l,E=0),!u||++B%u||(i=b,a=A,E=E||1);return C},zzfxM=(t,e,i,n=125)=>{let s,o,r,h,a,c,l,d,u,f,w,x,p,g,m=0,_=[],y=[],z=[],M=0,v=0,P=1,A={},b=44100/n*60>>2;for(;P;M++)_=[P=d=x=0],i.map(((n,C)=>{for(l=e[n][M]||[0,0,0],P|=!!e[n][M],g=x+(e[n][0].length-2-!d)*b,p=C==i.length-1,o=2,h=x;o<l.length+p;d=++o){for(a=l[o],u=o==l.length+p-1&&p||f!=(l[0]||0)|a|0,r=0;r<b&&d;r++>b-99&&u?w+=(w<1)/99:0)c=(1-w)*_[m++]/2||0,y[h]=(y[h]||0)-c*v+c,z[h]=(z[h++]||0)+c*v+c;a&&(w=a%1,v=l[1]||0,(a|=0)&&(_=A[[f=l[m=0]||0,a]]=A[[f,a]]||(s=[...t[f]],s[2]*=2**((a-12)/12),a>0?zzfxG(...s):[])))}x=g}));return[y,z]};const{canvas:lt}=(n=document.querySelector("canvas"),s=n.getContext("2d")||new Proxy({},a),s.imageSmoothingEnabled=!1,h("init"),{canvas:n,context:s});window.safari=window.safari||/iPhone|iPad|iPod/.test(navigator.userAgent),function({radius:t=5,canvas:e=c()}={}){let i=g.get(e);if(!i){let n=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:n},g.set(e,i)}e.addEventListener("mousedown",_),e.addEventListener("touchstart",_),e.addEventListener("mouseup",y),e.addEventListener("touchend",y),e.addEventListener("touchcancel",y),e.addEventListener("blur",M),e.addEventListener("mousemove",z),e.addEventListener("touchmove",z),i._t||(i._t=!0,r("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0})))}(),lt.width=400,lt.height=700;const dt=(({canvas:e})=>{const i=(({canvas:e})=>{let i=1;const n={floor:new P(st),floor2:new P(["#463D33","#393127"]),ceiling:new P([...st].reverse()),puzzle:S(),leftDoor:new P(it),rightDoor:new P(it),topPanel2:new P([nt.at(-1)]),leftPanel2:new P([...nt].reverse()),rightPanel2:new P([...nt].reverse()),leftPanel:new P(et),rightPanel:new P(et),topPanel:new P(["#55493E","#76685A"]),leftWall:new P([...ot].reverse()),rightWall:new P([...ot].reverse()),timer:tt()},s=[];for(let t=0;t<12;t++)s.push(new Z);const o=()=>{const t=e.height,o=e.width,r=220,h=460,a=r/3,c=(o-r-2*a)/2,l=(t-h)/2,d=r/45,u=2*-d,f=o-2*c,w=110-d,x=h-3*d,p=c/1.5,g=c+a+d,m=Y(g-w,g,i),_=Y(g+w+w,g+w,i);n.ceiling.onResize(0,0,o,106),n.floor.onResize(0,560,o,240),n.floor2.onResize(o/2-300,600,600,110,140,0,0),n.leftPanel.onResize(c,l,a,h),n.leftPanel2.onResize(c+a,l,d,h,0,u,0,0),n.rightPanel.onResize(o-c-a,l,a,h),n.rightPanel2.onResize(o-c-d-a,l,d,h,0,0,0,u),n.topPanel.onResize(c,l-a,f,a),n.topPanel2.onResize(c+a,l-a+a,r,Math.abs(u)),n.leftWall.onResize(0,l-a,c,h+a,0,0,0,p),n.rightWall.onResize(o-c,l-a,c,h+a,0,p,0,0),n.leftDoor.onResize(m,l+d+6,w,x-6),n.rightDoor.onResize(_,l+d+6,w,x-6);const y=o-c-a+7.5+(a-49)/2,z=l+230-17+8.5+1;n.timer.onResize(y-7.5,z-60,49,30),s.forEach(((t,e)=>{t.x=y+e%3*17,t.y=55+z-17*Math.floor(e/3)}))};return o(),{buttons:s,doorPosition:i,timer:n.timer,puzzle:n.puzzle,render(){[...Object.values(n),...s].forEach((t=>t.render()))},toggleButtons(t=!0){s.forEach((e=>{e.hovered=e.pressed=!1,e.disabled=!e.textNode.text||!t}))},updateButtons(t,e){s.forEach(((i,n)=>{i.disabled=!t[n],i.textNode.text=t[n]?`${t[n]}`:"",i.hasColorState="string"==typeof e,i.isCorrect="string"!=typeof e||t[n]===e}))},toggleDoor:(e=1,n=1e3)=>(n>0&&q("doors"),K(n,(n=>{i=t(.1,1,0===e?1-n:n),o()}))),update(){}}})({canvas:e}),n=new P(["#000"]);n.onResize(0,0,e.width,e.height);const s=l(),o=x({text:"Final\nLift",font:"84px Arial",x:e.width/2,y:.4*e.height}),h=x({text:"Press to start",font:"32px Arial",x:e.width/2,y:.85*e.height});let a=0,c=4,d=0,u=0,f=0,w=0;const p=async t=>{const e=at.zoom,i=at.x;await K(t.duration??500,(n=>{"number"==typeof t.zoom&&(at.zoom=Y(e,t.zoom,n)),"number"==typeof t.x&&(at.x=Y(i,t.x,n))})),"number"!=typeof t.x&&(at.x=0)},g=async(t=0,e=1,i=1e3)=>{await K(i,(i=>{n.colors=[`#000000${rt(Y(t,e,i))}`]}))},m=async(t,e=!1)=>{if(e)return u=t,i.timer.setText(`${u}`);const n=t>0?1:-1;for(;0!==t&&u>0;)t+=-1*n,u=Math.min(99,u+n),i.timer.setText(`${u}`),q(n>0?"tick2":n<0&&u<10?"tickUrgent":"tick"),await K(100)},_=async()=>{1!==c&&2!==c||(m(-1),u<=0&&(m(0,!0),g(.5,1),M())),await K(1e3),_()};_();const y=async(t=!0)=>{t?(await p({zoom:4.25,x:190,duration:500}),i.toggleButtons(!0)):(i.toggleButtons(!1),await p({zoom:2,x:0,duration:500}))},z=async(t=!1)=>{if(t?(await g(.75,.5),i.puzzle.nextPuzzle(w,a)):(i.updateButtons([]),i.toggleDoor(1),await p({zoom:1.05,x:0}),await K(500),i.puzzle.nextPuzzle(w,a)),await K(t?500:250),t||(q("elevator"),await at.shake(2,4,1200),await K(500)),13===a&&i.puzzle.setText("13","#ff0000"),i.toggleDoor(0),await p({zoom:2,duration:1e3}),13===a)return await K(500),g(.5,1),M();f=0,i.updateButtons(i.puzzle.getOptions(),i.puzzle.getCorrectAnswer()[f]),c=1},M=async()=>{3!==c&&(c=3,q("gameover"),ht(500),await K(1e3),i.updateButtons([]),await p({zoom:1.05,x:0,duration:0}),await i.toggleDoor(1,0),await g(1,.75),h.text=`Score: ${d} floors`,v(0,1),c=4)},v=(t=1,e=0)=>K(1e3,(i=>{h.color=o.color=`#ffffff${rt(Y(t,e,i))}`}));g(1,.75,0),r("press",(async t=>{if(1!==c&&2!==c)return;window.__disableClick=!0;const e=i.puzzle.getCorrectAnswer(),n=t===e[f],s=f===e.length-1;if(!n&&1===c){m(-3);try{ht(250)}catch(t){}at.shake(7,1,250)}1===c?n&&(s?(c=2,await K(500),await(async()=>{d+=1,c=0,await m(i.puzzle.getReward()),c=2,A(),i.updateButtons(((t,e)=>{let i=[];const n=(e,i,n)=>t+e>=1&&t+e<=20&&n.indexOf(e)===i;for(;i.length<3;)i.push(V(t,e)),i=i.filter(n);return I(i.map((t=>`${t>0?"+":""}${t}`)))})(a,w)),await y(!0)})()):i.updateButtons(i.puzzle.getOptions(),e[++f])):(a+=+t,c=0,await z()),window.__disableClick=!1}));const A=()=>{w=Math.min(9,1+Math.floor(d/4)),U=1+(w-1)/18,i.timer.setDifficulty(w)};return b("up",(t=>{if(window.__pointerDown=!1,4===c&&(c=0,a=1,d=0,i.puzzle.reset(),A(),m(60,!0),v(),z(!0),q("startGame")),1===c&&at.zoom>=2){const i=(t.offsetX??t.changedTouches[0].clientX)/e.width;0===at.x?(q("swap"),y(!0)):190===at.x&&i<.2&&(q("swap"),y(!1))}})),b("down",(()=>{window.__pointerDown=!0})),{shutdown(){},update(){e.style.cursor=i.buttons.some((t=>t.hovered))?"pointer":"initial"},render(){s.save();const t=e.width/2,r=e.height/2;++at.i%at.f==0&&(at.i=0,at.sx=(1-2*Math.random())*at.m,at.sy=(1-2*Math.random())*at.m),s.translate(t+at.x+at.sx,r+at.y+at.sy),s.scale(at.zoom,at.zoom),s.translate(-(t+at.x),-(r+at.y)),i.render(),n.render(),o.render(),h.render(),s.restore()}}})({canvas:lt});(function({fps:t=60,clearCanvas:i=!0,update:n=e,render:s,context:o=l(),blur:a=!1}={}){let c,d,u,f,w,x=0,p=1e3/t,g=1/t,m=i?C:e;function _(){if(d=requestAnimationFrame(_),window.__focused&&(u=performance.now(),f=u-c,c=u,!(f>1e3))){for(x+=f;x>=p;)h("tick"),w.update(g),x-=p;m(w.context),w.render()}}return window.__focused=!0,a||(window.addEventListener("focus",(()=>{window.__focused=!0})),window.addEventListener("blur",(()=>{window.__focused=!1}))),r("init",(()=>{w.context??=l()})),w={update:n,render:s,isStopped:!0,context:o,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(_))},stop(){this.isStopped=!0,cancelAnimationFrame(d)}},w})({update:()=>dt.update(),render:()=>dt.render()}).start()</script>