<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=0"><title>Candy Wrapper</title><style>body[orient=landscape]{font-family:'Segoe UI',sans-serif}.squareBtn{-moz-box-shadow:inset 0 -4px 0 -1px #135f8f;-webkit-box-shadow:inset 0 -4px 0 -1px #135f8f;box-shadow:inset 0 -4px 0 -1px #135f8f;background-color:#2980b9;-moz-border-radius:6px;-webkit-border-radius:6px;border-radius:6px;display:inline-block;color:#fff;font-family:Trebuchet MS;font-size:20px;font-weight:700;padding:10px 10px;text-decoration:none;cursor:pointer;position:absolute;text-align:center;width:40%;height:10%;text-shadow:1px 2px 1px #005085;z-index:10}.squareBtn:hover{background-color:#3498db}.squareBtn:active{position:absolute;height:12%}.about{font-size:10px}.popup{position:absolute;z-index:1000;-moz-box-shadow:inset 0 1px 0 0 #23395e;-webkit-box-shadow:inset 0 1px 0 0 #23395e;box-shadow:inset 0 1px 0 0 #23395e;background:-webkit-gradient(linear,left top,left bottom,color-stop(.05,#2e466e),color-stop(1,#415989));background:-moz-linear-gradient(top,#2e466e 5%,#415989 100%);background:-webkit-linear-gradient(top,#2e466e 5%,#415989 100%);background:-o-linear-gradient(top,#2e466e 5%,#415989 100%);background:-ms-linear-gradient(top,#2e466e 5%,#415989 100%);background:linear-gradient(to bottom,#2e466e 5%,#415989 100%);background-color:#2e466e;-moz-border-radius:7px;-webkit-border-radius:7px;border-radius:7px;border:1px solid #1f2f47;display:inline-block;color:#fff;font-family:Trebuchet MS;font-size:17px;font-weight:700;padding:6px 11px;text-decoration:none;text-shadow:0 1px 0 #263666}</style><script>var PathType,Vector2=function(){function t(t,e){this.X=0,this.Y=0,t&&(this.X=t),e&&(this.Y=e)}return t.prototype.set=function(t,e){return this.X=t,this.Y=e,this},t.prototype.length=function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},t.prototype.add=function(t){return this.X+=t.X,this.Y+=t.Y,this},t.prototype.subScalars=function(t,e){return this.X-=t,this.Y-=e,this},t.prototype.sub=function(t){return this.X-=t.X,this.Y-=t.Y,this},t.prototype.mulScalar=function(t){return this.X*=t,this.Y*=t,this},t.prototype.normalize=function(){var t=1/this.length();return this.X*=t,this.Y*=t,this},t.prototype.dot=function(t){return this.X*t.X+this.Y*t.Y},t.prototype.copy=function(t){return this.X=t.X,this.Y=t.Y,this},t.prototype.collides=function(t,e,i){var s=this.X-e.X,n=this.Y-e.Y;return Math.sqrt(s*s+n*n)<t+i},t}();!function(t){t[t.Line=0]="Line",t[t.Radial=1]="Radial"}(PathType||(PathType={}));var WrapperType,PathPart=function(t,e,i,s,n,a){if(this.Type=PathType.Line,this.Start=null,this.End=null,this.Radius=0,this.StartAngle=0,this.EndAngle=0,this.Type=t,this.Start=e,this.End=i,this.Radius=s,this.StartAngle=n,this.EndAngle=a,this.Type===PathType.Line){var r=this.End.X-this.Start.X,h=this.End.Y-this.Start.Y;this.Length=Math.sqrt(r*r+h*h)}else this.Length=Math.abs(this.EndAngle-this.StartAngle)*this.Radius},Path=function(){function t(t,e){this.Idx=0,this.Parts=null,this.NextCandyTime=0,this.LastCandy=null,this.Parts=t,this.Idx=e}return t.prototype.addEnemy=function(t){this.LastCandy=t},t.prototype.render=function(t){var e=this.Parts[0];t.beginPath(),t.moveTo(e.Start.X,e.Start.Y);for(var i=0;i<this.Parts.length;++i)(e=this.Parts[i]).Type===PathType.Line?t.lineTo(e.End.X,e.End.Y):t.arc(e.Start.X,e.Start.Y,e.Radius,e.StartAngle,e.EndAngle,e.StartAngle>e.EndAngle);t.stroke()},t}(),Sprite=function(){function t(t,e,i,s,n,a){this.Img=null,this.X=0,this.Y=0,this.Width=0,this.Height=0,this.SpriteMan=null,this.Img=t,this.X=e,this.Y=i,this.Width=s,this.Height=n,this.SpriteMan=a}return t.prototype.draw=function(t,e,i,s,n){var a=this.SpriteMan.GlobalScale;if(s){var r=Math.sin(s)*a,h=Math.cos(s)*a;t.setTransform(h,r,-r,h,e.X*a,e.Y*a)}else t.setTransform(a,0,0,a,e.X*a,e.Y*a);n?t.drawImage(this.Img,this.X,this.Y,this.Width,this.Height,.5*-i.X-n.X,.5*-i.Y-n.Y,i.X,i.Y):t.drawImage(this.Img,this.X,this.Y,this.Width,this.Height,.5*-i.X,.5*-i.Y,i.X,i.Y)},t.prototype.drawLabel=function(t,e,i){var s=this.SpriteMan.GlobalScale*i;t.setTransform(s,0,0,s,e.X*s,e.Y*s),t.drawImage(this.Img,this.X,this.Y,this.Width,this.Height,0,0,this.Width,this.Height)},t}(),InputManager=function(){function t(t,e){this.Tap={pos:new Vector2,justTapped:!1},this.MaxHoldTime=250,this.MaxDeltaDist=10,this.TouchPos=new Vector2,this.TouchTime=0;var i=this;t.addEventListener("touchstart",(function(s){1===s.touches.length&&(i.TouchPos.set(s.touches[0].pageX-t.clientLeft,s.touches[0].pageY-t.clientTop).mulScalar(1/e.GlobalScale),i.TouchTime=Date.now())}),!1),t.addEventListener("touchend",(function(s){var n=s.changedTouches[0].pageX-t.clientLeft,a=s.changedTouches[0].pageY-t.clientTop;0===s.touches.length&&Date.now()-i.TouchTime<i.MaxHoldTime&&i.TouchPos.subScalars(n,a).length()<i.MaxDeltaDist&&(i.Tap.justTapped=!0,i.Tap.pos.set(n,a).mulScalar(1/e.GlobalScale))}),!1),t.addEventListener("click",(function(s){i.Tap.justTapped=!0,i.Tap.pos.set(s.pageX-t.clientLeft,s.pageY-t.clientTop).mulScalar(1/e.GlobalScale)}),!1)}return t.prototype.update=function(){this.Tap.justTapped=!1},t}(),SpriteManager=function(t,e){this.RawSprites=[],this.Atlas=null,this.BackgroundCanvas=null,this.GlobalScale=1,this.LucksCanvas=null,this.Sprites={},this.LucksSprites={},this.GlobalScale=t;var i=document.createElement("canvas");i.width=i.height=512,this.Atlas=i;var s=i.getContext("2d");s.shadowBlur=5*t,s.shadowColor="#007FFF",s.strokeStyle="#007FFF",s.lineWidth=5,s.lineCap="round",s.beginPath(),s.arc(274,228,220,1.66*Math.PI,1.85*Math.PI),s.stroke(),this.Sprites.arc=new Sprite(i,264,0,246,246,this),s.shadowBlur=5*t,s.lineWidth=1,s.fillStyle=s.shadowColor="#0066CC",s.beginPath(),s.arc(64,64,64,0,2*Math.PI),s.fill(),this.Sprites.blueberry=new Sprite(i,0,0,128,128,this),s.fillStyle=s.shadowColor="#FFCC00",s.beginPath(),s.arc(192,64,64,0,2*Math.PI),s.fill(),this.Sprites.lemon=new Sprite(i,128,0,128,128,this),s.fillStyle=s.shadowColor="#CC0000",s.beginPath(),s.arc(64,192,64,0,2*Math.PI),s.fill(),this.Sprites.strawberry=new Sprite(i,0,128,128,128,this),s.fillStyle=s.shadowColor="#00CC00",s.beginPath(),s.arc(192,192,64,0,2*Math.PI),s.fill(),this.Sprites.apple=new Sprite(i,128,128,128,128,this),this.Sprites.SlowTime=new Sprite(i,0,0,128,128,this),this.Sprites.FiftyByFifty=new Sprite(i,128,0,128,128,this),this.Sprites.NoPenalty=new Sprite(i,0,128,128,128,this),this.Sprites.MinusPath=new Sprite(i,128,128,128,128,this),this.Sprites.readyRotor=new Sprite(i,0,0,128,128,this),s.strokeStyle=s.shadowColor="",s.lineWidth=14,s.beginPath(),s.moveTo(266,266+s.lineWidth),s.lineTo(267,266+s.lineWidth),s.stroke(),this.Sprites.barSample=new Sprite(i,266,266,1,2*s.lineWidth,this);var n=document.createElement("canvas");n.width=e.X,n.height=e.Y,this.BackgroundCanvas=n;var a=n.getContext("2d"),r="rgba(0,0,0,0)";a.fillStyle=r,a.fillRect(0,0,n.width,n.height);var h=a.createRadialGradient(920*t,360*t,50*t,920*t,360*t,500*t);h.addColorStop(0,"#003399"),h.addColorStop(1,r),a.beginPath(),a.fillStyle=h,a.rect(0,0,n.width,n.height),a.fill(),a.setTransform(t,0,0,t,0,0),a.fillStyle="#007FFF",a.font="22px bold marker felt, comic sans ms, arial",a.textBaseline="top",a.fillText("Score:",10,50),a.fillText("Speed:",10,80),a.globalAlpha=.2,this.Sprites.barSample.draw(a,new Vector2(180,670),new Vector2(120,24)),a.globalAlpha=1,a.setTransform(1,0,0,1,0,0);var o=document.createElement("canvas");o.width=o.height=512;var l=o.getContext("2d");l.shadowBlur=16,l.lineWidth=5,l.font="42px bold marker felt, comic sans ms, arial",l.textBaseline="top",l.fillStyle=l.shadowColor="#FF3333",l.fillText("Bad Luck",16,16),l.fillStyle=l.shadowColor="#6599FF",l.fillText("Ok",16,90),l.fillStyle=l.shadowColor="#9CFF00",l.fillText("Good",16,164),l.fillStyle=l.shadowColor="#990099",l.fillText("Awesome",16,238),l.fillStyle=l.shadowColor="#FF9900",l.fillText("Mega",16,312),this.LucksSprites[LuckLevel.Bad]=new Sprite(o,0,0,512,74,this),this.LucksSprites[LuckLevel.Ok]=new Sprite(o,0,74,512,74,this),this.LucksSprites[LuckLevel.Good]=new Sprite(o,0,148,512,74,this),this.LucksSprites[LuckLevel.Awesome]=new Sprite(o,0,222,512,74,this),this.LucksSprites[LuckLevel.Mega]=new Sprite(o,0,296,512,74,this),document.body.appendChild(o)};!function(t){t[t.Apple=0]="Apple",t[t.Strawberry=1]="Strawberry",t[t.Blueberries=2]="Blueberries",t[t.Lemon=3]="Lemon"}(WrapperType||(WrapperType={}));var LuckLevel,Wrapper=function(){function t(t,e,i){this.WSprite=null,this.Parent=null,this.Type=WrapperType.Apple,this.Position=new Vector2,this.Size=new Vector2,this.Radius=0,this.Type=t,this.Size.copy(e),this.Radius=e.X,this.WSprite=i.Sprites[t===WrapperType.Apple?"apple":t===WrapperType.Strawberry?"strawberry":t===WrapperType.Blueberries?"blueberry":"lemon"]}return t.prototype.update=function(t,e){},t.prototype.checkSpin=function(t){return!!this.Position.collides(this.Radius,t,0)},t.prototype.render=function(t,e,i){this.WSprite.draw(t,this.Position,this.Size,e)},t}(),Spinner=function(){function t(t,e,i,s,n){this.SSprite=null,this.Parent=null,this.Rotation=0,this.TargetRotation=-1,this.Radius=0,this.Size=new Vector2,this.Offset=new Vector2,this.RotationSpeed=0,this.Position=new Vector2,this.Radius=t,this.Offset.set(-t,t).mulScalar(.5),this.RotationSpeed=i,this.Position.copy(e),this.Size.set(t,t),this.Children=s,this.SSprite=n.Sprites.arc;for(var a=0;a<s.length;++a)s[a].Parent=this}return t.prototype.update=function(t,e){-1!==this.TargetRotation&&(this.Rotation+=this.RotationSpeed*e,this.Rotation>=this.TargetRotation&&(this.Rotation=this.TargetRotation,this.TargetRotation=-1));for(var i,s=t+this.Rotation,n=0,a=this.Radius,r=this.Children.length-1;r>=0;--r)n=s+.5*Math.PI*r,(i=this.Children[r]).Position.set(Math.cos(n)*a,Math.sin(n)*a).add(this.Position),i.update(t,e)},t.prototype.checkSpin=function(t){if(-1!==this.TargetRotation)return!0;for(var e=this.Children.length-1;e>=0;--e)if(this.Children[e].checkSpin(t))return!0;var i=t.X-this.Position.X,s=t.Y-this.Position.Y;return Math.sqrt(i*i+s*s)<=this.Radius&&(this.TargetRotation=this.Rotation+.5*Math.PI,!0)},t.prototype.render=function(t,e,i){var s=e+this.Rotation,n=0;for(n=0;n<4;++n)this.SSprite.draw(t,this.Position,this.Size,this.Rotation+.5*n*Math.PI,this.Offset);for(n=this.Children.length-1;n>=0;--n)this.Children[n].render(t,s+.5*Math.PI*n,i)},t}(),Candy=function(){function t(t){this.CSprite=null,this.Wrapped=!0,this.Type=WrapperType.Apple,this.Position=new Vector2,this.Size=new Vector2,this.Radius=0,this.Speed=0,this.CPath=null,this.PathPartIdx=0,this.PartInterpolation=0,this.PartSpeed=0,this.FinishedPath=!0,this.Size.copy(t),this.Radius=t.X}return t.prototype.revive=function(t,e,i,s){this.Type=t,this.CPath=i,this.Speed=s,this.Wrapped=!1,this.FinishedPath=!1,this.PathPartIdx=0,this.PartInterpolation=0,this.Position.set(-100,-100),this.CSprite=e.Sprites[t===WrapperType.Apple?"apple":t===WrapperType.Strawberry?"strawberry":t===WrapperType.Blueberries?"blueberry":"lemon"],i.addEnemy(this),this.PartSpeed=this.Speed/this.CPath.Parts[0].Length},t.prototype.update=function(t){if(!this.FinishedPath){var e=this.CPath.Parts,i=e[this.PathPartIdx];if(i.Type===PathType.Line)this.Position.copy(i.End).sub(i.Start).mulScalar(this.PartInterpolation).add(i.Start);else{var s=i.StartAngle+(i.EndAngle-i.StartAngle)*this.PartInterpolation;this.Position.set(i.Radius*Math.cos(s),i.Radius*Math.sin(s)).add(i.Start)}if(this.PartInterpolation+=this.PartSpeed*t,this.PartInterpolation>=1){if(this.PartInterpolation-=1,++this.PathPartIdx,!(this.PathPartIdx<e.length))return this.FinishedPath=!0,!0;i=e[this.PathPartIdx],this.PartInterpolation*=e[this.PathPartIdx-1].Length/i.Length,this.PartSpeed=this.Speed/i.Length}}return!1},t.prototype.render=function(t,e){this.FinishedPath||this.Wrapped||this.CSprite.draw(t,this.Position,this.Size)},t}();!function(t){t[t.Bad=0]="Bad",t[t.Ok=1]="Ok",t[t.Good=2]="Good",t[t.Awesome=3]="Awesome",t[t.Mega=4]="Mega"}(LuckLevel||(LuckLevel={}));var Level=function(){function t(t,e,i,s,n,a,r){this.Canvas=null,this.Context=null,this.Game=null,this.SpriteMan=null,this.InputMan=null,this.GSpinner=null,this.Spinners=null,this.ScreenSize=new Vector2,this.ScreenCenter=new Vector2,this.SpinnerSpeed=7,this.Wave=1,this.Paths=null,this.PathSmoothness=40,this.PathsCanvas=null,this.Candies=null,this.CandyRadius=17,this.MaxCandies=60,this.BaseCandySpeed=100,this.CurrentCandySpeed=this.BaseCandySpeed,this.WrapperRadius=35,this.Wrappers=null,this.Score=0,this.BaseScorePerCandy=10,this.TotalWrappedAmount=0,this.TotalSpinsDone=0,this.CurrentLuck=LuckLevel.Good,this.LuckMeter=0,this.TotalTimeElapsed=0,this.TimeToIncreaseSpeed=30,this.WaitingForNewWave=!1,this.CandiesCollected=0,this.CandiesToUp=[5,12,18,26,30],this.CandiesToLose=[5,6,5,3,1],this.CandiesLost=0,this.MaxLuckMeter=this.LuckMeter,this.MeterPos=new Vector2(120,575),this.MeterBarPos=new Vector2(120,670),this.MeterSize=new Vector2(0,24),this.Game=t,this.Wave=e,this.Canvas=i,this.Context=s,this.SpriteMan=n,this.MeterSampler=n.Sprites.barSample,this.InputMan=a,this.ScreenSize.copy(r),this.ScreenCenter.copy(r).mulScalar(.5);var h=new Array(16),o=null,l=new Array(4),p=new Vector2(this.WrapperRadius,this.WrapperRadius),d=0,u=0,c=[[0,1,2,3],[0,2,1,3],[0,1,3,2],[0,3,2,1]];for(d=0;d<4;++d){for(o=new Array(4),u=0;u<4;++u)o[u]=new Wrapper(c[d][u],p,n),h[4*d+u]=o[u];l[d]=new Spinner(80,new Vector2,this.SpinnerSpeed,o,n)}this.Spinners=l,this.GSpinner=new Spinner(220,new Vector2(920,360),this.SpinnerSpeed,l,n),this.Wrappers=h;for(var S=[[-50,360,1480,360],[-70,280,760,280,840,140,940,40,1040,60,1160,160,1480,160],[-88,440,760,440,840,580,940,680,1040,660,1160,560,1480,560]],w=this.PathSmoothness,y=[],f=0,C=0,m=0,P=new Vector2,g=new Vector2,T=new Vector2,v=0,M=0,L=0;L<S.length;++L){var W,b,x,k,R=S[L],I=new Array(R.length-3),X=null;for(d=0;d<I.length;d+=2)d+1<I.length?(W=new Vector2(R[d],R[d+1]),k=new Vector2(R[d+2],R[d+3]),x=new Vector2(R[d+4],R[d+5]),P.copy(W).sub(k).normalize(),g.copy(x).sub(k).normalize(),C=Math.sqrt(.5*(1+P.dot(g))),f=Math.sqrt(1-C*C),T=new Vector2(P.X,P.Y).add(g).normalize().mulScalar(w/f).add(k),m=w*(C/f),null!==X&&(W=X),b=new Vector2(k.X,k.Y).add(P.mulScalar(m)),X=new Vector2(k.X,k.Y).add(g.mulScalar(m)),I[d]=new PathPart(PathType.Line,W,b),v=(T.Y>b.Y?-1:1)*Math.acos(P.copy(b).sub(T).mulScalar(1/w).X),M=(T.Y>X.Y?-1:1)*Math.acos(g.copy(X).sub(T).mulScalar(1/w).X),I[d+1]=new PathPart(PathType.Radial,T,null,w,v,M)):I[d]=new PathPart(PathType.Line,X||new Vector2(R[d],R[d+1]),new Vector2(R[d+2],R[d+3]));y.push(new Path(I,L))}var Y=document.createElement("canvas");Y.width=i.width,Y.height=i.height,this.PathsCanvas=Y;var F=Y.getContext("2d");F.lineCap="round",F.lineWidth=5/n.GlobalScale,F.scale(n.GlobalScale,n.GlobalScale),F.shadowBlur=5*n.GlobalScale;try{F.setLineDash([10/n.GlobalScale])}catch(t){}for(F.shadowColor=F.strokeStyle="#CCCCCC",F.globalAlpha=.15,d=0;d<y.length;++d)y[d].render(F);this.Paths=y,this.Candies=new Array(this.MaxCandies);var A=new Vector2(this.CandyRadius,this.CandyRadius);for(d=0;d<this.MaxCandies;++d)this.Candies[d]=new Candy(A);this.Candies[0].revive(WrapperType.Lemon,n,y[0],this.BaseCandySpeed),this.Candies[1].revive(WrapperType.Apple,n,y[1],this.BaseCandySpeed),this.Candies[2].revive(WrapperType.Blueberries,n,y[2],this.BaseCandySpeed)}return t.prototype.update=function(t){var e=0,i=0,s=0,n=0,a=this.Candies,r=null,h=(a=this.Candies,this.Paths),o=a.length,l=this.InputMan.Tap,p=this.GSpinner,d=this.Spinners,u=d.length,c=.5*this.WrapperRadius,S=d[0].Radius+c,w=p.Radius+S,y=null;this.TotalTimeElapsed+=t,!this.WaitingForNewWave&&this.TotalTimeElapsed>this.TimeToIncreaseSpeed&&(this.WaitingForNewWave=!0),l.justTapped&&this.GSpinner.checkSpin(l.pos),this.GSpinner.update(0,t);var f=[0,0,0,0],C=0,m=0,P=0;for(e=0;e<o;++e)if((r=a[e]).FinishedPath)++m;else{if(!r.Wrapped&&r.Position.collides(r.Radius,p.Position,w))for(i=0;i<u;++i)if(r.Position.collides(.5*r.Radius,d[i].Position,S)){for(y=d[i].Children,s=0;s<y.length;++s)if(r.Type===y[s].Type&&r.Position.collides(.5*r.Radius,y[s].Position,c)){r.Wrapped=!0,r.FinishedPath=!0,++f[i],++P,this.Score+=this.BaseScorePerCandy*this.Wave;break}break}r.update(t)&&!r.Wrapped&&++C}if(this.TotalWrappedAmount+=P,this.CandiesCollected+=P,this.WaitingForNewWave&&m===this.MaxCandies&&(this.WaitingForNewWave=!1,++this.Wave,this.CurrentCandySpeed=this.BaseCandySpeed*(1+.25*(this.Wave-1)),this.TotalTimeElapsed=0),C>0?(this.CandiesCollected=0,this.CandiesLost+=C,this.CandiesLost>this.CandiesToLose[this.CurrentLuck]&&(this.CurrentLuck===LuckLevel.Bad?this.Game.showMenu():(--this.CurrentLuck,this.CandiesLost=0))):this.CandiesCollected>this.CandiesToUp[this.CurrentLuck]&&(this.CandiesCollected=0,this.CurrentLuck=Math.min(this.CurrentLuck+1,LuckLevel.Mega)),!this.WaitingForNewWave&&m>3)for(i=0,e=0;e<3;++e)if(h[e].LastCandy.Position.X>150&&Math.random()<.01)for(;i<this.MaxCandies;++i)if(a[i].FinishedPath){n=Math.random(),a[i].revive(n<.25?WrapperType.Apple:n<.5?WrapperType.Blueberries:n<.75?WrapperType.Lemon:WrapperType.Strawberry,this.SpriteMan,h[e],this.CurrentCandySpeed);break}},t.prototype.render=function(t){var e=0,i=this.Candies,s=i.length,n=this.Context;for(n.setTransform(1,0,0,1,0,0),n.drawImage(this.PathsCanvas,0,0),e=0;e<s;++e)i[e].render(n,t);this.GSpinner.render(n,0,t),n.setTransform(this.SpriteMan.GlobalScale,0,0,this.SpriteMan.GlobalScale,0,0),n.fillStyle="#007FFF",n.font="22px bold marker felt, comic sans ms, arial",n.textBaseline="top",n.shadowBlur=0,n.fillText(Math.floor(this.Score),90,50),n.fillText(this.Wave,90,80),this.SpriteMan.LucksSprites[this.CurrentLuck].drawLabel(n,this.MeterPos,1),this.MeterSize.X=this.CandiesCollected/this.CandiesToUp[this.CurrentLuck]*120,this.MeterBarPos.X=120+.5*this.MeterSize.X,this.MeterSampler.draw(n,this.MeterBarPos,this.MeterSize),n.setTransform(1,0,0,1,0,0)},t}(),CandyWrapper=function(){function t(){this.CurrentTime=0,this.GameLevel=null,this.InputMan=null,this.SpriteMan=null,this.Canvas=null,this.Context=null,this.MenuElement=null,this.MenuElement=document.getElementById("menu"),this.MenuElement.style.width=.4*window.innerWidth+"px",this.MenuElement.style.height=.4*window.innerHeight+"px",this.MenuElement.style.left=.3*window.innerWidth+"px",this.MenuElement.style.top=.1*window.innerHeight+"px";var t=document.getElementById("startBtn");t.style.fontSize=.035*window.innerHeight+"px",t.style.left=.12*window.innerWidth+"px",t.style.bottom=.03*window.innerHeight+"px",document.getElementById("about").style.fontSize=.02*window.innerHeight+"px";var e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.position="absolute",e.style.zIndex="0",e.style.left=e.style.top="0px",document.body.appendChild(e),this.Canvas=e,this.Context=e.getContext("2d");var i=Math.min(e.width,e.height)/720;this.SpriteMan=new SpriteManager(i,new Vector2(e.width,e.height)),this.InputMan=new InputManager(this.Canvas,this.SpriteMan)}return t.prototype.showMenu=function(){this.GameLevel=null,document.body.appendChild(this.MenuElement)},t.prototype.startNewWave=function(t){this.GameLevel=new Level(this,t,this.Canvas,this.Context,this.SpriteMan,this.InputMan,new Vector2(1280,720))},t.prototype.update=function(t){this.Context.fillStyle="#000000",this.Context.setTransform(1,0,0,1,0,0),this.Context.fillRect(0,0,this.Canvas.width,this.Canvas.height),null!==this.GameLevel&&(this.Context.drawImage(this.SpriteMan.BackgroundCanvas,0,0),this.GameLevel.update(t),this.InputMan.update())},t.prototype.render=function(t){null!==this.GameLevel&&this.GameLevel.render(t)},t.prototype.start=function(){var t=this;document.getElementById("startBtn").addEventListener("click",(function(e){document.body.removeChild(t.MenuElement),t.startNewWave(1)})),function e(){window.requestAnimFrame(e);var i=.001*(void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now()),s=i-t.CurrentTime;s>.3&&(s=0),t.CurrentTime=i,t.update(s),t.render(s)}()},t}();window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},window.onload=function(){(new CandyWrapper).start()}</script><div id=menu class=popup><div><p class=about id=about>Press spinners to rotate them so that candies collide with wrapper with matching color.<br><br>Don't forget about LuckMeter. If you miss 5 candies at level 'Bad luck' the game will end.<br><br>Speed of the game will increase every 30 seconds.</div><div id=startBtn class=squareBtn onselectstart=return!1>Start Game</div></div>