<!doctype html><title>Go Back (And Do It Again) - js13kGames 2019</title><meta content="width=device-width,user-scalable=no" name=viewport><meta content=#353449 name=theme-color><style>body{margin:0}canvas{display:block;user-select:none;outline:0;-webkit-tap-highlight-color:rgba(255,255,255,0)}</style><body><script type=module>import*as f from"/2019/webxr/three.js";function o(e){var t;return(n[e]||(t=n[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}var i=[function(e,t,i){i=new((i=i(4))&&i.__esModule?i:{default:i}).default,e.exports={app:i}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=null;t.default=new function e(){if(this instanceof e)return n||(this.bgColorTop=2171169,this.bgColor=3289650,this.wayColor=16777215,this.wayColorOver=6710886,this.wayLength=200,this.scoreColor=16777215,this.scoreColorOff=4473924,this.highscoreColor=16763904,this.colorArr=[[16464330,4731745,10119813],[16632362,2893338,9929070],[2869792,3878197,7641197],[16552229,2965085,10129272],[879356,4401467,6321301],[6560203,7090009,8740278],[16777215,6641467,7631988],[16384024,3491377,11886185]],this.defaultColorArr=[0,2171169,3289650],this.transitionSpeed=2,this.lerpSpeed=.9,this.maxHints=6,n=this),n;throw new TypeError("Cannot call a class as a function")}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=null,o=(function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,[{key:"shuffle",value:function(e){e.sort(function(){return Math.random()-.5})}},{key:"blendColors",value:function(e,t,i){var n=e>>16,o=e>>8&255,r=(e&=255,t>>8&255),a=255&t;return"#"+(16777216+65536*(Math.round(((t>>16)-n)*i)+n)+256*(Math.round((r-o)*i)+o)+(Math.round((a-e)*i)+e)).toString(16).slice(1)}}]),r);function r(){if(this instanceof r)return n=n||this;throw new TypeError("Cannot call a class as a function")}t.default=new o},function(e,t,i){i(0),i(6)()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(5),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).isVRActive=!1,e.time=0,e.prevTime=window.performance.now(),e.renderer=new f.WebGLRenderer({antialias:!0}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.vr.enabled=!0,document.body.appendChild(e.renderer.domElement),document.body.appendChild(f.WEBVR.createButton(e.renderer,{referenceSpaceType:"local"})),e.scene=new f.Scene,e.scene.fog=new f.Fog(l.default.bgColor,0,45),e.camera=new f.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),e.camera.layers.enable(1),window.addEventListener("resize",function(){return e.resize()}),e.animate(),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=s.EventEmitter;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"resize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"animate",value:function(){this.renderer.setAnimationLoop(this.render.bind(this))}},{key:"render",value:function(){var e=window.performance.now(),t=(e-this.prevTime)/1e3;this.prevTime=e,this.time+=t,this.update(t,this.time),this.isVRActive!==this.renderer.vr.isPresenting()&&(this.emit("toggleVR",this.renderer.vr.isPresenting()),this.isVRActive=this.renderer.vr.isPresenting(),this.isVRActive?l.default.lerpSpeed=.75:l.default.lerpSpeed=.9),this.renderer.vr.isPresenting()&&this.inputManager.updateVR(),this.gameManager.update(t),this.synth.update(t),this.renderer.render(this.scene,this.camera)}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.scene.traverse(function(e){"function"==typeof e.update&&e.update(t,i)}),this}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){var n="object"==typeof Reflect?Reflect:null,l=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},o=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}((e.exports=a).EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,i,n){var o,r;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);return void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener||i),o=e._events),r=o[t]),void 0===r?(r=o[t]=i,++e._eventsCount):("function"==typeof r?r=o[t]=n?[i,r]:[r,i]:n?r.unshift(i):r.push(i),0<(o=c(e))&&r.length>o&&!r.warned&&(r.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=r.length,console)&&console.warn),e}function u(e,t,i){return(t=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,l(this.listener,this.target,e))}.bind(e={fired:!1,wrapFn:void 0,target:e,type:t,listener:i})).listener=i,e.wrapFn=t}function p(e,t,i){if(void 0===(e=e._events))return[];if(void 0===(e=e[t]))return[];if("function"==typeof e)return i?[e.listener||e]:[e];if(i){for(var n=e,o=new Array(n.length),r=0;r<o.length;++r)o[r]=n[r].listener||n[r];return o}return f(e,e.length)}function d(e){var t=this._events;if(void 0!==t){if("function"==typeof(t=t[e]))return 1;if(void 0!==t)return t.length}return 0}function f(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if((r=0<t.length?t[0]:r)instanceof Error)throw r;throw(n=new Error("Unhandled error."+(r?" ("+r.message+")":""))).context=r,n}var r=o[e];if(void 0===r)return!1;if("function"==typeof r)l(r,this,t);else for(var a=r.length,s=f(r,a),i=0;i<a;++i)l(s[i],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,u(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,u(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var i,n,o,r,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0!==(n=this._events)&&void 0!==(i=n[e]))if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(o=-1,r=i.length-1;0<=r;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,o=r;break}if(o<0)return this;if(0===o)i.shift();else{for(var s=i,l=o;l+1<s.length;l++)s[l]=s[l+1];s.pop()}1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},a.prototype.removeAllListeners=function(e){var t,i;if(void 0!==(i=this._events))if(void 0===i.removeListener)0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]);else if(0===arguments.length){for(var n,o=Object.keys(i),r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0}else if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?o(this._events):[]}},function(e,t,i){var n=i(0),o=p(i(7)),r=p(i(10)),a=p(i(11)),s=p(i(19)),l=p(i(20)),c=p(i(21)),h=p(i(22)),u=p(i(25));function p(e){return e&&e.__esModule?e:{default:e}}e.exports=function(){n.app.inputManager=new s.default;var e=new a.default,t=(n.app.scene.add(e),new o.default),i=(n.app.scene.add(t),new r.default);n.app.scene.add(i),n.app.gameManager=new l.default({world:t,rewards:i,scoreboard:e}),t=new c.default,n.app.synth=t,i=new h.default,n.app.scene.add(i),e=new u.default,n.app.scene.add(e)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(8)),l=n(i(9));function n(e){return e&&e.__esModule?e:{default:e}}i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).position.y=-1.7,e.tokens=new s.default,e.ways=new l.default,e.add(e.tokens),e.add(e.ways),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=n(i(1)),c=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.tokensInitialPosZ=50,e.position.z=-e.tokensInitialPosZ,e.addTokens(),e.app.on("setCorrectRememberedWay",e.setCorrectRememberedWay.bind(e)),e.app.on("shuffleTokens",e.shuffleTokens.bind(e)),e.app.on("reorderTokens",e.reorderTokens.bind(e)),e.app.on("setStoredTokens",e.setStoredTokens.bind(e)),e.app.on("shuffleStoredTokens",e.shuffleStoredTokens.bind(e)),e.app.on("solve",e.solve.bind(e)),e.app.on("solveRemembering",e.solveRemembering.bind(e)),e.app.on("postSolved",e.postSolved.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"addTokens",value:function(){for(var e=0;e<5;e++){var t=void 0;switch(e){case 0:t=new f.RingBufferGeometry(.25,.35,3);break;case 1:t=new f.RingBufferGeometry(.25,.35,4);break;case 2:t=new f.RingBufferGeometry(.25,.35,5);break;case 3:t=new f.RingBufferGeometry(.25,.35,6);break;case 4:t=new f.RingBufferGeometry(.25,.35,32)}var i=new f.MeshBasicMaterial({color:16777215,side:f.DoubleSide}),n=new f.Mesh(t,i);n.name=e,n.position.x=2*e-4,n.position.y=1.5,this.app.emit("tokenAdded",t,i,e),this.add(n)}this.app.emit("allTokensAdded")}},{key:"setCorrectRememberedWay",value:function(e,t){for(var i=0;i<this.children.length;i++)this.children[i].name===e[t][1][0]&&(this.app.emit("correctWayChanged",(this.children[i].position.x+4)/2),this.app.emit("showCorrectReward",this.children[i].name))}},{key:"shuffleTokens",value:function(){c.default.shuffle(this.children);for(var e=0;e<this.children.length;e++){this.children[e].position.x=2*e-4;var t=l.default.colorArr[e][0];this.children[e].material.color.set(t)}this.app.emit("tokensShuffled",this.children)}},{key:"setStoredTokens",value:function(){this.position.z=this.tokensInitialPosZ/2}},{key:"shuffleStoredTokens",value:function(){this.position.z=-this.tokensInitialPosZ}},{key:"reorderTokens",value:function(e,t,i){for(var n=0;n<this.children.length;n++)this.children[n].name===e[i][0][t][0]&&(this.children[n].position.x=2*t-4,this.children[n].material.color.set(e[i][0][t][1]))}},{key:"solve",value:function(e,t){this.children[e].name===t?this.app.emit("solveOK"):this.app.emit("solveERROR"),this.visible=!1}},{key:"solveRemembering",value:function(e,t){this.children[e].name===this.children[t].name?this.app.emit("solveRememberingOK"):this.app.emit("solveRememberingERROR"),this.visible=!1}},{key:"postSolved",value:function(){this.visible=!0}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.addWays(),e.app.on("startgame",e.startgame.bind(e)),e.app.on("endgame",e.endgame.bind(e)),e.app.on("synth",e.synth.bind(e)),e.countEffect=0,e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"addWays",value:function(){var e=new f.PlaneBufferGeometry(1.9,l.default.wayLength,1,1);e.rotateX(-Math.PI/2);for(var t=0;t<5;t++){var i=new f.MeshBasicMaterial({transparent:!0,opacity:.25,color:l.default.wayColor});(i=new f.Mesh(e,i)).name="way"+t,i.position.x=2*t-4,i.position.y=.1,i.position.z=0,this.add(i)}}},{key:"startgame",value:function(){for(var e=0;e<this.children.length;e++)this.app.inputManager.addCollider(this.children[e])}},{key:"endgame",value:function(){for(var e=0;e<this.children.length;e++)this.app.inputManager.removeCollider(this.children[e])}},{key:"synth",value:function(e){}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0);i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.radius=.05,e.position.z=-.5,e.position.y=-.05,e.addRewards(),e.addErrorReward(),e.visible=!1,e.app.on("showCorrectReward",e.showCorrectReward.bind(e)),e.app.on("resetAtNewCycle",e.resetAtNewCycle.bind(e)),e.app.on("solve",e.solve.bind(e)),e.app.on("solveERROR",e.solveERROR.bind(e)),e.app.on("solveRemembering",e.solve.bind(e)),e.app.on("solveRememberingERROR",e.solveERROR.bind(e)),e.app.on("endgame",e.endgame.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"addRewards",value:function(){for(var e=new f.LineBasicMaterial({color:16777215}),t=0;t<5;t++){var i=void 0;switch(t){case 0:i=this.getRewardGeometry(3);break;case 1:i=this.getRewardGeometry(4);break;case 2:i=this.getRewardGeometry(5);break;case 3:i=this.getRewardGeometry(6);break;case 4:i=this.getRewardGeometry(32)}var n=new f.Line(i,e);n.name=t,this.add(n)}}},{key:"addErrorReward",value:function(){(e=new f.Shape).moveTo(0,-7.5),e.lineTo(-32.5,-40),e.lineTo(-40,-32.5),e.lineTo(-7.5,0),e.lineTo(-40,32.5),e.lineTo(-32.5,40),e.lineTo(0,10),e.lineTo(32.5,40),e.lineTo(40,32.5),e.lineTo(10,0),e.lineTo(40,-32.5),e.lineTo(32.5,-40),e.lineTo(0,-7.5);var e=new f.ShapeGeometry(e),t=new f.MeshBasicMaterial;(e=new f.Mesh(e,t)).scale.set(.02*this.radius,.02*this.radius,.02*this.radius),this.add(e)}},{key:"showCorrectReward",value:function(e){for(var t=0;t<this.children.length;t++)this.children[t].name===e?this.children[t].visible=!0:this.children[t].visible=!1}},{key:"getRewardGeometry",value:function(e){for(var t=new f.Geometry,i=0;i<=e;i++){var n=i/e*Math.PI*2;t.vertices.push(new f.Vector3(Math.cos(n)*this.radius,Math.sin(n)*this.radius,0))}return t}},{key:"resetAtNewCycle",value:function(){this.position.z=-.5,this.visible=!1}},{key:"solve",value:function(){this.scale.set(.1,.1,.1),this.visible=!0}},{key:"solveERROR",value:function(){for(var e=0;e<this.children.length;e++)e===this.children.length-1?this.children[e].visible=!0:this.children[e].visible=!1}},{key:"endgame",value:function(){this.visible=!1}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=n(i(12)),c=n(i(13)),h=n(i(15)),u=n(i(16)),p=n(i(17)),d=n(i(18));function n(e){return e&&e.__esModule?e:{default:e}}i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.position.set(0,1.25,-5),e.startBtn=new l.default,e.startBtn.position.set(0,.2,0),e.add(e.startBtn),e.hints=new c.default,e.hints.position.set(0,1,0),e.hints.visible=!1,e.add(e.hints),e.bigTokens=new h.default,e.bigTokens.position.set(0,.5,0),e.bigTokens.visible=!1,e.add(e.bigTokens),e.score=new u.default,e.score.position.set(0,1.5,0),e.add(e.score),e.playRewPanels=new p.default,e.playRewPanels.position.set(0,.5,0),e.playRewPanels.visible=!1,e.add(e.playRewPanels),e.audioBtn=new d.default,e.audioBtn.position.set(0,2.25,0),e.add(e.audioBtn),e.app.on("startgame",e.startgame.bind(e)),e.app.on("endgame",e.endgame.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"startgame",value:function(){this.startBtn.interactiveObj.visible=!1}},{key:"endgame",value:function(){this.score.visible=!0,this.startBtn.interactiveObj.visible=!0}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function r(){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");var e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));e.app=s.app,e.interactiveObj=new f.Mesh(new f.CircleBufferGeometry(.7,0),new f.MeshBasicMaterial({transparent:!0,opacity:.25,color:l.default.wayColor})),e.interactiveObj.name="start",e.add(e.interactiveObj),e.app.inputManager.addCollider(e.interactiveObj);for(var t=new f.LineBasicMaterial({color:16777215}),i=new f.Geometry,n=0;n<=3;n++){var o=n/3*Math.PI*2;i.vertices.push(new f.Vector3(.85*Math.cos(o),.85*Math.sin(o),0))}return(t=new f.Line(i,t)).rotation.z=Math.PI/64,e.interactiveObj.add(t),e}var e=r,t=f.Object3D;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);for(var i=(e=r).prototype,n=[{key:"update",value:function(){}}],o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}return r}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=n(i(1)),c=n(i(14));function n(e){return e&&e.__esModule?e:{default:e}}i=function(){function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");var e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.app=s.app,e.maxHints=6;for(var t=0;t<l.default.maxHints;t++){var i=new c.default;i.scale.set(.25,.25,.25),i.position.x=.25*t-.62,e.add(i)}return e.app.on("setHints",e.setHints.bind(e)),e.app.on("endgame",e.endgame.bind(e)),e}var e=n,t=f.Group;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);for(var i=(e=n).prototype,o=[{key:"setHints",value:function(e,t,i,n,o){for(var r=0;r<this.children.length;r++)r<n?(this.children[r].visible=!0,2===t&&(e[r]?this.updateHint(r,e[r][1][0],e[r][1][1]):this.updateHint(r,"hidden")),3===t&&(n-i%n-1<r?this.updateHint(r,"hidden"):this.updateHint(r,e[r][1][0],e[r][1][1])),4===t&&(r<o?this.updateHint(r,e[r][1][0],e[r][1][1]):this.updateHint(r,"hidden"))):this.children[r].visible=!1;this.position.x=this.maxHints/2*.25-.25*n/2,this.visible=!0}},{key:"updateHint",value:function(e,t,i){for(var n=0;n<this.children[e].children.length;n++)this.children[e].children[n].name===t?(this.children[e].children[n].visible=!0,"hidden"!==this.children[e].children[n].name&&this.children[e].children[n].material.color.set(i)):this.children[e].children[n].visible=!1}},{key:"endgame",value:function(){this.visible=!1}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}return n}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),(i=i(1))&&i.__esModule,i=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this)),t=new f.CircleBufferGeometry(.35,32),i=new f.MeshBasicMaterial;(t=new f.Mesh(t,i)).name="hidden",e.add(t);for(var n=0;n<5;n++){var o=new f.MeshBasicMaterial,r=void 0;switch(n){case 0:r=new f.RingBufferGeometry(.25,.35,3);break;case 1:r=new f.RingBufferGeometry(.25,.35,4);break;case 2:r=new f.RingBufferGeometry(.25,.35,5);break;case 3:r=new f.RingBufferGeometry(.25,.35,6);break;case 4:r=new f.RingBufferGeometry(.25,.35,32)}(o=new f.Mesh(r,o)).name=n,e.add(o)}return e}var e=a,t=f.Group;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);for(var i=(e=a).prototype,n=[{key:"update",value:function(){}}],o=0;o<n.length;o++){var r=n[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}return a}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0);i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.app.on("tokenAdded",e.tokenAdded.bind(e)),e.app.on("setBigTokens",e.setBigTokens.bind(e)),e.app.on("postSolved",e.postSolved.bind(e)),e.app.on("endgame",e.endgame.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"tokenAdded",value:function(e,t,i){(e=new f.Mesh(e,t)).name=i,this.add(e)}},{key:"setBigTokens",value:function(e){for(var t=0;t<this.children.length;t++)this.children[t].name===e?(this.children[t].visible=!0,this.children[t].material.color.getHexString(),this.app.emit("colorChanged",this.children[t].material.color.getHex(),!1),this.app.emit("setCorrectName",this.children[t].name)):this.children[t].visible=!1;this.visible=!0}},{key:"postSolved",value:function(){this.visible=!1}},{key:"endgame",value:function(){this.visible=!1}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function e(){var i;if(this instanceof e)return(i=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).app=s.app,i.canvas=document.createElement("canvas"),i.canvas.width=512,i.canvas.height=128,i.canvas.style.display="none",document.body.appendChild(i.canvas),i.context=i.canvas.getContext("2d"),i.context.font="bold 72px sans-serif",i.context.textAlign="center",i.hexStr="#"+l.default.scoreColor.toString(16),i.context.fillStyle=i.hexStr,i.actualScore="000",i.context.fillText(i.actualScore,i.canvas.width/2,i.canvas.height/2+32),i.material=new f.MeshBasicMaterial({transparent:!0,depthTest:!1}),i.material.map=new f.CanvasTexture(i.canvas),i.plane=new f.Mesh(new f.PlaneBufferGeometry(4,1),i.material),i.add(i.plane),i.setScore(0,!1),i.app.on("scoreboardchanged",function(e,t){i.setScore(e,t)}),i.app.on("replay",i.replay.bind(i)),i.app.on("play",i.play.bind(i)),i;throw new TypeError("Cannot call a class as a function")}var t=e,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i);for(var n=(t=e).prototype,o=[{key:"replay",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.material.opacity=.15,this.context.font="bold 72px sans-serif",this.context.fillText(this.actualScore,this.canvas.width/2,this.canvas.height/2+32),this.material.map.needsUpdate=!0}},{key:"play",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.material.opacity=1,this.context.font="bold 72px sans-serif",this.context.fillText(this.actualScore,this.canvas.width/2,this.canvas.height/2+32),this.material.map.needsUpdate=!0}},{key:"setScore",value:function(e,t){3<(e=Number(e).toString()).length?e="999":2===e.length?e="0"+e:1===e.length&&(e="00"+e),this.actualScore=e,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),t?(this.material.opacity=1,this.hexStr="#"+l.default.highscoreColor.toString(16),this.context.fillStyle=this.hexStr,this.context.font="bolder 28px sans-serif",this.context.fillText("·YOUR·BEST·",this.canvas.width/2,this.canvas.height/2-42),this.context.font="bolder 96px sans-serif"):(this.material.opacity=.8,this.hexStr="#"+l.default.scoreColor.toString(16),this.context.fillStyle=this.hexStr,this.context.font="bold 72px sans-serif"),this.context.fillText(e,this.canvas.width/2,this.canvas.height/2+32),this.material.map.needsUpdate=!0}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return e}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.canvas=document.createElement("canvas"),e.canvas.width=512,e.canvas.height=128,e.canvas.style.display="none",document.body.appendChild(e.canvas),e.context=e.canvas.getContext("2d"),e.context.font="bold 72px sans-serif",e.context.textAlign="center",e.hexStr="#"+l.default.scoreColor.toString(16),e.context.fillStyle=e.hexStr,e.material=new f.MeshBasicMaterial({transparent:!0}),e.material.map=new f.CanvasTexture(e.canvas),e.plane=new f.Mesh(new f.PlaneBufferGeometry(2,.5),e.material),e.add(e.plane),e.app.on("replay",e.stop.bind(e)),e.app.on("endgame",e.stop.bind(e)),e.app.on("play",e.play.bind(e)),e.app.on("rew",e.rew.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"play",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillText("REPLAY |·",this.canvas.width/2,this.canvas.height/2+32),this.material.map.needsUpdate=!0,this.visible=!0}},{key:"rew",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillText("REW ·|·|",this.canvas.width/2,this.canvas.height/2+32),this.material.map.needsUpdate=!0,this.visible=!0}},{key:"stop",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.material.map.needsUpdate=!0,this.visible=!1}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),l=(i=i(1))&&i.__esModule?i:{default:i};i=function(){function t(){var e;if(this instanceof t)return(e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).app=s.app,e.canvas=document.createElement("canvas"),e.canvas.width=256,e.canvas.height=64,e.canvas.style.display="none",document.body.appendChild(e.canvas),e.context=e.canvas.getContext("2d"),e.context.font="bold 36px sans-serif",e.context.textAlign="center",e.context.beginPath(),e.hexStr="#"+l.default.wayColor.toString(16),e.context.fillStyle=e.hexStr,e.context.strokeStyle=e.hexStr,e.context.lineWidth=6,e.material=new f.MeshBasicMaterial({transparent:!0,opacity:.25}),e.material.map=new f.CanvasTexture(e.canvas),e.plane=new f.Mesh(new f.PlaneBufferGeometry(1,.25),e.material),e.add(e.plane),e.plane.name="audio",e.app.inputManager.addCollider(e.plane),null===window.localStorage.getItem("unboring.js13k.back.audio")?e.audioActive="true":e.audioActive=window.localStorage.getItem("unboring.js13k.back.audio"),e.setAudio(),e.app.on("shuffleAudio",e.shuffleAudio.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=t,i=f.Group;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i);for(var n=(e=t).prototype,o=[{key:"setAudio",value:function(){"true"===this.audioActive?this.on():this.off()}},{key:"shuffleAudio",value:function(){"true"===this.audioActive?this.audioActive="false":this.audioActive="true",this.audioActive!==window.localStorage.getItem("unboring.js13k.back.audio")&&window.localStorage.setItem("unboring.js13k.back.audio",this.audioActive),this.setAudio()}},{key:"on",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillText("AUDIO·ON",this.canvas.width/2,this.canvas.height/2+16),this.context.moveTo(36,60),this.context.lineTo(220,60),this.context.stroke(),this.material.map.needsUpdate=!0,this.visible=!0}},{key:"off",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillText("AUDIO-OFF",this.canvas.width/2,this.canvas.height/2+16),this.context.moveTo(30,60),this.context.lineTo(226,10),this.context.stroke(),this.material.map.needsUpdate=!0,this.visible=!0}},{key:"update",value:function(){}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}return t}(),t.default=i},function(e,t,i){var n=i(0);function o(){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.app=n.app,this.app.on("toggleVR",this.toggleVR.bind(this)),this.iOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),this.raycaster=new f.Raycaster,this.intersected=[],this.tempMatrix=new f.Matrix4,this.mouse=new f.Vector2,this.intersection=null,this.colliders=[],this.swipe={sX:0,sY:0,eX:0,eY:0},this.addControllers(),document.addEventListener("mousemove",this.onDocumentMouseMove.bind(this),!1),document.addEventListener("click",this.onClick.bind(this),!1),document.addEventListener("touchstart",this.onTouchStart.bind(this),!1),document.addEventListener("touchmove",this.onTouchMove.bind(this),!1),document.addEventListener("touchend",this.onTouchEnd.bind(this),!1)}(i=i(1))&&i.__esModule,e.exports=(function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}((i=o).prototype,e=[{key:"toggleVR",value:function(e){this.controller1.visible=e,this.controller2.visible=e}},{key:"addControllers",value:function(){this.controller1=this.app.renderer.vr.getController(0),this.controller1.addEventListener("selectstart",this.onSelectStart.bind(this)),this.controller1.addEventListener("selectend",this.onSelectEnd.bind(this)),this.app.scene.add(this.controller1),this.controller2=this.app.renderer.vr.getController(1),this.controller2.addEventListener("selectstart",this.onSelectStart.bind(this)),this.controller2.addEventListener("selectend",this.onSelectEnd.bind(this)),this.app.scene.add(this.controller2);var e=(new f.BufferGeometry).setFromPoints([new f.Vector3(0,0,0),new f.Vector3(0,0,-1)]),t=new f.LineBasicMaterial({color:16777215});(e=new f.Line(e,t)).name="line",e.scale.z=5,this.controller1.add(e.clone()),this.controller2.add(e.clone())}},{key:"addCollider",value:function(e){e&&this.colliders.push(e)}},{key:"removeCollider",value:function(e){-1!==(e=this.colliders.indexOf(e))&&this.colliders.splice(e,1)}},{key:"addColliders",value:function(e){e.forEach(this.addCollider.bind(this))}},{key:"resetColliders",value:function(){this.colliders=[]}},{key:"onSelectStart",value:function(e){e=e.target,0<(e=this.getIntersections(e)).length&&("start"===e[0].object.name?this.app.emit("startgame"):"audio"===e[0].object.name?this.app.emit("shuffleAudio"):"way"===e[0].object.name.substr(0,3)&&(e=parseInt(e[0].object.name.substr(3,1),10),this.app.emit("wayChanged",e)))}},{key:"onSelectEnd",value:function(){}},{key:"onDocumentMouseMove",value:function(e){e.preventDefault(),e.targetTouches||(this.mouse.x=e.pageX/window.innerWidth*2-1,this.mouse.y=-e.pageY/window.innerHeight*2+1,this.intersection?this.app.renderer.domElement.style.cursor="pointer":this.app.renderer.domElement.style.cursor="default",this.doFallbackRaycast())}},{key:"onClick",value:function(e){e.preventDefault(),e.touches&&this.iOS,this.mouse.x=e.pageX/window.innerWidth*2-1,this.mouse.y=-e.pageY/window.innerHeight*2+1,this.doFallbackRaycast(),this.intersected.length&&("start"===this.intersected[0].name?this.app.emit("startgame"):"audio"===this.intersected[0].name?this.app.emit("shuffleAudio"):"way"===this.intersected[0].name.substr(0,3)&&(e=parseInt(this.intersected[0].name.substr(3,1),10),this.app.emit("wayChanged",e)))}},{key:"doFallbackRaycast",value:function(){this.cleanIntersected(),this.raycaster.setFromCamera(this.mouse,this.app.camera);var e=this.raycaster.intersectObjects(this.colliders);this.intersection=0<e.length?e[0]:null,null!==this.intersection&&((e=this.intersection.object).material.opacity=.5,this.intersected.push(e))}},{key:"onTouchStart",value:function(e){e=e.touches[0],this.swipe.sX=e.screenX,this.swipe.sY=e.screenY}},{key:"onTouchMove",value:function(e){e=e.touches[0],this.swipe.eX=e.screenX,this.swipe.eY=e.screenY}},{key:"onTouchEnd",value:function(e){(this.swipe.eX-60>this.swipe.sX||this.swipe.eX+60<this.swipe.sX)&&this.swipe.eY<this.swipe.sY+60&&this.swipe.sY>this.swipe.eY-60&&0<this.swipe.eX?this.swipe.eX>this.swipe.sX?this.app.emit("wayLeft"):this.app.emit("wayRight"):this.iOS&&this.onClick(e)}},{key:"getIntersections",value:function(e){return this.tempMatrix.identity().extractRotation(e.matrixWorld),this.raycaster.ray.origin.setFromMatrixPosition(e.matrixWorld),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(this.tempMatrix),this.raycaster.intersectObjects(this.colliders)}},{key:"intersectObjects",value:function(e){var t,i;void 0===e.userData.selected&&(t=e.getObjectByName("line"),0<(e=this.getIntersections(e)).length?((i=(e=e[0]).object).material.opacity=.5,this.intersected.push(i),t.scale.z=e.distance):t.scale.z=5)}},{key:"cleanIntersected",value:function(){for(;this.intersected.length;)this.intersected.pop().material.opacity=.25}},{key:"updateVR",value:function(){this.cleanIntersected(),this.intersectObjects(this.controller1),this.intersectObjects(this.controller2)}}]),o)},function(e,t,i){var n=i(0),o=a(i(1)),r=a(i(2));function a(e){return e&&e.__esModule?e:{default:e}}function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");this.app=n.app,this.world=e.world,this.rewards=e.rewards,this.scoreboard=e.scoreboard,this.correctName=0,this.gameStatus=0,this.highscore=window.localStorage.getItem("unboring.js13k.back"),this.highscore,this.app.emit("scoreboardchanged",this.highscore,!0),this.actualWay=2,this.newWay=2,this.correctWay=2,this.targetXpos=0,this.resetGameSettings(),this.app.on("startgame",this.startgame.bind(this)),this.app.on("wayChanged",this.wayChanged.bind(this)),this.app.on("wayLeft",this.wayLeft.bind(this)),this.app.on("wayRight",this.wayRight.bind(this)),this.app.on("correctWayChanged",this.correctWayChanged.bind(this)),this.app.on("tokensShuffled",this.tokensShuffled.bind(this)),this.app.on("setCorrectName",this.setCorrectName.bind(this)),this.app.on("solveOK",this.solveOK.bind(this)),this.app.on("solveERROR",this.solveERROR.bind(this)),this.app.on("solveRememberingOK",this.solveRememberingOK.bind(this)),this.app.on("solveRememberingERROR",this.solveRememberingERROR.bind(this)),this.setDefaultTheme()}e.exports=(function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}((i=s).prototype,e=[{key:"startgame",value:function(){this.resetGameSettings(),this.gameStatus=1,this.app.emit("scoreboardchanged",this.score,!1),this.newCycle()}},{key:"wayChanged",value:function(e){this.newWay=e}},{key:"wayLeft",value:function(){0<this.newWay&&this.app.emit("wayChanged",this.newWay-1)}},{key:"wayRight",value:function(){this.newWay<4&&this.app.emit("wayChanged",this.newWay+1)}},{key:"resetGameSettings",value:function(){this.solved=!1,this.errorOnSolved=!1,this.gameSpeed=10,this.app.emit("speedChanged",this.gameSpeed),this.backSpeed=50,this.cycle=0,this.cyclesPerRound=1,this.caught=0,this.remembered=0,this.tokensStore=[],this.score=0}},{key:"getTargetX",value:function(e){return 2*(4-e)-4}},{key:"newRound",value:function(){5===this.cyclesPerRound?this.cyclesPerRound=1:this.cyclesPerRound+=1,this.gameSpeed+=1,40<this.gameSpeed&&(this.gameSpeed=40),this.app.emit("speedChanged",this.gameSpeed),this.cycle=0,this.caught=0,this.remembered=0,this.tokensStore=[],this.newCycle()}},{key:"newCycle",value:function(){if(this.errorOnSolved)this.gameStatus=5,this.app.emit("wayChanged",2),this.endgame();else{if(this.cycle<this.cyclesPerRound&&this.caught<this.cyclesPerRound)this.app.emit("replay"),this.gameStatus=2,this.app.emit("setHints",this.tokensStore,this.gameStatus,this.cycle,this.cyclesPerRound,this.remembered),this.setCorrectWay(),r.default.shuffle(o.default.colorArr),this.app.emit("shuffleTokens"),this.app.emit("setBigTokens",this.correctWay);else if(this.cycle<2*this.cyclesPerRound&&this.caught===this.cyclesPerRound){this.app.emit("rew"),this.app.emit("colorChanged",0,!0),this.gameStatus=3,this.app.emit("changedToBackSpeed",this.backSpeed);var e=this.cycle%this.cyclesPerRound,e=this.cyclesPerRound-e-1;this.app.emit("setStoredTokens"),this.placeStoredTokens(e),this.app.emit("setHints",this.tokensStore,this.gameStatus,this.cycle,this.cyclesPerRound,this.remembered)}else if(this.cycle>=2*this.cyclesPerRound&&this.remembered<this.caught)this.app.emit("play"),this.gameStatus=4,this.app.emit("speedChanged",this.gameSpeed),this.app.emit("shuffleStoredTokens"),r.default.shuffle(this.tokensStore[this.remembered][0]),this.placeStoredTokens(this.remembered),this.app.emit("setCorrectRememberedWay",this.tokensStore,this.remembered),this.setDefaultTheme(),this.app.emit("setHints",this.tokensStore,this.gameStatus,this.cycle,this.cyclesPerRound,this.remembered);else{if(!(999<=this.score))return void this.newRound();this.gameStatus=6}this.app.emit("resetAtNewCycle"),this.solved=!1,this.world.position.z=0,this.cycle++}}},{key:"catchingTick",value:function(e){this.world.position.z+=this.gameSpeed*e,Math.abs(this.world.position.z)>=o.default.wayLength/4-2&&!this.solved&&(this.app.emit("solve",this.actualWay,this.correctName),this.solved=!0),Math.abs(this.world.position.z)>=o.default.wayLength/4+2&&!this.world.tokens.visible&&this.postSolved(),Math.abs(this.world.position.z)>=o.default.wayLength/4+10&&this.newCycle()}},{key:"backTick",value:function(e){this.world.position.z-=this.backSpeed*e,this.world.position.z<-o.default.wayLength/3&&this.newCycle()}},{key:"rememberingTick",value:function(e){this.world.position.z+=this.gameSpeed*e,Math.abs(this.world.position.z)>=o.default.wayLength/4-2&&!this.solved&&(this.app.emit("solveRemembering",this.actualWay,this.correctWay),this.solved=!0),Math.abs(this.world.position.z)>=o.default.wayLength/4+2&&!this.world.tokens.visible&&this.postSolved(),Math.abs(this.world.position.z)>=o.default.wayLength/4+10&&this.newCycle()}},{key:"gameTick",value:function(e){switch(this.gameStatus){case 2:this.catchingTick(e);break;case 3:this.backTick(e);break;case 4:this.rememberingTick(e)}var t;this.rewards.visible&&(t=f.Math.lerp(2.5,this.rewards.scale.x,o.default.lerpSpeed),this.rewards.scale.set(t,t,t),this.rewards.position.z+=.01)}},{key:"setDefaultTheme",value:function(){var e="#"+o.default.bgColorTop.toString(16);document.querySelector('meta[name="theme-color"]').setAttribute("content",e)}},{key:"setCorrectWay",value:function(){this.correctWay=Math.floor(5*Math.random()),this.app.emit("showCorrectReward",this.correctWay)}},{key:"correctWayChanged",value:function(e){this.correctWay=e}},{key:"tokensShuffled",value:function(e){this.tokensStore[this.caught]=[[],[]];for(var t=0;t<e.length;t++){e[t].position.x=2*t-4;var i=o.default.colorArr[t][0];e[t].material.color.set(i),this.tokensStore[this.caught][0][t]=[e[t].name,i],e[t].name===this.correctWay&&(this.tokensStore[this.caught][1]=[e[t].name,i])}}},{key:"placeStoredTokens",value:function(e){for(var t=0;t<this.tokensStore[e][0].length;t++)this.app.emit("reorderTokens",this.tokensStore,t,e)}},{key:"setCorrectName",value:function(e){this.correctName=e}},{key:"postSolved",value:function(){this.app.emit("postSolved"),this.app.emit("setHints",this.tokensStore,this.gameStatus,this.cycle,this.cyclesPerRound,this.remembered)}},{key:"solveOK",value:function(){this.caught+=1}},{key:"solveERROR",value:function(){this.errorOnSolved=!0}},{key:"solveRememberingOK",value:function(){this.remembered+=1,this.score+=1,this.app.emit("scoreboardchanged",this.score,!1)}},{key:"solveRememberingERROR",value:function(){this.errorOnSolved=!0}},{key:"endgame",value:function(){this.app.emit("endgame"),this.app.emit("wayChanged",2),this.gameSpeed=0,this.app.emit("speedChanged",this.gameSpeed),this.app.emit("colorChanged",0,!0),this.score>Number(this.highscore)&&(this.highscore=this.score,window.localStorage.setItem("unboring.js13k.back",this.score)),this.app.emit("scoreboardchanged",this.highscore,!0),this.setDefaultTheme()}},{key:"update",value:function(e){0<this.gameStatus&&this.gameStatus<5&&this.gameTick(e),this.newWay!==this.actualWay&&(this.actualWay=this.newWay,this.targetXpos=this.getTargetX(this.newWay)),this.targetXpos!==this.world.position.x&&(this.world.position.x=f.Math.lerp(this.targetXpos,this.world.position.x,o.default.lerpSpeed))}}]),s)},function(e,t,i){var n=i(0);function o(){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.app=n.app,window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext||(this.audioContext=new AudioContext),this.gameActive=!1,this.actualTempo=.3,this.backTempo=.1,this.tempo=this.actualTempo,this.counter=0,this.loopSeq=[0,0,14,14,0,0,12,12,0,0,11,11,0,0,12,12,0,14,12,11,12,0,0,9,8,7,0,7,0,7,0,7,0,0],this.reverseSeq=this.loopSeq.slice(0).reverse(),this.errorSeq=[0,16,17,19,19,0],this.okSeq=[0,2,0],this.clickSeq=[0,13,0],this.activeSeq=[],this.sequencePoint=0,this.actualLoopPoint=0,window.localStorage.getItem("unboring.js13k.back.audio")?this.audioActive=window.localStorage.getItem("unboring.js13k.back.audio"):this.audioActive="true",this.app.on("startgame",this.startgame.bind(this)),this.app.on("endgame",this.endgame.bind(this)),this.app.on("solveOK",this.solveOK.bind(this)),this.app.on("solveRememberingOK",this.solveOK.bind(this)),this.app.on("solveERROR",this.solveERROR.bind(this)),this.app.on("solveRememberingERROR",this.solveERROR.bind(this)),this.app.on("play",this.playEvent.bind(this)),this.app.on("rew",this.rew.bind(this)),this.app.on("speedChanged",this.speedChanged.bind(this)),this.app.on("shuffleAudio",this.shuffleAudio.bind(this))}e.exports=(function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}((i=o).prototype,e=[{key:"shuffleAudio",value:function(){"true"===this.audioActive?this.audioActive="false":this.audioActive="true"}},{key:"startgame",value:function(){var e=this.audioContext.createOscillator();"true"===this.audioActive?e.frequency.value=440*Math.pow(1.06,7):e.frequency.value=0,e.connect(this.audioContext.destination),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+this.actualTempo),this.gameActive=!0,this.activeSeq=this.loopSeq,this.sequencePoint=0}},{key:"endgame",value:function(){this.gameActive=!1,this.activeSeq=[]}},{key:"speedChanged",value:function(e){this.actualTempo=.3-Math.min(.2,e/200),this.tempo=this.actualTempo}},{key:"solveOK",value:function(){this.activeSeq=this.okSeq,this.actualLoopPoint=this.sequencePoint,this.sequencePoint=0}},{key:"solveERROR",value:function(){this.activeSeq=this.errorSeq,this.sequencePoint=0}},{key:"playEvent",value:function(){this.tempo=this.actualTempo}},{key:"rew",value:function(){this.tempo=this.backTempo,this.activeSeq=this.reverseSeq,this.activeSeq!==this.reverseSeq&&(this.sequencePoint=0)}},{key:"playNote",value:function(e){var t=this.audioContext.createOscillator();t.frequency.value=440*Math.pow(1.06,12-e),"false"!==this.audioActive&&(t.connect(this.audioContext.destination),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+this.actualTempo))}},{key:"tick",value:function(){this.sequencePoint<this.activeSeq.length?(this.activeSeq[this.sequencePoint]&&(this.playNote(this.activeSeq[this.sequencePoint]),this.app.emit("synth",this.activeSeq[this.sequencePoint])),this.sequencePoint+=1):this.gameActive?this.activeSeq!==this.loopSeq?(this.activeSeq=this.loopSeq,this.sequencePoint=this.actualLoopPoint):this.sequencePoint=0:(this.activeSeq=[],this.sequencePoint=0)}},{key:"update",value:function(e){this.counter+=e,this.counter>this.tempo&&(this.tick(),this.counter=0)}}]),o)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(23)),l=n(i(24)),c=i(0),h=n(i(1)),u=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}i=function(){function n(){var e,t,i;if(this instanceof n)return e=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),t=new f.SphereBufferGeometry(100,64,64),i=new f.ShaderMaterial({uniforms:{colorTop:{type:"c",value:new f.Color(h.default.bgColorTop)},colorBottom:{type:"c",value:new f.Color(h.default.bgColor)}},vertexShader:s.default,fragmentShader:l.default,side:f.BackSide}),e.shpere=new f.Mesh(t,i),e.add(e.shpere),e.app=c.app,e.changingColor=!1,e.count=0,e.prevTopColor=0,e.prevBottomColor=0,e.topColor=0,e.bottomColor=0,e.app.on("resetAtNewCycle",e.resetAtNewCycle.bind(e)),e.app.on("colorChanged",e.colorChanged.bind(e)),e;throw new TypeError("Cannot call a class as a function")}var e=n,t=f.Group;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);for(var i=(e=n).prototype,o=[{key:"resetAtNewCycle",value:function(){}},{key:"colorChanged",value:function(e,t){if(this.changingColor=!0,this.endColor=e,this.prevTopColor=this.shpere.material.uniforms.colorTop.value.getHex(),this.prevBottomColor=this.shpere.material.uniforms.colorBottom.value.getHex(),t)h.default.transitionSpeed=8,this.topColor=h.default.defaultColorArr[1],this.bottomColor=h.default.defaultColorArr[2];else{h.default.transitionSpeed=2;for(var i=0;i<h.default.colorArr.length;i++)h.default.colorArr[i][0]===e&&(this.topColor=h.default.colorArr[i][1],this.bottomColor=h.default.colorArr[i][2])}}},{key:"updateColors",value:function(){this.shpere.material.uniforms.colorTop.value=new f.Color(u.default.blendColors(this.prevTopColor,this.topColor,this.count)),this.shpere.material.uniforms.colorBottom.value=new f.Color(u.default.blendColors(this.prevBottomColor,this.bottomColor,this.count))}},{key:"colorTransitionEnds",value:function(){this.changingColor=!1;var e="#"+this.topColor.toString(16);document.querySelector('meta[name="theme-color"]').setAttribute("content",e),this.count=0}},{key:"update",value:function(){this.changingColor&&(this.count+=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)/10*h.default.transitionSpeed,this.updateColors(),1<=this.count)&&this.colorTransitionEnds()}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}return n}(),t.default=i},function(e,t,i){i.r(t),t.default="#define GLSLIFY 1\nvarying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}"},function(e,t,i){i.r(t),t.default="#define GLSLIFY 1\nuniform vec3 colorTop;\nuniform vec3 colorBottom;\n\nvarying vec3 vWorldPosition;\n\nvoid main()\n{\n\n\tvec3 pointOnSphere = normalize(vWorldPosition.xyz);\n\tfloat f = sin(pointOnSphere.y * 2.0);\n\n\tgl_FragColor = vec4(mix(colorBottom,colorTop, f ), 1.0);\n\n}\n"},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(26)),l=n(i(27)),c=i(0),h=n(i(1)),u=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}i=function(){function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(e.app=c.app,null===e.app.renderer.extensions.get("ANGLE_instanced_arrays"))return p(e);e.currentVector=new f.Vector3,e.audioDistortion=0;var t=e.getGeometry(),i=new f.RawShaderMaterial({uniforms:{time:{value:1},sineTime:{value:1},fogColor:{type:"c",value:new f.Color(h.default.bgColor)},fogFar:{type:"f",value:45},fogNear:{type:"f",value:0}},vertexShader:s.default,fragmentShader:l.default,side:f.DoubleSide,transparent:!0});return e.mesh=new f.Mesh(t,i),e.add(e.mesh),e.changingColor=!1,e.count=0,e.prevFogColor=0,e.fogColor=0,e.app.on("resetAtNewCycle",e.resetAtNewCycle.bind(e)),e.app.on("speedChanged",e.speedChanged.bind(e)),e.app.on("changedToBackSpeed",e.changedToBackSpeed.bind(e)),e.app.on("synth",e.synth.bind(e)),e.app.on("colorChanged",e.colorChanged.bind(e)),e}var e=n,t=f.Group;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);for(var i=(e=n).prototype,o=[{key:"getGeometry",value:function(){var e=new f.CircleBufferGeometry(2,0),t=new f.InstancedBufferGeometry,i=(t.index=e.index,t.attributes.position=e.attributes.position,t.attributes.uv=e.attributes.uv,[]),n=[],o=[],r=new f.Vector4;this.actualSpeed=0,this.totalObjs=300;for(var a=0;a<this.totalObjs;a++){var s=1,l=(s=15*(.5<Math.random()?-1:1),Math.floor(15*Math.random())*(5*Math.random())-4),c=Math.floor(200*Math.random()-100);r.set(s,l,c,0).normalize(),i.push(s,l,c),(s=new f.Quaternion).setFromAxisAngle(new f.Vector3(0,1,0),Math.PI/2),n.push(s.x,s.y,s.z,s.w),o.push(1,1,1)}return this.scaleAttribute=new f.InstancedBufferAttribute(new Float32Array(o),3).setDynamic(!0),this.offsetAttribute=new f.InstancedBufferAttribute(new Float32Array(i),3).setDynamic(!0),this.orientationAttribute=new f.InstancedBufferAttribute(new Float32Array(n),4),t.addAttribute("offset",this.offsetAttribute),t.addAttribute("orientation",this.orientationAttribute),t.addAttribute("scale",this.scaleAttribute),t}},{key:"resetAtNewCycle",value:function(){}},{key:"speedChanged",value:function(e){this.actualSpeed=e}},{key:"changedToBackSpeed",value:function(e){this.actualSpeed=-e}},{key:"synth",value:function(e){this.audioDistortion=e}},{key:"colorChanged",value:function(e,t){if(this.changingColor=!0,this.endColor=e,this.prevFogColor=this.mesh.material.uniforms.fogColor.value.getHex(),t)this.fogColor=h.default.defaultColorArr[2];else for(var i=0;i<h.default.colorArr.length;i++)h.default.colorArr[i][0]===e&&(this.fogColor=h.default.colorArr[i][2])}},{key:"updateColors",value:function(){this.transitionFogColor=new f.Color(u.default.blendColors(this.prevFogColor,this.fogColor,this.count)),this.mesh.material.uniforms.fogColor.value=this.transitionFogColor,this.app.scene.fog.color=this.transitionFogColor}},{key:"colorTransitionEnds",value:function(){this.changingColor=!1,this.count=0}},{key:"update",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=0,i=this.scaleAttribute.count;t<i;t++)this.scaleAttribute.setXYZ(t,3+t/100,.05,1),100<this.offsetAttribute.getZ(t)?this.offsetAttribute.setZ(t,-100):this.offsetAttribute.getZ(t)<-100?this.offsetAttribute.setZ(t,100):this.offsetAttribute.setZ(t,this.offsetAttribute.getZ(t)+10*this.actualSpeed/(this.totalObjs-t/5+t/50));this.scaleAttribute.needsUpdate=!0,this.offsetAttribute.needsUpdate=!0,this.changingColor&&(this.count+=e/10*h.default.transitionSpeed,this.updateColors(),1<=this.count)&&this.colorTransitionEnds()}}],r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}return n}(),t.default=i},function(e,t,i){i.r(t),t.default="precision highp float;\n#define GLSLIFY 1\nuniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec3 offset;attribute vec2 uv;attribute vec4 orientation;attribute vec3 scale;varying vec4 vColor;vec3 applyQuaternionToVector(vec4 q,vec3 v){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}void main(){vColor=vec4 (1.0,1.0,1.0,1.0);vec3 vPosition=applyQuaternionToVector(orientation,position*scale);gl_Position=projectionMatrix*modelViewMatrix*vec4(offset+vPosition,1.0);\n\n}"},function(e,t,i){i.r(t),t.default="precision highp float;\n#define GLSLIFY 1\nuniform float fogNear;uniform float fogFar;uniform vec3 fogColor;varying vec3 vPosition;varying vec4 vColor;void main(){vec4 color=vec4(vColor);gl_FragColor=color;float depth=gl_FragCoord.z/gl_FragCoord.w;float fogFactor=smoothstep(fogNear,fogFar,depth);gl_FragColor=mix(gl_FragColor,vec4(fogColor,gl_FragColor.w),fogFactor);\n\n}"}],n={};o.m=i,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)</script>