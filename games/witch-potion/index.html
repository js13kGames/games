<meta content="width=device-width,maximum-scale=1,user-scalable=no" name=viewport><title>Witch Potion - js13kGames 2025</title><style>:root{font-size:16px}body{background-color:#000;color:#fff;font-family:Courier,monospace}p{margin:8px 0}button{display:block;font-size:inherit;border-radius:8px;user-select:none}button:disabled{background-color:#aaa;text-decoration:line-through}.wh{width:100%;height:100%}.btext{color:#000}.wtext{color:#fff}.flxcr{display:flex;justify-content:center;align-items:center}#game-container{display:flex;justify-content:center;align-items:center}#game{max-width:500px;max-height:1000px;background-color:#ddd;position:relative;overflow:hidden}#primary-resources{margin-top:2px;display:flex;justify-content:space-around}.icon{filter:grayscale(50%);background:#111;border-radius:99px;cursor:default;margin-left:2px;display:inline-block}.calendar-square{width:42px;height:42px;padding:2px;border:1px solid #000;display:inline-block;background:#ddd}.calendar-square-active{background-color:#fff;border-color:#09a}.modal{background:#aaa;width:100%;position:absolute;bottom:64px;height:calc(100% - 174px - 64px);padding:8px;box-sizing:border-box}.hover-desc{position:absolute;top:113px;background:#000;height:64px;width:calc(100% - 16px);padding:8px;color:#fff}.highlight-text{cursor:default}.event-content{padding:8px;background-color:#fff;max-height:calc(100% - 16px);overflow-y:auto}.event-title{display:flex;align-items:center;justify-content:center}.event-title-icon{font-size:32px;text-align:center;width:100%}.event-title-text{font-size:1.5rem;font-weight:700;text-align:center}.event-choice-flex{font-size:.75rem;text-align:left}.event-choice-text{background:#000;padding:2px;text-align:center}.event-chosen-text{background:#ccc;color:#222;padding:2px;text-align:center}.event-next{margin-bottom:8px}.btn-text{color:#000;background:#eee;width:100%;padding:8px;margin:4px 0;font-family:Courier,monospace}.btn-text:active{background-color:#aaa}.primary-resource-column{width:45%}.primary-resource-row{justify-content:space-between;width:100%;border-bottom:1px solid #aaa;box-sizing:border-box;font-size:.9rem;max-height:20px}.garden{padding:0;margin-bottom:8px}.garden-slot{width:calc(100% - 16px);margin:8px;background:#fff}.garden-label{font-weight:700;font-style:italic}.garden-dice-container{display:flex}.garden-dice-list{display:flex;width:calc(100% - 64px)}.garden-dice-result{width:calc(64px);font-size:1.5rem;font-weight:700}.bottom-bar{position:absolute;bottom:0;width:100%;height:64px;background:#ddd}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}.dice{display:inline-block;width:42px;height:42px;background:#fff;border:1px solid #000;border-radius:4px;padding:4px;margin:4px}.moon-anim{font-size:2rem;text-align:center}.favor-meter{border:1px solid #000;text-align:center}.favor-meter-sub{display:flex}.shop{font-size:.75rem}</style><div class=wh id=game-container><div class="wh btext" id=game></div></div><script>function e(e){return structuredClone(e)}function t(e,t){return `<${l} style="filter: hue-rotate(${t}deg)">${e}</${l}>`}let o=[{title:"The Game",icon:"\ud83d\udc08\u200d\u2b1b",children:[{id:"0",type:"ch",p:'"Hello, dear witch.  I am your familiar, the Black Cat.  It is from me that you get your magic.  Ensure you keep me satisfied, lest you risk losing my favor."',choices:[{text:"Continue.",n:"1"},{text:"I already know what to do.",n:"4"}]},{id:"1",type:"d",p:'"I have provided you with a magic dice.  Hover over it to see its faces.  There are three kinds of magic."<br><br>- DICE_FIRE_MAGIC is for fending off your enemies.<br>- DICE_HEART_MAGIC is for affecting people.<br>- DICE_GROW is for growing your garden.',rolls:["1 ANY"],pass:"2",fail:"2"},{id:"2",type:"m",p:'"I am tasking you with running a potion shop: each day you will harvest magical herbs, mix potions, and deal with the many problems of the nearby villagers."<br><br>- You get <b>Herbs</b> by growing them in your garden.<br>- You get <b>Reagents</b> by buying them from a merchant.',n:"3"},{id:"3",type:"m",p:'"Run this shop for <b>1 month</b> and you will have convinced me that you are a competent witch.  Then, and only then, I shall let you keep your magic."',n:"4"},{id:"4",type:"m",p:'"Here are some materials to get you started.  Don\x27t disappoint me."',n:"eIntro"},{id:"eIntro",type:"end"}],vars:{}},{title:"The Wizard",icon:"\ud83e\uddd9\ud83c\udffc\u200d\u2640\ufe0f",children:[{id:"0",type:"ch",p:"An old wizard enters your shop. He challenges you to a duel, promising a great reward.<br><br>If you win: the wizard can teach you a new spell, and you get @A.<br>If you lose, the wizard takes @B.<br><br>You can sense the Black Cat observing you.",choices:[{text:"Accept! This guy's going down.<br>@A",n:"1"},{text:"Reject.",n:"2"}]},{id:"2",type:"m",p:"The wizard leaves.",n:"e"},{id:"1",type:"d",p:"The wizard readies a magic spell!  You raise your hands...",rolls:["@A"],pass:"3",fail:"4"},{id:"3",type:"m",p:"Your spells clash in magnificent glory, and when the smoke clears you stand triumphant! The defeated wizard teaches you a new spell.<br><br>You can feel that the Black Cat appreciates your victory.",mod:["@A","@C"],n:"e"},{id:"4",type:"m",p:"Damn!  His spell was just too much for you to handle.  The smug wizard pockets his earnings before leaving. You feel the Black Cat is displeased.",mod:["-@B","-@C"],n:"e"}],vars:{"@A":{str:"1 EFFECT_FACE_ADD_FIRE"},"@B":{str:"ALL GOLD"},"@C":{str:"1 FAVOR_CAT"}}},{title:"Gnome Thief",icon:"\ud83d\udc68",children:[{id:"0",type:"ch",p:"You wake up this morning to find a small gnome stealing from your garden!  With a fistful of herbs, he spots you and tries to run away as fast as his little feet can carry him.",choices:[{text:"Use your magic to threaten the gnome, but you may damage the herbs...<br>@A",n:"1"},{text:"Entice the gnome to give back the herbs.<br>@B",n:"2"},{text:"Let him take @C, but at least there'll be no ruckus.",n:"fail"}]},{id:"1",type:"d",p:"You raise your hand and aim at the little fellow.",rolls:["@A"],pass:"1pass",fail:"fail2"},{id:"1pass",type:"m",p:"The gnome drops your herbs and runs off, but errant fire damages your garden.<br><br>In his haste, he dropped some gold on the ground.",mod:["-@D","@R1"],n:"e"},{id:"2",type:"d",p:"You call out to the gnome and attempt wrap your words with your magic.",rolls:["@B"],pass:"2pass",fail:"fail2"},{id:"2pass",type:"m",p:"The gnome timidly hands over the herbs and scampers off.<br><br>You notice some coins on the ground. He must have felt bad.",mod:["@R2"],n:"e"},{id:"fail",type:"m",p:"@L",mod:["-@C"],n:"e"},{id:"fail2",type:"m",p:"@L<br><br>The Black Cat is displeased with your failure.",mod:["-@C","-@E"],n:"e"}],vars:{"@A":{str:"FIRE(2)"},"@B":{str:"HEART(1)"},"@C":{str:"HERB(RAND2_4 y)"},"@D":{str:"HERB(1 y)"},"@E":{str:"1 FAVOR_CAT"},"@L":{str:"The gnome slips away with your herbs."},"@R1":{str:"GOLD(5)"},"@R2":{str:"GOLD(9)"}}},{title:"Unfortunate Evil",icon:"\ud83d\udc80",children:[{id:"0",type:"m",p:"Abruptly, an undead creature steps into your shop, raises a bony finger at you, and zaps you with a dark lightning.<br><br>The pain of it causes you to pass out. When you awaken, the creature is gone, but you feel... off.<br><br>Such is the peril of being a witch.",mod:["@A"],n:"e"}],vars:{"@A":{str:"1 EFFECT_REPLACE_CURSE"}}},{title:"Injured Dragon",icon:"\ud83d\udc32",children:[{id:"S",type:"m",p:'A villager rushes into your shop. "My pet dragon!", he says, "He\x27s injured. Can you help?"<br><br>You walk outside to see an irritated, tiny dragon with a gash across his body.  Smoke streams from its nostrils, ready to burn anything that comes too close.',n:"0"},{id:"0",type:"ch",p:"You know you can do this if you can get close.  You can sense the Black Cat observing you.",choices:[{text:"Try to calm the dragon down. @A",n:"1"},{text:"You have @B1; @L2",conditionText:"HAS(@B1)",n:"2a"},{text:"You can mix<br>@B1. @L2",conditionText:"HAS_I(@B1)",n:"2b"},{text:"Sorry, dragons are too dangerous.",n:"3"}]},{id:"1",type:"d",p:"Carefully you step towards the dragon, readying your magic.",rolls:["@A"],pass:"1pass",fail:"1fail"},{id:"1pass",type:"m",p:"Your soothing energy calms the dragon, and he lets you approach. You're able to bandage his wounds.<br><br>You feel like your magic is getting stronger.",mod:["@C","1 EFFECT_FACE_ADD_HEART"],n:"e"},{id:"1fail",type:"m",p:"The angry dragon flails and breaths crazy amounts fire.  You barely manage to escape unscathed!<br><br>The villager rushes him away, shouting about how much you upset his pet.<br><br>After this debacle, you know the Black Cat is very displeased with you.",mod:["-1 FAVOR_CAT"],n:"e"},{id:"2a",type:"m",p:"@L1",mod:["-@B1","@C","@E"],n:"e"},{id:"2b",type:"m",p:"@L1",mod:["-@B2","@C","@E"],n:"e"},{id:"3",type:"m",p:'"Some witch you are!"<br><br>The villager spits at you and leaves with his dragon.<br><br>You can sense the Black Cat\x27s displeasure.',mod:["-@E"],n:"e"}],vars:{"@A":{str:"HEART(1)"},"@B1":{str:"1 POT_DRAGON_SWEAT"},"@B2":{str:"ING(1 POT_DRAGON_SWEAT)"},"@L1":{str:"The angry dragon breaths streams of fire, but the potion protects you as you heal him.  The villager is grateful and rewards you for your effort."},"@L2":{str:"with that you can get close without issue."},"@C":{str:"10 GOLD"},"@E":{str:"1 FAVOR_CAT"}}},{title:"You Have a Cold",icon:"\ud83e\udd27",children:[{id:"0",type:"ch",p:"You feel groggy and sick this morning, and it's a struggle to get out of bed.",choices:[{text:"You're not feeling well, and simply cannot be a proper witch today.",n:"1"},{text:"Drink @A.",conditionText:"HAS(@A)",n:"2"},{text:"Mix @A and drink it.",conditionText:"HAS_I(@A)",n:"3"}]},{id:"1",type:"m",p:"You should feel better soon, but not today.",mod:["1 EFFECT_COLD"]},{id:"2",type:"m",p:"You drink @A and feel better.<br><br>...@L",mod:["-@A","1 EFFECT_GREEN_THUMB"],n:"e"},{id:"3",type:"m",p:"You mix @A and drink it.<br><br>You feel better.<br><br>...@L",mod:["-@B","1 EFFECT_GREEN_THUMB"],n:"e"}],vars:{"@A":{str:"1 POT_COLD_CURE"},"@B":{str:"ING(1 POT_COLD_CURE)"},"@L":{str:"A lot better!  You feel like you can harvest extra today!"}}},{title:"Green Thumbs",icon:"\ud83c\udf31",children:[{id:"0",type:"m",p:"Today is a good day!  You woke up with green thumbs!",mod:["1 EFFECT_GREEN_THUMB"],n:"e"}],vars:{}},{title:"Cursed Robbery!",icon:"\ud83e\uddb9\u200d\u2642\ufe0f",children:[{id:"0",type:"ch",p:'A costumed man dashes into your shop.<br><br>"Give me all your money or I\x27ll curse you!"',choices:[{text:"Cower and give him @A.",n:"1"},{text:"Stand your ground. @B",n:"2"},{text:"Reason with him. @C",n:"3"}]},{id:"1",type:"m",p:"You empty your coffers and give up @A.",mod:["-@A"],n:"e"},{id:"2",type:"d",p:"You raise your hands...",rolls:["@B"],pass:"2pass",fail:"2fail"},{id:"2pass",type:"m",p:"Your spell terrifies the would-be robber, who scurries away, dropping some coins on the floor.",mod:["5 GOLD"],n:"e"},{id:"2fail",type:"m",p:"He has a trick up his sleeve!  He raises his hands and, after a flash, you fall to the ground, feeling ill!<br><br> After a struggle, you are barely able to fend him off and he leaves.",mod:["1 EFFECT_REPLACE_CURSE","-3 GOLD"],n:"e"},{id:"3",type:"d",p:"You raise your hands...",rolls:["@C"],pass:"3pass",fail:"2fail"},{id:"3pass",type:"m",p:"You reason with the man, and he is impressed by your wisdom.  He, miraculously, leaves you with a generous tip.",mod:["10 GOLD"],n:"e"}],vars:{"@A":{str:"ALL GOLD"},"@B":{str:"FIRE(2)"},"@C":{str:"HEART(2)"}}},{title:"Mason",icon:"\ud83e\uddf1",children:[{id:"0",type:"ch",p:"A mason visits you. He offers to upgrade your garden for @D.",choices:[{text:"@L2<br>@A.",conditionText:"HAS(@D)",n:"1a"},{text:"@L2<br>@B.",conditionText:"HAS(@D)",n:"1b"},{text:"@L2<br>@C.",conditionText:"HAS(@D)",n:"1c"},{text:"No thanks.",n:"4"}]},{id:"1a",type:"m",p:"@L1",mod:["-@D","@A"],n:"e"},{id:"1b",type:"m",p:"@L1",mod:["-@D","@B"],n:"e"},{id:"1c",type:"m",p:"@L1",mod:["-@D","@C"],n:"e"},{id:"4",type:"m",p:"He leaves.",n:"e"}],vars:{"@A":{str:"1 BLUEPRINT_SPARKLEWEED"},"@B":{str:"1 BLUEPRINT_BRAMBLEBERRY"},"@C":{str:"1 BLUEPRINT_SPECIALPETAL"},"@D":{str:"5 GOLD"},"@L1":{str:"Before the day is done you have a lovely new addition to your garden."},"@L2":{str:"Build a bed for"}}},{title:"Herb Merchant",icon:"\ud83d\uded2",children:[{id:"0",type:"ch",p:'A traveling merchant visits. "Got a surplus of plants.  I can give ya a good deal."',choices:[{text:"Trade @A1 for<br>@A2.",conditionText:"HAS(@A1)",n:"1"},{text:"Trade @B1 for<br>@B2.",conditionText:"HAS(@B1)",n:"2"},{text:"Decline the offer",n:"e"}]},{id:"1",type:"m",p:"@L",mod:["-@A1","@A2"],n:"e"},{id:"2",type:"m",p:"@L",mod:["-@B1","@B2"],n:"e"}],vars:{"@A1":{str:"GOLD(RAND1_2)"},"@A2":{str:"HERB1(RAND3_4)"},"@B1":{str:"GOLD(RAND2_3)"},"@B2":{str:"HERB2(RAND2_3)"},"@L":{str:"You make the trade."}}},{title:"Attack!",icon:"\ud83d\ude08",children:[{id:"0",type:"ch",p:"A monster is attacking the village! As a witch, it is your duty to help.",choices:[{text:"Fend off the monster with your magic.<br>@A",n:"1"},{text:"Maybe diplomacy will work this time.<br>@B",n:"2"}]},{id:"1",type:"d",p:"You prepare to launch a spell at the monster.",rolls:["@A"],pass:"1pass",fail:"1fail"},{id:"1pass",type:"m",p:"With the villagers help, you manage to fend off the monster.<br><br>@L",mod:["5 GOLD"],n:"e"},{id:"1fail",type:"m",p:"Your spell is not enough, and after a long battle, the monster is finally fended off by the villagers.  Bedraggled and exhausted, you return to your shop.<br><br>The Black Cat is displeased with your performance.",mod:["-@C"],n:"e"},{id:"2",type:"d",p:"With eyes closed, you reach out to the monster's chaotic mind with your magic.",rolls:["@B"],pass:"2pass",fail:"1fail"},{id:"2pass",type:"m",p:"Your spell sooths the monster just enough for you to get it to decide to leave peacefully.<br><br>@L",mod:["@C","7 GOLD"],n:"e"}],vars:{"@A":{str:"FIRE(1)"},"@B":{str:"HEART(2)"},"@C":{str:"1 FAVOR_CAT"},"@L":{str:"The grateful villagers scrounge together a nice reward for you."}}},{title:"Villager Contract",icon:"\ud83d\udcdc",children:[{id:"0",type:"ch",p:"A villager comes to your shop and requisitions a potion:<br><br>@A.",choices:[{text:"Sell the potion for<br>@B.",conditionText:"HAS(@A)",n:"1"},{text:"You can mix it and sell it right now for<br>@B.",conditionText:"HAS_I(@A)",n:"2"},{text:"Say that you'll have the potion ready by next week.",n:"3"}]},{id:"1",type:"m",p:"The villager buys the potion and leaves.",mod:["-@A","@B"],n:"e"},{id:"2",type:"m",p:"The villager buys the potion and leaves.",mod:["-@D","@B"],n:"e"},{id:"3",type:"m",p:"The villager leaves, promising to return next week.",n:"e",mod:["1 CONTRACT_VILLAGER"]}],vars:{"@A":{str:"POT1(1)"},"@B":{str:"9 GOLD"},"@C":{str:"1 FAVOR_CAT"},"@D":{str:"ING(@A)"}}},{title:"Demonic Deal",icon:"\ud83d\udc79",children:[{id:"0",type:"ch",p:'You notice a pair of eyes watching you from the shadows. When you turn to stare, a smiling demon reveals itself.<br><br>"Would you like a deal, my dear?"',choices:[{text:"Add @A1<br>AND<br>add @A2.",n:"1"},{text:"No thanks.",n:"2"}]},{id:"1",type:"m",p:"@L",mod:["@C","@D"],n:"e"},{id:"2",type:"m",p:"It leaves.",n:"e"}],vars:{"@A1":{str:"1"},"@A2":{str:"1 DICE_CURSE"},"@C":{str:"1"},"@D":{str:"1 EFFECT_FACE_ADD_CURSE"},"@L":{str:"The demon snaps its fingers, and you feel something fundamental change within you."}}},{title:"The Black Cat",icon:"\ud83d\udc08\u200d\u2b1b",children:[{id:"0",type:"ch",p:'The Black Cat suddenly appears.<br><br>"Tribute. @A. I demand it."',choices:[{text:"Give the gold to the Black Cat.",conditionText:"HAS(@A)",n:"1"},{text:"Say that you can't.",n:"fail"}]},{id:"1",type:"m",p:'With a mischievous grin, The Black Cat gathers the gold.<br><br>"Much appreciated, now I shall grant you a boon."',mod:["-@A"],n:"ch"},{id:"ch",type:"ch",p:'"What would you like?"'},{id:"fail",type:"m",p:'"I see," The Black Cat says. "Do not disappoint me again. Despite this, I shall grant you a boon. Maybe next time you won\x27t fail."',mod:["-@B"],n:"ch"}],vars:{"@A":{str:"GOLD(RAND2_4)"},"@B":{str:"1 FAVOR_CAT"},"@L1":{str:"The Black Cat's eyes glow"},"@L2":{str:"and new seed bed appears in your garden."}}},{title:"The Final Test",icon:"\ud83d\udc08\u200d\u2b1b",children:[{id:"0",type:"ch",p:'The Black Cat suddenly appears.<br><br>"I have a final test for you.  Demonstrate your magic to me."',choices:[{text:"Cast a threatening fire spell.<br>@A",n:"1"},{text:"Cast a soothing heart spell.<br>@B",n:"2"},{text:"Give the cat the money you've earned, surely @C is enough.",conditionText:"HAS(@C)",n:"3"}]},{id:"1",type:"d",p:"@L1",rolls:["@A"],pass:"1pass",fail:"1fail"},{id:"1pass",type:"m",p:"@L2",n:"e"},{id:"1fail",type:"m",p:"@L3",mod:["-ALL FAVOR_CAT","1 EFFECT_COLD"],n:"e"},{id:"2",type:"d",p:"@L1",rolls:["@B"],pass:"1pass",fail:"1fail"},{id:"3",type:"m",p:'"A bargain?"  The cat makes a gagging sound that could almost have been a laugh.  "Very well, I accept."',mod:["-@C"],n:"e"}],vars:{"@A":{str:"FIRE(3)"},"@B":{str:"HEART(3)"},"@C":{str:"GOLD(10)"},"@L1":{str:"You prepare to cast a spell to impress the Black Cat."},"@L2":{str:'The Black Cat emits a soft purr of satisfaction.  "Very good.  When I return, surely you will be rewarded."'},"@L3":{str:'The fur stands on end as the Black Cat\x27s eyes glow red.  "This is not the work of a true witch."'}}},{title:"Expulsion",icon:"\ud83d\udc08\u200d\u2b1b",children:[{id:"0",type:"ch",p:'The Black Cat appears in front of you and stares you down with disappointed eyes.<br><br>"I now see that you are not worthy of witchhood."<br><br>A tugging, a pulling, a ripping sensation engulfs you, tearing out your insides, eviscerating your soul. You\x27re left unconscious on the ground with nothing.  No gold.  No potions.  No magic.<br><br>You are no longer a witch.',choices:[{text:"Try again.",n:"1"},{text:"Quit.",conditionText:"HAS(999 GOLD)",n:"1"}]},{id:"1",type:"m",mod:["1 EFFECT_RELOAD"]}],vars:{}},{title:"True Witch",icon:"\ud83d\udc08\u200d\u2b1b",children:[{id:"0",type:"ch",p:'"That\x27s enough," says the Black Cat. "I\x27m pleased with you. You may keep your magic."<br><br>Congratulations! You\x27ve completed the game.<br><br>Would you like to play again?',choices:[{text:"Yes.",n:"1"},{text:"No.",conditionText:"HAS(999 GOLD)",n:"1"}]},{id:"1",type:"m",mod:["1 EFFECT_RELOAD"]}],vars:{}}],r={event:{icon:"",title:"",children:[{id:"harvest",type:"garden",p:"You may now harvest your garden."},{re:!0,id:"day",type:"ch",p:"You are at your shop. What would you like to do today?",choices:[{text:"Visit the reagent merchant.",n:"merch"},{text:"Mix potions.",n:"pot"},{text:"View inventory.",n:"inv"},{text:"End the day.",n:"nextDay"}]},{id:"nextDay",type:"end"}]},evalVars:{},currentChildId:"default"},i="div",s="button",a="p",l="span",n="<br>",d="innerHTML",c="click",u=()=>f("game"),h=(e,t)=>{for(let o in t)e.style[o]=t[o]},p=(e,t={},o=[])=>{let r=document.createElement(e);for(let e in t)e===d?r.innerHTML=t[e]:r.setAttribute(e,t[e]);for(let e of o)r.appendChild(e);return r},y=(e,t)=>{e.appendChild(t)},E=e=>{e[d]=""},f=e=>document.getElementById(e),_=(e,t,o)=>{e.addEventListener(t,o)},m=(e,t,o)=>{e.setAttribute(t,o)},A=e=>new Promise(t=>setTimeout(t,e)),R=(e,t)=>{let o=T(t);B(e,o,t),P(e,o,t);let r=e.ui.eventModal;r?Ge(r,o):(r=we(o),y(u(),r.root)),e.ui.eventModal=r,C(e,o,g(o,o.currentChildId))},C=(t,o,i)=>{let s=t.ui.eventModal;if(!s)throw 1;if("end"!==i.type){if(i.p&&(i.p=F(i.p,Je)),i.choices)for(let e of i.choices)e.text=F(e.text,Je),e.parsedCondition||(e.parsedCondition=D(t,o,e.conditionText));if(i.rolls){i.parsedRolls=[];for(let e of i.rolls){let [t,o]=O(e);for(let e=0;e<t;e++)i.parsedRolls.push(o)}}if(i.mod){i.parsedMod=[];for(let e of i.mod){let [r,s]=O(e);99===Math.abs(r)&&(r=Math.sign(r)*Ae(t,s)),i.parsedMod.push({amt:r,resource:s}),le(t,o,i,s,r)}}i.re&&(o=e(r),ne(t,o),de(t,o),ce(t,o),ue(t,o)),Se(s,i,o,t),qe(t.ui.res,t),Ye(t.ui.favorMeter,Ae(t,L.FAV_CAT))}else if("nextDay"===i.id)ie(t);else{if("eIntro"===i.id)return t.day=0,void ie(t,"Tomorrow you start your first day as a witch.");{let o=e(r);if(ne(t,o),de(t,o),ce(t,o),ue(t,o),C(t,o,o.event.children[0]),t.day%7==4||29===t.day||0===Ae(t,L.FAV_CAT)){let e=o.event.children.find(e=>"day"===e.id);if(e){let o="You feel that the Black Cat will visit you tomorrow.";29===t.day&&(o="A sense of urgency fills you! The Black Cat will come to TEST you tomorrow!"),e.p+=`${n}${n}<${l} style="color: brown;">${o}</${l}>`}}}}},g=(e,t)=>{if("e"===t)return {id:"e",type:"end"};let o=e.event.children.find(e=>e.id===t);if(!o)throw 1;return o},T=e=>({event:e,currentChildId:e.children[0].id,evalVars:{}}),b=(e,t,o,r)=>{let i=e=>{let t=(e=>{if(e.includes("RAND")){let t=e.slice(4).split("_"),o=parseInt(t[0]),r=parseInt(t[1]);if(isNaN(o)||isNaN(r))throw 1;return tt(o,r)}let t=parseInt(e);if(isNaN(t))throw 1;return t})(o[0]),s="y"===o[1],a=[];for(;0===a.length&&t>0;)a=s?e.filter(e=>Re(r,e,t)):e,t--;if(0===a.length){if(s&&e[0]!==L.GOLD){let t=[];for(let o=0;o<e.length;o++)t.push(L.GOLD);return i(t)}return [0,L.GOLD]}return [t+1,et(a)]},s={[W.FUNC_H1]:()=>i(x),[W.FUNC_H2]:()=>i(S),[W.FUNC_H3]:()=>i(S),[W.FUNC_H_ANY]:()=>i(G),[W.FUNC_R1]:()=>i(N),[W.FUNC_R2]:()=>i(k),[W.FUNC_R_ANY]:()=>i(H),[W.FUNC_P1]:()=>i(U.filter(e=>e!==L.POT_LIQ)),[W.FUNC_P_ANY]:()=>i(U),[W.FUNC_G]:()=>i([L.GOLD]),[W.FUNC_FIRE]:()=>i([L.DICE_FIR]),[W.FUNC_HEART]:()=>i([L.DICE_HEA]),[W.FUNC_GROW]:()=>i([L.DICE_GRO]),[W.FUNC_ING]:()=>{if(o[0].includes("@"))return [18,e];let [,t]=O(o.join(" "));return [18,te(M[t]).join("|")]}}[t];if(s)return s();throw 1},F=(e,t)=>{let o=e;if(e.includes("<span"))return e;let r={};for(let [e,t]of Object.entries(L))r[t]=e;for(let [e,i]of Object.entries(r)){let r=ee[e];if(!r)throw 1;let s=We(r.l,t);o=o.replaceAll(L[i],`${s}${ee[e].icon}`)}return e=e.replaceAll("Infinity","all"),o},D=(e,t,o)=>{if(!o)return ()=>!0;let r=ot(o,","),i=[];for(let t=0;t<r.length;t++){let o=r[t],s=t=>{let o=I(t,V.HAS_RES);if(!o)return ;let [r,i]=O(o[1].join(" "));return ()=>Re(e,i,r)},a=t=>{let o=I(t,V.HAS_ING);if(!o)return ;let [,r]=O(o[1].join(" ")),i=te(M[r]);return ()=>i.every(t=>{let [o,r]=O(t);return Re(e,r,o)})},l=s(o);l&&i.push(l);let n=a(o);n&&i.push(n)}if(0===i.length)throw 1;return ()=>i.every(e=>e())},v=(e,t)=>{for(let [o,r]of Object.entries(t))e=e.replaceAll(o,r);return e},O=e=>{let t=e.split(" ");if(2===t.length){let e=Ce(t[1]);return t[0].includes("ALL")?["-"===t[0][0]?-99:99,e]:[parseInt(t[0]),e]}return [1,L.GOLD]},I=(e,t)=>{let o=e.match(RegExp(`(${t??".*"})\\(([^)]*)\\)`));if(o){let e=o[1];return "-"===e[0]&&(e=e.slice(1)),[e,ot(o[2]," "),o[0]]}},B=(e,t,o)=>{for(let r in o.vars){let i=o.vars[r];if(i.parsed)continue;let s=I(i.str);if(s){let o=t.evalVars[r];if(o){i.parsed=o;continue}let [a,l,n]=s,[d,c]=b(n,a,l,e),u=d+" "+c;18===d&&(u=c),i.parsed=u,t.evalVars[r]=u}else i.parsed=i.str,t.evalVars[r]=i.str}},P=(e,t,o)=>{for(let e in o.vars){let r=o.vars[e];r.parsed.includes("@")&&(r.str=v(r.str,t.evalVars),delete t.evalVars[e],delete r.parsed)}B(e,t,o);for(let e of o.children){if(e.p&&(e.p=v(e.p,t.evalVars)),e.choices)for(let o of e.choices)o.text=v(o.text,t.evalVars),o.conditionText&&(o.conditionText=v(o.conditionText,t.evalVars));if(e.rolls)for(let o=0;o<e.rolls.length;o++)e.rolls[o]=v(e.rolls[o],t.evalVars);if(e.mod){let o=[];for(let r=0;r<e.mod.length;r++){let i=v(e.mod[r],t.evalVars),s=ot(i,"|"),a="-"===i[0];1===s.length?o.push(i):o.push(...s.map((e,t)=>a&&t>0?"-"+e:e))}e.mod=o}}};var L;!function(e){e.GOLD="GOLD",e.HERB_SPA="HERB_SPARKLEWEED",e.HERB_BRA="HERB_BRAMBLEBERRY",e.HERB_SPE="HERB_SPECIALPETAL",e.REAG_SKY="REAG_SKY_DUST",e.REAG_SUN="REAG_SUN_POWDER",e.POT_COL="POT_COLD_CURE",e.POT_DRA="POT_DRAGON_SWEAT",e.POT_MIA="POT_MIASMA_OF_MIDNIGHT",e.POT_TIN="POT_TINCTURE_OF_TASTE",e.POT_EMP="POT_EMPATHY",e.POT_GRO="POT_GROWTH",e.POT_LIQ="POT_LIQUID_LUCK",e.POT_POW="POT_POWER_POTION",e.POT_ANT="POT_ANTI_CURSE",e.DICE_FIR="DICE_FIRE_MAGIC",e.DICE_HEA="DICE_HEART_MAGIC",e.DICE_GRO="DICE_GROW",e.DICE_CUR="DICE_CURSE",e.DICE_BLA="DICE_BLANK",e.DICE_ANY="ANY",e.DICE_NEW="DICE_NEW",e.BP_SPA="BLUEPRINT_SPARKLEWEED",e.BP_BRA="BLUEPRINT_BRAMBLEBERRY",e.BP_SPE="BLUEPRINT_SPECIALPETAL",e.C_VIL="CONTRACT_VILLAGER",e.FAV_CAT="FAVOR_CAT",e.EFF_COL="EFFECT_COLD",e.EFF_GRE="EFFECT_GREEN_THUMB",e.EFF_FFIR="EFFECT_FACE_ADD_FIRE",e.EFF_FHEA="EFFECT_FACE_ADD_HEART",e.EFF_FGRO="EFFECT_FACE_ADD_GROW",e.EFF_FCUR="EFFECT_FACE_ADD_CURSE",e.EFF_RMCUR="EFFECT_REMOVE_CURSE",e.EFF_REPLCUR="EFFECT_REPLACE_CURSE",e.EFF_REL="EFFECT_RELOAD"}(L||(L={}));let w=[L.DICE_FIR,L.DICE_HEA,L.DICE_GRO],G=[L.HERB_SPA,L.HERB_BRA,L.HERB_SPE],x=[L.HERB_SPA,L.HERB_BRA],S=[L.HERB_SPE],H=[L.REAG_SUN,L.REAG_SKY],N=[L.REAG_SUN],k=[L.REAG_SKY],U=[L.POT_GRO,L.POT_POW,L.POT_LIQ,L.POT_COL,L.POT_DRA,L.POT_MIA,L.POT_TIN,L.POT_ANT],$=[L.BP_SPA,L.BP_BRA,L.BP_SPE],Y={[L.REAG_SUN]:2,[L.REAG_SKY]:3,[L.HERB_SPE]:8},M={[L.POT_GRO]:[L.REAG_SUN,L.REAG_SUN],[L.POT_EMP]:[L.HERB_SPA,L.REAG_SUN],[L.POT_POW]:[L.HERB_SPA,L.HERB_SPA,L.REAG_SUN],[L.POT_LIQ]:[L.HERB_BRA,L.HERB_SPA,L.REAG_SUN,L.REAG_SUN],[L.POT_COL]:[L.HERB_BRA,L.REAG_SKY],[L.POT_DRA]:[L.HERB_SPA,L.HERB_SPE,L.REAG_SKY],[L.POT_MIA]:[L.HERB_SPA,L.HERB_SPA,L.HERB_SPE,L.REAG_SKY],[L.POT_TIN]:[L.HERB_BRA,L.HERB_SPE,L.REAG_SKY],[L.POT_ANT]:[L.HERB_SPE,L.HERB_SPE,L.REAG_SUN,L.REAG_SKY]};var W,V;!function(e){e.FUNC_H1="HERB1",e.FUNC_H2="HERB2",e.FUNC_H3="HERB3",e.FUNC_H_ANY="HERB",e.FUNC_R1="REAG1",e.FUNC_R2="REAG2",e.FUNC_R_ANY="REAG",e.FUNC_P1="POT1",e.FUNC_P_ANY="POT",e.FUNC_G="GOLD",e.FUNC_FIRE="FIRE",e.FUNC_HEART="HEART",e.FUNC_GROW="GROW",e.FUNC_ING="ING"}(W||(W={})),function(e){e.HAS_RES="HAS",e.HAS_ING="HAS_I"}(V||(V={}));let j="\ud83c\udf3f",K="\ud83e\uddf4",Q="\ud83d\udd25",z="\u2665\ufe0f",q=`<${l} style="filter: grayscale(75%)">\ud83d\udc08\u200d\u2b1b</${l}>`,X="\ud83c\udf31",J="\ud83c\udfb2",Z="\ud83d\udc80",ee={[L.DICE_FIR]:{l:"Fire Magic",icon:Q,dsc:"Fends off your enemies."},[L.DICE_HEA]:{l:"Heart Magic",icon:z,dsc:"Guides situations and people."},[L.DICE_GRO]:{l:"Grow",icon:X,dsc:"Grows your magical garden."},[L.DICE_ANY]:{l:"Any",icon:J,dsc:"Any magic dice."},[L.DICE_BLA]:{l:"Blank",icon:"\u2716\ufe0f",dsc:"A blank dice face."},[L.DICE_CUR]:{l:"Curse",icon:Z,dsc:"Auto fails spells."},[L.GOLD]:{l:"Gold",icon:"\ud83d\udcb0",dsc:"Merchants love it."},[L.HERB_SPA]:{l:"Sparkleweed",icon:j,dsc:"A glittery weed."},[L.HERB_BRA]:{l:"Bramberry",icon:t(j,90),dsc:"Magical berries."},[L.HERB_SPE]:{l:"Specialpetal",icon:t(j,248),dsc:"Rare flower for rare potions."},[L.REAG_SKY]:{l:"Sky Dust",icon:"\ud83e\uddea",dsc:"Common dust collected on magical clouds."},[L.REAG_SUN]:{l:"Sun Powder",icon:t("\ud83e\uddea",180),dsc:"Rare ground-up sunbeams."},[L.POT_COL]:{l:"Cold Cure",icon:K,dsc:"Cures colds."},[L.POT_DRA]:{l:"Dragon Sweat",icon:K,dsc:"Antifire."},[L.POT_MIA]:{l:"Night Miasma ",icon:K,dsc:"Sleep potion."},[L.POT_TIN]:{l:"Taste Tinc",icon:K,dsc:"Yummy."},[L.POT_EMP]:{l:"Empathy Pot",icon:K,dsc:"More hearts."},[L.POT_LIQ]:{l:"Liquid Luck",icon:K,dsc:"Grants luck."},[L.POT_POW]:{l:"Power Potion",icon:K,dsc:`Temp ${Q}/${z} dice.`},[L.POT_GRO]:{l:"Growth Pot",icon:K,dsc:"Increases yields."},[L.POT_ANT]:{l:"NoCurse Pot",icon:K,dsc:"Removes curses."},[L.C_VIL]:{l:"Contract",icon:"\ud83d\udcc3",dsc:"A simple request."},[L.FAV_CAT]:{l:"Cat's Favor",icon:q,dsc:"Your standing with the Black Cat."},[L.BP_SPA]:{l:"Seed of Sparkleweed",icon:X,dsc:"Additional Sparkleweed seed bed."},[L.BP_BRA]:{l:"Seed of Bramberry",icon:X,dsc:"Additional Bramberry seed bed."},[L.BP_SPE]:{l:"Seed of Specialpetal",icon:X,dsc:"Additional Specialpetal seed bed."},[L.DICE_NEW]:{l:"Magic Dice",icon:J,dsc:"A new magic dice."},[L.EFF_COL]:{l:"Skip Day",icon:"\ud83e\udd27",dsc:"The day is skipped."},[L.EFF_GRE]:{l:"Green Thumbs",icon:X,dsc:"Your thumbs are bright green."},[L.EFF_FFIR]:{l:"Fire Dice Face",icon:Q,dsc:"A dice face increases your power."},[L.EFF_FHEA]:{l:"Heart Dice Face",icon:z,dsc:"A dice face increases your power."},[L.EFF_FGRO]:{l:"Grow Dice Face",icon:X,dsc:"A dice face increases your power."},[L.EFF_FCUR]:{l:"Curse Dice Face",icon:Z,dsc:"Cursed power inhibits your magic."},[L.EFF_RMCUR]:{l:"Removed Curse",icon:Z,dsc:"Dispelled a curse."},[L.EFF_REPLCUR]:{l:"Curse!",icon:Z,dsc:"A curse replaces a face."},[L.EFF_REL]:{l:"",icon:J,dsc:""}},te=(e,t=!1)=>{let o=[...G,...H],r=[];for(let i of o){let o=e.filter(e=>e===i).length;if(o>0)if(t){let e=ee[i];r.push(`${o}${e.l.slice(0,3)}${e.icon}`)}else r.push(`${o} ${i}`)}return r};for(let e in ee)ee[e].icon=`<${l} class="icon">${ee[e].icon}</${l}>`;for(let e of[...U]){let t=te(M[e],!0);ee[e].dsc+=`${n}<${l} style="font-size: 14px">${t.join(",")}</${l}>`}let oe,re=["Giant Frog","Giant Spider","Medusa","Cyclops","Ogre","Troll","Phoenix","Hydra","Minotaur","Griffon","Golem","Wraith","Demon","Lich","Giant","Wyrm"],ie=(e,t)=>{Se(e.ui.eventModal,{id:"1",type:"m",p:t??"You close up your shop for the day."},{event:e.events[e.day],evalVars:{},currentChildId:"1"},e);let o=p(a,{class:"moon-anim"});y(e.ui.eventModal.content,o);for(let t=0;t<1;t++)y(e.ui.eventModal.content,p("br"));let r=[..."\ud83c\udf15\ud83c\udf15\ud83c\udf15\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf15\ud83c\udf15\ud83c\udf15"];for(let t=0;t<r.length;t++)A(100*t).then(()=>{o[d]=r[t],He(e.ui.eventModal)});e.day++,A(100*r.length).then(()=>{o.remove();let r=p(a,{[d]:"---<br>Day "+e.day});y(e.ui.eventModal.content,r),He(e.ui.eventModal),ve(e.ui.calendar,t?0:e.day-1);let i=Ae(e,L.FAV_CAT);R(e,0===i?oe:e.events[e.day])})},se=e=>et(e),ae=async(e,t,o=!1)=>{let r=[],i=[],s=!1,a="orange";for(let l of e){let e=o?t[0]:se(l.dice);i.push(Le(l.elem,e,600,2).then(()=>{Pe(l.elem,ee[e].icon);let o=t.includes(e)?"green":"red",r=t.includes(e)?"green":"unset";e===L.DICE_CUR&&(s=!0),s&&(o=a,r=a),h(l.elem.root,{borderColor:o,background:r})})),await A(250),r.push(e)}if(await Promise.all(i),s){for(let t of e)h(t.elem.root,{borderColor:a,background:a});for(let e=0;e<r.length;e++)r[e]=L.DICE_CUR}return r},le=(e,t,o,r,i)=>{let s=(t,o)=>{for(let r of e.magicDice)for(let e=0;e<r.length;e++)if(r[e]===t)return r[e]=o,!0;return !1},a=(t,o)=>{if(!s(t,o))if(o===L.DICE_CUR&&t===L.DICE_BLA)s(t,et(w));else{let r=fe();e.magicDice.push(r),s(t,o)}};if(r===L.C_VIL){let o=he(t.event),r=e.events.indexOf(t.event);e.events.splice(r+7,1,o.event)}else r===L.DICE_NEW?e.magicDice.push(Ee()):r===L.EFF_RMCUR?a(L.DICE_CUR,L.DICE_BLA):r===L.EFF_FFIR?a(L.DICE_BLA,L.DICE_FIR):r===L.EFF_FHEA?a(L.DICE_BLA,L.DICE_HEA):r===L.EFF_FGRO?a(L.DICE_BLA,L.DICE_GRO):r===L.EFF_FCUR?a(L.DICE_BLA,L.DICE_CUR):r===L.EFF_REPLCUR?a(et([L.DICE_FIR,L.DICE_HEA,L.DICE_GRO]),L.DICE_CUR):r===L.EFF_COL?A(1).then(()=>{ie(e,"Time drags on...")}):r===L.EFF_REL?window.location.reload():(me(e,r,i),$.includes(r)&&(e.vars.avblBlueprints=e.vars.avblBlueprints.filter(e=>e!==r)))},ne=(e,t)=>{let o=[],r={...Y};for(let [e,i]of Object.entries(r))o.push({text:`<b class="shop">Buy 1 ${e} (${i} ${L.GOLD})</b>`,n:"buy_"+e,conditionText:`HAS(${i} ${L.GOLD})`}),t.event.children.push({id:"buy_"+e,type:"m",p:`You buy ${e} for ${i} ${L.GOLD}.`,mod:[`-${i} ${L.GOLD}`,"1 "+e],n:"merch",fastScroll:!0});for(let r of G)e.res.includes(r)&&(o.push({text:`<b class="shop">Sell 1 ${r} (1 ${L.GOLD})</b>`,n:"sell_"+r}),t.event.children.push({id:"sell_"+r,type:"m",p:`You sell 1 ${r} for 1 ${L.GOLD}.`,mod:["-1 "+r,"1 "+L.GOLD],n:"merch",re:!0,fastScroll:!0}));o.push({text:"Go back.",n:"day"}),t.event.children.push({id:"merch",type:"m",p:'"Whaddya want?"',choices:o,fastScroll:!0})},de=(e,t)=>{let o=[],r={...M};for(let [i,s]of Object.entries(r)){let r=te(s);Ae(e,i),o.push({text:`${i}:${n}${r.join(n)}`,n:"b_"+i,conditionText:r.map(e=>`HAS(${e})`).join(",")}),t.event.children.push({id:"b_"+i,type:"m",p:`You make a ${i}.`,mod:[...r.map(e=>"-"+e),"1 "+i],n:"pot", re:!0,fastScroll:!0})}o.push({text:"Go back.",n:"day"}),t.event.children.push({id:"pot",type:"ch",p:"At the mixing table you can concoct magical potions.",flex:!0,choices:o,fastScroll:!0})},ce=(e,t)=>{let o=U.map(t=>({res:t,count:Ae(e,t)}));t.event.children.push({id:"inv",type:"m",p:"Here's what you have:"+o.map(e=>` ${n}${e.res} (${e.count})`).join(""),n:"day"})},ue=(e,t)=>{e.magicDice.some(e=>e.some(e=>e===L.DICE_CUR))&&(t.event.children.find(e=>"day"===e.id).choices.push({text:`Use 1 ${L.POT_ANT} to remove a curse.`,n:"noc",conditionText:`HAS(1 ${L.POT_ANT})`}),t.event.children.push({id:"noc",type:"m",p:"You down the potion in one gulp, and feel much better.",mod:["-1 "+L.POT_ANT,"1 "+L.EFF_RMCUR],n:"day",re:!0}))},he=e=>{let t=e.vars["@A"].parsed;return T({title:"The villager returns",icon:"\ud83d\udcdc",children:[{id:"0",type:"ch",p:"The villager from last week returns to collect their promised potion:"+n+t,choices:[{text:"Sell them the potion.<br>(7 GOLD)",n:"1",conditionText:`HAS(${t})`},{text:"Mix the potion for them.",n:"3",conditionText:`HAS_I(${t})`},{text:"Say you cannot help. The Black Cat will be most displeased.",n:"2"}]},{id:"1",type:"m",p:"You sell the potion to the villager.",mod:["-"+t,"7 GOLD"],n:"e"},{id:"3",type:"m",p:"You mix and sell the potion to the villager.",mod:[...te(M[t.split(" ")[1]]).map(e=>"-"+e),"7 GOLD"],n:"e"},{id:"2",type:"m",p:"The disappointed villager leaves.",mod:["-2 "+L.FAV_CAT],n:"e"}]})},pe=t=>{let o=e(t),r=o.children.find(e=>"ch"===e.id),i=[L.EFF_FFIR,L.EFF_FHEA,L.EFF_FGRO];r.choices=[{text:`1 ${L.EFF_FFIR}.`,n:"dice0"},{text:`1 ${L.EFF_FHEA}.`,n:"dice1"},{text:`1 ${L.EFF_FGRO}.`,n:"dice2"},{text:`1 ${L.POT_ANT}.`,n:"pot"}];for(let e=0;e<i.length;e++)o.children.push({id:"dice"+e,type:"m",p:"The Black Cat's eyes glow, and you feel a new power within you.",mod:["1 "+i[e]],n:"e"});let s='"Perhaps a wise choice."';return o.children.push({id:"pot",type:"m",p:s,mod:["1 "+L.POT_ANT],n:"e"},{id:"fav",type:"m",p:s,mod:["2 "+L.FAV_CAT],n:"e"}),o};addEventListener("load",async()=>{let t=ye();window.state=t;let r=De(31);y(u(),r.root),t.ui.calendar=r;let i=ze();t.ui.res=i,y(u(),i.root),qe(i,t);let s=je();y(u(),s.root),Ke(s,L.DICE_FIR),t.ui.hoverDescription=s;let a=Te();y(u(),a.root),t.ui.favorMeter=a.favorMeter,((t,o)=>{let r=e=>o.find(t=>t.title===e),i=r("The Game"),s=r("Villager Contract"),a=r("The Black Cat"),l=r("Demonic Deal"),n=r("Attack!"),d=r("Herb Merchant"),c=r("The Final Test"),u=r("True Witch");oe=r("Expulsion");let h=[i,s,a,l,n,d,c,u,oe],p=o.filter(e=>!h.includes(e)),y=[];for(let t=0;t<7;t++){let o=t<3||t<6?1:2,r=et(re),i=e(n);for(let e of i.children)e.p=e.p?.replace("monster","<b>"+r+"</b>");i.vars["@A"]={str:`FIRE(${o})`,parsed:void 0},p.push(i),y.push(i)}for(let t=0;t<4;t++){let t=e(d);p.push(t)}let E=[L.EFF_FFIR,L.EFF_FHEA,L.EFF_FGRO],f=[L.DICE_FIR,L.DICE_HEA,L.DICE_GRO];for(let t=0;t<3;t++){let t=e(l),o=et(E),r=f[E.indexOf(o)];t.vars["@C"]={str:"1 "+o,parsed:void 0},t.vars["@A1"]={str:"1 "+r,parsed:void 0},p.push(t)}let _=(e=>e.sort(()=>Math.random()-.5))(p),m=0;for(let e=0;e<_.length;e++)_[e].title===n.title&&(_[e]=y[m],m++);for(let t=0;t<4;t++){let o=e(s);_.splice(4*t+tt(0,6),0,o)}for(let e=0;e<4;e++){let t=pe(a);_.splice(7*e+4,0,t)}let A=e(i);A.children.slice(-2)[0].mod=["3 "+L.GOLD,"1 "+L.HERB_SPA,"1 "+L.HERB_BRA,"1 "+L.REAG_SKY,"1 "+L.REAG_SUN,"1 "+L.POT_LIQ];let R=[A,..._].slice(0,30);R.push(c,u),t.events=R})(t,o),t.day=0,ve(t.ui.calendar,0);for(let e=0;e<3;e++)t.res.push(L.FAV_CAT);R(t,t.events[0])});let ye=()=>{let e={events:[],day:0,res:[],magicDice:[Ee()],harvestRoll:[],ui:{},vars:{avblBlueprints:[L.BP_SPE]}};return e.res.push(L.BP_SPA,L.BP_BRA),e},Ee=()=>[L.DICE_FIR,L.DICE_FIR,L.DICE_HEA,L.DICE_HEA,L.DICE_GRO,L.DICE_GRO],fe=()=>{let e=[];for(let t=0;t<6;t++)e.push(L.DICE_BLA);return e},_e=()=>{let e=[];for(let t=0;t<6;t++)e.push(L.DICE_GRO);return e},me=(e,t,o)=>{let r=Math.abs(o);for(let i=0;i<r;i++)if(o>0)e.res.push(t);else{let o=e.res.indexOf(t);-1!==o&&e.res.splice(o,1)}},Ae=(e,t)=>e.res.filter(e=>e===t).length,Re=(e,t,o)=>Ae(e,t)>=o,Ce=e=>{for(let t of Object.values(L))if(e===t)return t;throw 1},ge=e=>{switch(e){case L.BP_SPA:return L.HERB_SPA;case L.BP_BRA:return L.HERB_BRA;case L.BP_SPE:return L.HERB_SPE;default:throw 1}},Te=()=>{let e=p(i,{class:"bottom-bar flxcr"}),t=$e();return y(e,t.root),Ye(t,5),{root:e,favorMeter:t}},be="calendar-square-active",Fe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],De=e=>{let t=p(i,{});h(t,{width:48*e+"px"});let o=p(i,{});h(o,{transition:"transform 0.3s ease-in-out"}),y(t,o);for(let t=0;t<e;t++){let e=p(i,{class:"calendar-square",[d]:`${t+1}. ${Fe[t%7]}`});y(o,e)}return {root:t,subRoot:o,day:0}},ve=(e,t)=>{e.day=t-1,Oe(e)},Oe=e=>{e.day++,e.subRoot.style.transform=`translateX(-${48*e.day}px)`;let t=e.subRoot.children[e.day];t&&t.classList.add(be);let o=e.subRoot.children[e.day-1];o&&o.classList.remove(be)},Ie=`<${l} class="icon">\u2753</${l}>`,Be=(e,t,o=Ie)=>{let r=p(i,{class:"dice"}),s=()=>{Qe(e.ui.hoverDescription,t)};_(r,c,s),_(r,"mouseover",s);let a=p(i,{class:"flxcr wh",[d]:o});return y(r,a),{root:r,subRoot:a}},Pe=(e,t)=>{e.subRoot[d]=t},Le=(e,t,o,r)=>new Promise(i=>{h(e.root,{animation:`spin ${o/r}ms linear ${r}`}),Pe(e,Ie),setTimeout(()=>{h(e.root,{animation:""}),Pe(e,t),i()},o)}),we=e=>{let t=p(i,{id:"event-modal",class:"modal"}),o=p(i,{class:"event-content btext"}),r={root:t,content:o,choices:p(i,{class:"event-next"}),next:p(i,{class:"event-next"}),diceButtons:[],diceElements:[]};return Ge(r,e),y(o,r.choices),y(o,r.next),y(t,r.content),r},Ge=(e,t)=>{let {content:o}=e,r=t.event.icon;if("\ud83d\udc08\u200d\u2b1b"===r&&(r=q),r){let e=p(i,{class:"event-title-icon",[d]:r});y(o,e)}if(t.event.title){let e=p(a,{class:"event-title-text",[d]:t.event.title});y(o,e)}},xe=(e,t)=>{let o=F(t.resource,Je),r=t.amt>0,i=isNaN(t.amt)?"all":t.amt,s=Ue(`${r?"+"+i:i} ${o}`);y(e,s)},Se=(t,o,r,i)=>{let {content:n,choices:u,next:f}=t;E(f),f.remove(),E(u),u.remove();let A=p(a,{[d]:o.p});if(y(n,A),"garden"===o.type){let e=Me(i,r);y(n,e.root)}if(o.rolls){let s=o.parsedRolls[0]===L.DICE_ANY,c=p(a,{[d]:s?"Try it out!":"To pass: "});y(n,c);for(let e of o.parsedRolls){let t=p(l,{[d]:ee[e].icon});y(c,t)}t.diceElements=[];let u=e(i.magicDice);for(let e=0;e<i.magicDice.length;e++){let o=Be(i,u[e]);t.diceElements.push(o),y(n,o.root)}ke(t,o,r,i,{isAny:s,diceToRoll:u}),y(n,f)}if(o.parsedMod)for(let e of o.parsedMod)xe(n,e);if(o.n){let e=p(s,{class:Xe,[d]:"e"===o.n?"Done":"Next"});_(e,c,()=>{let e=g(r,o.n);C(i,r,e)}),y(f,e),y(n,f)}if(o.choices){o.flex&&h(u,{display:"flex",flexWrap:"wrap",gap:"2px"});for(let e of o.choices){let t=!e?.parsedCondition(),a={class:Xe,[d]:e.text};t&&(a.disabled="disabled");let l=p(s,a);o.flex&&(m(l,"class",Xe+" event-choice-flex"),h(l,{width:"49%",textDecoration:"none"})),_(l,c,()=>{let t=Ue(e.text);y(n,t);let o=g(r,e.n);C(i,r,o)}),y(u,l)}y(n,u)}He(t,!o.fastScroll)},He=(e,t=!0)=>{e.content.scrollTo({top:e.content.scrollHeight,behavior:t?"smooth":"auto"})},Ne=async(e,t,o,r,i)=>{let {content:s,diceButtons:l,diceElements:n}=e;for(let e=0;e<l.length;e++)l[e].disabled=!0;let c=i.diceToRoll.slice(),u=await ae(c.map((e,t)=>({dice:e,elem:n[t]})),r.parsedRolls,i.useLuck),h=!0;for(let e of r.parsedRolls){let t=u.indexOf(e);if(-1===t){h=!1;break}u.splice(t,1)}A(1e3).then(()=>{let e=p(a,{[d]:i.isAny?"":h?"Pass!":"Fail!"});y(s,e),i.useLuck&&(me(o,L.POT_LIQ,-1),xe(s,{amt:-1,resource:L.POT_LIQ})),i.usePower&&xe(s,{amt:-1,resource:L.POT_POW}),i.useEmpathy&&xe(s,{amt:-1,resource:L.POT_EMP});for(let e=0;e<l.length;e++)l[e].remove();let n=g(t,h?r.pass:r.fail);C(o,t,n)})},ke=(e,t,o,r,i)=>{let a={isAny:i.isAny,useLuck:!1,useDouble:!1,usePower:!1,useEmpathy:!1,diceToRoll:i.diceToRoll};e.diceButtons=[];let {next:l}=e,u=p(s,{class:Xe,[d]:"Roll."});_(u,c,()=>{Ne(e,o,r,t,a)}),y(l,u),e.diceButtons.push(u);let h=Ae(r,L.POT_LIQ),E=Ae(r,L.POT_POW),f=Ae(r,L.POT_EMP);if(!i.isAny){if(h>0){let i=ee[L.POT_LIQ],u=`Use a ${i.l}${i.icon}${n}(all rolls meet reqs).`,h=p(s,{class:Xe,[d]:u});_(h,c,()=>{Ne(e,o,r,t,{...a,useLuck:!0})}),y(l,h),e.diceButtons.push(h)}if(E>0){let t=`Use a ${Ve(L.POT_POW,Je)}${n}(1 additional dice).`,o=p(s,{class:Xe,[d]:t});_(o,c,()=>{o.disabled=!0;let t=(()=>{let e=[];for(let t=0;t<6;t++)e.push(t<3?L.DICE_FIR:L.DICE_HEA);return e})(),i=Be(r,t,"\u2728");e.diceElements.push(i),e.content.insertBefore(i.root,e.next),a.diceToRoll.push(t),me(r,L.POT_POW,-1),a.usePower=!0}),y(l,o),e.diceButtons.push(o)}if(f>0){let t=Ve(L.DICE_GRO,Je),o=Ve(L.DICE_HEA,Je),i=`Use a ${Ve(L.POT_EMP,Je)}<br>(tmp convert ${t} to ${o}).`,n=p(s,{class:Xe,[d]:i});_(n,c,()=>{n.disabled=!0,me(r,L.POT_EMP,-1);for(let e=0;e<a.diceToRoll.length;e++){let t=a.diceToRoll[e];for(let e=0;e<t.length;e++)t[e]===L.DICE_GRO&&(t[e]=L.DICE_HEA)}for(let t=0;t<e.diceElements.length;t++)e.diceElements[t].subRoot[d]=z;a.useEmpathy=!0}),y(l,n),e.diceButtons.push(n)}}},Ue=e=>p(a,{[d]:e,class:"event-chosen-text wtext"}),$e=()=>{let e=p(i,{class:"favor-meter"}),t=p(i,{[d]:"Black Cat's Favor"});y(e,t);let o=p(i,{class:"favor-meter-sub"});return h(e,{width:"168px"}),y(e,o),{root:e,subRoot:o}},Ye=(e,t)=>{E(e.subRoot);for(let o=0;o<Math.min(7,t);o++){let t=p(i,{[d]:q});y(e.subRoot,t)}},Me=(e,t)=>{let o=(e=>e.res.filter(e=>$.includes(e)))(e),r=p(i,{class:"garden"}),l=[],n=[],u=Ae(e,L.EFF_GRE)>0;for(let t of o){let o=p(i,{class:"garden-slot"}),s=ee[t],a=p(i,{[d]:s.l,class:"garden-label"}),n=p(i,{class:"garden-dice-container"}),c=p(i,{class:"garden-dice-list"}),u=p(i,{class:"garden-dice-result flxcr"});y(o,a),y(o,n),y(n,c),y(n,u),y(r,o);let h=[...e.magicDice],E=[];for(let t=0;t<h.length;t++){let o=Be(e,h[t]);E.push(o),y(c,o.root)}l.push({magicDice:h,diceList:E,type:t,resultArea:u,gardenDiceList:c})}if(u){let e=ee[L.EFF_GRE],t=p(a,{class:Xe,[d]:`Your ${e.l}${e.icon} will let you harvest double.`});h(t,{width:"calc(100% - 8px)"}),y(r,t)}let E=p(s,{class:Xe,[d]:"Harvest"});if(_(E,c,async()=>{for(let e of n)e.disabled=!0;me(e,L.EFF_GRE,-1);let o=[];for(let e of l)o.push(ae(e.magicDice.map((t,o)=>({dice:t,elem:e.diceList[o]})),[L.DICE_GRO]));let i=await Promise.all(o),s=u?2:1,a=((e,t,o=1)=>{let r=[];for(let i of t){let t=i.diceResults.filter(e=>e===L.DICE_GRO).length;r.push(t*o);for(let r=0;r<t*o;r++)e.res.push(i.resourceType)}return qe(e.ui.res,e),r})(e,i.map((e,t)=>({resourceType:ge(l[t].type),diceResults:e})),s);for(let e=0;e<a.length;e++)l[e].resultArea[d]="+"+a[e];await A(1e3);for(let e of n)e.remove();let c=Ue("Harvest");y(r,c),C(e,t,t.event.children[1])}),y(r,E),n.push(E),Ae(e,L.POT_GRO)>0){let t=Ve(L.DICE_GRO,Je),o=`Use a ${Ve(L.POT_GRO,Je)}<br>(adds 1 all ${t} dice).`,i=p(s,{class:Xe,[d]:o});_(i,c,()=>{me(e,L.POT_GRO,-1);for(let t of l){let o=_e(),r=Be(e,o,X);t.diceList.push(r),t.magicDice.push(o),y(t.gardenDiceList,r.root)}i.disabled=!0}),y(r,i),n.push(i)}return {root:r,slots:l,harvestButtons:n}},We=(e,t)=>{let o=`hl('${(e=>{let t=e.lastIndexOf(">");t>-1&&(e=e.slice(t+1));for(let t in ee)if(ee[t].l.toLowerCase()===e.toLowerCase())return t})(e)}', this)`;return `<${l} class="highlight-text" style="color: ${t};" ontouchstart="${o}" onclick="${o}" onmouseover="${o}" onmouseout="${o}" >${e}</${l}>`};window.hl=(e,t)=>{let o=document.getElementsByClassName("highlight-text");for(let e of o)h(e,{"text-decoration":"none"});h(t,{"text-decoration":"underline"});let r=window.state.ui.hoverDescription;Ke(r,e)};let Ve=(e,t)=>{let o=ee[e];return We(o.l,t)+o.icon},je=()=>({root:p(i,{class:"hover-desc"})}),Ke=(e,t)=>{let o=ee[t];E(e.root);let r=p(l,{class:"hover-desc-label",[d]:o.l+o.icon+": "});y(e.root,r);let i=p(l,{class:"hover-desc-dsc",[d]:o.dsc});y(e.root,i)},Qe=(e,t)=>{E(e.root);let o=p(i,{class:"flxcr"});h(o,{height:"48px"});for(let e of t){let t=ee[e],r=p(i,{class:"dice flxcr",[d]:t.icon});h(r,{display:"inline-flex"}),y(o,r)}y(e.root,o)},ze=()=>{let e=p(i,{id:"primary-resources"}),t=p(i,{class:"primary-resource-column"});y(e,t);let o=p(i,{class:"primary-resource-column"});return y(e,o),{root:e,herbRoot:t,otherRoot:o}},qe=(e,t)=>{E(e.herbRoot),E(e.otherRoot);for(let o of G){let r=ee[o],s=p(i,{class:"flxcr primary-resource-row"},[p(i,{[d]:We(r.icon+r.l,"#1b631b")+": "}),p(i,{[d]:Ae(t,o)+""})]);y(e.herbRoot,s)}let o=[...H,L.GOLD];for(let r of o){let o=ee[r],s=p(i,{class:"flxcr primary-resource-row"},[p(i,{[d]:We(o.icon+o.l,"#009")+": "}),p(i,{[d]:Ae(t,r)+""})]);y(e.otherRoot,s)}},Xe="btn-text wtext",Je="#02a",Ze=()=>Math.random(),et=e=>e[Math.floor(Ze()*e.length)],tt=(e,t)=>Math.floor(Ze()*(t-e+1))+e,ot=(e,t)=>e.split(t).map(e=>e.trim())</script>