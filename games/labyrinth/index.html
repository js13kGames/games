<!doctype html><title>Labyrinth - js13kGames 2012</title><style>body,html{padding:0;margin:0;background:#222}#c{position:relative;margin:0 auto;width:0;padding-top:100px}#fps{position:fixed;bottom:0;left:0}</style><div id=c></div><p id=fps><script>var t,i,x=16,w=320,I=480,k=function(e,t){var i,s,a,r,A,h=0;return{start:function(){(s=t.createElement("canvas")).setAttribute("height",w),s.setAttribute("width",I),(i=t.getElementById("c")).style.width=I+"px",i.appendChild(s),a=s.getContext("2d"),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},t.onkeydown=function(t){r.onkeydown&&r.onkeydown(t)},t.onkeyup=function(t){r.onkeyup&&r.onkeyup(t)},function n(){var t=(new Date).getTime(),o=(t-(A||t))/100;A=t,e.requestAnimFrame(function(){var t,e,i,A;r.update(o),t=s.width,e=s.height,i=function(t,e){s.width=s.width,t.clearRect(0,0,I,w),r.draw(t,e)},(A=document.createElement("canvas")).width=t,A.height=e,i(A.getContext("2d")),t=A,a.drawImage(t,0,0),n()}),10===h&&(parseInt(1/(o/10),10),h=0),h++}()},setScene:function(t,e){t.reset(),r?setTimeout(function(){r=t},e||400):r=t}}}(window,window.document),C=function(){"use strict";var n,o,s,a;return{reset:function(){n=0,o="<LABYRINTH/>",a=!(s='press "s" to start')},update:function(t){n<100?n+=7*t:a=!0},draw:function(t,e){if(t.fillStyle="#666",t.fillRect(0,0,I,w),t.textAlign="center",t.fillStyle="rgba(255, 255, 0, 0.9)",t.font="40px Georgia bold",t.fillText(o,240,n),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.strokeText(o,240,n),a){t.font="13px Helvetica",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText(s,240,130),t.fillText("TOP 5",240,170);for(var i=R.get(),A=0;A<i.length;A++)t.fillText(A+1+") "+i[A].username+" - "+i[A].points+" p.",240,190+20*A)}},onkeydown:function(t){83===t.keyCode&&a&&(s="LOADING...",k.setScene(e,2e3))}}}(),e=function(){"use strict";var h,d,y,l,g,c,m,u,f,p;return{reset:function(){10<(h=(prompt("Insert your name")||"PLAYER 1").toUpperCase()).length&&(h=h.substring(0,10)),u=3,y=d=0,function i(){p&&clearInterval(p),f=0,p=setInterval(function(){f++},1e3);var A=!1,n=(l=[],g=new S({type:"player",data:{img:new Image,imgc:0,died:!1},w:x,h:x,y:x,x:x,draw:function(t,e){try{t.drawImage(this.data.img,this.x,this.y)}catch(t){}},update:function(t){this.data.died?this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAjBJREFUOI2lk09I03EYxj/f775zThs6l87/MSczkywTk4qiFXookEC6d7OmB7106Fx26FCHNOzSoYNgeSujIjEPUSShEgqJ/5k6ZepaqZvb79vBVhJJYs/1fd7nfV7e5xWNvgba2jto9DWwF4idCrsVlNvJjb4GWptuaIC29o5dCSiTyWSyzk3HAFGS5tbD/ddpqj2q778aFDuJbHenfHVXY568x5wtdOjBgTvU1Gby+tM0d+sv6UI7fHce4sNK8Neqf4rKNA+MzYepqxec89o44skkz2EhtzyA/eJxTrsN3JGoDobW9PjElAZof/Dwt4PIvOLt52QuZ0sCM6tsFjiZDUdYGFqkeLKP2wPLNFdk0Pn8HR9Xv1HlqtAREWExGCTL4RCyr+sRecnFDM3GiRsG/sA6pdmKwNIaV2oq6b5Vj7MgnQl7HJVqZik4QrUq4En3U2y2DC3LKnPwnvnCiSKJSZkYHQuRog1Ca+u03OthrH8YqwH2lTilHk1n0wXcWZrDKYrUWHwrB82njumqihlAkZ9kxh+AryOS/IyTeK+VM9rVR+/L94gkcGXvJ2d5A9fBEnLf9AoF4LWV4VqdxHognXA0hikEViE4PzeIvDmKMAyqHZkUpaVhiW6QuzCVFPP7NwFE4qYtyqLNRg8y1YyzR4GUILaupw0DYbEglcKIRMAwkFYrRjiMAmh99kKLn2R0lA1AKgVCsG98/K9xTwze8Rf+lcAExF6/MAH5X93ADya+zRsLM6D3AAAAAElFTkSuQmCC":0!=this.mx||0!=this.my?(1<this.data.imgc?this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAkJJREFUOI2Fk0tIlFEUx3/fPBubh/o1PkemsRnNURvKRUZZUGFJYmQ7adkDg6ggAktypCjIja4KatfCTQZBCRY9KLLoRVgr6SX5maPJOD6m1Jk5rUaU8fFfnXsv53fuPf9zYQVtd9lkpXMA3VKbTQd9ssWWIdWVhQQb9VJdmL4sSEkGJ/fvk7/hHjwFKseO5vP+c5QnL8OUFhuYnJnl5p0E/eGIsiwAoG6TXdpa3ZgVPeORf/T0DhObUzBbdGhDOt69cROfmuD1ZP98nn4hYFZJBP3ZKqozzu8IBHxpTEwLfo+ZNfa16G2/MOhjfNGmW5M5hmRQU4GcOKTyTRvE+N3Cg1cxqopUSv0mXvSasNtDOBzC22hi6SZusLo4e2MUbSxOZ6eCdchDbMRAx60p4l/ddN23Yx0LwB/DIsD8Kj2azRFvIY+ej9BcH6Ckcj2v+wYp0TI4H6zDdN3MTGgSZ54Zhpewo2lHQGpyXNJ35biEu9ukwueTuPZQKks2ys+7V2Wgo1HczpwUO/UALRWbZWdVDi2fPqINjOKYiLPX46LYGMGVsBAaGOHc7Xv0hcZSbJyXL9MiZjdCGpKpN0lteYFsy8+S2rICWWcyCy6deMu8K09m84WLggEBRYyKXhrKigSQrfl+mXt2TS7vKk0BLBrlmJIgK2bFohqZ08V5Gtew2M0Ma4N0tXfjsOemFE15U335HrElYCg6zuMfHwA4deY0KirB9kvL9yCp3Qeqxas6pSg3T+obDq/6G1OvpCirV1mg/wHt0PiG7DTJAAAAAElFTkSuQmCC":this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAj5JREFUOI2Vk01I03EYxz/uv797yza3FrVZODd1raVBShEJSa03ErMgCIpREdGhQx0qyUOz6CBE4KEOXaIuFUQdejESlEwtCju0W7mspjkQnbpNc62nk5LMGX1PD8+P74eH5/v8YBFtKTLJYu8AmoWaTQ1uqTJbJLDJQ+iUIjtLCnKC8maLk4Htkkm24y62cTTopC+c4uWrMXxlWhLpNDduz/ApnsjLCQDY7SuQ65dd6BUN4xPTtHUPk06DwaAwHNPS3eVAkpP0Jj7P+ZR5NJ1cKrfbsNkzRMdgg9dIIiWsKdGjNRnQFQ6iaDOEo8nQrEc7W+ytRo7X24gMRQn363nWk2Gz24rfr9LRpcNqjWE0CQMTvxdeolNZydmbo3yN/eL+PQVLzIMmnk/rrSl0gy4ePjazdKQSdVI3DzA3QanFhyUTp+fNDI0NfkqrVvE2HMMXjXAmVIe2RUt6PI2qTucKBA56K+R9c1Diz6/JerdH5MdT2ej1SuTBFRlqPS2FqHJonUv6OzvnYs2Kpdpmksb9ezApCttqnHS8HmJ0OsXdd308GflO25Fd9LYPEvrwMctL2VqPaFyqmFVVAl6HVK9YJgGvQ6xKvqBHDC6NuKzG3NfZXOMTed0itcWVAsjhinIxKqpAnqAgF86dzzLPO2WzdTV3rj7iy0AE3ZJ8Xvz8Roo0epsWR8ZCcmYq9wL/VmPTRQEEkB0lVXLMH5B9/tp/fqwsBU8Epdi+XNx2m9QEtv4/AKDuQL04y4pymv8A2HDV/VfJbN4AAAAASUVORK5CYII=",this.data.imgc+=t,2<this.data.imgc&&(this.data.imgc=0)):this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAldJREFUOI2lU11Ik1EYfr6zTz912zfndFOXs/ybP3MznIZgbP1AUV4ssh8vEiqCqKAf6jIppbuCuoko6CJIIaLWRTcZWSQimSUJFokZzaygzySHzc18unI4Z930XJ33nPM+53nehwOsgHP797EuO5+tHievttnYUGDj4pnBYFCFEGKxlpY2BpwKZWHC6RNmTIUjCD5cgMsVhk4s4OYdGYOTWsJ9AJCXFtY8Cw4eSEV+VgaMMzLKKycQieoghAyvNwLLsJ9kFN0f++JEYinBrac/0dujBxnD7JyEde4cyDoBiyoQ8K9CdsU76OWBBAW6xUVdtYltrTJ+zc8iLY241z8Dk5yBOreC2G8DQl812HPnMfwtgg+feT7JwvoCPbqea6gtlfHgkYSJMQWZk+noH3mP6SEn5k3psDv0mA0JAN/jCuIW1DkXSqIluBtUkRMuw8ldzdjUWIEfbxy40r4THpsHutBqVFvjgSSjY6OPlwNbyb5rDPjcnOq/zSPbN/D+peNk90U2ZlmSuhNSOPvkmbS52MSmF2WoElaYtVH4HTZI4xquv36F3ilNLCeIY6Czi4cbCgk9aIXC9m1edjZv4o3dPjYVOQiARc4UBo8dWtnDmdq1DHW0cId3DQEQAE+5aujUmwmARkXm4IUWtrtL/j6EakceHUaVqYpgeiFYXJNJm0uhZATNaQZ67MkTTPA0/OmLpMyoOFq/BVWxcowNTYNvFeytqodPrYSxzJ30qLx8YxQTGAnbYI9l4iUg7fEHqI1PIhh9DPQg6S+sjBQkSM0uzf1H+P+JP0dK00lbBx1dAAAAAElFTkSuQmCC"},onCollision:function(t,e){"block"==t.type||!A&&"exit"==t.type?"right"==e.side?this.x=e.other.x-this.w:"left"==e.side?this.x=e.other.x+e.other.w:"bottom"==e.side?this.y=e.other.y-this.h:"top"==e.side&&(this.y=e.other.y+e.other.h):A&&"exit"==t.type?(y+=e=(e=20*(++d+1)-f)<10?10:e,i()):"key"==t.type?(m.hidden=!0,A=!0):"enemy"!=t.type||this.data.died||(this.data.died=!0,this.mx=0,this.my=0,u--,setTimeout(function(){u?i():(alert("GAME OVER\nYOUR SCORE IS "+y),R.save(h,y),k.setScene(C))},2e3))}}),l.push(g),c=B.get(20,30),new Image);n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAALlJREFUOI2l09EKhSAMBuBZU0oK68Zn7Nm7KpUiiDp34ixWcXa1n+xLaYphGE5gyjlHstaaZJymiXsfvPck7/v+DQghkHwcBwUQkQWWZSFZKUWBfMETUJblf0BeWNc1u8BaS3LbthQQQrBAVVUkG2Mo0Pc9CzRNE/txHGHbNgpIKVkgPeLdxx6BrutiXxTFFfjyF/Kp/Azk5wcAwPNk7xLM8xz7fKwBXtyFdPbvdot3alrpDtd1vTz/AXBkWA0AB1iPAAAAAElFTkSuQmCC";for(var t,e=0;e<c.length;e++)for(var o=0;o<c[e].length;o++)"x"==c[e][o]?t=new S({type:"block",w:x,h:x,x:o*x,y:e*x,draw:function(t,e){try{t.drawImage(n,this.x,this.y)}catch(t){}}}):"e"==c[e][o]&&(t=new S({type:"exit",w:x,h:x,x:o*x,y:e*x,draw:function(t,e){if(A)t.fillStyle="rgb(0, 0, 0)";else try{t.drawImage(n,this.x,this.y)}catch(t){}t.fillRect(this.x,this.y,this.w,this.h)}})),l.push(t);var s,a=B.getFreePoint(c);m=new S({type:"key",x:a.p2*x,y:a.p1*x,draw:function(t,e){try{var i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAQtJREFUOI2dkyFyxDAMRb86BoELC8siWFgY2CMU5gg+RmGOYLhHCMwRDAX2AIGFAZ5qwdZb2U7aTv+MZxRFepZ/HMCImRW/6LCGmXWLL5oLmFntIiKqawDA5eJp3AqYfQYAH/rPHE/jBh9YRYRcPUluHF4fyzzW3cmp3rVuvL1cABkAAMu8wocOIkIA8JBrRIR86LDMK57fPkqADPecbS4A9QQWYuNp3IovcQdYxfPpTznAeGCnyLJ+LPNaHIGISFW1AGRIHtXKhw4AivP/KGbW+f2puTi1dj04Av4bEGNEPJ92Ic1NdM65lFKyuWXir6hr4A2gbgZuBqaUcLm0Bu46SkTU998/D3Ds/hUe7YepByhS5QAAAABJRU5ErkJggg==",t.drawImage(i,this.x,this.y)}catch(t){}}}),l.push(m);for(var r=0;r<d;r++)s=B.getFreePoint(c),s=new S({type:"enemy",data:{img:new Image,imgc:0},w:x,h:x,y:s.p1*x,x:s.p2*x,mx:3,my:3,draw:function(t,e){try{t.drawImage(this.data.img,this.x,this.y)}catch(t){}},update:function(t){1<this.data.imgc?this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAUdJREFUOI2NkiFvwzAQhb+kVVRYBRUGBhoe7E8o7B+YFBhYGFhYOBg4WFgYeNDQsHCw0GCSB1anSZpuOymS3/neyzvfJUyirnfBGNNjay2n0zmZ1r0MkTKIlMF7H7z3wblLaNsmvKpPZ8iIlGy3Py6KYouIUNe7WZF0SFZ1HI8fEY8KjTGIlE8i6TSxWq1+a+/3Fup6R9s2AKi6WREDIxfpnThKqjq6zgJwvXaoKtZaVB0yEVlGQlXtERGKYst+f+jJf8UyHqy1iMiIpKr9narDqEMBC8lIQNUlQIB3pksUHc6RYQKA2VF1DVyaT3Z6+/9GDsNfymAgVJMJwGCM/rAJ/lKGs6xDlmUZQBVJ3e1Z9LB5iJ1lHQz031nWYbFYLKoBHjqIGAZTgMcDNXoLb/B1f7RRzLXxtF0xl+d5Hv+W53k+dBnrvgHx2qTUfj2olwAAAABJRU5ErkJggg==":this.data.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAWBJREFUOI19kqGS4zAQRJ+2FgQGBoad2YntQMODhvmEQMNAw8CFCwMPBgoaDhQ0XHjQUGjngC2XnHLSVS5rpOlWT5ccG2jbxrz3Sx1j5PPz7rZ6NyFSmUhlKSVLKdkwBLvdOtvqfXtCRqSiricXx2ONiNC2jTnn3FMBkcpUB67Xv7leiXvv+fj49fPSAcBut3s13usR2rbhdusAUB02RTwseSwCbdusQlId6PsIwPd3j6oSY0R1QAqR95JwPp8QEY7HmtPpspBf4b0sYoyIyIqkqsuZ6oDXAQUiuEcHDjD44vERZYePZCgWJUSqVR59PRL6RNCRryccAFKo7C57m5xMXwqVebDzXN9lb+lysBTmS/IiXQ7mYdV8Bsv7pUDuS5eDvdGPAIQ+rWbLCH1a1Y2OdLKfRr3+w82W6XQkgvNgkoOd/53sCTpd9GcmNzo6mAkUyTrn3G+zn3KvfHkZ+ew/IWC+AIZ1gg4AAAAASUVORK5CYII=",this.data.imgc+=t,2<this.data.imgc&&(this.data.imgc=0)},onCollision:function(t,e){"block"!=t.type&&"exit"!=t.type||("right"==e.side?(this.x=e.other.x-this.w,e.intersection&&!E.random(0,10)&&(this.mx=-this.mx)):"left"==e.side?(this.x=e.other.x+e.other.w,e.intersection&&!E.random(0,10)&&(this.mx=-this.mx)):"bottom"==e.side?(this.y=e.other.y-this.h,e.intersection&&!E.random(0,10)&&(this.my=-this.my)):"top"==e.side&&(this.y=e.other.y+e.other.h,e.intersection)&&!E.random(0,10)&&(this.my=-this.my))}}),l.push(s)}()},update:function(t){for(var e=0;e<l.length;e++){for(var i=l[e],A=0;A<l.length;A++){var n,o=l[A];i.equals(o)||(n=i.collides(o))&&(!i.collision||i.collision.min<n.min)&&(i.collision=n,i.onCollision(o,n))}i.update(t)}},draw:function(t,e){t.fillStyle="#BBB",t.fillRect(0,0,I,w);for(var i=0;i<l.length;i++)l[i].draw(t,e);t.font="10px Helvetica",t.fillStyle="rgba(255, 255, 255, 1)",t.fillText('"'+h+'"',10,11),t.fillText("LEVEL "+d,110,11),t.fillText("TIME "+f,210,11),t.fillText("LIVES "+u,310,11),t.fillText("POINTS "+y,410,11)},onkeydown:function(t){27===t.keyCode?k.setScene(C):g.data.died||38!==t.keyCode?g.data.died||40!==t.keyCode?g.data.died||37!==t.keyCode?g.data.died||39!==t.keyCode||(g.mx=5):g.mx=-5:g.my=5:g.my=-5},onkeyup:function(t){38!==t.keyCode&&40!==t.keyCode||(g.my=0),37!==t.keyCode&&39!==t.keyCode||(g.mx=0)}}}(),S=function(t){t=t||{},this.id=E.getId(),this.type=t.type||"",this.x=t.x||0,this.y=t.y||0,this.h=t.h||x,this.w=t.w||x,this.mx=t.mx||0,this.my=t.my||0,this.drawf=t.draw,this.updatef=t.update||function(){},this.collision=null,this.onCollision=t.onCollision||function(){},this.data=t.data||{},this.hidden=t.hidden||!1},B=(S.prototype.draw=function(t,e){this.hidden||this.drawf(t,e)},S.prototype.collides=function(t){var e,i,A,n,o,s=this,a=s.x<=t.x+t.w&&t.x<=s.x+s.w&&s.y<=t.y+t.h&&t.y<=s.y+s.h;return a?((i=t.x+t.w-s.x)<(e=1/0)&&(side="left",e=i),(A=s.x+s.w-t.x)<e&&(side="right",e=A),(n=t.y+t.h-s.y)<e&&(side="top",e=n),(o=s.y+s.h-t.y)<e&&(side="bottom",e=o),{collision:a,intersection:s.x<t.x+t.w&&t.x<s.x+s.w&&s.y<t.y+t.h&&t.y<s.y+s.h,other:t,left:i,right:A,top:n,bottom:o,side:side,min:e}):null},S.prototype.equals=function(t){return this.id===t.id},S.prototype.update=function(t){this.updatef(t=1<t?1:t),this.x=this.x+this.mx*t,this.y=this.y+this.my*t,this.x<=0&&(this.x=0),this.x>=I-this.w&&(this.x=I-this.w),this.y<=0&&(this.y=0),this.y>=w-this.h&&(this.y=w-this.h),this.collision&&(this.collision=null)},{get:function(n,o){"use strict";for(var s=[],t=0;t<n;t++){for(var e=[],i=0;i<o;i++)e[i]="x";s[t]=e}for(var A=!(s[1][1]="p"),a=1,r=1,h=1,d=1,y=0,l=[];!A;){var g=function(t,e,i){try{var A;if(0==t&&"x"==s[e-2][i]&&"x"==s[e-1][i+1]&&"x"==s[e-1][i-1]&&(A={x:e-1,y:i}),1==t&&"x"==s[e+2][i]&&"x"==s[e+1][i+1]&&"x"==s[e+1][i-1]&&(A={x:e+1,y:i}),2==t&&"x"==s[e][i-2]&&"x"==s[e-1][i-1]&&"x"==s[e+1][i-1]&&(A={x:e,y:i-1}),function(t){if(t&&0<t.x&&0<t.y&&t.x<n-1&&t.y<o-1){for(var e=0,i=-1;i<=1;i++)for(var A=-1;A<=1;A++)"p"==s[t.x+i][t.y+A]&&e++;return e<=2}}(A=3==t&&"x"==s[e][i+2]&&"x"==s[e-1][i+1]&&"x"==s[e+1][i+1]?{x:e,y:i+1}:A))return A}catch(t){}return!1}(E.random(0,3),a,r);g?(l.push(g),a=g.x,r=g.y,h=g.x,d=g.y,s[a][r]="p",y=0):l.length&&(a=(g=l[E.random(0,l.length-1)]).x,r=g.y,y++),500<y&&(A=!0,s[h][d]="e")}for(t=0;t<s.length;t++)s[t]=s[t].join().replace(/,/g,"");return s},getFreePoint:function(t){for(;;){var e=E.random(0,t.length-1),i=E.random(0,t[0].length-1);if("p"==t[e][i])return{p1:e,p2:i}}}}),R=(i=JSON.parse(localStorage.getItem("LSCORES")||JSON.stringify([{username:"ANTONIO",points:200},{username:"ANTONIO",points:100},{username:"ANTONIO",points:50},{username:"ANTONIO",points:30},{username:"ANTONIO",points:10}])),{save:function(t,e){i.push({username:t,points:e}),i.sort(function(t,e){return e.points-t.points}),5<i.length&&(i=i.slice(0,5)),localStorage.setItem("LSCORES",JSON.stringify(i))},get:function(){return i}}),E=(t=0,{getId:function(){return t++},random:function(t,e){return Math.floor(Math.random()*(e-t+1))+t}});k.setScene(C),k.start()</script>