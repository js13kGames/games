<title>Oggy's Curse - js13kGames 2025</title><body><script>let t=Math.PI;function i(t,i=1){return(t%i+i)%i}function s(t,i=0,s=1){return t<i?i:s<t?s:t}function e(t,i,e){return(e-=i)?s((t-i)/e):0}function h(t,i,s,e=r()){return 2*Math.abs(t.x-s.x)<i.x+e.x&&2*Math.abs(t.y-s.y)<i.y+e.y}function a(t=1,i=0){return i+Math.random()*(t-i)}function n(t=0){return Math.floor(a(2,t))}function r(t=0,i){return"number"==typeof t?new d(t,null==i?t:i):new d(t.x,t.y)}function o(t=0){var i=new d;return i.x=.001*Math.sin(t),i.y=.001*Math.cos(t),i}function c(t){return t.x**2+t.y**2}function u(t,i){return(t.x-i.x)**2+(t.y-i.y)**2}function l(t){var i=t.length();return 1<i?t.scale(1/i):t}function g(t,i){return 0<=t.x&&0<=t.y&&t.x<i.x&&t.y<i.y}class d{constructor(t=0,i=0){this.x=t,this.y=i}set(t=0,i=0){return this.x=t,this.y=i,this}F(){return new d(this.x,this.y)}add(t){return new d(this.x+t.x,this.y+t.y)}D(t){return new d(this.x-t.x,this.y-t.y)}multiply(t){return new d(this.x*t.x,this.y*t.y)}Y(t){return new d(this.x/t.x,this.y/t.y)}scale(t){return new d(this.x*t,this.y*t)}length(){return c(this)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new d(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(-t);return t=Math.sin(-t),new d(this.x*i-this.y*t,this.x*t+this.y*i)}setDirection(t,s=1){return r((t=i(t,4))%2?t-1?-s:s:0,t%2?0:t?-s:s)}direction(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}toString(){}}function f(t=0,e=0,h=1){var a=new y,n=(t=i(t,1),e=s(e),h=s(h),(t,s,e)=>6*(e=i(e,1))<1?t+6*(s-t)*e:2*e<1?s:3*e<2?t+(s-t)*(4-6*e):t);return a.r=n(h=2*h-(e=h<.5?h*(1+e):h+e-h*e),e,t+1/3),a.l=n(h,e,t),a.b=n(h,e,t-1/3),a.a=1,a}function x(t){return(255*s(t.r)|0)+(255*s(t.l)<<8)+(255*s(t.b)<<16)+(255*s(t.a)<<24)}class y{constructor(t=1,i=1,s=1,e=1){this.r=t,this.l=i,this.b=s,this.a=e}set(t=1,i=1,s=1,e=1){return this.r=t,this.l=i,this.b=s,this.a=e,this}F(){return new y(this.r,this.l,this.b,this.a)}add(t){return new y(this.r+t.r,this.l+t.l,this.b+t.b,this.a+t.a)}D(t){return new y(this.r-t.r,this.l-t.l,this.b-t.b,this.a-t.a)}multiply(t){return new y(this.r*t.r,this.l*t.l,this.b*t.b,this.a*t.a)}Y(t){return new y(this.r/t.r,this.l/t.l,this.b/t.b,this.a/t.a)}scale(t,i=t){return new y(this.r*t,this.l*t,this.b*t,this.a*i)}toString(t=!0){var i=t=>((t=255*s(t)|0)<16?"0":"")+t.toString(16);return"#"+i(this.r)+i(this.l)+i(this.b)+(t?i(this.a):"")}}let p=r(),v=32,m=r(1920,1080),w=r(),b=r(16),M=0;function z(t){var i,s,e=t.parent;for(s of(e&&(i=e.O?-1:1,t.g=t.Ha.multiply(r(i,1)).rotate(e.angle).add(e.g),t.angle=i*t.Ga+e.angle),t.children))z(s)}function A(t){if(!t.L)for(var i of(t.L=1,t.parent&&t.parent.removeChild(t),t.children))A(i,i.parent=0)}class S{constructor(t=r(),i=r(1),s,e=new y){this.g=t.F(),this.size=i,this.za=void 0,this.K=s,this.angle=0,this.color=e,this.ta=void 0,this.O=!1,this.ua=this.na=this.i=1,this.S=0,this.Ba=.8,this.Da=1,this.ra=0,this.h=r(),this.ja=0,this.children=[],this.wa=!0,this.parent=void 0,this.Ha=r(),this.Ga=0,this.Z=this.W=this.ma=!1,Mt.push(this)}update(){var i;if(!this.parent&&(this.wa?(this.h.x=s(this.h.x,-1,1),this.h.y=s(this.h.y,-1,1)):1<(i=c(this.h))&&(this.h.x*=i=1/i**.5,this.h.y*=i),i=this.g.F(),this.h.x*=this.na,this.h.y*=this.na,this.i&&(this.h.y+=0*this.Da),this.g.x+=this.h.x,this.g.y+=this.h.y,this.angle+=this.ja*=this.ua,this.i)){var e,n,u,l,g,d,f=this.h.y<0;if(this.G&&(e=this.G.h?this.G.h.x:0,this.h.x=e+(this.h.x-e)*this.Ba,this.G=0),this.W)for(var x of zt)!this.Z&&!x.Z||x.L||x.parent||x==this||h(this.g,this.size,x.g,x.size)&&(h(i,this.size,x.g,x.size)?(e=(n=(e=i.D(x.g)).length())<.01?o(a(2*t)):e.scale(.001/n),this.h=this.h.add(e),x.i&&(x.h=x.h.D(e))):(n=this.size.add(x.size),u=2*(i.y-x.g.y)>n.y+0,l=2*Math.abs(i.y-x.g.y)<n.y,g=2*Math.abs(i.x-x.g.x)<n.x,e=Math.max(this.S,x.S),!u&&!g&&l||(this.g.y=x.g.y+(n.y/2+.001)*Math.sign(i.y-x.g.y),x.G&&f||!x.i?(f&&(this.G=x),this.h.y*=-e):x.i&&(g=(this.i*this.h.y+x.i*x.h.y)/(this.i+x.i),d=x.h.y*(x.i-this.i)/(this.i+x.i)+2*this.h.y*this.i/(this.i+x.i),this.h.y=g+s(e)*(this.h.y*(this.i-x.i)/(this.i+x.i)+2*x.h.y*x.i/(this.i+x.i)-g),x.h.y=g+s(e)*(d-g))),!u&&l&&(this.g.x=x.g.x+(n.x/2+.001)*Math.sign(i.x-x.g.x),x.i?(n=(this.i*this.h.x+x.i*x.h.x)/(this.i+x.i),u=x.h.x*(x.i-this.i)/(this.i+x.i)+2*this.h.x*this.i/(this.i+x.i),this.h.x=n+s(e)*(this.h.x*(this.i-x.i)/(this.i+x.i)+2*x.h.x*x.i/(this.i+x.i)-n),x.h.x=n+s(e)*(u-n)):this.h.x*=-e)));this.ma&&gt(this.g,this.size,this)&&!gt(i,this.size,this)&&(x=gt(r(this.g.x,i.y),this.size,this),!gt(r(i.x,this.g.y),this.size,this)&&x||(this.h.y*=-this.S,(this.G=f)?this.g.y=(i.y-this.size.y/2|0)+this.size.y/2+1e-4:this.g.y=i.y),x)&&(this.g.x=i.x,this.h.x*=-this.S)}}qa(){k(this.g,this.za||this.size,this.K,this.color,this.angle,this.O,this.ta)}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){}}let D,B,j,C,P=r(),E=[];function I(t=r(),i=b,s=0,e=0){"number"==typeof i&&(i=r(i));var h=E[s],a=i.add(r(2*e));return"number"==typeof t&&(t=0<(h=h.size.x/a.x|0)?r(t%h,t/h|0):r()),t=r(t.x*a.x+e,t.y*a.y+e),new F(t,i,s,e)}class F{constructor(t=r(),i=b,s=0,e=0){this.g=t.F(),this.size=i.F(),this.ha=s,this.padding=e}offset(t){return new F(this.g.add(t),this.size,this.ha)}frame(t){return this.offset(r(t*(this.size.x+2*this.padding),0))}}class R{constructor(t){this.image=t,this.size=r(t.width,t.height);var i=Q.createTexture();Q.bindTexture(3553,i),t&&t.width?Q.texImage2D(3553,0,6408,6408,5121,t):(t=new Uint8Array([255,255,255,255]),Q.texImage2D(3553,0,6408,1,1,0,6408,5121,t)),Q.texParameteri(3553,10241,9728),Q.texParameteri(3553,10240,9728),this.oa=i}}function T(t){return new d((t.x-p.x)*v+P.x/2-.5,(t.y-p.y)*-v+P.y/2-.5)}function k(t,i=r(1),s,e=new y,h=0,a,n=new y(0,0,0,0)){var o,c,u,l,g=s&&E[s.ha];g?(o=r(1).Y(g.size),c=s.g.x*o.x,u=s.g.y*o.y,l=s.size.x*o.x,s=s.size.y*o.y,o=o.scale(M),(g=g.oa)!=it&&(mt(),Q.bindTexture(3553,it=g)),bt(t.x,t.y,a?-i.x:i.x,i.y,h,c+o.x,u+o.y,c-o.x+l,u-o.y+s,x(e),x(n))):bt(t.x,t.y,i.x,i.y,h,0,0,0,0,0,x(e))}function G(t,i,s=1,e=new y,h=0,a=new y(0,0,0)){var n=C;n.fillStyle=e.toString(),n.lineWidth=h,n.strokeStyle=a.toString(),n.textAlign="center",n.font=s+"px arial",n.textBaseline="middle",n.lineJoin="round",i=i.F(),t=(t+"").split("\n"),i.y-=(t.length-1)*s/2,t.forEach(t=>{h&&n.strokeText(t,i.x,i.y,void 0),n.fillText(t,i.x,i.y,void 0),i.y+=s})}function K(t,i=0){return W[i]&&!!(1&W[i][t])}let L=0,O=!1;function H(t,i=0){return K(t,i+1)}let W=[[]];function U(){for(var t of W)for(var i in t)t[i]&=1;L=0}function X(t){var i;return D?(i=D.getBoundingClientRect(),r(D.width,D.height).multiply(r(e(t.x,i.left,i.right),e(t.y,i.top,i.bottom)))):r()}let J=[];function N(){var t,i;if(navigator&&navigator.getGamepads&&document.hasFocus()){var s=navigator.getGamepads();for(let d=s.length;d--;){var h=s[d],a=W[d+1]||(W[d+1]=[]),n=J[d]||(J[d]=[]);if(h){for(var o=0;o<h.axes.length-1;o+=2)n[o>>1]=(t=r(h.axes[o],h.axes[o+1]),l(r((i=t=>.3<t?e(t,.3,.8):t<-.3?-e(-t,.3,.8):0)(t.x),i(-t.y))));for(o=h.buttons.length;o--;){var u=h.buttons[o],g=H(o,d);a[o]=u.pressed?g?1:3:g?4:0,O||=!d&&u.pressed}c(h=r((H(15,d)&&1)-(H(14,d)&&1),(H(12,d)&&1)-(H(13,d)&&1)))&&(n[0]=l(h))}}}}let Y,$=void 0!==window.ontouchstart,V=new AudioContext;class _{constructor(t){this.range=40,this.Ka=.7,this.aa=0,t&&(this.aa=null!=t[1]?t[1]:.05,t[1]=0,this.ba=[q(...t)],this.sampleRate=44100)}play(t,i=1,h=1,n=1,r=!1){if(this.ba){var o;if(t){if(o=this.range){var c=u(p,t);if(o*o<c)return;i*=e(c**.5,o,o*this.Ka)}o=2*T(t).x/D.width-1}return t=h+h*this.aa*n*a(-1,1),this.Ca=V.createGain(),this.source=function(t,i=1,e=1,h=0,a=!1,n=44100,r){let o=V.createBuffer(t.length,t[0].length,n),c=V.createBufferSource();return t.forEach((t,i)=>o.getChannelData(i).set(t)),c.buffer=o,c.playbackRate.value=e,c.loop=a,(r=r||V.createGain()).gain.value=i,r.connect(Y),t=new StereoPannerNode(V,{pan:s(h,-1,1)}),c.connect(t).connect(r),"running"!=V.state?V.resume().then(()=>c.start()):c.start(),c}(this.ba,i,t,o,r,this.sampleRate,this.Ca)}}stop(){this.source&&this.source.stop(),this.source=void 0}}function q(i=1,e=.05,h=220,n=0,r=0,o=.1,c=0,u=1,l=0,g=0,d=0,f=0,x=0,y=0,p=0,v=0,m=0,w=1,b=0,M=0,z=0){var A=2*t,S=l*=500*A/44100/44100;e=h*=a(1+e,1-e)*A/44100;let D=[],B=0,j=0,C=0,P=1,E=0,I=0,F=0,R=A*Math.abs(z)*2/44100,T=Math.cos(R),k=Math.sin(R)/2/2,G=1+k,K=(R=-2*T/G,k=(1-k)/G,(1+Math.sign(z)*T)/2/G),L=-(Math.sign(z)+T)/G,O=0,H=0,W=0,U=0;for(g*=500*A/44100**3,p*=A/44100,d*=A/44100,f*=44100,x=44100*x|0,G=(n=44100*n+9)+(b*=44100)+(r*=44100)+(o*=44100)+(m*=44100)|0;C<G;D[C++]=F*i)++I%(100*v|0)||(F=c?1<c?2<c?3<c?Math.sin(B**3):s(Math.tan(B),1,-1):1-(2*B/A%2+2)%2:1-4*Math.abs(Math.round(B/A)-B/A):Math.sin(B),F=(x?1-M+M*Math.sin(A*C/x):1)*Math.sign(F)*Math.abs(F)**u*(C<n?C/n:C<n+b?1-(C-n)/b*(1-w):C<n+b+r?w:C<G-m?(G-C-m)/o*w:0),F=m?F/2+(m>C?0:(C<G-m?1:(G-C)/m)*D[C-m|0]/2/i):F,z&&(F=U=K*O+L*(O=H)+K*(H=F)-k*W-R*(W=U))),T=(h+=l+=g)*Math.cos(p*j++),B+=T+T*y*Math.sin(C**5),P&&++P>f&&(h+=d,e+=d,P=0),!x||++E%x||(h=e,l=S,P=P||1);return D}let Z,Q,tt,it,st,et,ht,at,nt,rt,ot,ct=[],ut=r();function lt(t){g(t,ut)&&(ct[(0|t.y)*ut.x+t.x|0]=1)}function gt(t,i=r(),s){var e=Math.max(t.x-i.x/2|0,0),h=Math.max(t.y-i.y/2|0,0),a=Math.min(t.x+i.x/2,ut.x);for(t=Math.min(t.y+i.y/2,ut.y);h<t;++h)for(i=e;i<a;++i){var n=ct[h*ut.x+i];if(n&&(!s||0<n))return!0}return!1}class dt{constructor(t,i=0,s=!1,e=new y){this.ia=t,this.direction=i,this.O=s,this.color=e}clear(){this.ia=this.direction=0,this.O=!1,this.color=new y}}function ft(i,s,e=!0){var h=i.K.size;e&&(e=s.multiply(h),i.context.clearRect(e.x,i.canvas.height-e.y,h.x,-h.y)),null!=(e=i.getData(s)).ia&&(s=s.add(r(.5)),i=I(e.ia,h,i.K.ha,i.K.padding),k(s,r(1),i,e.color,e.direction*t/2,e.O))}function xt(t){t.Ja=[D,B,P,p,v],D=t.canvas,B=t.context,P=t.size.multiply(t.K.size),p=t.size.scale(.5),v=t.K.size.x,D.width=P.x,D.height=P.y,t.context.imageSmoothingEnabled=!1,pt();for(let i=t.size.x;i--;)for(let s=t.size.y;s--;)ft(t,r(i,s),!1);wt(!0),[D,B,P,p,v]=t.Ja}class yt extends S{constructor(t,i=ut){var s=I(),e=r(1);for(super(t,i,s),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=e,this.Fa=!1,this.data=[],t=this.size,t=Math.abs(t.x*t.y);t--;)this.data.push(new dt)}setData(t,i,s=!1){g(t,this.size)&&(this.data[(0|t.y)*this.size.x+t.x|0]=i,s)&&ft(this,t)}getData(t){return g(t,this.size)&&this.data[(0|t.y)*this.size.x+t.x|0]}update(){}qa(){var t=T(this.g.add(r(0,this.size.y*this.scale.y)));t.x|=0,t.y|=0,(this.Fa?C:B).drawImage(this.canvas,t.x,t.y,v*this.size.x*this.scale.x,v*this.size.y*this.scale.y)}}function pt(){Q.viewport(0,0,Z.width=D.width,Z.height=D.height),Q.clear(16384),Q.useProgram(tt),Q.activeTexture(33984),E[0]&&Q.bindTexture(3553,it=E[0].oa);let t=rt=ot=0,i=(i,s,e,h)=>{i=Q.getAttribLocation(tt,i);var a=e&&44,n=e&&1,r=1==e;Q.enableVertexAttribArray(i),Q.vertexAttribPointer(i,h,s,r,a,t),Q.vertexAttribDivisor(i,n),t+=h*e};Q.bindBuffer(34962,et),i("g",5126,0,2),Q.bindBuffer(34962,st),Q.bufferData(34962,44e4,35048),i("p",5126,4,4),i("u",5126,4,4),i("c",5121,1,4),i("a",5121,1,4),i("r",5126,4,1),i=r(2*v).Y(P);var s=r(-1).D(p.multiply(i));Q.uniformMatrix4fv(Q.getUniformLocation(tt,"m"),!1,[i.x,0,0,0,0,i.y,0,0,1,1,1,1,s.x,s.y,0,0])}function vt(t,i){return i=Q.createShader(i),Q.shaderSource(i,t),Q.compileShader(i),i}function mt(){var t;nt&&(t=ot?1:771,Q.blendFuncSeparate(770,t,1,t),Q.enable(3042),Q.bufferSubData(34962,0,ht),Q.drawArraysInstanced(5,0,4,nt),nt=0,ot=rt)}function wt(t=!1){var i=B;(nt||t)&&(mt(),t)&&i.drawImage(Z,0,0)}function bt(t,i,s,e,h,a,n,r,o,c,u=0){(1e4<=nt||ot!=rt)&&mt();var l=11*nt++;ht[l++]=t,ht[l++]=i,ht[l++]=s,ht[l++]=e,ht[l++]=a,ht[l++]=n,ht[l++]=r,ht[l++]=o,at[l++]=c,at[l++]=u,ht[+l]=h}let Mt=[],zt=[],At=0,St=0,Dt=[],Bt=[];function jt(){for(var t of(zt=Mt.filter(t=>t.W),Mt))t.parent||(function t(i){if(!i.L)for(var s of(i.update(),i.children))t(s)}(t),z(t));Mt=Mt.filter(t=>!t.L)}class Ct extends S{constructor(t,i,s,e=0,h=.02,a=300){e=I(16+e,16),super(t,r(.5,.5),e,s),this.h=i.scale(h),this.v=a}update(){super.update(),this.g=this.g.add(this.h),this.v--,this.v<=0&&A(this),(31<=this.g.x||this.g.x<=1||23<=this.g.y||this.g.y<=1)&&A(this)}}class Pt extends S{constructor(i,s=5){s=I(s,16),super(i,r(1.5,1.5),s,f(0,0,1)),this.speed=.05,this.o=2,this.j=240,this.target=Wt.g,this.ca=r(0,1),this.X=240,this.da=this.H=0,this.V=t/8,this.T=f(0,1,.8),this.la=0,this.va=.02,this.ka=300}update(){if(super.update(),this.j<=0){for(let s=0;s<2*t;s+=this.V){var i=r(Math.cos(s),Math.sin(s));i=0!=this.H?new kt(this.g,i,this.T,this.H,this.da,this.ka):new Ct(this.g,i,this.T,this.la,this.va),Jt.push(i)}this.j=this.X}else this.j--}}class Et extends Pt{constructor(t){super(t,7),this.X=240,this.j=120,this.H=.008,this.da=.025,this.T=f(.2,1,.8)}}function It(t){t.$=r(n(30),n(22)),t.direction=t.$.D(t.g).normalize()}class Ft extends S{speed=.1;$=r(0,0);direction=r(0,0);constructor(t){super(t,r(1,1),I(3,16),f(0,0,.8)),It(this)}update(){super.update(),this.g=this.g.add(this.direction.scale(this.speed)),u(this.g,this.$)**.5<.5&&It(this)}}function Rt(t){var i=Wt;0<i.N||(i.o-=t,i.N=120,i.M=0,i.ya.play())}class Tt extends S{constructor(){var t=r(16,8),i=(f(0,0,.2),I(2,16));super(t,r(1,1),i,f(0,0,1)),this.speed=.12,this.o=10,this.R=this.N=this.M=0,this.C=new y(this.color.r,this.color.l,this.color.b,this.color.a),this.ya=new _([2.1,,191,.08,.04,,3,3,5,,,,,.5,5,.3,.13,.48]),this.Aa=new _([,,539,,.06,.2,1,2,,,500,.04,.02,,,,.04]),this.Ea=new _([,0,847,,.3,.5,1,,,,-800,.05,.01,,,,.1])}move(t){this.g=this.g.add(t.scale(this.speed)),this.g.x=s(this.g.x,1,31),this.g.y=s(this.g.y,1,23)}update(){super.update(),0<this.N&&(this.N--,this.R=(this.R+1)%12,this.color=new y(this.C.r,this.C.l,this.C.b,this.R<6?.2:1),this.N<=0)&&(this.color=new y(this.C.r,this.C.l,this.C.b,this.C.a),this.R=0)}}class kt extends Ct{constructor(t,i,s,e,h,a){super(t,i,s,0),this.direction=i,this.H=e,this.scale=h,this.v=a}update(){this.direction=this.direction.rotate(this.H),this.h=this.direction.scale(this.scale),this.g=this.g.add(this.h),this.v--,this.v<=0&&A(this),(31<=this.g.x||this.g.x<=1||23<=this.g.y||this.g.y<=1)&&A(this)}}class Gt extends S{constructor(i){var s=I(7,16);super(i,Zt,s,f(.3,.25,.5)),this.speed=.05,this.o=2,this.j=120,this.target=Wt.g,this.xa=t/6,this.V=t/24}update(){super.update(),this.I+=this.La;var t=Ut.g.D(this.g).normalize();if(this.j<=0){for(var i=this.xa/2,s=-1*i;s<i;s+=this.V){var e=t.rotate(s).normalize();e=new Ct(this.g,e,f(.4,1,.5),1),Jt.push(e)}this.j=300}else this.j--}}class Kt extends S{constructor(t){var i=I(8,16);super(t,Zt,i,f(0,0,1)),this.speed=.05,this.o=3,this.j=10,this.target=Wt.g,this.ca=r(0,1),this.I=0}update(){var i;super.update(),this.j<=0?(this.ca=r(Math.cos(this.I),-1*Math.abs(Math.sin(this.I))),i=new Ct(this.g,this.ca,new y(.2,.5,1,1),0,.005,3e3),Jt.push(i),this.j=10,this.I+=t/10):this.j--}}class Lt extends S{constructor(t,i){var s=I(20,16);super(t,r(1,1),s,f(0,0,1)),this.h=i.scale(.05),this.v=600}update(){super.update(),this.g=this.g.add(this.h),this.v--,this.v<=0&&A(this)}}class Ot extends S{constructor(){var t=r(16,12),i=I(4,16);super(t,Zt,i,f(0,0,1)),this.ga=[4,12,16,20,28],this.sa=2,this.J=0,this.fa=1,this.pa=.1,this.targetX=this.ga[this.J],this.ea=this.j=this.U=0,this.g.x=this.targetX,this.g.y=this.sa}update(){var t;super.update(),0<this.U?(0<this.j&&this.j--,this.ea<2&&this.j<=0&&0<Xt.length&&(t=Xt[0])&&(t=t.g.D(this.g).normalize(),t=new Lt(this.g,t),Nt.push(t),this.ea++,this.j=240),this.U--,this.U<=0&&(this.J===this.ga.length-1?this.fa=-1:0===this.J&&(this.fa=1),this.J+=this.fa,this.targetX=this.ga[this.J])):(t=this.targetX-this.g.x,Math.abs(t)>this.pa?this.g.x+=Math.sign(t)*this.pa:(this.g.x=this.targetX,this.g.y=this.sa,this.U=240,this.j=120,this.ea=0))}}class Ht extends Pt{constructor(t){super(t,6),this.j=120,this.X=480,this.H=.01,this.da=.03,this.T=f(.6,1,.8),this.la=2,this.ka=600}}var Wt,Ut,Xt=[],Jt=[],Nt=[],Yt=[],$t=0,Vt=0,_t=!1,qt=!0,Zt=r(1.5,1.5);let Qt=new _([,0,925,.05,.3,.6,1,.3,,12,-100,.1,-.06,,,.1]),ti=new class extends _{constructor(){super(),this.aa=0,this.ba=function(t,i,s,e=125){let h,a,n,r,o,c,u,l,g,d,f,x,y,p,v=0,m=[],w=[],b=[],M=0,z=0,A=1,S={},D=44100/e*60>>2;for(;A;M++)m=[A=l=x=0],s.forEach((e,B)=>{for(u=i[e][M]||[0,0,0],A|=i[e][M]&&1,p=x+(i[e][0].length-2-(l?0:1))*D,y=B==s.length-1,h=2,n=x;h<u.length+y;l=++h){for(o=u[h],g=h==u.length+y-1&&y||d!=(u[0]||0)||0|o,a=0;a<D&&l;a++>D-99&&g&&f<1&&(f+=1/99))c=(1-f)*m[v++]/2||0,w[n]=(w[n]||0)-c*z+c,b[n]=(b[n++]||0)+c*z+c;o&&(f=o%1,z=u[1]||0,o|=0)&&(m=S[[d=u[v=0]||0,o]]=S[[d,o]]||((r=[...t[d]])[2]*=2**((o-12)/12),0<o?q(...r):[]))}x=p});return[w,b]}([[1.8,0,72,,,.2,,4,-2,6,50,.15,,6],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[1.2,0,23,,,.2,3,4,,,3,.9,.05],[1.5,0,740,,,.15,1,0,-.1,-.15,,.02,,,.12,,.06]],[[[3,-1,8,,,8,13,,13,,,,,,,,,,,,,,8,,,8,13,,13,,,,,,,,,,,,,,10,,,10,15,,15,,13,,15,,6,,15,,,8,6,5,3,5],[2,-1,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,]],[[3,-1,8,,,8,13,,13,,10,,15,,10,,15,,6,8,5,6,8,,,8,13,,13,,,,,,,,,,,,,,10,,,10,15,,15,,13,,15,,6,,15,,,8,6,5,3,5],[,1,25,,,,,,,,,,,,,25,,,,,,,,,,,,,25,,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,-1,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,25,,13,,]]],[0],void 0),this.sampleRate=44100}Ia(){super.play(void 0,1,1,1,!0)}};var ii=0,si=0,ei=!1,hi=[{P:[[4,12],[28,12]]},{P:[[4,18],[28,18]],u:[[10,10],[22,10]]},{P:[[4,12],[28,12]],u:[[12,12],[20,12]],A:[[10,8],[22,8]]},{u:[[8,8],[24,8]],A:[[6,16],[26,16]],m:[[4,20],[28,20]]},{u:[[10,6],[22,6]],A:[[10,18],[22,18]],m:[[8,20],[24,20]],B:[[16,6]]},{u:[[6,12],[26,12],[16,12]],A:[[12,8],[20,8],[12,16],[20,16]],m:[],B:[[16,6],[16,18]]},{u:[[4,8],[28,8]],A:[[4,16],[28,16]],m:[[8,20],[24,20]],B:[[16,10],[16,14]]},{u:[[6,6],[26,6],[6,18],[26,18]],A:[[8,8],[24,8],[8,16],[24,16]],m:[[16,20],[16,20]],B:[[4,12],[28,12]]},{u:[[10,10],[22,10],[10,14],[22,14]],A:[[16,8],[16,16]],m:[[6,12],[26,12]],B:[[12,12],[20,12]]},{u:[[4,12],[28,12],[16,4],[16,20]],A:[[8,6],[24,6],[8,18],[24,18]],m:[[6,14],[26,14]],B:[[16,12]]}],ai={10:{m:[[16,22]]},20:{m:[[16,22]],P:[[4,18],[28,18],[8,18],[24,18]]},30:{m:[[16,22]],B:[[16,6]]},40:{m:[[16,22]],u:[[16,6],[16,18]]},50:{m:[[16,22]],u:[[4,16],[28,16]],B:[[16,6]]}};function ni(){for(var t of Xt)A(t);for(var i of(Xt=[],Jt))A(i);for(var s of(Jt=[],Nt))A(s);Nt=[]}function ri(){var t,i=ii,e=hi[i%hi.length];e&&(ni(),(t=(t,i)=>{if(t)for(var[e,h]of t)t=new i(r(s(e,2,30),s(h,2,22))),Xt.push(t)})(e.u||[],Pt),t(e.A||[],Et),t(e.P||[],Gt),t(e.m||[],Kt),t(e.B||[],Ht),i=10*Math.floor((i+1)/10),console.log("> threshold",i),10<=i)&&ai&&ai[i]&&(i=ai[i],console.log(">>>> extra",i),t(i.u||[],Pt),t(i.A||[],Et),t(i.P||[],Gt),t(i.m||[],Kt),t(i.B||[],Ht))}function oi(){if(ti.Ia(),Wt.o=10,Wt.g=r(16,8),Vt<$t){Vt=$t;try{localStorage.setItem("oggys_curse_bestScore",String(Vt))}catch(t){}}for(var t of($t=0,_t=!1,ni(),Yt))A(t);for(ei=!(Yt=[]),si=ii=0,ri(),t=0;t<3;t++){var i=new Ft(r(n(30),n(14)));Yt.push(i)}}M=.5,((t,i,s,e,h,a=document.body)=>{function n(h=0){var a,c=h-At;for(At=h,St+=c,St=Math.min(St,50),o(),h=0,St<0&&-9<St&&(h=St,St=0);0<=St;St-=1e3/60)$||document.hasFocus()||(W=[[]]),N(),t(),Dt.forEach(t=>t()),jt(),i(),U();for(a of(St+=h,P=r(D.width,D.height),C.imageSmoothingEnabled=B.imageSmoothingEnabled=!1,pt(),s(),Mt.sort((t,i)=>t.ra-i.ra),Mt))a.L||a.qa();e(),Bt.forEach(t=>t()),wt(),requestAnimationFrame(n)}function o(){var t,i;w.x?(D.width=w.x,D.height=w.y,t=innerWidth/innerHeight,i=D.width/D.height,(Z||D).style.width=D.style.width=j.style.width=t<i?"100%":"",(Z||D).style.height=D.style.height=j.style.height=t<i?"":"100%"):(D.width=Math.min(innerWidth,m.x),D.height=Math.min(innerHeight,m.y)),j.width=D.width,j.height=D.height,P=r(D.width,D.height)}a.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",a.appendChild(D=document.createElement("canvas")),B=D.getContext("2d"),function(){function t(t){return"KeyW"==t?"ArrowUp":"KeyS"==t?"ArrowDown":"KeyA"==t?"ArrowLeft":"KeyD"==t?"ArrowRight":t}onkeydown=i=>{i.repeat||(O=!1,W[0][i.code]=3,W[0][t(i.code)]=3)},onkeyup=i=>{W[0][i.code]=4,W[0][t(i.code)]=4},onmousedown=t=>{V&&"running"!=V.state&&V.resume(),O=!1,W[0][t.button]=3,X(t),t.button&&t.preventDefault()},onmouseup=t=>W[0][t.button]=2&W[0][t.button]|4,onmousemove=t=>X(t),onwheel=t=>L=t.ctrlKey?0:Math.sign(t.deltaY),oncontextmenu=()=>!1,onblur=()=>{W=[[]]},$&&function(){function t(t){V&&"running"!=V.state&&V.resume();var s=t.touches.length;return s?(X(r(t.touches[0].clientX,t.touches[0].clientY)),i?O=!1:W[0][0]=3):i&&(W[0][0]=2&W[0][0]|4),i=s,document.hasFocus()&&t.preventDefault(),!0}let i;document.addEventListener("touchstart",i=>t(i),{passive:!1}),document.addEventListener("touchmove",i=>t(i),{passive:!1}),document.addEventListener("touchend",i=>t(i),{passive:!1}),onmousedown=onmouseup=()=>0}()}(),(Y=V.createGain()).connect(V.destination),Y.gain.value=.3,function(){Z=document.createElement("canvas"),Q=Z.getContext("webgl2",{antialias:!0}),D.parentElement.appendChild(Z);var t=Q.createProgram();Q.attachShader(t,vt("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",35633)),Q.attachShader(t,vt("#version 300 es\nprecision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}",35632)),Q.linkProgram(t),tt=t,t=new ArrayBuffer(44e4),ht=new Float32Array(t),at=new Uint32Array(t),st=Q.createBuffer(),et=Q.createBuffer(),t=new Float32Array([nt=0,0,1,0,0,1,1,1]),Q.bindBuffer(34962,et),Q.bufferData(34962,t,35044)}(),a.appendChild(j=document.createElement("canvas")),C=j.getContext("2d"),D.style.cssText=j.style.cssText="position:absolute",Z&&(Z.style.cssText="position:absolute"),o(),a=h.map((t,i)=>new Promise(s=>{let e=new Image;e.crossOrigin="anonymous",e.onerror=e.onload=()=>{E[i]=new R(e),s()},e.src=t})),h.length||a.push(new Promise(t=>{E[0]=new R(new Image),t()})),Promise.all(a).then(function(){new Promise(t=>t((()=>{for(var t,i=new yt(r(0,0),r(32,24)),s=0;s<32;s++)for(var e=0;e<24;e++)i.setData(r(s,e),new dt(0,0,!1,new y(1,1,1,1))),lt(r(s,e));for(xt(i),ut=r(32,24),i=(ct=[]).length=Math.abs(ut.x*ut.y);i--;)ct[i]=0;for(i=new yt(r(),ut),s=0;s<32;s++)for(e=0;e<24;e++)0!=s&&31!=s&&0!=e&&23!=e||(t=r(s,e),i.setData(t,new dt(1,0,!1,new y(1,1,1,1))),lt(t));I(2,16),(s=Wt=new Tt).W=!0,s.Z=!0,s.ma=!0,Ut=new Ot,xt(i);try{var h=localStorage.getItem("oggys_curse_bestScore");null!==h&&(Vt=Number(h)||0)}catch(t){}p=r(16,12),v=32})())).then(n)})})(function(){if(_t)W[0]&&2&W[0].KeyR&&oi();else{qt&&W[0]&&2&W[0].Space&&(qt=!1,oi()),L&&(v=s(v-=Math.sign(L)*v/5,10,300)),K("ArrowUp")&&Wt.move(r(0,1)),K("ArrowDown")&&Wt.move(r(0,-1)),K("ArrowLeft")&&Wt.move(r(-1,0)),K("ArrowRight")&&Wt.move(r(1,0)),qt||_t||(0===Xt.length?ei?0<si?si--:(ei=!1,ii++,ri()):(ei=!0,si=120):ei=!1);for(var t,i,e,h,o=Jt.length-1;0<=o;o--){var c=Jt[o];c.update(),c.v<=0&&(A(c),Jt.splice(o,1))}for(o=Nt.length-1;0<=o;o--)(c=Nt[o]).update(),c.v<=0&&(A(c),Nt.splice(o,1));for(t of Jt)if(u(t.g,Wt.g)**.5<.5){console.log("Bullet hit player",t),Rt(1),A(t),Jt.splice(Jt.indexOf(t),1);break}for(i of Nt){if(u(i.g,Wt.g)**.5<.5){console.log("Witch spell hit player",i),Rt(2),A(i),Nt.splice(Nt.indexOf(i),1);break}for(t=Xt.length-1;0<=t;t--)o=Xt[t],u(i.g,o.g)**.5<.5&&(console.log("Witch spell hit enemy",i),--o.o,A(i),Nt.splice(Nt.indexOf(i),1)),o.o<=0&&(A(o),Xt.splice(t,1))}for(e of Yt)if(u(e.g,Wt.g)**.5<1){console.log("Player ate mouse",e),$t+=1,A(e),Yt.splice(Yt.indexOf(e),1),(i=Wt).o<10&&i.M++,(5<=i.M?(i.o++,i.M=0,i.Ea):i.Aa).play();break}for(h of(Wt.update(),Ut.update(),Xt))h.update();Wt.o<=0&&(_t=!0,Qt.play(),ti.stop()),a()<.01&&(h=new Ft(r(n(31),n(22))),Yt.push(h))}},function(){},function(){},function(){qt?(G("Oggy's Curse",r(P.x/2,P.y/2-70),60,f(0,0,1)),G("Press space to start",r(P.x/2,P.y/2),40,f(0,0,1))):_t||(G(`Score: ${$t} | Best : `+Vt+" | Wave : "+(ii+1),r(P.x/2,70),40,f(0,0,1)),G(`HP : ${Wt.o} | Heal : `+Wt.M,r(P.x/2,120),40,f(0,0,1))),_t&&G("Game Over! Press R to Restart",r(P.x/2,P.y/2),60,f(0,1,.5),6,f(0,0,0))},["tiles.png"])</script>