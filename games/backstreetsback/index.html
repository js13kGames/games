<!doctype html><title>backstreetsback - alright</title><script src=/2019/webxr/aframe.js></script><script>function gen_lyrics(){let t=document.getElementById("mainscene");window.state.lyrics.forEach(((e,i)=>{let o=document.createElement("a-entity");o.classList.add("lyric"),o.setAttribute("geometry","primitive: plane; width: 4; height: 1;"),o.setAttribute("material","color: grey"),o.setAttribute("text",`value: ${e.v}; width=: 6; height: 2; align: center; font: monoid;`),o.setAttribute("rotation",e.r),o.setAttribute("position",e.p),o.setAttribute("cursor-listener",!0),o.setAttribute("animation","property: scale; from: 0.7 0.7 0.7; to: 0.9 0.9 0.9; loop: true; dir: alternate; dur: 800;"),t.appendChild(o)}))}function gen_title_screen(){let t=document.getElementById("mainscene"),e=document.createElement("a-entity");e.id="title",e.setAttribute("geometry","primitive: plane; width: 3; height: 3;"),e.setAttribute("rotation","0 -90 0"),e.setAttribute("position","-12 1.5 -10"),e.setAttribute("material","color: black");let i=document.createElement("a-entity");i.setAttribute("position","0 0.8 0"),i.setAttribute("text","value: backstreetsback; width: 6; align: center; font: monoid;");let o=document.createElement("a-entity");o.setAttribute("geometry","primitive: plane; width: 2; height: 1;"),o.setAttribute("material","color: grey"),o.setAttribute("position","0 -0.4 0.2"),o.setAttribute("title-plane",!0),o.setAttribute("text","value: Alright!; width: 6; height: 2; align: center; font: monoid; color: white;"),e.appendChild(i),e.appendChild(o),t.appendChild(e)}function reset_player_score(){let t=document.querySelector("#player");t.object3D.position.x=window.state.player.start_pos.x,t.object3D.position.y=window.state.player.start_pos.y,t.object3D.position.z=window.state.player.start_pos.z,window.state.score=0,window.state.mode="title",window.state.current=1}!function(t,e){"function"==typeof define&&define.amd?define(["exports"],e):e("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:t.TinyMusic={})}(this,(function(t){function e(t){var i=t.split(r);this.frequency=e.getFrequency(i[0])||0,this.duration=e.getDuration(i[1])||0}function i(t,e,i){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,i||[])}var o=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,r=/\s+/,s=/(\d+)/,a={};"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach((function(t,e){t.split("-").forEach((function(t){a[t]=e}))})),e.getFrequency=function(t){var e=t.split(s),i=a[e[0]],n=(e[1]||4)-4;return o*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,n)},e.getDuration=function(t){return n.test(t)?parseFloat(t):t.toLowerCase().split("").reduce((function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)}),0)},i.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,i){(i=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",i.frequency.value=e[1],t.connect(t=i)}.bind(this)),t.connect(this.ac.destination),this},i.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof e?t:new e(t))}.bind(this)),this},i.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},i.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},i.prototype.scheduleNote=function(t,e){var i=60/this.tempo*this.notes[t].duration,o=i*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,o),this.setFrequency(0,e+o),e+i},i.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},i.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},i.prototype.slide=function(t,e,i){var o=this.getNextNote(t),n=this.getSlideStartDelay(i);return this.setFrequency(this.notes[t].frequency,e+n),this.rampFrequency(o.frequency,e+i),this},i.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},i.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},i.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,i){t=this.scheduleNote(i,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},i.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=e,t.Sequence=i})),window.state={current:1,speed:.025,score:0,mode:"title",player:{start_pos:{x:-14,y:1.6,z:-10}},checkpoints:{1:{a:"x",p:{x:-12}},2:{a:"x",p:{x:-5}},3:{a:"z",p:{z:3}},4:{a:"x",p:{x:-8}},5:{a:"z",p:{z:7}},6:{a:"z",p:{z:4}},7:{a:"x",p:{x:3}},8:{a:"z",p:{z:8}},9:{a:"x",p:{x:8}},10:{a:"z",p:{z:-4}},11:{a:"x",p:{x:0}},12:{a:"z",p:{z:-14}}},lyrics:[{v:"Everybody!",p:"-9 1.3 -11",r:"0 0 0"},{v:"Rock your body!",p:"-2.6 1.3 -6",r:"0 -90 0"},{v:"Everybody!",p:"-5.8 2.3 -4.3",r:"0 90 0"},{v:"Rock your body!",p:"-3 3 -1.3",r:"0 -90 0"},{v:"Backstreet's back!",p:"-9 4 0.1",r:"0 0 0"},{v:"Oh my god, we're back again!",p:"-11.3 3 4.5",r:"0 90 0"},{v:"Brothers, sisters everybody sing!",p:"-9.8 3.4 10.1",r:"0 -180 0"},{v:"Gonna bring the flavor, show you how!",p:"-6.1 2 8",r:"0 -90 0"},{v:"Got a question for you better answer now!",p:"-3.4 2.8 5.8",r:"0 -180 0"},{v:"Am I original?",p:"-0.1 1.3 5.9",r:"0 180 0"},{v:"Am I the only one?",p:"0 2.3 2.6",r:"0 0 0"},{v:"Am I sexual?",p:"3.3 3.1 2.6",r:"0 0 0"},{v:"Am I everything you need?",p:"4.8 3.3 10.4",r:"0 180 0"},{v:"You better rock your body now!",p:"10.4 1.4 6.4",r:"0 -90 0"},{v:"Everybody!",p:"10.4 1.4 0",r:"0 -90 0"},{v:"Rock your body!",p:"7.3 4.4 -4.7",r:"0 0 0"},{v:"Everybody!",p:"3.6 2.7 -2.7",r:"0 180 0"},{v:"Rock your body right!",p:"-1.2 1.3 -6.6",r:"0 90 0"},{v:"Backstreet's back!",p:"1.9 2.8 -8.8",r:"0 -90 0"},{v:"Alright!",p:"-1 2.2 -11",r:"0 90 0"}]},AFRAME.registerShader("brix",{schema:{},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  float single = (mod(vUv[0], 0.09) * 60.0) * mod(vUv[1], 0.06) * 100.0;\n  vec3 construct = vec3(single);\n\n  construct.b = 0.3 * construct.r;\n  construct.g = 0.3 * construct.r;\n\n  gl_FragColor = vec4(construct, 1.0);\n  //gl_FragColor = vec4(0.4, 0.2, 0.2, 1.0);\n}"}),AFRAME.registerComponent("cursor-listener",{init:function(){var t=window.speechSynthesis,e=t.getVoices()[1],i=t.getVoices()[1];this.el.addEventListener("click",(function(i){if("play"===window.state.mode){this.setAttribute("material","color","white"),this.setAttribute("animation","property: rotation; to: 0 0 180; loop: false; dur: 800;");var o=new SpeechSynthesisUtterance(this.getAttribute("text").value);o.voice=e,t.speak(o)}})),this.el.addEventListener("animationcomplete",(function(e){if("play"===window.state.mode){this.remove();var o=new SpeechSynthesisUtterance("Yeah!");o.voice=i,t.speak(o),window.state.score++,document.querySelector("#score-card").setAttribute("text","value",`${window.state.score}/20`),document.querySelector("#score-hud").setAttribute("text","value",`score ${window.state.score}`)}}))}}),AFRAME.registerComponent("title-plane",{init:function(){var t=window.speechSynthesis,e=t.getVoices()[0];this.el.setAttribute("animation","property: scale; from: 0.7 0.7 0.7; to: 1 1 1; loop: true; dir: alternate; dur: 800;"),this.el.addEventListener("click",(function(i){this.setAttribute("animation","property: rotation; to: 0 0 180; dir: normal; dur: 1000; loop: 1;");var o=new SpeechSynthesisUtterance(this.getAttribute("text").value);o.voice=e,t.speak(o)})),this.el.addEventListener("animationcomplete",(function(t){this.parentNode.remove(),window.state.mode="play"}))}}),AFRAME.registerComponent("end-plane",{init:function(){this.el.setAttribute("animation","property: scale; from: 0.7 0.7 0.7; to: 1 1 1; loop: true; dir: alternate; dur: 800;"),this.el.addEventListener("click",(function(t){gen_title_screen(),gen_lyrics(),reset_player_score()}))}}),AFRAME.registerComponent("player-auto-move",{tick:function(){if("play"===window.state.mode){let t=window.state.checkpoints[state.current];t?this.checkAxis(t)&&(window.state.current+=1):window.state.mode="end"}},checkAxis:function(t){let e=t.a,i=t.p,o=this.el.object3D.position[e],n=i[e];return o<=n?this.el.object3D.position[e]+=state.speed:o>=n&&(this.el.object3D.position[e]-=state.speed),this.el.object3D.position[e].toFixed(2)==n}}),AFRAME.registerComponent("scene-play-music",{schema:{},init:function(){var t=new AudioContext,e=new TinyMusic.Sequence(t,130,["B3 e","- e","B3 e","A#3 e","A3 e","G#3 e","G3 e","- e","G3 e","- e","G3 e","A3 e","F#3 e","- h"]);e.waveType="sine",e.staccato=.05,e.bass.gain.value=30,e.mid.gain.value=5,e.loop=!0,e.gain.gain.value=.2,e.play()}}),AFRAME.registerComponent("exit-vr",{init:function(){this.el.addEventListener("click",(function(t){document.getElementById("mainscene").exitVR()}))}})</script><body><a-scene id=mainscene scene-play-music><a-entity position="0 0 0" id=walls><a-entity position="-8 4 -12" geometry="primitive: box; width: 13; height: 8" material="shader: brix"></a-entity><a-entity position="-2 4 -8" geometry="primitive: box; width: 15; height: 8" material="shader: brix" rotation="0 -90 0"></a-entity><a-entity position="-12 7 -4" geometry="width: 8; height: 15; depth: 12" material="shader: brix" rotation="0 -90 0"></a-entity><a-entity position="-12 4 4" geometry="width: 15; height: 8" material="shader: brix" rotation="0 -90 0"></a-entity><a-entity position="-5 4 11" geometry="width: 15; height: 8" material="shader: brix" rotation=""></a-entity><a-entity position="-2 10.85 12" geometry="width: 8; height: 22; depth: 12" material="shader: brix" rotation=""></a-entity><a-entity position="4 4 11" geometry="width: 15; height: 8" material="shader: brix" rotation=""></a-entity><a-entity position="1.4 6 0" geometry="width: 8; height: 14; depth: 5" material="shader: brix" rotation=""></a-entity><a-entity position="11 4 0" geometry="width: 23; height: 8" material="shader: brix" rotation="0 90 0"></a-entity><a-entity position="7 10 -11" geometry="width: 10; height: 22; depth: 12" material="shader: brix" rotation=""></a-entity></a-entity><a-entity position="-14 1.6 -10" rotation="0 -90 0" id=player player-auto-move><a-entity camera look-controls><a-entity position="0.0 0.5 -0.7" rotation="0 0 0" id=score-hud text="value: score 0; width: 2; height: 1; font: monoid; align: right; color: black"></a-entity><a-entity position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: black; shader: flat" cursor="fuse: true; fuseTimeout: 500"></a-entity></a-entity></a-entity><a-entity position="0 1.5 -16" geometry="primitive: plane; height: 4; width: 3" material="color: black" rotation="0 0 0" id=end><a-entity position="0 1 0" id=score-card text="value: 0/10; width: 5;align: center; font: monoid;"></a-entity><a-entity position="0 0.4 0" text="value: Back again?; width: 5;align: center; font: monoid;"></a-entity><a-entity position="0 -0.5 0.2" geometry="primitive: plane; width: 2; height: 1;" material="color: grey" end-plane text="value: Alright!; width: 6; height: 2; align: center; font: monoid; color: white;"></a-entity></a-entity><a-plane color=#111 height=35 id=floor material="shader: flat" position="0 0 0" rotation="-90 0 0" width=35></a-plane><a-sky color=#fee></a-sky></a-scene><script>gen_title_screen(),gen_lyrics();let scene=document.getElementById("mainscene");scene.addEventListener("enter-vr",(function(){let e=document.querySelector("#player");e.object3D.position.y=1.6;let t=document.createElement("a-entity");t.classList.add("escape-vr"),t.setAttribute("geometry","primitive: plane; width: 0.5; height: 0.5;"),t.setAttribute("material","color: red"),t.setAttribute("text","value: Exit VR Mode; width=: 6; height: 3; align: center; font: monoid;"),t.setAttribute("rotation","90 0 0"),t.setAttribute("position","0 1.5 0"),t.setAttribute("exit-vr",!0),e.appendChild(t)})),scene.addEventListener("exit-vr",(function(){document.querySelectorAll(".escape-vr").forEach((e=>e.remove()))}))</script>