<!doctype html><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=0"><style>body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden}canvas.fullscreen{position:absolute;margin:0}canvas{position:absolute;left:50%;top:50%}h1{left:0;line-height:200px;margin-left:25%;margin-top:-100px;position:absolute;top:50%;text-align:center;width:50%}#l{color:#fff;font-size:150%}body{margin:0;padding:0;background:#000;font-family:Courier,monospace;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}canvas#c{background:#000;margin:0 auto;display:none;transition:linear .25s;user-select:none;-webkit-user-select:none}.active{transform:scale(1)}.flip{transform:scale(0) rotate(360deg)}.shake{animation:shake .4s}.shake-fast{animation:shake 50ms}@keyframes shake{0%{transform:translate(3px,3px) rotate(0)}20%{transform:translate(-6px,0) rotate(1deg)}40%{transform:translate(3px,-3px) rotate(1deg)}60%{transform:translate(-6px,3px) rotate(0)}80%{transform:translate(-6px,-3px) rotate(1deg)}100%{transform:translate(3px,-5px) rotate(-1deg)}}</style><div id=l><h1 id=h>Loading</h1></div><canvas id=c width=320 height=480></canvas><script>var t={title:"Gecko Blaster - js13kGames 2024",start:"Title",w:270,h:480,pal:[[0,0,0],[157,157,157],[255,255,255],[190,38,51],[224,111,139],[73,60,43],[164,100,34],[235,137,49],[247,226,107],[42,72,78],[68,137,26],[163,206,39],[27,38,50],[0,87,132],[49,162,242],[178,220,239],[40,30,40],[30,40,30],[44,34,28],[44,44,44]],i:{13:"R0lGODlhBQAFAIABAAAAAPfiayH5BAEKAAEALAAAAAAFAAUAAAIIRIAWZ6nMQAEAOw==",bat:"R0lGODlhEAAGAMIFAAAAAL8uNOuIMeuJMf7+/v///////////yH5BAEKAAcALAAAAAAQAAYAAAMdeEdM+vAAEEidqjkFNHgDIWxZ9z1ahD0msUbcGScAOw==",bg:"R0lGODlhIgAiAIABAAAAAP///yH5BAEKAAEALAAAAAAiACIAAAJOhIOpy20PmpwKHoqZzXzBDgZfmG0kZp6TFanr6Dpw7M10Yt9IrvN3qtv5YkPiI1i7IEVFFWvJbJKeSyBSesJOj9BoC6oFUa/WXpgzDj4KADs=",bg2:"R0lGODlhIgAiAIABABMbJP///yH5BAEKAAEALAAAAAAiACIAAAJ8jG8AyKjbYoLyvBoVtno7unXeJFbleIXgGJxZyrrNs2K0Tddzbl7wnrtxhLJW8Hgcfogd5AsSVJJ+DGdVp+LtWMPihEvyeIEo7LNs3oqpOHT6iu4lszUku8u0a5dRo36Ppyc3dwUIZFg45ndHpgJmVPao+AU2KRTzthhRAAA7",bone:"R0lGODlhDwAHAIAAAP///////yH5BAEKAAEALAAAAAAPAAcAAAITDBCpena40pu0Ilsd3lE+1zFIAQA7",boss:"R0lGODlhEAAQAMIEAL4mMzGi8rLc7/////fia/fia/fia/fiayH5BAEKAAQALAAAAAAQABAAAANDSEKs/Q0AISRbDdONJbWKNEwXp43AoIlkSWWo6gRU8NCCXQc8v/c0BlCxGDaMwt5NeWS6MM+HRnqhOjJVyDWr5W4ZCQA7",bridge:"R0lGODlhCgAYAMIFAEk8K6NkIqRkIuqJMeuJMf///////////yH5BAEKAAcALAAAAAAKABgAAAMtKLo7AkwBEtkAOOdQ26uA0wlid2kaNzpQFI4kfKKYasqfW1Z7NNM2Xo7xWskSADs=",bullet:"R0lGODlhBAAIAMIDAL4mM+uJMffia////////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAEAAgAAAMNSAA6siKwIEm1jOjNEgA7",cactus:"R0lGODlhDAAIAMIEAESJGqPOJ/7+/v7//v///////////////yH5BAEKAAQALAAAAAAMAAgAAAMcSBraTiGAFicbQTgGoZyeFUkUuXwnIJojGJZTAgA7",circle:"R0lGODlhEAAQAIABAP///+BviyH5BAEKAAEALAAAAAAQABAAAAIdjA2px6G/GJzgUIoudLr7D4aix32ZeWpN11gbUwAAOw==",donut:"R0lGODlhCAAIAMIEAEk8K05CNOByjeuJMf///////////////yH5BAEKAAQALAAAAAAIAAgAAAMXSAEsQI7JOcZkhIB4meVAZVXhQIgjkQAAOw==",dot:"R0lGODlhAQABAIABAP///zGi8iH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==",firefly:"R0lGODlhEAAGAKECAOuJMffia////////yH5BAEKAAMALAAAAAAQAAYAAAIbzI6GO+HfnmzA1RNqVkE4j3kd14lY6SSQmg4FADs=",font:"R0lGODlhmwAFAIABAAAAAEk8KyH5BAEKAAEALAAAAACbAAUAAAJ4hGOAd6sZFpowPhrxhZz5x2ji5pRTyVEfulaWRV6vfNayksV5O/b53NMBcbjX0JY50pYwkFHDAxGTTlsUpZIadRViYzo1tVazcfHHRSOVWx9UyKK2wym6+nRei47PtkTbAbgTc1X3VvOXtfXFhkfmpVUWqZiSZFkAADs=",gecko:"R0lGODlhCAAIAMIEABsmMr0oM+Bvi99wiv///////////////yH5BAEKAAcALAAAAAAIAAgAAAMXeAczoOOQRtQRIgRsMW+XJnQeR0KWZiUAOw==",grass:"R0lGODlhCAAHAIABAAAAAP///yH5BAEKAAEALAAAAAAIAAcAAAIOjA2neeyRQIRwVsmQPAUAOw==",heart:"R0lGODlhBQAFAIABAL4mMzGi8iH5BAEKAAEALAAAAAAFAAUAAAIIDGygu3mBQgEAOw==",hole:"R0lGODlhRAAcAKEDAAAAAJycnJ2dnf///yH5BAEKAAMALAAAAABEABwAAAJznC0pd+rPxpvURVYT2HX7D2TgSIaZUHpHym5rC7sva8TlbNN1O+R37+MBacHRsHiLHZFLJKhJgvqkTgC1is1qt9yu9wsOi8fksvmMTqvX7Lb7DY/L5/S6PfcAObAB1Oi05wE4OPG3J1FxcTGh2OjYwIhRAAA7",pointer:"R0lGODlhBAAFAKECAAAAAP////fia/fiayH5BAEKAAIALAAAAAAEAAUAAAIIjGWAEKIsIigAOw==",pup:"R0lGODlhDgAEAKEDAOqKMfbia////v///yH5BAEKAAMALAAAAAAOAAQAAAIS1H6GKAIQWnvRPBiGo/HQ9Q0FADs=",skull:"R0lGODlhBAAEAIAAAP///////yH5BAEKAAEALAAAAAAEAAQAAAIFhB2Ql1kAOw==",spark:"R0lGODlhDgAOAIAAAP///////yH5BAEKAAEALAAAAAAOAA4AAAIdjA9wy8md4jNRwloXxnT7v3WfBj7hdE6BoyIKUwAAOw==",spider:"R0lGODlhEAAIAMIEAL4mM70qOTGi8v7+/////////////////yH5BAEKAAcALAAAAAAQAAgAAAMpeBAiASfKudqL1cHYmsxXNIhTJ0gCEREneYzHqR7qma72xMlr3JYxYAIAOw==",title:"R0lGODlhNgAWAMIEAL4mM+uJMaPOJ/fia////////////////yH5BAEKAAQALAAAAAA2ABYAAAPFSLrc/jDKqYYlNuM8tucdJW4dSF5oyY3TtbhVGH8qKwkCgev4vi89YO5ne/iGPSQjqDgWIU4ib6l0Ph1JZDA7PTKv1G2SJ+6Owei0es1uiwLwuALuiMsJdjo+P+fv8356DIB9doV3hH+BAX11jHuND4KQDXqGlJORlo+Og5wLmwCiAAyiDqOjCqimC6yqq6+rqa2kDbKxs6+lsASyrL+1u7q2wb3FrrTAw8jLxcPPxqezt8aozbjI2bzA1N213LnRydPfAAkAOw==",worm:"R0lGODlhEAAIAMIFAL4mM78uNL8wOp2dnZ6env///////////yH5BAEKAAcALAAAAAAQAAgAAAMneEc8+lCRQmmEs4igg2SEUgVAEXhZdVRskW2duq4jd9JRK7OiNRcJADs="},sfx:{hit:[,,537,.02,.02,.22,1,1.59,-6.98,4.97],piano:[.9,.8,270,,.1,,1,1.5,,,,,,,,.1,.01],land:[,,129,.01,,.15,,,,,,,,5],thunder:[1,,979,.01,.02,.52,1,2.52,.5,.7,,,.02,1.2,7,.2,.13,.48,.01,.44],fall:[.5,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],speak:[,,1236,.01,.01,.02,1,.13,,-6.5,,,,.2,,,,.14,.02,.25],powerup:[1.1,,698,.07,.23,.25,,1.5,,,103,.07,.09,,,.1,,.5,.22,.39],boss:[1.04,,612,.01,.17,.41,,.3,,,,,.17,,,.2,,.62,.25,.27]}},s=class{constructor(t){this.images=t,this.loaded=[],this.loadedImgs=0,this.totalImgs=Object.keys(t).length}start(){return new Promise((t,s)=>{this.resolve=t,this.reject=s,this.loadImages(this.images)})}loadImages(t){for(var s in t)t.hasOwnProperty(s)&&(this.loaded[s]=new Image,this.loaded[s].onload=this.checkLoaded(),this.loaded[s].src="data:image/gif;base64,"+t[s])}checkLoaded(){this.loadedImgs+=1,this.loadedImgs===this.totalImgs&&setTimeout(()=>this.resolve(this.loaded),250)}},i=(t,s)=>{let i=document.querySelector("#c"),h=(i.width=t)/(i.height=s),e=window.innerWidth,a=window.innerHeight;h<e/a?e=a*h:a=e/h,i.width=t,i.height=s,i.style.width=e+"px",i.style.height=a+"px",i.style.marginTop=-a/2+"px",i.style.marginLeft=-e/2+"px"},h=(window.addEventListener("resize",()=>{i(t.w,t.h)},!1),window.setTimeout(()=>{i(t.w,t.h)},50),class{constructor(t,s){const i=this,h=window.addEventListener;this.g=s,this.c=t,this.keys=[],this.freshKeys=[],this.mx=0,this.my=0,this.firstTouch=!1,this.touching=!1,this.fire=!1,h("keydown",t=>{this.keys[t.code]=this.keys[t.code]?this.keys[t.code]+=1:1}),h("keyup",t=>{this.keys[t.code]=0,this.freshKeys[t.code]=1}),h("touchstart",function(t){t.preventDefault(),i.firstTouch=!0,i.touching=!0,i.fire=!0,i.trackMove(t.touches[0])},{passive:!1}),h("touchmove",function(t){t.preventDefault(),i.firstTouch=!1,i.trackMove(t.touches[0])},{passive:!1}),h("touchend",function(){i.fire=!1,i.touching=!1}),h("mousemove",function(t){i.firstTouch=!1,i.trackMove(t)}),h("mousedown",function(){i.firstTouch=!0,i.touching=!0,i.fire=1},!1),h("mouseup",function(){i.fire=0,i.touching=!1},!1)}trackMove(t){t=this.getCords(t),this.mx=t[0],this.my=t[1]}getCords(t){var s=this.g,i=this.c.offsetTop,h=this.c.offsetLeft,s=parseInt(s.c.style.width,10)/s.c.width;return[~~((t.pageX-h)/s),~~((t.pageY-i)/s)]}}),e=class{constructor(t,s,i){this.w=t,this.h=s,this.c=document.querySelector("canvas#c"),this.ctx=this.c.getContext("2d"),this.pal=i}clear(t){t=this.pal[t],this.ctx.fillStyle=`rgb(${t[0]},${t[1]},${t[2]})`,this.ctx.fillRect(0,0,this.c.width,this.c.height)}rect(t,s,i,h,e){e=this.pal[e],this.ctx.fillStyle=`rgb(${e[0]},${e[1]},${e[2]})`,this.ctx.fillRect(~~t,~~s,i,h)}img(t,s,i,h=0,e=!1){e&&(this.ctx.globalAlpha=e),this.ctx.drawImage(t,~~s,~~i),e&&(this.ctx.globalAlpha=1)}rotate(t,s){var i=document.createElement("canvas"),h=i.getContext("2d"),e=Math.max(t.width,t.height);return i.width=e,i.height=e,h.translate(e/2,e/2),h.rotate(s+Math.PI/2),h.drawImage(t,-t.width/2,-t.height/2),i}flip(t,s,i){var h=this.mkCanvas(t.width,t.height),e=h.getContext("2d"),a=s?-1:1,r=i?-1:1;return s=s?-1*t.width:0,i=i?-1*t.height:0,h.width=t.width,h.height=t.height,e.save(),e.scale(a,r),e.drawImage(t,s,i,t.width,t.height),e.restore(),h}resize(t,s,i=1){var h=this.mkCanvas(t.width*s,t.height*s),e=h.getContext("2d");return 1!==i&&(e.globalAlpha=i),h.width&&(e.save(),e.scale(s,s),i<1&&(this.ctx.globalAlpha=i),e.drawImage(t,0,0),i<1&&(this.ctx.globalAlpha=1),e.restore()),h.scale=s,e.globalAlpha=1,h}color(t,s){let i,h=this.mkCanvas(t.width,t.height),e=h.getContext("2d"),a=0;for(e.drawImage(t,0,0),i=e.getImageData(0,0,t.width,t.height),a=0;a<i.data.length;a+=4)i.data[a+0]=s[0],i.data[a+1]=s[1],i.data[a+2]=s[2];return e.putImageData(i,0,0),h}textWidth(t,s){return t.length*(3*s.scale)+t.length*+s.scale}text(t,s,i,h){let e=0,a=this.ctx,r=0,o=3*s.scale,n=5*s.scale,l=+s.scale,g=this.textWidth(t,s),c=0,d="0123456789".split("");for("number"!=typeof t&&"0"!==t[0]||(t+="",r=43),i=i||(this.c.width-g)/2,e=0;e<t.length;e+=1)r="number"==typeof t[e]||"0"===t[e]||-1!==d.indexOf(t[e])?43:0,c=(t.charCodeAt(e)-65+r)*(o+l),"?"===t[e]&&(c=144),":"===t[e]&&(c=148),-1<(c="%"===t[e]?152:c)&&a.drawImage(s,c,0,o,n,~~i,~~h,o,n),i+=o+l}mkCanvas(t,s){var i=document.createElement("canvas"),h=i.getContext("2d");return i.width=t,i.height=s,h.mozImageSmoothingEnabled=!1,h.imageSmoothingEnabled=!1,i}},a={timeStamp:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},pad:(t,s=5)=>Array(s-String(t).length+1).join("0")+t,rnd:function(t,s){return Math.floor(Math.random()*(s-t+1)+t)},rndArray:function(t){return t[~~(Math.random()*t.length)]},mkCanvas:function(t,s){var i=document.createElement("canvas"),h=i.getContext("2d");return i.width=t,i.height=s,h.imageSmoothingEnabled=!1,i},mkFont:function(t,s,i){var h=`font_${s}_`+i;return t.imgs[h]||(i=t.draw.color(t.imgs.font,t.data.pal[i]),(i=t.draw.resize(i,s)).scale=s,t.imgs[h]=i),t.imgs[h]},toHex(t){let s="#";return t.forEach(t=>{s+=t.toString(16)}),s},toggleFullScreen(t){document.fullscreenElement?document.exitFullscreen():t.requestFullscreen()},getDist:function(t,s){var i=t.x-s.x;return t=t.y-s.y,Math.sqrt(i*i+t*t)},getAngle:function(t,s){var i=t.x-s.x;return t=t.y-s.y,Math.atan2(t,i)},tween:function(t,s,i,h){return i*t/h+s}},r=44100,o=new AudioContext,n=(window.P8=function(t,s){const T=t.split("\n"),E=s.split("\n");let i=0;const P=(t,s,i)=>parseInt(t.substr(s,i),16),R=t=>t+.5|0,K=[t=>Math.abs(2*t-1)-1,t=>.5*(t<.9?2*t/.9-1:2*(1-t)/(1-.9)-1),t=>.6*(t<.5?t:t-1),t=>t<.5?.5:-.5,t=>t<.3?.5:-.5,t=>(t<.5?3-Math.abs(24*t-6):1-Math.abs(16*t-12))/9,()=>{var t=2*Math.random()-1;return 10*(i=(i+.02*t)/1.02)},(t,s)=>(s=Math.abs(s/128%1*2-1),(Math.abs((t+.5*s)%1*4-2)-Math.abs(8*t-4))/6)],L=t=>65*2**(t/12),e={},G=(i,h)=>{{let t=i+"-"+h,s=e[t];return s||(s=((t,c)=>{const h=T[t];var d=P(h,2,2),s=d/120;const i=P(h,4,2),e=P(h,6,2)||32;let a=e*r,A=(t=o.createBuffer(1,a,r)).getChannelData(0),m=t=>t+1>=e?i:t+1,p=(t,s,i)=>P(h,8+5*t+s,i),u=0,f=0,w=0,x=24,y=L(24),b=-1,v=-1,E=-1;for(;u<a;){var k=p(w,0,2)+c,I=L(k),O=p(w,2,1),B=p(w,3,1)/8,C=p(w,4,1),H=p(D=m(w),0,2)+c,S=p(D,2,1),M=p(D,3,1),D=p(D,4,1);let a=.02,o=((4===C||O===b&&(k===x||1===C)&&0<v&&5!==E)&&(a=0),.05),n=((5===C||O===S&&(k===H||1===D)&&0<M&&4!==D)&&(o=0),R(s*r)),l=7<O&&G(O-8,c+k-24),g=0;for(let e=u;e<u+n;e++){let t=(e-u)/n,s=1,i=(t<a?s=t/a:t>1-o&&(s=(1-t)/o),I),h=B;1===C&&(i=(1-t)*y+t*I,0<v)&&(h=(1-t)*v+t*B),2===C&&(i*=1+.02*Math.sin(7.5*t)),3===C&&(i*=1-t),4===C&&(h*=t),5===C&&(h*=1-t),6<=C&&(i=L(p(-4&w|3&(d<=8?32:16)/(6===C?4:8)*t,0,2)+c)),f+=i/r,O<8?A[e]+=h*s*K[O](f%1,f):(A[e]+=h*s*l[g],g=(g+1)%l.length)}u+=n,x=k,y=I,b=O,v=B,E=C,w=m(w)}return t})(i,h),e[t]=s),s}},k=(t,s=!1,i=0)=>{var h=o.createBufferSource();return h.buffer=t,h.loop=s,h.loopStart=i,h.connect(o.destination),h.start(),h};this.sfx=t=>k(G(t,0)),this.music=i=>{let h=[],e=[],t=0,a=0,n=E.length-1;for(let s=i;s<=n;s++){var l=E[s],g=P(l,0,2);for(let t=h[s]=0;t<4;t++){var c=P(l,3+2*t,2);if(c<T.length&&(c=T[c],0===P(c,6,2))){h[s]=t;break}}var d=P(l,3+2*h[s],2),d=T[d];if(d=P(d,2,2)/120,e[s]=R(32*d*r),1&~g||(t=a),a+=32*d,!(2&~g)){n=s;break}}let s=r*a,A=(s=o.createBuffer(1,s,r)).getChannelData(0),m=0;for(let t=i;t<=n;t++){var p=E[t],u=e[t];for(let t=0;t<4;t++)if((y=P(p,3+2*t,2))<T.length){var[f,w,x,y,b=0]=[A,m,m+u,y],v=G(y,b).getChannelData(0);let t=0;for(;w<x;)f[w]+=v[t],t=(t+1)%v.length,w++}m+=u}return k(s,!0,t)}},P8);function l(t,i,s=1,h=1){i=t.draw.resize(i,s,h);var e=Math.ceil(t.w/i.width),a=Math.ceil(t.h/i.height);c=t.H.mkCanvas(t.w,t.h),ctx=c.getContext("2d");for(let s=0;s<=a;s+=1)for(let t=0;t<=e;t+=1)ctx.drawImage(i,t*i.width,s*i.width);return c}var g=(t=1,s=.05,i=220,h=0,e=0,a=.1,r=0,o=1,n=0,l=0,g=0,c=0,A=0,m=0,p=0,u=0,f=0,w=1,x=0,y=0,b=Math,v=44100,E=2*b.PI,k=n*=500*E/v/v,I=i*=(1-s+2*s*b.random(s=[]))*E/v,O=0,B=0,C=0,H=1,S=0,M=0,D=0,T,P)=>{for(l*=500*E/v**3,p*=E/v,g*=E/v,c*=v,A=v*A|0,P=(h=v*h+9)+(x*=v)+(e*=v)+(a*=v)+(f*=v)|0;C<P;s[C++]=D)++M%(100*u|0)||(D=r?1<r?2<r?3<r?b.sin((O%E)**3):b.max(b.min(b.tan(O),1),-1):1-(2*O/E%2+2)%2:1-4*b.abs(b.round(O/E)-O/E):b.sin(O),D=(A?1-y+y*b.sin(E*C/A):1)*(0<D?1:-1)*b.abs(D)**o*.3*t*(C<h?C/h:C<h+x?1-(C-h)/x*(1-w):C<h+x+e?w:C<P-f?(P-C-f)/a*w:0),D=f?D/2+(C<f?0:(C<P-f?1:(P-C)/f)*s[C-f|0]/2):D),O+=(T=(i+=n+=l)*b.cos(p*B++))-T*m*(1-1e9*(b.sin(C)+1)%2),H&&++H>c&&(i+=g,I+=g,H=0),!A||++S%A||(i=I,n=k,H||=1);return(t=d.createBuffer(1,P,v)).getChannelData(0).set(s),(i=d.createBufferSource()).buffer=t,i.connect(d.destination),i.start(),i},d=new AudioContext,A=g,m=(g=class{constructor(t,s){for(var i in this.g=t,this.o=s,this.id="id-"+Math.random().toString(36).substr(2,16),this.dead=!1,this.remove=!1,this.offsetY=0,this.name=s.i,s)this[i]=s[i];this.lastPos={x:this.x,y:this.y},this.flip={x:0,y:0},this.reduceHitBoxBy=0,this.scale=s.scale||1,this.frame=s.frame||1,this.frames=s.frames||1,this.frameRate=s.frameRate||80,this.frameNext=s.frameNext||0,s.i&&(this.iKey=s.i+"_"+this.scale,this.mkImg(this.iKey)),this.hurt=!1,this.hurtTime=0,this.hurtTimeMaster=25,this.anims={idle:{frames:[1],rate:80}},this.changeAnim("idle")}update(t){this.collidesWith&&this.collidesWith.forEach(t=>{this.hitGroup(t)}),this.hurt&&--this.hurtTime,this.hurtTime<0&&(this.hurt=!1,this.hurtTime=this.hurtTimeMaster),this.updateAnim(t),this.lastPos.x=this.x,this.lastPos.y=this.y}render(){let t=this.g,s=this.hurt?this.iHurt:this.i,i=this.frame;s?(this.flip.x&&(s=this.flipX,i=this.frames-this.frame+1),t.draw.ctx.drawImage(s,i*this.w-this.w,0,this.w,this.h,~~this.x,~~this.y+this.offsetY,this.w,this.h)):t.draw.rect(this.x,this.y,this.w,this.h,this.col)}updateAnim(t){this.frameNext<0&&(this.frameNext=this.anim.rate,this.anim.counter+=1,this.anim.counter>=this.anim.frames.length&&(this.anim.next?this.changeAnim(this.anim.next):(this.anim.cb&&this.anim.cb.call(this),this.anim.counter=0)),this.frame=this.anim.frames[this.anim.counter]),this.frameNext-=t}hitGroup(s){this.g.ents.forEach(t=>{t&&t.group===s&&t.id!==this.id&&this.hit(t)&&(this.receiveDamage(t),t.doDamage(this))})}hit(t){var s=this,i=this.reduceHitBoxBy,h=i?t.y+i:t.y,e=i?t.x+i:t.x,a=i?t.w-2*i:t.w;return!(h+(i?t.h-2*i:t.h)<s.y||s.y+s.h<h||e+a<s.x||s.x+s.w<e)}receiveDamage(t){}doDamage(t){}isOffScreen(){var t=this.g;return this.x<-this.w||this.x>t.w+this.w||this.y<-this.h||this.y>t.h+this.h}kill(){this.dead=this.remove=!0}getAngle(t,s){return t-=this.x,s-=this.y,Math.atan2(s,t)}mkImg(t){var s=t+"_flipx",i=t+"_flipy",h=t+"_hurt";this.g.imgs[t]?this.i=this.g.imgs[t]:(this.i=this.g.draw.resize(this.g.imgs[this.name],this.scale),this.g.imgs[t]=this.i),this.g.imgs[s]?this.flipX=this.g.imgs[s]:(this.flipX=this.g.draw.flip(this.i,1,0),this.g.imgs[s]=this.flipX),this.g.imgs[i]?this.flipY=this.g.imgs[i]:(this.flipY=this.g.draw.flip(this.i,0,1),this.g.imgs[i]=this.flipY),this.g.imgs[h]||(this.g.imgs[h]=this.g.draw.color(this.i,this.g.data.pal[2])),this.iHurt=this.g.imgs[h],this.w=this.i.width/this.frames,this.h=this.i.height,this.halfW=this.w/2,this.xLimit=this.g.w-this.w,this.yLimit=this.g.h-this.h}changeAnim(t){this.anim&&this.anim.name&&this.anim.name===t||(this.anim=this.anims[t],this.anim.name=t,this.anim.counter=0,this.frame=this.anim.frames[0],this.frameNext=this.anim.rate)}bindToScreen(){this.x<0&&(this.x=0),this.x>this.xLimit&&(this.x=this.xLimit),this.y<0&&(this.y=0),this.y>this.yLimit&&(this.y=this.yLimit)}boom(){}},class extends g{constructor(t,s){s.hits=s.hits||0,s.scale=s.scale||2,s.shake=s.shake||!1,s.score=s.score||10*s.scale,s.flash=s.flash||!1,s.hurtTimeMaster=s.hurtTimeMaster||200,super(t,s),this.group="baddies",this.collidesWith=["bullets","player"],this.shadow={x:0,y:this.halfW},this.p1=this.p.p1}update(t){super.update(t),this.hurt&&--this.hurtTime,this.hurtTime<0&&(this.hurt=!1,this.hurtTime=this.hurtTimeMaster)}render(){this.shadow&&(this.g.draw.ctx.globalAlpha=.2,this.g.draw.img(this.g.imgs.circle_2_0,this.x+this.shadow.x,this.y+this.shadow.y),this.g.draw.ctx.globalAlpha=1),super.render()}receiveDamage(t){t.kill(),this.g.sfx("land"),this.frame=2,--this.hits,this.g.spawn("Boom",{x:this.x+this.halfW,y:this.y+this.halfW,key:"boom",scale:4,p:3,col:2,type:this.hits<0?"circle":"spark"}),-1===this.hits?(this.shake&&this.g.shake("shake-fast"),this.flash&&(this.p.bgCol=2,this.g.addEvent({t:2,cb:()=>{this.p.bgCol=this.p.gameOver?3:this.p.bgColMaster}})),this.kill(),this.p.score+=10*this.scale):(this.hurt=!0,this.hurtTime=this.hurtTimeMaster)}});t.scenes={Title:class{constructor(t){this.g=t,this.f=t.H.mkFont(t,3,1),this.i=t.draw.resize(this.g.imgs.title,4),this.shadow=t.draw.color(this.i,t.data.pal[0],.2),this.canStart=!1,this.bgPos=0,this.bgSpeed=.25,t.spawn("Button",{y:this.g.h-130,clickCol:11,col:4,text:"PLAY",cb:()=>{t.changeScene(0===t.plays?"Tut":"Play")}}),t.addEvent({t:100,cb:()=>{this.canStart=!0,t.spawn("Button",{y:t.h-60,textCol:1,clickCol:0,col:!1,text:"CREDITS",cb:()=>{t.changeScene("Help")}})}}),this.bling()}update(s){this.fader=Math.sin(.005*(new Date).getTime()),this.bgPos+=this.bgSpeed,this.bgPos>this.g.h&&(this.bgPos=0),this.g.ents.forEach(t=>{t.update(s)})}render(){var t=this.g;t.draw.clear(5),t.draw.img(t.imgs.bg2,0,this.bgPos-this.g.h),t.draw.img(t.imgs.bg2,0,this.bgPos),t.draw.img(this.shadow,20,125),t.draw.img(this.i,20,120),t.ents.forEach(t=>{t.render()}),t.draw.text("HI",this.f,95,10),t.draw.text(this.g.hiScore,this.f,130,10),t.mobile||t.draw.img(t.imgs.pointer,t.input.mx,t.input.my)}bling(){let t=this.g.H.rndArray([[180,125],[120,200],[60,150]]);this.g.addEvent({t:this.g.H.rnd(100,150),cb:()=>{this.g.spawn("Boom",{x:t[0],y:t[1],key:"boom",scale:4,col:2,type:"spark"}),this.bling()}})}},Help:class{constructor(t){this.g=t,this.f=t.H.mkFont(t,5,4),this.f2=t.H.mkFont(t,3,2),this.f3=t.H.mkFont(t,3,1),t.spawn("Button",{y:this.g.h-90,clickCol:11,col:4,text:"BACK",cb:()=>{t.changeScene("Title")}}),t.spawn("Button",{x:45,y:265,size:3,noscroll:!0,textCol:1,clickCol:0,col:!1,w:120,text:"SOURCE",cb:()=>{window.location.href="https://snabisch.itch.io/free-music-sequences-for-pico-8"}})}update(s){this.g.ents.forEach(t=>{t.update(s)})}render(){var t=this.g;t.draw.clear(0),this.g.draw.text("CREDITS",this.f,!1,20),this.g.draw.text("CODE AND GFX",this.f3,50,90),this.g.draw.text("BY EOINMCG",this.f2,50,120),this.g.draw.text("MUSIC",this.f3,50,180),this.g.draw.text("BY SNABISCH",this.f2,50,210),t.ents.forEach(t=>{t.render()}),t.draw.img(t.imgs.pointer,t.input.mx,t.input.my)}},Play:class{constructor(t){this.g=t,this.bg=t.imgs.bg,this.bg2=t.imgs.bg2,this.bgPos=0,this.bgSpeed=1,this.bgColMaster=t.H.rndArray([12,16,17,18,19]),this.bgCol=this.bgColMaster;for(let t=0;t<6;t+=1)this.g.spawn("Obj",{p:this});this.p1=this.g.spawn("P1",{p:this}),this.newHiScore=!1,this.score=0,this.dist=0,t.plays+=1,this.offset={x:0,y:0},this.scoreFont=t.H.mkFont(t,4,2),this.gameOver=!1,this.g.audio=this.g.track1.music(0),(window.P=this).hole=this.g.spawn("Hole",{p:this,y:3*-t.h}),this.allBaddies=["Cactus","Bat","Spider","Worm"],this.baddies=[],this.boss=!1,this.startSpawn()}update(s){this.fader=Math.sin(.003*(new Date).getTime()),this.g.ents.forEach(t=>{t.update(s)}),this.bgPos+=this.bgSpeed,this.dist+=this.bgSpeed,this.bgPos>this.g.h&&(this.bgPos=0),this.p1.dead&&(this.bgSpeed=0),this.dist%1e3==0&&this.addBaddie(),!this.newHiScore&&this.score>this.g.hiScore&&(this.newHiScore=!0,this.g.addText("NEW HISCORE",0,!1,200,4,5))}render(){var t=this.g,s=(t.draw.clear(this.bgCol),t.draw.img(this.bg,0,this.bgPos-this.g.h),t.draw.img(this.bg,0,this.bgPos),t.draw.img(this.bg2,0,this.bgPos-this.g.h),t.draw.img(this.bg2,0,this.bgPos),t.ents.forEach(t=>{"gecko"!==t.name&&t.render()}),this.gameOver?this.gameOver&&0<this.fader&&(this.g.draw.text("GAME",this.g.imgs._titleFont,!1,158),this.g.draw.text("GAME",this.g.imgs.titleFont,!1,150),this.g.draw.text("OVER",this.g.imgs._titleFont,!1,218),this.g.draw.text("OVER",this.g.imgs.titleFont,!1,210)):this.p1.render(),Math.round(this.score));t.draw.text(t.H.pad(s),this.scoreFont,!1,20),this.gameOver&&!this.g.mobile&&this.g.draw.img(this.g.imgs.pointer,this.g.input.mx,this.g.input.my)}initGameOver(){if(!this.gameOver){if(this.newHiScore){this.g.hiScore=this.score;try{window.localStorage.setItem("GBhi",this.g.hiScore)}catch(t){}}this.g.sfx("thunder"),this.stopMusic(),this.gameOver=!0,this.g.addEvent({t:100,cb:()=>{this.spawnReplay()}})}}spawnReplay(){this.g.spawn("Button",{y:this.g.h-120,clickCol:4,col:11,text:"REPLAY",cb:()=>{this.g.changeScene("Play")}})}startSpawn(){this.addBaddie(),this.spawn()}addBaddie(){this.baddies.length!==this.allBaddies.length?this.baddies.push(this.allBaddies[this.baddies.length]):this.bgSpeed<2?this.bgSpeed+=.5:2<=this.bgSpeed&&this.bossTime()}spawn(){if(!this.gameOver&&!this.boss){var t=20<(t=~~(this.dist/500))?20:t;const i=this.g.H.rnd(80,120)-t;this.g.addEvent({t:i,cb:()=>{var t=this.g.H.rndArray(this.baddies);if(.7<Math.random()&&this.g.spawn("Cactus",{p:this}),this.g.spawn(t,{p:this}),.9<Math.random()){var s=this.g.H.rnd(50,250);for(let t=1;t<=4;t+=1)this.g.spawn("Donut",{p:this,x:s,y:-32*t})}this.spawn(i)}})}}bossTime(){this.stopMusic(),this.g.addText("BOSS TIME",0,!1,200,3,5),this.g.sfx("boss"),this.g.addEvent({t:50,cb:()=>{this.sparkle()}}),this.g.addEvent({t:100,cb:()=>{this.boss=!0,this.bgSpeed=0,this.g.spawn("Boss",{p:this})}})}sparkle(){let t=20,s=this.g.w/2;for(;t--;)this.g.addEvent({t:3*t,cb:()=>{var t=this.g.H.rnd(-20,20);this.g.sfx("speak"),this.g.spawn("Boom",{x:s+t,y:50+t,key:"boom",type:"spark",col:this.g.H.rnd(3,4)})}})}stopMusic(){try{this.g.audio.stop()}catch(t){console.log(t)}}},Tut:class{constructor(t){this.g=t,this.tutorial=!0,this.escape=!1,this.bgPos=0,this.bgSpeed=1,this.f=t.H.mkFont(t,5,4),this.f2=t.H.mkFont(t,2,1),this.p1=t.spawn("P1",{p:this}),t.addText(t.mobile?"MOVE WITH FINGER":"MOVE WITH MOUSE",50),t.sfx("piano"),t.addEvent({t:600,cb:()=>{t.sfx("piano"),t.addText("KILL BADDIES",1),t.spawn("Cactus",{p:this})}}),t.addEvent({t:1200,cb:()=>{t.sfx("piano"),t.addText("COLLECT POWERUPS",1),t.spawn("Powerup",{p:this,x:t.w/2,y:0})}}),t.addEvent({t:1700,cb:()=>{t.sfx("piano"),t.addText("LETS GO!",1)}}),t.addEvent({t:1900,cb:()=>{t.changeScene("Play")}}),t.mobile&&t.spawn("Button",{x:t.w-80,y:t.h-40,textCol:1,clickCol:0,col:!1,w:120,text:"SKIP",cb:()=>{t.changeScene("Play")}})}initGameOver(){this.g.chageScene("Tut")}update(s){this.bgPos+=this.bgSpeed,this.bgPos>this.g.h&&(this.bgPos=0),this.g.ents.forEach(t=>{t.update(s)}),this.g.input.freshKeys.Escape&&!this.escape&&(this.escape=!0,this.g.changeScene("Play"))}render(){var t=this.g;t.draw.clear(19),t.draw.img(t.imgs.bg2,0,this.bgPos-this.g.h),t.draw.img(t.imgs.bg2,0,this.bgPos),this.g.draw.text("TUTORIAL",this.f,!1,20),t.ents.forEach(t=>{t.render()}),this.g.mobile||this.g.draw.text("ESC TO SKIP",this.f2,!1,this.g.h-30)}},Win:class{constructor(t){this.g=t,this.bgPos=0,this.f=t.H.mkFont(t,6,2),this._f=t.H.mkFont(t,6,0),this.d=this.g.draw.resize(this.g.imgs.donut,8),t.addText("THE END",100,!1,t.h-50,1)}update(s){this.g.ents.forEach(t=>{t.update(s)}),this.g.input.freshKeys.Escape&&!this.escape&&(this.escape=!0,this.g.changeScene("Title"))}render(){var t=this.g;t.draw.clear(16),t.draw.img(t.imgs.bg2,0,this.bgPos-this.g.h),t.draw.img(t.imgs.bg2,0,this.bgPos),0<this.g.fader&&(this.g.draw.text("YOU ROCK",this._f,!1,26),this.g.draw.text("YOU ROCK",this.f,!1,20)),this.g.draw.img(this.d,105,200),t.ents.forEach(t=>{t.render()})}}},t.ents={Particle:class{constructor(t,s){this.g=t,this.x=s.x,this.y=s.y,this.w=s.w||8,this.h=this.w,this.vx=t.H.rnd(2,5)*t.H.rndArray([1,-1]),this.vy=t.H.rnd(2,5)*t.H.rndArray([1,-1]),this.col=s.col||2,this.i=t.imgs[`dot_${this.w}_`+this.col]}update(){this.x+=this.vx,this.y+=this.vy,(this.y>this.g.h||this.y<0||this.x<0||this.x>this.g.w)&&(this.remove=!0)}render(){this.g.draw.ctx.drawImage(this.i,this.x,this.y)}},P1:class extends g{constructor(t,s){s.i="gecko",s.frames=1,s.scale=3.5,super(t,s),this.shadow=t.draw.color(t.imgs.circle,0),this.shadow=t.draw.resize(this.shadow,this.scale/1.9,.1),this.group="player",this.collidesWith=["baddies"],this.x=t.w/2-this.w/2,this.y=t.h-80,this.offset={x:0,y:0},this.currentFrame=1,this.reduceHitBoxBy=8,this.shotDelayTime=50,this.shotDelay=50,this.powerups=0,this.minX=0,this.maxX=this.g.w-this.w,this.minY=2*this.h,this.maxY=this.g.h-2*this.h,this.imgs={s1:this.i,s2:this.flipX,l1:t.draw.rotate(this.i,4.4),l2:t.draw.rotate(this.flipX,4.5),r1:t.draw.rotate(this.i,5.1),r2:t.draw.rotate(this.flipX,5.1)},this.frame=1,this.dir="s",this.tailxOff=0,this.tailxDir=2,this.tail=[];let i=5;for(;i;)this.tail.push({x:this.x,y:this.y,s:i}),i--}update(t){super.update(t),(t=this.g.input).firstTouch&&(this.offset.x=t.mx-this.x,this.offset.y=t.my-this.y),!t.touching&&this.g.mobile||(this.x=t.mx-this.offset.x,this.y=t.my-this.offset.y),this.bindToScreen(),t=this.tail,this.tailxDir=t[t.length-1].x>t[t.length-2].x?2:-2,t=Math.floor(t[0].x-t[1].x),this.dir=0<t?"r":t<-1?"l":"s",this.fader=Math.sin(.03*(new Date).getTime()),this.frame=0<this.fader?1:2,this.shotDelay<0&&this.shoot(),this.shotDelay--}render(){this.g.draw.img(this.shadow,this.x+6,this.y+12),this.g.draw.img(this.imgs[""+this.dir+this.frame],this.x,this.y+6);let e={x:this.x,y:this.y},a=8;this.tailxOff=0,this.tail.forEach((t,s)=>{var i=s%2==0?4:3,h=(4<a&&--a,(e.x-t.x)/2);t.x+=h,t.y+=8*(e.y+t.y),this.g.draw.rect(t.x+9+this.tailxOff,this.y+this.h+a*s*1.1,a,a,i),e=t,this.tailxOff+=this.tailxDir})}receiveDamage(t){"cactus"===t.name&&this.kill()}kill(t=3){const s=this.x,i=this.y,h=this.w/2;for(super.kill(),this.p.initGameOver(),this.g.sfx("land"),this.p.bgCol=3,this.g.shake();t--;)this.g.addEvent({t:15*t,cb:()=>{var t=this.g.H.rnd(-h,h);this.g.spawn("Boom",{x:s+t,y:i+t,key:"boom"})}})}fall(){this.kill(0),this.g.sfx("fall"),this.p.initGameOver()}shoot(){this.shotDelay=this.shotDelayTime,this.g.spawn("Bullet",{p:this.p,x:this.x+this.halfW,y:this.y}),this.g.spawn("Circle",{x:this.x+this.halfW/2.5,y:this.y-this.h/2,i:"circle"}),0<this.powerups&&this.g.spawn("Bullet",{p:this.p,x:this.x-this.halfW/2,y:this.y}),1<this.powerups&&this.g.spawn("Bullet",{p:this.p,x:this.x+this.halfW,y:this.y,vy:-4,vx:-4}),2<this.powerups&&this.g.spawn("Bullet",{p:this.p,x:this.x+this.halfW,y:this.y,vy:-4,vx:4}),3<this.powerups&&this.g.spawn("Bullet",{p:this.p,x:this.x+this.halfW/2,y:this.y,vy:6})}addPowerup(){this.powerups+=1,4<this.powerups&&(this.p.score+=50)}},Bullet:class extends g{constructor(t,s){s.scale=3,s.i="bullet",super(t,s),this.vy=s.vy||-6,this.vx=s.vx||0,this.group="bullets",0<this.vy&&(this.i=t.imgs[`bullet_${this.scale}_flipy`])}update(t){super.update(t),this.y+=this.vy,this.x+=this.vx,this.isOffScreen()&&(this.remove=!0)}},Circle:class extends g{constructor(t,s){s.scale=1,super(t,s),this.ttl=.02}update(t){this.ttl-=t,this.ttl<0&&this.kill(),super.update(t)}},Boom:class{constructor(t,s){if(this.g=t,this.type=s.type||"circle",this.col=s.col||2,this.startX=s.x,this.startY=s.y,this.magnitude=s.m||4,this.scale=1,this.factor=s.factor||.5,s.p)for(;s.p--;)this.g.spawn("Particle",{x:s.x,y:s.y,col:s.col})}update(){this.scale+=this.factor,this.scale>this.magnitude&&0<this.factor&&(this.factor*=-1),this.scale<=1&&(this.remove=!0),this.iKey=`${this.type}_${Math.ceil(this.scale)}_`+this.col,this.i=this.g.imgs[this.iKey]}render(){var t,s;this.i&&(s=this.i.width/2,t=this.startX-s,s=this.startY-s,this.g.draw.img(this.i,t,s))}},Bat:class extends m{constructor(t,s){s.x=s.x||t.H.rndArray([0,t.w]),s.i=s.i||"bat",s.frames=s.frames||2,s.scale=s.scale||5,s.hits=1,super(t,s),this.vy=2,this.vx=.5,this.y=s.y||-this.h,2==s.frames&&(this.anims={flap:{frames:[1,2],rate:.4}},this.changeAnim("flap"),this.shadow={x:this.halfW,y:this.h})}update(t){super.update(t),this.y+=this.vy,this.x>this.p1.x?(this.x-=this.vx,this.flip.x=!1):this.x<this.p1.x&&(this.x+=this.vx,this.flip.x=!0),this.y>this.g.h+this.h&&(this.remove=!0)}},Button:class extends g{constructor(t,s){"col"in s||(s.col=7),"clickCol"in s||(s.clickCol=3),s.x=s.x||!1,s.w=s.w||140,s.h=s.h||40,s.textCol=s.textCol||2,s.hoverCol=s.hoverCol||2,s.center=!1===s.x,s.size=s.size||4,t.imgs["font_"+s.textCol]||(t.imgs["font_"+s.textCol]=t.H.mkFont(t,s.size,s.textCol)),t.imgs["font_"+s.hoverCol]||(t.imgs["font_"+s.hoverCol]=t.H.mkFont(t,s.size,s.hoverCol)),super(t,s),this.g=t,this.x=s.x||t.w/2-s.w/2,this.p=t.imgs["font_"+s.textCol],this.pHover=t.imgs["font_"+s.hoverCol],this.clicked=!1,this.clickCol=s.clickCol,this.currentCol=s.col,this.clicked=!1,this.textW=t.draw.textWidth(this.text,this.p)/2,this.tX=s.x?s.x+20:t.w/2-this.textW,this.origX=this.x,this.origY=s.y,this.center||(this.tX=this.x+4),s.noscroll||(this.y=this.g.h+2*this.h)}update(){this.hover=this.intersects(this.g.input.mx,this.g.input.my),this.y>this.origY&&(this.y-=2);var t=this.hover&&this.g.input.touching;this.currentCol=this.hover?this.clickCol:this.col,t&&this.cb&&!this.clicked&&(this.clicked=!0,this.cb.call(this))}render(){var t=this.hover?this.pHover:this.p;this.col&&(this.g.draw.ctx.globalAlpha=.3,this.g.draw.rect(this.x,this.y+10,this.w,this.h,0),this.g.draw.ctx.globalAlpha=1,this.g.draw.rect(this.x,this.y,this.w,this.h,this.currentCol)),this.g.draw.text(this.text,t,this.tX,this.y+10)}intersects(t,s){return t>this.x&&t<this.x+this.w&&s>this.y&&s<this.y+this.h}},Text:class extends g{constructor(t,s){for(var i in s.group="text",s.w=10,s.w=10,s.o=s.o||1,s.scale=s.scale||2,s.col=s.col||1,s.fade=s.fade||.01,super(t,s),s)this[i]=s[i];this.g=t,this.p=t.H.mkFont(t,s.scale,s.col)}update(){(this.y<0||this.o<0)&&(this.remove=!0),this.o-=this.fade}render(){var t;this.o<0||((t=this.g.draw).ctx.globalAlpha=this.o,t.text(this.text,this.p,this.x,this.y),t.ctx.globalAlpha=1)}},Hole:class extends g{constructor(t,s){s.x=t.H.rnd(50,250),s.i="hole",s.scale=2,super(t,s),this.group="baddies",this.collidesWith=["player"],this.x=0,this.reset(s.y)}reset(t=!1){this.y=t||-this.g.h,t=this.scale+2;var s="bridge_"+this.scale;this.bridge={x:this.g.H.rnd(30,this.g.w-30),yOff:10,key:"bridge_"+t,w:this.g.imgs[s].width*(t/2),h:this.g.imgs[s].height*(t/2)}}update(t){super.update(t),this.p.p1.dead||(this.y+=this.p.bgSpeed),this.y>this.g.h+this.h&&this.reset(),this.bridge.y=this.y-this.bridge.yOff}render(){super.render(),this.g.draw.img(this.g.imgs[this.bridge.key],this.bridge.x,this.bridge.y)}receiveDamage(t){t.hit(this.bridge)||t.fall()}},Cactus:class extends m{constructor(t,s){s.x=16*t.H.rnd(0,15),s.i="cactus",s.frames=2,s.scale=5,s.hits=2,s.shake=!0,s.flash=!0,super(t,s),this.y=-this.h,t.ents.forEach(t=>{"hole"===t.name&&this.hit(t)&&(this.y=t.y-t.h)})}update(t){super.update(t),this.p.gameOver||(this.y+=this.p.bgSpeed),this.y>this.g.h+this.h&&(this.remove=!0)}receiveDamage(t){super.receiveDamage(t),-1===this.hits&&(.5<Math.random()||this.p.tutorial)&&this.g.spawn("Powerup",{p:this.p,x:this.x,y:this.y})}},Donut:class extends g{constructor(t,s){s.x=s.x||t.H.rnd(50,250),s.i="donut",s.frames=1,s.scale=3,super(t,s),this.shadow=!0,this.group="bonus",this.collidesWith=["player"],this.y=s.y||-this.h,this.collected=!1,t.ents.forEach(t=>{"baddies"===t.group&&this.hit(t)&&(this.remove=!0)})}update(t){super.update(t),this.p.gameOver||(this.y+=this.p.bgSpeed),this.y>this.g.h+this.h&&(this.remove=!0),this.collected&&(this.y+=this.vy,this.vy+=-.2,this.x<this.g.w/2&&(this.x+=1),this.x>this.g.w/2&&--this.x,this.y<0)&&(this.remove=!0)}render(){this.g.draw.ctx.globalAlpha=.2,this.g.draw.img(this.g.imgs.circle_2_0,this.x,this.y+6),this.g.draw.ctx.globalAlpha=1,super.render()}receiveDamage(){this.collected||(this.collected=!0,this.vy=-2*this.p.bgSpeed,this.g.sfx("piano"),this.g.spawn("Boom",{x:this.x+this.halfW,y:this.y+this.halfW,key:"boom",scale:4,type:"spark",col:8}),this.p.score+=20)}},Spider:class extends m{constructor(t,s){s.x=t.H.rndArray([0,t.w]),s.i="spider",s.frames=2,s.scale=3,s.hits=1,super(t,s),this.vy=-2,this.vx=.5,this.y=t.h+this.h,this.shadow={x:this.halfW/2,y:this.h/2},this.anims={run:{frames:[1,2],rate:.2}},this.changeAnim("run")}update(t){super.update(t),this.y+=this.vy,this.x>this.p1.x?(this.x-=this.vx,this.flip.x=!1):this.x<this.p1.x&&(this.x+=this.vx,this.flip.x=!0),this.hit(this.p.hole)&&(this.vy=this.p.bgSpeed),this.y<-this.h&&(this.remove=!0)}},Powerup:class extends g{constructor(t,s){s.i="pup",s.frames=2,s.scale=3,super(t,s),this.vy=1.5,this.vx=s.x<t.w/2?.5:-.5,this.group="bonus",this.collidesWith=["player"],this.anims={fly:{frames:[1,2],rate:.2}},this.changeAnim("fly")}update(t){super.update(t),this.y+=this.vy,this.x+=this.vx,this.y>this.g.h+this.h&&(this.remove=!0)}render(){this.g.draw.ctx.globalAlpha=.1,this.g.draw.img(this.g.imgs.circle_2_0,this.x+this.halfW,this.y+6),this.g.draw.ctx.globalAlpha=1,super.render()}receiveDamage(t){this.g.sfx("powerup"),this.g.spawn("Boom",{x:this.x+this.halfW,y:this.y+this.halfW,key:"boom",scale:4,type:"spark",col:7}),this.remove||t.addPowerup(),this.remove=!0}},Worm:class extends m{constructor(t,s){s.i="worm",s.scale=4,s.frames=2,s.hits=4,s.active=!1,s.shake=!0,s.flash=!0,s.shadow=!1,super(t,s),.5<Math.random()?(this.x=-this.halfW,this.vx=1):(this.x=t.w-this.halfW,this.flip.x=!0,this.vx=-1),this.y=-this.h,t.ents.forEach(t=>{"hole"===t.name&&this.hit(t)&&(this.y=t.y-t.h)}),this.anims={wait:{frames:[2],rate:.2},bite:{frames:[1,2],rate:.2}},this.changeAnim("wait")}render(){var t=this.flip.x?this.x+this.halfW:this.x-this.w,s=0<this.fader?"wormtail":"wormtail_flipY";this.g.draw.img(this.g.imgs[s],t,this.y+this.halfW),super.render()}update(t){super.update(t),this.fader=Math.sin(.03*(new Date).getTime()),!this.active&&this.y>this.g.h/3&&.9<Math.random()&&(this.active=!0,this.changeAnim("bite"),this.vx=this.flip.x?-1:1,this.vy=this.g.H.rndArray([0,-.5,.5])),this.active&&(this.x+=this.vx,this.y+=this.vy,this.hit(this.p.hole))&&(this.vy*=-1),this.p.gameOver||(this.y+=this.p.bgSpeed),this.y>this.g.h+this.h&&(this.remove=!0)}},Obj:class extends g{constructor(t,s){super(t,s),this.reset(t.H.rnd(0,t.h))}update(){this.y+=this.p.bgSpeed,this.y>this.g.h+20&&this.reset()}render(){this.g.draw.img(this.i,this.x,this.y)}reset(t=!1){this.x=this.g.H.rnd(30,this.g.w-30),this.y=t||-1*this.g.H.rnd(20,60),this.i=this.g.imgs[this.g.H.rndArray(["bg_skull","bg_skull_flip","bg_bone","bg_bone_flip","bg_grass","bg_grass","bg_grass"])]}},Boss:class extends m{constructor(t,s){s.i="boss",s.frames=2,s.scale=5,s.hits=20,s.shake=!0,s.flash=!0,s.x=t.w/2,s.y=50,s.vx=1,s.vy=5,s.attack=!1,super(t,s),this.shadow={x:this.halfW/2,y:this.h/2},this.anims={run:{frames:[1,2],rate:.2}},this.changeAnim("run")}update(t){super.update(t),.995<Math.random()&&(this.attack=!0),this.attack?(this.y+=this.vy,this.y>this.g.h-this.h&&(this.vy*=-1),this.y<50&&(this.y=50,this.vy*=-1,this.attack=!1)):(this.x+=this.vx,(this.x<0||this.x>this.g.w-this.w)&&(this.vx*=-1))}render(){super.render(),this.g.draw.img(this.g.imgs[13],this.x+13,this.y+35+2*this.frame)}receiveDamage(t){super.receiveDamage(t),-1===this.hits?this.die():this.g.spawn("Bat",{p:this.p,x:this.x,y:this.y,scale:4})}die(){this.g.ents.forEach(t=>{"baddies"===t.group&&this.kill()});let t=10,s=this.w/2,i=this.x,h=this.y;for(;t--;)this.g.addEvent({t:10*t,cb:()=>{var t=this.g.H.rnd(-s,s);this.g.shake(),this.g.sfx("land"),this.g.spawn("Boom",{x:i+t,y:h+t,key:"boom"})}});this.g.addEvent({t:250,cb:()=>{this.g.changeScene("Win")}})}}},new class{constructor(s){var i,h={w:t.w,h:t.h},e=navigator.userAgent.toLowerCase();for(i in this.android=-1<e.indexOf("android"),this.ios=/ipad|iphone|ipod/.test(e),this.mobile=this.android||this.ios,this.firefox=-1<e.indexOf("firefox"),this.chrome=-1<e.indexOf("chrome"),h)this[i]=h[i];this.o=Object.assign(h,s),this.data=s,this.dt=0,this.fps=60,this.frameStep=1/this.fps,this.frameCurr=0,this.framePrev=a.timeStamp(),this.sceneName=s.start,this.H=a,this.scenes=s.scenes,this.availEnts=s.ents;let r=500;try{r=parseInt(window.localStorage.getItem("GBhi"),10)||500}catch(s){console.log(s)}this.hiScore=r,this.plays=0,this.ents=[],this.imgs=[],this.events=[],this.H=a,this.mute=!1,this.pause=!1,window.G=this}init(){var t=new s(this.o.i);this.c=document.querySelector("#c"),this.input=new h(this.c,this),document.title=this.o.title,t.start().then(t=>{this.imgs=t,window.setTimeout(()=>{var t,s,i,h;this.c.classList.add("active"),this.draw=new e(this.o.w,this.o.h,this.o.pal),this.scene=new this.scenes[this.sceneName](this),this.scaleUp("dot",[0,2,3,8,11]),this.scaleUp("circle",[0,2,3,8,11]),this.scaleUp("bridge"),this.scaleUp("spark",[0,2,3,8,11]),(t=this).imgs.bg=l(t,t.imgs.bg,8,.2),t.imgs.bg2=l(t,t.imgs.bg2,3,.17),t.imgs.pointer=t.draw.resize(t.imgs.pointer,4),t.imgs.hole=(i=(s=t).imgs.hole,(h=(s=t.H.mkCanvas(2*i.width,i.height)).getContext("2d")).drawImage(i,0,0),h.drawImage(i,i.width,0),s),t.imgs.wormtail=function(t){var s=t.imgs.circle,i=t.draw.color(s,t.data.pal[1]),h=(t=t.H.mkCanvas(4*s.width,s.height+4)).getContext("2d"),e=s.width;for(let t=0;t<=4;t+=1){var a=t%2?4:0;h.drawImage(t%2?s:i,0+e/2*t,a)}return t}(t),t.imgs.wormtail_flipX=t.draw.flip(t.imgs.wormtail,1),t.imgs.wormtail_flipY=t.draw.flip(t.imgs.wormtail,0,1),t.imgs.titleFont=t.H.mkFont(t,8,2),t.imgs._titleFont=t.H.mkFont(t,8,0),t.imgs.bg_skull=t.draw.rotate(t.draw.resize(t.imgs.skull,6,.1),4.4),t.imgs.bg_skull_flip=t.draw.flip(t.imgs.bg_skull,1,0),t.imgs.bg_bone=t.draw.rotate(t.draw.resize(t.imgs.bone,2,.1),4.4),t.imgs.bg_bone_flip=t.draw.flip(t.imgs.bg_bone,1,0),t.imgs.bg_grass=t.draw.resize(t.imgs.grass,4,.2),t.imgs[13]=t.draw.resize(t.imgs[13],3,.5),t.p8S="000e00001776217760177601776017762177601776017760177621776017762177601e7621e7601f7621f7601f7601f7601f7621f7601c7621c7601e7621e7601a7621a7601c7621c76019762197601a7621a760\n000e00000b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b2201722017220\n000e00001a7621a7601a7601a7601a7621a7601a7601a7601a7621a7601a7621a76021762217602276222760227602276022762227601f7621f76021762217601d7621d7601f7621f7601c7621c7601d7621d760\n000e00000e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a220\n010e00000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f21500000",t.p8M="00 00010404\n00 00010404\n00 02030404\n04 02030404",document.querySelector("#c").style.cursor="none",this.track1=new n(this.p8S,this.p8M),this.favIcon(this.draw.resize(this.imgs.gecko,8)),document.querySelector("#l").style.display="none",this.c.style.display="block",this.loop()},400)})}scaleUp(h,t=[]){for(let i=8;0<i;--i)t.length?t.forEach(t=>{var s=this.draw.color(this.imgs[h],this.o.pal[t]);this.imgs[`${h}_${i}_`+t]=this.draw.resize(s,i)}):this.imgs[h+"_"+i]=this.draw.resize(this.imgs[h],i)}sfx(t){this.mute||A(...this.data.sfx[t])}favIcon(t){var s=document.createElement("canvas"),i=s.getContext("2d"),h=document.createElement("link");s.width=64,s.height=64,i.drawImage(t,0,0),h.type="image/x-icon",h.rel="shortcut icon",h.href=s.toDataURL("image/x-icon"),document.getElementsByTagName("head")[0].appendChild(h)}changeScene(t,s="flip"){this.c.classList.add(s),window.setTimeout(()=>{this.ents=[],this.events=[],this.c.classList.remove(s),this.scene=new this.scenes[t](this)},300)}loop(){this.frameCurr=a.timeStamp(),this.dt=this.dt+Math.min(1,(this.frameCurr-this.framePrev)/1e3),this.pause||(this.update(this.frameStep),this.render()),this.framePrev=this.frameCurr,this.input.freshKeys.KeyS&&this.screenshot(),this.input.freshKeys.KeyM&&(console.log("MUTE",this.audio.stop()),this.mute=!this.mute,this.mute)&&this.audio&&this.audio.stop(),this.input.freshKeys.KeyP&&(this.pause=!this.pause),this.input.freshKeys=[],requestAnimationFrame(()=>this.loop())}update(s){if(!this.c.classList.contains("flip")){this.fader=Math.sin(.005*(new Date).getTime()),this.runEvents(s),this.scene.update(s);let t=this.ents.length;for(;t--;)this.ents[t].remove&&this.ents.splice(t,1);this.scene.update(s)}}render(t){this.scene.render(t)}spawn(t,s){return t=new this.availEnts[t](this,s),this.ents.push(t),t}shake(t="shake"){this.c.classList.add(t),this.addEvent({t:50,cb:()=>{this.c.className=""}})}addEvent(t){this.events.push(t)}runEvents(i){this.events.forEach((t,s)=>{t.t-=100*i,t.t<0&&(t.cb.call(this),this.events.splice(s,1))})}addText(t,s,i=!1,h=100,e=2,a=3){this.addEvent({t:s,cb:()=>{this.spawn("Text",{x:i,y:h,text:t,col:e,o:5,scale:a})}})}screenshot(){this.c.toBlob(t=>{s(t,`screencapture-${this.w}x${this.h}.png`)});const s=function(){const i=document.createElement("a");return document.body.appendChild(i),i.style.display="none",function(t,s){t=window.URL.createObjectURL(t),i.href=t,i.download=s,i.click()}}()}}(t).init()</script>