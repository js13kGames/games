<!doctype html><meta content="width=device-width" name=viewport><title>Celestial Paws - js13kGames 2025</title><style>#sh,.sc{height:100vh}#start .center,#start-cat,#timer,canvas{position:absolute}#an,#game,.sc{width:100vw}#an,#start .center{animation:.5s .5s both scalein;display:flex}#an,#tile{display:flex}.cell,.holder{transition:1s}#start button,.cell:not(.milk){pointer-events:auto;cursor:pointer}.cell *,.sc,.sc *{pointer-events:none}#an,#range{bottom:3em}#range,#rani,.om,.sc,body{overflow:hidden}#canvas-2,.cho{z-index:2}*{padding:0;margin:0;user-select:none;font-family:Garamond}.sc,.sc *{transform-style:preserve-3d;perspective:4000px;transform-origin:50% 50%;text-align:center}body{--plat:#99a1c0;--boardRot:50deg;--baseTransition:0.2s ease all;--ease1:cubic-bezier(0.329, 1.451, 0.54, 1.007);background:linear-gradient(0,#a5b3d1 0,#13161e 68%,#13161e 100%)}.sc{contain:layout style paint}canvas{top:0;left:0;width:100%;height:100%}#start{box-shadow:inset 0 -11vh #7f899f,inset 0 -12vh 1vh -1vh #ced9f2;font-size:1.5vmin}#start .center{flex-direction:column;top:24%;width:50%;left:14%;gap:3em}#start button{border-radius:2em;padding:1em 7em;font-size:2em;border:none;box-shadow:0 .3em #8893aa,0 .4em .3em #565d6b;transition:.1s;background:#ced9f2;margin:0 auto}#start button:active{box-shadow:0 .1em #9eacc9,0 .1em .1em #4a546b;transform:translateY(.1em)}#start-cat{bottom:4em;right:26vw;font-size:7em;transform:scale(2)}#t{font-size:6.3em;text-align:left;animation:5s ease-in-out infinite alternate both softr;color:#39445c;white-space:nowrap}@keyframes softr{from{transform:translate(-.7em,-.8em) rotateY(15deg)}to{transform:translate(-.7em,-.8em) rotateY(-15deg)}}#timer{top:.5em;left:.5em;color:#ddd;font-size:3em}#game,.derot .c1,.milk .toy,.reflect .c1{position:relative}#game{height:80vw}#p-cat,.platform{position:absolute}#p-cat{width:1em;height:2em;font-size:4.5em}.platform{width:140%;height:.3em;background:var(--plat);bottom:0;left:-20%;border-radius:3rem}#an,.star{position:fixed}#an{justify-content:center;align-items:center}#ss,.cell>div{position:absolute}#an input{width:50vw;min-width:600px;pointer-events:auto}#ss{left:50%;top:40%;animation:2s ease-in infinite alternate undu}.star{color:#eceab0;animation:6s ease-in forwards shoot;font-size:3.4vmax}@keyframes shoot{0%{opacity:0;transform:scale(0) rotate(0) translateX(0);filter:blur(20px)}20%{opacity:.5;transform:scale(.5) rotate(30deg) translateX(3vmax)}40%{opacity:1;filter:blur(0)}100%{transform:scale(2) rotate(0) translateX(100vmax);filter:blur(0)}}input[type=range]{appearance:none;background:0 0;cursor:pointer;width:26rem;max-width:100%}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background-color:var(--plat);border-radius:2.5rem;height:4rem}input[type=range]::-webkit-slider-thumb{appearance:none;margin-top:8px;background-color:#393939;border-radius:3rem;height:3rem;width:3rem}input[type=range]::-moz-range-track{background-color:var(--plat);border-radius:2.5rem;height:4rem}input[type=range]::-moz-range-thumb{background-color:#383838;border:none;border-radius:3rem;height:3rem;width:3rem}#tile{align-items:center;justify-content:center}.holder{display:grid;width:80vmin;gap:3.75%;transform:translate3d(5vmin,-2vmin,10em) rotateX(var(--boardRot)) rotate(45deg);font-size:2.1vmin}.holder.fail{transform:translateY(100vh)}@keyframes moveit{0%{transform:translateZ(100vh)}100%{transform:translateZ(0)}}@keyframes moveit-r{0%{transform:translateZ(0)}100%{transform:translateZ(100vh)}}.milk .toy{animation:3s ease-in-out infinite alternate hover;width:0;height:100%;font-size:.9em}.derot .toy{filter:drop-shadow(0 0 2px gold) drop-shadow(0 0 2px white)}.milk.fail .derot .toy{filter:sepia(10) saturate(10) hue-rotate(-45deg) drop-shadow(0 0 2px red) drop-shadow(0 0 2px red)}.reflect .toy{opacity:.65;left:-.5em;margin-top:-.5em}@keyframes hover{0%{transform:translateY(-.1em) rotate(10deg)}50%{transform:translateY(-.05em) rotate(-10deg)}100%{transform:translateY(0)}}@property --bop{syntax:"<number>";inherits:false;initial-value:0.2}.cell{aspect-ratio:1;transform-origin:50% 50%;animation:moveit 1.5s var(--ease1) 1 both;background-color:rgb(52 56 66 / var(--bop))}.cell .derot{transform:translateZ(2em) rotate(-45deg) rotateX(calc(var(--boardRot) * -1)) translateY(1em);display:flex;justify-content:center}.cell .reflect{transform:translateZ(2em) rotate(-25deg) rotateX(calc(var(--boardRot))) translate3d(.5em,1.7em,.6em) scaleY(-2.3) scaleX(1.1);opacity:.5}.om{height:100%;width:100%}.reflect .c1{height:18em}.derot .c1{left:0;top:-3em}#range,.c1,.c1 .tail,.c1 svg{position:absolute}.cat.fail .derot{filter:invert(1) drop-shadow(0 0 2px red) drop-shadow(0 0 2px red) drop-shadow(0 0 2px red)}.cell:after,.cell:before{--thick:0.4em;content:"";position:absolute;width:101%;height:var(--thick);background:inherit;left:0;bottom:calc(var(--thick) * -.5);transform:rotateX(-90deg) translateY(calc(var(--thick) * .5)) scaleY(1);box-shadow:inset 0 0 20px hsl(0 0 0 / .55)}.cell:after{left:calc(100% - (var(--thick) * .5));width:var(--thick);height:102%;bottom:0;transform:rotateY(90deg) translateX(calc(var(--thick) * .5)) scaleY(1)}.cat>div{filter:grayscale(1) brightness(.5)}.marker{color:silver;font-size:2.6em;transform:translate(-.1em,0) rotate(-45deg) translate(0,-.1em);line-height:1em;width:1.1em;transform-origin:50% 50%;background:#4e525b;height:1.1em;text-shadow:0 3px 10px #292d36,0 3px 3px #292d36;border-radius:.5em;margin:.3em;box-shadow:0 8px 0 1px #292d36,inset 0 -3px 5px #292d36}.marker.fail{transition:var(--baseTransition);background:tomato;box-shadow:0 8px 0 1px red,inset 0 -3px 5px red;text-shadow:0 3px 10px red,0 3px 1px red}.marker.correct{background:#0f0;box-shadow:0 8px 0 1px green,inset 0 -3px 5px green}.derot:not(:has(.toy)){width:100%;height:100%}.c1 div.tail-seg{height:1.75em;width:2.5em;left:1.5em;animation:5s ease-in-out infinite alternate wag;animation-delay:calc(var(--i) * 60ms);border-radius:1em;transform-origin:1em 1em}@keyframes wag{from{transform:rotateZ(-18deg)}to{transform:rotateZ(28deg)}}.c1{font-size:.115em;width:8em;filter:url(#goo);height:24em;animation:.5s both scalein}.c1 svg{width:100%;left:0;transform-origin:50% 100%}.c1 svg .ear{animation:3s linear infinite alternate ears}.c1 .tail{top:14em;left:3.5em}.c1 .tail *,.cho .c1{position:relative}.c1 .tail *{background:#000}@keyframes scalein{from{transform:scale(.001) translateY(-20em)}to{transform:scale(1)}}@keyframes ears{90%{transform:translateY(0)}95%{transform:translateY(.5em)}100%{transform:translateY(-.5em)}}.rm{border-top-left-radius:0;animation:.5s 1.5s both srow}.cm{border-top-right-radius:0;animation:.5s 1.5s both scol}.cell.rev{animation:1.75s .25s both moveit-r}.cm.rev{animation:1s both scol-r}.rm.rev{animation:1s both srow-r}@keyframes srow{from{opacity:0;transform:scale(0) translate3d(2em,0,-2em) rotate(-45deg)}to{transform:scale(1) translate3d(0,0,0) rotate(-45deg)}}@keyframes srow-r{from{transform:translate(0,0) rotate(-45deg)}to{opacity:0;transform:translate(5em,0) rotate(-45deg)}}@keyframes scol{from{opacity:0;transform:scale(0) translate3d(0,2em,-2em) rotate(-45deg)}to{transform:scale(1) translate3d(0,0,0) rotate(-45deg)}}@keyframes scol-r{from{transform:translate(0,0) rotate(-45deg)}to{opacity:0;transform:translate(0,5em) rotate(-45deg)}}#range{left:50%;transform:translateX(-50%);width:300px;height:2em;background:rgba(255,255,255,.2);border-radius:2em;border:2px solid rgba(255,255,255,.5);z-index:3}#rani{height:100%;width:0;max-width:100%;background:#fff;line-height:2em}#mho,.cho{width:100%;position:absolute}#mho{opacity:0;transition:opacity 3s var(--ease1);font-size:17vmin;transform:translateY(1em) rotate3d(-3.9,2.4,2.4,45deg);font-weight:700;color:#25f8b3;text-shadow:0 0 10px #25f8b3}.cho{display:flex;font-size:6em;bottom:-1em;justify-content:space-around}.moon-star:hover{animation:none;transform:scale(1.3)!important;filter:drop-shadow(0 0 10px rgba(255, 215, 0, .8))}</style><body><svg id=catbod viewBox="0 0 154 335" xmlns=http://www.w3.org/2000/svg><defs><filter color-interpolation-filters=sRGB height=200% id=goo width=200% x=-50% y=-50%><feGaussianBlur in=SourceGraphic result=blur stdDeviation=6 /><feColorMatrix in=blur result=goo type=matrix values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 25 -8"/><feBlend in=SourceGraphic in2=goo mode=normal /></filter></defs><ellipse cx=70 cy=82 rx=65 ry=48 /><ellipse cx=77 cy=193.5 rx=50.5 ry=104.5 /><ellipse cx=77 cy=233 rx=70.5 ry=72 /><ellipse cx=105 cy=30 rx=15 ry=25 class=ear /><ellipse cx=40 cy=30 rx=15 ry=25 class=ear /></svg><script id=draw-shader-vs type=x-shader/x-vertex>attribute vec2 inPos;void main(){gl_Position=vec4(inPos,0,1.0);}</script><script>const e=(e=1,t=0)=>Math.random()*(e-t)+t,t=(...e)=>o(a(...e)),n=new AudioContext,o=(...e)=>{let t=n.createBuffer(e.length,e[0].length,44100),o=n.createBufferSource();return e.map((e,n)=>t.getChannelData(n).set(e)),o.buffer=t,o.connect(n.destination),o.start(),o},a=(e=1,t=.05,n=220,o=0,a=0,r=.1,s=0,l=1,i=0,c=0,u=0,m=0,f=0,d=0,h=0,p=0,v=0,g=1,y=0,T=0,M=0)=>{let b,x,w=2*Math.PI,A=e=>e<0?-1:1,E=i*=500*w/44100/44100,P=n*=(1+2*t*Math.random()-t)*w/44100,I=[],S=0,R=0,L=0,F=1,C=0,$=0,_=0,k=w*Math.abs(M)*2/44100,B=Math.cos(k),N=Math.sin(k)/2/2,D=1+N,z=-2*B/D,H=(1-N)/D,V=(1+A(M)*B)/2/D,q=-(A(M)+B)/D,U=V,W=0,O=0,j=0,Y=0;for(c*=500*w/44100**3,h*=w/44100,u*=w/44100,m*=44100,f=44100*f|0,e*=.3,x=(o=44100*o+9)+(y*=44100)+(a*=44100)+(r*=44100)+(v*=44100)|0;L<x;I[L++]=_*e)++$%(100*p|0)||(_=s?s>1?s>2?s>3?Math.sin(S**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/w%2+2)%2:1-4*Math.abs(Math.round(S/w)-S/w):Math.sin(S),_=(f?1-T+T*Math.sin(w*L/f):1)*A(_)*Math.abs(_)**l*(L<o?L/o:L<o+y?1-(L-o)/y*(1-g):L<o+y+a?g:L<x-v?(x-L-v)/r*g:0),_=v?_/2+(v>L?0:(L<x-v?1:(x-L)/v)*I[L-v|0]/2/e):_,M&&(_=Y=U*W+q*(W=O)+V*(O=_)-H*j-z*(j=Y))),b=(n+=i+=c)*Math.cos(h*R++),S+=b+b*d*Math.sin(L**5),F&&++F>m&&(n+=u,P+=u,F=0),!f||++C%f||(n=P,i=E,F=F||1);return I};{let e,t,n,o,a,r,s,l,i,c,u,m,f;n=(t=Object).getPrototypeOf,o=document,r={},s=n(a={isConnected:1}),m=a=>new Proxy((m,...f)=>{let[d,...h]=n(f[0]??0)===s?f:[{},...f],p=a?o.createElementNS(a,m):o.createElement(m);for(let[o,a]of t.entries(d)){let s=a=>a?t.getOwnPropertyDescriptor(a,o)??s(n(a)):e,u=m+","+o,f=r[u]??(r[u]=s(n(p))?.set??0),d=f?f.bind(p):p.setAttribute.bind(p,o),h=n(a??0);h===i?c(()=>(d(a.val),p)):h!==l||o.startsWith("on")&&!a.h?d(a):c(()=>(d(a()),p))}return u(p,...h)},{get:(t,n)=>t.bind(e,n)}),f={add:u=(t,...o)=>{for(let a of o.flat(1/0)){let o=n(a??0),r=o===i?c(()=>a.val):o===l?c(a):a;r!=e&&t.append(r)}return t},_:e=>(e.h=1,e),tags:m()},window.van=f}let r,s=0;const l=[];function i(e,t){let n={},o=document.getElementById(e);if(r=o.getContext("webgl")||o.getContext("experimental-webgl"),!r)return;let a=r.createProgram();for(let e=0;e<2;++e){let n=0==e?document.getElementById("draw-shader-vs").text:t;1==e&&(n=`\n          precision mediump float;\n          uniform vec2 iResolution;\n          uniform vec2 iMouse;\n          uniform float iTime;\n          ${n}\n          void main() \n          {\n              mainImage( gl_FragColor, gl_FragCoord.xy );\n          }`);let o=r.createShader(0==e?r.VERTEX_SHADER:r.FRAGMENT_SHADER);r.shaderSource(o,n),r.compileShader(o),r.getShaderParameter(o,r.COMPILE_STATUS)||alert(r.getShaderInfoLog(o)),r.attachShader(a,o),r.linkProgram(a)}status=r.getProgramParameter(a,r.LINK_STATUS),status||alert(r.getProgramInfoLog(a)),a.inPos=r.getAttribLocation(a,"inPos"),a.iTime=r.getUniformLocation(a,"iTime"),a.iMouse=r.getUniformLocation(a,"iMouse"),a.iResolution=r.getUniformLocation(a,"iResolution"),r.useProgram(a);var s=[0,1,2,0,2,3];return n.pos=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,n.pos),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),r.STATIC_DRAW),n.inx=r.createBuffer(),n.inx.len=s.length,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.inx),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),r.STATIC_DRAW),r.enableVertexAttribArray(a.inPos),r.vertexAttribPointer(a.inPos,2,r.FLOAT,!1,0,0),r.enable(r.DEPTH_TEST),r.clearColor(0,0,0,1),{canvas:o,progDraw:a,gl:r,progDraw:a,bufObj:n}}let c=!0,u=performance.now();function m(){if(!c){const e=(performance.now()-u)/1e3;l.forEach(e=>{e.canvas.style.display="none"});const{canvas:t,gl:n,progDraw:o,bufObj:a}=l[s];t.width=.45*window.innerWidth,t.height=.45*window.innerHeight,t.style.display="block",n.viewport(0,0,t.width,t.height),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.uniform1f(o.iTime,e),n.uniform2f(o.iResolution,t.width,t.height),n.drawElements(n.TRIANGLES,a.inx.len,n.UNSIGNED_SHORT,0);const r=document.getElementById("ss");r&&(r.style.transform=`translateY(${-20*Math.sin(e)}vh)`)}requestAnimationFrame(m)}const f=["a","b","c","d","e","f"],d=["a","c","b"],h=["a","b"];let p=[];const v={major:[0,2,4,5,7,9,11],naturalMinor:[0,2,3,5,7,8,10],blues:[0,3,5,6,7,10]};let g,y={instrument:"a",scale:"blues",tempo:70,scaleChange:4,drumType:"b",drumType2:null,baseNote:60,drumPattern:"b",measures:[],measureSFX:[,5,100,.01,.2,.09,1,2.2,-10,25,,,,,.5,,,.94,.1,,-1140],doubleDrum:1},T=new AudioContext,M=0;const b=e=>(T&&"closed"!==T.state&&T.close(),T=new AudioContext,g=T.createBuffer(1,Math.ceil(44100*e),44100),g),x=(e,t,n)=>e+(t-e)*n,w=(e,t,n)=>Math.exp(-.5*((e-t)/n)**2),A=(t,n,o=y)=>{const a=44100,r=t/44100,s=Math.min(1,t/a),l=2*Math.PI*n,i=Math.floor(882),c=Math.floor(882),u=Math.max(0,a-i-c);let m,f;if(t<i){const e=t/i;m=e*e}else if(t<i+u)m=.7;else{if(!(t<a))return 0;m=.7*(1-(t-i-u)/c)**2}switch(o.instrument){case"f":case"c":let t;t=s<.35?x(-2,6,s/.35):x(6,-7,(s-.35)/.65);const a=("c"===o.instrument?.01:.002)*Math.sin(2*Math.PI*5*r),i=n*Math.pow(2,t/12)*(1+a),c=x(500,900,s),u=x(1800,1100,s),m=120,d=180;let h=0,p=0;const v=12;for(let e=1;e<=v;e++){const t=e*i,n=w(t,c,m)+.6*w(t,u,d);h+=n*Math.sin(2*Math.PI*t*r),p+=n}h=p>0?h/p:0;const g=.06,y=Math.max(0,1-r/g);f=.9*h+.15*(2*e()-1)*y;break;case"b":f=.6*Math.sin(l*r)+.4*Math.sin(l*r*2)+.2*Math.sin(l*r*4);break;case"a":let T=0,M=0;for(let e=0;e<10;e++){const t=n*e*(.5+.501*e),o=1/(1+.7*e),a=Math.exp((-3-.2*e)*r);M+=o*Math.sin(2*Math.PI*t*r)*a,T+=o}f=T?M/T:0;break;case"e":const b=100*Math.sin(2*Math.PI*n*2*r);f=.25*Math.sin(2*Math.PI*n*r+b);break;default:f=Math.sin(l*r)}let d=m*f*.35;return Number.isFinite(d)||(d=0),d=Math.max(-1,Math.min(1,d)),d};let E,P;const I=(t=y)=>new Promise((t,n)=>{if(!T||!g)return void n("Audio context or buffer is missing.");E&&(E.stop(),E.disconnect()),E=T.createBufferSource(),E.buffer=g,P=T.createGain(),P.gain.value=.8;const o=T.createConvolver();o.buffer=((t,n=2,o=2)=>{const a=t.sampleRate,r=n*a,s=t.createBuffer(2,r,a);for(let t=0;t<2;t++){const n=s.getChannelData(t);for(let t=0;t<r;t++)n[t]=(2*e()-1)*Math.pow(1-t/r,o)}return s})(T,1.5,3),E.connect(P),E.connect(o),o.connect(P),P.connect(T.destination);const a=g.length/T.sampleRate;E.start(),p.push(setTimeout(()=>{t()},1e3*a))}),S=e=>6e4/e,R=(t,n=y)=>{if(null===n.drumType||null===g)return;const o=g.getChannelData(0),a=Math.floor(4410);for(let r=0;r<a;r++){const a=r/44100;let s=1,l=0;switch(n.drumType){case"b":s=Math.exp(-140*a),l=2*Math.sin(2*Math.PI*150*a*Math.exp(-30*a))*s,l*=1.5;break;case"c":s=Math.exp(-20*a),l=(.5*(2*e()-1)+.5*Math.sin(2*Math.PI*200*a))*s,l*=.3;break;default:s=Math.exp(-40*a),l=(2*e()-1)*s,l*=.5}Number.isFinite(l)||(l=0),l=Math.max(-1,Math.min(1,l));const i=t+r;i<o.length&&(o[i]+=.5*l)}},L=async(e,t=y)=>{const n=S(t.tempo);let o=0;const a=Math.ceil(e.reduce((e,t)=>e+t.duration,3)),r=.005*n+Math.ceil(4*a)/4;b(r*(60/t.tempo)),e.forEach(e=>{let a;a=o+n*e.duration,p.push(setTimeout(()=>{((e,t=y)=>{const{degree:n,octave:o,duration:a}=e;if(null===n||null===g)return;e.scale=t.scale;const r=(({scale:e="chromatic",degree:t=1,octave:n=4},o=y)=>{const a=o.baseNote,r=v[e],s=r[t%r.length],l=r.length;return 440*2**((a+s+12*(n-4+Math.floor(t/l))-69)/12)})(e),s=Math.floor(44100*a*(60/t.tempo)),l=Math.floor(44100*T.currentTime),i=[];for(let e=0;e<s;e++){const t=e<88?e/88.2:1-(e-88.2)/(s-88.2);i[e]=t*A(e,r)}const c=g.getChannelData(0);for(let e=0;e<s;e++){const t=l+e;t<c.length&&(c[t]+=i[e])}})({...e},t)},a)),o=a}),((e=y)=>{const t=e.tempo*e.doubleDrum||1,n=Math.floor(.5*S(t)/1e3*44100),o=~~(S(t)/1e3*.2*44100);for(let t=0;t<200;t++){let a=t*n;"a"===e.drumPattern?(t%4==0&&R(a,{...e,drumType:e.drumType}),t%8==5&&R(a+n,{...e,drumType:e.drumType2}),t%16==15&&R(a-o,{...e,drumType:e.drumType})):(R(a,{...e,drumType:t%2==0?e.drumType:e.drumType2}),t%8==0&&R(a-o,{...e,drumType:t%2==0?e.drumType:e.drumType2}))}})(t)},F=t=>{const n=~~(8*e()),o=[2,3,4,5],a={ascend:[0,2,4,5],descend:[5,4,2,0],arch:[0,3,5,2],zigzag:[0,5,1,4],cascade:[0,1,2,4]},r=[[...new Array(10)].map(e=>.25),[.5,.5,.25,.75],[.25,.25,.25,.25,1],[4,2,2],[.75,.25,.5,.5],[0,2,0,2],[1,2,1,4]],s=Object.keys(a),l=a[s[~~(e()*s.length)]],i=r[~~(e()*r.length)],c=(t,n,o=.5)=>e()<.25?{degree:null,octave:null,duration:o}:{degree:t,octave:n,duration:o},u=l.map((t,a)=>c((n+t+8)%8,o[~~(e()*o.length)],1*i[a%i.length]));if(e()<.3){const t=1+~~(3*e());for(let n=0;n<t;n++)u.push({degree:null,octave:null,duration:.25+.5*e()})}if(e()<.4){const t=u.map((t,o)=>null==t.degree?t:c(e()>.5?n-(t.degree-n):t.degree+(o%2?-1:1),t.octave,t.duration));return u.concat(t)}return u},C=async(n=y)=>{if(!$)return;if(0===n.measures.length)for(let e=0;e<5;e++)n.measures.push(F());let o=n.measures[M%n.measures.length];L(o);const a=o.reduce((e,t)=>e+(null!==t.degree?t.duration:0),0);if(e()>.5&&a<2){const e=[...new Array(8)].map(e=>[{degree:2,octave:2,duration:.25},{degree:null,octave:null,duration:.25}]).flat();e[7]={degree:null,octave:null,duration:1},L(e)}n.measureSFX[0]=void 0===n.volume?.2:.25*n.volume,t(...n.measureSFX),await I(n),$&&(n.measureSFX[0]=void 0===n.volume?.2:.25*n.volume,t(...n.measureSFX),await I(n),C(),M++,M>y.scaleChange&&(y.scale=Object.keys(v).sort(()=>e()-.5)[0],M=0))};let $=!1;const _=()=>{p.forEach(e=>clearTimeout(e)),p=[],T&&(T.close(),T=null),T=new AudioContext,E&&(E.stop(),E.disconnect()),g=null,b(1),M=0},k=()=>{$=!0,_(),C()},{div:B,input:N,button:D,canvas:z}=van.tags,H={SKY_TIME_LIMIT:25e3,STAR_SPAWN_INTERVAL:150};let V=1,q=2,U=.4,W=0,O=0;const j=(e=8)=>B({class:"c1"},document.getElementById("catbod").cloneNode(!0),((e=8)=>{let t;for(let n=e-1;n>=0;n--)t=B({class:"tail-seg",style:`--i:${n}`},t);return B({class:"tho"},B({class:"tail"},t))})(e));let Y,X=[];function G(t,n){0===X.length&&(X=speechSynthesis.getVoices().filter(e=>e.lang.toLowerCase().startsWith("en")));const o=new SpeechSynthesisUtterance(t);o.voice=n||X[e()*X.length|0],speechSynthesis.speak(o)}const K=()=>{Y.remove(),c=!0,$=!1,_(),y={...y,instrument:f[Q%f.length],scale:Object.keys(v).sort(()=>e()-.5)[0],tempo:100,drumType:d[~~(e()*d.length)],drumType2:d[~~(e()*d.length)],baseNote:40+~~(60*e()),drumPattern:h[~~(e()*h.length)],doubleDrum:1,measures:[]},ae.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{Z(ae),k()},1e3)},J=n=>{0===O&&G("Move the circle and collect stars",X[0]),s=0,c=!1,_(),y.tempo*=2,C();let o=!0;const a=B({id:"p-cat"},B({class:"platform"}),j(8)),r=N({type:"range",min:"-4",max:"4",step:"0.05",value:"0",oninput:e=>v=+e.target.value}),l=B({id:"ss"}),i=B({id:"timer"}),u=B({id:"sh"},B({id:"game"},a,l),B({id:"an"},r),i);let m,f=0,d=0,h=0,p=0,v=0;const g=()=>{f=innerWidth/2,d=.4*innerHeight,h=.4*Math.min(innerWidth,innerHeight),T()},T=()=>{const e=innerWidth/innerHeight,t=.4*Math.min(innerWidth,innerHeight),n=t*Math.max(1,e),o=t*Math.max(1,1/e),r=f+n*Math.cos(p)-a.offsetWidth/2,s=d+o*Math.sin(p)-a.offsetHeight/2;a.style.left=r+"px",a.style.top=s+"px"},M=e=>{m||(m=e);const t=(e-m)/1e3;m=e;const n=Math.abs(v)<.5?0:v;p=(p+n*t)%(2*Math.PI),T(),requestAnimationFrame(M)};van.add(n,u),g(),v=+r.value||0,requestAnimationFrame(M),addEventListener("resize",g);const b=Date.now(),x=()=>{if(!o)return;const e=Math.max(0,H.SKY_TIME_LIMIT-(Date.now()-b));i.textContent=`${Math.ceil(e/1e3)}`,e>0&&requestAnimationFrame(x)};setTimeout(()=>{o&&(o=!1,document.querySelectorAll(".star").forEach(e=>e.remove()),(()=>{s=1,c=!1,H.STAR_SPAWN_INTERVAL=150,ne.scrollIntoView({behavior:"smooth"}),_(),y.tempo=40,C(),Y=B({class:"star-holder"}),van.add(ne,Y);for(var t=0;t<W;t++)setTimeout(()=>{van.add(Y,B({class:"collected",style:`transform: translate(${100*e()}vw, ${70*e()}vh) scale(${.5*e()+.5});\n          position: absolute; color: #fff;`},"¬∑")),O++,ee.style.width=O/300*100+"%"},1e3+50*t);ee.innerText=O+W,G(`${O+W} of 300 stars collected`),setTimeout(()=>{G("meow"),setTimeout(()=>{W=0,O>=300?(G("You've collected all the stars!"),document.querySelector("#mho").style.opacity=1,ee.style.pointerEvents="auto",ee.innerText="More Puzzles"):setTimeout(K,3500)},1e3)},50*W)})(),setTimeout(()=>{n.innerHTML=""},2e3))},H.SKY_TIME_LIMIT),requestAnimationFrame(x);let w=720*e()-360;const A=setInterval(()=>{w=720*e()-360},2e3),E=()=>{const n=B({class:"star",style:`margin-top: ${e(20)}vh`,onanimationend:()=>{r.parentElement.removeChild(r)}},"‚ú¶"),r=B({class:"st",style:`transform: rotate(${w+e(90)}deg)`},n);van.add(l,r);const s=()=>{if(e=n.getBoundingClientRect(),l=a.getBoundingClientRect(),!(e.right<l.left||e.left>l.right||e.bottom<l.top||e.top>l.bottom))return t(...[,0,1500,.02,,.2,,2,1,3,230,.1,,.1,,,,.8]),r.parentElement.removeChild(r),void W++;var e,l;o&&requestAnimationFrame(s)};requestAnimationFrame(s),o?setTimeout(E,Math.max(100,H.STAR_SPAWN_INTERVAL)):clearInterval(A)};requestAnimationFrame(E),n.scrollIntoView({behavior:"smooth"})};let Q=0;const Z=n=>{Q++,2===Q&&setTimeout(()=>{G("Until the last cat, you can remove cats by clicking again.",X[0])},2e3),ae.scrollIntoView({behavior:"smooth"});let o=0;const a=(r=2,s=2,l=.22)=>{let i,c,u,m;r+s<4&&setTimeout(()=>{G("Place cats on empty tiles. Pair every cat to a charm.",X[0])},1e3),2===r&&2===s&&setTimeout(()=>{G("Tag shows the number of cats per line",X[0])},1e3);let f=Math.min(Math.round(l*r*s),Math.ceil(r/2)*Math.ceil(s/2));const d=[[1,0],[-1,0],[0,1],[0,-1]],h=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],p=(e,t)=>e>=0&&e<r&&t>=0&&t<s;function v(e,t,n){let o=0;for(const[a,r]of d){const s=t+a,l=n+r;p(s,l)&&1===e[s][l]&&o++}return o}function g(e,t,n){for(const[o,a]of h){const r=t+o,s=n+a;if(p(r,s)&&2===e[r][s])return!0}return!1}function y(e,t,n){let o=0;for(const[a,r]of d){const s=t+a,l=n+r;p(s,l)&&2===e[s][l]&&o++}return 1===o}let T=0;const M=()=>(T+=1,T===f&&(x.style.setProperty("pointer-events","none"),setTimeout(async()=>{let r,s;s=u.map((e,t)=>parseInt(e.innerText)===c[t].reduce((e,t)=>e+t.classList.contains("cat"),0)),r=m.map((e,t)=>parseInt(e.innerText)===(e=>{let t=0;for(let n=0;n<c.length;n++)t+=c[n][e].classList.contains("cat");return t})(t));const l=(()=>{const e=e=>e.classList.contains("cat"),t=new Set;for(let n=0;n<c.length;n++)for(let o=0;o<c[n].length;o++)if(e(c[n][o]))for(const[a,r]of h){const s=n+a,l=o+r;if(p(s,l)&&e(c[s][l])){t.add(c[n][o]),t.add(c[s][l]);break}}return[...t]})(),i=()=>{const e=[];for(let t=0;t<c.length;t++)for(let n=0;n<c[t].length;n++){const o=c[t][n];if(!o.classList.contains("milk"))continue;let a;for(const[e,o]of d){const r=t+e,s=n+o;if(p(r,s)&&c[r][s].classList.contains("cat")){a=c[r][s];break}}e.push([o,a])}return e};if(s.every(e=>e)&&r.every(e=>e)&&i().some(e=>void 0!==e[1])&&0===l.length)t(...[,0,864,.03,.08,.27,,.4,,,428,.05,,,,,,.63,.04]),G("meow"),[...document.getElementsByClassName("cell")].forEach(t=>{t.style.setProperty("--bop",1),t.style.setProperty("animation-delay",`${e(300,1e3)}ms`)}),o+=1,V<3||q<2?V<q?V++:q++:(U+=.07,U>.36&&V+q<12?(V<q?V++:q++,U=.25):U>.36&&(U=.2)),u.concat(m).forEach(e=>e.classList.add("correct")),setTimeout(()=>{[...document.getElementsByClassName("cell")].concat([...document.getElementsByClassName("rm")]).concat([...document.getElementsByClassName("cm")]).forEach(e=>{e.offsetWidth,e.classList.add("rev"),e.style.pointerEvents="none"}),setTimeout(()=>{t(...[.7,,126,.5,.6,.3,,13.4,,,34,.25,.15,,,,,.63,,.01,-1029])},200),setTimeout(()=>{if(4===o)return ae.innerHTML="",J(te),void oe.scrollIntoView({behavior:"smooth"});const e=a(V,q,U);n.innerHTML="",van.add(n,e)},2e3)},400);else{const f=[.2,,10,.02,.2,.03,1,.1,88,22,,,,,145,,,.68,.03,,-1493];G("oh no"),H.STAR_SPAWN_INTERVAL+=200,[...document.querySelectorAll(".cell")].forEach(e=>e.style.setProperty("pointer-events","none"));const v=800;async function g(e,n){return new Promise(o=>{let a=0;for(let o=0;o<e.length;o++)e[o]||(a++,setTimeout(()=>{t(...f),n[o].classList.add("fail")},a*v));setTimeout(()=>{o()},a*v)})}const y=[[!s.every(e=>e),()=>g(s,u)],[!r.every(e=>e),()=>g(r,m)],[!0,()=>new Promise(e=>setTimeout(e,v))],[i().some(e=>void 0===e[1]),async function(){const e=i().filter(e=>void 0===e[1]);return G('No bordering cat"}'),new Promise(n=>{e.forEach((e,n)=>{setTimeout(()=>{t(...f),e[0].classList.add("fail")},n*v)}),setTimeout(()=>{n("resolved")},e.length*v)})}],[0!==l.length,async function(){return G("cats cannot touch even diagonally"),new Promise(e=>{l.forEach((e,n)=>{setTimeout(()=>{t(...f),e.classList.add("fail")},n*v)}),setTimeout(()=>{e("resolved")},l.length*v)})}],[!0,()=>new Promise(e=>setTimeout(e,1.5*v))]];for(const[T,M]of y)T&&await M();t(...[.5,,89,.09,.11,.27,,.2,7,8,,,,1.2,,.9,,.4,.06,,1299]),V>2||q>2?V<q?q--:V--:(U-=.15,U<.2&&(V<q?q--:V--,U=.4)),x.classList.add("fail"),setTimeout(()=>{if(4===o)return ae.innerHTML="",J(te),void oe.scrollIntoView({behavior:"smooth"});const e=a(V,q,U);n.innerHTML="",van.add(n,e)},2e3)}},500),!0));function b(t,n,o,a=5e4){function r(t,n){const o=[];for(const[e,a]of d){const r=n.r+e,s=n.c+a;p(r,s)&&0===t[r][s]&&(g(t,r,s)||1===v(t,r,s)&&o.push({r:r,c:s}))}for(let t=o.length-1;t>0;t--){const n=e()*(t+1)|0;[o[t],o[n]]=[o[n],o[t]]}return o}for(let s=0;s<a;s++){i=Array.from({length:t},e=>new Uint8Array(n));const l=[];let c=0,u=t*n*6;for(;c<o&&u--&&s<a;){const f=e()*t|0,h=e()*n|0;if(0!==i[f][h])continue;i[f][h]=1;let T=!1;for(const[M,b]of d){const x=f+M,w=h+b;if(p(x,w)&&0===i[x][w]){T=!0;break}}T?(l.push({r:f,c:h}),c++):i[f][h]=0}if(!(c<o)&&m())return i;function m(){let e=-1,t=null;for(let n=0;n<l.length;n++){const o=l[n];if(y(i,o.r,o.c))continue;const a=r(i,o);if(0===a.length)return!1;(!t||a.length<t.opts.length)&&(t={i:n,opts:a},e=n)}if(-1===e)return!0;for(const{r:e,c:n}of t.opts){if(i[e][n]=2,m())return!0;i[e][n]=0}return!1}}return!1}const x=B({class:"holder"});for(c=[...new Array(r)].map(e=>[...new Array(s)]);!b(r,s,f);)f-=1,U=.22;u=[],m=[];for(let e=2;e<r+2;e++){let t=B({class:"marker rm"});van.add(x,B({style:`grid-area: ${e} / ${s+2} / ${e+1} / ${s+3}; display: flex;\n    align-items: center;`},t)),u.push(t)}for(let e=2;e<s+2;e++){let t=B({class:"marker cm"});van.add(x,B({style:`grid-area: ${r+2} / ${e} / ${r+3} / ${e+1}; display: flex;\n    justify-content: center;\n    `},t)),m.push(t)}const w="var(--bop)",A=e()>.5?[`hsl(225 63% 57% / ${w}), hsl(240 90% 50% / ${w})`,`hsl(25 80% 55% / ${w}), hsl(45 90% 50% / ${w})`]:[`hsl(300 66% 72% / ${w}), hsl(300 90% 25% / ${w})`,`hsl(120 90% 50% / ${w}), hsl(120 90% 25% / ${w})`];for(let n=0;n<r;n++){let o=0;for(let a=0;a<s;a++){const l=11-Math.max(r,s);if(c[n][a]=B({class:"cell",style:`grid-area: ${n+2} / ${a+2} / ${n+3} / ${a+3};background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"><filter id="a"><feTurbulence seed="${~~(2e3*e())}" baseFrequency="2" result="noise" type="fractalNoise"/><feComponentTransfer><feFuncR tableValues="0 1" type="discrete"/><feFuncG tableValues="0 1" type="discrete"/><feFuncB tableValues="0 1" type="discrete"/><feFuncA type="linear"/></feComponentTransfer><feColorMatrix type="saturate" values="0.10"/></filter><g transform="scale(${l*l*.35})"><rect width="100px" height="100px" filter="url(%23a)" opacity=".15"/></g></svg>'), linear-gradient(${e()}turn, ${A[(n+a)%A.length]});\n          --bop: 0.3;\n      animation-delay: ${800*Math.abs(n-a)/(r+s)}ms;\n      font-size: ${.6*l}em`,onclick:()=>{1===i[n][a]||c[n][a].classList.contains("cat")?c[n][a].classList.contains("cat")&&(c[n][a].innerHTML="",c[n][a].classList.remove("cat"),c[n][a].style.setProperty("--bop",.3),T-=1):(t(...[2,0,261.6256,.01,.33,.07,1,1.9,,,,,,.1,,,.17,.62,.06]),c[n][a].classList.add("cat"),c[n][a].style.setProperty("--bop",1),c[n][a].style.setProperty("pointer-events","none"),van.add(c[n][a],B({class:"om"},B({class:"reflect"},j(0))),B({class:"derot"},j(7))),M()||c[n][a].style.setProperty("pointer-events","auto"))}}),1==i[n][a]){const t=["‚≠êÔ∏è","‚òÅÔ∏è","üåô"][~~(3*e())];c[n][a].classList.add("milk"),c[n][a].style.setProperty("--bop",1),van.add(c[n][a],B({class:"om"},B({class:"reflect"},B({class:"toy"},t))),B({class:"derot"},B({class:"toy"},t)))}else 2==i[n][a]&&(o+=1);van.add(x,c[n][a])}u[n].innerText=o}for(let e=0;e<s;e++){let t=0;for(let n=0;n<r;n++)2===i[n][e]&&t++;m[e].innerText=t}return x},r=a(V,q,U);van.add(n,r)},ee=B({id:"rani",onclick:K}),te=B(),ne=B({id:"moon",class:"sc"},B({id:"mho"},"You Win!"),z({id:"canvas-2"}),B({class:"cho"},[...new Array(5)].map(e=>j(0)))),oe=B({id:"tunnel",class:"sc"},z({id:"canvas-1"}),te),ae=B({id:"tile",class:"sc"}),re=B({id:"start",class:"sc"},B({class:"center"},B({id:"t"},"üåô Celestial Paws ‚≠êÔ∏è"),D({id:"start-btn",onclick:()=>{Z(ae),k()}},"Start")),B({id:"start-cat"},j(7)));van.add(document.body,ne,oe,ae,re),l.push(i("canvas-1","#define s iTime * 0.75\nfloat h(float n){return fract(sin(n)*43758.5453123);}\nfloat n3(vec3 x){vec3 p=floor(x),f=fract(x);f=f*f*(3.0-2.0*f);float n=p.x+p.y*57.0+p.z*113.0;return mix(mix(mix(h(n+0.0),h(n+1.0),f.x),mix(h(n+57.0),h(n+58.0),f.x),f.y),mix(mix(h(n+113.0),h(n+114.0),f.x),mix(h(n+170.0),h(n+171.0),f.x),f.y),f.z);}\nfloat c(vec3 p,vec3 r){return length(p.xy-r.xy)-r.z;}\nvec2 r(vec2 k,float a){return vec2(cos(a)*k.x-sin(a)*k.y,sin(a)*k.x+cos(a)*k.y);}\nfloat d(vec3 p){p.z+=s*2.0;p.x+=sin(p.z*0.5)*1.5;return c(p,vec3(0.0,0.0,1.5));}\nvec4 d4(vec3 p){float t=d(p);p.z+=s*4.0;t+=n3(p*1.75-s*1.5)*0.6;vec4 r=vec4(clamp(t,0.0,1.0));r.xyz=mix(vec3(1.0,1.0,1.0),vec3(0.0,0.0,0.05),r.x);return r;}\nvoid mainImage(out vec4 f,in vec2 c){vec3 o=vec3(0.0,0.0,-3.0);vec3 d=normalize(vec3((-1.0+2.0*c.xy/iResolution.xy)*vec2(iResolution.x/iResolution.y,1.0),1.0));o.x+=cos(s)*1.0;d.xy=r(d.xy,s*0.05+cos(s*0.05));d.x+=sin(s-3.14*0.5)*0.5;float t=0.0;vec4 l=vec4(0.07,0.1,0.2,0.0);for(int i=0;i<220;i++){vec4 v=d4(o+d*t);v.w*=0.35;v.xyz*=v.w;l=l+v*(1.0-l.w);t+=0.1;}l.xyz/=l.w;l=sqrt(l);f=vec4(l.xyz,1.0) * (l.y - 0.3) * (c.y / iResolution.y);}")),l.push(i("canvas-2","#define S 0.6\nmat2 r(float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\nfloat t(float x){return clamp(abs(fract(x)-0.5),0.01,0.49);}\nvec2 t2(vec2 p){return vec2(t(p.x)+t(p.y),t(p.y+t(p.x)));}\nfloat n2(vec2 p,float s){float c=1.8,d=2.5,n=0.0;vec2 w=p*r(p.x*0.06),b=w;for(float i=0.0;i<5.0;i++){vec2 l=t2(b*1.85)*0.75;l*=r(iTime*s);w-=l/d;b*=1.3;d*=0.45;c*=0.42;w*=1.21+(n-1.0)*0.02;n+=t(w.x+t(w.y))*c;w*=-mat2(0.95534,0.29552,-0.29552,0.95534);}return clamp(1.0/pow(n*29.0,1.3),0.0,0.55);}\nfloat h(vec2 p){return fract(sin(dot(p,vec2(12.9898,4.1414)))*43758.5453);}\nvec4 a(vec3 o,vec3 d){vec4 c=vec4(0.0),l=vec4(0.0);for(float i=0.0;i<50.0;i++){float f=0.006*h(gl_FragCoord.xy)*smoothstep(0.0,15.0,i);float t=(0.8+pow(i,1.4)*0.002-o.y)/(d.y*2.0+0.4);t-=f;vec3 p=o+t*d;vec2 j=p.zx;float a=n2(j,S);vec4 s=vec4(0.0,0.0,0.0,a);s.rgb=(sin(1.0-vec3(2.15,-0.5,1.2)+i*0.043)*0.5+0.5)*a;l=mix(l,s,0.5);c+=l*exp2(-i*0.065-2.5)*smoothstep(0.0,5.0,i);}c*=clamp(d.y*15.0+0.4,0.0,1.0);return c*1.8;}\nvoid mainImage(out vec4 fragColor,in vec2 c){vec2 q=c/iResolution.xy;vec2 p=q;p.x*=iResolution.x/iResolution.y;vec3 o=vec3(0.0,0.0,-6.7);vec3 d=normalize(vec3(p,1.3));vec3 l=vec3(0.0);float f=smoothstep(0.0,0.01,abs(d.y))*0.1+0.9;if(d.y>0.0){vec4 u=smoothstep(0.0,1.5,a(o,d))*f;l=l*(1.0-u.a)+u.rgb;}float m=dot(l.rgb,vec3(0.299,0.587,0.114));fragColor=vec4(l.rgb,m);}")),requestAnimationFrame(()=>{re.scrollIntoView({behavior:"smooth"}),m(),setTimeout(()=>{van.add(ne,B({id:"range"},ee))},1e3)})</script>