<html><head><meta charset='utf-8'><meta name="monetization" content="$ilp.uphold.com/6GmpAP42JBx8"><style>body{display:flex;justify-content:center;align-items:center;background-color:#333}canvas{box-shadow: 0 0 20px black}</style></head><body><canvas id="canvas"></canvas><script>function registerFontFunctions(t){t.drawFontCenter=function(t,e,a,n){var s=e-t.length/2*6*n;this.drawFont(t,s,a,n)},t.drawFontRight=function(t,e,a,n){var s=e-6*t.length*n;this.drawFont(t,s,a,n)},t.drawFont=function(t,e,a,n){for(var s=this.fonts[this.fonts.current],i=0,o=t.length;i<o;i++)this.drawLetter(s,t[i],e+i*(s.width+1)*n,a,n)},t.drawLetter=function(t,e,a,n,s){s=s||1,e=e.toLowerCase();for(var i=t.characters[e],o=0;o<t.height;o++)for(var r=0;r<t.width;r++)void 0!==i[o][r]&&("number"==typeof i[o][r]&&(this.fillStyle=this.fonts.palettes[this.fonts.palette][i[o][r]]),this.fillRect(r*s+a,o*s+n,s,s))}}function registerFonts(t){var e=!0;t.fonts={current:"alphanumeric",palette:0,palettes:[["#fff","#000"],["#000","#fff"]],alphanumeric:{height:7,width:5,characters:{a:[[,,e,,],[,e,,e],[e,,,,e],[e,,,,e],[e,e,e,e,e],[e,,,,e],[e,,,,e]],b:[[e,e,e,e],[e,,,,e],[e,,,,e],[e,e,e,e],[e,,,,e],[e,,,,e],[e,e,e,e]],c:[[,e,e,e],[e,,,,e],[e,,,,],[e,,,,],[e,,,,],[e,,,,e],[,e,e,e]],d:[[e,e,e,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,e,e,e]],e:[[e,e,e,e,e],[e,,,,],[e,,,,],[e,e,e,e],[e,,,,],[e,,,,],[e,e,e,e,e]],f:[[e,e,e,e,e],[e,,,,],[e,,,,],[e,e,e,e],[e,,,,],[e,,,,],[e,,,,]],g:[[,e,e,e],[e,,,,e],[e,,,,],[e,,,,],[e,,e,e,e],[e,,,,e],[,e,e,e]],h:[[e,,,,e],[e,,,,e],[e,,,,e],[e,e,e,e,e],[e,,,,e],[e,,,,e],[e,,,,e]],i:[[,e,e,e],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,e,e,e]],j:[[,e,e,e,e],[,,,e],[,,,e],[,,,e],[,,,e],[e,,,e],[,e,e,,]],k:[[e,,,,e],[e,,,e],[e,,e,,],[e,e,,,],[e,,e,,],[e,,,e],[e,,,,e]],l:[[e,,,,],[e,,,,],[e,,,,],[e,,,,],[e,,,,],[e,,,,],[e,e,e,e,e]],m:[[e,,,,e],[e,e,,e,e],[e,,e,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e]],n:[[e,,,,e],[e,,,,e],[e,e,,,e],[e,,e,,e],[e,,,e,e],[e,,,,e],[e,,,,e]],o:[[,e,e,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[,e,e,e]],p:[[e,e,e,e],[e,,,,e],[e,,,,e],[e,e,e,e],[e,,,,],[e,,,,],[e,,,,]],q:[[,e,e,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,e,,e],[e,,,e,e],[,e,e,e,e]],r:[[e,e,e,e],[e,,,,e],[e,,,,e],[e,e,e,e],[e,,e,,],[e,,,e],[e,,,,e]],s:[[,e,e,e],[e,,,,e],[e,,,,],[,e,e,e],[,,,,e],[e,,,,e],[,e,e,e]],t:[[e,e,e,e,e],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,,e,,]],u:[[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[,e,e,e]],v:[[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[,e,,e],[,e,,e],[,,e,,]],w:[[e,,,,e],[e,,,,e],[e,,,,e],[e,,,,e],[e,,e,,e],[e,e,,e,e],[e,,,,e]],x:[[e,,,,e],[e,,,,e],[,e,,e],[,,e,,],[,e,,e],[e,,,,e],[e,,,,e]],y:[[e,,,,e],[e,,,,e],[,e,,e],[,,e,,],[,,e,,],[,,e,,],[,,e,,]],z:[[e,e,e,e,e],[,,,,e],[,,,e],[,,e,,],[,e,,,],[e,,,,],[e,e,e,e,e]],0:[[,e,e,e],[e,,,,e],[e,,,e,e],[e,,e,,e],[e,e,,,e],[e,,,,e],[,e,e,e]],1:[[,e,e,,],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,,e,,],[,e,e,e]],2:[[,e,e,e],[e,,,,e],[,,,e],[,,e,,],[,e,,,],[e,,,,],[e,e,e,e,e]],3:[[,e,e,e],[e,,,,e],[,,,,e],[,,e,e],[,,,,e],[e,,,,e],[,e,e,e]],4:[[,,,e],[,,e,e],[,e,,e],[e,,,e],[e,e,e,e,e],[,,,e],[,,,e]],5:[[e,e,e,e,e],[e,,,,],[e,,,,],[e,e,e,e],[,,,,e],[e,,,,e],[,e,e,e]],6:[[,e,e,e],[e,,,,e],[e,,,,],[e,e,e,e],[e,,,,e],[e,,,,e],[,e,e,e]],7:[[e,e,e,e,e],[,,,,e],[,,,e],[,,,e],[,,e,,],[,,e,,],[,,e,,]],8:[[,e,e,e],[e,,,,e],[e,,,,e],[,e,e,e],[e,,,,e],[e,,,,e],[,e,e,e]],9:[[,e,e,e],[e,,,,e],[e,,,,e],[,e,e,e,e],[,,,,e],[e,,,,e],[,e,e,e]]," ":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,]],",":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,e,,],[,e,,,]],".":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,e,,,]],":":[[,,,,],[,,e,,],[,,,,],[,,,,],[,,,,],[,,e,,],[,,,,]],"?":[[,e,e,e],[e,,,,e],[,,,,e],[,,e,e],[,,e,,],[,,,,],[,,e,,]],"%":[[,e,,,],[e,,e,,e],[,e,,e],[,,e,,],[,e,,e],[e,,e,,e],[,,,e]],"@":[[,e,e,e],[e,,,e,e],[e,,e,,e],[e,,e,,e],[e,,e,e],[e,,,,],[,e,e,e]],'"':[[,e,,e],[,e,,e],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,]],"→":[[,,,,],[,,e,,],[,,,e],[e,e,e,e,e],[,,,e],[,,e,,],[,,,,]],"←":[[,,,,],[,,e,,],[,e,,,],[e,e,e,e,e],[,e,,,],[,,e,,],[,,,,]],"↑":[[,,,,],[,,e,,],[,e,e,e],[e,,e,,e],[,,e,,],[,,e,,],[,,,,]],"↓":[[,,,,],[,,e,,],[,,e,,],[e,,e,,e],[,e,e,e],[,,e,,],[,,,,]],"/":[[,,,e],[,,,e],[,,e,,],[,,e,,],[,,e,,],[,e,,,],[,e,,,]],"♥":[[,,,,],[,e,,e],[e,e,e,e,e],[e,e,e,e,e],[,e,e,e],[,,e,,],[,,,,]],"¢":[[,e,e,e],[e,,,,e],[e,,,e,e],[e,,,,],[e,,,,],[e,,,,e],[,e,e,e]]}},gameObjects:{height:8,width:8,characters:{"★":[[,,,,e,,,],[,,,,e,,,],[e,e,,e,e,,e,e],[,e,e,e,e,e,e],[,,e,e,e,e,e],[,,e,e,e,e,,],[,e,e,,,e,e],[,e,,,,,e,e]],b:[[,,,,e,e,,],[,,,,e,e,,],[,,,e,e,e,,],[,e,e,,e,,e],[e,,e,e,,e,e],[e,,e,e,e,e,e],[,,e,,e,e,,],[,,e,,,e,,]],t:[[,,,,,,,],[,,,,,,,],[,,,,,,,],[,,e,,e,,,],[,,e,e,,e,,],[,,e,e,e,e,,],[,,e,,e,e,,],[,,e,,,e,,]],a:[[,,,,,,,],[,,,,,,,],[,,,,,,,],[,e,,,,,e],[e,,,,,,,e],[e,,,,,,,],[,,,,,,,],[,,,,,,,]],k:[[,,,,,,,],[,,,,,,,],[,,,,,,,],[,e,,,,,,],[,e,,,,,e,e],[,,,,,,,],[,,,,,,,],[,,,,,,,]],h:[[,,,,e,e,,],[,,,,e,e,,],[,,,e,e,e,,],[,,,,e,,,],[,,,,,,,],[,,,,,,,],[,,,,,,,],[,,,,,,,]],w:[[,,,,,,,],[,,,e,e,e,e,e],[,,,e,e,e,e],[,,e,e,e,e,,],[,e,e,e,,,e],[,e,e,,e,,,],[,e,,,,,,],[,e,,,,,,]],u:[[,,,,,,e,e],[,,,,,e,e],[,,,,e,e,e],[,,,e,e,e,,e],[,,e,e,e,e,,],[,,e,e,,,e],[,e,e,,e,,,],[,e,,,,,,]],d:[[,,,e,,,,],[,,,e,e,,,],[,,e,e,e,e,,],[,e,e,e,e,e,e],[,e,e,e,,e,e],[,e,e,,e,,,e],[,e,,,,,,],[,e,,,,,,]],"^":[[,,,,,,,],[,,,,,,,],[,,,,,,,],[,,,,,,,],[,,,,,,,],[,e,,,,e,,],[,e,,,,e,,],[e,e,e,,e,e,e]],i:[[,,,,,,,],[,,,,e,e,,],[,e,,,e,e,,],[e,,,,e,,,],[e,,,e,e,e,,],[e,e,e,e,e,e,,],[,e,e,e,e,,,],[,,,e,,e,,]],"!":[[,e,,e,,,,],[e,e,,,e,,,e],[e,e,,,e,,e,e],[e,e,,e,e,,e,e],[e,e,e,e,e,e,e,e],[,e,,e,e,e,e,e],[,,e,e,e,,e],[,,e,e,,,,]],"/":[[,,,,,,,],[,,,,,,,],[,,,,,,,],[,,,,,,,e],[,,,,,,e],[,,,,,e,,],[,,,,e,,,],[,,,,,,,]],"@":[[,e,e,e,e,,,],[e,,,,,e,,],[,,e,e,,,e],[,e,,,e,,e],[,e,,e,,,e],[,e,,,,e,,],[,,e,e,e,,,],[,,,,,,,]]}},boss:{height:8,width:8,characters:{h:[[,,0,0,0,,,],[,,,0,,,,],[,,,0,,,,],[,,,0,,,,],[,0,0,0,0,0,,],[0,0,0,0,0,0,0],[,,0,1,0,,,],[,0,1,1,1,0,,]],b:[[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,]],t:[[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,0,1,0,,],[,0,1,1,1,0,,],[,,0,1,0,,,],[,,0,1,0,,,],[,,,0,,,,]],o:[[,,,,,,,],[,,,0,0,,,],[,0,0,1,1,0,0],[0,1,1,0,0,1,1,0],[0,1,1,0,0,1,1,0],[,0,0,1,1,0,0],[,,,0,0,,,],[,,,,,,,]],e:[[,,,,,,,],[,,,0,0,,,],[,0,0,1,1,0,0],[0,0,0,0,0,0,0,0],[0,1,1,0,0,1,1,0],[,0,0,1,1,0,0],[,,,0,0,,,],[,,,,,,,]],u:[[,,,,,,,],[,,,0,0,,,],[,0,0,1,1,0,0],[0,1,1,1,1,1,1,0],[0,0,1,1,1,1,0,0],[,0,0,0,0,0,0],[,,,0,0,,,],[,,,,,,,]],r:[[,,,0,0,0,,],[,,0,,,,0],[,0,,,,,,0],[,0,,,,,,],[0,,,,0,,0,0],[0,,,,,0,,],[0,,,,,,0],[0,,,0,,0,0]],l:[[0,,,,0,,,],[,0,,,,0,,],[,0,,,,0,0],[,0,,,0,,,],[,,0,,,0,,],[,,0,,,,0],[,,,0,,,,0],[,,,,0,0,0,0]],"/":[[,,,,,,,],[,,,,,,0,0],[,,,,0,0,,],[,,,0,,,,],[,,0,,,,,],[,0,,,,,,0],[0,,,0,0,,0],[0,0,0,,,0,,]],"-":[[,0,0,0,0,0,,],[0,,,,,,0],[,,,,,,,0],[,,,,,,,],[,,,0,,0,0],[0,,0,,0,,,0],[,0,,,,,,],[,,,,,,,]],"=":[[0,0,0,0,,,,],[0,,,,0,0,0],[,0,,,,,,0],[0,,,,,,,],[,0,0,,,,,],[,,,0,,0,0,0],[,,,0,0,,,0],[,,,,,,,0]],_:[[,,,,,,,],[,,,0,0,0,0],[0,0,0,,,,,0],[,,,,,,,0],[,,,,,0,,],[,,0,,,0,0,0],[,0,,0,,0,,],[0,,,,0,,,]]}}}}var CPlayer=function(){var t,e,a,n,s,i=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,e,a){var n,s,i,r,d,h,l,u=c[t.i[0]],f=t.i[1],m=t.i[3],p=c[t.i[4]],x=t.i[5],w=t.i[8],g=t.i[9],y=t.i[10]*t.i[10]*4,b=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,M=1/v,k=t.i[13],S=a*Math.pow(2,2-t.i[14]),C=new Int32Array(y+b+v),O=0,D=0;for(n=0,s=0;n<y+b+v;n++,s++)s>=0&&(s-=S,h=o(e+(15&(k=k>>8|(255&k)<<4))+t.i[2]-128),l=o(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),i=1,n<y?i=n/y:n>=y+b&&(i-=(n-y-b)*M),r=h,m&&(r*=i*i),d=u(O+=r)*f,r=l,w&&(r*=i*i),d+=p(D+=r)*x,g&&(d+=(2*Math.random()-1)*g),C[n]=80*d*i|0;return C},c=[i,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(i){t=i,e=i.endPattern,a=0,n=i.rowLen*i.patternLen*(e+1)*2,s=new Int32Array(n)},this.generate=function(){var o,d,h,l,u,f,m,p,x,w,g,y,b,v,M=new Int32Array(n),k=t.songData[a],S=t.rowLen,C=t.patternLen,O=0,D=0,R=!1,j=[];for(h=0;h<=e;++h)for(m=k.p[h],l=0;l<C;++l){var F=m?k.c[m-1].f[l]:0;F&&(k.i[F-1]=k.c[m-1].f[l+C]||0,F<16&&(j=[]));var I=c[k.i[15]],z=k.i[16]/512,P=Math.pow(2,k.i[17]-9)/S,G=k.i[18],X=k.i[19],L=43.23529*k.i[20]*3.141592/44100,T=1-k.i[21]/255,B=1e-5*k.i[22],A=k.i[23]/32,E=k.i[24]/512,U=6.283184*Math.pow(2,k.i[25]-9)/S,Y=k.i[26]/255,W=k.i[27]*S&-2;for(g=(h*C+l)*S,u=0;u<4;++u)if(f=m?k.c[m-1].n[l+u*C]:0){j[f]||(j[f]=r(k,f,S));var V=j[f];for(d=0,o=2*g;d<V.length;d++,o+=2)M[o]+=V[d]}for(d=0;d<S;d++)(w=M[p=2*(g+d)])||R?(y=L,G&&(y*=I(P*p)*z+.5),D+=(y=1.5*Math.sin(y))*(b=T*(w-D)-(O+=y*D)),w=3==X?D:1==X?b:O,B&&(w=(w*=B)<1?w>-1?i(.25*w):-1:1,w/=B),R=(w*=A)*w>1e-5,v=w*(1-(x=Math.sin(U*p)*E+.5)),w*=x):v=0,p>=W&&(v+=M[p-W+1]*Y,w+=M[p-W]*Y),M[p]=0|v,M[p+1]=0|w,s[p]+=0|v,s[p+1]+=0|w}return++a/t.numChannels},this.createWave=function(){var t=44+2*n-8,e=t-36,a=new Uint8Array(44+2*n);a.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var i=0,o=44;i<n;++i){var r=s[i];r=r<-32767?-32767:r>32767?32767:r,a[o++]=255&r,a[o++]=r>>8&255}return a},this.getData=function(t,e){for(var a=2*Math.floor(44100*t),n=new Array(e),i=0;i<2*e;i+=1){var o=a+i;n[i]=t>0&&o<s.length?s[o]/32768:0}return n}},mainTheme={songData:[{i:[2,192,128,0,2,192,140,18,0,0,158,27,158,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],p:[2,3,2,3,2,3,2,3,4,4,4,4,2,3,2,3,2,3,2,3,4,4,4,4],c:[{n:[],f:[]},{n:[106],f:[]},{n:[102],f:[]},{n:[101],f:[]}]},{i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,,,,,,,,,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[123,,,,123,,,,123,,,,123],f:[]}]},{i:[2,17,116,0,2,16,128,4,0,0,47,48,107,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[142],f:[]}]}],rowLen:11025,patternLen:16,endPattern:23,numChannels:3},diesIrae={songData:[{i:[3,128,128,0,3,0,92,0,0,0,5,27,58,0,0,0,0,6,1,2,135,0,0,27,147,6,121,6],p:[1,2,3,4,5,6,7,8,,9,10,11,12,13,14,15,16,17,18],c:[{n:[125,,,,,,,,125,,,,,,,,128,,,,,,,,128,,,,,,,,132,,,,,,,,132,,,,,,,,137,,,,,,,,132],f:[]},{n:[125,,,,125,,,,,,,,,,,,130,,,,130,,,,,,,,,,,,132,,,,132,,,,,,,,,,,,139,,,,132],f:[]},{n:[124,,,,,,,,124,,,,,,,,130,,,,,,,,130,,,,,,,,132,,,,,,,,132,,,,,,,,139,,,,,,,,132],f:[]},{n:[125,,,,125,,,,,,,,113,,113,,128,,,,128,,,,,,,,128,,128,,132,,,,132,,,,,,,,132,,132,,140,,,,137,,,,,,,,137,,137],f:[]},{n:[115,,,,116,,,,,,,,116,,116,,127,,,,125,,,,,,,,120,,120,,130,,,,132,,,,,,,,132,,132,,136,,,,137,,,,,,,,137,,137],f:[]},{n:[112,,,,113,,,,,,,,125,,123,,127,,,,125,,,,,,,,128,,128,,132,,,,132,,,,,,,,132,,132,,139,,,,140,,,,137,,,,,,137],f:[]},{n:[121,,,,120,,,,118,,,,113,,,,125,,,,125,,,,124,,,,128,,,,130,,,,132,,,,133,,,,132,,,,142,,,,140,,,,139,,,,137],f:[]},{n:[120,,,,120,,,,,,,,,,,,128,,,,127,,,,,,,,,,,,132,,,,132,,,,,,,,,,,,137,,,,136],f:[]},{n:[116,,,,,,,,,,,,116,,,,123,,,,,,,,,,,,116,,,,132,,,,,,,,,,,,132,,,,140,,,,,,,,,,,,135],f:[]},{n:[116,,,,116,,,,116,,,,116,,,,128,,,,,,,,,,,,123,,,,128,,,,123,,,,128,,,,132,,,,132,,,,128,,,,132,,,,135],f:[]},{n:[117,,,,,,,,117,,,,,,,,120,,,,117,,,,120,,,,123,,,,135,,,,,,,,132,,,,,,,,138,,,,,,,,137],f:[]},{n:[118,,,,,,,,,,,,118,,,,123,,,,,,,,122,,,,,,,,125,,,,,,,,,,,,130,,,,142,,,,,,,,,,,,137],f:[]},{n:[118,,,,118,,,,118,,,,118,,,,130,,,,,,,,,,,,125,,,,125,,,,125,,,,130,,,,134,,,,134,,,,130,,,,134,,,,137],f:[]},{n:[119,,,,,,,,119,,,,,,,,122,,,,119,,,,122,,,,125,,,,137,,,,,,,,134,,,,,,,,140,,,,,,,,139],f:[]},{n:[120,,,,,,,,122,,,,,,,,123,,,,,,120,,125,,,,,,122,,132,,,,,,,,131,,,,,,,,139,,,,,,,,139],f:[]},{n:[123,,,,,,,,125,,,,,,,,127,,,,120,,,,,,,,128,,128,,132,,,,135,,,,,,,,134,,132,,139,,,,,,,,137],f:[]},{n:[127,,,,120,,,,115,,,,,,,,127,,,,127,,,,127,,,,,,,,131,,,,132,,,,132,,,,131,,,,137,,,,135,,,,134],f:[]},{n:[120,,,,,,,,,,,,,,,,127,,,,,,,,,,,,,,,,132,,,,,,,,,,,,,,,,132],f:[]}]},{i:[3,128,128,0,3,0,92,0,0,0,5,25,58,0,0,0,0,6,1,2,135,0,0,27,0,0,0,6],p:[,,,,,,,,2],c:[{n:[128,,,,,,,,128],f:[]},{n:[120,,120,,121,,122,,123,,124,,125,,127],f:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[123,,,,123,,,,123,,,,123],f:[]}]},{i:[2,65,128,0,2,64,140,18,0,0,0,127,227,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],p:[1,,1,,1,,,2,,3,,,4,,,5,,,5],c:[{n:[101],f:[]},{n:[108],f:[]},{n:[104],f:[]},{n:[106],f:[]},{n:[108],f:[]}]}],rowLen:4725,patternLen:16,endPattern:18,numChannels:4},data={lastTime:(new Date).getTime(),lskey:"heavenascent",maxDX:8,maxDY:10,sound:3,music:10,screenshake:!0,secret:!1,infiniteLives:!1,rainbowDash:!1,randBoss:!1,debug:!1,palette:0,palettes:[{bg:"#000",bgt:"rgba(0,0,0,0.5)",fg:"#fff",sg:"#222",un:"#666",p1:"#7da8d6",p2:"#fff",p3:"yellow",e1:"red",e2:"#666",e3:"#fff",st:"yellow",ht:"red",pt:"limegreen"},{bg:"#fff",bgt:"rbga(255,255,255,0.5)",fg:"#000",sg:"#eee",un:"#666",p1:"#7da8d6",p2:"#ccc",p3:"yellow",e1:"red",e2:"#999",e3:"#000",st:"yellow",ht:"red",pt:"limegreen"}],collisionTypes:{"★":"collect","♥":"lifeUp",i:"hurt","-":"hurt","/":"hurt",r:"hurt",l:"hurt","@":"portal"},collisionFunctions:{collect:function(t,e){data.score++,playSFX("collect"),e.cull=!0},lifeUp:function(t,e){data.life++,e.cull=!0},hurt:function(t,e){damage(t,1)&&(t.iFrames=30,t.dx-=e.x-t.x,t.dy-=50,data.hitstop||(data.hitstop=4))},portal:function(t,e){Math.abs(t.x-e.x)<32/1.5&&Math.abs(t.y-e.y)<32/1.5&&(data.bossRoom.inBossRoom?leaveBoss():enterBoss(data.world[data.currentMap.y][data.currentMap.x]),resetParticles(),e.cull=!0)}},aiDefs:{wander:function(t){var e=data.timer+t.id,a=Math.sin(e/100)-Math.sin(e/50)-Math.sin(e/20),n=Math.sin(e/90)+Math.sin(e/40)+Math.sin(e/30);a>0&&(t.right=!0),a<0&&(t.left=!0),n>0&&(t.down=!0),n<0&&(t.up=!0)},seek:function(t){var e=getCurrentMap(),a=e.player.x-t.x,n=e.player.y-t.y;a>0&&(t.right=!0),a<0&&(t.left=!0),n>0&&(t.down=!0),n<0&&(t.up=!0)},imp:function(t){var e=getCurrentMap(),a={x:e.player.x-t.x,y:e.player.y-t.y};Math.abs(a.x)<160&&Math.abs(a.y)<160?data.aiDefs.seek(t):data.aiDefs.wander(t)}}};function initialiseGameData(){data.unlocks={life:{text:"Increase Life",cost:function(){return 10*(this.unlocked+1)},unlocked:0},dash:{text:"Wing Dash",cost:25,unlocked:!1,alt:"Press Z while moving to Dash"},glide:{text:"Wing Glide",cost:25,unlocked:!1,alt:"Hold Up to fall slower"},reaper:{text:"Reaper",cost:50,unlocked:!1,alt:"Gain stars from your enemies"}}}function setupData(){data.keys={},data.timer=0,data.screenShake=0,data.scene="title",data.previousScene=!1,data.life=5+5*data.unlocks.life.unlocked,data.score=0,setupWorld()}function Menu(t){this.selected=t.selected||0,this.charSelect=t.charSelect,this.y=t.y,this.margin=t.margin,this.space=t.space,this.optionSize=t.optionSize,this.options=t.options,this.update=function(t){this.selected+=t,this.options[this.selected]||(this.selected+=t),this.selected>=this.options.length&&(this.selected=0),this.selected<0&&(this.selected=this.options.length-1),this.options[this.selected].selectable(this.options[this.selected])||this.update(t<0?-1:1)},this.draw=function(){ctx.save(),ctx.translate(0,this.y);for(var t=0;t<this.options.length;t++)this.options[t]&&this.options[t].draw(this,t,this.selected===t);ctx.restore()}}function MenuOption(t){this.text=t.text,this.text2=t.text2,this.altCheck=t.altCheck,this.altText=t.altText,this.optionData=t.optionData,this.selectable=t.selectable||function(){return!0},this.onSelect=t.onSelect||function(){return!1},this.left=t.left,this.onLeft=t.onLeft,this.right=t.right,this.onRight=t.onRight,this.draw=function(t,e,a){if(a){var n=t.margin-48||192;ctx.strokeStyle=getColor("fg"),ctx.fillStyle=getColor("sg"),ctx.strokeRect(n,e*t.space-8,canvas.width-2*n,7*t.optionSize+16),ctx.fillRect(n,e*t.space-8,canvas.width-2*n,7*t.optionSize+16),t.charSelect&&(ctx.fonts.current="gameObjects",ctx.save(),ctx.translate(n-48,e*t.space+8),drawCharacter(!1,"u"),ctx.restore(),ctx.save(),ctx.translate(canvas.width-(n-48),e*t.space+8),ctx.scale(-1,1),drawImp("d"),ctx.restore(),ctx.fonts.current="alphanumeric")}ctx.fillStyle=this.selectable(this)?getColor("fg"):getColor("un"),this.altCheck&&this.altCheck(this)?ctx.drawFontCenter(this.altText(this),canvas.width/2,e*t.space,t.optionSize):this.text2?(ctx.drawFont(this.text(this),t.margin,e*t.space,t.optionSize),ctx.drawFontRight(this.text2(this),canvas.width-t.margin,e*t.space,t.optionSize),this.right&&(ctx.fillStyle=!this.right||this.right(this)?getColor("fg"):getColor("un"),ctx.drawFont("→",canvas.width-t.margin+5*t.optionSize,e*t.space,t.optionSize)),this.left&&(ctx.fillStyle=!this.left||this.left(this)?getColor("fg"):getColor("un"),ctx.drawFontRight("←",canvas.width-t.margin-6*this.text2(this).length*t.optionSize-5*t.optionSize,e*t.space,t.optionSize))):ctx.drawFontCenter(this.text(this),canvas.width/2,e*t.space,t.optionSize)}}function ToggleMenuOption(t,e){MenuOption.call(this,{optionData:{text:t,option:e},text:function(t){return t.optionData.text},text2:function(t){return data[t.optionData.option]?" on ":" off"},left:function(t){return data[t.optionData.option]},onLeft:function(t){data[t.optionData.option]=!1,save()},right:function(t){return!data[t.optionData.option]},onRight:function(t){data[t.optionData.option]=!0,save()}})}function setupMenus(){for(var t in data.menus={title:new Menu({charSelect:!0,y:320,space:32,optionSize:2,options:[new MenuOption({text:function(){return"Continue"},selectable:function(){return saveExists()},onSelect:function(){startGame()}}),new MenuOption({text:function(){return"New Game"},onSelect:function(){resetGame()&&(initialiseGameData(),save(),startGame())}}),new MenuOption({text:function(){return"Options"},onSelect:function(){switchScene("mainmenu")}})]}),main:new Menu({y:64,margin:160,space:32,optionSize:2,options:[new MenuOption({text:function(){return"Resume"},onSelect:function(){switchScene(data.previousScene)}}),new MenuOption({text:function(){return"Restart"},onSelect:function(){startGame()}}),new MenuOption({text:function(){return"Clear Save Data"},selectable:function(){return saveExists()},onSelect:function(){clearSave()}}),!1,new MenuOption({text:function(){return"Sound"},text2:function(){return" ".repeat(4-(10*data.sound+"%").length)+10*data.sound+"%"},left:function(){return data.sound>0},onLeft:function(){data.sound--,save()},right:function(){return data.sound<10},onRight:function(){data.sound++,save()}}),new MenuOption({text:function(){return"Music"},text2:function(){return" ".repeat(4-(10*data.music+"%").length)+10*data.music+"%"},left:function(){return data.music>0},onLeft:function(){data.music--,setVolume(data.music/10),save()},right:function(){return data.music<10},onRight:function(){data.music++,setVolume(data.music/10),save()}}),new ToggleMenuOption("Screenshake","screenshake"),!1,new MenuOption({text:function(){return"¢oil not detected. Enter code?"},altText:function(){return data.menus.main.altText="¢oil"===data.secret?"¢oil account detected":"Patron code entered"},altCheck:function(){return data.secret},selectable:function(){return!data.secret},onSelect:function(){return"alpaca"===prompt("Enter Patron code")&&(data.secret="patron",data.menus.main.update(0)),!1}}),new MenuOption({text:function(){return"Supporter Options"},selectable:function(){return data.secret},onSelect:function(){switchScene("secretmenu",!0)}})]}),secret:new Menu({y:128,margin:64,space:32,optionSize:2,options:[new ToggleMenuOption("Infinite Lives","infiniteLives"),new ToggleMenuOption("Rainbow Dash","rainbowDash"),new ToggleMenuOption("Random Bosses","randBoss"),new ToggleMenuOption("Debug View","debug"),new MenuOption({text:function(){return"Palette"},text2:function(){return" ".repeat(4-(data.palette+"").length)+data.palette},left:function(){return data.palette>0},onLeft:function(){data.palette--,ctx.fonts.palette=data.palette},right:function(){return data.palette<data.palettes.length-1},onRight:function(){data.palette++,ctx.fonts.palette=data.palette}})]}),prestige:new Menu({y:260,margin:64,space:32,optionSize:2,options:[]})},data.unlocks)data.menus.prestige.options.push(new MenuOption({text:function(t){return data.unlocks[t.optionData.id].text},text2:function(t){return"number"==typeof data.unlocks[t.optionData.id].cost?data.unlocks[t.optionData.id].cost+"pts":data.unlocks[t.optionData.id].cost()+"pts"},altCheck:function(t){return!0===data.unlocks[t.optionData.id].unlocked},altText:function(t){return data.unlocks[t.optionData.id].alt},optionData:{id:t},selectable:function(t){return"number"==typeof data.unlocks[t.optionData.id].unlocked?data.score>=data.unlocks[t.optionData.id].cost():!data.unlocks[t.optionData.id].unlocked&&data.score>=data.unlocks[t.optionData.id].cost},onSelect:function(t){"number"==typeof t.cost?(data.score-=t.cost,t.unlocked=!0):(data.score-=t.cost(),t.unlocked++),save()}}));data.menus.prestige.options.push(new MenuOption({text:function(){return"Reincarnate"},onSelect:function(){startGame()}})),data.menus.title.update(0),data.menus.main.update(0)}function drawMenu(t){switch(document.monetization&&"started"===document.monetization.state&&(data.secret="¢oil"),ctx.fillStyle=getColor("fg"),ctx.fonts.current="alphanumeric",t){case"title":ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle=getColor("bg"),ctx.fillRect(32,32,canvas.width-64,canvas.height-64),ctx.fillStyle=getColor("fg"),ctx.drawFontCenter("Heaven Ascent",canvas.width/2,100,6),ctx.drawFontCenter("@dhmstark",canvas.width/2,235,2),ctx.drawFontCenter("js13k 2020",canvas.width/2,260,2),data.menus.title.draw(),ctx.fonts.current="alphanumeric",ctx.fillStyle=getColor("e1"),ctx.drawFontCenter("And there I saw a throne, and surrounding",canvas.width/2,170,2),ctx.drawFontCenter("it, four hundred and four golden stars",canvas.width/2,190,2);break;case"mainmenu":data.menus.main.draw();break;case"secretmenu":ctx.drawFontCenter("Secret "+data.secret+" exclusive options",canvas.width/2,80,2),data.menus.secret.draw();break;case"death":ctx.drawFontCenter("YOU DIED",canvas.width/2,80,8),ctx.drawFontCenter("Score: "+data.score+"/404",canvas.width/2,180,4),data.menus.prestige.draw()}}function setupWorld(){if(data.world=[["8","<","3",">","7"," ","b","<","5",">","c"],[" "," ","^"," "," "," "," "," ","^"," "," "],[" "," ","1","<","<","0",">",">","2"," "," "],[" "," ","v"," "," "," "," "," ","v"," "," "],["9","<","4",">","a"," ","e","<","6",">","d"]],data.bosses={1:{e:1,w1:5,w2:0,i:0},2:{e:3,w1:3,w2:0,i:0},3:{e:2,w1:5,w2:2,i:2},4:{e:2,w1:7,w2:0,i:2},5:{e:4,w1:3,w2:2,i:2},6:{e:4,w1:6,w2:0,i:2},7:{e:3,w1:6,w2:4,i:6},8:{e:3,w1:5,w2:5,i:6},9:{e:4,w1:8,w2:3,i:4},a:{e:4,w1:7,w2:4,i:4},b:{e:6,w1:6,w2:3,i:4},c:{e:6,w1:5,w2:4,i:4},d:{e:6,w1:7,w2:2,i:4},e:{e:6,w1:6,w2:3,i:4},0:{e:6,w1:8,w2:7,i:8}},data.randBoss)for(var t in data.bosses)data.bosses[t].e=Math.ceil(4*Math.random()),data.bosses[t].w1=Math.ceil(8*Math.random()),data.bosses[t].w2=Math.ceil(7*Math.random()),data.bosses[t].i=Math.floor(5*Math.random());for(var e in data.bossRoom={layout:generateLayout({bossRoom:!0}),start:{x:304,y:32},dropDeath:!0,inBossRoom:!1,gameObjects:[]},data.bossRoom.player=new GameObject({symbol:"b",x:data.bossRoom.start.x,y:data.bossRoom.start.y,controlled:!0,color:"p1"}),data.maps=[],data.world)for(var a in data.maps[e]=[],data.world[e])data.maps[e][a]=generateMap(e,a);data.currentMap={y:2,x:5}}function Map(t){this.start=t.start,this.dropDeath=t.dropDeath,this.screenDown=t.screenDown,this.screenUp=t.screenUp,this.screenLeft=t.screenLeft,this.screenRight=t.screenRight,this.layout=t.layout,this.gameObjects=t.gameObjects||[],this.player=t.player}function generateMap(t,e){var a=data.world[t][e],n={x:304,y:32},s={mapType:a,dropDeath:"^v1235".indexOf(a)<0,start:n,gameObjects:[],player:new GameObject({symbol:"b",x:n.x,y:n.y,controlled:!0,color:"p1"})};"<>0234567acd".indexOf(a)>=0&&(s.screenLeft=function(){switchMap(parseInt(t),parseInt(e)-1,"right")}),"<>01345689be".indexOf(a)>=0&&(s.screenRight=function(){switchMap(parseInt(t),parseInt(e)+1,"left")}),"^v1246".indexOf(a)>=0&&(s.screenUp=function(){switchMap(parseInt(t)-1,parseInt(e),"bottom")}),"^v1235".indexOf(a)>=0&&(s.screenDown=function(){switchMap(parseInt(t)+1,parseInt(e),"top")}),s.layout=generateLayout(s);for(var i=[],o=1;o<19;o++)for(var r=1;r<15;r++)s.layout[r]&&s.layout[r][o]&&i.push({x:o,y:r});for(var c=0;c<5;c++){var d=i[Math.floor(Math.random()*i.length)];s.gameObjects.push(new GameObject({symbol:"★",x:32*d.x,y:32*(d.y-2),color:"st"}))}return"0"!=a&&s.gameObjects.push(new GameObject({symbol:"i",x:randBias(4)*canvas.width,y:canvas.height/2,ai:"imp",color:"e1",flight:!0,maxDX:2,maxDY:2,enemy:!0})),"<>^v0".indexOf(a)<0&&(s.gameObjects.push(new GameObject({symbol:"@",x:canvas.width/2-16,y:32*Math.floor(7.5),color:"pt",flight:!0})),s.gameObjects.push(new GameObject({symbol:"i",x:randBias(4)*canvas.width,y:canvas.height/2,ai:"imp",color:"e1",flight:!0,maxDX:2,maxDY:2,enemy:!0}))),new Map(s)}function generateLayout(t){for(var e=[],a=0;a<15;a++)e.push([]);if(t.bossRoom)e[11]=[,,,,,,,1,1,1,1,1,1,,,,,,,];else{switch(t.mapType){case"<":e=linear(e,!0);break;case">":e=linear(e);break;case"^":case"v":e=vertical(e);break;case"0":e[8]=[,,,,,,,,1,1,1,1,,,,,,,,],e[11]=[,,,1,1,1,1,,,,,,,1,1,1,1,,,],e[14]=[1,1,,,,,,,,,,,,,,,,,1,1];break;default:e=vertical(e)}for(a=0;a<15;a++)for(var n=0;n<20;n++)(!t.screenUp&&0==a||!t.screenLeft&&0==n||!t.screenRight&&19==n)&&(e[a][n]=1)}return e}function linear(t,e){var a=14,n=0;if(t[a][0]=1,t[a][19]=1,e)for(s=18;s>0;s--)i(s);else for(var s=1;s<19;s++)i(s);return t;function i(e){var s=Math.ceil(3*Math.random()),i=Math.random()>.5?1:-1;n*Math.random()>1&&(a+s*i<15&&a+s*i>2?(a+=s*i,n=0):a-s*i<15&&a-s*i>2&&(a-=s*i,n=0)),t[a][e]=1,n++}}function vertical(t){t[14]=[1,1,,,,,,,,,,,,,,,,,1,1];for(var e=1;e<=4;e++)for(var a=14-3*e,n=Math.ceil(2*Math.random()),s=0;s<n;s++)for(var i=20/n,o=i*s,r=Math.floor(i*randBias(3+n)+o),c=Math.round(3*Math.random()+4-n),d=Math.floor(c/-2);d<c/2;d++)t[a][r+d]=1;return t}function switchMap(t,e,a){var n=data.maps[t][e],s=getCurrentMap().player,i=n.player;n.start.x="left"==a?-16:"right"==a?624:s.x,n.start.y="top"==a?0:"bottom"==a?448:s.y,(i=s).x=n.start.x,i.y=n.start.y,i.dashing&&(i.dashing.dashFrames=[]),n.player=i,data.currentMap={y:t,x:e},resetParticles()}function GameObject(t){this.symbol=t.symbol,this.font=t.font,this.color=t.color,this.controlled=t.controlled,this.x=t.x,this.y=t.y,this.dx=t.dx||0,this.dy=t.dy||0,this.ddx=0,this.ddy=0,this.maxDX=t.maxDX||data.maxDX,this.maxDY=t.maxDY||data.maxDY,this.facing=t.facing||1,this.falling=0,this.enemy=t.enemy,this.flight=t.flight,this.ai=t.ai,this.id=Math.floor(1e4*Math.random()),this.collides=void 0===t.collides||t.collides,this.update=function(){this.iFrames&&this.iFrames--,this.y>960&&(this.cull=!0),this.left=this.right=this.up=this.down=this.dash=!1,this.controlled&&!this.dashing&&(this.left=data.keys.ArrowLeft,this.right=data.keys.ArrowRight,this.up=data.keys.ArrowUp,this.down=data.keys.ArrowDown,this.dash=data.keys.KeyZ,this.attack=data.keys.KeyX,this.dashed&&(this.dash=!1)),this.ai&&data.aiDefs[this.ai](this);var t=this.dx<0,e=this.dx>0,a=this.falling;if(this.ddx=0,this.flight||this.dashing?this.ddy=0:this.ddy=.9,this.dash&&data.unlocks.dash.unlocked&&!this.dashing){var n=0;this.left&&n--,this.right&&n++;var s=0;this.up&&s--,this.down&&s++,(n||s)&&(this.dashing={dx:n,dy:s,frameCount:0,dashFrames:[]},this.dashed=!0,playSFX("dash"))}if(this.dashing?(this.dashing.dashFrames.push({x:this.x+0,y:this.y+0,frameNumber:this.dashing.frameCount+0}),this.dx=25*this.dashing.dx,this.dy=25*this.dashing.dy,this.dashing.frameCount++,this.dashing.frameCount>=6&&(this.dashing=!1,this.dx=0,this.dy=0)):(this.left?(this.ddx-=this.maxDX/20,this.facing=-1):t&&(this.jumping||a?this.ddx+=this.maxDX/60:this.ddx+=this.maxDX/10),this.right?(this.ddx+=this.maxDX/20,this.facing=1):e&&(this.jumping||a?this.ddx-=this.maxDX/60:this.ddx-=this.maxDX/10),this.up&&(!this.flight&&!this.jumping&&a<10?(this.ddy-=50,this.jumping=!0,playSFX("jump")):this.jumping?(this.ddy-=.4,data.unlocks.glide.unlocked&&this.dy>0&&(this.ddy-=.4)):this.flight&&(this.ddy-=this.maxDY/20)),this.down&&this.flight&&(this.ddy+=this.maxDY/20)),this.attack&&!this.attacking){var i=this.facing,o=this.down?1:this.up?-1:0;this.attacking={dx:i,dy:o,frameCount:0},data.keys.KeyX=!1,playSFX("attack")}else this.attacking&&(this.attacking.frameCount++,this.attacking.frameCount>=24&&(this.attacking=!1));if(this.y=Math.floor(this.y+this.dy),this.x=Math.floor(this.x+this.dx),this.dx=this.dx+this.ddx,this.dashing||(this.dx>this.maxDX&&(this.dx=this.maxDX),this.dx<-1*this.maxDX&&(this.dx=-1*this.maxDX),this.dy=this.dy+this.ddy,this.dy>this.maxDY&&(this.dy=this.maxDY),this.dy<-1*this.maxDY&&(this.dy=-1*this.maxDY)),(t&&this.dx>0||e&&this.dx<0)&&(this.dx=0),this.collides){var r=Math.floor(this.y/32),c=Math.floor(this.x/32),d=this.y%32,h=this.x%32,l=getCurrentMap(),u=!l.layout[r]||l.layout[r][c];c<0&&(u=!0);var f=!l.layout[r]||l.layout[r][c+1];c+2>20&&(f=!0);var m=!l.layout[r+1]||l.layout[r+1][c];c<0&&(m=!0);var p=!l.layout[r+1]||l.layout[r+1][c+1];c+2>20&&(p=!0),this.dy>0?(m&&!u||p&&!f&&h)&&(r+1>=15&&l.dropDeath?this.controlled?(this.x=l.start.x,this.y=l.start.y,this.dx=0,this.dy=0,damage(this,1),this.iFrames=data.bossRoom.inBossRoom?45:30):this.enemy?this.dy=0:this.cull=!0:this.controlled&&r+1>=15&&l.screenDown?l.screenDown():(this.y=32*r,this.dy=0,this.falling=0,this.jumping=!1,data.keys.Space||(this.dashed=!1),d=0)):this.dy<0&&(u&&!m||f&&!p&&h)&&(this.controlled&&r<0&&l.screenUp?l.screenUp():p||(this.y=32*(r+1),this.dy=0,u=m,f=p,d=0)),this.dx>0?(f&&!u||p&&!m&&d)&&(this.controlled&&c+1>=20&&l.screenRight?this.x>=624&&l.screenRight():(this.x=32*c,this.dx=0,h=0)):this.dx<0&&(u&&!f||m&&!p&&d)&&(this.controlled&&c<0&&l.screenLeft?this.x<-16&&l.screenLeft():(this.x=32*(c+1),this.dx=0,h=0))}(this.falling=m||h&&p?0:this.falling+1,this.attacking&&this.attacking.frameCount<12&&checkAttack(this),this.controlled)&&getObjArr().forEach(t=>{data.collisionTypes[t.symbol]&&this.x<=t.x+32&&this.x+32>=t.x&&this.y<=t.y+32&&this.y+32>=t.y&&data.collisionFunctions[data.collisionTypes[t.symbol]](this,t)})},this.draw=function(){if(!this.iFrames||this.iFrames%4){if(ctx.fonts.current=this.font||"gameObjects",ctx.fillStyle=getColor(this.color),ctx.save(),this.controlled){ctx.translate(Math.round(this.x+16),Math.round(this.y+16)),ctx.scale(this.facing,1);var t=!1;data.unlocks.dash&&this.dy<0&&(t="d"),data.unlocks.dash&&this.dy>0&&(t="u"),data.unlocks.dash&&0==this.dy&&(t="w"),drawCharacter(this,t),data.debug&&this.attacking&&this.attacking.frameCount<12&&(ctx.strokeStyle="limegreen",ctx.strokeRect(0,22*this.attacking.dy-22,44,44))}else"i"===this.symbol&&this.ai?(ctx.translate(this.x+16,this.y+16),ctx.scale(this.facing,1),drawImp()):(ctx.translate(Math.round(this.x)+16,Math.round(this.y)+16),ctx.scale(this.facing,1),"@"==this.symbol&&ctx.rotate(Math.PI/2*(Math.floor(data.timer/10)%4+1)),ctx.drawFont(this.symbol,-16,-16,4));if(ctx.restore(),this.dashing)for(var e in this.dashing.dashFrames){var a=this.dashing.dashFrames[e];ctx.fillStyle=data.rainbowDash?"hsl("+Math.floor(60*a.frameNumber)+",50%,50%)":getColor("p2"),ctx.save(),ctx.translate(a.x+16,a.y+16),ctx.scale(this.facing,1),ctx.drawFont(this.symbol,-16,-16,4),ctx.restore()}}data.debug&&(ctx.fillStyle="limegreen",ctx.strokeStyle="limegreen",ctx.fillRect(this.x-2,this.y-2,4,4),ctx.beginPath(),ctx.moveTo(this.x+16,this.y+16),ctx.lineTo(this.x+32*this.dx/2+16,this.y+32*this.dy/2+16),ctx.stroke())}}function drawCharacter(t,e,a,n){e&&(ctx.fillStyle=getColor("p2"),ctx.drawFont(e,0,-24,4),ctx.scale(-1,1),ctx.drawFont(e,0,-24,4),ctx.scale(-1,1)),t.attacking&&drawPlayerSword(t.attacking),ctx.fillStyle=getColor("bg"),ctx.fillRect(-4,-4,12,8),ctx.fillStyle=getColor("p1"),t.attacking?ctx.drawFont("k",-16,-16,4):ctx.drawFont("a",-16,Math.round(data.timer/30)%2*4-16,4),ctx.drawFont("t",-16,-16,4),ctx.drawFont("h",-16,-16,4)}function drawPlayerSword(t){t.frameCount<12&&(ctx.save(),ctx.rotate(Math.PI/4*t.dy),ctx.fillStyle=getColor("p3"),ctx.beginPath(),ctx.lineTo(Math.sin(Math.PI*(t.frameCount-4)/12),Math.cos(Math.PI*(t.frameCount-4)/12)),ctx.arc(16,0,32,Math.PI*t.frameCount/12-Math.PI/2,Math.PI*(t.frameCount-2)/12-Math.PI/2,!0),ctx.lineTo(0,0),ctx.fill(),ctx.restore())}function drawImp(t){ctx.fillStyle=getColor("e2"),t||(t=Math.round(data.timer/30)%2?"d":"w"),ctx.drawFont(t,0,-24,4),ctx.scale(-1,1),ctx.drawFont(t,0,-24,4),ctx.scale(-1,1),ctx.fillStyle=getColor("e1"),ctx.drawFont("i",-16,-16,4),ctx.fillStyle=getColor("e3"),ctx.drawFont("/",Math.round(data.timer/30)%2*4-16,-16,4)}function checkAttack(t){var e=getObjArr();for(var a in e){var n=e[a];if(n.enemy){var s=[{x:n.x+16,y:n.y-16},{x:n.x-16,y:n.y-16},{x:n.x+16,y:n.y+16},{x:n.x-16,y:n.y+16}];for(var i in s){var o=s[i],r=(o.x-t.x)*t.attacking.dx,c=o.y-t.y;if(r>0&&r<=44&&c>22*t.attacking.dy-22&&c<22+22*t.attacking.dy)return killEnemy(t,n),data.hitstop=data.bossRoom.inBossRoom?2:4,!1}}}}function damage(t,e){return!(t.iFrames>0)&&(data.screenShake=10,data.infiniteLives||(data.life-=e),playSFX("damage"),!0)}function killEnemy(t,e){if(e.cull=!0,playSFX("kill"),"i"===e.symbol){var a=getCurrentMap();data.unlocks.reaper.unlocked&&!data.finalBoss&&a.gameObjects.push(new GameObject({symbol:"★",x:e.x,y:e.y,color:"st"})),a.gameObjects.push(new GameObject({symbol:"!",color:"e2",x:e.x,y:e.y,dx:6.25*t.attacking.dx,collides:!1}))}}function enterBoss(t){var e=data.bossRoom,a=e.player;if(e.inBossRoom=t,a.x=e.start.x,a.y=e.start.y,a.dx=0,a.dy=0,data.bosses[t].i)for(var n=0;n<data.bosses[t].i;n++)e.gameObjects.push(new GameObject({symbol:"i",x:Math.random()>.5?0:canvas.width-32,y:randBias(3)*canvas.height,ai:"imp",color:"e1",flight:!0,maxDX:2,maxDY:2,enemy:!0}));spawnBoss(),e.roomCheck=function(t){t.boss||t.gameObjects.some(t=>"@"===t.symbol)||t.gameObjects.some(t=>"★"===t.symbol)||t.gameObjects.push(new GameObject({symbol:"@",x:canvas.width/2-16,y:32*Math.floor(7.5),color:"pt",flight:!0}))},diesIraeGenerated&&(stopMusic(),playMusic("diesIrae",!0))}function leaveBoss(){data.finalBoss&&"0"===data.bossRoom.inBossRoom&&switchScene("end"),data.bossRoom.inBossRoom=!1,getCurrentMap().player.dx=data.bossRoom.player.dx,getCurrentMap().player.dy=data.bossRoom.player.dy,stopMusic(),playMusic("mainTheme",!0)}function Component(t){this.id=Math.floor(1e3*Math.random()),this.type=t.type,this.dirX=t.dirX||0,this.dirY=t.dirY||0,this.offset=t.offset,this.x=32*t.offset.x,this.y=32*t.offset.y,this.gameObjects=[]}function spawnBoss(){var t=data.bossRoom,e={x:canvas.width/2-16,y:-160,dx:0,dy:0,timer:50*Math.PI,components:[],ai:bossAI,draw:function(t){t.components.forEach(t=>{if("eye"===t.type)switch(Math.floor((data.timer+t.id)/10)%16){case 0:case 3:t.gameObjects[0].symbol="e";break;case 1:case 2:t.gameObjects[0].symbol="u";break;default:t.gameObjects[0].symbol="o"}t.gameObjects.forEach(t=>t.draw())})}},a=data.bosses[t.inBossRoom],n=0;if(a.e<2)e.components.push(new Component({type:"eye",offset:{x:0,y:0}}));else for(n++,i=0;i<a.e;i++)e.components.push(new Component({type:"eye",offset:{x:n*Math.cos(i/a.e*2*Math.PI),y:n*Math.sin(i/a.e*2*Math.PI)}}));for(n+=2,i=(a.w1-1)/-2;i<=(a.w1-1)/2;i++){var s=n*Math.cos(i/(a.w1+2)*Math.PI),o=n*Math.sin(i/(a.w1+2)*Math.PI);Math.sin(i/(a.w1+2)*Math.PI)<Math.sin(Math.PI/-4)?(e.components.push(new Component({type:"wing3",dirX:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing3",dirX:-1,offset:{x:-1*s,y:o}}))):Math.sin(i/(a.w1+2)*Math.PI)<Math.sin(Math.PI/4)?(e.components.push(new Component({type:"wing2",dirX:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing2",dirX:-1,offset:{x:-1*s,y:o}}))):(e.components.push(new Component({type:"wing1",dirX:1,dirY:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing1",dirX:-1,dirY:1,offset:{x:-1*s,y:o}})))}for(n+=2,i=(a.w2-1)/-2;i<=(a.w2-1)/2;i++){s=n*Math.cos(i/(a.w2+2)*Math.PI),o=n*Math.sin(i/(a.w2+2)*Math.PI);Math.sin(i/(a.w1+2)*Math.PI)<Math.sin(Math.PI/-4)?(e.components.push(new Component({type:"wing3",dirX:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing3",dirX:-1,offset:{x:-1*s,y:o}}))):Math.sin(i/(a.w1+2)*Math.PI)<Math.sin(Math.PI/4)?(e.components.push(new Component({type:"wing2",dirX:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing2",dirX:-1,offset:{x:-1*s,y:o}}))):(e.components.push(new Component({type:"wing1",dirX:1,dirY:1,offset:{x:s,y:o}})),e.components.push(new Component({type:"wing1",dirX:-1,dirY:1,offset:{x:-1*s,y:o}})))}e.components.forEach(t=>{var a={font:"boss",x:e.x+32*t.offset.x,y:e.y+32*t.offset.y,color:"e1",flight:!0,maxDX:2,maxDY:2,enemy:!0};switch(t.type){case"eye":a.symbol="o",t.gameObjects.push(new GameObject(a));break;case"wing1":a.facing=-1*t.dirX,a.symbol="r",t.gameObjects.push(new GameObject(a)),a.symbol="l",a.y+=32*t.dirY,t.gameObjects.push(new GameObject(a));break;case"wing2":a.facing=-1*t.dirX,a.symbol="-",t.gameObjects.push(new GameObject(a)),a.symbol="/",a.x+=32*t.dirX,t.gameObjects.push(new GameObject(a));break;case"wing3":a.facing=-1*t.dirX,a.symbol="_",t.gameObjects.push(new GameObject(a)),a.symbol="=",a.x+=32*t.dirX,t.gameObjects.push(new GameObject(a))}}),data.bossRoom.boss=e}function bossAI(t){if(t.timer++,!t.components.some(t=>"eye"===t.type))return data.bossRoom.boss=!1;var e=canvas.width/2+400*Math.sin(t.timer/100),a=160+300*Math.cos(t.timer/50),n=t.x<e?1:-1,s=t.y<a?1:-1;t.x+=n,t.y+=s,t.components.forEach(e=>{e.gameObjects.forEach(t=>{t.cull&&(e.cull=!0),t.x+=n,t.y+=s}),e.cull&&!data.finalBoss&&data.bossRoom.gameObjects.push(new GameObject({symbol:"★",x:t.x+32*e.offset.x,y:t.y+32*e.offset.y,color:"st"}))})}let zzfx,zzfxV,zzfxX;function playSFX(t){data.sound&&(zzfxV=data.sound/10,data.sfxDefs[t](data.sound))}function defineSounds(){data.sfxDefs={collect:function(t){zzfx(...[t,0,1620,,.03,.18,,1.26,,,840,.05,,,,,,.92,.08])},jump:function(t){zzfx(...[t,,,.01,,.34,,1.56,1,,,,,,,,,.66,.02])},dash:function(t){zzfx(...[t,0,4e3,.04,.02,0,4,2.18,1.1,,-624,.02,,,,,.07,.37])},damage:function(t){zzfx(...[t,,325,.2,,0,3,.82,-15,78,-50,,,,,-.1,,.36,.01])},attack:function(t){zzfx(...[t,,1,.05,.02,.05,,,45,3,,,,1.5,1])},kill:function(t){zzfx(...[t,,306,,,.49,3,1.12,.9,,,,,,,.4,.1,.65])}}}initialiseGameData(),zzfxV=.3,zzfx=((t=1,e=.05,a=220,n=0,s=0,i=.1,o=0,r=1,c=0,d=0,h=0,l=0,u=0,f=0,m=0,p=0,x=0,w=1,g=0,y=44100,b=99+n*y,v=s*y,M=i*y,k=g*y,S=x*y,C=2*Math.PI,O=(t=>0<t?1:-1),D=b+k+v+M+S,R=(c*=500*C/y**2),j=(a*=(1+2*e*Math.random()-e)*C/y),F=O(m)*C/4,I=0,z=0,P=0,G=0,X=0,L=0,T=1,B=[],A=zzfxX.createBufferSource(),E=zzfxX.createBuffer(1,D,y))=>{for(A.connect(zzfxX.destination);P<D;B[P++]=L)++X>100*p&&(X=0,L=I*a*Math.sin(z*m*C/y-F),L=O(L=o?1<o?2<o?3<o?Math.sin((L%C)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/C%2+2)%2:1-4*Math.abs(Math.round(L/C)-L/C):Math.sin(L))*Math.abs(L)**r*t*zzfxV*(P<b?P/b:P<b+k?1-(P-b)/k*(1-w):P<b+k+v?w:P<D-S?(D-P-S)/M*w:0),L=S?L/2+(S>P?0:(P<D-S?1:(P-D)/S)*B[P-S|0]/2):L),I+=1-f+1e9*(Math.sin(P)+1)%2*f,z+=1-f+1e9*(Math.sin(P)**2+1)%2*f,a+=c+=500*d*C/y**3,T&&++T>l*y&&(a+=h*C/y,j+=h*C/y,T=0),u&&++G>u*y&&(a=j,c=R,G=1,T=T||1);return E.getChannelData(0).set(B),A.buffer=E,A.start(),A}),zzfxX=new(window.AudioContext||webkitAudioContext);var music=[],mainThemePlayer=new CPlayer;mainThemePlayer.init(mainTheme);var diesIraePlayer=new CPlayer;function checkMusicGenerated(){!window.mainThemeGenerated&&mainThemePlayer.generate()>=1&&(mtwave=mainThemePlayer.createWave(),music.mainTheme=document.createElement("audio"),music.mainTheme.src=URL.createObjectURL(new Blob([mtwave],{type:"audio/wav"})),music.mainTheme.loop=!0,window.mainThemeGenerated=!0),!window.diesIraeGenerated&&diesIraePlayer.generate()>=1&&(diwave=diesIraePlayer.createWave(),music.diesIrae=document.createElement("audio"),music.diesIrae.src=URL.createObjectURL(new Blob([diwave],{type:"audio/wav"})),music.diesIrae.loop=!0,window.diesIraeGenerated=!0),window.mainThemeGenerated&&window.diesIraeGenerated&&(window.musicGenerated=!0)}function playMusic(t,e){data.music&&(e&&(music[t].currentTime=0),music[t].play())}function setVolume(t){var e=data.bossRoom.inBossRoom?"diesIrae":"mainTheme";for(var a in stopMusic(e),music)music[a].volume=t;data.music&&playMusic(e)}function stopMusic(t){if(t)music[t].pause();else for(var e in music)music[e].pause()}function load(){var t=localStorage.getItem(data.lskey);if(t){var e=JSON.parse(t);if(e)for(var a in data.sound=e.sound,data.music=e.music,data.screenshake=e.screenshake,e.unlocks)data.unlocks[a].unlocked=e.unlocks[a].unlocked;return e}return!1}function saveExists(){return!!localStorage.getItem(data.lskey)}function save(){var t={sound:data.sound,music:data.music,screenshake:data.screenshake,unlocks:data.unlocks};return localStorage.setItem(data.lskey,JSON.stringify(t)),saveExists()}function clearSave(){confirm("Really delete save?")&&localStorage.removeItem(data.lskey)}function setup(){load(),window.canvas=document.getElementById("canvas"),window.ctx=canvas.getContext("2d"),canvas.width=640,canvas.height=480,registerFontFunctions(ctx),registerFonts(ctx),defineSounds(),setupData(),setupMenus(),resetParticles(),document.body.onkeydown=function(t){t.repeat||(data.keys[t.code]=!0,handleKeyPress(t))},document.body.onkeyup=function(t){data.keys[t.code]=!1},gameLoop()}function gameLoop(){window.requestAnimationFrame(gameLoop);var t=(new Date).getTime(),e=t-data.lastTime;e>50/3&&(data.timer++,window.musicGenerated||checkMusicGenerated(),handleScene(),data.lastTime=t-e%50/3)}function handleScene(){switch(data.scene){case"game":if(data.hitstop)return data.hitstop--;handleObjects(),cullObjects(),checkGameState(),clear(),ctx.save(),handleScreenShake(),drawBG(),drawMap(),drawObjects(),ctx.restore(),drawUI();break;case"end":drawEnd();break;case"death":case"title":case"mainmenu":case"secretmenu":case"credits":clear(),drawMenu(data.scene)}}function handleObjects(){var t=getCurrentMap();t.roomCheck&&t.roomCheck(t),t.gameObjects.forEach(t=>t.update()),data.bossRoom.boss&&data.bossRoom.boss.ai(data.bossRoom.boss),t.player.update()}function cullObjects(){var t=getCurrentMap();t.gameObjects=t.gameObjects.filter(t=>!t.cull),data.bossRoom.boss&&(data.bossRoom.boss.components=data.bossRoom.boss.components.filter(t=>!t.cull))}function checkGameState(){data.life<=0&&(switchScene("death"),data.menus.prestige.selected=0,data.menus.prestige.update(0)),data.score>=404&&!data.maps[2][5].gameObjects.some(t=>"@"===t.symbol)&&!data.finalBoss&&(data.finalBoss=!0,data.maps[2][5].gameObjects.push(new GameObject({symbol:"@",x:canvas.width/2-16,y:192,color:"st",flight:!0})))}function startGame(){setupData(),switchScene("game"),stopMusic(),setVolume(data.music/10),playMusic("mainTheme",!0)}function resetGame(){return!saveExists()||confirm("Are you sure you wish to reset your progress?")}function switchScene(t,e){e||(data.previousScene=data.scene+""),data.scene=t}function getColor(t){return data.palettes[data.palette][t]}function clear(){ctx.fillStyle=getColor("bg"),ctx.fillRect(0,0,canvas.width,canvas.height)}function handleScreenShake(){data.screenShake&&(ctx.translate(Math.round(Math.sin(data.screenShake)*data.screenShake),Math.round(Math.cos(data.screenShake)*data.screenShake/2)),data.screenShake--)}function Particle(t){this.x=4*Math.floor(Math.random()*canvas.width/4),this.y=t||Math.random()*canvas.height,this.w=1.5*(Math.random()/2+.5),this.s=4*Math.round(3*Math.random())}function resetParticles(){data.particles=[];for(var t=0;t<20;t++)data.particles.push(new Particle)}function drawBG(){var t=ctx.createLinearGradient(0,0,0,canvas.height);t.addColorStop(0,getColor("bg")),t.addColorStop(1,data.bossRoom.inBossRoom?getColor("e1"):getColor("fg")),ctx.fillStyle=t,data.particles.forEach(t=>{t.y-=t.w,t.y<0&&(t.y+=canvas.height),ctx.fillRect(t.x,t.y,t.s,t.s)})}function drawMap(){var t=getCurrentMap();if(ctx.fillStyle=getColor("fg"),ctx.fonts.current="gameObjects",t.dropDeath)for(var e=0;e<20;e++)ctx.drawFont("^",32*e,canvas.height-32,4);for(var a in t.layout)for(var n in t.layout[a])ctx.fillRect(32*n,32*a,32,32)}function drawObjects(){var t=getCurrentMap();t.gameObjects.forEach(t=>t.draw()),data.bossRoom.boss&&data.bossRoom.boss.draw(data.bossRoom.boss),t.player.draw()}function drawUI(){ctx.strokeStyle=getColor("fg"),ctx.lineWidth=4,ctx.fonts.current="alphanumeric",ctx.save(),ctx.translate(canvas.width-(32+ctx.lineWidth),32+ctx.lineWidth);var t=data.score.toString().length+4;ctx.fillStyle=getColor("bgt"),ctx.fillRect(-1*t*6*4-24,4,6*t*4+20,44),ctx.strokeRect(-1*t*6*4-24,4,6*t*4+20,44),ctx.fillStyle=getColor("fg"),ctx.drawFontRight(data.score+"/404",-8,12,4),ctx.restore(),ctx.save(),ctx.translate(32+ctx.lineWidth,32+ctx.lineWidth);var e=2+data.life.toString().length;if(ctx.fillStyle=getColor("bgt"),ctx.fillRect(4,4,6*e*4+16,44),ctx.strokeRect(4,4,6*e*4+16,44),ctx.fillStyle=getColor("fg"),ctx.drawFont("  "+data.life,12,12,4),ctx.fillStyle=getColor("ht"),ctx.drawFont("♥",12,12,4),ctx.restore(),!data.finalBoss&&"0"===data.world[data.currentMap.y][data.currentMap.x]){ctx.fillStyle=getColor("fg");var a=canvas.width/4;ctx.drawFontCenter("move",a,112,4),ctx.drawFontCenter(" ↑ ",a,144,4),ctx.drawFontCenter("←↓→",a,176,4),a+=canvas.width/2,ctx.drawFontCenter("attack",a,112,4),ctx.drawFontCenter("x",a,176,4),data.unlocks.dash.unlocked&&(a-=canvas.width/4,ctx.drawFontCenter("dash",a,112,4),ctx.drawFontCenter("z",a,176,4))}}function drawEnd(){clear(),drawBG(),ctx.fillStyle=getColor("fg"),ctx.drawFontCenter("And at the throne of heaven",canvas.width/2,64,2),ctx.drawFontCenter("she stood triumphant",canvas.width/2,96,2),ctx.drawFontCenter("Upon her brow, a crown of four hundred and four",canvas.width/2,160,2),ctx.drawFontCenter("stars shining brighter than the heavens",canvas.width/2,192,2),ctx.drawFontCenter("In her right hand, the stolen flaming sword",canvas.width/2,256,2),ctx.drawFontCenter("that cast all before her into darkness",canvas.width/2,288,2),ctx.drawFontCenter("And on her lips, a single phrase...",canvas.width/2,352,2),ctx.drawFontCenter('"God is thy law, but thou not mine."',canvas.width/2,384,2)}function handleKeyPress(t){if("title"==data.scene){switch(t.code){case"ArrowUp":data.menus.title.update(-1);break;case"ArrowDown":data.menus.title.update(1);break;case"Escape":switchScene("mainmenu");break;case"Enter":data.menus.title.options[data.menus.title.selected].onSelect()}return!1}if("mainmenu"==data.scene){var e=data.menus.main.options[data.menus.main.selected];switch(t.code){case"ArrowUp":data.menus.main.update(-1);break;case"ArrowDown":data.menus.main.update(1);break;case"ArrowLeft":e.left&&e.left(e)&&e.onLeft(e);break;case"ArrowRight":e.right&&e.right(e)&&e.onRight(e);break;case"Escape":switchScene(data.previousScene);break;case"Enter":e.onSelect()}return!1}if("secretmenu"==data.scene){e=data.menus.secret.options[data.menus.secret.selected];switch(t.code){case"ArrowUp":data.menus.secret.update(-1);break;case"ArrowDown":data.menus.secret.update(1);break;case"ArrowLeft":e.left&&e.left(e)&&e.onLeft(e);break;case"ArrowRight":e.right&&e.right(e)&&e.onRight(e);break;case"Escape":switchScene("mainmenu",!0)}return!1}if("death"==data.scene){e=data.menus.prestige.options[data.menus.prestige.selected];switch(t.code){case"ArrowUp":data.menus.prestige.update(-1);break;case"ArrowDown":data.menus.prestige.update(1);break;case"Enter":e.onSelect(!!e.optionData&&data.unlocks[e.optionData.id]),data.menus.prestige.update(0)}}switch(t.code){case"Escape":switch(data.scene){case"game":case"death":case"credits":switchScene("mainmenu");break;case"mainmenu":switchScene(data.previousScene);break;case"end":switchScene("title"),data.finalBoss=!1}}}function getObjArr(){var t=getCurrentMap().gameObjects;return data.bossRoom.boss&&data.bossRoom.boss.components.forEach(e=>{t=t.concat(e.gameObjects)}),t}function getCurrentMap(){return data.bossRoom.inBossRoom?data.bossRoom:data.maps[data.currentMap.y][data.currentMap.x]}function randBias(t){for(var e=0,a=0;a<t;a++)e+=Math.random();return e/t}diesIraePlayer.init(diesIrae),setup();</script></body></html>