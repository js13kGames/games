<!doctype html><title>BACK</title><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=no"><meta name=monetization content=$coil.xrptipbot.com/IxoV1cY-T5uScOX--Vz-gg><style>body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#000;color:#fff;cursor:crosshair}#game{display:none;margin:0 auto;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated;background:#c96}</style><canvas id=game></canvas><script src=map.js></script><script>!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARAAAAA4BAMAAADHrLrJAAAAD1BMVEUAAAAAAABeXl6wsLD////RGX2eAAAAAXRSTlMAQObYZgAACQFJREFUWMOMVwt23CAMJGoOUKs9AAgfoAs+QF/s+5+pM0KYl335VN61kAzSMJLZJKX0iiv9TUkswyplg5RsySxBtiEYS0pwig4HJ8BlWwimmt3rVSVLTjnWw2YssZRLmQEFT7Pc61+BgxdDMJIpYGChGj4zUFElToNTCkwPbZrNdAGRUnIiMs4wXmZzfTHC8PW6qUPLGJuujfwNAQKIJSbyQBTLsSOkgOWuTSP2cCwggvWEM9Koy1hfYBMnxSlbGdb667peL4jQhz059cpAVDqphR+C0b1UwxEyEiGfemYL/Gsjhtn4zNJqyL3+IIrzOgZlyho6tTPA1FIGBqFFl+slyRz5ZERZT9oY087BxNpIJFqMHCeQHFdMiGbUu5J+h23DxnofRIHWQDwwm2wAj3CTEYNfmdYCygoQQE7gOCGisQVMe2KEYr48GFmiNzezpKkMDRc3kGezS6T3OIvQskpD6cchixHWL0eTwYoev3fu2d+F02AEhq8vsYFglJJlgF49Et/FSAcdvffZI1LeM0Fj9IhOx4KwdDGljp1rAFiAwEQwB71EF5Beuwtrz4U2e3roRa3Ot277UGaPmY5pE0Bs5GbUYH4kCRhqbb3aNmpagmKargv16pE48O78TnH4g5EJgBxNQFme35onQKlRemsWTWrjAJnEzEBmwWP9hBFPtHZ+M7LOkZFaqD6QVEMCQLM4U4OYtsW5ItCUGpniwBt6NmHR+7fmuUeeGXmWZEhtIKSa5297ByTTpi5XaGuiQ+StLLGyJJrcd4wnT2+NsZmDqo+BOI6K20kAe5NezK49W9lL2Ts00uHhbsVdAqCc6dduNgbQkfiDt8a5m0zIp4xMOYGmAwhy9trz3s5mrWfcT3s7894B92xv8BMWZu4Ndjv3DtvAk8Y5NAHouxJJjKD1SyA7Y9bakIhAYPUdjtbpACDpe++V49Ovt97bWbubve+H6TovoNI6hxZT0dRfM1INuQGkAkZ7qw4EaTIS9QaXnAOI0Bxg8Q0gGMy3ZjGyPTNSRsLvShN7dfpBCJOyRMxLYwcHsOtOc68BBLPpxbNka+cKHefmOln/l5GdcVvNiMrguTXDqGfwYACWgYD5GrFEbTi1NtypmUDvHlklieMvTyLsux4Rbre1LIiKQUJyXqn2TghZ4CUNgt7kDPYUAexBWfRIHCT3WxP5ww2h/hqIORU5GcnO6fT4GUBGiQQmfWxazjgb7m2gpkvK6oXokSiRy/r11m+AJIxQhQSN3Cl1KINutVmt8LM41o2PCQTFIocwMMF6FV09sprU5t+sKkX9CfR3QJL4Pf6vMKgEnYUjd0tOMQ2SoXFhrnC2xK+3vfut0XWyyoT2GSMpuZoS9tIv20+/PetECeQp57VcEpANG2DfB+aqJddfV9P7wk7jeOKy1hqTWafeOty4PWuCkN6RC5lbW+FLLirqlCqM8BJ87cUHA9DrVY/LTXgpWq/WygSA/BUdAFuH9j8BUN1nTRD1OFuqNdd6sojOjPxSsZdHlg28iCqLm0nMr8dxPDYm7I2Kr389U/p9bgHEwEgZADp1O6724PzjhFar29asQD+op10v9Cy+cgD/0RtocWZKU/76ZnzEiEaULIH47fF4VOz013nqln6gELW2Py+IQYKQ2OVf8VWU5TYIA7HbA4DIASK5B6ghB2hq7n+mzghckrxuXz82r7LLEIJhOtLgTQSB2g7fGAzwGYZo1aKUerlDGmCWTLyldGwgclRE2Y4DM7erKwNYk+Uq4nmBab1SqEjWVOsuMWSE1PjFX/nluhwvRMR8Z6DxgHBiLBKUw+XutbEfeya2+6XVhASTx3W93TgvUI7CFJgi0263XKSXL0GiSBHZl5IriMZiJmL2SMRNNQmAESIuDlCmXlq7V+B+lEx0InGtNyoWAmbdULM8aAgrLZzgbhhWXZGg+5VEoMmWNKtCTtn7L1CVSUSRiSqTwG5etYvDn4i4QjEwg901NypCSQhauYMKysOb7p5rSGFBakKSiK9r/8EoyYlY9y+0hlaTQBVPVXCwmZpOJJ2f4V1GgSQAFAe1gWvEJFF1LQK3pNM9tI2lHKEMCcVEIgwM6/B3bhW2+k0g7wBlzhwfilXUcb/cM3wN79I1AYLU2ygSgCSxhEspBi7eLFjaZjFIQkLAJfXww9HDf6DFMAlgJYoFAD7ZN3dsDbjW1mCzEmCbevg5stE1CSmp4q8FioEYXDLPqi2SEPE3EcZ0jcZBgCNgphjXBIwfHWh0DU8auKYU3BRkBZit2chgDdpdg+wYBeHatK8STyLz0BcTZ3ISwEbDzh760RHPzKA6eKpuLkXAv6ufI8Ilgl55jrh5jQdaP953EiKGU5BJRAVk9CQAKzueBBNRLb0iS9Sq9eOjrIESMLREPJMkqPSTNbg6YRkeHYQg+bMgNMeeEsXm+kbXEAcR4aIIS6+40jHWvcK9zqBRjElZr67GSyQSIo6X34xlvENOAiGDAgmpOZEP/www8+359n0KczZs3S3/Hp7ySYBEjZiIEkMNnx/TszOGPVwpNfVkpV67Pv6lfQ+fHotUjZPQJGLRCSD9ExdzQW7tCJ8eokmUnXy7z9S4ScgSyG8dx/h7iCybmBbuWewbYBCR5ERoHU+JEH1c7D2pyftWS9676pMIQlNHEnCDnp+BbyjWDOvzVUyDqD4U8Fmsjg5xjiPeQEQ3J7InAbyaieiEHsffEEvdikCTuBwbtInhf8VSpAg0iUvJm5Y0f+Z8Zcs7/PjaWmij5c2+tz44vg1f2UGLG+CdMXO2zcfnjZFJhNcWs5Zc8igSX8MXY4NNAIjnNeaev2f2OT7/R8NzLzM5ZfQxi9zxv3wkYlLTz0vJVXtuSON88AefaLz5EDp9JXZC74x+a4MIkMCYLFydJyIkwZFJZFO1kqAG7jqI+FTPC3q9PS/PxdSfLUdfFWGnDaYIX4qXa9HXn4IwMliI6qKH52YQcdnGemNbEmL719TMwacJjeyeiLAd1FlY4CMl+Rmfi/Ia9GYVjozwRreN7DwVawizWM/OLNbz22kACnHyau0kspiBRwyLgMr+n+zb2CQGcAEMHr8APUpSJ9zbvk0AAAAASUVORK5CYII="},function(t){t.exports=JSON.parse('{"cave":[0,0],"hero":[0,24],"font":[0,48],"item":[64,24],"splash":[112,24],"worm":[160,24],"runner":[208,24],"plasma":[64,40],"camp":[231,40],"hole":[240,24],"shot":[247,40],"grenade":[256,24]}')},function(t,e,s){"use strict";s.r(e),s(0),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;const i=new AudioContext,h={},r={},o={c:0,db:1,d:2,eb:3,e:4,f:5,gb:6,g:7,ab:8,a:9,bb:10,b:11},n=[];let a;class l{constructor(t,e,s){this.type=t,this.length=s,this.curve=Float32Array.from(e)}getTime(t){return(t<this.length?t:this.length)-.01}}class d{constructor(t,e,s){this.inst=t,this.size=0,this.length=0,this.data=[];let i=e.split("|");if(i.length>1){e="";for(let t=0;t<i.length;t++)e+=t%2?(","+i[t-1]).repeat(parseInt(i[t])-1):(e?",":"")+i[t]}e.split(",").forEach((t=>{let e=t.match(/^([\d\.]+)/),i=t.match(/([a-z]+\d+)/g);if(e){let t=s*parseFloat(e[1]),h=[t];if(this.length+=t,i){i.length>this.size&&(this.size=i.length);for(let t=0;t<i.length;t++){let e=i[t].match(/([a-z]+)(\d+)/);e&&h.push(n[12*parseInt(e[2])+o[e[1]]])}}this.data.push(h)}}))}play(t){let e=0;const s=this.inst,i=t.createGain(),h=[];i.connect(t.destination);for(let e=0;e<this.size;e++)h[e]=t.createOscillator(),h[e].type=s.type,h[e].connect(i);this.data.forEach((t=>{s.curve&&i.gain.setValueCurveAtTime(s.curve,e,s.getTime(t[0])),h.forEach(((s,i)=>{s.frequency.setValueAtTime(t[i+1]||0,e)})),e+=t[0]})),h.forEach((t=>{t.start(),t.stop(e)}))}}var c,u,p,m={async init(){"suspended"===i.state&&await i.resume();const t=Math.pow(2,1/12);for(let e=-69;e<50;e++)n.push(440*Math.pow(t,e));const e=(a=i.createBuffer(1,88200,44100)).getChannelData(0);for(let t=0;t<88200;t++)e[t]=2*Math.random()-1},async sound(t,e,s,i){const h=new OfflineAudioContext(1,44100*i,44100),o=h.createGain(),n=Float32Array.from(s);if(o.connect(h.destination),e.curve&&o.gain.setValueCurveAtTime(e.curve,0,e.getTime(i)),h.addEventListener("complete",(e=>r[t]=e.renderedBuffer)),"custom"==e.type){const t=h.createBiquadFilter();t.connect(o),t.detune.setValueCurveAtTime(n,0,i);const e=h.createBufferSource();e.buffer=a,e.loop=!0,e.connect(t),e.start()}else{const t=h.createOscillator();t.type=e.type,t.frequency.setValueCurveAtTime(n,0,i),t.connect(o),t.start(),t.stop(i)}await h.startRendering()},async music(t,e){const s=e.reduce(((t,e)=>e.length>t?e.length:t),0),i=new OfflineAudioContext(1,44100*s,44100);i.addEventListener("complete",(e=>r[t]=e.renderedBuffer)),e.forEach(((t,e)=>t.play(i))),await i.startRendering()},mixer:t=>(t in h||(h[t]=i.createGain(),h[t].connect(i.destination)),h[t]),play(t,e=!1,s="master"){if(t in r){let h=i.createBufferSource();return h.loop=e,h.buffer=r[t],h.connect(this.mixer(s)),h.start(),h}return null}};function g(t,e,s,i=!1){t.addEventListener(e,s,i)}class f{static get(t=1,e=0,s=!0){if(t<=e)return t;f.seed=(9301*f.seed+49297)%233280;let i=e+f.seed/233280*(t-e);return s?Math.round(i):i}}f.seed=Math.random(),function(t){t[t.FIRE=0]="FIRE",t[t.ALT=2]="ALT",t[t.LEFT=65]="LEFT",t[t.RIGHT=68]="RIGHT",t[t.UP=87]="UP",t[t.DOWN=83]="DOWN"}(c||(c={}));class w{constructor(t=0,e=0){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get angle(){return Math.atan2(this.y,this.x)}set(t,e=t){return t instanceof w?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this}add(t,e=t){return t instanceof w?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this}sub(t,e=t){return t instanceof w?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this}scale(t){return this.x*=t,this.y*=t,this}tile(t){return new w(Math.floor(this.x/t),Math.floor(this.y/t))}invert(){return this.x=-this.x,this.y=-this.y,this}normalize(){const t=this.length;return t>0&&this.scale(1/t),this}clone(){return new w(this.x,this.y)}}class b{constructor(t,e,s=e){this.pos=t,this.width=e,this.height=s,this._center=new w}get center(){return this._center.set(this.width/2+this.pos.x,this.height/2+this.pos.y),this._center}get bottom(){return this.pos.y+this.height}collide({pos:t,width:e,height:s}){return this.pos.x<t.x+e&&this.pos.x+this.width>t.x&&this.pos.y<t.y+s&&this.height+this.pos.y>t.y}contains({pos:t,width:e,height:s}){return this.pos.x<=t.x&&this.pos.x+this.width>=t.x+e&&this.pos.y<=t.y&&this.pos.y+this.height>=t.y+s}intersect({pos:t,width:e,height:s}){let i=Math.round(this.pos.x),h=Math.round(this.pos.y),r=i+this.width,o=h+this.height,n=Math.round(t.x),a=Math.round(t.y),l=n+e,d=a+s,c=i<n?n:i,u=h<a?a:h,p=r<l?r:l,m=o<d?o:d;return new b(new w(c,u),p-c,m-u)}}class x{constructor(t,e=null,s=null,i=!0){this.type=t,this.target=e,this.payload=s,this.bubble=i,this.stoped=!1}stop(){this.stoped=!0}}class y{constructor(){this.children=[],this.listeners={all:[]}}addChild(t){return this.children.push(t),t.parent=this,this}removeChild(t){const e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=null)}each(t){for(let e=this.children.length-1;e>=0;e--)t(this.children[e],e)}on(t,e){const s=t.match(/[a-zA-Z]+/g);s&&s.forEach((t=>{t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)}))}emit(t){for(const e of this.listeners.all){if(t.stoped)return;e(t)}if(t.type in this.listeners)for(const e of this.listeners[t.type]){if(t.stoped)return;e(t)}t.bubble&&this.parent&&this.parent.emit(t)}render(t){this.children.forEach((e=>e.render(t)))}update(t){this.children.forEach((e=>e.update(t)))}}class A extends y{constructor(t){super(),this.factory=t,this.pool=[]}create(t=null){let e=this.pool.pop();return e||(e=this.factory()),this.addChild(e),t&&t(e),e}removeChild(t){super.removeChild(t),this.pool.push(t)}clear(){for(;this.children.length;)this.removeChild(this.children[0])}}class v extends A{constructor(t,e,s,i=0,h=0){super(t),this.factory=t,this.init=e,this.box=s,this.frq=i,this.limit=h,this.pos=this.box.pos,this.time=0}create(t=null){return!this.limit||this.children.length<this.limit?super.create(t):null}update(t){super.update(t),this.frq<=0||(this.time+=t,this.time>this.frq&&(this.time-=this.frq,this.create(this.init)))}}class M{constructor(){}static load(t,e){return new Promise((s=>{const i=new Image;g(i,"load",(()=>{M.image.push(i),M.config=e,s(i)})),i.src=t}))}static tint(t,e,s,i){return new Promise((h=>{const r=t.canvas;let o=M.image[0];r.width=o.width,r.height=o.height,t.drawImage(M.image[0],0,0);const n=t.getImageData(0,0,r.width,r.height),a=n.data;for(let t=0;t<n.data.length;t+=4)a[t+3]&&(a[t]=Math.round(a[t]*e),a[t+1]=Math.round(a[t+1]*s),a[t+2]=Math.round(a[t+2]*i));t.putImageData(n,0,0),g(o=new Image,"load",(()=>{M.image.push(o),h(o)})),o.src=r.toDataURL()}))}static draw(t,e,{pos:s,width:i,height:h},r=0,o=!1,n=!1){const a=e.match(/^([a-z]+)([0-9]*)$/);if(!a||!(a[1]in M.config))return;const l=a[2]?parseInt(a[2]):0,d=M.config[a[1]];t.save(),t.translate(Math.round(s.x),Math.round(s.y)),t.scale(o?-1:1,n?-1:1),t.drawImage(M.image[l],d[0]+r*i,d[1],i,h,o?-i:0,n?-h:0,i,h),t.restore()}}M.image=[];class C extends A{constructor(t,{frq:e,amm:s,mag:i}){super(t),this.factory=t,this.time=0,this.frq=e,this.ammo=s,this.magazine=i}load(t){this.ammo+=t,this.magazine&&this.ammo>this.magazine&&(this.ammo=this.magazine)}create(t=null){return this.ammo<=0||this.frq&&this.time?null:(this.ammo--,this.time=this.frq,super.create(t))}update(t){this.time=t<this.time?this.time-t:0,super.update(t)}}class E extends y{constructor({spd:t,dmg:e,size:s,color:i}={}){super(),this.time=0,this.spd=t,this.dmg=e,this.size=s,this.color=i,this.pos=new w,this.dir=new w,this.box=new b(this.pos,this.size)}render(t){let e=Math.floor(this.time%200/50);M.draw(t,"plasma"+this.color,this.box,0,e%2>0,e>1)}update(t){this.time+=t,this.pos.add(this.dir.clone().scale(this.spd*t))}}class T extends E{constructor({spd:t,dmg:e,size:s,color:i,radius:h}={}){super({spd:t,dmg:e,size:s,color:i}),this.radius=h,this.aim=new w}render(t){M.draw(t,"grenade"+this.color,this.box)}update(t){this.box.center.sub(this.aim).length<=this.spd*t?(this.pos.set(this.aim),this.emit(new x("explode",this)),this.parent.removeChild(this)):super.update(t)}}class S extends y{constructor({hp:t,spd:e,score:s,lives:i,delay:h,gun:r,gnd:o}={}){super(),this.dir=new w,this.aim=new w,this.fire=!1,this.time=0,this.resist=0,this.ouch=0,this.hp=t,this.max=t,this.spd=e,this.lives=i,this.delay=h,this.score=s,this.pos=new w,this.box=new b(this.pos,16,24),this.gun=new C((()=>new E(r.bul)),r),this.grenades=new C((()=>new T(o.bul)),o),this.addChild(this.grenades),this.addChild(this.gun)}get alive(){return this.lives>0}render(t){if(super.render(t),!this.alive)return;const e=this.aim.clone().sub(this.box.center);let s=e.y>=0?0:3,i=this.time%200,h=i<100;Math.abs(e.x)>Math.abs(e.y)&&(s=i<100?1:2,h=e.x>0);let r=this.resist%500>250?"hero":"hero2";this.ouch>0&&(r="hero6"),M.draw(t,r,this.box,s,h)}update(t){super.update(t),this.resist-=t,this.ouch-=t,this.dir.length&&(this.time+=t),this.alive&&this.fire&&this.gun.create((t=>{const e=t.box,s=this.box.center;t.dir.set(this.aim.clone().sub(s).normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),this.emit(new x("fire",this,t))}))}launch(){this.grenades.create((t=>{const e=t.box,s=this.box.center;t.dir.set(this.aim.clone().sub(s).normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),t.aim.set(this.aim),this.emit(new x("launch"))}))}hit(t){if(!(this.resist>0))if(this.hp-=t,this.hp>0)this.ouch=250;else{if(--this.lives>0)return this.hp=this.max,this.resist=this.delay,void this.emit(new x("death",this));this.hp=0,this.emit(new x("lose",this))}}reset(){this.gun.clear(),this.grenades.clear()}}!function(t){t[t.WALL=0]="WALL",t[t.GROUND=1]="GROUND",t[t.HOLE=2]="HOLE",t[t.CAMP=3]="CAMP",t[t.SHOT=4]="SHOT",t[t.WORM=5]="WORM",t[t.HEAL=6]="HEAL",t[t.AMMO=7]="AMMO",t[t.NUKE=8]="NUKE",t[t.HERO=9]="HERO"}(u||(u={}));class L extends y{constructor(t){super(),this.level=t,this.width=14,this.height=1,this.size=16;const e=L.MAPS,s=e[t%e.length];let i=0;this.tiles=new Array(this.width+1).fill(0);for(let t=0;t<s.length;t+=2){const e=parseInt(s.charAt(t),36),h=parseInt(s.charAt(t+1),36);for(let t=0;t<h;t++)i&&i%12==0&&(this.tiles.push(0,0),this.height++),this.tiles.push(e),i++}this.tiles.push(0),this.loadFrames()}get length(){return this.width*this.height}get bottom(){return this.height*this.size}get last(){return this.level>=L.MAPS.length-1}loadFrames(){this.frame=[];for(let t=0;t<this.height+L.PLUS_ROWS;t++)for(let e=0;e<this.width;e++){let s=0;this.getTile(e,t)===u.WALL&&(s+=1,this.getTile(e,t-1)===u.WALL&&(s+=1),this.getTile(e-1,t)===u.WALL&&(s+=2),this.getTile(e+1,t)===u.WALL&&(s+=4),this.getTile(e,t+1)===u.WALL&&(s+=8)),this.frame.push(s)}}render(t){const e=new w,s=new b(e,this.size,1.5*this.size);let i=0;for(let h=0;h<this.height+L.PLUS_ROWS;h++){const r=h===this.height-1;for(let o=0;o<this.width;o++){const n=this.frame[i++];(n||r)&&(e.set(o,h).scale(this.size),M.draw(t,"cave1",s,n))}e.x+=this.size}super.render(t)}setTile(t,e,s){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.tiles[e*this.width+t]=s)}getTile(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.tiles[e*this.width+t]:u.WALL}getPosByTile(t,e=-1){const s=e>0?e:0,i=e>=0?e+1:this.height,h=[];let r=s*this.width;for(let e=s;e<i;e++)for(let s=0;s<this.width;s++)this.tiles[r++]===t&&h.push(new w(s*this.size,e*this.size));return h}collideX({pos:t,width:e,height:s},i=!1){let h=this.size,r=Math.floor(t.y/h),o=Math.floor(t.x/h),n=Math.floor((t.x+e)/h);for(let a=r*h;a<t.y+s;a+=h){let s=Math.floor(a/h);if(!this.getTile(o,s))return i&&(t.x+=(o+1)*h-t.x),!0;if(!this.getTile(n,s))return i&&(t.x-=t.x+e-n*h),!0}return!1}collideY({pos:t,width:e,height:s},i=!1){let h=this.size,r=Math.floor(t.y/h),o=Math.floor(t.x/h),n=Math.floor((t.y+s)/h);for(let a=o*h;a<t.x+e;a+=h){let e=Math.floor(a/h);if(!this.getTile(e,r))return i&&(t.y+=(r+1)*h-t.y),!0;if(!this.getTile(e,n))return i&&(t.y-=t.y+s-n*h),!0}return!1}createNav(t){const e=t.tile(this.size);this.nav=new Array(this.tiles.length).fill(L.MAX_NAV),this.setNav(e.x,e.y)}lockNav(t){const e=t.tile(this.size);this.nav[e.y*this.width+e.x]=L.MAX_NAV}setDirection(t){const e=this.size,s=t.box.center,i=s.tile(e);t.dir.set(0,0);let h=L.MAX_NAV;h=this.setDir(t,i,new w(1,0),h),h=this.setDir(t,i,new w(-1,0),h),h=this.setDir(t,i,new w(0,1),h),h=this.setDir(t,i,new w(0,-1),h),t.dir.x?(this.getTile(i.x,i.y+1)&&(h=this.setDir(t,i,new w(t.dir.x,1),h)),this.getTile(i.x,i.y-1)&&(h=this.setDir(t,i,new w(t.dir.x,-1),h))):t.dir.y&&(this.getTile(i.x+1,i.y)&&(h=this.setDir(t,i,new w(1,t.dir.y),h)),this.getTile(i.x-1,i.y)&&(h=this.setDir(t,i,new w(-1,t.dir.y),h))),t.dir.add(i).scale(e).add(e/2).sub(s).normalize()}setDir(t,e,s,i){const h=this.getNav(e.x+s.x,e.y+s.y);return i>h&&(t.dir=s,i=h),i}getNav(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.nav[e*this.width+t]:L.MAX_NAV}setNav(t,e,s=0){s>=L.MAX_NAV||!this.getTile(t,e)||s>=this.getNav(t,e)||(this.nav[e*this.width+t]=s++,this.setNav(t+1,e,s),this.setNav(t,e+1,s),this.setNav(t-1,e,s),this.setNav(t,e-1,s))}}L.PLUS_ROWS=15,L.MAX_NAV=30,L.MAPS=["0316061704152113031a021a011391160219021a021a021b021b021a03184104180517061903172111031a0116011a021a0219031904180617061705180321164111011w31021831031731051631061631061632051804180314011401160213211603190319031161170312021503120215021303140114031903190319021a011a411b011a02192102190418051705193102193102193101150114310114031331150313314114031331160114311b3113711702190318042117061606150311041402120418021a011z1e581z1802192103180418041804180331180331190231190131140319033117043117053116310431163104311731033118033118023119011n211p021203150213310214021331021402133102140715021331021402133102140211611131021402133102140212031z1q211z12311a3101311831033116310531143103","0316054116310414911231031931011b311r3103142112310516310516310516310517310319331t011b02125612021a0119410119310218310371173103173104311631021201311502130131150112211101311a01311a01311a0231190331180331115611033118023119321v031705150532140432150319021a021f021a02190317043112083113073114371t211r021a02126117021541140319031a031a021q32143503133108130213021502112118021a031a031s411b411b411t31011931021831031731031831021601120315021202150318041804180518041805190319041903115711021a021a011335173517327132173517351t591r081402150114021361110114021501122111051201140512011402150114021141130114021501140215011z1e211z1d321a023118043117053115071403","0316051804149114021a03180517061309130411011j211f01122118021a021a0314331303133313031333140217011b011a02211u021a03150114021403190311611421130114011a031903122117021h0219041903154114011x5712011a0318041804180419041805132114041904180517061606160733120733120733120733120616031a0218711d211l011b01190319034118034115011203150212031403130213051202130513011306160716061121311405123214031333140113011133160219031a021b011d5911711o0117011303150212041402120414021304130214031302150114011t581m341731044115310541143106411331031831021931011t411z1132081232031732031732031732031261132132031732031732031732031732081j211t011404120213043112021204311302110431140631140714081305","0319021921011b011591130219032118031a021a31011b31011a31021931031731041704311704311704311704311721023119011c211s0318051705170517051705170418031a0112211t581e311b321a371401391201213812013813413813413714410135150333150531150631146107140854081408140812211108140854081408140811211208140854081408122111081408140854081408140814073114310631153104311731023116711131023118310231183102311731031831021903411704411704411605170516061606211407150715071606160617051706164105411704180518041921031433120412351104123511041333120321180319021a021a0112581d41125811411z1202112112021402130314021203150614611105122111711205170616021203150213031402112112021h56130141190332143205321232063212320632123205331232410433123303331433011c","0316061606129113051741041721032118310241183103311631053114310714081408140814081408140814081407311421063115053116310321183102193102193101611a311434180418041804112113211204180441180413411404173104163204143404133307123307123302173215211g411a711z125a1p3418350215350215340315330411211333041532410415320614311305133115031331126118311b01311a0131192101311a021a011b01115911011b011a04180516410516021a02126117023118033216410333150433150433140532144105311506150715071341081309130913091309130913091408170531142112043217021171311a321921311m31125612321a3419351735183418341156113301183112021a04190313211503190418041341211361041903193313411n0131135611021a023118041731041121150516310516053116043116410418041333120517061603"];class z extends y{constructor(t,{hp:e,dmg:s,score:i}={}){super(),this.hero=t,this.pos=new w,this.box=new b(this.pos,16),this.hp=e,this.max=e,this.dmg=s,this.score=i}hit(t){this.hp-=t,this.hp>0||(this.emit(new x("kill",this)),this.parent.removeChild(this),this.hp=this.max)}}class O extends z{render(t){M.draw(t,"camp6",this.box)}update(t){super.update(t);for(const t of this.hero.gun.children)if(this.box.collide(t.box))return this.emit(new x("hit",this,t.dmg)),void t.parent.removeChild(t);if(this.box.collide(this.hero.box))return this.emit(new x("hit",this.hero,this.dmg)),this.emit(new x("kill",this)),void this.parent.removeChild(this)}}class N extends z{constructor(t,{hp:e,dmg:s,score:i,spd:h,frq:r}={}){super(t,{hp:e,dmg:s,score:i}),this.hero=t,this.time=0,this.frame=0,this.hitFrame=0,this.active=!0,this.spd=h,this.frq=r}render(t){if(this.active){const e=Math.abs(this.frame%5-2);M.draw(t,"worm1",this.box,e)}}update(t){if(super.update(t),this.time+=t,this.frame=Math.floor(this.time%this.frq/this.spd),this.active=this.frame<5,this.active&&this.frame!==this.hitFrame)return this.box.collide(this.hero.box)?(this.hitFrame=this.frame,void this.emit(new x("hit",this.hero,this.dmg))):void 0}}class B extends O{constructor(t,{hp:e,dmg:s,score:i,near:h,far:r,gun:o}={}){super(t,{hp:e,dmg:s,score:i}),this.hero=t,this.active=!1,this.near=h,this.far=r,this.gun=new C((()=>new E(o.bul)),o),this.addChild(this.gun)}render(t){M.draw(t,"shot1",this.box),this.gun.render(t)}update(t){super.update(t);const e=this.hero;this.gun.each((t=>{t.box.collide(e.box)&&(this.emit(new x("hit",e,t.dmg)),t.parent.removeChild(t))}));const s=this.box.center,i=e.box.center.sub(s),h=i.length;this.active=this.active&&h<this.far||!this.active&&h<this.near&&e.box.bottom>this.pos.y,this.active&&this.gun.create((t=>{const e=t.box;t.dir.set(i.normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),this.emit(new x("eject",t))}))}}class I extends O{constructor(t,{hp:e,dmg:s,score:i,far:h,gun:r,spd:o}={}){super(t,{hp:e,dmg:s,score:i,far:h,gun:r}),this.hero=t,this.dir=new w,this.time=0,this.spd=o}render(t){let e=Math.floor(this.time%400/100);M.draw(t,"runner5",this.box,e>1?3-e:e,e>1)}update(t){super.update(t),this.time+=t}}class D extends v{constructor(t,e,s,{frq:i,limit:h,near:r,far:o}){super(t,e,s,i,h),this.factory=t,this.init=e,this.box=s,this.active=!1,this.near=r,this.far=o}create(t=null){return this.active?super.create(t):null}toggle(t){const e=this.box.center.sub(t).length;e>this.far?this.active=!1:!this.active&&t.y>this.box.center.y&&e<this.near&&(this.active=!0,this.emit(new x("spawn",this)))}render(t){M.draw(t,"hole1",this.box),super.render(t)}}class P extends y{constructor(t,e="",s=6,i=8){super(),this.pos=t,this._text=e,this.width=s,this.height=i,this.box=new b(t,this._text.length*s,i)}set text(t){this._text=t,this.box.width=t.length*this.width}render(t){const e=new b(this.pos.clone(),this.width,this.height);for(let s=0;s<this._text.length;s++){let i=this._text.charCodeAt(s);if(i<32)e.pos.y+=this.height,e.pos.x=this.pos.x;else{if(i>=48&&i<=57)i-=48;else if(i>=97&&i<=122)i-=87;else if(i>=65&&i<=90)i-=55;else if(44===i)i=37;else{if(46!==i){e.pos.x+=this.width;continue}i=36}M.draw(t,"font",e,i),e.pos.x+=this.width}}}}!function(t){t[t.start=0]="start",t[t.run=1]="run",t[t.lose=2]="lose",t[t.win=3]="win"}(p||(p={}));class R extends y{constructor(t,e,s){super(),this.hero=t,this.cam=e,this.satus=p.start,this.text=new P(new w(3)),this.message=new P(new w(32,120)),this.messages=["Click to Start","","Game Over",s.last?"The End":`Level ${s.level+1} Complete`],this.addChild(this.text).addChild(this.message),this.update(0)}update(t){const e=this.cam.box,s=this.message.box,i=this.hero,h=new String(i.hp+1e3).substr(1),r=new String(i.grenades.ammo+100).substr(1),o=new String(i.score+1e6).substr(1);this.text.text=`MEN ${i.lives}  HP ${h}  BOMB ${r}  SCORE ${o}`,this.message.pos.set((e.width-s.width)/2,(e.height-s.height)/2),this.message.text=this.messages[this.satus]}}class W extends y{constructor(t,e,s,i){super(),this.hero=t,this.value=e,this.frame=s,this.color=i,this.pos=new w,this.box=new b(this.pos,16)}render(t){M.draw(t,"item"+this.color,this.box,this.frame)}update(t){this.box.collide(this.hero.box)&&(this.power(),this.emit(new x("item",this)),this.parent.removeChild(this))}}class q extends W{power(){const t=this.hero;t.hp+=this.value,t.hp>t.max&&(t.hp=t.max)}}class F extends W{power(){this.hero.grenades.load(this.value)}}var G={width:224,height:256,spd:.02},k={hp:100,spd:.07,score:0,lives:3,delay:3e3,gun:{frq:80,amm:99999,mag:0,bul:{spd:.4,dmg:25,size:6,color:4}},gnd:{frq:500,amm:5,mag:10,bul:{spd:.2,dmg:150,size:10,color:2,radius:48}}},U={hp:20,dmg:5,score:10},H={hp:150,dmg:0,score:50,near:96,far:160,gun:{frq:800,amm:9999,mag:0,bul:{spd:.1,dmg:10,size:6,color:3}}},Y={hp:500,dmg:2,score:95,spd:100,frq:2500},j={frq:300,limit:20,near:180,far:320},Q={hp:10,dmg:10,spd:.07,score:25};class X extends y{constructor(){super(...arguments),this.pos=new w,this.box=new b(this.pos,16),this.time=0,this.flip=!1,this.frame=0}render(t){M.draw(t,"splash3",this.box,this.frame,this.flip)}update(t){super.update(t),this.time+=t,this.frame=Math.floor(this.time/100),this.frame>2&&this.parent.removeChild(this)}}class K extends y{constructor(t,{width:e,height:s,spd:i},h){super(),this.hero=t,this.bottom=h,this.move=!0,this.pos=new w,this.box=new b(this.pos,e,s),this.spd=i}update(t){const e=this.hero;e.alive&&e.box.bottom<=this.pos.y&&e.hit(100),this.pos.y+=this.spd*t}}class V extends y{constructor(t,e){super(),this.hero=t,this.map=e,this.cam=new K(this.hero,G,this.map.bottom),this.hud=new R(this.hero,this.cam,this.map),this.aim=new w,this.holes=[],this.camps=new A((()=>new O(this.hero,U))),this.shots=new A((()=>new B(this.hero,H))),this.worms=new A((()=>new N(this.hero,Y))),this.explos=new A((()=>new X)),this.onHit=t=>{const e=t.target;e instanceof z&&e.hit(t.payload),e instanceof S&&e.hit(t.payload)},this.onKill=t=>{const e=t.target;this.hero.score+=e.score,this.createExplo(e.pos)},this.onDeath=t=>{const e=t.target,s=e.pos.clone();this.createExplo(s),this.createExplo(s.add(0,8)),this.revive(e)},this.onExplode=t=>{const e=t.target;this.camps.each((t=>this.explode(e,t))),this.shots.each((t=>this.explode(e,t)));for(const t of this.holes)t.each((t=>this.explode(e,t)))},this.map.createNav(this.hero.box.center),this.addChild(this.cam).addChild(this.map).addChild(this.worms).addChild(this.camps).addChild(this.shots);for(const t of this.map.getPosByTile(u.HERO))this.hero.pos.set(t);for(const t of this.map.getPosByTile(u.CAMP))this.camps.create((e=>e.pos.set(t)));for(const t of this.map.getPosByTile(u.SHOT))this.shots.create((e=>e.pos.set(t)));for(const t of this.map.getPosByTile(u.WORM))this.worms.create((e=>{e.time=6*t.x,e.pos.set(t)}));for(const t of this.map.getPosByTile(u.HEAL)){let e=new q(this.hero,100,0,0);e.pos.set(t),this.addChild(e)}for(const t of this.map.getPosByTile(u.AMMO)){let e=new F(this.hero,100,1,2);e.pos.set(t),this.addChild(e)}for(const t of this.map.getPosByTile(u.HOLE)){const e=new D((()=>new I(this.hero,Q)),(e=>e.pos.set(t)),new b(t,16,16),j);this.holes.push(e),this.addChild(e)}this.addChild(this.hero).addChild(this.explos),this.bind()}bind(){this.on("all",(t=>m.play(t.type))),this.on("hit",this.onHit),this.on("kill",this.onKill),this.on("death",this.onDeath),this.on("explode",this.onExplode),this.on("lose",(t=>{this.hud.satus=p.lose})),this.on("win",(t=>{this.hud.satus=p.win}))}revive(t){const e=this.map;let s=Math.floor(this.cam.box.bottom/e.size);s>=e.height&&(s=e.height-1);const i=e.getPosByTile(u.GROUND,s),h=i.length>1?f.get(i.length-1):0;t.hp=t.max,t.pos.set(i[h])}explode(t,e){const s=t.box.center,i=e.box.center.sub(s).length;this.createExplo(t.pos),t.radius>=i&&this.emit(new x("hit",e,t.dmg))}createExplo(t){this.explos.create((e=>{e.pos.set(t),e.time=0,e.flip=Math.random()<.5,e.frame=0}))}render(t){t.save(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.translate(0,-Math.round(this.cam.pos.y)),super.render(t),t.restore(),this.hud.render(t)}update(t){this.hud.update(t),this.hud.satus===p.run&&(super.update(t),this.updateProjectile(t),this.updateHero(t),this.updateMap(),this.updateSpawners(t))}updateHero(t){const e=this.hero,s=this.map,i=this.cam,h=i.box.bottom-e.box.bottom;e.dir.x&&(e.pos.x+=e.dir.x*e.spd*t,s.collideX(e.box,!0)),e.dir.y&&(e.dir.y<0||h>0)&&(e.pos.y+=e.dir.y*e.spd*t,s.collideY(e.box,!0)),e.box.bottom>=s.bottom&&e.emit(new x("win",e)),e.aim.set(this.aim).add(-i.pos.x,i.pos.y)}updateProjectile(t){this.hero.gun.each((t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)})),this.hero.grenades.each((t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&(t.emit(new x("explode",t)),t.parent.removeChild(t))})),this.shots.each((t=>{t.gun.each((t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)}))}))}updateMap(){this.map.createNav(this.hero.box.center);for(const t of this.holes)for(const e of t.children)this.map.lockNav(e.box.center)}updateSpawners(t){for(const e of this.holes){e.toggle(this.hero.pos);for(const s of e.children){this.map.setDirection(s);const e=s.spd*t;s.pos.add(s.dir.x*e,s.dir.y*e)}}}pointer(t,e){this.aim.set(t,e)}input(t,e){let s=0,i=0;t[c.LEFT]&&(s-=1),t[c.RIGHT]&&(s+=1),t[c.UP]&&(i-=1),t[c.DOWN]&&(i+=1),this.hero.dir.set(s,i).normalize(),this.hero.fire=!0===t[c.FIRE],t[c.ALT]&&e&&this.hero.launch()}}const Z=("#game",document.querySelector("#game"));const J=Z.getContext("2d"),_=[];let $=0,tt=new S(k),et=new class extends y{constructor(){super(),this.title=new P(new w(32,24),"F a l l  B a c k  H e r o"),this.story=new P(new w(6,56),"In 2091 a meteor landed on earth,\nand an alien lifeform appeared with\nit. Not so far away from the meteor,\nthe alien lifeform has been settled\nin a cave.\n\nAn elite squad of 3 men have been\nsent to the cave to secure the area\nfor further research.\n\nBut then suddenly..."),this.help=new P(new w(8,172)," Move        Fire         Bomb\n\nW A S D   Left Click   Right Click"),this.hint=new P(new w(72,220),"Click to start"),this.addChild(this.title).addChild(this.story).addChild(this.help).addChild(this.hint)}render(t){t.save(),t.fillStyle="#000",t.fillRect(0,0,t.canvas.width,t.canvas.height),super.render(t),t.restore()}pointer(t,e){}input(t,e){}},st=new V(tt,new L($)),it=(new Date).getTime(),ht=!1,rt=null;function ot(){const t=(new Date).getTime(),e=t-it;if(it=t,requestAnimationFrame(ot),!ht)return et.update(e),void et.render(J);st.update(e<34?e:34),st.render(J)}g(window,"load",(async()=>{!function(){const t=document.body;g(document,"keydown",(t=>{if(_[t.keyCode]=!0,st.input(_,!0),rt&&32===t.keyCode){const t=m.mixer("music").gain;t.value=t.value?0:.2}})),g(document,"keyup",(t=>{_[t.keyCode]=!1,st.input(_,!1)})),g(t,"mousedown",(t=>{_[t.button]=!0,st.input(_,!0)})),g(t,"mouseup",(t=>{_[t.button]=!1,st.input(_,!1)})),g(t,"mousemove",(e=>{const s=Z.height/t.clientHeight,i=(t.clientWidth*s-Z.width)/2;st.pointer(e.clientX*s-i,e.clientY*s)})),g(document,"contextmenu",(t=>t.preventDefault()))}(),await M.load(s(1),s(2)),await M.tint(J,.8,.3,.1),await M.tint(J,.4,.9,.4),await M.tint(J,1,.7,0),await M.tint(J,.1,1,1),await M.tint(J,.8,.1,1),await M.tint(J,1,.2,.2),Z.width=G.width,Z.height=G.height,Z.style.display="block",ot()})),g(document.body,"mousedown",(async()=>{switch(ht||async function(){ht=!0,await m.init(),await Promise.all([m.sound("hit",new l("custom",[2,1,0],1),[110,0],.2),m.sound("fire",new l("square",[.2,.1,0],.2),[660,110],.1),m.sound("eject",new l("triangle",[.2,.1,0],.2),[220,0],.1),m.sound("launch",new l("custom",[1,.5,0],1),[880,0],.1),m.sound("explode",new l("custom",[5,1,0],1),[220,0],1),m.sound("item",new l("square",[.3,.1,0],1),[220,440,220,440,220,440,220,440],.3),m.music("music",[new d(new l("sawtooth",[.2,.2],.2),"2c5eb5g5,1f4ab4c5,1g4bb4d5,2c5eb5g5,1f4ab4c5,1bb4d5ff5|3|",1),new d(new l("square",[1,.3],.2),"2c4,2c4,1c3,2c4,3ab3,2ab3,2ab2,2ab3,2f2,2f2,2g3,2g2,2bb2,2bb3,2g2,2g3,2c4,2c4,1c3,2c4,3ab3,2ab3,2ab2,2ab3,1f2,1f3,1f2,1f3,2g3,2g2,1bb2,1,2bb3,2g2,2g3|3|",.125),new d(new l("square",[.5,.5],1),"2,2c5,2eb5,1g5,2d5,3c5,4ab4,2,2f4,2g4,1f4,2bb4,1eb4,2g4,2b4,2g4,2,2c5,2eb5,1g5,2d5,3c5,4ab4,2,2g5,3bb5,3eb6,2d6,2bb5,2c6,2,2c5,2eb5,1g5,2d5,3c5,4ab4,2,2f4,2g4,1f4,2bb4,1eb4,2g4,2b4,2g4,2,2c5,2eb5,1g5,2d5,3c5,4ab4,2,.5g5,.5bb5,.5c6,.5eb6,2f6,1b5,3eb6,1d6,1d5,1c6,1c5,2bb5",.125)])]),m.mixer("music").gain.value=.2,rt=m.play("music",!0,"music")}(),st.hud.satus){case p.run:break;case p.start:st.hud.satus=p.run;break;case p.win:if(++$<L.MAPS.length){tt.reset(),st=new V(tt,new L($));break}default:$=0,tt=new S(k),st=new V(tt,new L($))}}))}])</script>