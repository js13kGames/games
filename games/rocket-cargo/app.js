var t=68,s=87,e=65,h=83,r=70,a=72,o=78,l=77,n=359,c=39,d=38,f=37,u=40,x=81,y=32,p=13,m={RELEASED:0,ACTIVE:1,INACTIVE:2},g={right:0,up:0,left:0,down:0,espace:0,enter:0,help:0,shoot:0,refuel:0,new:0,model:m.RELEASED,quit:m.RELEASED,state:m};function k(t,s,i){i=i||{x:0,y:3},this.x=t,this.y=s,this.vx=i.x,this.vy=i.y,this.radius=20,this.lifeMax=300,this.life=this.lifeMax,this.max=50,this.speed=1.5,this.size=20,this.fireWidth=50,this.particles=[],this.listeners=[],this.showLifeIndicator=1}function w(t,s,i,e){this.x=t,this.y=s,this.xs=i,this.ys=e,this.life=0}k.prototype.addListener=function(t){this.listeners.push(t)},k.prototype.smokingPosition=function(){return{x:this.x,y:this.y}},k.prototype.step=function(t){this.vy+=L,this.vx+=D.wind.x,this.vy+=D.wind.y,this.x+=t*this.vx,this.y+=t*this.vy,this.y>X&&(this.y=X+20);for(var s=0;s<1;s++){var i=new w(this.x+(Math.random()-.5)*this.fireWidth,this.y,(Math.random()-.5)*this.speed/2,0-2*Math.random()*this.speed);this.particles.push(i)}this.smoking(this),this.life-=1},k.prototype.draw=function(t){for(t.save(),i=0;i<this.particles.length;i++){i<this.particles.length/2?t.globalCompositeOperation="xor":t.globalCompositeOperation="lighter";let s=260-2*this.particles[i].life,e=2*this.particles[i].life+50,h=2*this.particles[i].life;t.fillStyle="rgba("+s+","+e+","+h+","+(this.max-this.particles[i].life)/this.max*.4+")",t.beginPath(),t.arc(this.particles[i].x,this.particles[i].y,(this.max-this.particles[i].life)/this.max*(this.size/2)+this.size/2,0,2*Math.PI),t.fill(),this.particles[i].x+=this.particles[i].xs,this.particles[i].y+=this.particles[i].ys,this.particles[i].life++,this.particles[i].life>=this.max&&(this.particles.splice(i,1),i--)}t.restore()},k.prototype.smoking=function(){this.listeners.forEach((t=>{t.smoking(this)}))};var v=function(t,s,i,e=1,h=.001){this.name=Math.random().toString(36).substr(2,9);var r=["rgba(255,255,255,0.2)","rgba(200,200,200,0.2)","rgba(230,230,230,0.2)"];i=i||{x:0,y:0},this.x=t,this.y=s,this.vx=i.x,this.vy=i.y,this.radius=5*e,this.mass=h,this.life=100,this.strokeColor=r[F(0,r.length-1)],this.fillColor=r[F(0,r.length-1)]};v.prototype.step=function(t){this.vy+=L*this.mass,this.vx+=D.wind.x,this.vy+=D.wind.y,this.x+=t*this.vx,this.y+=t*this.vy,this.y>X&&(this.y=X,this.vy*=-1),this.life-=1,this.radius<30&&(this.radius+=.1)},v.prototype.draw=function(t){t.save(),t.beginPath(),t.lineWidth=0,t.strokeStyle=this.strokeColor,t.fillStyle=this.fillColor,t.arc(this.x,this.y,this.radius,0,2*Math.PI,0),t.fill(),t.stroke(),t.restore()};class b{constructor(t,s,i=0){this.name="vehicle",this.x=t,this.y=s,this.radius=30,this.width=2*this.radius,this.height=2*this.radius,this.life=100,this.ground=s,this.velX=0,this.velY=0,this.lastY=this.y,this.hasExploded=0,this.listeners=[],this.name="",this.imageWidth=60,this.imageHeight=60,this.smokePosition={x:0,y:10},this.Width=20,this.Length=40}step(t){this.x+=t*this.velX,this.y+=t*this.velY}draw(t){t.save(),t.translate(this.x,this.y),t.restore()}destroyVehicle(){this.hasExploded||(this.exploding(),this.life=0,this.hasExploded=1)}addListener(t){this.listeners.push(t)}smoking(){this.listeners.forEach((t=>{t.smoking(this)}))}exploding(){this.listeners.forEach((t=>{t.exploding(this)}))}smokingPosition(){return{x:this.x+this.smokePosition.x,y:this.y+this.smokePosition.y}}explodePosition(){return{x:this.x,y:this.y}}}class P extends b{constructor(t,s){super(t.x,t.y,1),this.name="plane",this.velX=s.x,this.velY=s.y,this.Width=108,this.Length=32}draw(t){super.draw(t),t.save(),t.translate(this.x,this.y),this.velX>0&&t.scale(-1,1),t.rotate(Math.PI/4*5),t.font="bold 80px Verdana",t.textAlign="left",t.fillStyle="#000000",t.beginPath(),t.fillText("‚úàÔ∏è",-85,60),t.stroke(),t.restore()}}class E extends b{constructor(t,s){super(t,s),this.loaded=0,this.load="",this.status="landed",this.altitude=0,this.altitudeMax=1500,this.distanceTavelled=0,this.thrustAngle=Math.PI,this.thrust={x:0,y:0},this.thrusting=0,this.fuelTank={x:60,y:-10,w:7,h:52,color:"red"},this.fuel_MAX=4e3,this.fuel=2*this.fuel_MAX/3,this.grounded=1,this.canFuel=0,this.manualThrust=2*L,this.landingThrust=2*L,this.landingConstraints={dx:50,dy:50},this.Width=20,this.Length=40,this.side=8}step(t){"flying"==this.status&&(this.velY+=L),this.fuel>0?(this.velX+=this.thrust.x,this.velY-=this.thrust.y,this.fuel-=this.thrust.y,this.fuel=Math.max(0,this.fuel)):(this.thrust.x=0,this.thrust.y=0),this.thrustAngle=Math.atan2(this.thrust.x,this.thrust.y)+Math.PI/2,this.thrusting=0,(Math.abs(this.thrust.x)>0||Math.abs(this.thrust.y)>0)&&(this.status="flying",this.grounded=0,this.hasExploded=0,this.thrusting=1,this.smoking()),this.thrust.x=0,this.thrust.y=0,super.step(t),this.altitude=-this.y+this.ground-50,this.altitude>this.altitudeMax&&(this.y=-this.altitudeMax+this.ground-50,this.velY=0),this.distanceTavelled+=t*Math.abs(this.velX),"flying"==this.status&&this.y>X-50&&(this.velY>this.landingConstraints.dy||this.velX>this.landingConstraints.dx?(this.exploding(),this.life=0):(this.status="landed",this.grounded=1)),"landed"!=this.status&&"crashed"!=this.status||(this.grounded=1,this.y=X-50,this.velX=0,this.velY=0),"based"==this.status&&(this.grounded=1,this.velX=0,this.velY=0),this.lastStatus=this.status}draw(t){super.draw(t),this.thrusting&&this.drawExhaustPlume(this),t.save(),t.translate(this.x,this.y),t.rotate(-Math.PI/4),t.font="bold 64px Verdana",t.textAlign="left",t.fillStyle="#000000",t.beginPath(),t.fillText("üöÄ",-45,25),t.stroke(),t.restore(),this.drawRocket(t)}drawRocket(){this.throttle=this.thrusting?1:0,this.gimbalAngle=-this.thrustAngle;var t=this.Length;this.Width;Y.save(),Y.translate(this.x,this.y),Y.lineWidth=t/40,Y.lineJoin="round",Y.lineCap="round";let s=this.fuelTank.w,i=this.fuelTank.h;Y.beginPath(),Y.fillStyle="rgba(255,255,255,0.4)",Y.fillRect(this.fuelTank.x-2*s,this.fuelTank.y-t/2,s,i),Y.fillStyle=this.fuelTank.color,Y.fillRect(this.fuelTank.x-2*s,this.fuelTank.y-t/2+i*(1-this.fuel/this.fuel_MAX),s,i*(this.fuel/this.fuel_MAX)),Y.strokeStyle="rgba(0,0,0,0.4)",Y.strokeRect(this.fuelTank.x-2*s,this.fuelTank.y-t/2,s,i),Y.restore(),this.loaded&&(Y.save(),Y.font="50px Verdana",Y.textAlign="center",Y.fillStyle="#000000",Y.beginPath(),Y.fillText(this.load,this.x,this.y-50),Y.restore())}drawExhaustPlume(t){Y.fillStyle="red",Y.strokeStyle="yellow",Y.lineWidth=2;const s=10;var i=[],e=[],h=t.thrustAngle;let r=.5*(4*t.radius/5+1*t.radius/5*Math.random());var a=0+Math.cos(h-2*Math.PI)*r,o=0+this.Length+Math.sin(h-2*Math.PI)*r;i[1]=a+Math.cos(h-2*Math.PI)*s*4,e[1]=o+Math.sin(h-2*Math.PI)*s*4,i[2]=a+Math.cos(h-7*Math.PI/4)*s,e[2]=o+Math.sin(h-7*Math.PI/4)*s,i[3]=a+Math.cos(h-2*Math.PI)*s/2,e[3]=o+Math.sin(h-2*Math.PI)*s/2,i[4]=a+Math.cos(h+7*Math.PI/4)*s,e[4]=o+Math.sin(h+7*Math.PI/4)*s,Y.save(),Y.translate(this.x,this.y+10),Y.beginPath(),Y.moveTo(i[0],e[0]);for(var l=0,n=i.length-1;l<i.length;n=l++)Y.lineTo(i[n],e[n]);Y.closePath(),Y.fill(),Y.stroke(),Y.restore()}moveRocket(t){!this.grounded&&this.fuel>0&&(this.thrust.x+=t)}thrusRocket(){this.velY>100?this.thrust.y+=this.landingThrust:this.thrust.y+=this.manualThrust}refuelRocket(){this.fuel<this.fuel_MAX&&this.canFuel&&(this.fuel+=this.fuel_MAX/100)}smokingPosition(){return{x:this.x+this.smokePosition.x+20*Math.cos(this.thrustAngle),y:this.y+this.smokePosition.y+40+20*Math.sin(this.thrustAngle)}}}class M{constructor(t,s,i,e=200){this.name=t,this.colorNormal="rgb(90,100,90,0.4)",this.colorActive="rgb(90,100,90,0.7)",this.color=this.colorNormal,this.visible=1,this.x=s,this.y=i,this.radius=30,this.width=2*this.radius,this.height=2*this.radius,this.type=i==X?M.TYPE.GROUND:M.TYPE.SPACE,this.emojiSize=e}step(t){}draw(){Y.save(),Y.translate(this.x,this.y),Y.strokeStyle=this.color,Y.fillStyle=this.color;let t=4*this.radius;Y.beginPath(),Y.ellipse(0,32,t,.2*t,0,0,2*Math.PI),Y.fill(),Y.stroke(),Y.beginPath(),Y.ellipse(0,35,t/2,t/2*.2,0,0,2*Math.PI),Y.fill(),Y.stroke(),Y.restore()}inSafeDistance(t){return this.distance(t)<this.SafeDistance+t.radius?1:0}distance(t){var s=t.x-this.x,i=t.y-this.y;return Math.sqrt(s*s+i*i)}}M.TYPE={GROUND:"GROUND",SPACE:"SPACE"};class T extends M{constructor(t,s,i,e){super(t,i,e),this.building=s,this.visible=0}draw(t){t.save(),t.translate(this.x,this.y),t.font="bold "+this.emojiSize+"px Verdana",t.textAlign="left";let s=t.measureText(this.building);if(t.beginPath(),t.fillText(this.building,0-s.width/2,-40),t.strokeStyle=this.color,t.fillStyle=this.color,this.visible){t.font="bold 40px Verdana",t.textAlign="left",t.fillStyle="#000000";let s=t.measureText(this.name);t.beginPath(),t.fillText(this.name,0-s.width/2,80)}t.restore(),super.draw(t)}}class R extends M{constructor(t,s,i,e=200){super(t,s,i,e)}draw(t){super.draw(t),t.save(),t.translate(this.x,this.y),t.font="bold "+this.emojiSize+"px Verdana",t.textAlign="left",t.fillStyle="#000000";let s=t.measureText(this.name);t.beginPath(),t.fillText(this.name,0-s.width/2,-20),t.restore()}}class S{constructor(t){this.visible=0,this.title="R O C K E T  C A R G O",this.color="#282828",this.width=600,this.height=300,this.x=t.width/2-this.width/2,this.y=t.height/2-this.height/2,this.buttons=[];var s=new A(this.x+this.width/2-25,this.y+.8*this.height,50,20,"OK",{default:{top:"#1879BD",bottom:"#084D79"},hover:{top:"#678834",bottom:"#093905"},active:{top:"#EB7723",bottom:"#A80000"}},(function(){D.screen.modal.visible&&(D.screen.modal.visible=0,D.stop=0)}));this.buttons.push(s)}step(t){this.buttons.forEach((s=>s.step(t)))}draw(t){if(!this.visible)return;let s=0,i=25;t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.lineWidth=1,t.strokeStyle="#fff",t.fillStyle=this.color,t.fill(),t.stroke(),t.font="22px sans-serif",t.fillStyle="#FFF";var e=t.measureText(this.title),h=this.x+this.width/2-e.width/2,r=this.y+50;t.fillText(this.title,h,r),t.translate(this.x+20,this.y+80),t.font="bold 60px Helvetica",t.beginPath(),t.fillText("üöÄüì¶",this.width-200,0+s*i),t.stroke(),t.font="16px Helvetica",t.beginPath(),t.fillText("Basic operation:",0,0+s++*i),t.stroke(),s++,t.beginPath(),t.fillText("Press F to refuel the Rocket at base",0,0+s++*i),t.stroke(),t.beginPath(),t.fillText("Press W or UP to thrust the rocket",0,0+s++*i),t.stroke(),t.beginPath(),t.fillText("Press A/D or LEFT/RIGHT to move the rocket when flying",0,0+s++*i),t.stroke(),t.beginPath(),t.fillText("Press Q to activate FTS (Flight Termination System) if you run out of fuel",0,0+s++*i),t.stroke(),t.beginPath(),t.fillText("Press H to show this info",0,0+s++*i),t.stroke(),t.restore(),this.buttons.forEach((s=>s.draw(t)))}}class A{constructor(t,s,i,e,h,r,a,o){this.hud=o,this.x=t,this.y=s,this.width=i,this.height=e,this.colors=r,this.text=h,this.clickCB=a,this.enabled=1,this.state="default",this.isClicking=0}step(t){this.enabled&&(g.enter&&"function"==typeof this.clickCB&&!this.isClicking?(this.clickCB(),this.isClicking=1):this.isClicking=0,H.x>=this.x&&H.x<=this.x+this.width&&H.y>=this.y&&H.y<=this.y+this.height?(this.state="hover",V?(this.state="active","function"!=typeof this.clickCB||this.isClicking||(this.clickCB(),this.isClicking=1)):this.isClicking=0):"selected"==this.state?this.state="hover":this.state="default")}draw(t){t.save();var s=this.colors[this.state],i=this.height/2;t.fillStyle=s.top,t.fillRect(this.x,this.y,this.width,i),t.fillStyle=s.bottom,t.fillRect(this.x,this.y+i,this.width,i),t.font="12px sans-serif",t.fillStyle="#FFF";var e=t.measureText(this.text),h=this.x+this.width/2-.65*e.width,r=this.y+i+3;t.fillText(this.text,h,r),t.restore()}}class C{constructor(t,s,i){this.width=s,this.height=i,this.x=t.width-1*this.width/10-s,this.y=t.height-1*this.height/10-i,this.color="#282828"}step(t){}draw(t){t.save(),t.lineWidth=1,t.strokeStyle="#fff",t.fillStyle=this.color,t.translate(this.x-10,this.y-20),t.beginPath(),t.rect(0,0,this.width,this.height),t.fill(),t.stroke();let s=.03,i=.08;t.translate(20,75),t.beginPath(),t.fillStyle="rgba(0,200,100,0.6)",t.fillRect(-20,5+X*i,this.width,(this.height/2-X)*i),t.strokeStyle="rgb(255,255,255,0.5)",t.setLineDash([2,2]),t.lineWidth=3;let e=D.resources.filter((t=>t.name==D.mission.path[0]))[0];e&&D.bases.filter((t=>t.name==D.mission.path[1])).forEach((h=>{t.beginPath(),t.moveTo(50+e.x*s,e.y*i),t.lineTo(50+h.x*s,h.y*i),t.stroke()})),D.bases.forEach((e=>{e.visible&&(t.font="bold 25px Verdana",t.beginPath(),t.fillText(e.name,35+e.x*s,e.y*i-5))})),D.resources.forEach((e=>{e.visible&&(t.font="bold 20px Verdana",t.beginPath(),t.fillText(e.name,35+e.x*s,e.y*i-5))})),D.rockets.forEach((e=>{t.beginPath(),t.fillStyle="rgb(255, 255, 50)",t.arc(50+e.x*s,0+e.y*i,5,0,2*Math.PI),t.fill()})),t.restore()}}class I{constructor(t,s,i){i=i,this.offsetX=0,this.offsetY=0,this.width=t,this.height=s,this.height_original=s,this.scaleX=this.width/cWidth,this.scaleY=this.height/cHeight,this.x=(cWidth-this.width)/2,this.x_original=this.x,this.y=(cHeight-this.height)/2,this.y_original=this.y,this.modal=new S(this),this.minimap=new C(this,225,150),this.stars=[],this.trees=[],this.createStars(-5*cWidth,-1500,10*cWidth,X-1e3,100),this.createTrees(-5*cWidth,X-10,10*cWidth,X-0,100)}createStars(t,s,i,e,h){for(let r=t;r<i;r+=h)for(let t=s;t<e;t+=h){const s={x:r+Math.floor(Math.random()*h),y:t+Math.floor(Math.random()*h),r:1.5*Math.random()};this.stars.push(s)}}createTrees(t,s,i,e,h){for(let r=t;r<i;r+=h)for(let t=s;t<e;t+=h){const s={x:r+Math.floor(Math.random()*h),y:t+Math.floor(0*Math.random())};this.trees.push(s)}this.trees=this.trees.filter((t=>t.x<cWidth/2-400||t.x>cWidth/2+400))}update(t){this.modal.step(t),this.minimap.step(t)}draw(t){this.modal.draw(t),this.minimap.draw(t)}drawTarget(t){var s=W.getBoundingClientRect();t.save(),t.scale(this.scaleX,this.scaleY),t.translate(this.x+this.offsetX-s.left,this.y+this.offsetY-s.top),t.strokeStyle="rgb(255,255,255,0.3)",t.setLineDash([20,20]),t.lineWidth=12;let i=D.resources.filter((t=>t.name==D.mission.path[0]))[0];i&&D.bases.filter((t=>t.name==D.mission.path[1])).forEach((s=>{t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.stroke()})),t.restore()}drawItem(t){var s=W.getBoundingClientRect();Y.save(),Y.scale(this.scaleX,this.scaleY),Y.translate(this.x+this.offsetX-s.left,this.y+this.offsetY-s.top),t.draw(Y),Y.restore()}drawScene(){Y.save();var t=W.getBoundingClientRect();Y.scale(this.scaleX,this.scaleY),Y.translate(this.x+this.offsetX-t.left,this.y-t.top+this.offsetY);var s=X;Y.beginPath(),Y.fillStyle="rgba(135,206,235,0.5)",Y.fillRect(-100*cWidth,-1e4,200*cWidth,1e4+s),Y.beginPath(),Y.fillStyle="rgba(0,0,0,1)",Y.fillRect(-100*cWidth,-1500,200*cWidth,1e3+s-500),Y.beginPath(),Y.fillStyle="rgb(255, 255, 255)",this.stars.forEach((function(t){Y.beginPath(),Y.arc(t.x,t.y,t.r,0,2*Math.PI),Y.fill()})),Y.font="50px Verdana",Y.textAlign="center",Y.fillStyle="#000000",this.trees.forEach((function(t){Y.beginPath(),Y.fillText("üå≥",t.x,t.y)})),Y.beginPath(),Y.moveTo(-100*cWidth,s),Y.lineTo(100*cWidth,s),Y.strokeStyle="rgba(0,100,50,0.6)",Y.stroke(),Y.fillStyle="rgba(0,200,100,0.6)",Y.fillRect(-100*cWidth,s,200*cWidth,this.height),Y.restore(),Y.restore()}drawMission(){let t=0;if(D.mission){let s=50,i=cHeight-150;Y.beginPath(),Y.fillStyle="rgb(255,255,255,0.6)",Y.roundRect(s-30,i-50,450,180,20),Y.fill(),Y.fillStyle="black",Y.font="28px Helvetica",Y.beginPath(),Y.fillText(D.rocket.name+" Mission "+(D.missionIndex+1)+":",s,i+30*t++),Y.stroke(),t++,Y.font="36px Helvetica",Y.beginPath(),Y.fillText("Carry "+D.mission.path[0]+" to base "+D.mission.path[1],s+20,i+30*t++),Y.stroke(),D.mission.distanceToTarget&&(Y.font="20px Helvetica",Y.beginPath(),Y.fillText("Distance to target "+D.mission.distanceToTarget.toFixed(0)+" units ",s+20,i+30*t++),Y.stroke())}Y.restore()}}var W=document.createElement("canvas");W.id="canvas";var Y=W.getContext("2d");W.width=window.innerWidth,W.height=window.innerHeight,document.body.appendChild(W),cWidth=W.width,cHeight=W.height;var L=.98,X=cHeight-cHeight/10,D=new class{constructor(t,s){this.x=t,this.y=s,this.rocketRespawn=1,this.respawnPos={x:1*cWidth/2,y:X},this.screen=new I(1*window.innerWidth,1*window.innerHeight,Y),this.dificulty=1,this.stop=0,this.wind={x:0,y:0},this.planes=[],this.rockets=[],this.smoke=[],this.fires=[],this.pieces=[],this.bases=[],this.resources=[],this.rocket=null,this.lastRocketY=0,this.planeRespawn=1;let i=this.respawnPos.x;this.resources.push(new T("üçî","üè®",i-1500,X)),this.resources.push(new T("üßä","üè≠",i-2700,X)),this.resources.push(new T("üí∞","üè¶",i-3400,X)),this.resources.push(new T("üì¶","üè¨",i+400,X)),this.resources.push(new T("üéÅ","üè†",i+1500,X)),this.resources.push(new T("üßª","üè¨",i+2200,X)),this.resources.push(new T("ü©π","üè•",i+3600,X)),this.bases.push(new R("üëæ",i-2500,X-1100)),this.bases.push(new R("üëΩ",i-1e3,X-1100)),this.bases.push(new R("üõ∏",i+1500,X-1100)),this.bases.push(new R("üõ∞Ô∏è",i+3500,X-1100)),this.missionIndex=0,this.missions=[];let e="",h="";for(;this.missions.length<50;){let t=this.resources[Math.floor(Math.random()*this.resources.length)].name,s=this.bases[Math.floor(Math.random()*this.bases.length)].name;"‚õΩ"!=s.name&&h!=t&&e!=s&&(this.missions.push({path:[t,s]}),h=t,e=s)}this.mission=this.missions[this.missionIndex],this.missionCompleted=0,this.bases.push(new R("‚õΩ",i-300,X,100)),this.bases.push(new R("‚õΩ",i+2900,X,100)),this.newRocket(this.respawnPos),setTimeout((()=>{this.showHelp()}),100)}interpolate(t,s,i){return t+i/.99999*(s-t)}step(t){if(this.screen.update(t),this.stop)return;this.smoke=this.smoke.filter((t=>t.life>0)),this.rockets=this.rockets.filter((t=>t.life>0)),this.planes=this.planes.filter((t=>t.life>0)),this.pieces=this.pieces.filter((t=>t.life>0)),this.fires=this.fires.filter((t=>t.life>0)),this.resources.filter((t=>"‚õΩ"==t.building)).forEach((t=>{t.visible=0})),this.checkMissionStatus(),this.fires.forEach((s=>s.step(t))),this.rockets.forEach((s=>s.step(t))),this.planes.forEach((s=>s.step(t))),this.smoke.forEach((s=>s.step(t))),this.pieces.forEach((s=>s.step(t)));let s=1-this.rocket.altitude/this.rocket.altitudeMax;this.screen.scaleY=this.interpolate(.45,.9,s),this.screen.offsetY=this.interpolate(900,-100,s),this.screen.scaleX=this.screen.scaleY,this.screen.x=this.interpolate(cWidth/2,0,s)+this.rocket.velX/8,this.screen.offsetX=-this.rocket.x+this.respawnPos.x,this.bases.forEach((t=>{t.color=t.colorNormal}));let i=[];this.bases.filter((t=>"‚õΩ"==t.name)).forEach((t=>i.push(t))),i.length>0&&this.rockets.forEach((t=>{t.canFuel=0;let s=i[0];for(let e=1;e<i.length;e++)i[e].distance(t)<s.distance(t)&&(s=i[e]);null!=s&&(this.distance(s,t)<4*s.radius?(s.color=s.colorActive,t.canFuel=1):s.color=s.colorNormal)})),this.resources.length>0&&this.rockets.forEach((t=>{let s=this.resources[0];for(let i=1;i<this.resources.length;i++)this.resources[i].distance(t)<s.distance(t)&&(s=this.resources[i]);null!=s&&(this.distance(s,t)<3*s.radius?(s.color=s.colorActive,t.loaded&&t.load==s.name||s.name==this.mission.path[0]&&(t.loaded=1,t.load=s.name,s.visible=0)):s.color=s.colorNormal)})),this.rockets.forEach((t=>{this.bases.forEach((s=>{t.velY>0&&this.collideRect(t,s)&&(t.status="based")}))})),this.planes.forEach((t=>{this.rockets.forEach((s=>{this.collide(t,s)&&(s.destroyVehicle(),t.destroyVehicle())}))})),this.planes.forEach((t=>{t.x>this.rocket.x+1500&&(t.life=0),t.x<this.rocket.x-1500&&(t.life=0)})),this.planes.filter((t=>t.life>0)).length<this.dificulty&&this.newPlane(),this.rocketRespawn&&0==this.rockets.filter((t=>t.life>0))&&(setTimeout((()=>{this.newRocket(this.respawnPos),this.rocketRespawn=1}),4e3),this.rocketRespawn=0)}draw(t){t.clearRect(0,0,cWidth,cHeight),this.screen.drawScene(),this.screen.drawTarget(t),this.bases.forEach((t=>D.screen.drawItem(t))),this.resources.forEach((t=>D.screen.drawItem(t))),this.fires.forEach((t=>D.screen.drawItem(t))),this.pieces.forEach((t=>D.screen.drawItem(t))),this.rockets.forEach((t=>D.screen.drawItem(t))),this.planes.forEach((t=>D.screen.drawItem(t))),this.smoke.forEach((t=>D.screen.drawItem(t))),this.screen.draw(t),this.screen.drawMission(t)}thrusRocket(){this.rocket&&this.rocket.thrusRocket()}refuelRocket(){this.rocket&&this.rocket.refuelRocket()}destroyRocket(){this.rocket&&this.rocket.destroyVehicle()}moveRocket(t){this.rocket&&this.rocket.moveRocket(t)}newRocket(t){if(t=t||{x:cWidth/2,y:X},0==this.rockets.filter((t=>t.life>0))){let s=new E(t.x,t.y);s.addListener(this),this.rockets.unshift(s),this.rocket=this.rockets[0]}return this.screen.scaleX=1,this.screen.scaleY=1,this.screen.x=this.screen.x_original,this.screen.y=this.screen.y_original,this.fires=[],this.smoke=[],this.rocket}newPlane(){let t=Math.random()>=.5,s=t?this.rocket.x-1500:this.rocket.x+1500,i=X-180-400*Math.random(),e=Math.max(30,30+30*Math.random()),h=new P({x:s,y:i},{x:(t?1:-1)*e,y:0});h.addListener(this),this.planes.push(h)}smoking(t,s=8){if(1==F(1,3))return;let i=t.smokingPosition();for(let e=0;e<s;e++){i={x:i.x+20*(Math.random()-.5),y:i.y};let s={x:0,y:-10};null!=t.thrust&&(s={x:5*t.thrust.x+5*(Math.random()-.5),y:0-1*t.thrust.y+5*(Math.random()-.5)}),this.smoke.push(new v(i.x,i.y,s))}}exploding(t){let s=t.explodePosition(),i=new k(t.x,t.y);i.addListener(this),this.fires.push(i);for(let t=0;t<100;t++){s={x:s.x,y:s.y};let t={x:25*(Math.random()-.5),y:25*(Math.random()-.5)};this.smoke.push(new v(s.x,s.y,t,3,.1))}}distance(t,s){var i=s.x-t.x,e=s.y-t.y;return Math.sqrt(i*i+e*e)}collide(t,s){var i=s.x-t.x,e=s.y-t.y;return Math.sqrt(i*i+e*e)<t.radius+s.radius?1:0}collideRect(t,s){return t.x<s.x+s.width&&t.x+t.width>s.x&&t.y<s.y+s.height&&t.y+t.height>s.y?1:0}collideWithForce(t,s,i){var e=s.x-t.x,h=s.y-t.y,r=Math.sqrt(e*e+h*h),a=t.radius+s.radius;if(r<a){var o=t.x+e/r*a,l=t.y+h/r*a,n=o-s.x,c=l-s.y;return n*=i.x,c*=i.y,t.vx-=n,t.vy-=c,s.vx+=n,s.vy+=c,1}return 0}showHelp(){this.screen.modal.visible=1,this.stop=1}checkMissionStatus(){if(this.mission){let t=this.mission.path[0],s=this.resources.filter((s=>s.name==t))[0];null!=s&&(s.visible=1,s.animate=1);let i=this.mission.path[1],e=this.bases.filter((t=>t.name==i))[0];null!=e&&(e.visible=1,e.animate=1,this.mission.distanceToTarget=-50+e.distance(this.rocket),this.mission.distanceToTarget<e.radius&&"based"==this.rocket.status&&this.rocket.loaded&&this.rocket.life>0&&this.missionHasCompleted())}}missionHasCompleted(){this.missionCompleted||(setTimeout((()=>{D.nextMission()}),200),this.missionCompleted=1)}nextMission(){this.missionIndex++,this.missionIndex>this.missions.length-1&&(this.missionIndex=0),this.mission=this.missions[this.missionIndex],this.missionCompleted=0,this.rocket.loaded=0,this.dificulty++}}(cWidth/2,X-600);function F(t,s){return Math.floor(Math.random()*(s-t+1))+t}var H={x:0,y:0},V=0;W.addEventListener("mousemove",(function(t){H.x=t.offsetX||t.layerX,H.y=t.offsetY||t.layerY})),W.addEventListener("mousedown",(function(t){V=1})),W.addEventListener("mouseup",(function(t){V=0,0})),W.addEventListener("contextmenu",(function(t){return t.preventDefault(),t.stopPropagation(),0}));var q=function(){!function(t){g.up&&D.thrusRocket(),g.quit==g.state.ACTIVE&&(D.destroyRocket(),g.quit=g.state.INACTIVE),g.new==g.state.ACTIVE&&(D.newRocket(),g.new=g.state.INACTIVE),g.help&&D.showHelp(),g.left&&D.moveRocket(-1),g.right&&D.moveRocket(1),g.refuel&&D.refuelRocket(),D.step(t)}(.2),D.draw(Y),requestAnimationFrame(q)},B=window;requestAnimationFrame=B.requestAnimationFrame||B.webkitRequestAnimationFrame||B.msRequestAnimationFrame||B.mozRequestAnimationFrame,addEventListener("keydown",(function(i){var m=i.keyCode;m!=t&&m!=c||(g.right=1),m!=s&&m!=d||(g.up=1),m!=e&&m!=f||(g.left=1),m!=h&&m!=u||(g.down=1),m==y&&(g.espace=1),m==p&&(g.enter=1),m==a&&(g.help=1),m==n&&(g.help=1),m==r&&(g.refuel=1),m==o&&g.new==g.state.RELEASED&&(g.new=g.state.ACTIVE),m==l&&g.model==g.state.RELEASED&&(g.model=g.state.ACTIVE),m==x&&g.quit==g.state.RELEASED&&(g.quit=g.state.ACTIVE)})),addEventListener("keyup",(function(i){var m=i.keyCode;m!=t&&m!=c||(g.right=0),m!=s&&m!=d||(g.up=0),m!=e&&m!=f||(g.left=0),m!=h&&m!=u||(g.down=0),m==y&&(g.espace=0),m==p&&(g.enter=0),m==a&&(g.help=0),m==n&&(g.help=0),m==r&&(g.refuel=0),m==o&&(g.new=g.state.RELEASED),m==l&&(g.model=g.state.RELEASED),m==x&&(g.quit=g.state.RELEASED)})),CanvasRenderingContext2D.prototype.roundRect=function(t,s,i,e,h){return i<2*h&&(h=i/2),e<2*h&&(h=e/2),this.beginPath(),this.moveTo(t+h,s),this.arcTo(t+i,s,t+i,s+e,h),this.arcTo(t+i,s+e,t,s+e,h),this.arcTo(t,s+e,t,s,h),this.arcTo(t,s,t+i,s,h),this.closePath(),this},q();