<title>Alley Cat Noir - js13kGames 2025</title><meta name=viewport content="width=device-width,maximum-scale=1,user-scalable=no"><style>body,html{overflow:hidden}body{margin:0;padding:0;display:flex;place-content:center}body,canvas{background-color:#000}#screen{flex:1;align-self:center}</style><canvas id=screen></canvas><script>let L,o="Alley Cat Noir",d="v0.13.31235615088",F=("#0000"),h="#100e23",i="#0f0d1cff",M="#100e2388",j="#100e23c0",q="#533",H="#432",V="#423e44",U="#332",Q="#442",J="#353",K="#240",Z="#335",_="#424",s="#eef",p="#eefa",u=64,y=10,ee=u*y,t=160,te=6e4/t,oe=te/1.5,ae=te/1e3,le=te/2,ie=te/4,re=24,se=2147483647,{min:C,max:ne,ceil:f,round:de,cos:pe,sin:m,hypot:a,atan2:l,asin:ce,abs:g,sign:he,pow:ue,random:ye,PI:x,SQRT2:fe}=Math,v=2*x,me=x/2,ge=e=>e>x?e-v:e,b=(e=0,t=0)=>({x:e,y:t}),w=(e,t=1)=>b(e.x*t,e.y*t),xe=(e,t=0)=>b(e.x*pe(t)-e.y*m(t),e.x*m(t)+e.y*pe(t)),T=e=>a(e.x,e.y),ve=e=>ge(l(e.y,e.x)),be=(e=b(1,0))=>w(e,1/T(e)),k=(e=b(),t=b())=>b(e.x+t.x,e.y+t.y),S=(e=b(),t=b())=>b(e.x-t.x,e.y-t.y),we=(e=b,t=b())=>T(S(e,t)),Te=(e=0)=>b(pe(e),m(e)),ke=(e,t,o,a)=>{var l=S(t,e),i=S(a,o),r=t.x-e.x,s=t.y-e.y;if(0!=(i=l.x*i.y-i.x*l.y)&&(l=((a.y-o.y)*(a.x-e.x)+(o.x-a.x)*(a.y-e.y))/i,o=((e.y-t.y)*(a.x-e.x)+r*(a.y-e.y))/i,0<=l&&l<=1&&0<=o&&o<=1))return b(e.x+l*r,e.y+l*s)},Se=(e,t=2)=>e.toFixed(t),O=()=>Date.now(),E=(e=0,t=e=>e)=>new Array(e).fill(0).map((e,t)=>t).map(t),Ce=(e,t,o=0)=>e+o*(t-e),Oe=e=>0===e?0:1===e?1:e<.5?2**(20*e-10)/2:(2-2**(-20*e+10))/2,Ee=e=>-(pe(x*e)-1)/2,Ae=(e,t,o)=>{let a=((t+v)%v-(e=(e+v)%v)+v)%v;return a>x&&(a-=v),(e+a*o+v)%v},Ie=(e,t,o)=>b(Ce(e.x,t.x,o),Ce(e.y,t.y,o)),c=(e=0,t=0,o=0)=>(e=458671337*((e=1759714724+((e=3039394381*(e%=se)+(49632*t^325176*o))^e>>8))^e<<8))^e>>8,A=(...e)=>c(...e)/se,Pe=(...e)=>255&c(...e),I=(...e)=>2*A(...e)-1,Re=(...e)=>1&c(...e),Ne=(...e)=>2*Re(...e)-1,P=(e,t,o,a=10)=>A(e,t,o)*a|0,R=(...e)=>xe(b(0,1),I(...e)*x),N=(e,t,o,a)=>a.at(P(e,t,o,a.length)),We=(...e)=>I(...e)*x,Be=(e,t,o,a=[])=>{let l=e;return a.slice().sort(()=>(l=c(l,t,o))/se*2-1)},e=(e,t,o,...a)=>e.addEventListener(t,o,...a),W=(e,t)=>e.forEach(t),B=(e=64,t=64,o)=>{let a=(o=o??new OffscreenCanvas(e,t)).getContext("2d"),l={screen:o,ctx:a,w:e,h:t,w2:e/2,h2:t/2,do:e=>(l.save(),e(l),l.restore(),l),clear:()=>(a.clearRect(0,0,e,t),l),center:()=>(a.translate(l.w2,l.h2),l)};return W(["save","restore","translate","rotate","drawImage","putImageData","beginPath","closePath","moveTo","lineTo","bezierCurveTo","arc","ellipse","fill","fillRect","fillText","stroke","strokeText","strokeRect","clearRect"],e=>l[e]=(...t)=>(a[e](...t),l)),W(["font","filter","fillStyle","lineWidth","lineCap","strokeStyle","globalCompositeOperation","globalAlpha","imageSmoothingEnabled","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],e=>l[e]=t=>(a[e]=t,l)),l},Ge=(e=O(),t=64,o=64)=>{var a=B(t,o),l=a.ctx.createImageData(t,o),i=l.data;for(let a=0;a<t;a++)for(let l=0;l<o;l++){var r=Pe(e,a,l),s=4*(a+l*t);i[s]=r,i[1+s]=r,i[2+s]=r,i[3+s]=r}return a.putImageData(l,0,0)},ze=(e=O(),t=128,o=128,a=2)=>{var l=B(t,o),i=Math.sqrt(t**2+o**2),r=i/2,s=l.w2-2*a,n=.9*a;let d=Ne(e,t,o),p=l.h2-r+A(e,t+a,o-a)*a,c=l.w2+(d*s+I(e,0,p)*a);for(l.strokeStyle("#fff").lineWidth(a).save().translate(l.w2,l.h2).rotate(I(e,t+c,o+p)*x).translate(-l.w2,-l.h2).beginPath().moveTo(c,p);p<i;)d*=-1,c=l.w2+(d*r+I(e,c,p)*a),p+=n+I(e,c,p),l.lineTo(c,p);return l.stroke().restore()},De=(e,t=0,o=2,a=!0)=>(o=B(e.w,e.h).drawImage(ze(t,e.w,e.h,o).screen,0,0),a&&e.globalCompositeOperation("destination-in").drawImage(Ge(t,e.w,e.h).screen,0,0),o.globalCompositeOperation("source-in").drawImage(e.screen,0,0).globalCompositeOperation("source-over")),Le=(e,t=[],o,a=h)=>e.do(e=>{let l=t.length;e.fillStyle(a).beginPath(),W(t,(a,i)=>{var[r]=t.at(i-1),[a]=a,[i]=t.at((i+1)%l),s=(r=S(r,a),T(r)),r=be(r),n=(i=S(i,a),T(i)),d=(i=be(i),r.x*i.y-r.y*i.x),p=r.x*i.x-r.y*i.y;let c=ce(ne(-1,C(1,d))),h=1,u=!1;p<0?c<0?c=x+c:(c=x-c,h=-1,u=!0):0<c?(h=-1,u=!0):c=v+c;let y=g(pe(d=c/2)*o/m(d)),f=o;y>(p=C(s/2,n/2))&&(y=p,f=g(y*m(d)/pe(d))),s=k(k(a,w(i,y)),w(b(-i.x,i.y),f*h)),e.arc(s.x,s.y,f,ve(r)+me*h,ve(i)-me*h,u)}),e.closePath().fill()}),Xe=(e=O(),t=u,o=u,a,l=10,i,r)=>{var s=t/4,n=o/4;let d=C(t,o)/2,p=P(e,s,n,7)+10,c=v/p;return(a??B(t,o)).do(a=>{var i=E(p,t=>(t+I(e,t,1)/5)*c-x).sort((e,t)=>e-t).map((a,l)=>[w(b(pe(a),m(a)),(1-A(e,t+l,7*l-o)/3)*d),a]);a.center(),Le(a,i,l,h)})},Ye=new WeakMap,$e=(e,t,o,a,l,i=!0)=>({w:t,h:o,w2:t/2,h2:o/2,bg:B(t,o),scribble:ze(e.seed,t,o,l).fillStyle(a).do(e=>e.globalCompositeOperation("source-in").fillRect(0,0,t,o)),noise:i?Ge(e.seed,t,o):B(t,o).fillRect(0,0,t,o),final:B(t,o),color:a}),Fe=e=>Ye.has(e),G=(e,t,o,a=s,l=2,i=!0)=>{let r=Ye.get(e);return r||(r=$e(e,t,o,a,l,i),Ye.set(e,r)),r},Me=e=>Ye.delete(e),z=(e,t=!1)=>{e.final.do(t=>t.clear().drawImage(e.noise.screen,0,0).globalCompositeOperation("source-in").drawImage(e.scribble.screen,0,0).globalCompositeOperation("destination-in").drawImage(e.bg.screen,0,0).globalCompositeOperation("destination-over").drawImage(e.bg.screen,0,0)),t&&(e.bg=null,e.scribble=null,e.noise=null)},je=()=>({dumpsters:[],lights:[],puddles:[],splatters:[],papers:[],bags:[],boxes:[],doors:[],sewers:[],rats:[],dogs:[],humans:[]}),r=(e=O(),t=0,o=0,a=0)=>({seed:e,position:b(t,o),rot:a}),qe=(e,t,o,a)=>({...r(e,t,o,a),home:null,speed:2,target:null,action:null,path:[],easeFunction:Ee}),He=(e="idle",t=b(),o=b(),a=te/2,l=S(o,t))=>({kind:e,dur:a,from:t,to:o,rot:ge(-ve(l)-me),length:T(l),elapsed:0}),Ve=(e,t,o,a)=>({...r(e,t,o,a),coa:b(),zoom:C(window.innerWidth,window.innerHeight,1.5*ee)/ee/1.5,follow:!0}),Ue=(e,t,o,a)=>({...r(e,t,o,a),offset:I(e,t+1,o-7),radius:4+I(e,t,o),brightness:.5+.5*A(e,o+4,t-1)}),Qe=(e,t,o,a,l=2)=>({...r(e,t,o,a),diameter:l,radius:l/2}),Je=(e,t,o,a,l=1,i=q)=>({...r(e,t,o,a),diameter:l,radius:l/2,color:i}),Ke=(e,t,o,a,l=2,i=U)=>({...r(e,t,o,a),diameter:l,radius:l/2,color:i}),Ze=(e,t,o,a)=>({...r(e,t,o,a),diameter:5.25,radius:2.625,width:4,height:3.25,visited:!1,contents:[]}),_e=(e=O())=>({...qe(e),home:Ze(e),speed:4,reach:2,lives:9,kills:0,streak:0,maxStreak:0,distance:0,distanceTotal:0,score:0,multiplier:1,dead:!1,sticky:!1,easeFunction:Oe}),et=(e,t,o,a,l=1.5)=>({...r(e,t,o,a),contents:[],radius:l/2,diameter:l,color:N(e,t,o,[V,Q,i])}),tt=(e,t,o,a)=>({...qe(e,t,o,a),radius:.5,diameter:1}),ot=E(y-1,e=>E(y-1,t=>b(e-(y-2)/2,t-(y-2)/2))).flat(),at=ot.filter(e=>(e.x+e.y)%2==0),lt=[[-5,-5],[5,5],[-5,5],[5,-5]].map(e=>b(...e)),it=ot.filter(e=>(e.x+e.y)%2&&2.5<T(e)),rt=(e,t,o,a)=>{var l=!!(a.x%10),i=!!(a.y%10),r=l?(a.x%10+10)%10:i?(a.y%10+10)%10:0;let s={seed:e,position:b(t,o),address:a,horizontal:l,vertical:i,type:r,...je()},n=2,d=1;return 0==r?(n+=3,0===t&&0===o?(s.dumpsters.push(L.player.home),L.player.home.visited=!0):Re(e,t,o)&&s.dumpsters.push(Ze(e,t+I(e+1,t,o),o,We(e,t+23,o-8))),Be(e-13,t-5,o+5,lt).slice(4-P(e,5,5,4)).forEach((a,l)=>{l=Ue(e+l,a.x+t,a.y+o),s.lights.push(l)}),d+=2):2==r||5==r||8==r?(n+=2,a=Ne(e-7,t,o),i=k(s.position,w(l?b(0,-5):b(-5,0),a)),(r=Ue(e+13,i.x,i.y)).radius+=2,s.lights.push(r),d+=1):(n+=5,d+=3),n=Be(e,t,o,at).slice(0,n).map(t=>k(w(R(e,t.x+7367,t.y-87863),.5),k(t,s.position))),d=Be(e,t,o,it).filter(e=>!s.vertical||2<g(e.y)||!s.horizontal||2<g(e.x)).slice(0,d).map(t=>k(w(R(e,t.x-7367,t.y+87863),.5),k(t,s.position))),E(P(e,t/3+23,6*o-2,C(3,n.length)),t=>{var o=n.shift();s.puddles.push(Qe(c(e,o.x,o.y),o.x,o.y,We(e,o.x/7,1.3*o.y),2+2*A(e,o.y/2,3*o.x)))}),E(P(e,t/3+23,6*o-2,C(2,n.length)),t=>{var o=n.shift(),a=c(e,o.x,o.y);s.splatters.push(Je(a,o.x,o.y,We(e,o.x/7,1.3*o.y),1+2*A(e,o.y/2,3*o.x),N(a,o.x,o.y,[p,q,K,Z,Q])))}),E(n.length,t=>{var o=n.shift(),a=c(e,o.x,o.y);s.papers.push(Ke(a,o.x,o.y,We(e,o.x/7,1.3*o.y),1+1.5*A(e,o.y/2,3*o.x),N(a,o.x,o.y,[U,_,V,H])))}),l=d.pop(),s.rats.push(tt(e,l.x,l.y)),E(d.length,t=>{var o=d.shift();s.bags.push(et(c(e,o.x,o.y),o.x,o.y,We(e,o.x/7,1.3*o.y),1+1.5*A(e,o.y/2,3*o.x)))}),s},st=(e=O()%se)=>({seed:e,totaltime:0,now:0,frame:0,gametime:0,speed:1,paused:!0,camera:Ve(e),player:_e(e),numbers:[c(e,13)*Ne(e,13,1),c(e,42)*Ne(e,42,1)],blocks:{},rats:[],dogs:[],humans:[],activeBlocks:[],activeGroups:je()}),nt=De(B(360,360).fillStyle("#fff").font("bold 72px sans-serif").do(e=>{W(o.split(" "),(t,o)=>{let a=(e.w-e.ctx.measureText(t).width)/2;e.do(e=>e.fillText(t,a,60+72*o).filter("blur(10px)").fillStyle("#fff8").fillText(t,a-8,68+72*o))}),e.font("32px monospace");var t=ne(0,(e.w-e.ctx.measureText(d).width)/2);e.fillText(d,t,260)}),1313),dt=B(21,21).do(e=>{e.center().fillStyle("#000").fillRect(-9.5,-9.5,9,9).fillRect(-9.5,.5,9,9).fillRect(.5,-9.5,9,9).fillRect(.5,.5,9,9)}),pt=(e,t=256,o=Z,a=1)=>((o=G(e,t,t,o,a)).bg.do(o=>{o.center().fillStyle(j).beginPath(),E(P(e.seed,e.position.x,e.position.y,11)+10,o=>w(R(e.seed,e.position.x-3*o,e.position.y+17*o),t/2-8)).map(t=>w(t,A(e.seed,t.x,t.y))).forEach(a=>{var l=C(t/4,ne(5,t/2.2-T(a))),i=l/2;o.moveTo(a.x,a.y).ellipse(a.x,a.y,i+i*A(e.seed,a.x,a.y),l,-ve(a),0,v)}),o.fill()}),z(o,!0),o),ct=(e,t=256,o=q,a=3)=>{o=G(e,t,t,o,a);let l=P(e.seed,e.position.x,e.position.y,11)+10,i=t/4,r=v/l;return o.bg.do(o=>{o.center().rotate(e.rot).fillStyle(h).beginPath();let a=E(l,t=>w(Te(t*r),i*(2.2+.25*I(e.seed,e.position.x+t,r-t)))).map(t=>{var a=i+T(t)/5,l=i/1.5-T(t)/11,r=I(e.seed,t.x,t.y)/8;return o.moveTo(t.x,t.y).ellipse(t.x,t.y,a,l,r+ve(t),0,v),[t,l,r,a]});var s=w(R(e.seed,e.position.x,e.position.y),4),n=w(R(e.seed,e.position.x,e.position.y),4);(s=o.ctx.createRadialGradient(s.x,s.y,1,n.x,n.y,t/2.25)).addColorStop(0,h),s.addColorStop(.3,h),s.addColorStop(.86,M),s.addColorStop(.9,F),o.fill().globalCompositeOperation("source-out").fillStyle(s).beginPath().moveTo(0,0).arc(0,0,1.76*i,0,v).fill().globalCompositeOperation("source-over").fillStyle(h).beginPath().moveTo(0,0),W(a,(t,l)=>{l=a.at(l-1),t=w(k(t[0],l[0]),.5),t=w(t,1-.65*A(e.seed,t.x,t.y)),l=w(R(e.seed,t.x,t.y),4),o.lineTo(t.x,t.y).arc(t.x,t.y,3+I(e.seed,l.x,l.y),0,v).lineTo(t.x,t.y).lineTo(l.x,l.y)}),o.fill()}),z(o,!0),o},ht=(e,t="sans-serif")=>B(256,256).do(o=>{let a=0;o.strokeStyle(h).fillStyle(s).globalAlpha(.25),W(e.split("\n"),e=>{o.font("10px bold "+t);var l=256/o.ctx.measureText(e).width,i=C(10*l|0,96);l=(256-(o.font(i+"px bold "+t),i=o.ctx.measureText(e)).width)/2,a+=1.2*i.actualBoundingBoxAscent,o.strokeText(e,l,a).fillText(e,l,a)})}),ut=["MORNING\nNEWS\nðŸŒ‡","SALE!\nðŸ’µ","ALBUM\nRELEASE\nðŸŽ¸","LIVE\nMUSIC\nTONIGHT","EXTRA!\nEXTRA!\nâ€¼ï¸","SHOW\n9pm-1am\nðŸŽ­","BEWARE\nOF\nDOG","BEWARE\nOF\nðŸ¶","WANTED\nðŸˆâ€â¬›","ALLEY\nCAT NOIR","js13k\ngames\n2025","MISSING\nðŸ±","LOST\nðŸ•"].map(e=>["serif","sans-serif"].map(t=>ht(e,t))).flat(),yt=(e,t=256,o=V,a=4)=>{o=G(e,t,t,o,a);let l=t/fe,i=l*(1-.3*A(e.seed,e.position.x,e.position.y));return o.bg.do(t=>{t.center().rotate(e.rot).fillStyle(h).lineWidth(2).fillRect(-i/2,-l/2,i,l)}),o.scribble.do(t=>{var o=N(e.seed,e.position.x,e.position.y,ut);t.center().rotate(e.rot).drawImage(o.screen,0,0,256,256,-i/2,-l/2,i,l)}),z(o,!0),o},ft=(e,t=f(e.diameter*u),o=e.color,a=3)=>{o=G(e,t,t,o,a),Xe(e.seed,t,t,o.bg);let l=I(e.seed,e.position.x,t-a)*x,i=(o.bg.do(o=>o.fillStyle(h).center().beginPath().moveTo(0,0).ellipse(0,0,t/(2.5+A(e.seed,e.position.y,t+a)/5),t/2.5,l,0,v).fill()),t/8),r=t/4,s=Xe(e.seed+r,r,r).globalCompositeOperation("source-in").fillStyle(o.color).fillRect(0,0,r,r);return o.scribble.do(e=>e.center().rotate(-l).shadowColor(h).shadowBlur(3).shadowOffsetX(0).shadowOffsetY(0).lineWidth(3).strokeStyle(h).beginPath().moveTo(0,0).bezierCurveTo(12+r,-i-10,10+r,i-10,0,0).bezierCurveTo(10+r,10-i,8+r,10+i,0,0).stroke().strokeStyle(q).beginPath().moveTo(0,0).bezierCurveTo(12+r,-i-10,10+r,i-10,0,0).bezierCurveTo(10+r,10-i,8+r,10+i,0,0).stroke().shadowBlur(1).globalCompositeOperation("destination-out").drawImage(s.screen,-i-2,-i-2,4+r,4+r).shadowBlur(0).globalCompositeOperation("source-over").drawImage(s.screen,-i,-i,r,r)),o.noise.do(e=>e.center().rotate(-l).globalCompositeOperation("source-over").globalAlpha(.5).lineWidth(3).beginPath().moveTo(0,0).bezierCurveTo(12+r,-i-10,10+r,i-10,0,0).bezierCurveTo(10+r,10-i,8+r,10+i,0,0).stroke().drawImage(s.screen,-i,-i,r,r).globalCompositeOperation("destination-out").globalAlpha(1).drawImage(s.screen,-10,-10,20,20)),z(o,!0),o},mt=(e,t=ee,o=i,a)=>{var l={w:t,h:t,w2:t/2,h2:t/2,color:o,final:B(t,t)};Ye.set(e,l);let r=t/u/2|0,s=t/r;return l.final.do(a=>{a.filter("blur(4px)").translate(s/2,s/2).fillStyle(o).beginPath(),E(r,t=>E(r,o=>{let l=m(t/(r-1)*x)*m(o/(r-1)*x),i=4+P(e.seed,t+o,o*t+7,6),n=v/i;E(i,a=>(a+A(e.seed,o+2,t-8)*v+A(e.seed,t+t*o+a+i,o+t-i*a)/5)*n).map((a,i)=>w(k(b(t,o),w(Te(a),.47+A(e.seed,a*l-o*t,4*o+t)*l/3)),s)).forEach((e,t,o)=>{0===t&&(t=o.at(-1),a.moveTo(t.x,t.y)),a.lineTo(e.x,e.y)})})),a.fill().translate(-s/2,-s/2),a.globalCompositeOperation("destination-in").globalCompositeOperation("destination-out").globalAlpha(.65).drawImage(Ge(e.seed,r,r).screen,0,0,t,t)}),l},gt=(e,t=2*e.radius,o="#fff8",a=5)=>{o=G(e,t,t,o,a,!1);let l=w(R(e.seed,e.position.x,e.position.y),4),i=w(R(e.seed,e.position.x,e.position.y),4),r=o.bg.ctx.createRadialGradient(l.x,l.y,1,i.x,i.y,t/2.25);return a=E(3,t=>I(e.seed,l.x+t,i.y-t)/9).sort(),r.addColorStop(0,p),r.addColorStop(.23+a[0],Q),r.addColorStop(.42+a[1],s),r.addColorStop(.7+a[2],Q),r.addColorStop(1,F),o.bg.do(e=>e.center().globalAlpha(.25).fillStyle(r).beginPath().arc(0,0,t/2-8,0,v).fill()),o.scribble.do(e=>e.center().fillStyle(h).beginPath().arc(0,0,13,0,v).fill()),z(o,!0),o},xt=e=>{var t=e.diameter*u|0;let o=e.width*u,a=o/2,l=e.height*u,i=l/2;return(t=G(e,t,t,J,3)).bg.do(t=>{t.center().rotate(e.rot).fillStyle(h).strokeStyle(h).lineWidth(3).fillRect(4-a,4-i,o-8,l-8).strokeRect(-a-4,-i-4,8+o,16)}),t.scribble.do(t=>{var r=et(e.seed+1,0,0,We(e.seed+1,0,0),f(1.5+A(e.seed+1,0,0))),s=a-r.radius*u-12,n=i-r.radius*u-8;t.center().rotate(e.rot).fillStyle(M).globalCompositeOperation("destination-out").fillRect(16-a,16-i,o-32,l-32).globalCompositeOperation("source-over").globalAlpha(.7).drawImage(ft(r).final.screen,-r.radius*u+I(r.seed,8,23)*s,-r.radius*u+I(r.seed,2,1)*n)}),z(t,!0),t},vt=e=>{var t=L.gametime,o=G(e,1.5*u,1.5*u,U,3),a=m(t/le);t=.25*m(t/te);let l=b(3*-a,-10),i=b(0,-1),r=.25*a,s=xe(b(0,45),-t);o.bg.save().clear().fillStyle(h).strokeStyle(h).lineWidth(4).lineCap("round").center().rotate(-e.rot).do(e=>e.translate(l.x,l.y).rotate(r).beginPath().moveTo(0,-30).lineTo(5,-0).lineTo(-5,-0).closePath().fill().stroke()).do(e=>e.beginPath().ellipse(i.x,i.y,9,17,0,0,v).closePath().fill()).do(t=>{e.dead||t.lineWidth(3).beginPath().moveTo(0,8).bezierCurveTo(.5*s.x,25,-.25*s.x,.8*s.y+g(s.x)/2,s.x,s.y).stroke()}).restore(),X.touchScreen&&!X.touch||Pt(X.path.slice(e.path.length?1:0)),Pt([e.position,...e.path],J,1),z(o),e.dead&&(D.globalAlpha=.5),Y(o,e,p),e.dead&&(D.globalAlpha=1)},n=document.getElementById("screen"),D=n.getContext("2d"),bt=e=>(e=b(...[e.x,e.y].map(e=>de(e/y)))).x%10&&e.y%10?null:e,X={...r(O(),0,0),real:b(),click:!1,touchScreen:!1,touch:!1,target:null,path:[],dist:0},wt=(window.mouse=X,(e,t,o=2,a=!0,l=0)=>{var i=[],r=bt(e),s=bt(t);if(r&&s){var n=S(t,e);let h;T(n);var d=y/2;if(r.x!==s.x&&r.y!==s.y){let o,a;a=r.y%10?(o=b(r.x,s.y),b(he(n.x)*d,-he(n.y)*d)):(o=b(s.x,r.y),b(-he(n.x)*d,he(n.y)*d)),a=w(a,(d-.5)/d),s=k(w(r,y),a),d=k(w(o,y),a),ke(e,t,s,d)&&(h=k(w(o,y),a))}if(h)i.push(...wt(e,h,o,!1,l+1)),i.push(...wt(h,t,o,a,l+2));else{r=T(n);var p=f(r/o),c=w(n,1/p);i.push(e);let t=e;for(let e=0;e<p;e++)t=k(t,c),i.push(t)}}return i}),Tt=()=>{var{x:e,y:t}=X.real,{camera:o,player:a}=L,l=n.width/2,i=n.height/2,r=1/(o.zoom*u),e=(X.position=k(xe(w(S(b(e,t),b(l,i)),r),o.rot),o.position),X.rot),t=(X.rot=ge(-ve(S(X.position,a.position))-me),isNaN(X.rot)&&(X.rot=e),bt(X.position));if(X.path.length=0,t){let e=L.activeGroups.dumpsters.find(e=>{var t=xe(S(e.position,X.position),-e.rot);if(T(t)<=e.diameter)return g(t.x)<=e.width/2&&g(t.y)<=e.height/2});e=(e=e||L.activeGroups.rats.map(e=>[e,we(e.position,X.position)]).filter(([e,t])=>t<e.radius).sort((e,t)=>e[1]-t[1])[0]?.[0])||L.activeGroups.bags.map(e=>[e,we(e.position,X.position)]).filter(([e,t])=>t<e.radius).sort((e,t)=>e[1]-t[1])[0]?.[0],X.target=e,l=a.path[0]??a.position,(i=!!a.path[0])&&X.path.push(a.position),X.path.push(...wt(l,(e??X).position,a.speed)),X.click&&(a.path.splice(1,a.path.length-1,...X.path.slice(i?2:1)),a.target=X.target)}X.click=!1},kt=(e=0)=>{var t,o=L.player,a=o.rot;o.dead||(o.path.length||o.action?(t=o.action)?"jumping"===t.kind&&(t.elapsed=C(t.elapsed+e,t.dur),e=o.easeFunction(t.elapsed/t.dur),e=Ie(t.from,t.to,e),isNaN(e.x)||isNaN(e.y)||(o.position=e),o.rot=Ae(o.rot,t.rot,.1),t.elapsed>=t.dur)&&((e=o.distance+t.length)%10<t.length&&(o.score+=o.multiplier),e%1e3<t.length&&(o.multiplier+=1),o.distance+=t.length,o.distanceTotal+=t.length,o.path.shift(),o.action=null):o.path.length&&(e=o.path[0],t=S(e,o.position),t=ne(10,f(T(t)/o.speed*te)),o.action=He("jumping",o.position,e,t)):X.touchScreen&&!X.touch||(o.rot=Ae(o.rot,X.rot,.1))),isNaN(o.rot)&&(o.rot=a)},St=()=>{var e,t,o=bt(L.player.position);if(o){L.activeBlocks.length=0;let a=Object.entries(L.activeGroups);a.forEach(e=>{e[1].length=0});for(let a=o.x-2;a<o.x+3;a++)for(let l=o.y-2;l<o.y+3;l++)a%10&&l%10||(e=a+","+l,L.activeBlocks.push(e),L.blocks[e])||(t=w(b(a,l),y),t=rt(c(L.seed,t.x,t.y),t.x,t.y,b(a,l)),L.blocks[e]=t);L.activeBlocks.map(e=>L.blocks[e]).forEach(e=>{Fe(e)||mt(e,ee),a.forEach(([t,o])=>o.push(...e[t]))}),W(Object.entries(L.blocks),([e,t])=>{L.activeBlocks.includes(e)||(Me(t),W(Object.keys(je()),e=>W(t[e],e=>Me(e))))})}},Ct=(e,t=2,o=8)=>{if(0!==e&&!L.paused){let{camera:l,player:i}=L;e=S(i.position,l.position);var a=T(e);o<a&&(l.position=k(l.position,w(be(e),a-o)));let r=[X].filter(e=>e===X||we(e.position,i.position)<=o).map((e,t)=>S(e.position,i.position)).reduce((e,t,o,a)=>k(e,w(t,1/a.length/2)),b()),s=T(r);isNaN(s)&&(r=b(),s=0),e=S(k(i.position,s?w(be(r),C(o,s)):b()),l.position),a=T(e),l.coa=a<t?e:w(be(e),t),l.position=k(l.position,w(l.coa,.1)),a=l.follow?-i.rot:0,l.rot=Ae(l.rot,a,.01),isNaN(l.rot)&&(l.rot=a)}},Ot=(e=O())=>{L=st(e),St()},Et=(Ot(),window.doNewGame=Ot,e=>{jt(e),Tt(),Ct(e),St(),kt(e)}),Y=(e,t,o)=>{o=o??e.shadow,t=t.position,D.save(),D.translate(t.x*u,t.y*u),o&&(D.shadowColor=o,D.shadowBlur=1,D.shadowOffsetX=0,D.shadowOffsetY=0),D.drawImage(e.final.screen,-e.w2,-e.h2),D.restore()},At=(e,t=p,o=h)=>((o=G(e,32,32,o)).bg.do(o=>o.clear().fillStyle(t).lineCap("round").center().rotate(-e.rot).beginPath().moveTo(-10,-2).ellipse(-10,-2,3,4,-.5,0,v).moveTo(-4,-7).ellipse(-4,-7,3,4,-.15,0,v).moveTo(4,-7).ellipse(4,-7,3,4,.15,0,v).moveTo(10,-2).ellipse(10,-2,3,4,.5,0,v).moveTo(0,3).ellipse(0,3,5,4,0,0,v).moveTo(-5,8).ellipse(-5,8,5,4,0,0,v).moveTo(5,8).ellipse(5,8,5,4,0,0,v).fill()),z(o),o),It=At(X),Pt=(e=[],t=p,o=.5)=>{e.length<2||(D.save(),D.globalAlpha=o,D.lineWidth=1,D.setLineDash([2,3]),D.strokeStyle=t,D.beginPath(),e.length,e.forEach((e,t)=>{var o=e.x*u;e=e.y*u,t&&(D.lineTo(o,e),D.arc(o,e,7,0,v)),D.moveTo(o,e)}),D.stroke(),D.restore())},Rt=e=>{Fe(e)||pt(e,f(e.diameter*u)),Y(G(e),e)},Nt=e=>{Fe(e)||ct(e,f(e.diameter*u),e.color??Q),Y(G(e),e)},Wt=e=>{Fe(e)||yt(e,f(e.diameter*u),e.color),Y(G(e),e)},Bt=(e,t,o)=>{Fe(e)&&!o||t(e),o=G(e),Y(o,e,X.target===e?s:o.shadow)},Gt=()=>{let{player:e,gametime:t}=L;var o=h,a=G(e,256,256,"#000",3),l=m(t/ie),i=.5*m(t/le);let r=b(3*l,-45),s=b(0,0),n=.25*l,d=xe(b(0,116),-i);a.bg.save().clear().fillStyle(o).strokeStyle(o).lineWidth(2).lineCap("round").center().rotate(-e.rot).do(e=>e.translate(r.x,r.y).rotate(n).beginPath().ellipse(0,0,35,30,0,0,v).closePath().fill().beginPath().moveTo(0,5).lineTo(-50,0).moveTo(0,5).lineTo(-50,-10).moveTo(0,5).lineTo(-50,10).moveTo(0,5).lineTo(50,0).moveTo(0,5).lineTo(50,-10).moveTo(0,5).lineTo(50,10).stroke().globalCompositeOperation("destination-out").fillRect(-20,-32,42,20).globalCompositeOperation("source-over")).do(e=>e.beginPath().ellipse(s.x,s.y,30,27.5,0,0,v).closePath().fill()).do(t=>{e.dead||t.lineWidth(6).beginPath().moveTo(0,27.5).bezierCurveTo(.5*d.x,55,-.25*d.x,.8*d.y+g(d.x)/2,d.x,d.y).stroke()}).restore(),X.touchScreen&&!X.touch||Pt(X.path.slice(e.path.length?1:0)),Pt([e.position,...e.path],J,1),z(a),e.dead&&(D.globalAlpha=.5),Y(a,e,p),e.dead&&(D.globalAlpha=1)},zt=e=>{Fe(e)||gt(e,f(2*e.radius*u),p),D.save(),D.globalAlpha=e.brightness??1,Y(G(e),e),D.restore()},Dt=e=>{Fe(e)||gt(e,f(2*e.radius*u),p),D.save(),D.globalAlpha=(e.brightness??1)/2,D.globalCompositeOperation="lighter",Y(G(e),e),D.restore()},Lt=()=>{var e=!L.player.dead&&X.path.length?X.target?J:p:q;At(X,e,h),Y(It,X),L.player.dead},Xt=null,Yt=e=>{var t,o=(L.paused&&!Xt&&L.gametime?(o=n.width,a=n.height,Xt=B(o,a).drawImage(n,0,0)):L.paused||(Xt=Xt&&null),L).camera,a=C(1920,window.innerWidth),l=C(1080,window.innerHeight),i=a/2,r=l/2;n.width=a,n.height=l,D.fillStyle="#000",D.fillRect(0,0,a,l),L.paused?(Xt&&(t=m(L.totaltime/6e3*v),D.filter=`blur(${2.5-t}px)`,D.globalAlpha=.75+.125*t,D.drawImage(Xt.screen,0,0,a,l),D.filter="none",D.globalAlpha=1),D.fillStyle=s,D.drawImage(nt.screen,i-nt.w2,r-nt.h/2)):(({zoom:t,rot:a,position:o}=o),D.save(),D.translate(i,r),D.scale(t,t),D.rotate(-a),D.translate(-o.x*u,-o.y*u),i=L.activeGroups,L.activeBlocks.forEach(e=>{e=L.blocks[e],Y(G(e),e)}),i.lights.forEach(zt),i.splatters.forEach(Nt),i.papers.forEach(Wt),i.puddles.forEach(Rt),i.bags.forEach(e=>Bt(e,ft)),i.rats.forEach(e=>Bt(e,vt,!0)),i.dumpsters.forEach(e=>Bt(e,xt)),Gt(),i.lights.forEach(Dt),D.save(),D.imageSmoothingEnabled=!1,D.filter="blur(4px)",r=b(100*de(o.x/100),100*de(o.y/100)),D.translate(r.x*u,r.y*u),D.scale(10*u,10*u),D.drawImage(dt.screen,-10.5,-10.5,21,21),D.restore(),Lt(),D.restore(),D.font="bold 42px sans-serif",D.fillStyle=s,D.fillText("SCORE: "+Se(L.player.score,0),10,42),D.font="bold 32px sans-serif",D.fillStyle=J,D.fillText("x"+Se(L.player.multiplier,0),10,74),D.fillStyle=s,D.font="bold 10px monospace",D.fillText(`Player [${Se(L.player.position.x)}, ${Se(L.player.position.y)}]: Mouse [${Se(X.position.x)}, ${Se(X.position.y)}]`,10,l-24),D.fillText(`Alley Cat Noir ${d}: seed ${L.seed} frame ${L.frame} gametime ${L.gametime.toFixed(3)}${L.paused?" paused":""} mouse `+X.path.length,10,l-10))},$t=()=>requestAnimationFrame((e=0)=>{var t=(e-L.now)*(L.speed??1);L.now=e,L.frame++,L.totaltime+=t,L.gametime+=L.paused?0:t,Et(t),Yt(),$t()});if($t(),window.currentGame=()=>L,e(window,"keydown",e=>{switch(e.key.toLowerCase()){case"c":L.camera.follow=!L.camera.follow;break;case"escape":case"p":L.paused=!L.paused}}),/android|ipad|iphone|ipod|windows phone|iemobile|blackberry|webos|opera mini/i.test(navigator.userAgent||navigator.vendor||window.opera)&&("ontouchstart"in window||0<navigator.maxTouchPoints)){X.touchScreen=!0;let t=0;e(window,"touchstart",e=>{var[o]=e.touches;e.preventDefault(),X.real.x=o.clientX,X.real.y=o.clientY,X.touch=!0,t=O()}),e(window,"touchmove",e=>{var[t]=e.touches;e.preventDefault(),X.real.x=t.clientX,X.real.y=t.clientY,X.touch=!0}),e(window,"touchend",e=>{var[o]=e.changedTouches;e.preventDefault(),X.real.x=o.clientX,X.real.y=o.clientY,X.touch=!1,O()-t<500&&(X.click=!L.paused,L.paused)&&(L.paused=!1)}),e(window,"touchcancel",e=>{var[t]=e.changedTouches;e.preventDefault(),X.real.x=t.clientX,X.real.y=t.clientY,X.touch=!1})}else e(window,"click",e=>{X.real.x=e.clientX,X.real.y=e.clientY,X.click=!L.paused,L.paused&&(L.paused=!1)}),e(document,"mousemove",({clientX:e,clientY:t})=>{X.real.x=e,X.real.y=t});let $,Mt,Ft=!1,jt=()=>{},qt=()=>{if($)return;window.removeEventListener("click",qt),window.removeEventListener("touchstart",qt),$=new AudioContext,Mt=$.createConvolver();var e,t=3*(e=$.sampleRate),o=(e=$.createBuffer(2,t,e)).getChannelData(0),a=e.getChannelData(1);for(let e=0;e<t;e++){var l=e;o[e]=(2*ye()-1)*ue(1-l/t,3),a[e]=(2*ye()-1)*ue(1-l/t,3)}Mt.buffer=e,Mt.connect($.destination),Ft=!0;let i={idle:{scale:0,octave:3,key:4,notes:[[0,4,1],[1,5,1],[2,8,1],[3,5,1],[4,10,1],[6,10,1.5],[8,9,2],[12,4,1],[13,5,1],[14,8,1],[15,5,1],[16,9,1],[18,9,1.5],[20,8,2.5]],bass:[[4,10,3],[6,10,4],[8,9,7],[16,9,3],[18,9,4],[20,8,7]]},strangers:{scale:2,octave:2,key:3,notes:[[0,0,1],[1,2,1],[2,3,1],[3,4,1],[4,5,1],[5,4,1],[6,2,1],[7,0,1],[8,0,1],[9,2,1],[10,3,1],[11,4,1],[12,5,1],[13,4,1],[14,2,1],[15,0,1],[16,0,1],[17,2,1],[18,3,1],[19,4,1],[20,5,1],[21,4,1],[22,2,1],[23,0,1]],bass:[[0,0,4],[4,5,4],[8,0,4],[12,5,4],[16,0,4],[20,5,4]]},ohno:{scale:6,octave:2,key:1,notes:[[0,0,1],[1,1,1],[2,2,1],[3,0,1],[4,1,1],[5,2,1],[6,3,1],[7,4,1],[8,5,1],[9,4,3],[12,7,1],[13,8,1],[14,9,1],[15,7,1],[16,8,1],[17,9,1],[18,4,1],[19,5,1],[20,6,1],[21,7,3]],bass:[[0,0,3],[3,0,3],[6,3,3],[9,4,3],[12,0,3],[15,0,3],[18,5,2],[20,7,1],[21,0,3]]}},r=E(144,e=>432*2**((e-48)/12)),s=E(7,e=>{var t=[0,2,4,5,7,9,11];return t.push(...t.splice(0,(e%7+7)%7).map(e=>e+12)),t}),n=-1,d=i.idle,p=0,c=d.key,h=s[d.scale],u=e=>{d=i[e]??N(L.seed,p,c,Object.values(i).filter(e=>e!==d)),h=s[d.scale]??h,c=d.key??c,p=0},m=(window.changeMelody=u,e=>(1+(e/oe%re|0))%re),y=(e,...t)=>e.linearRampToValueAtTime(...t),f=(e,...t)=>e.exponentialRampToValueAtTime(...t),g=(e,...t)=>e.setValueAtTime(...t),b=(e,t,...o)=>e.connect(t,...o),x=(e,t,o="sine",a=1,l=0,i=1,s=.5,n=.5,d=.001,p=.5)=>{var u=i*ae,m=a+(l<0?-1:l/7|0),x=c+12*m+h[(l+14)%7],v=r[x]??r[x-12]??r[x+12];if(Number.isFinite(v)){var w=$.currentTime,T=w+ne((re+e-t/oe%re)%re*ae,0);let a=$.createOscillator({type:o}),l=$.createGain(),i=$.createDynamicsCompressor(),r=$.createGain(),c=$.createChannelSplitter(2);var S=T+u+.1;g(a.frequency,v,T),g(a.frequency,v,T+d),f(a.frequency,v*p,T+u),g(l.gain,.01,w),y(l.gain,.5*s,T),f(l.gain,s,T+d),f(l.gain,.01,S),g(i.threshold,-27,w),g(i.knee,39,T),g(i.ratio,13,T),g(i.attack,0,T),g(i.release,ne(0,C(u,1)),T),y(r.gain,s*n,T+.1),y(r.gain,.01,T+u),b(a,l),b(l,i),b(i,c),b(c,r,1,0),b(r,Mt),a.start(T),a.stop(S),setTimeout(()=>W([a,l,i,c,r],e=>e.disconnect()),1e3*(S-w+1))}else console.warn("invalid freq being played",{tick:e,dur:t,type:o,octave:a,note:l,len:i,vol:s,verb:n,attack:d,deflate:p,freq:v,decay:u,oct:m,n:x})},v=new Set;jt=()=>{var e=L.gametime,t=m(e);t!==n&&(v.delete(n),n=t),Ft&&!v.has(t)&&(0===t&&p++,v.add(t),((e,t)=>{var o,a=d.notes.find(([t])=>t===e);a&&(o=p%3&&12!==p&&.75<A(L.seed,e,t)?N(L.seed,t,e,[-3,-4,2,3,4,8,-8]):0,x(e,t,"sawtooth",d.octave,a[1]+o,a[2],.7,.8,.005,.98))})(t,e),((e,t)=>{var o=d.bass.find(([t])=>t===e);o&&x(e,t,"square",1,o[1],o[2],.5,.7,.01,.98)})(t,e),23===t)&&(p&&p%12==0?u(N(L.seed,p,c,Object.keys(i))):p%6!=3&&p&&p%6&&(h=N(L.seed,p,c,s)))}};e(window,"click",qt),e(window,"touchstart",qt)</script>