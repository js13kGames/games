<!doctype html><meta content="width=device-width" name=viewport><title>Aargh! Triskaideka attacks! - js13kGames 2024</title><style>body{margin:0;padding:0;font-family:sans-serif;overflow:hidden;background-color:#000;cursor:default}canvas{width:100vw;height:100vh;display:block;position:absolute;top:0;left:0;object-fit:contain;cursor:not-allowed}#bg{width:100vw;height:100vh;display:block;position:absolute;top:0;left:0;overflow:hidden}#bg>div{position:relative;width:100vw;height:1000vh;background-color:#000;top:-900vh}.bg1{background:linear-gradient(0deg,#07a 0,#118 30%,#314 61%,#002 100%)}.bg2{background:linear-gradient(180deg,#002 0,#482a79 40%,#5551df 60%,#462692 100%)}.bg3{background:linear-gradient(180deg,#002 0,#163c52 30%,#4f4f47 50%,#c5752d 80%,#b7490f 95%,#2f1107 100%)}.hidden{display:none}.msg{position:absolute;left:0;right:0;margin-left:auto;margin-right:auto;top:100px;width:calc(100vw - 200px);min-height:calc(100vh - 200px);background-color:#0254;color:#daf0ff;border:3px solid #adf;border-radius:20px;font-family:sans-serif;font-weight:700;font-size:3vh;padding:10px;text-align:center;cursor:default;text-shadow:3px 3px 3px #000;box-shadow:0 0 20px 5px #8af,inset 0 0 10px 2px #8af}</style><div id=bg><div class=bg1 id=sky></div></div><canvas id=gameCanvas></canvas><div class="hiddenx msg"></div><script>const t=1920,e=900,n="#fff",r="#000",a="255,255,0",s=Math.PI,i=Math.sin,o=Math.cos,l=Math.sqrt,c=(e,t,n)=>Math.min(Math.max(e,t),n),f=e=>Math.abs(e),u=e=>e*(s/180),h=Math.round,y=(e,t)=>Math.random()*(t-e)+e,d=(e,t)=>h(y(e,t));function x(e){return e[Math.floor(Math.random()*e.length)]}let[p,m]=(()=>{var n=document.querySelector("#gameCanvas");return n.width=t,n.height=e,[n,n.getContext("2d")]})(),v=document.querySelector("#bg > div"),g=m,w=Date.now();function b(){var e=Date.now(),t=c((e-w)/1e3,0,.1);return w=e,t}function A(e){g=e}function E(e,t){var[e,t]=rt({x:e,y:t});g.translate(e,t)}const T=e=>g.rotate(u(e)),k=()=>g.save(),I=()=>g.restore(),L=e=>g.strokeStyle=e,S=e=>g.fillStyle=e,D=()=>g.beginPath(),q=(e,t)=>g.moveTo(e,t),R=(e,t)=>g.lineTo(e,t),H=()=>g.stroke(),O=()=>g.fill(),_=(e,t,n,a)=>g.fillRect(e,t,n,a),M=(e,t,n,a)=>{D(),g.rect(e,t,n,a),H()},B=()=>g.globalCompositeOperation="destination-out",C=()=>g.globalCompositeOperation="source-over",N=(e,t,n)=>g.arc(e,t,n,0,2*s);let W=-1;const K=[],G=[],P="standard",F=(window.addEventListener("gamepadconnected",e=>{e.gamepad.mapping==P&&(W=e.gamepad.index)}),window.addEventListener("gamepaddisconnected",e=>{W=-1,navigator.getGamepads().find(e=>e.mapping==P)}),0);function U(){return 0<=W}function j(e){return U()?G[e]:0}function J(e){return!!U()&&K[e]}const Y={},X=(window.addEventListener("keydown",e=>Y[e.code]=!0),window.addEventListener("keyup",e=>Y[e.code]=!1),["ArrowLeft","KeyA"]),Q=["ArrowRight","KeyD"],V=["ArrowUp","KeyW"],Z=["ArrowDown","KeyS"],z=["Space","ControlLeft","ControlRight","Enter","NumpadEnter"];function $(e){return null!=e.find(e=>Y[e])}function tt(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,{c:n,w:e,h:t,ctx:n.getContext("2d")}}const et={x:960,y:450,bb:{l:0,r:t,t:0,b:e},dx:0,dy:0,ex:0,ey:0,et:0,t:null,_u:()=>{}};function nt(e,t){return e.x>=et.bb.l-t&&e.x<=et.bb.r+t&&e.y>=et.bb.t-t&&e.y<=et.bb.b+t}function rt(e){return[e.x-et.x+960+et.ex,e.y-et.y+450+et.ey]}function at(e){et.et=e}function st(e,t){return{x:e,y:t,a:0}}function it(e,t){return st(t.x-e.x,t.y-e.y)}function ot(e){return l(e.x*e.x+e.y*e.y)}function lt(e,t){return ot(it(e,t))}function ct(e,t){return st(e.x*t,e.y*t)}function ft(e,t){return st(e.x+t.x,e.y+t.y)}function ut(e){return Math.atan2(e.y,e.x)/(s/180)}function ht(e,t=1){return e=u(e),e={x:o(e),y:i(e)},1!=t?ct(e,t):e}function yt(e,t=1){return ct(e,t/ot(e))}function dt(a,e,t){return a.c=e,a.d=t,e.p=a,e.pd=t,a.p||a._r||(a._r=()=>{{var t=a;k(),E(t.x,t.y);let e=t;for(;e.c;)D(),L(n),N(e.x-t.x,e.y-t.y,e.r),H(),e=e.c;I()}}),e}function xt(n,a=180){if(n.c){var r=n.c,s=ot(i=it(n,r)),i=ct(i,n.d/s);r.a=ut(i),s=ft(n,i),r.x=s.x,r.y=s.y;let e=(n.a-r.a+180)%360-180,t=!1;e<-a?(e=-a,t=!0):e>a&&(e=a,t=!0),t&&(r.a=pt(n.a+720-e),i=ft(n,ht(r.a,n.d)),r.x=i.x,r.y=i.y),xt(r,a)}}function pt(e){for(;360<=e;)e-=360;for(;e<0;)e+=360;return e}function mt(e,t,s){let u={x:e,y:t,a:s,as:180,dx:0,dy:0,dv:st(0,0),dva:0,dvl:0,t:{x:e,y:t},fr:.5/Ce[Be],l:Ce[Me],lf:0,h:10,mh:10,alive:!0,cr:10,ct:0,ls:0,_r:()=>{var e=u;if(e.alive){var t=[0,-25],a=[-2,-12,-6,-11,-5,-9,-3,-8,-4,-5,-14,4,-13,7,-5,2,-6,9,-3,9,-2,8],s=a.length;k(),E(e.x,e.y),T(e.a+90),D(),S(r),L(n),q(t[0],t[1]);for(let e=0;e<s-1;e+=2)R(a[e],a[e+1]);for(let e=s-2;0<=e;e-=2)R(-a[e],a[e+1]);R(t[0],t[1]),O(),H(),I()}},_u:r=>{{var s=u,i=F,o=1;s.ct-=r;let e=1,t=10;if(s.h<=0)s.a-=360*r,he(xe),e=3,t=30;else if(s.y<-7200+ke)s.a+=180*r,e=5,t=50;else{var l,i=st(j(i),j(o));if((wt=i&&.2<ot(i)?vt:gt)==vt)o=(ut(i)+360-s.a+180)%360-180,i=360*r,o<0?s.a+=o<-i?-i:o:0<o&&(s.a+=i<o?i:o),s.a=pt(s.a);else if(wt==gt){let e=j(F);($(X)||J(14))&&(e=-1),($(Q)||J(15))&&(e=1),.1<f(e)&&(s.a+=e*r*s.as)}(c=$(V)||J(12)||J(7)?-1:0)<-.1?(i=ct(l=ht(s.a+y(-10,10)),7*-c*r),s.dx+=i.x,s.dy+=i.y,Oe.push((c=s.dx-400*l.x,(c=bt(s.x,s.y,c,s.dy-400*l.y,1,Bt,Tt)).r=10,c.sf=.7,c)),ue(xe,!1)):(s.dx*=.995,he(xe))}if(s.dy<t&&(s.dy+=e*r),s.x+=s.dx,s.y+=s.dy,s.y>ke-8&&(.5<s.dy&&(Xe(It(s.x,s.y,1)),et.et=.25),s.y=ke-8.1,s.dy=0,s.a=270,s.dx=0,s.h<=0)&&s.alive){s.alive=!1,ue(de),Xe(Rt(s.x,s.y,a));for(let e=0;e<40;e++)Xe(Ot(s.x,s.y,3,-300));Ne.classList.remove("hidden");let e=Te[Ke].failure;Te[Ke].count&&(e+="\n\nScore Details: "+Pe.e+" scouts, "+Pe.sn+" jabberwockies, "+Pe.sq+" squids and "+Pe.sqr+" starfishs."),Ne.innerText=e,s.lf=-2}o=ht(s.a),s.lf+=r,s.ls+=r,(J(0)||$(z))&&s.lf>=s.fr&&s.alive&&!s.won&&(ue(ye),(1==s.l||3==s.l&&s.alive)&&Oe.push(Lt(s.x,s.y,1200*o.x,1200*o.y,2)),2==s.l?(i=ht(s.a-2),r=ht(s.a+2),Oe.push(Lt(s.x,s.y,1200*i.x,1200*i.y,2)),Oe.push(Lt(s.x,s.y,1200*r.x,1200*r.y,2))):3==s.l&&(i=ht(s.a-5),r=ht(s.a+5),Oe.push(Lt(s.x,s.y,1200*o.x,1200*o.y,2)),Oe.push(Lt(s.x,s.y,1200*i.x,1200*i.y,2)),Oe.push(Lt(s.x,s.y,1200*r.x,1200*r.y,2))),s.lf=0),J(1)&&at(.25),s.h<s.mh&&.1*s.h<s.ls&&(Oe.push(qt(s.x,s.y)),s.ls=0);let n=0;s.x<je-1.1*Ye&&(n=Je+Ye-s.x),0!=(n=s.x>Je+1.1*Ye?-(s.x-(je-Ye)):n)&&(s.x+=n,et.x+=n),i=s,r=ct(o,100),o={x:i.x+r.x,y:i.y+r.y},s.t.x=o.x,s.t.y=o.y,s.dv.x=s.dx,s.dv.y=s.dy,s.dva=ut(s.dv),s.dvl=ot(s.dv)}var c}};return u.t.p=u,et.t=u.t,u}et._u=e=>{var t,n,a=et;a.t&&(t={x:a.t.x-a.x,y:a.t.y-a.y},n=ot({x:a.t.p.dx,y:a.t.p.dy}),a.dx=t.x*n,a.dy=t.y*n,a.x+=a.dx*e,a.y+=a.dy*e,a.bb.l=a.x-960,a.bb.r=a.x+960,a.bb.t=a.y-450,a.bb.b=a.y+450),0<a.et?(a.et-=e,a.ex=c(a.ex+y(-5,5),-10,10),a.ey=c(a.ey+y(-5,5),-10,10)):(a.ex=0,a.ey=0)};const vt=1,gt=2;let wt=gt;function bt(e,t,n,a,r,s,i){let o={x:e,y:t,dx:n,dy:a,ttl:r};return o.ittl=r,o.s=1,o.sf=1,s&&(o._r=()=>{k(),E(o.x,o.y),s(o),I()}),i=i||At,o._u=e=>i(o,e),o}function At(e,t){e.g&&(e.dy+=e.g*t),e.x+=e.dx*t,e.y+=e.dy*t,e.ttl-=t}function Et(t,e,n){if(At(t,e),t.y>ke&&(t.ttl=-1,n))for(let e=0;e<t.s;e++)Xe(It(t.x+y(-10,10),t.y,t.sf))}function Tt(e,t){Et(e,t,!0)}function kt(e,t){e.w+=e.dw*t,Et(e,t,!1)}function It(e,t,n=1){return(e=bt(e,t,y(-30,30),y(-400,-200)*n,2,Ct,kt)).w=1,e.dw=40,e.g=500,e}function Lt(e,t,n,a,r){return(e=bt(e,t,n,a,r,Nt,Tt)).r=3,e.ot=Le,t=ot({x:n,y:a}),e.v=st(n/t,a/t),e.s=5,e}function St(e,t){return(e=bt(e,t,0,0,1/0,Kt,Dt)).a=y(0,360),e.l=1,e}function Dt(n){n.x<et.x-960&&(n.x+=t),n.x>et.x+960&&(n.x-=t),n.y<et.y-450&&(n.y+=e),n.y>et.y+450&&(n.y-=e),n.a=dn.dva,n.l=1+dn.dvl}function qt(e,t,n=1){return(e=bt(e,t,y(-5,5),y(-50,-15),y(1,2)*n,Mt)).r=y(5,10),e.c="50,50,40",e}function Rt(e,t,n,a=1){return(e=bt(e,t,0,0,+a,Mt,Ht)).r=y(20,30),e.c=n,e}function Ht(e,t){e.r+=3*e.r*t,e.ttl-=t}function Ot(e,t,n=1,a=0){return(e=bt(e,t,y(-100,100)*n,y(-150,10)+a,2,Gt,_t)).a=y(0,360),e.ad=y(-860,860),e.g=500,e.l=y(3,6),e}function _t(e,t){e.a+=e.ad*t,Tt(e,t)}function Mt(e){D();var t=e.ttl/e.ittl;S("rgba("+e.c+","+t+")"),N(0,0,e.r*(e.ittl-e.ttl/e.ittl)),O()}function Bt(e){D(),S("#fa01"),N(0,0,e.r*(e.ttl/e.ittl)),O()}function Ct(e){var t,n,a,r;D(),S("#fff3"),e.r,t=ke-e.y,n=e.w,e=c(ke-e.y,0,500),r=2*(a=s),g.ellipse(0,t,n,e,0,a,r),O()}function Nt(t){S("#ff0a"),[0,5,10,15].forEach(e=>{D(),N(-e*t.v.x,-e*t.v.y,t.r),O()})}function Wt(t){let e=1;(e=t.ttl<.5?2*t.ttl:e)<0&&(e=0),S("rgba(255,190,0,"+e+")"),[0,1,2].forEach(e=>{D(),N(-5*e*t.v.x,-5*e*t.v.y,t.r-1.5*e),O()}),B(),S("#fff"),[0,1,2].forEach(e=>{D(),N(-5*e*t.v.x,-5*e*t.v.y,t.r-1.5*e-2),O()}),C()}function Kt(e){T(e.a),D(),L("#fffa"),q(-e.l,0),R(e.l,0),H()}function Gt(e){T(e.a),D(),L("#fff7"),m.lineWidth=2,q(-e.l,0),R(e.l,0),H()}function Pt(t,a,s,i,e,o=Ie){let l=Ft(t,a,s),c=(l.ot=o,l.ma=25,l.hp=10,l.s=e,l._r=()=>{{var c=l;nt(c,c.r)||c.sq||we(c,3);let e=c;for(;e.c;)e=e.c;if(nt(c,c.r)||nt(e,c.r)){k(),E(c.x,c.y);let s=[],i=[],o=c,e=!0,l=0;for(;o.c;){let n=o.x-c.x,a=o.y-c.y;if(B(),D(),S(r),N(n,a,o.r),O(),C(),e&&c.ot==Ie&&[[180,1],[170,2],[160,1],[150,1.5],[140,1],[130,1.2]].forEach(e=>{i.unshift(jt(n,a,o,e[0],e[1])),s.push(jt(n,a,o,-e[0],e[1]))}),i.unshift(jt(n,a,o,90)),s.push(jt(n,a,o,-90)),l%2==0){let t=2==l&&c.ot==Ie?2:1;[[70,1.5],[65,1.1]].forEach(e=>{i.unshift(jt(n,a,o,e[0],e[1]*t)),s.push(jt(n,a,o,-e[0],e[1]*t))})}o=o.c,e=!1,l++}if(D(),L(n),[...s,...i].forEach((e,t)=>{(0==t?q:R)(e.x,e.y)}),H(),c.ot==Ie){let t=c.r/4,n=t/2;[90,-90].forEach(e=>{Ut((e=jt(0,0,c,e,.7)).x,e.y,t,n,c.ta)})}I()}}},l._u=e=>{var t,n,a,r=l;r.ot==Ie&&(t=ut(it(r,st(dn.x,dn.y)))+720,r.ta=t,r.inited?(n=r.s*e,(a=(t-(r.a-180)+180)%360-180)<0?r.a-=n:0<a&&(r.a+=n)):(r.a=t+180,r.inited=!0),r.a=pt(r.a),a=ht(r.a-180,r.s*e),r.x+=a.x,r.y+=a.y),xt(r,r.ma)},l);for(let e=1;e<=i;e++){var f=s-e*(s/i);c=dt(c,Ft(t-400,a-e*s,f),f)}return l}function Ft(e,t,n){return{x:e,y:t,r:n,a:0}}function Ut(e,t,a,s,i){i=ht(i,a-s),D(),S(n),N(e,t,a),O(),D(),S(r),N(e+i.x,t+i.y,s),O()}function jt(e,t,n,a,r=1){return r=n.r*r,st(e+(n=ht(n.a+a)).x*r,t+n.y*r)}function Jt(e,a,r,s=8){let o={x:e,y:a,s:r,ot:qe,t:[],hp:20,st:s,_r:()=>{var e;nt(e=o,e.s)||we(e,4),nt(e,2*e.s)&&(k(),E(e.x,e.y),D(),L(n),N(0,0,e.s),H(),I(),e.t.forEach(e=>e._r()),k(),B(),E(e.x,e.y),D(),S(n),N(0,0,e.s-2),O(),C(),Ut(0,-e.s/2,e.s/3,e.s/6,e.ta),Ut(e.s/2,e.s/4,e.s/5,e.s/9,e.ta),Ut(-e.s/2,e.s/4,e.s/5,e.s/9,e.ta),I())},_u:e=>{{var a=o,r=e,s=(e=st(dn.x,dn.y),ut(e=it(a,e))+720);a.ta=s;let n=yt(e,50*r);if(a.x+=n.x,a.y+=n.y,a.t.forEach(e=>{var t;8==e.tt?(e.x+=n.x,e.y+=n.y,e.a+=e.da*r,(e.a<e.aMin||e.aMax<e.a)&&(e.da*=-1,e.a+=20*e.da*r)):9==e.tt&&(e.a+=e.da*r,t=ft(ht(e.a,.9*e.sq.s),e.sq),e.x=t.x,e.y=t.y),e._u(r)}),a.hp<=0){0<xn&&(xn--,s=.5<=y(0,1)?t:-t,Xe(Jt(a.x+s,a.y-225,a.s,a.st))),a.ttl=-1,a.t.forEach(e=>{e.ot=Ie,e.x+=y(-a.s,a.s),e.y+=y(-a.s,a.s),e.a=y(0,360),e.inited=!0,e.s=y(100,180),e.sq=null,Xe(e)});var i=a;ue(de);for(let e=0;e<y(20,30);e++)Xe(Ot(i.x+y(-i.s,i.s),i.y+y(-i.s,i.s)));for(let e=0;e<y(8,12);e++)Xe(qt(i.x+y(-i.s,i.s),i.y+y(-i.s,i.s),y(2,5)));Fe(i.st)}}}};return 8==s?(o.t.push(Yt(o,e,a+r/2,r/4,18,30,150)),o.t.push(Yt(o,e-r/2,a+r/3,r/4,15,40,180)),o.t.push(Yt(o,e+r/2,a+r/3,r/4,15,0,140))):9==s&&(o.t.push(Xt(o,e,a+r/2,r/4,18,120,70)),o.t.push(Xt(o,e,a-r/2,r/4,18,240,70)),o.t.push(Xt(o,e,a-r/2,r/4,18,360,70)),o.t.push(Xt(o,e,a+r/2,r/4,18,120,-50)),o.t.push(Xt(o,e,a-r/2,r/4,18,240,-50)),o.t.push(Xt(o,e,a-r/2,r/4,18,360,-50)),o.t.forEach(e=>e.ma=10),o.hp=30),o}function Yt(e,t,n,a,r,s,i){return(t=Pt(t,n,a,r,0,Re)).a=90,t.aMin=s,t.aMax=i,t.da=90,t.ma=5,t._u(0),t.tt=8,t.sq=e,t}function Xt(e,t,n,a,r,s,i){return(t=Pt(t,n,a,r,0,Re)).a=s,t.da=i,t.tt=9,t.sq=e,t}function Qt(e,a,r){let i={x:e,y:a,dx:0,dy:0,a:y(0,360),c:r,ttl:1/0,ot:Se,r:15,hp:2,s:y(50,120),t:{x:960+y(-500,500),y:450+y(-400,400)},ti:y(2,5),tc:0,fi:y(2,3),fc:0};return i.tc=i.ti,i.fc=i.fi,(e=i).i=tt(60,60),A(e.i.ctx),k(),E(e.i.w/2,e.i.h/2),T(-90),e.c.forEach(t=>{D(),S("#07a"),L(n),q(t[0],t[1]);let a=t.length,e=!0;a%2==1&&(e=1==t[a-1],a--);for(let e=2;e<a-1;e+=2)R(t[e],t[e+1]);for(let e=a-2;0<=e;e-=2)R(-t[e],t[e+1]);e&&R(t[0],t[1]),B(),O(),C(),H()}),I(),A(m),i._r=()=>{var e,t,n,a;nt(e=i,15)?(k(),E(e.x,e.y),T(e.a),t=e.i.c,n=-e.i.w/2,a=-e.i.h/2,g.drawImage(t,n,a),I()):we(e,2)},i._u=e=>{var n,a,r,s;(n=i).tc-=e,n.fc-=e,n.tc<=0&&(n.t={x:dn.x+y(-200,200),y:dn.y+y(-200,200)},n.tc=n.ti),r=(ut(it(n,n.t))+720-(n.a-180)+180)%360-180,s=n.s*e,r<0?n.a-=s:0<r&&(n.a+=s),n.a=pt(n.a),r=ht(n.a-180,n.s*e),n.x+=r.x,n.y+=r.y,n.fc<=0&&(n.fc=n.fi,s=ht(n.a),Xe(((e=bt(e=n.x+-15*s.x,n.y+-20*s.y,r=-200*s.x,a=-200*s.y,8,Wt,Tt)).r=6,e.ot=He,s=ot({x:r,y:a}),e.v=st(r/s,a/s),e.s=1,e))),n.hp<=0&&(0<xn?(xn--,n.y-=450,n.x+=.5<=y(0,1)?t:-t,n.hp=2):n.ttl=-1,Vt(n))},i}function Vt(t){Oe.push(qt(t.x+y(-t.r,t.r),t.y+y(-t.r,t.r),3));for(let e=0;e<y(3,7);e++)Xe(Ot(t.x+y(-t.r,t.r),t.y+y(-t.r,t.r)));Fe(Se)}const Zt=[0,-15,-20,0,-20,10,0,5],zt=[0,-5,-20,0,-20,5,0,5],$t=[0,-5,-18,0,-20,-8,-20,5,0,5],te=[0,-4,-12,-2,-16,-5,-19,-10,-20,-15,-20,0,-18,3,-14,5,0,10],ee=[0,-5,-12,-5,-14,-15,-16,-15,-16,10,-14,10,-12,0,0,0],ne=[-5,-10,-5,-5,-2,0,0],re=[-5,-10,-5,7,-3,10,-1,12,0],ae=[-5,-10,-5,-5,-2,0,-3,10,-7,12,-7,15,-1,14,0],se=[-5,-10,-4,-12,-2,-13,-1,-10,0],ie=[-5,-10,-4,-12,-2,-15,-1,-20,0],oe=[-5,-10,-8,-10,-3,-15,-3,-20,-2,-16,0];let le=function(){function _(e){return Math.sin(6.283184*e)}function P(e){return.003959503758*2**((e-128)/12)}let K,M,B,W,j,G=[_,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){return(e=e%1*4)<2?e-1:3-e}];this.init=function(e){K=e,M=e.endPattern,B=0,W=e.rowLen*e.patternLen*(M+1)*2,j=new Int32Array(W)},this.generate=function(){let e,t,n,a,r,s,i,o,l,c,f,u,h,y,d=new Int32Array(W),x=K.songData[B],p=K.rowLen,g=K.patternLen,m=0,v=0,w=!1,b=[];for(n=0;n<=M;++n)for(i=x.p[n],a=0;a<g;++a){var A=i?x.c[i-1].f[a]:0,E=(A&&(x.i[A-1]=x.c[i-1].f[a+g]||0,A<17)&&(b=[]),G[x.i[16]]),T=x.i[17]/512,k=2**(x.i[18]-9)/p,S=x.i[19],I=x.i[20],O=43.23529*x.i[21]*3.141592/44100,D=1-x.i[22]/255,L=1e-5*x.i[23],R=x.i[24]/32,q=x.i[25]/512,N=6.283184*2**(x.i[26]-9)/p,H=x.i[27]/255,C=x.i[28]*p&-2;for(f=(n*g+a)*p,r=0;r<4;++r)if(s=i?x.c[i-1].n[a+r*g]:0){b[s]||(b[s]=function(e,t,n){let a,r,s,i,o,l,c=G[e.i[0]],f=e.i[1],u=e.i[3]/32,h=G[e.i[4]],y=e.i[5],d=e.i[8]/32,x=e.i[9],p=e.i[10]*e.i[10]*4,g=e.i[11]*e.i[11]*4,m=e.i[12]*e.i[12]*4,v=1/m,w=-e.i[13]/16,b=e.i[14],A=n*2**(2-e.i[15]),E=new Int32Array(p+g+m),T=0,k=0;for(a=0,r=0;a<p+g+m;a++,r++)0<=r&&(b=b>>8|(255&b)<<4,r-=A,o=P(t+(15&b)+e.i[2]-128),l=P(t+(15&b)+e.i[6]-128)*(1+8e-4*e.i[7])),s=1,a<p?s=a/p:a>=p+g&&(s=(1-(s=(a-p-g)*v))*3**(w*s)),T+=o*s**u,i=c(T)*f,k+=l*s**d,i+=h(k)*y,x&&(i+=(2*Math.random()-1)*x),E[a]=80*i*s|0;return E}(x,s,p));var X=b[s];for(t=0,e=2*f;t<X.length;t++,e+=2)d[e]+=X[t]}for(t=0;t<p;t++)o=2*(f+t),(c=d[o])||w?(u=O,S&&(u*=E(k*o)*T+.5),u=1.5*Math.sin(u),m+=u*v,h=D*(c-v)-m,v+=u*h,c=3==I?v:1==I?h:m,L&&(c=(c*=L)<1?-1<c?_(.25*c):-1:1,c/=L),c*=R,w=1e-5<c*c,l=Math.sin(N*o)*q+.5,y=c*(1-l),c*=l):y=0,C<=o&&(y+=d[o-C+1]*H,c+=d[o-C]*H),d[o]=0|y,d[1+o]=0|c,j[o]+=0|y,j[1+o]+=0|c}return++B/K.numChannels},this.createAudioBuffer=function(e){var n=e.createBuffer(2,W/2,44100);for(let t=0;t<2;t++){var a=n.getChannelData(t);for(let e=t;e<W;e+=2)a[e>>1]=j[e]/65536}return n},this.createWave=function(){var e=44+2*W-8,t=e-36,n=new Uint8Array(44+2*W);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(let e=0,t=44;e<W;++e){var a=(a=j[e])<-32767?-32767:32767<a?32767:a;n[t++]=255&a,n[t++]=a>>8&255}return n},this.getData=function(t,n){var a=2*Math.floor(44100*t),r=new Array(n);for(let e=0;e<2*n;e+=1){var s=a+e;r[e]=0<t&&s<j.length?j[s]/32768:0}return r}};const ce=[];function fe(e,t,n){var a=new le;for(a.init(e);a.generate()<1;);e=a.createWave(),ce[t]=document.createElement("audio"),ce[t].src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),ce[t].loop=n}function ue(e,t=!0){(e=ce[e])&&(t||e.paused)&&(e.currentTime=0,e.play())}function he(e){(e=ce[e])&&(e.pause(),e.currentTime=0)}fe({songData:[{i:[2,100,128,0,0,140,128,0,1,0,0,0,64,37,0,0,1,80,2,0,2,89,81,0,76,23,6,0,0],p:[1,1,2,2],c:[{n:[109,114,116,119,124,119,121,116,119,114,116,119,109,114,116,119,124,119,121,116,119,114,116,119,109,114,116,119,124,119,121,116,119,114,116,119],f:[]},{n:[112,117,119,122,127,122,124,119,122,117,119,122,112,117,119,122,127,122,124,119,122,117,119,122,112,117,119,122,127,122,124,119,122,117,119,122],f:[]}]},{i:[2,100,128,0,0,140,128,0,1,0,0,63,101,20,0,0,1,80,2,0,2,89,81,0,76,23,6,0,0],p:[1,1,2,3],c:[{n:[133,,,138,140,143,145,,,148,147,143,145,,,148,147,143,145,,,143,,147,140,,,138,,,136,,138,135,,131],f:[13,,,12,,,13,,,12,,,13,,,12,,,13,,,12,,,13,,,12,,,,,,,,,76,,,33,,,76,,,33,,,76,,,33,,,76,,,33,,,76,,,33]},{n:[136,,,141,143,146,148,,,151,150,146,148,,,151,150,146,148,,,146,,150,143,,,141,,,139,,141,138,,134],f:[13,,,12,,,13,,,12,,,13,,,12,,,13,,,12,,,13,,,13,,,12,,,,,,76,,,33,,,76,,,33,,,76,,,33,,,76,,,33,,,76,,,76,,,33]},{n:[136,,,141,143,146,148,,,151,150,146,148,,,151,150,146,148,,,155,155,153,148,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,158,157,,155],f:[13,,,12,,,13,,,12,,,13,,,12,,,13,,,12,,,12,,,,,,,,,,,,76,,,33,,,76,,,33,,,76,,,33,,,76,,,33,,,121]}]},{i:[2,100,128,0,0,140,128,0,1,0,0,21,43,37,0,0,1,80,2,0,2,9,81,0,136,80,6,0,0],p:[1,1,2,2],c:[{n:[109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109],f:[]},{n:[112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112],f:[]}]},{i:[0,255,128,8,3,255,128,0,5,25,0,0,48,115,0,0,0,195,6,0,2,157,29,0,247,0,0,0,0],p:[1,1,1,1],c:[{n:[111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,0,0,0,1,193,171,0,68,39,3,96,2],p:[1,1,1,1],c:[{n:[,,,118,,,,,,118,,,,,,118,,,,,,118,,,,,,118,,,,,,118],f:[]}]}],rowLen:6615,patternLen:36,endPattern:3,numChannels:5},0,!0),fe({songData:[{i:[2,100,128,0,0,140,128,0,1,0,0,0,64,37,0,0,1,80,2,0,2,89,81,0,76,23,6,0,0],p:[1,1,2,2],c:[{n:[109,114,116,119,124,119,121,116,119,114,116,119,109,114,116,119,124,119,121,116,119,114,116,119,109,114,116,119,124,119,121,116,119,114,116,119],f:[]},{n:[112,117,119,122,127,122,124,119,122,117,119,122,112,117,119,122,127,122,124,119,122,117,119,122,112,117,119,122,127,122,124,119,122,117,119,122],f:[]}]},{i:[2,100,128,0,0,140,128,0,1,0,0,63,101,20,0,0,1,80,2,0,2,89,81,0,76,23,6,0,0],p:[],c:[]},{i:[2,100,128,0,0,140,128,0,1,0,0,21,43,37,0,0,1,80,2,0,2,9,81,0,136,80,6,0,0],p:[1,1,2,2],c:[{n:[109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109],f:[]},{n:[112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112],f:[]}]},{i:[0,255,128,8,3,255,128,0,5,25,0,0,48,115,0,0,0,195,6,0,2,157,29,0,76,0,0,0,0],p:[1,1,1,1],c:[{n:[111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113,,,111,,111,113],f:[]}]}],rowLen:6615,patternLen:36,endPattern:3,numChannels:4},5,!0);const ye=1,de=(fe({songData:[{i:[0,255,127,48,0,255,110,0,63,0,0,0,60,21,0,0,0,0,0,0,2,16,117,4,142,0,0,60,1],p:[1],c:[{n:[176],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},ye,!1),2),xe=(fe({songData:[{i:[2,255,127,48,1,255,110,0,63,255,29,0,95,35,0,0,0,0,0,0,2,16,117,4,142,115,5,123,2],p:[1],c:[{n:[115,,,,,,,,,,,,,118,,,,,,,,,,,106,,,,,,,,,,,,,,134],f:[]}]}],rowLen:5513,patternLen:12,endPattern:0,numChannels:1},de,!1),fe({songData:[{i:[2,255,127,109,1,255,110,0,117,0,0,0,97,63,0,0,0,0,0,0,2,16,117,4,77,115,5,39,1],p:[1],c:[{n:[139],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},3,!1),4);fe({songData:[{i:[0,59,92,0,3,21,95,0,0,97,11,212,31,0,16,4,2,35,6,1,2,94,73,0,69,0,0,134,1],p:[1],c:[{n:[159],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},xe,!1);let pe=[[38,80,68,15,186,15,160,81],[173,81,197,15,328,16,343,38,332,81,291,81,293,64,217,64,212,80],[351,81,370,15,408,15,391,81],[411,80,422,36,449,15,559,14,581,40,573,79,528,81,528,64,459,64,451,80],[593,80,604,14,640,15,633,79,707,14,759,16,692,81],[798,80,823,15,852,15,871,79],[934,80,934,14,972,15,975,81],[995,80,992,14,1145,15,1171,39,1177,81],[1197,80,1188,16,1303,16,1313,65,1234,66,1236,81],[1336,80,1323,15,1360,15,1376,77,1426,14,1478,15,1437,81],[1543,81,1543,14,1574,14,1616,81],[9,238,63,113,103,112,52,238],[113,238,160,112,320,115,309,145,276,167,284,239,239,240,231,165,182,165,155,238],[306,236,341,114,383,115,350,238],[370,238,386,183,505,183,512,175,506,165,415,166,398,139,402,113,543,115,562,141,551,211,519,238],[567,237,588,114,689,114,738,238,685,239,657,165,620,166,609,237],[744,235,786,114,878,115,914,237,872,238,851,165,809,165,783,238],[936,238,935,114,976,114,979,237],[1001,238,997,113,1037,115,1040,181,1134,182,1147,166,1141,113,1181,114,1194,210,1171,237],[1219,237,1201,113,1292,113,1301,165,1250,166,1253,183,1340,185,1351,236],[1371,236,1345,114,1446,113,1540,237,1489,238,1434,165,1396,166,1413,237],[1548,236,1546,114,1639,115,1721,238,1675,238,1631,166,1588,167,1590,239]];const me="#afa5",ve="#cfc7",ge="#f00a";function we(e,t=1){e=yt(it(dn,e),350),S("#f00a"),k(),g.translate(960+e.x,450+e.y),T(ut(e)),D(),q(-4*t,-4*t),R(4*t,0*t),R(-4*t,4*t),O(),I()}function be(e,t,a,r,s,i,o){let l={x:e,y:t,w:a,h:r,t:s,c:o,ot:De,a:i,l:{},_r:()=>{var e,t=l;k(),E(t.x-t.w/2,t.y-t.h/2),L(n),t.a?(m.lineWidth=5,S("#ffa6"),_(0,0,t.w,t.h)):m.lineWidth=1,M(0,0,t.w,t.h),S(n),e=t.ts||24,m.font=e+"px sans-serif",m.textAlign="center",m.textBaseline="middle",m.fillText(t.t,t.w/2,t.h/2),I()}};return l}function Ae(e,t,a,r=30){let s={x:e,y:t,t:a,s:r,_r:()=>{var e=s;k(),E(e.x,e.y),S(n),m.font=e.s+"px sans-serif",m.textAlign="center",m.textBaseline="middle",m.fillText(e.t,0,0),I()}};return s}function Ee(e,t,n){(e.l[n]=t).l[-n]=e}const Te=[{e:20,sn:4,sq:3,sqr:1,p:{fr:.1,l:3,y:600,dy:-2,h:1},hideUpdates:!0,d:"Day 13 of the invasion, the final battle!",m:"[SPACE] to LAUNCH",failure:"Yep, that's me!\nYou are probably wondering, how I ended up in this situation.\nIt all began 13 days ago, when the first scouts of the aliens, now known as 'Triskaideka', entered earths atmosphere.\nThe arrival of them triggered a global mass hysteria:\n\nTRISKAIDEKA-PHOBIA\n\nMy experimental Jet, the A.I.R.W.O.L.F.\n(Advanced Intercept Rocket, Worlds Only and Last hope for Future)\nwas the only capable craft to defend earth against the intruders.\n\nBut lets have a look at all the events from the beginning...",success:"",adv:!0,respawn:1/0},{e:3,d:"Day 0 of the invasion, the first scouts appear.",m:"LAUNCH!",success:"HA HA HA!\n\nThose filthy scout ships had no chance against me and my rocket!\n\nAnd from the scrap parts they left behind,\nI might be able to upgrade some systems...",failure:"Those scouts were tough!\n\nSo, after a quick repair of my craft, I launched again!",respawn:2},{e:10,d:"Day 2 of the invasion, more scouts.",m:"LETS GO!",success:"If that's all they have, this invasion will be over tomorrow!\n\nAnd the parts of their crashed ships still look promising.\nLets salvage some more parts...",failure:"Ouch!\n\nThat hurt!\n\nBut the rocket is still in relative good shape.\n\nI'll just add some bolts, and return to battle!",respawn:5},{e:10,sn:2,d:"Day 4 of the invasion, what's that? Jabberwockies?",m:"EAT THAT, JABBERWOCK!",success:"Jabberwockies?!?! Well, they didn't like my lasers.\n\nLet's see what they come up with next...",failure:"AH!!! I hate Jabberwockies!\n\nWhere is my repair-hammer?\n\nAh! Here! Ok, just some taps here and there will do the trick.\n\n*BANG* ... *BOINK*\n\nAs good as new! Here we go again...",respawn:10},{e:15,sn:4,d:"Day 5 of the invasion, they keep coming",m:"FREEDOM!",success:"Ok, how creative. They just keep sending more Jabberwockies.\n\nWell, i've sent them more rounds of laser-bolts in return.\n\nBRING IT ON!",failure:"Oh boy, do i hate these Jabberwockies...\n\nLets try again!",respawn:15},{e:10,sn:2,sq:1,d:"Day 7 of the invasion, dawn of the squids. WHAT?!?! SQUIDS?!?! AAAAHHH!!!",m:"FOR FRODO!",success:"Squids.\n\nThat was a surprise.\nEspecially that they split into jabberwockies.\n\nBut still: no match for my A.I.R.W.O.L.F., ha!",failure:"Squids?!?! What the heck? They took me by surprise. Let's check them out again!",respawn:20},{e:5,sqr:2,d:"Day 9 of the invasion, starfishs. Rotating STARFISHS? *gulp*",m:"SAVE BIKINI BOTTOM!",success:"Ok. That problem is solved.\n\nFortunately, these starfishs are allergic against lasers.\n\nNEXT!",failure:"Oh my mighty flying spaghetti monster!\n\n So many rotating tentacles.\n\nOuch!\n\nHurry, the rocket needs to start again!",respawn:20},{e:20,sn:4,sq:2,sqr:1,d:"Day 10 of the invasion, will there be an end?",m:"GO GO GO GO!",success:"Ok, they doubled their attacking crafts and... creatures.\n\nSo, i should also increase my firepower.\nLet's search the crashed aliens for upgrades...",failure:"Oh. That rapid unplanned disassembly was unfortunate.\n\nWhere is my duct tape?\n\n*covers rocket in grey tape*\n\nThat should work...",respawn:25},{e:20,sn:5,sq:3,sqr:2,d:"Day 13 of the invasion, no end in sight",m:"THERE IS NO TRY!",success:"Hu? How did that happen?\n\nYou are not supposed to win this game... ;-)\n\nHowever: congratulations, and thanks for playing!",failure:"ARGHL!\n\nThat cant be true!\nHow many of these TRISKAIDEKA are out there?!?!\nFeels like there is no end of this TRISKAIDEKAGEDDON!\n\n\nWell. In fact: there is no happy end.\nThats the worst day in earth's history.\nYou can try again, but...\nTRISKAIDEKAPHOBIA is real.\nThere is no escape...\n\nThanks for playing ;-)\n\n\nSpecial thx to Almar and Alcore for the constructive feedback!",respawn:1/0,count:!0}],ke=850,Ie=1,Le=2,Se=3,De=4,qe=5,Re=6,He=7;let Oe=[],_e=1;const Me=1,Be=2,Ce=[],Ne=(Ce[0]=0,Ce[Me]=1,Ce[Be]=1,document.querySelector(".msg")),We=document.querySelector("#sky");let Ke=0,Ge=0;const Pe={e:0,sn:0,sq:0,sqr:0,p:0};function Fe(e){switch(e){case Se:Pe.e++,Pe.p+=3;break;case Ie:Pe.sn++,Pe.p+=7;break;case 8:Pe.sq++,Pe.p+=13;break;case 9:Pe.sqr++,Pe.p+=17}}let Ue=null,je=(document.addEventListener("click",()=>{null==Ue&&1==_e&&0==Ke&&(Ue=Xe(Ae(960,410,"Please, use the keyboard or a gamepad, not the mouse or touch.",30)))}),-t),Je=t;const Ye=4*t;function Xe(e){return Oe.push(e),e}function Qe(t){return Oe.filter(e=>e.ot&&e.ot==t)}const Ve=tt(t,e);function Ze(){if(m.clearRect(0,0,t,e),Oe.filter(e=>e._r).forEach(e=>e._r()),2==_e){dn._r();{k(),E(et.x-960,ke),m.clearRect(0,0,t,e),S("#0056"),_(0,0,t,e);let a=0;[5,4,3,1].forEach(e=>{D(),m.lineWidth=e,L(n),q(0,a),R(t,a),H(),a+=2*e}),I()}var[,a]=rt({x:0,y:ke});a<e&&(Ve.ctx.clearRect(0,0,t,e),Ve.ctx.save(),Ve.ctx.scale(1,-1),Ve.ctx.drawImage(p,0,0,t,e,0,e-a+3,t,-e),Ve.ctx.restore(),m.globalAlpha=.5,m.drawImage(Ve.c,0,a,t,300),m.globalAlpha=1);{k(),g.translate(-2*et.ex,-2*et.ey),D(),L(me),N(960,450,350),H(),D(),L(me),M(1330,100,20,700),H(),S("#fa07"),_(1330,100,20,105),k(),g.translate(1310,100),T(90),g.font="20px sans-serif",g.fillText("DANGER",0,0),S(me),g.fillText("HEIGHT",0,-45),I(),700<(a=f((dn.y-ke)/-7200*700))&&(S(ge),g.font="30px sans-serif",g.textAlign="center",g.textBaseline="middle",g.fillText("ALTITUDE! ENGINE FROZEN!",960,300)),a=c(a,0,700),S(665<a?ge:ve),_(1325,800-a,30,4),a&&D(),L(me),M(570,100,20,700),H(),S(ve);let e=dn.h/dn.mh*700;e<0&&(e=0),_(570,800-e,20,e),k(),g.translate(610,800),T(-90),g.font="20px sans-serif",S(me),g.fillText("SHIELD STATUS",0,-45),I(),Te[Ke].count&&(S("#ff0"),g.font="40px sans-serif",g.textAlign="center",g.textBaseline="middle",g.fillText("Triskaidekageddon-Score: "+Pe.p,960,40)),I()}}}function ze(e){je=e.x<je?e.x:je,Je=e.x>Je?e.x:Je}function $e(){let r=b();U()&&((n=navigator.getGamepads()[W]).buttons.forEach((e,t)=>{K[t]=e.pressed}),n.axes.forEach((e,t)=>{G[t]=e})),tn+=r,et._u(r);var n=9*e,s=et.y-450;if(s=c(n+s,0,n)/n*-900,v.style.top=s+"vh",1==_e){var s=Qe(De).find(e=>e.a),l=J(0)||$(z);rn||l||(rn=!0),s&&rn&&l&&(rn=!1,s.c()),l=$(Z)||J(13)||.3<j(1),n=$(V)||J(12)||j(1)<-.3,an||l||n||(an=!0),s&&s.l[1]&&l&&an&&(s.l[1].a=!0,s.a=!1,an=!1),s&&s.l[-1]&&n&&an&&(s.l[-1].a=!0,s.a=!1,an=!1)}else if(2==_e){dn._u(r),je=-t,Je=t;let e=Qe(Le),n=Qe(He),s=Qe(Ie),i=Qe(Se),o=Qe(qe);if(!dn.won&&s.length+i.length+o.length==0){dn.lf=-2,Ne.classList.remove("hidden");let e=Te[Ke].success;Te[Ke].count&&(e+="\n\nScore Details: "+Pe.e+" scouts, "+Pe.sn+" jabberwockies, "+Pe.sq+" squids and "+Pe.sqr+" starfishs."),Ne.innerText=e,dn.won=!0}dn.alive&&(i.forEach(e=>{ze(e),lt(e,dn)<=e.r+dn.cr&&dn.ct<=0&&(--dn.h,--e.hp,dn.ct=.5,at(.25),Xe(Rt((e.x+dn.x)/2,(e.y+dn.y)/2,a)))}),n.forEach(e=>{lt(e,dn)<=e.r+dn.cr&&(--dn.h,at(.25),Xe(Rt((e.x+dn.x)/2,(e.y+dn.y)/2,a)),e.ttl=0)}),s.forEach(e=>{ze(e);let t=lt(dn,e)<=e.r+dn.cr,n=e;for(;n.c&&!t;)n=n.c,t=lt(dn,n)<=n.r+dn.cr;t&&dn.ct<=0&&(--dn.h,--e.hp,dn.ct=.5,at(.25),Xe(Rt((n.x+dn.x)/2,(n.y+dn.y)/2,a)))}),o.forEach(e=>{ze(o);var{hit:t,currentSegment:n}=en(dn,dn.cr,e);t&&dn.ct<=0&&(--dn.h,--e.hp,dn.ct=.5,at(.25),Xe(Rt((n.x+dn.x)/2,(n.y+dn.y)/2,a)))})),e.forEach(r=>{s.forEach(a=>{if(!(r.ttl<0)){let e=lt(r,a)<=a.r,n=a;for(;n.c&&!e;)n=n.c,e=lt(r,n)<=n.r;if(e){r.ttl=-1,--a.hp;for(let e=0;e<y(3,7);e++)Xe(Ot(r.x,r.y));if(ue(3),a.hp<=0){0<xn&&!a.tt?(xn--,a.y-=450,a.x+=.5<=y(0,1)?t:-t,a.hp=10):a.ttl=-1;{let t=a;for(;t.c;){Oe.push(qt(t.x+y(-t.r,t.r),t.y+y(-t.r,t.r),3));for(let e=0;e<y(3,7);e++)Xe(Ot(t.x+y(-t.r,t.r),t.y+y(-t.r,t.r)));t=t.c}Fe(Ie)}ue(de)}}}}),i.forEach(e=>{if(lt(r,e)<=e.r){r.ttl=-1,--e.hp;for(let e=0;e<y(2,4);e++)Xe(Ot(r.x,r.y));ue(3),e.hp<=0&&(0<xn?(xn--,e.y-=450,e.x+=.5<=y(0,1)?t:-t,e.hp=2):e.ttl=-1,Vt(e),ue(de))}}),o.forEach(e=>{if(en(r,2,e).hit){r.ttl=-1,--e.hp;for(let e=0;e<y(2,4);e++)Xe(Ot(r.x,r.y));ue(3)}})}),l=J(0)||$(z),!dn.alive&&0<dn.lf&&l?(Te[Ke].adv&&Ke++,sn()):dn.won&&0<dn.lf&&l&&(Ke++,Ge++,sn())}Oe.forEach(e=>{e._u&&e._u(r)}),Oe=Oe.filter(e=>void 0===e.ttl||0<e.ttl)}let tn=0;function en(e,t,n){let a=n,r=lt(e,n)<=n.s+t;if(!r)for(var s of n.t){for(r=lt(e,s)<=s.r+t,a=s;a.c&&!r;)a=a.c,r=lt(e,a)<=a.r+t;if(r)break}return{hit:r,currentSegment:a}}function nn(){Oe=[]}let rn=!1,an=!1;function sn(){Ne.classList.add("hidden"),rn=!1,an=!1,nn(),et.x=960,et.y=450,et.t=null,_e=1,Xe(function(){let t={x:960,y:70,s:.8,ttl:1/0,_r:()=>{{var o=t;let a=o.x,r=o.y,s=80,i=5;[.975,.98,.985,.99,.995,1].forEach(e=>{let n=o.s*e,t;k(),E(a-856*n,r-0*n+i),i-=2,m.lineWidth=4,s+=20,L("#"+((t=s)<=15?"0":"")+Number(t).toString(16)+"0000"),S("#f00"),pe.forEach(t=>{D(),q(t[0]*n,t[1]*n);for(let e=2;e<t.length-1;e+=2)R(t[e]*n,t[e+1]*n);R(t[0]*n,t[1]*n),O(),H()}),(m.lineWidth=1)==e&&(S("#ff8"),m.font=70*n+"px Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif",m.textAlign="left",m.textBaseline="bottom",m.fillText("AAAARGHHHHH!",100*n,0),m.textAlign="right",m.textBaseline="top",m.fillText("ATTACKS!!!",1700*n,250*n)),I()})}},_u:e=>{t.s=.8+.05*i(tn)+.05}};return t}());var e=Te[Ke],r=(e.d&&Xe(Ae(960,370,e.d)),0==Ke?(Xe(Ae(960,500,"Controls: Keyboard Arrows/WASD and SPACE or use a gamepad (button A)",20)),We.className="bg1"):We.className="bg"+d(1,3),!e.hideUpdates&&0<Ge),s=Xe(be(960,450,300,40,e.m,!r,pn));e.hideUpdates;{let t=Xe(Ae(960,530,"Available scrap for upgrades: 0",30)),n=(t._u=e=>t.t="Available scrap for upgrades: "+Ge,Xe(be(960,570,350,40,"ADD LASERS",r,hn))),a=Xe(be(960,620,350,40,"ENHANCE FIRE RATE",!(n._u=e=>{n.t="UPGRADE LASER ("+(3==Ce[Me]?"MAX":Ce[Me])+")"}),yn));a._u=e=>{a.t="ENHANCE FIRE RATE ("+(5==Ce[Be]?"MAX":Ce[Be])+")"},Ee(s,n,1),Ee(n,a,1),on?((e=Xe(be(960,730,550,30,"return to the story - where you left",!1,un))).ts=18,Ee(a,e,1)):((r=Xe(be(960,730,550,30,"pause the story - release the whole TRISKAIDEKA fleet",!1,fn))).ts=18,Ee(a,r,1))}Xe(Ae(960,860,"A 13 kilobyte game by DerBenniBanni (Github / itch.io / X) for the 2024 js13kgames.com gamejam",20)),0<Ke&&(ue(5),he(0))}let on=!1,ln=[],cn=0;function fn(){on=!0,ln=[],Ce.forEach(e=>ln.push(e)),cn=Ke,Ke=Te.length-1,Ce[Be]=5,Ce[Me]=3,Ce[0]=0,sn()}function un(){on=!1,Ce.length=0,ln.forEach(e=>Ce.push(e)),Ke=cn,sn()}function hn(){0<Ge&&Ce[Me]<3&&(Ce[Me]+=1,Ge--)}function yn(){0<Ge&&Ce[Be]<5&&(Ce[Be]+=1,Ge--)}let dn=null,xn=0;function pn(){Ne.classList.add("hidden");var n,a=Te[Ke];for(n in Pe.e=0,Pe.sn=0,Pe.sq=0,Pe.sqr=0,Pe.p=0,xn=a.respawn||0,Ne.innerText=a.success,nn(),_e=2,dn=mt(960,ke-3,-90),a.p)dn[n]=a.p[n];for(let n=0;n<50;n++)Xe(St(y(0,t),y(0,e)));if(a.e)for(let n=0;n<a.e;n++){var r=x([Zt,zt,$t,te,ee]),s=x([ne,re,ae]),i=x([se,ie,oe]);Xe(Qt(y(-t,2*t),y(2*-e,0),[r,s,i]))}if(a.sn)for(let n=0;n<a.sn;n++)Xe(Pt(dn.x+(0==d(0,1)?-1:1)*(200+y(0,t)),dn.y-y(0,e),d(13,33),d(13,33),y(100,180)));if(a.sq)for(let n=0;n<a.sq;n++)Xe(Jt(dn.x+(0==d(0,1)?-1:1)*(300+y(0,t)),dn.y-y(0,e),y(60,100)));if(a.sqr)for(let n=0;n<a.sqr;n++)Xe(Jt(dn.x+(0==d(0,1)?-1:1)*(300+y(0,t)),dn.y-y(0,e),y(60,100),9));ue(0),he(5)}b(),function e(){$e(),Ze(),requestAnimationFrame(e)}(),sn();</script>