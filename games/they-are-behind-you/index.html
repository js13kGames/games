<!DOCTYPE html><html><head><meta name=viewport content="width=device-width"><title>They are behind you</title><script src=/2019/webxr/aframe.js></script><script>!function(){function t(t){let e=t%360;return e<0&&(e+=360),e}function e(t,e){return(e.x-t.x)*(e.x-t.x)+(t.y-e.y)*(t.y-e.y)<=(t.r+e.r)*(t.r+e.r)}AFRAME.registerComponent("game",{schema:{default:""},map:{data:[],startHeight:3,width:3,tileSize:3,getHeight:function(t){return this.startHeight+3*t},getTile:function(t,e){return this.data[e*this.width+t]}},level:1,gotKeys:!1,dead:!0,winLevel:!1,transitionScreenDur:2e3,transitionScreenTimer:0,gameOverRoomPosition:{x:-500,y:-500,z:-500},entityRadius:{player:.5,enemy:1.4,key:.3},inGameOverRoom:!0,tips:["Never look them at their eyes.","Don't touch them.","The key is cursed.","Here rest an evil spirit.","Stay away when the curse is actived.","Nobody can leave this place"],nextLevel:function(){this.level++},renderGameOverRoom:function(){this.inGameOverRoom=!0,this.textLevelEndEl.setAttribute("visible",!1),this.textLevelEndSubEl.setAttribute("visible",!1),this.cursor.setAttribute("visible",!0),this.startButton.classList.add("button"),this.gameOverRoom.setAttribute("visible",!0),this.player.object3D.position.set(this.gameOverRoomPosition.x,this.gameOverRoomPosition.y,this.gameOverRoomPosition.z),this.textLevel.setAttribute("text","value","Level "+this.level)},gameOver:function(e){let i;switch(this.dead=!0,this.level=1,this.textLevelEndEl.setAttribute("visible",!0),this.textLevelEndEl.setAttribute("text","value","GAME OVER"),e){case"fall":i="You fell to hell.";break;case"touch":i="A demon caught you.";break;case"look":i="The demons looked you at your eyes."}if("look"===e){const e=t(THREE.Math.radToDeg(this.player.object3D.rotation._y)),i=e>0&&e<180?180:-180;this.player.setAttribute("animation",`property: rotation; to: 0 ${i} 0; startEvents: rotate;`),this.player.emit("rotate")}this.textLevelEndSubEl.setAttribute("visible",!0),this.textLevelEndSubEl.setAttribute("text","value",i),this.player.setAttribute("wasd-controls","enabled: false")},start:function(){this.inGameOverRoom=!1,this.dead=!1,this.winLevel=!1,this.gotKeys=!1,this.keyEl.setAttribute("visible",!0),this.textKeyEl.setAttribute("visible",!1),this.generateMap(),this.renderMap(),this.player.object3D.position.set(this.playerMapPosition.x,this.playerMapPosition.y,this.playerMapPosition.z),this.gameOverRoom.setAttribute("visible",!1),this.startButton.classList.remove("button"),this.cursor.setAttribute("visible",!1),this.player.setAttribute("wasd-controls","enabled: true"),this.player.setAttribute("look-controls","enabled: true")},generateMap:function(){const t=this.map.getHeight(this.level),e=new Array(3*t),i=[3,3,3];let s=0;for(var o=0;o<t;o++)if(0!==o&&o!==t-1)if(++s>2)s=0;else{const t=i.indexOf(0);let s;t>-1?(s=t,i[t]=3):s=Math.floor(3*Math.random());for(let t=i.length-1;t>=0;t--)t!==s&&i[t]--;e[3*o+s]=2}e[1]=5,e[e.length-2]=4,this.map.data=e},renderMap:function(){let t,e;for(this.ground.setAttribute("geometry","width",this.map.tileSize*this.map.width),this.ground.setAttribute("geometry","height",this.map.tileSize*this.map.getHeight(this.level));this.trapsEl.hasChildNodes();)this.trapsEl.removeChild(this.trapsEl.lastChild);for(;this.deadsEl.hasChildNodes();)this.deadsEl.removeChild(this.deadsEl.lastChild);for(let i=0;i<this.map.width;i++)for(let s=0;s<this.map.getHeight(this.level);s++){let o=this.map.getTile(i,s),r=(i-this.map.width/2)*this.map.tileSize+this.map.tileSize/2,l=1.6,a=(s-this.map.getHeight(this.level)/2)*this.map.tileSize+this.map.tileSize/2;2===o&&(e=document.createElement("a-plane"),this.trapsEl.appendChild(e),e.setAttribute("color","#040F16"),e.setAttribute("width",this.map.tileSize),e.setAttribute("height",this.map.tileSize),e.setAttribute("rotation","-90 0 0"),e.object3D.position.set(r,.01,a),e.setAttribute("text","align: center; anchor: center; color: #FBFBFF; value: "+this.tips[Math.floor(Math.random()*this.tips.length)]),t=document.createElement("a-plane"),this.deadsEl.appendChild(t),t.setAttribute("material","src: #sprite-dead; transparent: true; side: double"),t.setAttribute("width",.57),t.setAttribute("height",1.5),t.object3D.position.set(r,-1,a)),4===o&&(this.playerMapPosition={x:r,y:l,z:a},this.exitDoor.setAttribute("geometry","width",this.map.tileSize),this.exitDoor.setAttribute("geometry","height",this.map.tileSize),this.exitDoor.object3D.position.set(r,.01,a)),5===o&&(this.keyEl.object3D.position.set(r,1.2,a),this.keyEl.setAttribute("visible",!0),this.textKeyEl.object3D.position.set(r,1.5,a-2.5))}},init:function(){const t=this;this.ground=document.getElementById("ground"),this.player=document.getElementById("player"),this.player.setAttribute("rotation-reader",""),this.player.setAttribute("universal-controls",""),this.cursor=document.getElementById("cursor"),this.gameOverRoom=document.getElementById("gameoverbox"),this.gameOverRoom.object3D.position.set(this.gameOverRoomPosition.x,this.gameOverRoomPosition.y,this.gameOverRoomPosition.z),this.startButton=document.getElementById("start-button"),this.startButton.classList.add("button"),this.startButton.addEventListener("click",function(e){t.start()}),this.camera=document.getElementById("camera"),this.trapsEl=document.getElementById("traps"),this.keyEl=document.getElementById("key"),this.deadsEl=document.getElementById("deads"),this.exitDoor=document.getElementById("exitdoor"),this.textLevel=document.getElementById("text-level"),this.textKeyEl=document.getElementById("text-key"),this.textLevelEndEl=document.getElementById("text-levelend"),this.textLevelEndSubEl=document.getElementById("text-levelend-sub"),this.loaded=!0,this.renderGameOverRoom()},tick:function(i,s){if(!this.loaded)return;if(this.dead||this.winLevel)return this.transitionScreenTimer+=s,void(this.transitionScreenTimer>=this.transitionScreenDur&&(this.transitionScreenTimer=0,this.inGameOverRoom||this.renderGameOverRoom()));this.transitionScreenTimer=0;const o=this.player.getAttribute("position"),r=Math.floor(o.x/this.map.tileSize+this.map.width/2),l=Math.floor(o.z/this.map.tileSize+this.map.getHeight(this.level)/2);(r<0||r>this.map.width-1||l<0||l>this.map.getHeight(this.level)-1)&&(this.player.object3D.position.set(o.x,o.y-.005*s,o.z),o.y<-5&&this.gameOver("fall"));const a=this.keyEl.getAttribute("position");if(this.gotKeys){const i=t(THREE.Math.radToDeg(this.player.object3D.rotation._y));i>90&&i<270&&this.gameOver("look");for(let t=this.deadsEl.childNodes.length-1;t>=0;t--){const i=this.deadsEl.childNodes[t].getAttribute("position");if(e({x:o.x,y:o.z,r:this.entityRadius.player},{x:i.x,y:i.z,r:this.entityRadius.enemy}))return void this.gameOver("touch")}4===this.map.getTile(r,l)&&(this.winLevel=!0,this.textLevelEndEl.setAttribute("visible",!0),this.textLevelEndEl.setAttribute("text","value","NEXT LEVEL"),this.player.setAttribute("wasd-controls","enabled: false"),this.nextLevel())}else if(e({x:o.x,y:o.z,r:this.entityRadius.player},{x:a.x,y:a.z,r:this.entityRadius.key})){this.gotKeys=!0,this.keyEl.setAttribute("visible",!1),this.textKeyEl.setAttribute("visible",!0);for(let t=this.deadsEl.childNodes.length-1;t>=0;t--){this.deadsEl.childNodes[t].object3D.position.y=1}for(let t=this.trapsEl.childNodes.length-1;t>=0;t--){this.trapsEl.childNodes[t].setAttribute("text","value","")}}}}),document.addEventListener("DOMContentLoaded",function(){document.querySelector("a-scene").setAttribute("game","")})}();</script></head><body><a-scene fog="type: exponential; color: #2A324C; density: 0.2;"><a-assets><img id=sprite-key src=key.png> <img id=sprite-dead src=dead.png> <img id=sprite-play-button src=play.png></a-assets><a-entity id=player wasd-controls="enabled: false; acceleration: 200;" look-controls="pointerLockEnabled: true;" position="0 1.6 0"><a-entity id=camera camera position="0 0 0"></a-entity><a-entity id=cursor cursor="fuse: true; fuseTimeout: 1000" raycaster="objects: .button" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: blue; shader: flat"></a-entity><a-entity id=text-levelend position="0 0 -0.1" visible=false text="align: center; anchor: center; width: 1; color: #FBFBFF;"></a-entity><a-entity id=text-levelend-sub position="0 -0.03 -0.1" visible=false text="align: center; anchor: center; width: .3; color: #FBFBFF;"></a-entity><a-light color=#fff distance=5 intensity=0.7 type=point></a-light></a-entity><a-entity id=gameoverbox geometry="primitive: box; width: 5; height: 5; depth: 5" material="color: #040F16; side: double" position="0 0 0"><a-entity position="0 1 -2.5" text="align: center; anchor: center; width: 8; color: #FBFBFF; value: They are behind you"></a-entity><a-entity id=text-level position="0 0 -2.5" text="align:center; anchor: center; width: 3; color: #FBFBFF; value: Level"></a-entity><a-entity position="0 0 1.5" rotation="0 -180 0" text="align:center; anchor: center; width: 3; color: #FBFBFF; side: double; value: Not yet. -.-"></a-entity><a-entity id=start-button animation__mouseenter="property: scale; to: 1.2 1.2 1.2; dur: 300; startEvents: mouseenter;" animation__mouseleave="property: scale; to: 1 1 1; dur: 300; startEvents: mouseleave;" geometry="primitive: box; width :0.5; height: 0.3; depth: 0.5" material="src: #sprite-play-button; shader: flat" position="-1.5 -.5 -1"></a-entity></a-entity><a-entity id=traps></a-entity><a-entity id=deads></a-entity><a-entity id=text-key position="0 0 0" visible=false text="align: center; anchor: center; width: 5; color: #FBFBFF; value: You've unleashed the curse.\nDon't look back or they will catch you!"></a-entity><a-entity id=key position="0 0 0"><a-plane material="src: #sprite-key; transparent: true; side: double" width=0.5 height=0.5></a-plane><a-light color=gold distance=5 intensity=0.7 type=point></a-light></a-entity><a-entity id=exitdoor rotation="-90 0 0" geometry="primitive: plane;" material="color: #FBFBFF; side: double;" text="align: center; anchor: center; color: black; value: Find the key and get back to this point."></a-entity><a-entity id=ground material="color: #291711; side: double; repeat: 75 75;" rotation="-90 0 0" geometry="primitive: plane;"></a-entity><a-sky id=sky color=#0000ff></a-sky><a-light type=ambient color=#92455E intensity=0.4></a-light></a-scene></body></html>