<!doctype html><meta content="width=device-width" name=viewport><title>CUBES - js13kGames 2012</title><style>body{height:100%}div{display:block;position:absolute;top:0;left:0;width:100%;height:100%;background:#300}canvas{position:relative;top:50%;left:50%;margin-top:-300px;margin-left:-480px}</style><div><div><a href=https://twitter.com/ricotweet target=_blank><img src=t.gif></a><a href=https://github.com/RicoP/cubes.js target=_blank><img src=g.gif></a></div><canvas height=600 width=960></canvas></div><script>function g(e){var t=new ce(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t}function w(e){return(e=e||g())[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Y(e,t,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],f=e[7],d=e[8],h=e[9],l=e[10],g=e[11],w=e[12],v=e[13],m=e[14],p=e[15],b=t[0],k=t[1],x=t[2],y=t[3];(n=n||e)[0]=b*r+k*s+x*d+y*w,n[1]=b*a+k*c+x*h+y*v,n[2]=b*i+k*u+x*l+y*m,n[3]=b*o+k*f+x*g+y*p,n[4]=(b=t[4])*r+(k=t[5])*s+(x=t[6])*d+(y=t[7])*w,n[5]=b*a+k*c+x*h+y*v,n[6]=b*i+k*u+x*l+y*m,n[7]=b*o+k*f+x*g+y*p,n[8]=(b=t[8])*r+(k=t[9])*s+(x=t[10])*d+(y=t[11])*w,n[9]=b*a+k*c+x*h+y*v,n[10]=b*i+k*u+x*l+y*m,n[11]=b*o+k*f+x*g+y*p,n[12]=(b=t[12])*r+(k=t[13])*s+(x=t[14])*d+(y=t[15])*w,n[13]=b*a+k*c+x*h+y*v,n[14]=b*i+k*u+x*l+y*m,n[15]=b*o+k*f+x*g+y*p}function Q(e,t,n){var r,a,i,o,s,c,u,f,d,h,l,g,w=t[0],v=t[1];t=t[2],n&&e!==n?(r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],c=e[5],u=e[6],f=e[7],d=e[8],h=e[9],l=e[10],g=e[11],n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=c,n[6]=u,n[7]=f,n[8]=d,n[9]=h,n[10]=l,n[11]=g,n[12]=r*w+s*v+d*t+e[12],n[13]=a*w+c*v+h*t+e[13],n[14]=i*w+u*v+l*t+e[14],n[15]=o*w+f*v+g*t+e[15]):(e[12]=e[0]*w+e[4]*v+e[8]*t+e[12],e[13]=e[1]*w+e[5]*v+e[9]*t+e[13],e[14]=e[2]*w+e[6]*v+e[10]*t+e[14],e[15]=e[3]*w+e[7]*v+e[11]*t+e[15])}function E(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function D(e){var t=new ce(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t}function m(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)}function Z(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e)}function s(e,t){t=t||e;var n=e[0],r=e[1],a=(e=e[2],Math.sqrt(n*n+r*r+e*e));return a?1===a?(t[0]=n,t[1]=r,t[2]=e):(t[0]=n*(a=1/a),t[1]=r*a,t[2]=e*a):(t[0]=0,t[1]=0,t[2]=0),t}function i(e,t,n){var r=e[0],a=e[1],i=e[2],o=t[0],s=t[1];return(n=n||e)[0]=a*(t=t[2])-i*s,n[1]=i*o-r*t,n[2]=r*s-a*o,n}function c(e,t,n){var r=t[0],a=t[1],i=t[2],o=e[0],s=e[1],c=e[2],u=(e=e[3])*r+s*i-c*a,f=e*a+c*r-o*i,d=e*i+o*a-s*r;(n=n||t)[0]=u*e+(r=-o*r-s*a-c*i)*-o+f*-c-d*-s,n[1]=f*e+r*-s+d*-o-u*-c,n[2]=d*e+r*-c+u*-s-f*-o}function u(e,t,n){n=n||new ce(4),e*=.5;var r=Math.sin(e);return n[3]=Math.cos(e),n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n}function l(e){var t=new(mt||Array)(4096),n=362436,r=2654435769;t[0]=e,t[1]=e+r,t[2]=e+r+r;for(var a=3;a<4096;a++)t[a]=t[a-3]^t[a-2]^r^a;var i=4095;this.next=function(){(e=(e=18782*t[i=i+1&4095]+n)+(n=e>>32))<n&&(e++,n++);var e=t[i]=4294967294-e;return e<0?-e%65535:e%65535}}function f(e){var t=this,n=0;t.position=e,t.getFace=function(){return n},t.view=function(){switch(n){case 0:n=1;break;case 1:case 2:break;case 3:n=4}},t.unview=function(){switch(n){case 0:case 2:case 3:break;case 1:n=0;break;case 4:n=3}},t.touch=function(){n=2},t.leave=function(){switch(n){case 0:case 1:case 3:break;case 2:case 4:n=3}},t.reset=function(){n=0}}function $(){var e,t,n,r,a,i,o,s,c,u,f,d,h,l=H;E(O,l),Z(l,B),m(l,q),e=q,t=Ve,n=(n=z)||g(),s=l[0],c=l[1],l=l[2],u=t[0],f=t[1],t=t[2],d=e[0],h=e[1],e=e[2],s===d&&c===h&&l===e?w(n):(d=s-d,h=c-h,e=l-e,r=f*(e*=o=1/Math.sqrt(d*d+h*h+e*e))-t*(h*=o),t=t*(d*=o)-u*e,u=u*h-f*d,(o=Math.sqrt(r*r+t*t+u*u))?(r*=o=1/o,t*=o,u*=o):u=t=r=0,f=h*u-e*t,a=e*r-d*u,i=d*t-h*r,(o=Math.sqrt(f*f+a*a+i*i))?(f*=o=1/o,a*=o,i*=o):i=a=f=0,n[0]=r,n[1]=f,n[2]=d,n[3]=0,n[4]=t,n[5]=a,n[6]=h,n[7]=0,n[8]=u,n[9]=i,n[10]=e,n[11]=0,n[12]=-(r*s+t*c+u*l),n[13]=-(f*s+a*c+i*l),n[14]=-(d*s+h*c+e*l),n[15]=1)}function ee(e){c(u(e,Ve),O),$()}function te(e){var t=s(i(Ve,O,H));c(u(e,t),O),s(i(O,t,Ve)),$()}function ne(e){try{k=e,J.keys.wasReleased(J.keys.codes.p)&&(tt=!tt),(F.poke||J.keys.wasPressed(J.keys.codes.space))&&(x=Oe(O),C.tap(k,x)),F.drag&&(x=2*F.dragDirection.x*Math.PI/K.width,y=2*F.dragDirection.y*Math.PI/K.height,ee(x),te(y)),(J.keys.isDown(J.keys.codes.left)||J.keys.isDown(J.keys.codes.a))&&ee(k.delta*Math.PI),(J.keys.isDown(J.keys.codes.right)||J.keys.isDown(J.keys.codes.d))&&ee(-k.delta*Math.PI),(J.keys.isDown(J.keys.codes.up)||J.keys.isDown(J.keys.codes.w))&&te(k.delta*Math.PI),(J.keys.isDown(J.keys.codes.down)||J.keys.isDown(J.keys.codes.s))&&te(-k.delta*Math.PI),C.isWinning()&&re(),F.update(),C.tick(k);var t,n,r,a,i,o,s,c,u,f,d=e;if(ke(We),Pe(c=de),u=N(c,"uModelviewprojection"),l=N(c,"uTexture"),w=T(c,"aVertex"),v=T(c,"aTextureuv"),c=N(c,"uTextureOffset"),f=H,j(U,ge),L(w,4,X,!1,I.stride,I.voffset),V(w),L(v,4,X,!1,I.stride,I.toffset),V(v),S(W,Le),Ce(l,0),Z(w=E(O,Te),B),Y(Se,z,f),Q(f,q),Q(f,w),Ie(u,!1,f),R(c,0,0),xe(4,0,I.numVertices),ye(We),ve(256),nt){Pe(v=de);var h=N(v,"uModelviewprojection"),l=N(v,"uTexture"),g=N(v,"uTextureOffset"),w=T(v,"aVertex"),v=T(v,"aTextureuv"),m=H;j(U,he),L(w,4,X,!1,M.stride,M.voffset),V(w),-1!==v&&(L(v,4,X,!1,M.stride,M.toffset),V(v)),l&&(S(W,Ne),Ce(l,0));for(var p=0;p!=G.length;p++){var b=G[p];if(g)switch(b.getFace()){case 0:R(g,0,0);break;case 1:R(g,.3125,0);break;case 2:R(g,.3125,.3125);break;case 3:R(g,0,.3125);break;case 4:R(g,.625,0)}Y(Se,z,m),Q(m,b.position),Ie(h,!1,m),xe(4,0,M.numVertices)}Pe(u=de),f=N(u,"uModelviewprojection"),c=N(u,"uTexture"),w=T(u,"aVertex"),u=T(u,"aTextureuv"),v=H,j(U,le),L(w,4,X,!1,A.stride,A.voffset),V(w),-1!==u&&(L(u,4,X,!1,A.stride,A.toffset),V(u)),c&&(S(W,Re),Ce(c,0)),Y(Se,z,v),Q(v,C.position),1!==C.size&&(w=v,c=(u=[C.size,C.size,C.size])[0],l=u[1],u=u[2],w[0]*=c,w[1]*=c,w[2]*=c,w[3]*=c,w[4]*=l,w[5]*=l,w[6]*=l,w[7]*=l,w[8]*=u,w[9]*=u,w[10]*=u,w[11]*=u),Ie(f,!1,v),xe(4,0,A.numVertices),l=d,Pe(c=de),w=N(c,"uModelviewprojection"),u=N(c,"uTexture"),f=T(c,"aVertex"),c=T(c,"aTextureuv"),v=H,j(U,fe),L(f,4,X,!1,P.stride,P.voffset),V(f),-1!==c&&(L(c,4,X,!1,P.stride,P.toffset),V(c)),u&&(S(W,Fe),Ce(u,0)),Y(Se,z,v),Q(v,_),f=v,c=l.total,u=Math.sin(c),c=Math.cos(c),l=f[0],d=f[1],n=f[2],r=f[3],a=f[8],i=f[9],o=f[10],s=f[11],t?f!==t&&(t[4]=f[4],t[5]=f[5],t[6]=f[6],t[7]=f[7],t[12]=f[12],t[13]=f[13],t[14]=f[14],t[15]=f[15]):t=f,t[0]=l*c+a*-u,t[1]=d*c+i*-u,t[2]=n*c+o*-u,t[3]=r*c+s*-u,t[8]=l*u+a*c,t[9]=d*u+i*c,t[10]=n*u+o*c,t[11]=r*u+s*c,Ie(w,!1,v),xe(4,0,P.numVertices)}J.requestGameFrame(ne)}catch(e){}var k,x,y}function p(e,t){S(W,t),Ee($e,!0),De(W,0,Je,Je,et,e),Ae(W,Qe,Ke),Ae(W,Ze,Ke)}function b(e){var t=be();return p(e,t),S(W,null),t}function k(e,t){var n,r,a=function(e,t,n,r){n=t.width,r=t.height;for(var a=t.getContext("2d"),i=(n=a.getImageData(0,0,n,r),Math.random),o=n.data,s=o.length,c=0;c<s;)1===e?(o[c+0]=256*i()|0,o[c+1]=0):(o[c+0]=0,o[c+1]=256*i()|0),o[c+2]=0,o[c+3]=255,c+=4;return a.putImageData(n,0,0),t}(t,(t=e.width,n=e.height,(r=gt.createElement("canvas")).width=t,r.height=n,r)),i=e.getContext("2d");i.save();for(var o=4;o<=a.width;o*=2){var s=Math.random()*(a.width-o)|0,c=Math.random()*(a.height-o)|0;i.globalAlpha=4/o,i.drawImage(a,s,c,o,o,0,0,e.width,e.height)}return i.restore(),e}function re(){var v,n,e=qe.shift();if(e){v=16,n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=function e(t){var n=new l(t),r=2+n.next()%3,a=[8,8,8],i=function(){for(var e=[],t=16;t--;){e[t]=[];for(var n=16;n--;){e[t][n]=[];for(var r=16;r--;)e[t][n][r]=0}}return e}();m(i,a,2);for(var o=[],s=[],c=M(n,a,r,0,-1,o,i,16,!1),u=0;u!==r;u++){for(var f=n.next()%o.length,d=o[f],h=0;h!==f+1;h++)s.push(o[h]);o=[],c=c&&M(n,d,r,0,-1,o,i,16,u===r-1)}for(h=0;h!==f;h++)s.push(o[h]);return c?{startingPosition:{x:a[0],y:a[0],z:a[0]},getObject:function(e,t,n){return p(i,16,[e,t,n])},path:s,dimension:16}:e(t+1)}(e),G=[];for(var t=0;16!==t;t++)for(var r=0;16!==r;r++)for(var a=0;16!==a;a++){var i=o.getObject(t,r,a);1===i?G.push(new f(D([t,r,a]))):3===i&&(_[0]=t,_[1]=r,_[2]=a)}q[0]=o.startingPosition.x,q[1]=o.startingPosition.x,q[2]=o.startingPosition.x,C=new ue({x:q[0],y:q[1],z:q[2]},G,_,o.dimension),E(q,O),O[0]=0,O[1]=0,O[2]=1,$()}else nt=!1;function m(e,t,n){e[t[0]][t[1]][t[2]]=n}function p(e,t,n){var r=n[0],a=n[1];return n=n[2],r<0||a<0||n<0||t<=r||t<=a||t<=n?-1:e[r][a][n]}function b(e){return-1===e?-1:[1,0,3,2,5,4][e]}function k(e,t){return t=n[t],(e=e.slice(0))[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e}function x(e,t,n){return 0===n?e:x(k(e,t),t,n-1)}function y(e,t,n,r,a){return a<2||0===p(e,t,n=k(n,r))&&y(e,t,n,r,a-1)}function M(e,t,n,r,a,i,o,s,c){var u,f,d,h,l=1===n&&c?3:1,g=e.next()%6,w=3+e.next()%(s-3);return 0===n||!(v<=r)&&(g===a||g===b(a)?M(e,t,n,r,a,i,o,s,c):y(o,s,t,g,w)&&-1!==p(o,s,h=x(t,g,w))?(r=o,a=s,f=g,(d=w)<2||0===p(r,a,u=k(t,f))&&(m(r,u,4),y(r,a,u,f,d-1)),m(o,h,l),r=x(t,g,w-1),i.push(r),M(e,r,n-1,0,b(g),i,o,s,c)):M(e,t,n,r+1,a,i,o,s,c))}}function x(i,s,o,c){function u(e,t,n){var r,a=e[0],i=e[1];e=e[2],a<0||c<=a||i<0||c<=i||e<0||c<=e||((r=d(a,i,e))?n?r.view():r.unview():u([a+(r=v.getVector(t))[0],i+r[1],e+r[2]],t,n))}function n(e,t){for(var n,r=0;6!==r;r++)r!==t&&(n=v.getVector(r),m(D(i.position),n),u(e,r,!0))}function f(e,t){for(var n,r=0;6!==r;r++)r!==t&&(n=v.getVector(r),m(D(i.position),n),u(e,r,!1))}function d(e,t,n){for(var r=0,a=s.length;r!==a;r++){var i=s[r],o=i.position;if(o[0]===e&&o[1]===t&&o[2]===n)return i}return null}var h=0,l=D(),g=D(),r=D(i.position),w=0;this.tick=function(e){switch(h){case 0:break;case 2:if(i.size-=.5*e.delta,i.size<0){for(var t=0;t!==s.length;t++)s[t].reset();return E(r,i.position),h=0,i.size=1,void n(i.position,-1)}case 1:m(i.position,Z(l,8*e.delta,ie)),1<=(w+=8*e.delta)&&2!==h&&(E(m(g,l,ie),i.position),n(i.position,v.getDirectionBasedOnVector(l)),w=h=0,this.tap(e,l))}},this.tap=function(e,t){switch(h){case 1:case 2:break;case 0:var n=Math.round(i.position[0]+t[0]),r=Math.round(i.position[1]+t[1]),a=Math.round(i.position[2]+t[2]);return n===o[0]&&r===o[1]&&a===o[2]?void(i.winning=!0):n<0||c<=n||r<0||c<=r||a<0||c<=a?(h=2,void f(i.position,v.getDirectionBasedOnVector(l))):(n=d(n,r,a))?(n.touch(),i.lastCube&&i.lastCube!==n&&i.lastCube.leave(),void(i.lastCube=n)):(i.lastCube&&i.lastCube!==n&&i.lastCube.leave(),i.lastCube=n,E(t,l),E(i.position,g),w=0,f(i.position,v.getDirectionBasedOnVector(l)),void(h=1))}},n(i.position,-1)}function y(e){return-1===e?se:oe[e]}function ae(e){return-1===e?-1:[1,0,3,2,5,4][e]}var ie,oe,se,ce,v,ue,M,A,C,I,P,fe,de,he,le,ge,o,j,S,we,ve,me,pe,be,ke,xe,ye,V,T,N,Me,Ee,De,Ae,Ce,Ie,Pe,L,je,R,F,Se,O,q,Ve,z,B,H,Te,Ne,Le,Re,Fe,G,_,Oe,qe,ze,Be,He,Ge,_e,e,Ue,Xe,U,We,X,Ke,Je,Ye,W,Qe,Ze,$e,et,tt,nt,d,rt,at,K,h,it,ot,st,ct,ut,ft,dt,r,t,n,ht,lt,gt=document,wt=this,vt=Float32Array||Array,mt=Uint32Array||Array,a=Uint8Array||Array,J={};function pt(e,t){this.x=e,this.y=t,this.toString=function(){return"["+e+", "+t+"]"}}function bt(n,r,a,i){var o=0,s=!1,c=new XMLHttpRequest;c.onreadystatechange=function(){var e;if(!s)if(2!==c.readyState&&3!==c.readyState||(t=c.getResponseHeader("content-type"),o="application/json"===(t=t.toLowerCase())?2:"text/html"===t?7:-1!==t.indexOf("javascript")?3:-1!==t.indexOf("xml")?4:-1!==t.indexOf("image")?5:1,r.toLowerCase().lastIndexOf(".json")+5===r.length?o=2:r.toLowerCase().lastIndexOf(".obj")+4===r.length&&(o=6),5!==o)){if(4===c.readyState){var t=c.status;if(200<=t&&t<=299||304===t||0===t)if(4===o)a(n,c.responseXML);else if(2===o)try{a(n,JSON.parse(c.responseText))}catch(e){i(r,e)}else if(6===o)try{a(n,it.obj.parse(c.responseText))}catch(e){i(r,e)}else a(n,c.responseText);else i(r,t||0)}}else s=!0,c.abort(),(e=new Image).onload=function(){a(n,e)},e.onerror=function(){i(r,"Loading image failed.")},e.src=r},c.open("GET",r,!0),c.send(null)}function kt(){}function xt(){for(var e=0;256!==e;e++)ht[e]=0,n[e]=0}lt=["experimental-webgl","webgl","moz-webgl","webkit-3d"],J.createContext=function(e){for(var t,n=0;t=lt[n++];)if(t=e.getContext(t,{alpha:!1,preserveDrawingBuffer:!0}))return t;return null},t=J,n=new(a=a||Array)(256),ht=new a(256),xt(),gt.addEventListener("keydown",function(e){(e=e.keyCode)<256&&(n[e]=1)},!1),gt.addEventListener("keyup",function(e){(e=e.keyCode)<256&&(n[e]=0)},!1),wt.addEventListener("blur",function(){xt()},!1),t.keys={codes:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,num0:48,num1:49,num2:50,num3:51,num4:52,num5:53,num6:54,num7:55,num8:56,num9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windowKeyLeft:91,windowKeyRight:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equals:187,comma:188,dash:189,period:190,slash:191,graveAccent:192,openBracket:219,backSlash:220,closeBraket:221,quote:222},update:function(){for(var e=0;256!==e;e++)ht[e]=n[e]},isDown:function(e){return 0!==n[e]},isUp:function(e){return 0===n[e]},wasPressed:function(e){return 0!==n[e]&&0===ht[e]},wasReleased:function(e){return 0===n[e]&&0!==ht[e]}},st=J,ut=(ct=wt).requestAnimationFrame||ct.webkitRequestAnimationFrame||ct.mozRequestAnimationFrame||ct.oRequestAnimationFrame||ct.msRequestAnimationFrame||function(e){ct.setTimeout(e,16)},ft=-1,r={total:dt=0,delta:0,frame:0,reset:function(){ft=-1,r.total=0,r.frame=0}},st.requestGameFrame=function(n){ut(function(){var e=Date.now(),t=(-1===ft&&(ft=dt=e,r.frame=0),(e-dt)/1e3);r.delta=t,r.total+=t,n(r),r.frame++,dt=e,st.keys.update()})},ot=/[\t\r\n ]+/g,(a=J).obj={},a.obj.parse=function(e){for(var t=e.split("\n"),r="",s=0,a=[],i=[],n=[],c=[],u=[],f=[],d=0,o={v:function(e){if(!e||3!=e.length)throw new Error("Can't accept Vertic without 3 components. LINE:"+r);var t=Number(e[0]),n=Number(e[1]);e=Number(e[2]),a.push(t,n,e)},vn:function(e){if(!e||3!=e.length)throw new Error("Can't accept Normal without 3 components. LINE:"+s);var t=Number(e[0]),n=Number(e[1]);e=Number(e[2]),i.push(t,n,e)},vt:function(e){if(!e||e.length<2)throw new Error("Can't accept Texture with less than 2 components. LINE:"+s);var t=Number(e[0]);e=Number(e[1]),n.push(t,e)},f:function e(t){if(!t||t.length<3)throw new Error("Can't accept Face with less than 3 components. LINE:"+s);if(3<t.length)for(var n=t.length-1;1!==n;n--)e([t[0],t[n-1],t[n]]);else{d++;for(var r=0;3!==r;r++){var a=t[r].split("/"),i=parseInt(a[0],10)-1,o=parseInt(a[1],10)-1,n=parseInt(a[2],10)-1;c.push(i),isNaN(o)||f.push(o),isNaN(n)||u.push(n)}}}},s=0;s!=t.length;){var h=(r=t[s++].trim()).split(ot),l=h.shift();l in o&&o[l](h)}var g=0;if((0!==n.length||0!==f.length)&&(g|=2,c.length!==f.length))throw new Error("Texture indice don't match Vertic indice.");if((0!==i.length||0!==u.length)&&(g|=1,c.length!==u.length))throw new Error("Normal indice don't match Vertic indice.");var w=0,v=0,m=0;switch(g){case 0:m=4;break;case 2:m=6,w=16;break;case 1:m=8,v=16;break;case 3:m=10,w=16,v=24;break;default:throw new Error("Schema broken.")}for(var p,b=new vt(3*d*m),k=0,x=0;x!=c.length;x++)p=3*c[x],b[k++]=a[p++],b[k++]=a[p++],b[k++]=a[p],b[k++]=1,2&g&&(p=2*f[x],b[k++]=n[p++],b[k++]=n[p]),1&g&&(p=3*u[x],b[k++]=i[p++],b[k++]=i[p++],b[k++]=i[p],b[k++]=0);return{stride:4*m,schema:g,voffset:0,toffset:w,noffset:v,rawData:b,numVertices:3*d}},a.obj.SCHEMA_V=0,a.obj.SCHEMA_VN=1,a.obj.SCHEMA_VT=2,a.obj.SCHEMA_VTN=3,(it=J).loadmanager={},it.loadmanager.loadFiles=function(e){if(!e)throw new Error("Passed nothing in loadFiles");var t=e.files||{},n=e.update||kt,r=e.finished||kt,a=e.error||kt,i=0,o=0,s=Object.create(null),c=function(e,t){o++,s[e]=t,n(e,o/i),o===i&&r(s)},u=function(e,t){u=c=kt,a(e,t)};if(t instanceof Array)for(var f,i=t.length,d=0;f=t[d++];)bt(f,f,c,u);else{var h,l=Object.keys(t);for(i=l.length,d=0;h=l[d++];)t.hasOwnProperty(h)&&bt(h,t[h],c,u)}},(t=J).shader={},t.shader.compileProgram=function(e,t){for(var n,r=["#define VERTEX\n","#define FRAGMENT\n"],a=[e.createShader(e.VERTEX_SHADER),e.createShader(e.FRAGMENT_SHADER)],i=e.createProgram(),o="",s=0;s!=r.length;s++){if(e.shaderSource(n=a[s],r[s]+"#line 0\n"+t),e.compileShader(n),o=e.getShaderInfoLog(n))throw new Error(o);e.attachShader(i,n)}return e.linkProgram(i),o=e.getProgramInfoLog(i),i},ce=vt,oe=[D([1,0,0]),D([-1,0,0]),D([0,1,0]),D([0,-1,0]),D([0,0,1]),D([0,0,-1])],se=D([0,0,0]),v={getVector:y,getOppositeDirection:ae,getOppositeVector:function(e){return y(ae(e))},getDirectionBasedOnVector:function(e){var t=D(e);s(t);for(var n=0;6!==n;n++){var r=y(n);if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2])return n}if(0===t[0]&&0===t[1]&&0===t[2])return-1}},ie=D(),ue=function(e,t,n,r){this.position=D([e.x,e.y,e.z]),this.size=1,this.lastCube=null;var a=new x(this,t,n,r),i=(this.tap=function(e,t){a.tap(e,t)},this.tick=function(e){a.tick(e)},this.winning=!1,this);this.isWinning=function(){return i.winning}},U=34962,We=2929,X=5126,Ke=9728,Je=6408,Ye=35044,W=3553,Qe=10240,Ze=10241,$e=37440,nt=!(tt=!(et=5121)),d=new function(){var e=gt.createElement("canvas"),t=(e.width=e.height=64,e.getContext("2d"));this.getCanvasCoordinate=function e(t,n,r){if(n<0)switch(t){case 0:return e(1,r,-n-1);case 1:return e(5,-n-1,15-r);case 2:return e(1,n+16,r);case 3:return e(2,n+16,r);case 4:return e(1,15-r,16+n);case 5:return e(1,-n-1,15-r);default:throw new RangeError}if(r<0)switch(t){case 0:return e(5,n,16+r);case 1:return e(0,-r-1,n);case 2:return e(0,n,16+r);case 3:return e(0,16+r,15-n);case 4:return e(2,n,16+r);case 5:return e(4,n,16+r);default:throw new RangeError}if(16<=n)switch(t){case 0:return e(3,15-r,n-16);case 1:return e(2,n-16,r);case 2:return e(3,n-16,r);case 3:return e(5,31-n,15-r);case 4:return e(3,r,31-n);case 5:return e(3,31-n,15-r);default:throw new RangeError}if(16<=r)switch(t){case 0:return e(2,n,r-16);case 1:return e(4,r-16,15-n);case 2:return e(4,n,r-16);case 3:return e(4,31-r,n);case 4:return e(5,n,r-16);case 5:return e(0,n,r-16);default:throw new RangeError}switch(t){case 0:return new pt(n+16,r);case 1:return new pt(n,r+16);case 2:return new pt(n+16,r+16);case 3:return new pt(n+32,r+16);case 4:return new pt(n+16,r+32);case 5:return new pt(n+16,r+48);default:throw new RangeError}},this.canvas=e,this.ctx=t},rt="#FF0000",at=0,K=gt.getElementsByTagName("canvas")[0],(h=J.createContext(K))?(h.attachShader.bind(h),j=h.bindBuffer.bind(h),S=h.bindTexture.bind(h),we=h.bufferData.bind(h),ve=h.clear.bind(h),me=h.clearColor.bind(h),h.compileShader.bind(h),pe=h.createBuffer.bind(h),h.createProgram.bind(h),h.createShader.bind(h),be=h.createTexture.bind(h),ke=h.disable.bind(h),xe=h.drawArrays.bind(h),ye=h.enable.bind(h),V=h.enableVertexAttribArray.bind(h),T=h.getAttribLocation.bind(h),h.getProgramInfoLog.bind(h),h.getShaderInfoLog.bind(h),N=h.getUniformLocation.bind(h),Me=h.lineWidth.bind(h),h.linkProgram.bind(h),Ee=h.pixelStorei.bind(h),h.shaderSource.bind(h),De=h.texImage2D.bind(h),Ae=h.texParameteri.bind(h),Ce=h.uniform1i.bind(h),Ie=h.uniformMatrix4fv.bind(h),Pe=h.useProgram.bind(h),L=h.vertexAttribPointer.bind(h),je=h.viewport.bind(h),R=h.uniform2f.bind(h),F=new function(e){var r,a,i=this,o=0,s=0,c=0;e.onmousedown=function(){switch(o){case 0:o=1;break;case 1:case 3:break;case 2:i.poke=!1,o=0}},e.onmouseup=e.onmouseout=wt.onblur=function(){switch(o){case 0:break;case 1:i.poke=!0,o=2;break;case 2:case 3:i.drag=i.poke=!1,o=0}},e.onmousemove=function(e){switch(r=s,a=c,s=e.clientX,c=e.clientY,o){case 0:break;case 1:var t=r-s,n=a-c;3<Math.sqrt(t*t+n*n)&&(i.dragDirection.x=t,i.dragDirection.y=n,i.drag=!0,o=3);break;case 2:i.poke=!1,o=0;break;case 3:t=r-s,n=a-c,i.dragDirection.x=t,i.dragDirection.y=n}},i.update=function(){switch(o){case 0:case 1:case 3:break;case 2:i.poke=!1,o=0}},i.drag=!1,i.poke=!1,i.dragDirection={x:0,y:0}}(K),a=K.width/K.height,Ue=(Ge=a*=t=.1*Math.tan(75*Math.PI/360))-(a=-a),Xe=(_e=t)-(t=-t),e=void 0,(e=g())[0]=.2/Ue,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=.2/Xe,e[6]=0,e[7]=0,e[8]=(Ge+a)/Ue,e[9]=(_e+t)/Xe,e[10]=-1000.1/999.9,e[11]=-1,e[12]=0,e[13]=0,e[14]=-200/999.9,e[15]=0,Se=e,O=D(),q=D(),Ve=D([0,1,0]),z=w(),B=15,K.onmousewheel=function(e){0<(e=e.wheelDelta)&&(B-=.5),e<0&&(B+=.5),B=Math.min(20,Math.max(10,B)),$()},H=g(),Te=D(),Fe=Re=Le=Ne=null,Ge=D([1,0,0]),a=D([0,1,0]),Ue=D([0,0,1]),D([0,0,0]),D([1,0,0]),D([0,1,0]),D([0,0,1]),D([0,0,-1]),D([0,-1,0]),D([-1,0,0]),G=[],_=D(),_e=D([-1,0,0]),t=D([0,-1,0]),Xe=D([0,0,-1]),ze=[Ge,_e,a,t,Ue,Xe],Be=D(),He=D(),Oe=function(e){E(e,Be),s(Be);for(var t=99999,n=-1,r=0;6!==r;r++){a=Be,o=ze[r],(i=He)&&a!==i?(i[0]=a[0]-o[0],i[1]=a[1]-o[1],i[2]=a[2]-o[2]):(a[0]-=o[0],a[1]-=o[1],a[2]-=o[2]);var a=i=void 0,i=(o=He)[0],o=(a=o[1],o[2]);(i=Math.sqrt(i*i+a*a+o*o))<t&&(t=i,n=r)}return ze[[1,0,3,2,5,4][n]]},qe=[15905,26470,43162,62220,11365,10170,61515,54975,35340,14145,8364],J.loadmanager.loadFiles({files:["cube.obj","sphere.obj","diffuse.shader","faces.gif","skybox.obj","border.shader","heart.obj"],error:function(e,t){},finished:function(e){M=e["cube.obj"],I=e["skybox.obj"],A=e["sphere.obj"],P=e["heart.obj"],de=J.shader.compileProgram(h,e["diffuse.shader"]),J.shader.compileProgram(h,e["border.shader"]),Ne=b(e["faces.gif"]),Le=b(d.canvas),(e=gt.createElement("canvas")).width=e.height=8,Re=b(k(e,2)),Fe=b(k(e,1));for(var i=new Int32Array(10),o=new Int32Array(10),s=new Int32Array(10),c=new Int32Array(10),t=0;10!==t;t++)i[t]=16*Math.random()|0,o[t]=16*Math.random()|0,s[t]=2*Math.random()|0,c[t]=6*Math.random()|0;var u=255,f=!1;at=setInterval(function(){if(!f){d.ctx.beginPath(),d.ctx.fillStyle="#000000",d.ctx.globalAlpha=.2,d.ctx.rect(0,0,64,64),d.ctx.fill(),d.ctx.globalAlpha=1;for(var e=0;10!==e;e++){var t=i[e],n=o[e],r=s[e],a=c[e],a=d.getCanvasCoordinate(a,t,n);d.ctx.beginPath(),d.ctx.fillStyle=rt,d.ctx.rect(a.x,a.y,1,1),d.ctx.fill(),r?i[e]++:o[e]++}p(d.canvas,Le),nt||(0===u&&(clearInterval(at),h.clearColor(0,0,0,0),h.clear(16384),f=!(J=0)),rt="#"+u.toString(16)+"0000",(u-=5)<0&&(u=0))}},100),re(),J.requestGameFrame(ne),ye(We),ye(2884),Me(4.5),me(0,0,0,0),je(0,0,K.width,K.height),he=pe(),j(U,he),we(U,M.rawData,Ye),le=pe(),j(U,le),we(U,A.rawData,Ye),ge=pe(),j(U,ge),we(U,I.rawData,Ye),fe=pe(),j(U,fe),we(U,P.rawData,Ye),ee(.785),te(-.785)}})):location="http://get.webgl.org"</script>