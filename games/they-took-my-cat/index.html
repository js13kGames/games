<!doctype html><html><head><title>They took my cat - js13kGames 2025</title><body id=body><script>(()=>{const t=1280,i=800;body.innerHTML='<style>\n*{padding:0;margin:0;box-sizing:border-box;}\nbody{font:20pt sans-serif;background:#123;color:#fff;}\n#r{position:relative;display:flex;align-items:center;justify-content:center;margin:auto;text-shadow:1px 1px 4px #000;max-width:1280px;max-height:100vh;aspect-ratio:1.6;}\na{color:#fff;font-size:14pt;}\n#p_c{display:none;width:100%;height:100%;}\n#p_ui{display:flex;align-items:center;justify-content:center;flex-direction:column;position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;}\n#p_h{display:flex;align-items:flex-end;position:absolute;gap:4px;top:0;left:0;width:100%;height:100%;pointer-events:none;padding:4px;}\n#p_h span{border-radius:100%}\n@keyframes f{0%{opacity:0;}10%{opacity:1;}90%{opacity:1;}100%{opacity:0;}}\n#p_ui>p{opacity:0;animation:3s linear f;}</style>\n<div id="r"><canvas id="p_c" width="1280" height="800"></canvas><div id="p_h"></div><div id="p_ui"></div><div id="p_t">THEY TOOK MY CAT<p><a href="https://github.com/megagrump/they-took-my-cat" target="_blank" rel="noopener">https://github.com/megagrump/they-took-my-cat</a><br><br></p><p id="p_l">Loading...</p></div></div>';const e=[],s=t=>p_ui.innerHTML=`<p>${t}</p>`,n=(t,i)=>{t&&(i?e.unshift(t):e.push(t)),p_h.innerHTML=`<div>${e.join("")}</div>`},r=t=>{e.splice(e.indexOf(t),1),n()},h=p_c.getContext("webgl2")||alert("No WebGL2!"),o=t=>t,a=(t,i,e)=>(1-e)*t+e*i,l=(t,i,e=a)=>{const s=t.length-1,n=Math.min(Math.max(0,s-1),i*s|0);return e(t[n],t[n+1],i*s-n)},f=t=>t[Math.random()*t.length|0],c=(t,i,e,s,n,r)=>!(e>t||s>i||n<t||r<i),u=(t,i)=>Math.abs(t-i),d=["===============================================","=                       ||d                   =","=                       ||                    =","=    G   G   G   G      ||   G   G   G   G    =","========================||=====================","=                       ||c                   =","=                       ||                    =","=    G   G   G   G      ||   G   G   G   G    =","===============================================","=         ||b           =                     =","=         ||            =                     =","=   G  G  ||    G    G  = G    G    G   T     =","==========||===================================","=         ||a           =         a||         =","=         ||            =          ||         =","=   G  G  ||    G    G  = R    R   || G T     =","==========||=======================||==========","=         ||9           ||        9||         =","=         ||            ||         ||         =","=   G  G  ||    R    R  ||     R   ||         =","========================||=========||==========","=         ||8           ||        8||         =","=         ||            ||         ||         =","=   G  G  ||    R    R  ||     R   || R T     =","==========||===================================","=         ||7            =                    =","=         ||             =                    =","=   G  G  ||    R    R   =  G    R      T     =","==========||===================================","=         ||6                    6||          =","=         ||                      ||          =","=     R   ||    R    R    R    R  ||          =","==================================||===========","=                      =         5||          =","=                      =          ||          =","=         G    G   B   =   B   G  ||  G       =","==================================||===========","=                                4||          =","=                                 ||          =","=    N  S  N    N     B    N   N  || N  N     =","===============================================","=           =        3||3                     =","=           =         ||                      =","=       N N =  B      ||   B    B    B  T     =","======================||=======================","=                    2||2                     =","=                     ||                      =","=     S N  R    R     ||   B    B    B   B    =","======================||=======================","=                    1||1                     =","=                     ||                      =","=       B   B   B     ||    N   N    N  T     =","===============================================","=                  =                          =","=                  =                          =","=  N  S  N   N   N =  XP v v v v        T     =","==============================================="],x=d[0].length,p=d.length,y=[0,0,0,0,0],m=[0,0,0,0,0],v=["owDown","S","owUp","W","owLeft","A","owRight","D","ce","X"],g=t=>i=>{const e=v.indexOf(i.code.substr(3))>>>1;e<=4&&(y[e]=t,i.preventDefault())};document.onkeydown=g(1),document.onkeyup=g(0);const w=(t,i,e,s,n="",r="")=>`<rect x="${t}" y="${i}" width="${e}" height="${s}" fill="${n}" ${r} />`,b=(t,i,e,s,n,r,h="",o="")=>`<rect x="${t}" y="${i}" width="${e}" height="${s}" fill="${h}" ${o} rx="${n}" ry="${r}" />`,M=(t,i,e,s,n,r=1,h="square")=>`<line x1="${t}" y1="${i}" x2="${e}" y2="${s}" stroke="${n}" stroke-width="${r}" stroke-linecap="${h}" />`,$=(t,i,e,s,n,r="")=>`<text x="${i}" y="${e}" class="${s}" fill="${n}" ${r}>${t}</text>`,A=(t,i,e,s,n="")=>`<ellipse cx="${t}" cy="${i}" rx="${e}" ry="${s}" fill="${n}" />`,G=(t,i,e="",s="")=>`<g id="_${t}" fill="${e}" ${s}>${i}</g>`,k=(t,i=1)=>`<filter id="n">\n<feTurbulence type="fractalNoise" baseFrequency="${t}" numOctaves="2" stitchTiles="stitch" result="n"/>\n<feColorMatrix type="matrix" values="${i} 0 0 0 0 ${i} 0 0 0 0 ${i} 0 0 0 0 0 0 0 0 1" in="n"/>\n<feComposite operator="in" in2="SourceGraphic" result="m"/>\n<feBlend in="SourceGraphic" in2="m" mode="multiply"/>\n</filter>`,T=(t,i,e=90)=>`<linearGradient id="g" gradientTransform="rotate(${e})">\n<stop stop-color="${t}" offset="0%" />\n<stop stop-color="${i}" offset="100%" />\n</linearGradient>`,P=[1,.5,.4].reduce((t,i,e)=>t+`<filter id="d${e}">\n<feColorMatrix in="SourceAlpha" result="blur" type="matrix" values="-1 0 0 0 ${i} 0 -1 0 0 ${i} 0 0 -1 0 ${i} 0 0 0 1 0" />\n<feGaussianBlur in="blur" result="blur" stdDeviation="15" />\n<feComposite operator="atop" in="blur" in2="SourceAlpha" />\n</filter>`,""),S=(t,i,e)=>`<svg width="${t}" height="${i}" xmlns="http://www.w3.org/2000/svg">\n<style>\n.s {font:bold 40vh serif;text-anchor:middle;dominant-baseline:middle;line-height:1;text-shadow: 0px 0px 1px #888; }\n.e {font:bold 60vh serif;text-anchor:middle;dominant-baseline:middle;line-height:1;text-shadow: 0px 0px 3px #000; }\n</style>\n${e}\n</svg>`,N=async(t,i=o,e=1)=>{const s=await(t=>new Promise(i=>{const e=new Image;e.onload=()=>i(e),e.src=`data:image/svg+xml;utf8,${encodeURIComponent(t)}`}))(t),n=new OffscreenCanvas(s.width,s.height).getContext("2d"),r=Math.round(s.width*e),h=Math.round(s.height*e);return n.drawImage(s,0,0,s.width,s.height,0,0,r,h),i(n.getImageData(0,0,r,h))},D=(t,i,e,s,n)=>{const r=(new DOMParser).parseFromString(t,"image/svg+xml");return new Array(e).fill(0).map((t,h)=>{const o=h/e;for(const t in i){const e=r.getElementById("_"+t),s=[],n=i[t],h=(o+n[3])%1;if(n[2]){const t=l(n[2][0],h,n[1]),i=l(n[2][1],h,n[1]);s.push(`translate(${t} ${i})`)}if(n[0]){const[t,i]=n[4],e=l(n[0],h,n[1]);s.push(`rotate(${e} ${t} ${i})`)}e.setAttribute("transform",s.join(" "))}return N((new XMLSerializer).serializeToString(r),s,n)})},L=(t,i,e)=>{const s=new Uint8ClampedArray(t.data.length),n=new Uint32Array(t.data.buffer),r=t.width,h=t.height;i/=255;let o=0;for(let t=0;t<r*h;t+=r){const a=Math.max(t-r,0),l=Math.min(t+r,r*h-r);for(let h=0;h<r;++h){const f=Math.max(h-1,0),c=Math.min(h+1,r-1),u=255&n[h+a],d=255&n[h+l],x=255&n[f+t],p=255&n[f+a],y=255&n[f+l],m=255&n[c+t],v=255&n[c+a],g=255&n[c+l],w=i*(y-g+2*(x-m)+p-v),b=i*(v-g+2*(u-d)+p-y),M=Math.sqrt(w*w+b*b+1);s[o++]=127+w/M*128,s[o++]=127+b/M*128,s[o++]=e,s[o++]=255}}return new ImageData(s,r,h)},_=new Array(111).fill(0).fill(1344,64).map((t,i)=>String.fromCodePoint(128e3+t+i)),E=34962;class O{constructor(t,i,e,s){const n=i*e+s.byteLength;this.h=s.byteLength/t[0][1],this.u=0,this.p=s.length,this.v=e>>2,this.m=new Float32Array(n>>2),this.m.set(s),this.$=1,this.M=h.createVertexArray(),h.bindVertexArray(this.M),this._=h.createBuffer(),h.bindBuffer(E,this._),t.forEach((t,i)=>{h.enableVertexAttribArray(i),h.vertexAttribPointer(i,t[0],5126,0,t[1],t[2]),h.vertexAttribDivisor(i,t[3]??0)}),h.bufferData(E,n,35048),h.bufferSubData(E,0,this.m,0),h.bindVertexArray(null)}draw(){h.bindVertexArray(this.M),this.$&&(h.bindBuffer(E,this._),h.bufferSubData(E,0,this.m,0),this.$=0),h.drawArraysInstanced(6,0,this.h,this.u)}A(t){return this.k(this.u++,t)}k(t,i){return this.m.set(i,this.p+t*this.v),this.$=1,t}}const B=[[2,16,0],[2,16,8],[4,0,64,1]],C=new Float32Array(4);class R extends O{constructor(t,i,e=1){super(B,e,16,new Float32Array([0,0,0,0,0,i,0,1,t,i,1,1,t,0,1,0])),1==e&&this.add(0,0,0,0)}add(...t){C.set(t),this.A(C)}set(t,...i){C.set(i),this.k(t,C)}}const F=[[2,8,0],[4,48,240,1],[4,48,256,1],[4,48,272,1]],I=new Float32Array(12),z=[[1,1,1,1],[1,1,1,4],[1.5,1.5,4,1]],Y=(t,i,e,s,n,r,h,o,a,l,f,c,u=20,d=1)=>{let x="",p="";for(let i=l/2;i<64+o+l;i+=o+l)x+=b(i,l/2,o,a,s,n,t),p+=b(i,l/2,o,a,s,n,e);x=G("c",x),p=G("h",p);let y=.5-f;for(let t=a+l+.5;t<64;t+=a+l)x+=`<use href="#_c" x="${y}" y="${t}" />`,p+=`<use href="#_h" x="${y}" y="${t}" />`,y=-(y+f)%o;return[S(64,64,w(0,0,64,64,i)+x+c[0]),S(64,64,k(r,h)+w(0,0,64,64,"#fff",'filter="url(#n)"')+p+c[1]),d,u]},U=t=>[S(64,64,w(8,8,48,48,"#888")+w(12,12,40,40,"#0008")+$(t,32,34,"s","#fff")),S(64,64,w(0,0,64,64,"#444")+w(12,12,40,40,"#0002")+$(t,32,34,"s","#fff1")),2,3],q=["#fff","#4af","#ff4","#8f4","#888","#f4f","#f44"],V=["#c96","#888","#8ac"],X=async()=>{const t=[Y("#fff","#fff","#fffc",0,0,.5,.13,64,64,0,0,["",""],30,1),Y("#d86","#ccc","#aaab",2,4,.5,.2,30,13,3,16,["",""],60,1),[S(66,66,M(0,0,66,66,"#89b",64)),S(66,66,w(0,0,66,66,"#444")+M(0,0,64,64,"#fff",60)+M(0,-32,96,64,"#7772",2)),1,10],[S(66,66,M(-64,0,64,128,"#89b",64)),S(66,66,w(0,0,66,66,"#444")+M(-64,0,64,128,"#fff",60)+M(0,32,64,96,"#7772",2)),1,10],[S(66,66,M(-2,-66,132,66,"#89b",64)),S(66,66,w(0,0,66,66,"#444")+M(0,-64,128,64,"#fff",60)),1,10],Y("#bbb","#fff","#0008",5,3,.17,.04,47,13,1,16,[w(0,0,6,64,"#89b")+w(58,0,6,64,"#89b"),w(0,0,6,64,"#000")+w(1,0,4,64,"#fff")+w(58,0,6,64,"#000")+w(59,0,4,64,"#fff")],60)];for(let i=0;i<14;++i)t.push(U(i));_.forEach(i=>t.push((t=>{const i=f(V);return[S(64,64,T(f(q),f(q))+w(0,0,64,64,"#444")+w(1,1,62,62,i)+M(0,0,64,64,"#000")+M(64,0,0,64,"#000")+w(6,6,52,52,"url(#g)")+$(t,32,34,"e","#fff")),S(64,64,w(0,0,64,64,"#111")+w(2,2,60,60,"#444")+w(6,6,52,52,"#111")+$(t,32,34,"e")+w(8,8,48,48,"#111d")),.5,3]})(i)));const i=(t,i,e)=>s=>(s=t?L(s,i,e):s).width>64?(t=>{const i=new Uint32Array(4096),e=new Uint32Array(t.data.buffer);for(let s=1;s<=64;++s){const n=s*t.width+1;i.set(e.subarray(n,n+64),64*(s-1))}return new ImageData(new Uint8ClampedArray(i.buffer),64,64)})(s):s,e=await Promise.all(t.map(t=>Promise.all([N(t[0],i()),N(t[1],i(1,t[2],t[3]))])));return[e.map(t=>t[0]),e.map(t=>t[1])]},j=[[0,0,0],[2,1,2],[2,2,0],[2,3,0],[2,4,0],[2,2,1],[2,3,1],[2,4,1],[1,5,0]];for(let t=0;t<14;++t)j.push([1,t+6,0,[20,256,.3,.7,.2,1]]);for(let t=0;t<_.length;++t)j.push([1,t+6+14,1&t]);const H=`#version 300 es\nprecision mediump float;precision mediump sampler2D;precision mediump sampler2DArray;const vec2 res=vec2(${1/t},0.00125);`,J=`${H}\nout vec4 col;\nin vec2 uv;\nuniform sampler2D tex0;`,W=[`${H}\nlayout(location=0) in vec2 vp;\nlayout(location=1) in vec2 tc;\nout vec2 uv;\nvoid main(){\n uv=tc;\n gl_Position=vec4((vp*res)*2.-1.,0.,1.);\n}`,`${H}\nlayout(location=0) in vec2 vp;\nlayout(location=1) in vec2 tc;\nlayout(location=2) in vec4 pos;\nout vec3 uv;\nuniform vec3 xy;\nflat out vec2 flip;\nvoid main(){\n uv=vec3(tc,pos.z);\n flip=vec2(pos.w*-2.+1.,pos.w);\n uv.x=uv.x*flip.x+flip.y;\n vec2 p=((vp+pos.xy-xy.xy)*res)*2.-1.;\n gl_Position=vec4(p,0.,1.);\n}`,`${H}\nlayout(location=0) out vec4 col;\nlayout(location=1) out vec4 norm;\nin vec3 uv;\nflat in vec2 flip;\nuniform sampler2DArray tex0,tex1;\nuniform float alpha;\nvoid main(){\n col=texture(tex0,uv);\n col.w*=alpha;\n col.xyz*=col.w;\n norm=vec4(texture(tex1,uv).xyz,col.w);\n norm.x=norm.x*flip.x+flip.y;\n norm.xyz*=col.w;\n}`,`${J}\nvoid main(){\n col=texture(tex0,uv).aaaa;\n}`,`${J}\nuniform sampler2D tex1,tex2;\nvoid main(){\n vec4 t=texture(tex0,uv);\n col=vec4(mix(texture(tex1,uv).xyz*(1.-texture(tex2,uv).x),t.xyz,t.w),1.);\n}`,`${J}\nuniform vec3 dir;\nvoid main(){\n col=dir.z*(texture(tex0,uv)+texture(tex0,uv-dir.xy*1.)+texture(tex0,uv-dir.xy*2.)+texture(tex0,uv-dir.xy*3.)+texture(tex0,uv-dir.xy*4.)+texture(tex0,uv+dir.xy*1.)+texture(tex0,uv+dir.xy*2.)+texture(tex0,uv+dir.xy*3.)+texture(tex0,uv+dir.xy*4.));\n}`,`${J}\nvoid main(){\n col=vec4(vec3(.07,.08,.09)*texture(tex0,uv).xyz,1.);\n}`,`${H}\nlayout(location=0) in vec2 vp;\nlayout(location=1) in vec4 lp;\nlayout(location=2) in vec4 col;\nlayout(location=3) in vec4 dir;\nflat out vec4 p;\nflat out vec3 c;\nflat out vec4 d;\nout vec2 uv;\nuniform vec3 xy;\nvoid main(){\n vec2 lxy=vec2(vp.x/dir[int(max(.0,sign(-vp.x)))],vp.y/dir[int(max(.0,sign(-vp.y)))+2]);\n p=vec4(lp.xy-xy.xy,lp.zw);\n c=col.xyz*col.w;\n d=dir;\n uv=(lxy*p.w+p.xy)*res;\n gl_Position=vec4(uv*2.-1.,0.,1.);\n}`,`${J}\nuniform sampler2D tex1;\nflat in vec4 p;\nflat in vec3 c;\nflat in vec4 d;\nvec3 light(vec3 t,vec3 norm,float s){\n vec3 ld=vec3(p.xy-gl_FragCoord.xy,p.z);\n ld.x*=d[int(max(.0,sign(ld.x)))];\n ld.y*=d[int(max(.0,sign(ld.y)))+2];\n float dn=max(dot(norm,normalize(ld)),0.);\n float a=max(0.,1.-(length(ld)/p.w));\n return t*(c*dn*a)+(c*pow(dn,.5+s)*a);\n}\nvoid main(){\n vec4 t=texture(tex0,uv),n=texture(tex1,uv);\n vec3 norm=normalize(vec3(n.xy*2.-1.,1.));\n col=vec4(light(t.xyz*t.w,norm,n.z*128.),1.);\n}`,`${J}\nvoid main(){\n col=texture(tex0,vec2(uv.x,1.-uv.y));\n}`],K=3042,Z=3553,Q=35632,tt=35633,it=35866,et=36009;h.disable(2929),h.enable(K);const st=t=>{const i=t.map((t,i)=>36064+i),e=h.createFramebuffer();return[t,()=>{h.bindFramebuffer(et,e);for(let i=0;i<t.length;++i)h.framebufferTexture2D(et,36064+i,Z,t[i],0);h.drawBuffers(i)}]},nt=t=>{const i=h.createTexture();return h.bindTexture(t,i),h.texParameteri(t,10241,9729),i},rt=(t,i,e=32856)=>{const s=nt(Z);return h.texStorage2D(Z,1,e,t,i),s},ht=(t,i=32856)=>{const e=nt(it);return h.texStorage3D(it,1,i,t[0].width,t[0].height,t.length),t.forEach((t,i)=>h.texSubImage3D(it,0,0,0,i,t.width,t.height,1,6408,5121,t.data)),e},ot=(t,i)=>{const e=(t=i?t:[t]).reduce((t,i)=>(t.push(...i[0]),t),[]),s=t.reduce((t,i)=>(t.push(...i[1]),t),[]);return[e[0].width,e[0].height,t.map(t=>t[0].length),[ht(e),ht(s)],new R(e[0].width,e[0].height)]},at=(t,i,e)=>{const s=h.createProgram();return[[tt,t],[Q,i]].forEach(t=>{const i=h.createShader(t[0]);h.shaderSource(i,t[1]),h.compileShader(i),h.attachShader(s,i)}),h.linkProgram(s),h.useProgram(s),[()=>h.useProgram(s),...e.map((t,i)=>("x"==t[2]&&h.uniform1i(h.getUniformLocation(s,t),i),h.getUniformLocation(s,t)))]},lt=st([rt(t,i),rt(t,i)]),ft=st([rt(t,i),lt[0][1]]),ct=st([ft[0][0]]),ut=st([rt(640,400,33321)]),dt=st([rt(640,400,33321)]),xt=st([rt(t,i)]),pt=st([rt(t,i)]),yt=at(W[0],W[3],["tex0"]),mt=at(W[0],W[5],["tex0","dir"]),vt=at(W[0],W[4],["tex0","tex1","tex2"]),gt=at(W[0],W[6],["tex0"]),wt=at(W[0],W[9],["tex0"]),bt=at(W[1],W[2],["tex0","tex1","alpha","xy"]),Mt=at(W[7],W[8],["tex0","tex1","xy"]),$t=new R(64,64,x*p),At=new R(64,64,x*p),Gt=new R(64,64,x*p),kt=new R(t,i),Tt=new class extends O{constructor(t=256){const i=[0,0];for(let t=0;t<29;++t){const e=t/28*Math.PI*2;i.push(Math.sin(e)),i.push(Math.cos(e))}super(F,t,48,new Float32Array(i))}add(t,...i){return I.set(i),I.set(z[t],8),this.A(I)}},Pt=[],St=(t,i=0,e=3553)=>{h.activeTexture(33984+i),h.bindTexture(e,t)},Nt=1/30;class Dt{constructor(t,i,e,s=0,n=0){this.buf=t,this.x=i,this.y=e,this.z=s,this.T=n,this.px=.5*t[0]|0,this.py=.5*t[1]|0,this.flip=0,this.alpha=1,this.setAnim(0),this.S=0}get l(){return this.x-this.px|0}get t(){return this.y-this.py|0}get r(){return this.l+this.buf[0]}get b(){return this.t+this.buf[1]}get f(){return this.P+this.C}tick(){}move(t,i,e){this.x+=t*this.T*e,this.y+=i*this.T*e}setAnim(t){if(t!=this.D){this.D=t,this.P=t==Ut?Math.random()*this.buf[2][t]|0:0,this.C=0;for(let i=0;i<t;++i)this.C+=this.buf[2][i]}}F(t,i,e){this.S+=t,this.S<Nt||(this.S-=Nt,this.P=i?Math.min(this.P+1,this.buf[2][this.D]-1):e?--this.P>=0?this.P:this.buf[2][this.D]-1:++this.P%this.buf[2][this.D])}}const Lt=[[[[[0,100,128,0,2,201,128,0,0,0,0,148,29,0,0,0,3,255,4,1,2,2,188,255,255,63,4,84,6],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,1,1],[[[104,,,,,,,,,,,,,,,,104],[]],[[109,,,,,,,,,,,,,,,,109],[]]]],[[2,96,128,0,2,83,128,10,0,25,124,97,123,0,0,0,0,105,2,1,2,32,31,0,11,168,2,120,6],[,,,,,,,,,,,,,,,,,,,,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,,,,,,,,,1,2,3,4,1,2,3,4],[[[128,,,,,,,,,,,,,,,,128,,,,,,,,,,,,,,,,131,,,,,,,,,,,,,,,,133,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,143,,,,,,,,,,,,,,,,142],[]],[[128,,,,,,,,,,,,,,,,128,,,,,,,,,,,,,,,,131,,,,,,,,,,,,,,,,133,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,138],[]],[[128,,,,,,,,,,,,,,,,124,,,,,,,,,,,,,,,,133,,,,,,,,,,,,,,,,128,,,,,,,,,,,,,,,,136,,,,,,,,,,,,,,,,133,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,136],[]],[[123,,,,,,,,,,,,123,,,,,,,,,,,,,,,,,,,,128,,,,,,,,,,,,128,,,,,,,,,,,,,,,,,,,,132,,,,,,,,,,,,132,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,135],[]]]],[[3,128,128,0,3,201,128,2,0,0,0,6,49,0,0,0,0,139,4,1,3,20,184,119,244,147,6,84,6],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,1,1],[[[104,,,,,,104,,,,,,,,105,,104,,,,,,104,,,,,,,,107],[]],[[109,,,,,,109,,,,,,,,112,,109,,,,,,109,,,,,,,,107],[]]]],[[0,195,124,85,0,188,136,0,183,5,0,0,111,99,0,0,0,0,0,0,2,19,176,15,105,0,0,0,0],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,,,1,1,1,1,1,1,1,,1,1,1,1,1,1,1,1],[[[132,,,,,,132,,,,,,,,132,,132,,,,,,132,,,,,,,,132],[]]]],[[2,131,130,123,2,131,132,0,103,120,0,0,100,92,0,0,3,0,0,0,3,22,178,19,228,0,0,0,0],[,,,,,,,,1,1,1,1,1,1,1,1,,,,,,,,,,,,,1,1,1,1,1,1,1,,1,1,1,1,1,1,1,1],[[[,,,,130,,,,,,,,130,,,,,,,,130,,,,,,,,130,,,130],[]]]],[[3,228,128,123,3,0,128,0,0,159,0,6,20,0,0,0,0,195,6,0,1,188,144,8,32,147,13,60,2],[,,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[[[125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125,,125],[]]]],[[3,228,128,123,3,0,128,0,0,159,0,0,37,0,0,0,0,195,6,0,1,219,197,8,53,0,0,0,0],[,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[[[,,137,,,,137,,,,137,,,,137,,,,137,,,,137,,,,137,,,,137,137],[]]]],[[0,0,128,127,2,0,128,0,128,127,0,16,190,123,0,0,2,0,0,0,1,126,39,0,55,0,0,88,4],[,,,,,,,,1,,,,1,,,,1,,,,,,,,,,,,1,,,,1,,,,1],[[[137],[]]]],[[2,128,128,0,3,127,128,4,0,0,3,0,71,121,0,0,0,0,0,0,1,77,0,133,44,255,6,155,8],[,,,,,,,,,,,,,,,,,,,,,,,,1,2,3,4,1,2,3,4,1,2,3,4,,,,,,,,,1,2,3,4,1,2,3,4],[[[155,,155,,157,,150,,152,,152,,,,,,,,,,152,,152,,154,,150,,150,,152],[]],[[154,,154,,150,,155,,152,,152,,,,,,,,,,145,,145,,147,,145,,152,,152],[]],[[155,,155,,147,,154,,152,,152,,,,,,,,,,150,,152,,155,,154,,152,,150],[]],[[152,,152,,150,,145,,150,,152],[]]]]],5513,32,55,9],[[[[2,255,144,128,2,255,116,45,255,104,0,6,85,52,0,0,0,0,0,0,2,26,0,0,63,0,0,0,0],[1],[[[161],[]]]]],6615,4,0,1],[[[[1,180,122,130,2,138,128,129,123,0,7,56,48,255,196,4,1,139,7,0,1,168,164,0,19,125,3,0,1],[1],[[[183,,,,132,180,,,,135,175],[]]]]],6615,4,0,1],[[[[1,100,138,61,1,201,141,20,93,200,23,0,83,25,198,6,0,0,0,0,2,6,193,20,108,0,0,0,0],[1],[[[130],[]]]]],66150,1,0,1],[[[[3,100,116,0,3,131,128,14,0,0,11,48,28,0,192,2,0,0,0,0,2,46,101,0,32,0,0,59,6],[1],[[[137,140,144,140,144,149,144,149,152,149,152,156,152,156,161],[]]]]],5513,32,0,1],[[[[2,150,164,250,2,135,164,0,255,255,1,0,43,135,0,0,0,0,0,0,2,19,130,135,130,0,0,0,0],[1],[[[137],[]]]]],16538,1,0,1],[[[[2,100,127,0,2,201,136,58,0,123,0,125,0,0,108,5,0,0,0,0,2,9,166,8,32,127,0,0,0],[1],[[[108],[]]]]],13230,8,0,1],[[[[3,255,128,0,3,154,128,9,0,0,7,5,52,0,0,0,0,0,0,0,2,66,0,0,32,47,3,44,3],[1],[[[154,159],[]]]]],5513,6,0,1],[[[[3,199,128,191,3,199,130,0,29,0,29,23,60,0,128,7,0,0,0,0,3,53,249,137,255,147,0,21,2],[1],[[[156],[]]]]],5513,4,0,1],[[[[1,255,92,101,2,255,96,54,59,0,0,59,58,0,32,2,1,131,6,1,3,8,178,32,202,0,0,0,0],[1],[[[123],[]]]]],6615,4,0,1]].map(t=>(t=>{const i=t=>Math.sin(6.283184*t),e=t=>.003959503758*2**((t-128)/12),s=(t,i,s)=>{let r=n[t[0][0]],h=t[0][1],o=t[0][3]/32,a=n[t[0][4]],l=t[0][5],f=t[0][8]/32,c=t[0][9],u=t[0][10]*t[0][10]*4,d=t[0][11]*t[0][11]*4,x=t[0][12]*t[0][12]*4,p=1/x,y=-t[0][13]/16,m=t[0][14],v=s*2**(2-t[0][15]);const g=new Int32Array(u+d+x);let w,b,M,$,A,G,k=0,T=0;for(w=0,b=0;w<u+d+x;w++,b++)b>=0&&(m=m>>8|(255&m)<<4,b-=v,A=e(i+(15&m)+t[0][2]-128),G=e(i+(15&m)+t[0][6]-128)*(1+8e-4*t[0][7])),M=1,w<u?M=w/u:w>=u+d&&(M=(w-u-d)*p,M=(1-M)*3**(y*M)),k+=A*M**o,$=r(k)*h,T+=G*M**f,$+=a(T)*l,c&&($+=(2*Math.random()-1)*c),g[w]=80*$*M|0;return g},n=[i,t=>t%1<.5?1:-1,t=>t%1*2-1,t=>{let i=t%1*4;return i<2?i-1:3-i}],r=t[3];let h=0;const o=t[1]*t[2]*(r+1)*2,a=new Int32Array(o);return e=>{let l,f,c,u,d,x,p,y,m,v,g,w;const b=new Int32Array(o),M=t[0][h],$=t[1],A=t[2];let G,k,T=0,P=0,S=0,N=[];for(c=0;c<=r;++c)for(p=M[1][c],u=0;u<A;++u){const t=p?M[2][p-1][1][u]:0;t&&(M[0][t-1]=M[2][p-1][1][u+A]||0,t<17&&(N=[]));let e=n[M[0][16]],r=M[0][17]/512,h=2**(M[0][18]-9)/$,o=M[0][19],D=M[0][20],L=43.23529*M[0][21]*3.141592/44100,_=1-M[0][22]/255,E=1e-5*M[0][23],O=M[0][24]/32,B=M[0][25]/512,C=6.283184*2**(M[0][26]-9)/$,R=M[0][27]/255,F=M[0][28]*$&-2;for(g=(c*A+u)*$,d=0;d<4;++d)if(x=p?M[2][p-1][0][u+d*A]:0,x){N[x]||(N[x]=s(M,x,$));const t=N[x];for(f=0,l=2*g;f<t.length;f++,l+=2)b[l]+=t[f]}for(f=0;f<$;f++)y=2*(g+f),v=b[y],v||S?(w=L,o&&(w*=e(h*y)*r+.5),w=1.5*Math.sin(w),T+=w*P,G=_*(v-P)-T,P+=w*G,v=3==D?P:1==D?G:T,E&&(v*=E,v=v<1?v>-1?i(.25*v):-1:1,v/=E),v*=O,S=v*v>1e-5,m=Math.sin(C*y)*B+.5,k=v*(1-m),v*=m):k=0,y>=F&&(k+=b[y-F+1]*R,v+=b[y-F]*R),b[y]=0|k,b[y+1]=0|v,a[y]+=0|k,a[y+1]+=0|v}if(++h==t[4]){const t=e.createBuffer(2,o/2,44100);for(let i=0;i<2;i++){const e=t.getChannelData(i);for(let t=i;t<o;t+=2)e[t>>1]=a[t]/65536}return t}}})(t)),_t=(t,i,e=t.y,s=1)=>{let n,r;return h=>(n||(n=i<t.x?Math.max:Math.min,r=e<t.y?Math.max:Math.min,u(t.x,i)>16&&t.I(Math.sign(i-t.x),h)),t.move(Math.sign(i-n(t.x,i)),Math.sign(e-r(t.y,e)),h*s),t.x=n(t.x,i),t.y=r(t.y,e),t.x==i&&t.y==e)},Et=(t,i)=>{let e=0;return s=>(e=Math.min(1,e+2*s),t.alpha=i?1-e:e,1==e)},Ot=(t,i)=>()=>(t.setAnim(i),1),Bt=t=>{let i=0;return e=>(0==i&&ye(t)&&Lt[3](),i+=e,t.setAnim(Yt),t.dead=1,t.alpha=Math.max(0,1-i),t!=bi&&i>=1?(Wi(t),1):i>=2&&Te(-1)?(Wi(t),Ge(),1):void 0)},Ct=[["#fcc","#444","#fcc","#55f","#fff","#0000"],["#fcc","#444","#444","#444","#444","#444"]],Rt=[[125,480],[125,100],[85,260],[125,125],[125,195],[125,125],[125,195],[125,260],[125,370],[118,465],[125,260],[125,370],[118,465]],Ft=(t,i,e,s="")=>G(t,G(++t,A(125,195,13,20)+A(125,230,15,50)+(e?w(132,270,25,80,"#444"):"")+b(110,260,28,44,15,10,i[0]))+b(105,120,40,70,10,30)+A(125,135,24,30),i[2],`filter="${s}"`),It=(t,i,e)=>G(t,G(++t,b(100,365,40,90,10,40)+G(++t,b(110,460,60,20,30,25)+b(105,450,30,30,5,5),i[4]))+A(125,280,30,40)+A(120,360,20,30)+b(95,260,50,120,20,50),i[3],`filter="${e}"`),zt=[a,(t,i,e)=>a(t,i,.5*(1-Math.cos(e*Math.PI)))],Yt=2,Ut=4,qt=[[[[,1,[[0,0],[15,0,15,0,15]]],[[5,0,5,0,5],1],,[[25,-20,25],1],[[-10,-50,-10],1],,,[[18,-30,18],1],[[10,60,30,5,20,0,10]],[[-10,0,15,-5,-5,-10]]],30],[[[,1,[[0,0],[15,0,15,0,15]]],[[5,0,5,0,5],1],,[[25,-20,25],1],[[-10,-50,-10],1],[[-65,-55,-65],1],[[-40,-35,-40]],[[18,-30,18],1],[[10,60,30,5,20,0,10]],[[-10,0,15,-5,-5,-10]]],30],[[[[0,-90],,[[0,400],[0,60,0]]],[[0,60,0]],,,,[[0,-40,0]],[[0,-40,0]],[[0,-90]],[[0,180]],,[[0,-90]],[[0,180]]],15],[[[,,[[0,0],[120,120]]],,,,,[[-65,-62,-65],1],[[-40,-38,-40]],[[-90,-90]],[[110,110]],[[-30,-30]],[[10,10]],[[95,95]],[[55,55]]],30],[[,[,1,[[0,0],[0,-5,0]]],[,1,[[0,0],[0,-5,0]]],,,[[-65,-62,-65],1],[[-40,-38,-40]]],30]];qt.forEach(([t],i)=>{t.forEach((t,e)=>{t[3]=i==Yt?0:.25,t[1]=zt[t[1]??0],t[4]=Rt[e]}),i<=1&&[,,,,,3,4,,,,7,8,9].forEach((i,e)=>{const s=t[e]??{...t[i]};s[3]+=.5,t[e]=s})});const Vt=(t,i)=>{const e=Ct[t],s=i?P+w(0,0,340,480,"#444"):"",n=t=>i?`url(#d${t})`:"";return S(340,480,s+G(0,Ft(3,e,0,n(2))+((t,i="")=>G(1,w(110,80,35,30)+A(135,32,25,20)+b(100,20,70,70,20,40)+A(125,47,10,14,"#0003")+A(130,51,10,10)+A(123,53,5,5,"#0003")+A(167,62,12,10)+A(148,85,15,12)+A(155,45,14,10,"#0004")+M(153,33,165,36,"#000c",3,"round")+A(158,45,8,6,"#fff")+A(163,45,3,3,"#000")+b(147,72,20,10,5,5,"#f88")+b(95,8,40,30,10,20,t[5])+b(130,6,45,30,15,20,t[5])+b(80,31,110,10,10,10,t[5]),t[0],`filter="${i}"`))(e,n(1))+It(7,e,n(2))+It(10,e,n(1))+((t,i="")=>G(2,b(88,105,80,165,20,100,t[1]),"",`filter="${i}"`))(e,n(1))+Ft(5,e,1,n(0))))},Xt=t=>Promise.all(qt.map(([i,e])=>Promise.all([Promise.all(D(Vt(t,0),i,e,o,.3)),Promise.all(D(Vt(t,1),i,e,t=>L(t,2,20),.3))])));class jt extends Dt{constructor(t,i,e,s,n){super(t,i,e,s,n),this.py=t[1]-1,this.px=Math.round(.4*t[0]),this.setAnim(Ut),this.U=1,this.Y=[],this.dir=1}tick(t,i){if(this.Y[0]&&this.Y[0](t)&&this.Y.shift(),!this.dead&&this.L&&this.setAnim(3),!this.dead&&!this.Y[0]){const[i,e]=Xi(this.x,this.t,0,-1,Ai);if(e<96-32*(this.L??0)){const[t,i]=Xi(this.x,this.y-32,0,1,Gi);i<64&&(Lt[9](),this.die())}if(!this.dead){const[t,i]=Xi(this.x,this.t,0,-1,ki);i<96-32*(this.L??0)&&(Lt[9](),this.die())}if(!this.dead){let[i,e]=Xi(this.x,this.y-32,0,1,Ai|Gi|ki);e-=i==Ai?64:32,e<ge?this.y=Math.min(this.y+e,this.y+t*ve):this.q(Ot(this,Ut),((t,i,e)=>{let s=0;return n=>{if(0==s&&Lt[8](),s+=n,t.y=Math.min(i,t.y+n*e),t.y>=i)return pe(),1}})(this,this.y+e,ve),Bt(this))}}super.F(t,this.D==Yt,i)}die(){this.type==Ni&&window.idkfa||(this.L=0,this.dead=1,this.q(Bt(this)))}hitTest(t,i,e,s){if(!(this.dead||this.Y[0]||this.O)&&i==s&&i>=this.t&&i<=this.y){if(this.L&&this.t+50>i)return;if(t<=this.x&&e>=this.x||t>=this.x&&e<=this.x)return[this.type,u(this.x,t)]}}I(t,i){const e=0==t?this.flip:t<0?1:0;return e!=this.flip&&(this.dir*=-1,this.flip=e,this.U=-i,this.px=this.buf[0]-this.px),this.U+=i,this.U<.15}j(t,i,e){if(!(this.dead||this.L||!e&&this.I(t,i)))if(0!=t){if(this.setAnim(1),!Yi(this.x+64*t,this.y,t))return this.move(t,0,i),1}else this.setAnim(Ut)}W(){Qi().spawn(this,this.L?32:0),Lt[1]()}q(...t){this.Y.length=0,this.Y.push(...t)}H(){this.K=null;for(const t of gi)if(u(t.y,this.y)<=2&&u(t.x,this.x)<64)return this.K=t}}let Ht;class Jt extends jt{type=_i;constructor(t,i){super(Ht,t,i,Ri,128),this.J=f([-1,0,1]),this.V=1/0,this.Z=0,this.tt=3}tick(t){const i=this.V>1024||this.x>bi.x&&!this.flip;this.j(this.J,t,!i)||(this.J=0),super.tick(t,this.J&&!i&&this.J!=this.dir)}it(){this.I(Math.sign(bi.x-this.x),0)}st(){const[t,i,e]=this.et();let s=this.J;this.V=1/0,t&(Ai|Pi)&&i<256?s=Math.random()<.25?-this.dir:0:t==Ti?(this.V=i,s=i<256?-this.dir:i<512?Math.random()<i/1024?this.dir:0:i<1024?this.dir:f([-1,0,1]),me(this)&&(this.tt=0,this.L||(this.W(),Zt(this)))):(!this.L&&u(this.t%256,64)<16&&Math.random()<.5&&(this.W(),Zt(this)),!bi.O&&!bi.Y[0]&&u(bi.y,this.y)<32&&u(bi.x,this.x)<i?(this.it(),this.V=u(bi.x,this.x),this.V<192&&(s=-this.dir)):Math.random()<.5&&(s=f([-1,0,1]))),this.tt<3?this.L=this.Z>1+3*Math.random()?0:Math.random()<.5:this.L=0,this.Z=this.L?this.Z+1:0,this.L||this.J==s||this.setAnim(Ut),this.J=s,++this.tt}et(){const t=Ai|Pi|(!bi.O&&!bi.Y[0]&&Ti);return Xi(this.x,this.y-64,this.dir,0,t,this)}nt=()=>{u(this.y,bi.y)<64&&(this.tt=0,this.it(),this.J=this.dir)}}let Wt=[],Kt=.5;const Zt=t=>{Wt.forEach(i=>i!=t&&i.nt())};let Qt=-.5;class ti extends jt{type=Ni;constructor(t,i,e){super(t,i,e,Fi,192)}tick(t){super.tick(t),this.O||this.dead||this.Y[0]||(this.H()&&(y[0]&&(this.K.d=1),y[1]&&(this.K.d=-1)),this.L=y[0],this.j(-y[2]+y[3],t))}keyPressed(t){if(!this.Y[0]){if(4==t&&be-Qt>=.5&&(this.W(),Zt(),Qt=be),0==t){if(this.O)return this.ht();const t=this.rt(1);if(t)return this.ot(t)}if(1==t){if(this.O)return this.ht();this.L=0;const t=Ki(this.x,this.y);if(t)return"X"==t.color&&-1==we.indexOf("C")?s("You can't leave without Manny"):-1==we.indexOf(t.color)?s(`You need a ${t.name} key`):this.ct(t);const i=this.rt(-1);if(i)return this.ot(i)}}}ct(t){this.O=t,t?this.q(Ot(this,0),_t(this,t.x),()=>(this.setAnim(5),t.open()),Et(this,1),()=>("X"==t.color&&ke(),1)):this.q(Et(this),Ot(this,Ut))}ot(t){const[i,e,s]=t,n=e+256*i[0],r=s+256*i[1],h=[_t(this,e,s),_t(this,n,r,.7)];-1==i[1]&&h.push(_t(this,n+33*i[0],r)),h.push(Ot(this,Ut)),this.I(i[0],0),this.setAnim(0),this.q(...h)}ht(){const t=this.O;if(this.ct(),!t.o)return t.o=1,Zt(),t.key?(we.push(t.key),s(`You found a ${t.keyName} key`),n(`<span style="background-color:${t.keyColor}">🔑</span>`),Lt[7](),t.key=null):t.cat?(t.cat=null,we.push("C"),n("🐈‍⬛"),Lt[7](),s("You found Manny!<br>Now get out of here!")):t.life?(t.life=null,Te(1),Lt[7](),s("You found a 🧡")):Math.random()<.7?s(`They keep ${f(_)} in there!`):void s("Nothing in there")}rt(t){for(const i of vi){const[e,s,n]=i;if(e[1]==t&&u(s,this.x)<32&&u(n,this.y)<8)return i}}}const ii={N:"#aaa",R:"#f53",B:"#3af",G:"#3f5",X:"#fb6"};let ei;const si=async t=>{t=ii[t];const i=w(0,0,102,166,"#678"),e=w(0,0,102,166,"#111")+w(1,1,100,166,"#333")+w(8,8,86,166,"#222"),s=S(102,166,k(.3,2)+i+w(10,10,84,166,t)+w(10,10,84,166,"#0002",'filter="url(#n)"')+b(14,80,14,35,2,2,"#fff")+b(22,85,16,6,2,2,"#fff")+b(20,100,2,5,1,1,"#000")),n=S(102,166,e+b(15,81,12,33,2,2,"#333")+b(22,86,15,4,2,2,"#888")+A(22,89,3,3,"#888")+b(20,100,2,5,1,1,"#000")),r=S(102,166,i+w(12,12,78,160,"#000")+w(83,9,10,166,t)),h=S(102,166,e+w(83,9,10,166,"#888")),[o,a,l,f]=await Promise.all([N(s),N(r),...ei?[]:[N(n),N(h)]]);return ei||=[L(l,2,6),L(f,2,6)],[[o,a],ei]},ni=(t,i)=>`<span style="color:${i}">${t}</span>`,ri={N:"",R:ni("red",ii.R),B:ni("blue",ii.B),G:ni("green",ii.G),X:ni("golden",ii.X)};class hi extends Dt{type=Di;constructor(t,i,e,s,n,r){super(t,i,e,Ci),this.py=166,this.flip=r,this.color=s,this.P=2*n}get name(){return ri[this.color]}get keyName(){return ri[this.key]}get keyColor(){return ii[this.key]}open(){return this.P|=1,1}close(){return this.P&=-2,this.o=0,1}}const oi=(t,i,e,s,n,r,h,o,a)=>{const l=Tt.add(t,i,e,s,n,r,h,o,a),f=()=>Tt.k(l,[i,e,s,n,r,h,o,a]);return{get type(){return t},get x(){return i},get y(){return e},get i(){return a},set i(t){t!=a&&(a=t,f())},pos:(t,s)=>{i==t&&e==s||(i=t,e=s,f())}}},ai=async()=>{let t="";for(let i=16;i<48;i+=6)t+=M(1,i,126,i,"#0004");const i=S(128,288,b(0,0,128,288,8,8,"#89a")+t+w(8,64,112,192,"#fff")),e=S(128,288,k(.1,.4)+w(0,0,128,288,"#444")+b(2,2,124,284,8,8,"#888")+t+b(4,4,120,280,8,8,"#fff4",'filter="url(#n)"')+w(8,62,112,194,"#000d")+A(10,10,2,2,"#fff")+A(10,54,2,2,"#fff")+A(118,10,2,2,"#fff")+A(118,54,2,2,"#fff")+A(18,270,2,2,"#fff")+A(110,270,2,2,"#fff")),[s,n]=await Promise.all([N(i),N(e)]);return[[s],[L(n,2,20)]]};class li extends Dt{type=Ei;constructor(t,i,e){super(t,i,e,Bi,192),this.light=oi(1,i,e-190,16,256,1,.2,.1,1),this.py=256,this.lt=e;let s=this.t>>>6;for(;0==$i(i>>>6,s-1)[2][2];)--s;this.ft=64*s+t[1],this.ut=0,this.dt=1,this.xt=e,this.vt=2*Math.random(),this.d=0}tick(t){this.move(0,this.ut,t);const i=Math.min(.8,2e5/(1+(e=this.x,s=this.y,(e-bi.x)**2+(s-bi.y)**2)));var e,s;this.y==this.xt?(this.vt+=t+3*t*Math.abs(this.d),this.vt>=2&&(this.vt=0,this.ut=0,1==this.d&&this.y<this.lt||-1==this.d&&this.y>this.ft?this.ut=this.d:this.d||(this.ut=this.y<=this.ft||this.y>=this.lt?-this.dt:this.dt),this.ut&&(this.xt=this.xt+256*this.ut,i>.05&&(this.yt=Lt[6](),this.yt[1].gain.value=i)))):(this.yt&&(this.yt[1].gain.value=i>.05?i:0),this.vt=0,(1==this.ut&&this.y>=this.xt||-1==this.ut&&this.y<=this.xt)&&(this.y=this.xt,this.dt=this.ut,this.ut=0)),this.d=0,this.light.pos(this.x,this.y-190)}hitTest(t,i,e,s){if(t==e&&t>=this.l&&t<=this.r){if(i<=this.t)return[Gi,this.t-i];if(i<this.y)return[ki,this.y-i]}else if(i==s)if(i>=this.t&&i<=this.t+64){if(t<=this.x&&e>=this.x||t>=this.x&&e<=this.x)return[Gi,u(this.x,t)]}else if(i>=this.y&&i<=this.b&&(t<=this.x&&e>=this.x||t>=this.x&&e<=this.x))return[ki,u(this.x,t)]}}const fi=async()=>{const t=await N(S(8,8,A(4,4,4,4,"#fff")));return[[t],[L(t,2,100)]]};let ci;class ui extends Dt{type=Li;constructor(t){ci||=oi(0,-1e3,0,32,256,1,.4,.4,0),super(t,-1e3,0,Ii,800),this.light=oi(0,-1e3,0,16,192,1,.8,.6,0),this.alpha=0}spawn(t,i){this.wt=t.dir,this.x=t.x+64*this.wt,this.y=i+t.y-115,this.alpha=1,this.light.pos(this.x,this.y),this.light.i=1,ci.pos(this.x,this.y),ci.i=1.1,this.$t=t,this.Mt=t.type==Ni?Pi:Ti|Pi}gt(){this.alpha=0,this.light.i=0}tick(t){if(0==this.alpha)return;const[i,e,s]=Xi(this.x,this.y,this.wt,0,Ai|Si|ki|Gi|this.Mt);return!ye(this)||i==Ai&&e<=32||(i&(ki|Gi))>0&&e<=64?(ye(this)&&Lt[5](),this.gt()):i&this.Mt&&e<=64?(s.die(),this.gt()):(i==Si&&e<=32&&(Lt[2](),s.i=0),this.move(this.wt,0,t),void this.light.pos(this.x,this.y))}}const di=[[1,-1],[-1,1],[-1,-1],[1,1]],xi=[],pi=[],yi=[],mi=[],vi=[],gi=[],wi=[];let bi,Mi=[];const $i=(t,i)=>xi[i*x+t],Ai=1,Gi=2,ki=4,Ti=8,Pi=16,Si=32,Ni=Ti,Di=256,Li=512,_i=Pi,Ei=ki|Gi,Oi=ki|Gi|Ti|Pi,Bi=1,Ci=2,Ri=3,Fi=4,Ii=5,zi=(t,i)=>(2&$i(t,i)[2][2])>0,Yi=(t,i,e)=>{for(const e of gi)if(!(u(e.x,t)>64||e.b<i-128||e.t>=i)&&u(i,e.y)>7)return 1;t=t+e>>>6|0;for(let e=(i=i>>>6|0)-2;e<i;++e)if(zi(t,e))return 1},Ui=64*x-1,qi=64*p-1,Vi=[0,1/0],Xi=(t,i,e,s,n,r)=>{let h,o,a,l=1/0,f=1/0,c=1/0;t=Math.min(Ui,Math.max(0,t)),i=Math.min(qi,Math.max(0,i));const d=Math.min(Ui,Math.max(0,t+1e5*e)),x=Math.min(qi,Math.max(0,i+1e5*s));if(n&Ai)if(0!=e){for(let s=t>>>6;s!=(d>>>6)+e;s+=e)if(zi(s,i>>>6)){l=u(64*s+32,t);break}}else for(let e=i>>>6;e!=(x>>>6)+s;e+=s)if(zi(t>>>6,e)){l=u(64*e+32*s,i);break}return n&Si&&pi.forEach(e=>{if(e.i>0&&u(i,e.y)<32){const i=u(t,e.x);i<c&&(c=i,a=e)}}),n&Oi&&yi.forEach(e=>{if(e.type&n&&e!=r){const[s,n]=e.hitTest(t,i,d,x)??Vi;n<f&&(f=n,h=e,o=s)}}),l<=f+32&&l<=c+32?[Ai,l-1]:f<c?[o,f,h]:c<1/0?[Si,c,a]:Vi};let ji=1,Hi=[];const Ji=t=>(yi.push(t),ji=1,t),Wi=t=>{ji=1,Hi.push(t)},Ki=(t,i)=>{for(const e of mi)if(c(t,i,e.l,e.t,e.r,e.b))return e};let Zi=0;const Qi=()=>wi[Zi++%wi.length],te=64*x,ie=64*p,ee=-Math.max(0,640-.5*te),se=-Math.max(0,400-.5*ie),ne=te-t,re=ie-i,he=(t,i,e)=>t+Math.sign(i-t)*Math.min(u(i,t),e),oe=(t,i)=>[Math.max(ee,Math.min(ne,t-640)),Math.max(se,Math.min(re,i-96-400))];let[ae,le]=oe(0,ie),fe=ae+t,ce=le+i,ue=ae,de=le,xe=0;const pe=()=>xe=1,ye=t=>!(le>t.b||ce<t.t||ae>t.r||fe<t.l),me=t=>t.t>=le&&t.b<=ce&&t.l>=ae&&t.r<=fe,ve=1280,ge=256,we=["N"];let be,Me,$e=3,Ae=e=>{be+=e,(t=>{for(let i=0;i<=4;++i)y[i]!=m[i]&&!m[i]&&!t.dead&&t.keyPressed(i),m[i]=y[i]})(bi),(e=>{[ue,de]=oe(bi.x,bi.y);const s=1.8**Math.log((ue-ae)**2+(de-le)**2+1);ae=he(ae,ue,s*e)+xe*(1-2*Math.random())*4,le=he(le,de,s*e)+xe*(1-2*Math.random())*4,fe=ae+t,ce=le+i,xe=Math.max(0,xe-e)})(e),(t=>{ji&&(Hi.forEach(t=>yi.splice(yi.indexOf(t),1)),Hi.length=0,yi.sort((t,i)=>t.z-i.z),ji=0),yi.forEach(i=>i.tick(t)),(t=>{ci.i=Math.max(0,ci.i-8*t)})(t)})(e),(t=>{Kt+=t,Kt<.5||(Kt=0,Wt.forEach(t=>{!t.dead&&u(t.y,bi.y)>512&&!ye(t)&&(t.dead=1,Wi(t))}),Wt.some(t=>t.dead)&&(Wt=Wt.filter(t=>!t.dead)),((t=512)=>{if(Wt.length>=20)return;const i=f(mi.filter(i=>{if(!(u(i.y,bi.y)>t||"X"==i.color||Math.random()<.5||ye(i)||i.o&&Math.random()>.02)){for(const t of Wt)if(u(t.y,i.y)<256&&u(t.x,i.x)<512)return;return 1}}));i&&Wt.push(Ji(new Jt(i.x,i.y)))})(),Wt.forEach(t=>t.st()))})(e),(()=>{const e=Math.round(ae),s=Math.round(le);let n;h.blendFunc(1,771),h.viewport(0,0,t,i),h.clearColor(0,0,0,0),ft[1](),h.clear(16384),lt[1](),bt[0](),h.uniform1f(bt[3],1),h.uniform3f(bt[4],e,s,0),St(Pt[0],0,it),St(Pt[1],1,it),$t.draw(),At.draw(),ft[1]();let r=1;yi.forEach(t=>{t.alpha>0&&ye(t)&&(t.buf!=n&&(St(t.buf[3][0],0,it),St(t.buf[3][1],1,it),n=t.buf),t.alpha!=r&&(h.uniform1f(bt[3],t.alpha),r=t.alpha),t.buf[4].set(0,t.l,t.t,t.f,t.flip),t.buf[4].draw())}),h.uniform1f(bt[3],1),St(Pt[0],0,it),St(Pt[1],1,it),Gt.draw(),ct[1](),(()=>{h.disable(K),h.viewport(0,0,640,400),dt[1](),yt[0](),St(ft[0][0]),kt.draw(),mt[0]();for(let e=1;e<3;++e)ut[1](),h.uniform3f(mt[2],0,1/i,.11),St(dt[0][0]),kt.draw(),dt[1](),h.uniform3f(mt[2],1/t,0,.11),St(ut[0][0]),kt.draw();h.enable(K),h.viewport(0,0,t,i)})(),xt[1](),vt[0](),St(ft[0][0]),St(lt[0][0],1),St(dt[0][0],2),kt.draw(),pt[1](),gt[0](),St(xt[0][0]),kt.draw(),h.blendFunc(1,1),Mt[0](),h.uniform3f(Mt[3],e,s,0),St(lt[0][1],1),Tt.draw(),h.blendFunc(770,771),h.drawBuffers([]),h.bindFramebuffer(et,null),wt[0](),St(pt[0][0]),kt.draw()})()};const Ge=()=>{const t=we.indexOf("C")>=0;t&&(we.splice(we.indexOf("C"),1),r("🐈‍⬛"),s("They took your cat again!")),(t=>{if(bi=Ji(new ti(bi.buf,...Mi)),t){const t=f(mi.filter(t=>"G"==t.color));t.close(),t.cat=1}})(t)},ke=t=>{Me[0].stop(),!t&&Lt[4](),Ae=o,p_ui.style.backgroundColor="#0008",p_ui.style.pointerEvents="auto",p_ui.innerHTML=`<div><b>${t?"YOU FAILED":"YOU RESCUED MANNY! 🐈‍⬛"}</b></div><div><a href="javascript:window.location.reload()">Play again</a></div>`},Te=t=>($e+=t,$e<0?ke(1):(t>0?n("🧡",1):r("🧡"),1)),Pe=async()=>{const t=await N(S(500,120,$("PET &amp; WILDLIFE",250,40,"s","#fb8")+$("SNATCHERS INC.",250,90,"s","#fb8")));return[[t],[L(t,1,10)]]};requestAnimationFrame(async t=>{((t,i,e,s,n,r,h)=>{s=ot([s.reduce((t,i)=>(t.push(...i[0]),t),[]),s.reduce((t,i)=>(t.push(...i[1]),t),[])]),n=ot(n);const a=(()=>{const t=[...d.join("")],i=(i,e)=>t[e*x+i],e=(i,e,s)=>Array.from(s).forEach((s,n)=>t[e*x+i+n]=s),s=[(t,i)=>{e(--t,i--,"+"),e(--t,i--,"+Ss"),e(--t,i--,"+Ss^"),e(t,--i,"s")},(t,i)=>{e(++t,i--,"-"),e(--t,i--,"tT-"),e(t++,i--,"^tT-"),e(t+2,--i,"t")},(t,s)=>1!=t&&t!=x-2||s%4!=1?s%4==1&&t%6==4?e(t,s,"^"):void(Math.random()<.7&&s%4==2&&t>2&&t<x-4&&i(t-1,s)+i(t-1,s+1)+i(t,s+1)+i(t+1,s+1)+i(t+1,s)=="     "&&e(t,s,"?")):e(t,s,"0123456789abcd"[(p-s>>2)-1]),(t,s)=>{i(t,s+1)+i(t+1,s)=="=|"&&e(t,s,"!")}];return t.forEach((t,i)=>{(s["ST |".indexOf(t)]??o)(i%x,i/x|0)}),t})(),l="NRBGX";var c,u,y;a.forEach((t,e)=>{const r=e%x,h=e/x|0,o=64*r,f=64*h;if("P"==t)Mi=[o,f+63],bi=Ji(new ti(ot(i,1),o,f+63,["N"])),t=" ";else if("!"==t){const i=Ji(new li(n,o+64,f+64));pi.push(i.light),gi.push(i),t="|"}else if("^"==t)pi.push(oi(1,o+32,f+2,48,256,.8,.9,1,1)),t=" ";else if("v"==t)oi(2,o+32,f+62,16,256,1,.9,.8,1),t=" ";else if(l.indexOf(t)>=0)mi.push(Ji(new hi(s,o+32,f+63,t,l.indexOf(t),Math.random()>.5))),t=" ";else if("TtSs".indexOf(t)>=0&&"="==a[(h+1)*x+r]){const i="tS".indexOf(t)>=0?63:0;vi.push(((t,i,e)=>[di[t],i,e])("TtSs".indexOf(t),o+i,f+63))}let c=" =Ss+Tt-|0123456789abcd?".indexOf(t);c+=("?"==t)*(Math.random()*(j.length-c))|0;const u=j[c];((t,i,e)=>{xi[i*x+t]=e})(r,h,((t,i,e)=>[i,e,t])(u,o,f)),u[3]&&oi(0,o+32,f+32,...u[3])}),c=ot(e,1),Ht=c,Wt.push(Ji(new Jt(bi.x+1200,bi.y))),Ji(new Dt(ot(h),1824,qi-160)),r=ot(r);for(let t=0;t<12;++t)wi.push(Ji(new ui(r)));Array.from(l.substring(1)).forEach((t,i)=>f(mi.filter(t=>l.indexOf(t.color)==i)).key=t),f(mi.filter(t=>!t.key&&t.y<512&&"G"==t.color)).cat=1,f(mi.filter(t=>!t.key&&!t.cat)).life=1,f(mi.filter(t=>!t.key&&!t.cat)).life=1,u=xi,y=t,Pt.push(ht(y[0]),ht(y[1])),u.forEach(([t,i,[e,s,n]])=>{$t.add(t,i,0),e--&&[At,Gt][e].add(t,i,s,1&n)})})(...await Promise.all([X(),Xt(0),Xt(1),Promise.all([si("N"),si("R"),si("B"),si("G"),si("X")]),ai(),fi(),Pe(),new Promise(t=>{const i=new AudioContext;let e=0;const s=()=>{const n=Lt[e](i);if(n&&(Lt[e++]=()=>{"suspended"==i.state&&i.resume();const t=new AudioBufferSourceNode(i,{buffer:n,loop:n.duration>20}),e=i.createGain();return t.connect(e).connect(i.destination),t.start(),[t,e]},!Lt[e]))return t();requestAnimationFrame(s)};requestAnimationFrame(s)})]));const i=e=>{document.hasFocus()&&Ae(Math.min(1/30,.001*(e-t))),t=e,requestAnimationFrame(i)};p_l.innerHTML='<b style="cursor:pointer;"><u>START GAME</u></b>',p_l.onclick=()=>{(()=>{be=0,Me=Lt[0](),p_t.style.display="none",p_c.style.display="block",s("Locate and rescue Manny 🐈‍⬛"),n('<span style="background-color:#888">🔑</span>');for(let t=0;t<$e;++t)n("🧡",1)})(),requestAnimationFrame(i)}})})();</script>