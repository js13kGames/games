<!doctype html><meta content="width=device-width,maximum-scale=1,user-scalable=0" name=viewport><style>body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden}canvas.fullscreen{position:absolute;margin:0}canvas{position:absolute;left:50%;top:50%}body{margin:0;padding:0;background:#000;font-family:"Lucida Console",Courier,monospace;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}canvas{background:#fff;display:block;margin:0 auto;display:none;image-rendering:pixelated;image-rendering:-moz-pixelated;image-rendering:-webkit-pixelated;cursor:none}h1{left:0;line-height:200px;margin:auto;margin-top:-100px;position:absolute;top:50%;width:100%;text-align:center}#l{color:#fff;font-size:150%}</style><div id=l><h1 id=h>Loading</h1></div><div id=fs></div><canvas></canvas><script>BUILD=!0,(()=>{function t(t){this.images=t,this.loaded=[],this.loadedImgs=0,this.totalImgs=Object.keys(t).length,this.start=function(){return new Promise(((t,i)=>{this.resolve=t,this.reject=i,this.loadImages(this.images)}))},this.loadImages=function(t){for(var i in t)t.hasOwnProperty(i)&&(this.loaded[i]=new Image,this.loaded[i].onload=this.checkLoaded(),this.loaded[i].src="data:image/gif;base64,"+t[i])},this.checkLoaded=function(){this.loadedImgs+=1,this.loadedImgs===this.totalImgs&&setTimeout((()=>this.resolve(this.loaded)),500)},this.makeFonts=function(){return new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}}function i(t,i){return this.w=t,this.h=i,this.c=document.getElementsByTagName("canvas")[0],this.ctx=this.c.getContext("2d"),this.c.width=t,this.c.height=i,this.c.style.width=t+"px",this.c.style.height=i+"px",this.resize=function(){document.querySelector("canvas");var t=this.w/this.h;let i=window.innerWidth,s=window.innerHeight;t<i/s?(i=s*t,this.c.style.height=s+"px",this.c.style.width=i+"px"):(s=i/t,this.c.style.width=i+"px",this.c.style.height=s+"px"),this.c.style.marginTop=-s/2+"px",this.c.style.marginLeft=-i/2+"px"},this._resize=function(){var t=window.innerHeight,i=t*(i=(window.innerWidth,this.w/this.h));this.c.width=this.w,this.c.height=this.h,this.cx=this.w/2,this.cy=this.h/2,this.c.style.width=~~i+"px",this.c.style.height=~~t+"px"},this.delayedResize=function(t=100){window.setTimeout((()=>{this.resize()}),t)},window.addEventListener("resize",(()=>{this.delayedResize()})),window.addEventListener("fullscreenchange",(()=>{this.delayedResize(150)})),this.delayedResize(500),{c:this.c,ctx:this.ctx}}var s={timeStamp:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},rnd:function(t,i){return Math.floor(Math.random()*(i-t+1)+t)},rndArray:function(t){return t[~~(Math.random()*t.length)]},mkCanvas:function(t,i){var s=document.createElement("canvas"),h=s.getContext("2d");return s.width=t,s.height=i,h.mozImageSmoothingEnabled=!1,h.msImageSmoothingEnabled=!1,h.imageSmoothingEnabled=!1,s},mkFont:function(t,i,s){return(t=t.draw.color(t.imgs["font_"+i],t.o.pal[s],!0)).scale=i,t},tween:function(t,i,s,h){return s*t/h+i}};function h(t,i){var s=window.addEventListener;this.c=t,this.g=i,this.click=0,this.keys={l:0,r:0},this.resetKeys=()=>{this.keys={l:0,r:0,click:!1}},s("keydown",(t=>{switch(t.keyCode){case 39:this.keys.r=1;break;case 37:this.keys.l=1}this.click=!0})),s("keyup",(t=>{switch(t.keyCode){case 39:this.keys.r=0;break;case 37:this.keys.l=0}this.click=!1})),s("touchstart",(t=>{this.trackTouch(t.touches)})),s("touchmove",(t=>{this.trackTouch(t.touches)})),s("touchend",(t=>{this.trackTouch(t.touches),this.resetKeys()})),this.trackTouch=t=>{var i=this.c,s=i.offsetLeft,h=parseInt(i.style.width,10)/i.width;t&&t[0]&&(t=~~(t[0].pageX-s)/h,this.click=!0,t<i.width/2?this.keys.l=1:this.keys.r=1)}}var e={title:"BEWITCHED!",start:"Ready",gravity:9.8,w:320,h:480,pal:[[0,0,0],[157,157,157],[255,255,255],[190,38,51],[224,111,139],[73,60,43],[164,100,34],[235,137,49],[247,226,107],[42,72,78],[68,137,26],[163,206,39],[27,38,50],[0,87,132],[49,162,242],[178,220,239],[40,30,40],[30,40,30],[44,34,28],[122,50,46],[44,44,44]],i:{bat:"R0lGODlhEAAIAKEDAAAAAC9ITvfia+BviyH5BAEKAAMALAAAAAAQAAgAAAIdnI95YawZomt0ACBCvk2eKwFHliEX93mmuKLPehQAOw==",biter:"R0lGODlhDgAIAKECAL4mM////+Bvi+BviyH5BAEKAAIALAAAAAAOAAgAAAIYVH6iq+j2HACuolkxtEebH2wIQ1bNIwoFADs=",brick1:"R0lGODlhCAAHAIABAAAAAOBviyH5BAEKAAEALAAAAAAIAAcAAAINhBEZh8rL2lFpQlpbKgA7",brick2:"R0lGODlhBgAIAIABAAAAAOBviyH5BAEKAAEALAAAAAAGAAgAAAIMDIJ4tgp/4EswWWoLADs=",broom:"R0lGODlhDAADAKECAKRkIuuJMeBvi+BviyH5BAEKAAIALAAAAAAMAAMAAAIKVC6peeAPDVqqAAA7",bubble:"R0lGODlhBgAGAIABAP///+BviyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAEALAAAAAAGAAYAAAIKTAB2lqmolnPHFQA7",cat:"R0lGODlhCAAGAKECAKPOJ////+Bvi+BviyH5BAEKAAIALAAAAAAIAAYAAAIOlGOCF90HGlDKLftOCgUAOw==",cat1:"R0lGODlhCAAGAKECABsmMqPOJ+Bvi+BviyH5BAEKAAIALAAAAAAIAAYAAAIOlGGCB90XWlDKLftOAgUAOw==",cat2:"R0lGODlhCAAGAKECAOuJMaPOJ+Bvi+BviyH5BAEKAAIALAAAAAAIAAYAAAIOlGGCB90XWlDKLftOAgUAOw==",circle:"R0lGODlhCAAIAIABAP///zGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=",demon:"R0lGODlhEAAIAKEDAAAAAL4mM////+BviyH5BAEKAAMALAAAAAAQAAgAAAIf1I5ieLrtmBqTrjqD3rxvAGigGAajh3ZHug0B87pqAQA7",door:"R0lGODlhCQAOAKECAAAAABsmMuBvi+BviyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAEALAAAAAAJAA4AAAIXDI5gyRq/DnxpRgfr1BlZTnmb2Emj2RUAOw==",dot:"R0lGODlhAQABAIABAP///zGi8iH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==",fireball:"R0lGODlhCAAFAMIEAL4mM+uJMffia////+Bvi+Bvi+Bvi+BviyH5BAEKAAQALAAAAAAIAAUAAAMOSErQy0GMRqMArAasKE4AOw==",firefly:"R0lGODlhCAAEAKEDAESJGqPOJ/fia+BviyH5BAEKAAMALAAAAAAIAAQAAAIN1BZwwpHAhnAAnpNuAQA7",font:"R0lGODlhmwAFAIABAAAAADGi8iH5BAEKAAEALAAAAACbAAUAAAJ4hGOAd6sZFpowPhrxhZz5x2ji5pRTyVEfulaWRV6vfNayksV5O/b53NMBcbjX0JY50pYwkFHDAxGTTlsUpZIadRViYzo1tVazcfHHRSOVWx9UyKK2wym6+nRei47AtkTbAbgTc1X3VvOXtfXFhkfmpVUWqeiSZFkAADs=",heart:"R0lGODlhBQAFAIABAL4mMzGi8iH5BAEKAAEALAAAAAAFAAUAAAIIDGygu3mBQgEAOw==",skull:"R0lGODlhBQAEAIABAP///+BviyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAEALAAAAAAFAAQAAAIGhB+QZ+kFADs=",spark:"R0lGODlhAwADAIABAP///+BviyH5BAEKAAEALAAAAAADAAMAAAIEDAx3BQA7",spider:"R0lGODlhBwAEAKECAAAAAL4mM+Bvi+BviyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAIALAAAAAAHAAQAAAIKFH4iAQyK0pumAAA7",spike:"R0lGODlhBgAIAKEDAEk8K52dnf///+BviyH5BAEKAAMALAAAAAAGAAgAAAIPBIYTIckCxQrJJMVchDMVADs=",spitter:"R0lGODlhBAAHAKEAAOBvi52dnf///+BviyH5BAEKAAMALAAAAAAEAAcAAAIKVDZ2ChqGYAqnAAA7",torch:"R0lGODlhAwALAMIEAEk8K74mM6RkIvfia+Bvi+Bvi+Bvi+BviyH5BAEKAAQALAAAAAADAAsAAAMOSBS7HDCMpxQQgGRtSQIAOw==",witch:"R0lGODlhDwAIAKEDAESJGqPOJ////+BviyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAMALAAAAAAPAAgAAAIanI+py+0BApRyTGhrDoYaAX7hAArkSKapmRQAOw=="},sfx:{hit:[,,537,.02,.02,.22,1,1.59,-6.98,4.97],piano:[.9,.8,270,,.1,,1,1.5,,,,,,,,.1,.01],jump:[.1,,921,.04,.03,.52,,2.44,,.5,,,.05,1.4,57,.9,,.33,.18,.47],land:[,,129,.01,,.15,,,,,,,,5],thunder:[1,,979,.01,.02,.52,1,2.52,.5,.7,,,.02,1.2,7,.2,.13,.48,.01,.44],fin:[.5,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],speak:[,,1236,.01,.01,.02,1,.13,,-6.5,,,,.2,,,,.14,.02,.25],win:[1.06,,299,,.3,.23,,.04,-2.6,4.3,,,.19,,,,,.74,.17,.4],gameover:[1.04,,612,.01,.17,.41,,.3,,,,,.17,,,.2,,.62,.25,.27]}},a={0:{n:"TUTORIAL",h:1,bg:20,l:6,data:["B-100-280","L-0-50-320","L-0-200-30","L-290-200-30","L-140-350-50-0-0-0-7"]},1:{n:"BELFRY",h:3,bg:12,l:14,data:["B-100-280","L-110-50-100","L-0-200-30","L-290-200-30","L-140-350-50-1","B-250-600","L-140-700-50","L-0-900-30","L-290-750-30","B-250-900","L-0-1100-30-0-1","L-290-1100-30-0-1","L-140-1300-50-0-0-0-7"]},2:{n:"INFESTATION",h:4,bg:18,l:7,data:["L-110-50-100","L-100-350-150-0-0-0-1","L-290-500-30-0-1","L-0-500-30-0-1","B-100-500","L-80-700-50-0-0-0-1","L-200-700-50-0-0-0-1","L-20-900-30-0-0-0-1","L-270-900-30-0-0-0-1","B-100-1000","L-100-1200-100-1","L-145-1450-30-0-1","B-100-1500","L-20-1650-30-0-0-0-1","L-270-1650-30-0-0-0-1","L-120-1750-50-0-0-0-7"]},3:{n:"MUNCHFEST",h:5,bg:16,l:4,data:["L-110-50-100","L-100-350-150-0-0-0-2","L-0-600-50-0-0-0-2","L-270-600-50-0-0-0-2","L-100-700-150-0-0-0-3","L-100-1000-150-1","B-100-1200","L-100-1400-150-1","B-100-1600","L-100-1800-150-1","L-120-2300-50-0-0-0-7"]},4:{n:"INFERNO",h:5,bg:17,l:8,data:["L-110-50-100","L-110-250-100-0-1","S-0-300","S-1-300","L-0-700-50-1","S-0-800","S-1-800","L-0-1000-50-0-0-0-3","L-270-1000-50","S-0-1200","S-1-1200","L-270-1300-50","L-0-1400-50","L-110-1600-100-0-0-0-3","S-0-1700","S-1-1700","L-270-1800-50","L-0-2000-50","S-0-2150","S-1-2150","L-120-2300-50-0-0-0-7"]},5:{n:"YE OLDE DEATHE",h:6,bg:19,l:12,data:["L-110-50-100","L-110-250-100-1-1","S-0-200","S-1-200","X-0-300","X-1-300","X-0-350","X-1-350","B-100-375","X-0-400","X-1-400","X-0-450","X-1-450","L-110-600-100-0-0-0-1","L-0-800-100-0-0-0-2","L-220-800-100-0-0-0-2","L-110-1000-100","S-0-1000","S-1-1000","X-0-1200","X-1-1200","L-110-1350-100-1-1","S-0-1500","S-1-1500","B-100-1550","S-0-1600","S-1-1600","L-110-1800-100","X-0-2000","X-1-2000","L-0-2050-50","L-270-2050-50","X-0-2060","X-1-2060","L-110-2300-100-1-0","L-110-2400-100-0-1","B-0-2550","B-280-2550","L-120-2700-50-0-0-0-7"]}},r=class{constructor(t,i){for(var s in this.g=t,this.o=i,this.id="id-"+Math.random().toString(36).substr(2,16),this.dead=!1,this.remove=!1,this.offsetY=0,this.name=i.i,this.vx=0,this.vy=0,i)this[s]=i[s];this.lastPos={x:this.x,y:this.y},this.flip={x:0,y:0},this.scale=i.scale||1,this.frame=i.frame||1,this.frames=i.frames||1,this.frameRate=i.frameRate||80,this.frameNext=i.frameNext||0,i.i&&this.mkImg(i.i),this.hurt=!1,this.anims={idle:{frames:[1],rate:80}},this.changeAnim("idle")}update(t){this.lastPos={x:this.x,y:this.y},this.collidesWith&&this.collidesWith.forEach((t=>{this.hitGroup(t)})),this.updateAnim(t)}render(){let t=this.g,i=this.hurt?this.iHurt:this.i,s=this.frame;if(this.g.viewport&&!this.hit(this.g.viewport))return;this.x;let h=~~this.y;this.g.viewport&&(h=this.convY()),i?(this.flip.y&&(i=t.draw.flip(i,0,1)),this.flip.x&&(i=t.draw.flip(i,1,0),s=this.frames-this.frame+1),t.draw.ctx.drawImage(i,s*this.w-this.w,0,this.w,this.h,~~this.x,h+this.offsetY,this.w,this.h)):t.draw.rect(this.x,h,this.w,this.h,this.col)}convY(t=this.y){return this.g.viewport.convY(t)+this.g.viewport.y}updateAnim(t){this.frameNext<0&&(this.frameNext=this.anim.rate,this.anim.counter+=1,this.anim.counter>=this.anim.frames.length&&(this.anim.next?this.changeAnim(this.anim.next):this.anim.counter=0),this.frame=this.anim.frames[this.anim.counter]),this.frameNext-=t}hitGroup(t){this.g.ents.forEach((i=>{i&&i.group===t&&i.id!==this.id&&this.hit(i)&&(this.receiveDamage(i),i.doDamage(this))}))}hit(t){return!(t.y+t.h<this.y||t.y>this.y+this.h||t.x+t.w<this.x||t.x>this.x+this.w)}receiveDamage(t){}doDamage(t){}kill(){this.dead=this.remove=!0}mkImg(t){var i;this.i&&(i=this.g,this.i=i.draw.resize(i.imgs[t],this.scale),this.w=this.i.width/this.frames,this.h=this.i.height,this.iHurt=i.draw.color(this.i,i.data.pal[3]))}changeAnim(t){this.anim&&this.anim.name&&this.anim.name===t||(this.anim=this.anims[t],this.anim.name=t,this.anim.counter=0,this.frame=this.anim.frames[0],this.frameNext=this.anim.rate)}},n=new AudioContext;e.states={Ready:class{constructor(t){this.g=t,this.mainText=t.H.mkFont(t,4,11),this.text=t.mobile?"TAP ME":"PRESS A KEY"}init(){}update(t){this.g.input.click&&this.g.changeState("Title")}render(){var t=this.g;t.draw.clear(0),0<t.fader&&t.draw.text(this.text,this.mainText,!1,120)}},Title:class{constructor(t){this.g=t,this.bat=this.g.spawn("Bat",{p:this,x:100,y:445,s:2}),this.bat=this.g.spawn("Bat",{p:this,x:200,y:200}),this.mainText=t.H.mkFont(t,6,11),this.mainShadow=t.H.mkFont(t,6,0),this.startText=t.H.mkFont(t,2,2),this.canSwitch=!1,this.text=t.mobile?"TAP TO START":"L OR R ARROW TO START",this.bga=0}init(){this.setThunder(),this.g.addEvent({t:75,cb:()=>{this.canSwitch=!0}})}setThunder(){this.g.addEvent({t:this.g.H.rnd(200,500),cb:()=>{this.bga=1,this.g.sfxPlay("thunder"),this.setThunder()}})}update(t){var i=this.g,s=(i.ents.forEach((i=>{i.update(t)})),0<this.bga&&(this.bga-=t),this.bga<0&&(this.bga=0),i.input);s.click&&this.canSwitch&&i.changeState("Play"),s.click=!1}render(){var t=this.g;t.draw.clear(12),this.bga&&t.draw.rect(0,0,t.w,t.h,2,this.bga),t.draw.circle(230,70,40,2),this.drawTower(),t.draw.rect(0,t.h-10,t.w,t.h,3),t.draw.text(t.data.title,this.mainShadow,!1,156),t.draw.text(t.data.title,this.mainText,!1,150),this.g.ents.forEach((t=>{t.render()})),t.draw.triangle(90,70,100,50,19),t.draw.triangle(90,70,100,50,0,.1),0<t.fader&&t.draw.text(this.text,this.startText,!1,400)}drawTower(){var t=this.g;t.draw.rect(90,70,100,t.h,19),t.draw.rect(120,t.h-40,20,t.h,0),t.draw.img(t.imgs.brick1,100,100,8,.1),t.draw.img(t.imgs.brick1,142,t.h/2,6,.1),t.draw.img(t.imgs.brick2,t.w/3,t.h/3,10,.1),t.draw.img(t.imgs.brick2,t.w/3,300,10,.1)}},Play:class{constructor(t){this.g=t,(window.P=this).tower={fin:!1,h:3*this.g.h,bg:12},this.mainText=t.H.mkFont(t,3,11),this.curtain={active:!1,h:0},this.g.plays+=1}init(){this.tower=new class{constructor(t){this.level=1,this.p=t,this.g=t.g}init(t){this.level=t,this.fin=!1;let i=a[t];i?(this.n=i.n,this.bg=i.bg,this.h=i.h*this.g.h,i.data.forEach((t=>{let s=t.split("-");switch(s.forEach(((t,i)=>{i&&(s[i]=~~t)})),s[0]){case"B":this.g.spawn("Bat",{p:this.p,x:~~s[1],y:~~s[2]});break;case"S":this.g.spawn("Spitter",{p:this.p,x:~~s[1],y:~~s[2]});break;case"X":this.g.spawn("Spike",{p:this.p,x:~~s[1],y:~~s[2]});break;case"L":s=(h=s).concat(Array(10).fill(0)).slice(0,10),h={p:this.p,x:s[1],y:s[2],w:s[3],vx:s[4],vy:s[5],col:s[6]||i.l,b:s[7]},this.g.spawn("Ledge",h)}var h}))):this.complete=!0}}(this),this.sess={level:this.g.plays<2?0:1,score:0,time:0,lives:2,gameOver:!1},this.nextLevel()}nextLevel(){var t=this.g.w;if(this.g.ents=[],this.g.events=[],this.bgBlocks=[],this.tower.init(this.sess.level),this.tower.complete)this.g.changeState("Win");else{var i=~~(this.tower.h/200);for(let h=1;h<i;h+=1){var s=.5<Math.random()?1:2;this.bgBlocks.push(["brick"+s,-20,200*h+20,16,.1]),this.bgBlocks.push(["brick"+s,240,200*h+20,16,.1]),h%2!=0&&this.bgBlocks.push(["brick"+s,t/2,200*h+20,5,.1])}this.door=this.g.spawn("Door",{p:this}),this.p1=this.g.spawn("Witch",{p:this}),this.g.viewport.init(this.tower.h),this.g.viewport.y=this.tower.h-this.g.h,0===this.sess.level&&2===this.sess.lives?this.helpText():0<this.sess.level&&(this.addText("LEVEL "+this.sess.level,50,!1,300,11,4),this.addText(this.tower.n,100,!1,340,11,4))}}update(t){!this.door.open&&this.cat.owner&&(this.door.open=!0),this.curtain.active&&this.curtain.h<this.g.h?this.curtain.h+=10:0<this.curtain.h&&(this.curtain.h-=15),this.g.ents.forEach((i=>{i.update(t)}))}render(){const t=this.g,i=(t.draw.clear(this.tower.bg),this.convertY.bind(this));this.g.viewport.convY.bind(this.g.viewport),t.draw.rect(0,i(18),t.w,50,3),t.draw.rect(0,i(18),t.w,2,0,.3),this.bgBlocks.forEach((s=>{var h=i(s[2]),e=t.imgs[s[0]].height*s[3];(t.viewport.y<h+e||t.viewport.y>h+e)&&!t.android&&t.draw.img(t.imgs[s[0]],s[1],h,s[3],s[4])})),this.g.ents.forEach((t=>{t.render()})),this.p1&&(t.draw.rect(18,16,this.p1.maxCharge+4,14,0),t.draw.rect(20,18,this.p1.charge,10,11),t.draw.rect(20,18,this.p1.charge,4,2,.3));let s=this.sess.lives;for(;s--;)t.draw.img(t.imgs.heart,300-20*s,20,2);0<this.curtain.h&&t.draw.rect(0,0,t.w,this.curtain.h,0),this.curtain.active&&this.curtain.h>=t.h&&(this.sess.level+=1,this.nextLevel(),this.curtain.active=!1)}convertY(t){return this.g.h-t+this.g.viewport.y}levelComplete(){this.tower.fin||(this.tower.fin=!0,this.g.sfxPlay("piano"),this.curtain.active=!0)}helpText(){let t="HOLD LEFT ARROW",i="HOLD RIGHT ARROW";this.g.mobile&&(t=i="HOLD HERE"),this.addText(t,50,10,310),this.addText("TO FLY LEFT",50,10,330),this.addText(i,400,180,310),this.addText("TO FLY RIGHT",400,180,330),this.addText("NOW RESCUE CAT",770,!1,100,7,4)}addText(t,i,s=10,h=310,e=1,a=2){this.g.addEvent({t:i,cb:()=>{this.g.spawn("Text",{x:s,y:h,text:t,col:e,o:5,scale:a})}})}},Gameover:class{constructor(t){this.g=t,this.mainText=t.H.mkFont(t,6,2),this.canSwitch=!1,this.o=0}init(){this.g.addEvent({t:100,cb:()=>{this.canSwitch=!0,this.g.sfxPlay("gameover")}})}update(t){this.o<.5&&(this.o+=t/10),this.g.ents.forEach((i=>{i.update(t)})),this.g.input.click&&this.canSwitch&&this.g.changeState("Title")}render(){var t=this.g;t.draw.clear(3),t.draw.rect(0,0,t.w,t.h,0,this.o),0<t.fader&&(t.draw.text("GAME",this.mainText,!1,100),t.draw.text("OVER",this.mainText,!1,150)),t.draw.img(t.imgs.skull,120,240,14,.2),this.g.ents.forEach((t=>{t.render()}))}},Win:class{constructor(t){this.g=t,this.mainText=t.H.mkFont(t,7,2),this.canSwitch=!1,this.o=0,this.cat2=t.draw.flip(t.imgs.cat1,1,0)}init(){this.g.sfxPlay("win"),this.confetti(),this.g.addEvent({t:500,cb:()=>{this.canSwitch=!0}}),this.g.addEvent({t:100,cb:()=>{this.g.spawn("Text",{text:"YAYYY",x:20,y:350,col:2,scale:3,o:4}),this.g.sfxPlay("speak")}}),this.g.addEvent({t:200,cb:()=>{this.g.spawn("Text",{text:"YOU AWESOME",x:180,y:350,col:12,scale:3,o:4}),this.g.sfxPlay("speak")}})}confetti(){this.g.addEvent({t:this.g.H.rnd(100,300),cb:()=>{var t=this.g.H.rnd(50,this.g.w-50),i=this.g.H.rnd(100,this.g.h-100);this.g.burst(t,i,4,5,4),this.g.sfxPlay("jump"),this.confetti()}})}update(t){this.o<.5&&(this.o+=t/10),this.g.ents.forEach((i=>{i.update(t)})),this.g.input.click&&this.canSwitch&&this.g.changeState("Title")}render(){var t=this.g;t.draw.clear(14),t.draw.rect(0,430,t.w,t.h,11),t.draw.text("YOU",this.mainText,!1,70),t.draw.text("WIN",this.mainText,!1,120),t.draw.img(t.imgs.cat,20,400,5),t.draw.img(this.cat2,250,400,5),this.g.ents.forEach((t=>{t.render()}))}}},e.ents={Sprite:r,Witch:class extends r{constructor(t,i){i.group="player",i.i="witch",i.collidesWith=["baddies","firefly","cat","door"],i.scale=3,i.frames=3,super(t,i),this.g=t,this.o=i,this.anims={fly:{frames:[3],rate:.025},stand:{frames:[2,2,2,1],rate:.3}},this.changeAnim("stand"),this.gravity=t.data.gravity,this.maxCharge=100,this.chargeRate=2,this.charge=this.maxCharge,this.vx=2,this.maxVy=2,this.minVy=3,this.hide=!0,this.broom=t.draw.resize(t.imgs.broom,this.scale),this.broom2=t.draw.flip(this.broom,1,0),this.hairColor=t.H.rndArray([2,8,4,15,7]),(window.W=this).reset()}reset(){if(this.hide){var t=this.g;this.vy=0,this.x=t.w/2,this.g.viewport.y=0,this.y=this.convY(this.g.h-50),this.isStanding=!1,this.flip.y=0,this.dead=!1,this.hide=!1,this.falling=!1,this.hair=[];let i=6;for(;i;)this.hair.push({x:this.x,y:this.y,s:i}),i--}}update(t){super.update(t),this.isStanding=!1,this.ledge=!1;var i=this.g.input.keys,s=(i.click,(i.l||i.r)&&0<this.charge);this.vy-=this.gravity/4*t,this.falling||this.y<this.h?(this.y=~~(this.y+this.vy),this.y-this.h<this.g.viewport.y&&!this.dead&&this.kill()):(this.vy>this.maxVy&&(this.vy=this.maxVy),this.vy<-this.minVy&&(this.vy=-this.minVy),this.checkStanding(),this.bindToScreen(),this.handleInput(s,i.l,i.r),this.y=~~(this.y+this.vy),this.ledge&&this.ledge.vx&&(this.x+=this.ledge.vx),this.isStanding?(this.changeAnim("stand"),this.charge=this.charge<this.maxCharge?this.charge+this.chargeRate:this.charge):(s&&(this.charge-=.5,!this.g.chromobile)&&0<Math.abs(this.vy)&&.95<Math.random()&&(t=this.flip.x?this.x+1.5*this.w:this.x-1.5*this.w,this.g.sfxPlay("jump"),this.g.spawn("Spark",{x:t,y:this.y-this.h,vx:this.flip.x?2:-2})),this.changeAnim("fly")),this.g.viewport.y=this.y-this.g.h/2,this.g.viewport.y<0&&(this.g.viewport.y=0),this.g.viewport.y>this.g.viewport.world.h-this.g.h&&(this.g.viewport.y=this.g.viewport.world.h-this.g.h))}render(){if(!this.hide){let s=8,h=this.flip.x?0:-2,e=0<=this.vy?-1:1,a=(this.g.draw.circle(this.x+h,this.convY(this.y-this.h/2),s,this.hairColor),{x:this.x,y:this.y});var t,i;this.g.chromobile||this.hair.forEach(((t,i)=>{s--,t.x+=(a.x-t.x)/1.5,t.y+=(a.y+e-t.y)/1.3,this.g.draw.circle(t.x+h,this.convY(t.y-this.h/2),s,this.hairColor),a=t})),"fly"===this.anim.name&&(t=this.flip.x?this.broom2:this.broom,i=this.flip.x?this.w+-20:-16,this.g.draw.img(t,this.x+i,this.convY(this.y-this.h+10))),super.render()}}handleInput(t,i,s){t&&(this.y+=1,this.isStanding,this.vy+=.06),i?(this.x-=this.vx*!this.isStanding,this.flip.x=1):s&&(this.x+=this.vx*!this.isStanding,this.flip.x=0)}bindToScreen(){var t;this.isStanding||(t=this.g,this.x<0&&(this.x=0),this.x>t.w-this.w&&(this.x=t.w-this.w),this.y>this.g.viewport.world.h-this.h&&(this.y=this.g.viewport.world.h-this.h,this.vy=0))}checkStanding(){const t=this.g;this.isStanding||t.ents.forEach((i=>{var s;"Ledge"===i.constructor.name&&this.hit(i)&&this.vy<0&&(this.vy<=-1.5&&(s=t.viewport.convY(this.y)+this.g.viewport.y,t.burst(this.x,s+this.h,1,3),t.sfxPlay("land")),this.vy=0,this.y=i.y-1,this.isStanding=!0,this.ledge=i)}))}receiveDamage(t){if(!this.dead){var i,s=this.g;switch(t.group){case"cat":t.owner||(s.sfxPlay("hit"),s.spawn("Demon",{p:this.p}),0===(t.owner=this).p.sess.level&&this.g.spawn("Text",{y:300,text:"ESCAPE TO BOTTOM",col:7,o:5,scale:3}));break;case"door":t.open&&(this.p.levelComplete(),this.hide=!0);break;case"firefly":t.kill();break;case"baddies":this.falling||(i=s.viewport.convY(this.y)+this.g.viewport.y,this.falling=!0,s.sfxPlay("hit"),s.spawn("Boom",{x:this.x,y:i+this.h/2}),this.changeAnim("stand"),this.vy+=.5,this.flip.y=1)}}}kill(){!0!==this.dead&&(this.dead=this.remove=!0,this.g.sfxPlay("fin"),this.p.sess.lives--,this.p.sess.lives<0?this.g.changeState("Gameover"):this.g.addEvent({t:70,cb:()=>{this.p.nextLevel()}}))}},Ledge:class extends r{constructor(t,i){i.group="ledge",i.scale=4,i.h=8,i.b=i.b||0,i.col=i.col||14,i.range=i.range||200,i.vx&&(i.vx/=4),i.vy&&(i.vy/=4),super(t,i),1===i.b?this.g.spawn("Spider",{x:this.x,y:this.y,l:this}):2===i.b?this.g.spawn("Biter",{x:this.x,y:this.y,l:this}):3===i.b?(this.g.spawn("Spider",{x:this.x,y:this.y,l:this}),this.g.spawn("Biter",{x:this.x,y:this.y,l:this})):7===i.b&&(this.p.cat=this.g.spawn("Cat",{x:this.x,y:this.y})),this.collidesWith=["player"]}update(t){super.update(t),this.vx&&(this.x+=this.vx),this.vy&&(this.y+=this.vy,this.y>this.o.y+this.range||this.y<=this.o.y)&&(this.vy*=-1),(this.x+this.w>this.g.w||this.x<=0)&&(this.vx*=-1)}render(){var t=this.g.viewport.convY(this.y)+this.g.viewport.y,i=this.h/2;this.g.imgs["circle_1_"+this.col],this.g.draw.circle(this.x-i,t+3.5*this.h,0+i,this.col),this.g.draw.circle(this.x+this.w-3,t+3.5*this.h,0+i,this.col),this.g.draw.rect(this.x,t+3*this.h,this.w,this.h,this.col),this.g.draw.rect(this.x,t+3*this.h,this.w,2,0,.2)}},Bat:class extends r{constructor(t,i){i.frames=2,i.scale=i.s||3,i.i="bat",i.group="baddies",super(t,i),this.anims={fly:{frames:[1,2],rate:.3}},this.changeAnim("fly"),this.vx=1,window.B=this}update(t){super.update(t),(this.x<0||this.x>this.g.w-this.w)&&(this.vx*=-1),this.x+=this.vx,this.flip.x=0<this.vx?1:0}},Biter:class extends r{constructor(t,i){i.frames=2,i.scale=2,i.i="biter",i.group="baddies",super(t,i),this.y=i.y-this.h/2,this.minX=i.l.x,this.maxX=i.l.x+i.l.w-this.w,this.vx=.5,this.anims={bite:{frames:[1,2],rate:.25}},this.changeAnim("bite")}update(t){super.update(t),this.x+=this.vx,(this.x<this.minX||this.x>this.maxX)&&(this.vx*=-1,this.flip.x=!this.flip.x)}},Spitter:class extends r{constructor(t,i){i.frames=1,i.scale=2,i.i="spitter",i.group="baddies",super(t,i),(this.x=0)!==i.x&&(this.x=this.g.w-this.w,this.flip.x=!0),this.spit(),this.hasEvent=!1}spit(){var t;this.hasEvent||(this.hasEvent=!0,t=this.g.H.rnd(300,600),this.g.addEvent({t:t,cb:()=>{this.spit(),this.hasEvent=!1,this.g.spawn("Fireball",{p:this.p,x:this.x,y:this.y})}}))}render(){super.render(),this.g.draw.rect(this.x+this.w/2,this.convY(this.maxY),1,this.maxY-this.y,1)}},Spike:class extends r{constructor(t,i){i.frames=1,i.scale=2,i.i="spike",i.group="baddies",super(t,i),(this.x=0)!==i.x&&(this.x=this.g.w-this.w,this.flip.x=!0)}},Fireball:class extends r{constructor(t,i){i.frames=1,i.scale=2,i.i="fireball",i.group="baddies",super(t,i),this.y-=this.h/2,i.x<=0?this.vx=2:(this.flip.x=!0,this.vx=-2)}update(t){super.update(t),this.x+=this.vx,(this.x>this.g.w+this.w||this.x<0)&&(this.remove=!0)}},Firefly:class extends r{constructor(t,i){i.frames=2,i.scale=4,i.i="firefly",i.group="firefly",super(t,i),this.speed=120,this.anims={fly:{frames:[1,2],rate:.3}},this.changeAnim("fly"),this.vx=1,this.vy=.5}update(t){super.update(t),(this.x<0||this.x>this.g.w-this.w)&&(this.vx*=-1),(this.y<0||this.y>this.p.floor-this.h)&&(this.vy*=-1),this.x+=this.vx,this.y+=this.vy}},Demon:class extends r{constructor(t,i){i.frames=2,i.scale=3,i.i="demon",i.group="baddies",super(t,i),this.speed=120,this.anims={fly:{frames:[1,2],rate:.3}},this.changeAnim("fly"),this.vx=.5,this.vy=.75,this.x=t.H.rnd(0,1)?0:t.w-this.h,this.y=this.p.tower.h+50,this.body=[];for(let t=0;t<7;t+=1)this.body.push({x:this.x,y:this.y})}update(t){var i=this.p.p1;this.p.tower.fin||(super.update(t),this.x>i.x&&(this.x-=this.vx,this.flip.x=1),this.x<i.x&&(this.x+=this.vx,this.flip.x=0),this.y>i.y&&(this.y-=this.vy),this.y<i.y&&(this.y+=this.vy))}render(){let t={y:this.y-this.h/2,x:this.x};this.g.chromobile||this.body.forEach(((i,s)=>{i.x+=(t.x-i.x)/6,i.y+=(t.y+1-i.y)/6,s=s%2?7:3,this.g.draw.circle(i.x,this.convY(i.y),10,s),t=i})),super.render()}},Cat:class extends r{constructor(t,i){i.frames=1,i.scale=2,i.i="cat",i.group="cat",super(t,i),this.speed=120,this.anims={o:{frames:[1],rate:.3}},this.changeAnim("o"),this.owner=!1,this.y-=this.h,this.oX=this.x,this.oY=this.y}reset(){this.owner=!1,this.x=this.oX,this.y=this.oY}update(t){this.owner?(this.x=this.owner.flip.x?this.owner.x+this.w:this.owner.x-this.w,this.flip.x=this.owner.flip.x,this.y=this.owner.y-this.h/2,this.owner.isStanding&&(this.x=this.owner.x,this.y=this.owner.y+this.h/3)):.99<Math.random()&&(this.flip.x=!this.flip.x)}render(){this.owner&&this.owner.hide||super.render()}},Spider:class extends r{constructor(t,i){i.frames=1,i.scale=2,i.i="spider",i.group="baddies",i.range=100,super(t,i),this.y=i.y-4*this.h,this.maxY=this.y,this.minY=this.y+-i.range,this.vy=-.2,this.x=t.H.rnd(i.l.x+20,i.l.x+i.l.w-20),this.y=t.H.rnd(this.minY,this.maxY)}update(t){.99<Math.random()&&(this.flip.x=!this.flip.x),this.y+=this.vy,(this.y<this.minY||this.y>this.maxY)&&(this.vy*=-1)}render(){super.render(),this.g.draw.rect(this.x+this.w/2,this.convY(this.maxY),1,this.maxY-this.y,1)}},Door:class extends r{constructor(t,i){i.group="door",i.i="door",i.scale=4,i.y=82,super(t,i),this.x=t.w/2-this.w/2,this.open=!1,this.pulse=0,this.torch0=this.g.imgs.torch,this.torch1=this.g.draw.flip(this.torch0,1,0)}update(t){this.pulse=Math.sin(.002*(new Date).getTime())}render(){var t,i,s,h;this.hit(this.g.viewport)&&(t=this.open?11:0,i=this.convY(this.y),s=.2<Math.abs(this.pulse/2)?this.torch0:this.torch1,h=i-3-this.pulse,this.g.draw.rect(this.x,i+8,this.w,this.h-8,t),this.open&&this.g.draw.rect(this.x,i+8,this.w,this.h-8,2,Math.abs(this.pulse)),this.g.draw.circle(this.x-24,10+h,7,1,.3),this.g.draw.img(s,this.x-20,i,2),this.g.draw.circle(this.x+46,10+h,7,1,.3),this.g.draw.img(s,this.x+50,i,2),super.render())}},Boom:class{constructor(t,i){i.col=i.col||2,this.g=t,this.i=t.draw.color(t.imgs.circle,t.data.pal[i.col]),this.startX=i.x,this.startY=i.y,this.magnitude=i.m||4,this.scale=1,this.factor=i.factor||.5}update(t){this.g,this.scale+=this.factor,this.scale>this.magnitude&&0<this.factor&&(this.factor*=-1),this.scale<=1&&(this.remove=!0)}render(){var t=this.i.width*this.scale/2,i=this.startX-t;t=this.startY-t;this.g.draw.img(this.i,i,t,this.scale)}},Particle:class{constructor(t,i){this.g=t,this.o=i,this.x=i.x,this.y=i.y,this.w=i.w||3,this.h=this.w,this.vx=i.vx||t.H.rnd(-40,40),this.vy=i.vy||-1*t.H.rnd(50,80),this.col=i.col||6,this.r=i.r||1,this.i=t.imgs[`${i.img}_${this.w}_`+this.col],this.ttl=200}update(t){--this.ttl,this.vy+=.15*this.g.data.gravity,this.x+=this.vx*t,this.y+=this.vy*t,(this.y>this.o.y||this.ttl<0)&&(this.remove=!0)}render(t){this.g.viewport.convY(this.y),this.g.viewport.y,this.y,this.g.draw.circle(this.x,this.y,this.w/2,this.col)}},Spark:class extends r{constructor(t,i){i.cols=[7,8,3],i.size=t.H.rnd(3,6),i.size=8,i.vy=.3,i.tick=0,super(t,i),this.vx/=2,this.col=this.cols[this.size-2]||this.g.H.rndArray(this.cols),this.ttl=75}update(t){this.ttl--,this.ttl<0&&(this.remove=!0),this.tick+=1,this.tick%25==0&&1<this.size&&--this.size,this.x+=this.vx,this.y-=this.vy}render(){var t;this.size<1||(this.col=1,t=this.size/10/2,this.g.draw.ring(this.x,this.convY(this.y),this.size,this.col,3,t))}},Text:class extends r{constructor(t,i){for(var s in i.group="text",i.w=10,i.w=10,i.o=i.o||1,i.scale=i.scale||2,i.col=i.col||1,i.fade=i.fade||.01,super(t,i),i)this[s]=i[s];this.g=t,this.p=t.H.mkFont(t,i.scale,i.col)}update(t){(this.y<0||this.o<0)&&(this.remove=!0),this.o-=this.fade}render(){var t;this.o<0||((t=this.g.draw).ctx.globalAlpha=this.o,t.text(this.text,this.p,this.x,this.y),t.ctx.globalAlpha=1)}}},e.Sfx=(t=1,i=.05,s=220,h=0,e=0,a=.1,r=0,o=1,c=0,A=0,l=0,d=0,g=0,x=0,w=0,p=0,m=0,y=1,v=0,f=0,u=Math,b=44100,E=2*u.PI,B=(c*=500*E/b/b),L=(s*=(1-i+2*i*u.random(i=[]))*E/b),k=0,S=0,I=0,T=1,O=0,H=0,D=0,C,R)=>{for(A*=500*E/b**3,w*=E/b,l*=E/b,d*=b,g=b*g|0,R=(h=b*h+9)+(v*=b)+(e*=b)+(a*=b)+(m*=b)|0;I<R;i[I++]=D)++H%(100*p|0)||(D=r?1<r?2<r?3<r?u.sin((k%E)**3):u.max(u.min(u.tan(k),1),-1):1-(2*k/E%2+2)%2:1-4*u.abs(u.round(k/E)-k/E):u.sin(k),D=(g?1-f+f*u.sin(E*I/g):1)*(0<D?1:-1)*u.abs(D)**o*.3*t*(I<h?I/h:I<h+v?1-(I-h)/v*(1-y):I<h+v+e?y:I<R-m?(R-I-m)/a*y:0),D=m?D/2+(I<m?0:(I<R-m?1:(R-I)/m)*i[I-m|0]/2):D),k+=(C=(s+=c+=A)*u.cos(w*S++))-C*x*(1-1e9*(u.sin(I)+1)%2),T&&++T>d&&(s+=l,L+=l,T=0),!g||++O%g||(s=L,c=B,T||=1);return(t=n.createBuffer(1,R,b)).getChannelData(0).set(i),(s=n.createBufferSource()).buffer=t,s.connect(n.destination),s.start(),s},new function(e={}){var a,r={w:320,h:480,orientation:"portrait"},n=navigator.userAgent.toLowerCase();for(a in this.android=-1<n.indexOf("android"),this.ios=/ipad|iphone|ipod/.test(n),this.mobile=this.android||this.ios,this.firefox=-1<n.indexOf("firefox"),this.chrome=-1<n.indexOf("chrome"),this.chromobile=this.mobile&&this.chrome,r)this[a]=r[a];return this.o=Object.assign(r,e),this.data=e,this.dt=0,this.fps=60,this.frameStep=1/this.fps,this.frameCurr=0,this.framePrev=s.timeStamp(),this.stateName=e.start,this.H=s,this.states=e.states,this.availEnts=e.ents,this.score=0,this.hiScore=20,this.plays=0,this.ents=[],this.imgs=[],this.fonts=[],this.events=[],this.transition=!1,this.H=s,this.Sfx=e.Sfx,(window.G=this).init=function(){var e=new t(this.o.i);document.title=this.o.title,this.canvas=new i(this.o.w,this.o.h),this.draw=new class{constructor(t,i,s,h=0){this.pal=s,this.c=t,this.ctx=i}clear(t){t=this.pal[t],this.ctx.fillStyle=`rgb(${t[0]},${t[1]},${t[2]})`,this.ctx.fillRect(0,0,this.c.width,this.c.height)}rect(t,i,s,h,e,a){a&&(this.ctx.globalAlpha=a),e=this.pal[e],this.ctx.fillStyle=`rgb(${e[0]},${e[1]},${e[2]})`,this.ctx.fillRect(~~t,~~i,s,h),a&&(this.ctx.globalAlpha=1)}img(t,i,s,h=!1,e=!1){e&&(this.ctx.globalAlpha=e),h&&(t=this.resize(t,h)),this.ctx.drawImage(t,~~i,~~s),e&&(this.ctx.globalAlpha=1)}circle(t,i,s,h,e=!1){e&&(this.ctx.globalAlpha=e),h=this.pal[h],this.ctx.fillStyle=`rgb(${h[0]},${h[1]},${h[2]})`,this.ctx.beginPath(),this.ctx.arc(~~t+s,~~i,~~s,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),e&&(this.ctx.globalAlpha=1)}ring(t,i,s,h,e=2,a=!1){a&&(this.ctx.globalAlpha=a),h=this.pal[h],this.ctx.strokeStyle=`rgb(${h[0]},${h[1]},${h[2]})`,this.ctx.lineWidth=e,this.ctx.beginPath(),this.ctx.arc(~~t+s,~~i,~~s,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.stroke(),a&&(this.ctx.globalAlpha=1)}triangle(t,i,s,h,e,a=!1){a&&(this.ctx.globalAlpha=a),e=this.pal[e],this.ctx.fillStyle=`rgb(${e[0]},${e[1]},${e[2]})`,(e=new Path2D).moveTo(t,i),e.lineTo(t+s/2,i-h),e.lineTo(t+s,i),this.ctx.fill(e),a&&(this.ctx.globalAlpha=1)}flip(t,i,h){var e=s.mkCanvas(t.width,t.height),a=e.getContext("2d"),r=i?-1:1,n=h?-1:1;return i=i?-1*t.width:0,h=h?-1*t.height:0,e.width=t.width,e.height=t.height,a.save(),a.scale(r,n),a.drawImage(t,i,h,t.width,t.height),a.restore(),e}resize(t,i){var h=s.mkCanvas(t.width*i,t.height*i),e=h.getContext("2d");return h.width&&(e.save(),e.scale(i,i),e.drawImage(t,0,0),e.restore()),h.scale=i,h}color(t,i){var h=s.mkCanvas(t.width,t.height),e=h.getContext("2d");let a,r=0;for(e.drawImage(t,0,0),a=e.getImageData(0,0,t.width,t.height),r=0;r<a.data.length;r+=4)a.data[r+0]=i[0],a.data[r+1]=i[1],a.data[r+2]=i[2];return e.putImageData(a,0,0),h}textWidth(t,i){return t.length*(3*i.scale)+t.length*+i.scale}text(t,i,s,h){let e=0,a=this.ctx,r=0,n=3*i.scale,o=5*i.scale,c=+i.scale,A=this.textWidth(t,i),l=0;var d="0123456789".split("");for("number"!=typeof t&&"0"!==t[0]||(t+="",r=43),s=s||(this.c.width-A)/2,e=0;e<t.length;e+=1)r="number"==typeof t[e]||"0"===t[e]||-1!==d.indexOf(t[e])?43:0,l=(t.charCodeAt(e)-65+r)*(n+c),"?"===t[e]&&(l=144),":"===t[e]&&(l=148),-1<(l="%"===t[e]?152:l)&&a.drawImage(i,l,0,n,o,~~s,~~h,n,o),s+=n+c}}(this.canvas.c,this.canvas.ctx,this.o.pal,this.mobile),this.input=new h(this.canvas.c,this.g),this.viewport={w:this.w,h:this.h,world:{h:this.h,w:this.w},x:0,y:0,maxY:0,init:function(t){this.world.h=t,this.maxY=t-this.h,this.y=0},convY:function(t){return~~(this.h-t)},move:function(t){this.y+=t,this.y<0&&(this.y=0),this.y>this.maxY&&(this.y=this.maxY)}},e.start().then((t=>{this.imgs=t,this.makeFonts(this.imgs.font),document.getElementById("l").style.display="none",this.changeState(this.stateName),this.canvas.c.style.display="block",this.favIcon(this.draw.resize(this.imgs.cat,8)),this.loop()}))},this.makeFonts=function(t){let i=12;for(;1<i--;)this.imgs["font_"+i]=this.draw.resize(t,i)},this.favIcon=function(t){var i=document.createElement("canvas"),s=i.getContext("2d"),h=document.createElement("link");i.width=i.height=64,s.drawImage(t,0,0),h.type="image/x-icon",h.rel="shortcut icon",h.href=i.toDataURL("image/x-icon"),document.getElementsByTagName("head")[0].appendChild(h)},this.sfxPlay=function(t){this.ios||this.Sfx(...this.data.sfx[t])},this.changeState=function(t){this.ents=[],this.events=[],this.state=new this.states[t](this),this.input.resetKeys(),this.state.init(),this.transition=!1},this.loop=function(){for(this.frameCurr=s.timeStamp(),this.dt=this.dt+Math.min(1,(this.frameCurr-this.framePrev)/1e3);this.dt>this.frameStep;)this.dt=this.dt-this.frameStep,this.update(this.frameStep);this.render(this.dt),this.framePrev=this.frameCurr,requestAnimationFrame((()=>this.loop()))},this.update=function(t){this.fader=Math.sin(.005*(new Date).getTime()),this.runEvents(t),this.state.update(t);let i=this.ents.length;for(;i--;)this.ents[i].remove&&this.ents.splice(i,1);this.state.update(t)},this.render=function(t){this.state.render(t)},this.spawn=function(t,i){return t=new this.availEnts[t](this,i),this.ents.push(t),t},this.burst=function(t,i,s,h,e=3){for(;h--;)this.ents.push(new this.availEnts.Particle(this,{x:t,y:i,col:s,w:e}))},this.addEvent=function(t){this.events.push(t)},this.runEvents=function(t){this.events.forEach(((i,s)=>{i.t-=100*t,i.t<0&&(i.cb.call(this),this.events.splice(s,1))}))},this}(e).init()})()</script>