<!doctype html><title>Go Home - js13kGames 2025</title><meta name=viewport content="width=device-width"><style>body,html{margin:0;height:100%;background:#000}canvas{display:block;width:100%;height:100%}#l{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#111;color:#fff;font-size:1.2rem;z-index:9999;opacity:1;transition:opacity var(--fade-time, 1s) ease}#l.hidden{opacity:0;pointer-events:none}.s{width:50px;height:50px;border:6px solid #444;border-top:6px solid #fff;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px}@keyframes spin{to{transform:rotate(360deg)}}.b{width:200px;height:10px;background:#333;border-radius:5px;overflow:hidden;margin-bottom:10px}.p{width:0%;height:100%;background:#0f0;transition:width .2s ease}.t{letter-spacing:2px}</style><div id=l><div class=s></div><div class=b><div class=p></div></div><div class=t>0%</div></div><canvas id=a></canvas><script>!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t={state:0,sound:0,title:"#go home#",wwid:0,whei:0,tileW:300,theme:{surC:["5E6287","8E5F29","5E6287","8E5F29","5E6287"],f:[["eacdc5"],["010101"],["f4be82"],["f3eae0"],["a3a6bf"]],cats:[["010101","696969","ffee00"],["f4be82","a1550a","50b100"],["f3eae0","9b9085","003ca5"],["a3a6bf","60566d","ffffff"],["eacdc5","c7705a","633500"]],i:[["410100","c3625e","ff4840"],["010101","c9ebdb","a2beb1"],["412200","c3955e","ffa840"],["8f8d91","a4a2a7","cecad4"],["003541","007b96","40dcff"]]},ig:[],ic:[],f:{},tileTable:{},item:[],cats:[],transOn:0,ti:0,msg:["a careful first step\na familiar sound ahead\n is mommy meow###","brave even in darkness\neach fall\n rise again\n:want to go home","their voice calls you\nrun faster now\nTheir hand reaches out\nThey hold you tight##\nmeow","the scent leads you on\ncrossed the cold puddle\nwent around the wall\ncloser to warmth home","\nthank you for playing this game\n meow# meow# meow#","\n\nhome\n at last::\nbut \nmore cats \nawait black cat help##"],ltip:[":push right key","#color#","there is a cat food here\ncan reset to zero","avoid tree holes of\n #same color#","hidden num is important","cats can be #stacked#","hit the wall may be an opportunity","make good use of tree holes \n height differences","cat food is a sign to go home\nblack x block the way","llurulurru\nnow u need think by urself","haha this level\ni have try 10 time\nu should find by urself","black change is behind tile\nchange twice\nsend black cat to home",":watch the hidden num 5\nlddul##\ni talk too much","##no hint for you##\n think twice","magic change\nmeow# meow# meow#","here have some bug\n wish u can find it","hihi### play with arrow key\nwelcome to the world of cats#\nthe clever black cat \nneeds to help the other cats\nreturn to their home\nyou must use your wisdom \nto lead all the cats back home\ncats only react to\n same color item\npay attention\nto the number of steps\nless than 13","falling is cute\nrising is cooler##\n\nhere tips:\n"],cmsg:["MEOW","i am home","OOPS TOO HIGH","NO WAY","OTHER CATS","magic change","MEWWWOWW","yummy yummy","Mmm too dark","left "],restartLevel:1,levelcleared:0,level:0,maxLevel:15,mapLevel:[{0:[[[0,1],[16,2],[1,1]],[[16,1],[0,1],[0,1]]],2:[[0,0,1,1]],3:10},{0:[[[26,1],[12,2],[1,2]],[[0,1],[11,1],[0,1]]],2:[[0,1,1,1]],3:10},{0:[[[0,3],[0,3],[1,2]],[[16,2],[16,1],[11,2]],[[6,2],[11,1],[11,1]]],2:[[1,1,1,1]],3:11},{0:[[[12,3],[1,3],[0,1]],[[0,2],[0,2],[0,2]],[[0,1],[0,2],[0,1]]],1:[[1,1,3,1],[2,0,2,1]],2:[[2,2,1,1]],3:8},{0:[[[0,1],[6,3],[0,2],[0,1]],[[0,2],[0,3],[0,2],[0,1]],[[0,3],[16,3,8],[0,1]],[[1,4],[16,1,8],[0,1],[0,2]]],1:[[1,1,4,1]],2:[[1,3,1,1]]},{0:[[[2,2],[1,2]],[[0,3],[0,1]],[[21,2],[0,1]],[[0,1],[0,1]]],2:[[0,3,1,2],[1,3,1,1]],3:3},{0:[[[22,3],[2,3],[1,5]],[[0,1],[12,3],[0,1]],[[0,2],[12,3],[0,2]]],2:[[0,2,2,1],[2,2,2,2]]},{0:[[[6,1],[0,3],[0,1]],[[0,2],[0,2],[22,1]],[[2,1],[12,2],[0,2]],[[1,3],[0,1],[0,1]]],1:[[1,1,3,1],[2,2,3,1]],2:[[2,0,1,1],[1,3,1,2]],3:3},{0:[[[0,3],[0,2],[8,4],[0,4]],[[1,4],[0,1],[0,3],[11,3]],[[0,1],[13,3],[0,2],[0,1]],[[0,2],[16,3,2],[3,1],[0,3]]],2:[[0,3,2,1],[3,3,3,3]]},{0:[[[1,5],[0,3],[3,2],[0,3]],[[2,3],[0,1],[0,2],[23,2]],[[0,3],[11,2],[0,2],[8,1]],[[0,2],[0,4],[0,2],[0,2]],[[0,1],[0,1],[0,2],[0,3]]],1:[[2,2,3,1],[3,0,4,3]],2:[[3,4,3,1],[3,4,4,2],[3,4,5,3]]},{0:[[[0,1],[15,4],[11,1],[1,5],[5,4]],[[0,1],[15,3],[11,1],[4,3],[0,3]],[[0,2],[14,2],[11,1],[0,2],[0,2]],[[0,3],[15,1],[11,1],[11,1]]],2:[[0,0,1,1],[0,1,1,5],[0,3,3,4]],3:1},{0:[[[10,5],[0,1],[0,3],[21,1],[5,4]],[[0,4],[0,1],[0,1],[0,1],[0,3]],[[0,3],[0,1],[0,1],[0,1],[1,1]],[[0,2],[0,1],[0,1],[0,1],[2,1]]],1:[[2,0,4,1],[2,1,2,1],[2,2,2,1],[2,3,2,1],[3,2,2,2],[3,3,2,2]],2:[[0,3,2,1],[1,3,1,2],[4,3,1,5]]},{0:[[[0,3],[3,4],[1,3],[2,1],[6,4]],[[0,1],[9,1],[4,1],[0,1],[0,2]],[[0,2],[19,1,5],[0,2],[0,1],[13,1]],[[0,2],[12,1],[11,1],[0,2],[16,1,5]]],2:[[1,3,1,4],[0,3,2,2],[3,0,1,3],[4,3,1,1]]},{0:[[[21,1],[16,1],[18,2],[1,3],[2,3]],[[12,3],[17,1],[18,1],[17,1],[17,1]],[[11,2],[11,3],[11,3],[11,1],[11,3]],[[19,1],[3,1],[16,3],[16,1],[4,1]],[[19,1],[16,2],[16,1],[24,1],[16,1]],[[23,1],[19,1],[14,3],[16,2],[9,1]]],2:[[1,5,1,4],[0,2,2,2],[3,0,3,3],[4,3,1,1]],3:2},{0:[[[25,5],[5,5],[1,5],[3,5],[4,5]],[[0,4],[0,4],[0,4],[23,4],[2,4]],[[0,3],[0,2],[0,3],[0,3],[22,3]],[[0,2],[0,2],[21,2],[0,2],[0,2]],[[0,1],[0,1],[0,1],[0,1],[0,1]]],2:[[0,4,1,4],[1,4,1,3],[2,4,1,2],[3,4,1,1],[4,4,1,5]],3:2},{0:[[[7,3],[11,1],[12,1],[10,1],[21,2]],[[0,2],[11,1],[12,1],[13,1],[0,1]],[[15,2],[11,1],[12,1],[13,1],[25,1]],[[14,2],[14,1],[14,1],[13,1],[0,1]],[[11,2],[11,1],[9,1],[0,1],[6,1]],[[13,2],[17,1],[8,2],[0,3],[1,1]],[[13,3],[4,1],[5,1],[2,3],[3,3]]],1:[[1,3,2,1],[4,3,2,4]],2:[[0,1,2,1],[0,2,2,2],[0,0,4,3],[0,0,3,4],[4,1,1,5]]}],prevMap:[],memap:{},moves:{37:[-1,0],38:[0,-1],39:[1,0],40:[0,1]},mbtn:{t:0,x:0,y:0,w:0,h:0},btn:[],g:0,ac:null},e=Math,s=e.PI,i=(t,e)=>t>e?t:e,h=(t,e)=>t<e?t:e,n=t=>e.random()*t,o=(t,e)=>({x:t,y:e}),a=(e,s)=>(e-s)*t.tileW/2,r=(e,s)=>(e+s)*t.tileW/4,l=t=>e.floor(t),c=t=>e.abs(t),m=t=>e.sign(t),p=(t,s)=>{var i=parseInt(t,16),h=e.round(2.55*s),n=(i>>16)+h,o=(i>>8&255)+h,a=(255&i)+h;return"#"+(16777216+65536*(n<255?n<1?0:n:255)+256*(o<255?o<1?0:o:255)+(a<255?a<1?0:a:255)).toString(16).slice(1)},d=localStorage,f=t=>d.getItem(t),u=document,y=t=>u.createElement("canvas"),g=t=>t.getContext("2d"),w=(t,e=32,s=32)=>(t.width=e,t.height=s,t),v=t=>new Image,x=t=>t.toDataURL(),b=u.getElementById("a"),k=g(b),T=(t,e,i,h,n,o=.5,a=0,r=0,l=0)=>{k.save();const c=l?10*Math.sin(r):0;if(k.translate(h+e,n+c),l){const t=a||Math.cos(r);k.scale(t,.5);const e=.6+.4*Math.sin(r);k.fillStyle="#666",k.beginPath(),k.ellipse(0,.4*i,.2*i*e,.15*i*e,0,0,2*s),k.fill()}else k.scale(1,o),k.rotate(s/4);k.drawImage(t,-i/2,-i/2,i,i),k.restore()};class P{constructor(t,e,s=o(0,0)){this.x=t,this.y=e,this.wh=s}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}substractY(t){return this.y-=t,this}substractX(t){return this.x-=t,this}dot(t){return this.x*=t,this.y*=t,this}devide(t){return this.x/=t,this.y/=t,this}multiply(t){return this.x*=t,this.y*=t,this}clone(){return new P(this.x,this.y,this.wh)}setX(t){return this.x=t,this}setY(t){return this.y=t,this}tranisoXY(){const t=a(this.x,this.y);return this.y=r(this.x,this.y),this.x=t,this}toData(){return{__class:"Vector",x:this.x,y:this.y,wh:this.wh}}static fromData(t){return new P(t.x,t.y,t.wh)}}let I,W=null,O=[],S=!1,E=0;const M=44100,$=["sawtooth","square","triangle","sine"],D=Array.from({length:50},(t,e)=>130.81*Math.pow(2,e/12)),L=["t","t","b","b","b","t","t","b","b"],A=[[0,13,15,17,20,22],[0,17,19,21,24,26],[0,20,22,24,27,29],[0,24,26,28,31,33],[0,27,29,31,34,36]],_={t:[[2,.4,.3,[[0,1,3,4,5,7,8,10,12]],[0,1,0,2,2,0,3,1,0,5,0,4,3,1,0,0,3,3,0,4,4,0,2,0,1,1,0,5,0,4,3,1,0,0,3,3,0,4,4,0,2,0,1,1,0,5,0,4,3,0,1,2,0,0],.2,.01],[3,.8,1,A,[0,0,2,2,0,3,0,3,0,0,2,0,0,3,0,1,0,0],.1,0]],b:[[2,.3,.3,[[0,1,3,4,5,7,8,10,12]],[0,0,0,1,0,2,0,0,2,3,4,5,0,0,5,4,3,0,0,2,2,0,1,0,1,1,0,3,0,5,4,0,5,4,3,0,0,1,1,0,2,0,2,3,0,0,3,4,5,0,5,4,0,0],.2,.01],[3,.6,1,A,[0,0,4,0,0,3,0,2,0,0,2,0,0,3,0,1,0,0],.1,0]]};async function C(){return W||(W=new(window.AudioContext||window.webkitAudioContext),I=W.createGain(),I.gain.value=1,I.connect(W.destination)),"suspended"===W.state&&await W.resume(),W}function z(e){if(S||t.sound)return;S=!0,C(),O.forEach(t=>t.forEach(t=>t.stop())),O=[],e.forEach(t=>{const e=$[t[0]],s=t[4],i=t[2],h=t[1],n=t[5],o=[];let a=W.currentTime;s.forEach(s=>{t[3].forEach(r=>{const l=W.createOscillator(),c=W.createGain();l.connect(c),c.connect(I),l.type=e,l.frequency.value=D[r[s]],c.gain.setValueAtTime(0,a),c.gain.linearRampToValueAtTime(n,a+t[6]*h),l.start(a),c.gain.exponentialRampToValueAtTime(.01*n,a+i),l.stop(a+i),o.push(l)}),a+=h}),O.push(o)});const s=O[O.length-1];s[s.length-1].onended=e=>{E=(E+1)%L.length,S=!1,t.sound||z(_[L[E]])}}function R(t,e,s,i,h,n,o,a){const r=Math.floor(M*o),l=new Float32Array(r);for(let c=0;c<r;c++){const m=c/M,p=t+c/r*(e-t);let d=m<s?m/s:m<s+i?1-(m-s)/i*(1-h):m<s+i+o-n?h:h*(1-(m-s-i-o+n)/n);l[c]=d*a*Math.sin(2*Math.PI*p*m)}return l}const Y=R(D[20],D[10],.1,1,0,.5,1,.2),B=R(D[40],D[25],.1,1,0,1,.1,.1),X=R(D[5],D[16],0,.5,.8,.6,.1,.1),j=R(D[20],D[29],.5,.1,0,.1,.4,.1),N=R(D[0],D[30],1,0,.1,.5,.1,.1);async function q(e){await async function(e){if(t.sound)return;await C();let s=W.createBuffer(1,e.length,M);s.copyToChannel(e,0);let i=W.createBufferSource();i.buffer=s,i.connect(I),i.start()}(0==e?X:1==e?j:3==e?B:4==e?Y:N)}function F(t,e,s,i,h,n){return t>=s&&t<=s+h&&e>=i&&e<=i+n}class H{constructor(t=1,e=0){this.set(0,1,t),this.l=e,this.e=0}set(t,e,s){this.s=t,this.et=e,this.step=s}curTime(){return performance.now()}add(){this.s+=this.step}sub(){this.s-=this.step}clone(){return new H(this.step,this.l)}reset(){this.s=0,this.e=0}start(){this.s<this.et?this.add():(this.e=1,this.l&&this.reset())}get progress(){return h(this.s/this.et,1)}}class U{constructor(t,e,s=0,i=0){this.x=t,this.y=e,this.t=i,this.timer=new H(1/30),this.idlet=this.timer.clone(),this.closet=this.timer.clone(),this.active=0,this.stop=0,this.cm(s)}reset(){this.stop=0,this.active=0,this.timer.reset(),this.idlet.reset(),this.closet.reset()}show(t,e=""){this.stop=1,this.active=1,this.timer.startTime=1,this.cm(t,e)}changeXY(e){this.x=e.x-t.tileW/25,this.y=e.y-t.tileW/15}cm(e,s=""){this.msg=t.cmsg[e]+s}update(){this.stop||n(1)>.3||((this.active?this.timer:this.idlet).start(),(this.active&&this.timer.e||!this.active&&this.idlet.e)&&(this.active=!this.active,this.timer.reset(),this.idlet.reset()))}draw(){if(this.update(),!this.active)return;let e=" "+this.msg+" ",s=t.tileW/30;const i=e.length*s+2*s,h=s+2*s,n=this.x-i/2,o=this.y-5.5*s;k.save(),k.globalAlpha=this.stop?1:this.timer.progress,k.fillStyle="#fff",k.beginPath(),k.roundRect(n,o,i,h,8),k.moveTo(this.x,this.y-s),k.lineTo(this.x-s,o+h),k.lineTo(this.x+s,o+h),k.closePath(),k.fill();let a=n+s;for(let i=0;i<e.length;i++){if(" "===e[i]){a+=s/2;continue}let h=t.f[e[i].toLowerCase()];h&&(k.drawImage(h[this.t],a,o+s,s,s),a+=s+s/3)}k.restore()}}class V{constructor(t,e,s,i,h=0,n=0,o=0,l=0){this.x=t,this.y=e,this.targetpos=new P(t,e),this.prevpos=new P(t,e),this.pos=new P(a(t,e),r(t,e)),this.spos=this.pos.clone(),this.h=h,this.n=o,this.b=l,this.k=n,this.dt=new H(1/60,1),this.timer=new H(1/60),this.speed=8,this.a=1}update(t){return this}draw(){}isMouseOver(t,e){return t>this.pos.x&&t<this.pos.x+this.pos.w&&e>this.pos.y&&e<this.pos.y+this.pos.h}resize(){this.spos=this.pos.clone(),this.prevpos=this.pos.clone()}restoreXYZ(t,e,s,i){this.x=t,this.y=e,this.h=s,this.pos=i.clone()}toData(){return{__class:"Item",x:this.x,y:this.y,h:this.h,k:this.k,n:this.n,b:this.b,pos:this.pos.toData(),targetpos:this.targetpos.toData(),prevpos:this.prevpos.toData(),spos:this.spos.toData()}}static fromData(t){let e=new V(t.x,t.y,32,32,t.h,t.k,t.n,t.b);return e.pos=P.fromData(t.pos),e.targetpos=P.fromData(t.targetpos),e.prevpos=P.fromData(t.prevpos),e.spos=P.fromData(t.spos),e}}class G extends V{constructor(t,e,s,i){super(t,e,32,32,s,i),this.keyIn={},this.moving=1,this.nextPos=null,this.home=0,this.fall=0,this.f=0,this.d=0,this.jump=0,this.dt.l=0,this.it=new H(1/150,1),this.msg=new U(t,e,0,this.k%5),this.isPa=0}getTile(e,s){return t.tileTable[`${e},${s}`]}getTunnel(e,s,i,h){return t.tileTable[`${e},${s},${i},${h}`]}planMove(){if(!this.moving){for(let e in t.moves)if(t.ac.isDown(e)&&!this.keyIn[e]){this.msg.cm(0),this.d=e-36;let s=this.x+t.moves[e][0],i=this.y+t.moves[e][1],h=this.getTile(s,i),n=this.getTile(this.x,this.y);if(!h||!n){this.isPa=1,this.msg.show(3);continue}if(h.h-this.h>1){this.isPa=1,this.msg.show(2);continue}let o=t.cats.filter(t=>t!==this&&t.x==this.x&&t.y==this.y&&!t.isPa),a=0;for(let t of o)t.h<this.h&&(h.h,t.h,h.h,a++);let r=h.h<=this.h?h.h+a:h.h;if(this.getTunnel(s,i,r+1,this.k)){this.isPa=1,this.msg.show(8);continue}let l=r-this.h;l>=1&&(this.jump=1),l<0&&(this.jump=2),0==l&&(this.jump=-1),this.nextPos={x:s,y:i,h:r}}this.keyIn={...t.ac.keyIn}}}applyMove(){if(!this.nextPos)return;let e=this.nextPos.x,s=this.nextPos.y,n=this.nextPos.h,o=n,a=t.cats.filter(t=>t!==this&&t.x==e&&t.y==s&&t.isPa),r=0;for(let t of a)t.h<=n&&this.h>t.h?(this.k,o=a.length+i(h(n,this.h-t.h),t.h)):(r=1,this.isPa=1);if(r)return this.msg.show(4),void(this.nextPos=null);this.targetpos.setX(e).setY(s),this.h=o,this.moving=1}update(){if(this.fall)this.timer.start(),this.h-=this.h*this.timer.progress,this.pos.y+=10,this.timer.e&&(t.restartLevel=1);else if(this.moving){this.msg.reset(),this.it.reset(),this.dt.start();let e=this.getTile(this.targetpos.x,this.targetpos.y);if(this.dt.progress<.3)return void(this.f=2);let s=e?e.h+t.tileW/20:0,i=this.targetpos.clone().add({x:.5,y:.5});i.tranisoXY().substractY(s+this.h*t.tileW/4.7),this.pos.add(i.clone().substract(this.pos).devide(this.speed));let h=this.dt.progress,n=[-2,-1,-2,-1],o=l(4*h);this.jump<0&&(this.jump=n[o]),this.f=2+this.jump,c(i.x-this.pos.x)<1&&c(i.y-this.pos.y)<1&&(this.pos=i.clone(),this.spos=i.clone(),this.x=this.targetpos.x,this.y=this.targetpos.y,this.moving=0,this.nextPos=null,this.f=0,this.dt.reset())}else if(this.it.start(),this.it.progress>.7){let t=this.it.progress,e=[1,0,1,0],s=l(3*t);this.d=0,this.f=e[s],this.msg.active=1}}trigger(){this.isPa=0,this.msg.changeXY(this.pos),this.msg.draw(),this.home=0;const e=this.getTile(this.x,this.y);if(e)if(e.k-e.ty==this.k)e.k>=1&&e.k<=5&&(this.home=1,this.msg.show(1)),e.k>=6&&e.k<=10&&!e.zeroBtn&&this.h==e.h&&(t.item.map(t=>0==t.k||t.k>=16&&t.k<=20||t.x==e.x&&t.y==e.y?t.resetzero():0),this.msg.show(7),q(1)),e.k>=11&&e.k<=15&&e.h==this.h&&(this.msg.show(6),t.cats.map(t=>{t.x===this.x&&t.y===this.y&&(t.fall=1,t.f=3)}),q(4),e.destory()),e.k>=16&&e.k<=20&&this.h==e.h&&(this.msg.show(9,String(i(14-e.n,0))),e.openTile());else if(e.k>=21&&e.k<=25&&this.h==e.h){let s=t.cats.find(t=>t.k==e.k-e.ty&&t!=this);if(!s)return;this.msg.show(5);let i=s.toData();s.restoreXYZ(this.x,this.y,this.h,this.pos),this.restoreXYZ(i.x,i.y,i.h,new P(i.pos.x,i.pos.y)),q(3)}}isMask(){let e=0;return t.item.some(t=>{t!==this&&t.x>=this.x&&t.x<=this.x+1&&t.y>=this.y&&t.y<=this.y+1&&t.h>this.h+1?(t.a=.3,e=1):t!==this&&1==t.b&&t.x==this.x&&t.y==this.y&&this.h+1==t.h?e=1:t.a=1}),e}draw(){k.save(),this.isMask()?k.globalCompositeOperation="overlay":k.globalCompositeOperation="source-over";const e=t.tileW/2.5;T(t.ic[this.d][this.f][this.k-1],0,e,this.pos.x,this.pos.y-e/10,1,0,0,1),k.restore()}resize(){let e=this.getTile(this.x,this.y),s=(e?.h??0)+t.tileW/20;this.pos=this.targetpos.clone().add({x:.5,y:.5}).tranisoXY().substractY(s+this.h*t.tileW/5)}toData(){return{...super.toData(),__class:"Cat",keyIn:this.keyIn,moving:this.moving,nextPos:this.nextPos,home:this.home,fall:this.fall,f:this.f}}static fromData(t){let e=new G(t.x,t.y,t.h,t.k);return Object.assign(e,super.fromData(t),{keyIn:t.keyIn,moving:t.moving,nextPos:t.nextPos,home:t.home,fall:t.fall,f:t.f}),e}}class Z{constructor(e=0,s=150){this.targets=t.cats.map(t=>({pos:t.pos,timer:new H(1/s)})),this.mr=i(t.wwid,t.whei),this.minr=.5,this.isrun=1,this.fadeIn=e}update(){if(!this.isrun)return;k.save(),k.globalAlpha=.3;let t=1;this.targets.forEach(e=>{const s=e.timer.progress,i=(t=>t*(2-t))(s);let n;n=this.fadeIn?h(this.minr+i*(this.mr-this.minr),this.mr):this.mr-i*(this.mr-this.minr),k.beginPath(),k.fillStyle="#000",k.arc(e.pos.x,e.pos.y,n,0,2*Math.PI),k.fill(),k.closePath(),e.timer.start(),s<1&&(t=!1)}),k.restore(),this.isrun=!t}}class J extends V{constructor(t,e,s,i,h=0,n=0){super(t,e,32,32,s,i,h,n),this.hiddenTile(),this.zeroBtn=0,this.ty=0!=i&&0==n?5*l((i-1)/5):0,this.fragments=null,this.broken=0}toData(){return{...super.toData(),__class:"Tile",zeroBtn:this.zeroBtn,ty:this.ty,hidden:this.hidden}}static fromData(t){let e=new J(t.x,t.y,t.h,t.k,t.n,t.b);return e.zeroBtn=t.zeroBtn,e.hidden=t.hidden,e.ty=t.ty,e}islose(){return this.n>13}resetzero(){this.zeroBtn||this.islose()||(this.k>=6&&this.k<=10&&(this.zeroBtn=1),this.n=0)}plusmove(){(0==this.k||this.k>=16&&this.k<=20)&&this.n++}openTile(){this.hidden=0}hiddenTile(){this.hidden=this.k>=16&&this.k<=20?1:0}update(){this.hiddenTile()}destory(){this.broken||(this.broken=1,t.tileTable[`${this.x},${this.y}`]=null,t.item.splice(t.item.indexOf(this),1))}draw(){k.save(),k.globalAlpha=this.a;let e=this.x,s=this.y,i=t.tileW;const h=this.h*i/5;let n=a(e+.5,s+.5),o=r(e+.5,s+.5)-h,l=i/2;if(this.b)return k.save(),k.globalAlpha=.6,k.globalCompositeOperation="source-atop",T(t.ig[6][this.k],0,i/1.3,n,o+i/6,.5,1,0,1),void k.restore();for(var c=this.h-1;c>=0;c--)this.poly(this.x,this.y,h-c*i/4);if(this.k>=1&&this.k<=5&&!this.b&&(this.dt.start(),T(t.ig[1][this.k%5],0,i/1.5,n,o-l/5,1,1,3.5*this.dt.progress,1)),this.k>=6&&this.k<=10&&!this.zeroBtn&&(this.dt.start(),T(t.ig[2][this.k%5],0,l/1.5,n,o-l/5,1,1,3.5*this.dt.progress,1)),this.k>=11&&this.k<=15&&T(t.f.x[this.k%5],0,l,n,o),0==this.k||this.k>=16&&this.k<=20){if(this.hidden)return void T(t.f["?"][this.k%5],0,l,n,o);const e=String(this.n).split("").map(Number),s=l/e.length;e.forEach((i,h)=>{const a=(h-(e.length-1)/2)*s;T(t.f[i][this.k%5],a,s,n,o)})}this.k>=21&&this.k<=25&&(this.dt.start(),T(t.ig[5][this.k%5],0,l,n,o,1,0,3.5*this.dt.progress,1)),k.restore()}poly(e,s,i){const h=t.tileW/3.75;[[[0,0,0],[1,0,0],[1,1,0],[0,1,0]],[[0,1,0],[1,2,0,h],[2,2,0,h],[1,1,0]],[[1,1,0],[2,2,0,h],[2,1,0,h],[1,0,0]]].forEach((h,n)=>{k.beginPath(),h.map(([t,h,n=0,l=0],c)=>{const{x:m,y:p}=o(a(e+t,s+h),r(e+t,s+h)-(i+n)-l);0===c?k.moveTo(m,p):k.lineTo(m,p)}),k.closePath(),k.fillStyle=p(`${t.theme.surC[this.k%5]}`,20*n),k.fill(),k.strokeStyle=p("666666",30*n),k.lineWidth=2,k.stroke()})}}const K={Item:V,Cat:G,Tile:J,Vector:P};function Q(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(Q):t.__class&&K[t.__class]?K[t.__class].fromData(t):Object.fromEntries(Object.entries(t).map(([t,e])=>[t,Q(e)])):t}const tt="t.png",et=async(t,e,s,i,h,n=[],o=0,a=50,r=50)=>new Promise(l=>{const c=w(y(),i,h);g(c).drawImage(t,e,s,i,h,0,0,i,h);const m=g(c).getImageData(0,0,i,h).data,p=w(y(),i*a,h*r),d=g(p);for(let t=0;t<h;t++)for(let e=0;e<i;e++){const s=4*(t*i+e);d.save(),d.fillStyle=o?"#"+n[0]:"#"+n[m[s]%3],d.globalAlpha=m[s+3]/255,d.fillRect(e*a,t*r,a,r),d.restore()}const f=v();f.onload=t=>l(f),f.src=x(p)});let st=t.msg,it=t.ltip;class ht{constructor(e,s={}){this.cps=s.cps??3,this.f=s.f??0,this.ls=s.ltS??4,this.lh=s.lnS??8,this.max=s.mC??16,this._t=new H(.2,1),this.nm=e+2,this.set(e?st[(0|n(4))-1]+st[st.length-(t.level>=t.maxLevel?2:1)]:s.d?it[it.length-2]:it[it.length-1]+t.ltip[t.level])}set(t){this.tx=t??"",this._c=[...this.tx],this.visible=0,this.elapsed=0,this.done=0,this.isrun=1,this._t.et=t.length}skip(){this.visible=this._c.length,this.done=1}update(){this.draw(),this._t.start(),this.done||(this.visible=h(this._t.s,this._c.length),this.visible>=this._c.length&&(this.done=1))}draw(){k.save(),k.setTransform(1,0,0,1,0,0);const e=h(t.wwid/20,t.whei/15),s=h(t.tileW/6,e),i=.25*s,n=.5*s,o=.1*t.wwid,a=.2*t.whei;k.globalAlpha=.8,k.fillStyle="#000",k.fillRect(0,0,t.wwid,t.whei),k.globalAlpha=1;let r=0,l=0;for(let e=0;e<this.visible;e++){let h=this._c[e];if("\n"==h){l++,r=0;continue}if(" "==h){r++;continue}let c=t.f[h.toLowerCase()];c&&(k.drawImage(c[this.f],o+r*(s+i),a+l*(s+n),s,s),r++)}const c=t.wwid/8,m=t.whei/6;for(let e=0;e<5;e++)T(t.f["click"[e]][this.f],e*s,s,6*c,5.5*m,1,0,this._t.s,1);t.mbtn={t:this.nm,x:0,y:0,w:t.wwid,h:t.whei},k.restore()}}t.map=new class{constructor(){this.index=-1}changelevel(e){if(t.restartLevel=0,t.level=e,t.level>t.maxLevel)return t.level=0,void(t.state=0);this.initMap(),this.genMap(),t.levelcleared=0}genMap(){let e=t.mapLevel[t.level];for(let s in e){if(0==s){let i=e[3];t.item=e[s].flatMap((e,s)=>e.map(([e,h,n],o)=>{let a=n||i||0;return t.tileTable[`${o},${s}`]=new J(o,s,h,e,a),t.tileTable[`${o},${s}`]}))}1==s&&e[s].map(e=>{t.tileTable[`${e[0]},${e[1]},${e[2]},${e[3]}`]=new J(e[0],e[1],e[2],e[3],0,1),t.item.push(t.tileTable[`${e[0]},${e[1]},${e[2]},${e[3]}`])}),2==s&&(t.cats=e[s].map(t=>new G(t[0],t[1],t[2],t[3])))}t.transOn=new Z(0)}initMap(){t.item=[],t.cats=[],t.tileTable={},t.prevMap=[]}save(){t.prevMap.push({items:t.item.map(t=>t.toData()),cats:t.cats.map(t=>t.toData())})}undo(){return t.prevMap.length>0?this.restoreSnapshot():null}restoreSnapshot(){const e=t.prevMap.pop();if(!e)return null;t.cats=e.cats.map(Q),t.tileTable={},t.item=e.items.map(e=>{let s,i=Q(e);return s=0==i.b?`${i.x},${i.y}`:`${i.x},${i.y},${i.h},${i.k}`,t.tileTable[s]=i,i})}},t.ac=new class{constructor(t,e){this.c=t,this.gamemap=e,this.reset(),["keydown","keyup",..."ontouchstart"in window?["touchstart","touchend"]:["mousedown","mouseup"]].forEach(t=>window.addEventListener(t,t=>this.handle(t)))}reset(){this.keyIn={},this.keyUp=0,this.keyEvent=0}pos(t){let e=this.c.getBoundingClientRect(),s=t.touches?.[0]||t;return{x:s.clientX-e.left,y:s.clientY-e.top}}handle(e){let s=e.which||0,i=e.type;if(z(_[L[E]]),e.repeat)return;const h=t.cats.every(t=>!t.moving);if(!t.cats.find(t=>t.fall)){if("keydown"==i&&h&&(this.keyIn[s]=1),"keyup"==i&&(this.keyIn[s]=0),"mousedown"==i||"touchstart"==i){if(this.keyUp)return;this.keyUp=1;let s=this.pos(e);if(this.keyIn.mouse={...s},1==t.state&&t.btn?.length)for(let e of t.btn)if(F(s.x,s.y,e.x,e.y,e.w,e.h))return t.state=2,void t.map.changelevel(e.t);let{x:i,y:h,w:n,h:o,t:a}=t.mbtn;F(s.x,s.y,i,h,n,o)&&(t.mbtn={},1===a&&(t.state=1),2===a&&(t.g&&(t.g=0),t.ti&&(t.ti.isrun=0),t.state=2,t.map.changelevel(t.level)),3===a&&(null!=t.ti&&(t.ti.isrun=0),t.map.changelevel(t.level+1)))}"mouseup"!==i&&"touchend"!==i||this.reset(),this.keyEvent=Object.values(this.keyIn).some(t=>1===t||t?.active),0==t.levelcleared?this.keyEvent&&this.gamemap?.save&&this.gamemap?.undo&&(t.moves[s]&&h&&(this.gamemap.save(),q(0),t.item.forEach(t=>t.plusmove())),81==s&&this.gamemap.undo(),82==s&&(t.restartLevel=1),87==s&&async function(){await C(),t.sound=!t.sound,I.gain.value=t.sound?0:1}(),69==s&&(t.state=0)):this.reset()}}isDown(t){return 1===this.keyIn[t]}hasInput(){return!!this.keyEvent}}(b,t.map),t.memap=f("CAT")?JSON.parse(f("CAT")):Array(t.maxLevel+1).fill(0);const nt=new class{constructor(t,e=1){this.pos=t,this.tPos=t.clone(),this.zoom=e,this.bond=o(150/e,80/e),this.smoothness=.0055}follow(t){const e=t.substract(this.tPos);c(e.x)>this.bond.x&&(this.tPos=t.substract(o(this.bond.x*m(e.x),0))),c(e.y)>this.bond.y&&(this.tPos=t.substract(o(0,this.bond.y*m(e.y)))),this.update()}update(){this.pos.add(this.tPos.clone().substract(this.pos).dot(this.smoothness)),this.draw()}draw(){k.translate(t.wwid/2,t.tileW/2+t.tileW),k.scale(this.zoom,this.zoom),k.translate(-this.pos.x,-this.pos.y)}}(new P(0,0));let ot=new H(1/60,1),at=null;const rt=async()=>{const e=await(s=tt,new Promise((t,e)=>{const i=new Image;return i.onload=e=>t(i),i.onerror=e,i.src=s,i}));var s;await(async e=>{const s=t.theme.cats,i=t.theme.f,h=t.theme.i,n=async t=>new Promise(e=>{const s=w(y(),t.width,t.height),i=g(s);i.save(),i.translate(t.width,0),i.scale(-1,1),i.drawImage(t,0,0),i.restore();const h=v();h.onload=()=>e(h),h.src=x(s)}),o=async(t,i,h,o,a,r,c,m=s,p=[],d=0)=>{for(var f=t;f<i;f+=h){const t=[];for(var u=0;u<5;u++){let s=await et(e,f,o,a,r,m[u],c);d&&(s=await n(s)),t.push(s)}p instanceof Array?p.push(t):p["0123456789abcdefghijklmnopqrstuvwxyz?:#"[l(f/5)]]=t}return p},[a,r,c,m,p,d,f]=await Promise.all([o(0,195,5,0,5,5,1,i,{}),o(0,11,11,5,11,16,1,i),o(11,22,11,5,11,16,1),o(150,198,16,5,16,16,0,h),o(54,150,16,5,16,16,0,s,[],0),o(54,150,16,5,16,16,0,s,[],1),o(22,54,16,5,16,16,0,s,[],0)]);t.f=a,t.ig=[c[0],m[0],m[1],t.f.x,t.f["?"],r[0],m[2]],t.ic=[[...f,...f],[...d],[...p],[...p],[...d]]})(e)},lt=e=>{t.wwid=b.width=window.innerWidth,t.whei=b.height=window.innerHeight,t.state<2?(onresize(),1===t.state?(()=>{k.save(),t.btn=[],ot.start();const e=t.wwid/2,s=t.whei/2,i=t.tileW/2.5,n=i/1.5;let o="choose",a=e-o.length*n/2,r=n;for(let e=0;e<o.length;e++)T(t.f[o[e]][2],0,n,a+i/2,r),a+=n;for(let a=0;a<4;a++)for(let r=0;r<4;r++){const l=4*a+r,c=e-(2*i+1.5*n)+r*(i+n),m=s-(2*i+1.5*n)+a*(i+n);t.memap[l]?k.globalAlpha=.5:k.globalAlpha=1,k.fillStyle="#888",k.fillRect(c,m,i,i),t.btn.push({t:l,x:c,y:m,w:i,h:i}),T(t.ig[1][4],0,i,c,m,1,0,1,1);const p=h(a+1,2),d=i/p,f=c+i/2;for(let e=0;e<p;e++){const s=f-d*(p-1)/2+e*d;T(t.ic[2][ot.progress>.5?3:2][e],0,d,s,m+i/4,1,0,1,1)}o=l+1+"";for(let e=0;e<o.length;e++){const s=f-i/4*(o.length-1)/2+e*i/4;T(t.f[o[e]][2],0,i/2.5,s,m+i/1.5,1,0,1,1)}}k.restore()})():(()=>{ot.start();const e=t.whei,s=t.wwid;k.save(),k.fillStyle="#002",k.fillRect(0,0,s,e),k.fillStyle="#fea",k.beginPath(),k.arc(s-120-.2*nt.pos.x,100,40,0,2*Math.PI),k.fill();const i=e-80;k.fillStyle="#111",k.fillRect(0,i,s,e-i),k.fillStyle="#222",k.fillRect(0,i+20,s,60),k.strokeStyle="#ffec80",k.lineWidth=4,k.setLineDash([30,30]),k.beginPath();let h=nt.pos.x%60;k.moveTo(-h,i+50),k.lineTo(s-h,i+50),k.stroke(),k.setLineDash([]);for(let t=-nt.pos.x%200;t<s+200;t+=200)k.fillStyle="#222",k.fillRect(t,i-60,6,80),k.beginPath(),k.arc(t+3,i-70,15,0,2*Math.PI),k.fillStyle="rgba(255,240,180,0.6)",k.fill();if(null!=at){let t=at.pos.x-nt.pos.x;at.pos.setX(t),at.pos.setY(i+50),at.pos.setX(s/2),at.d=3,at.f=ot.progress<.3?2:3,at.draw(),nt.pos.x+=1}const n=t.tileW/2.5;function o(e,i,h,n=0,o=0){let a=e.length*h*.8,r=s/2-a/2;for(let s=0;s<e.length;s++)" "!=e[s]?(T(t.f[e[s]][o],0,h,r,i,n,n,6*ot.progress,1),r+=h):r+=h/2}o(t.title,e/3,n,0,3),o("tap to start",e/1.5,.3*n,1,2),t.mbtn={t:1,x:0,y:0,w:s,h:e},nt.pos.x<-e&&(nt.pos.x=0),k.restore()})()):(()=>{if(t.g)return void t.g.update();((e=t.level)=>{const s=t.mapLevel[e][0];if(s=={})return;const h=t.tileW/1.5,n=t.tileW/1.5,o=t.tileW/15,a=t.tileW/15,r=s.length,c=Math.max(...s.map(t=>t.length)),m=i(10,l(h/c)),d=i(10,l(n/r));k.save(),k.globalAlpha=.8,k.fillStyle="#3a7",k.fillRect(o-5,a-5,m*c+10,d*r+10),k.restore(),k.save();const f={};t.cats.forEach(t=>{const e=`${t.x},${t.y}`;f[e]||(f[e]=[]),f[e].push(t)});let u=t.theme.f.flat(1);for(let t=0;t<r;t++)for(let e=0;e<s[t].length;e++){const[i,h]=s[t][e];k.fillStyle=i>0&&i<6?"#"+u[i%5]:i>10&&i<16?p(u[i%5],20):"#053",k.fillRect(o+e*m,a+t*d,m-2,d-2);const n=f[`${e},${t}`];n&&n.length&&(n.sort((t,e)=>e.h-t.h),n.forEach((s,i)=>{k.fillStyle=p(u[s.k%5],-20),k.fillRect(o+e*m+m/5,a+t*d+i*(d/4),m/5,d/5)}))}const y=o+c*m+20,g=a,w=t.tileW/8;["Q: Undo","W: Sound:","E: Home","R: Restart"].forEach((e,s)=>{let i=0;1==s&&(e+=t.sound?"ON":"OFF");for(let h=0;h<e.length;h++){let n=e[h];if(" "==n){i++;continue}const o=t.f[n.toLowerCase()];o&&k.drawImage(o[3],y+i*(w+1),g+s*(w+2+5),w,w),i++}}),k.restore()})(),t.restartLevel&&t.map.changelevel(t.level),t.cats.length>0?nt.follow(t.cats[0].pos.clone()):nt.follow(new P(0,0)),t.cats.sort((e,s)=>{let i=t.ac.keyIn;return i[37]?e.x-s.x:i[38]?e.y-s.y:i[39]?s.x-e.x:i[40]?s.y-e.y:e.h-s.h}),t.item.map(t=>{t.draw(),t.update()});const e=t.cats.every(t=>0==t.moving);let s={};for(let e of t.cats){e.update(),e.draw();let t=`${e.x},${e.y}`;s[t]||(s[t]=[]),s[t].push(e)}if(e){t.in=0;for(let e of t.cats)e.trigger();for(let e of t.cats)e.planMove();for(let e of t.cats)e.applyMove();if(0==t.levelcleared&&t.cats.every(t=>1===t.home))t.transOn||(t.transOn=new Z(1,100),t.levelcleared=1);else{let e=0;t.item.map(t=>{t.islose()&&(t.hidden=0,e=t.islose())}),!t.ti&&e&&(t.transOn||(t.transOn=new Z(1),t.levelcleared=-1))}}var h;t.transOn&&(t.transOn.update(),t.transOn.isrun||(1==t.levelcleared&&(q(5),t.ti=new ht(1,{f:4}),t.memap[t.level]=1,h=t.memap,d.setItem("CAT",JSON.stringify(h))),-1==t.levelcleared&&(t.ti=new ht(0,{f:3})),t.transOn=0)),t.ti&&(t.ti.isrun?t.ti.update():t.ti=0)})(),requestAnimationFrame(lt)};onresize=()=>{t.wwid=b.width=window.innerWidth,t.whei=b.height=window.innerHeight;const e=window.innerWidth;t.tileW=i(100,h(300,l(e/8))),t.cats.map(t=>t.resize())},addEventListener("DOMContentLoaded",async()=>{await async function({minTime:t=1e4,fadeTime:e=1e3}={}){const s=document.getElementById("l"),i=s.querySelector(".p"),o=s.querySelector(".t");s.style.setProperty("--fade-time",e+"ms"),s.classList.remove("hidden");let a=0;const r=setInterval(()=>{i.style.width=(a=h(a+n(10),100))+"%",o.textContent=l(a)+"%",a>=100&&clearInterval(r)},200);return await Promise.all([rt(),new Promise(e=>setTimeout(e,t))]),clearInterval(r),i.style.width="100%",o.textContent="100%",new Promise(t=>{s.addEventListener("transitionend",()=>t(lt()),{once:!0}),s.classList.add("hidden")})}({minTime:5e3,fadeTime:1500}),at=new G(0,0,1,1),t.g=new ht(0,{f:3,d:1})})</script>