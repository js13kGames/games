<title>Unblock - js13kGames 2024</title><body><script>let t=Math.PI;function i(t,i=0,e=1){return t<i?i:e<t?e:t}function e(t,e,s){return s-e?i((t-e)/(s-e)):0}function s(t,i,e,s=l()){return 2*Math.abs(t.x-e.x)<i.x+s.x&&2*Math.abs(t.y-e.y)<i.y+s.y}function h(t=1,i=0){return i+Math.random()*(t-i)}function a(t,i=0){return Math.floor(h(t,i))}function n(i=1){return u(new y,h(2*t),i)}function r(t=1){return 0<t?n(t*h(0/t,1)**.5):new y}function o(t=new g,i=new g(0,0,0,1),e=!1){return e?t.ma(i,h()):new g(h(t.r,i.r),h(t.l,i.l),h(t.b,i.b),h(t.a,i.a))}function l(t=0,i){return"number"==typeof t?new y(t,null==i?t:i):new y(t.x,t.y)}function u(t,i=0,e=1){return t.x=e*Math.sin(i),t.y=e*Math.cos(i),t}function c(t){var i=t.length();return 1<i?t.scale(1/i):t}class y{constructor(t=0,i=0){this.x=t,this.y=i}ba(){return new y(this.x,this.y)}add(t){return new y(this.x+t.x,this.y+t.y)}o(t){return new y(this.x-t.x,this.y-t.y)}multiply(t){return new y(this.x*t.x,this.y*t.y)}ha(t){return new y(this.x/t.x,this.y/t.y)}scale(t){return new y(this.x*t,this.y*t)}length(){return(this.x**2+this.y**2)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new y(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(t);return t=Math.sin(t),new y(this.x*i-this.y*t,this.x*t+this.y*i)}setDirection(t,i=1){return l(t%2?t-1?-i:i:0,t%2?0:t?-i:i)}direction(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new y(Math.floor(this.x),Math.floor(this.y))}ma(t,e){return this.add(t.o(this).scale(i(e)))}toString(){}}function x(t){return(255*i(t.r)|0)+(255*i(t.l)<<8)+(255*i(t.b)<<16)+(255*i(t.a)<<24)}class g{constructor(t=1,i=1,e=1,s=1){this.r=t,this.l=i,this.b=e,this.a=s}ba(){return new g(this.r,this.l,this.b,this.a)}add(t){return new g(this.r+t.r,this.l+t.l,this.b+t.b,this.a+t.a)}o(t){return new g(this.r-t.r,this.l-t.l,this.b-t.b,this.a-t.a)}multiply(t){return new g(this.r*t.r,this.l*t.l,this.b*t.b,this.a*t.a)}ha(t){return new g(this.r/t.r,this.l/t.l,this.b/t.b,this.a/t.a)}scale(t,i=t){return new g(this.r*t,this.l*t,this.b*t,this.a*i)}ma(t,e){return this.add(t.o(this).scale(i(e)))}toString(t=!0){var i=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+i(this.r)+i(this.l)+i(this.b)+(t?i(this.a):"")}}function d(t){return null!=t.time}function f(t){return d(t)?e(t.time-jt,t.setTime,0):0}class m{constructor(t){this.time=null==t?void 0:jt+t,this.setTime=t}set(t=0){this.time=jt+t,this.setTime=t}active(){return jt<=this.time}get(){return d(this)?jt-this.time:0}toString(){}valueOf(){return this.get()}}let p=l(),w=l(1920,1200),v=l(),b=l(16);function M(t){t.ga=!0,t.la=!0,t.R=!0}class A{constructor(t=l(),i=l(1),e,s=0,h,a=0){this.g=t.ba(),this.size=i,this.Ja=void 0,this.ca=e,this.angle=s,this.color=h,this.Ba=void 0,this.P=!1,this.Z=this.u=this.i=1,this.H=0,this.ja=.8,this.I=1,this.X=a,this.h=l(),this.fa=0,this.za=jt,this.children=[],this.parent=void 0,this.Na=l(),this.Ma=0,this.la=this.ga=this.R=!1,Tt.push(this)}update(){var t=this.parent;if(t)this.g=this.Na.multiply(l(t.P?-1:1,1)).rotate(-t.angle).add(t.g),this.angle=(t.P?-1:1)*this.Ma+t.angle;else if(this.h.x=i(this.h.x,-1,1),this.h.y=i(this.h.y,-1,1),t=this.g.ba(),this.h.y+=0*this.I,this.g.x+=this.h.x*=this.u,this.g.y+=this.h.y*=this.u,this.angle+=this.fa*=this.Z,this.i){var e,h,a,r,o,u,c=this.h.y<0;if(this.J&&(u=this.J.h?this.J.h.x:0,this.h.x=u+(this.h.x-u)*this.ja,this.J=0),this.ga)for(var y of Pt)!this.la&&!y.la||y.D||y.parent||y==this||s(this.g,this.size,y.g,y.size)&&(u=this.A(y),e=y.A(this),u)&&e&&(s(t,this.size,y.g,y.size)?(u=(e=(u=t.o(y.g)).length())<.01?n(.001):u.scale(.001/e),this.h=this.h.add(u),y.i&&(y.h=y.h.o(u))):(e=this.size.add(y.size),h=2*(t.y-y.g.y)>e.y+0,a=2*Math.abs(t.y-y.g.y)<e.y,r=2*Math.abs(t.x-y.g.x)<e.x,u=Math.max(this.H,y.H),!h&&!r&&a||(this.g.y=y.g.y+(e.y/2+.001)*Math.sign(t.y-y.g.y),y.J&&c||!y.i?(c&&(this.J=y),this.h.y*=-u):y.i&&(r=(this.i*this.h.y+y.i*y.h.y)/(this.i+y.i),o=y.h.y*(y.i-this.i)/(this.i+y.i)+2*this.h.y*this.i/(this.i+y.i),this.h.y=r+i(u)*(this.h.y*(this.i-y.i)/(this.i+y.i)+2*y.h.y*y.i/(this.i+y.i)-r),y.h.y=r+i(u)*(o-r))),!h&&a&&(this.g.x=y.g.x+(e.x/2+.001)*Math.sign(t.x-y.g.x),y.i?(e=(this.i*this.h.x+y.i*y.h.x)/(this.i+y.i),h=y.h.x*(y.i-this.i)/(this.i+y.i)+2*this.h.x*this.i/(this.i+y.i),this.h.x=e+i(u)*(this.h.x*(this.i-y.i)/(this.i+y.i)+2*y.h.x*y.i/(this.i+y.i)-e),y.h.x=e+i(u)*(h-e)):this.h.x*=-u)));this.R&&nt(this.g,this.size,this)&&!nt(t,this.size,this)&&(y=nt(l(this.g.x,t.y),this.size,this),!nt(l(t.x,this.g.y),this.size,this)&&y||(this.J=c,this.h.y*=-this.H,(c=(t.y-this.size.y/2|0)-(t.y-this.size.y/2))<0&&c>this.u*this.h.y+0*this.I&&(this.h.y=this.u?(c-0*this.I)/this.u:0),this.g.y=t.y),y)&&(this.g.x=t.x,this.h.x*=-this.H)}}G(){R(this.g,this.Ja||this.size,this.ca,this.color,this.angle,this.P,this.Ba)}j(){if(!this.D)for(var t of(this.D=1,this.parent&&this.parent.removeChild(this),this.children))t.j(t.parent=0)}A(){return!0}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){}}let z,S,E,T,P=l(),k=[];function j(t=l(),i=b){var e;return"number"==typeof i&&(i=l(i)),"number"==typeof t&&(t=l(t%(e=k[0].size.x/i.x|0)*i.x,(t/e|0)*i.y)),new C(t,i,0)}class C{constructor(t=l(),i=b,e=0){this.g=t,this.size=i,this.Aa=e}offset(t){return new C(this.g.add(t),this.size,this.Aa)}frame(t){return this.offset(l(t*this.size.x,0))}}class D{constructor(t){this.image=t,this.size=l(t.width,t.height);var i=yt.createTexture();yt.bindTexture(3553,i),t&&yt.texImage2D(3553,0,6408,6408,5121,t),yt.texParameteri(3553,10241,9728),yt.texParameteri(3553,10240,9728),this.ua=i,this.Ka=l(.1).ha(this.size)}}function B(){var t=K;return new y((t.x-P.x/2+.5)/32+p.x,(t.y-P.y/2+.5)/-32+p.y)}function F(t){return new y(32*(t.x-p.x)+P.x/2-.5,-32*(t.y-p.y)+P.y/2-.5)}function R(t,i=l(1),e,s=new g,h=0,a,n=new g(0,0,0,0)){var r,o,u,c,y=e&&k[e.Aa];y?(r=e.g.x/y.size.x,o=e.g.y/y.size.y,u=e.size.x/y.size.x,e=e.size.y/y.size.y,c=y.Ka,(y=y.ua)!=gt&&(zt(),yt.bindTexture(3553,gt=y)),St(t.x,t.y,a?-i.x:i.x,i.y,h,r+c.x,o+c.y,r-c.x+u,o-c.y+e,x(s),x(n))):St(t.x,t.y,i.x,i.y,h,0,0,0,0,0,x(s))}function G(t,i,e){R(t,i,void 0,e,void 0,!1)}function I(t,i,e=1,s,h=0,a){U(t,F(i),32*e,s,32*h,a)}function U(t,i,e=1,s=new g,h=0,a=new g(0,0,0),n="center"){var r=T;r.fillStyle=s.toString(),r.lineWidth=h,r.strokeStyle=a.toString(),r.textAlign=n,r.font=e+"px arial",r.textBaseline="middle",r.lineJoin="round",i=i.ba(),(t+"").split("\n").forEach(t=>{h&&r.strokeText(t,i.x,i.y),r.fillText(t,i.x,i.y),i.y+=e})}function L(t,i=0){return V[i]&&!!(1&V[i][t])}function H(t){return V[0]&&!!(2&V[0][t])}let O=l(),K=l(),N=!1;function W(t,i=0){return L(t,i+1)}let V=[[]];function J(){for(var t of V)for(var i in t)t[i]&=1}function Y(t){return"KeyW"==t?"ArrowUp":"KeyS"==t?"ArrowDown":"KeyA"==t?"ArrowLeft":"KeyD"==t?"ArrowRight":t}function X(t){var i;return z?(i=z.getBoundingClientRect(),l(z.width,z.height).multiply(l(e(t.x,i.left,i.right),e(t.y,i.top,i.bottom)))):l()}onkeydown=t=>{t.repeat||(N=!1,V[0][t.code]=3,V[0][Y(t.code)]=3)},onkeyup=t=>{V[0][t.code]=4,V[0][Y(t.code)]=4},onmousedown=t=>{N=!1,V[0][t.button]=3,K=X(t),t.button&&t.preventDefault()},onmouseup=t=>V[0][t.button]=2&V[0][t.button]|4,onmousemove=t=>K=X(t),onwheel=t=>t.ctrlKey?0:Math.sign(t.deltaY),oncontextmenu=()=>!1;let Z=[];function $(){var t,i;if(navigator&&navigator.getGamepads&&document.hasFocus()){var s=navigator.getGamepads();for(let y=s.length;y--;){var h=s[y],a=V[y+1]||(V[y+1]=[]),n=Z[y]||(Z[y]=[]);if(h){for(var r=0;r<h.axes.length-1;r+=2)n[r>>1]=(t=l(h.axes[r],h.axes[r+1]),c(l((i=t=>.3<t?e(t,.3,.8):t<-.3?-e(-t,.3,.8):0)(t.x),i(-t.y))));for(r=h.buttons.length;r--;){var o=h.buttons[r],u=W(r,y);a[r]=o.pressed?u?1:3:u?4:0,N||=!y&&o.pressed}(h=l((W(15,y)&&1)-(W(14,y)&&1),(W(12,y)&&1)-(W(13,y)&&1))).x**2+h.y**2&&(n[0]=c(h))}}}}let q=void 0!==window.ontouchstart;if(q){let t;onmousedown=onmouseup=()=>0,ontouchstart=ontouchmove=ontouchend=i=>{tt&&"running"!=tt.state&&et([st(0)]);var e=i.touches.length;return e?(K=X(l(i.touches[0].clientX,i.touches[0].clientY)),t?N=!1:V[0][0]=3):t&&(V[0][0]=2&V[0][0]|4),t=e,document.hasFocus()&&i.preventDefault(),!0}}class Q{constructor(t){this.Ra=40,this.Ua=.7,this.W=0,t&&(this.W=t[1]||0,t[1]=0,this.oa=[st(...t)],this.sampleRate=44100)}play(t,i=1,s=1,a=1,n=!1){if(this.oa){var r;if(t){if(r=this.Ra){var o=p;if(r*r<(o=(p.x-t.x)**2+(o.y-t.y)**2))return;i*=e(o**.5,r,r*this.Ua)}r=2*F(t).x/z.width-1}return this.source=et(this.oa,i,s+s*this.W*a*h(-1,1),r,n,this.sampleRate)}}stop(){this.source&&this.source.stop(),this.source=void 0}}class _ extends Q{constructor(){super(),this.W=0,this.oa=function(t,i,e,s=125){let h,a,n,r,o,l,u,c,y,x,g,d,f,m,p=0,w=[],v=[],b=[],M=0,A=0,z=1,S={},E=44100/s*60>>2;for(;z;M++)w=[z=c=d=0],e.forEach((s,T)=>{for(u=i[s][M]||[0,0,0],z|=i[s][M]&&1,m=d+(i[s][0].length-2-(c?0:1))*E,f=T==e.length-1,h=2,n=d;h<u.length+f;c=++h){for(o=u[h],y=h==u.length+f-1&&f||x!=(u[0]||0)||0|o,a=0;a<E&&c;a++>E-99&&y&&g<1&&(g+=1/99))l=(1-g)*w[p++]/2||0,v[n]=(v[n]||0)-l*A+l,b[n]=(b[n++]||0)+l*A+l;o&&(g=o%1,A=u[1]||0,o|=0)&&(w=S[[x=u[p=0]||0,o]]=S[[x,o]]||((r=[...t[x]])[2]*=2**((o-12)/12),0<o?st(...r):[]))}d=m});return[v,b]}([[,0,232,.01,.09,.15,2,,,,,,154.87,,,,.26],[2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[,0,232,.01,.09,.15,2,,,,,,154.87,,,,.26],[.8,0,2100,,,.2,3,3,,,-400,,,2],[,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[,-1,10,,10,,10,,10,,10,,10,,10,,10,,8,,8,,8,,8,,8,,8,,8,,8,,7,,7,,7,,7,,7,,7,,7,,7,,6,,6,,6,,6,,6,,6,,6,,6,,],[2,-.3,17,,,,,,17,,,,,,,,17,,15,,,,,,15,,,,,,,,15,,13,,,,,,13,,,,,,,,13,,12,,,,,,12,,,,,,,,12,,],[1,1,,,,,10,,,,,,,,10,,10,,,,,,8,,,,,,,,8,,8,,,,,,7,,,,,,,,7,,7,,,,,,6,,,,,,,,6,,6,,],[3,.5,22,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,]],[[,-1,10,,10,,10,,10,,10,,10,,10,,10,,8,,8,,8,,8,,8,,8,,8,,8,,7,,7,,7,,7,,7,,7,,7,,7,,6,,6,,6,,6,,6,,6,,6,,6,,],[2,-.3,17,,,,,,17,,,,,,,,17,,15,,,,,,15,,,,,,,,15,,13,,,,,,13,,,,,,,,13,,12,,,,,,12,,,,,,,,12,,],[1,1,,,,,10,,,,,,,,10,,10,,,,,,8,,,,,,,,8,,8,,,,,,7,,,,,,,,7,,7,,,,,,6,,,,,,,,6,,6,,],[3,.5,22,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,],[,,22,,,,24,,25,,,,22,,,,,,27,,,,29,,27,,,,,,,,,,22,,,,24,,25,,,,22,,,,,,27,,,,25,,24,,,,,,,,,,]],[[,-1,10,,10,,10,,10,,10,,10,,10,,10,,8,,8,,8,,8,,8,,8,,8,,8,,7,,7,,7,,7,,7,,7,,7,,7,,6,,6,,6,,6,,6,,6,,6,,6,,],[2,-.3,17,,,,,,17,,,,,,,,17,,15,,,,,,15,,,,,,,,15,,13,,,,,,13,,,,,,,,13,,12,,,,,,12,,,,,,,,12,,],[1,1,,,,,10,,,,,,,,10,,10,,,,,,8,,,,,,,,8,,8,,,,,,7,,,,,,,,7,,7,,,,,,6,,,,,,,,6,,6,,],[3,.5,22,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,],[,,29,,,,27,,25,,,,22,,,,,,27,,,,29,,27,,,,,,,,,,25,,,,27,,25,,,,22,,,,,,27,,,,25,,24,,,,,,,,,,]],[[,-1,10,,10,,10,,10,,10,,10,,10,,10,,8,,8,,8,,8,,8,,8,,8,,8,,7,,7,,7,,7,,7,,7,,7,,7,,6,,6,,6,,6,,6,,6,,6,,6,,],[2,-.3,17,,,,,,17,,,,,,,,17,,15,,,,,,15,,,,,,,,15,,13,,,,,,13,,,,,,,,13,,12,,,,,,12,,,,,,,,12,,],[1,1,,,,,10,,,,,,,,10,,10,,,,,,8,,,,,,,,8,,8,,,,,,7,,,,,,,,7,,7,,,,,,6,,,,,,,,6,,6,,],[3,.5,22,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,],[,,22,,25,,22,,25,,22,,25,,22,,25,,20,,25,,20,,25,,20,,25,,20,,25,,13,,13,,13,,13,,13,,13,,13,,13,,15,,15,,13,,15,,9,,9,,12,,9,,]]],[0,0,1,1,2,2,3,3,1,2,3,3],void 0),this.sampleRate=44100}Qa(){super.play(void 0,.5,1,1,!0)}}let tt=new AudioContext,it=!1;function et(t,e=1,s=1,h=0,a=!1,n=44100){var r=it;if(!(it="running"!=tt.state)||(tt.resume(),!r)){let r=tt.createBuffer(t.length,t[0].length,n);return n=tt.createBufferSource(),t.forEach((t,i)=>r.getChannelData(i).set(t)),n.buffer=r,n.playbackRate.value=s,n.loop=a,(t=tt.createGain()).gain.value=.5*e,t.connect(tt.destination),n.connect(new StereoPannerNode(tt,{pan:i(h,-1,1)})).connect(t),n.start(),n}}function st(e=1,s=.05,a=220,n=0,r=0,o=.1,l=0,u=1,c=0,y=0,x=0,g=0,d=0,f=0,m=0,p=0,w=0,v=1,b=0,M=0,A=0){var z=2*t,S=c*=500*z/44100/44100;s=a*=h(1+s,1-s)*z/44100;let E=[],T=0,P=0,k=0,j=1,C=0,D=0,B=0,F=z*Math.abs(A)*2/44100,R=Math.cos(F),G=Math.sin(F)/2/2,I=1+G,U=(F=-2*R/I,G=(1-G)/I,(1+Math.sign(A)*R)/2/I),L=-(Math.sign(A)+R)/I,H=0,O=0,K=0,N=0;for(y*=500*z/44100**3,m*=z/44100,x*=z/44100,g*=44100,d=44100*d|0,e*=.5,I=(n=44100*n+9)+(b*=44100)+(r*=44100)+(o*=44100)+(w*=44100)|0;k<I;E[k++]=B*e)++D%(100*p|0)||(B=l?1<l?2<l?3<l?Math.sin(T**3):i(Math.tan(T),1,-1):1-(2*T/z%2+2)%2:1-4*Math.abs(Math.round(T/z)-T/z):Math.sin(T),B=(d?1-M+M*Math.sin(z*k/d):1)*Math.sign(B)*Math.abs(B)**u*(k<n?k/n:k<n+b?1-(k-n)/b*(1-v):k<n+b+r?v:k<I-w?(I-k-w)/o*v:0),B=w?B/2+(w>k?0:(k<I-w?1:(I-k)/w)*E[k-w|0]/2/e):B,A&&(B=N=U*H+L*(H=O)+U*(O=B)-G*K-F*(K=N))),R=(a+=c+=y)*Math.cos(m*P++),T+=R+R*f*Math.sin(k**5),j&&++j>g&&(a+=x,s+=x,j=0),!d||++C%d||(a=s,c=S,j=j||1);return E}let ht=[],at=l();function nt(t,i=l(),e){var s=Math.max(t.x-i.x/2|0,0),h=Math.max(t.y-i.y/2|0,0),a=Math.min(t.x+i.x/2,at.x);for(t=Math.min(t.y+i.y/2,at.y);h<t;++h)for(i=s;i<a;++i){var n=ht[h*at.x+i];if(n&&(!e||0<n))return!0}}function rt(t){var i="number"==typeof t.ia?r(t.ia/2):l(h(-.5,.5),h(-.5,.5)).multiply(t.ia).rotate(t.angle);let e=h(t.wa,-t.wa),s=(t.na||(i=t.g.add(i),e+=t.angle),t.W),n=t=>t+t*h(s,-s);var c=n(t.Pa),y=n(t.pa),x=n(t.Sa),g=n(t.speed),d=(n=n(t.Ca)*(2*a(2)-1),h(t.ra,-t.ra)),f=o(t.Ga,t.Ha,t.ya),m=o(t.Ea,t.Fa,t.ya);d=t.na?d:t.angle+d,(i=new lt(i,t.ca,e,f,m,c,y,x,t.T,t.Y,t.da,t.na&&t,t.Oa)).h=u(l(),d,g),i.fa=n,i.T=t.T,i.u=t.u,i.Z=t.Z,i.H=t.H,i.ja=t.ja,i.I=t.I,i.R=t.R,i.X=t.X,i.P=!!a(2),t.xa&&t.xa(i)}class ot extends A{constructor(i,e,s=0,h=0,a=100,n=t,r,o=new g,u=new g,c=new g(1,1,1,0),y=new g(1,1,1,0),x=.5,d=.1,f=1,m=.1,p=.05,w=1,v=1,b=0,M=t,A=.1,z=.2,S=!1,E=!1,T=!0,P=(E?1e9:0),k=!1){super(i,l(),r,e,void 0,P),this.ia=s,this.ta=h,this.sa=a,this.ra=n,this.Ga=o,this.Ha=u,this.Ea=c,this.Fa=y,this.ya=T,this.Pa=x,this.pa=d,this.Sa=f,this.speed=m,this.Ca=p,this.u=w,this.Z=v,this.I=b,this.wa=M,this.T=A,this.W=z,this.R=S,this.Y=E,this.na=k,this.da=0,this.xa=this.Oa=void 0,this.S=0}update(){if(this.parent&&super.update(),!this.ta||jt-this.za<=this.ta){if(+this.sa){var t=1/this.sa;for(this.S+=Et;0<this.S;this.S-=t)rt(this)}}else this.j()}G(){}}class lt extends A{constructor(t,i,e,s,h,a,n,r,o,u,c,y,x){super(t,l(),i,e),this.aa=s,this.$=h.o(s),this.La=a,this.pa=n,this.Ta=r-n,this.T=o,this.Y=u,this.da=c,this.M=y,this.qa=x}G(){var t=Math.min((jt-this.za)/this.La,1),i=l(this.pa+t*this.Ta),e=this.T/2;e=new g(this.aa.r+t*this.$.r,this.aa.l+t*this.$.l,this.aa.b+t*this.$.b,(this.aa.a+t*this.$.a)*(t<e?t/e:1-e<t?(1-t)/e:1)),this.Y&&(vt=!0);let s=this.g;var h,a,n=this.angle;this.M&&(s=this.M.g.add(s.rotate(-this.M.angle)),n+=this.M.angle),this.da?(h=this.h,(n=(h=this.M?h.rotate(-this.M.angle):h).length())&&(h=h.scale(1/n),a=n*this.da,i.y=Math.max(i.x,a),n=h.angle(),R(s.add(h.multiply(l(0,-a/2))),i,this.ca,e,n,this.P))):R(s,i,this.ca,e,n,this.P),this.Y&&(vt=void 0),1==t&&(this.color=e,this.size=i,this.qa&&this.qa(this),this.D=1)}}let ut,ct,yt,xt,gt,dt,ft,mt,pt,wt,vt,bt,Mt=[];function At(t,i){return i=yt.createShader(i),yt.shaderSource(i,t),yt.compileShader(i),i}function zt(){var t;wt&&(t=bt?1:771,yt.blendFuncSeparate(770,t,1,t),yt.enable(3042),yt.bufferSubData(34962,0,mt),yt.drawArraysInstanced(5,0,4,wt),wt=0,bt=vt)}function St(t,i,e,s,h,a,n,r,o,l,u=0){(1e4<=wt||bt!=vt)&&zt();var c=11*wt;mt[c++]=t,mt[c++]=i,mt[c++]=e,mt[c++]=s,mt[c++]=a,mt[c++]=n,mt[c++]=r,mt[c++]=o,pt[c++]=l,pt[c++]=u,mt[+c]=h,wt++}let Et=1/60,Tt=[],Pt=[],kt=0,jt=0,Ct=0,Dt=0,Bt=0;function Ft(){for(var t of(Pt=Tt.filter(t=>t.ga),Tt))t.parent||function t(i){if(!i.D)for(var e of(i.update(),i.children))t(e)}(t);Tt=Tt.filter(t=>!t.D)}class Rt extends A{constructor(t,i,e,s=1){super(t,l(2)),this.V=i,this.va=e,this.type=s,this.block=!0,M(this),3===this.type&&(this.h=l(0,-.25))}update(){this.g.y<0&&this.j(),super.update()}G(){G(this.g,this.size,ji),2===this.type?G(this.g,l(1.7,1.7),ji):(G(this.g,l(1.7,1.7),Pi),I(this.V,l(this.g.x,this.g.y-.1),1.4,ki))}A(i){if(i===yi&&(qt.set(.1),this.j(),qt.set(1),hi.set(2),li="lost"),i.Da){let e=0;return--this.V,0!=this.V&&(new ot(this.g.o(l(0,2)),t,this.size,.1,50,t/2,0,ji,ji,ji.scale(1,0),ji.scale(1,0),.2,.1,.4,.1,0,1,0,1.8,t,.1,.4,0,0),gi||Ri.play(this.g)),3===this.type&&(e+=600),(this.V<1||"hard"===i.type||3===this.type)&&(e+=200,this.j(),new Nt(this.g,"+"+e),oi+=e),1}}j(){var i=ri[this.va].indexOf(this);-1<i&&ri[this.va].splice(i,1),super.j(),new ot(this.g,0,this.size,.1,200,t,0,ji,ji,ji.scale(1,0),ji.scale(1,0),.2,.5,1,.08,.1,.99,.95,.4,t,.1,.8,0,1),gi||Gi.play(this.g)}}function Gt(i){new ot(i.g.o(l(0,.5)),t,i.size,.1,50,t,j(1,16),Ci,Ci,Ci.scale(1,0),Ci.scale(1,0),.2,.1,.4,.1,0,1,0,5,t,.1,.4,0,0)}class It extends A{constructor(t=l(0,.8),i="normal"){var e=yi.g;super(l(e.x,e.y+1),l(1),j(1)),this.h=t,this.color=Ci,this.type=i,this.Da=!0,M(this)}update(){40<this.g.y&&this.j(),"hard"===this.type&&Gt(this),super.update()}A(t){return"normal"===this.type&&t.block&&this.j(),t.Va&&(Gt(this),this.j()),0}}class Ut extends A{constructor(t,i,e){super(t,i),this.color=ji,M(this),this.i=0,this.label=e}G(){G(this.g,this.size,ji),G(this.g,this.size.multiply(l(.97,.9)),Pi),I(this.label,l(this.g.x,this.g.y-.1),.5*this.size.y,ki)}}class Lt extends A{constructor(){super(O,l(.5),j(1)),this.color=new g(0,0,0,0),M(this),this.Ia=new m(.1)}update(){jt>this.Ia.time&&this.j(),super.update()}A(t){return t===wi&&Vt(),t===vi&&(gi=!gi,Bi.play(),gi||Fi.play()),t===bi&&((gi=!gi)||Fi.play(),gi?Ki.stop():Ki.play()),t===Mi&&(Xt(!(Mi.g.x=-5)),ui=oi=0,fi=di,ci=10,ri=Array.from(Array(10),()=>[]),ni.time=void 0,ai.time=void 0,Xt(!1),gi||Fi.play(),li="title"),this.j(),1}}class Ht extends A{constructor(t=1,i=""){super(l(a(1,20),41),l(1.5),j(2)),this.h=l(0,-.2),this.color="hard"===i?new g(.568,.003,.968):new g(.254,.917,.831),this.amount=t,this.X=500,this.type=i,this.ka=new m(.4),this.ea=-.018}update(){d(this.ka)&&jt>this.ka.time&&(this.ea*=-1,this.ka.set(.4)),this.color.a+=this.ea,this.g.y<Ti.y+1&&M(this),this.g.y<-1&&this.j(),super.update()}A(t){return t===yi&&(this.j(),gi||Ui.play(this.g),"hard"===this.type?ci+=this.amount:ui+=this.amount),0}}class Ot extends A{constructor(){super(Ti,Ei,j(0)),M(this),this.color=ki}A(i){if("Block"===i.constructor.name)return this.j(),new ot(this.g,0,this.size,.1,200,t,j(1),ki,ki,ki.scale(1,0),ki.scale(1,0),.8,.2,1.5,.3,.1,.8,.5,.1,t,.5,.3,0,1),1}update(){var t=this.g.x;this.g.x=t+i(.1)*(O.x-t),this.g.x=i(this.g.x,this.size.x/2,Si.x-this.size.x/2)}}function Kt(t,i){U(t,l(P.x/2,P.y/4),50,i),U(oi.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),l(P.x/2,P.y/3),40,ki),"GAME OVER"===t&&U("STAGE "+fi+" / 10",l(P.x/2,P.y-550),35,ki)}class Nt extends A{constructor(t,i){super(t),this.points=i,this.color=new g(.984,1,.07),this.time=new m,this.h=l(0,.2)}update(){d(this.time)||this.time.set(.5),d(this.time)&&(this.color.a=1-f(this.time),jt>this.time.time)&&this.j(),super.update()}G(){I(this.points,this.g,1.3,this.color,.1,this.color)}}let Wt={1:{level:[[],[],[],[],[],[],[],[],[],[],[]],m:{min:20,max:40},time:30},2:{level:[[1],[1],[1],[1],[1,1],[1],[1],[1],[1],[1,1],[1]],m:{min:15,max:35},time:40},3:{level:[[1,1],[1,11],[1,1,2],[1,1,2],[1,1,2],[1,1],[1,1],[1,1],[1,1],[1,1,1],[1,1]],m:{min:5,max:10},time:40},4:{level:[[1,1,1],[1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,2,1],[1,2],[1,1,1,1],[1,1,2],[1,2,1],[1,2,1]],m:{min:10,max:15},s:.97,time:40},5:{level:[[1,1,1,1],[1,1,1],[1,1,2],[1,1,1,2],[1,1,2],[1,1,2],[1,2],[1,1,2,1],[1,1,2],[1,2,1],[1,2,1]],m:{min:7,max:12},s:.95,time:40},6:{level:[[1,1,1,1,1],[1,1,1,3],[1,1,2],[1,1,1,2,1,1,1],[1,1,2,1,3],[1,1,1],[1,1,1],[1,1,3],[1,1,1,1,1,1,1],[1,2,1,3],[1,2,1,1]],m:{min:5,max:10},F:10,s:.95,time:40},7:{level:[[1,1,1],[1,1,1],[1,1,2,3],[1,1,1,2,2],[1,1,3],[1,1,1,3],[1,1,2],[1,1,2],[1,1,1,3],[1,2,1],[1,2,1,1,1]],m:{min:5,max:10},F:7,s:.9,time:40},8:{level:[[1,1,3],[1,1,1,3],[1,1,2,2,3],[1,1,1,2,1,3],[1,1,3],[1,1,1,3],[1,1,2],[1,1,2],[1,1,1,1,3],[1,2,1,3],[1,2,3]],m:{min:5,max:10},F:7,s:.95,time:40},9:{level:[[1,1,1,1,3],[1,1,1,1,3],[1,1,1,2,3],[1,1,1,2,3],[1,1,2,1,3],[1,1,1,1,3],[1,1,2,1,3],[1,1,2,1,3],[1,1,1,1,3],[1,2,1,1,3],[1,2,1,1,3]],m:{min:5,max:8},F:5,s:.8,time:45},10:{level:[[1,1,1,1,1,3],[1,1,1],[1,1,2,2,1,3],[1,1,1,2],[1,1,1,1,1,1,3],[1,1,1],[1,1,2,1,1,3],[1,1,2],[1,1,1,1,1,3],[1,2,1],[1,2,1,1,1,3]],m:{min:2,max:4},F:5,s:.5,time:50}};function Vt(){Xt(!(ci=0)),hi.set(1.5),gi||Fi.play(),li="stage"}function Jt(){R(l(1,38.5),l(1.2),j(2),Di),U("x "+ci,l(100,45),40,ki,void 0,void 0,"left"),U(oi.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),l(P.x-55,48),50,ki,void 0,void 0,"right")}function Yt(t=!1){if(t)0<ci&&(new It(l(0,.8),"hard"),--ci);else if(0===ui)new It;else{for(t=-.2;t<=.2;t+=.2)new It(l(t,1));ui--}}function Xt(t){t?(wi.g.x=-5,vi.g.x=-5):(wi.g.x=p.x,vi.g.x=p.x)}function Zt(){H("Space")&&Yt(),d(ei)||ei.set(.3),H(0)&&(zi=Ai=O,ei.set(.1),ii.set(.2)),((zi=V[0]&&4&V[0][0]?O:zi).y>Ai.y&&3<zi.y-Ai.y&&!(jt>ii.time)||!q&&H(0))&&(Yt(!0),Ai=zi=0),jt>ei.time&&L(0)&&q&&(Yt(),ei.set(.12))}class $t extends A{constructor(t){super(t,l(1,80)),M(this),this.Va=!0,this.i=0,this.color=new g(0,0,0,0)}}let qt,Qt,_t,ti,ii,ei,si,hi,ai,ni,ri,oi,li,ui,ci,yi,xi,gi,di,fi,mi,pi,wi,vi,bi,Mi,Ai,zi,Si=l(20,40),Ei=l(1.4,2),Ti=l(18,8),Pi=new g(.047,.058,.039),ki=new g(.254,.917,.831),ji=new g(1,.125,.431),Ci=new g(.984,1,.07),Di=new g(.568,.003,.968),Bi=new Q([0]),Fi=(new Q([.5,,432,.02,.01,.07,1,.3,-4,-2,,,,,,.2,.01,.93,.17,,-1390]),new Q([2.5,,113,.03,.02,.008,1,2.1,,7,141,.13,,,,.4,,.67,.02,.05,-1492])),Ri=new Q([2.1,,250,.01,.07,,1,3.5,-4,,,,,1.3,18,.3,.13,.65]),Gi=new Q([.7,,45,.01,.06,.39,,1.7,4,-4,,,,2,,.6,,.44,.13,,-2517]),Ii=new Q([1.2,,924,.03,.04,.004,1,2.4,,,403,.06,.01,,,,.01,.56,.02,.28,335]),Ui=new Q([,,306,.03,.08,.06,1,.7,,,258,.04,.04,,,.1,,.89,.04,,258]),Li=new Q([,,570,.08,.26,.16,,1.2,,,-99,.09,.09,,,,,.7,.22,.45]),Hi=new Q([1.9,,485,.03,.14,.4,1,,9,16,-117,.09,.05,,,,.16,.6,.14]),Oi={U:[[1,,1],[1,,1],[1,,1],[1,,1],[,1,1]],N:[[1,1],[1,,1],[1,,1],[1,,1],[1,,1]],B:[[1,1,1],[1,,1],[1,1],[1,,1],[1,1,1]],L:[[1],[1],[1],[1],[1,1,1]],O:[[,1,1],[1,,1],[1,,1],[1,,1],[1,1]],C:[[,1,1],[1],[1],[1],[,1,1]],K:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]]},Ki=new class extends _{constructor(){super(),this.v=!1}play(){this.v||(super.Qa(),this.v=!0)}stop(){this.v&&(super.stop(),this.v=!1)}};((t,i,e,s,h=["tiles.png"])=>{function a(h=0){var r,o=h-Dt;for(Dt=h,Ct+=o/1e3,Bt+=o,Bt=Math.min(Bt,50),n(),h=0,Bt<0&&-9<Bt&&(h=Bt,Bt=0);0<=Bt;Bt-=1e3/60)jt=kt++/60,q||document.hasFocus()||(V=[[]]),O=B(),$(),t(),Ft(),i(),J();for(r of(Bt+=h,P=l(z.width,z.height),S.imageSmoothingEnabled=!1,function(){yt.viewport(0,0,ct.width=z.width,ct.height=z.height),yt.clear(16384),yt.useProgram(xt),yt.activeTexture(33984),yt.bindTexture(3553,gt=k[0].ua);let t=vt=bt=0,i=(i,e,s,h)=>{i=yt.getAttribLocation(xt,i);var a=s&&44,n=s&&1,r=1==s;yt.enableVertexAttribArray(i),yt.vertexAttribPointer(i,h,e,r,a,t),yt.vertexAttribDivisor(i,n),t+=h*s};yt.bindBuffer(34962,ft),i("g",5126,0,2),yt.bindBuffer(34962,dt),yt.bufferData(34962,44e4,35048),i("p",5126,4,4),i("u",5126,4,4),i("c",5121,1,4),i("a",5121,1,4),i("r",5126,4,1),i=l(64).ha(P);var e=l(-1).o(p.multiply(i));yt.uniformMatrix4fv(yt.getUniformLocation(xt,"m"),!1,new Float32Array([i.x,0,0,0,0,i.y,0,0,1,1,1,1,e.x,e.y,0,0]))}(),e(),Tt.sort((t,i)=>t.X-i.X),Tt))r.D||r.G();s(),function(){var t;Mt.length&&(t=Mt[0],ut?5<Ct-ut?(ut=0,Mt.shift()):t.G():ut=Ct)}(),wt&&zt(),requestAnimationFrame(a)}function n(){var t,i;v.x?(z.width=v.x,z.height=v.y,t=innerWidth/innerHeight,i=z.width/z.height,(ct||z).style.width=z.style.width=E.style.width=t<i?"100%":"",(ct||z).style.height=z.style.height=E.style.height=t<i?"":"100%"):(z.width=Math.min(innerWidth,w.x),z.height=Math.min(innerHeight,w.y)),E.width=z.width,E.height=z.height,P=l(z.width,z.height)}document.body.style.cssText="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none",document.body.appendChild(z=document.createElement("canvas")),S=z.getContext("2d"),function(){ct=document.createElement("canvas"),yt=ct.getContext("webgl2"),document.body.appendChild(ct);var t=yt.createProgram();yt.attachShader(t,At("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",35633)),yt.attachShader(t,At("#version 300 es\nprecision highp float;in vec2 v;in vec4 d,e;uniform sampler2D s;out vec4 c;void main(){c=texture(s,v)*d+e;}",35632)),yt.linkProgram(t),xt=t,t=new ArrayBuffer(44e4),mt=new Float32Array(t),pt=new Uint32Array(t),dt=yt.createBuffer(),ft=yt.createBuffer(),t=new Float32Array([wt=0,0,1,0,0,1,1,1]),yt.bindBuffer(34962,ft),yt.bufferData(34962,t,35044)}(),document.body.appendChild(E=document.createElement("canvas")),T=E.getContext("2d"),(ct||z).style.cssText=z.style.cssText=E.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",n(),h=h.map((t,i)=>new Promise(e=>{let s=new Image;s.onerror=s.onload=()=>{k[i]=new D(s),e()},s.src=t})),Promise.all(h).then(()=>{p=Si.scale(.5),v=l(720,1280),ri=Array.from(Array(10),()=>[]),qt=new m,Qt=new m,ii=new m,_t=new m,ti=new m,ei=new m,si=new m,hi=new m,ai=new m,ni=new m,li="title",di=1,mi=11,pi=12,fi=di,ui=oi=0,ci=10,Ai=l(0,0),zi=l(0,0),xi="B",gi=!1,yi=new Ot,new $t(l(-.5,0)),new $t(l(Si.x+.5,Si.y)),wi=new Ut(l(p.x,p.y+2.5),l(6,2),"PLAY"),vi=new Ut(p,l(6,2),"MUTE"),bi=new Ut(l(-5,1),l(2,2),"♫"),Mi=new Ut(l(-5,p.y+2.5),l(6,2),"MENU"),Bi.play(),a()})})(function(){switch(li){case"title":yi.D&&(yi=new Ot),Zt(),H("Enter")&&Vt(),H(0)&&new Lt,Ki.v&&Ki.stop(),bi.g=l(-5,1),vi.label=gi?"UNMUTE":"MUTE";break;case"play":var t,i,e,s;for(Zt(),d(ai)||ai.set(Wt[fi].time),d(Qt)||Qt.set(1),Wt[fi].F&&!d(ni)&&ni.set(a(0,Wt[fi].F)),jt>Qt.time&&(e=2*(t=a(0,10))+1,s=36-2*(i=ri[t].length+1),Wt[fi].s&&h(0,1)>Wt[fi].s&&ri[t].push(new Rt(l(e,s),1e3,t,2)),ri[t].push(new Rt(l(e,s),i,t,1)),Qt.set(h(.1,.8))),jt>ni.time&&(t=a(0,10),new Rt(l(2*t+1,36-2*ri[t].length),13,t,3),ni.set(a(0,Wt[fi].F))),t=0;t<10;t++)for(i=0;i<ri[t].length;i++)ri[t][i].type<3&&(ri[t][i].g.y=36-2*i);for(d(_t)||_t.set(2),jt>_t.time&&(new Ht,_t.set(2)),jt>ti.time&&(new Ht(1,"hard"),ti.set(a(Wt[fi].m.min,Wt[fi].m.max))),d(ti)||ti.set(5),H(0)&&new Lt,bi.g=l(1,1),bi.label=gi?" ̶♫̶":"♫",jt>ai.time&&(fi++,hi.set(1),li="clear"),t=0;t<10;t++)ri[t].length>pi&&(qt.set(1),hi.set(2),li="lost");gi||Ki.v||Ki.play();break;case"clear":for(t=0;t<10;t++)for(i=0;i<ri[t].length;i++)ri[t][i].j();jt>hi.time&&(hi.set(1.5),li=fi===mi?"win":(gi||Hi.play(),"stage"));break;case"stage":gi||Ki.v||Ki.play();break;case"win":case"over":H(0)&&new Lt,Xt(!0),bi.g.x=-5,Mi.g.x=p.x;break;case"lost":for(t=0;t<10;t++)for(i=0;i<ri[t].length;i++)ri[t][i].V=13;if(d(ai)&&(ai.time=void 0),Ki.v&&Ki.stop(),jt>qt.time){for(t=0;t<10;t++)for(i=0;i<ri[t].length;i++)ri[t][i].j();jt>hi.time&&(gi||Li.play(),li="over")}}},function(){},function(){G(p,l(21.1,50),ki),G(p,l(21,50),Pi),G(p,l(20.2,50),ji),G(p,l(20.1,50),Pi)},function(){switch(li){case"title":for(var t=P.x/2,i=P.y/2,e=(R(l(p.x-1,p.y-7.5),l(1.2),j(2),Di),U("x "+ci,l(t,i+240),32,ki,void 0,void 0,"left"),t="PRESS SPACE",i="PRESS LEFT CLICK",q&&(t="TOUCH THE SCREEN",i="SWIPE UP"),U(t,l(P.x/2,P.y/2+130),32,ki),U(i,l(P.x/2,P.y/2+185),32,ki),U("2024. ISAAC BENITEZ.",l(P.x/2,P.y/2+585),28,ki),t=l(.65,.6),d(si)||si.set(.5),jt>si.time&&(i=a(0,7),xi="UNBLOCK".charAt(i),si.set(h(.7,2)),gi||Ii.play(l(4*i,30))),0),s=0;s<7;s++){var n=Oi["UNBLOCK".charAt(s)],r=(i="UNBLOCK".charAt(s)===xi?Pi.ma(ki,f(si)-.01):ki,0),o=0;for(let s=n.length-1;0<=s;s--){var u=n[s];for(let s=0;s<u.length;s++)u[s]&&G(l(1.5+e+s*t.x,30+r),t,i);o=Math.max(o,u.length*t.x),r+=t.x}e+=t.x+o}break;case"play":case"lost":case"clear":Jt(),G(l(10*f(ai),37.3),l(20*f(ai),.5),Ci);break;case"stage":if(Jt(),U("STAGE "+fi+" / 10",l(P.x/2,P.y/3.5),45,ki),jt>hi.time){for(t=Wt[fi],i=0;i<10;i++)for(e=0;e<t.level[i].length;e++)n=2*i+1,r=36-2*(s=ri[i].length),3===(o=t.level[i][e])?new Rt(l(n,r),13,i,o):2===o?ri[i].push(new Rt(l(n,r),1e3,i,o)):ri[i].push(new Rt(l(n,r),s+1,i,o));ai.set(Wt[fi].time),li="play"}break;case"win":Kt("WELL DONE!",ki);break;case"over":Kt("GAME OVER",ji)}})</script>