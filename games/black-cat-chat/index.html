<!doctype html><title>Black Cat Chat - js13kGames 2025</title><style>body,html{margin:0;padding:0;font-family:monospace;background-color:#111;color:#fff;height:100vh;overflow:hidden;position:relative}.cat-background{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden}.cat-silhouette{position:absolute;width:80px;height:80px;opacity:1;pointer-events:none}#app{display:flex;height:100vh;max-width:1200px;margin:0 auto;position:relative;z-index:1}#chat-container{display:flex;flex-direction:column;flex:1;padding:10px;box-sizing:border-box;min-width:0}#sidebar{width:200px;background:#1a1a1aaa;border-left:1px solid #333;padding:10px;box-sizing:border-box}#messages{flex:1;overflow-y:auto;padding:10px;border:1px solid #333;background:#222a;margin-bottom:10px;border-radius:4px}.message{margin:8px 0;padding:8px;border-left:3px solid #0f8;background:#333;border-radius:3px}.message.own{border-left-color:#08f;background:#2a2a3a;margin-left:20px}.message.system{border-left-color:#f80;font-style:italic}.message-header{display:flex;justify-content:flex-start;align-items:center;margin-bottom:4px;gap:8px}.message-time{font-size:11px;color:#888;font-weight:400}.message-content{line-height:1.3;color:#ccc}#input-area{display:flex;gap:10px;margin-bottom:5px}#message-input{flex:1;padding:10px;background:#333;border:1px solid #555;color:#fff;border-radius:4px;font-family:monospace}#send-btn{padding:10px 20px;background:#0f8;color:#000;border:none;border-radius:4px;cursor:pointer;font-family:monospace;font-weight:700}#send-btn:hover{background:#0a6}#send-btn:disabled{background:#555;cursor:not-allowed}#connection-status{text-align:center;padding:8px;font-size:12px;color:#f80;background:#2a2a2a;border-radius:4px;margin-bottom:10px;border:1px solid #444}.user-item.self{border-left-color:#08f;background:#2a2a3a;font-weight:700;display:flex;align-items:center;justify-content:space-between}.user-edit-btn{background:0 0;border:none;color:#08f;cursor:pointer;font-size:10px;padding:2px 4px;border-radius:2px;margin-left:5px}.user-edit-btn:hover{background:#333}.user-name-input{background:#333;border:1px solid #08f;color:#fff;border-radius:2px;font-family:monospace;font-size:12px;padding:2px 4px;width:80px}#users-list{height:100%}.users-header{font-weight:700;margin-bottom:10px;padding:8px;background:#333;border-radius:4px;text-align:center;color:#0f8}.user-item{padding:5px 8px;margin:2px 0;background:#2a2a2a;border-radius:3px;border-left:3px solid #555;font-size:12px}@media (max-width:768px){#app{flex-direction:column}#sidebar{width:100%;height:150px;border-left:none;border-top:1px solid #333;order:2}#chat-container{order:1}.users-header{font-size:12px;padding:5px;margin-bottom:5px}.user-item{display:inline-block;margin:2px;padding:3px 6px;font-size:11px}}</style><div id=app><div id=chat-container><div id=messages></div><div id=input-area><input id=message-input maxlength=200 placeholder="Type your message..."><button id=send-btn>Send</button></div></div><div id=sidebar><div id=connection-status>Disconnected</div><div id=users-list></div></div></div><script>function e(){try{h=new WebSocket("wss://relay.js13kgames.com/black-cat-chat"),h.onopen=()=>{a("Connected","#0f8"),g=0,i.disabled=!1,s("Connected to chat server"),v=setInterval(()=>{if(h&&h.readyState===WebSocket.OPEN){const e={id:""+Date.now(),t:p,message:u,timestamp:Date.now(),type:"ping"};h.send(JSON.stringify(e))}},3e3),C=setInterval(()=>{(()=>{const e=Date.now();let t=!1;for(const[n,s]of f)e-s.o>1e4&&(f.delete(n),t=!0);t&&c()})()},2e3)},h.onmessage=e=>{try{"system"===(t=JSON.parse(e.data)).type?s(t.message):"ping"===t.type?(e=>{if(e.t===p)return;const t=e.message.slice(0,10);f.set(e.t,{id:e.t,o:e.timestamp,displayName:t}),c()})(t):"leave"===t.type?(e=>{e.t!==p&&f.get(e.t)&&(f.delete(e.t),c())})(t):n(t.t,t.message,t.timestamp)}catch(e){console.error("Failed to parse message:",e)}var t},h.onclose=()=>{a("Disconnected","#f80"),i.disabled=!0,s("Disconnected from server"),v&&(clearInterval(v),v=null),C&&(clearInterval(C),C=null),f.clear(),c(),5>g?(g++,a(`Reconnecting... (${g}/5)`,"#ff0"),setTimeout(()=>{e()},2e3*g)):(a("Connection Failed","#f44"),s("Max reconnection attempts reached"))},h.onerror=e=>{console.error("WebSocket error:",e),s("Connection error occurred")}}catch(e){console.error("Failed to connect:",e),a("Connection Failed","#f44"),s("Failed to connect to server")}}function t(){const e=r.value.trim();if(!e||!h||h.readyState!==WebSocket.OPEN)return;const t={id:""+Date.now(),t:p,message:e,timestamp:Date.now(),type:"user"};n(t.t,t.message,t.timestamp),h.send(JSON.stringify(t)),r.value=""}function n(e,t,n){const s=document.createElement("div"),a=e===p;s.className=a?"message own":"message";const c=new Date(n).toLocaleTimeString([],{i:"2-digit",l:"2-digit",u:!1}),r=t.length>200?t.slice(0,200)+"...":t;let i;if(a)i="You";else{const t=f.get(e);i=t?t.displayName:e.split("_")[1]||e}s.innerHTML=`\n      <div class="message-header">\n        <strong>${i}</strong> <span class="message-time">${c}</span>\n      </div>\n      <div class="message-content">${(e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML})(r)}</div>\n    `,l.appendChild(s),o()}function s(e){const t=document.createElement("div");t.className="message system",t.textContent=e,l.appendChild(t),o()}function a(e,t){d.textContent=e,d.style.color=t,d.style.display="Connected"===e?"none":"block"}function o(){l.scrollTop=l.scrollHeight}function c(){const e=`Online (${f.size+1})`;if(y)return;let t=document.createElement("div");t.innerHTML=`<div class="users-header">${e}</div>`;const n=document.createElement("div");n.className="user-item self";const s=document.createElement("span");s.textContent=u+" (You)";const a=document.createElement("button");a.className="user-edit-btn",a.textContent="✏️",a.title="Edit name",a.addEventListener("click",()=>{((e,t,n)=>{y=!0;const s=document.createElement("input");s.className="user-name-input",s.type="text",s.value=u,s.maxLength=10;const a=()=>{y=!1;const a=s.value.trim();a.length>0&&(e=>{const t=e.trim();if(0===t.length)return;const n=t.slice(0,10);u=n,localStorage.setItem("chat-display-name",n),y||c()})(a),t.textContent=u+" (You)",e.replaceChild(t,s),e.appendChild(n),c()};s.addEventListener("keypress",o=>{"Enter"===o.key?a():"Escape"===o.key&&(y=!1,t.textContent=u+" (You)",e.replaceChild(t,s),e.appendChild(n))}),s.addEventListener("blur",a),e.replaceChild(s,t),e.removeChild(n),s.focus(),s.select()})(n,s,a)}),n.appendChild(s),n.appendChild(a),t.appendChild(n);const o=Array.from(f.values()).sort((e,t)=>e.displayName.localeCompare(t.displayName));for(const e of o){const n=document.createElement("div");n.className="user-item",n.textContent=e.displayName,t.appendChild(n)}m.innerHTML="",m.appendChild(t)}let l,r,i,d,m,p,u,h=null,g=0,y=!1,f=new Map,v=null,C=null;document.addEventListener("DOMContentLoaded",()=>{p="user_"+Math.random().toString(36).substr(2,9),u=(()=>{const e=localStorage.getItem("chat-display-name");if(e)return e.slice(0,10);const t=["Shadow","Midnight","Silent","Swift","Dark","Sleek","Mystic","Sneaky"][Math.floor(8*Math.random())]+["Cat","Kitten","Feline","Paws","Whiskers","Panther","Lynx","Tiger"][Math.floor(8*Math.random())];return localStorage.setItem("chat-display-name",t),t})(),l=document.getElementById("messages"),r=document.getElementById("message-input"),i=document.getElementById("send-btn"),d=document.getElementById("connection-status"),m=document.getElementById("users-list"),(()=>{const e=document.createElement("div");e.className="cat-background",document.body.appendChild(e);const t=[];for(let n=0;40>n;n++){let n=!1,s=0,a=0,o=0,c=1;for(;!n&&50>s;){a=Math.random()*(window.innerWidth-160),o=Math.random()*(window.innerHeight-160),c=1+Math.random();const e=80*c/2;let l=!1;for(const n of t)if(120+e+80*n.scale/2>Math.sqrt(Math.pow(a-n.x,2)+Math.pow(o-n.y,2))){l=!0;break}l||(n=!0,t.push({x:a,y:o,scale:c})),s++}if(!n)continue;const l=document.createElement("div");l.className="cat-silhouette";const r=30*(Math.random()-.5),i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 512 512"),i.style.width="100%",i.style.height="100%";const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("fill","#222"),d.setAttribute("d","m463 37-30 51-7-3c-27-8-72-7-98 1l-7 2-28-49c-34 69-33 118-15 149 18 33 57 49 99 48 49-1 89-20 107-54 17-32 16-81-21-145zM324 138c18 0 29 15 31 36-37 18-54 4-61-26 12-7 22-10 30-10zm109 0c9 0 19 3 30 10-7 30-24 44-61 26 2-21 13-36 31-36zm-293 51h-4c-30 0-56 10-76 26-43 36-57 101-13 166 21 34 45 55 71 65 33 12 67 8 100 4 33-5 66-11 97-9s62 10 91 41c19 22 46-1 23-24-35-34-72-47-109-50-37-2-72 5-104 9-32 5-60 7-85-2-14-6-28-15-41-31h351c14-53 15-107 2-142-19 8-42 12-66 13-30 0-59-7-83-23a426 426 0 0 0-14 10l-6 4-5-5c-47-37-91-52-129-52z"),d.setAttribute("transform","translate(0 1)"),i.appendChild(d),l.appendChild(i),l.style.left=a+"px",l.style.top=o+"px",l.style.transform=`rotate(${r}deg) scale(${c})`,e.appendChild(l)}})(),c(),i.addEventListener("click",()=>t()),r.addEventListener("keypress",e=>{"Enter"===e.key&&t()}),window.addEventListener("beforeunload",()=>{(()=>{if(h&&h.readyState===WebSocket.OPEN){const e={id:""+Date.now(),t:p,message:u,timestamp:Date.now(),type:"leave"};h.send(JSON.stringify(e))}})()}),e()});</script>