<html><head><title>13 Steps to Escape - js13kGames 2024</title><meta name=viewport content="width=device-width"><style>body{margin:0;padding:0;overflow:hidden;height:100%;width:100%;display:flex}body:not(.editor){#editor{display:none}}body:not(.cS){.-cS{display:none}}#game{position:relative;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}#gBC{position:absolute;top:-5%;left:-5%;width:110%;height:110%;object-fit:cover;filter:blur(15px) brightness(50%)}#editor{width:100%;height:0;z-index:1;display:flex;justify-content:space-around}select,button{transform:translateY(-50%);height:24px}</style></head><body oncontextmenu="return!1"><canvas id="gBC"></canvas><div id="game"><div id="editor"><select id="eTS"></select> <select id="eOS"><option value="0">Up</option><option value="1">Right</option><option value="2">Down</option><option value="3">Left</option></select> <button id="eTLB">Test/Share</button></div><canvas id="uC"></canvas><canvas id="gC"></canvas><script>let e=e=>document.querySelector(e),M=(e,M)=>localStorage.setItem(e,M),t=(e,M=null)=>(e=localStorage.getItem(e))?JSON.parse(e):M,r=Math.min,n=Math.max,i=t("cD")||{g:0,s:0,h:0,o:0};const l={bG:["#024d53","#599dbc","#72d1c7","#a9ffe6"],crate:["#011721","#893a25","#f89e61","#c16c43"],g:["#011721","#527f67","#a2ce69","#d6f8e1"],s:["#e5d09e","#cab168"],br:["#011721","#811c07","#ca6137","#ffb59c"],si:["#011721","#014a5d","#7ddbff","#d0ffea"],go:["#011721","#5e3718","#d8aa3b","#fdffaa"],p:["#341b2e","#6a5979","#937cb2","#afbeff"]},a="#f5ff40",o="#011721",c=["#f9ece6","#f0d3c5","#e3b38d","#bc8d57","#a96c4f","#704733"],Y=["#dfa245","#9e6631","#ac422a","#998880","#e4e1ce","#53381a","#270e11"],N=["#d14244","#f1592a","#fbd54e","#017949","#c9dfed","#1b4872","#724559"],s={arrow:{r:"16LKZLA\\K^LZLBZLBZLLLLLLLLLLLLG",co:l.bG,l:0,iS:!0},block:{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:l.bG,cCO:!0},"block-trigger":{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:l.g,cCO:!0},boulder:{r:"16LIRHNgqYqNEMgsZrMCMfrYrZsMBMesYqZtMAMfYrYq^qNfZqZuZNerYrYvYN]q[tYNtYs^MAMs[uYMBM\\q[q[MCMtYq\\MENs[NHRE",co:l.crate},crate:{r:"16AXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYO[MZM]OYNYMYNYPYNYMZMYNYMZMYNYPYNYMYNYO]MZM[NAXNA",co:l.crate},flag:{r:"48DYLCYLCYLBZLBZLBZLCMgLMlGMlGMkHMkHMkHMkHMkHMkHMkHMkHMkHMkHMlGMkHMFfGMLCMChHMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLBZLBZLBZK",co:l.br,l:1},"gong-trigger":{r:"16XQsevesNqfTfqNfOhNgNfNeteNfNfMeqPqeMfMAMeMeqMrMqeMeMBMeMeqPqeMeMBMeNeteNeMBMeMAMhMAMeMBMeMBPBMeMBMeMHMeMBMeMHMeMBMeMAQBMeMBMeMBQAMeMBOHOA",co:[l.br,l.si,l.go,l.p],uOFC:!0,iS:!0},gong:{r:"16F\\JZtZGYfvYEZe^rYC\\jYrYB[lYqYBZnZBYhthYBYgq\\qgYBYgqYrYqgYBYgq\\qgYBZgtgZBeZlZeCeZjZeEe`eGlD",co:[l.br,l.si,l.go,l.p],uOFC:!0},"hole-filled":{r:"16LLLAMANAMFXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYMAM[MZM]MCMAYMYNYNAMLF",co:l.crate},hole:{r:"16LLLYA\\AYGbEYA`AYDdCYAbAYB\\MYNYM\\A\\MYMZMYM\\AZMYMYNYMYMZCZTZCZMYRYMZCZTZEYTYHRLI",co:["#000","#00506e"]},"key-holder":{r:"16LFdCYpYAZ{e\\qbe\\qYeYhYeYe\\qZfZfZe\\qYgZgYe\\qYgYhYe\\qZfZfZe\\qYeYhYeYe\\qbe\\oq[edqZpfYAdZA",co:l.bG,l:0,iS:!0},key:{r:"16FtKqPqIqMhMqHqMYNeMqHqMYNeMqHqM\\MqIqNYMqJqMeYMqJqNYMqJqMZMqKqNqLArLLLLLK",co:l.g},lock:{r:"16FPKMtMIMq\\qMGMZhYqMEMZeqNYeYqMCNYeqPYeYqMAOYeqPYeYrPYfqNYfYrO[eqNYeYfqMYM\\ereYgMYAYM\\fYgMYCYM[MYgMYEYMYMfYeMYGYMhMYIYPYK\\F",co:l.g},rock:{r:"16FPIOhNFMeresfMDMerYeueMCMfqZesfqMBMgqZgYfMBMiYgZNBNYkZqNBNYiZsMBMqgriqMAMqeqYgqMYgMAMYfqMYeqMYgMAMZeqMYfNYfMAOZNYPYMqBPEOLF",co:l.bG,iS:!0},"spawn-current":{r:"16E\\LBYAYJZBYAYJZAYAYJYAYBYBYD[F[AYAYEZCYBZAZB\\AYB\\BYA\\BZAZBYCZEYAYA[F[DYBYBYAYJYAYAZJYAYBZJYAYLB\\E",co:l.bG,l:1},spawn:{r:"32E\\L\\LBYAYLAYAYJZBYAYIZBYAYJZAYAYJZAYAYJYAYBYBYGYAYBYBYD[F[AYB[F[AYAYEfCYBYAYErCYBZAZBhAYB[AZBtAYB\\BYAhBZA[BYAtBZAZBYCfEYAYBYCrEYAYA[F[BYA[F[DYBYBYAYGYBYBYAYJYAYAZJYAYAZJYAYBZIYAYBZJYAYLAYAYLB\\L\\E",co:l.bG},trap:{r:"16DNANANGVEQfQCNYM[N[NBMeMfYfMfMeMANZM\\e\\OeMfMYgMfMeO]N]OgNgMeYgN\\eYM]eYOeMeOgYfNAeZN[M[MeBNYeMgMfOCO[fZNFQfMJPF",co:["#306710","#000","#b1712e"]},s:{r:"16ZMYV]MYV]MYW\\MYMYU^MYU^MZU^MZV]MYV]XM\\XM\\X[XN[XM\\X]XZ",co:l.s,l:0},characters:{r:"144FPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFMlMGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMe[eZeMEMe]gMFMlMFMlMEMmMFMlMFMlMEMmMFMlMEMYe^eYMEM]fNEMYlYMEMeZe[eMEMe]gMFMlMFMeZe[eMEMe]gMFMlMFMZMZMZMFMYM[eMYMFMlMEMYe^eYMEM]fNEMYlYMDMYe^eYMEM]fNEMYlYMFMYMZMYMGMYM]MHMjMGMZMZMZMFMYM[eMYMFMlMFMZMZMZMFMYM[eMYMFMlMFO\\OGM\\NHO\\OFNYMZMYNFMYM]MHNhNGNYMZMYNFMYM]MHNhNFMsPsMGPqMGMsPsMDMrM\\MrMFM\\NHMrPrMEMrM\\MrMFM\\OGMrPrMDMrMrZrMrMFNsMFMrMvMrMCOqPqMqYMEQqNFMYMvOCMYqMqPqOFQsMEOvMYMCMrMvMrMFMqMrMFMrMvMrMCMZMuNYMDMZtMYMFNuMZMCMYNuMZMEMYNrMqYMEMZMuNEMYTYMGMqMYNGMYTYMEUANEOtMHUDNAUGNtMYMFUGNvNHOYMINvNHMYNrMISHMrNYMIMrNYMJSIMYNrMHMZNZMIMZNJMZNZMJOZMHMZNZMHMZOJMZOJMZNZMJOZMJPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFNjNGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFNjNFMlMEMmMFNjNFMgYhMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMe^eMEMeZjMFMlMFMgYhMEMmMFMlMFMgYhMEMmMFMlMEMYe^eYMEM[hMeMDMYlYMEMe^eMEMeZjMFMlMFMe^eMEMeZjMFMlMFMeYMZMYeMFMYMYgMYMeMDMgNgMEMYe^eYMEM[hMeMDMYlYMDMYe^eYMEM[hMeMDMYlYMFMYMZMYMGMYMYfZMfMEMeMfMeMGMeYMZMYeMFMYMYgMYMeMDMgNgMFMeYMZMYeMFMYMYgMYMeMDMgNgMGN\\NHM\\NfMFNhNHMYMZMYMGMYMYfZMfMEMeMfMeMHMYMZMYMGMYMYfZMfMEMeMfMeMGMrPrMHSeMEMqMhMqMFMqM\\MqMGM\\NfMEMqMhMqMFMqM\\MqMGM\\NfMEMqMhMqMFMsZsMGMqNqMANFMrMfMrMFMqQqNHSfMDMqMgPFNqQqMGTfMDMqNgOEMYNtNYMFMrMYMHMYNqNqNYMEOtMZMFMrYNYODMZNeQEMZMtOGMsMZOEQeNZMCMZNtNZMFMqMYMGMZNtNZMCMZMtPFM[PFPqNqMZMDPtMZMEMYMrNYMFMZMqNqPDOZNZOGMZNHOZNZOEOYNZMIOqYMIMZNYOGMZNYOGMZNqNGOYNZMIMYNYMKMYMLMYNYMKOYMJMYNYMJMYOKMYOJMYOYMKOYME",co:["#000",c[i.s],Y[i.h],N[i.o]],l:0},spikes:{r:"16CMGMEeOiOeBeYMqM]MqMYeAYNeN[NeNYAYMgM[MgMYAYMgM[MgMYAYQ[QYAd[A[M_M[AZO]OZAZMqM]MqMZAYNeN[NeNYAYMgM[MgMYAYMgM[MgMYAYQ[QYBdYB",co:l.bG},"switch-off":{r:"16LLIpfBedeBeZxZeBeYzYeBeYs\\sYeBeYs\\sYeBeYs\\sYeBeYzYeBeYzYeBeZxZeBedeBpfLLI",co:[l.p,l.br,l.si,l.go],uOFC:!0},"switch-on":{r:"16CVEMexeMDMqftfqMCeMqeqPqeqMeBeMqeqPqeqMeBeMqeqPqeqMeBeMqftfqMeBeMexeMeBeNlNeBeMqZereZqMeBeMeqZfZqeMeBeMYerfreYMeBeNYe\\eYNeBeXeBiDiLE",co:l.p,co:[l.p,l.br,l.si,l.go],uOFC:!0},"switch-trigger":{r:"16Zp[pfYplTkMxMjMxMjMrPrMjMrPrMjMrPrMjMxMjMxMjM`MjYTYk`hYpf[pZ",co:l.p,co:[l.p,l.br,l.si,l.go],uOFC:!0},"sound-off":{r:"16LIOLMfMBMCMDMgMAMYMAMYMANhMAMYMAMYNjMBMYMYMAMjMBM[MAMeYeYeYMCMYMBMYeYeYeMCMYMBM^MBM[MAM^MBMYMYMBN\\MAMYMAMYMCM[MAMYMAMYMDMZMBMCMFOLL",co:l.p,l:0},"sound-on":{r:"16LIOLMfMBNGMgMAMfMDNhMBMfMBMjMCMfMAMjMDMeMAMeYeYeYMDMfNYeYeYeMDMfN^MDMeMAM^MCMfMBN\\MBMfMEM[MAMfMGMZMBNIOLL",co:l.g,l:0},star:{r:"16GNLAMZMLMZMKMeZeMJMereMEQeteRZfqMrMqfZMAMeYrMrMrYeMCMfvfMEMeqPqeMEMesNseMDMfvfMDMfZrZfMCMeZfNfZeMBMeYeNBNeYeMBPFPA",co:l.go,l:0}},f={flag:200,spawn:600},g=0,u=["","-6N-F-N-13N-3N-7N7Bz2CzMN7-2GAz-N2-6NLN-2N4-2N-6NHN-6E2-17A-2O","-2N-3N5-9N-E-J-MCxBx2By-7N-3N5-By-7N-3N5-N-5N3-E-P-2JE-N-5LJ2-E-N5-N-5N11HN-2F-2G-5Q5ON","ByBz2-ByBz-2NGN-3EQN2BxByBBzByBBzCzM-M-3N-N2ByBzNBByN2Bz2N-O-2Cz-CzLByN2BBxBy-NBN-E-2N-NQBxByNBFByN2BN2CN3-NQByBzNBBz2-NBN2-5NQByN3-N2-BN2JN5QBx8BNL-3HQ2P","-2NWzEMHx-3NLN2-5B-N4-O-2H-N-Bz3BxBFMVz-8N-3By-B-N2-8N-2Bz2-B-2N3Q4N4-2BBxBBz-N-9NBz3-4NM-2P-2Hx-2VzL-6NGxNG-2NLN3","-7Bz8N-3NT-4NEN5CN-2NWTEO-2Q-Q-4H-4NT-4Q-Q-5P-9NTN7MN-7V-2WN-6N3VN4UN3-3F-2N3GN4L-N2","-BxByBxGxNGy-4N-5L-CBxBVM-5N2HN5MNQN9QN4GCQO-9PQHy-FN-NQN6WN2QN5-NVN-4N-4N5-3N-4N-2E-HxLN7-4N-4N4","G-T6-DOH-2UxM-FN10-ND-N4-4N6-E-2N-7NWzVxHyEWx-E-2N-4D-2N2PNPN-N-2N-3N2-E-2EN3-N-2N-3LUz-7NHxN-TV-2GyWzT2JTJ-3NWNTGxT-N2","LUzH-N4WWxWy-2TWzT-4NPQ-2Vx-E-4T-3N3-N4-5N5OEW-VQ-2P-E-2M3-FN3-N2-D3-3N5-UzHxPQ2-6VxT4G-2N4-3E-2VyT4GxL-N2LHy-2EUy2-VzT4Gy"],h=[];u.forEach(e=>{e=R(e),h.push(e)});var d=function(){function G(e){return Math.sin(6.283184*e)}function k(e){return.003959503758*2**((e-128)/12)}var P,S,H,I,T,J=[G,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){return(e=e%1*4)<2?e-1:3-e}];this.init=function(e){S=(P=e).eP,H=0,I=e.rL*e.pL*(S+1)*2,T=new Int32Array(I)},this.generate=function(){for(var e,M,t,r,n,l,i,a=new Int32Array(I),c=P.sD[H],m=P.rL,o=P.pL,Y=0,s=0,N=!1,f=[],g=0;g<=S;++g)for(t=c.p[g],e=0;e<o;++e){for(var h=t?c.c[t-1].f[e]:0,u=(h&&(c.i[h-1]=c.c[t-1].f[e+o]||0,h<17)&&(f=[]),J[c.i[16]]),d=c.i[17]/512,A=2**(c.i[18]-9)/m,B=c.i[19],E=c.i[20],L=43.23529*c.i[21]*3.141592/44100,Z=1-c.i[22]/255,q=1e-5*c.i[23],p=c.i[24]/32,v=c.i[25]/512,O=6.283184*2**(c.i[26]-9)/m,x=c.i[27]/255,C=c.i[28]*m&-2,F=(g*o+e)*m,b=0;b<4;++b)if(M=t?c.c[t-1].n[e+b*o]:0){f[M]||(f[M]=function(e,M){for(var t,r,n,l,i=J[e.i[0]],a=e.i[1],c=e.i[3]/32,o=J[e.i[4]],Y=e.i[5],s=e.i[8]/32,N=e.i[9],f=e.i[10]*e.i[10]*4,g=e.i[11]*e.i[11]*4,h=e.i[12]*e.i[12]*4,u=1/h,d=-e.i[13]/16,A=e.i[14],B=m*2**(2-e.i[15]),E=new Int32Array(f+g+h),L=0,Z=0,q=0,p=0;q<f+g+h;q++,p++)0<=p&&(p-=B,n=k(M+(15&(A=A>>8|(255&A)<<4))+e.i[2]-128),l=k(M+(15&A)+e.i[6]-128)*(1+8e-4*e.i[7])),t=1,q<f?t=q/f:f+g<=q&&(t=(1-(t=(q-f-g)*u))*3**(d*t)),r=i(L+=n*t**c)*a,r+=o(Z+=l*t**s)*Y,N&&(r+=(2*Math.random()-1)*N),E[q]=80*r*t|0;return E}(c,M));for(var y=f[M],w=0,D=2*F;w<y.length;w++,D+=2)a[D]+=y[w]}for(w=0;w<m;w++)(n=a[r=2*(F+w)])||N?(l=L,B&&(l*=u(A*r)*d+.5),s+=(l=1.5*Math.sin(l))*(l=Z*(n-s)-(Y+=l*s)),n=3==E?s:1==E?l:Y,q&&(n=(n*=q)<1?-1<n?G(.25*n):-1:1,n/=q),N=1e-5<(n*=p)*n,i=n*(1-(l=Math.sin(O*r)*v+.5)),n*=l):i=0,C<=r&&(i+=a[r-C+1]*x,n+=a[r-C]*x),a[r]=0|i,a[1+r]=0|n,T[r]+=0|i,T[1+r]+=0|n}return++H/P.nC},this.createAudioBuffer=function(e){for(var M=e.createBuffer(2,I/2,44100),t=0;t<2;t++)for(var r=M.getChannelData(t),n=t;n<I;n+=2)r[n>>1]=T[n]/65536;return M},this.createWave=function(){var e=44+2*I-8,M=e-36,t=new Uint8Array(44+2*I);t.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&M,M>>8&255,M>>16&255,M>>24&255]);for(var r=0,n=44;r<I;++r){var l=T[r];t[n++]=255&(l=l<-32767?-32767:32767<l?32767:l),t[n++]=l>>8&255}return t},this.getData=function(e,M){for(var t=2*Math.floor(44100*e),r=new Array(M),n=0;n<2*M;n+=1){var l=t+n;r[n]=0<e&&l<T.length?T[l]/32768:0}return r}};const A={1:"010110010010111",2:"01101001001001001111",3:"11100001001100011110",4:"00110101100111110001",5:"11111000111100011110",6:"01101000111010010110",7:"11110001001000100010",8:"01101001011010010110",9:"01101001011100010110",0:"01101001100110010110",A:"01101001111110011001",B:"110101110101110",C:"011100100100011",D:"110101101101110",E:"111100111100111",F:"111100111100100",G:"01111000101110010110",H:"10011001111110011001",I:"111010010010111",K:"10011010110010101001",L:"100100100100111",M:"1000111011101011000110001",N:"10011101101110011001",O:"01101001100110010110",P:"11101001111010001000",R:"11101001111010101001",S:"01111000011000011110",T:"111010010010010",U:"10011001100110010110",V:"1000110001010100101000100",W:"1010110101101010101001010",Y:"10011001111100011110",Z:"11110001011010001111"," ":"000000000000000","!":"010010010000010",":":"000010000010000",x:"000000101010101"};function L(r){let n=0;for(let t=0;t<r.text.length;t++){var e=r.text.charAt(t),l=A[e],i=l.length/5;for(let M=0;M<5;M++)for(let e=0;e<i;e++)"1"===l[M*i+e]&&r.ctx.rect((r.x+(e+n+r.hspacing*t))*O*r.scale,(r.y+M)*O*r.scale,O*r.scale,O*r.scale);n+=i}}function B(e){var M={ctx:p,x:0,y:0,text:"",vspacing:0,hspacing:1,color:"#fff",scale:1,...e},t=M.text.split("\n"),r=5*O*M.scale;M.ctx.beginPath();for(let e=0;e<t.length;e++){var n=t[e],l=M.x,i=M.y+(r+M.vspacing*O*M.scale)*e;L({ctx:M.ctx,x:l,y:i,text:n,hspacing:M.hspacing,scale:M.scale})}M.ctx.fillStyle=M.color,M.ctx.fill()}const Z=e("#uC"),E=Z.getContext("2d"),q=e("#gC"),p=q.getContext("2d"),x=e("#gBC"),C=x.getContext("2d");let v,m="menu",O=1,F=0,w=0,y=[],b=1,D=e("#eTS"),k=e("#eOS"),G={x:-1,y:-1},P=document.createElement("audio"),H=new d,S=!1!==t("iSA"),I=1,T=u.length-1,J=[],Q=[];function z(e){e=function(M){var t="A".charCodeAt(0),r=[],e=parseInt(M.match(/^\d+/)[0],10);M=M.replace(/^\d+/,"");for(let e=0;e<M.length;++e){var n=M[e].charCodeAt(0)-t,l=Math.floor(n/12);r.push(...Array(n%12+1).fill(l))}return{pixels:r,imageWidth:e}}(s[e].r),Q=e.pixels;var r=e=function(M,t){var r=[];for(let e=0;e<M.length;e+=t)r.push(M.slice(e,e+t));return r}(e.pixels,e.imageWidth),n=[],M=r.length,l=r[0].length;for(let t=0;t<M;t+=16)for(let M=0;M<l;M+=16){var i=[];for(let e=0;e<16;e++)i.push(r[t+e].slice(M,M+16));n.push(i)}return n}function R(e){let M,t=[],r=0,n=0,l=0;const i=/([A-Z\-])([xyz]?)(\d*)/g;for(;null!==(M=i.exec(e));){const e=M[1],i=M[2]||"",o=parseInt(M[3]||"1",10),Y="-"===e?null:V(e),s=U(i);for(let e=0;e<o;e++){var a=l%18+1,c=Math.floor(l/18)+1;Y&&(t[["crate","boulder"].includes(Y)?"push":"unshift"]({tile:Y,x:a,y:c,o:s}),"spawn-current"===Y)&&(r=a,n=c),++l}}return{cIX:r,cIY:n,lD:t}}function U(e){switch(e){case"x":return 1;case"y":return 2;case"z":return 3;default:return 0}}function V(e){return Object.keys(s)[e.charCodeAt(0)-"A".charCodeAt(0)]}function j(e){let t="",r="",n="",l=0;for(let M=1;M<=8;M++)for(let e=1;e<=18;e++){var i=W((a=ce(e,M))?.tile),a=K(a?.o);i===r&&a===n?++l:(t+=r+n,1<l&&(t+=""+l),r=i,n=a,l=1)}return t+=r+n,1<l&&(t+=""+l),t.replace(/-[0-9]+$/,"")}function V(e){return Object.keys(s)[e.charCodeAt(0)-"A".charCodeAt(0)]}function W(e){return e?(e=Object.keys(s).indexOf(e),String.fromCharCode("A".charCodeAt(0)+e)):"-"}function K(e){return{1:"x",2:"y",3:"z"}[e]||""}function X(e){for(H.init(e);H.generate()<1;);return H.createWave()}function $(e,M=!1){P.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),P.loop=M,P.play()}function _(){P.play()}function ee(){P.pause()}function Me(){if(p.clearRect(0,0,q.width,q.height),"menu"===m&&(OM(),CM.forEach((e,M)=>{var t=30+12*M,r=M===vM;e.isDisabled=0===M&&!mM(),B({ctx:p,x:30,y:t,hspacing:2,text:e.text,color:r?a:e.isDisabled?"#999":o,scale:1.5})})),"cS"===m){if(OM(),B({ctx:p,x:30,y:45,hspacing:2,text:{g:"SELECT GENDER",s:"SELECT SKIN COLOR",h:"SELECT HAIR COLOR",o:"SELECT OUTFIT COLOR"}[dM[AM]],color:o,scale:1.5}),0===AM)hM.g.forEach((e,M)=>{B({ctx:p,x:50,y:70+15*M,hspacing:2,text:e.toUpperCase(),color:M===vM?a:o,scale:1.2})});else{var r=hM[dM[AM]],n=i[dM[AM]];const t=6*O;r.forEach((e,M)=>{p.beginPath(),p.arc(50*O+M*(3*t),92*O,t,0,2*Math.PI),p.fillStyle=e,p.fill(),M===n&&(p.lineWidth=2,p.strokeStyle=a,p.stroke())})}Xe(2),qe=3,ve=14,me=5,je()}if("lS"===m){OM();for(let e=1;e<=T;e++){var M=e===I;pM(e,50+(e-1)%4*60,20+35*Math.floor((e-1)/4),50,M)}t("completedLevelList")?.length>=T&&(B({ctx:p,x:75,y:65,text:"CONGRATULATIONS!",color:a,scale:1.5}),B({ctx:p,x:80,y:132,text:"YOU ESCAPED ALL LEVELS WITHIN 13 STEPS!",color:a}),B({ctx:p,x:55,y:145,text:"CREATE AND SHARE YOUR OWN LEVELS USING LEVEL EDITOR",color:a}),ie(s.star.tiles[0],s.star.co,2,7,{scale:2}),ie(s.star.tiles[0],s.star.co,17,7,{scale:2}))}"editor"===m&&(te(b),BM()),"game"===m&&(te(b),je());{E.fillStyle=o,E.fillRect(0,0,Z.width,Z.height),ie(s[r=S?"sound-on":"sound-off"].tiles[0],s[r].co,18.8,.1,{context:E});let e="",M=1.5;if("menu"===m&&(e="13 STEPS TO ESCAPE"),"cS"===m&&(e="CHARACTER CUSTOMIZATION"),"game"===m&&(e="STEPS",M=1),"editor"===m&&(e="TILE:",M=1),"lS"===m&&(e="LEVEL SELECTION"),B({ctx:E,x:10,y:1===M?6:3.33,text:e,scale:M}),"editor"===m&&B({ctx:E,x:92,y:6,text:"ORIENTATION:"}),"game"===m){let e=0,M=0;10<=Ve&&(e=de(r=Ve-9),M=de(r)),B({ctx:E,x:25+e,y:3+M,text:""+(13-Ve),color:Ae(Ve),scale:1.5}),ie(s.key.tiles[0],s.key.co,4.5,.2,{context:E}),B({ctx:E,x:120,y:6,text:"LEVEL: "+b}),B({ctx:E,x:90,y:6,text:"x"+F}),B({ctx:E,x:220,y:3,text:"E: UNDO"}),B({ctx:E,x:220,y:10,text:"R: RESET"})}}}function te(e){p.drawImage(x,0,0,q.width,q.height),ne(h[e].lD)}function re(e,M,t=p){var r=s[e].tiles[0],n=s[e].co,l=s[M].tiles[0],i=s[M].co;for(let M=0;M<10;M++)for(let e=0;e<20;e++)ie(r,n,e,M,{context:t}),0!==e&&19!==e&&0!==M&&9!==M||ie(l,i,e,M,{context:t});"game"===m&&ne(h[b].lD,!0),t===p&&C.drawImage(q,0,0,x.width,x.height)}function ne(e,t=!1,r=p){e.forEach(e=>{var M=s[e.tile];if(t&&"key"===e.tile){const t=s["key-holder"];ie(t.tiles[0],t.co,e.x,e.y,{context:r})}"game"===m&&(t&&!M.iS||!t&&M.iS)||ie(M.tiles[e.animationFrame||0],e.color||s[e.tile].co,e.x,e.y,{o:e.o||g,scale:e.scale||1,uOFC:s[e.tile].uOFC,context:r})})}function ie(t,r,e,M,n={}){var{o:n=g,scale:l=t.scale||1,context:i=p,flipHorizontally:a=!1,alpha:c=1,uOFC:o=!1}=n,Y=(i.save(),16*O/2);i.translate(Math.floor(16*(e+.5)*O),Math.floor(16*(M+.5)*O)),i.scale(l*(e=a?-1:1),l),o?r=r[n]:i.rotate(n*Math.PI/2),i.translate(-Y,-Y);for(let M=0;M<t.length;M++)for(let e=0;e<t[M].length;e++){const n=t[M][e];0<n&&(i.fillStyle=r[n-1],i.globalAlpha=c,i.fillRect(e*O,M*O,O,O))}i.restore()}function le(e){b=e,re("s","rock"),h[b].initialData=JSON.parse(JSON.stringify(h[b].lD)),Ve=0,F=0,v=[],xe=h[b].cIX,Ce=h[b].cIY,ve=xe,me=Ce,Xe(2),qe=1}function ae(){h[b]?.initialData&&(h[b].lD=JSON.parse(JSON.stringify(h[b].initialData))),le(b)}function oe(e,M){return 1<=e&&e<19&&1<=M&&M<9}function ce(e,M,t=[],r=b){let n=null,l=h[r].lD;for(const r of l)r.x!==e||r.y!==M||0<t.length&&!t.includes(r.tile)||(n=r);return n}function Ye(e=[],M=b){var t=[],r=h[M].lD;for(const M of r)0<e.length&&!e.includes(M.tile)||t.push(M);return t}function Ne(M,t,r){h[b].lD=h[b].lD.filter(e=>e.tile!==M||e.x!==t||e.y!==r)}function se(e,M,t,r={}){h[b].lD[r.isUnder?"unshift":"push"]({tile:e,x:M,y:t,...r})}function fe(e,M,t){Fe=e,Le=e.x,Be=e.y,Ze=M,Ee=t,we=0}function ge(t,r,e,M){ue("block-trigger",t,r),ue("block",t,r),uM("block");const n=t+e,l=r+M,i=ce(n,l)?.tile;if("block"===i){const t=h[b].lD.find(e=>e.x===n&&e.y===l&&"block"===e.tile);if(t){const r=t.o||g;let e=0,M=0;3===r?e=-1:1===r?e=1:r===g?M=-1:2===r&&(M=1),setTimeout(()=>{ge(n,l,e,M)},120)}}}function ue(M,t=null,r=null,n=null,l=()=>{},i=225){h[b].lD.filter(e=>!(e.tile!==M||null!==t&&e.x!==t||null!==r&&e.y!==r||null!==n&&e.o!==n)).forEach(e=>{e.isBeingRemoved=!0,e.scale=1,e.elapsed=0,e.removalDuration=i,e.removeCallback=l})}function he(t){var e=Ye("switch-on"),M=Ye("switch-off");e.forEach(e=>{e.o===t&&(e.tile="switch-off")}),M.forEach(e=>{var M;e.o===t&&(e.tile="switch-on",M=ce(e.x,e.y,["crate","boulder"]))&&(ue(M.tile,e.x,e.y),uM("fall"))})}function de(e){return e*=.5,Math.random()*e-e/2}function Ae(e){return e<11?"rgb(255, 255, 255)":e<12?"rgb(255, 255, 0)":e<13?"rgb(255, 165, 0)":"rgb(255, 0, 0)"}for(const e in s)s[e].tiles=z(e);Z.addEventListener("click",function(e){e.offsetX>288*O&&(S=!S,M("iSA",S),(S?_:ee)())});let Le,Be,Ze,Ee,qe,pe,xe,Ce,ve,me,Oe,Fe=null,we=0;function ye(e,M,t,r,n){let l=!1;switch(n?.tile){case"crate":case"boulder":(function(M,e,t,r,n){let l=1,i=("boulder"===M&&(l=20),0);for(;i<l;){var a=e+(i+1)*r,c=t+(i+1)*n,o=ce(a,c)?.tile||null;if(!oe(a,c)||null!==o&&!["arrow","hole","trap","hole-filled","switch-off","switch-trigger","spikes"].includes(o))break;i++}if(0<i)for(const l of h[b].lD)if(l.x===e&&l.y===t&&l.tile===M){fe(l,e+i*r,t+i*n);for(let e=1;e<i;e++)setTimeout(()=>{uM(M)},125*e);return 1}})(n?.tile,e,M,t,r)&&(l=!0,i=ce(e,M,["switch-trigger"]))&&he(i.o);break;case"lock":0<F&&(l=!0,ue("lock",e,M,null,()=>{F--}));break;case"trap":break;case"block-trigger":var i=n.o||g;(3===i&&-1===t||1===i&&1===t||i===g&&-1===r||2===i&&1===r)&&(l=!0,ge(e,M,t,r));break;case"gong-trigger":n.triggered||(l=!0,n.triggered=!0,ue("gong",null,null,n.o))}return l}function be(){var e={lD:JSON.parse(JSON.stringify(h[b].lD)),stepsPerformed:Ve,cKN:F,cX:ve,cY:me,cDi:pe};0!==v.length&&JSON.stringify(e.lD)===JSON.stringify(v[v.length-1].lD)||v.push(e)}function De(e){switch(e){case"ArrowUp":case"z":case"w":return"up";case"ArrowDown":case"s":return"down";case"ArrowLeft":case"q":case"a":return"left";case"ArrowRight":case"d":return"right";case"Enter":return"action";case" ":case"Control":case"e":return"undo";case"Alt":case"r":return"reset";case"Escape":return"menu";default:return e}}let ke,Ge,Pe,He,Se,Ie,Te,Je,Qe=ve,ze=me,Re=ve,Ue=me,Ve=0;function je(){ie(s.characters.tiles[ke+9*i.g],s.characters.co,ve,me,{scale:qe,flipHorizontally:1===pe})}function We(e,M,t){var n,l,i,a,c;Pe||Oe||Fe||(n=ve+e,l=me+M,Xe(t),[t,e,M=0,i=0]=[n,l,e,M],Fe)||Oe||Pe||!(oe(t,e)?(c=(a=ce(t,e))?.tile||null,(!a||!a.isBeingRemoved)&&(j(h[b].lD),(t=ye(t,e,M,i,a))&&(be(),uM(c)),[null,"arrow","key","key-holder","flag","trap","hole","spikes","hole-filled","spawn","spawn-current","switch-trigger","switch-off"].includes(c)||(t?(++Ve,NM=!0,_e(ve,me,t)):uM("wall"),0))):(uM("wall"),0))||(be(),Ve<13&&(Oe=!0,Qe=ve,ze=me,Re=n,Ue=l,Ge=0),Ve=r(Ve+1,13))}function Ke(e=null,M=null){uM("respawn"),Pe=!0,Se=ve,Ie=me,Te=e||xe,Je=M||Ce,He=performance.now()}function Xe(e){pe=e,ke=$e(pe)}function $e(e){switch(e){case g:return 2;case 1:case 3:return 1;case 2:return 0}}function _e(e,r,n){var l,i=ce(e,r,["trap","switch-trigger"]),a=ce(ve,me);switch(i?.tile){case"trap":n||"hole"===a?.tile||(uM("trap"),i.tile="hole");break;case"switch-trigger":he(i.o)}switch(a?.tile){case"hole":case"spikes":Ke(e,r),--Ve,uM("fall");break;case"flag":return y=[],(l=t("completedLevelList")||[]).includes(b)||(l.push(b),M("completedLevelList",JSON.stringify(l))),M("currentLevel",l=(b+1)%T),I=l,qM("lS"),!1;case"spawn-current":Ve=0;break;case"spawn":uM(ce(xe,Ce).tile="spawn"),a.tile="spawn-current",a.animationFrame=0,a.elapsed=0,xe=ve,Ce=me,Ve=0;break;case"switch-trigger":Ve<13&&he(a.o);break;case"key":Ne("key",ve,me),uM("key"),++F}13<=Ve&&(Ke(),setTimeout(()=>{Ve=0},400))}function eM(e){var t=e-w;if(h[b].lD.forEach(e=>{var M;1<s[e.tile].tiles.length&&(e.elapsed=(e.elapsed||0)+t,f[e.tile]<=e.elapsed)&&(e.animationFrame=(e.animationFrame+1)%s[e.tile].tiles.length||0,e.elapsed=0),e.isBeingRemoved&&(e.elapsed=(e.elapsed||0)+t,M=e.removalDuration||225,e.scale=n(1-e.elapsed/M,0),e.scale<=0)&&(Ne(e.tile,e.x,e.y),e.isBeingRemoved=!1,e.removeCallback)&&e.removeCallback()}),!Oe&&!Pe&&0<y.length)switch(y[y.length-1]){case"up":We(0,-1,g);break;case"down":We(0,1,2);break;case"left":We(-1,0,3);break;case"right":We(1,0,1)}if(Oe){Ge+=M=t;var M=r(Ge/300,1),l=(ve=Qe+(Re-Qe)*M,me=ze+(Ue-ze)*M,$e(pe));switch(Math.floor(3*M)){case 0:ke=l+3;break;case 1:ke=l;break;case 2:ke=l+6}1<=M&&(Oe=!1,ve=Re,me=Ue,Ge=0,ke=l,_e(Qe,ze))}if(Fe){var i,a=t,c=(we+=a,Math.abs(Le-Ze)+Math.abs(Be-Ee)),o=r(we/(125*c),1);if("boulder"===Fe.tile){const e=4*c,t=Math.floor(o*e)%4;Fe.o=t}if(Fe.x=Le+(Ze-Le)*o,Fe.y=Be+(Ee-Be)*o,1<=o){if(Fe.x=Ze,Fe.y=Ee,we=0,"crate"===Fe.tile&&(i=ce((a=Fe).x,a.y,["hole","trap"]))&&(Ne(i.tile,a.x,a.y),Ne("crate",a.x,a.y),se("hole-filled",a.x,a.y,{isUnder:!0}),uM("fall")),["crate","boulder"].includes(Fe.tile)&&((i=ce(Ze,Ee,["switch-trigger"]))&&he(i.o),ce(Ze,Ee,["switch-on"]))&&(ue(Fe.tile,Ze,Ee),uM("fall")),"boulder"===Fe.tile){const e=Ze-Le,t=Ee-Be,M=ce(Fe.x+(0!=e?Math.sign(e):0),Fe.y+(0!=t?Math.sign(t):0));M&&"gong-trigger"===M.tile&&!M.triggered&&(M.triggered=!0,ue("gong",null,null,M.o),uM("gong-trigger"))}Fe=null}}if(Pe&&(M=performance.now()-He,(M=r(M/400,1))<.5?(qe=1-2*M,ve=Se,me=Ie):(qe=2*(M-.5),ve=Te,me=Je,Te===xe&&Je===Ce&&Xe(2)),1<=M)&&(Pe=!1,ve=Te,me=Je,qe=1),Me(),w=e,a=navigator.getGamepads()){var Y,N=a[lM];if(N)for(let e=0;e<N.buttons.length;e++)aM[e]&&((Y=N.buttons[e].pressed)&&!iM[e]&&rM(aM[e]),!Y&&iM[e]&&nM(aM[e]),iM[e]=Y)}requestAnimationFrame(eM)}function MM(e){rM(De(e.key))}function tM(e){nM(De(e.key))}function rM(e){if("game"===m&&(l=e)&&!y.includes(l)&&["up","down","left","right"].includes(l)&&y.push(l),"menu"===m){var r=e;switch(r){case"up":vM=(vM-1+CM.length)%CM.length,CM[vM].isDisabled&&(vM=(vM-1+CM.length)%CM.length);break;case"down":vM=(vM+1)%CM.length,CM[vM].isDisabled&&(vM=(vM+1)%CM.length);break;case"action":const e=CM[vM];if(!e.isDisabled){var n=e.action;switch(S&&_(),n){case"continue":b=parseInt(t("currentLevel")),qM("game");break;case"nG":setTimeout(()=>{vM=0,M("completedLevelList",[]),M("currentLevel",null),M("cD",null),qM("cS")},0);break;case"lS":setTimeout(()=>{qM("lS")},0);break;case"lE":qM("editor")}}}}if("cS"===m){var l=e;const t=hM[dM[AM]].length,r=e=>{var r;0===AM?(vM=(vM+e+t)%t,i.g=vM):(r=dM[AM],i[r]=(i[r]+e+t)%t,s.characters.co[AM]=hM[r][i[r]]),M("cD",JSON.stringify(i))};"up"===l||"down"===l?r("up"===l?-1:1):"left"!==l&&"right"!==l||r("left"===l?-1:1),"action"===l&&(++AM,vM=0,AM>=dM.length)&&(b=1,M("currentLevel",1),qM("game"))}if("lS"===m)switch(e){case"up":4<=I&&(I-=4);break;case"down":I+4<=T&&(I+=4);break;case"left":1<I&&I--;break;case"right":I<T&&I++;break;case"action":b=I,ae(),qM("game")}"menu"===e&&qM("menu")}function nM(e){var M;"game"===m&&(e&&-1!==(M=y.indexOf(e))&&y.splice(M,1),"reset"===e&&ae(),"undo"===e&&0<v.length&&(M=v.pop(),h[b].lD=M.lD,h[b].lD.forEach(e=>{e.isBeingRemoved&&(e.isBeingRemoved=!1,e.scale=1)}),Ve=M.stepsPerformed,F=M.cKN,ve=M.cX,me=M.cY,Xe(M.cDi)),NM=!1)}q.addEventListener("mousemove",e=>{e.preventDefault();var M=q.getBoundingClientRect(),t=e.clientX-M.left,M=e.clientY-M.top;"editor"===m&&(G.x=Math.floor(t/(16*O)),G.y=Math.floor(M/(16*O)),BM(),LM)&&ZM(e)}),q.addEventListener("mouseleave",e=>{e.preventDefault(),"editor"===m&&(G.x=-1,G.y=-1,BM())}),q.addEventListener("mousewheel",e=>{e.preventDefault(),"editor"===m&&(e=n(-1,r(1,e.wheelDelta||-e.detail)),k.value=(parseInt(k.value)+e+4)%4,BM())}),q.addEventListener("mousedown",e=>{LM=!0,"editor"===m&&ZM(e)}),window.addEventListener("mouseup",e=>{LM=!1});let iM=Array(16).fill(!1),lM=null;const aM={12:"up",13:"down",14:"left",15:"right",0:"action",1:"undo",2:"reset",4:"reset",5:"undo",9:"menu"};window.addEventListener("gamepadconnected",e=>{"standard"===e.gamepad.mapping&&(lM=e.gamepad.index)}),window.addEventListener("gamepaddisconnected",e=>{e.gamepad.index===lM&&(lM=null)});var oM={sD:[{i:[3,89,128,0,0,59,128,0,0,0,5,6,60,0,0,0,0,128,0,0,2,255,191,1,89,0,6,35,0],p:[1,1,1,1,1,1,1,1],c:[{n:[132,135,132,135,132,135,132,135,132,135,132,135,,,132,139,132,135,132,135,132],f:[]}]},{i:[3,128,128,0,0,59,128,0,0,0,12,28,216,0,0,0,0,128,0,1,2,64,195,0,31,131,6,55,1],p:[1,1,1,1,1,1,1,1],c:[{n:[120,,,,,,,,118,,,,,,,,116,,,,,,,,,,,,,,,132,,,,,,,,123,,,,,,,,128,,,,,,,,,,,,,,,139,,,,,,,,135,,,,,,,,135],f:[]}]},{i:[3,51,128,0,0,37,128,0,0,0,8,6,60,0,0,0,0,128,0,0,2,255,191,1,89,255,6,159,4],p:[1,1,1,2,1,1,1,2],c:[{n:[,,,,,,,,,,,,132,139,,,,,,,,142,132,,,,,,,,,,,,,,,,,,,127,,,,,,,,130],f:[]},{n:[,,,,,,,,,,,,132,139,,,,,,,,142,132,,132,144,132,146,132,147,132,147,,,,,,,,,,,,,,127,,,,,,,,130],f:[]}]},{i:[2,51,128,0,1,56,128,3,0,0,85,0,91,0,0,0,3,176,5,1,3,60,134,5,21,147,3,128,6],p:[1,2,3,4,2,5,6,4],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,144],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,85]},{n:[144,,,,,,,,147,,,,,,,,144],f:[]},{n:[144,,,,,,,,142,,,,,,,,144],f:[]},{n:[144,,,,,,,,147,,,,146,,,,144],f:[]},{n:[132,,,,,,,,135,,,,,,,,132],f:[]},{n:[132,,,,,,,,130,,,,,,,,132],f:[]}]}],rL:11025,pL:32,eP:7,nC:4},cM={...oM},YM={...oM,sD:[...oM.sD,{i:[0,0,140,0,0,0,140,0,0,81,4,10,47,55,0,0,0,187,5,0,1,239,135,0,15,108,5,16,4],p:[1,1,1,1,1,1,1,1],c:[{n:[147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147],f:[]}]},{i:[0,159,116,85,0,156,116,0,37,14,4,6,73,99,0,0,0,0,0,0,2,136,15,0,32,0,0,0,6],p:[1,1,1,1,1,1,1,1],c:[{n:[135,,,135,,135,,135,135,,,135,,135,,135,135,,,135,,135,,135,135,,,135,,135,,135,,,,,147,,,147,,,,,147,,,147,,,,,147,,,147,,,,,147,,,147],f:[]}]}],nC:6};let NM=!1,sM={sD:[{i:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,14,0,10,32,0,0,0,0],p:[1],c:[{n:[140,142],f:[]}]}],rL:5513,pL:32,eP:0,nC:1},fM={"gong-trigger":{sD:[{i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[123],f:[]}]}],rL:5513,pL:32,eP:0,nC:1},fall:{sD:[{i:[0,128,106,64,0,127,106,12,64,16,0,0,134,0,0,0,0,0,0,0,2,24,169,5,71,83,5,0,0],p:[1],c:[{n:[164],f:[]}]}],rL:7350,pL:32,eP:0,nC:1},crate:{sD:[{i:[0,0,140,0,0,0,140,0,0,255,11,28,59,0,0,0,0,51,2,1,2,58,31,0,32,88,1,39,2],p:[1],c:[{n:[132],f:[]}]}],rL:5513,pL:32,eP:0,nC:1},key:{sD:[{i:[0,255,152,0,0,255,152,12,0,0,12,17,28,0,0,0,0,0,0,0,2,255,0,0,32,47,3,0,0],p:[1],c:[{n:[135,147],f:[]}]}],rL:7350,pL:32,eP:0,nC:1},spawn:{sD:[{i:[2,64,128,0,2,64,140,14,0,0,7,20,28,0,0,0,0,97,4,1,3,49,154,0,109,107,4,93,2],p:[1],c:[{n:[135,139,142,147],f:[]}]}],rL:6014,pL:32,eP:0,nC:1},lock:sM,"block-trigger":sM,block:sM,boulder:{sD:[{i:[3,0,128,0,2,0,128,6,0,101,24,61,37,0,0,0,3,125,0,1,2,66,94,62,64,119,12,67,2],p:[1],c:[{n:[123],f:[]}]}],rL:6300,pL:32,eP:0,nC:1},trap:{sD:[{i:[3,0,128,0,0,0,128,0,0,255,31,4,67,0,0,0,0,0,0,1,2,64,1,0,0,131,0,31,0],p:[1],c:[{n:[111],f:[]}]}],rL:6300,pL:32,eP:0,nC:1},respawn:{sD:[{i:[3,162,128,93,1,95,128,0,64,48,8,8,87,0,0,0,0,79,8,1,3,127,154,2,32,40,5,65,2],p:[1],c:[{n:[156,135],f:[]}]}],rL:11025,pL:32,eP:0,nC:1}},gM={};function uM(e){gM[e]&&(gM[e].currentTime=0,gM[e].play())}const hM={g:["boy","girl"],s:c,h:Y,o:N};let dM=["g","s","h","o"],AM=0,LM=!1;function BM(){var e=D.value,M=parseInt(k.value);ie(s[e].tiles[0],s[e].co,G.x,G.y,{o:s[e].cCO||s[e].uOFC?M:g,uOFC:s[e].uOFC,scale:1,flipHorizontally:!1,alpha:.5})}function ZM(e){1===e.buttons?!ce(G.x,G.y)&&oe(G.x,G.y)&&(se(D.value,G.x,G.y,{o:s[D.value].cCO||s[D.value].uOFC?parseInt(k.value):g}),j(h[b].lD)):2===e.buttons&&(e=ce(G.x,G.y))&&(Ne(e.tile,G.x,G.y),j(h[b].lD))}function EM(){O=Math.min(Math.floor(window.innerWidth/320),Math.floor(.89*window.innerHeight/160)),q.width=320*O,q.height=160*O,Z.width=q.width,Z.height=17.6*O,e("#editor").style.width=q.width+"px",e("#editor").style.transform=`translateY(${Z.height/2}px)`,2<window.innerWidth/window.innerHeight?(x.width=window.innerWidth,x.height=.5*window.innerWidth):(x.height=window.innerHeight,x.width=2*window.innerHeight)}function qM(e){document.body.classList.remove(m),document.body.classList.add(e),document.removeEventListener("keydown",MM),document.removeEventListener("keyup",tM),setTimeout(()=>{document.addEventListener("keydown",MM),document.addEventListener("keyup",tM)},300),"game"===(m=e)&&le(b),"editor"===m&&(le(b=0),Object.keys(s).forEach(e=>{var M;0!==s[e].l&&((M=document.createElement("option")).value=e,M.text=e,D.appendChild(M))}))}function pM(e,M,r,n,l){var i=J[e];p.drawImage(i,M*O,r*O,n*O,n/2*O),l&&(p.lineWidth=2,p.strokeStyle=a,p.strokeRect(M*O,r*O,n*O,n/2*O)),B({ctx:p,x:M+n/2-5,y:r+n/4,text:"L"+e,color:l?a:o}),(t("completedLevelList")||[]).includes(e)&&ie(s.star.tiles[0],s.star.co,M/16-.3,r/16-.5,{scale:.8})}function xM(e,M,t){b=e,M.save(),re("s","rock",M),ne(h[e].lD,!0,M),M.restore()}e("#eTLB").addEventListener("click",()=>{var e;!function(){let e=h[b].lD,M=0,t=0;return e.forEach(e=>{"spawn-current"===e.tile?M++:"flag"===e.tile&&t++}),1===M&&1===t}()||(e=j(h[b].lD),window.open("./index.html?level="+e))}),window.addEventListener("resize",()=>{EM(),re("s","rock")}),function(){var e,M;for(M in p.imageSmoothingEnabled=!1,E.imageSmoothingEnabled=!1,C.imageSmoothingEnabled=!1,EM(),fM){var t=document.createElement("audio"),r=new d;for(r.init(fM[M]);r.generate()<1;);var n=r.createWave();t.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),gM[M]=t}l=X(cM),e=X(YM),$(l),P.addEventListener("ended",function(){$(e,!0)}),(S?_:ee)();var l=new URLSearchParams(window.location.search).get("level");let i=null;l&&(i=R(l))&&(h.push(i),++T);for(let e=1;e<=T;e++){var a=document.createElement("canvas"),c=a.getContext("2d");a.width=q.width,a.height=q.height,c.imageSmoothingEnabled=!1,xM(e,c),J[e]=a}i?(le(h.length-1),qM("game")):qM(m),requestAnimationFrame(eM)}();const CM=[{text:"CONTINUE",action:"continue"},{text:"NEW GAME",action:"nG"},{text:"LEVEL SELECTION",action:"lS"},{text:"LEVEL EDITOR",action:"lE"}];let vM=mM()?0:1;function mM(){return null!==t("currentLevel")}function OM(){var e=new Image;if(e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAACgAgMAAABWEiUVAAAACVBMVEVelt05U8Gc2PyB3HZ+AAAARklEQVQY02MIJROKAnEgEAvCaDB2BeIQIHaBY0YkWgCIGcCYBYgd4DQtQAMQcwBxBxgrALESGK8A4i4gXgXGi4BYC4jJhgDoJyriwWJx+QAAAABJRU5ErkJggg==",e.height){var M=C.canvas.height/e.height,t=C.canvas.height,r=e.width*M,n=document.createElement("canvas");n.width=r,n.height=t,(M=n.getContext("2d")).imageSmoothingEnabled=!1,M.drawImage(e,0,0,r,t);for(let e=0;e<C.canvas.width;e+=r)C.drawImage(n,e,0,r,t)}p.drawImage(x,0,0,q.width,q.height)}</script></div></body></html>