<script src=/2025/webxr/aframe.js></script><script>zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),i=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,i=220,r=0,o=0,n=.1,a=0,s=1,c=0,d=0,l=0,p=0,u=0,h=0,g=0,m=0,A=0,f=1,b=0,y=0)=>{let v,w,E=2*Math.PI,L=c*=500*E/zzfxR**2,q=(0<g?1:-1)*E/4,x=i*=(1+2*e*Math.random()-e)*E/zzfxR,j=[],R=0,S=0,_=0,T=1,z=0,M=0,k=0;for(r=99+zzfxR*r,b*=zzfxR,o*=zzfxR,n*=zzfxR,A*=zzfxR,d*=500*E/zzfxR**3,g*=E/zzfxR,l*=E/zzfxR,p*=zzfxR,u=zzfxR*u|0,w=r+b+o+n+A|0;_<w;j[_++]=k)++M%(100*m|0)||(k=a?1<a?2<a?3<a?Math.sin((R%E)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/E%2+2)%2:1-4*Math.abs(Math.round(R/E)-R/E):Math.sin(R),k=(u?1-y+y*Math.sin(2*Math.PI*_/u):1)*(0<k?1:-1)*Math.abs(k)**s*t*zzfxV*(_<r?_/r:_<r+b?1-(_-r)/b*(1-f):_<r+b+o?f:_<w-A?(w-_-A)/n*f:0),k=A?k/2+(A>_?0:(_<w-A?1:(w-_)/A)*j[_-A|0]/2):k),v=(i+=c+=d)*Math.sin(S*g-q),R+=v-v*h*(1-1e9*(Math.sin(_)+1)%2),S+=v-v*h*(1-1e9*(Math.sin(_)**2+1)%2),T&&++T>p&&(i+=l,x+=l,T=0),!u||++z%u||(i=x,c=L,T=T||1);return j},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext);let songNode,scene,room,zzfxM=(t,e,i,r=125)=>{let o,n,a,s,c,d,l,p,u,h,g,m,A,f,b,y=0,v=[],w=[],E=[],L=0,q=0,x=1,j={},R=zzfxR/r*60>>2;for(;x;L++)v=[x=p=g=A=0],i.map(((r,g)=>{for(l=e[r][L]||[0,0,0],x|=!!e[r][L],b=A+(e[r][0].length-2-!p)*R,f=g==i.length-1,n=2,s=A;n<l.length+f;p=++n){for(c=l[n],u=n==l.length+f-1&&f||h!=(l[0]||0)|c|0,a=0;a<R&&p;a++>R-99&&u?m+=(m<1)/99:0)d=(1-m)*v[y++]/2||0,w[s]=(w[s]||0)-d*q+d,E[s]=(E[s++]||0)+d*q+d;c&&(m=c%1,q=l[1]||0,(c|=0)&&(v=j[[h=l[y=0]||0,c]]=j[[h,c]]||(o=[...t[h]],o[2]*=2**((c-12)/12),c>0?zzfxG(...o):[])))}A=b}));return[w,E]},song=zzfxM([[,0,23,,.15,.2,3,5],[3,0,43,,,.25,,,,,,,,2],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[.4,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,740,,.15,.15,2,.2,,-.15,9,,,.1,.12,,.06]],[[[,,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,12,12,12,12,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,,,,,],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,],[3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,22,20,18]],[[,,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,12,12,12,12,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,,,,,],[1,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,],[2,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,],[,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,12,12,12,12,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,,,,,],[1,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,],[2,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,],[4,,12,,,,,,,,5,,,,10,,,,,,,,8,,,,7,,,,,,,,5,,,,12,,,,,,,,,,,,3,,,,3,,,,7,,,,7,,,,]],[[,,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,12,12,12,12,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,,,,,],[1,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,],[2,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,],[4,,12,,,,,,,,5,,,,10,,,,,,,,8,,,,7,,,,,,,,5,,,,12,,,,,,,,,,,,3,,,,3,,,,7,,,,7,,,,]],[[,,10,,,,,,,,8,,,,10,,,,,,,,,,,,,,,,10,10,10,10,12,,,,,,,,,,,,10,,,,12,,,,,,,,,,,,,,,,],[4,,3,,,,,,,,3,,,,3,,,,7,,,,5,,,,3,,,,10,8,7,5,3,,,,,,,,,,,,8,,,,10,,,,,,,,,,,,,,,,],[1,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,12,,,,,,,,12,,12,,,,,,12,,,,,,12,,12,,,,,,,,],[2,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,,,,,12,,,,],[4,,10,,,,,,,,8,,,,10,,,,,,,,8,,,,7,,,,,,,,8,,,,12,,,,,,,,,,,,3,,,,3,,,,7,,,,7,,,,]]],[0,1,2,3,4,2],150,{title:"New Song",instruments:["Dig Dug","Bass Drum 2","Snare","Hihat Open","Flute"],patterns:["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4"]}),meowAudio=new Audio("data:audio/mp3;base64,SUQzBAAAAAAAIlRTU0UAAAAOAAADTGF2ZjU4LjIuMTAzAAAAAAAAAAAAAAD/40DAAAAAAAAAAAAASW5mbwAAAA8AAAAKAAAC2wBbW1tbW1tbW1ttbW1tbW1tbW1tf39/f39/f39/f5KSkpKSkpKSkpKkpKSkpKSkpKSktra2tra2tra2tsnJycnJycnJycnb29vb29vb29vb7e3t7e3t7e3t7f////////////8AAAAATGF2YzU4LjYuAAAAAAAAAAAAAAAAJANgAAAAAAAAAtuRB9lBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MQxAAIgHnkAUMQAERC3d9z/rnAN9NwMXAMW9bw/4PxANBB36gf2iMP8Mf//BDEswEief/jEsQFCgkmnAGHUAA/se3ug8UXhp5Mx54X/+iiuNzMhHw8/Oa7HiH8h93v/f0/9aooNCU8/+MQxAQJCUagAco4AOZ3P//6oDAFnf///oIgqBJz///8cGg+I6nf+Fw9/5cCVTyDq7///f/jEMQGCboaoABoD6BCZrb///x+HsDUXr///3Jw7xREzNTdXjrE3///6sNgjF5gYHE2+VH/4xDEBgmiFqwqEBQxYZv//+ePwvxNT///mCoNAGha///6yMoTf//6GMQCqPlqIFBmYe9X/+MSxAYJkgqgKmgPov/1jWeSb///aEwN0a///8yEbMnb1cErJ///owwlH+wFqhgM8wBCPMz/4xDEBwnKCqBUOA8E72t//uBp81tOA4WPTb+3/gMf7v/9NlUAxnVP//+Mf8rVIxNrW81P/+MQxAYIMaaUAFAFoP9Th6Pnb///j0JoHR1///+oyIzP1MFZ/6xGRQoxnzasmaXqXYUFNP/jEMQMB9DWbAAQRuj5C5P+I4KCoHz3+oKmTrE/4VMklRX63VMG5AALIfFGvULM1C4rWzr/4xLEEwjoAdW+CEYAxSa+pv/1C3Fhdn62eLam+KpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqg==");function meow(){meowAudio.currentTime=0,meowAudio.play()}meowAudio.playbackRate=.4;let meowAudioAngry=new Audio("data:audio/mp3;base64,SUQzBAAAAAAAIlRTU0UAAAAOAAADTGF2ZjU4LjIuMTAzAAAAAAAAAAAAAAD/40DAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAEfQA5OTk5OUVFRUVFRVFRUVFRXFxcXFxcaGhoaGh0dHR0dHR/f39/f4uLi4uLi5eXl5eXoqKioqKirq6urq6uurq6urrFxcXFxcXR0dHR0d3d3d3d3ejo6Ojo9PT09PT0//////8AAAAATGF2YzU4LjYuAAAAAAAAAAAAAAAAJAQkAAAAAAAABH3jDrHbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MQxAADYAXoAAAAAK31n8vq5zDHd9uD//6FIqWpTbcbdAEhsbAxxVZ8pl/WU9QD6WSFS//jEsQZCGgCNl4AhABb/nKP+t//t1oEIMAODmI//PrM713a7bsgfUr4l+i06GYX5gPhTNVH/+MQxB8KcMIpTUYQAPZ8W//mMtvxclQiaP49gcLEbtS5xEoJtkicYA2AsR5+XC5mtBH+hv/jEMQcDwpmjAGTaAEl5HHO/+pFtZwe6Bcb/2+ZkmgaGn//6b////9v+cKCCtU5RN//uM7/4xDEBgjYXtgBwhAAFAAZgQ3s8SHlHPpCS3/0byiQQOB8MfrB9IIeD4PqGABmAlBHKLv//+MSxAkKghrZkBAPgfrqVvWhU//M5v/fwghX//5MmUOMM//8uxF/wWDQF4qMA25QLZRUEoD/4xDEBwnyHxJcEA+CByimNTT/p7/wQX//f//mU7//9jx9S/////FQhBYDggemSWCwzrgB/+MQxAYJshMLGDgFJQJMhxMer+nzWlHIp0lBMDf/yA7////9axziP///+kFIgpaB/7gY5v/jEMQGCeiLGlYwVBqABxuCbz/yE88fuIwNIbP//kSD//7hohET//kxxkkz+UCF3AAA/Az/4xLEBQfBA0peEAo2JpwBKQa/UXR////+iAos//9Z4tb/8UT/9Q9wbYa0ZhCgJIlP2vr/fv/jEMQOCGEDGlwQBSJCMtn//vOc8U//8RmUf/zynf/hxQgxhrhgEJiP8PmZV1fEwXvDv/r/4xDEEwigfuJQCA6ghCO//hUFhca7/zooHv/5FSmJI0BEGqAFyIXgTRSeizGgb/+LlXf//+MQxBcIuAruXDBEAqjwVEj//Jw7//hoOIEEwACUA9nYDN2ddhPUTGJrDLv/WRgr/+o0d//jEsQbCIhqrDRgBED/fMKAv//H1QbwYCjgAQ/u3/KblQUeZ4pS/wpBX/+kr/6mlVhr//JB/+MQxCAIWOqw/hAFBtJqDoQwhiVFTV2+GuBYVWvUVpvla/8rf////oGZ//TkquuHfRDp3v/jEMQlB5FuXABABQSg7yQllvXW7bLd9s7kpY91hrz35Wd5ajrMWkxBTUUzLjEwMKqqqqr/4xDELQcgBfwAAIYAqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq/+MSxDcAoAQAANgAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=");meowAudioAngry.playbackRate=.75;let catGrid={x:0,z:0},cat=null,firstSit=!1,startPos={...catGrid},runningHome=!1,alarming=!1,security=!0;const buttonSpec={g:"primitive: cylinder; height: 1; radius:.15",m:"color:#000",cl:"button",c:[{g:"primitive:box;width:.5;height:.5;depth:.5",m:"opacity:0",p:"0 .5 0"},{g:"primitive: cylinder; radius:.1",m:"color:#f00",p:"0 .05 0"},{text:"value:DISABLE\nALARMS",sc:"4 4 4",r:"-90 0 0",p:"1.65 .5 -.4"}]},spotSpec={c:[{p:"0 .05 .2",r:"-90 0 -45",cl:"spotlight","spotlight-detector":"target:#cat; angle:20; range:18; obstacles:.blocking-obj",animation__move:"property:rotation;to:-155 0 -45;dur:4000;loop:true;dir:alternate;easing:linear",c:[{r:"90 0 0",g:"primitive:cone;radiusBottom:.14;radiusTop:.1;height:.25",m:"color:#000",c:[{p:"0 -.11 0",g:"primitive:sphere;radius:.12",m:"color:#fff;emissive:#fff",sc:"1 .3 1"}]},{l:"type:spot;intensity:10;angle:10;castShadow:true"}]}]},catSpec={id:"cat",cl:"cat",p:"-7.58 .47 -3.75",r:"0 90 0",sh:"cast:true","walk-on-trigger":"speed:2; trigger:startwalk","run-on-trigger":"speed:7; trigger:startrun","jump-on-trigger":"trigger:startjump",status:"standing",blink:"","path-recorder":"","retrace-path":"","cat-seen":"","cat-runner":"","sit-stand":"","turn-trigger":"","pounce-trigger":"trigger:pounce;speed:10","press-button":"",c:[{id:"torso-joint",p:"0 .46 .15",sc:".8 1 1",c:[{id:"torso",g:"primitive:sphere; radius:.23",m:"color:#000; roughness:.9",sh:"cast:true",p:"0 0 0",c:[{id:"head-joint",p:"0 0 0",animation:"property:position; to:0 .27 .22; from:0 .26 .22; loop:true; dur:1000; dir:alternate",animation__standheadbob:"property:position; to:0 .27 .22; from:0 .26 .22; loop:true; dur:1000; dir:alternate; startEvents:catstand; delay:500",c:[{id:"head",p:"0 0 0",g:"primitive:sphere; radius:.22",m:"color:#000; roughness:.9",sc:".6 .8 .8",sh:"cast:true",c:[{g:"primitive:cone; radiusBottom:.14; radiusTop:.04; height:.13",m:"color:#000",p:"0 -.05 .19",r:"0 90 90"},{g:"primitive:sphere; radius:.02",m:"color:#730",sc:"1 1 .5",p:"0 -.03 .26"},{g:"primitive:cone; radiusBottom:.08; radiusTop:0; height:.28",m:"color:#000",p:"-.1 .21 0",r:"0 0 15"},{g:"primitive:cone; radiusBottom:.08; radiusTop:0; height:.28",m:"color:#000",p:".1 .21 0",r:"0 0 -15"},{cl:"eye",g:"primitive:sphere; radius:.03",m:"color:#ff4;emissive:#ff4",sc:"1 1 .3",p:"-.07 .04 .2",blink:"",c:[{g:"primitive:sphere; radius:.03",m:"color:#000",sc:".2 1 1",p:"0 0 .02"}]},{cl:"eye",g:"primitive:sphere; radius:.03",m:"color:#ff4;emissive:#ff4",sc:"1 1 .3",p:".07 .04 .2",blink:"",c:[{g:"primitive:sphere; radius:.03",m:"color:#000",sc:".2 1 1",p:"0 0 .02"}]}]}]},{id:"shoulders",g:"primitive:sphere; radius:.21",m:"color:#000; roughness:.9",p:"0 .13 0",sc:".8 .5 .5"},{id:"frontLegR-joint",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",p:"-.12 -.19 .05",c:[{id:"frontLegR",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",c:[{id:"frontLowerLegR-joint",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",p:"0 -.18 0",c:[{id:"frontLowerLegR",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",c:[{id:"frontPawR-joint",g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true",p:"0 -.06 .01",c:[{id:"frontPawR",g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true"}]}]}]}]}]},{id:"frontLegL-joint",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",p:".12 -.19 .05",c:[{id:"frontLegL",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",c:[{id:"frontLowerLegL-joint",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",p:"0 -.18 0",c:[{id:"frontLowerLegL",g:"primitive:cylinder; radius:.045; height:.2",m:"color:#000",c:[{id:"frontPawL-joint",g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true",p:"0 -.06 .01",c:[{id:"frontPawL",g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true"}]}]}]}]}]}]}]},{id:"spine-joint",p:"0 .47 -.06",r:"87 0 0",c:[{id:"spine",g:"primitive:cylinder; radius:.18; height:.35",m:"color:#000; roughness:1; metalness:0",sh:"cast:true",c:[{id:"rear-joint",sc:".8 1 1",p:"0 -.22 .02",cl:"rearR",c:[{g:"primitive:sphere; radius:.22",m:"color:#000; roughness:.9",sh:"cast:true",c:[{id:"tail-joint",p:"0 -.2 -.18",r:"30 0 0",animation__tailwag:"property:rotation; from:30 -15 0; to:30 15 0; dur:500; easing:easeInSine; dur:2000; dir:alternate; loop:true",animation__standtail:"property:rotation; to:30 0 0; dur:250; easing:easeInSine; startEvents:catstand",animation__standtail2:"property:position; to:0 -.2 -.18; dur:250; easing:easeInSine; startEvents:catstand",animation__tailwagstand:"property:rotation; from:30 -15 0; to:30 15 0; dur:500; easing:easeInSine; dur:2000; dir:alternate; loop:true; startEvents:catstand; delay:500",c:[{g:"primitive:cylinder; radius:.035; height:.2",m:"color:#000",sh:"cast:true",animation__tailwag:"property:rotation; from:30 -15 0; to:30 15 0; dur:500; easing:easeInSine; dur:2000; dir:alternate; loop:true",animation__standtail:"property:rotation; to:30 0 0; dur:250; easing:easeInSine; startEvents:catstand",animation__standtail2:"property:position; to:0 -.2 -.18; dur:250; easing:easeInSine; startEvents:catstand",animation__tailwagstand:"property:rotation; from:30 -15 0; to:30 15 0; dur:500; easing:easeInSine; dur:2000; dir:alternate; loop:true; startEvents:catstand; delay:500",c:[{g:"primitive:cylinder; radius:.035; height:.2",m:"color:#000",sh:"cast:true",p:"0 -.18 -.05",r:"30 0 0",animation__tailwag:"property:rotation; from:30 -5 0; to:30 5 0; dur:500; easing:easeInSine; dur:2000; dir:alternate; loop:true",c:[{g:"primitive:sphere; radius:.035",m:"color:#000; roughness:.9",sh:"cast:true",p:"0 -.1 0"}]}]}]},{id:"backUpperLegL-joint",p:".15 -.02 .05",r:"90 0 90",c:[{g:"primitive:cylinder; radius:.15; height:.08",m:"color:#000",sh:"cast:true",c:[{id:"backLegL-joint",r:"90 -90 0",p:".02 0 .1",c:[{g:"primitive:cylinder; radius:.04; height:.3",m:"color:#000",sh:"cast:true",p:"0 -.15 0",c:[{id:"backPawL-joint",p:"0 -.18 0",c:[{g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true"}]}]}]}]}]},{id:"backUpperLegR-joint",p:"-.15 -.02 .05",r:"90 0 90",c:[{g:"primitive:cylinder; radius:.15; height:.08",m:"color:#000",sh:"cast:true",c:[{id:"backLegR-joint",r:"90 -90 0",p:".02 0 .1",c:[{g:"primitive:cylinder; radius:.04; height:.3",m:"color:#000",sh:"cast:true",p:"0 -.15 0",c:[{id:"backPawR-joint",p:"0 -.18 0",c:[{g:"primitive:cone; radiusBottom:.06; radiusTop:.03; height:.06",m:"color:#000; roughness:.9",sh:"cast:true"}]}]}]}]}]}]}]}]}]}]},floorSpec={c:[{id:"ground",cl:"clickable",sh:"receive:true","grid-floor":"w:10; h:10; size:1.5",p:"0 .42 0"},{g:"primitive:plane; width:15; height:10.5",m:"color:#540",p:"0 6.42 -2.25",r:"90 0 0"}]},bgSpec={c:[{id:"hover",g:"primitive: plane; width: 1.5; height: 1.5",r:"-90 0 0",p:"-100 .45 0",m:"color: #ff0; opacity: .3",cl:"nohit"},{cl:"grass",g:"primitive: plane; width: 15; height: 4.5",p:"0 .44 5.25",r:"-90 0 0",m:"color: #777",sh:"receive:true"},{cl:"grass",g:"primitive: plane; width: 200; height: 200",p:"0 .4 0",r:"-90 0 0",m:"color: #777",sh:"receive:true"}]},exitSpec={c:[{cl:"wall clickable",g:"primitive:box; width:2; height:6; depth:.5",p:"0 4 0",m:"color: #fff"},{text:"value: EXIT; color:#f00; align:center",sc:"10 16 16",p:"0 2.25 .25"},{id:"hinge",p:"-.9 -1 -.1","door-trigger":!0,c:[{id:"door",g:"primitive: box; width: 2.5; height: 4; depth: .2",p:"1 0 0",m:"color: #999",c:[{text:"value: EMERGENCY ONLY;align:center",sc:"4 4 4",p:"0 1.25 .21"},{text:"value: ALARM WILL SOUND;align:center",sc:"4 4 4",p:"0 .75 .21"},{id:"secureLight",g:"primitive: sphere; radius: .2",p:"0 .25 0",m:"emissive: #f00"},{cl:"bar clickable",g:"primitive: box; width: 1.75; height: .2; depth: 1.2",p:"-.1 -.2 -.4",m:"color: #fff"}]}]}]},doorSpec={p:"0 2.5 .5",c:[{g:"primitive:box; width:2; height:6; depth:.5",p:"0 4.25 0",cl:"wall clickable",m:"color:#fff"},{g:"primitive: box; width: 2; height:4.5; depth:.25",p:"0 -.85 .1",m:"color:#6b5a4a"},{g:"primitive: box; width: 1.6; height:4; depth:.25",p:".025 -1 .15",m:"color:#a67c52",c:[{g:"primitive: sphere; radius:.13",p:"-.5 -.25 .11",m:"color:#fff"}]}]},windowSpec={p:"0 2.5 .5",c:[{g:"primitive:box; width:2; height:6; depth:.5",p:"0 -4.2 0",cl:"wall clickable",m:"color:#fff",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:2.05; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},{g:"primitive:box; width:2; height:6; depth:.5",p:"0 4.25 0",cl:"wall clickable",m:"color:#fff",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:2.05; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},{g:"primitive: plane; width: 2; height:3.5",p:"0 .5 .1",m:"color:#000;opacity:.7"}]},mirrorSpec={p:"0 2.5 .5",c:[{g:"primitive:box; width:2; height:6; depth:.5",p:"0 -5.25 0",cl:"wall clickable",m:"color:#fff",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:2.05; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},{g:"primitive:box; width:2; height:6; depth:.5",p:"0 4.25 0",cl:"wall clickable",m:"color:#fff",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:2.05; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},{g:"primitive: plane; width: 2; height:3.5",p:"0 -.5 0",cl:"mirror",m:"color:#000;opacity:.5;transparent:true"},{g:"primitive:box; width:2; height:.2; depth:.2",p:"0 1.25 -.35",m:"color:#550"},{g:"primitive:box; width:2; height:.2; depth:.2",p:"0 -2.25 -.35",m:"color:#550"},{g:"primitive:box; width:.2; height:3.5; depth:.2",p:"-1 -.5 -.35",m:"color:#550"}]},treasure={sc:"3 3 3",c:[{g:"primitive:cone; height: .4; radiusBottom:.25; radiusTop:.005; segmentsRadial:6;openEnded:true",m:"color:#99f; metalness:.5; roughness:.1; opacity:.7; transparent:true",r:"180 0 0",a:"property: rotation; to: 180 360 0; loop: true; dur: 12000; easing: linear"},{g:"primitive:cone; height: .15; radiusBottom:.25; radiusTop:.15; segmentsRadial:6",m:"color:#99f; metalness:.5; roughness:.1; opacity:.7; transparent:true",p:"0 .275 0",a:"property: rotation; to: 0 360 0; loop: true; dur: 12000; easing: linear"}]},treasureSpec={c:[{id:"treasure",g:"primitive:cylinder; radius:.8; height:.2",m:"color:#333",c:[{g:"primitive:cone; radiusBottom:.7; height:1; segmentsRadial:4",m:"color:#333",p:"0 .5 0",r:"0 45 0"},{g:"primitive:cone; radiusBottom:.7; height:1",m:"color:#333",p:"0 1.05 0",r:"180 0 0"},{g:"primitive:cylinder; radius:1.1; height:.2",m:"color:#333",p:"0 1.5 0",s:"receive:false; cast:true",c:[{g:"primitive:cylinder; radius:.3; height:.08",m:"color:#fff",p:"0 .08 0",c:[{id:"treasure",c:[{g:"primitive:cone; height: .4; radiusBottom:.25; radiusTop:.005; segmentsRadial:6;openEnded:true",m:"color:#99f; metalness:.5; roughness:.1; opacity:.7; transparent:true",p:"0 .25 0",r:"180 0 0",a:"property: rotation; to: 180 360 0; loop: true; dur: 12000; easing: linear",sh:"cast:false; receive:false"},{g:"primitive:cone; height: .15; radiusBottom:.25; radiusTop:.15; segmentsRadial:6",m:"color:#99f; metalness:.5; roughness:.1; opacity:.7; transparent:true",p:"0 .525 0",a:"property: rotation; to: 0 360 0; loop: true; dur: 12000; easing: linear",sh:"cast:false; receive:false"}]},{g:"primitive:cylinder; radius:.02; height:3",m:"color:#000",p:"0 4.5 0"},{g:"primitive:cone; radiusBottom:.14; radiusTop:.1; height:.25",m:"color:#000",p:"0 3 0",c:[{g:"primitive:sphere; radius:.12",m:"color:#fff; emissive:#fff",s:"1 .3 1",p:"0 -.05 0"}]},{l:"type: spot; intensity:.6; angle:10; distance:2",p:".1 1.5 .6",r:"-70 10 0"},{l:"type: spot; intensity:.5; angle:12; castShadow:true",p:"0 3 0",r:"-90 0 0"}]}]}]}]},ropesSpec={id:"ropes",c:[{g:"primitive:cylinder; radius:.05; height:1.6",m:"color:#fff; metalness:.5",p:"-1 -2.5 -1",c:[{g:"primitive:cone; height:.1; radiusTop:.05; radiusBottom:.4",m:"color:#000",p:"0 -.5 0"},{g:"primitive:sphere; radius:.08",m:"color:#fff; metalness:.5",p:"0 .83 0"}]},{g:"primitive:cylinder; radius:.05; height:1.6",m:"color:#fff; metalness:.5",p:"1 -2.5 -1",c:[{g:"primitive:cone; height:.1; radiusTop:.05; radiusBottom:.4",m:"color:#000",p:"0 -.5 0"},{g:"primitive:sphere; radius:.08",m:"color:#fff; metalness:.5",p:"0 .83 0"}]},{g:"primitive:cylinder; radius:.05; height:1.6",m:"color:#fff; metalness:.5",p:"-1 -2.5 1",c:[{g:"primitive:cone; height:.1; radiusTop:.05; radiusBottom:.4",m:"color:#000",p:"0 -.5 0"},{g:"primitive:sphere; radius:.08",m:"color:#fff; metalness:.5",p:"0 .83 0"}]},{g:"primitive:cylinder; radius:.05; height:1.6",m:"color:#fff; metalness:.5",p:"1 -2.5 1",c:[{g:"primitive:cone; height:.1; radiusTop:.05; radiusBottom:.4",m:"color:#000",p:"0 -.5 0"},{g:"primitive:sphere; radius:.08",m:"color:#fff; metalness:.5",p:"0 .83 0"}]},{g:"primitive:torus; arc:60; radius:2; radiusTubular:.02",m:"color:#F55",p:"0 0 1",r:"0 0 -120"},{g:"primitive:torus; arc:60; radius:2; radiusTubular:.02",m:"color:#F55",p:"-1 0 0",r:"0 90 -120"},{g:"primitive:torus; arc:60; radius:2; radiusTubular:.02",m:"color:#F55",p:"0 0 -1",r:"0 0 -120"},{g:"primitive:torus; arc:60; radius:2; radiusTubular:.02",m:"color:#F55",p:"1 0 0",r:"0 90 -120"}]},hiddenArt={c:[{g:"primitive:plane; width:40; height:40",m:"color:#ddd;emissive:#999",p:"0 -100 -20.5"},{g:"primitive:plane; width:40; height:40",m:"color:#ddd;emissive:#999",p:"0 -200 -20.5"},{g:"primitive:plane; width:40; height:40",m:"color:#ddd;emissive:#999",p:"-15 -200 -1.5",r:"0 90 0"},{g:"primitive:plane; width:40; height:40",m:"color:#ddd;emissive:#999",p:"-15 -100 -1.5",r:"0 90 0"},{id:"piece1",g:"primitive:torusKnot;radiusTubular:.1;radius:3",p:"0 -100 -15",q:"7",m:"color:#B84A39;emissive:#300"},{id:"piece2",g:"primitive:torusKnot;radiusTubular:.1;radius:3",p:"0 -200 -15",q:"7",r:"90 60 0",m:"color:#394AB8;emissive:#003"}]},hiddenCamera={c:[{id:"hiddenCam1",camera:"active:false",p:"0 -101 -12"},{id:"hiddenCam2",camera:"active:false",p:"0 -201 -12"},{id:"hiddenCam3",camera:"active:false",p:"5 -200 -16",r:"0 90 0"},{id:"hiddenCam4",camera:"active:false",p:"5 -101 -14",r:"0 90 0"}]},ventSpec={r:"0 90 0",c:[{g:"primitive:box; width:1.7; height:1.2; depth:1",m:"color:#000"},{cl:"vent",g:"primitive:box; width:1.7; height:.05; depth:1.2",m:"color:#999",r:"0 0 0",p:"0 .65 1.2"}]},facadeSpec={c:[{p:".5 14 -7.5",m:"color:#ccc",cl:"outerwall2",g:"primitive:box; width:18; height: 15; depth:22"},{p:"-22.7 0 -7.5",m:"color:#ccc",cl:"outerwall2",g:"primitive:box; width:30; height: 30; depth:22"}]},wallSpec={g:"primitive:box; width:2; height:6; depth:.5",p:"0 0 .5",cl:"wall clickable blocking-obj",m:"color:#fff;side:double",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:2.05; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},halfWallSpec={g:"primitive:box; width:1.15; height:6; depth:.5",p:"0 0 .5",cl:"wall clickable blocking-obj",m:"color:#fff;side:double",sh:"receive:true;cast:true",c:[{g:"primitive:box; width:1.17; height:6.05; depth:.5",p:"0 0 -.05",m:"color:#ccc",cl:"outerwall"}]},ATTR={id:"id",p:"position",r:"rotation",sc:"scale",g:"geometry",m:"material",sh:"shadow",cl:"class",c:"children",l:"light",li:"line",o:"color",a:"animation"};currlevel=1;let levels=[];function buildEntity(t,e,i,r){const o=document.createElement("a-entity");for(const e in t){const i=t[e];"c"===e?i.forEach((t=>buildEntity(t,o))):"id"===e?o.id=i:o.setAttribute(ATTR[e]||e,i)}return i&&o.setAttribute("position",i),r&&o.setAttribute("rotation",r),e.appendChild(o),o}function flushRecursive(t){t.flushToDOM(),t.childNodes.forEach((t=>1===t.nodeType&&flushRecursive(t)))}function loadLevel(t){for(buildEntity(floorSpec,room),i=0;i<4;i++)buildWall(levels[t][i],room);buildEntity(ventSpec,room,"-7.99 1.07 -3.75"),buildEntity(treasureSpec,room,".75 .47 -2.5"),buildEntity(ropesSpec,room,".75 3.5 -2.5"),buildEntity(buttonSpec,room,levels[t][4].p,levels[t][4].r),buildEntity(facadeSpec,scene),buildEntity(spotSpec,room,".76 5.55 -7.47"),buildEntity(spotSpec,room,"-5 5.55 -7.47"),buildEntity(levels[t][5],room),document.querySelector("#piece1").setAttribute("rotation","0 "+360*Math.random()+" 0"),document.querySelector("#piece2").setAttribute("rotation","0 "+360*Math.random()+" 0"),document.querySelectorAll(".art").forEach((t=>{t.addEventListener("loaded",(()=>{paintArt(t.getAttribute("artId"))}))}));let e=document.querySelectorAll(".mirror");if(e.length>0){e.forEach((t=>{t.addEventListener("loaded",(()=>{const e=t.getObject3D("mesh");e&&(e.material.depthWrite=!1)}))})),document.querySelector("#player").setAttribute("mirror-figure","target:#rig"),flushRecursive(room),flushRecursive(cat);const t=room.cloneNode(!0);t.setAttribute("id","reflection"),t.setAttribute("scale","1 1 -1"),t.setAttribute("position","0 0 -15.6"),scene.appendChild(t),t.querySelectorAll("*").forEach((t=>{for(let{name:e,value:i}of[...t.attributes])"grid-floor"!==e&&"id"!==e&&t.setAttribute(e,i)})),t.object3D.traverse((t=>{t.isMesh&&(t.material=t.material.clone(),t.material.side=THREE.DoubleSide)}));let i=document.querySelector("#reflection-cat");cloneEntity(cat,i),document.querySelector("#head-joint").setAttribute("look-at-cursor",""),i.setAttribute("mirror-children","target:#cat"),i.removeAttribute("walk-on-trigger"),i.removeAttribute("run-on-trigger"),i.removeAttribute("status"),i.removeAttribute("blink"),i.removeAttribute("cat-seen"),i.removeAttribute("cat-runner"),i.removeAttribute("sit-stand"),i.removeAttribute("retrace-path"),i.removeAttribute("path-recorder"),i.removeAttribute("turn-trigger"),i.removeAttribute("pounce-trigger"),i.removeAttribute("press-button"),i.setAttribute("position","-3 .47 2");let r=document.createElement("a-entity");r.setAttribute("id","mirrorLaser"),r.setAttribute("line","color:#fff"),scene.appendChild(r),r.addEventListener("loaded",(()=>{document.querySelector("#rightHand").setAttribute("mirror-laser","target: #mirrorLaser;mirrorZ:-8")}))}cat.addEventListener("loaded",(()=>{updateCatGrid(),requestAnimationFrame((()=>{updateCatGrid()})),setTimeout((()=>{updateCatGrid()}),0),triggerSit()})),document.querySelector("#rightHand").components.raycaster.refreshObjects(),startPos=cat.getAttribute("position"),paintWalls(),paintVent(),room.setAttribute("tile-hover","")}function buildWall(t,e){const i=t.r,r=t.p,o=t.w.split(""),n=document.createElement("a-entity");let a=0;o.forEach((t=>{let e;switch(t){case"W":e=buildEntity(wallSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"H":e=buildEntity(halfWallSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"D":e=buildEntity(doorSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"E":e=buildEntity(exitSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"I":e=buildEntity(windowSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"M":e=buildEntity(mirrorSpec,n),n.appendChild(e),e.setAttribute("position",a+" 3.42 .5");break;case"R":e=buildEntity(mirrorSpec,n),n.appendChild(e),e.setAttribute("scale","-1 1 1"),e.setAttribute("position",a+" 3.42 .5")}a+=2})),n.setAttribute("position",r),n.setAttribute("rotation",i),e.appendChild(n)}function city(){const t=document.getElementById("scene");for(let e=0;e<47;e++){let i=e*(2*Math.PI/47),r=100*Math.cos(i),o=100*Math.sin(i),n=20+80*Math.random(),a=document.createElement("a-box");a.setAttribute("position",r+" "+(n/2-1)+" "+(o-10)),a.setAttribute("depth",20),a.setAttribute("width",30),a.setAttribute("height",n),a.setAttribute("color","#222"),a.setAttribute("class","building"),t.appendChild(a)}}function fadeIn(){document.querySelectorAll(".fader").forEach((t=>{t.emit("fadeIn")}))}function fadeOut(){document.querySelectorAll(".fader").forEach((t=>{t.emit("fadeOut")}))}function lose(){firstSit=!1;const t=document.querySelector("#room");Array.from(t.children).forEach((t=>t.remove())),cat.setAttribute("position","-7.58 .47 -3.75"),cat.setAttribute("rotation","0 90 0"),security=!0,songNode.stop(),toggleLasers(.3),startGame(currlevel)}function win(){firstSit=!1;const t=document.querySelector("#startLevel"+currlevel);t.setAttribute("material","emissive:#00f"),document.querySelector("#treasure"+currlevel)||buildEntity(treasure,t,"-.35 0 -1"),document.querySelector("#startLevel"+currlevel++).setAttribute("material","emissive:#00f");const e=document.getElementById("rig");e.setAttribute("position","200 1.2 3.2"),e.setAttribute("rotation","0 0 0");const i=document.querySelector("#room");Array.from(i.children).forEach((t=>t.remove()));const r=document.querySelector("#reflection");r&&Array.from(r.children).forEach((t=>t.remove())),cat.setAttribute("position","-7.58 .47 -3.75"),cat.setAttribute("rotation","0 90 0"),security=!0,toggleLasers(.3),songNode.stop()}function hit(t){const e=t.detail.intersection;if(!e||!e.object)return;const i=e.object.el;if(i&&i.classList.contains("floor-tile")&&isAdjacent(i,catGrid)){const t=parseInt(i.dataset.gx),e=parseInt(i.dataset.gz),r=getRotationForStep(t-catGrid.x,e-catGrid.z);r&&(cat.emit("turn",{rotation:{y:r.y}}),justPounced||(justPounced=!0,setTimeout((function(){cat.emit("pounce")}),500),setTimeout((function(){justPounced=!1}),1e3))),triggerStand(),document.querySelector("#spine").addEventListener("animationcomplete__stand",(()=>{cat.emit("startwalk");const r=i.getAttribute("position");cat.setAttribute("animation__move",{property:"position",to:r.x+" 0.45 "+r.z,dur:200,easing:"linear"}),cat.addEventListener("animationcomplete__move",(()=>{cat.emit("stopwalk"),catGrid.x=t,catGrid.z=e,cat.removeAttribute("animation__move"),triggerSit()}),{once:!0})}),{once:!0})}else if(i&&i.classList.contains("button")&&isAdjacentButton(i,catGrid)){let t=i.getAttribute("position"),e=getGridData();const r=worldToGrid(t.x,t.z,e.w,e.h,e.size),o=parseInt(r.x),n=parseInt(r.z),a=getRotationForStep(o-catGrid.x,n-catGrid.z);a&&a.y!==Math.abs(cat.getAttribute("rotation").y)?(cat.emit("turn",{rotation:{y:a.y}}),setTimeout((function(){cat.emit("pressbutton")}),125)):cat.emit("pressbutton"),pressingButton||(pressingButton=!0,setTimeout((function(){pressingButton=!1,security=!1,document.querySelector("#secureLight").setAttribute("material","emissive:#000"),triggerSit()}),1e3))}else if(i&&i.classList.contains("bar")&&isAdjacentButton(i,catGrid,5)){let t=i.getAttribute("position"),e=getGridData();const r=worldToGrid(t.x,t.z,e.w,e.h,e.size),o=parseInt(r.x),n=parseInt(r.z),a=getRotationForStep(o-catGrid.x,n-catGrid.z);a&&a.y!==Math.abs(cat.getAttribute("rotation").y)?(cat.emit("turn",{rotation:{y:a.y}}),setTimeout((function(){cat.emit("pressbutton")}),250)):cat.emit("pressbutton"),pressingButton||(pressingButton=!0,setTimeout((function(){pressingButton=!1,openDoor(),security?(zzfx(...[,0,960,,1,.01,,.8,-.01,,-190,.5,,.05,,,1]),fadeOut(),setTimeout(lose,1e3)):(zzfx(...[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07]),win())}),120),setTimeout(triggerSit,500))}}function intersect(t){if(!t.detail.intersections.length)return void hover.setAttribute("visible",!1);const e=t.detail.intersections[0]?.object?.el;if(e&&e.classList.contains("floor-tile")&&isAdjacent(e,catGrid)){const t=e.getAttribute("position");hover.setAttribute("position",t.x+" 0.425 "+t.z),hover.setAttribute("visible",!0)}else hover.setAttribute("visible",!1)}function startGame(t){currlevel=t,loadLevel(t);const e=document.getElementById("rig");e.setAttribute("position","-2 1.5 3.4"),e.setAttribute("rotation","0 0 0"),fadeIn(),triggerFirstSit(),setTimeout((()=>{songNode=zzfxP(...song),songNode.loop=!0}),800),document.getElementById("rightHand").addEventListener("thumbstickmoved",(t=>{Math.abs(t.detail.x)>.2&&(e.object3D.position.x+=.25*t.detail.x)}))}function meowAngry(){meowAudioAngry.paused&&(meowAudioAngry.currentTime=0,meowAudioAngry.play())}function openDoor(){document.querySelector("#hinge").emit("openDoor")}function getGridData(){const t=document.querySelector("[grid-floor]"),e=t?.components["grid-floor"]?.data;return e?{w:e.w,h:e.h,size:e.size}:{w:10,h:10,size:1.5}}function worldToGrid(t,e,i,r,o){return{x:Math.round(t/o+i/2-.5),z:Math.round(e/o+r/2-.5)}}function updateCatGrid(){cat=document.querySelector("#cat");const{w:t,h:e,size:i}=getGridData(),r=new THREE.Vector3;cat.object3D.getWorldPosition(r);const o=worldToGrid(r.x,r.z,t,e,i);catGrid.x=o.x,catGrid.z=o.z}function isAdjacent(t,e){const i=parseInt(t.dataset.gx),r=parseInt(t.dataset.gz);return Math.abs(i-e.x)+Math.abs(r-e.z)===1}function isAdjacentButton(t,e,i){let r=t.getAttribute("position"),o=getGridData();const n=worldToGrid(r.x,r.z,o.w,o.h,o.size),a=parseInt(n.x),s=parseInt(n.z);let c=Math.abs(a-e.x);return i>0&&(c=Math.abs(a-(e.x-i))),c+Math.abs(s-e.z)===1}function getRotationForStep(t,e){return 1===t&&0===e?{y:90}:-1===t&&0===e?{y:-90}:0===t&&-1===e?{y:180}:0===t&&1===e?{y:0}:void 0}function toggleLasers(t){document.querySelectorAll(".laser").forEach((e=>{e.setAttribute("material","opacity:"+t)}))}function triggerFirstSit(){if(!firstSit){meow();const t=document.querySelector("#cat");t.emit("catstand"),t.emit("startwalk");const e={x:-6.7,y:.47,z:-3.75};t.setAttribute("animation__move",{property:"position",to:e.x+" 0.45 "+e.z,dur:1e3,easing:"linear"}),t.addEventListener("animationcomplete__move",(()=>{t.emit("stopwalk"),t.removeAttribute("animation__move"),t.emit("catsit")}),{once:!0}),firstSit=!0}}function triggerSit(){cat.emit("catsit")}function triggerSitForward(){let t=getGridData();cat.emit("catstand"),setTimeout((function(){cat.emit("startwalk",{distance:t.size/2})}),100),setTimeout((function(){cat.emit("catsit")}),1e3)}function triggerStand(){cat.emit("catstand")}function paintWalls(){const t=document.getElementById("brickTexture"),e=t.getContext("2d");e.fillStyle="#221",e.fillRect(0,0,t.width,t.height),e.lineWidth=5;for(let i=0;i<=t.width;i+=64)for(let r=0;r<t.height;r++){const t=r,o=32+20*Math.sin(t/20)-10,n=32+20*Math.cos(t/20+Math.PI/2);e.fillStyle="#311",e.fillRect(o+i,t,15,1),e.fillStyle="#311",e.fillRect(n+i,t,15,1)}let i=document.querySelectorAll(".wall"),r=new THREE.CanvasTexture(t);i.forEach((t=>{t.addEventListener("loaded",(()=>{let e=t.getObject3D("mesh");e.material.map=r,e.material.needsUpdate=!0,r.wrapS=r.wrapT=THREE.RepeatWrapping}))}));const o=document.getElementById("brickTexture2"),n=o.getContext("2d");o.width=256,o.height=128,n.fillStyle="#888",n.fillRect(0,0,o.width,o.height),n.strokeStyle="#666",n.lineWidth=4,n.strokeRect(-o.width/2,0,o.width,o.height/2),n.strokeRect(o.width/2,0,o.width,o.height/2),n.strokeRect(o.width/4,o.height/2,o.width/2,o.height/2);let a=document.querySelectorAll(".outerwall2"),s=document.querySelectorAll(".outerwall"),c=new THREE.CanvasTexture(o),d=new THREE.CanvasTexture(o);s.forEach((t=>{t.addEventListener("loaded",(()=>{const e=t.getObject3D("mesh");e.material.map=c,e.material.needsUpdate=!0,c.wrapS=c.wrapT=THREE.RepeatWrapping,c.repeat.set(2,10)}))})),a.forEach((t=>{t.addEventListener("loaded",(()=>{const e=t.getObject3D("mesh");e.material.map=d,e.material.needsUpdate=!0,d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(20,50)}))}))}function paintVent(){const t=document.querySelector("#ventTexture"),e=t.getContext("2d");t.width=256,t.height=128,e.fillStyle="#ccc",e.fillRect(0,0,256,128),e.strokeStyle="#555",e.lineWidth=10;for(let t=0;t<=128;t+=15)e.beginPath(),e.moveTo(0,t),e.lineTo(256,t),e.stroke();e.strokeRect(2,2,254,126);const i=new THREE.CanvasTexture(t);i.wrapS=i.wrapT=THREE.RepeatWrapping,i.needsUpdate=!0,document.querySelectorAll(".vent").forEach((t=>{t.addEventListener("loaded",(()=>{const e=t.getObject3D("mesh");e.material=e.material.clone(),e.material.map=i,e.material.color.set("#fff"),e.material.needsUpdate=!0}))}))}function paintArt(t){const e=scene.renderer,i=scene.object3D;artId="#art"+t,camId="#hiddenCam"+t;const r=document.querySelector(camId).getObject3D("camera"),o=document.querySelector(artId),n=new THREE.WebGLRenderTarget(512,512),a=e.xr.enabled;e.xr.enabled=!1,e.setRenderTarget(n),e.render(i,r),e.setRenderTarget(null),e.xr.enabled=a;const s=n.texture;s.encoding=THREE.sRGBEncoding,o.getObject3D("mesh").material=new THREE.MeshBasicMaterial({map:s})}function cloneEntity(t,e){if(t&&e){for(;e.firstChild;)e.removeChild(e.firstChild);for(let r=0;r<t.children.length;r++)i(t.children[r],e)}function i(t,e){const r=document.createElement(t.tagName.toLowerCase());for(let e=0;e<t.attributes.length;e++){const i=t.attributes[e];"id"!==i.name&&"look-at-cursor"!==i.name&&r.setAttribute(i.name,i.value)}for(let e=0;e<t.children.length;e++)i(t.children[e],r);e.appendChild(r)}}levels[1]=[{p:"-7.5 0 -8.25",r:"0 0 0",w:"WWWWDWWW"},{p:"-8.25 0 2",r:"0 90 0",w:"WWWWWW"},{p:"8.2 0 -8",r:"0 -90 0",w:"WWWEWW"},{p:"7.5 0 3.5",r:"0 180 0",w:"WIIIIIWW"},{p:"-2 2 -8",r:"90 0 0"},{c:[{id:"art1",cl:"art",artId:1,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"-5 3.42 -7.4"},{id:"art2",cl:"art",artId:2,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"4 3.42 -7.4"},{id:"art3",cl:"art",artId:3,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"-7.4 3.42 -4.4",r:"0 90 0"},{id:"art4",cl:"art",artId:4,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"-7.4 3.42 0",r:"0 90 0"}]}],levels[2]=[{p:"-7.5 0 -8.25",r:"0 0 0",w:"WWWMRWWW"},{p:"-8.25 0 2",r:"0 90 0",w:"WDWWWH"},{p:"8.2 0 -8",r:"0 -90 0",w:"HWWEWW"},{p:"7.5 0 3.5",r:"0 180 0",w:"WIWIWIWW"},{p:"-7.98 2 -2.2",r:"90 90 0"},{c:[{id:"art1",cl:"art",artId:1,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"-5 3.42 -7.4"},{id:"art2",cl:"art",artId:2,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"4 3.42 -7.4"},{id:"art3",cl:"art",artId:3,g:"primitive:box; width:2.7; height:2.3; depth:.05",p:"-7.4 3.42 -4.4",r:"0 90 0"}]}],AFRAME.registerComponent("fade-trigger",{init:function(){this.el.addEventListener("fadeIn",(()=>{this.intensity=this.el.getAttribute("light").intensity,this.fadingIn=!0})),this.el.addEventListener("fadeOut",(()=>{this.intensity=this.el.getAttribute("light").intensity,this.fadingOut=!0}))},tick(t,e){if(this.fadingIn){let t=this.el.getAttribute("light").intensity;const i=e/1e3*.1;this.el.setAttribute("light","intensity",t+i),t+i>=.2&&(this.fadingIn=!1)}else if(this.fadingOut){let t=this.el.getAttribute("light").intensity;const i=this.intensity*(e/1e3);this.el.setAttribute("light","intensity",t-i),t-i<.001&&(this.fadingOut=!1)}}}),AFRAME.registerComponent("door-trigger",{schema:{speed:{type:"number",default:360},trigger:{type:"string",default:"openDoor"}},init:function(){this.el.addEventListener(this.data.trigger,(t=>{const e=this.el.getAttribute("rotation");this.startYaw=e.y,this.targetYaw=90;let i=this.targetYaw-this.startYaw;this.targetYaw=this.startYaw+i,this.isTurning=!0}))},tick:function(t,e){if(!this.isTurning)return;const i=this.el.getAttribute("rotation");let r=i.y,o=this.targetYaw-r;o=(o+180)%360-180;const n=this.data.speed*(e/1e3);Math.abs(o)<=n?(r=this.targetYaw,this.isTurning=!1):r+=n*Math.sign(o),this.el.setAttribute("rotation",{x:i.x,y:r,z:i.z})}}),AFRAME.registerComponent("turn-trigger",{schema:{speed:{type:"number",default:360},trigger:{type:"string",default:"turn"}},init:function(){this.isTurning=!1,this.startYaw=0,this.targetYaw=0,this.el.addEventListener(this.data.trigger,(t=>{const e=this.el.getAttribute("rotation");this.startYaw=e.y;const i=t.detail&&t.detail.rotation?t.detail.rotation:{x:0,y:0,z:0};this.targetYaw=i.y;let r=this.targetYaw-this.startYaw;r=(r+180)%360-180,-270===r&&(r=90),this.targetYaw=this.startYaw+r,this.isTurning=!0}))},tick:function(t,e){if(!this.isTurning)return;const i=this.el.getAttribute("rotation");let r=i.y,o=this.targetYaw-r;o=(o+180)%360-180;const n=this.data.speed*(e/1e3);Math.abs(o)<=n?(r=this.targetYaw,this.isTurning=!1):r+=n*Math.sign(o),this.el.setAttribute("rotation",{x:i.x,y:r,z:i.z})}}),AFRAME.registerComponent("pounce-trigger",{schema:{speed:{type:"number",default:.5},trigger:{type:"string",default:"pounce"},height:{type:"number",default:.5},isPouncing:{type:"bool",default:!1}},init:function(){this.data.isPouncing=!1,this.legs=[{id:"#head-joint",rotation:{property:"rotation",to:"30 0 0",dur:250,easing:"linear"},position:{property:"position",to:"0 .06 0.32",dur:250,easing:"linear"}},{id:"#spine-joint",rotation:{property:"rotation",to:"105 0 0",dur:225,easing:"linear"},position:{property:"position",to:"0 0.38 .16",dur:250,easing:"linear"}},{id:"#torso-joint",rotation:{property:"rotation",to:"0 0 0",dur:250,easing:"linear"},position:{property:"position",to:"0 0.34 0.35",dur:250,easing:"linear"}},{id:"#rear-joint",rotation:{property:"rotation",to:"0 0 0",dur:225,easing:"linear"}},{id:"#backUpperLegL-joint",rotation:{property:"rotation",to:"-5 0 90",dur:250,easing:"linear"}},{id:"#backUpperLegR-joint",rotation:{property:"rotation",to:"-5 0 90",dur:250,easing:"linear"}},{id:"#backLegR-joint",rotation:{property:"rotation",to:"90 -190 0",dur:250,easing:"linear"}},{id:"#backLegL-joint",rotation:{property:"rotation",to:"90 -190 0",dur:250,easing:"linear"}},{id:"#frontLegL-joint",rotation:{property:"rotation",to:"-55 0 -10",dur:250,easing:"linear"},position:{property:"position",to:"0.12 -.2 0.2",dur:250,easing:"linear"},scale:{property:"scale",to:"1 1.3 1",dur:250,easing:"linear"}},{id:"#frontLegR-joint",rotation:{property:"rotation",to:"-55 0 10",dur:250,easing:"linear"},position:{property:"position",to:"-.12 -.2 0.2",dur:250,easing:"linear"},scale:{property:"scale",to:"1 1.3 1",dur:250,easing:"linear"}},{id:"#frontLowerLegL-joint",rotation:{property:"rotation",to:"-20 0 -15",dur:250,easing:"linear"},position:{property:"position",to:"-0.02 -.18 .02",dur:250,easing:"linear"}},{id:"#frontLowerLegR-joint",rotation:{property:"rotation",to:"-20 0 15",dur:250,easing:"linear"},position:{property:"position",to:"0.02 -.18 .02",dur:250,easing:"linear"}},{id:"#frontPawL-joint",rotation:{property:"rotation",to:"40 0 0",dur:250,easing:"linear"}},{id:"#frontPawR-joint",rotation:{property:"rotation",to:"40 0 0",dur:250,easing:"linear"}}],this.el.addEventListener(this.data.trigger,(()=>{this.data.isPouncing||(this.data.isPouncing=!0,this.startLegAnimations())})),this.el.addEventListener("stoppounce",(()=>{this.data.isPouncing=!1,setTimeout(triggerSit,1e3)}))},startLegAnimations:function(){hover.setAttribute("visible",!1);const t=getGridData().size,e=new THREE.Vector3;this.el.object3D.getWorldDirection(e),e.y=0,e.normalize().multiplyScalar(t-t/2);const i=this.el.object3D.position.clone(),r=i.clone().add(e),o=i.clone().add(e.clone().multiplyScalar(.5));o.y+=this.data.height,this.el.setAttribute("animation__pounceUp",{property:"position",to:o.x+" "+o.y+" "+o.z,dur:125,easing:"easeOutQuad"}),this.el.addEventListener("animationcomplete__pounceUp",(()=>{this.el.setAttribute("animation__pounceDown",{property:"position",to:r.x+" "+r.y+" "+r.z,dur:125,easing:"easeInQuad"}),this.el.addEventListener("animationcomplete__pounceDown",(()=>{this.data.isPouncing=!1,this.el.removeAttribute("animation__pounceUp"),this.el.removeAttribute("animation__pounceDown"),updateCatGrid(),setTimeout(triggerSitForward,125)}),{once:!0})}),{once:!0}),this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__pounce"+e+"_rot"),i.removeAttribute("animation__pounce"+e+"_pos"),i.removeAttribute("animation__pounce"+e+"_scale"),t.rotation&&i.setAttribute("animation__pounce"+e+"_rot",t.rotation),t.position&&i.setAttribute("animation__pounce"+e+"_pos",t.position),t.scale&&i.setAttribute("animation__pounce"+e+"_scale",t.scale))}))}}),AFRAME.registerComponent("press-button",{schema:{speed:{type:"number",default:1},trigger:{type:"string",default:"pressbutton"}},init:function(){this.legs=[{id:"#spine-joint",rotation:{property:"rotation",to:"25 0 0",dur:125,easing:"linear"},position:{property:"position",to:"0 1 .41",dur:125,easing:"linear"}},{id:"#torso-joint",rotation:{property:"rotation",to:"10 0 0",dur:125,easing:"linear"},position:{property:"position",to:"0 1.2 0.55",dur:125,easing:"linear"}},{id:"#rear-joint",rotation:{property:"rotation",to:"45 0 0",dur:125,easing:"linear"},position:{property:"position",to:"0 -.32 .02",dur:125,easing:"linear"}},{id:"#backUpperLegL-joint",rotation:{property:"rotation",to:"35 0 90",dur:125,easing:"linear"}},{id:"#backUpperLegR-joint",rotation:{property:"rotation",to:"35 0 90",dur:125,easing:"linear"}},{id:"#backLegR-joint",rotation:{property:"rotation",to:"90 -190 0",dur:125,easing:"linear"}},{id:"#backLegL-joint",rotation:{property:"rotation",to:"90 -190 0",dur:125,easing:"linear"}},{id:"#frontLegL-joint",rotation:{property:"rotation",to:"55 0 -10",dur:125,easing:"linear"},position:{property:"position",to:"0.12 .3 0.4",dur:125,easing:"linear"}},{id:"#frontLegR-joint",rotation:{property:"rotation",to:"55 0 10",dur:125,easing:"linear"},position:{property:"position",to:"-.12 .3 0.4",dur:125,easing:"linear"}},{id:"#frontLowerLegL-joint",rotation:{property:"rotation",to:"-20 0 -15",dur:125,easing:"linear"},position:{property:"position",to:"-0.02 -.18 .02",dur:125,easing:"linear"}},{id:"#frontLowerLegR-joint",rotation:{property:"rotation",to:"-20 0 15",dur:125,easing:"linear"},position:{property:"position",to:"0.02 -.18 .02",dur:125,easing:"linear"}},{id:"#frontPawL-joint",rotation:{property:"rotation",to:"40 0 0",dur:125,easing:"linear"}},{id:"#frontPawR-joint",rotation:{property:"rotation",to:"40 0 0",dur:125,easing:"linear"}}],this.el.addEventListener(this.data.trigger,(()=>{triggerStand(),this.startLegAnimations()}))},startLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__press"+e+"_rot"),i.removeAttribute("animation__press"+e+"_pos"),t.rotation&&i.setAttribute("animation__press"+e+"_rot",t.rotation),t.position&&i.setAttribute("animation__press"+e+"_pos",t.position)),i.addEventListener("animationcomplete__press"+e+"_rot",(()=>{this.stopLegAnimations(),toggleLasers(0)}),{once:!0})}))},stopLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__press"+e+"_rot"),i.removeAttribute("animation__press"+e+"_pos"))}))}}),AFRAME.registerComponent("cat-seen",{schema:{speed:{type:"number",default:5},trigger:{type:"string",default:"startjump"},height:{type:"number",default:2}},init:function(){this.isMoving=!1,this.legs=[{id:"#cat",position:{property:"position",dur:250,easing:"easeOutQuad",dir:"alternate",loop:1}},{id:"#backUpperLegL-joint",rotation:{property:"rotation",to:"90 0 90",dur:150,easing:"linear"},position:{property:"position",to:".15 -.02 .1",dur:150,easing:"linear"}},{id:"#backUpperLegR-joint",rotation:{property:"rotation",to:"90 0 90",dur:150,easing:"linear"},position:{property:"position",to:"-.15 0 .02",dur:150,easing:"linear"}},{id:"#backLegR-joint",rotation:{property:"rotation",to:"90 -90 0",dur:150,easing:"linear"},position:{property:"position",to:"0.2 0 .0",dur:150,easing:"linear"}},{id:"#backLegL-joint",rotation:{property:"rotation",to:"90 -90 0",dur:150,easing:"linear"},position:{property:"position",to:".2 0 .05",dur:150,easing:"linear"}},{id:"#frontLegL-joint",rotation:{property:"rotation",to:"-45 0 0",dur:150,easing:"linear"},position:{property:"position",to:"0.12 -.19 0.05",dur:150,easing:"linear"}},{id:"#frontLegR-joint",rotation:{property:"rotation",to:"-45 0 0",dur:150,easing:"linear"},position:{property:"position",to:"-.12 -.19 -.05",dur:150,easing:"linear"}},{id:"#frontLowerLegL-joint",rotation:{property:"rotation",to:"-25 0 0",dur:150,easing:"linear"},position:{property:"position",to:"0 -.21 .03",dur:150,easing:"linear"}},{id:"#frontLowerLegR-joint",rotation:{property:"rotation",to:"-25 0 0",dur:150,easing:"linear"},position:{property:"position",to:"0 -.21 .03",dur:150,easing:"linear"}}],this.el.addEventListener(this.data.trigger,(()=>{this.isMoving||(this.isMoving=!0,triggerStand(),this.startLegAnimations())})),this.el.addEventListener("stopjump",(()=>{this.stopLegAnimations(),this.el.emit("startrun")}))},startLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);if(i&&(t.rotation&&i.setAttribute("animation__jump"+e+"_rot",t.rotation),t.position)){const r=Object.assign({},t.position);if("cat"===i.id){let t=i.getAttribute("position");r.to=t.x+" "+this.data.height+" "+t.z,i.removeAttribute("animation__jump"+e+"_pos"),i.setAttribute("animation__jump"+e+"_pos",r),i.addEventListener("animationcomplete__jump"+e+"_pos",(()=>{i.emit("stopjump")}),{once:!0})}else i.setAttribute("animation__jump"+e+"_pos",r)}}))},stopLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__jump"+e+"_rot"),i.removeAttribute("animation__jump"+e+"_pos"),"cat"===i.id&&i.addEventListener("animationcomplete__jump"+e+"_pos",(()=>{i.emit("startrun")})))}))}}),AFRAME.registerComponent("walk-on-trigger",{schema:{speed:{type:"number",default:2},trigger:{type:"string",default:"startwalk"},distance:{type:"number",default:3}},init:function(){this.isMoving=!1,this.startPos=null,this.travelled=0,this.legs=[{id:"#shoulders",rotation:{property:"rotation",from:"0 0 -15",to:"0 0 15",dur:225,easing:"linear",loop:!0,dir:"alternate"}},{id:"#torso-joint",rotation:{property:"position",from:"0 0.46 0.15",to:"0 0.44 0.15",dur:225,easing:"linear",loop:!0,dir:"alternate",delay:112}},{id:"#rear-joint",rotation:{property:"position",from:"0 -.22 .02",to:"0 -.22 .04",dur:225,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backUpperLegL-joint",rotation:{property:"rotation",from:"75 0 90",to:"125 0 90",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backUpperLegR-joint",rotation:{property:"rotation",from:"125 0 90",to:"75 0 90",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backLegR-joint",rotation:{property:"rotation",from:"90 -85 0",to:"90 -75 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backLegL-joint",rotation:{property:"rotation",from:"90 -85 0",to:"90 -75 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLegL-joint",rotation:{property:"rotation",from:"45 0 0",to:"-25 0 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLegR-joint",rotation:{property:"rotation",from:"-25 0 0",to:"45 0 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLowerLegL-joint",rotation:{property:"rotation",from:"0 0 0",to:"-25 0 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLowerLegR-joint",rotation:{property:"rotation",from:"-25 0 0",to:"0 0 0",dur:450,easing:"linear",loop:!0,dir:"alternate"}}],this.el.addEventListener(this.data.trigger,(t=>{const e=t.detail&&t.detail.distance?t.detail.distance:0;this.isMoving||(this.remainingDistance=e,this.startLegAnimations(),this.isMoving=!0)})),this.el.addEventListener("stopwalk",(()=>{this.isMoving=!1,this.stopLegAnimations()}))},startLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(t.rotation&&i.setAttribute("animation__walk"+e+"_rot",t.rotation),t.position&&i.setAttribute("animation__walk"+e+"_pos",t.position))}))},stopLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__walk"+e+"_rot"),i.removeAttribute("animation__walk"+e+"_pos"))}))},tick:function(t,e){if(!this.isMoving)return;const i=this.data.speed*(e/1e3);if(void 0!==this.remainingDistance&&this.remainingDistance>0){const t=new THREE.Vector3;this.el.object3D.getWorldDirection(t),t.multiplyScalar(i),this.el.object3D.position.add(t),this.remainingDistance-=i,this.remainingDistance<=0&&(this.isMoving=!1,this.stopLegAnimations(),this.el.emit("stopwalk"))}}}),AFRAME.registerComponent("run-on-trigger",{schema:{speed:{type:"number",default:1},trigger:{type:"string",default:"startrun"}},init:function(){this.isMoving=!1,this.legs=[{id:"#torso-joint",rotation:{property:"position",from:"0 0.46 0.15",to:"0 0.42 0.15",dur:150,easing:"linear",loop:!0,dir:"alternate",delay:112}},{id:"#rear-joint",rotation:{property:"position",from:"0 -.22 .02",to:"0 -.22 .08",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backUpperLegL-joint",rotation:{property:"rotation",from:"55 0 90",to:"165 0 90",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backUpperLegR-joint",rotation:{property:"rotation",from:"55 0 90",to:"165 0 90",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backLegR-joint",rotation:{property:"rotation",from:"90 -85 0",to:"90 -75 0",dur:150,easing:"linear",loop:!0,dir:"alternate"},position:{property:"position",from:"0.2 0 .05",to:"0.2 0 .0",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#backLegL-joint",rotation:{property:"rotation",from:"90 -85 0",to:"90 -75 0",dur:150,easing:"linear",loop:!0,dir:"alternate"},position:{property:"position",from:"0.2 0 .05",to:"0.2 0 .0",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLegL-joint",rotation:{property:"rotation",from:"45 0 0",to:"-45 0 0",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLegR-joint",rotation:{property:"rotation",from:"45 0 0",to:"-45 0 0",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLowerLegL-joint",rotation:{property:"rotation",from:"0 0 0",to:"-25 0 0",dur:150,easing:"linear",loop:!0,dir:"alternate"},position:{property:"position",from:"0 -.21 0",to:"0 -.21 .03",dur:150,easing:"linear",loop:!0,dir:"alternate"}},{id:"#frontLowerLegR-joint",rotation:{property:"rotation",from:"0 0 0",to:"-25 0 0",dur:150,easing:"linear",loop:!0,dir:"alternate"},position:{property:"position",from:"0 -.21 0",to:"0 -.21 .03",dur:150,easing:"linear",loop:!0,dir:"alternate"}}],this.el.addEventListener(this.data.trigger,(()=>{this.isMoving||this.startLegAnimations(),this.isMoving=!0})),this.el.addEventListener("stoprun",(()=>{this.isMoving=!1,this.stopLegAnimations()}))},startLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(t.rotation&&i.setAttribute("animation__run"+e+"_rot",t.rotation),t.position&&i.setAttribute("animation__run"+e+"_pos",t.position))}))},stopLegAnimations:function(){this.legs.forEach(((t,e)=>{const i=document.querySelector(t.id);i&&(i.removeAttribute("animation__run"+e+"_rot"),i.removeAttribute("animation__run"+e+"_pos"))}))},tick:function(t,e){this.isMoving}}),AFRAME.registerComponent("sit-stand",{schema:{dur:{type:"int",default:250},easing:{type:"string",default:"easeInSine"}},init:function(){this.legs=[{id:"#head-joint",sit:{position:"0 0.34 0.10",rotation:"0 0 0"},stand:{position:"0 0.26 0.22",rotation:"0 0 0"}},{id:"#torso-joint",sit:{position:"0 .46 0.15",rotation:"0 0 0"},stand:{position:"0 .46 0.15",rotation:"0 0 0"}},{id:"#spine-joint",sit:{rotation:"45 0 0",position:"0 0.39 0"},stand:{rotation:"87 0 0",position:"0 0.47 -0.06"}},{id:"#rear-joint",sit:{position:"0 -.22 .02",rotation:"0 0 0"},stand:{position:"0 -.22 .02",rotation:"0 0 0"}},{id:"#backUpperLegR-joint",sit:{rotation:"0 0 90"},stand:{rotation:"90 0 90"}},{id:"#backUpperLegL-joint",sit:{rotation:"0 0 90"},stand:{rotation:"90 0 90"}},{id:"#backLegR-joint",sit:{position:"0.2 0 -.05",rotation:"90 -135 90"},stand:{position:"0.02 0 .1",rotation:"90 -90 0"}},{id:"#backLegL-joint",sit:{position:"0.2 0 -.05",rotation:"90 -135 90"},stand:{position:"0.02 0 .1",rotation:"90 -90 0"}},{id:"#frontLegR-joint",sit:{rotation:"0 0 10",position:"-0.09 -0.21 0.1"},stand:{rotation:"0 0 0",position:"-0.12 -0.19 0.05"}},{id:"#frontLegL-joint",sit:{rotation:"0 0 -10",position:"0.09 -0.21 0.1"},stand:{rotation:"0 0 0",position:"0.12 -0.19 0.05"}},{id:"#frontLowerLegR-joint",sit:{position:"0 -0.18 .01",rotation:"0 0 -5"},stand:{position:"0 -0.18 .01",rotation:"0 0 0"}},{id:"#frontLowerLegL-joint",sit:{position:"0 -0.18 .01",rotation:"0 0 5"},stand:{position:"0 -0.18 .01",rotation:"0 0 0"}},{id:"#tail-joint",sit:{rotation:"-20 0 0",position:"0 -0.15 -0.15"},stand:{rotation:"30 0 0",position:"0 -0.20 -0.18"}}],this.el.addEventListener("catsit",(()=>this.startLegAnimations("sit"))),this.el.addEventListener("catstand",(()=>this.startLegAnimations("stand")))},startLegAnimations:function(t){this.legs.forEach(((e,i)=>{const r=document.querySelector(e.id);r&&(r.removeAttribute("animation__pounce"+i+"_rot"),r.removeAttribute("animation__pounce"+i+"_pos"),r.removeAttribute("animation__pounce"+i+"_scale"),e[t].rotation&&(r.removeAttribute("animation__sitstand"+i+"_rot"),r.setAttribute("animation__sitstand"+i+"_rot",{property:"rotation",to:e[t].rotation,dur:this.data.dur,easing:this.data.easing})),e[t].position&&(r.removeAttribute("animation__sitstand"+i+"_pos"),r.setAttribute("animation__sitstand"+i+"_pos",{property:"position",to:e[t].position,dur:this.data.dur,easing:this.data.easing})))}))}}),AFRAME.registerComponent("grid-floor",{schema:{w:{default:8},h:{default:8},size:{default:1}},init(){const t=this.data.size,e=document.getElementById("gridTexture"),i=new THREE.CanvasTexture(e),r=e.getContext("2d");r.fillStyle="#fff",r.fillRect(0,0,e.width,e.height),r.strokeStyle="#999",r.lineWidth=1;for(let t=0;t<=e.width;t+=64)r.beginPath(),r.moveTo(t,0),r.lineTo(t,e.height),r.stroke(),r.moveTo(0,t),r.lineTo(e.width,t),r.stroke();i.wrapS=i.wrapT=THREE.RepeatWrapping,i.repeat.set(.25,.25);for(let e=0;e<this.data.h;e++)for(let r=0;r<this.data.w;r++){const o=document.createElement("a-plane");o.classList.add("floor-tile"),o.setAttribute("rotation","-90 0 0"),o.setAttribute("width",t),o.setAttribute("height",t),o.setAttribute("position",(r-this.data.w/2+.5)*t+" 0 "+(e-this.data.h/2+.5)*t),o.addEventListener("loaded",(()=>{const t=o.getObject3D("mesh");t&&(t.material.map=i,t.material.needsUpdate=!0)})),o.dataset.gx=r,o.dataset.gz=e,this.el.appendChild(o)}}}),AFRAME.registerComponent("blink",{init:function(){const t=this.el.querySelectorAll(".eye"),e=[],i=[];t.forEach(((t,r)=>{const o={...t.getAttribute("position")};e[r]=o,i[r]={x:o.x,y:o.y,z:.1}})),setTimeout((function r(){t.forEach(((t,r)=>{t.removeAttribute("animation__close"),t.removeAttribute("animation__open"),t.setAttribute("animation__close",{property:"position",to:i[r],dur:100,easing:"easeInSine"}),t.addEventListener("animationcomplete__close",(function i(){t.removeEventListener("animationcomplete__close",i),t.setAttribute("animation__open",{property:"position",to:e[r],dur:100,easing:"easeOutSine"})}))}));const o=2e3+2e3*Math.random();setTimeout(r,o)}),2e3)}}),AFRAME.registerComponent("look-at-cursor",{schema:{maxAngle:{type:"number",default:90}},init:function(){this.cursor=document.querySelector("#rightHand"),this.initialRotationY=this.el.object3D.rotation.y},tick:function(){const t=this.cursor.components.raycaster?.intersections;if(!t||0===t.length)return;const e=t[0].point.clone(),i=this.el.object3D,r=new THREE.Vector3;i.getWorldPosition(r);const o=e.clone().sub(r),n=i.parent.worldToLocal(o.clone().add(r)).sub(i.position),a=Math.atan2(n.x,n.z),s=-Math.atan2(n.y,Math.sqrt(n.x*n.x+n.z*n.z)),c=THREE.MathUtils.degToRad(this.data.maxAngle);let d=a;d=THREE.MathUtils.clamp(d,-c,c),i.rotation.order="YXZ",i.rotation.set(s,this.initialRotationY+d,0)}}),AFRAME.registerComponent("spotlight-detector",{schema:{target:{type:"selector"},angle:{type:"number",default:15},range:{type:"number",default:25},obstacles:{type:"string",default:".blocking-obj"}},init(){this.raycaster=new THREE.Raycaster,this.dir=new THREE.Vector3,this.v=new THREE.Vector3},tick(){if(!this.data.target&&(this.data.target=this.el.sceneEl.querySelector("#cat"),!this.data.target))return;const t=this.el.object3D,e=this.data.target.object3D,i=new THREE.Vector3,r=new THREE.Vector3;t.getWorldPosition(i),e.getWorldPosition(r),this.v.subVectors(r,i);const o=this.v.length();if(o>this.data.range)return;if(this.v.normalize(),this.dir.set(0,0,-1).applyQuaternion(t.quaternion).normalize(),THREE.MathUtils.radToDeg(this.dir.angleTo(this.v))>this.data.angle/2)return;const n=[];e.traverse((t=>{t.isMesh&&n.push(t)})),Array.from(document.querySelectorAll(this.data.obstacles)).map((t=>t.object3D)).forEach((t=>{t.traverse((t=>{t.isMesh&&n.push(t)}))})),this.raycaster.set(i,this.v),this.raycaster.far=o;const a=this.raycaster.intersectObjects(n,!0);if(a.length>0){const t=a[0].object;let e=!1;if(t.traverseAncestors((t=>{t.el&&"cat"===t.el.id&&(e=!0)})),e){setTimeout((()=>{this.data.target.emit("startjump"),meowAngry()}),0);let t=document.querySelector("#cat");this.data.runningHome=!0;const e=t.components["path-recorder"];t.components["retrace-path"].startRetrace(e.getPath())}}}}),AFRAME.registerComponent("path-recorder",{schema:{interval:{type:"number",default:200}},init:function(){this.points=[],this.time=0},clearPoints:function(){this.points=[],this.time=0},tick:function(t,e){if(this.time+=e,this.time<this.data.interval)return;this.time=0;const i=this.el.object3D.position.clone();(!this.points.length||i.distanceTo(this.points[this.points.length-1])>.2)&&(i.y=.45,this.points.push(i))},getPath:function(){return this.points.slice()}}),AFRAME.registerComponent("retrace-path",{schema:{speed:{type:"number",default:7}},init:function(){this.path=null,this.current=0},startRetrace:function(t){this.path=t.reverse(),this.current=0,this.el.emit("startrun")},tick:function(t,e){if(!this.path||this.current>=this.path.length)return void(this.el.components["run-on-trigger"].isMoving&&(this.el.emit("stoprun"),document.querySelector("#cat").components["path-recorder"].clearPoints()));const i=this.el.object3D.position,r=this.path[this.current],o=r.clone().sub(i);o.length()<.1?this.current++:(o.normalize(),i.addScaledVector(o,.001*e*this.data.speed),this.el.object3D.lookAt(r))}}),AFRAME.registerComponent("mirror-laser",{schema:{target:{type:"selector"},mirrorZ:{type:"number",default:-5}},tick:function(){const t=this.el,e=this.data.target,i=this.data.mirrorZ,r=t.getAttribute("line");if(!r)return;const o=new THREE.Vector3(r.start.x,r.start.y,r.start.z),n=new THREE.Vector3(r.end.x,r.end.y,r.end.z);t.object3D.localToWorld(o),t.object3D.localToWorld(n),o.z=2*i-o.z,n.z=2*i-n.z,e.setAttribute("line",{start:o,end:n,color:"#fff"})}}),AFRAME.registerComponent("mirror-figure",{schema:{target:{type:"selector"}},tick:function(){if(!this.data.target)return;const t=new THREE.Vector3;this.data.target.object3D.getWorldPosition(t),this.el.object3D.position.x=t.x}}),AFRAME.registerComponent("mirror-children",{schema:{target:{type:"selector"},axis:{type:"string",default:"z"},mirrorPos:{type:"number",default:-7.9}},tick:function(){if(!this.data.target)return;srcPosition=this.data.target.getAttribute("position"),this.el.object3D.position.copy(this.data.target.getAttribute("position")),this.el.setAttribute("position",srcPosition.x+" "+srcPosition.y+" "+(this.data.mirrorPos-srcPosition.z+this.data.mirrorPos)),this.el.object3D.quaternion.copy(this.data.target.object3D.quaternion);const t=this.data.target.children,e=this.el.children;srcRotation=this.data.target.getAttribute("rotation"),this.el.setAttribute("rotation",srcRotation.x+" "+(180-srcRotation.y)+" "+srcRotation.z);for(let i=0;i<Math.min(t.length,e.length);i++){const r=t[i].object3D,o=e[i].object3D;o.quaternion.copy(r.quaternion),o.position.copy(r.position)}}}),AFRAME.registerComponent("tile-hover",{init:function(){this.hover=document.querySelector("#hover"),this.rightHand=document.querySelector("#rightHand"),this.currentTile=null,this.rightHand.addEventListener("raycaster-intersection",(t=>{const e=t.detail.intersections[0]?.object?.el;e&&e.classList.contains("floor-tile")&&(this.currentTile=e)})),this.rightHand.addEventListener("raycaster-intersection-cleared",(()=>{this.currentTile=null,this.hover.setAttribute("visible",!1)}))},tick:function(){if(this.currentTile)if(isAdjacent(this.currentTile,catGrid)){const t=this.currentTile.getAttribute("position");this.hover.setAttribute("position",t.x+" 0.425 "+t.z),this.hover.setAttribute("visible",!0)}else this.hover.setAttribute("visible",!1)}});let justPounced=!1,pressingButton=!1;document.addEventListener("DOMContentLoaded",(()=>{scene=document.querySelector("#scene"),room=document.querySelector("#room"),scene.addEventListener("loaded",(()=>{cat=buildEntity(catSpec,scene),buildEntity(bgSpec,scene),city(),buildEntity(hiddenArt,scene),buildEntity(hiddenCamera,scene);const t=document.querySelector("#rightHand"),e=document.querySelector("#hover");t&&(t.addEventListener("raycaster-intersection",(t=>intersect(t))),t.addEventListener("raycaster-intersection-cleared",(()=>{e.setAttribute("visible",!1)})),t.addEventListener("click",(t=>hit(t))));for(let t=-5.5;t<=7.5;t+=1.5){let e=document.createElement("a-cylinder");e.setAttribute("class","laser"),e.setAttribute("geometry","radius:.01;height:21"),e.setAttribute("rotation","90 0 0"),e.setAttribute("position",t+" 2.2 -7.5"),e.setAttribute("material","color:#f00;opacity:.3;emissive:#f66"),scene.appendChild(e)}let i=new THREE.BufferGeometry,r=new Float32Array(6e3);for(let t=0;t<2e3;t++){let e=(new THREE.Vector3).randomDirection().multiplyScalar(150);r.set([e.x,e.y,e.z],3*t)}i.setAttribute("position",new THREE.BufferAttribute(r,3));let o=new THREE.PointsMaterial({color:16777215,size:.2,sizeAttenuation:!1}),n=new THREE.Points(i,o);scene.object3D.add(n),document.addEventListener("click",(function(){updateCatGrid()}))}))}))</script><canvas id=gridTexture style=display:none height=64 width=64></canvas><canvas id=ventTexture style=display:none></canvas><canvas id=brickTexture style=display:none height=512 width=128></canvas><canvas id=brickTexture2 style=display:none height=128 width=128></canvas><canvas id=cityCanvas style=display:none height=211 width=211></canvas><a-scene background="color: #111" fog="type: exponential; color: #AAA" id=scene shadow="type: pcfsoft"><a-entity id=room></a-entity><a-entity id=reflection-cat></a-entity><a-entity id=menu position="200 3.5 -4" geometry=type:box;width:30;height:30;depth:30 material=color:#222;side:double><a-text position="-2.3 .5 0" value="INSIDE CAT" scale="4 4 4"></a-text><a-plane class=clickable height=.5 id=startLevel1 material=emissive:#00f onclick=startGame(1) position="-2 -.55 0" width=1.5><a-text position="-.35 0 .1" value="LEVEL 1" color=#fff></a-text></a-plane><a-plane class=clickable height=.5 id=startLevel2 material=emissive:#006 onclick=startGame(2) position="0 -.55 0" width=1.5><a-text position="-.35 0 .1" value="LEVEL 2" color=#fff></a-text></a-plane></a-entity><a-entity class=fader fade-trigger light="type: ambient; intensity: 0"></a-entity><a-entity id=rig position="200 1.2 3.2" rotation="0 0 0"><a-camera></a-camera><a-entity id=rightHand laser-controls="hand: right" raycaster="objects: .floor-tile, .button, .clickable; ignore: .nohit; sort: true"></a-entity></a-entity><a-entity id=player position="0 3 -19.4"><a-sphere color=#999 position="0 0 0" radius=.25></a-sphere><a-cone color=#999 height=.2 position="0 -.25 0" radius-bottom=.3 radius-top=.1></a-cone><a-cylinder color=#999 height=1 position="0 -.85 0" radius=.3></a-cylinder></a-entity></a-scene>