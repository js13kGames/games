<!doctype html><title>Internet Quest - js13kGames 2018</title><style>body{background-color:#000}canvas{position:absolute;width:640px;height:480px;border:5px solid #fff}</style><canvas id=game width=640 height=480></canvas><canvas id=text width=640 height=480></canvas><script>kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){function e(){if(r=requestAnimationFrame(e),o=performance.now(),n=o-i,i=o,!(1e3<n)){for(kontra._tick(),a+=n;a>=l;)d.update(h),a-=l;c(),d.render()}}let i,r,o,n,s=(t=t||{}).fps||60,a=0,l=1e3/s,h=1/s,c=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)},d={update:t.update,render:t.render,isStopped:!0,start(){i=performance.now(),this.isStopped=!1,requestAnimationFrame(e)},stop(){this.isStopped=!0,cancelAnimationFrame(r)}};return d},function(){let t={},e={},r={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;26>t;t++)r[65+t]=(10+t).toString(36);for(i=0;10>i;i++)r[48+i]=""+i;addEventListener("keydown",(function(i){let o=r[i.which];e[o]=!0,t[o]&&t[o](i)})),addEventListener("keyup",(function(t){e[r[t.which]]=!1})),addEventListener("blur",(function(){e={}})),kontra.keys={bind(e,i){[].concat(e).map((function(e){t[e]=i}))},unbind(e,i){[].concat(e).map((function(e){t[e]=i}))},pressed:t=>!!e[t]}}(),function(){var t=Math.min,e=Math.max;class i{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,r){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=r}get x(){return this._x}get y(){return this._y}set x(i){this._x=this._c?t(e(this._a,i),this._d):i}set y(i){this._y=this._c?t(e(this._b,i),this._e):i}}kontra.vector=(t,e)=>new i(t,e),kontra.vector.prototype=i.prototype;class r{init(t,e,i,r){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),r=r||i[e];this._ca=r,this.width=r.width,this.height=r.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=t=>(new r).init(t),kontra.sprite.prototype=r.prototype}(),function(){function t(t){let e=a.x-s(t.x,n(a.x,t.x+t.width)),i=a.y-s(t.y,n(a.y,t.y+t.height));return e*e+i*i<a.radius*a.radius}function e(){let e,i,r=h.length?h:l;for(let o=r.length-1;0<=o;o--)if(i=(e=r[o]).collidesWithPointer?e.collidesWithPointer(a):t(e))return e}function i(t){u[p[t.button]]=!0,o(t,"onDown")}function r(t){u[p[t.button]]=!1,o(t,"onUp")}function o(t,i){if(!kontra.canvas)return;let r,o,n;-1===t.type.indexOf("mouse")?(r=(t.touches[0]||t.changedTouches[0]).clientX,o=(t.touches[0]||t.changedTouches[0]).clientY):(r=t.clientX,o=t.clientY),a.x=r-kontra.canvas.offsetLeft,a.y=o-kontra.canvas.offsetTop,t.target===kontra.canvas&&(n=e())&&n[i]&&n[i](),c[i]&&c[i](t,n)}var n=Math.min,s=Math.max;let a,l=[],h=[],c={},d=[],u={},p={0:"left",1:"middle",2:"right"};addEventListener("mousedown",i),addEventListener("touchstart",i),addEventListener("mouseup",r),addEventListener("touchend",r),addEventListener("blur",(function(){u={}})),addEventListener("mousemove",(function(t){o(t,"onOver")})),a=kontra.pointer={x:0,y:0,radius:5,track(t){[].concat(t).map((function(t){t._r||(t._r=t.render,t.render=function(){l.push(this),this._r()},d.push(t))}))},untrack(t,e){[].concat(t).map((function(t){t.render=t._r,t._r=e;let i=d.indexOf(t);-1!==i&&d.splice(i,1)}))},over:t=>-1!==d.indexOf(t)&&e()===t,onDown(t){c.onDown=t},onUp(t){c.onUp=t},pressed:t=>!!u[t]},kontra._tick=function(){h.length=0,l.map((function(t){h.push(t)})),l.length=0}}();const letters={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]],"?":[[1,1,1],[,,1],[1,1,1],[,,],[1,,]],"!":[[,1],[,1],[,1],[,,],[,1]],"-":[[,,],[,,],[1,1,1]],".":[[,,],[,,],[,,],[,,],[1,,]],",":[[,,],[,,],[,,],[,1],[1,,]],"^":[[,1],[1,1,1],[,1],[,1],[,1]],"&":[[,1],[,1],[,1],[1,1,1],[,1]],"<":[[,,],[,1],[1,,],[,1],[,,]],">":[[,,],[,1],[,,1],[,1],[,,]],":":[[,,],[,1],[,,],[,1]],"/":[[,,],[,,1],[,1],[1,,]],"'":[[1,,],[1,,]]," ":[[,,],[,,],[,,],[,,],[,,]]},canvas=document.getElementById("text"),context=canvas.getContext("2d");function clearAllText(){context.clearRect(0,0,canvas.width,canvas.height)}function clearTextBox(){context.clearRect(0,325,canvas.width,150)}function clearLvl5(){context.clearRect(0,0,250,50),context.clearRect(180,50,30,25)}function drawText(t,e,i,r,o){let n=[];t=t.toUpperCase();for(let e=0;e<t.length;e++){const i=letters[t.charAt(e)];i&&n.push(i)}context.fillStyle=o;let s=i;for(let t=0;t<n.length;t++){const i=n[t];let o=r,a=0;for(let t=0;t<i.length;t++){const r=i[t];for(let t=0;t<r.length;t++)r[t]&&context.fillRect(s+t*e,o,e,e);a=Math.max(a,r.length*e),o+=e}s+=e+a}}function textBox(t,e,i){t=t.split("\\"),context.strokeStyle="white",context.fillStyle="black",context.lineWidth=4,context.rect(25,350,590,100),context.stroke(),context.fill(),drawText(t[0],4,35,360,i),drawText(t[1]||"",4,35,390,i),drawText(t[2]||"",4,35,420,i)}kontra.init(document.querySelector("#game"));const width=640,height=480;let curLvl=1;const playerSpeed=4,playerRad=kontra.sprite({width:60,height:60});let curDialogue,inDialogue=!1,curDialogueIndex=0,curDialogueChar=0,weapon=!1,health=10;const charSize=30,bulletSpeed=7,enemySpeed=2.5;let kills=0,fight=!0,lvl5BoxShown=!1,timers=[0,0,0],bullets=[],enemies=[],levels=[{player:kontra.vector(305,225),world:[],text:[[257.5,10,"^ Town ^",4,"white"]],triggers:[[270,0,100,30,2]],chars:{blue:{sprite:[305,100,30,30,"blue"],dialogue:["Hey Red!","What are you doing all the way down\\here? It's dangerous to go alo- err...\\unaccompanied! You need a weapon!","Go up into town, I'll meet you there\\in front of the shop."]}}},{player:kontra.vector(305,400),world:[[100,100,100,70,"white"],[100,170,30,30,"white"],[170,170,30,30,"white"],[440,100,100,70,"white"],[440,170,30,30,"white"],[510,170,30,30,"white"],[100,280,100,70,"white"],[100,350,30,30,"white"],[170,350,30,30,"white"],[440,280,100,70,"white"],[440,350,30,30,"white"],[510,350,30,30,"white"]],text:[[257.5,10,"^ Town ^",4,"white"]],triggers:[[270,0,100,20,3]],chars:{green:{sprite:[305,100,30,30,"green"],dialogue:["The shop?","It's just up North, be careful..."]}}},{player:kontra.vector(305,400),world:[[]],text:[[257.5,450,"& Town &",4,"white"],[10,215,"<- Shop",4,"white"],[250,10,"^ Internet ^",4,"white"]],triggers:[[270,460,100,20,2],[0,0,20,480,4],[270,0,100,30,5,!1]],chars:{}},{player:kontra.vector(535,225),world:[],text:[[515,215,"Town ->",4,"white"]],triggers:[[620,0,20,480,3]],chars:{blue:{sprite:[400,100,30,30,"blue"],dialogue:["Hi again!","Go talk to the shopkeeper, he can\\give you a weapon!"]},orange:{sprite:[100,300,30,30,"orange"],dialogue:["Hello there adventurer! What are\\you looking for?","You're looking for a weapon? Lucky\\for you, I have a data blaster, last\\one in stock! That'll be 400 bits!","You don't have any money? ...\\Well, why don't we make a deal?","The Internet went down this\\morning. I'll give you this data\\blaster, and in exchange you fix it.","How does that sound? ...","Great! You can find the Internet\\up to the north. Press Z to\\shoot the blaster. Good luck!"]}}},{player:kontra.vector(305,400),world:[],text:[[75,50,"Defeat    enemies to progress!",4,"white"]],triggers:[],chars:{}},{player:kontra.vector(305,400),world:[[270,75,100,50,"white"],[275,80,90,40,"black"]],text:[[150,25,"Turn on the Internet!",4,"white"]],triggers:[],chars:{}}];function createSprite(t){return kontra.sprite({x:t[0],y:t[1],width:t[2],height:t[3],color:t[4],level:t[4]})}function genLevels(){for(let t=0;t<levels.length;t++){for(let e=0;e<levels[t].world.length;e++){const i=levels[t].world[e];levels[t].world[e]=createSprite(i)}for(let e=0;e<levels[t].triggers.length;e++){const i=levels[t].triggers[e];levels[t].triggers[e]=createSprite(i),levels[t].triggers[e].enabled=!(null!=i[5])||i[5]}for(const e in levels[t].chars){const i=levels[t].chars[e].sprite;levels[t].chars[e].sprite=createSprite(i)}}}function getLevel(t){let e=levels[t-1];e.colliders=[];for(const t of e.world)e.colliders.push(t);for(const t in e.chars)e.colliders.push(e.chars[t].sprite);clearAllText();for(const t of e.text)drawText(t[2],t[3],t[0],t[1],t[4]);return e}function game(t){if(90!=t.keyCode)return;document.body.removeEventListener("keydown",game),clearAllText(),genLevels();let e=getLevel(1),i=kontra.sprite({x:305,y:225,color:"red",width:30,height:30,update(){5==curLvl&&(clearLvl5(),drawText(`Health: ${health}`,4,5,5,"white"),drawText(25-kills+"",4,180,50,"white"),0>=health&&(health=10,curLvl=3,e=getLevel(3),this.position=e.player,kills=0),25<=kills&&(r.stop(),enemies=[],bullets=[],fight=!1,weapon=!1,timers[2]=-1,r.start(),r.stop(),curLvl=6,e=getLevel(6),this.position=e.player,setTimeout((()=>r.start()),3e3))),6==curLvl&&130>this.y&&(r.stop(),this.render=()=>{},clearAllText(),setTimeout((()=>{const t=new Path2D;t.arc(316.5,100,7,0,2*Math.PI),kontra.context.fillStyle="#dc143c",kontra.context.fill(t)}),2e3),setTimeout((()=>{kontra.context.clearRect(0,0,640,480)}),4e3),setTimeout((()=>{kontra.context.clearRect(0,0,640,480),textBox("Thanks for playing!\\github.com/IvanFon\\<3",6,"white")}),6e3)),inDialogue||(kontra.keys.pressed("left")?(this.x-=4,e.colliders.forEach((t=>this.x+=this.collidesWith(t)?4:0))):kontra.keys.pressed("right")&&(this.x+=4,e.colliders.forEach((t=>this.x-=this.collidesWith(t)?4:0))),kontra.keys.pressed("up")?(this.y-=4,e.colliders.forEach((t=>this.y+=this.collidesWith(t)?4:0))):kontra.keys.pressed("down")&&(this.y+=4,e.colliders.forEach((t=>this.y-=this.collidesWith(t)?4:0)))),this.position.clamp(0,0,640-this.width,480-this.height);for(const t of e.triggers)if(this.collidesWith(t)){if(t.enabled){curLvl=t.level,e=getLevel(t.level),this.position=e.player,5==curLvl&&(timers[2]=120);break}5==t.level&&(textBox("You need a weapon first!",4,"white"),lvl5BoxShown=!0)}else lvl5BoxShown&&(clearTextBox(),lvl5BoxShown=!1);if(0>=timers[0]&&kontra.keys.pressed("z"))if(timers[0]=30,inDialogue)if(clearTextBox(),curDialogueIndex<curDialogue.length){if(0<=curDialogue[curDialogueIndex].indexOf("Area unlocked")){const t=curDialogue[curDialogueIndex].split("$");e.triggers[t[1]].enabled=!0,e.chars[curDialogueChar].dialogue.splice(curDialogueIndex,1),textBox("Area unlocked!",6,"#0891db")}else textBox(curDialogue[curDialogueIndex],6,"white");curDialogueIndex++}else inDialogue=!1,timers[1]=60;else for(const t in playerRad.x=this.x-15,playerRad.y=this.y-15,e.chars)if(e.chars[t].sprite.collidesWith(playerRad)){inDialogue=!0,curDialogueIndex=0,curDialogue=e.chars[t].dialogue,curDialogueChar=t,"orange"==t&&(weapon=!0,levels[2].triggers[2].enabled=!0),textBox(curDialogue[0],6,"white");break}if(0>=timers[1]&&kontra.keys.pressed("z")&&!inDialogue&&weapon){for(let t=0;4>t;t++).5<=Math.random()?bullets.push(kontra.sprite({x:i.x,y:i.y,width:3,height:12,color:"white",update(){0==t?this.y+=7:1==t?this.y-=7:2==t?this.x+=7:3==t&&(this.x-=7)}})):(bullets.push(kontra.sprite({x:i.x-5,y:i.y-5,width:10,height:10,color:"white",update(){0==t?this.y+=7:1==t?this.y-=7:2==t?this.x+=7:3==t&&(this.x-=7)}})),bullets.push(kontra.sprite({x:i.x-2,y:i.y-2,width:4,height:4,color:"black",update(){0==t?this.y+=7:1==t?this.y-=7:2==t?this.x+=7:3==t&&(this.x-=7)}})));timers[1]=20}}}),r=kontra.gameLoop({update(){i.update(),bullets=bullets.filter((t=>(t.update(),!(0>t.x||t.x>640||0>t.y||t.y>480)))),enemies.map((t=>t.update())),timers=timers.map((t=>--t)),0==timers[2]&&(enemies.push(kontra.sprite({x:.5<=Math.random()?640/6:640/6*5,y:.5<=Math.random()?80:400,width:20,height:20,color:"#ff00f1",health:2,update(){if(!(0>=this.health)){this.x>i.x&&(this.x-=2.5),this.x<i.x&&(this.x+=2.5),this.y>i.y&&(this.y-=2.5),this.y<i.y&&(this.y+=2.5),this.collidesWith(i)&&(health--,this.health=0,kills++);for(let t=0;t<bullets.length;t++)this.collidesWith(bullets[t])&&(bullets.splice(t,1),this.health--,0>=this.health&&kills++)}},render(){0<this.health&&this.draw()}})),fight&&(timers[2]=200-(25-kills)-8*kills))},render(){i.render(),bullets.map((t=>t.render())),enemies.map((t=>t.render())),e.world.map((t=>t.render())),Object.keys(e.chars).map((t=>e.chars[t].sprite.render()))}});r.start()}drawText("Internet Quest",10,10,10,"white"),drawText("arrow keys to move",7,10,125,"white"),drawText("z to interact",7,10,175,"white"),drawText("made by",7,10,275,"white"),drawText("Ivan Fonseca",7,230,275,"#0891db"),drawText("for js    games 2018",7,10,325,"white"),drawText("13k",7,170,325,"red"),drawText("press z to start",7,10,430,"#03c123"),document.body.addEventListener("keydown",game)</script>