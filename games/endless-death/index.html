<!doctype html><meta content="width=device-width" name=viewport><script src=/2022/webxr/aframe.js></script><style>body,html{width:100%;height:100%;margin:0;padding:0}.warning{font-size:2rem;font-weight:700}.warning,.warning_message{color:#a22929}.ui{position:absolute;z-index:9999;width:100%;height:100%;pointer-events:none}.ui_items{position:inherit;left:50%;transform:translate(-50%);bottom:5%;display:flex;align-items:center;justify-content:space-around;gap:5rem;width:70%;height:10%}.ui_text{font-size:3rem;font-weight:700;background:linear-gradient(90deg,rgba(251,251,204,.5843137254901961),rgba(252,192,191,.5843137254901961));background-clip:text;-webkit-background-clip:text;color:transparent;padding:.5rem}.ui_item{text-align:center}.ui_title{font-weight:400;display:block;font-size:2rem;margin-bottom:.5rem}.ui_flash,.ui_health{position:inherit;top:5%;right:5%;width:400px;height:100px}.ui_health{top:13%}.ui_flash_title,.ui_health_title{font-size:1.5rem;text-align:right;display:block;margin-bottom:.5rem}.battery_wrap,.health_wrap{border:2px solid rgba(240,248,255,.5843137254901961);width:100%;height:20px}.battery,.health{width:100%;height:100%;background:linear-gradient(90deg,rgba(255,140,140,.5843137254901961),hsla(0,0%,100%,.5843137254901961))}.health{background:linear-gradient(90deg,rgba(90,255,84,.5843137254901961),hsla(0,0%,100%,.5843137254901961))}.ui_clear,.ui_game_over,.ui_main{position:absolute;box-sizing:border-box;display:flex;flex-direction:column;justify-content:space-around;align-items:center;background-color:hsla(0,0%,50.6%,.30980392156862746);left:50%;top:50%;border-radius:5px;transform:translate(-50%,-50%);padding:2rem 4rem;color:hsla(0,0%,99.2%,.6784313725490196);font-size:1.5rem;text-align:center}.off{display:none}.ui_game_over_title,.ui_main_title{margin:0;font-size:3rem}.ui_game_over_desc,.ui_game_over_title{color:#a22929;font-weight:700}.tip{font-weight:700;display:block}.ui_game_over_start,.ui_main_start{pointer-events:all;cursor:pointer;border:none;padding:.5rem 2rem;border-radius:3px;background:#fff;color:#222;font-weight:700;font-size:1.5rem;margin-top:2rem}.ui_game_over_start{margin-top:1rem}.ui_clear_title{color:#fff;font-weight:700;font-size:3rem}.pulse_wrap{position:absolute;width:100%;height:100%}.pulse{animation:pulse 1.5s ease-out infinite}@keyframes pulse{0%{box-shadow:inset 0 0 30px rgba(255,0,0,.5450980392156862)}70%{box-shadow:inset 0 0 100px rgba(255,0,0,.5450980392156862)}to{box-shadow:inset 0 0 30px rgba(255,0,0,.5450980392156862)}}</style><body><a-scene id=gameScene><a-light color=#fff id=light intensity=0 position="0 20 -10" type=ambient></a-light><div class=ui><div class="pulse pulse_wrap"></div><div class=ui_main><h1 class=ui_main_title>ENDLESS DEATH</h1><p class=ui_main_story>You're on the verge of death.<br>Collect enough collection of life and get out of the MAZE OF DEATH.<br><br><span class=warning>WARNING</span><br><span class=warning_message>Even now, the Grim Reaper is chasing you.<br>They move slowly in the dark, but they'll jump at you when they feel your light.<br>They also move through walls, so you're not safe even with walls.</span><p class=ui_main_tips><span class=tip>Move: WASD</span> <span class=tip>Flash: Space Bar</span> <span class=tip>Walk/Run: Ctrl</span> <span class=tip>Sound On/Off: Zero</span><div class=ui_main_start>Press ENTER key to face DEATH...!</div></div><div class="off ui_game_over"><h1 class=ui_game_over_title>YOU ARE DEAD</h1><p class=ui_game_over_desc>Unfortunately, one of the Grim Reapers found you lacking life power.<br>And then Grim Reapers took all the life that was left and you finally died.<div class=ui_game_over_start>Press ENTER key to try again</div></div><div class="off ui_clear"><span class=ui_clear_title>YOU SURVIVED !</span><p>Congratulations! You have successfully collected all the signs of life.<br>Grim Reapers can't take your life anymore because you have enough life power.</div><div class="off ui_text ui_items"><div class="ui_item keys"><span class=ui_title>Collection of Life</span> <span class=ui_item_count>0</span> / <span class=ui_item_total>10</span></div><div class="ui_item monsters"><span class=ui_title>Grim Reapers</span> <span class=ui_item_count>0</span> / <span class=ui_item_total>5</span></div></div><div class="off ui_text ui_flash"><span class=ui_flash_title>Flash Battery</span><div class=battery_wrap><div class=battery></div></div></div><div class="off ui_text ui_health"><span class=ui_health_title>Health</span><div class=health_wrap><div class=health></div></div></div></a-scene><script>!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t){t.exports={camera:{},"wasd-controls":{},"look-controls":{pointerLockEnabled:!0},position:{x:-10,y:3,z:0},collision:""}},function(t){t.exports={type:"spot",angle:"40",decay:"1",distance:"300",color:"#fff",intensity:"0",position:"0 0 0"}},function(t,e){AFRAME.registerComponent("collision",{schema:{},init:function(){"player"===this.el.id?this.system.registerPlayer(this.el):/key/.test(this.el.id)?this.system.registerKey(this.el):this.system.registerWall(this.el)},update:function(){"player"===this.el.id&&this.system.registerPlayer(this.el)}})},function(t,e,i){},function(t,e,i){"use strict";i.r(e),AFRAME.registerComponent("coin",{schema:{sequence:{default:"gameover"},playbackRate:{default:1},volume:{default:1},loop:{default:!1},muted:{default:!1}},init:function(){this.system.initAudio(this.data)},update:function(){this.system.updateAudio(this.data)}}),AFRAME.registerComponent("footstep",{schema:{sequence:{default:"gameover"},playbackRate:{default:1},volume:{default:1},loop:{default:!1},muted:{default:!1}},init:function(){this.system.initAudio(this.data)},update:function(){this.system.updateAudio(this.data)}}),AFRAME.registerComponent("glitch",{schema:{sequence:{default:"gameover"},playbackRate:{default:1},volume:{default:1},loop:{default:!1},muted:{default:!1}},init:function(){this.system.initAudio(this.data)},update:function(){this.system.updateAudio(this.data)}}),AFRAME.registerComponent("music",{schema:{sequence:{default:"gameover"},playbackRate:{default:1},volume:{default:1},loop:{default:!1},muted:{default:!1}},init:function(){this.system.initAudio(this.data)},update:function(){this.system.updateAudio(this.data)}}),AFRAME.registerComponent("toggle",{schema:{sequence:{default:"gameover"},playbackRate:{default:1},volume:{default:1},loop:{default:!1},muted:{default:!1}},init:function(){this.system.initAudio(this.data)},update:function(){this.system.updateAudio(this.data)}}),i(2);var o=function(t){return Math.random()*t*2-t},n=function(t){return Math.floor(Math.random()*t)},s=function(t,e){return Math.floor(Math.random()*(e-t))+t},a=function(t,e,i,o){for(var n=[],a=0;a<Math.round(i/o);++a){var r=Array(o);r[0]=s(t,e),n.push.apply(n,r)}return n},r=function(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2};const u={coin:{songData:[{i:[2,138,116,0,2,138,128,4,0,0,47,48,162,63,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1],c:[{n:[206],f:[]}]}],rowLen:3675,patternLen:16,endPattern:0,numChannels:1},footstep:{songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[99],f:[]}]}],rowLen:7350,patternLen:4,endPattern:0,numChannels:1},gameover:{songData:[{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[1],c:[{n:[99],f:[]}]},{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[2],c:[{n:[],f:[]},{n:[153],f:[]}]},{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[3],c:[{n:[],f:[]},{n:[],f:[]},{n:[206],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:3},glitch:{songData:[{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[1],c:[{n:a(183,207,256,32),f:[]}]}],rowLen:5513,patternLen:256,endPattern:0,numChannels:1},music:{songData:[{i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],p:[1],c:[{n:a(99,123,256,4),f:[]}]}],rowLen:55125,patternLen:256,endPattern:0,numChannels:1},toggle:{songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[99],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1}},l=function(){var t,e,i,o,n,s=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,e,i){var o,n,s,r,l,h,c=u[t.i[0]],d=t.i[1],p=t.i[3]/32,m=u[t.i[4]],y=t.i[5],f=t.i[8]/32,g=t.i[9],v=t.i[10]*t.i[10]*4,b=t.i[11]*t.i[11]*4,$=t.i[12]*t.i[12]*4,A=1/$,E=-t.i[13]/16,w=t.i[14],M=i*2**(2-t.i[15]),S=new Int32Array(v+b+$),k=0,C=0;for(o=0,n=0;o<v+b+$;o++,n++)n>=0&&(n-=M,l=a(e+(15&(w=w>>8|(255&w)<<4))+t.i[2]-128),h=a(e+(15&w)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,o<v?s=o/v:o>=v+b&&(s=(1-(s=(o-v-b)*A))*3**(E*s)),r=c(k+=l*s**p)*d,r+=m(C+=h*s**f)*y,g&&(r+=(2*Math.random()-1)*g),S[o]=80*r*s|0;return S},u=[s,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(s){t=s,e=s.endPattern,i=0,o=s.rowLen*s.patternLen*(e+1)*2,n=new Int32Array(o)},this.generate=function(){var a,l,h,c,d,p,m,y,f,g,v,b,$,A,E=new Int32Array(o),w=t.songData[i],M=t.rowLen,S=t.patternLen,k=0,C=0,R=!1,q=[];for(h=0;h<=e;++h)for(m=w.p[h],c=0;c<S;++c){var O=m?w.c[m-1].f[c]:0;O&&(w.i[O-1]=w.c[m-1].f[c+S]||0,O<17&&(q=[]));var P=u[w.i[16]],W=w.i[17]/512,D=2**(w.i[18]-9)/M,H=w.i[19],F=w.i[20],x=43.23529*w.i[21]*3.141592/44100,_=1-w.i[22]/255,L=1e-5*w.i[23],j=w.i[24]/32,T=w.i[25]/512,z=6.283184*2**(w.i[26]-9)/M,I=w.i[27]/255,U=w.i[28]*M&-2;for(v=(h*S+c)*M,d=0;d<4;++d)if(p=m?w.c[m-1].n[c+d*S]:0){q[p]||(q[p]=r(w,p,M));var K=q[p];for(l=0,a=2*v;l<K.length;l++,a+=2)E[a]+=K[l]}for(l=0;l<M;l++)(g=E[y=2*(v+l)])||R?(b=x,H&&(b*=P(D*y)*W+.5),C+=(b=1.5*Math.sin(b))*($=_*(g-C)-(k+=b*C)),g=3==F?C:1==F?$:k,L&&(g=(g*=L)<1?g>-1?s(.25*g):-1:1,g/=L),R=(g*=j)*g>1e-5,A=g*(1-(f=Math.sin(z*y)*T+.5)),g*=f):A=0,y>=U&&(A+=E[y-U+1]*I,g+=E[y-U]*I),E[y]=0|A,E[y+1]=0|g,n[y]+=0|A,n[y+1]+=0|g}return++i/t.numChannels},this.createWave=function(){var t=44+2*o-8,e=t-36,i=new Uint8Array(44+2*o);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,a=44;s<o;++s){var r=n[s];r=r<-32767?-32767:r>32767?32767:r,i[a++]=255&r,i[a++]=r>>8&255}return i}},h=t=>{const e=new l,i=document.createElement("audio");e.init(u[t.sequence]);let o=!1;return setInterval((function(){if(!o&&(o=e.generate()>=1)){const o=e.createWave();i.src=URL.createObjectURL(new Blob([o],{type:"audio/wav"})),i.playbackRate=t.playbackRate,i.volume=t.volume,i.loop=t.loop,i.muted=t.muted}}),0),i};AFRAME.registerSystem("coin",{init:function(){this.audio=void 0,this.sequence=void 0},initAudio:function(t){this.audio=h(t),this.sequence=t.sequence},updateAudio:function(t){this.sequence===t.sequence?(this.audio.playbackRate=t.playbackRate,this.audio.volume=t.volume,this.audio.loop=t.loop,this.audio.muted=t.muted):this.initAudio(t)},playAudio:function(){r(this.audio)||this.audio.play()},pauseAudio:function(){r(this.audio)&&this.audio.pause()}}),AFRAME.registerSystem("footstep",{init:function(){this.audio=void 0,this.sequence=void 0},initAudio:function(t){this.audio=h(t),this.sequence=t.sequence},updateAudio:function(t){this.sequence===t.sequence?(this.audio.playbackRate=t.playbackRate,this.audio.volume=t.volume,this.audio.loop=t.loop,this.audio.muted=t.muted):this.initAudio(t)},playAudio:function(){r(this.audio)||this.audio.play()},pauseAudio:function(){r(this.audio)&&this.audio.pause()}}),AFRAME.registerSystem("glitch",{init:function(){this.audio=void 0,this.sequence=void 0},initAudio:function(t){this.audio=h(t),this.sequence=t.sequence},updateAudio:function(t){this.sequence===t.sequence?(this.audio.playbackRate=t.playbackRate,this.audio.volume=t.volume,this.audio.loop=t.loop,this.audio.muted=t.muted):this.initAudio(t)},playAudio:function(){r(this.audio)||this.audio.play()},pauseAudio:function(){r(this.audio)&&this.audio.pause()}}),AFRAME.registerSystem("music",{init:function(){this.audio=void 0,this.sequence=void 0},initAudio:function(t){this.audio=h(t),this.sequence=t.sequence},updateAudio:function(t){this.sequence===t.sequence?(this.audio.playbackRate=t.playbackRate,this.audio.volume=t.volume,this.audio.loop=t.loop,this.audio.muted=t.muted):this.initAudio(t)},playAudio:function(){r(this.audio)||this.audio.play()},pauseAudio:function(){r(this.audio)&&this.audio.pause()}}),AFRAME.registerSystem("toggle",{init:function(){this.audio=void 0,this.sequence=void 0},initAudio:function(t){this.audio=h(t),this.sequence=t.sequence},updateAudio:function(t){this.sequence===t.sequence?(this.audio.playbackRate=t.playbackRate,this.audio.volume=t.volume,this.audio.loop=t.loop,this.audio.muted=t.muted):this.initAudio(t)},playAudio:function(){r(this.audio)||this.audio.play()},pauseAudio:function(){r(this.audio)&&this.audio.pause()}});var c=function(){function t(){this.mapHeight=500,this.mapWidth=500,this.roomRowCount=5}return Object.defineProperty(t.prototype,"roomCount",{get:function(){return 2*this.roomRowCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roomSection",{get:function(){var t=this,e=3*-this.mapWidth/8,i=this.mapWidth/8-10,o=this.mapHeight/this.roomRowCount/2-10,n=3*this.mapWidth/8;return Array.from({length:this.roomRowCount}).reduce((function(i,o,s){var a=(2*s-t.roomRowCount)*t.mapHeight/(2*t.roomRowCount)+t.mapHeight/(2*t.roomRowCount);return i.leftRooms.push({x:e,z:a}),i.rightRooms.push({x:n,z:a}),i}),{leftRooms:[],rightRooms:[],xOffset:i,zOffset:o})},enumerable:!1,configurable:!0}),t}(),d=new function(){this.player={isRunning:!1,health:100,isMuted:!1,isFound:!1,nearMonsters:[]},this.level=new c,this.flash={isOn:!1,battery:100},this.uiItem={keys:{total:10,count:0},monsters:{total:10,count:0}},this.game={isStarted:!1,isClear:!1}},p=function(){function t(t,e,i,o,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n={}),this.$scene=document.querySelector("a-scene"),this.$el=document.createElement("a-entity"),this.$el.setAttribute("position",{x:e,y:i,z:o}),this.$el.setAttribute("geometry",{primitive:"box",width:n.width||2,height:n.height||2,depth:n.depth||2}),this.$el.setAttribute("material",{color:"#ffe45e",opacity:.9,shader:"standard"}),this.$el.setAttribute("collision",""),this.$el.setAttribute("visible",!0),this.$el.className="key",this.$el.id="key".concat(t),this.$scene.appendChild(this.$el)}return t.prototype.update=function(t){var e=this.$el.getAttribute("rotation");this.$el.setAttribute("rotation",{x:e.x+.1*Math.random()*t,y:e.y+.1*Math.random()*t})},t}(),m=(i.p,function(){function t(t){void 0===t&&(t={});var e=this;this.HEIGHT=5,this.BOUNCING_SPEED=.02,this.SPEED=.035,this.$gameScene=document.querySelector("#gameScene"),this.$el=document.createElement("a-box"),this.didFindPlayer=!1,this.deg=0,Object.keys(t).forEach((function(i){e.$el.setAttribute(i,t[i])})),this.$el.classList.add("monster"),setTimeout((function(){var t=new Image,i=new THREE.Texture(t);t.src="public/monster.webp",t.tex=i,t.onload=function(){this.tex.needsUpdate=!0};var o=[new THREE.MeshStandardMaterial({color:"#080808",roughness:.9}),new THREE.MeshStandardMaterial({color:"#080808",roughness:.9}),new THREE.MeshStandardMaterial({color:"#080808",roughness:.9}),new THREE.MeshStandardMaterial({color:"#080808",roughness:.9}),new THREE.MeshStandardMaterial({color:"#999999",map:i,roughness:.9}),new THREE.MeshStandardMaterial({color:"#080808",roughness:.9})];e.$el.getObject3D("mesh").material=new THREE.MultiMaterial(o)}),500),this.$gameScene.appendChild(this.$el)}return t.prototype.update=function(t){var e=this,i=d.flash,o=d.player,n=document.querySelector("#player").getAttribute("position"),s=n.x,a=n.y,r=n.z;this.$el.object3D.lookAt(new THREE.Vector3(s,a,r));var u=this.$el.getAttribute("position"),l=u.x,h=u.y,c=u.z,p=s-l,m=r-c,y=Math.abs(m/p),f=p>=0?1:-1,g=m>=0?1:-1,v=Math.sqrt(Math.pow(p,2)+Math.pow(m,2));v<150?o.nearMonsters.includes(this)||o.nearMonsters.push(this):o.nearMonsters=o.nearMonsters.filter((function(t){return t!==e})),!this.didFindPlayer&&v<13&&(this.didFindPlayer=!0,this.$el.emit("player-dead",{x:l,y:h,z:c}),this.$gameScene.systems.game.restartGame());var b=this.didFindPlayer||!i.isOn?.08*this.SPEED:this.SPEED,$=this.didFindPlayer?0:Math.sqrt(Math.pow(b,2)/(1+Math.pow(y,2))),A=$*y;this.$el.setAttribute("position",{x:l+$*f*t,y:this.HEIGHT+Math.sin(Math.PI*this.deg),z:c+A*g*t}),this.deg+=this.BOUNCING_SPEED},t.prototype.setDidFindPlayer=function(t){this.didFindPlayer=t},t}()),y=function(){return(y=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},f=function(){function t(){}return Object.defineProperty(t,"roomDepth",{get:function(){return d.level.mapWidth/4},enumerable:!1,configurable:!0}),t.getDoorWidth=function(t){return d.level.mapHeight/t},t.createWall=function(t){var e=document.createElement("a-box"),i=y({material:{roughness:.9},height:30,depth:10,color:"#390904",collision:""},t);return Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),e.className="wall",this.$walls.push(e),e},t.addKeys=function(t){for(var e=0;e<t;e++)this.$keys.push(new p(e,o(d.level.mapWidth/2),1.5,o(d.level.mapHeight/2)))},t.generateRooms=function(t){for(var e=d.level,i=Math.max(e.roomRowCount,3),o=[e.mapHeight/2-.5*this.getDoorWidth(i),e.mapHeight/2-.25*this.getDoorWidth(i)+5,e.mapHeight/2-.75*this.getDoorWidth(i)-5],s=1;s<i;s++)t.append(this.createWall({width:this.roomDepth+s%2*this.roomDepth*1.25,position:"".concat(-(e.mapWidth/2-.5*this.roomDepth-s%2*(1.25*this.roomDepth*.75))," 15 ").concat(e.mapHeight/2-e.mapHeight/i*s),rotation:"0 0 0"}),this.createWall({width:this.roomDepth+(s+1)%2*this.roomDepth*1.25,position:"".concat(e.mapWidth/2-.5*this.roomDepth-(s+1)%2*(1.25*this.roomDepth*.75)," 15 ").concat(e.mapHeight/2-e.mapHeight/i*s),rotation:"0 0 0"}));for(s=0;s<i;s++)t.append(this.createWall({width:.5*this.getDoorWidth(i),position:"-".concat(this.roomDepth," 15 ").concat(o[n(3)]-this.getDoorWidth(i)*s),rotation:"0 90 0"}),this.createWall({width:.5*this.getDoorWidth(i),position:"".concat(this.roomDepth," 15 ").concat(o[n(3)]-this.getDoorWidth(i)*s),rotation:"0 90 0"}))},t.generateWorld=function(){var t=document.createDocumentFragment();this.$sky=document.createElement("a-sky"),this.$sky.setAttribute("color","#171101"),this.$sky.setAttribute("radius",Math.max(d.level.mapHeight,d.level.mapWidth)/2*1.5),this.$ground=document.createElement("a-plane"),this.$ground.setAttribute("position","0 0 0"),this.$ground.setAttribute("rotation","-90 0 0"),this.$ground.setAttribute("width",d.level.mapWidth),this.$ground.setAttribute("height",d.level.mapHeight),this.$ground.setAttribute("material",{color:"#071e38",roughness:.9});var e=[this.createWall({position:"-".concat(d.level.mapWidth/2," 15 0"),width:d.level.mapHeight,rotation:"0 90 0"}),this.createWall({position:"".concat(d.level.mapWidth/2," 15 0"),width:d.level.mapHeight,rotation:"0 90 0"}),this.createWall({position:"0 15 -".concat(d.level.mapHeight/2),width:d.level.mapWidth,rotation:"0 0 0"}),this.createWall({position:"0 15 ".concat(d.level.mapHeight/2),width:d.level.mapWidth,rotation:"0 0 0"})];t.append.apply(t,function(t,e,i){if(i||2===arguments.length)for(var o,n=0,s=e.length;n<s;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}([this.$sky,this.$ground],e,!1)),this.generateRooms(t),this.$gameScene.appendChild(t)},t.spawnMonster=function(t){var e=this;Array.from({length:t}).forEach((function(t,i){var o={x:(Math.random()*(d.level.mapWidth/2-2e3)+2e3)*(Math.random()<.5?1:-1),y:5,z:(Math.random()*(d.level.mapHeight/2-2e3)+2e3)*(Math.random()<.5?1:-1)};e.$monsters.push(new m({position:o,width:10,height:10,depth:10}))}))},t.removeEntity=function(t){var e=t.$el?t.$el:t;e.parentNode.removeChild(e)},t.removeEntities=function(t){for(;t.length>0;)this.removeEntity(t.pop())},t.stopMonsters=function(){this.$monsters.forEach((function(t){t.setDidFindPlayer(!0)}))},t.removeKey=function(t){this.$keys=this.$keys.filter((function(e){return e.$el.id!==t.id})),this.removeEntity(t)},t.removeStage=function(){this.removeEntity(this.$sky),this.removeEntity(this.$ground),this.removeEntities(this.$walls),this.removeEntities(this.$keys),this.removeEntities(this.$monsters)},t.createStage=function(t){void 0===t&&(t=1);var e=d.level,i=d.uiItem;if(1===t)e.roomRowCount=19,e.mapHeight=100*e.roomRowCount,i.monsters.total=6,i.keys.total=20,this.generateWorld(),this.addKeys(i.keys.total),this.spawnMonster(i.monsters.total)},t.update=function(t){this.$keys.forEach((function(e){e.update(t)})),this.$monsters.forEach((function(e){e.update(t)}))},t.clear=function(){d.game.isClear=!0,this.stopMonsters(),document.querySelector("#player").removeAttribute("wasd-controls"),document.querySelector(".ui_clear").classList.remove("off")},t.$gameScene=document.querySelector("#gameScene"),t.$sky=void 0,t.$ground=void 0,t.$walls=[],t.$keys=[],t.$monsters=[],t}();AFRAME.registerSystem("collision",{init:function(){this.keys=[],this.walls=[],this.wallsWithCollision=[],this.keyWithCollision,this.player,this.playerOldPosition},registerPlayer:function(t){this.player=t},registerKey:function(t){this.keys.push(t)},registerWall:function(t){this.walls.push(t)},detectCollisionWithWall:function(){var t=this;this.wallsWithCollision=this.walls.filter((function(e){return t.isCollide(e,.1)}))},detectCollisionWithKey:function(){var t=this;this.keyWithCollision=this.keys.find((function(e){return t.isCollide(e,3.5)}))},isCollide:function(t,e){var i=this.player.object3D.position,o=i.x,n=i.y,s=i.z,a=new THREE.Box3,r=t.getObject3D("mesh");a.setFromObject(r);var u=a.min,l=a.max;return o<=l.x+e&&o>=u.x-e&&n<=l.y+e&&n>=u.y-e&&s<=l.z+e&&s>=u.z-e},solveCollisionWithWall:function(){if(void 0!==this.playerOldPosition&&0!==this.wallsWithCollision.length){var t=this.playerOldPosition,e=t[0],i=t[1],o=t[2],n=this.player.object3D.position,s=n.x,a=n.y,r=n.z;this.player.object3D.position.x+=3.3*(e-s),this.player.object3D.position.y+=3.3*(i-a),this.player.object3D.position.z+=3.3*(o-r)}},solveCollisionWithKey:function(){void 0!==this.keyWithCollision&&(this.keyWithCollision.emit("find-key"),f.removeKey(this.keyWithCollision))},updatePlayerOldPosition:function(){var t=this.player.object3D.position,e=t.x,i=t.y,o=t.z;this.playerOldPosition=[e,i,o]},tick:function(){void 0!==this.player&&(this.detectCollisionWithWall(),this.detectCollisionWithKey(),this.solveCollisionWithWall(),this.solveCollisionWithKey(),this.updatePlayerOldPosition())}});var g=i(0),v=i(1),b=function(){function t(t){var e=this;this.FLASH_CONSUME_SPEED=.05,this.FLASH_CHARGE_SPEED=.01,this.$toggle=document.querySelector("#gameScene").systems.toggle,this.$battery=document.querySelector(".battery"),this.$el=document.createElement("a-light");var i=v;Object.keys(i).forEach((function(t){e.$el.setAttribute(t,i[t])})),t.appendChild(this.$el)}return t.prototype.chargeBattery=function(){var t=d.flash,e=d.player;requestAnimationFrame(function i(){e.isFound||(t.battery=Math.min(t.battery+this.FLASH_CHARGE_SPEED,100),this.$battery.style.width="".concat(t.battery,"%"),!t.isOn&&t.battery<100&&requestAnimationFrame(i.bind(this)))}.bind(this))},t.prototype.consumeBattery=function(){var t=d.flash,e=d.player,i=d.game;requestAnimationFrame(function o(){e.isFound||i.isClear||(t.battery=Math.max(t.battery-this.FLASH_CONSUME_SPEED,0),this.$battery.style.width="".concat(t.battery,"%"),t.isOn&&requestAnimationFrame(o.bind(this)),0===t.battery&&(t.isOn=!1,this.$el.setAttribute("intensity","0"),this.chargeBattery()))}.bind(this))},t.prototype.turnOff=function(){this.$el.setAttribute("intensity","0"),this.$toggle.playAudio(),this.chargeBattery()},t.prototype.turnOn=function(){var t=d.flash;t.battery<1?t.isOn=!t.isOn:(this.$el.setAttribute("intensity","2"),this.$toggle.playAudio(),this.consumeBattery())},t}(),$=function(){return($=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},A=function(){function t(){var t=this;this.HEALTH_CONSUME_SPEED=.05,this.HEALTH_RECOVER_SPEED=.01,this.$gameScene=document.querySelector("#gameScene"),this.$mainPage=document.querySelector(".ui_main"),this.$gameOverPage=document.querySelector(".ui_game_over"),this.$health=document.querySelector(".health"),this.$el=document.createElement("a-entity"),this.$footstep=this.$gameScene.systems.footstep,this.$glitch=this.$gameScene.systems.glitch,this.$music=this.$gameScene.systems.music;var e=g;Object.keys(e).forEach((function(i){t.$el.setAttribute(i,e[i])})),this.$el.id="player",this.flash=new b(this.$el),this.$gameScene.appendChild(this.$el),this.initEventHandler()}return t.prototype.run=function(t){var e=d.player;this.$el.setAttribute("wasd-controls",$($({},t),{acceleration:200})),requestAnimationFrame(function t(){if(!e.isFound&&!d.game.isClear){var i=this.$el.components["wasd-controls"].velocity,o=Math.abs(i.x)>5||Math.abs(i.y)>5||Math.abs(i.z)>5;e.health=Math.max(e.health-(o?this.HEALTH_CONSUME_SPEED:0),0),this.$health.style.width="".concat(e.health,"%"),e.isRunning&&requestAnimationFrame(t.bind(this)),0===e.health&&(e.isRunning=!1,this.walk())}}.bind(this))},t.prototype.walk=function(t){var e=d.player;this.$el.setAttribute("wasd-controls",$($({},t),{acceleration:65})),requestAnimationFrame(function t(){e.isFound||(e.health=Math.min(e.health+this.HEALTH_RECOVER_SPEED,100),this.$health.style.width="".concat(e.health,"%"),!e.isRunning&&e.health<100&&requestAnimationFrame(t.bind(this)))}.bind(this))},t.prototype.resetStatus=function(){var t=d.flash,e=d.player;d.game.isClear=!1,t.isOn=!1,this.flash.turnOff(),e.isRunning=!1,t.battery=100,e.health=100,document.querySelector(".health").style.width="100%",document.querySelector(".battery").style.width="100%",e.nearMonsters=[]},t.prototype.initEventHandler=function(){var t=this,e=d.flash,i=d.player,o=d.game;document.addEventListener("player-dead",(function(e){t.$el.removeAttribute("look-controls"),requestAnimationFrame(function t(){var i=this.$el,o=i.components["wasd-controls"];o&&(o.velocity={x:0,y:0,z:0});var n=e.detail,s=n.x,a=n.y,r=n.z,u=i.object3D.position;s-=2*(s-u.x),a-=2*(a-u.y),r-=2*(r-u.z),this.$el.object3D.lookAt(s,a,r),d.player.isFound?requestAnimationFrame(t.bind(this)):this.$el.setAttribute("look-controls",{pointerLockEnabled:!0})}.bind(t))})),document.addEventListener("keydown",(function(n){if(!o.isClear)if("Enter"!==n.key)if(document.pointerLockElement&&o.isStarted){if(!i.isFound&&o.isStarted){var s=t.$el.getAttribute("wasd-controls"),a=t.$el.getAttribute("coin"),r=t.$el.getAttribute("footstep"),u=t.$el.getAttribute("glitch"),l=t.$el.getAttribute("music"),h=t.$el.getAttribute("toggle");switch(n.key){case" ":if(e.isOn=!e.isOn,!e.isOn){t.flash.turnOff();break}t.flash.turnOn();break;case"Control":i.isRunning=!i.isRunning,i.isRunning?t.run(s):t.walk(s),t.$el.setAttribute("footstep",$($({},r),{playbackRate:i.isRunning?2:1}));break;case"0":i.isMuted=!i.isMuted,t.$el.setAttribute("coin",$($({},a),{muted:i.isMuted})),t.$el.setAttribute("footstep",$($({},r),{muted:i.isMuted})),t.$el.setAttribute("glitch",$($({},u),{muted:i.isMuted})),t.$el.setAttribute("music",$($({},l),{muted:i.isMuted})),t.$el.setAttribute("toggle",$($({},h),{muted:i.isMuted}))}}}else t.$el.removeAttribute("wasd-controls");else{if(t.$footstep.playAudio(),t.$glitch.playAudio(),t.$music.playAudio(),o.isStarted){if(d.player.isFound){var c=t.$el.getAttribute("glitch");d.player.isFound=!1,t.$gameOverPage.classList.add("off"),f.removeStage(),f.createStage(1),t.resetStatus(),t.$gameScene.systems.game.resetUi(),t.$el.setAttribute("look-controls",{pointerLockEnabled:!0}),t.$glitch.pauseAudio(),t.$el.setAttribute("glitch",$($({},c),{sequence:"glitch",volume:.3,loop:!0})),t.$glitch.playAudio()}}else o.isStarted=!0,t.$mainPage.classList.add("off"),document.querySelector(".ui_items").classList.remove("off"),document.querySelector(".ui_flash").classList.remove("off"),document.querySelector(".ui_health").classList.remove("off");t.$el.setAttribute("wasd-controls",{acceleration:d.player.isRunning?200:65})}}))},t.prototype.coinCharge=function(){d.flash.battery=Math.min(d.flash.battery+15,100),d.player.health=Math.min(d.player.health+15,100)},t}(),E=function(){function t(){this.$keys=document.querySelector(".keys"),this.$monsters=document.querySelector(".monsters"),this.$gameOverPage=document.querySelector(".ui_game_over"),this.initUiItems()}return t.prototype.initUiItems=function(){var t=d.uiItem,e=t.keys,i=t.monsters;this.$keys.querySelector(".ui_item_total").textContent="".concat(e.total),this.$keys.querySelector(".ui_item_count").textContent="".concat(e.count),this.$monsters.querySelector(".ui_item_total").textContent="".concat(i.total),this.$monsters.querySelector(".ui_item_count").textContent="".concat(i.count)},t.prototype.setKeyCount=function(t){d.uiItem.keys.count=t,this.$keys.querySelector(".ui_item_count").textContent="".concat(t)},t.prototype.setMonsterCount=function(t){d.uiItem.monsters.count=t,this.$monsters.querySelector(".ui_item_count").textContent="".concat(t)},t.prototype.setGameOverUi=function(){var t=this;d.game.isClear=!0,new Promise((function(e,i){setTimeout((function(){t.$gameOverPage.classList.remove("off"),e()}),1500)})).then((function(){d.game.isClear=!1}))},t}(),w=function(){return(w=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};AFRAME.registerSystem("game",{schema:{},init:function(){var t=this;this.$gameScene=document.querySelector("#gameScene"),f.createStage(1),document.addEventListener("pointerlockchange",function(){d.player.isFound||d.game.isClear||(document.pointerLockElement?this.$player.$el.setAttribute("wasd-controls",{acceleration:d.player.isRunning?200:65}):this.$player.$el.setAttribute("wasd-controls",{acceleration:0}))}.bind(this),!1),document.addEventListener("find-key",(function(){t.$gameScene.systems.coin.playAudio(),t.$player.coinCharge(),t.$ui.setKeyCount(d.uiItem.keys.count+1),d.uiItem.keys.count===d.uiItem.keys.total&&f.clear()})),this.$player=new A,this.$ui=new E,this.$player.$el.setAttribute("coin",{sequence:"coin",playbackRate:1,volume:1,loop:!1,muted:d.player.isMuted}),this.$player.$el.setAttribute("footstep",{sequence:"footstep",playbackRate:1,volume:1,loop:!0,muted:d.player.isMuted}),this.$player.$el.setAttribute("glitch",{sequence:"glitch",playbackRate:1,volume:.3,loop:!0,muted:d.player.isMuted}),this.$player.$el.setAttribute("music",{sequence:"music",playbackRate:1,volume:.3,loop:!0,muted:d.player.isMuted}),this.$player.$el.setAttribute("toggle",{sequence:"toggle",playbackRate:10,volume:1,loop:!1,muted:d.player.isMuted})},tick:function(t,e){if(d.player.nearMonsters.length?document.querySelector(".pulse_wrap").classList.add("pulse"):document.querySelector(".pulse_wrap").classList.remove("pulse"),!d.game.isClear&&!d.player.isFound&&this.$player.$el.components["wasd-controls"]){var i=d.player,o=this.$player.$el.getAttribute("footstep"),n=this.$player.$el.getAttribute("glitch"),s=this.$player.$el.components["wasd-controls"].velocity,a=Math.abs(s.x||s.y||s.z)>5;this.$player.$el.setAttribute("footstep",w(w({},o),{muted:i.isMuted||!a})),this.$ui.setMonsterCount(i.nearMonsters.length),i.isMuted||this.$player.$el.setAttribute("glitch",w(w({},n),{volume:.05*i.nearMonsters.length})),f.update(e)}},restartGame:function(){var t=this.$gameScene.systems.glitch,e=this.$player.$el.getAttribute("glitch");d.player.isFound=!0,f.stopMonsters(),this.$player.flash.turnOn(),this.$player.$el.setAttribute("wasd-controls",{acceleration:0}),t.pauseAudio(),this.$player.$el.setAttribute("glitch",w(w({},e),{sequence:"gameover",volume:.3,loop:!1})),t.playAudio(),this.$ui.setGameOverUi()},resetUi:function(){this.$ui.setKeyCount(0),this.$ui.setMonsterCount(0)}}),i(3)}])</script>