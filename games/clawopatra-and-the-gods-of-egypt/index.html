<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Kamil Zurek"><title>Claw'opatra and the Gods of Egypt</title><style>body{margin:0;padding:20px;background:linear-gradient(135deg,#1a2a6c,#2a4b8c);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:#fff;text-align:center;min-height:100vh;display:flex;flex-direction:column;align-items:center;position:relative;overflow-x:hidden;background:linear-gradient(to top,#321 0,#531 15%,#ff9729 50%,#2816a8 100%)}.container{max-width:100%;display:flex;flex-direction:column;align-items:center}h1{text-shadow:2px 2px 4px rgba(0,0,0,.5);margin-bottom:10px;margin-top:15px;font-size:42px;color:#fff6a7;text-shadow:0 0 15px #f90,0 0 25px #f50;font-weight:700}.description{margin-bottom:20px;opacity:.9;max-width:600px}button{background:linear-gradient(45deg,#ea5e3d,#c1371b);color:#fff;border:none;padding:12px 24px;border-radius:5px;cursor:pointer;font-weight:700;transition:transform .2s,background .2s;margin:5px}button:hover{transform:translateY(-2px);background:linear-gradient(45deg,#ff5252,#e53935)}.turn-counter{font-size:20px;font-weight:700;margin:10px 0;padding:8px 15px;background:rgba(255,255,255,.2);border-radius:10px;display:none}.map-and-lgs{display:flex;justify-content:center;align-items:flex-start;gap:10px;margin:10px 0}.lg-left,.lg-right{display:flex;flex-direction:column;justify-content:space-between;min-width:180px;background:rgba(0,0,0,.2);padding:15px;border-radius:10px;height:510px;width:200px;background:url(data:image/gif;base64,R0lGODlhGAAOAKIAAOSXWt+QU9uLT9eHS9KCSMR1P7prOcx8RCH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDMgNzkuOTY5MGE4N2ZjLCAyMDI1LzAzLzA2LTIwOjUwOjE2ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjYuNyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1NTc4RDE0NDg2NkMxMUYwODg3MTk2QkVDNUZEOUY5NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OENEMjRDMDg2RjAxMUYwODg3MTk2QkVDNUZEOUY5NyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjU1NzhEMTQyODY2QzExRjA4ODcxOTZCRUM1RkQ5Rjk3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU1NzhEMTQzODY2QzExRjA4ODcxOTZCRUM1RkQ5Rjk3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAABgADgAAA4pYd9UkIRwzAoBDiDEUGUSoRYAUnZ/IgB+YjQcEBaFIeOFSZ8azCYQFY1EwHHJFRaMxLBoMyU4sIij4NIXMY3mzOo4SDgfYAnZqkyfz8Mqwf0dPHGpNL4dBkH1pdUOhISx9OUR3DEpGRyGGQh9FYgQSUI0NkwpsAxMPARkDiQsdlXeLnzl0RYeiDQkAOw==);background-repeat:repeat;background-size:240px 140px;image-rendering:pixelated}.lg-content{flex-grow:1}.controls-bottom{margin-top:auto;padding-top:15px;border-top:1px solid rgba(255,255,255,.2)}.map-container{overflow:visible;display:flex;justify-content:center;flex-direction:column;padding:20px;background:rgba(0,0,0,.2);border-radius:10px;box-sizing:border-box;transition:all .5s ease;height:540px}.map-container.power-effect{animation:powerFlash 1s ease-in-out}@keyframes powerFlash{0%,100%{box-shadow:0 0 0 transparent}50%{box-shadow:0 0 50px currentColor}}#mapTable{border-collapse:collapse;border:8px inset #ece3ae;border-radius:5px;box-shadow:0 10px 50px rgba(0,0,0,.8);background:#000;transform:rotateX(60deg) rotateZ(45deg);width:auto;height:auto;transition:all .5s ease}#mapTable td{width:8px;height:8px;padding:0;margin:0;transition:all .2s ease;position:relative;box-sizing:border-box}#mapTable.zoomed td{width:14px;height:14px}.start-point{position:relative;border:3px solid #fff!important;background:red!important;box-sizing:border-box;z-index:10}.civ-cell{position:relative}.civ-cell::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(255,0,0,.8);z-index:1}.enemy-cell{position:relative}.enemy-cell::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(67,46,80,.85);z-index:2}.conflict-flash{animation:conflictFlash 1s ease-in-out}@keyframes conflictFlash{0%,100%{opacity:1;box-shadow:0 0 0 rgba(255,0,0,0)}50%{opacity:.5;box-shadow:0 0 15px rgba(255,0,0,1)}}.highlighted-cell{filter:brightness(200%);transition:filter .3s ease;z-index:20}.lg-item,.lg-item2{display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:10px}.lg-color{width:20px;height:20px;margin-right:8px;border:1px solid #fff;border-radius:3px;flex-shrink:0}.lg-text{flex-grow:1;text-align:left;font-size:14px}.lg-count{margin-left:10px;font-weight:700;min-width:30px;text-align:right;font-size:14px}.game-controls{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap;justify-content:center}.control-group{display:flex;flex-direction:column;gap:5px;margin:0 10px;align-items:center}.control-group-label{font-weight:700;margin-bottom:5px;font-size:14px}.time-controls button{padding:8px 16px;font-size:14px;width:100%}.time-controls button.active{background:linear-gradient(45deg,#4caf50,#2e7d32);box-shadow:0 0 10px rgba(76,175,80,.5)}.deep-water{background-color:#00f}.shallow-water{background-color:#87ceeb}.beach{background-color:#ff0}.plains{background-color:#90ee90}.forest{background-color:#32cd32}.mountains{background-color:sienna}.peaks{background-color:#fff}.game-message{position:fixed;top:37%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:700;text-shadow:3px 3px 6px rgba(0,0,0,.8);background:rgba(0,0,0,.7);padding:30px 60px;border-radius:15px;z-index:1000;display:none;animation:fadeIn .5s ease-in-out}.victory-message{color:#4caf50;border:4px solid #4caf50}.defeat-message{color:#ff5252;border:4px solid #ff5252}@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-60%)}to{opacity:1;transform:translate(-50%,-50%)}}.power-instruction{margin:15px 0 10px 0;font-weight:700;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.7);font-size:16px;display:none}.power-buttons{display:flex;flex-direction:row;flex-wrap:wrap;gap:8px;margin-top:10px;width:100%;justify-content:center}.power-button{display:flex;flex-direction:column;align-items:center;padding:8px 10px;border-radius:8px;border:none;font-weight:700;cursor:pointer;transition:all .3s;position:relative;overflow:hidden;min-width:70px;min-height:70px;background:rgba(0,0,0,.3)!important;flex-grow:1}.power-button::before{content:'';position:absolute;top:0;left:0;height:100%;width:var(--power-percent,0%);transition:width .3s;z-index:0}.power-button.shallow-water::before{background:#87ceeb}.power-button.beach::before{background:#ff0}.power-button.plains::before{background:#90ee90}.power-button.forest::before{background:#32cd32}.power-button.mountains::before{background:#b64f1f}.power-text{z-index:1;font-size:12px;text-align:center;margin-bottom:5px;line-height:1.2;text-shadow:1px 1px 0 #000}.power-value{background:rgba(0,0,0,.5);padding:3px 6px;border-radius:10px;min-width:40px;z-index:1;font-size:12px;margin-bottom:3px}.power-size{background:rgba(0,0,0,.5);padding:3px 6px;border-radius:10px;min-width:40px;z-index:1;font-size:11px;color:#fc0}.power-button.charged{animation:pulse 1s infinite}.power-button.selected{animation:selectedPower .5s infinite alternate;box-shadow:0 0 15px rgba(255,0,0,.8);border:2px solid red}.power-description{display:none;font-size:11px;margin-top:5px;text-align:center;max-width:90px;line-height:1.2;z-index:1}.power-description-global{display:none;margin-top:15px;padding:10px;background:rgba(0,0,0,.3);border-radius:8px;max-width:800px;text-align:center}.power-button.selected .power-description{display:block}@keyframes pulse{0%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,.7)}50%{transform:scale(1.05);box-shadow:0 0 10px rgba(255,255,255,.9)}100%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,.7)}}@keyframes selectedPower{from{box-shadow:0 0 5px rgba(255,0,0,.5)}to{box-shadow:0 0 20px rgba(255,0,0,1)}}.manual-panel{display:none;position:fixed;right:0;top:0;width:500px;height:100%;background:#382842;padding:20px;overflow-y:auto;z-index:1000}.manual-content{margin-top:20px;color:#fff;text-align:left}.close-manual{position:absolute;top:10px;right:10px;background:#f4b43e;border:none;color:#fff;border-radius:0;width:auto!important;height:auto;cursor:pointer;display:inline-block;text-align:center;box-sizing:content-box;padding:10px!important}.divider{width:100%;height:1px;background:rgba(255,255,255,.2);margin:10px 0}#manualBtn{margin-bottom:15px}.power-selection-mode .power-button:not(.selected){opacity:.6}.power-selection-mode #mapTable{box-shadow:0 0 20px rgba(255,215,0,.7)}.power-selection-mode::after{content:'Select target on map. Press ESC to cancel.';position:fixed;top:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);color:gold;padding:10px 20px;border-radius:5px;z-index:1000;font-weight:700}.power-usage-message{position:relative;background:rgba(0,0,0,.8);color:gold;padding:5px 10px;border-radius:10px;z-index:1000;font-weight:700;font-size:18px;display:none}.footer{font-size:13px;margin-top:15px;color:#eed0b2}.difficulty-controls button{padding:8px 16px;font-size:14px;width:80px}.difficulty-controls button.active{background:linear-gradient(45deg,#4caf50,#2e7d32);box-shadow:0 0 10px rgba(76,175,80,.5)}.sun{width:700px;height:700px;background:radial-gradient(circle,#fd0 50%,#ff8300 70%);border-radius:50%;position:absolute;top:calc(30% - 250px);box-shadow:0 0 150px #ff8a00,0 0 350px #f70,0 0 550px rgba(255,119,0,.7);z-index:-1000!important}.eye,.eye2{width:84px;height:84px;image-rendering:pixelated;background:url(data:image/gif;base64,R0lGODlhHAAcALMAAOuAEslYDv70xf/aTRUSEeaoNv3ohpo8Deq9UsuPK2pRKjMvJ/3eYwAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDMgNzkuOTY5MGE4N2ZjLCAyMDI1LzAzLzA2LTIwOjUwOjE2ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjZhNWY5ZTNkLWY5MDUtNGI1Yy1iYmJmLTQ1YTZhZmYxYTYxMSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OENEMjRDNDg2RjAxMUYwODg3MTk2QkVDNUZEOUY5NyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5OENEMjRDMzg2RjAxMUYwODg3MTk2QkVDNUZEOUY5NyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjAyNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMjA1ODg5Ny1lYmEwLTQ2MjgtOGRmZS1iMjgwMjEzZDMyYTkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NmE1ZjllM2QtZjkwNS00YjVjLWJiYmYtNDVhNmFmZjFhNjExIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAABwAHAAABP8QgFJQtbUkkDqywZEIJBkEEpd8TIsAJ9rFTCl8SLIQCzK0DAPidIgFFBXbR7dbVAYIxrKzCSQUIptmweVdBtAcpaMoZ0sKbnexwmnK3HL5ZECrm1YKpdy5aE4IBnV3eHkJVhZ9egkHBYIGdwQ8hxQnK3pjCRqBgpE8Cn0nFxYqbJydPDuSbFSaU0SNj6ieC6BUF2lcCUEGvISqtbYTFwdIUUAtv3fCwzltP8ipynEoEhQ4x0CSq8oECikT2MgM27+p3il62GAt2zzcTgro1plW0e7ubGnf6QUAIj/Y4cunhh89CmDYkRtYTk01CZYSCmTYsFaKEAEkJqQIr1Y1URoxwXCUJumjo5ADvMmhiARjAB8o+2w4oGobEjB9UIKxQuWATzWaEOqUaMSMiFZCYeqMAAA7);background-size:cover;display:inline-block;margin:0 30px;border-radius:15px;border:3px solid #ffde00;box-shadow:0 0 25px #e47600}.eye2{transform:scaleX(-1)}.manbut{color:#000;border-radius:5px;padding:2px 5px;display:inline-block;margin-bottom:5px}.topper{display:flex}</style></head><body><div class="sun"></div><div class="game-message victory-message" id="victoryMessage">Your Civilization wins!</div><div class="game-message defeat-message" id="defeatMessage">Game Over</div><div class="manual-panel" id="manualPanel"><button class="close-manual" id="closeManual">X</button><h2>Manual</h2><div class="manual-content"><p style="font-style:italic;text-align:center">Cats rule the world ‚Äì especially black ones ;)<br>So, become the Black Cat ‚Äì God of Egypt!</p><br>Lead your<span style="background-color:red;color:#fff" class="manbut">civilization</span>to world domination. Manage its development, control your followers, and battle hostile empires. Your goal is to conquer all territories, but beware ‚Äì you cannot allow the capital to fall into enemy hands!<br><br>Collect and use your divine powers, which recharge faster the more tiles of a given type you control. Each use increases their cost and range. Choose wisely to shape the terrain, convert enemies, or wreak havoc:<br><br><span style="background-color:#87ceeb" class="manbut">FLOOD</span>: Lowers terrain by one level in the selected area<br><span style="background-color:#ff0" class="manbut">CONVERSION</span>: Converts enemy territories to player territories<br><span style="background-color:#90ee90" class="manbut">BLESSING</span>: Claims empty territories for the player<br><span style="background-color:#32cd32" class="manbut">PLAGUE</span>: Removes all enemy units in the area<br><span style="background-color:#b64f1f" class="manbut">EXALTATION</span>: Raises terrain by one level in the selected area<br><br>Click on a fully charged divine power and select a target field on a map. Use ESC to cancel.<em>May the cat gods be with you!</em></div></div><div class="container"><div class="topper"><div class="eye"></div><div><h1>Claw'opatra and the Gods of Egypt</h1></div><div class="eye2"></div></div><div class="game-controls"><div id="difficultyGroup" class="control-group"><span class="control-group-label">Difficulty:</span><div class="difficulty-controls"><button id="easyBtn">Easy</button><button id="normalBtn" class="active">Normal</button><button id="hardBtn">Hard</button></div></div><button id="generateBtn">üé≤ Generate New Map</button></div><div class="map-and-lgs"><div class="lg-left"><div class="lg-content"><div class="lg-item2"><div class="lg-color" style="background:#00f"></div><span class="lg-text">Deep water</span><span>N/A</span></div><div class="lg-item"><div class="lg-color" style="background:#87ceeb"></div><span class="lg-text">Shallow water</span><span class="lg-count" id="shallow-water-count">0</span></div><div class="lg-item"><div class="lg-color" style="background:#ff0"></div><span class="lg-text">Beaches</span><span class="lg-count" id="beach-count">0</span></div><div class="lg-item"><div class="lg-color" style="background:#90ee90"></div><span class="lg-text">Plains</span><span class="lg-count" id="plains-count">0</span></div><div class="divider"></div><div class="turn-counter">Turn:<span id="turnNumber">1</span></div></div><div class="divider"></div><button id="manualBtn">üìñ Manual</button><div class="controls-bottom"><div class="control-group"><span class="control-group-label">State:</span><div class="time-controls"><button id="pauseBtn">‚è∏Ô∏è Pause</button><button id="playBtn" class="active">‚ñ∂Ô∏è Play</button></div></div></div></div><div class="map-container"><table id="mapTable"></table><button id="startGameBtn" style="margin-top:20px;display:none">üêæ Start Game</button></div><div class="lg-right"><div class="lg-content"><div class="lg-item"><div class="lg-color" style="background:#32cd32"></div><span class="lg-text">Forests</span><span class="lg-count" id="forest-count">0</span></div><div class="lg-item"><div class="lg-color" style="background:sienna"></div><span class="lg-text">Mountains</span><span class="lg-count" id="mountains-count">0</span></div><div class="lg-item2"><div class="lg-color" style="background:#fff"></div><span class="lg-text">Peaks</span><span>N/A</span></div><div class="lg-item"><div class="lg-color" style="background:rgba(47,46,80,1)"></div><span class="lg-text">Enemy civilization</span><span class="lg-count" id="enemy-count">0</span></div><div class="divider"></div><button id="restartGameBtn" style="display:none;width:100%;margin-top:10px">üîÑ Restart Game</button></div><div class="controls-bottom"><div class="control-group"><span class="control-group-label">Speed:</span><div class="time-controls"><button id="speed1Btn">1x</button><button id="speed2Btn" class="active">2x</button><button id="speed4Btn">4x</button><button id="speed6Btn">6x</button></div></div></div></div></div><div class="power-usage-message" id="powerUsageMessage">Use DIVINE POWER</div><div class="power-instruction" id="powerInstruction">Click on the<span style="background-color:#222;border-radius:4px;color:#fff;text-shadow:none;padding:2px 5px;display:inline-block;margin:0 5px">FULLY CHARGED DIVINE POWER</span>below, then click on a location on the map to use it.</div><div class="power-buttons" style="display:none"><button class="power-button shallow-water" id="shallowWaterPower"><span class="power-text">Flood</span><span class="power-value">0/50</span><span class="power-size">size: 3</span></button><button class="power-button beach" id="beachPower"><span class="power-text">Conversion</span><span class="power-value">0/100</span><span class="power-size">size: 3</span></button><button class="power-button plains" id="plainsPower"><span class="power-text">Blessing</span><span class="power-value">0/200</span><span class="power-size">size: 3</span></button><button class="power-button forest" id="forestPower"><span class="power-text">Plague</span><span class="power-value">0/100</span><span class="power-size">size: 3</span></button><button class="power-button mountains" id="mountainsPower"><span class="power-text">Exaltation</span><span class="power-value">0/50</span><span class="power-size">size: 3</span></button></div><div class="power-description-global" id="powerDescriptionGlobal"></div></div><div class="footer">Game idea, graphics and programming by Kamil Zurek 2025. Game designed specially for JS13K contest.</div>
<script>
class PerlinNoise{constructor(){this.permutation=new Array(512),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.init()}init(){const e=new Array(256);for(let t=0;t<256;t++)e[t]=t;for(let t=255;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}for(let t=0;t<512;t++)this.permutation[t]=e[255&t]}dot(e,t,s){return e[0]*t+e[1]*s}mix(e,t,s){return(1-s)*e+s*t}fade(e){return e*e*e*(e*(6*e-15)+10)}noise(e,t){const s=255&Math.floor(e),i=255&Math.floor(t);e-=Math.floor(e),t-=Math.floor(t);const a=this.fade(e),n=this.fade(t),l=this.permutation[s]+i,o=this.permutation[l],r=this.permutation[l+1],h=this.permutation[s+1]+i,c=this.permutation[h],d=this.permutation[h+1],m=this.grad3[o%12],u=this.grad3[c%12],p=this.grad3[r%12],y=this.grad3[d%12];return this.mix(this.mix(this.dot(m,e,t),this.dot(u,e-1,t),a),this.mix(this.dot(p,e,t-1),this.dot(y,e-1,t-1),a),n)}fractalNoise(e,t,s,i,a){let n=0,l=1,o=1,r=0;for(let h=0;h<s;h++)n+=this.noise(e*l,t*l)*o,r+=o,o*=i,l*=a;return n/r}}class MapGenerator{constructor(){this.mapTable=document.getElementById("mapTable"),this.turnNumberElement=document.getElementById("turnNumber"),this.turnCounter=document.querySelector(".turn-counter"),this.generateBtn=document.getElementById("generateBtn"),this.startGameBtn=document.getElementById("startGameBtn"),this.restartGameBtn=document.getElementById("restartGameBtn"),this.timeControls=document.querySelector(".time-controls"),this.mapContainer=document.querySelector(".map-container"),this.victoryMessage=document.getElementById("victoryMessage"),this.defeatMessage=document.getElementById("defeatMessage"),this.perlin=new PerlinNoise,this.powerDescriptionGlobal=document.getElementById("powerDescriptionGlobal"),this.manualBtn=document.getElementById("manualBtn"),this.manualPanel=document.getElementById("manualPanel"),this.closeManual=document.getElementById("closeManual"),this.powerInstruction=document.getElementById("powerInstruction"),this.powerUsageMessage=document.getElementById("powerUsageMessage"),this.isProcessingPower=!1,this.powers={"shallow-water":{current:50,max:50,element:document.getElementById("shallowWaterPower"),costMultiplier:1,description:"Lowers terrain by one level in the selected area",radius:3,useCount:0},beach:{current:0,max:100,element:document.getElementById("beachPower"),costMultiplier:1,description:"Converts enemy territories to player territories",radius:3,useCount:0},plains:{current:0,max:200,element:document.getElementById("plainsPower"),costMultiplier:1,description:"Claims empty territories for the player",radius:3,useCount:0},forest:{current:0,max:100,element:document.getElementById("forestPower"),costMultiplier:1,description:"Removes all enemy units in the area",radius:3,useCount:0},mountains:{current:50,max:50,element:document.getElementById("mountainsPower"),costMultiplier:1,description:"Raises terrain by one level in the selected area",radius:3,useCount:0}},this.width=50,this.height=50,this.scale=20,this.octaves=3,this.persistence=1,this.lacunarity=2.1,this.mapData=null,this.startPoint=null,this.civCells=[],this.enemyCells=[],this.currentTurn=1,this.gameInterval=null,this.gameSpeed=2500,this.isPaused=!1,this.gameStarted=!1,this.gameEnded=!1,this.selectedPower=null,this.isPowerSelectionMode=!1,this.powerTargetSelectionActive=!1,this.previousGameSpeed=this.gameSpeed,this.terrainCounts={"deep-water":0,"shallow-water":0,beach:0,plains:0,forest:0,mountains:0,peaks:0,enemy:0},this.difficultyLevel="normal",this.initEvents(),this.showInitialControls(),this.generateMap()}initEvents(){this.generateBtn.addEventListener("click",()=>{this.perlin.init(),this.resetGame(),this.generateMap()}),this.startGameBtn.addEventListener("click",()=>{this.startGame(),this.showGameControls(),this.zoomMap()}),this.restartGameBtn.addEventListener("click",()=>{location.reload()}),document.getElementById("pauseBtn").addEventListener("click",()=>{this.pauseGame(),this.updateButtonStates("pauseBtn","playPauseGroup")}),document.getElementById("playBtn").addEventListener("click",()=>{this.resumeGame(),this.updateButtonStates("playBtn","playPauseGroup")}),document.getElementById("speed1Btn").addEventListener("click",()=>{this.setGameSpeed(5e3),this.updateButtonStates("speed1Btn","speedGroup")}),document.getElementById("speed2Btn").addEventListener("click",()=>{this.setGameSpeed(2500),this.updateButtonStates("speed2Btn","speedGroup")}),document.getElementById("speed4Btn").addEventListener("click",()=>{this.setGameSpeed(1250),this.updateButtonStates("speed4Btn","speedGroup")}),document.getElementById("speed6Btn").addEventListener("click",()=>{this.setGameSpeed(833),this.updateButtonStates("speed6Btn","speedGroup")}),this.manualBtn.addEventListener("click",()=>{this.manualPanel.style.display="block"}),this.closeManual.addEventListener("click",()=>{this.manualPanel.style.display="none"});for(const e in this.powers)this.powers[e].element.addEventListener("click",()=>{this.selectPower(e)});document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isPowerSelectionMode&&this.cancelPowerSelection()}),document.addEventListener("click",e=>{!this.isPowerSelectionMode||e.target.closest("#mapTable")||e.target.closest(".power-button")||this.cancelPowerSelection()}),this.mapTable.addEventListener("mouseover",e=>{"TD"===e.target.tagName&&(e.target.style.opacity="0.8",e.target.style.transform="scale(1.2)")}),this.mapTable.addEventListener("mouseout",e=>{"TD"===e.target.tagName&&(e.target.style.opacity="1",e.target.style.transform="scale(1)")}),this.mapTable.addEventListener("click",e=>{if("TD"===e.target.tagName&&this.isPowerSelectionMode&&this.powerTargetSelectionActive&&!this.isProcessingPower){const t=parseInt(e.target.dataset.x),s=parseInt(e.target.dataset.y);this.isProcessingPower=!0,this.usePower(t,s),this.powerTargetSelectionActive=!1,setTimeout(()=>{this.isProcessingPower=!1},1e3)}}),document.getElementById("easyBtn").addEventListener("click",()=>{this.setDifficulty("easy"),this.updateButtonStates("easyBtn","difficultyGroup"),this.gameStarted||this.generateMap()}),document.getElementById("normalBtn").addEventListener("click",()=>{this.setDifficulty("normal"),this.updateButtonStates("normalBtn","difficultyGroup"),this.gameStarted||this.generateMap()}),document.getElementById("hardBtn").addEventListener("click",()=>{this.setDifficulty("hard"),this.updateButtonStates("hardBtn","difficultyGroup"),this.gameStarted||this.generateMap()})}setDifficulty(e){this.difficultyLevel=e}getCellElement(e,t){const s=this.mapTable.getElementsByTagName("tr");if(!s[t])return null;return s[t].getElementsByTagName("td")[e]||null}renderMap(){this.mapTable.innerHTML="";for(let e=0;e<this.height;e++){const t=this.mapTable.insertRow();for(let s=0;s<this.width;s++){const i=t.insertCell(),a=this.mapData[e][s],n=this.getTileClass(a),l=this.getTerrainName(n);i.className=n,i.dataset.x=s,i.dataset.y=e;if(this.enemyCells.some(t=>t.x===s&&t.y===e))i.classList.add("enemy-cell");else{if(this.civCells.some(t=>t.x===s&&t.y===e)){this.startPoint&&this.startPoint.x===s&&this.startPoint.y===e?i.classList.add("start-point"):i.classList.add("civ-cell")}}i.title=`X: ${s}, Y: ${e}, Terrain: ${l}`}}}selectPower(e){const t=this.powers[e];if(t.current>=t.max){if(this.selectedPower===e)return void this.cancelPowerSelection();this.cancelPowerSelection(),this.selectedPower=e,this.isPowerSelectionMode=!0,this.powerTargetSelectionActive=!0,t.element.classList.add("selected"),this.powerDescriptionGlobal.textContent=t.description+" - Click on map to use. Press ESC to cancel.",this.powerDescriptionGlobal.style.display="block",this.powerUsageMessage.style.display="block",this.previousGameSpeed=this.gameSpeed,this.pauseGame(),this.updateButtonStates("pauseBtn","playPauseGroup"),this.mapTable.style.cursor="crosshair",document.body.classList.add("power-selection-mode")}}cancelPowerSelection(){this.selectedPower&&(this.powers[this.selectedPower].element.classList.remove("selected"),this.selectedPower=null,this.isPowerSelectionMode=!1,this.powerTargetSelectionActive=!1,this.mapTable.style.cursor="default",this.powerDescriptionGlobal.style.display="none",this.powerUsageMessage.style.display="none",this.setGameSpeed(this.previousGameSpeed),this.resumeGame(),this.updateButtonStates("playBtn","playPauseGroup"),document.body.classList.remove("power-selection-mode"))}usePower(e,t){if(!this.selectedPower)return;const s=this.powers[this.selectedPower];let i;switch(this.selectedPower){case"shallow-water":i="#87CEEB";break;case"beach":i="#FFFF00";break;case"plains":i="#90EE90";break;case"forest":i="#32CD32";break;case"mountains":i="#A0522D";break;default:i="#FFFFFF"}this.mapContainer.style.color=i,this.mapContainer.classList.add("power-effect"),setTimeout(()=>{this.mapContainer.classList.remove("power-effect")},1e3),s.costMultiplier*=1.5,s.max=Math.floor(this.getBaseMax(this.selectedPower)*s.costMultiplier),s.useCount++;const a=s.radius+s.useCount-1;switch(this.updatePowerSizeDisplay(this.selectedPower,a),this.highlightArea(e,t,a),this.selectedPower){case"shallow-water":this.applyShallowWaterPower(e,t,a);break;case"beach":this.applyBeachPower(e,t,a);break;case"plains":this.applyPlainsPower(e,t,a);break;case"forest":this.applyForestPower(e,t,a);break;case"mountains":this.applyMountainsPower(e,t,a)}this.updateTerrainCounts(),s.current=0,this.updatePowerDisplay(this.selectedPower),this.renderMap(),this.updateTerrainCounts(),this.checkGameConditions(),this.cancelPowerSelection()}updatePowerSizeDisplay(e,t){this.powers[e].element.querySelector(".power-size").textContent=`size: ${t}`}applyShallowWaterPower(e,t,s){for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.mapData[i][a];let t;switch(this.getTileClass(e)){case"peaks":t=.85;break;case"mountains":t=.7;break;case"forest":t=.6;break;case"plains":t=.48;break;case"beach":t=.4;break;case"shallow-water":t=.3;break;default:t=e}this.mapData[i][a]=t;const s=this.civCells.findIndex(e=>e.x===a&&e.y===i);-1!==s&&(this.civCells[s].value=t);const n=this.enemyCells.findIndex(e=>e.x===a&&e.y===i);-1!==n&&(this.enemyCells[n].value=t),this.checkUnitsOnInvalidTerrain(a,i,t)}}}applyBeachPower(e,t,s){for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.enemyCells.findIndex(e=>e.x===a&&e.y===i);if(-1!==e){const t=this.enemyCells[e];this.civCells.push({x:t.x,y:t.y,value:this.mapData[i][a]}),this.enemyCells.splice(e,1)}}}}applyPlainsPower(e,t,s){for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.getTileClass(this.mapData[i][a]);if("deep-water"!==e&&"peaks"!==e){const e=this.civCells.some(e=>e.x===a&&e.y===i),t=this.enemyCells.some(e=>e.x===a&&e.y===i);e||t||this.civCells.push({x:a,y:i,value:this.mapData[i][a]})}}}}applyForestPower(e,t,s){const i=[];for(let a=Math.max(0,t-s);a<=Math.min(this.height-1,t+s);a++)for(let n=Math.max(0,e-s);n<=Math.min(this.width-1,e+s);n++){if(Math.max(Math.abs(n-e),Math.abs(a-t))<=s){const e=this.enemyCells.findIndex(e=>e.x===n&&e.y===a);-1!==e&&i.push(e)}}i.sort((e,t)=>t-e).forEach(e=>{this.enemyCells.splice(e,1)})}applyMountainsPower(e,t,s){for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.mapData[i][a];let t;switch(this.getTileClass(e)){case"deep-water":t=.4;break;case"shallow-water":t=.48;break;case"beach":t=.6;break;case"plains":t=.7;break;case"forest":t=.85;break;case"mountains":t=.95;break;default:t=e}this.mapData[i][a]=t;const s=this.civCells.findIndex(e=>e.x===a&&e.y===i);-1!==s&&(this.civCells[s].value=t);const n=this.enemyCells.findIndex(e=>e.x===a&&e.y===i);-1!==n&&(this.enemyCells[n].value=t),this.checkUnitsOnInvalidTerrain(a,i,t)}}}checkUnitsOnInvalidTerrain(e,t,s){const i=this.getTileClass(s);"deep-water"!==i&&"peaks"!==i||(this.civCells=this.civCells.filter(s=>!(s.x===e&&s.y===t)),this.enemyCells=this.enemyCells.filter(s=>!(s.x===e&&s.y===t)),this.startPoint&&this.startPoint.x===e&&this.startPoint.y===t&&this.endGame(!1))}updatePowerDisplay(e){const t=this.powers[e];t.element.querySelector(".power-value").textContent=`${t.current}/${t.max}`;const s=t.current/t.max*100;t.element.style.setProperty("--power-percent",`${s}%`),t.current>=t.max?t.element.classList.add("charged"):(t.element.classList.remove("charged"),t.element.classList.remove("selected"))}updatePowers(){if(this.currentTurn%3==0)for(const e in this.powers){const t=this.powers[e],s=this.terrainCounts[e]||0;t.current=Math.min(t.current+s,t.max),this.updatePowerDisplay(e)}}zoomMap(){this.mapTable.classList.add("zoomed")}showInitialControls(){this.generateBtn.style.display="inline-block",this.startGameBtn.style.display="inline-block",this.restartGameBtn.style.display="none",this.turnCounter.style.display="none",document.querySelector(".power-buttons").style.display="none",this.powerInstruction.style.display="none",document.querySelectorAll(".controls-bottom").forEach(e=>e.style.display="none"),document.querySelectorAll(".lg-count").forEach(e=>e.style.display="none")}showGameControls(){this.generateBtn.style.display="none",this.startGameBtn.style.display="none",this.restartGameBtn.style.display="inline-block",this.turnCounter.style.display="block",document.querySelector(".power-buttons").style.display="flex",this.powerInstruction.style.display="block",document.querySelectorAll(".controls-bottom").forEach(e=>e.style.display="block"),document.querySelectorAll(".lg-count").forEach(e=>e.style.display="inline-block");const e=document.getElementById("difficultyGroup");e&&(e.style.display="none")}updateButtonStates(e,t){"playPauseGroup"===t?(["playBtn","pauseBtn"].forEach(e=>document.getElementById(e).classList.remove("active")),document.getElementById(e).classList.add("active")):"speedGroup"===t?(["speed1Btn","speed2Btn","speed4Btn","speed6Btn"].forEach(e=>document.getElementById(e).classList.remove("active")),document.getElementById(e).classList.add("active")):"difficultyGroup"===t&&(["easyBtn","normalBtn","hardBtn"].forEach(e=>document.getElementById(e).classList.remove("active")),document.getElementById(e).classList.add("active"))}setGameSpeed(e){this.gameSpeed=e,!this.isPaused&&this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=setInterval(()=>this.nextTurn(),this.gameSpeed))}pauseGame(){this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=null,this.isPaused=!0)}resumeGame(){this.isPaused&&(this.gameInterval=setInterval(()=>this.nextTurn(),this.gameSpeed),this.isPaused=!1)}resetGame(){this.currentTurn=1,this.turnNumberElement.textContent=this.currentTurn,this.civCells=[],this.enemyCells=[],this.isPaused=!1,this.gameSpeed=2500,this.gameStarted=!1,this.gameEnded=!1,this.selectedPower=null,this.isPowerSelectionMode=!1,this.powerTargetSelectionActive=!1,this.mapTable.style.cursor="default",document.body.classList.remove("power-selection-mode");for(const e in this.powers)["shallow-water","mountains"].includes(e)?this.powers[e].current=this.getBaseMax(e):this.powers[e].current=0,this.powers[e].max=this.getBaseMax(e),this.powers[e].costMultiplier=1,this.powers[e].useCount=0,this.updatePowerDisplay(e),this.updatePowerSizeDisplay(e,this.powers[e].radius);this.victoryMessage.style.display="none",this.defeatMessage.style.display="none",this.powerUsageMessage.style.display="none";for(const e in this.terrainCounts)this.terrainCounts[e]=0;this.updateTerrainCounts(),this.gameInterval&&clearInterval(this.gameInterval),this.updateButtonStates("playBtn","playPauseGroup"),this.updateButtonStates("speed2Btn","speedGroup"),this.powerDescriptionGlobal.style.display="none"}getBaseMax(e){switch(e){case"shallow-water":case"mountains":default:return 50;case"beach":case"forest":return 100;case"plains":return 200}}startGame(){this.gameStarted=!0,this.gameInterval=setInterval(()=>this.nextTurn(),this.gameSpeed)}nextTurn(){this.gameStarted&&!this.gameEnded&&(this.currentTurn++,this.turnNumberElement.textContent=this.currentTurn,this.currentTurn%18==0&&this.addEnemyCiv(),this.expandCiv(),this.expandEnemyCiv(),this.renderMap(),this.updateTerrainCounts(),this.updatePowers(),this.checkGameConditions())}checkGameConditions(){if(this.startPoint){if(this.enemyCells.some(e=>e.x===this.startPoint.x&&e.y===this.startPoint.y))return void this.endGame(!1)}0!==this.civCells.length?0!==this.enemyCells.length||this.endGame(!0):this.endGame(!1)}endGame(e){this.gameEnded=!0,clearInterval(this.gameInterval),e?this.victoryMessage.style.display="block":this.defeatMessage.style.display="block",document.querySelector(".power-buttons").style.display="none",this.powerInstruction.style.display="none",this.powerDescriptionGlobal.style.display="none",this.powerUsageMessage.style.display="none",document.querySelectorAll(".controls-bottom").forEach(e=>e.style.display="none"),this.isPowerSelectionMode&&this.cancelPowerSelection(),document.querySelectorAll(".lg-count").forEach(e=>e.style.display="none")}addEnemyCiv(){const e=[];for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)if(t<10||t>=this.height-10||s<10||s>=this.width-10){const i=this.mapData[t][s];if(i>=.5&&i<.65){this.civCells.some(e=>e.x===s&&e.y===t)||this.enemyCells.some(e=>e.x===s&&e.y===t)||e.push({x:s,y:t,value:i})}}if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];this.enemyCells.push(t)}}expandCiv(){const e=[],t=[{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1}];for(const s of this.civCells){const i=Math.floor(10*Math.random())+1,a=t[Math.floor(Math.random()*t.length)],n=s.x+a.dx,l=s.y+a.dy;if(n>=0&&n<this.width&&l>=0&&l<this.height){if(!this.enemyCells.some(e=>e.x===n&&e.y===l)){const t=this.mapData[l][n],s=this.getTileClass(t);if("deep-water"===s||"peaks"===s)continue;let a;switch(s){case"shallow-water":case"mountains":a=6;break;case"forest":case"beach":a=4;break;case"plains":a=2;break;default:a=10}i>a&&e.push({x:n,y:l,value:t})}}}for(const t of e)this.civCells.some(e=>e.x===t.x&&e.y===t.y)||this.civCells.push(t)}expandEnemyCiv(){const e=[],t=[{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1}];for(const s of this.enemyCells){const i=Math.floor(10*Math.random())+1,a=t[Math.floor(Math.random()*t.length)],n=s.x+a.dx,l=s.y+a.dy;if(n>=0&&n<this.width&&l>=0&&l<this.height){const t=this.mapData[l][n],s=this.getTileClass(t);if("deep-water"===s||"peaks"===s)continue;let a;switch(s){case"shallow-water":case"mountains":a=6;break;case"forest":case"beach":a=4;break;case"plains":a=2;break;default:a=10}if(i>a){this.civCells.some(e=>e.x===n&&e.y===l)?this.handleConflict(n,l):e.push({x:n,y:l,value:t})}}}for(const t of e)this.enemyCells.some(e=>e.x===t.x&&e.y===t.y)||this.enemyCells.push(t)}handleConflict(e,t){const s=Math.random()>.6,i=[];for(let a=Math.max(0,t-5);a<=Math.min(this.height-1,t+5);a++)for(let n=Math.max(0,e-5);n<=Math.min(this.width-1,e+5);n++){if(Math.max(Math.abs(n-e),Math.abs(a-t))<=5)if(s){const e=this.enemyCells.find(e=>e.x===n&&e.y===a);e&&i.push({type:"enemy",cell:e})}else{const e=this.civCells.find(e=>e.x===n&&e.y===a);e&&i.push({type:"player",cell:e})}}this.flashConflictArea(e,t,5),setTimeout(()=>{for(const{type:e,cell:t}of i)"player"===e?this.civCells=this.civCells.filter(e=>!(e.x===t.x&&e.y===t.y)):this.enemyCells=this.enemyCells.filter(e=>!(e.x===t.x&&e.y===t.y));this.renderMap(),this.updateTerrainCounts(),this.checkGameConditions()},1e3)}flashConflictArea(e,t,s){for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.getCellElement(a,i);e&&(e.classList.add("conflict-flash"),setTimeout(()=>e.classList.remove("conflict-flash"),1e3))}}}highlightArea(e,t,s){if(this.isPowerSelectionMode)for(let i=Math.max(0,t-s);i<=Math.min(this.height-1,t+s);i++)for(let a=Math.max(0,e-s);a<=Math.min(this.width-1,e+s);a++){if(Math.max(Math.abs(a-e),Math.abs(i-t))<=s){const e=this.getCellElement(a,i);e&&(e.classList.add("highlighted-cell"),setTimeout(()=>e.classList.remove("highlighted-cell"),1e3))}}}getTileClass(e){return e<.35?"deep-water":e<.45?"shallow-water":e<.5?"beach":e<.63?"plains":e<.75?"forest":e<.9?"mountains":"peaks"}getTerrainName(e){return{"deep-water":"Deep Water","shallow-water":"Shallow Water",beach:"Beach",plains:"Plains",forest:"Forest",mountains:"Mountains",peaks:"Mountain Peaks"}[e]||e}updateTerrainCounts(){for(const e in this.terrainCounts)"enemy"!==e&&(this.terrainCounts[e]=0);for(const e of this.civCells){const t=this.getTileClass(e.value);this.terrainCounts[t]++}this.terrainCounts.enemy=this.enemyCells.length;for(const e in this.terrainCounts){const t=document.getElementById(`${e}-count`);t&&(t.textContent=this.terrainCounts[e])}}generateMap(){setTimeout(()=>{this.mapData=[],this.resetGame();let e=1/0,t=-1/0;const s=[];for(let i=0;i<this.height;i++){this.mapData[i]=[];for(let a=0;a<this.width;a++){const n=this.perlin.fractalNoise(a/this.scale,i/this.scale,this.octaves,this.persistence,this.lacunarity);s.push(n),n<e&&(e=n),n>t&&(t=n)}}for(let i=0;i<this.height;i++)for(let a=0;a<this.width;a++){const n=(s[i*this.width+a]-e)/(t-e);this.mapData[i][a]=n}this.findStartPoint();let i=4;"easy"===this.difficultyLevel?i=2:"hard"===this.difficultyLevel&&(i=6);for(let e=0;e<i;e++)this.addEnemyCiv();const a=[60,40,20],n=["beach","plains","forest"];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}this.powers[n[0]].current=a[0],this.powers[n[1]].current=a[1],this.powers[n[2]].current=a[2],this.updatePowerDisplay(n[0]),this.updatePowerDisplay(n[1]),this.updatePowerDisplay(n[2]),this.renderMap(),this.updateTerrainCounts(),this.startGameBtn.style.display="inline-block"},50)}findStartPoint(){const e=Math.floor(this.width/2),t=Math.floor(this.height/2),s=Math.floor(.3*this.width),i=Math.floor(.3*this.height),a=Math.max(0,e-Math.floor(s/2)),n=Math.max(0,t-Math.floor(i/2)),l=Math.min(this.width-1,a+s),o=Math.min(this.height-1,n+i),r=[];for(let e=n;e<o;e++)for(let t=a;t<l;t++){const s=this.mapData[e][t];s>=.5&&s<.65&&r.push({x:t,y:e,value:s})}if(r.length>0){const e=Math.floor(Math.random()*r.length);this.startPoint=r[e]}else{const s=[];for(let e=n;e<o;e++)for(let t=a;t<l;t++){const i=this.mapData[e][t];i>=.5&&s.push({x:t,y:e,value:i})}if(s.length>0){const e=Math.floor(Math.random()*s.length);this.startPoint=s[e]}else this.mapData[t][e]=.55,this.startPoint={x:e,y:t,value:.55}}this.civCells=[this.startPoint]}}window.addEventListener("load",()=>{new MapGenerator}); 
    </script></body></html>