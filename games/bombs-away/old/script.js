function resizeGame(){var e=document.getElementById("gameArea"),t=1,i=window.innerWidth,a=window.innerHeight,s=i/a;s>t?(i=a*t,e.style.height=a+"px",e.style.width=i+"px"):(a=i/t,e.style.width=i+"px",e.style.height=a+"px"),e.style.marginTop=-a/2+"px",e.style.marginLeft=-i/2+"px";var h=document.getElementById("gameCanvas");h.width=i,h.height=a}function gameXToCanvasX(e){return e/game.gameWidth*gameCanvas.width}function gameYToCanvasY(e){return e/game.gameHeight*gameCanvas.height}function canvasXToGameX(e){return e*gameCanvas.width/game.gameWidth}function canvasYToGameY(e){return e*gameCanvas.height/game.gameHeight}function powerup(e,t,i,a,s){this.x=e,this.y=t,this.velX=i,this.velY=a,this.radius=1,this.type=s,this.update=function(e){this.x+=this.velX*e,this.y-=this.velY*e,this.x-this.radius<0&&(this.x=this.radius,this.velX=-this.velX/2),this.x+this.radius>game.gameWidth&&(this.x=game.gameWidth-this.radius,this.velX=-this.velX/2),this.y+this.radius>game.gameHeight-20&&(this.y=game.gameHeight-20-this.radius,this.velY=-this.velY/2),this.y-this.radius<0&&(this.y=this.radius,this.velY=-this.velY/2)},this.draw=function(){this.type==game.powerupTypes.BombChargeRate&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Bomb),this.type==game.powerupTypes.MaxBombAmmo&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Bomb),this.type==game.powerupTypes.WellChargeRate&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Well),this.type==game.powerupTypes.MaxWellAmmo&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Well)}}function floor(e,t,i,a){this.x=e,this.y=t,this.width=i,this.height=a,this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y-this.height/2},this.bottom=function(){return this.y+this.height/2},this.printSides=function(){console.log("Floor Right: "+this.right()+" Left: "+this.left()+" Top"+this.top()+" Bottom"+this.bottom())},this.draw=function(){draw.drawRectCentered(this.x,this.y,this.width,this.height)}}function meter(e,t,i){this.x=e,this.y=t,this.type=i,this.orientations={Horizontal:0,Vertical:1},this.type==game.meterTypes.Bomb&&(this.width=1,this.height=10,this.maxLevel=game.players[0].maxBombAmmo,this.currentLevel=game.players[0].maxBombAmmo,this.orientation=this.orientations.Vertical),this.type==game.meterTypes.Well&&(this.width=1,this.height=10,this.maxLevel=game.players[0].maxWellAmmo,this.currentLevel=game.players[0].maxWellAmmo,this.orientation=this.orientations.Vertical),this.type==game.meterTypes.Life?(this.width=1,this.height=10,this.maxLevel=game.players[0].maxLife,this.currentLevel=game.players[0].maxLife,this.orientation=this.orientations.Vertical):this.type==game.meterTypes.Level&&(this.width=40,this.height=2,this.maxLevel=game.levelTime,this.currentLevel=game.currentLevelTimer,this.orientation=this.orientations.Horizontal),this.update=function(){this.type==game.meterTypes.Bomb&&(this.currentLevel=game.players[0].bombAmmo),this.type==game.meterTypes.Well&&(this.currentLevel=game.players[0].wellAmmo),this.type==game.meterTypes.Life?this.currentLevel=game.players[0].currentLife>0?game.players[0].currentLife:0:this.type==game.meterTypes.Level&&game.players[0].currentLife>0&&(this.currentLevel=game.currentLevelTimer)},this.draw=function(){if(this.type==game.meterTypes.Bomb)var e=game.colors.Bomb;else if(this.type==game.meterTypes.Well)var e=game.colors.Well;else if(this.type==game.meterTypes.Life)var e=game.colors.Ship;else var e="#000000";this.orientation==this.orientations.Vertical?(draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000"),draw.drawFilledRectCentered(this.x,this.y,this.width,this.height*(this.currentLevel/this.maxLevel),e)):this.orientation==this.orientations.Horizontal&&(draw.drawRectCentered(this.x,this.y,this.width,this.height,"#000000"),draw.drawFilledRectCentered(this.x,this.y,this.width*(1-this.currentLevel/this.maxLevel),this.height,e))}}function roundButton(e,t,i,a,s){this.x=e,this.y=t,this.radius=i,this.type=a,this.color=s,this.draw=function(){this.type==game.weapons.Bomb?(draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Bomb),game.selectedWeapon==game.weapons.Bomb&&draw.drawCircle(this.x,this.y,this.radius,"#00ff00")):this.type==game.weapons.Well&&(draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Well),game.selectedWeapon==game.weapons.Well&&draw.drawCircle(this.x,this.y,this.radius,"#00ff00"))}}function well(e,t,i,a,s,h,m){var o=h-t,r=s-e,n=Math.atan(Math.abs(o/r)),g=Math.sqrt((t-h)*(t-h)+(e-s)*(e-s)),l=(s-e)/Math.abs(s-e),d=-(h-t)/Math.abs(h-t);this.shotSpeed=m,this.velX=i+Math.cos(n)*l*this.shotSpeed,this.velY=a+Math.sin(n)*d*this.shotSpeed,this.magnitude=g,this.x=e,this.y=t,this.radius=.5,this.plantTimer=1,this.plantBaseRadius=this.radius,this.explodeTimer=.5,this.explosionBaseRadius=.5,this.explosionMaxRadius=g/2,this.standingTimer=5,this.states={Placed:0,Detonated:1,Standing:2,Dissipated:3},this.state=this.states.Placed,this.currentTimer=this.plantTimer,this.draw=function(){this.state==this.states.Placed?draw.drawCircle(this.x,this.y,this.radius):this.state==this.states.Detonated?draw.drawCircle(this.x,this.y,this.radius):this.state==this.states.Standing&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Well)},this.explode=function(){this.state=this.states.Detonated,this.currentTimer=this.explodeTimer,this.radius=this.explosionBaseRadius;var e=game.players[0],t=e.y-this.y,i=e.x-this.x,a=(Math.atan(Math.abs(t/i)),Math.sqrt((this.y-e.y)*(this.y-e.y)+(e.x-this.x)*(e.x-this.x)));console.log(a),game.wells.push(this)},this.stand=function(){this.state=this.states.Standing,this.currentTimer=this.standingTimer},this.disappear=function(){this.state=this.states.Dissipated},this.update=function(e){this.updateState(e),this.state==this.states.Placed||this.state==this.states.Detonated&&(this.velX=0,this.velY=0),this.x+=this.velX*e,this.y-=this.velY*e},this.updateState=function(e){if(this.state==this.states.Placed){this.currentTimer-=e;var t=this.currentTimer/this.plantTimer*this.plantBaseRadius;this.radius=t>this.PlantBaseRadius?this.PlantBaseRadius:t,this.currentTimer<=0&&this.explode()}else this.state==this.states.Detonated?(this.currentTimer-=e,this.currentTimer>0&&(this.radius+=(this.explosionMaxRadius-this.explosionBaseRadius)*e),this.currentTimer<=0&&this.stand()):this.state==this.states.Standing&&(this.currentTimer-=e,this.currentTimer<=0&&this.disappear())}}function playerFloorHit(e,t){var i=!1,a=!1;return(e.bottom()>t.top()&&e.bottom()<t.bottom()||e.top()<t.bottom()&&e.top()>t.top())&&(i=!0),(e.left()<t.right()&&e.left()>t.left()||e.right()>t.left()&&e.right()<t.right())&&(a=!0),i&&a}function rectangleHitCircle(e){console.log("player: "+e.width+" this.right "+e.right+e.height)}function rectangleHitRectangle(e,e){e.printSides()}function circleHitCircle(){}function mouseHitButton(e,t,i){var a=distance(e,t,i.x,i.y);return a<i.radius?!0:!1}function distance(e,t,i,a){return Math.sqrt((a-t)*(a-t)+(i-e)*(i-e))}function bomb(e,t,i,a,s,h,m){var o=h-t,r=s-e,n=Math.atan(Math.abs(o/r)),g=Math.sqrt((t-h)*(t-h)+(e-s)*(e-s)),l=(s-e)/Math.abs(s-e),d=-(h-t)/Math.abs(h-t);this.velX=i,this.velY=a,this.shotSpeed=m,this.velX+=Math.cos(n)*l*this.shotSpeed,this.velY+=Math.sin(n)*d*this.shotSpeed,this.magnitude=g,this.x=e,this.y=t,this.radius=.5,this.plantTimer=1,this.plantBaseRadius=this.radius,this.explodeTimer=1,this.explosionBaseRadius=.5,this.explosionMaxRadius=this.magnitude/2,this.states={Placed:0,Detonated:1,Dissipated:2},this.state=this.states.Placed,this.currentTimer=this.plantTimer,this.draw=function(){this.state==this.states.Placed?draw.drawCircle(this.x,this.y,this.radius):this.state==this.states.Detonated&&game.selectedWeapon==game.weapons.Bomb&&draw.drawFilledCircle(this.x,this.y,this.radius,game.colors.Bomb)},this.explode=function(){this.state=this.states.Detonated,this.currentTimer=this.explodeTimer,this.radius=this.explosionBaseRadius;var e=game.players[0],t=e.y-this.y,i=e.x-this.x,a=Math.atan(Math.abs(t/i)),s=Math.sqrt((this.y-e.y)*(this.y-e.y)+(e.x-this.x)*(e.x-this.x));console.log(s);var h=(e.x-this.x)/Math.abs(e.x-this.x),m=-(e.y-this.y)/Math.abs(e.y-this.y);game.players[0].velX+=Math.cos(a)*h*this.magnitude*this.magnitude/2/s/s,game.players[0].velY+=Math.sin(a)*m*this.magnitude*this.magnitude/2/s/s;for(var o=0;o<game.bots.length;o++){var r=game.bots[o],t=r.y-this.y,i=r.x-this.x,a=Math.atan(Math.abs(t/i)),s=Math.sqrt((this.y-r.y)*(this.y-r.y)+(r.x-this.x)*(r.x-this.x));console.log(s);var h=(r.x-this.x)/Math.abs(r.x-this.x),m=-(r.y-this.y)/Math.abs(r.y-this.y);game.bots[o].velX+=Math.cos(a)*h*this.magnitude/s,game.bots[o].velY+=Math.sin(a)*m*this.magnitude/s}for(var o=0;o<game.generators.length;o++){var n=game.generators[o],t=n.y-this.y,i=n.x-this.x,a=Math.atan(Math.abs(t/i)),s=Math.sqrt((this.y-n.y)*(this.y-n.y)+(n.x-this.x)*(n.x-this.x));console.log(s);var h=(n.x-this.x)/Math.abs(n.x-this.x),m=-(n.y-this.y)/Math.abs(n.y-this.y);game.generators[o].velX+=Math.cos(a)*h*this.magnitude/s/2,game.generators[o].velY+=Math.sin(a)*m*this.magnitude/s/2}game.bombs.push(this)},this.disappear=function(){this.state=this.states.Dissipated},this.update=function(e){this.updateState(e),this.state==this.states.Placed||this.state==this.states.Detonated&&(this.velX=0,this.velY=0),this.x+=this.velX*e,this.y-=this.velY*e},this.updateState=function(e){if(this.state==this.states.Placed){this.currentTimer-=e;var t=this.currentTimer/this.plantTimer*this.plantBaseRadius;this.radius=t>this.PlantBaseRadius?this.PlantBaseRadius:t,this.currentTimer<=0&&this.explode()}else this.state==this.states.Detonated&&(this.currentTimer-=e,this.radius+=(this.explosionMaxRadius-this.explosionBaseRadius)*e/this.explodeTimer,this.currentTimer<=0&&this.disappear())}}function animLoop(){game.nowTime=Date.now();var e=(game.nowTime-game.lastTime)/1e3;update(e),draw.drawScene(),requestAnimFrame(animLoop),game.lastTime=game.nowTime}function update(e){game.botCooldownTimer-=e,game.currentLevelTimer-=e,game.currentLevelTimer<=0&&game.levelUp(),game.keys[82]&&(console.log("new!"),game=new gameObject,game.init()),game.keys[71]&&game.gravity++,game.keys[72]&&game.gravity--,game.keys[74]&&(game.botCooldownTimer<=0&&(game.bots.push(new bot(6,6,2,2,.5,10)),game.botCooldownTimer=1),game.keys[74]=!1);for(var t=0;t<game.players.length;t++)game.players[t].update(e);for(var t=0;t<game.powerups.length;t++)game.powerups[t].update(e);for(var i=0;i<game.bots.length;i++)game.bots[i].update(e);for(var a=0;a<game.generators.length;a++)game.generators[a].update(e);game.liveBomb&&game.liveBomb.update(e),game.liveWell&&game.liveWell.update(e);for(var i=0;i<game.bombs.length;i++)game.bombs[i].update(e);for(var s=0;s<game.wells.length;s++)game.wells[s].update(e);for(var h=0;h<game.meters.length;h++)game.meters[h].update(e);clearSpentBombsAndWells()}function clearSpentBombsAndWells(){for(var e=0;e<game.wells.length;e++)game.wells[e].state==game.wells[e].states.Dissipated&&(game.wells.splice(e,1),e-=1);for(var e=0;e<game.bots.length;e++)game.bots[e].state==game.bots[e].states.Dissipated&&(game.bots.splice(e,1),e-=1);for(var e=0;e<game.generators.length;e++)game.generators[e].state==game.generators[e].states.Dissipated&&(game.generators.splice(e,1),e-=1)}function shipGenerator(e,t,i,a,s,h){this.x=e,this.y=t,this.width=i,this.height=a,this.deployInterval=s,this.type=h,this.states={Alive:0,Exploded:1,Dissipated:2},this.state=this.states.Alive,this.currentTimer=this.deployInterval,this.velX=0,this.velY=0,this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y-this.height/2},this.bottom=function(){return this.y+this.height/2},this.draw=function(){var e=this.type==game.weapons.Bomb?game.colors.Bomb:game.colors.Well;draw.drawFilledRectCentered(this.x,this.y,this.width,this.height,e),draw.drawFilledRectCentered(this.x,this.y,this.width/2,this.height/2,e)},this.deploy=function(){this.type==game.weapons.Bomb&&game.bots.push(new bot(this.x,this.y,2,2,.5,10,2,game.weapons.Bomb)),this.type==game.weapons.Well&&game.bots.push(new bot(this.x,this.y,2,2,.5,10,2,game.weapons.Well))},this.update=function(e){this.updateState(e);for(var t=1,i=0;i<game.wells.length;i++){var a=Math.sqrt((game.wells[i].y-this.y)*(game.wells[i].y-this.y)+(this.x-game.wells[i].x)*(this.x-game.wells[i].x));console.log("dist "+a),a<game.wells[i].radius&&(console.log("reverse grav"),t=-1)}this.x+=this.velX*e,this.y-=this.velY*e,this.x-this.width/2<0&&(this.x=this.width/2,this.velX=-this.velX/2,this.explode()),this.x+this.width/2>game.gameWidth&&(this.x=game.gameWidth-this.width/2,this.velX=-this.velX/2,this.explode()),this.y+this.height/2>game.gameHeight-20&&(this.y=game.gameHeight-20-this.height/2,this.velY=-this.velY/2,this.explode()),this.y-this.height/2<0&&(this.y=this.height/2,this.velY=-this.velY/2,this.explode())},this.explode=function(){this.state=this.states.Dissipated,game.score+=200,this.type==game.weapons.Bomb&&game.powerups.push(new powerup(this.x,this.y,this.velX,this.velY,game.powerupTypes.MaxBombAmmo)),this.type==game.weapons.Well&&game.powerups.push(new powerup(this.x,this.y,this.velX,this.velY,game.powerupTypes.MaxWellAmmo))},this.updateState=function(e){this.currentTimer-=e,this.currentTimer<=0&&(this.deploy(),this.currentTimer=this.deployInterval)}}function bot(e,t,i,a,s,h,m,o){this.x=e,this.y=t,this.width=i,this.height=a,this.fireInterval=s,this.shotSpeed=h,this.type=o,this.states={Alive:0,Exploded:1,Dissipated:2},this.state=this.states.Alive,this.shotTimer=4,this.currentTimer=this.shotTimer,this.velX=8*Math.random()-4,this.velY=8*Math.random()-4,this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y-this.height/2},this.bottom=function(){return this.y+this.height/2},this.printSides=function(){console.log("Player Right: "+this.right()+" Left: "+this.left()+" Top"+this.top()+" Bottom"+this.bottom())},this.draw=function(){var e=this.type==game.weapons.Bomb?game.colors.Bomb:game.colors.Well;draw.drawFilledRectCentered(this.x,this.y,this.width,this.height,e)},this.shoot=function(){this.type==game.weapons.Bomb&&game.bombs.push(new bomb(this.x,this.y,0,0,game.players[0].x,game.players[0].y,20)),this.type==game.weapons.Well&&game.wells.push(new well(this.x,this.y,0,0,game.players[0].x,game.players[0].y,20))},this.update=function(e){this.updateState(e);for(var t=1,i=0;i<game.wells.length;i++){var a=Math.sqrt((game.wells[i].y-this.y)*(game.wells[i].y-this.y)+(this.x-game.wells[i].x)*(this.x-game.wells[i].x));a<game.wells[i].radius&&(console.log("reverse grav"),t=-1)}this.x+=this.velX*e,this.y-=this.velY*e,this.x-this.width/2<0&&(this.x=this.width/2,this.velX=this.velX/2,this.explode()),this.x+this.width/2>game.gameWidth&&(this.x=game.gameWidth-this.width/2,this.velX=-this.velX/2,this.explode()),this.y+this.height/2>game.gameHeight-20&&(this.y=game.gameHeight-20-this.height/2,this.velY=-this.velY/2,this.explode()),this.y-this.height/2<0&&(this.y=this.height/2,this.velY=-this.velY/2,this.explode())},this.explode=function(){this.state=this.states.Dissipated,game.score+=50,this.type==game.weapons.Bomb&&game.powerups.push(new powerup(this.x,this.y,this.velX,this.velY,game.powerupTypes.BombChargeRate)),this.type==game.weapons.Well&&game.powerups.push(new powerup(this.x,this.y,this.velX,this.velY,game.powerupTypes.WellChargeRate))},this.updateState=function(e){this.currentTimer-=e,this.currentTimer<=0&&(this.shoot(),this.currentTimer=this.shotTimer)}}function mouseClick(){game.ctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);for(var e=(document.getElementById("gameArea"),(event.clientX-(window.innerWidth-gameCanvas.width)/2)/gameCanvas.width*game.gameWidth),t=(event.clientY-(window.innerHeight-gameCanvas.height)/2)/gameCanvas.height*game.gameHeight,i=0;i<game.buttons.length;i++)if(mouseHitButton(e,t,game.buttons[i]))return game.selectedWeapon=game.buttons[i].type,null;game.players[0].shoot(game.players[0],e,t)}function mouseUp(){game.ctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);document.getElementById("gameArea"),(event.clientX-(window.innerWidth-gameCanvas.width)/2)/gameCanvas.width*game.gameWidth,(event.clientY-(window.innerHeight-gameCanvas.height)/2)/gameCanvas.height*game.gameHeight;game.liveBomb&&game.liveBomb.state==game.liveBomb.states.Placed&&game.liveBomb.explode(),game.liveWell&&game.liveWell.state==game.liveWell.states.Placed&&game.liveWell.explode()}function mouseMoved(){var e=(event.clientX-(window.innerWidth-gameCanvas.width)/2)/gameCanvas.width*game.gameWidth,t=(event.clientY-(window.innerHeight-gameCanvas.height)/2)/gameCanvas.height*game.gameHeight;game.mouseX=e,game.mouseY=t}function switchWeapon(){game.selectedWeapon++,game.selectedWeapon%=2}function keyDown(){game.keys[event.keyCode]=!0}function keyUp(){game.keys[event.keyCode]=!1}function gameObject(){this.gameWidth=100,this.gameHeight=100;var e={Background:"#5D6F72",Ship:"#80CCD8",Enemy:"#CEF5FB",Bomb:"#343A3B",Well:"#8AAAAF"};this.colors=e,this.Canvas=document.getElementById("gameCanvas"),this.ctx=this.Canvas.getContext("2d"),this.isMobile=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1},this.gravity=0,this.level=0,this.score=0,this.clicks=[],this.keys=[],this.buttons=[],this.meters=[],this.inputs=[],this.liveBomb,this.liveWell,this.bombs=[],this.wells=[],this.powerups=[],this.bombMap=[],this.floors=[],this.players=[],this.bots=[],this.generators=[],this.botCooldownTimer=1,this.levelTime=20,this.currentLevelTimer=0,this.weapons={Bomb:0,Well:1},this.builder={BombBot:0,WellBot:1,Gravity:2,BombSpawner:3,WellSpawner:4},this.selectedWeapon=this.weapons.Bomb,this.meterTypes={Level:0,Bomb:1,Well:2,Life:3},this.powerupTypes={WellChargeRate:0,MaxWellAmmo:1,BombChargeRate:2,MaxBombAmmo:3},this.init=function(){this.players.push(new player(this.gameWidth/2,this.gameHeight/2)),this.floors.push(new floor(150,40,10,5)),this.buttons.push(new roundButton(this.gameWidth/2+10,this.gameHeight-10,5,this.weapons.Bomb,"#000000")),this.buttons.push(new roundButton(this.gameWidth/2-10,this.gameHeight-10,5,this.weapons.Well,"#990099")),this.meters.push(new meter(this.gameWidth/2+17.5,this.gameHeight-10,this.meterTypes.Bomb)),this.meters.push(new meter(this.gameWidth/2-17.5,this.gameHeight-10,this.meterTypes.Well)),this.meters.push(new meter(this.gameWidth/2,this.gameHeight-10,this.meterTypes.Life)),this.meters.push(new meter(this.gameWidth/2,this.gameHeight-17.5,this.meterTypes.Level)),this.lastTime=Date.now(),this.nowTime=this.lastTime},this.levelUp=function(){if(this.level++,this.gravity=0,this.currentLevelTimer=this.levelTime,this.bots=[],this.generators=[],this.powerups=[],this.players[0].moveSpeed+=.5,2==this.level&&(this.levelTime=10,this.currentLevelTimer=this.levelTime,game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Bomb))),3==this.level&&(this.gravity=2),4==this.level&&(this.gravity=2,game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Well))),this.level>4&&this.level<8){var e=Math.floor(3*Math.random()+1),t=Math.floor(3*Math.random()+1),i=Math.floor(3*Math.random());this.gravity=i;for(var a=0;e>a;a++)game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Bomb));for(var a=0;t>a;a++)game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Well))}if(8==this.level&&(game.levelTime=30,this.currentLevelTimer=this.levelTime,game.generators.push(new shipGenerator(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,3,3,5,this.weapons.Bomb))),9==this.level&&(game.gravity=3,game.generators.push(new shipGenerator(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,3,3,5,this.weapons.Well))),this.level>9){game.levelTime=3*this.level,this.currentLevelTimer=this.levelTime;for(var s=0;s<this.level;){var h=Math.floor(5*Math.random());h==this.builder.BombBot&&(game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Bomb)),s+=1),h==this.builder.WellBot&&(game.bots.push(new bot(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,2,2,.5,10,2,game.weapons.Well)),s+=1),h==this.builder.Gravity&&(this.gravity+=1,s+=2),h==this.builder.WellSpawner&&(game.generators.push(new shipGenerator(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,3,3,5,this.weapons.Bomb)),s+=5),h==this.builder.WellBot&&(game.generators.push(new shipGenerator(game.gameWidth/2+Math.random()*game.gameWidth/2-game.gameWidth/4,game.gameHeight/2+Math.random()*game.gameHeight/2-game.gameHeight/4,3,3,5,this.weapons.Well)),s+=5)}}}}function drawLevelCentricObject(){this.drawScene=function(){var e=document.getElementById("gameCanvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),draw.drawFilledRectCentered(game.gameWidth/2,game.gameHeight/2,game.gameWidth,game.gameHeight,game.colors.Background),t.beginPath(),t.rect(0,0,e.width,e.height),t.rect(0,0,e.width,e.height-gameXToCanvasX(20)),t.stroke(),game.liveBomb&&game.liveBomb.draw(),game.liveWell&&game.liveWell.draw();for(var i=0;i<game.bombs.length;i++)game.bombs[i].draw();for(var a=0;a<game.wells.length;a++)game.wells[a].draw();for(var s=0;s<game.players.length;s++)game.players[s].draw();for(var s=0;s<game.powerups.length;s++)game.powerups[s].draw();for(var i=0;i<game.bots.length;i++)game.bots[i].draw();for(var h=0;h<game.generators.length;h++)game.generators[h].draw();for(var m=0;m<game.floors.length;m++)game.floors[m].draw();for(var i=0;i<game.buttons.length;i++)game.buttons[i].draw();for(var o=0;o<game.meters.length;o++)game.meters[o].draw();draw.drawText(game.gameWidth/2-27,game.gameHeight-17,"Level: "+game.level),draw.drawText(game.gameWidth/2-27,game.gameHeight-15,"[G]ravity: "+game.gravity),draw.drawText(game.gameWidth/2-27,game.gameHeight-13,"Spawners: "+game.generators.length),draw.drawText(game.gameWidth/2-27,game.gameHeight-11,"Bots: "+game.bots.length),draw.drawText(game.gameWidth/2-13,game.gameHeight-2,"Gravity Wells"),draw.drawText(game.gameWidth/2+9,game.gameHeight-2,"Bombs"),draw.drawText(game.gameWidth/2-1,game.gameHeight-2,"Life"),draw.drawText(game.gameWidth/2+25,game.gameHeight-17,"Score: "+game.score),draw.drawText(game.gameWidth/2+25,game.gameHeight-15,"Move Speed: "+game.players[0].moveSpeed),draw.drawText(game.gameWidth/2+25,game.gameHeight-13,"Max Bomb Ammo: "+game.players[0].maxBombAmmo),draw.drawText(game.gameWidth/2+25,game.gameHeight-11,"Bomb Regen Rate: "+game.players[0].bombRegenRate),draw.drawText(game.gameWidth/2+25,game.gameHeight-9,"Max Well Ammo: "+game.players[0].maxWellAmmo),draw.drawText(game.gameWidth/2+25,game.gameHeight-7,"Well Regen Rate: "+game.players[0].wellRegenRate),draw.drawText(3,game.gameHeight-9,"Directions: Survive"),draw.drawText(3,game.gameHeight-7,"WASD will move you, albeit very poorly."),draw.drawText(3,game.gameHeight-5,"Click to shoot self propelling bombs "),draw.drawText(3,game.gameHeight-3,"Release to detonate!"),draw.drawText(3,game.gameHeight-1,"Mouse Wheel switches weapons. Good luck!"),t.stroke(),t.closePath()},this.drawRect=function(e,t,i,a){var s=(document.getElementById("gameCanvas"),game.ctx);s.rect(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),gameYToCanvasY(a)),s.stroke()},this.drawRectCentered=function(e,t,i,a){var s=document.getElementById("gameCanvas"),h=s.getContext("2d");h.save(),h.beginPath(),h.rect(gameXToCanvasX(e-i/2),gameYToCanvasY(t-a/2),gameXToCanvasX(i),gameYToCanvasY(a)),h.stroke(),h.closePath(),h.restore()},this.drawFilledRectCentered=function(e,t,i,a,s){var h=document.getElementById("gameCanvas"),m=h.getContext("2d");m.save(),m.beginPath(),m.fillStyle=s,m.rect(gameXToCanvasX(e-i/2),gameYToCanvasY(t-a/2),gameXToCanvasX(i),gameYToCanvasY(a)),m.stroke(),m.fill(),m.closePath(),m.restore()},this.drawCircle=function(e,t,i,a){var s=game.ctx;s.beginPath(),s.save(),s.strokeStyle=a,s.lineWidth=2,s.arc(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),0,2*Math.PI,!1),s.stroke(),s.restore()},this.drawFilledCircle=function(e,t,i,a){var s=game.ctx;s.save(),s.beginPath(),s.fillStyle=a,s.arc(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),0,2*Math.PI,!1),s.fill(),s.stroke(),s.restore()},this.drawText=function(e,t,i){var a=game.ctx;a.beginPath(),a.fillText(i,gameXToCanvasX(e),gameYToCanvasY(t)),a.stroke()}}function drawPlayerCentricObject(){this.drawRect=function(e,t,i,a){var s=(document.getElementById("gameCanvas"),game.ctx);s.rect(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),gameYToCanvasY(a)),s.stroke()},this.drawRectCentered=function(e,t,i,a){var s=document.getElementById("gameCanvas"),h=s.getContext("2d");h.rect(gameXToCanvasX(game.players[0].x-e-i/2),gameYToCanvasY(game.players[0].y-t-a/2),gameXToCanvasX(i),gameYToCanvasY(a)),h.stroke()},this.drawCircle=function(e,t,i,a){var s=game.ctx;s.beginPath(),s.fillStyle=a,s.arc(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),0,2*Math.PI,!1),s.stroke()},this.drawFilledCircle=function(e,t,i){var a=game.ctx;a.beginPath(),a.arc(gameXToCanvasX(e),gameYToCanvasY(t),gameXToCanvasX(i),0,2*Math.PI,!1),a.fill(),a.stroke()},this.drawText=function(e,t,i){var a=game.ctx;a.beginPath(),a.fillText(i,gameXToCanvasX(e),gameYToCanvasY(t)),a.stroke()}}function player(e,t){this.x=e,this.y=t,this.velX=0,this.velY=0,this.width=1,this.height=3,this.moveSpeed=5,this.maxLife=100,this.currentLife=100,this.lifeRegen=2,this.shotSpeed=20,this.maxBombAmmo=100,this.maxWellAmmo=100,this.bombAmmo=100,this.wellAmmo=100,this.bombRegenRate=4,this.wellRegenRate=4,this.right=function(){return this.x+this.width/2},this.left=function(){return this.x-this.width/2},this.top=function(){return this.y-this.height/2},this.bottom=function(){return this.y+this.height/2},this.printSides=function(){console.log("Player Right: "+this.right()+" Left: "+this.left()+" Top"+this.top()+" Bottom"+this.bottom())},this.draw=function(){this.currentLife>0?draw.drawFilledRectCentered(this.x,this.y,this.width,this.height,game.colors.Ship):draw.drawText(game.gameWidth/2-8,game.gameHeight/2-6,"GAME OVER. PRESS R TO RESTART")},this.shoot=function(e,t,i){if(game.selectedWeapon==game.weapons.Bomb){var a=new bomb(e.x,e.y,e.velX,e.velY,t,i,this.shotSpeed);e.bombAmmo>=a.magnitude&&(game.liveBomb=a,e.bombAmmo-=game.liveBomb.magnitude)}else if(game.selectedWeapon==game.weapons.Well){var s=new well(e.x,e.y,e.velX,e.velY,t,i,this.shotSpeed);e.wellAmmo>=s.magnitude&&(game.liveWell=s,e.wellAmmo-=game.liveWell.magnitude)}},this.update=function(e){game.keys[65]&&(this.velX+=-this.moveSpeed*e),game.keys[68]&&(this.velX+=this.moveSpeed*e),game.keys[87]&&(this.velY+=this.moveSpeed*e),game.keys[83]&&(this.velY+=-this.moveSpeed*e),game.keys[69]&&(this.velY=0,this.velX=0),this.bombAmmo+=this.bombRegenRate*e,this.wellAmmo+=this.wellRegenRate*e,this.currentLife>0&&(this.currentLife+=this.lifeRegen*e),this.bombAmmo>this.maxBombAmmo&&(this.bombAmmo=this.maxBombAmmo),this.wellAmmo>this.maxWellAmmo&&(this.wellAmmo=this.maxWellAmmo),this.currentLife>this.maxLife&&(this.currentLife=this.maxLife),this.updateState(e);for(var t=1,i=0;i<game.wells.length;i++){var a=Math.sqrt((game.wells[i].y-this.y)*(game.wells[i].y-this.y)+(this.x-game.wells[i].x)*(this.x-game.wells[i].x));console.log("dist "+a),a<game.wells[i].radius&&(console.log("reverse grav"),t=-1)}for(var i=0;i<game.powerups.length;i++){var a=distance(game.powerups[i].x,game.powerups[i].y,this.x,this.y);a<game.powerups[i].radius+1&&(game.powerups[i].type==game.powerupTypes.BombChargeRate&&(this.bombRegenRate+=1),game.powerups[i].type==game.powerupTypes.MaxBombAmmo&&(this.maxBombAmmo+=5),game.powerups[i].type==game.powerupTypes.WellChargeRate&&(this.wellRegenRate+=1),game.powerups[i].type==game.powerupTypes.MaxWellAmmo&&(this.maxWellAmmo+=5),console.log("hit powerup!"),game.powerups.splice([i],1),i--)}this.velY-=game.gravity*game.gravity*t*e;this.x,this.y;this.x+=this.velX*e,this.y-=this.velY*e,this.x-this.width/2<0&&(this.x=this.width/2,this.currentLife-=Math.abs(this.velX),this.velX=-this.velX/2),this.x+this.width/2>game.gameWidth&&(this.x=game.gameWidth-this.width/2,this.currentLife-=Math.abs(this.velX),this.velX=-this.velX/2),this.y+this.height/2>game.gameHeight-20&&(this.y=game.gameHeight-20-this.height/2,this.currentLife-=Math.abs(this.velY),this.velY=-this.velY/2),this.y-this.height/2<0&&(this.y=this.height/2,this.currentLife-=Math.abs(this.velY),this.velY=-this.velY/2)},this.updateState=function(){}}!function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e,e.document)}):"undefined"!=typeof module&&module.exports?module.exports=t(e,e.document):e.Shake=t(e,e.document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function i(i){if(this.hasDeviceMotion="ondevicemotion"in e,this.options={threshold:15,timeout:1e3},"object"==typeof i)for(var a in i)i.hasOwnProperty(a)&&(this.options[a]=i[a]);if(this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null,"function"==typeof t.CustomEvent)this.event=new t.CustomEvent("shake",{bubbles:!0,cancelable:!0});else{if("function"!=typeof t.createEvent)return!1;this.event=t.createEvent("Event"),this.event.initEvent("shake",!0,!0)}}return i.prototype.reset=function(){this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null},i.prototype.start=function(){this.reset(),this.hasDeviceMotion&&e.addEventListener("devicemotion",this,!1)},i.prototype.stop=function(){this.hasDeviceMotion&&e.removeEventListener("devicemotion",this,!1),this.reset()},i.prototype.devicemotion=function(t){var i,a,s=t.accelerationIncludingGravity,h=0,m=0,o=0;return null===this.lastX&&null===this.lastY&&null===this.lastZ?(this.lastX=s.x,this.lastY=s.y,void(this.lastZ=s.z)):(h=Math.abs(this.lastX-s.x),m=Math.abs(this.lastY-s.y),o=Math.abs(this.lastZ-s.z),(h>this.options.threshold&&m>this.options.threshold||h>this.options.threshold&&o>this.options.threshold||m>this.options.threshold&&o>this.options.threshold)&&(i=new Date,a=i.getTime()-this.lastTime.getTime(),a>this.options.timeout&&(e.dispatchEvent(this.event),this.lastTime=new Date)),this.lastX=s.x,this.lastY=s.y,void(this.lastZ=s.z))},i.prototype.handleEvent=function(e){return"function"==typeof this[e.type]?this[e.type](e):void 0},i}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),game=new gameObject,game.init(),draw=new drawLevelCentricObject,resizeGame(),animLoop(),window.addEventListener("resize",resizeGame,!1),window.addEventListener("orientationchange",resizeGame,!1),gameCanvas.addEventListener("mousedown",mouseClick,!1),gameCanvas.addEventListener("mouseup",mouseUp,!1),gameCanvas.addEventListener("mousemove",mouseMoved,!1),window.addEventListener("mousewheel",switchWeapon,!1),gameCanvas.addEventListener("touchstart",mouseClick,!1),gameCanvas.addEventListener("touchend",mouseUp,!1),window.addEventListener("shake",switchWeapon,!1),window.addEventListener("keydown",keyDown,!1),window.addEventListener("keyup",keyUp,!1);
