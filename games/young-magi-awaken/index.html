<script type="module" crossorigin>
const t="data:image/png;base64,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",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARQAAAANCAYAAABo3pGeAAAAAXNSR0IArs4c6QAAAuFJREFUaIHtWllywjAMlTv94hxckhNwSc6RX/ejhFGFlicvJNC8GWYaW9FmW5KVFtohLrdaiYiu51K21qUF767/gY9FZX9P2Zvf/CE6COu8Bu0djb7nkFnyV56efprsiB+nQfWOdJA0ka9RXaw5KSsju5cO8e8IfhZPjd/lVmvGf5KPtte8MY13RMd11XRC+Fky6rJQOZ2IfoPL8KDyxR+ig8kVu55LsZzBnyM6FJKftvBy3KJD+bUA4dciq7XqkfQ9suWYtNULCB4dH/P2isZP43m51Sr1k8FU0lrPUndNF29MG/f2B5+zbNN8gepC9BtU1j8tmlZ8xSQ+0GgvnSTp+Q/hZ/FC9MxmOqmjJweheTXkxkQPdkulilaJ3iGZdVXsSUJWZWPJkPZpVYa2n5G94wWQ9f0oAc0KKk9XntUoxIFI+cwRlW4aX28crSwymSPiteoxsz8SZaQ9Aj0MrwDfw3J8VIXWAyQp8eAqK65Resy4/nRVKCOuMll5s2V6173MYvbopmXMnsqHb1CZLFCel1t9/GjA5htxMLyDhvRUZqHBt+mqDqFDfDy6UnkEFBkVuWIeRmdOxBlo38O6plj2IZXH3isFBD02XM+F6L75sgfUqnxlsEvoYq7jOv+KJDQbmQSQXdt7hUK0hwrFAnJHj+gQRBswan5xHqOyyd7gJYpgndZq5IF7MAmDvTcXNSNHBWyvoTuDvwT3rSdb9jw8OaMSfTmdHoGEVShDkPrslG1mavQRXaYRGNFmryheL8fzi6ejpYenoyUjskubt4KH94w0EDV7s3Z6iPprkY1WTwc53KitLeuh8ZO6RlcXhK+h05M/WB+FaNL/prw9kIqD0/T0J1qxhcwt0GKn944194m+bLEpeKfS36BS67LUuixyvBlTrjzvhC2+orzLl5tezDrk3mfTT0KLTcE7hUQVwqqTAxbQrLhVZfJKeXtAtkf1H320ISo9Vy4HDhw4sD1+ACVnsHzpshHvAAAAAElFTkSuQmCC",s=2e3,h=.98,e=32,o=27;function a({t:t,i:i}){return t.position.x+t.width>=i.position.x&&t.position.x<=i.position.x+i.width&&t.position.y+t.height>=i.position.y&&t.position.y<=i.position.y+i.height}function l(t,i){const s=Math.max(i.position.x,Math.min(t.position.x,i.position.x+i.width)),h=Math.max(i.position.y,Math.min(t.position.y,i.position.y+i.height)),e=t.position.x-s,o=t.position.y-h;return e*e+o*o<=t.h*t.h}function r(t,i){const s=Math.max(i.position.x,Math.min(t.position.x,i.position.x+i.width)),h=Math.max(i.position.y,Math.min(t.position.y,i.position.y+i.height)),e=t.position.x-s,o=t.position.y-h,a=e*e+o*o;let l=null;if(a<=t.h*t.h){const i=t.h-Math.sqrt(a);Math.abs(e)>Math.abs(o)?(t.position.x+=e>0?i:-i,l=e>0?"right":"left"):(t.position.y+=o>0?i:-i,l=o>0?"bottom":"top")}return l}class n{constructor({position:t={x:0,y:0},o:i,l:s,width:h,height:e,scale:o=1,p:a=!1,alpha:l=1,u:r=!1}){this.A=!0,this.width=h*o,this.height=e*o,this.position=t,this.M=JSON.parse(JSON.stringify(t)),this.g=!1,this.m=new Image,this.m.onload=()=>{this.g=!0},this.m.src=i,this.l=s,this.scale=o,this.S=this.position.x,this.p=a,this.k={x:0,y:0},this.alpha=l,this.v=!1,this.O=!1,this.u=r,this.T=!1,this.D=this.width/this.scale,this.U=this.height/this.scale}R(t){t.globalAlpha=this.alpha<0?0:this.alpha,t.drawImage(this.m,this.l.x,this.l.y,this.D,this.U,this.position.x,this.position.y,this.width,this.height),t.globalAlpha=1}L(){this.alpha<1&&this.v&&(this.alpha+=.01)}N(){this.alpha>0&&this.O&&(this.v=!1,this.alpha-=.01)}P(t){t.fillStyle="rgba(255,0,0,0.2)",t.fillRect(this.position.x,this.position.y,this.width,this.height)}update({c:t,canvas:i,delta:s,G:h,I:e,V:o}){this.R(t),this.L(),this.N(),this.p&&this.q({canvas:i,delta:s,I:e,V:o})}C(t,i,s){this.F=t,this.X=i,this.duration=s,this.H=0}B(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}q({delta:t,canvas:i,I:h,V:o}){if(this.T=!0,!(Math.sqrt(Math.pow(this.position.x+this.width/2-o.position.x,2)+Math.pow(this.position.y+this.height/2-o.position.y,2))<100)){if(this.T=!1,this.position.y+=this.k.y*t,this.k.y+=s*t,this.position.y+this.height>=i.height-e)return this.position.y=i.height-e-this.height,void(this.k.y=0);for(let t of h)if(t!==this&&a({t:this,i:t})&&this.position.y+this.height>=t.position.y){this.position.y=t.position.y-this.height,this.k.y=0;break}}}W(t){if(this.H<=1){const t=this.B(this.H);this.position.x=this.F+t*(this.X-this.F),this.H+=1/this.duration}else this.position.x=this.M.x,this.H=0}}class c{constructor({position:t={x:0,y:0},k:i={x:0,y:0},o:s}){this.position=t,this.k=i,this.g=!1,this.m=new Image,this.m.onload=()=>{this.g=!0},this.m.src=s,this.l={x:86,y:0,width:16,height:13},this.J=0,this.scale=2,this.state="full"}R(t,i){t.drawImage(this.m,this.l.x,this.l.y,this.l.width,this.l.height,this.position.x+i,this.position.y,this.l.width*this.scale,this.l.height*this.scale)}update({c:t,scroll:i}){this.R(t,i)}K(){this.state="empty",this.l.x=70}}class d{constructor({position:t={x:0,y:0},k:i={x:0,y:0},j:s,h:h=3,delay:e=0,color:o="red"}){this.position=t,this.M=JSON.parse(JSON.stringify(t)),this.k=i,this.alpha=1,this.j=s,this.h=h,this.delay=e,this.Z=0,this.Y={x:5,y:5},this.color=o}R(t){t.save(),t.globalAlpha=this.alpha,t.beginPath(),t.arc(this.position.x,this.position.y,this.h,0,2*Math.PI,!1),t.fillStyle=this.color,t.fill(),t.restore()}update({delta:t,c:i,scroll:s}){this.Z+=t,s&&(this.position.x=this.M.x+.98*s),this.Z<this.delay||(this.R(i),this.j&&this.$(t))}$(t){this.position.x+=this.k.x*t+(Math.random()-.5)*this.Y.x,this.position.y+=this.k.y*t+(Math.random()-.5)*this.Y.y,this.alpha-=this.j*t}}class y{constructor({char:t,x:i,y:s,m:h,_:e,tt:o,width:a,height:l,delay:r,it:n,u:c=!0}){this.char=t,this.position={x:i,y:s},this.m=h,this._=e,this.tt=o,this.width=a,this.height=l,this.opacity=0,this.offsetY=20,this.delay=r||0,this.st=0,this.u=c,this.it=n}R(t){t.globalAlpha=this.opacity,t.drawImage(this.m,this._,this.tt,this.width,this.height,this.position.x,this.position.y-this.offsetY,this.width,this.height),t.globalAlpha=1}animate(){this.st<this.delay?this.st++:(this.opacity=Math.min(this.opacity+.05,1),this.offsetY=Math.max(this.offsetY-1,0))}}class p{constructor({position:t={x:0,y:0},k:i={x:0,y:0},ht:s=10,direction:h="left",scale:e=2.5,o:a,et:l}){this.position=t,this.ot={...t},this.k=i,this.width=20*e,this.height=o*e,this.lt=0,this.rt=2e3,this.nt=!1,this.g=!1,this.m=new Image,this.m.onload=()=>{this.g=!0},this.m.src=a,this.l={x:20,y:19,width:20,height:24,offset:{x:0,y:10}},this.frames=0,this.ct=8,this.dt=12,this.J=0,this.scale=e,this.state="walk",this.yt=1,this.ht=s,this.direction=h,this.xt=!1,this.et=l,this.u=!0,this.type="soldier",this.D=this.width/this.scale,this.U=this.height/this.scale}R(t){const i=this.l.width*this.scale/2,s=this.l.height*this.scale/2;t.save(),t.translate(this.position.x+i,this.position.y+s),this.nt&&(this.yt-=.1,t.scale(this.yt,this.yt)),"left"===this.direction&&t.scale(-1,1),t.drawImage(this.m,this.l.x*this.J,this.l.y,this.width/this.scale,this.height/this.scale,-i+(this.l.offset?this.l.offset.x:0),-s+(this.l.offset?this.l.offset.y:0),this.width,this.height),t.restore()}P(t){const i=this.l.width*this.scale/2,s=this.l.height*this.scale/2;t.fillStyle="rgba(255,0,0,0.2)",t.fillRect(-i,-s,this.width,this.height),t.fillStyle="rgba(0,0,255,0.2)",t.fillRect(-i,-s,this.l.width*this.scale,this.l.height*this.scale)}update({c:t,G:i,delta:s,V:h,canvas:e,ut:o}){this.R(t),this.At(t),this.Mt({ut:o}),this.q({delta:s,canvas:e,V:h}),this.bt({G:i,c:t}),Math.abs(this.position.x-this.ot.x)>=this.et&&"walk"===this.state&&(this.direction="right"===this.direction?"left":"right",this.ot.x=this.position.x,this.k.x=-this.k.x);const a=this.wt({delta:s,G:i,c:t});a&&"walk"===this.state?this.gt():!a&&"attack"===this.state&&this.xt?(this.J=0,this.ft(),this.xt=!1):this.position.x+=this.k.x*s}wt({delta:t,G:i,c:s}){return a({t:{position:{x:this.position.x+("left"===this.direction?-5*this.scale:5*this.scale+20),y:this.position.y},width:this.width-20,height:this.height},i:i})}q({delta:t,canvas:i,V:h}){Math.sqrt(Math.pow(this.position.x+this.width/2-h.position.x,2)+Math.pow(this.position.y+this.height/2-h.position.y,2))<1.5*h.h||(this.position.y+=this.k.y*t,this.k.y+=s,this.position.y+this.height>=i.height-e&&(this.position.y=i.height-e-this.height,this.k.y=0))}At(){this.frames++,this.frames%this.dt==0&&this.J++,this.St(),"attack"===this.state&&this.J===this.ct-1&&(this.xt=!0),this.J>=this.ct&&(this.frames=0,this.J=0)}St(){this.kt=!1,"attack"===this.state&&this.J>1&&this.J<3&&!0!==this.kt&&(this.kt=!0)}bt({G:t,c:i}){const s="right"===this.direction?19*this.scale:-19*this.scale;a({t:{position:{x:this.position.x+s,y:this.position.y},width:this.width,height:this.height},i:t})&&this.kt&&!t.vt&&t.K()}gt(){this.state="attack",this.width=38*this.scale,this.l={x:38,y:44,width:38,height:o,offset:{x:"left"===this.direction?19*this.scale:0,y:-5}},this.frames=0,this.ct=5,this.dt=12,this.J=0,this.k.x=0,this.D=this.width/this.scale,this.U=this.height/this.scale}Mt({ut:t}){let i=!1;for(let s=0;s<t.length;s++){const h=t[s];if(a({t:this,i:h})){if(this.k.y>0&&this.position.y+this.height>=h.position.y){this.position.y=h.position.y-this.height,this.k.y=0,i=!0;break}if(this.k.y<0&&this.position.y<=h.position.y+h.height){this.position.y=h.position.y+h.height,this.k.y=0,i=!0;break}}}return i}ft(){0===this.J&&(this.width=20*this.scale,this.state="walk",this.l={x:20,y:19,width:20,height:24,offset:{x:0,y:10}},this.frames=0,this.ct=8,this.dt=12,this.J=0,this.k.x="left"===this.direction?-20:20,this.D=this.width/this.scale,this.U=this.height/this.scale)}}class x{constructor({position:t={x:0,y:0},k:i={x:0,y:0},h:s=5}){this.position=t,this.Ot=JSON.parse(JSON.stringify(t)),this.k=i,this.h=s,this.Tt=0,this.shadowBlur=10,this.state="idle"}R(t){t.save(),t.shadowBlur=this.shadowBlur,t.shadowColor="purple",t.beginPath(),t.arc(this.position.x,this.position.y,this.h+3,0,2*Math.PI,!1),t.fillStyle="purple",t.fill(),t.shadowBlur=2,t.shadowColor="black",t.beginPath(),t.arc(this.position.x,this.position.y,this.h,0,2*Math.PI,!1),t.fillStyle="black",t.fill(),t.restore()}update({delta:t,c:i,V:s}){this.R(i),this.Dt(s),this.Tt+=2*t,this.shadowBlur=10*Math.abs(Math.sin(this.Tt))+3,this.position.x=this.Ot.x+2*Math.sin(this.Tt),this.position.y=this.Ot.y+2*Math.cos(this.Tt),"shrink"===this.state&&(this.h-=.5)}nt(){this.state="shrink"}Dt(t){const i=2.5*t.h,s=1.4*t.h,h=t.position.x-this.position.x,e=t.position.y-this.position.y,o=Math.sqrt(h*h+e*e),a=Math.min(10,s/o);o<i&&(this.Ot.x+=a*h/o,this.Ot.y+=a*e/o)}}class u{constructor({position:t={x:0,y:0},color:i="red",width:s,height:h}){this.position=t,this.color=i,this.width=s,this.height=h,this.Ut=0}R(t){t.save(),t.globalAlpha=.175*Math.sin(this.Ut)+.275,t.shadowColor="yellow",t.shadowBlur=20,t.fillStyle="yellow",t.fillRect(this.position.x,this.position.y,this.width,this.height),t.globalAlpha=1,t.restore()}update({delta:t,c:i,scroll:s}){this.R(i),this.Ut+=t}}const A=document.querySelector("#c"),M=A.getContext("2d");A.width=1024,A.height=576;const b=265,w="#993399";M.imageSmoothingEnabled=!1;const g=[];for(let H=0;H<193;H++)g.push(new n({position:{x:40*H,y:A.height-e},width:40,height:e,o:t,l:{x:134,y:1,width:10,height:9},scale:4}));const f=new class{constructor({position:i={x:0,y:0},k:s={x:0,y:0}}){this.width=45,this.height=54,this.position={x:i.x,y:i.y},this.k=s,this.Rt=[new c({o:t,position:{x:10,y:10}}),new c({o:t,position:{x:45,y:10}}),new c({o:t,position:{x:80,y:10}})],this.m=new Image,this.m.onload=()=>{this.g=!0},this.m.src=t,this.l={x:16,y:0,width:15,height:18},this.frames=0,this.ct=4,this.dt=10,this.J=0,this.scale=3,this.state="idle",this.Tt=0,this.Lt=0,this.Nt=2,this.vt=!1,this.Pt=!1,this.Gt=0,this.It=1,this.alpha=1}R(){M.globalAlpha=this.alpha,this.g&&(this.Vt(),this.Pt&&this.qt()),M.globalAlpha=1}update({delta:t,ut:i}){this.Tt+=t,this.R(),this.At(),this.position.x+=this.k.x*t,this.Ct({ut:i}),this.q(t),this.Et(),this.position.x<0&&(this.position.x=0),this.position.x+this.width>=7677&&(this.position.x=7677-this.width),this.vt?this.alpha=1===this.alpha?0:1:this.alpha=1}Ct({ut:t}){for(let i=0;i<t.length;i++){const s=t[i];if(!s.T&&(!(this.position.y+this.height<=s.position.y)&&a({t:this,i:s}))){if(this.k.x<0){this.position.x=s.position.x+s.width+.01;break}if(this.k.x>0){this.position.x=s.position.x-this.width-.01;break}}}}Mt({ut:t}){let i=!1;for(let s=0;s<t.length;s++){const h=t[s];if(!h.T&&a({t:this,i:h})){if(this.k.y>0&&this.position.y+this.height>=h.position.y){this.position.y=h.position.y-this.height,this.k.y=0,this.Lt=0,i=!0;break}if(this.k.y<0&&this.position.y<=h.position.y+h.height){this.position.y=h.position.y+h.height+1,this.k.y=0,i=!0;break}}}return i}P(){M.fillStyle="rgba(255,0,0,0.2)",M.fillRect(this.position.x,this.position.y,this.width,this.height),M.fillStyle="rgba(0,0,255,0.2)",M.fillRect(this.position.x,this.position.y,this.l.width*this.scale,this.l.height*this.scale)}Et(){if("run"===this.state&&0===this.k.y&&this.Tt>.02){for(let t=0;t<3;t++)D.push(new d({position:{x:v.d.Ft?this.position.x:this.position.x+this.width,y:this.position.y+this.height+5},k:{x:v.d.Ft?-15:15,y:-40},j:1.5,h:1+1*Math.random(),delay:.05*Math.random(),color:"#6abe30"}));this.Tt=0}}q(t){this.position.y+=this.k.y*t,this.Mt({ut:q})||(this.k.y+=s*t),this.position.y+this.height>=A.height-e&&(this.position.y=A.height-e-this.height,this.k.y=0,this.Lt=0)}Vt(){M.save(),T.position.x<this.position.x?(M.scale(-1,1),M.drawImage(this.m,this.l.x*this.J,this.l.y,15,18,-this.position.x-this.width,this.position.y,15*this.scale,18*this.scale)):M.drawImage(this.m,this.l.x*this.J,this.l.y,15,18,this.position.x,this.position.y,15*this.scale,18*this.scale),M.restore()}qt(){const t=Math.atan2(T.position.y-this.position.y+14,T.position.x-this.position.x-7);this.Gt<1&&(this.Gt+=.01),this.It<30&&(this.It+=.3),M.globalAlpha=this.Gt,M.drawImage(this.m,63,0,5,4,this.position.x+15+Math.cos(t)*this.It,this.position.y+14+Math.sin(t)*this.It,5*this.scale,4*this.scale);const i=8*this.scale*.8,s=18*this.scale*.8;M.save(),M.translate(this.position.x+14+Math.cos(t)*this.It+i/2,this.position.y+-23+Math.sin(t)*this.It+s),M.rotate(t+Math.PI/2),M.translate(-i/2,-s),M.drawImage(this.m,171,0,7,19,0,0,i,s),M.restore(),M.globalAlpha=1}At(){this.frames++,this.frames%this.dt==0&&this.J++,this.J>=this.ct&&(this.frames=0,this.J=0)}K(){this.vt=!0,setTimeout((()=>{this.vt=!1}),2e3);for(let t=this.Rt.length-1;t>=0;t--)if("empty"!==this.Rt[t].state){this.Rt[t].state="empty",this.Rt[t].l.x=70;break}this.Rt.every((t=>"empty"===t.state))&&!N.Xt&&(N.Xt=!0,L=0)}}({position:{x:A.width/2-22.5-5,y:A.height-54-37}}),m=[];let S=Date.now(),k=[];const v={d:{Ft:!1},a:{Ft:!1}},O={Ft:!1,h:10},T=new class{constructor({position:t={x:0,y:0},k:i={x:0,y:0},h:s=5}){this.position=t,this.k=i,this.h=s,this.Ht=s,this.Bt={x:this.position.x,y:this.position.y,h:5,angle:0},this.Tt=0,this.Wt=!1,this.Jt=!0}R(t){t.beginPath(),t.arc(this.position.x,this.position.y,this.h,0,2*Math.PI,!1),t.shadowColor="#490385",t.shadowBlur=50+10*Math.abs(Math.sin(this.Tt)),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.beginPath(),t.arc(this.position.x,this.position.y,this.h,0,2*Math.PI,!1),t.shadowColor="purple",t.shadowBlur=15+10*Math.abs(Math.sin(this.Tt)),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.shadowBlur=0,t.beginPath(),t.arc(this.position.x,this.position.y,this.h,0,2*Math.PI,!1),t.shadowColor="black",t.shadowBlur=20,t.fillStyle="black",t.fill(),t.shadowBlur=0}update({delta:t,c:i,canvas:s,scroll:h,Kt:e,ut:o,jt:a,font:l,zt:r,Zt:n,Yt:c}){this.R(i),this.Tt+=1.2*t,this.Qt&&(this.k.y+=GRAVITY),this.position.x+=this.k.x*t,this.position.y+=this.k.y*t,this.$t(s),this._t(),this.ti(h),this.ii(s,h),this.si(o),this.hi(c),this.ei(i),this.oi(),this.ai({c:i,Kt:e}),this.Dt(a,l),this.Dt(n)}oi(){this.Wt&&this.h>20?this.h-=.1:this.h<=20&&(this.Wt=!1)}hi(t){for(let i of t)l(this,i)&&(this.Wt=!0)}si(t){for(let i of t){if(this.h>i.width/2&&i.u)continue;const t=r(this,i);if(t){"left"===t||"right"===t?(this.k.x*=-.2,this.k.y*=h):"top"!==t&&"bottom"!==t||(this.k.y*=-.2,this.k.x*=h);break}}}$t(t){this.position.y+this.h>=t.height-e&&(this.k.y=0,this.k.x*=h,this.position.y=t.height-this.h-e)}_t(){this.position.y-this.h<=0&&(this.k.y=0,this.position.y=this.h,this.k.x*=h)}ti(t){this.position.x-this.h-t<=0&&(this.position.x=this.h+t,this.k.x=0,this.k.y*=h)}ii(t,i){this.position.x+this.h>=t.width+i&&(this.position.x=t.width-this.h+i,this.k.x=0,this.k.y*=h)}ai({c:t,Kt:i}){if(!i.Ft)return;this.Bt.x=this.position.x,this.Bt.y=this.position.y;const s=this.Bt.x+-Math.cos(this.Bt.angle)*(this.h+14),h=this.Bt.y+-Math.sin(this.Bt.angle)*(this.h+14),e=Math.atan2(h-this.Bt.y,s-this.Bt.x),o=e+Math.PI/6,a=e-Math.PI/6,l=s-10*Math.cos(o),r=h-10*Math.sin(o),n=s-10*Math.cos(a),c=h-10*Math.sin(a);t.beginPath(),t.moveTo(s,h),t.lineTo(l,r),t.lineTo(n,c),t.lineTo(s,h),t.fillStyle="#993399",t.fill(),t.closePath()}li(t=1){this.Jt=!0,this.Ht=this.h+t}ei(t){this.Jt&&this.h<this.Ht?this.h+=.1:this.h>=this.Ht&&(this.Jt=!1)}Dt(t,i){if(this.h<20)return;const s=1.5*this.h;let h=!1;for(let o of t){if(!o.u)continue;const t=this.position.x-(o.position.x+o.width/2),i=this.position.y-(o.position.y+o.height/2),h=Math.sqrt(t*t+i*i),e=Math.min(this.h/10,100/h);this.h>Math.min(o.width/2,o.height/2)&&h<s&&(o.T=!0,setTimeout((()=>{o.T=!1}),500),o.position.x+=e*t/h,o.position.y+=e*i/h,h<this.h&&(o.width*=.9,o.height*=.9))}let e=!0;for(let o of t){if(o.width>5||o.height>5){e=!1;break}o.it&&o.width<=5&&o.height<=5&&(h=!0)}e&&i&&!h&&i.ri()}}({position:{x:A.width/2,y:150},h:0}),D=[],U=[];function R({position:t,rows:i=5,cols:s=5}){for(let h=0;h<s;h++)for(let s=0;s<i;s++)U.push(new x({position:{x:t.x+30*h,y:t.y+30*s},h:7}))}R({position:{x:1420,y:100}}),R({position:{x:3100,y:380}});let L=1;setTimeout((()=>{N.ni=!0}),2e3);const N={ci:!1,di:!1,yi:!1,ni:!1,Xt:!1,init(){R({position:{x:1420,y:100}}),R({position:{x:3100,y:380}})},pi(){if(L>0&&L<=1){if(M.globalAlpha=L,M.fillStyle="black",M.fillRect(0,0,A.width,A.height),!this.ni)return;L-=.003,L<0&&(L=0,setTimeout((()=>{I.ri(),T.li(23),setTimeout((()=>{I.ri(),f.Pt=!0,setTimeout((()=>{I.ri(),V.v=!0,this.di=!0,this.yi=!0}),4e3)}),5e3)}),1e3))}M.globalAlpha=1},xi({ui:t,delta:i}){for(let s=t.length-1;s>=0;s--){const h=t[s],e=Math.hypot(h.Ot.x-T.position.x,h.Ot.y-T.position.y);h.h<=0?(t.splice(s,1),T.li(.75)):(h.update({delta:i,c:M,V:T}),e<30&&"shrink"!==h.state&&h.nt())}},Ai({Mi:t,delta:i}){for(let s=t.length-1;s>=0;s--){const h=t[s];h.alpha>0?h.update({delta:i,c:M}):t.splice(s,1)}},bi({G:t,scroll:i,delta:s}){t.position.x<A.width/2+10+i.value||i.value>6700?t.k.x=400:(i.value+=b*s,M.translate(-265*s,0),t.position.x+=b*s,C.forEach((t=>{t.position.x+=b*s*.6})),E.forEach((t=>{t.position.x+=b*s*.7})))},wi({G:t,scroll:i,delta:s}){t.position.x>A.width/2-10+i.value||i.value<=0&&t.position.x>0?t.k.x=-400:i.value>0&&(i.value-=b*s,M.translate(b*s,0),t.position.x-=b*s,C.forEach((t=>{t.position.x-=b*s*.6})),E.forEach((t=>{t.position.x-=b*s*.7})))}},P=[];for(let H=0;H<300;H++)P.push(new d({position:{x:Math.random()*(2*A.width),y:Math.random()*A.height},h:2*Math.random(),color:"#4A86CC"}));let G={value:0};const I=new class{constructor({gi:t,fi:i,mi:s,Si:h}){this.m=new Image,this.m.src=t,this.fi=i,this.mi=s,this.Si=h,this.ki=!1,this.m.onload=()=>{this.ki=!0,this.init()},this.jt=[],this.vi=[],this.Oi=0,this.Ti=.02,this.Di=null,this.Ui=1,this.scrollX=0,this.Ri=[{Li:1300,x:1300,y:140,text:"THE KNIGHTS HAVE MAGIC BARRIERS THAT WILL SHRINK THE VOID",activated:!1},{Li:2100,x:2400,y:300,text:"BEWARE KNIGHTS LARGER THAN YOUR VOID",activated:!1},{Li:3200,x:3200,y:100,text:"CARVE YOUR PATH TO GREATNESS",activated:!1},{Li:7e3,x:7250,y:100,text:"IM TIRED AND NEED TO GO TO BED NOW",activated:!1,Ni:!1},{Li:7e3,x:7250,y:120,text:"THANKS FOR PLAYING",activated:!1,Ni:!1}]}init(){this.vi.push(this.Pi("YOUNG MAGI AWAKEN",425,300)),this.vi.push(this.Pi("WITH YOU LIES THE POWER OF VOID",360,300)),this.vi.push(this.Pi("DRAW YOUR WAND AND USE ITS POWER WISELY",315,300)),this.vi.push(this.Pi("CLICK AND DRAG TO MOVE THE VOID",360,300)),this.vi.push(this.Pi("USE THE W A S D KEYS TO MOVE",660,138)),this.vi.push(this.Pi("COLLECT ORBS TO GROW THE VOID",1330,308)),this.vi.push(this.Pi("GROW THE VOID TO CONSUME SMALLER OBJECTS LIKE BOXES",700,148)),this.vi[this.Oi]?this.jt=[...this.vi[this.Oi]]:console.warn("Unexpected state: currentSequence does not point to a valid letter sequence.")}Gi(){}ri(){if(this.Oi++,this.Oi<this.vi.length){this.jt=[],this.jt.push(...this.vi[this.Oi]);for(const t of this.Ri)t.activated=!1}else this.jt=[]}Ii(t,i,s,h){const e=this.Pi(t,i,s,!0,h);this.jt.push(...e)}Vi(t){this.scrollX=t;for(const i of this.Ri)t>=i.Li&&!i.activated&&(i.activated=!0,this.Ii(i.text,i.x,i.y,i.Ni))}Pi(t,i,s,h=!1,e=!0){if(!this.ki)return console.warn("Bitmap font image not yet loaded."),this.Gi=()=>{this.Pi(t,i,s)},[];const o=[],a=t.split("\n");let l=0;for(let r=0;r<a.length;r++){const t=a[r];for(let a=0;a<t.length;a++){const n=t[a],c=n.charCodeAt(0)-65;if(c<0||c>25){console.warn(`Unsupported character: ${n}`);continue}const d=c%this.Si,p=Math.floor(c/this.Si),x=d*this.fi,u=p*this.mi,A=new y({char:n,x:i+a*this.fi,y:s+r*this.mi-20,m:this.m,_:x,tt:u,width:this.fi,height:this.mi,delay:l,it:h,Ni:e});o.push(A),l+=2}}return o}}({gi:i,fi:10,mi:14,Si:26}),V=new n({position:{x:600,y:300},width:10,height:14,o:i,l:{x:250,y:0,width:16,height:16},scale:2,alpha:0}),q=[new n({position:{x:1220,y:375},width:16,height:16,o:t,l:{x:102,y:0,width:16,height:16},scale:3,p:!0,qi:!0,u:!0}),new n({position:{x:1220,y:307},width:16,height:16,o:t,l:{x:102,y:0,width:16,height:16},scale:3,p:!0,qi:!0,u:!0}),new n({position:{x:1220,y:247},width:16,height:16,o:t,l:{x:102,y:0,width:16,height:16},scale:3,p:!0,qi:!0,u:!0})];V.C(V.position.x,420,200);const C=[],E=[];for(let H=0;H<10;H++)C.push(new n({position:{x:576*H,y:389},width:18,height:5,o:t,l:{x:134,y:9,width:18,height:5},scale:32})),E.push(new n({position:{x:576*H-162,y:430},width:18,height:5,o:t,l:{x:152,y:1,width:18,height:5},scale:18}));const F=[...E,...C,...g],X=[];!function(){for(let i=0;i<22;i++)q.push(new n({position:{x:2e3+48*i,y:158},width:16,height:16,o:t,l:{x:118,y:0,width:16,height:16},scale:3,p:!1,qi:!0}));for(let i=0;i<6;i++)q.push(new n({position:{x:3008,y:158+48*i},width:16,height:16,o:t,l:{x:118,y:0,width:16,height:16},scale:3,p:!1,qi:!0}));for(let i=0;i<2;i++)q.push(new n({position:{x:3008,y:158+48*(6+i)},width:16,height:16,o:t,l:{x:102,y:0,width:16,height:16},scale:3,p:!1,qi:!0,u:!0}));X.push(new u({position:{x:2e3,y:198},width:48,height:346})),m.push(new p({position:{x:2900,y:A.height-o},k:{x:-40,y:0},et:200,scale:3,o:t}))}(),function(){const i=3700;for(let s=0;s<62;s++)for(let h=0;h<11;h++)if(!(h>7&&h<11&&s>5&&s<9||h>2&&h<6&&s>5&&s<9||h>5&&h<11&&s>13&&s<19||(h>=0&&h<5&&s>23&&s<26&&q.push(new n({position:{x:i+48*s,y:17+48*h},width:16,height:16,o:t,l:{x:118,y:0,width:16,height:16},scale:3,p:!1,qi:!0})),h>=9&&h<11&&s>23&&s<26)))if(s<32)q.push(new n({position:{x:i+48*s,y:17+48*h},width:16,height:16,o:t,l:{x:102,y:0,width:16,height:16},scale:3,p:!1,qi:!0,u:!0}));else if(s>=32){if(h>3&&h<11&&s>50&&s<60)continue;U.push(new x({position:{x:i+48*s+24,y:17+48*h+24},h:7}))}R({position:{x:4015,y:190},rows:4,cols:4}),m.push(new p({position:{x:4033,y:A.height-o-10},k:{x:-40,y:0},et:50,scale:5,o:t})),m.push(new p({position:{x:4443,y:A.height-o-10},k:{x:-40,y:0},et:60,scale:8,o:t})),m.push(new p({position:{x:4883,y:A.height-o-10},k:{x:-40,y:0},et:25,scale:3,o:t})),m.push(new p({position:{x:6343,y:A.height-o-10},k:{x:-40,y:0},et:105,scale:12,o:t}))}(),function t(){requestAnimationFrame(t);const i=Date.now(),s=(i-S)/1e3;S=i,M.clearRect(G.value,0,A.width,A.height),M.clearRect(G.value,0,199999,1999),M.fillStyle="#181622",M.fillRect(G.value,0,A.width,A.height),P.forEach((t=>{t.update({delta:s,c:M,scroll:G.value})})),F.forEach((t=>{t.update({c:M,canvas:A,delta:s,G:f,I:q})})),X.forEach((t=>{t.update({c:M,delta:s,scroll:G})})),N.Ai({Mi:D,delta:s}),V.update({c:M,canvas:A,delta:s}),V.W(M),4===I.Oi&&(V.v=!1,V.O=!0,N.yi=!0),T.update({delta:s,c:M,canvas:A,scroll:G.value,Kt:O,ut:q,jt:I.jt,font:I,Zt:[...q,...m],Yt:X});for(let h=q.length-1;h>=0;h--){const t=q[h];t.width<=5?q.splice(h,1):t.update({c:M,canvas:A,delta:s,G:f,I:q,V:T})}f.update({delta:s,ut:q,scroll:G}),N.xi({ui:U,delta:s}),f.Rt.forEach((t=>{t.update({c:M,scroll:G.value})})),f.k.x*=.87,v.d.Ft?N.bi({G:f,scroll:G,delta:s}):v.a.Ft&&N.wi({G:f,scroll:G,delta:s}),v.d.Ft||v.a.Ft?f.state="run":f.state="idle";for(let h=m.length-1;h>=0;h--){const t=m[h];t.width<=5?(T.Ht+=t.ht,m.splice(h,1)):t.update({canvas:A,G:f,delta:s,V:T,c:M,ut:q})}k.length>0&&(M.beginPath(),M.moveTo(k[0].x+G.value,k[0].y),M.lineTo(k[1].x+G.value,k[1].y),M.lineTo(k[2].x+G.value,k[2].y),M.lineTo(k[3].x+G.value,k[3].y),M.lineWidth=5,M.closePath(),M.fillStyle=w,M.fill(),M.beginPath(),M.arc(k[0].x+G.value,k[0].y,O.h,0,2*Math.PI,!1),M.fillStyle=w,M.fill()),N.Xt||N.pi();for(let h of I.jt)h.animate(),h.R(M);I.Vi(f.position.x),L>=0&&L<=1&&N.Xt&&(M.globalAlpha=L,M.fillStyle="black",M.fillRect(0,0,A.width+G.value,A.height),L<1&&(L+=.006),L>1&&(L=1),M.fillStyle="white",M.fillText("GAME OVER",G.value+A.width/2-30,A.height/2),M.fillText("REFRESH TO PLAY AGAIN",G.value+A.width/2-65,A.height/2+20))}(),addEventListener("mousedown",(t=>{N.di&&(O.Ft=!0,k=[{x:t.clientX,y:t.clientY},{x:t.clientX+O.h,y:t.clientY},{x:t.clientX,y:t.clientY},{x:t.clientX-O.h,y:t.clientY}])})),addEventListener("mousemove",(t=>{if(N.di&&O.Ft&&k.length>0){k[2].x=t.clientX,k[2].y=t.clientY;const i=Math.atan2(k[2].y-k[0].y,k[2].x-k[0].x);k[1].x=k[0].x+Math.cos(i-Math.PI/2)*O.h,k[1].y=k[0].y+Math.sin(i-Math.PI/2)*O.h,k[3].x=k[0].x+Math.cos(i+Math.PI/2)*O.h,k[3].y=k[0].y+Math.sin(i+Math.PI/2)*O.h,T.Bt.angle=i}})),addEventListener("mouseup",(t=>{if(!N.di)return;O.Ft=!1;const i=Math.hypot(k[2].x-k[0].x,k[2].y-k[0].y),s=Math.atan2(k[2].y-k[0].y,k[2].x-k[0].x);k=[],T.k={x:-Math.cos(s)*i*1,y:-Math.sin(s)*i*1}})),addEventListener("keydown",(t=>{if(N.yi)switch(t.code){case"KeyA":v.a.Ft=!0;break;case"KeyD":v.d.Ft=!0;break;case"KeyW":case"Space":f.Lt<f.Nt&&(f.k.y=-450,f.Lt++);break;case"KeyS":f.k.y+=1}})),addEventListener("keyup",(t=>{if(N.yi)switch(t.code){case"KeyA":v.a.Ft=!1;break;case"KeyD":v.d.Ft=!1}}));

</script>

<body style="background: #181622">
  <canvas id="c"></canvas>
  
</body>
