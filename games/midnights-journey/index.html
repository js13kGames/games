<!doctype html><title>Midnight's Journey - js13kGames 2025</title><meta name=viewport content="width=device-width"><style>*{margin:0;padding:0;box-sizing:border-box}body{color:#e0e6ed;font-family:Arial,sans-serif;overflow:hidden;height:100vh}.st{position:fixed;bottom:20px;left:20px;background:rgba(0,0,0,.7);padding:8px 14px;border-radius:10px;font-size:.9em;line-height:1.4em;color:#e0e6ed;max-width:220px}.lc{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.95);color:#fff;padding:40px 30px;border-radius:20px;text-align:center;display:none;z-index:9999;max-width:420px;line-height:1.4}#hd{display:none;position:fixed;left:50%;top:140px;transform:translateX(-50%);background:rgba(0,0,0,.85);padding:10px 14px;border-radius:10px;color:#e0e6ed;z-index:999}.ct{position:fixed;bottom:20px;right:20px;background:rgba(0,0,0,.8);padding:10px;border-radius:10px;color:#fff;z-index:10001;pointer-events:auto;display:grid;grid-template-columns:auto auto;gap:8px 12px;align-items:center}.ct-t{grid-column:1/span 2;justify-self:center;white-space:nowrap;font-size:.9rem;opacity:.85;text-shadow:0 1px 0 rgba(0,0,0,.3)}.ct button{border-radius:999px;padding:8px 24px;font-weight:600;background:#2f2f2f;color:#fff;cursor:pointer;font-size:12px;border:none}.ct button:first-of-type{grid-column:1;justify-self:end}.ct button:nth-of-type(2){grid-column:2;justify-self:start}.sb{font-size:.9rem;opacity:.8}#vp{height:95vh;position:relative;overflow:hidden}#g{width:100%;height:100%;display:block}.lc button{border-radius:999px;padding:8px 24px;font-weight:600;background:#2f2f2f;color:#fff;cursor:pointer;font-size:12px;border:none;margin:0 5px}h1{text-align:center;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.5);margin:10px 0;font-size:2em;position:relative;z-index:10}.star{position:absolute;background:#fff;border-radius:50%;animation:t 4s infinite}</style><h1>☁ Midnight's Journey ☁</h1><div id=s></div><div class=ld><span id=wl>World 1 • Level 1</span><div class=sb id=ln>Shadow Dance</div></div><div id=hd>?</div><div id=vp><canvas id=g></canvas></div><div class=ct><div class=ct-t>Rotate:Mouse • Zoom:Scroll • Move:WASD/Arrows</div><button id=bh onclick=getHint()>Hint (<span id=hc>3</span>)</button><button onclick=rstLvl()>Reset</button></div><div class=st><div>Moves: <span id=mc>0</span></div><div>Targets: <span id=tc>0/0</span></div></div><div id=gc class=lc style=display:none><h2>Game Complete</h2><p id=gs>All levels!<div style=margin-top:10px;display:flex;gap:10px;justify-content:center><button onclick=rstGame()>Play Again</button></div></div><div id=lc class=lc><h2>Level Complete!</h2><div id=sd style="font-size:2em;margin:15px 0"></div><button onclick=cntToNxtLvl()>Continue</button><button onclick=rtyLvl()>Try Again</button></div><script>let sts={totalMoves:0,levelsCleared:0,startAt:Date.now()},isGameOver=!1;(t=>{const e=new AudioContext,i=()=>"suspended"==e.state&&e.resume();t.sfx={step:()=>{i();const t=e.createOscillator(),s=e.createGain();t.type="triangle",t.connect(s),s.connect(e.destination),t.frequency.value=700,s.gain.setValueAtTime(.045,e.currentTime),t.start(),t.stop(e.currentTime+.035)},target:()=>{i();const t=e.createOscillator(),s=e.createGain();t.type="sine",t.connect(s),s.connect(e.destination),t.frequency.value=440,s.gain.setValueAtTime(.06,e.currentTime),t.start(),t.stop(e.currentTime+.06)}},["pointerdown","keydown"].forEach(t=>document.addEventListener(t,i,{once:1}))})(window),(()=>{class t{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}length(){return Math.hypot(this.x,this.y,this.z)}normalize(){const t=this.length()||1;return this.multiplyScalar(1/t)}clone(){return new t(this.x,this.y,this.z)}}class e{constructor(){this.m=new Float32Array(16),this.identity()}identity(){const t=this.m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,this}multiply(t){const e=this.m,i=t.m,s=new Float32Array(16);for(let t=0;t<4;t++){const n=e[t],a=e[t+4],o=e[t+8],r=e[t+12];s[t]=n*i[0]+a*i[1]+o*i[2]+r*i[3],s[t+4]=n*i[4]+a*i[5]+o*i[6]+r*i[7],s[t+8]=n*i[8]+a*i[9]+o*i[10]+r*i[11],s[t+12]=n*i[12]+a*i[13]+o*i[14]+r*i[15]}return this.m=s,this}static multiply(t,i){const s=new e;return s.m.set(t.m),s.multiply(i)}translate(t,i,s){const n=new e;return n.m[12]=t,n.m[13]=i,n.m[14]=s,this.multiply(n)}scale(t,i,s){const n=new e;return n.m[0]=t,n.m[5]=i,n.m[10]=s,this.multiply(n)}rotateX(t){const i=Math.cos(t),s=Math.sin(t),n=new e;return n.m[5]=i,n.m[6]=s,n.m[9]=-s,n.m[10]=i,this.multiply(n)}rotateY(t){const i=Math.cos(t),s=Math.sin(t),n=new e;return n.m[0]=i,n.m[2]=-s,n.m[8]=s,n.m[10]=i,this.multiply(n)}rotateZ(t){const i=Math.cos(t),s=Math.sin(t),n=new e;return n.m[0]=i,n.m[1]=s,n.m[4]=-s,n.m[5]=i,this.multiply(n)}static perspective(t,i,s,n){const a=1/Math.tan(t*Math.PI/360),o=1/(s-n),r=new e;return r.m[0]=a/i,r.m[5]=a,r.m[10]=(n+s)*o,r.m[11]=-1,r.m[14]=2*n*s*o,r.m[15]=0,r}static lookAt(i,s,n){const a=new t(i.x-s.x,i.y-s.y,i.z-s.z).normalize(),o=new t(n.y*a.z-n.z*a.y,n.z*a.x-n.x*a.z,n.x*a.y-n.y*a.x).normalize(),r=new t(a.y*o.z-a.z*o.y,a.z*o.x-a.x*o.z,a.x*o.y-a.y*o.x),l=(new e).identity().m;return l[0]=o.x,l[4]=o.y,l[8]=o.z,l[12]=-(o.x*i.x+o.y*i.y+o.z*i.z),l[1]=r.x,l[5]=r.y,l[9]=r.z,l[13]=-(r.x*i.x+r.y*i.y+r.z*i.z),l[2]=a.x,l[6]=a.y,l[10]=a.z,l[14]=-(a.x*i.x+a.y*i.y+a.z*i.z),{m:l}}}class i{constructor(){this.position=new t,this.rotation=new t,this.scale=new t(1,1,1),this.children=[],this.parent=null,this.matrixWorld=new e,this.visible=!0}add(t){return t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this}remove(t){return this.children=this.children.filter(e=>e!==t),t.parent=null,this}updateMatrixWorld(t=null){const i=(new e).identity().translate(this.position.x,this.position.y,this.position.z).rotateX(this.rotation.x).rotateY(this.rotation.y).rotateZ(this.rotation.z).scale(this.scale.x,this.scale.y,this.scale.z);this.matrixWorld=t?e.multiply(t,i):i;for(const t of this.children)t.updateMatrixWorld(this.matrixWorld)}}class s{constructor(t,e=null,i=null){this.vertices=new Float32Array(t),this.indices=e?new Uint16Array(e):null,this.normals=i?new Float32Array(i):null,this.mode="triangles",this._gl=null}}class n extends s{constructor(t){const e=t.vertices,i=t.indices,s=new Map;for(let t=0;t<i.length;t+=3){const n=i[t],a=i[t+1],o=i[t+2],r=e[3*n],l=e[3*n+1],h=e[3*n+2],c=e[3*a]-r,d=e[3*a+1]-l,m=e[3*a+2]-h,u=e[3*o]-r,f=e[3*o+1]-l,g=e[3*o+2]-h,y=d*g-m*f,p=m*u-c*g,x=c*f-d*u,b=Math.hypot(y,p,x)||1,v={nx:y/b,ny:p/b,nz:x/b},M=(t,e)=>{const i=Math.min(t,e)<<16|Math.max(t,e),n=s.get(i);n?(n.n2=v,n.count=2):s.set(i,{a:Math.min(t,e),b:Math.max(t,e),n1:v,count:1})};M(n,a),M(a,o),M(o,n)}const n=[];s.forEach(t=>{(1===t.count||t.n1.nx*t.n2.nx+t.n1.ny*t.n2.ny+t.n1.nz*t.n2.nz<.999)&&n.push(t.a,t.b)});const a=[];for(let t=0;t<n.length;t+=2){const i=n[t],s=n[t+1];a.push(e[3*i],e[3*i+1],e[3*i+2],e[3*s],e[3*s+1],e[3*s+2])}super(a,null,null),this.mode="lines"}}class a{constructor({color:t=16777215,ambient:e=.35,diffuse:i=.9,emissive:s=0,emissiveIntensity:n=0,opacity:a=1,transparent:o=!1,depthTest:r=!0,depthWrite:l=!0}={}){this.color=new Float32Array([(t>>16&255)/255,(t>>8&255)/255,(255&t)/255,a]),this.emissive=new Float32Array([(s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1]),this.ambient=e,this.diffuse=i,this.emissiveIntensity=n,this.transparent=o||a<1,this.depthTest=r,this.depthWrite=l}setColor(t){return this.color[0]=(t>>16&255)/255,this.color[1]=(t>>8&255)/255,this.color[2]=(255&t)/255,this}setEmissive(t){return this.emissive[0]=(t>>16&255)/255,this.emissive[1]=(t>>8&255)/255,this.emissive[2]=(255&t)/255,this}}class o extends i{constructor(t,e){super(),this.geometry=t,this.material=e,this.isMesh=!0}}const r={pulseEmissive(t,e=1,i=1){const s=.001*Date.now()*e,n=(.5*Math.sin(s)+.5)*i;t.emissiveIntensity=n}};window.M3D={Vector3:t,Matrix4:e,Object3D:i,Scene:class extends i{constructor(){super(),this.isScene=!0}},PerspectiveCamera:class extends i{constructor(e=60,i=1,s=.1,n=100){super(),this.fov=e,this.aspect=i,this.near=s,this.far=n,this.target=new t,this.up=new t(0,1,0)}lookAt(t,e,i){return this.target.set(t,e,i),this}projectionMatrix(){return e.perspective(this.fov,this.aspect,this.near,this.far)}viewMatrix(){return e.lookAt(this.position,this.target,this.up)}},Geometry:s,BoxGeometry:class extends s{constructor(t=1,e=1,i=1){const s=t/2,n=e/2,a=i/2,o=[s,-n,-a,s,n,-a,s,n,a,s,-n,a,-s,-n,a,-s,n,a,-s,n,-a,-s,-n,-a,-s,n,-a,-s,n,a,s,n,a,s,n,-a,-s,-n,a,-s,-n,-a,s,-n,-a,s,-n,a,-s,-n,a,s,-n,a,s,n,a,-s,n,a,s,-n,-a,-s,-n,-a,-s,n,-a,s,n,-a],r=[];for(let t=0;t<6;t++){const e=4*t;r.push(e,e+1,e+2,e,e+2,e+3)}super(o,r,[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1])}},StarGeometry:class extends s{constructor(t=1,e=.4,i=5,s=.2){const n=[],a=[],o=[],r=2*Math.PI,l=Math.PI/2,h=[];for(let s=0;s<2*i;s++){const n=s/(2*i)*r+l,a=s%2==0?t:e;h.push([Math.cos(n)*a,Math.sin(n)*a])}const c=s/2;let d=0;n.push(0,0,c),o.push(0,0,1);const m=d++,u=[];for(let t=0;t<h.length;t++)n.push(h[t][0],h[t][1],c),o.push(0,0,1),u.push(d++);for(let t=0;t<h.length;t++)a.push(m,u[t],u[(t+1)%h.length]);n.push(0,0,-c),o.push(0,0,-1);const f=d++,g=[];for(let t=0;t<h.length;t++)n.push(h[t][0],h[t][1],-c),o.push(0,0,-1),g.push(d++);for(let t=0;t<h.length;t++)a.push(f,g[(t+1)%h.length],g[t]);for(let t=0;t<h.length;t++){const e=(t+1)%h.length,i=h[e][0]-h[t][0],s=h[e][1]-h[t][1],r=Math.hypot(i,s)||1,l=s/r,m=-i/r,u=d;n.push(h[t][0],h[t][1],c,h[e][0],h[e][1],c,h[t][0],h[t][1],-c,h[e][0],h[e][1],-c);for(let t=0;t<4;t++)o.push(l,m,0);a.push(u,u+2,u+1,u+1,u+2,u+3),d+=4}super(n,a,o)}},EdgesGeometry:n,MeshLambertMaterial:a,MaterialAnimator:r,Mesh:o,WebGLRenderer:class{constructor({canvas:t=null}={}){if(this.canvas=t||document.createElement("canvas"),this.gl=this.canvas.getContext("webgl",{antialias:!0,alpha:!0}),!this.gl)throw new Error("WebGL not supported");this._initGL()}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.gl.viewport(0,0,t,e)}_compile(t,e){const i=this.gl,s=i.createShader(t);if(i.shaderSource(s,e),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS))return s;throw new Error(i.getShaderInfoLog(s))}_link(t,e){const i=this.gl,s=i.createProgram();if(i.attachShader(s,t),i.attachShader(s,e),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS))return s;throw new Error(i.getProgramInfoLog(s))}_initGL(){const t=this.gl,e=this._compile(t.VERTEX_SHADER,"attribute vec3 aPos,aNormal;uniform mat4 uProjection,uView,uModel;varying vec3 vN;void main(){gl_Position=uProjection*uView*uModel*vec4(aPos,1.0);vN=mat3(uModel)*aNormal;}"),i=this._compile(t.FRAGMENT_SHADER,"precision mediump float;uniform vec3 uLightDir;uniform vec4 uColor,uEmissive;uniform float uAmbient,uDiffuse,uEmissiveIntensity,uHemiStrength;uniform vec3 uHemiTop,uHemiBottom;varying vec3 vN;void main(){vec3 N=normalize(vN);float l=max(dot(N,normalize(uLightDir)),0.0),h=clamp(0.5*N.y+0.5,0.0,1.0);vec3 b=uColor.rgb*(uAmbient+uDiffuse*l),hemi=mix(uHemiBottom,uHemiTop,h),lit=b*mix(vec3(1.0),hemi,uHemiStrength),em=uEmissive.rgb*uEmissiveIntensity;gl_FragColor=vec4(lit+em,uColor.a);}");this.p=this._link(e,i),this.l={aPos:t.getAttribLocation(this.p,"aPos"),aNormal:t.getAttribLocation(this.p,"aNormal"),uProjection:t.getUniformLocation(this.p,"uProjection"),uView:t.getUniformLocation(this.p,"uView"),uModel:t.getUniformLocation(this.p,"uModel"),uColor:t.getUniformLocation(this.p,"uColor"),uEmissive:t.getUniformLocation(this.p,"uEmissive"),uLightDir:t.getUniformLocation(this.p,"uLightDir"),uAmbient:t.getUniformLocation(this.p,"uAmbient"),uDiffuse:t.getUniformLocation(this.p,"uDiffuse"),uEmissiveIntensity:t.getUniformLocation(this.p,"uEmissiveIntensity"),uHemiTop:t.getUniformLocation(this.p,"uHemiTop"),uHemiBottom:t.getUniformLocation(this.p,"uHemiBottom"),uHemiStrength:t.getUniformLocation(this.p,"uHemiStrength")},t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.clearColor(0,0,0,0)}_prepareGeometry(t){const e=this.gl;if(!t._gl){const i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t.vertices,e.STATIC_DRAW);let s=null,n=null,a=0,o=0;t.normals&&(s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,t.normals,e.STATIC_DRAW)),t.indices?(n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW),a=t.indices.length):o=t.vertices.length/3,t._gl={vbo:i,nbo:s,ibo:n,idxCount:a,arrCount:o,isLines:"lines"===t.mode}}}render(t,e,i=[.6,1,.5],s=[1,1,1],n=[.5,.7,1],o=0){const r=this.gl;e.aspect=(this.canvas.width||1)/(this.canvas.height||1),t.updateMatrixWorld(null),r.viewport(0,0,this.canvas.width,this.canvas.height),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const l=[],h=[];!function t(e){e.isMesh&&e.visible&&("lines"===e.geometry.mode?h:l).push(e);for(const i of e.children)t(i)}(t);const c=e.projectionMatrix().m,d=e.viewMatrix().m;r.useProgram(this.p),r.uniformMatrix4fv(this.l.uProjection,!1,c),r.uniformMatrix4fv(this.l.uView,!1,d),r.uniform3fv(this.l.uLightDir,new Float32Array(i)),r.uniform3fv(this.l.uHemiTop,new Float32Array(s)),r.uniform3fv(this.l.uHemiBottom,new Float32Array(n)),r.uniform1f(this.l.uHemiStrength,o);for(const t of l){const e=t.geometry;this._prepareGeometry(e);const i=e._gl;r.bindBuffer(r.ARRAY_BUFFER,i.vbo),r.vertexAttribPointer(this.l.aPos,3,r.FLOAT,!1,12,0),r.enableVertexAttribArray(this.l.aPos),i.nbo?(r.bindBuffer(r.ARRAY_BUFFER,i.nbo),r.vertexAttribPointer(this.l.aNormal,3,r.FLOAT,!1,12,0),r.enableVertexAttribArray(this.l.aNormal)):this.l.aNormal>=0&&r.disableVertexAttribArray(this.l.aNormal),r.uniformMatrix4fv(this.l.uModel,!1,t.matrixWorld.m);const s=t.material||new a;s.transparent?(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)):r.disable(r.BLEND),!1!==s.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(!1!==s.depthWrite),r.uniform4fv(this.l.uColor,s.color),r.uniform4fv(this.l.uEmissive,s.emissive||new Float32Array([0,0,0,1])),r.uniform1f(this.l.uAmbient,s.ambient),r.uniform1f(this.l.uDiffuse,s.diffuse),r.uniform1f(this.l.uEmissiveIntensity,s.emissiveIntensity||0),i.ibo?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.ibo),r.drawElements(r.TRIANGLES,i.idxCount,r.UNSIGNED_SHORT,0)):(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),r.drawArrays(r.TRIANGLES,0,i.arrCount))}r.disable(r.CULL_FACE),r.useProgram(this.p),this.l.aNormal>=0&&r.disableVertexAttribArray(this.l.aNormal);for(const t of h){const e=t.geometry;this._prepareGeometry(e);const i=e._gl;r.uniformMatrix4fv(this.l.uModel,!1,t.matrixWorld.m),r.uniform4fv(this.l.uColor,t.material?t.material.color:new Float32Array([1,1,1,1])),r.uniform4fv(this.l.uEmissive,new Float32Array([0,0,0,1])),r.uniform1f(this.l.uAmbient,1),r.uniform1f(this.l.uDiffuse,0),r.uniform1f(this.l.uEmissiveIntensity,0),r.bindBuffer(r.ARRAY_BUFFER,i.vbo),r.vertexAttribPointer(this.l.aPos,3,r.FLOAT,!1,12,0),r.enableVertexAttribArray(this.l.aPos),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),r.drawArrays(r.LINES,0,i.arrCount)}r.enable(r.CULL_FACE),r.disable(r.BLEND),r.depthMask(!0),r.enable(r.DEPTH_TEST)}},a0:function(t,e=16777215,i=1.001){const s=new o(new n(t.geometry),new a({color:e,depthWrite:!1}));return s.scale.set(t.scale.x*i,t.scale.y*i,t.scale.z*i),t.add(s),s},OrbitControls:class{constructor(t,e){this.camera=t,this.dom=e,this.target=t.target.clone();const i=t.position.clone().sub(this.target);this.radius=i.length(),this.theta=Math.atan2(i.x,i.z),this.phi=Math.acos(Math.min(Math.max(i.y/this.radius,-1),1)),this.minRadius=2,this.maxRadius=30,this.minPhi=.05,this.maxPhi=Math.PI-.05,this.rotateSpeed=1,this.zoomSpeed=1,this._initEvents(),this.update()}_initEvents(){const e=this.dom;let i=!1,s="rotate",n=0,a=0,o=t=>t.touches?{x:t.touches[0].clientX,y:t.touches[0].clientY}:{x:t.clientX,y:t.clientY};e.addEventListener("mousedown",t=>{i=!0;const e=o(t);n=e.x,a=e.y,s=2===t.button||t.shiftKey?"pan":"rotate",t.preventDefault()}),window.addEventListener("mousemove",e=>{if(i){const i=o(e),r=i.x-n,l=i.y-a;if(n=i.x,a=i.y,"rotate"===s)this.theta-=.005*r*this.rotateSpeed,this.phi-=.005*l*this.rotateSpeed,this.phi=Math.max(this.minPhi,Math.min(this.maxPhi,this.phi));else{const e=-.002*r*this.radius,i=.002*l*this.radius,s=Math.sin(this.theta),n=Math.cos(this.theta),a=new t(n,0,-s),o=new t(0,1,0);this.target.add(a.multiplyScalar(e).add(o.multiplyScalar(i)))}this.update()}}),window.addEventListener("mouseup",()=>{i=!1}),e.addEventListener("contextmenu",t=>t.preventDefault()),e.addEventListener("wheel",t=>{const e=Math.exp(-.001*t.deltaY*this.zoomSpeed);this.radius*=e,this.radius=Math.max(this.minRadius,Math.min(this.maxRadius,this.radius)),this.update()},{passive:!0}),e.addEventListener("touchstart",t=>{1===t.touches.length&&(i=!0,s="rotate",n=t.touches[0].clientX,a=t.touches[0].clientY)},{passive:!1}),e.addEventListener("touchmove",t=>{if(i&&1===t.touches.length&&"rotate"===s){const e=t.touches[0],i=e.clientX-n,s=e.clientY-a;n=e.clientX,a=e.clientY,this.theta-=.005*i*this.rotateSpeed,this.phi-=.005*s*this.rotateSpeed,this.phi=Math.max(this.minPhi,Math.min(this.maxPhi,this.phi)),this.update()}},{passive:!1}),e.addEventListener("touchend",()=>{i=!1})}update(){const e=Math.sin(this.phi),i=Math.cos(this.phi),s=Math.sin(this.theta),n=Math.cos(this.theta),a=new t(this.target.x+this.radius*e*s,this.target.y+this.radius*i,this.target.z+this.radius*e*n);this.camera.position.copy(a),this.camera.lookAt(this.target.x,this.target.y,this.target.z)}}}})();class Cat extends M3D.Object3D{constructor(t={}){super(),this.baseY=t.baseY||0,this.scale.set(.3,.3,.3),this._yaw=0,this._targetYaw=null,this._buildCat()}_buildCat(){const{BoxGeometry:t,MeshLambertMaterial:e,Mesh:i}=M3D,s=new t(2.5,2.5,2.5),n=new t(.5,.5,.1),a=new t(.3,.3,.2),o=new t(1,.5,.2),r=new t(.25,.25,.25),l=new t(.5,.5,.5),h=new t(.6,.8,.4),c=new t(.4,.4,.4),d=new t(.4,1.8,.4),m=new t(.5,.2,.5),u=new e({color:0,ambient:.4,diffuse:.8}),f=new e({color:16771116,ambient:.8,diffuse:.4}),g=new e({color:0,ambient:.8,diffuse:.4}),y=new e({color:16777215,ambient:.8,diffuse:.4}),p=new e({color:1710618,ambient:.5,diffuse:.7}),x=new i(s,u);x.position.set(0,1.25,0),this.add(x),M3D.a0(x,0,1.002);for(let[t,e]of[[-.5,-1.25],[.5,-1.225]]){let s=new i(n,f);s.position.set(t,1.5,e),this.add(s);let o=new i(a,g);o.position.set(t,1.5,-1.25),this.add(o)}let b=new i(o,y);b.position.set(.06,.95,-1.225),this.add(b),b=new i(r,u),b.position.set(.06,1.05,-1.4),this.add(b),b=new i(l,u),b.position.set(0,1.4,1.4),this.add(b);for(let[t,e]of[[-.9,-1.002],[.9,-1.002]]){let s=new i(h,u);s.position.set(t,2.6,e),this.add(s),M3D.a0(s,0,1.002);let n=new i(c,y);n.position.set(t,2.7,e-.001),this.add(n),M3D.a0(n,0,1.002)}for(let[t,e]of[[-.7,-.8],[.7,-.8],[-.7,.8],[.7,.8]]){let s=new i(d,u);s.position.set(t,.9,e),this.add(s),M3D.a0(s,0,1.002);let n=new i(m,p);n.position.set(t,.1,e),this.add(n),M3D.a0(n,0,1.002)}}setFacing(t){const e={N:0,E:-Math.PI/2,S:Math.PI,W:Math.PI/2}[t.toUpperCase()];void 0!==e&&(this._targetYaw=e)}faceStep(t,e){const i=1===t&&0===e?-Math.PI/2:-1===t&&0===e?Math.PI/2:0===t&&1===e?Math.PI:0===t&&-1===e?0:null;null!==i&&(this._targetYaw=i)}update(t){if(null===this._targetYaw)return;let e=this._targetYaw-this._yaw;for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;const i=Math.sign(e)*Math.min(Math.abs(e),8*t);for(this._yaw+=i;this._yaw>Math.PI;)this._yaw-=2*Math.PI;for(;this._yaw<-Math.PI;)this._yaw+=2*Math.PI;this.rotation.y=this._yaw,Math.abs(e)<.01&&(this._yaw=this._targetYaw,this.rotation.y=this._yaw,this._targetYaw=null)}}const W=[{n:"Feather Isles",l:[{m:["11111","14321","11111"]},{m:["1111100","1000111","1003001","1150201","0100041","0111111"]},{m:["00111110","11100010","10301011","10100201","10000101","11010001","01400111","01111100"]},{m:["00001111","11111001","10003001","10021001","11011011","10000001","10410001","10011111","11110000"]}]},{n:"Crescent Cloud",l:[{m:["111110","120011","143301","110001","011001","001121","000111"]},{m:["1111100","1000110","1010011","1201301","1004001","1211311","1000010","1111110"]},{m:["1111000","1001111","1020201","1033141","1100001","0111111"]},{m:["1111000","1001110","1000011","1021301","1104001","0121311","0100010","0111110"]}]},{n:"Glimmer Aeries",l:[{m:["00011110","11110010","10300010","10021011","11012001","10400301","10001111","11111000"]},{m:["1111111","1000001","1010101","1203541","1000111","1111100"]},{m:["1111100","1000100","1040100","1033111","1120201","0100001","0111111"]},{m:["00111110","11100010","10301011","10100201","10000101","11312001","01400111","01111100"]}]},{n:"Starforge Valley",l:[{m:["11110000","10011100","10000111","10035401","11102101","00100001","00111111"]},{m:["01111100","01000100","11310111","10003401","10100101","10120201","10001111","11111000"]},{m:["1111111","1005001","1000001","1101011","0134210","0100010","0111110"]},{m:["01111100","01000110","11013011","10300001","12021001","11104011","00101010","00100010","00111110"]}]}],P=[{g:"4B7B68|365C4F",p:"E2EAD9|C0C7B9",G:"ADB5A8|8B9187",t:"386957|2A4E3F",T:"32433C|26312E",b:"9BB589|7D9170",a:"F2E38F|D5C86F",d:"linear-gradient(180deg, #B8FFD7 0%, #4B967E 30%, #0B1714 100%), radial-gradient(750px 370px at 40% 22%, rgba(140,255,200,0.08), transparent 68%)"},{g:"3F6578|2B4653",p:"D9E1EA|B6BBC0",G:"9DA9B4|7B838C",t:"345064|243844",T:"29363F|1A2228",b:"5CC5FF|3B99C7",a:"E4D27F|C4B15F",d:"linear-gradient(180deg, #D6F4FF 0%, #3E7D94 35%, #07121A 100%), radial-gradient(900px 450px at 50% 12%, rgba(140,210,255,0.10), transparent 75%)"},{g:"536D92|3A4E69",p:"E0DDF6|BCBAD3",G:"B1ADCA|8D89A7",t:"42567A|2E3E56",T:"343E4F|242C38",b:"C177FF|9C5DD4",a:"F6E983|D4C865",d:"linear-gradient(180deg, #D2E8FF 0%, #6F80C2 40%, #0A101F 100%), radial-gradient(850px 400px at 60% 15%, rgba(190,150,255,0.10), transparent 70%)"},{g:"7F6C56|5A4B3B",p:"F0E3CA|CBBDA8",G:"BFAF97|9B8D77",t:"66533E|4B3D2D",T:"4B382B|34251E",b:"FF8736|D16C29",a:"FFE47F|DCC562",d:"linear-gradient(180deg, #FFD7A3 0%, #AD7842 35%, #0D0A06 100%), radial-gradient(900px 420px at 55% 12%, rgba(255,180,100,0.14), transparent 65%)"}],{Scene:Scene,PerspectiveCamera:PerspectiveCamera,WebGLRenderer:WebGLRenderer,Mesh:Mesh,BoxGeometry:BoxGeometry,MeshLambertMaterial:MeshLambertMaterial,a0:a0,OrbitControls:OrbitControls,Object3D:Object3D,StarGeometry:StarGeometry,EdgesGeometry:EdgesGeometry,MaterialAnimator:MaterialAnimator}=M3D,canvas=document.getElementById("g"),renderer=new WebGLRenderer({canvas:canvas}),scene=new Scene,cam=new PerspectiveCamera(45,1,.1,100);cam.position.set(6,8,9),cam.lookAt(0,.8,0);const controls=new OrbitControls(cam,canvas);controls.minRadius=4,controls.maxRadius=30;const C={floor:3227981,rim:2767172,box:3064785,boxOK:16766287,grass:5025616},G={unit:new BoxGeometry(1,1,1),tile:new BoxGeometry(1,.06,1)};let cL=0,moves=0,catX=1,catY=1,gO=[],isMoving=!1,cW=0,gridW=0,gridH=0,halfX=0,halfZ=0,hintsThisLevel=3,hintTimeout=0,solutionPath=null;const root=new Object3D;scene.add(root);const byId=new Map,tilesByCell=new Map,toWorldX=t=>t-halfX,toWorldZ=t=>t-halfZ,cellKey=(t,e)=>`${t},${e}`,x=(t,e=t.indexOf("|"))=>e>0?[parseInt(t.slice(0,e),16),parseInt(t.slice(e+1),16)]:[parseInt(t,16),parseInt(t,16)],clrHint=()=>{document.getElementById("hd").style.display="none",clearTimeout(hintTimeout)};function a1(t,e,i={}){const{canopyScale:s=.78,trunkScale:n=.22,canopyTallRange:a=[.85,1.7]}=i,o=toWorldX(t),r=toWorldZ(e),l=new M3D.BoxGeometry(n,.6,n),h=new M3D.MeshLambertMaterial({color:C.trunk,ambient:.4,diffuse:.9}),c=new M3D.Mesh(l,h);c.position.set(o,.3,r),root.add(c),M3D.a0(c,C.trunkEdge,1.002);const d=a[0]+Math.random()*(a[1]-a[0]),m=new M3D.BoxGeometry(s,.8*d,s),u=new M3D.MeshLambertMaterial({color:C.tree,ambient:.5,diffuse:.8}),f=new M3D.Mesh(m,u);f.position.set(o,.6+.8*d/2,r),root.add(f),M3D.a0(f,C.treeEdge,1.001)}function a5(t){const e=t.m.length,i=Math.max(...t.m.map(t=>t.length));let s=i,n=-1,a=e,o=-1;for(let r=0;r<e;r++){const e=t.m[r]||"";for(let t=0;t<i;t++){const i=e[t];i&&" "!==i&&(s=Math.min(s,t),n=Math.max(n,t),a=Math.min(a,r),o=Math.max(o,r))}}const r=n-s+1+.2,l=o-a+1+.2,h=(s+n)/2-halfX,c=(a+o)/2-halfZ,d=new M3D.BoxGeometry(r,1.8,l),m=new M3D.MeshLambertMaterial({color:C.ground,ambient:.45,diffuse:.85}),u=new M3D.Mesh(d,m);return u.position.set(h,-.901,c),root.add(u),M3D.a0(u,C.groundEdge,1.002),u}function a7(){const t=Math.min(2,window.devicePixelRatio||1),e=Math.round(canvas.clientWidth*t),i=Math.round(canvas.clientHeight*t);canvas.width===e&&canvas.height===i||(canvas.width=e,canvas.height=i,renderer.setSize(e,i))}function a12(){gO=[],moves=0;const t=W[cW].l[cL];hintsThisLevel=3,document.getElementById("hc").textContent=hintsThisLevel,document.getElementById("bh").disabled=!1,document.getElementById("mc").textContent=moves,a21(),clrHint(),Board3D.clear(),gridH=t.m.length,gridW=Math.max(...t.m.map(t=>t.length)),halfX=gridW/2-.5,halfZ=gridH/2-.5,a5(t);for(let e=0;e<gridH;e++){const i=t.m[e]||"";for(let s=0;s<gridW;s++){const n=s<i.length?i[s]:" ",a=toWorldX(s),o=toWorldZ(e);if(" "!==n)switch(n){case"0":if(Board3D.addTile(`t_${s}_${e}`,a,o,!1,C.pathEdge),a15(s,e,t)){const t=tilesByCell.get(cellKey(a,o));if(t){t.material=new MeshLambertMaterial({color:C.grass,ambient:.45,diffuse:.85});const e=t.children.find(t=>t.material&&1===t.material.ambient);e&&(e.material.color=new Float32Array([(C.grassEdge>>16&255)/255,(C.grassEdge>>8&255)/255,(255&C.grassEdge)/255,1]))}}else{const t=tilesByCell.get(cellKey(a,o));t&&(t.material=new MeshLambertMaterial({color:C.path,ambient:.45,diffuse:.85}))}break;case"1":if(Board3D.addTile(`t_${s}_${e}`,a,o,!1,"1"===n?C.grassEdge:C.pathEdge),"1"===n){const t=tilesByCell.get(cellKey(a,o));t&&(t.material=new MeshLambertMaterial({color:C.grass,ambient:.45,diffuse:.85}))}Math.random()<.1&&a1(s,e);break;case"2":Board3D.addTile(`t_${s}_${e}`,a,o,!1,C.targetEdge),Board3D.addGlow(`g_${s}_${e}`,a,o),gO.push({type:"target",x:s,y:e});break;case"3":Board3D.addTile(`t_${s}_${e}`,a,o,!1,C.pathEdge),Board3D.addBox(`box_${s}_${e}`,a,o),gO.push({type:"box",x:s,y:e,id:`box_${s}_${e}`});break;case"4":Board3D.addTile(`t_${s}_${e}`,a,o,!1,C.pathEdge),catX=s,catY=e,Board3D.addCat("cat",a,o),Board3D.setCatFacing("S");break;case"5":Board3D.addTile(`t_${s}_${e}`,a,o,!1,C.targetEdge),Board3D.addGlow(`g_${s}_${e}`,a,o),gO.push({type:"target",x:s,y:e}),Board3D.addBox(`box_${s}_${e}`,a,o,!0),gO.push({type:"box",x:s,y:e,id:`box_${s}_${e}`,onTarget:!0})}}}a18(),a22()}function a15(t,e,i){const s=i.m,n=s.length,a=Math.max(...s.map(t=>t.length));if(0===e||e===n-1)return!0;if(0===t||t===a-1)return!0;const o=[[-1,0],[1,0],[0,-1],[0,1]];for(const[i,n]of o){const a=t+i,o=(s[e+n]||"")[a];if(void 0===o||" "===o)return!0}return!1}function a18(){const t=W[cW].l[cL],e=t.m.length,i=Math.max(...t.m.map(t=>t.length));let s=i,n=-1,a=e,o=-1;for(let r=0;r<e;r++){const e=t.m[r]||"";for(let t=0;t<i;t++)e[t]&&" "!==e[t]&&(s=Math.min(s,t),n=Math.max(n,t),a=Math.min(a,r),o=Math.max(o,r))}const r=(s+n)/2-halfX,l=(a+o)/2-halfZ,h=Math.max(n-s+1,o-a+1);controls.target.set(r,-.9,l),controls.minRadius=Math.max(3,.9*h),controls.maxRadius=Math.max(15,4*h),controls.radius=Math.min(controls.maxRadius,Math.max(controls.minRadius,2.2*h)),controls.theta=Math.PI/4.5,controls.phi=Math.PI/3.2,controls.update()}function a21(){const t=W[cW].n,e=cL+1;document.getElementById("wl").textContent=`${t}`,document.getElementById("ln").textContent=`Level ${e}`}function a10(t,e){const i=W[cW].l[cL];if(e<0||e>=i.m.length)return"0";const s=i.m[e]||"";return t<0||t>=s.length?"0":s[t]||"0"}function a3(t,e){const i=a10(t,e);return"1"!==i&&" "!==i}function a9(t,e){return gO.find(i=>"box"===i.type&&i.x===t&&i.y===e)}function a20(t,e){if(clrHint(),isMoving)return;const i=catX+t,s=catY+e;if(!a3(i,s))return;Board3D.faceCat(t,e);const n=a9(i,s);if(sfx.step(),n){const a=n.x+t,o=n.y+e;if(!a3(a,o)||a9(a,o))return;isMoving=!0,n.x=a,n.y=o,Board3D.moveTo(n.id,toWorldX(a),toWorldZ(o));const r=gO.find(t=>"target"===t.type&&t.x===a&&t.y===o);n.onTarget=!!r,Board3D.rcBx(n.id,n.onTarget),setTimeout(()=>{catX=i,catY=s,Board3D.moveTo("cat",toWorldX(i),toWorldZ(s)),moves++,document.getElementById("mc").textContent=moves,a22(),isMoving=!1,solutionPath&&solutionPath[0]?.dx===t&&solutionPath[0]?.dy===e?solutionPath.shift():solutionPath=null},100)}else isMoving=!0,catX=i,catY=s,Board3D.moveTo("cat",toWorldX(i),toWorldZ(s)),moves++,document.getElementById("mc").textContent=moves,setTimeout(()=>{isMoving=!1,solutionPath&&solutionPath[0]?.dx===t&&solutionPath[0]?.dy===e?solutionPath.shift():solutionPath=null},100)}function a22(){const t=gO.filter(t=>"target"===t.type).length,e=gO.filter(t=>"box"===t.type&&t.onTarget).length;document.getElementById("tc").textContent=`${e}/${t}`,e===t&&t>0&&setTimeout(a11,1e3)}function getHint(){if(hintsThisLevel<=0)return void a19("No more hints. Try reset.",3e3);if(solutionPath=a6(),!solutionPath||!solutionPath.length)return void a19("Can't find path. Try moving.",2800);hintsThisLevel--,document.getElementById("hc").textContent=hintsThisLevel,hintsThisLevel<=0&&(document.getElementById("bh").disabled=!0);const t=solutionPath[0];let e=a9(catX+t.dx,catY+t.dy)?"Push box ":"Move ";e+=t.dx>0?"right":t.dx<0?"left":t.dy>0?"down":"up",a19(e,4e3)}function a19(t,e){const i=document.getElementById("hd");i&&(i.textContent=t,i.style.display="block",clearTimeout(hintTimeout),hintTimeout=setTimeout(()=>i.style.display="none",e))}function a6(){const t=gO.filter(t=>"target"===t.type),e=gO.filter(t=>"box"===t.type),i=[{catX:catX,catY:catY,boxes:e.map(t=>({x:t.x,y:t.y})),moves:[]}],s=new Set;let n=0;const a=t=>`${t.catX},${t.catY}:${t.boxes.map(t=>`${t.x},${t.y}`).sort().join("|")}`,o=e=>t.every(t=>e.boxes.some(e=>e.x===t.x&&e.y===t.y));for(;i.length&&n++<8e3;){const t=i.shift(),e=a(t);if(s.has(e))continue;if(s.add(e),o(t))return t.moves;const n=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(const e of n){const s=t.catX+e.dx,n=t.catY+e.dy,a=t.boxes.findIndex(t=>t.x===s&&t.y===n);if(-1!==a){const o=s+e.dx,r=n+e.dy,l=a10(o,r);if("1"===l||" "===l||t.boxes.some(t=>t.x===o&&t.y===r))continue;const h=t.boxes.map((t,e)=>e===a?{x:o,y:r}:{x:t.x,y:t.y});i.push({catX:s,catY:n,boxes:h,moves:t.moves.concat({dx:e.dx,dy:e.dy})})}else{const a=a10(s,n);if("1"===a||" "===a||t.boxes.some(t=>t.x===s&&t.y===n))continue;i.push({catX:s,catY:n,boxes:t.boxes.map(t=>({x:t.x,y:t.y})),moves:t.moves.concat({dx:e.dx,dy:e.dy})})}}}return null}function a11(){clrHint();const t=gO.filter(t=>"target"===t.type).length,e=Math.max(6,5*t),i=3-hintsThisLevel>0?1:moves<=e?3:moves<=1.25*e?2:1;if(sts.totalMoves+=moves,sts.levelsCleared+=1,a13()&&a14())return setTimeout(()=>{s.style.display="none",a8()},2e3),void sfx.target();document.getElementById("sd").innerHTML="★".repeat(i)+"☆".repeat(3-i),document.getElementById("sd").style.color="#FFD700";const s=document.getElementById("lc");s&&(s.style.display="block",document.getElementById("bh").disabled=!0,document.querySelector('button[onclick="rstLvl()"]').disabled=!0,setTimeout(()=>s.querySelector("button").focus(),100)),sfx.target()}function rtyLvl(){document.getElementById("lc").style.display="none",document.getElementById("bh").disabled=hintsThisLevel<=0,document.querySelector('button[onclick="rstLvl()"]').disabled=!1,rstLvl()}function rstLvl(){clrHint(),document.getElementById("lc").style.display="none",solutionPath=null,hintsThisLevel=3,document.getElementById("hc").textContent=hintsThisLevel,document.getElementById("bh").disabled=!1,a12()}function a2(t){const e=P[t]||P[0];[C.grass,C.grassEdge]=x(e.g),[C.ground,C.groundEdge]=x(e.G),[C.path,C.pathEdge]=x(e.p),[C.tree,C.treeEdge]=x(e.t),[C.trunk,C.trunkEdge]=x(e.T),[C.box,C.boxEdge]=x(e.b),[C.target,C.targetEdge]=x(e.a),C.gradient=e.d,document.body.style.background=C.gradient}function a13(){return cL>=W[cW].l.length-1}function a14(){return cW>=W.length-1}function a8(){isGameOver=!0;try{sfx.target()}catch(t){}const t=Math.max(0,Date.now()-sts.startAt),e=Math.floor(t/6e4),i=String(Math.floor(t%6e4/1e3)).padStart(2,"0"),s=`Cleared ${sts.levelsCleared} levels • ${sts.totalMoves} moves • ${e}:${i}`,n=document.getElementById("gs");n&&(n.textContent=s);const a=document.getElementById("gc");a&&(a.style.display="block",setTimeout(()=>a.querySelector("button").focus(),100))}function rstGame(){const t=document.getElementById("gc");t&&(t.style.display="none"),isGameOver=!1,cW=0,cL=0,sts={totalMoves:0,levelsCleared:0,startAt:Date.now()},hintsThisLevel=3,document.getElementById("hc").textContent=hintsThisLevel,document.getElementById("bh").disabled=!1,a2(0),a12()}function cntToNxtLvl(){document.getElementById("lc").style.display="none",document.getElementById("bh").disabled=!1,document.querySelector('button[onclick="rstLvl()"]').disabled=!1,sts.totalMoves+=moves,sts.levelsCleared+=1;let t=cW,e=cL+1;e>=W[cW].l.length&&(t++,e=0,t>=W.length)?a8():(cW=t,cL=e,a2(cW),a12())}function cs(){let t=document.getElementById("s");for(let e=0;e<150;e++){let e=document.createElement("div");e.className="star",e.style.width=e.style.height="2px",e.style.left=100*Math.random()+"%",e.style.top=100*Math.random()+"%",e.style.animationDelay=4*Math.random()+"s",t.appendChild(e)}}window.Board3D={clear(){for(const t of[...root.children])root.remove(t);byId.clear(),tilesByCell.clear()},addTile(t,e,i,s=!1,n=16777215){const a=new Mesh(G.tile,new MeshLambertMaterial({color:s?C.rim:C.path,ambient:.45,diffuse:.85}));a.position.set(e,-.03,i),root.add(a);const o=a0(a,n,1);o.material.ambient=1,o.material.diffuse=0,byId.set(t,{kind:"tile",mesh:a}),tilesByCell.set(cellKey(e,i),a)},addGlow(t,e,i){const s=tilesByCell.get(cellKey(e,i));s&&(s.material=new MeshLambertMaterial({color:C.target,ambient:.55,diffuse:.9}))},addBox(t,e,i,s=!1){const n=new Object3D,a=new EdgesGeometry(G.unit),o=new MeshLambertMaterial({color:16777215,emissive:4473924,emissiveIntensity:.1,opacity:.9,transparent:!0,ambient:1,diffuse:0,depthWrite:!1}),r=new Mesh(a,o);r.scale.set(.8,.8,.8),r.position.set(0,.4,0);const l=new StarGeometry(.28,.112,5,.2),h=s?C.boxOK:C.box,c=new MeshLambertMaterial({color:h,emissive:h,emissiveIntensity:.3,opacity:.95,transparent:!0,ambient:.7,diffuse:.5}),d=new Mesh(l,c);d.position.set(0,.42,0),d._pulseSpeed=1.5,d._basePulse=.4,n.add(r),n.add(d),n.position.set(e,0,i),root.add(n),byId.set(t,{kind:"box",mesh:n})},addCat(t,e,i){const s=new Cat({baseY:.01});s.position.set(e,0,i),root.add(s),byId.set(t,{kind:"cat",mesh:s}),this._cat=s},moveTo(t,e,i){const s=byId.get(t);s&&s.mesh.position.set(e,s.mesh.position.y,i)},rcBx(t,e){const i=byId.get(t);if(!i||"box"!==i.kind)return;const s=i.mesh.children[1];if(s&&s.material){const t=e?C.boxOK:C.box;s.material.setColor(t),s.material.setEmissive(t)}},faceCat(t,e){this._cat?.faceStep?.(t,e)},setCatFacing(t){this._cat?.setFacing?.(t)},update(t){this._cat?.update?.(t),byId.forEach(t=>{if("box"===t.kind){const e=t.mesh.children[1];e&&e._pulseSpeed&&MaterialAnimator.pulseEmissive(e.material,e._pulseSpeed,e._basePulse)}})}},new ResizeObserver(a7).observe(canvas),a7(),window.addEventListener("resize",a7),cs(),document.addEventListener("keydown",t=>{if(!isMoving){switch(t.code){case"ArrowUp":case"KeyW":a20(0,-1);break;case"ArrowDown":case"KeyS":a20(0,1);break;case"ArrowLeft":case"KeyA":a20(-1,0);break;case"ArrowRight":case"KeyD":a20(1,0)}t.preventDefault()}});let t0=performance.now();!function t(e){const i=(e-t0)/1e3;t0=e,Board3D.update?.(i),renderer.render(scene,cam,[.6,1,.5]),requestAnimationFrame(t)}(t0),window.addEventListener("DOMContentLoaded",()=>{a2(0),a12()}),"loading"!==document.readyState&&(a2(0),a12())</script>