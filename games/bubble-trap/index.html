<!doctype html><head><title>Bubble Trap - js13kGames 2016</title><script>var f=this&&this.zd||function(t,i){function h(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(h.prototype=i.prototype,new h)},n=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.La=!1,this.name="Go",this.z=0,this.oc=!0,this.x=t,this.y=i}return Object.defineProperty(t.prototype,"active",{get:function(){return this.oc},set:function(t){this.oc=t,this.La&&this.eb(t)},enumerable:!0,configurable:!0}),t.prototype.pa=function(){},t.prototype.Y=function(){},t.prototype.N=function(){},t.prototype.eb=function(){},t}(),p=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.cc=function(){return new t(this.x,this.y)},t.prototype.gc=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.Xc=function(){return this.x*this.x+this.y*this.y},t.prototype.Cb=function(t){return this.x*t.x+this.y*t.y},t.prototype.Set=function(t,i){this.x=t,this.y=i},t.prototype.Eb=function(t){return this.x*=t,this.y*=t,this},t.prototype.nb=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.Qa=function(){var t=this.gc();return 0==t||(this.x/=t,this.y/=t),this},t.prototype.lc=function(t,i,h){void 0===i&&(i=0),void 0===h&&(h=0);var s=t*Math.PI/180;t=Math.cos(s);s=Math.sin(s);var e=(this.x-i)*s+(this.y-h)*t+h;this.x=(this.x-i)*t-(this.y-h)*s+i,this.y=e},t}(),aa=function(i){function h(t,s,e,a){void 0===t&&(t=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===a&&(a=-1),i.call(this,t,s),this.Aa=h.ra,this.ab=h.$a,this.Ec=this.Dc=1,this.zb=0,this.z=q,this.name="bbl",this.Set(t,s,e,a)}return f(h,i),h.prototype.Set=function(i,h,s,e){void 0===e&&(e=-1),this.x=i,this.y=h,this.K=s,this.qa=s/100,this.Aa=0,this.A=-1==e?t(v,w.length):e},h.prototype.bd=function(t){if((h=x(this.x,this.y,t.x,t.y))<Math.pow(.9*this.K+.9*t.K,2)){var i=new p(this.x-t.x,this.y-t.y).Qa(),h=Math.sqrt(h);return i.x*=.9*this.K+.9*t.K-h,i.y*=.9*this.K+.9*t.K-h,i}return null},h.prototype.cd=function(t){var i=new p(t.D-t.B,t.F-t.C).Qa(),h=t.ec(),s=new p(this.x-t.B,this.y-t.C).Cb(i);i=new p(i.x*s,i.y*s);return t=0>s?new p(t.B,t.C):s>h?new p(t.D,t.F):new p(t.B+i.x,t.C+i.y),(h=(t=new p(this.x-t.x,this.y-t.y)).Xc())<this.K*this.K?t.Qa().Eb(this.K-Math.sqrt(h)):null},h.prototype.Nc=function(t){var i=this.bd(t);if(null!==i){this.x+=i.x/2,this.y+=i.y/2,t.x-=i.x/2,t.y-=i.y/2,(i=new p(t.x-this.x,t.y-this.y).Qa()).y=-i.y;var s=2*(this.M.Cb(i)-t.M.Cb(i))/(this.qa+t.qa);this.M.Set(this.M.x-s*t.qa*i.x,this.M.y-s*t.qa*i.y),t.M.Set(t.M.x+s*this.qa*i.x,t.M.y+s*this.qa*i.y),i=this.K>t.K?this.K:t.K,this.Jb(h.ra+2*h.ra*t.K/i,2*h.$a*this.K/i),t.Jb(h.ra+2*h.ra*this.K/i,2*h.$a*t.K/i)}},h.prototype.Jb=function(t,i){this.Aa=t,this.ab=i,this.wd=t-h.ra,this.xd=i-h.$a},h.prototype.Y=function(s){i.prototype.Y.call(this,s),this.y<-this.K?this.e.Gb(this,!1,!1):(this.zb+=2*Math.PI*s*this.Aa,this.Dc=1+this.ab*Math.sin(.8*this.zb),this.Ec=1+.6*this.ab*Math.cos(this.zb),this.Aa>h.ra&&(this.Aa-=this.wd/t(2,3)*s,this.ab-=this.xd/3*s,this.Aa<=h.ra&&(this.Aa=h.ra,this.ab=h.$a)),0>this.x-this.K?(this.M.x<-h.wc?this.M.x=-this.M.x:this.x=this.K,this.Jb(3*h.ra,2*h.$a)):this.x+this.K>this.e.A.width&&(this.M.x>h.wc?this.M.x=-this.M.x:this.x=this.e.A.width-this.K))},h.prototype.N=function(t){t.save();var i=this.x,s=this.y;t.translate(i,s),t.scale(this.Dc,this.Ec),t.translate(-i,-s),t.globalCompositeOperation="lighter",t.globalAlpha=.8,t.fillStyle=w[this.A],t.beginPath(),t.arc(i,s,this.K,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-over",t.globalAlpha=h.opacity,t.fillStyle=this.e.rc,t.beginPath(),t.arc(i,s,.95*this.K,0,2*Math.PI),t.fill(),t.restore()},h.ra=1,h.$a=.035,h.wc=2,h.opacity=.5,h}(function(t){function i(i,h,s){void 0===s&&(s=new p),t.call(this,i,h),this.Ga=new p,this.vb=new p,this.qa=1,this.hb=new p(Number.MAX_VALUE,Number.MAX_VALUE),this.ib=new p(-Number.MAX_VALUE,-Number.MAX_VALUE),this.Xb=new p,this.M=s}return f(i,t),i.prototype.Y=function(t){var i=this.M.cc().Qa(),h=this.M.gc();this.Xb.Set(Math.pow(h,2)*y.x,Math.pow(h,2)*y.y),this.M.x=Math.min(Math.max(this.M.x+(this.Ga.x+z.x+this.vb.x/this.qa-this.Xb.x*i.x)*t,this.ib.x),this.hb.x),this.M.y=Math.min(Math.max(this.M.y+(this.Ga.y+z.y+this.vb.y/this.qa-this.Xb.y*i.y)*t,this.ib.y),this.hb.y),this.vb.Set(0,0),this.x+=this.M.x*t,this.y-=this.M.y*t},i.prototype.Kc=function(t,i){this.vb.Set(t,i)},i}(n)),C=function(){function t(i){this.A=0|i.A,this.Ra=null==i.Ra?.4:i.Ra,this.G=null==i.G?[]:i.G,this.la=t.ac(this.G)}return t.prototype.N=function(t){if(!(2>this.G.length))if(t.globalAlpha=this.Ra,t.fillStyle=w[this.A],t.beginPath(),2==this.G.length)t.strokeStyle=w[this.A],t.moveTo(this.G[0].x,this.G[0].y),t.lineTo(this.G[1].x,this.G[1].y),t.stroke();else{t.moveTo(this.G[0].x,this.G[0].y);for(var i=1;i<this.G.length;i++)t.lineTo(this.G[i].x,this.G[i].y);t.lineTo(this.G[0].x,this.G[0].y),t.closePath(),t.fill()}},t.prototype.nc=function(){this.la=t.ac(this.G)},t.prototype.Ca=function(t,i){var h,s=this.G,e=s[s.length-1],a=!1;for(h=0;h<s.length;h++){var n=s[h];(n.y<i&&e.y>=i||e.y<i&&n.y>=i)&&(n.x<=t||e.x<=t)&&(a^=n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x)<t),e=s[h]}return a},t.prototype.Mc=function(t,i,h){return this.Ca(t,i)||this.Ca(t,i+h)||this.Ca(t,i-h)||this.Ca(t+h,i)||this.Ca(t-h,i)},t.ac=function(t){for(var i=new p,h=0;h<t.length;h++)i.x+=t[h].x,i.y+=t[h].y;return i.Set(i.x/t.length,i.y/t.length),i},t}(),ba=function(){function t(t){this.S=0|t.S,this.p=new C(t.p),this.Va=0,this.Za=!0}return Object.defineProperty(t.prototype,"color",{get:function(){return this.p.A},set:function(t){this.p.A=t},enumerable:!0,configurable:!0}),t.prototype.Wc=function(){return this.S<=this.Va&&this.Za},t.prototype.ua=function(){this.Va=0,this.Za=!0},t.prototype.jd=function(t){if(this.ua(),0!=t.length)for(var i=0;i<t.length;i++)this.p.Ca(t[i].x,t[i].y)&&(t[i].A==this.p.A?this.Va++:this.Za=!1)},t.prototype.N=function(t){if(null!=this.p.A){t.globalAlpha=1,t.lineWidth=4,this.p.N(t);var i=this.Za?"White":"DimGray";E(t,this.Za&&this.Va>=this.S?"Complete":this.Va<=this.S?this.Va+" of "+this.S:"Full",this.p.la.x,this.p.la.y,"center","middle",i),this.Za||E(t,"Error!",this.p.la.x,this.p.la.y+20,"center","middle",i)}},t}(),z=new p,y=new p(.005,0),w="White Gray Yellow Cyan Red Green RoyalBlue Orange".split(" "),v=2,K=[15,25,35],ca=new p(140,90),da=new p(-140,-90),q=1,L=[1,0],ea=[5,8],Q="Arial";function E(t,i,h,s,e,a,n,o,r){void 0===e&&(e="left"),void 0===a&&(a="middle"),void 0===n&&(n="White"),void 0===o&&(o="20px "+Q),void 0===r&&(r=1),t.globalAlpha=r,t.font="900 "+o,t.fillStyle=n,t.textAlign=e,t.textBaseline=a,t.fillText(i,h,s)}function t(t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.floor(Math.random()*(i-t)+t)}function x(t,i,h,s){return(t-h)*(t-h)+(i-s)*(i-s)}function R(t,i){if(null==t||null==i)return null;for(var h=[],s=0;s<t.length;s++){var e=i(t[s]);h.push(e)}return h}function na(t,i,h){var s=8;void 0===s&&(s=-1);var e=x(t,i,h.B,h.C),a=x(t,i,h.D,h.F);if(t=x(t,i,(h.B+h.D)/2,(h.C+h.F)/2),-1==s)return e<a?1:2;if(t<e&&t<a){if(t<=s*s)return 3}else if(e<a){if(e<=s*s)return 1}else if(a<=s*s)return 2;return-1}function oa(t,i,h,s,e){return(t=new p(t-h,i-s).Qa().Eb(e)).x+=h,t.y+=s,t}var W=[{t:"Plug the Hole",O:[{B:899,C:519,D:610,F:462},{B:1,C:518,D:273,F:463},{B:384,C:595,D:351,F:460},{B:502,C:597,D:535,F:460},{B:535,C:460,D:351,F:460},{B:610,C:462,D:565,F:268},{B:565,C:268,D:617,F:109},{B:617,C:109,D:234,F:110},{B:234,C:110,D:299,F:271},{B:299,C:271,D:273,F:463},{B:366,C:522,D:317,F:535}],Z:[{S:5,p:{A:4,G:[{x:235,y:112},{x:614,y:110},{x:564,y:269},{x:299,y:271}]}}],ca:[{x:41,y:563,A:2,W:70,R:1,X:5,L:75},{x:860,y:563,A:4,W:70,R:1,X:5,L:285}]},{t:"Make it Crowded",O:[{B:444,C:307,D:508,F:441},{B:508,C:441,D:383,F:441},{B:444,C:307,D:383,F:441},{B:492,C:408,D:608,F:236},{B:398,C:410,D:288,F:241},{B:310,C:153,D:591,F:153},{B:591,C:153,D:608,F:236},{B:288,C:241,D:310,F:153}],Z:[{S:3,p:{A:6,Ra:.4,G:[{x:311,y:153},{x:589,y:155},{x:607,y:235},{x:492,y:405},{x:443,y:307},{x:398,y:407},{x:289,y:239}]}}],ka:[{x:441,y:412,r:15,A:6},{x:431,y:385,r:15,A:6},{x:457,y:384,r:15,A:6},{x:471,y:415,r:15,A:6},{x:445,y:360,r:15,A:6},{x:419,y:411,r:15,A:6}]},{t:"Dashed Lines Discriminate",O:[{B:715,C:465,D:559,F:325},{B:208,C:477,D:356,F:332},{B:356,C:332,D:357,F:296},{B:357,C:296,D:282,F:296},{B:282,C:296,D:258,F:181},{B:559,C:325,D:558,F:290},{B:558,C:290,D:640,F:290},{B:640,C:290,D:651,F:175},{B:258,C:181,D:651,F:175,J:!0,A:7,wa:!0}],Z:[{S:6,p:{A:7,G:[{x:259,y:180},{x:650,y:175},{x:638,y:288},{x:283,y:294}]},x:0,y:0}],ca:[{x:405,y:557,A:4,R:.5,X:5,W:45},{x:501,y:557,A:7,R:.5,X:6,W:45}]},{t:"Popping Pins",ha:[{x:539,y:372,J:!0},{x:501,y:373,J:!0},{x:459,y:374,A:3,J:!0},{x:417,y:374,A:3,J:!0},{x:383,y:375,J:!0},{x:349,y:376,J:!0}],O:[{B:651,C:530,D:568,F:376},{B:265,C:527,D:340,F:390},{B:265,C:527,D:333,F:597},{B:651,C:530,D:590,F:596},{B:568,C:376,D:597,F:173},{B:340,C:390,D:325,F:178},{B:597,C:173,D:895,F:4},{B:895,C:4,D:1,F:2},{B:1,C:2,D:325,F:178},{B:336,C:3,D:413,F:155},{B:499,C:151,D:584,F:3}],Z:[{S:4,p:{A:4,G:[{x:411,y:153},{x:324,y:176},{x:7,y:2},{x:337,y:5}]}},{S:4,p:{A:7,G:[{x:339,y:3},{x:581,y:4},{x:498,y:149},{x:412,y:151}]}},{S:4,p:{A:6,G:[{x:893,y:4},{x:597,y:173},{x:500,y:149},{x:584,y:6}]}}],ca:[{x:411,y:563,A:7,W:70,R:1},{x:506,y:563,A:3,W:70,R:1},{x:609,y:521,A:6,W:70,R:1,L:-45},{x:309,y:521,A:4,W:70,R:1,L:45}]},{t:"Pushy",O:[{B:604,C:3,D:604,F:278},{B:333,C:0,D:333,F:278},{B:333,C:278,D:213,F:262},{B:213,C:262,D:162,F:227},{B:604,C:278,D:754,F:267},{B:754,C:267,D:808,F:227},{B:604,C:3,D:898,F:3},{B:898,C:3,D:898,F:155},{B:333,C:0,D:3,F:0},{B:3,C:0,D:3,F:111}],Z:[{S:5,p:{A:2,G:[{x:604,y:277},{x:753,y:267},{x:898,y:156},{x:898,y:3},{x:604,y:3}]}},{S:5,p:{A:5,G:[{x:333,y:277},{x:213,y:261},{x:0,y:111},{x:1,y:0},{x:333,y:1}]}}],T:[{ea:40,L:-90,x:626,y:331,J:!0,fa:300},{ea:40,L:90,x:324,y:415,J:!0,fa:300}],ca:[{x:407,y:561,A:5,W:70,R:.5,X:5},{x:515,y:562,A:2,W:70,R:.75,X:5}]},{t:"Traffic Jam",O:[{B:0,C:595,D:898,F:595},{B:764,C:0,D:551,F:205},{B:901,C:174,D:615,F:274},{B:140,C:0,D:355,F:209},{B:0,C:127,D:283,F:281},{B:900,C:495,D:615,F:274},{B:780,C:596,D:551,F:318},{B:0,C:462,D:283,F:281},{B:358,C:324,D:132,F:594},{B:447,C:0,D:447,F:213},{B:900,C:1,D:0,F:0},{B:448,C:310,D:448,F:596}],Z:[{S:8,p:{A:4,G:[{x:143,y:2},{x:445,y:4},{x:447,y:206},{x:353,y:207}]}},{S:8,p:{A:5,G:[{x:447,y:3},{x:761,y:2},{x:551,y:203},{x:447,y:205}]}},{S:8,p:{A:6,G:[{x:134,y:591},{x:445,y:593},{x:445,y:327},{x:356,y:325}]}},{S:8,p:{A:2,G:[{x:775,y:592},{x:448,y:593},{x:446,y:329},{x:552,y:320}]}}],T:[{ea:50,L:-120,x:717,y:165,J:!0,A:6,fa:200},{ea:50,L:-405,x:691,y:406,J:!0,A:4,fa:200},{ea:50,L:-315,x:248,y:366,J:!0,A:5,fa:200},{ea:50,L:-585,x:210,y:148,J:!0,A:2,fa:200}],ca:[{x:858,y:47,A:2,W:130,R:.5,X:8,L:225},{x:855,y:556,A:5,W:70,R:.25,X:8,L:315},{x:48,y:555,A:4,W:70,R:.25,X:8,L:405},{x:45,y:47,A:6,W:130,R:.5,X:8,L:495}]},{t:"Factorio",ha:[{x:253,y:262,J:!0},{x:259,y:298,J:!0},{x:239,y:231,A:6,J:!0},{x:264,y:343,A:7,J:!0}],O:[{B:1,C:521,D:248,F:499},{B:248,C:499,D:220,F:436},{B:220,C:436,D:255,F:370},{B:255,C:370,D:414,F:360},{B:414,C:360,D:435,F:416},{B:435,C:416,D:404,F:488},{B:248,C:499,D:404,F:488,J:!0,A:3,wa:!0},{B:414,C:360,D:603,F:349},{B:603,C:349,D:633,F:402},{B:633,C:402,D:588,F:480},{B:25,C:432,D:209,F:424,J:!0,A:7,wa:!0},{B:588,C:480,D:777,F:457,J:!0,A:4},{B:777,C:457,D:752,F:387},{B:752,C:387,D:765,F:330},{B:765,C:330,D:899,F:298},{B:771,C:235,D:748,F:4},{B:172,C:233,D:1,F:254},{B:262,C:223,D:312,F:138},{B:312,C:50,D:262,F:3},{B:535,C:3,D:521,F:230},{B:899,C:4,D:262,F:3},{B:603,C:349,D:694,F:233,J:!0,A:2},{B:262,C:223,D:521,F:230},{B:521,C:230,D:694,F:233,A:4,wa:!0},{B:771,C:235,D:694,F:233},{B:603,C:349,D:521,F:230,A:6,J:!0}],Z:[{S:4,p:{A:2,G:[{x:256,y:370},{x:412,y:362},{x:434,y:415},{x:404,y:486},{x:247,y:497},{x:221,y:437}]}},{S:4,p:{A:6,G:[{x:416,y:362},{x:603,y:350},{x:629,y:403},{x:586,y:481},{x:407,y:485},{x:435,y:416}]}},{S:4,p:{A:3,G:[{x:897,y:299},{x:766,y:332},{x:753,y:388},{x:776,y:456},{x:898,y:454}]}},{S:7,p:{A:7,G:[{x:749,y:5},{x:897,y:5},{x:898,y:235},{x:771,y:235}]}},{S:5,p:{A:5,G:[{x:259,y:3},{x:532,y:4},{x:519,y:229},{x:264,y:222},{x:311,y:138},{x:312,y:50}]}},{S:7,p:{A:4,G:[{x:535,y:5},{x:748,y:4},{x:769,y:234},{x:522,y:227}]}}],T:[{ea:5,L:90,x:234,y:556,J:!0,fa:380},{ea:50,L:30,x:160,y:331,J:!0,A:5,fa:205},{ea:10,L:-90,x:756,y:265,J:!0,A:6,fa:395},{ea:40,x:693,y:578,fa:240,J:!0}],ca:[{x:38,y:563,W:90,R:1,L:90}]}],pa=function(){function t(i){this.aa=new C({}),this.ea=1,this.L=0,this.Ha=t.Ub,this.x=0|i.x,this.y=0|i.y,this.J=null!=i.J&&i.J,this.A=null==i.A?0:i.A,this.L=null==i.L?0:i.L,this.ea=null==i.ea?10:i.ea,this.fa=null==i.fa?140:i.fa,this.sb=new p(0,1),this.aa=new C({G:[new p,new p,new p,new p],Ra:.2,A:this.A}),this.Oa(this.L)}return t.prototype.jc=function(){this.Oa(this.L)},t.prototype.Oa=function(i){this.L=i=Math.round(i);var h=this.x-t.width/2,s=this.y-t.height/2;for(this.sb.Set(Math.sin(i*Math.PI/180),Math.cos(i*Math.PI/180)),this.ja=this.sb.cc(),this.ja.y=-this.ja.y,this.ja.Eb(60),this.ja.Set(this.ja.x+this.x,this.ja.y+this.y),this.aa.G[0].Set(h,s),this.aa.G[1].Set(h+t.width,s),this.aa.G[2].Set(h+t.width,s-this.fa),this.aa.G[3].Set(h,s-this.fa),i=0;i<this.aa.G.length;i++)this.aa.G[i].lc(this.L,this.x,this.y),this.aa.G[i].x=Math.floor(this.aa.G[i].x),this.aa.G[i].y=Math.floor(this.aa.G[i].y);this.aa.nc()},t.prototype.Lc=function(t){for(var i=0;i<t.length;i++)(this.A==t[i].A||this.A<v)&&this.aa.Mc(t[i].x,t[i].y,t[i].K)&&t[i].Kc(this.sb.x*this.ea,this.sb.y*this.ea)},t.prototype.Y=function(i){this.Ha+=t.od*i,this.Ha>=t.width-t.Ub&&(this.Ha=t.Ub)},t.prototype.ta=function(t,i){t.globalAlpha=1,1!=i&&(this.aa.A=this.A,this.aa.N(t)),t.globalAlpha=.4,t.fillStyle=w[this.A],t.beginPath(),t.arc(this.ja.x,this.ja.y,8,0,2*Math.PI),t.fill(),t.strokeStyle="rgba(128, 128, 128, 0.4)",t.moveTo(this.ja.x,this.ja.y),t.lineTo(this.x,this.y),t.stroke(),this.J&&(t.beginPath(),t.rect(this.x-16,this.y-16,32,32),t.fill()),0==i&&E(t,"L:"+this.fa+"\nF:"+this.ea,this.aa.la.x,this.aa.la.y,"center")},t.prototype.N=function(i){var h=this.x-t.width/2,s=this.y-t.height/2;i.save(),i.translate(this.x,this.y),i.rotate(this.L*Math.PI/180),i.translate(-this.x,-this.y),i.globalAlpha=.7,i.fillStyle=w[this.A],i.fillRect(h,s,t.width,t.height),i.globalAlpha=1,i.lineCap="butt",i.strokeStyle="#4F4F4F",i.beginPath(),i.moveTo(h+t.width/2,s+t.height/2),i.lineTo(h+t.width/2,s+t.height),i.stroke(),i.strokeStyle=w[this.A],i.lineCap="round",i.setLineDash(L),i.lineWidth=3,i.beginPath(),i.moveTo(h,s),i.lineTo(h+t.width,s),i.stroke(),i.beginPath(),i.fillStyle="#dFdFdF",i.rect(h+this.Ha,s+t.height/2-t.rb/2,t.width/2-this.Ha,t.rb),i.fill(),i.beginPath(),i.fillStyle="#5F5F5F",i.rect(h+t.width/2,s+t.height/2-t.rb/2,t.width/2-this.Ha,t.rb),i.fill(),i.restore()},t.width=60,t.height=15,t.od=10*t.width,t.Ub=Math.floor(.05*t.width),t.rb=Math.floor(.5*t.height),t}(),qa=function(i){function h(t){i.call(this),this.Qb=new p,this.x=0|t.x,this.y=0|t.y,this.A=0|t.A,this.z=3,this.R=null==t.R||0==t.R?1:t.R,this.Ia=this.X=null==t.X?-1:t.X,this.W=null==t.W?5:t.W,this.L=null==t.L?0:t.L,this.$=1/this.R,this.p=new C({G:[new p,new p,new p,new p],Ra:1,A:0==this.A?1:this.A}),this.Oa(this.L)}return f(h,i),h.prototype.toJSON=function(){return{x:this.x,y:this.y,A:this.A,W:this.W,R:this.R,X:-1==this.X?void 0:this.X,L:this.L}},h.prototype.jc=function(){this.Oa(this.L)},h.prototype.ua=function(){this.Ia=this.X,this.$=1/this.R},h.prototype.Oa=function(t){this.L=t=Math.round(t),this.Qb.Set(Math.sin(t*Math.PI/180),Math.cos(t*Math.PI/180)),t=this.x-h.Wb/2;var i=this.y+h.ub/2;for(this.p.G[0].Set(t,i),this.p.G[1].Set(t+h.Wb,i),this.p.G[2].Set(t+h.Fc,i-h.ub),this.p.G[3].Set(t-(h.Fc-h.Wb),i-h.ub),t=0;t<this.p.G.length;t++)this.p.G[t].lc(this.L,this.x,this.y),this.p.G[t].x=Math.floor(this.p.G[t].x),this.p.G[t].y=Math.floor(this.p.G[t].y);this.p.nc()},h.prototype.Y=function(i){!this.e.U.active&&0<this.$&&(this.$-=i,0>=this.$)&&(0<this.Ia&&this.Ia--,(0<this.Ia||-1==this.Ia)&&(this.$=1/this.R),null!=(i=0==this.A?this.e.cb(this.x,this.y,K[t(0,K.length)]):this.e.cb(this.x,this.y,K[t(0,K.length)],this.A))&&(i.M.Set(this.Qb.x*this.W,this.Qb.y*this.W),X.Play("bubble"+t(0,3))))},h.prototype.ta=function(t,i){0==i&&E(t,"r:"+this.R+" s:"+this.W,this.x,this.y+h.ub/2,"center","top")},h.prototype.N=function(t,i){void 0===i&&(i=1),this.p.N(t),t.setLineDash(L),t.strokeStyle="DarkGray",t.lineWidth=3,t.beginPath(),t.moveTo(this.p.G[0].x,this.p.G[0].y);for(var h=1;h<this.p.G.length;h++)t.lineTo(this.p.G[h].x,this.p.G[h].y);t.lineTo(this.p.G[0].x,this.p.G[0].y),t.stroke(),-1!=this.Ia&&0!=i?E(t,this.Ia.toString(),this.p.la.x,this.p.la.y,"center","middle",3>this.p.A?"Black":"White"):-1!=this.X&&0==i&&E(t,this.X.toString(),this.p.la.x,this.p.la.y,"center","middle",3>this.p.A?"Black":"White")},h.ub=70,h.Fc=70,h.Wb=50,h}(n),ra=function(){function t(t){this.x=0|t.x,this.y=0|t.y,this.A=0|t.A,this.J=null!=t.J&&t.J}return t.prototype.Oc=function(t){return(0==this.A||this.A==t.A)&&x(this.x,this.y,t.x,t.y)<=t.K*t.K+144},t.prototype.ta=function(t,i){this.J&&1!=i&&(t.globalAlpha=.3,t.fillStyle=w[this.A],t.beginPath(),t.arc(this.x,this.y,12,0,2*Math.PI),t.fill())},t.prototype.N=function(t){t.globalAlpha=1,t.lineWidth=3,t.setLineDash(L),t.beginPath(),t.strokeStyle=w[this.A],t.moveTo(this.x-6,this.y),t.lineTo(this.x+6,this.y),t.moveTo(this.x,this.y-6),t.lineTo(this.x,this.y+6),t.stroke()},t}(),sa=function(){function t(t){this.B=0|t.B,this.C=0|t.C,this.D=0|t.D,this.F=0|t.F,this.J=null!=t.J&&t.J,this.A=0|t.A,this.wa=null!=t.wa&&t.wa}return t.prototype.ta=function(t){var i=(this.B+this.D)/2,h=(this.C+this.F)/2;t.globalAlpha=.5,t.fillStyle=w[this.A],t.beginPath(),t.arc(this.B,this.C,8,0,2*Math.PI),t.arc(this.D,this.F,8,0,2*Math.PI),this.J&&(t.fill(),t.beginPath(),t.rect(i-8,h-8,16,16)),t.fill()},t.prototype.ec=function(){return Math.sqrt(x(this.B,this.C,this.D,this.F))},t.prototype.N=function(t){t.globalAlpha=1,t.lineWidth=3,t.lineCap="butt",this.wa?t.setLineDash(ea):t.setLineDash(L),t.beginPath(),t.strokeStyle=w[this.A],t.moveTo(this.B,this.C),t.lineTo(this.D,this.F),t.stroke()},t}(),ta=function(){function t(t){this.t=t.t,this.ha=null==t.ha?[]:R(t.ha,(function(t){return new ra(t)})),this.O=null==t.O?[]:R(t.O,(function(t){return new sa(t)})),this.Z=null==t.Z?[]:R(t.Z,(function(t){return new ba(t)})),this.T=null==t.T?[]:R(t.T,(function(t){return new pa(t)})),this.ca=null==t.ca?[]:R(t.ca,(function(t){return new qa(t)})),this.ka=null==t.ka?[]:t.ka}return t.prototype.Hb=function(t){for(var i=0;i<this.ca.length;i++)t.sa(this.ca[i]);for(i=0;i<this.ka.length;i++)t.cb(this.ka[i].x,this.ka[i].y,this.ka[i].r,this.ka[i].A)},t.prototype.ua=function(){for(var t=0;t<this.ca.length;t++)this.ca[t].ua();for(t=0;t<this.Z.length;t++)this.Z[t].ua()},t.prototype.kb=function(t){if(t)for(var i=0;i<this.ca.length;i++)t.kc(this.ca[i])},t.prototype.Y=function(t){for(var i=0;i<this.T.length;i++)this.T[i].Y(t)},t.prototype.Vc=function(t){for(var i=0;i<this.T.length;i++)this.T[i].Lc(t)},t.prototype.Jc=function(){return 0<this.Z.length},t.prototype.Ic=function(){for(var t=0;t<this.Z.length;t++)if(!this.Z[t].Wc())return!1;return!0},t.prototype.N=function(t,i){for(var h=0;h<this.O.length;h++)this.O[h].N(t),2==i&&this.O[h].J&&this.O[h].ta(t);for(h=0;h<this.Z.length;h++)this.Z[h].N(t);for(h=0;h<this.ha.length;h++)this.ha[h].ta(t,i),this.ha[h].N(t);for(h=0;h<this.T.length;h++)this.T[h].N(t),(2==i&&this.T[h].J||0==i)&&this.T[h].ta(t,i);if(1!=i){for(h=0;h<this.ka.length;h++){var s=this.ka[h];t.globalCompositeOperation="lighter",t.globalAlpha=.8,t.fillStyle=w[this.ka[h].A],t.beginPath(),t.arc(s.x,s.y,s.r,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-over",t.globalAlpha=aa.opacity,t.fillStyle="black",t.beginPath(),t.arc(s.x,s.y,.95*s.r,0,2*Math.PI),t.fill()}for(h=0;h<this.ca.length;h++)this.ca[h].N(t,i),this.ca[h].ta(t,i)}},t}();function ua(t){for(var i=0;24>i;i++)this[String.fromCharCode(97+i)]=t[i]||0;.01>this.c&&(this.c=.01),.18>(t=this.b+this.c+this.e)&&(t=.18/t,this.b*=t,this.c*=t,this.e*=t)}var va=function(){function t(){}return t.Pc=function(i){var h=new t;h.Ob=i;var s=h.ua();i=new Uint8Array(4*((s+1)/2|0)+44);s=2*h.gd(new Uint16Array(i.buffer,44),s);var e=new Uint32Array(i.buffer,0,44);return h.Uc(e,s),i.buffer},t.prototype.Uc=function(t,i){t[0]=1179011410,t[1]=i+36,t[2]=1163280727,t[3]=544501094,t[4]=16,t[5]=65537,t[6]=44100,t[7]=88200,t[8]=1048578,t[9]=1635017060,t[10]=i},t.prototype.ic=function(){var t=this.Ob;this.Ea=100/(t.f*t.f+.001),this.pc=100/(t.g*t.g+.001),this.Pb=1-t.h*t.h*t.h*.01,this.md=-t.i*t.i*t.i*1e-6,t.a||(this.Fa=.5-t.n/2,this.nd=5e-5*-t.o),this.kd=1+t.l*t.l*(0<t.l?-.9:10),this.ld=0,this.Kb=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},t.prototype.ua=function(){this.ic();var t=this.Ob;return this.Lb=t.b*t.b*1e5,this.Mb=t.c*t.c*1e5,this.Nb=t.e*t.e*1e5+12,3*((this.Lb+this.Mb+this.Nb)/3|0)},t.prototype.gd=function(t,i){var h=1!=(B=this.Ob).s||B.v,s=B.v*B.v*.1,e=1+3e-4*B.w,a=B.s*B.s*B.s*.1,n=1+1e-4*B.t,o=1!=B.s,r=B.x*B.x,l=B.g,c=B.q||B.r,y=B.r*B.r*B.r*.2,b=B.q*B.q*(0>B.q?-1020:1020),u=B.p?32+((1-B.p)*(1-B.p)*2e4|0):0,p=B.d,f=B.j/2,x=B.k*B.k*.01,d=B.a,v=this.Lb,g=1/this.Lb,A=1/this.Mb,w=1/this.Nb;.8<(B=5/(1+B.u*B.u*20)*(.01+a))&&(B=.8);for(var C,m,D,F,M,B=1-B,S=!1,G=0,P=0,I=0,L=0,H=0,T=0,k=0,K=0,J=0,R=0,E=Array(1024),O=Array(32),W=E.length;W--;)E[W]=0;for(W=O.length;W--;)O[W]=2*Math.random()-1;for(W=0;W<i;W++){if(S)return W;if(u&&++J>=u&&(J=0,this.ic()),this.Kb&&++this.ld>=this.Kb&&(this.Kb=0,this.Ea*=this.kd),this.Pb+=this.md,this.Ea*=this.Pb,this.Ea>this.pc&&(this.Ea=this.pc,0<l&&(S=!0)),m=this.Ea,0<f&&(R+=x,m*=1+Math.sin(R)*f),8>(m|=0)&&(m=8),d||(this.Fa+=this.nd,0>this.Fa?this.Fa=0:.5<this.Fa&&(this.Fa=.5)),++P>v)switch(P=0,++G){case 1:v=this.Mb;break;case 2:v=this.Nb}switch(G){case 0:I=P*g;break;case 1:I=1+2*(1-P*A)*p;break;case 2:I=1-P*w;break;case 3:I=0,S=!0}c&&(0>(D=0|(b+=y))?D=-D:1023<D&&(D=1023)),h&&e&&(1e-5>(s*=e)?s=1e-5:.1<s&&(s=.1)),M=0;for(var N=8;N--;){if(++k>=m&&(k%=m,3==d))for(C=O.length;C--;)O[C]=2*Math.random()-1;switch(d){case 0:F=k/m<this.Fa?.5:-.5;break;case 1:F=1-k/m*2;break;case 2:F=.225*((0>(F=1.27323954*(F=6.28318531*(.5<(F=k/m)?F-1:F))+.405284735*F*F*(0>F?1:-1))?-1:1)*F*F-F)+F;break;case 3:F=O[Math.abs(32*k/m|0)]}h&&(C=T,0>(a*=n)?a=0:.1<a&&(a=.1),o?(H+=(F-T)*a,H*=B):(T=F,H=0),L+=(T+=H)-C,F=L*=1-s),c&&(E[K%1024]=F,F+=E[(K-D+1024)%1024],K++),M+=F}M*=.125*I*r,t[W]=1<=M?32767:-1>=M?-32768:32767*M|0}return i},t}(),X=function(){function t(){}return t.Db=function(){for(var i in t.pb=new AudioContext,t.Rb={},t.Bc){var h=va.Pc(new ua(t.Bc[i]));t.Rc(i,h)}},t.Rc=function(t,i){var h=this;this.index++,this.pb.decodeAudioData(i,(function(i){h.Rb[t]=i,h.index--,0==h.index&&h.fc&&h.fc()}),(function(){console.log("ERROR!")}))},t.Play=function(i,h){if(void 0===h&&(h=0),t.Rb[i]){var s=t.pb.createBufferSource();return s.buffer=t.Rb[i],s.connect(t.pb.destination),h=t.pb.currentTime+(h||0),s.start(h),s}},t.Bc={buttonDown:[2,.04,.21,.0787,.0583,.34,.0056,.1399,-.0162,.0614,,-.3787,.0883,.3414,.0899,.0111,.1224,-.7053,.9075,.1738,-.729,.6085,.1811,.4],buttonUp:[2,.04,.21,.0787,.0583,.42,.0056,-.04,.34,.0614,,-.06,.0883,.3414,.0899,.0111,-.48,-.7053,.9075,.1738,-.729,.6085,.1811,.4],bubble0:[2,.14,.09,,.1699,.2,,.32,-.12,,.0343,-.0485,.1916,.3523,-.0239,,-1,-.76,1,-.0317,,.1172,-.2115,.3],bubble1:[2,.14,.09,,.1699,.09,,.32,-.12,,.0343,-.0485,.1916,.3523,-.0239,,-1,-.76,1,-.0317,,.1172,-.2115,.3],bubble2:[2,.14,.09,,.1699,.17,,.32,-.12,,.0343,-.0485,.1916,.3523,-.0239,,-1,-.76,1,-.0317,,.1172,-.2115,.3],lowPop:[2,,.01,.0023,.1699,.2,.034,.2459,-.0171,,.0343,-.0485,.1916,.3523,-.0239,,-.1688,.0518,1,-.0317,,.1172,-.2115,.5],midPop:[2,,.01,.0023,.1699,.35,.034,.2459,-.0171,,.0343,-.0485,.1916,.3523,-.0239,,-.1688,.0518,1,-.0317,,.1172,-.2115,.5],highPop:[2,,.01,.0023,.1699,.5,.034,.2459,-.0171,,.0343,-.0485,.1916,.3523,-.0239,,-.1688,.0518,1,-.0317,,.1172,-.2115,.4],blowUp:[3,.4221,.01,,.85,.2394,,,,-.9113,-.2781,-1,-.5043,,.1074,.0389,4e-4,-.3199,.9776,.0118,,.7449,.1003,.3]},t.index=0,t}(),Ea=function(i){function h(){i.call(this),this.da=[];for(var t=0;t<h.Zb;t++)this.da[t]={x:0,y:0,Gc:0,Ab:0}}return f(h,i),h.prototype.Set=function(i,s,e,a,n){this.x=i,this.y=s,this.$=this.Yb=e,this.K=a,this.A=n,e=0,n=2*Math.PI/h.Zb,a*=.1;for(var o=0;o<h.Zb;o++){var r=t(h.ib,h.hb),l=Math.cos(e),c=Math.sin(e);this.da[o].x=i+a*l,this.da[o].y=s+a*c,this.da[o].Gc=l*r,this.da[o].Ab=c*r,e+=n}},h.prototype.Y=function(t){if(0<this.$&&(this.$-=t,0>=this.$))this.e.zc.Fb(this);else for(var i=0;i<this.da.length;i++)this.da[i].Ab+=256*t,this.da[i].x+=this.da[i].Gc*t,this.da[i].y+=this.da[i].Ab*t},h.prototype.N=function(t){t.fillStyle=w[this.A];var i=(this.$-this.Yb/2)/(this.Yb/2);for(0<i&&(t.globalAlpha=.3,t.beginPath(),t.arc(this.x,this.y,i*this.K*.9,0,2*Math.PI),t.fill()),t.globalAlpha=this.$/this.Yb,i=0;i<this.da.length;i++)t.beginPath(),t.arc(this.da[i].x,this.da[i].y,2,0,2*Math.PI),t.fill()},h.ib=30,h.hb=120,h.Zb=50,h}(n),Z=function(t){function i(h,s,e,a,n,o){void 0===o&&(o=!0),t.call(this,h,s),this.r=10,this.qb=this.Ya=!1,this.z=10,this.width=e,this.height=a,this.text=n,this.Tb=i.color,this.Cc=o}return f(i,t),i.prototype.Y=function(){var t=this.e.V.x,h=this.e.V.y,s=this.x,e=this.y;t>=s&&t<=s+this.width&&h>=e&&h<=e+this.height?(this.Ya||(this.Ya=!0,Y.Ka++),this.e.V.va[0]?(this.qb=!0,this.Cc&&X.Play("buttonDown")):this.e.V.Sa[0]&&this.qb&&(this.qb=!1,this.Cc&&X.Play("buttonUp"),this.fb&&this.fb(this)),this.Tb=this.e.V.ya[0]?i.vd:i.ud):(this.qb=!1,this.Tb=i.color,this.Ya&&(this.Ya=!1,Y.Ka--))},i.prototype.eb=function(t){!t&&this.Ya&&(this.Ya=!1,Y.Ka--)},i.prototype.N=function(t){t.globalAlpha=1,t.lineWidth=i.rd,t.fillStyle=this.Tb,t.setLineDash([1,0]),t.strokeStyle="Gainsboro",t.beginPath(),0==this.r?(t.lineWidth=1,t.rect(this.x,this.y,this.width,this.height)):(t.moveTo(this.x+this.r,this.y),t.lineTo(this.x+this.width-this.r,this.y),t.quadraticCurveTo(this.x+this.width,this.y,this.x+this.width,this.y+this.r),t.lineTo(this.x+this.width,this.y+this.height-this.r),t.quadraticCurveTo(this.x+this.width,this.y+this.height,this.x+this.width-this.r,this.y+this.height),t.lineTo(this.x+this.r,this.y+this.height),t.quadraticCurveTo(this.x,this.y+this.height,this.x,this.y+this.height-this.r),t.lineTo(this.x,this.y+this.r),t.quadraticCurveTo(this.x,this.y,this.x+this.r,this.y)),t.fill(),t.stroke(),E(t,this.text,this.x+this.width/2,this.y+this.height/2,"center","middle",i.yd,i.font)},i.font="20px "+Q,i.rd=3,i.color="DimGray",i.ud="Gray",i.vd="LightGray",i.yd="White",i.Bd=parseInt(i.font),i}(n),Fa=function(t){function i(i){var h=this;t.call(this),this.uc="center",this.Hc=0,this.Zc=function(t){h.oa=t.text,h.active=!1},this.z=999,this.x=0|i.x,this.y=0|i.y,this.A=null==i.A?"rgba(0, 32, 64, 0.9)":i.A,this.height=150,this.width=null==i.width?100:i.width,this.oa=null,this.buttons=[]}return f(i,t),i.prototype.pa=function(){this.active=!1},i.prototype.Pa=function(t){this.oa=null,this.active=t},i.prototype.Set=function(t,h,s,e,a){void 0===s&&(s=[]),void 0===e&&(e="center"),void 0===a&&(a=this.e.A.width/2),this.uc=e,this.Hc=a,this.height=0==s.length?110:110+35*s.length,this.y=this.e.A.height/2-this.height/2,e=i.Sb+20,a=this.width/2-i.Sb/2-(h.length-1)/2*e;var n=this.y+this.height-i.qc-10;for(this.title=t,this.xc=s,this.buttons=[],t=0;t<h.length;t++)s=new Z(a,n,i.Sb,i.qc,h[t]),a+=e,s.fb=this.Zc,s.e=this.e,this.buttons.push(s),this.e.sa(s)},i.prototype.eb=function(t){if(!t){for(t=0;t<this.buttons.length;t++)this.buttons[t].active=!1,this.e.kc(this.buttons[t]);this.buttons=[]}},i.prototype.Y=function(t){for(var i=0;i<this.buttons.length;i++)this.buttons[i].Y(t)},i.prototype.N=function(t){t.globalAlpha=1,t.fillStyle=this.A,t.fillRect(this.x,this.y,this.width,this.height),t.lineWidth=2,t.strokeStyle="White",t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x+this.width,this.y),t.moveTo(this.x,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.stroke(),E(t,this.title,this.x+this.width/2,this.y+this.height/8+5,"center","middle","Yellow","24px "+Q);for(var i=0;i<this.xc.length;i++)E(t,this.xc[i],this.x+this.Hc,this.y+this.height/6+24+5+25*i,this.uc,"middle");for(i=0;i<this.buttons.length;i++)this.buttons[i].N(t)},i.Sb=180,i.qc=50,i}(n),Ia=function(){function t(t,i){var h=this;void 0===i&&(i="#000000"),this.jb={},this.sort=this.Ja=!1,this.tb=this.timeStamp=0,this.hc=function(t){h.tb=(t-h.timeStamp)/1e3,.1<h.tb&&(h.tb=.06),h.Y(h.tb),h.N(h.tc),h.timeStamp=t,window.requestAnimationFrame(h.hc)},this.tc=t.getContext("2d"),this.tc.Ad=!1,this.A=t,this.rc=i,this.P=[],this.Vb=new Ga(150,150,!0),this.zc=new Ga(5),this.bubbles=[],this.xb=new Ha,this.V=new Y(this),this.U=new Fa({width:t.width})}return t.prototype.ed=function(){if(!this.Ac){this.Ac=!0,this.V.pa(),this.xb.pa(),this.sa(this.U);for(var t=0;t<this.P.length;t++)this.P[t].active&&!this.P[t].La&&(this.P[t].pa(),this.P[t].La=!0);window.requestAnimationFrame(this.hc)}},t.prototype.sa=function(t){-1<this.P.indexOf(t)||(t.e=this,this.P.push(t),this.sort=!0,this.Ac&&t.active&&!t.La&&(t.pa(),t.La=!0))},t.prototype.kc=function(t){-1<(t=this.P.indexOf(t))&&this.P.splice(t,1)},t.prototype.Sc=function(){for(var t=0;t<this.P.length;t++)if("IGE"==this.P[t].name)return this.P[t];return null},t.prototype.Y=function(t){for(var i=0;i<this.P.length;i++)this.P[i].active&&(this.P[i].La||(this.P[i].La=!0,this.P[i].pa()),this.P[i].Y(t));if(!this.Ja)for(i=0;i<this.bubbles.length;i++)this.bubbles[i].active&&this.bubbles[i].Y(t);this.xb.Bb(),this.V.Bb(),this.sort&&(this.sort=!this.sort,this.P.sort((function(t,i){return t.z-i.z})))},t.prototype.N=function(t){var i=!1;t.globalAlpha=1,t.fillStyle=this.rc,t.fillRect(0,0,this.A.width,this.A.height);for(var h=0;h<this.P.length;h++){if(!i&&(this.P[h].z>=q||h==this.P.length-1)){i=!0;for(var s=0;s<this.bubbles.length;s++)this.bubbles[s].active&&this.bubbles[s].N(t)}this.P[h].active&&this.P[h].N(t)}},t.prototype.Gb=function(t,i,h){var s=this;void 0===i&&(i=!0),void 0===h&&(h=!0),this.Vb.Fb(t);var e=this.bubbles.indexOf(t);-1<e&&(this.bubbles.splice(e,1),this.jb[w[t.A]]--,i&&this.zc.mc((function(){var t=new Ea;return s.sa(t),t})).Set(t.x,t.y,.5,t.K,t.A)),h&&(t.K>=K[2]?X.Play("lowPop"):t.K>=K[1]?X.Play("midPop"):X.Play("highPop"))},t.prototype.mb=function(){for(var t=0;t<this.bubbles.length;t++)this.Vb.Fb(this.bubbles[t]);this.bubbles=[],this.jb={}},t.prototype.cb=function(t,i,h,s){var e,a,n=this;void 0===s&&(s=-1),void 0===e&&(e=!0),void 0===a&&(a=!1);var o=this.Vb.mc((function(){var t=new aa;return t.hb=ca,t.ib=da,t.e=n,t}));return null!=o&&(o.Set(t,i,h,s),o.Ga.y=a?0:5,o.Ga.x=0,o.M.x=0,o.M.y=0,e&&this.bubbles.push(o),this.jb[o.A]=(null==this.jb[o.A]?0:this.jb[o.A])+1),o},t.prototype.dd=function(t){for(var i=0;i<this.bubbles.length;i++)if(x(this.bubbles[i].x,this.bubbles[i].y,t.x,t.y)<this.bubbles[i].K*this.bubbles[i].K)return this.bubbles[i];return null},t.prototype.bc=function(){for(var t=0;t<this.bubbles.length;t++)for(var i=this.bubbles[t],h=t+1;h<this.bubbles.length;h++)i.Nc(this.bubbles[h])},t}(),Ja=function(i){function h(){i.call(this),this.na=-1,this.abs=this.ba=null,this.z=-10,this.name="Game",this.ia=0}return f(h,i),h.prototype.pa=function(){this.vc=this.e.Sc(),this.vc.Db(this),this.state=this.lb},h.prototype.bb=function(t,i){void 0===i&&(i=!1),this.e.Ja=!1,this.e.mb(),this.ia=2,this.H&&this.H.kb(this.e),0>t||t>=W.length||(this.na=t,this.H=new ta(W[t]),this.H.Hb(this.e),this.Ba=i?3:0)},h.prototype.Ma=function(t){void 0===t&&(t=!1),t?(this.na+1>=W.length?this.e.U.Set("Game Complete",["Main Menu"],["Congratulations!","You have trapped all the bubbles!","Thanks for playing :)"]):this.e.U.Set("Level Complete",["Retry","Next","Main Menu"],["Nice job!"]),this.e.U.Pa(!0),this.state=this.Da,this.e.Ja=!0,localStorage.setItem("cl",this.na.toString())):this.e.U.active&&this.state==this.Da&&"Level Complete"!=this.e.U.title?(this.state=this.lb,this.e.Ja=!1,this.e.U.Pa(!1)):this.state!=this.lb||this.e.U.active||(-1==this.na?-1<Number(localStorage.getItem("cl"))?this.e.U.Set("Main Menu",["New Game","Continue","Help"]):this.e.U.Set("Main Menu",["New Game","Help"]):this.e.U.Set("Options",["Retry","Edit Level","Resume","Main Menu"],["Level "+this.na+": "+this.H.t]),this.abs&&this.abs.stop(),this.ba=null,this.e.Ja=!0,this.e.U.Pa(!0),this.state=this.Da)},h.prototype.Y=function(t){this.e.xb.dc()&&this.Ma(),0<this.Ba&&(this.Ba-=t),1<this.Ba&&(this.e.V.ya[0]||this.e.V.ya[1]||this.e.V.ya[2])&&(this.Ba=1),this.state(t)},h.prototype.Ib=function(){this.H.kb(this.e),this.e.mb(),this.na=-1,this.H=null},h.prototype.Da=function(){if(!this.e.U.active){this.state=this.lb;var t=this.e.U;switch(t.title){case"Level Complete":"Retry"==t.oa?this.bb(this.na):"Main Menu"==t.oa?this.Ib():(this.na++,this.bb(this.na,!0));break;case"Game Complete":localStorage.removeItem("cl"),this.Ib();break;case"Options":this.e.Ja=!1,"Retry"==t.oa?(this.e.mb(),this.H.kb(this.e),this.H.ua(),this.H.Hb(this.e)):"Edit Level"==t.oa?(this.Ba=0,this.active=!1,this.H.ua(),this.vc.fd(this.H)):"Main Menu"==t.oa&&this.Ib();break;case"Main Menu":"New Game"==t.oa?(localStorage.removeItem("cl"),this.bb(0,!0)):"Continue"==t.oa?-1<(t=Number(localStorage.getItem("cl")))?this.bb(t+1,!0):this.bb(0,!0):"Help"==t.oa&&(this.state=this.Da,t.Set("Help",["Ok"],"Trap bubbles in same-colored areas to complete levels;Different color bubbles in a colored area isn't allowed and shows as 'Error!';Right-click blows new white bubbles (hold to make larger);Left-click pops only WHITE bubbles;In Edit Mode, items that can be moved, colored, and/or rotated are indicated;by a dot, or rectangle;Go to Edit Mode thru the menu via 'Escape' or the menu button".split(";"),"left",10),t.Pa(!0));break;case"Help":this.e.Ja=!1}}},h.prototype.lb=function(i){if(this.H){if(0<this.ia&&(this.ia-=i,0>=this.ia&&this.Ma(!0)),this.e.V.va[2]&&null==this.ba&&!Y.Ka&&-1<this.na)this.ba=this.e.cb(this.e.V.x,this.e.V.y,10,0),null!=this.ba&&(this.abs=X.Play("blowUp"),this.ba.M.Set(0,0),this.ba.Ga.y=0,this.ba.Ga.x=0);else if(this.e.V.va[0]&&!Y.Ka){var h=this.e.dd(new p(this.e.V.x,this.e.V.y));null!=h&&0==h.A&&this.e.Gb(h)}for(this.ba&&this.e.V.ya[2]?(this.ba.K=Math.min(this.ba.K+25*i,60),this.ba.qa=this.ba.K/50):this.ba&&this.e.V.Sa[2]&&(this.abs&&this.abs.stop(),this.ba.M.x=t(-2,3),this.ba.M.y=t(10,40),this.ba.Ga.y=5,this.ba=null),this.e.bc(),h=0;h<this.e.bubbles.length;h++){for(var s=0;s<this.H.O.length;s++){var e=this.e.bubbles[h].cd(this.H.O[s]);null!=e&&(this.H.O[s].wa&&this.H.O[s].A!=this.e.bubbles[h].A||!this.H.O[s].wa&&this.H.O[s].A==this.e.bubbles[h].A||0==this.H.O[s].A)&&(this.e.bubbles[h].x+=e.x,this.e.bubbles[h].y+=e.y)}for(s=0;s<this.H.ha.length;s++)if(this.H.ha[s].Oc(this.e.bubbles[h])){this.e.Gb(this.e.bubbles[h]);break}for(s=0;s<this.H.Z.length;s++)this.H.Z[s].jd(this.e.bubbles)}this.H&&(this.H.Y(i),this.H.Vc(this.e.bubbles),this.H.Jc()&&this.H.Ic()?0==this.ia&&(this.ia=2):this.ia=0)}else this.ia-=i,0>=this.ia&&50>this.e.bubbles.length&&(this.e.cb(t(40,this.e.A.width-40),this.e.A.height+40,K[t(0,K.length)],t(0,w.length)).M.Set(t(-90,90),0),this.ia=t(.25,2)),this.e.bc()},h.prototype.N=function(t){if(-1==this.na)E(t,"Bubble Trap!",this.e.A.width/2,this.e.A.height/2,"center","middle","cyan","92px "+Q),E(t,"Escape for the menu",this.e.A.width/2,this.e.A.height-30,"center","bottom","orange"),E(t,"by recursor for js13k 2016",this.e.A.width/2,this.e.A.height,"center","bottom","yellow","16px "+Q);else if(this.H&&(this.H.N(t,1),0<this.Ba)){var i=Math.min(Math.max(this.Ba,0),1);t.globalAlpha=.9*i,t.fillStyle="MidnightBlue",t.fillRect(0,this.e.A.height/2-50,this.e.A.width,100),E(t,this.H.t,this.e.A.width/2,this.e.A.height/2,"center","middle","white","30px "+Q,i)}},h.prototype.eb=function(t){!t&&this.H&&(this.H.kb(this.e),this.e.mb())},h}(n);window.addEventListener("load",(function(){var t=new Ia(document.getElementById("main"));X.Db(),X.fc=function(){var i=new Ja;t.sa(i);var h=new Ka;h.active=!1,t.sa(h);var s=new Z(t.A.width-25,0,25,25,"=");s.name="o",s.r=0,t.sa(s),s.fb=function(){i.active?i.Ma():h.Ma()},t.ed()}}));var Ha=function(){function t(){var t=this;this.Yc=function(){t.Wa={},t.gb={},t.wb={}},this.$c=function(i){t.Wa[i.key]&&t.Wa[i.key]||(t.Wa[i.key]=!0,t.gb[i.key]=!0)},this.ad=function(i){t.Wa[i.key]&&(t.Wa[i.key]=!1,t.wb[i.key]=!0)},this.Wa={},this.gb={},this.wb={}}return t.prototype.pa=function(){window.addEventListener("blur",this.Yc),window.addEventListener("keyup",this.ad),window.addEventListener("keydown",this.$c)},t.prototype.dc=function(){return this.gb.Escape||!1},t.prototype.Bb=function(){for(var t in this.gb)this.gb[t]=!1;for(t in this.wb)this.wb[t]=!1},t}(),Y=function(){function t(t){this.e=t,this.va=[!1,!1,!1],this.Sa=[!1,!1,!1],this.ya=[!1,!1,!1]}return t.prototype.hd=function(t){var i=this.e.A.getBoundingClientRect();this.x=t.clientX-i.left,this.y=t.clientY-i.top},t.prototype.pa=function(){var t=this;this.e.A.addEventListener("mousemove",(function(i){t.hd(i)})),this.e.A.addEventListener("mousedown",(function(i){t.va[i.button]=!0,t.ya[i.button]=!0})),this.e.A.addEventListener("mouseup",(function(i){t.va[i.button]=!1,t.Sa[i.button]=!0,t.ya[i.button]=!1}))},t.prototype.Bb=function(){this.Sa[0]=this.Sa[1]=this.Sa[2]=!1,this.va[0]=this.va[1]=this.va[2]=!1},t.Ka=0,t}(),Ga=function(){function t(t,i,h){for(void 0===t&&(t=0),void 0===i&&(i=-1),void 0===h&&(h=!1),this.td=i,this.pd=h,0<i&&(t=Math.min(t,i)),this.ga=Array(t),t=0;t<this.ga.length;t++)this.ga[t]={Xa:null,$b:!1}}return t.prototype.mc=function(t){for(var i=0;i<this.ga.length;i++)if(!this.ga[i].$b)return this.ga[i].$b=!0,null===this.ga[i].Xa?this.ga[i].Xa=t():this.ga[i].Xa instanceof n&&(this.ga[i].Xa.active=!0),this.ga[i].Xa;if(this.td==this.ga.length)return this.pd?null:t()},t.prototype.Fb=function(t){t instanceof n&&(t.active=!1);for(var i=0;i<this.ga.length;i++)t===this.ga[i].Xa&&(this.ga[i].$b=!1)},t}(),Ka=function(t){function i(){t.call(this),this.xa=-1,this.z=-10,this.name="IGE"}return f(i,t),i.prototype.Db=function(t){this.sd=t},i.prototype.fd=function(t){this.H=t,this.active=!0},i.prototype.pa=function(){var t=this;this.state=this.ob,this.Ua=new Z(this.e.A.width-100-2,this.e.A.height-40,100,40,"Color +",!1),this.Ta=new Z(this.e.A.width-210,this.e.A.height-40,100,40,"Color -",!1),this.e.sa(this.Ua),this.e.sa(this.Ta),this.Ua.active=!1,this.Ta.active=!1,this.Ua.fb=function(){t.Tc()},this.Ta.fb=function(){t.Qc()},this.$=.75},i.prototype.eb=function(t){t||(this.Ua.active=!1,this.Ta.active=!1,this.Na(null))},i.prototype.Ma=function(){this.e.U.active&&this.state==this.Da?(this.state=this.ob,this.e.U.Pa(!1)):this.e.U.active||this.state!=this.ob||(this.e.U.Set("Options",["Play Level","Resume Editing"]),this.state=this.Da,this.e.U.Pa(!0))},i.prototype.Y=function(t){this.e.xb.dc()&&this.Ma(),this.state(t),this.$-=t,0>=this.$&&(this.sc=!this.sc,this.$=.75)},i.prototype.Tc=function(){this.ma=(this.ma+1)%w.length,1==this.ma&&this.ma++,this.I&&(this.I.A=this.ma)},i.prototype.Qc=function(){this.ma--,1==this.ma?this.ma--:0>this.ma&&(this.ma=w.length-1),this.I&&(this.I.A=this.ma)},i.prototype.Na=function(t){(this.I=t)?(this.ma=this.I.A,this.Ta.active=!0,this.Ua.active=!0):(this.Ta.active=!1,this.Ua.active=!1)},i.prototype.Da=function(){if(!this.e.U.active){var t=this.e.U;this.state=this.ob,"Options"==t.title&&"Play Level"==t.oa&&(this.active=!1,this.sd.active=!0,this.H.Hb(this.e))}},i.prototype.ob=function(){var t=this.e.V.x,i=this.e.V.y;if(this.e.V.va[0]&&!Y.Ka){this.Na(null);for(var h=0;h<this.H.O.length;h++)if(this.H.O[h].J&&(this.xa=na(t,i,this.H.O[h]),0<this.xa))return this.Na(this.H.O[h]),this.za=new p(this.I.B,this.I.C).nb(new p(t,i)),this.yc=new p(this.I.D,this.I.F).nb(new p(t,i)),this.yb=new p((this.I.B+this.I.D)/2,(this.I.C+this.I.F)/2),void(this.qd=this.I.ec());for(h=0;h<this.H.T.length;h++)if(this.H.T[h].J){if(64>=x(this.H.T[h].ja.x,this.H.T[h].ja.y,t,i))return this.Na(this.H.T[h]),void(this.xa=1);if(this.H.T[h].aa.Ca(t,i)||256>=x(this.H.T[h].x,this.H.T[h].y,t,i))return this.Na(this.H.T[h]),this.za=new p(this.I.x,this.I.y).nb(new p(t,i)),void(this.xa=3)}for(h=0;h<this.H.ha.length;h++)if(this.H.ha[h].J&&144>=x(this.H.ha[h].x,this.H.ha[h].y,t,i)){this.Na(this.H.ha[h]),this.za=new p(this.I.x,this.I.y).nb(new p(t,i));break}}else this.e.V.ya[0]&&!Y.Ka&&(this.I instanceof sa?1==this.xa||2==this.xa?(t=oa(t,i,this.yb.x,this.yb.y,this.qd/2),this.I.B=t.x,this.I.C=t.y,this.I.D=t.x-2*(t.x-this.yb.x),this.I.F=t.y-2*(t.y-this.yb.y)):3==this.xa&&(this.I.B=t+this.za.x,this.I.C=i+this.za.y,this.I.D=t+this.yc.x,this.I.F=i+this.yc.y):this.I instanceof pa?3==this.xa?(this.I.x=t+this.za.x,this.I.y=i+this.za.y,this.I.jc()):1==this.xa&&((t=oa(t,i,this.I.x,this.I.y,60)).Set(t.x-this.I.x,t.y-this.I.y),this.I.Oa(Math.round(180*(Math.atan2(t.y,t.x)-Math.atan2(-1,0))/Math.PI))):this.I instanceof ra&&(this.I.x=t+this.za.x,this.I.y=i+this.za.y))},i.prototype.N=function(t){this.H.N(t,2),this.I&&this.I.ta&&this.I.ta(t,2),this.sc||E(t,"Edit Mode",0,0,"left","top","Yellow")},i}(n)</script><canvas id=main width=900 height=600 oncontextmenu=return!1></canvas>