<!doctype html><title>Mastermind</title><meta name=viewport content="height=device-height,maximum-scale=1"><style>*{margin:0;padding:0}</style><body><script>var e=e||{};e.VERSION="0.0.1",e.plugins=void 0,e.custom=void 0,e.create=function(t,i,r,a,s){var n,o={};if(o.canvas=document.createElement("canvas"),o.canvas.setAttribute("width",1*t),o.canvas.setAttribute("height",1*i),o.canvas.style.backgroundColor="black",document.body.appendChild(o.canvas),o.canvas.ctx=o.canvas.getContext("2d"),o.stage=(c(n={}),n.stage=!0,n.width=o.canvas.width,n.height=o.canvas.height,n.x=0,n.y=0,n.parent=void 0,n),o.key=function(){var e={};return e.leftArrow=d(37),e.upArrow=d(38),e.rightArrow=d(39),e.downArrow=d(40),e.zKey=d(90),e.rKey=d(82),e}(),o.state=void 0,o.load=s||void 0,o.setup=r||void 0,void 0===o.setup)throw new Error("Please supply the setup function in the constructor");function h(){if(requestAnimationFrame(h,o.canvas),void 0===o._fps)l(),o.render(o.canvas,0);else{var e=Date.now(),t=e-o._startTime;for(t>1e3&&(t=o._frameDuration),o._startTime=e,o._lag+=t;o._lag>=o._frameDuration;)o.stage.children.forEach((function(e){!function e(t){t._previousX=t.x,t._previousY=t.y,t.children&&t.children.length>0&&t.children.forEach((function(t){e(t)}))}(e)})),l(),o._lag-=o._frameDuration;var i=o._lag/o._frameDuration;o.render(o.canvas,i)}}function l(){if(o.state&&!o.paused&&o.state(),0!==o.updateFunctions.length)for(var e=0;e<o.updateFunctions.length;e++)(0,o.updateFunctions[e])()}function c(e){e.x=0,e.y=0,e.vx=0,e.vy=0,e.width=0,e.height=0,e.scaleX=1,e.scaleY=1,e.pivotX=.5,e.pivotY=.5,e.rotation=0,e.visible=!0,e.parent=void 0,e.stage=!1,e._alpha=1,e._layer=0,e._previousX=void 0,e._previousY=void 0,e.children=[],e.addChild=function(t){t.parent&&t.parent.removeChild(t),t.parent=e,e.children.push(t)},e.removeChild=function(t){if(t.parent!==e)throw new Error(t+"is not a child of "+e);e.children.splice(e.children.indexOf(t),1)},e.add=function(t){var i=Array.prototype.slice.call(arguments);i.length>1?i.forEach((function(t){e.addChild(t)})):e.addChild(i[0])},e.remove=function(t){var i=Array.prototype.slice.call(arguments);i.length>1?i.forEach((function(t){e.removeChild(t)})):e.removeChild(i[0])},e.setPosition=function(t,i){e.x=t,e.y=i},Object.defineProperties(e,{gx:{get:function(){return this.parent?this.x+this.parent.gx:this.x},enumerable:!0,configurable:!0},gy:{get:function(){return this.parent?this.y+this.parent.gy:this.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:e.x,y:e.y}},enumerable:!0,configurable:!0},alpha:{get:function(){return e.parent._alpha*e._alpha},set:function(t){e._alpha=t},enumerable:!0,configurable:!0},halfWidth:{get:function(){return e.width/2},enumerable:!0,configurable:!0},halfHeight:{get:function(){return e.height/2},enumerable:!0,configurable:!0},centerX:{get:function(){return e.x+e.halfWidth},enumerable:!0,configurable:!0},centerY:{get:function(){return e.y+e.halfHeight},enumerable:!0,configurable:!0}})}function d(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}return o.assetFilePaths=a||void 0,o.paused=!1,o._fps=60,o._startTime=Date.now(),o._frameDuration=1e3/o._fps,o._lag=0,o.interpolate=!0,o.updateFunctions=[],o.scale=1,o.start=function(){o.assetFilePaths?(o.assets.whenLoaded=function(){o.state=void 0,o.setup()},o.assets.load(o.assetFilePaths),o.load&&(o.state=o.load)):o.setup(),h()},o.hidePointer=function(){o.canvas.style.cursor="none"},Object.defineProperties(o,{fps:{get:function(){return o._fps},set:function(e){o._fps=e,o._startTime=Date.now(),o._frameDuration=1e3/o._fps},enumerable:!0,configurable:!0},backgroundColor:{set:function(e){o.canvas.style.backgroundColor=e},enumerable:!0,configurable:!0}}),o.remove=function(e){var t=Array.prototype.slice.call(arguments);if(t[0]instanceof Array){var i=t[0];if(i.length>0)for(var r=i.length-1;r>=0;r--){var a=i[r];a.parent.removeChild(a),i.splice(i.indexOf(a),1)}}else t.length>1?t.forEach((function(e){e.parent.removeChild(e)})):t[0].parent.removeChild(t[0])},o.group=function(e){var t={};(c(t),t.addChild=function(e){e.parent&&e.parent.removeChild(e),e.parent=t,t.children.push(e),t.calculateSize()},t.removeChild=function(e){if(e.parent!==t)throw new Error(e+"is not a child of "+t);t.children.splice(t.children.indexOf(e),1),t.calculateSize()},t.calculateSize=function(){t.children.length>0&&(t._newWidth=0,t._newHeight=0,t.children.forEach((function(e){e.x+e.width>t._newWidth&&(t._newWidth=e.x+e.width),e.y+e.height>t._newHeight&&(t._newHeight=e.y+e.height)})),t.width=t._newWidth,t.height=t._newHeight)},o.stage.addChild(t),e)&&Array.prototype.slice.call(arguments).forEach((function(e){Array.isArray(e)?e.forEach((function(e){t.addChild(e)})):t.addChild(e)}));return t},o.rectangle=function(e,t,i,r,a,s,n){var h={};return c(h),h.mask=!1,h.width=e||32,h.height=t||32,h.fillStyle=i||"red",h.strokeStyle=r||"none",h.lineWidth=a||0,h.x=s||0,h.y=n||0,o.stage.addChild(h),h.render=function(e){e.strokeStyle=h.strokeStyle,e.lineWidth=h.lineWidth,e.fillStyle=h.fillStyle,e.beginPath(),e.rect(-h.width*h.pivotX,-h.height*h.pivotY,h.width,h.height),!0===h.mask?e.clip():("none"!==h.strokeStyle&&e.stroke(),"none"!==h.fillStyle&&e.fill())},h},o.text=function(e,t,i,r,a){var s={};return c(s),s.content=e||"Hello!",s.font=t||"12px sans-serif",s.fillStyle=i||"red",s.textBaseline="top",Object.defineProperties(s,{width:{get:function(){return o.canvas.ctx.measureText(s.content).width},enumerable:!0,configurable:!0},height:{get:function(){return o.canvas.ctx.measureText("M").width},enumerable:!0,configurable:!0}}),o.stage.addChild(s),s.x=r||0,s.y=a||0,s.render=function(e){e.strokeStyle=s.strokeStyle,e.lineWidth=s.lineWidth,e.fillStyle=s.fillStyle,0===s.width&&(s.width=e.measureText(s.content).width),0===s.height&&(s.height=e.measureText("M").width),e.translate(-s.width*s.pivotX,-s.height*s.pivotY),e.font=s.font,e.textBaseline=s.textBaseline,e.fillText(s.content,0,0)},s},o.frame=function(e,t,i,r,a){var s={};return s.image=e,s.x=t,s.y=i,s.width=r,s.height=a,s},o.frames=function(e,t,i,r){var a={};return a.image=e,a.data=t,a.width=i,a.height=r,a},o.filmstrip=function(e,t,i,r){for(var a=o.assets[e].source,s=[],n=a.width/t,h=n*(a.height/i),l=0;l<h;l++){var c,d;c=l%n*t,d=Math.floor(l/n)*i,r&&r>0&&(c+=r+r*l%n,d+=r+r*Math.floor(l/n)),s.push([c,d])}return o.frames(e,s,t,i)},o.sprite=function(e){var t={};if(void 0===e)throw new Error("Sprites require a source");return c(t),t.frames=[],t.loop=!0,t._currentFrame=0,t.setTexture=function(e){if(e.image)if(e.image&&!e.data){if(!(o.assets[e.image].source instanceof Image))throw new Error(e.image+" is not an image file");t.source=o.assets[e.image].source,t.sourceX=e.x,t.sourceY=e.y,t.width=e.width,t.height=e.height,t.sourceWidth=e.width,t.sourceHeight=e.height}else e.image&&e.data&&(t.source=o.assets[e.image].source,t.frames=e.data,t.sourceX=t.frames[0][0],t.sourceY=t.frames[0][1],t.width=e.width,t.height=e.height,t.sourceWidth=e.width,t.sourceHeight=e.height);else e instanceof Array?(t.frames=e,t.source=o.assets[e[0]].source,t.sourceX=o.assets[e[0]].frame.x,t.sourceY=o.assets[e[0]].frame.y,t.width=o.assets[e[0]].frame.w,t.height=o.assets[e[0]].frame.h,t.sourceWidth=o.assets[e[0]].frame.w,t.sourceHeight=o.assets[e[0]].frame.h):(t.tilesetFrame=o.assets[e],t.source=t.tilesetFrame.source,t.sourceX=t.tilesetFrame.frame.x,t.sourceY=t.tilesetFrame.frame.y,t.width=t.tilesetFrame.frame.w,t.height=t.tilesetFrame.frame.h,t.sourceWidth=t.tilesetFrame.frame.w,t.sourceHeight=t.tilesetFrame.frame.h)},t.setTexture(e),t.gotoAndStop=function(e){if(!(t.frames.length>0))throw new Error("Frame number "+e+"doesn't exist");t.frames[0]instanceof Array?(t.sourceX=t.frames[e][0],t.sourceY=t.frames[e][1]):o.assets[t.frames[e]].frame&&(t.source=o.assets[t.frames[e]].source,t.sourceX=o.assets[t.frames[e]].frame.x,t.sourceY=o.assets[t.frames[e]].frame.y,t.sourceWidth=o.assets[t.frames[e]].frame.w,t.sourceHeight=o.assets[t.frames[e]].frame.h,t.width=o.assets[t.frames[e]].frame.w,t.height=o.assets[t.frames[e]].frame.h),t._currentFrame=e},t.x=0,t.y=0,t.frames.length>0&&(o.addStatePlayer(t),Object.defineProperty(t,"currentFrame",{get:function(){return t._currentFrame},enumerable:!1,configurable:!1})),o.stage.addChild(t),t.render=function(e){e.drawImage(t.source,t.sourceX,t.sourceY,t.sourceWidth,t.sourceHeight,-t.width*t.pivotX,-t.height*t.pivotY,t.width,t.height)},t},o.json=function(e){return o.assets[e]},o.addStatePlayer=function(e){var t=0,i=0,r=0,a=0,s=void 0,n=!1;function o(o){l(),r=o[0],a=o[1],i=a-r,0===r&&(i+=1,t+=1),1===i&&(i=2,t+=1),e.fps||(e.fps=12);var c=1e3/e.fps;e.gotoAndStop(r),n||(s=setInterval(h.bind(this),c),n=!0)}function h(){t<i?(e.gotoAndStop(e.currentFrame+1),t+=1):e.loop&&(e.gotoAndStop(r),t=1)}function l(){void 0!==s&&!0===n&&(n=!1,t=0,r=0,a=0,i=0,clearInterval(s))}e.show=function(t){l(),"string"!=typeof t?e.gotoAndStop(t):e.gotoAndStop(e.frames.indexOf(t))},e.play=function(){o([0,e.frames.length-1])},e.stop=function(){l(),e.gotoAndStop(e.currentFrame)},e.playing=n,e.playSequence=o},o.render=function(e,t){var i=e.ctx;i.clearRect(0,0,e.width,e.height);for(var r=0;r<o.stage.children.length;r++)a(o.stage.children[r]);function a(r){if(r.visible&&r.gx<e.width+r.width&&r.gx+r.width>=-r.width&&r.gy<e.height+r.height&&r.gy+r.height>=-r.height){if(i.save(),o.interpolate?(void 0!==r._previousX?r.renderX=(r.x-r._previousX)*t+r._previousX:r.renderX=r.x,void 0!==r._previousY?r.renderY=(r.y-r._previousY)*t+r._previousY:r.renderY=r.y):(r.renderX=r.x,r.renderY=r.y),i.translate(r.renderX+r.width*r.pivotX,r.renderY+r.height*r.pivotY),i.globalAlpha=r.alpha,i.rotate(r.rotation),i.scale(r.scaleX,r.scaleY),r.render&&r.render(i),r.children&&r.children.length>0){i.translate(-r.width*r.pivotX,-r.height*r.pivotY);for(var s=0;s<r.children.length;s++)a(r.children[s])}i.restore()}}},o.assets={toLoad:0,loaded:0,imageExtensions:["png"],jsonExtensions:["json"],whenLoaded:void 0,load:function(e){var t=this;t.toLoad=e.length,e.forEach((function(e){var i=e.split(".").pop();if(-1!==t.imageExtensions.indexOf(i)){var r=new Image;r.addEventListener("load",(function(){r.name=e,t[r.name]={source:r,frame:{x:0,y:0,w:r.width,h:r.height}},t.loadHandler()}),!1),r.src=e}else if(-1!==t.jsonExtensions.indexOf(i)){var a=new XMLHttpRequest,s={};a.open("GET",e,!0),a.addEventListener("readystatechange",(function(){200===a.status&&4===a.readyState&&((s=JSON.parse(a.responseText)).name=e,t[s.name]=s,s.frames?t.createTilesetFrames(s,e):t.loadHandler())})),a.send()}else console.log("File type not recognized: "+e)}))},createTilesetFrames:function(e,t){var i=this,r=t.replace(/[^\/]*$/,""),a=new Image;a.addEventListener("load",(function(){i[r+e.meta.image]={source:a,frame:{x:0,y:0,w:a.width,h:a.height}},Object.keys(e.frames).forEach((function(t){i[t]=e.frames[t],i[t].source=a})),i.loadHandler()}),!1),a.src=r+e.meta.image},loadHandler:function(){this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,this.whenLoaded())}},o.keyboard=d,o.makeDisplayObject=c,void 0!==e.plugins&&e.plugins(o),void 0!==e.custom&&e.custom(o),o},window.ga=e.create,window.addEventListener("load",(function(){window.focus(),document.body.addEventListener("click",(function(e){window.focus()}),!1)})),(e=e||{}).plugins=function(e){e.wait=function(e,t){return setTimeout(t,e)},e.worldCamera=function(e,t){return{width:t.width,height:t.height,_x:0,_y:0,get x(){return this._x},set x(t){this._x=t,e.x=-this._x,e._previousX=e.x},get y(){return this._y},set y(t){this._y=t,e.y=-this._y,e._previousY=e.y},get centerX(){return this.x+this.width/2},get centerY(){return this.y+this.height/2},get rightInnerBoundary(){return this.x+this.width/2+this.width/4},get leftInnerBoundary(){return this.x+this.width/2-this.width/4},get topInnerBoundary(){return this.y+this.height/2-this.height/4},get bottomInnerBoundary(){return this.y+this.height/2+this.height/4},follow:function(t){t.x<this.leftInnerBoundary&&(this.x=t.x-this.width/4),t.y<this.topInnerBoundary&&(this.y=t.y-this.height/4),t.x+t.width>this.rightInnerBoundary&&(this.x=t.x+t.width-this.width/4*3),t.y+t.height>this.bottomInnerBoundary&&(this.y=t.y+t.height-this.height/4*3),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+this.width>e.width&&(this.x=e.width-this.width),this.y+this.height>e.height&&(this.y=e.height-this.height)},centerOver:function(e){this.x=e.x+e.halfWidth-this.width/2,this.y=e.y+e.halfHeight-this.height/2}}},e.scaleToWindow=function(t){var i,r,a,s,n;t=t||"#2C3539",i=window.innerWidth/e.canvas.width,r=window.innerHeight/e.canvas.height,a=Math.min(i,r),e.canvas.style.transformOrigin="0 0",e.canvas.style.transform="scale("+a+")","horizontally"==(s=e.canvas.width>e.canvas.height?e.canvas.width*a<window.innerWidth?"horizontally":"vertically":e.canvas.height*a<window.innerHeight?"vertically":"horizontally")&&(n=(window.innerWidth-e.canvas.width*a)/2,e.canvas.style.marginLeft=n+"px",e.canvas.style.marginRight=n+"px"),"vertically"===s&&(n=(window.innerHeight-e.canvas.height*a)/2,e.canvas.style.marginTop=n+"px",e.canvas.style.marginBottom=n+"px"),e.canvas.style.paddingLeft=0,e.canvas.style.paddingRight=0,e.canvas.style.paddingTop=0,e.canvas.style.paddingBottom=0,e.canvas.style.display="block",document.body.style.backgroundColor=t,e.canvas.scaled=!0;var o=navigator.userAgent.toLowerCase();-1!=o.indexOf("safari")&&(o.indexOf("chrome")>-1||(e.canvas.style.maxHeight="100%",e.canvas.style.minHeight="100%"))},e.progressBar={maxWidth:0,height:0,backgroundColor:"gray",foregroundColor:"white",backBar:null,frontBar:null,percentage:null,assets:null,initialized:!1,create:function(t,i){this.initialized||(this.assets=i,this.maxWidth=e.canvas.width/2,this.backBar=e.rectangle(this.maxWidth,32,this.backgroundColor),this.backBar.x=e.canvas.width/2-this.maxWidth/2,this.backBar.y=e.canvas.height/2-16,this.frontBar=e.rectangle(this.maxWidth,32,this.foregroundColor),this.frontBar.x=e.canvas.width/2-this.maxWidth/2,this.frontBar.y=e.canvas.height/2-16,this.percentage=e.text("0%","28px sans-serif","black"),this.percentage.x=e.canvas.width/2-this.maxWidth/2+12,this.percentage.y=e.canvas.height/2-12,this.initialized=!0)},update:function(){var t=(e.assets.loaded+1)/e.assets.toLoad;this.frontBar.width=this.maxWidth*t,this.percentage.content=Math.floor(100*t)+"%"},remove:function(){e.remove(this.frontBar),e.remove(this.backBar),e.remove(this.percentage)}},e.hitTestRectangle=function(e,t,i){var r,a,s,n;return void 0===i&&(i=!1),i?(s=e.gx+e.halfWidth-(t.gx+t.halfWidth),n=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(s=e.centerX-t.centerX,n=e.centerY-t.centerY),r=e.halfWidth+t.halfWidth,a=e.halfHeight+t.halfHeight,Math.abs(s)<r&&Math.abs(n)<a},e.rectangleCollision=function(e,t,i,r){var a,s,n,o,h,l,c;return void 0===i&&(i=!1),void 0===r&&(r=!1),r?(l=e.gx+e.halfWidth-(t.gx+t.halfWidth),c=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(l=e.centerX-t.centerX,c=e.centerY-t.centerY),s=e.halfWidth+t.halfWidth,n=e.halfHeight+t.halfHeight,Math.abs(l)<s&&Math.abs(c)<n&&((o=s-Math.abs(l))>=(h=n-Math.abs(c))?(c>0?(a="top",e.y=e.y+h):(a="bottom",e.y=e.y-h),i&&(e.vy*=-1)):(l>0?(a="left",e.x=e.x+o):(a="right",e.x=e.x-o),i&&(e.vx*=-1))),a},e.makeTiledWorld=function(t,i){t=e.json(t);var r=e.group();r.tileheight=t.tileheight,r.tilewidth=t.tilewidth,r.width=t.width*t.tilewidth,r.height=t.height*t.tileheight,r.widthInTiles=t.width,r.heightInTiles=t.height,r.objects=[];var a=t.tilesets[0].spacing,s=Math.floor(t.tilesets[0].imagewidth/(t.tilewidth+a));return t.layers.forEach((function(n){var o=e.group();Object.keys(n).forEach((function(e){"width"!==e&&"height"!==e&&(o[e]=n[e])})),o.alpha=n.opacity,r.addChild(o),r.objects.push(o),"tilelayer"===n.type&&n.data.forEach((function(n,h){var l,c,d,u,f,g,y,v,p,m;if(0!==n){y=h%r.widthInTiles,v=Math.floor(h/r.widthInTiles),d=y*r.tilewidth,u=v*r.tileheight,p=(n-1)%s,m=Math.floor((n-1)/s),f=p*r.tilewidth,g=m*r.tileheight,a>0&&(f+=a+a*((n-1)%s),g+=a+a*Math.floor((n-1)/s)),c=e.frame(i,f,g,r.tilewidth,r.tileheight);var w=t.tilesets[0].tileproperties,x=String(n-1);w[x]&&w[x].name?(l=e.sprite(c),Object.keys(w[x]).forEach((function(e){l[e]=w[x][e]})),r.objects.push(l)):l=e.sprite(c),l.x=d,l.y=u,l.index=h,l.gid=n,o.addChild(l)}})),"objectgroup"===n.type&&n.objects.forEach((function(e){e.group=o,o.width=r.width,o.height=r.height,r.objects.push(e)}))})),r.getObject=function(e){return this.searchForObject=function(){var t;if(r.objects.some((function(i){if(i.name&&i.name===e)return t=i,!0})),t)return t;console.log("There is no object with the property name: "+e)},this.searchForObject()},r.getObjects=function(e){var t=Array.prototype.slice.call(arguments),i=[];return r.objects.forEach((function(e){e.name&&-1!==t.indexOf(e.name)&&i.push(e)})),i.length>0||console.log("I could not find those objects"),i},r}};var t,i,a=ga(160,120,(function(){a.backgroundColor="black",function(){t=a.makeTiledWorld("maps/level.json","images/sheet.png"),u=t.getObjects("spawnPos"),(r=k(0,0,8,12)).skin=a.sprite(m("player_")),x(),r.states={up:[0,3],left:[8,11],down:[4,7],right:[12,15],idle:4},r.keyActiveState={isKeyLeft:"left",isKeyRight:"right",isKeyUp:"up",isKeyDown:"down"},W(),r.skin.show(r.states.idle),r.isFound=!1,r.doorKey=null,r.isWin=!1,t.getObject("enemyLayer").children.forEach((function(e){var t=a.sprite(m("cop_"));t.eSpawn=e,t.directions=[e.name],t.direction=e.name,t.isCBoxHitCheck=!0,t.enemyVsCbox=!1,t.cBoxTimeout=null,t.isBoxHitCheck=!0,t.enemyVsBox=!1,t.boxTimeout=null,t.x=e.x,t.y=e.y,t.states={up:[0,3],left:[8,11],down:[4,7],right:[12,15],idle:4},t.ray=a.sprite("uray.png"),t.ray.alpha=.3,t.ray.x=t.x,t.ray.y=t.y,t.updateRay=function(){this.ray.width=32,this.ray.height=16;switch(this.hArea||(this.hArea=k(0,0,this.ray.halfWidth,this.ray.halfHeight,"blue"),this.hArea.hAreaVsPlayer=!1,this.hArea.isHAreaHitCheck=!0,this.hArea.hAreaTimeout=null),this.direction){case"eUp":this.ray.x=this.x-this.halfWidth,this.ray.y=this.y-this.height,this.ray.scaleX=1,this.ray.rotation=1.6,this.hArea.x=this.ray.x+this.halfWidth+0;break;case"eDown":this.ray.x=this.x-this.halfWidth,this.ray.y=this.y+this.height,this.ray.scaleX=1,this.ray.rotation=4.7,this.hArea.x=this.ray.x+this.halfWidth+0;break;case"eLeft":this.ray.x=this.x-this.width-this.halfWidth,this.ray.y=this.y+2,this.ray.scaleX=1,this.ray.rotation=0,this.hArea.x=this.ray.x+this.ray.halfWidth-0;break;case"eRight":this.ray.x=this.x+this.halfWidth,this.ray.y=this.y+2,this.ray.scaleX=-1,this.ray.rotation=0,this.hArea.x=this.ray.x+0}this.hArea.y=this.ray.y+this.ray.halfHeight-this.hArea.halfHeight,this.hArea.rotation=this.ray.rotation,this.hArea.scaleX=this.ray.scaleX},t.defaultProps={x:t.x,y:t.y,direction:t.direction},t.updateRay(),f.push(t),g.push(t.ray),y.push(t.hArea),K(t,e.name)})),(s=a.rectangle(a.canvas.width,a.canvas.height,"black")).alpha=.3,s.defaultProps={alpha:s.alpha},s.reset=!0;var e=a.rectangle(a.canvas.width-8,4,"black"),w=a.rectangle(a.canvas.width-9,3,"pink");w.x=e.x+.5,w.y=e.y+.5,(d=a.group(e,w)).fg=w,d.bg=e,d.defaultProps={interval:500,fg:{width:w.width}},d.reset=!0,_(),E(),n=t.getObject("wallLayer").children,o=t.getObject("cBoxLayer").children,h=t.getObject("keyLayer").children,c=t.getObject("doorLayer").children,l=t.getObject("boxLayer").children,h.forEach((function(e){e.defaultProps={x:e.x,y:e.y,visible:e.visible,alpha:e.alpha}})),c.forEach((function(e){e.defaultProps={x:e.x,y:e.y,visible:e.visible,alpha:e.alpha}})),l.forEach((function(e){e.defaultProps={x:e.x,y:e.y}}));var b=L("Arrow keys Moves"),S=L("by redchilligame.com");S.y=b.y+16,v.move=a.group(b,S),v.move.x=u[0].x,v.move.y=u[0].y+16,A();var B=L("Press and hold Z"),X=L("with Arrow keys"),j=L("to Push");X.y=B.y+B.height,j.y=X.y+X.height,v.push=a.group(B,X,j),v.push.x=l[2].x-v.push.halfWidth,v.push.y=l[2].y-16,v.push.visible=!1,v.push.isTrigger=!0;var O=L("At last... Freedom!"),F=L("Press R to restart");F.y=O.y+4*O.height,v.win=a.group(O,F),v.win.visible=!1,H(),i=a.group(t,g,f,y,r.skin,r,d,s,v.move,v.push,v.win),camera=a.worldCamera(i,a.canvas),camera.centerOver(r),a.key.zKey.press=function(){r.isPush=!0},a.key.zKey.release=function(){r.isPush=!1},a.key.rKey.press=function(){p=0,P()},a.key.leftArrow.press=function(){T("isKeyLeft"),r.skin.playSequence(r.states.left)},a.key.leftArrow.release=function(){r.isKeyLeft=!1,C("isKeyLeft")},a.key.rightArrow.press=function(){T("isKeyRight"),r.skin.playSequence(r.states.right)},a.key.rightArrow.release=function(){r.isKeyRight=!1,C("isKeyRight")},a.key.upArrow.press=function(){T("isKeyUp"),r.skin.playSequence(r.states.up)},a.key.upArrow.release=function(){r.isKeyUp=!1,C("isKeyUp")},a.key.downArrow.press=function(){T("isKeyDown"),r.skin.playSequence(r.states.down)},a.key.downArrow.release=function(){r.isKeyDown=!1,C("isKeyDown")}}(),a.state=X}),["maps/level.json","images/sheet.json","images/sheet.png"],(function(){a.progressBar.create(a.canvas,a.assets),a.progressBar.update()}));a.start(),a.fps=30,a.scaleToWindow(),window.addEventListener("resize",(function(e){a.scaleToWindow()})),a.hidePointer();var r,n,s,o,h,c,l,d,u=[],f=[],g=[],y=[],p=0,v={};function m(e){var t=[];for(var i in a.assets)i.includes(e)&&t.push(i);return t}function w(){r.isPush=!1,r.x-=r.vx,r.y-=r.vy,r.vx=0,r.vy=0}function x(e){e=void 0!==e?e:p,r.x=u[e].x+r.width/2,r.y=u[e].y+r.height/4}function b(e){e=e||1,(r.isKeyLeft||r.isKeyRight)&&(r.vx*=2*e),(r.isKeyUp||r.isKeyDown)&&(r.vy*=2*e),w()}function k(e,t,i,r,s,n){var o=a.rectangle(i,r,s||"blue");return o.alpha=n||0,o.x=e||0,o.y=t||0,o}function A(){v.move.visible=!0,v.move.moveTimeout&&(clearTimeout(v.move.moveTimeout),v.move.moveTimeout=null),v.move.moveTimeout=setTimeout((function(){v.move.visible=!1}),5e3)}function T(e){r.isKeyLeft?r.keyActive="isKeyLeft":r.isKeyRight?r.keyActive="isKeyRight":r.isKeyUp?r.keyActive="isKeyUp":r.isKeyDown?r.keyActive="isKeyDown":r.keyActive="",r.isKeyLeft=!1,r.isKeyRight=!1,r.isKeyUp=!1,r.isKeyDown=!1,r.hasOwnProperty(e)&&(r[e]=!0)}function C(e){if(r.keyActive&&r.keyActive!==e){r[r.keyActive]=!0;var t=r.keyActiveState[r.keyActive];r.skin.playSequence(r.states[t])}else r.keyActive=""}function W(){r.skin.x=r.x-r.halfWidth,r.skin.y=r.y-r.halfHeight/2}function _(){d.x=s.x+4,d.y=s.y+1}function H(){v.win.x=s.x+s.width/2-v.win.halfWidth-16,v.win.y=s.y+s.height/2-32}function K(e,t){var i=e.directions.length<=1;switch(t){case"eUp":e.playSequence(e.states.up),i&&e.directions.push("eDown");break;case"eDown":e.playSequence(e.states.down),i&&e.directions.push("eUp");break;case"eLeft":e.playSequence(e.states.left),i&&e.directions.push("eRight");break;case"eRight":e.playSequence(e.states.right),i&&e.directions.push("eLeft")}}function S(e){e.forEach((function(e){for(var t in e.defaultProps)e[t]=e.defaultProps[t];e.hasOwnProperty("eSpawn")&&(e.updateRay(),K(e,e.direction))}))}function E(e){e=e||d.defaultProps.interval,d.reset&&(d.reset=!1,d.alpha=.5,d.fg.width=d.defaultProps.fg.width,d.barInterval&&(clearInterval(d.barInterval),d.barInterval=null),d.barInterval=setInterval((function(){r.isWin||(d.fg.width-=1,d.fg.width<=0&&(d.fg.width=d.defaultProps.fg.width,d.reset=!0,P()))}),e))}function B(){s.reset&&(s.reset=!1,s.alpha=1,v.move.visible=!1,s.resetInterval&&(clearInterval(s.resetInterval),s.resetInterval=null),s.resetInterval=setInterval((function(){s.alpha-=.01,s.alpha<=s.defaultProps.alpha&&(s.alpha=s.defaultProps.alpha,s.reset=!0,A(),clearInterval(s.resetInterval))}),25))}function P(e){!function(e){r.isWin=!1,r.isFound=!1,r.doorKey=null,x(e)}(e),S(f),S(h),S(c),S(l),B(),E(),v.push.isShow=!1,v.push.visible=!1,v.push.isTrigger=!0,v.win.visible=!1}function L(e){return a.text(e,"6px","#fff",0,0)}function X(){r.isKeyRight?(r.vx=1,r.vy=0):r.isKeyLeft?(r.vx=-1,r.vy=0):r.isKeyUp?(r.vy=-1,r.vx=0):r.isKeyDown?(r.vy=1,r.vx=0):(r.vx=0,r.vy=0,r.skin.show(r.states.idle)),W(),r.x+=r.vx,r.y+=r.vy,camera.follow(r),s.x=camera.x,s.y=camera.y,_(),n.forEach((function(e){a.hitTestRectangle(r,e)&&w()})),f.forEach((function(e){switch(e.direction){case"eUp":e.vy=-.8;break;case"eDown":e.vy=.8;break;case"eLeft":e.vx=-.8;break;case"eRight":e.vx=.8}for(var t=0,i=o.length;t<i;t++)if(e.enemyVsCbox=a.hitTestRectangle(e,o[t]),e.enemyVsCbox&&e.isCBoxHitCheck){e.isCBoxHitCheck=!1;for(var r=0,s=e.directions.length;r<s;r++)if(e.direction===e.directions[r]){e.direction=r===s-1?e.directions[0]:e.directions[1],K(e,e.direction);break}e.cBoxTimeout&&(clearTimeout(e.cBoxTimeout),e.cBoxTimeout=null),e.cBoxTimeout=setTimeout(function(){e.isCBoxHitCheck=!0}.bind(this),1e3);break}for(var n=0,h=l.length;n<h;n++){var c=l[n];if(e.enemyVsBox=a.hitTestRectangle(e,c),e.enemyVsBox&&e.isBoxHitCheck&&e.isCBoxHitCheck){e.isBoxHitCheck=!1;for(var d=0,u=e.directions.length;d<u;d++)if(e.direction===e.directions[d]){e.direction=d===u-1?e.directions[0]:e.directions[1],K(e,e.direction);break}e.boxTimeout&&(clearTimeout(e.boxTimeout),e.boxTimeout=null),e.boxTimeout=setTimeout(function(){e.isBoxHitCheck=!0}.bind(this),1500);break}}e.x+=e.vx,e.y+=e.vy,e.updateRay()})),y.forEach((function(e){e.hAreaVsPlayer=a.hitTestRectangle(e,r),e.hAreaVsPlayer&&e.isHAreaHitCheck&&!r.isFound&&(e.isHAreaHitCheck=!1,r.isFound=!0,s.reset=!0,d.reset=!0,e.hAreaTimeout&&(clearTimeout(e.hAreaTimeout),e.hAreaTimeout=null),e.hAreaTimeout=setTimeout(function(){e.isHAreaHitCheck=!0}.bind(this),1e3))})),r.isFound&&P(),h.forEach((function(e){a.hitTestRectangle(e,r)&&1===e.alpha&&e.visible&&(e.alpha=.5,r.doorKey=e),e.alpha<1&&e.visible&&(e.x=r.x-r.halfWidth,e.y=r.y-r.skin.height)})),c.forEach((function(e,t){var i=a.hitTestRectangle(e,r);i&&p>=4&&t===c.length-1&&!r.isWin&&(r.isWin=!0,s.alpha=1,v.win.visible=!0,H()),i&&r.doorKey&&(e.visible=!1,r.doorKey.visible=!1,r.doorKey=null,p+=1,d.reset=!0,E(p*d.defaultProps.interval)),i&&!r.doorKey&&e.visible&&w()})),l.forEach((function(e,t){var i,s,o,h=a.hitTestRectangle(e,r);h&&!v.push.isShow&&2===t&&v.push.isTrigger&&(v.push.isShow=!0,v.push.isShow&&(v.push.isShow=!1,v.push.visible=!0,v.push.isTrigger=!1,v.push.pushTimeout&&(clearTimeout(v.push.pushTimeout),v.push.pushTimeout=null),v.push.pushTimeout=setTimeout((function(){v.push.visible=!1}),5e3))),h&&!r.isPush&&w();for(var d=0,u=n.length;d<u&&!(i=a.rectangleCollision(e,n[d]));d++);for(var f=0,g=c.length;f<g&&!(o=a.rectangleCollision(e,c[f]));f++);if(h&&r.isPush)for(var y=0,p=l.length;y<p&&(e===l[y]||!(s=a.rectangleCollision(e,l[y])));y++);!s&&h&&r.isPush&&(i?b():(r.isKeyLeft&&(e.x-=1),r.isKeyRight&&(e.x+=1),r.isKeyUp&&(e.y-=1),r.isKeyDown&&(e.y+=1))),s&&h&&r.isPush&&b(2),o&&!s&&h&&b(),s&&o&&h&&b(2)}))}</script>