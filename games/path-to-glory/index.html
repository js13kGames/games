<meta name="viewport" content="width=device-width,maximum-scale=1.01"><title>PATH TO GLORY - js13kGames 2023</title><style>*{margin:0;width:100%;height:100%;position:relative;touch-action:none;user-select:none}body{background:#000}#t{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}#g{display:block}</style><div id="t"><canvas id="g"></canvas></div><script>let w=window,_g,$,bf,gl;_s=CanvasRenderingContext2D.prototype,bw=navigator.userAgent.match(/andro|ipho|ipa|ipo/i)?1:0,bd=(t,i,e)=>i<t?t:i>e?e:i,bv=(t,i,e)=>t<=i&&i<=e||t>=i&&i>=e,T=(t,i)=>random()*(i-t)+t,es=(t,i,e,s)=>hypot(t-e,i-s),_U=(t,i)=>es(t.x,t.y,i.x,i.y),iG=t=>iF(t,PI),_P=(t,i)=>atan2(i.y-t.y,i.x-t.x),iE=(t,i)=>round(t/i)*i,bc=t=>t[~~(random()*t.length)],_f=(t,i,e)=>bd(0,e,1)*(i-t)+t,iD=t=>t,eq=t=>1-pow(1-t,5),iF=(t,i)=>((t%=2*i)>i&&(t-=2*i),t<-i&&(t+=2*i),t),Object.getOwnPropertyNames(Math).forEach(t=>w[t]=w[t]||Math[t]),N=2*PI;class iC{_r(t){t.J=this,t.bb=this._d||new ba,t.d_(),this._d=t}C(t){this._d.C(t)}}class ba{constructor(){this.D=0}get _B(){return 0}get cg(){return 0}get _o(){return 1}get ay(){return 0}d_(){}C(t){this.D+=t}}d$=({o:t,bu:i,cZ:e,gk:s,b_:h})=>{let{F:a}=t,l=new iC,n=[.7,.8,.9,1,3];i=i||1,e=e||0,h=h||0;class r extends ba{C(i){super.C(i),0===t.ax&&l._r(new u),t.D-t.cf<h&&l._r(new b)}}class o extends r{get _B(){return _f(this.bb._B,0,this.D/.1)}get cg(){return _f(this.bb.cg,0,this.D/.1)}get _o(){return t.aZ?.5:1}C(t){super.C(t),a._n?l._r(new _):a._k?l._r(new d):a._A&&l._r(new c)}}class _ extends r{get _o(){return.5}get cg(){return _f(0,1,this.D/.1)}get _B(){return _f(0,-1,this.D/.1)}get iz(){return 1}get iy(){return this.D<e}C(t){super.C(t),a._n||l._r(new o)}}class c extends ba{get _B(){return _f(this.bb._B,-1,this.D/.15)}d_(){this.ce=t.F.M,t._A(t.F.M,200,.3),aY(...[1.99,,427,.01,,.07,,.62,6.7,-.7,,,,.2,,,.11,.76,.05]),t.cc(.15)}C(t){super.C(t),this.D>.3&&l._r(new o)}}class d extends r{constructor(t=0){super(),this._x=t}get _o(){return.5}get ay(){return this.D/i}get _B(){return _f(this.bb._B,-1,this.ay)}C(i){let{ay:e}=this;if(super.C(i),!a._k){let t=this.D>=1?n.length-1:this._x;l._r(new f(t))}if(e<1&&this.ay>=1){let i=t.g.add(new iw);i.x=t.x-20*t.af,i.y=t.y-60}}}class f extends r{constructor(t=0){super(),this._x=t,this.en=.4*-min(3,this._x+1)}get _B(){return this.D<.05?_f(this.bb._B,this.en,this.D/.05):_f(this.en,1,(this.D-.05)/(.15-.05))}d_(){t.iv(),this.gi=new iu(t,this._x==n.length-1?"#ff0":"#fff",this.en,0)}C(i){if(super.C(i),this.D>=.05&&(t.g.add(this.gi),this.gi.cX=this._B),a._k&&(this.ir=1),a._A&&(this.iq=1),this.D>.15){if(t.strike(n[this._x]),this.iq)return void l._r(new c);l._r(this._x<3?this.ir?new d(this._x+1):new $(this._x):new w)}}}class $ extends r{constructor(t){super(),this._x=t}get _B(){return-1*min(1,this.D/.05)+1}C(t){super.C(t),a._k&&s||(this.im=1),this.D>.3?l._r(new o):a._k&&this.im?l._r(new d(this._x+1)):a._n?l._r(new _):a._A&&l._r(new c)}}class w extends r{get _B(){return-1*min(this.D/.5,1)+1}C(t){super.C(t),this.D>.5?l._r(new o):a._A&&l._r(new c)}}class u extends ba{get _B(){return _f(this.bb._B,1,this.D/.2)}get el(){return 1}get _o(){return.5}d_(){t.il||t.cb("Exhausted"),t.kb=0}C(i){super.C(i),t.ax>=1&&l._r(new o)}}class b extends ba{get _B(){return this.bb._B}get _o(){return.5}C(t){super.C(t),this.D>=h&&l._r(new o)}}return l._r(new o),l},ca=(t,i,e)=>{let s=document.createElement("canvas");return s.width=t,s.height=i,e(s.getContext("2d"),s)||s},_s.slice=(t,i,e)=>{$.beginPath(),i?($.moveTo(-t,-t),$.lineTo(t,-t)):($.lineTo(-t,t),$.lineTo(t,t)),$.lineTo(t,-t*e),$.lineTo(-t,t*e),$.clip()},_s.G=function(t){let{U:i}=this;this.save(),t(),this.restore(),this.U=i||(t=>t)},_s.U=t=>t,_s.c_=function(t){this.G(()=>{this.aX=1,this.U=()=>"rgba(0,0,0,.2)",$.scale(1,.5),$.transform(1,0,.5,1,0,0),t()}),this.G(()=>{this.aX=0,t()})},ej=ca(50,50,(t,i)=>{t.fillStyle="#fff",t.translate(i.width/2,i.width/2);for(let e=0,s=0;e<1;e+=.05,s++){let h=s%2?i.width/2:i.width/3;t.lineTo(cos(e*N)*h,sin(e*N)*h)}t.fill(),t.font="bold 18pt Arial",t.fillStyle="#f00",t.textAlign="center",t.textBaseline="middle",t.fillText("!!!",0,0)}),_s.bs=function(){with(this)G(()=>{fillStyle=U("#444"),fillRect(-10,-2,20,4),fillRect(-3,0,6,12),fillStyle=U("#fff"),beginPath(),moveTo(-3,0),lineTo(-5,-35),lineTo(0,-40),lineTo(5,-35),lineTo(3,0),fill()})},_s.gh=function(){with(this)G(()=>{fillStyle=U("#634"),fillRect(-2,12,4,-40),translate(0,-20);let t=10;fillStyle=U("#eee"),beginPath(),arc(0,0,t,-PI/4,PI/4),arc(0,t*hypot(1,1),t,-PI/4,3*-PI/4,1),arc(0,0,t,3*PI/4,3*-PI/4),arc(0,-t*hypot(1,1),t,3*PI/4,PI/4,1),fill()})},_s.cW=function(){with(this)G(()=>{fillStyle=U("#fff");for(let[t,i]of[[.8,U("#fff")],[.6,U("#888")]])fillStyle=i,scale(t,t),beginPath(),moveTo(0,-15),lineTo(15,-10),lineTo(12,10),lineTo(0,25),lineTo(-12,10),lineTo(-15,-10),fill()})},_s.ei=function(o,W){with(this)G(()=>{let{D:t}=o;translate(0,-32),G(()=>{fillStyle=U(W),translate(-6,12),o.F._I&&rotate(-sin(t*N*4)*PI/16),fillRect(-4,0,8,20)}),G(()=>{fillStyle=U(W),translate(6,12),o.F._I&&rotate(sin(t*N*4)*PI/16),fillRect(-4,0,8,20)})})},_s.cV=function(o,W,width=25){with(this)G(()=>{let{_O:t}=o;translate(0,-32),translate(0,.5*sin(t*N/5)),rotate(sin(t*N/5)*PI/128),fillStyle=U(W),o.F._I&&rotate(-sin(t*N*4)*PI/64),fillRect(-width/2,-15,width,30)})},_s.cU=function(o,W,gf=0){with(this)G(()=>{let{_O:t}=o;fillStyle=U(W),translate(0,-54),o.F._I&&rotate(-sin(t*N*4)*PI/32),fillRect(-6,-7,12,15),fillStyle=U(gf),gf&&fillRect(4,-5,-6,4)})},_s.ge=function(o){with(this)G(()=>{fillStyle=U("#ff0"),translate(0,-70),beginPath(),lineTo(-8,0),lineTo(-4,6),lineTo(0,0),lineTo(4,6),lineTo(8,0),lineTo(8,12),lineTo(-8,12),fill()})},_s.gd=function(){this.fillStyle=this.U("#444"),this.fillRect(-3,10,6,-40)},_s.eh=function(o,W,ij){with(this)G(()=>{if(!o._c)return;let{_O:t}=o;translate(11,-42),fillStyle=U(W),o.F._I&&rotate(-sin(t*N*4)*PI/32),rotate(o.J._d._B*PI/2),rotate(sin(t*N/5)*PI/32),fillRect(0,-3,20,6),translate(18,-6),ij()})},_s.eg=function(o,ii){with(this)G(()=>{let{_O:t}=o;translate(0,-32),fillStyle=U(ii),translate(-10,-8),o.F._I&&rotate(-sin(t*N*4)*PI/32),rotate(PI/3),rotate(o.J._d.cg*-PI/3),rotate(sin(t*N/5)*PI/64);let i=10+15*o.J._d.cg;fillRect(0,-3,i,6),G(()=>{translate(i,0),cW()})})},_s.ef=function(t,i){t._c&&t.J._d.el&&this.G(()=>{this.translate(0,i),this.fillStyle=this.U("#ff0");for(let i=0;i<1;i+=.15){let e=i*N+t.D*PI;this.fillRect(15*cos(e),15*sin(e)*.5,4,4)}})},_s.gb=function(o){with(this)G(()=>{if(!o._c)return;let t=o.J._d.ay;t>0&&!this.aX&&(strokeStyle="rgba(255,0,0,1)",fillStyle="rgba(255,0,0,.5)",globalAlpha=_f(.5,0,t),lineWidth=10,beginPath(),scale(1-t,1-t),ellipse(0,0,o.c$,o.br,0,0,N),fill(),stroke())})},_s.ga=function(o){with(this)G(()=>{if(o._c&&(translate(0,-100+bc([-2,2])),o.J._d.ay>0&&!aX)){let t=min(1,2*o.J._d.D/.25);scale(t,t),drawImage(ej,-ej.width/2,-ej.height/2)}})},g_=ca(400,1,t=>{let i=t.createLinearGradient(-200,0,200,0);return i.addColorStop(0,"#900"),i.addColorStop(1,"#f44"),i}),g$=ca(400,1,t=>{let i=t.createLinearGradient(-200,0,200,0);return i.addColorStop(0,"#07f"),i.addColorStop(1,"#0ef"),i});class bZ{constructor(t){this.cT=t,this.value=this.aW=1,this.ee=.5}C(t){this.aW+=bd(.5*-t,this.cT()-this.aW,t*this.ee)}_q(t,i,e,s,h){function a(t,i,e,h){$.G(()=>{let a=_f(i/2,t,e);0!==e&&($.translate(-t/2,0),$.fillStyle=h,$.beginPath(),$.lineTo(0,i/2),s||($.lineTo(i/2,0),$.lineTo(a-i/2,0)),$.lineTo(a,i/2),$.lineTo(a-i/2,i),$.lineTo(i/2,i),$.fill())})}$.G(()=>{$.G(()=>{$.globalAlpha*=.5,a(t+8,i+4,1,"#000")}),$.translate(0,2),a(t,i,this.aW,"#fff"),a(t,i,min(this.aW,this.cT()),e),$.globalAlpha*=.5,$.fillStyle="#000";for(let e=1/h;e<1;e+=1/h)$.fillRect(e*t-t/2,0,1,i)})}}ig=ca(1,1,t=>{let i=t.createLinearGradient(0,0,0,-150);return i.addColorStop(0,"#888"),i.addColorStop(.7,"#eee"),i.addColorStop(1,"#888"),i}),_s.fY=function(aV){with(this){textBaseline="alphabetic",textAlign="left",fillStyle=ig,strokeStyle="#000",lineWidth=4,shadowColor="#000";let x=0;for(let[L,_T,offsetWidth]of aV)font=_T+"px Times New Roman",x+=measureText(L).width+(offsetWidth||0);translate(-x/2,0),x=0;for(let[L,_T,offsetWidth]of aV)font=_T+"px Times New Roman",shadowBlur=5,strokeText(L,x,0),shadowBlur=0,fillText(L,x,0),x+=measureText(L).width+(offsetWidth||0);return x}},_s.fX=function(L){with(this){textBaseline="middle",textAlign="center",strokeStyle="#000",lineWidth=4,font="18pt Times New Roman";let width=measureText(L).width+20;fillStyle="rgba(0,0,0,.5)",fillRect(-width/2,0,width,40),fillStyle="#fff",strokeText(L,0,20),fillText(L,0,20)}};let _z={};onkeydown=t=>{27!=t.keyCode&&80!=t.keyCode||(bf=!bf,fW(bf?0:.5)),_z[t.keyCode]=1},onkeyup=t=>_z[t.keyCode]=0,onblur=onfocus=()=>{_z={},bY=bX=0},bX=0,bY=0,eb={x:0,y:0},onmousedown=t=>2==t.button?bY=1:bX=1,onmouseup=t=>2==t.button?bY=0:bX=0,onmousemove=t=>fV(t,_g,eb),oncontextmenu=t=>t.preventDefault(),fV=(t,i,e)=>{if(!i)return;let s=i.getBoundingClientRect();e.x=(t.pageX-s.left)/s.width*i.width,e.y=(t.pageY-s.top)/s.height*i.height};class ie{constructor(){this.x=this.y=0,this._p={x:0,y:0},this.bq=-1}_q(){if(this.bq<0)return;let t=bd(0,(_U(this,this._p)-50)/100,1),i=50*(1-t);__.globalAlpha=_f(.5,0,t),__.strokeStyle="#fff",__.lineWidth=2,__.fillStyle="rgba(0,0,0,0.5)",__.beginPath(),__.arc(this.x,this.y,i*devicePixelRatio,0,N),__.fill(),__.stroke(),__.globalAlpha=.5,__.fillStyle="#fff",__.beginPath(),__.arc(this._p.x,this._p.y,30*devicePixelRatio,0,N),__.fill()}}class ea{constructor(t,i,e){this.x=t,this.y=i,this.bp=e}_q(){__.translate(this.x(),this.y()),__.scale(devicePixelRatio,devicePixelRatio),__.strokeStyle="#fff",__.lineWidth=2,__.fillStyle=this.bW?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",__.beginPath(),__.arc(0,0,35,0,N),__.fill(),__.stroke(),__.font="16pt Courier",__.textAlign="center",__.textBaseline="middle",__.fillStyle="#fff",__.fillText(this.bp,0,0)}}e_=t=>{for(let i of fS){i.bW=0;for(let e of t)fV(e,_S,e),abs(i.x()-e.x)<35*devicePixelRatio&&abs(i.y()-e.y)<35*devicePixelRatio&&(i.bW=1)}let i;for(let e of t)if(e.identifier===_H.bq||e.x<_S.width/2){i=e;break}i?(_H.bq<0&&(_H.x=i.x,_H.y=i.y),_H.bq=i.identifier,_H._p.x=i.x,_H._p.y=i.y):_H.bq=-1},ontouchstart=t=>{bw=1,t.preventDefault(),e_(t.touches)},ontouchmove=t=>{t.preventDefault(),e_(t.touches)},ontouchend=t=>{t.preventDefault(),e_(t.touches),onclick&&onclick()},fR=()=>{_S.style.display=1==bw?"block":"hidden",_S.width=innerWidth*devicePixelRatio,_S.height=innerHeight*devicePixelRatio;for(let t of fS.concat([_H]))__.G(()=>t._q());requestAnimationFrame(fR)},_S=document.createElement("canvas"),__=_S.getContext("2d"),fS=[ic=new ea(()=>_S.width-175*devicePixelRatio,()=>_S.height-75*devicePixelRatio,"ATK"),ib=new ea(()=>_S.width-75*devicePixelRatio,()=>_S.height-75*devicePixelRatio,"DEF"),ia=new ea(()=>_S.width-125*devicePixelRatio,()=>_S.height-150*devicePixelRatio,"ROLL")],_H=new ie,1===bw&&(document.body.appendChild(_S),fR());class e${_w(t){this.o=t}C(){}}class _Z extends e${_w(t){return super._w(t),new Promise((t,i)=>{this.dZ=t,this.bV=i})}C(){let t=_v(this.o.g.R("A"));t&&this.ad(t)}ad(t){}_C(){let{dZ:t}=this;this.bU(),t&&t()}cR(t){let{bV:i}=this;this.bU(),i&&i(t)}bU(){this.bV=0,this.bV=0}}class i$ extends _Z{constructor(){super(),this.aL=new Set}C(t){super.C(t);for(let i of this.aL.values())i.C(t)}async _w(t){super._w(t),await this.fQ(t)}async fQ(){}ad(t){this.o.F._Y.x=t.x,this.o.F._Y.y=t.y}aS(t){return this.race([t])}async race(t){try{await Promise.race(t.map(t=>(this.aL.add(t),t._w(this.o))))}finally{for(let i of t)i.cR(Error()),i._C(),this.aL.delete(i)}}async ka(t){for(let i of t)await this.aS(i)}}class dY extends _Z{constructor(t){super(),this._j=t}_w(t){return this.dW=t.D+this._j,super._w(t)}ad(){this.o.D>this.dW&&this._C()}}class fP extends _Z{constructor(t){super(),this._j=t}_w(t){return this.dW=t.D+this._j,super._w(t)}ad(){this.o.D>this.dW&&this.cR(Error())}}class fO extends _Z{ad(){_v(this.o.g.R("at")).hZ(this.o)&&this._C()}}class hY extends _Z{ad(){_v(this.o.g.R("at")).dU(this.o),this._C()}}class fN extends _Z{constructor(t,i){super(),this.V=t,this._i=i,this.M=random()*N}ad(t){let{F:i}=this.o;i._I=0,this.o.fM(t,this.V,this._i,PI/2)?this._C():(i._I=1,i.M=_P(this.o,{x:t.x+cos(this.M)*this.V,y:t.y+sin(this.M)*this._i}))}}class hX extends _Z{constructor(t){super(),this.dT=t}ad(){let{F:t}=this.o;t._k=1,this.o.J._d.ay>=this.dT&&(t._k=0,this._C())}}class hW extends _Z{constructor(t,i){super(),this.V=t,this._i=i}ad(t){this.o.F._I=0,this.o.fM(t,this.V,this._i,PI/2)?(this.o.F._I=1,this.o.F.M=_P(t,this.o)):this._C()}bU(){this.o.F._I=0}}class hV extends _Z{ad(){this.o.F._n=1}bU(){this.o.F._n=0}}class hU extends _Z{ad(){this.o.F._A=1}bU(){this.o.F._A=0}}class Y{constructor(){this.x=this.y=this.ac=this.D=0,this._y=[],this.S=new hT,this.aw=1/0,this._X=1}get z(){return this.y}get aZ(){if(this.g)for(let t of this.g.R("aR"))if(t.hS(this))return 1}C(t){this.D+=t}_q(){let t=_v(this.g.R("B"));bv(t.x-640-this.aw,this.x,t.x+640+this.aw)&&bv(t.y-360-this.aw,this.y,t.y+360+this.aw)&&(this.S.reset(),this._$(t))}_$(t){}_l(){this.g._l(this)}aK(t){$.translate(t.x,t.y),$.scale(1/t._N,1/t._N),$.translate(-640,-360)}}class hR extends Y{constructor(){super(),this._y.push("B"),this.cQ=1,this._X=0,this.cP=-640}get _N(){return _f(1.2,3,(this.cQ-1)/3)}C(t){super.C(t);for(let i of this.g.R("A")){let e={x:i.x,y:i.y-60},s=_U(this,e),h=_P(this,e),a=min(s,s*t*3);this.x+=a*cos(h),this.y+=a*sin(h)}this.x=max(this.cP,this.x)}bT(t){return this.hQ&&this.hQ._l(),this.g.add(new _h(this,"cQ",this.cQ,t,1)).await()}}class _h extends Y{constructor(t,i,e,s,h,a=iD){super(),this.cO=t,this.aQ=i,this.dS=e,this.bS=s,this._j=h,this.dR=a,this._X=t._X,this.C(0)}await(){return new Promise(t=>this._C=t)}C(t){super.C(t);let i=this.D/this._j;this.cO[this.aQ]=_f(this.dS,this.bS,this.dR(i)),i>1&&(this._l(),this._C&&this._C())}}class hP extends Y{constructor(t){super(),this.A=t}get z(){return 9994}_$(){1!=bw&&($.translate(this.A.F._Y.x,this.A.F._Y.y),$.fillStyle="#000",$.rotate(PI/4),$.fillRect(-15,-5,30,10),$.rotate(PI/2),$.fillRect(-15,-5,30,10))}}class hO extends Y{get z(){return-9992}_$(t){$.strokeStyle="#dc9",$.lineWidth=70,$.fillStyle="#fff",$.beginPath();for(let i=iE(t.x-2560,300);i<t.x+1280;i+=300){let t=this.g.aJ(i);$.lineTo(i,t)}$.stroke()}}class hN extends Y{constructor(){super(),this._y.push("at"),this.bR=0,this.cN=new Set}hZ(t){this.dU(t);let{av:i}=t;if(!(this.bR+i>6))return this.bR+=i,this.cN.add(t),1}dU(t){if(this.cN.has(t)){let{av:i}=t;this.bR-=i,this.cN.delete(t)}}_$(t){}}class iw extends Y{get z(){return 9992}C(t){super.C(t),this.D>.25&&this._l()}_$(){let t=this.D/.25;$.translate(this.x,this.y),$.scale(t,t),$.globalAlpha=1-t,$.strokeStyle="#ff0",$.lineWidth=10,$.beginPath(),$.arc(0,0,80,0,N),$.stroke()}}class hM extends Y{get z(){return 9992}C(t){super.C(t),this.D>.25&&this._l()}_$(){let t=this.D/.25;$.translate(this.x,this.y),$.scale(t,t),$.globalAlpha=1-t,$.strokeStyle="#fff",$.lineWidth=10,$.beginPath(),$.arc(0,0,80,0,N),$.stroke()}}class hL extends Y{constructor(){super(),this._X=0}get z(){return 9992}C(t){super.C(t),this.D>.5&&this._l()}_$(){let t=this.D/.5;$.fillStyle="#fff",$.translate(this.x,this.y),$.globalAlpha=1-t,$.strokeStyle="#fff",$.fillStyle="#fff",$.lineWidth=20,$.beginPath();for(let i=0;i<1;i+=.05){let e=i*N,s=t*T(140,200);$.lineTo(cos(e)*s,sin(e)*s)}$.fill()}}class cM extends Y{constructor(t,i,e,s,h){super(),this.W=t,this.dQ=i,this.dP=e,this.dO=s,this._j=h}get z(){return 9991}C(t){super.C(t),this.D>this._j&&this._l()}cL(t){let i=this.D/this._j;return t[0]+i*(t[1]-t[0])}_$(){let t=this.cL(this.dQ);$.translate(this.cL(this.dP)-t/2,this.cL(this.dO)-t/2),$.rotate(PI/4),$.fillStyle=this.W,$.globalAlpha=this.cL([1,0]),$.fillRect(0,0,t,t)}}class iu extends Y{constructor(t,i,e,s){super(),this.K=t,this.W=i,this.dN=e,this.cX=s,this._X=t._X}get z(){return 9992}C(t){super.C(t),this.D>.2&&this._l()}_$(){$.globalAlpha=1-this.D/.2,$.translate(this.K.x,this.K.y),$.scale(this.K.af,1),$.translate(11,-42),$.strokeStyle=this.W,$.lineWidth=40,$.beginPath();for(let t=0;t<1;t+=.05)$.G(()=>{$.rotate(_f(this.dN*PI/2,this.cX*PI/2,t)),$.lineTo(18,-26)});$.stroke()}}class hK extends Y{get z(){return 9993}_$(t){this.S.reset(),$.fillStyle="#0af",this.aK(t);for(let t=99;t--;)$.G(()=>{$.translate(640,360),$.rotate(this.S.next(0,PI/16)),$.translate(-640,-360),$.fillRect(this.S.next(0,1280),this.S.next(1e3,2e3)*(this.D+this.S.next(0,10))%720,2,20)})}}class hJ extends Y{constructor(){super(),this.aP()}get z(){return 9993}aP(){this.D=0;let t=0,i=0;if(this.g){let e=_v(this.g.R("B"));t=e.x,i=e.y}this.x=T(t-640,t+640),this.y=i-460,this.ac=T(PI/4,3*PI/4)}C(t){super.C(t);let i=_v(this.g.R("B"));this.y>i.y+660&&this.aP(),this.x+=cos(this.ac)*t*300,this.y+=sin(this.ac)*t*300}_$(){$.translate(this.x,this.y+300),$.c_(()=>{$.strokeStyle=$.U("#000"),$.lineWidth=4,$.beginPath(),$.translate(0,-300);let t=sin(this.D*N*4)*PI/16+PI/4;$.lineTo(10*-cos(t),10*-sin(t)),$.lineTo(0,0),$.lineTo(10*cos(t),10*-sin(t)),$.stroke()})}}class hI extends Y{constructor(){super(),this.aw=100}C(t){super.C(t),cK(this,690,410)}_$(){$.translate(this.x,this.y),$.c_(()=>{this.S.reset();let t=0;for(let i=0;i<(1==bw?2:5);i++)$.G(()=>{$.fillStyle=$.U("#ab8"),$.translate(t,0),$.rotate(sin((this.D+this.S.next(0,5))*N/this.S.next(4,8))*this.S.next(PI/16,PI/4)),$.fillRect(-2,0,4,-this.S.next(5,30))}),t+=this.S.next(5,15)})}}class hH extends Y{constructor(){super(),this._y.push("aG")}}class fI extends hH{constructor(){super(),this.fH=this.S.next(10,20),this.bo=this.S.next(100,250),this.cJ=20,this.am=1,this.aw=this.bo+60}C(t){super.C(t),this.hG||cK(this,840,760),this.S.reset();let i=1;for(let t of this.g.R("A"))if(bv(this.x-100,t.x,this.x+100)&&bv(this.y-this.bo-50,t.y,this.y)){i=.2;break}this.am+=bd(2*-t,i-this.am,2*t)}_$(){$.translate(this.x,this.y),$.c_(()=>{if(this.S.reset(),$.G(()=>{$.rotate(sin((this.D+this.S.next(0,10))*N/this.S.next(4,16))*this.S.next(PI/32,PI/64)),$.fillStyle=$.U("#a65"),$.aX||($.globalAlpha=this.am),$.aX||$.fillRect(0,0,this.fH,-this.bo),$.translate(0,-this.bo),$.beginPath(),$.fillStyle=$.U("#060");for(let t=0;t<5;t++){let i=t/5*N,e=this.S.next(20,50),s=cos(i)*e,h=sin(i)*e*.5,a=this.S.next(20,40);$.G(()=>{$.translate(s,h),$.rotate(PI/4),$.rotate(sin((this.D+this.S.next(0,10))*N/this.S.next(2,8))*PI/32),$.rect(-a,-a,2*a,2*a)})}$.aX&&$.rect(0,0,this.fH,this.bo),$.fill()}),$.clip(),!$.aX)for(let t of this.g.R("P"))bv(this.x-100,t.x,this.x+100)&&bv(this.y-this.bo-50,t.y,this.y)&&($.U=()=>t instanceof cI?"#888":"#400",$.G(()=>{$.translate(t.x-this.x,t.y-this.y),$.scale(t.af,1),$.globalAlpha=this.am,t.al()}))})}}class hF extends Y{constructor(){super(),this.aw=100}C(t){super.C(t),cK(this,690,410)}_$(){$.translate(this.x,this.y),$.c_(()=>{this.S.reset();let t=0;for(let i=0;i<5;i++)$.G(()=>{$.fillStyle=$.U("green"),$.translate(t,0),$.rotate(sin((this.D+this.S.next(0,5))*N/this.S.next(4,8))*this.S.next(PI/32,PI/16)),$.fillRect(-10,0,20,-this.S.next(20,60))}),t+=this.S.next(5,15)})}}class hE extends Y{constructor(){super(),this._y.push("aR"),this.width=this.height=0}get z(){return-9991}get aZ(){return 0}C(t){super.C(t),this.aw=max(this.width,this.height)/2,cK(this,2560,1440,max(this.width,this.height))}hS(t){let i=t.x-this.x,e=t.y-this.y,s=i*cos(this.ac)+e*sin(this.ac),h=-i*sin(this.ac)+e*cos(this.ac);return abs(s)<this.width/2&&abs(h)<this.height/2}_$(){this.S.reset(),$.G(()=>{$.fillStyle="#08a",$.translate(this.x,this.y),$.rotate(this.ac),$.beginPath(),$.rect(-this.width/2,-this.height/2,this.width,this.height),$.fill(),$.clip(),$.rotate(-this.ac),$.scale(1,.5),$.strokeStyle="#fff",$.lineWidth=4;for(let t=3;t--;){let t=(this.D+this.S.next(0,20))/2,i=min(1,t%1);$.globalAlpha=(1-i)/2,$.beginPath(),$.arc((this.S.next(0,this.width)+~~t*this.width*.7)%this.width-this.width/2,(this.S.next(0,this.height)+~~t*this.height*.7)%this.height-this.width/2,i*this.S.next(20,60),0,N),$.stroke()}})}}class fC extends Y{constructor(t,i="#fff"){super(),this.L=t.toUpperCase(),this.W=i}get z(){return 9994}C(t){super.C(t),this.D>1&&!this.fB&&this._l()}_$(){$.translate(this.x,_f(this.y+20,this.y,this.D/.25)),this.fB||($.globalAlpha=_f(0,1,this.D/.25)),$.font="bold 14pt Arial",$.fillStyle=this.W,$.strokeStyle="#000",$.lineWidth=3,$.textAlign="center",$.textBaseline="middle",$.shadowColor="#000",$.shadowOffsetX=$.shadowOffsetY=1,$.strokeText(this.L,0,0),$.fillText(this.L,0,0)}}class cH extends Y{constructor(){super(),this.am=1}get z(){return 9996}_$(t){this.aK(t),$.fillStyle="#000",$.globalAlpha=this.am,$.fillRect(0,0,1280,720)}}class hB extends Y{constructor(){super(),this.am=1}get z(){return 9995}_$(t){if(!bf){$.globalAlpha=this.am,$.G(()=>{this.aK(t),$.fillStyle="#000",$.fillRect(0,0,1280,720),$.translate(640,240),$.fY([["P",192,-30],["ATH",96,30],["TO",36,20],["G",192],["LORY",96]])});for(let i of this.g.R("A"))i._$(t),gl&&$.ge(i)}}}class cG extends Y{constructor(t){super(),this.L=t,this._X=0}get z(){return 9995}C(t){super.C(t),this.D>5&&this._l()}_$(t){this.aK(t),$.globalAlpha=this.D<1?_f(0,1,this.D):_f(1,0,this.D-4),$.G(()=>{$.translate(40,680),$.fillStyle="#fff",$.strokeStyle="#000",$.lineWidth=4,$.textAlign="left",$.textBaseline="alphabetic",$.font="72pt Times New Roman",$.strokeText(this.L,0,0),$.fillText(this.L,0,0)})}}class fA extends Y{get z(){return 9997}C(t){super.C(t),this.L!=this.hA&&(this.hA=this.L,this.dK=0),this.dK+=t}_$(t){this.L&&!bf&&(this.aK(t),$.translate(640,600),$.scale(_f(1.2,1,8*this.dK),_f(1.2,1,8*this.dK)),$.fX(this.L))}}class cF extends Y{constructor(t){super(),this.L=t,this.am=1}get z(){return 9997}_$(t){if(!this.L)return;this.aK(t),$.translate(150,360),$.textBaseline="middle",$.textAlign="left",$.fillStyle="#fff",$.font="24pt Times New Roman";let i=-this.L.length/2*50,e=0;for(let t of this.L)$.globalAlpha=bd(0,this.D-3*e,1)*this.am,$.fillText(t,0,i),i+=75,e++}}class hz extends Y{get z(){return 9996}_$(t){bf&&(this.aK(t),$.fillStyle="rgba(0,0,0,0.5)",$.fillRect(0,0,1280,720),$.G(()=>{$.translate(640,240),$.fY([["G",192],["AME",96,30],["P",192,-30],["AUSED",96]])}),$.G(()=>{$.translate(640,540),$.fX("[P] or [ESC] to resume")}))}}class dJ extends Y{constructor(t){super(),this.K=t,this.bn=new bZ(()=>this.K._c/this.K.ab),this.bQ=new bZ(()=>this.K.ax)}get z(){return 9990}C(t){super.C(t),this.bn.C(t),this.bQ.C(t),this.K._c||this._l()}_$(){this.K._c>.5&&this.K.D-max(this.K.dI,this.K.cf)>2||($.translate(this.K.x,this.K.y+20),$.G(()=>{$.translate(0,4),this.bQ._q(60,6,g$,1)}),this.bn._q(80,5,g_))}}class hy extends Y{constructor(t){super(),this.A=t,this.bn=new bZ(()=>this.A._c/this.A.ab),this.bQ=new bZ(()=>this.A.ax),this.bm=new bZ(()=>this._E),this.bn.ee=.1,this.bm.ee=.1,this.bm.aW=0,this._E=0,this.hx=0,this.hw=new cI,this.hv=new fw,this._X=0}get z(){return 9994}C(t){super.C(t),this.bn.C(t),this.bQ.C(t),this.bm.C(t)}_$(t){this.aK(t),$.G(()=>{$.translate(640,50),$.G(()=>{$.translate(0,10),this.bQ._q(300,20,g$,1)}),this.bn._q(400,20,g_)}),$.G(()=>{$.globalAlpha=this.hx,$.translate(640,570),this.bm._q(600,10,"#fff",0,8),$.U=()=>"#fff",$.shadowColor="#000",$.shadowBlur=1,$.G(()=>{$.translate(_f(-300,300,this.bm.aW),20),$.scale(.5,.5),this.hw.al()}),$.G(()=>{$.translate(300,20),$.scale(-.5,.5),this.hv.al()})}),$.G(()=>{$.translate(640,90),$.fillStyle="#fff",$.strokeStyle="#000",$.lineWidth=4,$.textBaseline="top",$.textAlign="center",$.font="bold 16pt Times New Roman",$.strokeText("SCORE: "+this.A.aI.toLocaleString(),0,0),$.fillText("SCORE: "+this.A.aI.toLocaleString(),0,0)}),this.A.bl>0&&$.G(()=>{$.translate(840,70),$.fillStyle="#fff",$.strokeStyle="#000",$.lineWidth=4,$.textBaseline="middle",$.textAlign="right",$.font="bold 36pt Times New Roman",$.rotate(-PI/32);let t=min(1,(this.A.D-this.A.dH)/.1);$.scale(2-t,2-t),$.strokeText("X"+this.A.bl,0,0),$.fillText("X"+this.A.bl,0,0)})}}class fv extends Y{constructor(){super(),this._y.push("K","aG"),this.aw=90,this.af=1,this._c=this.ab=100,this.bl=0,this.ax=1,this.cf=this.dI=this.dH=-9,this.bk=200,this.c$=80,this.br=40,this.au=this.aH=0,this.cJ=30,this.aO=100,this.bP=this.dG=0,this.fu=99,this.cD(this._u),this.ar=[],this.F={_I:0,M:0,_Y:{x:0,y:0}},this.J=d$({o:this})}cD(t){(this.controller=t)._w(this)}get _u(){return new _Z}dF(t){return this.D-this.cf<.1?"#fff":t}C(t){super.C(t),this._O=this.D*(this.aZ?.5:1),this.J.C(t),this.controller.C(t),this.aZ&&this.F._I&&this.cc(.2*t);let i=this.J._d._o*this.bk;this.x+=cos(this.F.M)*this.F._I*i*t,this.y+=sin(this.F.M)*this.F._I*i*t,this.af=sign(this.F._Y.x-this.x)||1;for(let t of this.g.R("aG")){if(t===this||_U(this,t)>t.cJ)continue;let i=_P(this,t);this.x=t.x-cos(i)*t.cJ,this.y=t.y-sin(i)*t.cJ}(this.D-this.dI>this.fu||this.J._d.el)&&(this.ax=min(1,this.ax+.3*t)),this.D-this.dH>5&&this.cC(-99)}cC(t){this.bl=max(0,this.bl+t),this.dH=this.D}fM(t,i,e){return this.aq(t,i,e,PI/2)>0}hu(t,i,e){return abs(t.x-this.x)<i&&abs(t.y-this.y)<e}aq(t,i,e,s){if(t===this||!i||!e)return 0;let h=_P(this,t),a=_P(this,this.F._Y),l=1-abs(iG(h-a))/(s/2),n=abs(this.x-t.x),r=abs(this.y-t.y)/(e/i),o=1-hypot(n,r)/i;return o<0||l<0?0:o+pow(l,3)}fp(t,i,e){return Array.from(this.g.R(this.cA)).filter(s=>this.aq(s,t,i,e)>0)}fo(t,i,e){return this.fp(t,i,e).reduce((s,h)=>s?this.aq(h,t,t,e)>this.aq(s,t,i,e)?h:s:h,0)}iv(){let t=this.fo(this.au,this.aH,PI/2);t?this._A(_P(this,t),max(0,_U(this,t)-this.br/2),.1):this._A(_P(this,this.F._Y),40,.1)}strike(t){aY(...[.1,,400,.1,.01,,3,.92,17,,,,,2,,,,1.04]);for(let i of this.fp(this.c$,this.br,N)){let e=_P(this,i);if(i.J._d.iz)if(i.af=sign(this.x-i.x)||1,i.dG++,this._A(e+PI,20,.1),i.J._d.iy){i.ax=1,i.cC(1),i.cb("Perfect Block!");let t=this.g.add(new hL);t.x=i.x,t.y=i.y-30,this.il=1,this.cc(1);for(let t of this.g.R(i.cA))i.hu(t,2*i.c$,2*i.br)&&t._A(_P(i,t),100,.2);(async()=>{this.g._o=.1;let t=_v(this.g.R("B"));await t.bT(2),await this.g._b(3*this.g._o),await t.bT(1),this.g._o=1})(),aY(...[2.14,,1e3,.01,.2,.31,3,3.99,,.9,,,.08,1.9,,,.22,.34,.12])}else{i.cc(t*this.aO/100),i.cb("Blocked!");let e=this.g.add(new hM);e.x=i.x,e.y=i.y-30,aY(...[2.03,,200,,.04,.12,1,1.98,,,,,,-2.4,,,.1,.59,.05,.17])}else{i.bN(~~(this.aO*t)),i._A(e,this.aO*t,.1),i._c||this.dB(.1*this.ab),this.cC(1);let s=i.x+T(-20,20),h=i.y-30+T(-20,20),a=T(1,2);for(let t=0;t<20;t++)this.g.add(new cM("#900",[a,a+T(3,6)],[s,s+T(-30,30)],[h,h+T(-30,30)],T(.2,.4)))}}}cb(t,i){this.cz&&this.cz._l(),this.cz=this.g.add(new fC(t,i)),this.cz.x=this.x,this.cz.y=this.y-90}cc(t){this.ax=max(0,this.ax-t),this.dI=this.D}bN(t){this._c=max(0,this._c-t),this.cf=this.D,this.bP++,this.J._d.el||this.cc(t/this.ab*.3),this.cC(-99),this.cb(""+t,this.fl),this._c||this.dA()}dB(){}_$(){let{aZ:t,_O:i}=this;$.translate(this.x,this.y);let e=$.U||(t=>t);$.U=t=>this.dF(e(t)),$.c_(()=>{t&&($.beginPath(),$.rect(-150,-150,300,150),$.clip(),$.translate(0,10));let{af:e}=this,{ce:s}=this.J._d;void 0!==s&&(e=sign(cos(s)),$.translate(0,-30),$.rotate(this.J._d.D/.3*e*N),$.translate(0,30)),$.scale(e,1),$.G(()=>this.al(i))})}_A(t,i,e){this.g.add(new _h(this,"x",this.x,this.x+cos(t)*i,e)),this.g.add(new _h(this,"y",this.y,this.y+sin(t)*i,e))}dA(){let t=this.ar.concat([1,0].map(t=>()=>{$.slice(30,t,.5),$.translate(0,30),this.al()}));for(let i of t){let t=this.g.add(new hm(i));t.x=this.x,t.y=this.y;let e=_P(this,this.F._Y)+PI+T(-1,1)*PI/4,s=T(30,60);this.g.add(new _h(t,"x",t.x,t.x+cos(e)*s,1,eq)),this.g.add(new _h(t,"y",t.y,t.y+sin(e)*s,1,eq)),this.g.add(new _h(t,"ac",0,bc([-1,1])*T(PI/4,PI),1,eq))}this.dz(),this.cb("Slain!",this.fl),this._l(),aY(...[2.1,,400,.03,.1,.4,4,4.9,.6,.3,,,.13,1.9,,.1,.08,.32])}dz(){for(let t=0;t<80;t++){let t=random()*N,i=40*random(),e=this.x+cos(t)*i,s=this.y-30+sin(t)*i;this.g.add(new cM("#fff",[10,20],[e,e+T(-20,20)],[s,s+T(-20,20)],T(.5,1)))}}}hl=[0,255].map(t=>ca(1,1,i=>{let e=i.createRadialGradient(0,0,0,0,0,250);return e.addColorStop(0,"rgba("+t+",0,0,.1)"),e.addColorStop(1,"rgba("+t+",0,0,0)"),e}));class cI extends fv{constructor(){super(),this._y.push("A"),this.cA="P",this.aI=0,this.bk=250,this.aO=30,this.fu=2,this.au=this.aH=250,this._X=0,this.fl="#f00",this.ar=[()=>$.bs(),()=>$.cW()],this.J=d$({o:this,bu:1,cZ:.15,gk:1,b_:.2})}get _u(){return new fk}bN(t){super.bN(t),aY(...[2.07,,71,.01,.05,.03,2,.14,,,,,.01,1.5,,.1,.19,.95,.05,.16])}dF(t){return this.D-this.cf<.1?"#f00":super.dF(t)}dB(t){t=~~min(this.ab-this._c,t),this._c+=t;for(let i=t;--i>0;)setTimeout(()=>{let t=random()*N,i=40*random(),e=this.x+T(-10,10),s=this.y-30+sin(t)*i;this.g.add(new cM("#0f0",[5,10],[e,e+T(-10,10)],[s,s+T(-30,-60)],T(1,1.5)))},100*i)}_q(){let t=this.fo(this.au,this.aH,PI/2);t&&$.G(()=>{$.globalAlpha=.2,$.strokeStyle="#f00",$.lineWidth=5,$.setLineDash([10,10]),$.beginPath(),$.moveTo(this.x,this.y),$.lineTo(t.x,t.y),$.stroke()}),$.G(()=>{$.translate(this.x,this.y);let i=_P(this,this.F._Y);$.fillStyle=hl[+!!t],$.beginPath(),$.arc(0,0,this.au,i-PI/4,i+PI/4),$.lineTo(0,0),$.fill()}),super._q()}al(){$.ei(this,"#666"),$.eh(this,"#666",()=>$.bs()),$.cU(this,"#fec"),$.cV(this,"#ccc",25),$.eg(this,"#666"),$.ef(this,-70)}}class fk extends e${C(){let t=0,i=0;(_z[37]||_z[65])&&(t=-1),(_z[38]||_z[87])&&(i=-1),(_z[39]||_z[68])&&(t=1),(_z[40]||_z[83])&&(i=1);let e=_v(this.o.g.R("B"));(t||i)&&(this.o.F.M=atan2(i,t)),this.o.F._I=t||i?1:0,this.o.F._n=_z[16]||bY||ib.bW,this.o.F._k=bX||ic.bW,this.o.F._A=_z[32]||_z[17]||ia.bW;let s=(eb.x-640)/640,h=(eb.y-360)/360;if(this.o.F._Y.x=this.o.x+1280*s/2/e._N,this.o.F._Y.y=this.o.y+720*h/2/e._N,1==bw){let{_p:t}=_H;this.o.F._Y.x=this.o.x+(t.x-_H.x),this.o.F._Y.y=this.o.y+(t.y-_H.y),this.o.F.M=_P(_H,t),this.o.F._I=_H.bq<0?0:min(1,_U(t,_H)/50)}t&&(this.o.af=t)}}class dw extends fv{constructor(){super(),this._y.push("P"),this.cA="A"}_l(){super._l(),_v(this.g.R("at")).dU(this)}dA(){super.dA();for(let t of this.g.R("A"))t.aI+=~~(100*this.av*t.bl)}bN(t){super.bN(t),aY(...[1.6,,278,,.01,.01,2,.7,-7.1,,,,.07,1,,,.09,.81,.08])}}fj=({_n:t,aF:i})=>class extends i${async fQ(){for(;;){await this.aS(new fN(300,300));try{await this.race([new fP(3),new fO])}catch(t){continue}let e;await this.aS(new fO);try{await this.race([new fP(500/this.o.bk),new fN(this.o.c$,this.o.br)]);for(let t=i;t--;)await this.aS(new hX(.5));await this.aS(new dY(.5))}catch(t){e=1}await this.aS(new hY);let s=!t&&!e&&random()<.5;await this.race([new hW(300,300),new dY(s?.1:4),s?new hU:t?new hV:new _Z]),await this.aS(new dY(1))}}},aj=({bM:t,_W:i,aa:e,_n:s,_V:h,a_:a,aF:l})=>{let n=fj({_n:s,aF:l}),r=0+.2*!!h+.3*!!a+.1*!!e+.3*!(!i&&!s),o=0+.3*!!s+.5*!!h+.7*!!a;return class extends dw{constructor(){super(),this.av=1,i&&(this.av+=1),e&&(this.av+=2),this._c=this.ab=~~_f(100,400,o),this.aO=e?35:i?25:10,this.bk=_f(120,50,r),t&&this.ar.push(()=>$.gd()),i&&this.ar.push(()=>$.bs()),s&&this.ar.push(()=>$.cW()),e&&this.ar.push(()=>$.gh()),this.J=d$({o:this,bu:.5,b_:_f(.3,.1,o)})}get _u(){return new n(this)}al(){$.gb(this),$.ei(this,"#666"),$.eh(this,h||a?"#666":"#fec",()=>{t&&$.gd(this),i&&$.bs(this),e&&$.gh(this)}),$.cV(this,h?"#ccc":a?"#444":"#fec",22),$.cU(this,a?"#666":"#fec",a?"#000":"#fec"),s&&$.eg(this,h||a?"#666":"#fec"),$.ef(this,-70),$.ga(this)}}},_n={_n:1},_W={_W:1,aF:2},bM={bM:1,aF:3},aa={aa:1,aF:1},_V={_V:1},a_={a_:1},bL=[k$=aj({...bM}),jZ=aj({...aa}),jY=aj({..._W}),fg=aj({..._W,..._V}),jX=aj({...aa,..._V}),jW=aj({...aa,..._n,..._V}),jV=aj({..._W,..._n,..._V}),jU=aj({..._W,..._n,...a_}),jT=aj({...aa,..._n,...a_})],cw=[bL.slice(0,3),bL.slice(0,4),bL.slice(0,5),bL.slice(0,7),bL];class ff extends dw{constructor(){super(),this._y.push("P"),this._c=9999}al(){$.G(()=>{$.fillStyle=$.U("#634"),$.fillRect(-2,0,4,-20)}),$.cV(this,"#634",22),$.cU(this,"#634")}_A(){}}class fw extends dw{constructor(){super(),this.ar=[()=>$.bs(),()=>$.cW()],this._c=this.ab=600,this.aO=40,this.bk=100,this.J=d$({o:this,bu:.5,b_:.2})}al(){$.gb(this),$.ei(this,"#400"),$.eh(this,"#400",()=>$.bs()),$.cU(this,"#fec"),$.ge(this),$.cV(this,"#900",25),$.eg(this,"#400"),$.ef(this,-70),$.ga(this)}}class dv extends Y{constructor(t){super(),this.K=t}get z(){return 9994}C(t){super.C(t),this.K._c||this._l()}_$(t){if(abs(t.x-this.K.x)<640/t._N&&abs(t.y-this.K.y)<360/t._N)return;let i=bd(t.x-590/t._N,this.K.x,t.x+590/t._N),e=bd(t.y-310/t._N,this.K.y,t.y+310/t._N);$.translate(i,e),$.beginPath(),$.G(()=>{$.shadowColor="#000",$.shadowBlur=5,$.fillStyle="#f00",$.rotate(_P({x:i,y:e},this.K)),$.arc(0,0,20,-PI/4,PI/4,1),$.lineTo(40,0),$.closePath(),$.fill(),$.shadowBlur=0,$.fillStyle="#fff",$.beginPath(),$.arc(0,0,15,0,N,1),$.fill()}),$.clip(),$.U=()=>"#f00",$.scale(.4,.4),$.translate(0,30),$.scale(this.K.af,1),this.K.al()}}class hm extends Y{constructor(t,i){super(),this.du=t,this.fe=i}get z(){return-9990}C(t){super.C(t),this.D>5&&this._l(),this.D<.5&&this.g.add(new cM("#900",[3,6],[this.x,this.x+T(-20,20)],[this.y,this.y+T(-20,20)],T(.5,1)))}_$(){this.D>3&&this.D%.25<.125||($.translate(this.x,this.y),$.rotate(this.ac),this.du())}}let hg=(...t)=>hf(he(...t)),hd=.3,_L=44100,dt=new AudioContext,hf=(...t)=>{let i=dt.createBuffer(t.length,t[0].length,_L),e=dt.createBufferSource();return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(dt.destination),e},he=(t=1,i=.05,e=220,s=0,h=0,a=.1,l=0,n=1,r=0,o=0,_=0,c=0,d=0,f=0,$=0,w=0,u=0,b=1,g=0,x=0)=>{let y,p,j=2*PI,m=t=>t>0?1:-1,S=r*=500*j/_L/_L,C=e*=(1+2*i*random()-i)*j/_L,P=[],T=0,D=0,R=0,A=1,v=0,I=0,k=0;for(o*=500*j/_L**3,$*=j/_L,_*=j/_L,c*=_L,d=d*_L|0,p=(s=s*_L+9)+(g*=_L)+(h*=_L)+(a*=_L)+(u*=_L)|0;R<p;P[R++]=k)++I%(100*w|0)||(k=l?l>1?l>2?l>3?sin((T%j)**3):max(min(tan(T),1),-1):1-(2*T/j%2+2)%2:1-4*abs(round(T/j)-T/j):sin(T),k=(d?1-x+x*sin(j*R/d):1)*m(k)*abs(k)**n*t*hd*(R<s?R/s:R<s+g?1-(R-s)/g*(1-b):R<s+g+h?b:R<p-u?(p-R-u)/a*b:0),k=u?k/2+(u>R?0:(R<p-u?1:(p-R)/u)*P[R-u|0]/2):k),T+=(y=(e+=r+=o)*cos($*D++))-y*f*(1-1e9*(sin(R)+1)%2),A&&++A>c&&(e+=_,C+=_,A=0),!d||++v%d||(e=C,r=S,A=A||1);return P};aY=(...t)=>hg(...t).start();let dp=44100,bJ=2,bI=33,bi;function dn(t){return sin(6.283184*t)}function gY(t){return dn(t)<0?-1:1}function gX(t){return t%1-.5}function gW(t){let i=t%1*4;return i<2?i-1:3-i}let dl=[dn,gY,gX,gW];function eZ(t){return.00390625*pow(1.059463094,t-128)}function dk(t,i){setTimeout(()=>{var e=new Uint8Array(t*bJ*2),s=e.length-2,h=()=>{for(var t=new Date,a=0;s>=0;)if(e[s]=0,e[s+1]=128,s-=2,(a+=1)%1e3==0&&new Date-t>bI)return void setTimeout(h,0);setTimeout(()=>i(e),0)};setTimeout(h,0)},0)}function eY(t,i,e,s,h){let a=e.jS*s>>1,l=e.jR/255,n=0,r=()=>{let e=new Date,s=0;for(;n<i-a;){var o=4*n,_=4*(n+a),c=t[_]+(t[_+1]<<8)+(t[o+2]+(t[o+3]<<8)-32768)*l;if(t[_]=255&c,t[_+1]=c>>8&255,c=t[_+2]+(t[_+3]<<8)+(t[o]+(t[o+1]<<8)-32768)*l,t[_+2]=255&c,t[_+3]=c>>8&255,++n,(s+=1)%1e3==0&&new Date-e>bI)return void setTimeout(r,0)}setTimeout(h,0)};setTimeout(r,0)}class eW{constructor(t){this._m=t,this._K=t.length/bJ/2}jQ(){let t,i,e,s,h,a,l,n=this._m,r=this._K*bJ*2;for(a=(h=r-8)-36,s=String.fromCharCode(82,73,70,70,255&h,h>>8&255,h>>16&255,h>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),t=0;t<r;){for(e="",i=0;i<256&&t<r;++i,t+=2)l=(l=4*(n[t]+(n[t+1]<<8)-32768))<-32768?-32768:l>32767?32767:l,e+=String.fromCharCode(255&l,l>>8&255);s+=e}return s}eV(t){bi||(bi=new AudioContext);let i=this._m,e=this._K,s=bi.createBuffer(bJ,this._K,dp),h=s.getChannelData(0),a=s.getChannelData(1),l=0,n=()=>{for(var r=new Date,o=0;l<e;){var _=4*(i[4*l]+(i[4*l+1]<<8)-32768);if(_=_<-32768?-32768:_>32767?32767:_,h[l]=_/32768,_=(_=4*(i[4*l+2]+(i[4*l+3]<<8)-32768))<-32768?-32768:_>32767?32767:_,a[l]=_/32768,l+=1,(o+=1)%1e3==0&&new Date-r>bI)return void setTimeout(n,0)}setTimeout(()=>t(s),0)};setTimeout(n,0)}}class gS{constructor(t,i){this.O=t,this._R=i||5605,this.gR=dl[t.jD],this.gQ=dl[t.jC],this.gP=dl[t.jB],this._k=t.jA,this.aD=t.jz,this.release=t.jy,this.gO=pow(2,t.jx-8)/this._R,this.gN=pow(2,t.jw-8)/this._R}eU(t,i,e){for(var s=0,h=0,a=eZ(t+12*(this.O.jt-8)+this.O.jr)*(1+8e-4*this.O.jq),l=eZ(t+12*(this.O.jp-8)+this.O.jo)*(1+8e-4*this.O.jn),n=this.O.jm/255,r=0,o=0,_=this._k+this.aD+this.release-1;_>=0;--_){let t=_+e,u=this.gR(t*this.gN)*this.O.jk/512+.5,b=1;_<this._k?b=_/this._k:_>=this._k+this.aD&&(b-=(_-this._k-this.aD)/this.release);var c=a;this.O.ji&&(c+=u),this.O.jh&&(c*=b*b),s+=c;var d=this.gQ(s)*this.O.jg;c=l,this.O.jf&&(c*=b*b),h+=c,d+=this.gP(h)*this.O.je,this.O.gI&&(d+=(2*random()-1)*this.O.gI*b),d*=b/255;var f=this.O.jb;this.O.ja&&(f*=u);var $=n*(d-o)-(r+=(f=1.5*sin(3.141592*f/dp))*o);switch(o+=f*$,this.O.j_){case 1:d=$;break;case 2:d=r;break;case 3:d=o;break;case 4:d=r+$}if(c=dn(t*this.gO)*this.O.iU/512+.5,d*=39*this.O.iT,3+(t*=4)<i.length){var w=i[t]+(i[t+1]<<8)+d*(1-c);i[t]=255&w,i[t+1]=w>>8&255,w=i[t+2]+(i[t+3]<<8)+d*c,i[t+2]=255&w,i[t+3]=w>>8&255}}}eQ(t,i){this.dh(t,t=>{t.eV(i)})}dh(t,i){var e=this._k+this.aD+this.release-1+32*this._R,s=this;dk(e,h=>{s.eU(t,h,0),eY(h,e,s.O,s._R,function(){i(new eW(h))})})}}class gG{constructor(t){this.aB=t,this._K=dp*t.iQ}gF(t,i,e){dk(this._K,s=>{var h=this._K,a=this._K*bJ*2,l=this.aB._R,n=this.aB.eP,r=new gS(t,l);let o=0,_=0,c=0,d=()=>{for(var i=new Date;;)if(32!==c){if(_===n-1)return void setTimeout(f,0);var e=t.p[_];if(e){var h=t.c[e-1].n[c];h&&r.eU(h,s,o)}if(o+=l,c+=1,new Date-i>bI)return void setTimeout(d,0)}else c=0,_+=1},f=()=>eY(s,h,t,l,w);var $=0;let w=()=>{let t=new Date,h=0;for(;$<a;){var l=i[$]+(i[$+1]<<8)+s[$]+(s[$+1]<<8)-32768;if(i[$]=255&l,i[$+1]=l>>8&255,$+=2,(h+=1)%1e3==0&&new Date-t>bI)return void setTimeout(w,0)}setTimeout(e,0)};setTimeout(d,0)})}dh(t){dk(this._K,i=>{let e=0,s=()=>{e<this.aB.gD.length?(e+=1,this.gF(this.aB.gD[e-1],i,s)):t(new eW(i))};s()})}eQ(t){this.dh(i=>i.eV(t))}}_F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],gC={_R:5513,eP:10,gD:[{jt:7,jr:0,jq:0,jh:1,jg:255,jC:0,jp:7,jo:0,jn:0,jf:1,je:255,jB:0,gI:0,jA:100,jz:0,jy:3636,iT:254,j_:2,jb:500,jm:254,jS:0,jR:27,jx:0,iU:0,ji:0,ja:0,jw:0,jk:0,jD:0,p:[2,2,2,2,2,2,2,2,2],c:[{n:_F},{n:[135,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0]}]},{jt:8,jr:0,jq:0,jh:1,jg:221,jC:0,jp:8,jo:0,jn:0,jf:1,je:210,jB:0,gI:255,jA:50,jz:150,jy:15454,iT:229,j_:3,jb:11024,jm:240,jS:6,jR:24,jx:0,iU:20,ji:0,ja:1,jw:7,jk:64,jD:0,p:[3,3,3,3,3,3,3,3,3],c:[{n:_F},{n:_F},{n:[0,0,0,0,134,0,0,0,0,0,0,0,134,0,0,0,0,0,0,0,134,0,0,0,0,0,0,0,134,0,0,0]}]},{jt:7,jr:0,jq:0,jh:0,jg:192,jC:1,jp:6,jo:0,jn:9,jf:0,je:192,jB:1,gI:0,jA:137,jz:2e3,jy:4611,iT:192,j_:1,jb:982,jm:89,jS:6,jR:25,jx:6,iU:77,ji:0,ja:1,jw:3,jk:69,jD:0,p:[0,0,0,0,0,0,4,4],c:[{n:_F},{n:_F},{n:_F},{n:[137,0,0,144,0,0,142,0,0,144,0,0,0,149,0,0,144,0,0,142,0,0,144,0,0,0,0,0,0,0,0,0]}]},{jt:7,jr:0,jq:0,jh:0,jg:255,jC:1,jp:7,jo:0,jn:9,jf:0,je:154,jB:1,gI:0,jA:197,jz:88,jy:10614,iT:45,j_:0,jb:11025,jm:255,jS:2,jR:146,jx:3,iU:47,ji:0,ja:0,jw:0,jk:0,jD:0,p:[0,5,5,0,0,0,0,0,5],c:[{n:_F},{n:_F},{n:_F},{n:_F},{n:[125,0,0,132,0,0,130,0,0,132,0,0,137,0,0,132,0,0,130,0,0,132,0,0,0,0,0,0,0,0,0,0]}]},{jt:9,jr:0,jq:0,jh:0,jg:255,jC:0,jp:9,jo:0,jn:12,jf:0,je:255,jB:0,gI:0,jA:100,jz:0,jy:14545,iT:70,j_:0,jb:0,jm:240,jS:2,jR:157,jx:3,iU:47,ji:0,ja:0,jw:0,jk:0,jD:0,p:[0,0,0,6,6],c:[{n:_F},{n:_F},{n:_F},{n:_F},{n:_F},{n:[137,0,0,132,0,0,130,0,0,132,0,0,137,0,0,132,0,0,130,0,0,132,0,0,0,0,0,0,0,0,0,0]}]}],iQ:31},eK=()=>new gG(gC).eQ(t=>{let i=bi.createBufferSource();i.buffer=t,i.loop=1;let e=bi.createGain();e.gain.value=.5,e.connect(bi.destination),i.connect(e),i.start(),eK=()=>0,fW=t=>e.gain.value=t}),fW=()=>0;class eJ{constructor(){this.g=new gB,this.g.add(new hR),_z={},bX=bY=0,this.g.add(new hN);let t=this.g.add(new cI);this.g.add(new hP(t)),this.g.add(new hK),this.g.add(new hz);for(let t=2;t--;)this.g.add(new hJ);for(let t=0;t<400;t++){let t=new hI;t.x=1280*T(-2,2),t.y=720*T(-2,2),this.g.add(t)}for(let t=0;t<20;t++){let t=new hF;t.x=1e4*random(),this.g.add(t)}}C(t){this.g.C(t)}async eH(t,i){let e=this.g.add(new cH);await this.g.add(new _h(e,"am",0,1,1)).await();let s=_v(this.g.R("A")),h=_v(this.g.R("B"));s.x=t,s.y=i,h.C(999),await this.g.add(new _h(e,"am",1,0,1)).await(),e._l()}}class eG extends eJ{constructor(){super();let{g:t}=this;for(let i=0;i<1;i+=1/15){let e=t.add(new fI);e.hG=1,e.x=600*cos(i*N)+T(-20,20),e.y=600*sin(i*N)+T(-20,20)}let i=_v(t.R("B"));i.cQ=3,i.C(99);let e=_v(t.R("A"));e._c=9999,e.cD(new e$),(async()=>{for(;;)await t._t(()=>es(e.x,e.y,0,0)>650),await this.eH(0,0)})(),(async()=>{let s=t.add(new hB),h=t.add(new cH);await t.add(new _h(h,"am",1,0,2)).await();let a=t.add(new fA);a.L="[CLICK] to follow the path",await new Promise(t=>onclick=t),a.L="",eK(),_g.style.cursor="none",e.cD(new fk),await t.add(new _h(s,"am",1,0,2)).await(),await i.bT(1),t.add(new cG("Prologue")),a.L="Use [ARROW KEYS] or [WASD] to move",await t._t(()=>es(e.x,e.y,0,0)>200),s._l(),a.L="",await t._b(1),await this.cl(a,"Press [SPACE] or [CTRL] to roll",async()=>{await t._t(()=>void 0!==e.J._d.ce),await t._t(()=>void 0===e.J._d.ce)},3);let l=()=>Array.from(t.R("P")).reduce((t,i)=>i.bP+t,0);for(let i=0;i<1;i+=.2){let e=t.add(new ff);e.x=200*cos(i*N),e.y=200*sin(i*N),e.dz()}await this.cl(a,"[LEFT CLICK] to strike a dummy",async()=>{let i=l();await t._t(()=>l()>i)},10),await this.cl(a,"Hold [LEFT CLICK] to charge a heavy attack",async()=>{await t._t(()=>e.J._d.ay>=1);let i=l();await t._t(()=>l()>i)},3);let n=aj({_W:1,_V:1,aF:1}),r=t.add(new n);r._c=9999,r.x=i.x+640/i.cQ+20,r.y=-99,t.add(new dv(r)),await this.cl(a,"Hold [RIGHT CLICK] or [SHIFT] to block attacks",async()=>{let i=e.dG;await t._t(()=>e.dG>i)},3),t.add(new dJ(r)),r._c=r.ab=100,a.L="Now slay them!",await t._t(()=>r._c<=0),a.L="",await t._b(1),await t.add(new _h(h,"am",0,1,2)).await();let o=t.add(new cF(["1254 AD","The Kingdom of Syldavia is being invaded by the Northern Empire.","The Syldavian army is outnumbered and outmatched.","One lone soldier decides to take on the emperor himself."]));await t._b(15),await t.add(new _h(o,"am",1,0,2)).await(),az=new de})(),(async()=>{let i=t.add(new ff);i.y=-550,i.dz();let e=t.add(new fC("Skip"));for(e.y=i.y-30,e.fB=1;;){let{bP:e}=i;await t._t(()=>i.bP>e),confirm("Skip intro?")&&(az=new de)}})()}async cl(t,i,e,s){for(let h=0;h<s;h++)t.L=i+" ("+h+"/"+s+")",await e();t.L=i+" ("+s+"/"+s+")",await this.g._b(1),t.L="",await this.g._b(1)}}class de extends eJ{constructor(t=0,i=0){super();let{g:e}=this,s=i,h=_v(e.R("A"));h.x=1280*t,h.y=e.aJ(h.x),h.aI=i;let a=_v(e.R("B"));a.C(99);let l=e.add(new hy(h));e.add(new hO);for(let t=0;t<15;t++){let t=e.add(new fI);t.x=1280*T(-1,1)/2,t.y=720*T(-1,1)/2}for(let t=0;t<20;t++){let t=e.add(new hE);t.width=T(100,200),t.height=T(200,400),t.ac=random()*N,t.x=1280*random()*5,t.y=720*random()*5}async function n(){h._X=1,e._o=.2,await a.bT(3),await e._b(1.5*e._o),await a.bT(1),e._o=1,h._X=0}function r(t,i){return Array.apply(0,Array(t)).map(()=>{let t=e.add(new(bc(i)));return t.x=h.x+T(-640,640),t.y=h.y+bc([-1,1])*(360+T(50,100)),e.add(new dJ(t)),e.add(new dv(t)),t})}(async()=>{for(;;){await e._t(()=>abs(h.y-e.aJ(h.x))>1e3||h.x<a.cP-640);let t=max(a.cP+1280,h.x);await this.eH(t,e.aJ(t))}})(),(async()=>{let i=e.add(new cH);await e.add(new _h(i,"am",1,0,2)).await(),e.add(new cG("The Path")),await e._b(2),l._E=l.bm.aW=t/8;let o=h.x+1280;for(;t<8;t++){(async()=>{await e._b(1),await e.add(new _h(l,"hx",0,1,1)).await(),l._E=t/8,h.dB(.5*h.ab),await e._b(3),await e.add(new _h(l,"hx",1,0,1)).await()})();let i=e.add(new fA);(async()=>{await e._b(10),i.L="Follow the path to the right"})(),await e._t(()=>h.x>=o),i._l(),s=h.aI,this.g.add(new cG("Wave "+(t+1)));let _=r(3+t,cw[min(cw.length-1,t)]);await Promise.all(_.map(t=>e._t(()=>t._c<=0))),n(),this.g.add(new cG("Wave Cleared")),o=h.x+2560,a.cP=h.x-1280}await e._t(()=>h.x>=o);let _=e.add(new fw);_.x=a.x+1280+50,_.y=e.aJ(_.x),e.add(new dJ(_)),await e._t(()=>_.x-h.x<400),await e.add(new _h(i,"am",0,1,2*e._o)).await(),h.x=_.x-400,h.y=e.aJ(h.x);let c=e.add(new cF(["At last, he faced the emperor."]));await e._b(3),await e.add(new _h(c,"am",1,0,2)).await(),await e.add(new _h(i,"am",1,0,2)).await();let d=fj({_n:1,aF:3});_.cD(new d),e.add(new dv(_)),r(5,cw[cw.length-1]),await e._t(()=>_._c<=0),h._c=h.ab=999,gl=1,await n(),await e.add(new _h(i,"am",0,1,2*e._o)).await();let f=e.add(new cF(["After an epic fight, the emperor was defeated.","Our hero's quest was complete.","Historians estimate his final score was "+h.aI.toLocaleString()+"."]));await e.add(new _h(f,"am",0,1,2*e._o)).await(),await e._b(9*e._o),await e.add(new _h(f,"am",1,0,2*e._o)).await(),az=new eG})(),(async()=>{await e._t(()=>h._c<=0),n();let i=e.add(new cH);await e.add(new _h(i,"am",0,1,2*e._o)).await(),e._o=2;let a=e.add(new cF([bc(["Failing never affected his will, only his score.","Giving up was never an option.","His first attempts weren't successful.","After licking his wounds, he resumed his quest."]),bc(["His shield would not fail him again ([SHIFT] / [RIGHT CLICK])","Rolling would help him dodge attacks ([SPACE] / [CTRL])","Heavy attacks would be key to his success"])]));await e._b(6),await e.add(new _h(a,"am",1,0,2)).await(),az=new de(t,max(0,s-5e3))})()}}onresize=()=>{let i,e,s=innerWidth,h=innerHeight,a=s/h,l=1280/720,n=t.style;a<=l?e=(i=s)/l:i=(e=h)*l,n.width=i+"px",n.height=e+"px"},_v=t=>{for(let i of t)return i};class hT{constructor(){this.bB=0,this.ey=Array.apply(0,Array(50)).map(()=>random())}next(t=0,i=1){return this.ey[this.bB++%this.ey.length]*(i-t)+t}reset(){this.bB=0}}cK=(t,i,e,s=50)=>{let h=_v(t.g.R("B")),a=0;for(;t.x<h.x-i;)t.x+=2*i,a=1;for(;t.x>h.x+i;)t.x-=2*i,a=1;for(;t.y<h.y-e;)t.y+=2*i;for(;t.y>h.y+e;)t.y-=2*i;for(;a;)t.y=t.g.aJ(t.x)+T(s,500)*bc([-1,1]),a=abs(t.y-t.g.aJ(t.x))<s||t.aZ};class gB{constructor(){this.bA=new Set,this._y=new Map,this.bz=[],this._o=1,this.bx=new Set}add(t){if(!this.bA.has(t)){this.bA.add(t),t.g=this,this.bz.push(t);for(let i of t._y)this._y.has(i)?this._y.get(i).add(t):this._y.set(i,new Set([t]));return t}}R(t){return this._y.get(t)||[]}_l(t){this.bA.delete(t);for(let i of t._y)this._y.has(i)&&this._y.get(i).delete(t);let i=this.bz.indexOf(t);i>=0&&this.bz.splice(i,1)}C(t){if(!bf){for(let i of this.bA)i.C(t*(i._X?this._o:1));for(let t of this.bx)t()}}aJ(t){return 200*sin(t*N/2e3)+100*sin(t*N/1e3)}_q(){let t=_v(this.R("B"));$.fillStyle="#996",$.fillRect(0,0,1280,720),t.D%10<.3&&t.D%.2<.1&&$.G(()=>{$.globalAlpha=.3,$.fillStyle="#fff",$.fillRect(0,0,1280,720)}),$.G(()=>{$.scale(t._N,t._N),$.translate(640/t._N-t.x,360/t._N-t.y),this.bz.sort((t,i)=>t.z-i.z);for(let t of this.bz)$.G(()=>t._q())})}async _t(t){return new Promise(i=>{let e=()=>{t()&&(this.bx.delete(e),i())};this.bx.add(e)})}async _b(t){let i=this.add(new Y);await this._t(()=>i.D>t),i._l()}}onload=()=>{(_g=document.querySelector("canvas")).width=1280,_g.height=720,$=_g.getContext("2d"),onresize(),ev()};let eu=performance.now(),az=new eG;ev=()=>{let t=performance.now(),i=(t-eu)/1e3;eu=t,az.C(i),$.G(()=>az.g._q()),requestAnimationFrame(ev)}</script>