<!doctype html><title>CosmoColonies - js13kGames 2020</title><meta content="width=device-width" name=viewport><style>body{margin:0;padding:0;overscroll-behavior:contain}canvas{display:block;background:#000;margin:0 auto;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}</style><script>function t(t,e){for(var i=new Array(t),s=0;s<t;s++)i[s]=new Array(e);return i}function dt(t,e,i){return t<e?e:i<t?i:t}function yt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}let ut=function(){var t={};function e(t,e,i){this.x=t,this.y=e,this.z=i}e.prototype.dot2=function(t,e){return this.x*t+this.y*e},g3=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)];let s=[];for(;s.length<300;)s.push((yt(0,255)+yt(0,255))/2);function l(t){return t*t*t*(t*(6*t-15)+10)}function h(t,e,i){return(1-i)*t+i*e}return s=[...new Set(s)],perm=new Array(512),gP=new Array(512),t.seed=function(t){for(0<t&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8),i=0;i<256;i++)v=0,v=1&i?s[i]^255&t:s[i]^t>>8&255,perm[i]=perm[i+256]=v,gP[i]=gP[i+256]=g3[v%12]},t.seed(0),t.perlin2=function(t,e){return X=Math.floor(t),Y=Math.floor(e),t-=X,e-=Y,X&=255,Y&=255,n00=gP[X+perm[Y]].dot2(t,e),n01=gP[X+perm[Y+1]].dot2(t,e-1),n10=gP[X+1+perm[Y]].dot2(t-1,e),n11=gP[X+1+perm[Y+1]].dot2(t-1,e-1),u=l(t),h(h(n00,n10,u),h(n01,n11,u),l(e))},t}();class pt{constructor(t,e,i,s,l,h){this.x=t,this.y=e,this.w=i,this.h=s,this.img=l,this.args=null==h?{}:h,this.args.data={},this.isHoveringOver=!1,this.tooltip=null}update(t,e){t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h?(this.isHoveringOver||(this.args.hoverCallback&&this.args.hoverCallback(),this.isHoveringOver=!0),this.args.clickCallback&&e&&this.args.clickCallback()):this.isHoveringOver=!1}render(t,e){this.args.showbgRec&&(t.save(),t.fillStyle=this.args.bgRecColor,t.fillRect(this.x-this.args.bgRecExtraSize,this.y-this.args.bgRecExtraSize,this.w+2*this.args.bgRecExtraSize,this.h+2*this.args.bgRecExtraSize),t.restore()),this.isHoveringOver&&this.args.showhovRec&&(t.save(),t.fillStyle=this.args.hovRecColor,t.fillRect(this.x-this.args.hovRecExtraSize,this.y-this.args.hovRecExtraSize,this.w+2*this.args.hovRecExtraSize,this.h+2*this.args.hovRecExtraSize),t.restore()),t.drawImage(this.img,this.x,this.y,this.w,this.h),null!==this.tooltip&&this.tooltip.render(t,e)}}class ft{constructor(t,e,i,s,l,h){this.x=t,this.y=e,this.w=i,this.h=s,this.text=l,this.args=h,this.bgColor="#fff"}update(t,e){t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h?(this.isHoveringOver=!0,this.args.hovBgColor&&(this.bgColor=this.args.hovBgColor),this.args.clickCallback&&e&&this.args.clickCallback()):(this.isHoveringOver=!1,this.bgColor=this.args.bgColor)}render(t){t.save(),t.fillStyle=this.bgColor,t.fillRect(this.x,this.y,this.w,this.h),t.fillStyle="#fff",t.font=this.args.fontSize+"px monospace",t.textAlign="center",t.fillText(this.text,this.x+this.w/2,this.y+1.05*this.args.fontSize),t.restore()}}class h{constructor(t,e,i){this.x=t,this.y=e,this.w=256,this.h=128,this.buildingType=i,this.canDestroy=!1}render(e,t){var i=[];this.buildingType.cost&&i.push({icon:t.i_cost.el,value:this.buildingType.cost}),this.buildingType.opCostWk&&i.push({icon:t.i_op_cost.el,value:this.buildingType.opCostWk+"/wk"}),this.buildingType.eDemand&&i.push({icon:t.i_power.el,value:"-"+this.buildingType.eDemand}),this.buildingType.eOutput&&i.push({icon:t.i_power.el,value:this.buildingType.eOutput}),this.buildingType.o2Output&&i.push({icon:t.i_o2.el,value:this.buildingType.o2Output}),this.buildingType.h2oOutput&&i.push({icon:t.i_h2o.el,value:this.buildingType.h2oOutput}),this.h=64+48*i.length,e.save(),e.fillStyle="#0000ff",e.fillRect(this.x,this.y,this.w,this.h),e.fillStyle="#fff",e.fillText(this.buildingType.name,this.x+32,this.y+32);for(let t=0;t<i.length;t++){var s=i[t];e.drawImage(s.icon,this.x+22,this.y+44+48*t,24,24),e.fillText(s.value,this.x+52,this.y+64+48*t)}e.restore()}}class xt{constructor(t,e,i,s,l){this.x=t,this.y=e,this.w=i,this.h=s,this.img=l,this.destroyDelay=10,this.destroyTick=0,this.canDestroy=!1}update(){this.destroyTick<this.destroyDelay?this.destroyTick++:this.canDestroy=!0}render(t){t.drawImage(this.img,this.x,this.y,this.w,this.h)}}class wt{constructor(t,e,i,s,l,h){this.x=t,this.y=e,this.w=i,this.h=s,this.img=l,this.args=h,this.state=0,this.vel={x:0,y:0},this.canDestroy=!1}update(){switch(this.state){case 0:0==this.args.orientation?this.x<this.args.target.x?this.vel.x=this.args.speed:this.x>this.args.target.x?this.vel.x=-this.args.speed:(this.state=1,this.vel.x=0,this.vel.x=0):this.y<this.args.ascendDecentHeight?this.vel.y=this.args.speed:this.y>this.args.ascendDecentHeight?this.vel.y=-this.args.speed:(this.state=1,this.vel.x=0,this.vel.y=0);break;case 1:this.y<this.args.landedY?this.vel.y=.5:(this.state=2,this.vel.x=0,this.vel.y=0);break;case 3:this.y>this.args.ascendDecentHeight?this.vel.y=-.5:(5<yt(this.vel.y=0,10)?this.vel.x=5<yt(0,10)?-this.args.speed:this.args.speed:this.vel.y=5<yt(0,10)?-this.args.speed:this.args.speed,this.state=4)}this.x+=this.vel.x,this.y+=this.vel.y}render(t){t.drawImage(this.img,this.x,this.y,this.w,this.h)}}window.addEventListener("DOMContentLoaded",()=>{let n=["btn_ore_insights","btn_buildings","btn_buildings_left","btn_buildings_right","i_power","i_ore","i_o2","i_h2o","i_cost","i_op_cost","t_rocket","t_dynamite","t_headquarters","t_tube","t_solar","t_oxygen_gen","t_water_tower","t_habitat","t_ore_sensor","t_mine","t_satdish","t_landing_pad","t_moon","o_explosion","o_lander","o_flare","o_title_lander"];for(let t=0;t<n.length;t++){var e=n[t],s=new Image;s.src=e+".png",n[e]={key:e,el:s}}let g=document.createElement("canvas"),c=(g.width=960,g.height=640,g.getContext("2d")),B=(c.imageSmoothingEnabled=!1,document.body.appendChild(g),0),d=!1,y=!1,u={x:0,y:0},p=null,f=-64,x=0,w={x:0,y:0},v={x:0,y:0},i=[];function L(){c.save(),c.fillStyle="#fff";for(let t=0;t<i.length;t++){var e=i[t];c.fillRect(e.x,e.y,e.size,e.size)}c.restore()}let N,b,j,_,U,m,o=0,k=t(Math.floor(g.width/16),Math.floor(g.height/16)),r=[],C=t(Math.floor(g.width/16),Math.floor(g.height/16)),T=[],S=[],O=0,D=[],R=[],F=[],G=yt(0,2e3),J=yt(0,2e3),K=k.length,Q=k[0].length,V=Math.floor(K/2),Z=Math.floor(Q/2),M=1500,E=yt(2,3),$=0,tt=0,I=0,et=0,it=0,st=1,lt=0,ht=!1,at=0,ot=!1,P=!1,z={moon:{key:"t_moon",isSelectable:!1,cost:0},rocket:{key:"t_rocket",isSelectable:!1,cost:0,colonistCapacity:4,eOutput:5,o2Output:20,h2oOutput:10},dynamite:{name:"Dynamite",key:"t_dynamite",cost:50,freePlace:!0,canOverrideTile:!0},headquarters:{name:"Headquarters",key:"t_headquarters",cost:1e3,opCostWk:10,colonistCapacity:10,eDemand:50,eOutput:50,h2oOutput:50,o2Output:30},tube:{name:"Transport Tube",key:"t_tube",cost:10,opCostWk:2,eDemand:2,freePlace:!0},solar:{name:"Solar Panel",key:"t_solar",cost:50,opCostWk:5,eOutput:100},oxygen_gen:{name:"Oxygen Generator",key:"t_oxygen_gen",cost:550,opCostWk:100,o2Output:500},water_tower:{name:"Water Tower",key:"t_water_tower",cost:550,opCostWk:75,h2oOutput:500},habitat:{name:"Habitat",key:"t_habitat",cost:350,opCostWk:30,colonistCapacity:50,eDemand:50,h2oOutput:100,o2Output:100,timeTriggerWeekly:t=>{M+=50}},ore_sensor:{name:"Ore Sensor",key:"t_ore_sensor",cost:350,opCostWk:15,eDemand:10,freePlace:!0},mine:{name:"Mine",key:"t_mine",cost:1e3,opCostWk:150,eDemand:50,timeTriggerWeekly:i=>{var s=[];for(let e=i.x-3;e<i.x+4;e++)for(let t=i.y-3;t<i.y+4;t++)Math.pow(e-i.x,2)+Math.pow(t-i.y,2)<=Math.pow(3,2)&&C[e][t]&&s.push(C[e][t]);s.forEach(t=>{0<t.value&&(I+=yt(1,2),0<t.value-.001?t.value-=.001:t.value=0,M+=yt(1,2))})}},satdish:{name:"Satellite Dish",key:"t_satdish",cost:350,eDemand:20},landing_pad:{name:"Landing Pad",key:"t_landing_pad",cost:500,eDemand:20}},W=null,Y=null,H=[],rt=null,nt=null,A=0,X="",gt=!1;function q(i,s){for(let e=0;e<i.length;e++)for(let t=0;t<i[0].length;t++){var l=i[e][t];l&&s(e,t,l)}}function ct(i){var e=Object.keys(z);for(let t=0;t<e.length;t++){var s=z[e[t]];null==s.isSelectable||s.isSelectable||e.splice(t,1)}let l=0;e.forEach((e,t)=>{if(i<=t-1&&t<=i+10){let t=z[e];null!=t.isSelectable&&!t.isSelectable||(btnBuilding=new pt(180+72*l,g.height-72,48,48,n[t.key].el,{clickCallback:()=>{X=e,P=!1},hoverCallback:()=>{btnBuilding.tooltip=new h(8192,8192,t)},showhovRec:!0,hovRecColor:"#7575ff",hovRecExtraSize:8,showbgRec:!0,bgRecColor:"#d1190d",bgRecExtraSize:8,buildingType:t}),H.push(btnBuilding),l++)}})}function l(t,e){var i=(null==e.clientX?e.changedTouches[0]:e).clientX,s=(e=(null==e.clientY?e.changedTouches[0]:e).clientY,t.getBoundingClientRect());return{x:Math.round((i-s.left)/(s.right-s.left)*t.width),y:Math.round((e-s.top)/(s.bottom-s.top)*t.height)}}for(let t=0;t<100;t++)i.push({x:yt(0,g.width),y:yt(0,g.height),size:yt(1,2)});(function t(e){switch(B=e){case 0:p=new ft(g.width/2-128,380,256,64,"PLAY",{bgColor:"#4d3d87",hovBgColor:"#7c6fab",fontSize:48,clickCallback:()=>{t(1)}});break;case 1:var i=yt(10,20);for(let e=V-i;e<V+i;e++)for(let t=Z-i;t<Z+i;t++){var s=Math.pow(e-V,2)+Math.pow(t-Z,2),l=(ut.seed(G),ut.perlin2(e/yt(24,26),t/yt(24,25))),h=(ut.seed(J),dt(ut.perlin2(e/10,t/10),.01,1));s<=Math.pow(i,2)+100*l&&.001<l&&(k[e][t]={id:o,x:e,y:t,type:z.moon},o++,C[e][t]={id:o,x:e,y:t,value:h},.05<l)&&r.push({x:e,y:t})}var a=r[yt(0,r.length-1)];k[a.x][a.y].type=z.rocket,W=new pt(0,g.height-192,96,96,n.btn_ore_insights.el,{clickCallback:()=>{ot=!ot}}),Y=new pt(0,g.height-96,96,96,n.btn_buildings.el,{clickCallback:()=>{gt=!0,P=!P}}),rt=new pt(106,g.height-96,50,96,n.btn_buildings_left.el,{clickCallback:()=>{0<A&&(A--,H.length=0,ct(A))}}),nt=new pt(g.width-50-10,g.height-96,50,96,n.btn_buildings_right.el,{clickCallback:()=>{A<Object.keys(z).length-10-2&&(A++,H.length=0,ct(A))}}),ct(0)}})(0),setInterval(t=>{switch(c.clearRect(0,0,g.width,g.height),hasClicked=!(d||!y),B){case 0:c.save(),c.fillStyle="#060214",c.fillRect(0,0,g.width,g.height),c.restore(),L();for(let e=-10;e<g.width/64+10;e++)for(let t=0;t<10;t++)c.drawImage(n.t_moon.el,64*e,g.height-320+t*(.05*t)*64,64,64);0==x?180<f?f-=2:x=1:f<220?f+=2:x=0,c.drawImage(n.o_title_lander.el,g.width/2-32,f,64,64),p.update(u,hasClicked),p.render(c),c.save(),c.fillStyle="#fff",c.textAlign="center",c.font="bold 64px monospace",c.fillText("COSMOCOLONIES",g.width/2,96),c.font="24px monospace",c.fillText("© 2020 JARED YORK",g.width/2,138),c.restore();break;case 1:if($=0,tt=0,b=0,et=0,it=0,D.length=0,R.length=0,F.length=0,q(k,(t,e,i)=>{"t_landing_pad"==i.type.key?D.push(i):"t_ore_sensor"==i.type.key?R.push(i):"t_satdish"==i.type.key?F.push(i):"t_dynamite"==i.type.key&&(k[t][e].type=z.moon,T.push(new xt(16*t,16*e,16,16,n.o_explosion.el))),i.type.eOutput&&(tt+=i.type.eOutput),i.type.eDemand&&($+=i.type.eDemand),i.type.o2Output&&(et+=i.type.o2Output),i.type.h2oOutput&&(it+=i.type.h2oOutput)}),b=tt-$,h2oOutput=0,j=0,_=et-(j=5*E),m=it-(U=2*E),0<D.length)if(S.forEach(t=>{if(2==t.state)if(t.args.landedDuration<t.args.landedMaxDuration)t.args.landedDuration++;else{switch(t.args.visitType){case 1:var e=yt(1,3),i=yt(100,500);0<I-i&&(M+=i*e,I-=i);break;case 2:E+=yt(3,5);break;case 3:e=yt(3,5),5<E-e&&(E-=e)}t.state=3,t.targetPadId=null}}),N=0<F.length?150:1e3,O<N)O++;else{let e=D[yt(0,D.length-1)],i=!0;var s,l,h,a;S.forEach(t=>{t.args.targetPadId==e.id&&(i=!1)}),i&&(yt(0,10),s=16*e.x,l=5<=yt(0,10)?-16:g.height+16,h=16*e.y,a=yt(0,3),S.push(new wt(s,l,16,16,n.o_lander.el,{targetPadId:e.id,target:{x:16*e.x,y:16*e.y},visitType:a,ascendDecentHeight:16*e.y-8,landedY:h,orientation:1,speed:1,landedMaxDuration:yt(10,300),landedDuration:0}))),O=0}for(let t=0;t<S.length;t++){var e=S[t];e.update(),(e.x<-e.w||e.x>g.width+e.w||e.y<-e.h||e.y>g.height+e.h)&&(e.canDestroy=!0),e.canDestroy&&S.splice(t,1)}if(lt<10)lt++;else{if(++st%7==0&&q(k,(t,e,i)=>{i.type.opCostWk&&(M-=i.type.opCostWk),i.type.timeTriggerWeekly&&i.type.timeTriggerWeekly(i)}),q(k,(t,e,i)=>{i.timeTriggerDaily&&i.timeTriggerDaily(i)}),0<b&&0<_&&0<m){let s=0;q(k,(t,e,i)=>{i.type.colonistCapacity&&(s+=i.type.colonistCapacity)}),a=yt(0,Math.ceil(.05*E)),E+a<s&&95<yt(0,100)&&(E+=a)}else a=yt(0,Math.ceil(.1*E)),0<E&&(E-=a);lt=0}w.x=16*Math.floor(u.x/16),w.y=16*Math.floor(u.y/16),v.x=dt(w.x/16,0,K-1),v.y=dt(w.y/16,0,Q-1),W&&W.update(u,hasClicked),Y&&Y.update(u,hasClicked),P&&(rt.update(u,hasClicked),nt.update(u,hasClicked),H.forEach(function(t){t.update(u,hasClicked)})),L(),q(k,(t,e,i)=>{c.drawImage(n[i.type.key].el,16*t,16*e,16,16)});for(let t=0;t<T.length;t++)T[t].update(),T[t].render(c),T[t].canDestroy&&T.splice(t,1);if(0<at&&(at-=.1),ot){var i=[];for(let t=0;t<R.length;t++){var o,r=R[t];for(let e=r.x-2;e<r.x+3;e++)for(let t=r.y-2;t<r.y+3;t++)Math.pow(e-r.x,2)+Math.pow(t-r.y,2)<=Math.pow(2,2)&&C[e][t]&&(i.push({x:r.x,y:r.y}),o=1/C[e][t].value*10,c.save(),c.fillStyle="rgba("+(90+o)+","+(40+o)+","+o+",255)",c.globalAlpha=.75,c.fillRect(16*e,16*t,16,16),c.restore())}}if(0<X.length){c.save();let t=k[v.x][v.y],i=!1;if(t){let e=!1;z[X].freePlace?e=!0:(a=[],k[t.x][t.y-1]&&a.push(k[t.x][t.y-1]),k[t.x+1][t.y]&&a.push(k[t.x+1][t.y]),k[t.x][t.y+1]&&a.push(k[t.x][t.y+1]),k[t.x-1][t.y]&&a.push(k[t.x-1][t.y]),a.forEach(t=>{t&&"t_moon"!=t.type.key&&(e=!0)})),("t_moon"==t.type.key||z[X].canOverrideTile)&&e&&(i=!0),M<z[X].cost&&(i=!1),ht||"t_headquarters"==z[X].key||(i=!1),"dynamite"==X&&"t_headquarters"==t.type.key&&(i=!1)}t&&i?(c.fillStyle="#34f000",y&&(k[v.x][v.y].type=z[X],M-=z[X].cost,"headquarters"==X)&&(ht=!0)):c.fillStyle="#ff0000",c.globalAlpha=.5,c.fillRect(w.x,w.y,16,16),c.restore()}S.forEach(t=>{t.render(c)}),W&&W.render(c),Y&&Y.render(c),c.save(),c.fillStyle=0<M?"#fff":"#ff0000",c.font="20px monospace",c.fillText("FUNDS: "+M,16,32),c.fillStyle=0<E?"#fff":"#ff0000",c.fillText("POPULATION: "+E,16,56),c.fillStyle="#fff",c.fillText("DAY: "+st,16,80),0<X.length?(c.drawImage(n[z[X].key].el,112,g.height-72,32,32),c.fillText("Building: "+z[X].name,112,g.height-16)):gt||c.fillText("<-- Click the build menu to select buildings",112,g.height-16),c.drawImage(n.i_power.el,g.width-180,16,24,24),c.fillStyle=0<b?"#34f000":"#ff0000",c.fillText(b,g.width-180+32,36),c.drawImage(n.i_o2.el,g.width-180,48,24,24),c.fillStyle=0<_?"#34f000":"#ff0000",c.fillText(_,g.width-180+32,68),c.drawImage(n.i_h2o.el,g.width-180,80,24,24),c.fillStyle=0<m?"#34f000":"#ff0000",c.fillText(m,g.width-180+32,100),c.drawImage(n.i_ore.el,g.width-180,112,24,24),c.fillStyle="#fff",c.fillText(I,g.width-180+32,132),P&&(c.save(),c.fillStyle="#0000ff",c.fillRect(96,g.height-96,g.width-96,96),c.restore(),rt.render(c),nt.render(c),H.forEach(function(t){M>=t.args.buildingType.cost?t.args.bgRecColor="#34f000":t.args.bgRecColor="#d1190d",ht||"t_headquarters"==t.args.buildingType.key||(t.args.bgRecColor="#d1190d"),t.render(c,n),t.tooltip&&(t.tooltip.x=u.x,t.tooltip.y=u.y-t.tooltip.h,t.tooltip.x+t.tooltip.w>g.width&&(t.tooltip.x=g.width-t.tooltip.w),t.tooltip.y=g.height-96-t.tooltip.h)}))}d=y},33),onmousedown=function(t){u=l(g,t),d=y,y=!0},onmousemove=function(t){u=l(g,t)},onmouseup=function(t){u=l(g,t),y=!1}})</script>