<!doctype html><meta name=viewport content="width=device-width"><title>Dusk - js13kGames 2025</title><style>:root{font-family:system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#000;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{margin:0}#app{max-width:1280px;margin:0 auto;padding:0 2rem 2rem;text-align:center}.jagged{-webkit-clip-path:polygon(5% 10%,46% 1%,46% 10%,100% 0,95% 90%,31% 100%,31% 90%,0 100%);clip-path:polygon(5% 10%,46% 1%,46% 10%,100% 0,95% 90%,31% 100%,31% 90%,0 100%)}button{transition:font-weight .1s ease,-webkit-clip-path .2s ease;transition:font-weight .1s ease,clip-path .2s ease;transition:font-weight .1s ease,clip-path .2s ease,-webkit-clip-path .2s ease;display:inline-block;padding:1em 1.5em;font-family:var(--font-main);text-decoration:none;text-align:center;line-height:normal;-webkit-appearance:none;background-color:#003d7e;color:#fff;border:0;box-shadow:none}button:hover{color:#000;cursor:pointer;text-decoration:none;font-weight:800;background-color:#646cff;-webkit-clip-path:polygon(5% 10%,66% 1%,66% 10%,100% 0,95% 90%,51% 100%,51% 90%,0 100%);clip-path:polygon(5% 10%,66% 1%,66% 10%,100% 0,95% 90%,51% 100%,51% 90%,0 100%)}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}.enable-transitions{transition:transform .2s ease}.disable-button{pointer-events:none;opacity:.5}.flex-row{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:1rem}.flex-col{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem}.flex-cards{display:flex;flex-direction:row;justify-content:center;align-items:center;flex-wrap:wrap;gap:1rem;padding:2rem;border-radius:8px}.void-phase{background-color:#6e0000}.last-line,.ui-wrapper{opacity:0}.last-line.visible{opacity:1;transition:opacity 1s ease-in-out}.hidden{display:none}.area-wrappers{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:1rem;flex-wrap:wrap;width:50%}.phases-wrapper{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:1rem;margin-bottom:.5rem}.phase-wrapper{padding:.2rem .4rem 0;min-width:3rem}.phase-wrapper.active{border-bottom:3px solid #fff}.game-area-wrapper{display:flex;justify-content:center;gap:20px;flex-direction:column;margin-bottom:2rem}.deck-dealt-wrapper{display:flex;flex-direction:row;justify-content:center;gap:20px}.deck-wrapper{width:9rem;height:13.5rem;display:inline-block;vertical-align:top;position:relative}.deck-wrapper .deck-card-wrapper{position:absolute}.pile-wrapper{width:9rem;height:13.5rem;background-color:#8080805a;display:inline-block;vertical-align:top;position:relative;border-radius:8px}.pile-wrapper .pile{position:absolute}.play-area-wrapper{background:linear-gradient(0deg,#000,#060e2a);display:flex;flex-direction:column;justify-content:flex-start;gap:1rem;flex-wrap:wrap;border:1px solid #fff;border-radius:8px}.play-area-min-height{min-height:20rem}.flex-row-top{display:flex;gap:1rem}.play-area-header{text-align:left;font-weight:700;padding-left:.3rem}.play-area-body{padding:1rem;display:flex;flex-direction:column;justify-content:center;gap:1rem}.played{opacity:.2}.play-area-bod-inner{padding:1rem;display:flex;flex-direction:row;justify-content:center;gap:1rem;flex-wrap:wrap;min-height:216px}.card-container{width:9rem;height:13.5rem;perspective:1000px;cursor:pointer}.card{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .35s ease-in-out;border-radius:10px;will-change:transform}.face-up .card{transform:rotateY(0)}.face-down .card{transform:rotateY(180deg)}.face-down .card,.face-up .card{transform-origin:50% 50%}.card-face{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;border-radius:8px;backface-visibility:hidden;transform:rotateY(0)}.front{background:linear-gradient(0deg,#000,#060e2a);color:#fff;z-index:2;print-color-adjust:exact;-webkit-print-color-adjust:exact;border:2px solid #202020}.front.rift{background:linear-gradient(0deg,#000,#450000)}.front.echo{background:linear-gradient(0deg,#000,#001357)}.front.omen{background:linear-gradient(0deg,#000,#323232)}.front.multi{background:linear-gradient(0deg,#000,#584800)}.back{transform:rotateY(180deg);display:grid;place-items:center;background:#5b5b5b}.back-pattern{width:160px;height:240px;pointer-events:none;transform:translate(-7px,-9px)}.card-name,.card-type{font-size:.8rem;font-weight:700;margin-top:.5rem;overflow:hidden;font-weight:400}.card-image{max-width:85px}.card-type{margin-top:-16px;font-weight:700}.card-rules{padding:3px}.card-inner-front{font-size:.7rem;position:relative}.active-card-wrapper{position:absolute;top:0;left:0;right:0;bottom:0;z-index:10000;pointer-events:none}.active-card-wrapper .pile{transform:scale(1.6)}.dialog-wrapper{padding:1rem;position:fixed;left:0;right:0;top:0;bottom:0;background:#000000e0;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:2rem}.dialog-wrapper.hidden{display:none}.dialog{border-radius:8px;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:2rem;gap:2rem;overflow-x:hidden;overflow-y:auto}.dialog-areas{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:2rem}.dialog-ui{margin:2rem 0 0}.game-rules-wrapper{text-align:left;padding:1rem;background-color:#000;max-width:600px}#eyes{width:100%;max-width:600px;margin:0 auto}.eyes-wrapper{display:flex;flex-direction:row;justify-content:space-around;align-items:center}.eye-wrapper{width:150px;height:116px;overflow:hidden;position:relative}.eye-background{position:absolute;bottom:-41px;left:-155px}.eye-layer{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;aspect-ratio:100/100;height:auto}.number-buttons-wrapper{display:flex;flex-direction:row;justify-content:center;align-items:center}.number{width:2rem;height:2rem;background-color:#fff;border-radius:1rem;color:#000;font-weight:700;display:flex;justify-content:center;align-items:center}.deck-card-wrapper{position:relative}.deck-card-wrapper.dnd-insert-after:after,.deck-card-wrapper.dnd-insert-before:before{content:"";position:absolute;left:0;right:0;height:2px;background:currentColor;opacity:.35}.deck-card-wrapper.dnd-insert-before:before{top:-1px}.deck-card-wrapper.dnd-insert-after:after{bottom:-1px}.pulse-border{border:5px solid #3498db;animation:pulse 2s infinite}@keyframes pulse{0%{box-shadow:0 0 #3498db}70%{box-shadow:0 0 0 9px #3498db80}to{box-shadow:0 0 #3498db00}}@media (max-width:480px){#app{padding:0 1rem 1rem}.flex-row-top{flex-direction:column}.play-area-wrapper{width:100%}.back-pattern{display:none}}</style><div id=eyes></div><div id=app></div><script>!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Me=(e,t)=>{let a=structuredClone(e),i=!1;return!1===i&&(t(e),i=!0),{get:()=>structuredClone(a),set:e=>{t(e),a=e}}},L=e=>new Promise((t=>setTimeout(t,e))),pe=e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e},fe=e=>e[Math.floor(Math.random()*e.length)],Se=e=>Math.floor(Math.random()*e)+1,xe=(e,t,a={})=>{var i,n;const s=e.getAttribute("d");if(!s)throw new Error(`Element "${id}" has no 'd' attribute`);const r=/-?\d*\.?\d+(?:e[-+]?\d+)?/gi,o=null==(i=s.match(r))?void 0:i.map(Number),l=null==(n=t.match(r))?void 0:n.map(Number);if(!o||!l||o.length!==l.length)throw new Error("Start and target paths must have identical command structure and number count.");const c=a.easing||(e=>.5-.5*Math.cos(Math.PI*e)),d=Math.max(1,a.duration||800);return new Promise((t=>{let a;requestAnimationFrame((function i(n){a??(a=n);const p=Math.min(1,(n-a)/d),u=c(p),y=o.map(((e,t)=>((e,t,a)=>e+(t-e)*a)(e,l[t],u))),h=s.replace(r,(()=>{const e=y.shift();return Math.abs(e)<1e-6?"0":e.toFixed(3).replace(/\.?0+$/,"")}));e.setAttribute("d",h),p<1?requestAnimationFrame(i):t()}))}))},ce=(e,t)=>{const a=document.querySelectorAll(".upper-brow"),i=e?600:600+Se(200),n=`m-6,0l649,0l0,${t||i}c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z`;for(let e=0;e<a.length;e++)xe(a[e],n,{duration:200+3*i})},ye=e=>{const t=document.querySelectorAll(".iris"),a=e?"m345.22,45c-188.76,49.98 -199.63,117.3 -216.1,197.88c2.69,140.76 156.4,202.98 220.35,210.12c2.13,0 200.44,-22.44 196.5,-210.12c-5.14,-149.94 -200.76,-197.88 -200.76,-197.88z":"m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z";for(let e=0;e<t.length;e++)setTimeout((()=>{xe(t[e],a,{duration:500})}),2200)},m=(e,t)=>e.filter((e=>e.zone===t)).sort(((e,t)=>e.zoneOrder-t.zoneOrder)).reverse(),G=(e,{size:t=180,cell:a=14,jitter:i=.85}={})=>{const n=t,s=e=>Math.max(0,Math.min(n-1,e)),r=document.createElement("canvas");r.width=r.height=n;const o=r.getContext("2d",{willReadFrequently:!0});function l(e,t){o.clearRect(0,0,n,n);const a=window.devicePixelRatio||1;(o.canvas.width!==n*a||o.canvas.height!==n*a)&&(o.canvas.width=n*a,o.canvas.height=n*a,o.canvas.style.width=n+"px",o.canvas.style.height=n+"px"),o.setTransform(a,0,0,a,0,0),o.font=`${n}px ${t}`,o.textAlign="center",o.textBaseline="alphabetic",o.fillStyle="#000";const i=o.measureText(e);let s=i.actualBoundingBoxAscent,r=i.actualBoundingBoxDescent;s>0||r>0||(s=i.fontBoundingBoxAscent??0,r=i.fontBoundingBoxDescent??0),s>0||r>0||(s=.8*n,r=.2*n);const l=n/2,c=n/2+(s-r)/2;o.fillText(e,l,c)}function c(){const e=o.getImageData(0,0,n,n).data;for(let t=3;t<e.length;t+=4)if(0!==e[t])return!0;return!1}const d=['"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif','"Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"sans-serif"];let p=!1,u=e;for(let t=0;t<3&&!p;t++)l(u,d[t]),p=c(),!p&&0===t&&!/\uFE0F/.test(u)&&(u=e+"️",t--);p||(o.clearRect(0,0,n,n),o.fillStyle="#000",o.fillRect(n,n,n,n));const y=[],h=a*i*.5;for(let e=0;e<=n;e+=a){const t=[];for(let i=0;i<=n;i+=a){const a=i>0&&i<n?(2*Math.random()-1)*h:0,r=e>0&&e<n?(2*Math.random()-1)*h:0;t.push([s(i+a),s(e+r)])}y.push(t)}const m=document.createElement("canvas");m.width=n,m.height=n+20;const v=m.getContext("2d");function f(e,t,a){const i=s((e[0]+t[0]+a[0])/3|0),n=s((e[1]+t[1]+a[1])/3|0),r=o.getImageData(i,n,1,1).data;r[3]<1||(v.beginPath(),v.moveTo(e[0],e[1]),v.lineTo(t[0],t[1]),v.lineTo(a[0],a[1]),v.closePath(),v.fillStyle=`rgba(${r[0]},${r[1]},${r[2]},${(r[3]/255).toFixed(3)})`,v.fill())}for(let e=0;e<y.length-1;e++)for(let t=0;t<y[e].length-1;t++){const a=y[e][t],i=y[e][t+1],n=y[e+1][t],s=y[e+1][t+1];Math.random()<.5?(f(a,i,s),f(a,s,n)):(f(a,i,n),f(i,s,n))}return m.toDataURL("image/png")},$=(e,...t)=>e.reduce(((e,a,i)=>e+a+(t[i]??"")),""),me=(e,t)=>e.map(t).join(""),N=(e,t,a)=>m(e,t).map(a).join(""),Ae=(e,t)=>{e.innerHTML=t()},le=["c","c","c","c","c","c","c","c","c","u","u","u","u","r"],Re=["rift","echo","omen"],se=["🦀","🔥","🥩","🧣"],ne=["🫐","🦋","🌀","❄️"],oe=["🪙","⚙️","🪞","📓"],ve=(e,t)=>{let a=oe[3];return"rift"===e&&(a=se[3]),"echo"===e&&(a=ne[3]),{name:`${String(e).charAt(0).toUpperCase()+String(e).slice(1)} Goal Card`,types:[e],zone:t+"Goal",abilityFunct:[],abilityRule:[`At the end of your turn if you have 7 or more other ${e} cards in your play area you win.`],cardArt:G(a,{size:100,cell:10})}},X={blank:{name:"Eclipse Void",types:["rift","echo","omen"],abilityFunct:[],abilityRule:[],cardArt:G("🎭",{size:100,cell:10})},cRift:{name:"Stellar Crypt",types:["rift"],abilityFunct:["floodOpponent$Time:2"],abilityRule:["Flood your opponent 2 times."],cardArt:G(se[0],{size:100,cell:10})},uRift:{name:"Grave Haunt",types:["rift"],abilityFunct:["floodOpponent$Time:3"],abilityRule:["Flood your opponent 3 times."],cardArt:G(se[1],{size:100,cell:10})},rRift:{name:"Chasm Infernal",types:["rift"],abilityFunct:["floodAllPlayers$Time:2"],abilityRule:["Flood all players 2 times."],cardArt:G(se[2],{size:100,cell:10})},cEcho:{name:"Ethereal Nebula",types:["echo"],abilityFunct:["return$Time:1"],abilityRule:["Return a card 1 time."],cardArt:G(ne[0],{size:100,cell:10})},uEcho:{name:"Cosmic Lunar",types:["echo"],abilityFunct:["returnAllExhaustedCards"],abilityRule:["Return all your exhuasted cards."],cardArt:G(ne[1],{size:100,cell:10})},rEcho:{name:"Umbral Aster",types:["echo"],abilityFunct:["unexhaustAllYourExhaustedCards"],abilityRule:["Unexhaust all your exhuasted cards."],cardArt:G(ne[2],{size:100,cell:10})},cOmen:{name:"Orbit Crypt",types:["omen"],abilityFunct:["remianingCardsInPileGoToYourPlayArea"],abilityRule:["The remaining cards in this pile go to your play area."],cardArt:G(oe[0],{size:100,cell:10})},uOmen:{name:"Nebula Specter",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:2"],abilityRule:["Exhaust 2 random unexhausted cards in your opponents play area."],cardArt:G(oe[1],{size:100,cell:10})},rOmen:{name:"Shadow Singularity",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:4"],abilityRule:["Exhaust 4 random unexhausted cards in your opponents play area."],cardArt:G(oe[2],{size:100,cell:10})}},ee=(e,t,a)=>({id:t,zoneOrder:0,zone:"deck",isSelected:!1,isActive:!1,isExhausted:!1,rarity:a,...e}),Ie=()=>{const e=[];for(let t=0;t<5;t++){const t=X.blank;e.push(ee(t,e.length+1,"U"))}const t=pe(Re);return e.push(ve(t[0],"player")),e.push(ve(t[1],"opponent")),le.forEach((t=>{const a=X[t+"Rift"];e.push(ee(a,e.length+1,t))})),le.forEach((t=>{const a=X[t+"Echo"];e.push(ee(a,e.length+1,t))})),le.forEach((t=>{const a=X[t+"Omen"];e.push(ee(a,e.length+1,t))})),pe(e).map(((e,t)=>(e.zoneOrder=t,e)))},$e=["deal","take","end"],Z=["deck","opponentPlay","opponentGoal","pile1","pile2","pile3"],H=["takeModal","playerPlay","active","playerGoal"],Fe=Ie(),Le=()=>new Promise((e=>{e({isIntroSkipped:!1,isUiHidden:!0,storyIndex:0,isStarted:!1,isPhaseButtonDisabled:!0,isPileToPlay:"deck",winner:void 0,activePlayer:"player",currentPhase:void 0,phases:$e,isModalOpen:!1,ui:{},cards:[...Fe],selectedPile:"pile1",pile1:[],pile2:[],pile3:[],player:{id:1,hand:[],play:[],isComputer:!1},opponent:{id:2,hand:[],play:[],isComputer:!0}})})),he=["","Well, well, well. Look what we have here?","A small flicker of light at dusk.","Delicious. I so rarely get guests","I so rarely get any guests... guests.","It's all so terrIBLY BORING I JUST WANT...","...I'm sorry I forget myself, forgot myself.","Welcome, you who stands at the edge twilight.","Come, sit with me and play a game.","It tastes like cards, and you wager yourself.","The night is almost here... you get the first play."],te=new Map,ae=new Map;function Ge({containerSelector:e=".card-container",faceUpClass:t="face-up",faceDownClass:a="face-down"}={}){return{startFlip(e){te.clear(),document.querySelectorAll("[data-flip]").forEach((e=>{const t=e.getAttribute("data-flip");if(!t)return;const a=e.getBoundingClientRect();te.set(t,a)}))},endFlip:(i=200,n)=>new Promise((s=>{const r=[];document.querySelectorAll("[data-flip]").forEach((i=>{const s=i.getAttribute("data-flip");if(!s)return;const o=te.get(s);if(!o)return;const l=i.getBoundingClientRect(),c=o.left-l.left,d=o.top-l.top;(c||d)&&(i.style.transform=`translate(${c}px, ${d}px)`,r.push(i));const p=n.cards.find((e=>e.id===parseInt(s,10))),u=null==p?void 0:p.zone,y=ae.get(s),h=i.querySelector(e);h&&(Z.includes(y)&&H.includes(u)?(h.classList.remove(a),h.classList.add(t)):H.includes(y)&&Z.includes(u)&&(h.classList.remove(t),h.classList.add(a))),ae.set(s,u)})),document.querySelectorAll("[data-face]").forEach((e=>{var i;const s=e.getAttribute("data-face");if(!s)return;const r=null==(i=n.cards.find((e=>e.id===parseInt(s,10))))?void 0:i.zone,o=ae.get(s);o&&(r!==o&&(Z.includes(o)&&H.includes(r)&&(e.classList.remove(a),e.classList.add(t)),H.includes(o)&&Z.includes(r)&&(e.classList.remove(t),e.classList.add(a))),ae.set(s,r))})),requestAnimationFrame((()=>{r.forEach((e=>{e.style.transition=`transform ${i}ms ease`,e.style.transform=""})),setTimeout((()=>{r.forEach((e=>{e.style.transition=""})),te.clear(),s()}),i)}))}))}}const je=G("🌌",{size:500,cell:15}),ge=new Map;function D(e,t,a=!1,i){var n,s,r;let o=e.types[0];("playerGoal"===e.zone||"opponentGoal"===e.zone||e.types.length>1)&&(o="multi");const l=ge.get(e.id),c=e.zone;let d="face-down";l&&c&&(H.includes(l)&&H.includes(c)?d="face-up":Z.includes(l)&&Z.includes(c)&&(d="face-down")),!0===a&&(d="face-up"),ge.set(e.id,c);const p=null!=e&&e.rarity?(null==(n=null==e?void 0:e.rarity)?void 0:n.toUpperCase())+" - ":"";return $`<div class="card-wrapper ${"active"===e.zone?"active-card":""} ${e.isExhausted?"played":""}" ${t?"":"data-flip="+e.id}><div class="card-container ${d}" data-face="${e.id}"><div class="card ${i?"pulse-border":""}"><div class="card-face front ${o}"><div class="card-inner-front"><div class="card-name">${e.name}</div><img class="card-image" src="${e.cardArt}">${e.isExhausted?"":$`<div class="card-type">${p+(null==(s=e.types)?void 0:s.join(" - "))}</div>`}<div class="card-rules">${null==(r=e.abilityRule)?void 0:r.join("\n")}</div></div></div><div class="card-face back"><img class="back-pattern" src="${je}"></div></div></div></div>`}function qe(e){return $`<div class="dialog"><div class="game-rules-wrapper"><div class="flex-col"><div>Quick Rules</div><div><div>Win: End your turn with Goal card's goal met.</div><div>Lose: End your turn with 15+ cards in your Play Area.</div><div>(Win checked before Loss)</div></div><div>Setup: Shuffle deck. Each player takes 1 secret Goal Card.</div><div>Turn:<ol><li>Deal 1 card to each Pile.</li><li>Choose 1 Pile. Order its cards.</li><li>Resolve all cards → bottom of deck (unless stated).</li><li>Check Goals (Win → Lose).</li></ol></div><div>Terms:<ul><li>Play Area - hidden set of drawn cards.</li><li>Exhausted - counts for Loss, not Goal</li><li>Flood - Opponent draws 1 into Play Area.</li><li>Return - Send back exhausted first, then oldest</li></ul></div><div>m Key: Turn on music</div><div><button class="jagged" onclick="methods.cancelPlayModal()">Start the Game</button></div><div><button class="jagged" onclick="methods.skipIntro()">Start & Skip Intro</button></div></div></div></div>`}function Be(e){return $`<div class="dialog"><div><div>Select this pile of cards by clicking the take button. Cards resolve in numerical order.</div><div>Played cards go to the bottom of the deck after resolving.</div></div><div class="flex-column"><div class="flex-cards">${N(e.cards,"takeModal",((t,a)=>{var i;return $`<div><div class="deck-card-wrapper">${D(t,!0,!1,!1)}</div>${(null==(i=m(e.cards,"takeModal"))?void 0:i.length)>1?$`<div class="number-buttons-wrapper"><button class="jagged" onclick="methods.orderCards(${t.id}, false)">⬅</button><div class="number">${a+1}</div><button class="jagged" onclick="methods.orderCards(${t.id}, true)">⮕</button></div>`:""}</div>`}))}</div></div><div class="flex-row dialog-ui"><button class="jagged" onclick="methods.cancelTakeModal()">Close</button><button class="jagged" onclick="methods.submitTakeModal()">Play & Pass</button></div></div>`}function Ne(e){const t=$e[e.currentPhase],a=(e.currentPhase?["play","end"]:["take","end"]).includes(t)?"player"===e.activePlayer?"opponent":"player":e.activePlayer;return $`<div class="${e.isStarted?"hidden":""}" id="story-wrapper">${me(he,((t,a)=>a>e.storyIndex?null:a===e.storyIndex?$`<div class="last-line">${t}</div>`:$`<div>${t}</div>`))}</div><div class="${e.isStarted?"":"ui-wrapper"}"><div><div class="phases-wrapper ${"player"!==a?"void-phase jagged":""}">${"player"===a?"YOUR TURN: ":"VOID'S TURN: "}${me(e.phases,((t,a)=>$`<div class="phase-wrapper ${e.currentPhase===a?"active":""}">${t.toUpperCase()}</div>`))}</div><div class="game-area-wrapper"><div class="deck-dealt-wrapper"><div class="deck-wrapper">${N(e.cards,"deck",((e,t)=>$`<div class="deck-card-wrapper" style="${"bottom:"+Math.floor(t/3)+"px;right:"+Math.floor(t/6)+"px"}">${D(e,!1,!1,!1)}</div>`))}</div><div class="pile-wrapper pile-1-wrapper">${N(e.cards,"pile1",((e,t)=>$`<div onclick="methods.viewPile('pile1')" class="pile" style="${"bottom:"+2*t+"px;right:"+2*t+"px"}">${D(e,!1,!1,!0)}</div>`))}</div><div class="pile-wrapper pile-2-wrapper">${N(e.cards,"pile2",((e,t)=>$`<div onclick="methods.viewPile('pile2')" class="pile" style="${"bottom:"+2*t+"px;right:"+2*t+"px"}">${D(e,!1,!1,!0)}</div>`))}</div><div class="pile-wrapper pile-3-wrapper">${N(e.cards,"pile3",((e,t)=>$`<div onclick="methods.viewPile('pile3')" class="pile" style="${"bottom:"+2*t+"px;right:"+2*t+"px"}">${D(e,!1,!1,!0)}</div>`))}</div></div></div></div><div class="flex-row-top"><div class="play-area-wrapper area-wrappers play-area-min-height"><div class="play-area-header">⚪ YOUR PLAY AREA (${m(e.cards,"playerPlay").length})</div><div class="flex-cards">${N(e.cards,"playerGoal",((e,t)=>$`<div>${D(e,!0,!0)}</div>`))}${N(e.cards,"playerPlay",((e,t)=>$`<div>${D(e,!1,!1,!1)}</div>`))}</div></div><div class="play-area-wrapper area-wrappers play-area-min-height"><div class="play-area-header">⚫ THE VOIDS'S PLAY AREA (${m(e.cards,"opponentPlay").length})</div><div class="flex-cards">${N(e.cards,"opponentGoal",((t,a)=>$`<div>${D(t,!0,!!e.winner)}</div>`))}${N(e.cards,"opponentPlay",((t,a)=>$`<div class="pile">${D(t,!1,!!e.winner,!1)}</div>`))}</div></div></div></div><div class="dialog-wrapper ${e.isModalOpen||0===e.storyIndex?"":"hidden"}">${0===e.storyIndex?qe():null}${1===e.currentPhase&&!0===e.isStarted?Be(e):null}</div><div class="active-card-wrapper flex-row">${N(e.cards,"active",((e,t)=>$`<div class="pile">${D(e,!1,!1,!1)}</div>`))}</div>`}const De=G("😶",{size:500,cell:20}),we=e=>$`<div class="eye-wrapper" ${e?"style='transform: scaleX(-1)'":""}><img class="eye-background" src="${De}"><svg class="eye-layer" viewBox="0 0 622 500" preserveAspectRatio="xMaxYMin"><g class="layer"><path class="upper-brow" d="m-6,0l649,0l0,890c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z" fill="#000000" id="svg_16" stroke="#000000" stroke-width="0"/><path d="m-3,-1c0.68,161 1.35,322 2.03,483l642.97,0c-94.8,-70.22 -336.89,9.59 -431.69,-60.63c-120.2,-90.78 -93.11,-331.59 -213.31,-422.37z" fill="#000000" id="svg_17" stroke="#000000" stroke-width="0"/><path class="iris" d="m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z" fill="#000000" stroke="#000000" stroke-width="0"/></g></svg></div>`,Ye=()=>$`<div class="eyes-wrapper">${we(!1)}${we(!0)}</div>`,Ce=(e,t)=>{if("number"!=typeof t||t<=0){const a=e.get(),i="player"===a.activePlayer?"player":"opponent";let n=0;for(let e=0;e<a[i].play.length;e++)a[i].play[e].types.includes(t)&&!1===a[i].play[e].isExhausted&&n++;return n}return t},Ee=async(e,t)=>{for(let a=0;a<e&&!1!==await t(a);a++);};async function de(e,t,a){const i=Ce(e,a);await Ee(i,(async()=>{const a=e.get(),i=m(a.cards,"deck"),n=i[i.length-1];if(!n)return!1;n.zone=`${t}Play`,e.set(a),await L(1e3)}))}async function Ue(e,t,a){const i=Ce(e,a);await Ee(i,(async()=>{const a=e.get(),i=`${t}Play`,n=m(a.cards,i);if(!n.length)return!1;const s=n.find((e=>e.isExhausted))??n[n.length-1];if(!s||"playerGoal"===s.zone||"opponentGoal"===s.zone)return!1;const r=m(a.cards,"deck");s.zone="deck",s.zoneOrder=r[r.length-1].zoneOrder+1,s.isExhausted=!1,e.set(a),await L(1e3)}))}const be={floodOpponent$Time:async(e,t,a)=>{await de(e,"player"===t?"opponent":"player",a)},floodAllPlayers$Time:async(e,t,a)=>{await de(e,"player",a),await de(e,"opponent",a)},return$Time:async(e,t,a)=>{await Ue(e,t,a)},returnAllExhaustedCards:async(e,t,a)=>{await L(1e3);const i=e.get();let n="player"===i.activePlayer?m(i.cards,"playerPlay"):m(i.cards,"opponentPlay");const s=m(i.cards,"deck");for(let e=0;e<n.length;e++){const t=n[e];t.isExhausted&&(t.zone=s,t.zoneOrder=s[s.length-1].zoneOrder+1)}e.set(i)},unexhaustAllYourExhaustedCards:async(e,t,a)=>{await L(1e3);const i=e.get();let n="player"===i.activePlayer?m(i.cards,"playerPlay"):m(i.cards,"opponentPlay");for(let e=0;e<n.length;e++){const t=n[e];t.isExhausted&&(t.isExhausted=!1)}e.set(i)},remianingCardsInPileGoToYourPlayArea:async(e,t,a)=>{await L(1e3);const i=e.get();i.isPileToPlay="next",e.set(i)},exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:async(e,t,a)=>{await L(1e3);const i=e.get();let n="opponent"===i.activePlayer?m(i.cards,"playerPlay"):m(i.cards,"opponentPlay");const s=n.map((e=>e.id)),r=pe(s);let o=0;for(let e=0;e<r.length;e++){const t=n.find((t=>t.id===r[e]));if(!t.isExhausted&&("playerGoal"!==t.zone||"opponentGoal"!==t.zone)&&(t.isExhausted=!0,o++),o>=a)break}e.set(i)}},Ve=(e,t,a)=>{const i="object"==typeof t&&t?t:{wave:"string"==typeof t?t:"sine",musicLength:void 0},n=i.wave||"sine",s=i.musicLength??.1,r=i.transposeOctaves??-2,o=i.transposeSemitones??0,l=i.baseHz??440,c=i.baseCharCode??105,d=i.filterCutoff??450,p=i.filterQ??10,u=i.subLevel??.35,y=i.subOctaves??1,h=i.gain??.45,m=i.attack??.01,v=i.decay??.12,f=i.sustain??.2,g=i.release??.3,w=i.vibratoRate??5,P=i.vibratoDepth??12,$=i.delayTime??.23,b=i.delayFeedback??.33,k=i.delayWet??.25,x={5:.4,4:.3,3:.2,2:.1,1:.05},A=[...Object.keys(x),"-"];window.AudioContext=window.AudioContext||window.webkitAudioContext;const E=new AudioContext,z=E.createGain();z.gain.value=.9,z.connect(E.destination);const O=E.createDelay(1.5);O.delayTime.value=$;const T=E.createGain();T.gain.value=b;const C=E.createGain();C.gain.value=k,O.connect(T),T.connect(O),O.connect(C),C.connect(z);for(let t=0;t<e.length;t++){const a=e[t],i=e[t+1],$=isNaN(i)?s:x[i];if(!a||A.includes(a))continue;const b=E.currentTime+t*$+.3,k=b+$,T=e.charCodeAt(t)-c+12*r+o,C=l*Math.pow(2,T/12),M=E.createOscillator();M.type=n,M.frequency.setValueAtTime(C,b);const S=E.createOscillator();S.type="square"===n?"sine":n;const L=C/Math.pow(2,y);S.frequency.setValueAtTime(L,b);const G=E.createGain();G.gain.value=u;const R=E.createBiquadFilter();R.type="lowpass",R.frequency.setValueAtTime(d,b),R.Q.setValueAtTime(p,b);const I=E.createGain();if(I.gain.setValueAtTime(1e-4,b),I.gain.linearRampToValueAtTime(h,b+m),I.gain.linearRampToValueAtTime(h*f,b+m+v),I.gain.setTargetAtTime(1e-4,Math.max(b,k-g),.15),P>0){const e=E.createOscillator(),t=E.createGain();e.frequency.setValueAtTime(w,b);const a=e=>e*(Math.pow(2,P/1200)-1);t.gain.value=a(C),e.connect(t),t.connect(M.frequency),e.start(b),e.stop(k+.1)}M.connect(R),S.connect(G),G.connect(R),R.connect(I),I.connect(z),I.connect(O),M.start(b),S.start(b),M.stop(k+.05),S.stop(k+.05)}},We=()=>{const e=["m5","k5","h5","o5","g5","k3","h3","m3","k2","h2","m4"],t=["-m5-k5-h5-m5-","-m5-k5-h5-k5-","-o5-m5-k5-h5-","-h5-g5-k5-h5--","-k3-h3-m5--k3-h3-m5--","-m5-m5-k5-h5-m5--","-a5-h5-g5-d5-c5-a5-a5-","-a5-h5-g5-d5-c5-k25-k25-","-o5-j5-k5-g5-h5-h5-c5-","-m5-g5-j5-c5-h3"];let a="";for(let i=0;i<200;i++){const i=Math.random()>.7?"---":"--";a+=(Math.random()>.9?fe(e):fe(t))+i}Ve(a,{wave:"sawtooth",musicLength:.4,transposeOctaves:-3,filterCutoff:320,filterQ:14,subLevel:.45,subOctaves:2,attack:.03,decay:.2,sustain:.35,release:.6,vibratoRate:4,vibratoDepth:14,delayTime:.38,delayFeedback:.38,delayWet:.22,gain:.2})},Pe=Ge();let ke=!1,K=0,ue=!1;const Ze=(e,t)=>t.length>1?e[t[0]][t[1]]:e[t[0]],He=document.querySelector("#app"),Qe=document.querySelector("#eyes"),_e=async e=>{Pe.startFlip(e),Ae(He,(()=>Ne(e))),Pe.endFlip(500,e)};async function Ke(){const e=()=>{K++},t=()=>{K=Math.max(0,K-1),0===K&&ue&&(ue=!1,d())},a=async()=>{K>0?ue=!0:await d()};if(ke)return;ke=!0;const i=await new Promise((e=>{e({isIntroSkipped:!1,isUiHidden:!0,storyIndex:0,isStarted:!1,isPhaseButtonDisabled:!0,isPileToPlay:"deck",winner:void 0,activePlayer:"player",currentPhase:void 0,phases:$e,isModalOpen:!1,ui:{},cards:[...Fe],selectedPile:"pile1",pile1:[],pile2:[],pile3:[],player:{id:1,hand:[],play:[],isComputer:!1},opponent:{id:2,hand:[],play:[],isComputer:!0}})})),n=Me(i,_e);Je(),Ae(Qe,(()=>$`<div class="eyes-wrapper">${we(!1)}${we(!0)}</div>`));const s=e=>(()=>{const e=n.get();return e.phases[e.currentPhase??0]})()===e,r=e=>{const t=n.get(),a=m(t.cards,"deck")[0].zoneOrder,i=t.cards.find((t=>t.id===e));if("play"===t.isPileToPlay){const e="player"===t.activePlayer?"playerPlay":"opponentPlay";i.zone=e}else i.zone="deck",i.zoneOrder=a+1;"next"===t.isPileToPlay&&(t.isPileToPlay="play"),n.set(t)},o=async()=>{for(let e=1;e<=3;e++){const t=n.get(),a=m(t.cards,"deck"),i=a[a.length-1];if(!i)break;i.zone=`pile${e}`,n.set(t)}},l=async(a,i,s)=>{if(!a||!Array.isArray(a.abilityFunct))return;e();for(let e=0;e<a.abilityFunct.length;e++){const t=a.abilityFunct[e],[s,r]=String(t).split(":");let o=r?parseInt(r,10):0;Number.isNaN(o)&&(o=r),be[s]&&await be[s](n,i,o)}const r=n.get();let o;o=s.length>1?r[s[0]][s[1]]:r[s[0]];const l=o.find((e=>e.id===a.id));if(l){const e=m(r.cards,"deck");l.zone="deck",l.zoneOrder=e[e.length-1].zoneOrder+1,n.set(r)}t()},c=()=>{const e=n.get(),t=void 0===e.currentPhase||e.currentPhase+1>=e.phases.length?0:e.currentPhase+1;return e.currentPhase=t,n.set(e),e.phases[t]};async function d(){const i=n.get();if(i.winner)return void alert(i.winner);const s=c();"player"===i.activePlayer?await async function(e){p(!0),"deal"===e&&(ce(!0),await await o(),await L(500),await a()),"take"!==e&&"end"===e&&(h(),await a())}(s):await async function(i){p(!0),"deal"===i&&(ye(!0),await o(),await L(500),await a()),"take"===i&&(await async function(){e(),ce();const i=n.get(),s=m(i.cards,"opponentPlay"),r=m(i.cards,"pile1"),o=h(r),l=m(i.cards,"pile2"),c=h(l),d=m(i.cards,"pile3"),p=h(d);if(i.selectedPile=fe(["pile1","pile2","pile3"]),s.length>=13)y("echo")&&(i.selectedPile=y("echo"));else if(s.length<=7)y("rift")&&(i.selectedPile=y("rift"));else if(y("omen")){const e=y("omen");i.selectedPile=e,m(i.cards,e).forEach((e=>{"remianingCardsInPileGoToYourPlayArea"===e.abilityFunct[0]&&(e.zoneOrder=100)}))}function y(e){return o[e]>c[e]&&o[e]>p[e]?"pile1":c[e]>o[e]&&c[e]>p[e]?"pile2":p[e]>o[e]&&p[e]>c[e]?"pile3":void 0}function h(e){const t={rift:0,echo:0,omen:0};return e.forEach((e=>{e.types.includes("rift")&&(t.rift=t.rift+1),e.types.includes("echo")&&(t.echo=t.echo+1),e.types.includes("omen")&&(t.omen=t.omen+1)})),t}n.set(i),await L(200),await u(),t(),await a()}(),await L(3e3),p(!1)),"end"===i&&(ye(!1),h(),await a())}(s)}const p=e=>{const t=n.get();t.isPhaseButtonDisabled=e,n.set(t)};async function u(){for(;;){const e=n.get(),t=m(e.cards,e.selectedPile).reverse();if(!Array.isArray(t)||0===t.length)break;const a=t[t.length-1];if(!a)break;a.isFaceUp=!0,a.zone="active",n.set(e),await L(2e3),await l({...a},e.activePlayer,[e.selectedPile]),r(a.id),await L(1e3)}const e=n.get();e.isPileToPlay="deck",e.player.play=e.player.play.sort((e=>e.isExhausted)),e.opponent.play=e.opponent.play.sort((e=>e.isExhausted)),n.set(e)}function y(){var e;const t=n.get();t.storyIndex>=he.length-1?(t.isModalOpen=!1,t.isStarted=!0,n.set(t),window.methods.advancePhase()):(t.storyIndex=t.storyIndex+1,n.set(t),setTimeout(y,3e3),null==(e=document.querySelector(".last-line"))||e.classList.add("visible"))}function h(){const e=n.get(),t=m(e.cards,"playerPlay"),a=m(e.cards,"opponentPlay"),i=m(e.cards,"playerGoal"),s=m(e.cards,"opponentGoal"),r=i[0].types[0],o=s[0].types[0],l=t.filter((e=>!1===e.isExhausted&&e.types.includes(r))),c=a.filter((e=>!1===e.isExhausted&&e.types.includes(o)));"opponent"===e.activePlayer&&c.length>7?e.winner="You lost because your opponent completed their goal card!":"player"===e.activePlayer&&l.length>7?e.winner="You won for completeing your goal card!":"player"===e.activePlayer&&t.length>=15?e.winner="You lost because you had 15 or more cards in your play area!":"opponent"===e.activePlayer&&a.length>=15&&(e.winner="You won because your opponent had 15 or more cards in their play area!"),e.activePlayer="player"===e.activePlayer?"opponent":"player",n.set(e)}window.methods={advancePhase:d,submitTakeModal:async()=>{const i=n.get();i.isModalOpen=!1,m(i.cards,"takeModal").forEach((e=>e.zone=i.selectedPile)),n.set(i),e(),await L(500),await u(),await L(500),t(),await a()},cancelTakeModal:()=>{if(!s("take"))return;const e=n.get();if("opponent"===e.activePlayer)return;const t=m(e.cards,"takeModal");e.isModalOpen=!1,t.forEach((t=>{t.zone=e.selectedPile})),n.set(e)},cancelPlayModal:()=>{ce(!1,750);const e=n.get();e.isModalOpen=!1,n.set(e),y()},setSelected:(e,t)=>{const a=n.get(),i=Ze(a,e),s=null==i?void 0:i.find((e=>e.id===t));s&&(s.isSelected=!s.isSelected,n.set(a))},viewPile:e=>{if(!s("take"))return;const t=n.get();if("opponent"===t.activePlayer)return;const a=m(t.cards,e);t.selectedPile=e,t.isModalOpen=!0,a.forEach((e=>{e.zone="takeModal"})),n.set(t)},orderCards:(e,t)=>{const a=n.get(),i=m(a.cards,"takeModal");i.forEach(((a,i)=>{a.id===e?a.zoneOrder=t?i+1.5:i-1.5:a.zoneOrder=i})),i.sort(((e,t)=>e.zoneOrder-t.zoneOrder)).reverse().forEach(((e,t)=>{e.zoneOrder=t+1})),n.set(a)},skipIntro:()=>{const e=n.get();e.isModalOpen=!1,e.isStarted=!0,e.storyIndex=he.length,n.set(e),window.methods.advancePhase()}}}function Je(){document.addEventListener("keydown",(e=>{"m"===e.key.toLowerCase()&&We()}))}setTimeout((()=>{Ke()}),200)</script>