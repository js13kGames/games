<!doctype html><meta content="width=device-width" name=viewport><title>Project Panther - js13kGames 2025</title><style>body{margin:0;padding:0;background:#000;overflow:hidden;font-family:monospace;color:#fff}#gameCanvas{display:block;margin:0 auto;background:#000}#gameOver{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:24px;display:none;z-index:200}</style><canvas height=600 id=gameCanvas width=800></canvas><div id=gameOver><h2>Game Over</h2><p>Final Score:<span id=finalScore>0</span><p>Press SPACE to restart</div><script>function t(t,e,i){return t+(e-t)*i}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class e{constructor(t){this.game=t}enter(){}exit(){}update(t){}render(t){}handleInput(t){}}const i=new class{constructor(){this.context=new(window.AudioContext||window.webkitAudioContext)}zzfx(...t){let e=Math,i=44100,s=2*e.PI,h=t[2]*(1+t[1]*(2*e.random()-1)),a=t[3]*i,l=t[4]*i,o=t[5]*i,r=t[6],n=[],m=0;for(let c=0;c<a+l+o;c++){let o=c<a?c/a:c<a+l?1-(c-a)/l:0;m+=h*e.cos(r*c/i),n[c]=o*e.sin(m/i*s),h+=t[7]}const c=this.context.createBuffer(1,n.length,i);c.getChannelData(0).set(n);const g=this.context.createBufferSource();g.buffer=c,g.connect(this.context.destination),g.start()}playSound(t){const e=[t.v||.5,0,2e3*(t.f||.5),t.a||.01,t.s||.1,t.d||.2,0,t.r||0];this.zzfx(...e)}},s={a:0,s:.15,d:.3,f:.82,r:-.29,v:.25},h={a:.1,s:.2,d:.4,f:.3,r:-.15,v:.3},a={a:0,s:.1,d:.2,f:.2,r:-.5,v:.4},l={a:0,s:.05,d:.1,f:.8,r:.2,v:.3},o={a:0,s:.1,d:.3,f:.4,r:-.3,v:.35};class r{static f48="48px monospace";static f24="24px monospace";static f16="16px monospace";static f20="20px monospace";static drawStars(t,e){e.stars&&e.stars.forEach(e=>e.render(t))}}class n{constructor(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.states={},this.currentState=null,this.previousStateName=null,this.gameData={score:0,lives:3,level:1,highScore:0,metal:0,shopVisited:!1,turboMultiplier:1},this.player=null,this.bullets=[],this.enemies=[],this.stars=[],this.particles=[],this.metal=[],this.proximityBombs=[],this.keys={},this.keys.StartPressed=!1,this.lastTime=0,this.enemySpawnTimer=0,this.starSpawnTimer=0,this.controllers=[],this.controllerConnected=!1,this.screenShake={intensity:0,duration:0,maxIntensity:100,decayRate:.9},this.init()}init(){this.setupStates(),this.bindEvents(),this.checkExistingControllers(),this.changeState("menu"),this.gameLoop()}checkExistingControllers(){const t=navigator.getGamepads()[0];if(t){this.controllers[0]=t,this.controllerConnected=!0,this.initialButtonStates={};for(let e=0;e<t.buttons.length;e++)this.initialButtonStates[e]=t.buttons[e]?.pressed||!1}}setupStates(){this.states={menu:new m(this),gameplay:new c(this),pause:new g(this),gameOver:new d(this),win:new f(this),highscore:new p(this),shop:new y(this)}}changeState(t){if(this.currentState){this.currentState.exit();for(let[t,e]of Object.entries(this.states))if(e===this.currentState){this.previousStateName=t;break}}this.currentState=this.states[t],this.currentState&&this.currentState.enter()}goBack(){this.currentState===this.states.shop||this.currentState===this.states.pause?this.changeState("gameplay"):(this.currentState===this.states.gameOver||this.currentState===this.states.win)&&this.changeState("menu")}bindEvents(){document.addEventListener("keydown",t=>{this.keys[t.code]=!0,"Escape"===t.code&&(this.currentState===this.states.gameplay?this.changeState("pause"):this.currentState===this.states.pause&&this.changeState("gameplay"))}),document.addEventListener("keyup",t=>{this.keys[t.code]=!1}),window.addEventListener("gamepadconnected",t=>{this.controllers[t.gamepad.index]=t.gamepad,this.controllerConnected=!0,this.initialButtonStates={};for(let e=0;e<t.gamepad.buttons.length;e++)this.initialButtonStates[e]=t.gamepad.buttons[e]?.pressed||!1}),window.addEventListener("gamepaddisconnected",t=>{delete this.controllers[t.gamepad.index],this.controllerConnected=Object.keys(this.controllers).length>0})}update(t){this.updateControllerInput(),this.currentState&&(this.currentState.update(t),this.currentState.handleInput(this.keys)),this.updateScreenShake(t)}updateControllerInput(){const t=navigator.getGamepads();let e=t[0];for(let i=0;i<t.length&&(e=t[i],!e);i++);if(!e)return;this.controllers[0]=e,this.keys.ControllerSpace=!1,this.keys.ControllerQ=!1,this.keys.ControllerShift=!1,this.keys.ControllerC=!1,this.keys.ArrowUp=!1,this.keys.ArrowDown=!1,this.keys.ArrowLeft=!1,this.keys.ArrowRight=!1,this.keys.Space=!1,this.keys.Escape=!1,e.buttons[0]&&e.buttons[0].pressed&&(this.keys.ControllerSpace=!0,this.keys.Space=!0),e.buttons[1]&&e.buttons[1].pressed&&(this.keys.ControllerQ=!0),e.buttons[2]&&e.buttons[2].pressed&&(this.keys.ControllerShift=!0),e.buttons[3]&&e.buttons[3].pressed&&(this.keys.ControllerC=!0),e.buttons[9]&&e.buttons[9].pressed?this.keys.StartPressed||(this.keys.StartPressed=!0,this.currentState===this.states.gameplay?this.changeState("pause"):this.currentState===this.states.pause&&this.changeState("gameplay")):this.keys.StartPressed&&(this.keys.StartPressed=!1);const i=e.axes[0],s=e.axes[1];Math.abs(i)>.1&&(i>0?this.keys.ArrowRight=!0:this.keys.ArrowLeft=!0),Math.abs(s)>.1&&(s>0?this.keys.ArrowDown=!0:this.keys.ArrowUp=!0),e.buttons[12]&&e.buttons[12].pressed&&(this.keys.ArrowUp=!0),e.buttons[13]&&e.buttons[13].pressed&&(this.keys.ArrowDown=!0),e.buttons[14]&&e.buttons[14].pressed&&(this.keys.ArrowLeft=!0),e.buttons[15]&&e.buttons[15].pressed&&(this.keys.ArrowRight=!0)}triggerScreenShake(t=100,e=400){this.screenShake.intensity=Math.min(t,this.screenShake.maxIntensity),this.screenShake.duration=e}updateScreenShake(t){this.screenShake.duration>0&&(this.screenShake.duration-=t,this.screenShake.intensity*=this.screenShake.decayRate,(this.screenShake.intensity<.5||this.screenShake.duration<=0)&&(this.screenShake.intensity=0,this.screenShake.duration=0))}getScreenShakeOffset(){return this.screenShake.intensity<=0?{x:0,y:0}:{x:4*(Math.random()-.5)*this.screenShake.intensity,y:4*(Math.random()-.5)*this.screenShake.intensity}}render(){const t=this.getScreenShakeOffset();this.ctx.save(),this.ctx.translate(t.x,t.y),this.currentState&&this.currentState.render(this.ctx),this.ctx.restore()}gameLoop(t=0){const e=t-this.lastTime;this.lastTime=t,this.update(e),this.render(),requestAnimationFrame(t=>this.gameLoop(t))}drawMilkyWay(t){const e=.001*Date.now(),i=.5*this.height,s=.3*this.height;t.save();const h=20*e%this.width,a=t.createLinearGradient(0,i-s/2,0,i+s/2);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(.2,"rgba(80, 40, 20, 0.3)"),a.addColorStop(.4,"rgba(120, 60, 30, 0.5)"),a.addColorStop(.6,"rgba(160, 80, 40, 0.6)"),a.addColorStop(.8,"rgba(120, 60, 30, 0.5)"),a.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=a,t.fillRect(h,i-s/2,this.width,s),t.fillRect(h-this.width,i-s/2,this.width,s),this.addAnimatedNoise(t,h,i,s,"rgba(160, 80, 40, 0.2)",.4);const l=t.createLinearGradient(0,i-s/2,0,i+s/2);l.addColorStop(0,"rgba(0, 0, 0, 0)"),l.addColorStop(.1,"rgba(40, 60, 100, 0.15)"),l.addColorStop(.3,"rgba(60, 90, 140, 0.3)"),l.addColorStop(.5,"rgba(80, 120, 180, 0.4)"),l.addColorStop(.7,"rgba(60, 90, 140, 0.3)"),l.addColorStop(.9,"rgba(40, 60, 100, 0.15)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=l,t.fillRect(h,i-s/2,this.width,s),t.fillRect(h-this.width,i-s/2,this.width,s),this.addAnimatedNoise(t,h,i,s,"rgba(60, 90, 140, 0.1)",.3),this.addAnimatedDustLanes(t,h,i,s),t.restore()}addAnimatedNoise(t,e,i,s,h,a){for(let a=0;a<2*this.width;a+=8)for(let l=i-s/2;l<i+s/2;l+=8){const i=.05*(a+e),s=.03*l;.5*this.simpleNoise(i+s+42)+.5<.3&&(t.fillStyle=h,t.fillRect(a+e,l,8,8),t.fillRect(a+e-this.width,l,8,8))}}addAnimatedDustLanes(t,e,i,s){const h=.3*e;t.fillStyle="rgba(0, 0, 0, 0.3)";for(let e=0;e<150;e++){const a=(h+this.simpleNoise(50*e)*this.width*2)%(2*this.width),l=i+(.5*this.simpleNoise(100*e)-.25)*s*.4,o=.5*this.simpleNoise(150*e)+.5;if(l>=i-s/2&&l<=i+s/2){const e=Math.max(2,8*o);t.fillRect(a,l,e,e),a<this.width?t.fillRect(a+this.width,l,e,e):t.fillRect(a-this.width,l,e,e)}}}simpleNoise(t){return Math.sin(12.9898*t)*Math.cos(78.233*t)*43758.5453%1}}class m extends e{constructor(t){super(t),this.selectedOption=0,this.options=["Play Game","High Score"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0}enter(){this.selectedOption=0,this.keyCooldown=0,this.enterCooldown=300}update(t){this.keyCooldown>0&&(this.keyCooldown-=t),this.enterCooldown>0&&(this.enterCooldown-=t)}handleInput(t){t.ArrowUp&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption-1+this.options.length)%this.options.length,this.keyCooldown=this.cooldownTime),t.ArrowDown&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption+1)%this.options.length,this.keyCooldown=this.cooldownTime),(t.Enter||t.Space)&&this.enterCooldown<=0&&this.selectOption(),(t.Enter||t.Space||t.ControllerSpace)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){switch(this.selectedOption){case 0:this.game.changeState("gameplay");break;case 1:this.game.changeState("highscore")}}render(t){t.fillStyle="#002",t.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(t),r.drawStars(t,this.game),t.fillStyle="#fff",t.font=r.f48,t.textAlign="center",t.fillText("Project Panther",this.game.width/2,150),t.font=r.f24,t.fillText("js13k 2025 Entry",this.game.width/2,200),t.font=r.f20;for(let e=0;e<this.options.length;e++)e===this.selectedOption?(t.fillStyle="#0ff",t.fillText("> "+this.options[e],this.game.width/2,300+40*e)):(t.fillStyle="#fff",t.fillText(this.options[e],this.game.width/2,300+40*e));t.fillStyle="#888",t.font=r.f16,t.fillText("Use WASD or Arrow Keys to navigate, Enter to select",this.game.width/2,500),this.game.controllerConnected&&t.fillText("Controller: A=Select, B=Back, Start=Pause",this.game.width/2,520)}}class c extends e{constructor(t){super(t),this.gameOver=!1,this.levelComplete=!1,this.levelObjectives={},this.currentLevelData=null,this.devCooldowns={metal:0,turbo:0,levelNav:0}}enter(){this.game.player||this.initGameplay(),"pause"!==this.game.previousStateName&&"shop"!==this.game.previousStateName&&(this.gameOver=!1,this.levelComplete=!1,this.game.gameData.lives=3,this.game.gameData.score=0,this.game.gameData.level=1,this.game.bullets=[],this.game.enemies=[],this.game.particles=[],this.game.metal=[],this.game.enemySpawnTimer=0,this.game.starSpawnTimer=0,this.game.player&&(this.game.player.shieldLevel=this.game.player.maxShieldLevel,this.game.player.shieldRechargeTimer=0,this.game.player.turboLevel=0,this.game.player.turboCharge=0,this.game.player.turboActive=!1,this.game.player.cloakLevel=0,this.game.player.cloakTimer=0,this.game.player.isCloaked=!1,this.game.player.isHit=!1,this.game.player.hitTimer=0,this.game.player.blinkTimer=0,this.game.player.isVisible=!0),this.setupLevel(this.game.gameData.level))}setupLevel(t){this.currentLevelData=this.getLevelData(t),this.levelObjectives={...this.currentLevelData.objectives},this.spawnCounts={asteroids:0,mice:0,shops:0,snakes:0,birds:0,ratboss:0},this.enemyPool=null}getLevelData(t){const e={1:{description:"Survive 50 asteroids",objectives:{asteroids:50},spawnRules:{asteroids:!0,mice:!1,shops:!1},maxEnemies:8},2:{description:"Survive 50 asteroids and 15 mice",objectives:{asteroids:50,mice:15},spawnRules:{asteroids:!0,mice:!0,shops:!1},maxEnemies:10},3:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},4:{description:"Survive 60 asteroids and 20 mice",objectives:{asteroids:60,mice:20},spawnRules:{asteroids:!0,mice:!0,shops:!1},maxEnemies:12},5:{description:"Survive 70 asteroids, 25 mice, and 10 snakes",objectives:{asteroids:70,mice:25,snakes:10},spawnRules:{asteroids:!0,mice:!0,snakes:!0,shops:!1},maxEnemies:15},6:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},7:{description:"Survive 80 asteroids, 30 mice, and 10 snakes",objectives:{asteroids:80,mice:30,snakes:10},spawnRules:{asteroids:!0,mice:!0,snakes:!0,shops:!1},maxEnemies:18},8:{description:"Survive 90 asteroids, 35 mice, 15 snakes, and 5 birds",objectives:{asteroids:90,mice:35,snakes:15,birds:5},spawnRules:{asteroids:!0,mice:!0,snakes:!0,birds:!0,shops:!1},maxEnemies:20},9:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},10:{description:"First Boss Battle",objectives:{ratboss:1},spawnRules:{asteroids:!1,mice:!1,shops:!1,ratboss:!0},maxEnemies:10}};return e[t]||e[1]}initGameplay(){for(let t=0;t<50;t++){const t=new P(Math.random()*this.game.width,Math.random()*this.game.height,3*Math.random()+1);t.game=this.game,this.game.stars.push(t)}this.game.player=new w(100,this.game.height/2,this.game)}update(t){this.gameOver||this.levelComplete||(Object.keys(this.devCooldowns).forEach(e=>{this.devCooldowns[e]>0&&(this.devCooldowns[e]-=t)}),this.game.player.update(t,this.game.keys,this.game.height),this.game.bullets=this.game.bullets.filter(e=>(e.update(t),!(e.x>this.game.width+10||e instanceof A&&e.age>=e.lifetime))),this.game.enemies.forEach(e=>{e.update(t)}),this.game.enemies=this.game.enemies.filter(t=>!(t instanceof x&&"defeated"===t.phase&&t.defeatTimer<=0)&&t.x>-50),this.game.proximityBombs=this.game.proximityBombs.filter(e=>(e.update(t),!e.exploded)),this.game.stars.forEach(e=>e.update(t)),this.game.particles=this.game.particles.filter(e=>(e.update(t),e.life>0)),this.game.metal=this.game.metal.filter(e=>(e.update(t),!e.collected&&e.x>-100)),this.spawnEnemies(t),this.checkCollisions(),this.checkLevelCompletion())}spawnEnemies(t){this.currentLevelData&&(this.enemyPool||this.createEnemyPool(),this.enemyPool.length>0&&this.game.enemies.length<this.currentLevelData.maxEnemies&&(this.game.enemySpawnTimer+=t,this.game.enemySpawnTimer>800&&(this.spawnRandomEnemy(),this.game.enemySpawnTimer=0)))}createEnemyPool(){this.enemyPool=[];const t=this.currentLevelData.spawnRules,e=this.levelObjectives;if(t.asteroids&&e.asteroids)for(let t=0;t<e.asteroids;t++)this.enemyPool.push({type:"asteroid",priority:Math.random()});if(t.mice&&e.mice)for(let t=0;t<e.mice;t++)this.enemyPool.push({type:"mouse",priority:Math.random()});if(t.shops&&e.shops)for(let t=0;t<e.shops;t++)this.enemyPool.push({type:"shop",priority:Math.random()});if(t.snakes&&e.snakes)for(let t=0;t<e.snakes;t++)this.enemyPool.push({type:"snake",priority:Math.random()});if(t.birds&&e.birds)for(let t=0;t<e.birds;t++)this.enemyPool.push({type:"bird",priority:Math.random()});if(t.ratboss&&e.ratboss)for(let t=0;t<e.ratboss;t++)this.enemyPool.push({type:"ratboss",priority:Math.random()});this.enemyPool.sort((t,e)=>t.priority-e.priority)}spawnRandomEnemy(){if(0===this.enemyPool.length)return;const t=this.enemyPool.shift();this.spawnEnemy(t.type),this.game.enemySpawnTimer+=200*(Math.random()-.5)}spawnEnemy(t){const e=Math.random()*(this.game.height-40);let i;switch(t){case"asteroid":i=new S(this.game.width+50,e,this.game.gameData.level,0),this.spawnCounts.asteroids++;break;case"mouse":i=new S(this.game.width+50,e,this.game.gameData.level,1),this.spawnCounts.mice++;break;case"shop":i=new S(this.game.width+50,e,this.game.gameData.level,2),this.spawnCounts.shops++;break;case"snake":i=new S(this.game.width+50,e,this.game.gameData.level,3),this.spawnCounts.snakes++;break;case"bird":i=new S(this.game.width+50,e,this.game.gameData.level,4),this.spawnCounts.birds++;break;case"ratboss":i=new x(this.game.width+50,e,this.game),this.spawnCounts.ratboss++}if(i){if(i.game=this.game,"shop"===t){const t=this.game.height/4,e=1.5*t;i.width=e,i.height=t,i.speed=60,i.y=(this.game.height-i.height)/2}this.game.enemies.push(i)}}checkLevelCompletion(){if(!this.currentLevelData)return;let t=!0;for(const[e,i]of Object.entries(this.levelObjectives))if(this.spawnCounts[e]<i){t=!1;break}const e=this.game.enemies.some(t=>t.x>-50),i=this.game.metal.some(t=>t.x>-20);!t||e||i||(this.levelComplete=!0,this.completeLevel())}completeLevel(){this.game.gameData.score+=1e3,this.game.gameData.level>=10?setTimeout(()=>{this.game.changeState("win")},2e3):setTimeout(()=>{this.game.gameData.level++,this.setupLevel(this.game.gameData.level),this.levelComplete=!1,this.game.enemies=[],this.game.particles=[],this.game.metal=[],this.spawnCounts={asteroids:0,mice:0,shops:0,snakes:0,birds:0,ratboss:0},this.game.gameData.shopVisited=!1},2e3)}checkCollisions(){this.game.bullets.forEach((t,e)=>{this.game.enemies.forEach((s,h)=>{if(this.checkCollision(t,s)){if(2===s.enemyType)return;if(s instanceof x)return s.takeDamage(1),this.game.bullets.splice(e,1),void(this.game.gameData.score+=50);if(t instanceof A)return this.game.bullets.splice(e,1),this.game.enemies.splice(h,1),this.game.gameData.score+=100,i.playSound(o),this.createRocketExplosion(s.x+s.width/2,s.y+s.height/2),void this.createMetalDrop(s.x+s.width/2,s.y+s.height/2,s.enemyType);this.game.bullets.splice(e,1),this.game.enemies.splice(h,1),this.game.gameData.score+=100,i.playSound(o),this.createExplosion(s.x+s.width/2,s.y+s.height/2),this.createMetalDrop(s.x+s.width/2,s.y+s.height/2,s.enemyType)}})}),this.game.enemies.forEach((t,e)=>{if(this.checkCollision(this.game.player,t)){if(2===t.enemyType)return this.game.gameData.shopVisited?void this.game.enemies.splice(e,1):(this.game.enemies.splice(e,1),this.game.gameData.shopVisited=!0,void this.game.changeState("shop"));if(t instanceof x)return this.game.player.shieldLevel>0?(this.game.player.shieldLevel=0,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives=Math.max(0,this.game.gameData.lives-2),this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(15,500),void(this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver")));this.game.enemies.splice(e,1),this.createExplosion(t.x+t.width/2,t.y+t.height/2),this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(8,300),this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver"))}}),this.game.proximityBombs.forEach((t,e)=>{this.checkCollision(this.game.player,t)&&!t.exploded&&t.explode()}),this.game.enemies.forEach(t=>{4===t.enemyType&&this.game.player.isHitByBeam(t)&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.player.beamHitCooldown=this.game.player.beamHitCooldownTime,this.createBeamDamageEffect(),this.game.triggerScreenShake&&this.game.triggerScreenShake(12,300),this.game.gameData.lives<=0&&(this.game.gameOver=!0,this.game.changeState("gameOver")))}),this.game.enemies.forEach(t=>{t instanceof x&&"tail"===t.currentAttack&&t.tailAttackTimer<500&&this.checkTailAttackCollision(this.game.player,t)&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(10,400),this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver")))})}checkTailAttackCollision(t,e){const i=e.x+e.width,s=e.y+.5*e.height,h=i+150,a=s+100;return t.x<h&&t.x+t.width>i&&t.y<a&&t.y+t.height>s-50}checkCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}createExplosion(t,e){for(let i=0;i<12;i++)this.game.particles.push(new B(t,e,360*Math.random()))}createMetalDrop(t,e,i=0){const s=1===i?1:.7,h=1===i?3:1;if(Math.random()<s)for(let s=0;s<h;s++){const s=1===i?30*(Math.random()-.5):0,h=1===i?20*(Math.random()-.5):0,a=new O(t+s,e+h,this.game);this.game.metal.push(a)}}createBeamDamageEffect(){const t=this.game.player;for(let e=0;e<8;e++){const e=.5*Math.random()+2,i=4*Math.random()+2,s=t.x+t.width/2,h=t.y+t.height/2;this.game.particles.push(new v(s,h,e,i))}}createRocketExplosion(t,e){for(let i=0;i<25;i++){const i=360*Math.random(),s=6*Math.random()+4;this.game.particles.push(new C(t,e,i,s))}this.game.triggerScreenShake&&this.game.triggerScreenShake(8,200)}render(t){t.fillStyle="#002",t.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(t),this.game.stars.forEach(e=>e.render(t)),this.game.particles.forEach(e=>e.render(t)),this.game.proximityBombs.forEach(e=>e.render(t)),this.game.metal.forEach(e=>e.render(t)),this.game.enemies.forEach(e=>e.render(t)),this.game.bullets.forEach(e=>e.render(t)),this.game.proximityBombs.forEach(e=>e.render(t)),this.game.player&&this.game.player.render(t),this.renderUI(t)}renderUI(t){t.fillStyle="#fff",t.font=r.f20,t.textAlign="left",t.fillText(`Score: ${this.game.gameData.score}`,20,30),t.fillText(`Lives: ${this.game.gameData.lives}`,20,60),t.fillText(`Level: ${this.game.gameData.level}`,20,90),t.fillText(`Metal: ${this.game.gameData.metal}`,20,120),this.renderCloakingBar(t),this.renderShieldBar(t),this.renderTurboBar(t),this.game.player.secondaryWeaponLevel>0&&this.renderRocketCooldownBar(t)}renderRocketCooldownBar(t){const e=this.game.width-120-20,i=this.game.player.rocketCooldown/this.game.player.rocketCooldownTime;this.renderBar(t,{x:e,y:20,width:120,height:15,label:"ROCKET",value:1-i,maxValue:1,backgroundColor:"#333",foregroundColor:i>0?"#f60":"#0f0",borderColor:"#fff",textColor:"#fff",showSegments:!1,showBorder:!0,showLabel:!0})}renderBar(t,e){const{x:i,y:s,width:h,height:a,label:l,value:o,maxValue:n=1,backgroundColor:m="#333",foregroundColor:c="#0f0",borderColor:g="#fff",textColor:d="#fff",showSegments:f=!1,segmentCount:p=1,showBorder:y=!0,showLabel:u=!0}=e;if(t.fillStyle=m,t.fillRect(i,s,h,a),o>0)if(t.fillStyle=c,f){const e=h/p,l=Math.floor(o/n*p);for(let h=0;h<l;h++)t.fillRect(i+h*e,s,e,a);if(p>1){t.strokeStyle="#666",t.lineWidth=1;for(let h=1;h<p;h++){const l=i+h*e;t.beginPath(),t.moveTo(l,s),t.lineTo(l,s+a),t.stroke()}}}else{const e=o/n*h;t.fillRect(i,s,e,a)}y&&(t.strokeStyle=g,t.lineWidth=2,t.strokeRect(i,s,h,a)),u&&(t.fillStyle=d,t.font=r.f16,t.textAlign="center",t.fillText(l,i+h/2,s+15))}renderCloakingBar(t){if(5===this.game.gameData.level)return;const e=this.game.width/3,i=(this.game.width-e)/2;this.renderBar(t,{x:i,y:20,width:e,height:20,label:"CLOAK",value:this.game.player&&this.game.player.isCloaked?this.game.player.cloakLevel:0,maxValue:1,foregroundColor:"#0ff",showSegments:!1})}renderShieldBar(t){const e=this.game.width/3,i=(this.game.width-e)/2;this.renderBar(t,{x:i,y:50,width:e,height:20,label:"SHIELD",value:this.game.player.shieldLevel,maxValue:this.game.player.maxShieldLevel,foregroundColor:"#0f0",showSegments:!0,segmentCount:this.game.player.maxShieldLevel})}renderTurboBar(t){if(!this.game.player||0===this.game.player.turboLevel)return;const e=this.game.width/3,i=(this.game.width-e)/2;this.renderBar(t,{x:i,y:80,width:e,height:20,label:"TURBO",value:this.game.player.turboCharge,maxValue:this.game.player.maxTurboCharge,foregroundColor:this.game.player.turboActive?"#f60":"#0f0",showSegments:!1})}handleInput(t){}}class g extends e{constructor(t){super(t)}render(t){this.game.states.gameplay.render(t),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,this.game.width,this.game.height),t.fillStyle="#fff",t.font=r.f48,t.textAlign="center",t.fillText("PAUSED",this.game.width/2,this.game.height/2-50),t.font=r.f20,t.fillText("Press ESC to resume",this.game.width/2,this.game.height/2),t.fillText("Press M for menu",this.game.width/2,this.game.height/2+40)}handleInput(t){t.KeyM&&this.game.changeState("menu"),(t.KeyY||t.ControllerC)&&this.game.changeState("menu")}}class d extends e{constructor(t){super(t)}enter(){p.saveHighScore(this.game.gameData.score,this.game.gameData.level),this.game.gameData.score>this.game.gameData.highScore&&(this.game.gameData.highScore=this.game.gameData.score)}render(t){this.game.states.gameplay.render(t),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,this.game.width,this.game.height),t.fillStyle="#f00",t.font=r.f48,t.textAlign="center",t.fillText("GAME OVER",this.game.width/2,this.game.height/2-80),t.fillStyle="#fff",t.font=r.f24,t.fillText(`Final Score: ${this.game.gameData.score}`,this.game.width/2,this.game.height/2-20),t.fillText(`High Score: ${this.game.gameData.highScore}`,this.game.width/2,this.game.height/2+20),t.font=r.f20,t.fillText("Press SPACE to restart",this.game.width/2,this.game.height/2+80),t.fillText("Press M for menu",this.game.width/2,this.game.height/2+120)}handleInput(t){t.Space&&this.game.changeState("gameplay"),t.KeyM&&this.game.goBack(),(t.KeyA||t.ControllerSpace)&&this.game.changeState("gameplay"),(t.KeyY||t.ControllerC)&&this.game.goBack()}}class f extends e{constructor(t){super(t)}enter(){p.saveHighScore(this.game.gameData.score,this.game.gameData.level),this.game.gameData.score>this.game.gameData.highScore&&(this.game.gameData.highScore=this.game.gameData.score)}render(t){this.game.states.gameplay.render(t),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,this.game.width,this.game.height),t.fillStyle="#0f0",t.font=r.f48,t.textAlign="center",t.fillText("VICTORY!",this.game.width/2,this.game.height/2-120),t.fillStyle="#ff0",t.font=r.f24,t.fillText("You have defeated the Rat Boss!",this.game.width/2,this.game.height/2-60),t.fillText("Congratulations on completing the game!",this.game.width/2,this.game.height/2-20),t.fillStyle="#fff",t.font=r.f20,t.fillText(`Final Score: ${this.game.gameData.score}`,this.game.width/2,this.game.height/2+40),t.fillText(`Level Reached: ${this.game.gameData.level}`,this.game.width/2,this.game.height/2+80),t.fillText(`High Score: ${this.game.gameData.highScore}`,this.game.width/2,this.game.height/2+120),t.font=r.f20,t.fillText("Press SPACE to play again",this.game.width/2,this.game.height/2+180),t.fillText("Press M for main menu",this.game.width/2,this.game.height/2+220)}handleInput(t){t.KeyM&&this.game.changeState("menu"),(t.KeyA||t.ControllerSpace||t.Space)&&(this.game.gameData.level=1,this.game.gameData.lives=3,this.game.gameData.score=0,this.game.gameData.metal=0,this.game.gameData.shopVisited=!1,this.game.changeState("gameplay")),(t.KeyY||t.ControllerC)&&this.game.changeState("menu")}}class p extends e{constructor(t){super(t),this.selectedOption=0,this.options=["Main Menu"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0}enter(){this.enterCooldown=200}update(t){this.keyCooldown>0&&(this.keyCooldown-=t),this.enterCooldown>0&&(this.enterCooldown-=t)}handleInput(t){(t.Enter||t.Space||t.Escape||t.ControllerSpace||t.ControllerQ)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){0===this.selectedOption&&this.game.changeState("menu")}render(t){t.fillStyle="#002",t.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(t),this.game.stars.forEach(e=>e.render(t)),t.fillStyle="#fff",t.font=r.f24,t.textAlign="center",t.fillText("High Scores",this.game.width/2,150);const e=this.getHighScores();t.font=r.f20,t.fillStyle="#0ff";const i=Math.min(10,e.length);for(let s=0;s<i;s++){const i=e[s],h=220+30*s;t.fillText(`${s+1}. ${i.score.toLocaleString()} - Level ${i.level}`,this.game.width/2,h)}0===e.length&&(t.fillStyle="#888",t.font=r.f20,t.fillText("No high scores yet!",this.game.width/2,300),t.fillText("Play a game to set your first score.",this.game.width/2,330));const s=80+(i>0?220+30*(i-1):330),h=Math.min(s,this.game.height-80);t.fillStyle="#0ff",t.font=r.f20,t.fillText("> Press ENTER or ESCAPE to return",this.game.width/2,h),this.game.controllerConnected&&(t.fillStyle="#888",t.font=r.f16,t.fillText("Controller: A=Select, B=Back",this.game.width/2,h+30))}getHighScores(){try{const t=localStorage.getItem("PantherProject.highScores");return t?JSON.parse(t):[]}catch(t){return[]}}static saveHighScore(t,e){try{let i=[];const s=localStorage.getItem("PantherProject.highScores");return s&&(i=JSON.parse(s)),i.push({score:t,level:e,date:(new Date).toISOString()}),i.sort((t,e)=>e.score-t.score),i=i.slice(0,10),localStorage.setItem("PantherProject.highScores",JSON.stringify(i)),i}catch(t){return[]}}}class y extends e{constructor(t){super(t),this.selectedOption=0,this.options=["Shield Upgrade (50 Metal)","Agility Boost (30 Metal)","Turbo Thrust (100 Metal)","Double Bullet (80 Metal) - 2 parallel","Triple Bullet (120 Metal) - 2 diagonal","Rocket Launcher (150 Metal)","Return to Game"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0,this.selectionCooldown=0,this.selectionCooldownTime=500}enter(){this.keyCooldown=0,this.enterCooldown=300}update(t){this.keyCooldown>0&&(this.keyCooldown-=t),this.enterCooldown>0&&(this.enterCooldown-=t),this.selectionCooldown>0&&(this.selectionCooldown-=t)}render(t){t.fillStyle="#002",t.fillRect(0,0,this.game.width,this.game.height),r.drawStars(t,this.game),t.fillStyle="#fff",t.font=r.f48,t.textAlign="center",t.fillText("Shop",this.game.width/2,150),t.font=r.f24,t.fillText("Purchase Upgrades",this.game.width/2,200),t.fillStyle="#0f0",t.font=r.f20,t.fillText(`Metal: ${this.game.gameData.metal}`,this.game.width/2,250),t.font=r.f20;for(let e=0;e<this.options.length;e++)e===this.selectedOption?(t.fillStyle="#0ff",t.fillText("> "+this.options[e],this.game.width/2,300+40*e)):(t.fillStyle="#fff",t.fillText(this.options[e],this.game.width/2,300+40*e));t.fillStyle="#888",t.font=r.f16,t.fillText("Use Arrow Keys to navigate, Enter to select",this.game.width/2,500),this.game.controllerConnected&&t.fillText("Controller: A=Select, B=Back, Start=Pause",this.game.width/2,520)}handleInput(t){t.ArrowUp&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption-1+this.options.length)%this.options.length,this.keyCooldown=this.cooldownTime),t.ArrowDown&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption+1)%this.options.length,this.keyCooldown=this.cooldownTime),(t.Enter||t.Space)&&this.enterCooldown<=0&&this.selectOption(),t.Escape&&this.enterCooldown<=0&&this.game.changeState("gameplay")}selectOption(){if(!(this.selectionCooldown>0))switch(this.selectedOption){case 0:this.game.gameData.metal>=50&&(this.game.gameData.metal-=50,this.game.player.maxShieldLevel++,this.game.player.shieldLevel=this.game.player.maxShieldLevel,this.selectionCooldown=this.selectionCooldownTime);break;case 1:this.game.gameData.metal>=30&&(this.game.gameData.metal-=30,this.game.player.speed+=50,this.selectionCooldown=this.selectionCooldownTime);break;case 2:this.game.gameData.metal>=100&&(this.game.gameData.metal-=100,this.game.player.turboLevel=1,this.game.player.turboCharge=5,this.selectionCooldown=this.selectionCooldownTime);break;case 3:this.game.gameData.metal>=80&&(this.game.gameData.metal-=80,this.game.player.doubleBulletLevel=1,this.selectionCooldown=this.selectionCooldownTime);break;case 4:this.game.gameData.metal>=120&&(this.game.gameData.metal-=120,this.game.player.tripleBulletLevel=1,this.selectionCooldown=this.selectionCooldownTime);break;case 5:this.game.gameData.metal>=150&&(this.game.gameData.metal-=150,this.game.player.secondaryWeaponLevel=1,this.selectionCooldown=this.selectionCooldownTime);break;case 6:this.game.goBack()}}}class u{constructor(t,e,i,s=2,h=3,a=.02,l="#fa0"){this.x=t,this.y=e,this.vx=Math.cos(i*Math.PI/180)*s,this.vy=Math.sin(i*Math.PI/180)*s,this.life=1,this.decay=a,this.size=h,this.color=l}update(t){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay}render(t){t.globalAlpha=this.life,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.size,this.size),t.globalAlpha=1}}class w{constructor(t,e,i){this.x=t,this.y=e,this.width=40,this.height=40,this.speed=300,this.shootCooldown=0,this.shootDelay=200,this.game=i,this.cloakLevel=0,this.cloakTimer=0,this.cloakDelay=5e3,this.cloakDuration=5e3,this.isCloaked=!1,this.shieldLevel=4,this.maxShieldLevel=4,this.shieldRechargeTimer=0,this.shieldRechargeDelay=1e4,this.isHit=!1,this.hitTimer=0,this.hitDuration=4e3,this.blinkInterval=500,this.blinkTimer=0,this.isVisible=!0,this.beamHitCooldown=0,this.beamHitCooldownTime=500,this.turboLevel=0,this.turboCharge=0,this.maxTurboCharge=5,this.turboRechargeRate=.1,this.turboActive=!1,this.secondaryWeaponLevel=0,this.doubleBulletLevel=0,this.tripleBulletLevel=0,this.rocketCooldown=0,this.rocketCooldownTime=1600}update(t,e,i){let s=this.speed;this.turboActive&&this.turboCharge>0&&(s*=2),(e.ArrowLeft||e.KeyA)&&(this.x-=s*t/1e3),(e.ArrowRight||e.KeyD)&&(this.x+=s*t/1e3),(e.ArrowUp||e.KeyW)&&(this.y-=s*t/1e3),(e.ArrowDown||e.KeyS)&&(this.y+=s*t/1e3),this.y<-this.height?this.y=i:this.y>i&&(this.y=-this.height),this.x=Math.max(0,Math.min(this.game.width-this.width,this.x)),this.shootCooldown-=t,(e.Space||e.ControllerSpace)&&this.shootCooldown<=0&&(this.shoot(),this.shootCooldown=this.shootDelay,this.decloak()),(e.KeyQ||e.ControllerQ)&&this.secondaryWeaponLevel>0&&this.fireSecondaryWeapon(),e.ShiftLeft||e.ShiftRight||e.ControllerShift?this.turboLevel>0&&this.turboCharge>0&&(this.turboActive=!0):this.turboActive=!1,this.updateCloaking(t),this.updateShield(t),this.updateHitEffects(t),this.updateTurbo(t),this.beamHitCooldown>0&&(this.beamHitCooldown-=t),this.rocketCooldown>0&&(this.rocketCooldown-=t)}updateHitEffects(t){this.isHit&&(this.hitTimer+=t,this.blinkTimer+=t,this.blinkTimer>=this.blinkInterval&&(this.isVisible=!this.isVisible,this.blinkTimer=0),this.hitTimer>=this.hitDuration&&(this.isHit=!1,this.isVisible=!0))}updateTurbo(t){0!==this.turboLevel&&(this.turboActive&&this.turboCharge>0?(this.turboCharge-=t/1e3,this.turboCharge<=0&&(this.turboCharge=0,this.turboActive=!1)):!this.turboActive&&this.turboCharge<this.maxTurboCharge&&(this.turboCharge+=this.turboRechargeRate*t/1e3,this.turboCharge>this.maxTurboCharge&&(this.turboCharge=this.maxTurboCharge)),this.turboActive&&this.turboCharge>0?this.game.gameData.turboMultiplier=2:this.game.gameData.turboMultiplier=1)}updateCloaking(t){if(this.game&&this.game.gameData&&5===this.game.gameData.level)return this.cloakLevel=0,void(this.isCloaked=!1);if(this.cloakTimer+=t,this.cloakTimer>=this.cloakDelay){const t=(this.cloakTimer-this.cloakDelay)/this.cloakDuration;this.cloakLevel=Math.min(1,t),this.isCloaked=this.cloakLevel>0}}decloak(){this.cloakLevel=0,this.cloakTimer=0,this.isCloaked=!1}isHitByBeam(t){if("firing"!==t._phase||this.beamHitCooldown>0)return!1;const e=t.y+12,i=this.y+this.height/2;return i>=e-1.5&&i<=e+1.5}updateShield(t){this.shieldLevel<this.maxShieldLevel&&(this.shieldRechargeTimer+=t,this.shieldRechargeTimer>=this.shieldRechargeDelay&&(this.shieldLevel++,this.shieldRechargeTimer=0))}hit(){i.playSound(a),this.triggerControllerVibration(),this.isHit=!0,this.hitTimer=0,this.blinkTimer=0,this.isVisible=!0,this.createHitSparks()}triggerControllerVibration(){this.game.controllers&&this.game.controllers.length>0&&this.game.controllers.forEach(t=>{t&&t.vibrationActuator&&t.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:300,weakMagnitude:.8,strongMagnitude:.8})})}triggerRocketVibration(){this.game.controllers&&this.game.controllers.length>0&&this.game.controllers.forEach(t=>{t&&t.vibrationActuator&&t.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:200,weakMagnitude:.5,strongMagnitude:.5})})}createHitSparks(){for(let t=0;t<12;t++){const t=360*Math.random(),e=3*Math.random()+2,i=this.x+this.width/2,s=this.y+this.height/2;this.game.particles.push(new E(i,s,t,e))}}shoot(){i.playSound(s);const t=this.y+this.height/2;this.doubleBulletLevel>0?(this.game.bullets.push(new D(this.x+this.width,t-4,this.game)),this.game.bullets.push(new D(this.x+this.width,t+4,this.game))):this.game.bullets.push(new D(this.x+this.width,t,this.game)),this.tripleBulletLevel>0&&(this.game.bullets.push(new R(this.x+this.width,t-8,this.game,-45)),this.game.bullets.push(new R(this.x+this.width,t+8,this.game,45))),Math.random()<.1&&(this.game.bullets.length,this.doubleBulletLevel>0&&this.tripleBulletLevel>0||this.doubleBulletLevel>0||this.tripleBulletLevel)}fireSecondaryWeapon(){this.secondaryWeaponLevel>0&&this.rocketCooldown<=0&&(i.playSound(h),this.decloak(),this.triggerRocketVibration(),this.game.bullets.push(new A(this.x+this.width/2,this.y+this.height/2,this.game)),this.rocketCooldown=this.rocketCooldownTime)}render(t){if(!this.isHit||this.isVisible){if(this.isCloaked&&(t.globalAlpha=1-this.cloakLevel),this.turboActive&&this.turboLevel>0&&this.drawTurboFlames(t),t.fillStyle="#000",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000",t.fillRect(this.x+5,this.y-10,8,10),t.fillRect(this.x+27,this.y-10,8,10),t.fillStyle="#fff",t.fillRect(this.x+8,this.y+5,8,8),t.fillRect(this.x+24,this.y+5,8,8),t.fillStyle="#ff69b4",t.fillRect(this.x+18,this.y+15,4,4),t.strokeStyle="#fff",t.lineWidth=1,t.beginPath(),t.moveTo(this.x-5,this.y+20),t.lineTo(this.x+5,this.y+20),t.moveTo(this.x-5,this.y+25),t.lineTo(this.x+5,this.y+25),t.moveTo(this.x+this.width+5,this.y+20),t.lineTo(this.x+this.width-5,this.y+20),t.moveTo(this.x+this.width+5,this.y+25),t.lineTo(this.x+this.width-5,this.y+25),t.stroke(),this.isCloaked){t.globalAlpha=this.cloakLevel;const e=this.x+this.width/2,i=this.y+this.height/2,s=.8*Math.max(this.width,this.height),h=.005*Date.now(),a=3;for(let l=0;l<a;l++){const a=s+15*l+8*Math.sin(h+2*l),o=.6*this.cloakLevel/(l+1);t.globalAlpha=o,t.strokeStyle="#0ff",t.lineWidth=2,t.setLineDash([5,5]),t.lineDashOffset=2*h,t.beginPath(),t.arc(e,i,a,0,2*Math.PI),t.stroke()}t.setLineDash([])}t.globalAlpha=1}}drawTurboFlames(t){const e=.01*Date.now(),i=this.x-15,s=this.y+this.height/2,h=[{color:"#f40",size:25,speed:3,offset:0},{color:"#f60",size:20,speed:2,offset:-4},{color:"#f80",size:15,speed:1.5,offset:-8},{color:"#fa0",size:10,speed:1,offset:-12}];for(let a=0;a<h.length;a++){const l=h[a],o=.3*Math.sin(e*l.speed+a)+.7,r=i-l.offset,n=s+3*Math.sin(2*e+a);t.save(),t.translate(r,n),t.scale(o,1),t.fillStyle=l.color,t.globalAlpha=.8+.2*o,t.beginPath(),t.ellipse(0,0,l.size,.4*l.size,0,0,2*Math.PI),t.fill(),t.shadowColor=l.color,t.shadowBlur=6,t.fill(),t.shadowBlur=0,t.restore()}}}class S{constructor(t,e,i,s=0){if(this.x=t,this.y=e,this.width=30,this.height=30,this.speed=100+20*i,this.health=1,this.enemyType=s,this.rotation=360*Math.random(),this.rotationSpeed=0,0===s){this.rotationSpeed=60*Math.random()+30,this.asteroidType=Math.floor(4*Math.random()),this.sizeVariation=.4*Math.random()+.8,this.colorVariation=.3*Math.random()+.85,this.detailLevel=Math.floor(3*Math.random())+2,this.details=[];for(let t=0;t<this.detailLevel;t++)this.details.push({x:Math.random()-.5,y:Math.random()-.5})}4===this.enemyType&&(this._phase="entering")}layBomb(){if(this.game&&this.game.proximityBombs){const t=new T(this.x,this.y,this.game);this.game.proximityBombs.push(t)}}update(e){const i=this.game.gameData.turboMultiplier||1;if(0===this.enemyType&&(this.x-=this.speed*i*e/1e3,this.rotation+=this.rotationSpeed*e/1e3,this.rotation>360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360)),1===this.enemyType)if(this.x-=.6*this.speed*i*e/1e3,this.game.player.isCloaked)this.rotation+=15*e/1e3;else{const i=this.game.player.x-this.x,s=this.game.player.y-this.y;this.targetRotation=180*Math.atan2(s,i)/Math.PI;const h=this.targetRotation-this.rotation;this.rotation+=h*e/1e3*2;const a=.3;this.x=t(this.x,this.game.player.x,a*e/1e3),this.y=t(this.y,this.game.player.y,a*e/1e3)}2===this.enemyType&&(this.x-=.6*this.speed*i*e/1e3,this._bobTimer=(this._bobTimer||0)+e/1e3,this.y+=.2*Math.sin(2*this._bobTimer)),3===this.enemyType&&(this.x-=.8*this.speed*i*e/1e3,this.y+=50*Math.sin(this._diagonalTimer||0)*i*e/1e3,this._diagonalTimer=(this._diagonalTimer||0)+e/1e3*2,this._bombTimer=(this._bombTimer||0)+e,this._bombTimer>2e3&&(this.layBomb(),this._bombTimer=0)),4===this.enemyType&&("entering"===this._phase?(this.x-=.5*this.speed*i*e/1e3,this.x<=this.game.width-100&&(this._phase="firing",this._firingTimer=0)):"firing"===this._phase?(this._firingTimer+=e,this._firingTimer>3e3&&(this._phase="exiting")):"exiting"===this._phase&&(this.x-=.8*this.speed*i*e/1e3))}render(t){if(t.save(),0===this.enemyType){t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation*Math.PI/180);const e=this.width*this.sizeVariation,i=this.height*this.sizeVariation;switch(this.asteroidType){case 0:case 1:this.drawGenericAsteroid(t,e,i,4);break;case 2:this.drawGenericAsteroid(t,e,i,8);break;case 3:this.drawGenericAsteroid(t,e,i,6)}}else 1===this.enemyType?this.drawMouseEnemy(t):2===this.enemyType?this.drawShop(t):3===this.enemyType?this.drawSnakeEnemy(t):4===this.enemyType&&this.drawBirdEnemy(t);t.restore()}drawMouseEnemy(t){t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.rotation*Math.PI/180),t.fillStyle="#808080",t.beginPath(),t.arc(0,0,12,0,2*Math.PI),t.fill(),t.fillStyle="#A0A0A0",t.beginPath(),t.arc(-8,-12,6,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(8,-12,6,0,2*Math.PI),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(-4,-2,2,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(4,-2,2,0,2*Math.PI),t.fill();const e=.005*Date.now();this.game.player.isCloaked?t.fillStyle=Math.sin(3*e)>0?"#0f0":"#030":t.fillStyle="#f00",t.beginPath(),t.arc(0,-8,3,0,2*Math.PI),t.fill(),t.shadowColor=t.fillStyle,t.shadowBlur=8,t.beginPath(),t.arc(0,-8,3,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.restore()}drawShop(t){const e=this.width,i=this.height,s=this.x,h=this.y;t.fillStyle="#2c3e50",t.fillRect(s,h,e,i),t.fillStyle="#34495e",t.fillRect(s+5,h,e-10,i),t.fillRect(s,h+5,e,i-10),t.fillStyle="#1a252f",t.fillRect(s+.2*e,h+.1*i,.6*e,.8*i),t.fillStyle="#3498db";for(let a=0;a<3;a++){const l=s+.25*e+a*e*.2,o=h+.2*i,r=.15*i;t.fillRect(l,o,r,r)}t.fillStyle="#e74c3c";const a=.8*e,l=.2*i,o=s+(e-a)/2,r=h+.7*i;t.fillRect(o,r,a,l),t.fillStyle="#fff",t.font=.15*i+"px monospace",t.textAlign="center",t.fillText("SHOP",s+e/2,r+.7*l),t.fillStyle="#95a5a6",t.fillRect(s+.4*e,h-.1*i,.2*e,.1*i),t.fillStyle="#7f8c8d",t.fillRect(s-.05*i,h+.3*i,.1*i,.4*i),t.fillRect(s+e,h+.3*i,.1*i,.4*i)}drawGenericAsteroid(t,e,i,s=6){const h=this.adjustColor("#808080",this.colorVariation);t.fillStyle=h,t.beginPath();for(let h=0;h<s;h++){const a=h*Math.PI*2/s,l=Math.cos(a)*e/2,o=Math.sin(a)*i/2;0===h?t.moveTo(l,o):t.lineTo(l,o)}if(t.closePath(),t.fill(),this.details&&this.details.length>0)for(let s=0;s<this.detailLevel&&s<this.details.length;s++){const h=this.details[s],a=.25*e-s*e*.08,l=h.x*e*.3,o=h.y*i*.3;t.fillStyle=this.adjustColor("#404040",this.colorVariation),t.fillRect(-a/2+l,-a/2+o,a,a)}t.fillStyle=this.adjustColor("#c0c0c0",this.colorVariation),this.details&&this.details.length>0&&(t.fillRect(this.details[0].x*e*.1-2,-i/2+2+this.details[0].y*i*.1,4,4),this.details.length>1&&t.fillRect(e/2-6+this.details[1].x*e*.1,this.details[1].y*i*.1-2,4,4))}adjustColor(t,e){if("#808080"===t){const t=Math.floor(128*e);return`rgb(${t}, ${t}, ${t})`}if("#404040"===t){const t=Math.floor(64*e);return`rgb(${t}, ${t}, ${t})`}if("#c0c0c0"===t){const t=Math.floor(192*e);return`rgb(${t}, ${t}, ${t})`}return t}drawSnakeEnemy(t){t.fillStyle="#0f0";for(let e=0;e<3;e++){const i=this.x+8*e,s=this.y+3*Math.sin(2*(this._diagonalTimer||0)+.5*e);t.fillRect(i,s,8,12)}t.fillStyle="#080",t.fillRect(this.x+24,this.y+2,10,8),t.fillStyle="#f00",t.fillRect(this.x+26,this.y+4,2,2),t.fillRect(this.x+30,this.y+4,2,2),t.fillStyle="#0a0",t.fillRect(this.x-4,this.y+4,6,4)}drawBirdEnemy(t){t.fillStyle="#8B4513",t.fillRect(this.x,this.y+8,20,12),t.fillStyle="#654321";const e=2*Math.sin(4*(this._diagonalTimer||0));t.fillRect(this.x-8,this.y+6+e,12,8),t.fillRect(this.x+16,this.y+6+e,12,8),t.fillStyle="#A0522D",t.fillRect(this.x+18,this.y+6,8,8),t.fillStyle="#FFD700",t.fillRect(this.x+26,this.y+8,4,4),t.fillStyle="#000",t.fillRect(this.x+20,this.y+8,2,2),"firing"===this._phase&&(t.strokeStyle="#ff0",t.lineWidth=3,t.beginPath(),t.moveTo(this.x+30,this.y+12),t.lineTo(0,this.y+12),t.stroke(),t.shadowColor="#ff0",t.shadowBlur=10,t.stroke(),t.shadowBlur=0)}}class x extends S{constructor(t,e,i){super(t,e,i.gameData.level,5),this.width=i.width/5,this.height=i.height/5,this.game=i,this.maxHealth=100,this.health=this.maxHealth,this.phase="entering",this.targetX=.6*i.width,this.attackTimer=3e3,this.attackInterval=3e3,this.currentAttack="spawn",this.tailAttackTimer=0,this.tailAttackDuration=2e3,this.spawnAttackTimer=1e3,this.spawnAttackDuration=1e4,this.entranceSpeed=200,this.isVulnerable=!1,this.spawnCount=0,this.maxSpawnsPerWave=10,this.spawnInterval=1e3,this.spawnPauseDuration=5e3,this.isInSpawnPause=!1,this.verticalMovementTimer=0,this.verticalMovementSpeed=100,this.verticalMovementRange=.2*i.height,this.verticalCenter=e}update(t){const e=this.game.gameData.turboMultiplier||1;"entering"===this.phase?(this.x-=this.entranceSpeed*e*t/1e3,this.x<=this.targetX&&(this.x=this.targetX,this.phase="attacking",this.isVulnerable=!0)):"attacking"===this.phase?(this.attackTimer+=t,this.attackTimer>=this.attackInterval&&(this.attackTimer=0,this.currentAttack="tail"===this.currentAttack?"spawn":"tail","tail"===this.currentAttack&&(this.y=this.verticalCenter,this.verticalMovementTimer=0)),"tail"===this.currentAttack?this.performTailAttack(t):this.performSpawnAttack(t)):"defeated"===this.phase&&this.defeatTimer>0&&(this.defeatTimer-=t)}performTailAttack(t){this.tailAttackTimer+=t,this.tailAttackTimer>=this.tailAttackDuration?this.tailAttackTimer=0:this.tailAttackTimer<500&&this.createTailDamageZone()}performSpawnAttack(t){this.spawnAttackTimer+=t,this.verticalMovementTimer+=t;const e=Math.sin(.002*this.verticalMovementTimer)*this.verticalMovementRange;if(this.y=this.verticalCenter+e,!this.isInSpawnPause)return this.spawnCount>=this.maxSpawnsPerWave?(this.isInSpawnPause=!0,void(this.spawnAttackTimer=0)):void(this.spawnAttackTimer>=this.spawnInterval&&(this.spawnEnemiesFromMouth(),this.spawnAttackTimer=0));this.spawnAttackTimer>=this.spawnPauseDuration&&(this.isInSpawnPause=!1,this.spawnAttackTimer=0,this.spawnCount=0)}createTailDamageZone(){this.tailDamageActive=!0,this.tailDamageTimer=1e3}spawnEnemiesFromMouth(){const t=this.game.width-150,e=100+Math.random()*(this.game.height-200),i=new S(t,e,this.game.gameData.level,1);i.game=this.game,i.spawnedByBoss=!0,this.game.enemies.push(i),this.spawnCount++}takeDamage(t){this.isVulnerable&&(this.health-=t,this.health<=0&&this.defeat(),this.createDamageEffect())}defeat(){this.phase="defeated",this.isVulnerable=!1,this.game.controllers&&this.game.controllers.length>0&&this.game.controllers.forEach(t=>{t&&t.vibrationActuator&&t.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:1e3,weakMagnitude:1,strongMagnitude:1})});for(let t=0;t<50;t++){const t=360*Math.random(),e=8*Math.random()+4;this.game.particles.push(new b(this.x+this.width/2,this.y+this.height/2,t,e))}for(let t=0;t<20;t++){const t=100*(Math.random()-.5),e=60*(Math.random()-.5),i=new O(this.x+this.width/2+t,this.y+this.height/2+e,this.game);this.game.metal.push(i)}this.game.triggerScreenShake&&this.game.triggerScreenShake(200,1e3),this.defeatTimer=2e3}createDamageEffect(){for(let t=0;t<8;t++){const t=360*Math.random(),e=3*Math.random()+2;this.game.particles.push(new k(this.x+this.width/2,this.y+this.height/2,t,e))}}render(t){this.renderHealthBar(t),t.fillStyle="#8B4513",t.fillRect(this.x,this.y,this.width,this.height),this.drawBossDetails(t),"tail"===this.currentAttack&&this.tailAttackTimer<500&&this.drawTailAttack(t),this.isInSpawnPause&&this.drawSpawnPauseIndicator(t)}renderHealthBar(t){const e=this.width,i=this.x,s=this.y-20;t.fillStyle="#333",t.fillRect(i,s,e,10);const h=this.health/this.maxHealth;t.fillStyle=h>.5?"#0f0":h>.25?"#ff0":"#f00",t.fillRect(i,s,e*h,10),t.strokeStyle="#fff",t.lineWidth=1,t.strokeRect(i,s,e,10),t.fillStyle="#fff",t.font="12px monospace",t.textAlign="center",t.fillText(`${this.health}/${this.maxHealth}`,i+e/2,s+5+4)}drawBossDetails(t){t.fillStyle="#f00",t.fillRect(this.x+.2*this.width,this.y+.2*this.height,8,8),t.fillRect(this.x+.7*this.width,this.y+.2*this.height,8,8),t.fillStyle="#000",t.fillRect(this.x+.4*this.width,this.y+.6*this.height,.2*this.width,.3*this.height),t.fillStyle="#654321",t.fillRect(this.x-5,this.y-5,10,15),t.fillRect(this.x+this.width-5,this.y-5,10,15),t.strokeStyle="#654321",t.lineWidth=8,t.beginPath(),t.moveTo(this.x+this.width,this.y+.5*this.height),t.quadraticCurveTo(this.x+this.width+50,this.y+.3*this.height,this.x+this.width+80,this.y+.7*this.height),t.stroke()}drawTailAttack(t){}drawSpawnPauseIndicator(t){t.fillStyle="rgba(255, 255, 0, 0.7)",t.font=r.f16,t.textAlign="center",t.fillText("SPAWN PAUSED",this.x+this.width/2,this.y-30);const e=this.width,i=this.x,s=this.y-40;t.fillStyle="rgba(255, 255, 0, 0.3)",t.fillRect(i,s,e,4);const h=this.spawnAttackTimer/this.spawnPauseDuration;t.fillStyle="rgba(255, 255, 0, 0.8)",t.fillRect(i,s,e*h,4)}}class b{constructor(t,e,i,s){this.x=t,this.y=e,this.vx=Math.cos(i*Math.PI/180)*s,this.vy=Math.sin(i*Math.PI/180)*s,this.life=1,this.decay=.02,this.size=6*Math.random()+4,this.color=["#f60","#f00","#ff0"][Math.floor(3*Math.random())]}update(t){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay}render(t){t.globalAlpha=this.life,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.size,this.size),t.globalAlpha=1}}class k extends u{constructor(t,e,i,s=3){super(t,e,i,s,3*Math.random()+2,.05,"#f00")}render(t){t.globalAlpha=this.life,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.size,this.size),t.fillRect(this.x+2,this.y+2,this.size-4,this.size-4),t.globalAlpha=1}}class v extends u{constructor(t,e,i,s=4){super(t,e,i,s,4*Math.random()+3,.08,"#ff0")}render(t){t.globalAlpha=this.life,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.size,this.size),t.shadowColor=this.color,t.shadowBlur=6,t.fillRect(this.x,this.y,this.size,this.size),t.shadowBlur=0,t.globalAlpha=1}}class C extends u{constructor(t,e,i,s=5){super(t,e,i,s,5*Math.random()+4,.06,["#f60","#f00","#ff0","#f80"][Math.floor(4*Math.random())])}render(t){t.globalAlpha=this.life,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.size,this.size),t.shadowColor=this.color,t.shadowBlur=8,t.fillRect(this.x,this.y,this.size,this.size),t.shadowBlur=0,t.globalAlpha=1}}class T{constructor(t,e,i){this.x=t,this.y=e,this.width=8,this.height=8,this.game=i,this.explosionRadius=60,this.exploded=!1,this.blinkTimer=0,this.blinkInterval=200,this.speed=30,this.lifetime=15e3,this.age=0,this.driftDirection=360*Math.random(),this.driftSpeed=20*Math.random()+10}update(t){if(this.blinkTimer+=t,this.age+=t,this.age>=this.lifetime)this.exploded=!0;else{if(!this.exploded){const e=this.driftDirection*Math.PI/180;if(this.x+=Math.cos(e)*this.driftSpeed*t/1e3,this.y+=Math.sin(e)*this.driftSpeed*t/1e3,this.x<-this.width||this.x>this.game.width+this.width||this.y<-this.height||this.y>this.game.height+this.height)return void(this.exploded=!0)}if(!this.exploded&&this.game.player){const t=this.x-this.game.player.x,e=this.y-this.game.player.y;Math.sqrt(t*t+e*e)<this.explosionRadius&&this.explode()}}}explode(){this.exploded=!0;for(let t=0;t<20;t++){const t=360*Math.random(),e=5*Math.random()+3;this.game.particles.push(new M(this.x,this.y,t,e))}if(this.game.triggerScreenShake&&this.game.triggerScreenShake(50,300),this.game.player){const t=this.x-this.game.player.x,e=this.y-this.game.player.y;Math.sqrt(t*t+e*e)<this.explosionRadius&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake&&this.game.triggerScreenShake(15,400),this.game.gameData.lives<=0&&(this.game.gameOver=!0,this.game.changeState("gameOver")))}}render(t){this.exploded||Math.floor(this.blinkTimer/this.blinkInterval)%2==0&&(t.fillStyle="#f00",t.fillRect(this.x,this.y,this.width,this.height),t.shadowColor="#f00",t.shadowBlur=8,t.fillRect(this.x,this.y,this.width,this.height),t.shadowBlur=0)}}class M extends u{constructor(t,e,i,s=4){super(t,e,i,s,4*Math.random()+2,.05,"#f60")}}class D{constructor(t,e,i){this.x=t,this.y=e,this.width=8,this.height=3,this.speed=500,this.game=i}update(t){const e=this.game.gameData.turboMultiplier||1;this.x+=this.speed*e*t/1e3}render(t){t.fillStyle="#ff0",t.fillRect(this.x,this.y,this.width,this.height)}}class R extends D{constructor(t,e,i,s){super(t,e,i),this.angle=s,this.speed=400}update(t){const e=this.game.gameData.turboMultiplier||1,i=this.angle*Math.PI/180;this.x+=Math.cos(i)*this.speed*e*t/1e3,this.y+=Math.sin(i)*this.speed*e*t/1e3}render(t){t.fillStyle="#f0f",t.fillRect(this.x,this.y,this.width,this.height)}}class A extends D{constructor(t,e,i){super(t,e,i),this.width=6,this.height=6,this.speed=300,this.deployed=!1,this.deployTimer=0,this.deployDelay=500,this.target=null,this.smokeTimer=0,this.smokeInterval=100,this.lifetime=8e3,this.age=0}update(t){if(this.age+=t,this.age>=this.lifetime)this.deployed=!0;else if(this.deployed){if(this.target||this.findTarget(),this.target){const e=this.target.x-this.x,i=this.target.y-this.y,s=Math.sqrt(e*e+i*i);s>0&&(this.x+=e/s*this.speed*t/1e3,this.y+=i/s*this.speed*t/1e3)}else this.x+=this.speed*t/1e3;this.smokeTimer+=t,this.smokeTimer>=this.smokeInterval&&(this.createSmoke(),this.smokeTimer=0)}else this.deployTimer+=t,this.deployTimer>=this.deployDelay?this.deployed=!0:this.x+=50*t/1e3}findTarget(){let t=1/0,e=null;for(const i of this.game.enemies){const s=i.x-this.x,h=i.y-this.y,a=Math.sqrt(s*s+h*h);a<t&&(t=a,e=i)}this.target=e}createSmoke(){for(let t=0;t<3;t++){const t=10*Math.random()-5,e=10*Math.random()-5;this.game.particles.push(new L(this.x-10+t,this.y+e))}}render(t){this.deployed?(t.fillStyle="#f60",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#ff0",t.fillRect(this.x-8,this.y+1,4,4)):(t.fillStyle="#888",t.fillRect(this.x,this.y,this.width,this.height))}}class L extends u{constructor(t,e){super(t,e,360*Math.random(),1,3*Math.random()+2,.02,"#666")}}class P{constructor(t,e,i){this.x=t,this.y=e,this.speed=i}update(t){const e=this.game.gameData.turboMultiplier||1;this.x-=this.speed*e*t/1e3,this.x<-10&&(this.x+=this.game.width+20,this.y=Math.random()*this.game.height)}render(t){t.fillStyle="#fff",t.fillRect(this.x,this.y,1,1)}}class E extends u{constructor(t,e,i,s=4){super(t,e,i,s,3*Math.random()+2,.03,"#ff0")}}class B extends u{constructor(t,e,i){super(t,e,i,3,4*Math.random()+3,.015,"#ff0")}}class O{constructor(t,e,i){this.x=t,this.y=e,this.width=8,this.height=8,this.collected=!1,this.collectRadius=40,this.floatOffset=0,this.floatSpeed=2,this.driftSpeed=50,this.game=i}update(t){this.floatOffset+=this.floatSpeed*t/1e3,this.floatOffset>2*Math.PI&&(this.floatOffset-=2*Math.PI);const e=this.game.gameData.turboMultiplier||1;if(this.x-=this.driftSpeed*e*t/1e3,!this.collected&&this.game&&this.game.player){const t=this.x-this.game.player.x,e=this.y-this.game.player.y;Math.sqrt(t*t+e*e)<this.collectRadius&&this.collect()}}collect(){this.collected||(this.collected=!0,this.game.gameData.metal++,i.playSound(l))}render(t){if(this.collected)return;const e=this.y+3*Math.sin(this.floatOffset);t.fillStyle="#c0c0c0",t.fillRect(this.x,e,this.width,this.height)}}window.addEventListener("load",()=>{new n})</script>