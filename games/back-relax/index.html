<title>BACK RELAX</title><meta content=$twitter.xrptipbot.com/randytayler name=monetization><script src=/2019/webxr/aframe.js></script><script>var audio_ctx;zzfx_v=.5,zzfx_x=new AudioContext,zzfx=(t,e,r,o=1,n=.1,i=0,a=0,s=0,u=0)=>{let l=44100,c=Math.PI;r*=2*c/l,r*=1+e*(2*Math.random()-1),i*=1e3*c/l**2,n*=0|(o=0<o?l*(10<o?10:o)|0:1),s*=2*c/l,u*=c,e=[];for(var d=0,b=0,m=0;m<o;++m)e[m]=t*zzfx_v*Math.cos(d*r*Math.cos(b*s+u))*(m<n?m/n:1-(m-n)/(o-n)),d+=1+a*(2*Math.random()-1),b+=1+a*(2*Math.random()-1),r+=i;return t=zzfx_x.createBuffer(1,o,l),r=zzfx_x.createBufferSource(),t.getChannelData(0).set(e),r.buffer=t,r.connect(zzfx_x.destination),r.start(),r};var selectedBacksLeft,selectedBacksRight,selectedPieces=Array(),throbspeed=.005;AFRAME.registerComponent("startbutton",{init:function(){this.el.addEventListener("click",(function(){enterPhase("select")}))}}),AFRAME.registerComponent("nextbutton",{init:function(){this.el.addEventListener("click",(function(){for(var t=!1,e=0;e<selectedBacksLeft.length;e++)selectedBacksLeft[e]&&(t=!0);for(e=0;e<selectedBacksRight.length;e++)selectedBacksRight[e]&&(t=!0);t?enterPhase("breathe"):displayText("Select at least one area to continue.",0,4,-1.5,4,4,4)}))}}),AFRAME.registerComponent("beginbutton",{init:function(){this.el.addEventListener("click",(function(){enterPhase("play")}))}}),AFRAME.registerComponent("homebutton",{init:function(){this.el.addEventListener("click",(function(){enterPhase("menu")}))}}),AFRAME.registerComponent("selector",{schema:{side:{type:"string",default:""},num:{type:"number"},previousColor:{type:"string",default:"white"}},init:function(){var t=!1,e=this.el,r=this.data;e.classList.toggle("selector"),e.addEventListener("mouseleave",(function(){e.setAttribute("material",{color:r.previousColor})})),e.addEventListener("mouseenter",(function(){e.setAttribute("material",{color:"#99FF99"})})),e.addEventListener("click",(function(){t?(t=!1,e.setAttribute("material",{color:"white"}),r.previousColor="white","left"==r.side?selectedBacksLeft[r.num]=!1:selectedBacksRight[r.num]=!1):(t=!0,e.setAttribute("material",{color:"green"}),r.previousColor="green","left"==r.side?selectedBacksLeft[r.num]=!0:selectedBacksRight[r.num]=!0)}))}}),AFRAME.registerComponent("throb",{init:function(){var t=this.el;t.col=0,t.min=.5,t.max=1,t.addEventListener("mouseleave",(function(){t.healing=!1})),t.addEventListener("mouseenter",(function(){t.healing=!0})),this.dir=-1},tick:function(){var t=this.el,e=parseInt(t.id.replace(/throb/,""));if(t.healing){t.col+=.5;var r=Math.round(t.col);r>15&&(r=15),t.setAttribute("material",{color:colors[r]}),radius=t.getAttribute("geometry").radius-.005,radius<=.05?(zzfx(.5,.1,700-8*throbs[e].r,.1,.11,0,0,8.2,.46),t.parentNode.removeChild(t),2==document.querySelector("#torso").children.length&&win()):t.setAttribute("geometry",{radius:radius})}t.object3D.scale.x>=throbs[e].max?this.dir=-1:t.object3D.scale.x<=throbs[e].min&&(this.dir=1),t.object3D.scale.x+=throbspeed*this.dir,t.object3D.scale.y+=throbspeed*this.dir,t.object3D.scale.z+=throbspeed*this.dir}});for(var waveInterval,s2,instr,rad=Math.PI/180,maxDepth=9,nerveLength=.035,angle=40,nervePoints=Array(),counter=0,speed=1,branch2=0,throbs=Array(),throbcounter=0,colors=(throbcounter=0,Array()),color=16711680,c=0,throbEls=Array(),s1=!1;2027775!=color;)color+=4113,color-=983040,c++,colors[c]="#"+color.toString(16);messageCounter=0;var messages=["How was your breathing?\nLet's go again, and remember\nto breathe deeply, in sync\nwith the waves.\n\nThere's no hurry.","Now imagine your pain\ndiminishing as you clear the\nred bubbles.\n\nLet the pain wash over you, then\nfloat away.","Imagine you are\nquieting the nerves that hurt.\nRemember to breathe deeply.","Now focus\non relaxing the muscles where\nyou hurt.\nAnd breathe.","Slow down now,\nremembering to breathe, relax,\nand smile.\n\nYes, smile. A fake one\nwill do.","You are in control.\nTake a break, or keep playing.\nGet up whenever you feel ready."];function init(){selectedBacksLeft=[!1,!1,!1,!1,!1,!1,!1,!1],selectedBacksRight=[!1,!1,!1,!1,!1,!1,!1,!1]}function buildSand(){for(var t=document.getElementById("sand"),e=t.getContext("2d"),r=0;r<1024;r++)for(var o=parseInt("EE",16),n=parseInt("DD",16),i=parseInt("BB",16),a=0;a<1024;a++){if(4*Math.round(Math.random())<2){var s=Math.round(6*Math.random())-4+o,u=Math.round(6*Math.random())-4+n,l=Math.round(6*Math.random())-4+i;s>230&&(s-=3),u>210&&(u-=3),l>180&&(l-=3),s<210&&(s+=3),u<190&&(u+=3),l<160&&(l+=3),o=s,n=u,i=l}else o=parseInt("EE",16),n=parseInt("DD",16),i=parseInt("BB",16);e.fillStyle="rgba("+o+","+n+","+i+",255)",e.fillRect(a,r,1,1)}var c=t.toDataURL("image/png");document.querySelector("#island").setAttribute("material",{src:c})}function buildSky(){var t=document.getElementById("gradient"),e=t.getContext("2d"),r=e.createLinearGradient(0,0,0,1024);r.addColorStop(.2,"#84C0FA"),r.addColorStop(.5,"#B5D2E5"),r.addColorStop(.5,"#77AAEE"),r.addColorStop(.7,"#0C3ACC"),e.fillStyle=r,e.fillRect(0,0,1024,1024);var o=t.toDataURL("image/png"),n=document.createElement("a-sky");n.setAttribute("src",o),document.querySelector("a-scene").appendChild(n)}function displayText(t,e,r,o,n,i,a){var s=document.createElement("a-entity");return s.setAttribute("text",{align:"center",anchor:"center",value:t}),s.setAttribute("scale",{x:n,y:i,z:a}),s.setAttribute("position",e+" "+r+" "+o),s.setAttribute("rotation","70 0 0"),s.setAttribute("material",{transparent:!1,color:"white"}),document.querySelector("#body").appendChild(s),s}function enterPhase(t){switch(t){case"select":clearScreen(),buildSelector();break;case"breathe":clearScreen(),breathe();break;case"play":clearScreen(),play();break;default:clearScreen(),menu()}}function win(){clearScreen(),displayText("Level cleared.",0,5,-1,10,10,10),messages[messageCounter+1]&&displayText(messages[messageCounter++],0,4,-1.5,4,4,4),zzfx(1,.1,490,.8,.35,.7,2.9,.3,.3),s1.stop(),s1=!1,buildNextButton("beginbutton","NEXT >",5),buildHomeButton("homebutton","< HOME",5),clearCursor(),buildSmallCursor()}function breathe(){(s1=zzfx(.5,0,350,5,.4,.1,0,2555,.5)).loop=!0,displayText("First, breathe.",0,5,-.8,10,10,10),displayText("Practice breathing in time\nwith the sound of the waves.\n\nWhen you feel your breathing\nin sync with the waves,\n click PLAY.",0,4.5,-1.5,3,3,3),buildNextButton("beginbutton","PLAY",5)}function clearCursor(){var t=document.querySelector("#camera").getChildren();for(var e in t)document.querySelector("#camera").removeChild(t[e])}function buildSmallCursor(){var t=document.createElement("a-cursor");t.setAttribute("id","player"),t.setAttribute("raycaster",{objects:".selector,#nextbutton,#beginbutton,#homebutton"}),t.setAttribute("position","0 0 -3"),t.setAttribute("fuse",!0),t.setAttribute("fuseTimeout",1500),t.setAttribute("animation__click",{property:"scale",startEvents:"click",easing:"easeInCubic",dur:150,from:"0.1 0.1 0.1",to:"1 1 1"}),t.setAttribute("animation__fusing",{property:"scale",startEvents:"fusing",easing:"easeInCubic",dur:1500,from:"1 1 1",to:"0.1 0.1 0.1"}),t.setAttribute("geometry",{primitive:"ring",radiusInner:.02,radiusOuter:.03}),document.querySelector("#camera").appendChild(t)}function buildBigCursor(){var t=document.createElement("a-cursor");t.setAttribute("id","player"),t.setAttribute("raycaster",{objects:".throb,#nextbutton,#beginbutton,#homebutton"}),t.setAttribute("position","0 0 -3"),t.setAttribute("fuse",!1),t.setAttribute("geometry",{primitive:"ring",radiusInner:.05,radiusOuter:.07}),document.querySelector("#camera").appendChild(t)}function play(){s1||((s1=zzfx(.5,0,350,5,.4,.1,0,2555,.5)).loop=!0),clearCursor(),buildBigCursor(),(instr=displayText("Hover over the center of\na pain bubble to shrink it.",0,5,-.25,4,4,4)).id="instr",throbs=[],throbEls=[];var t,e=document.createElement("a-entity");e.setAttribute("id","torso"),e.setAttribute("position","0 2.5 0"),document.querySelector("#body").appendChild(e),(t=document.createElement("a-entity")).setAttribute("id","torsoLeft"),t.setAttribute("obj-model",{obj:"#torso-obj",mtl:"#torso-mtl"}),e.appendChild(t),(t=document.createElement("a-entity")).setAttribute("id","torsoRight"),t.setAttribute("obj-model",{obj:"#torso-obj",mtl:"#torso-mtl"}),t.setAttribute("scale","-1 1 1"),e.appendChild(t);var r=0,o=0;for(var n in selectedBacksLeft){if(selectedBacksLeft[n])r++,o+=n-1.5,makeNerve(0,0,7-n,0,1)}for(var n in m=branch2=counter,selectedBacksRight){if(selectedBacksRight[n])r++,o+=n-1.5,makeNerve(0,0,7-n,0,-1)}drawThrobs(),e.setAttribute("position","0 7 "+(o/r-7.5).toString()),e.setAttribute("rotation","80 0 0")}function buildSelector(){init(),s2&&s2.stop(),(s2=zzfx(.1,50,100,600,.7,.1,0,2555,9)).loop=!0,displayText("Select the area or areas\nwhere you feel pain now.",0,5,-1,5,5,5);var t=document.createElement("a-entity");t.setAttribute("id","torso-selector"),t.setAttribute("position","0 7 -7.5"),t.setAttribute("rotation","80 0 0"),t.setAttribute("material",{color:"white"}),document.querySelector("#body").appendChild(t);for(var e=2;e<=7;e++){(r=document.createElement("a-entity")).setAttribute("id","torso-"+e+"-left"),r.setAttribute("selector",{side:"left",num:e}),r.setAttribute("obj-model",{obj:"#torso-"+e}),t.appendChild(r),(r=document.createElement("a-entity")).setAttribute("id","torso-"+e+"-right"),r.setAttribute("selector",{side:"right",num:e}),r.setAttribute("obj-model",{obj:"#torso-"+e}),r.setAttribute("scale","-1 1 1"),t.appendChild(r)}AFRAME.scenes[0].querySelector("[raycaster]").components.raycaster.refreshObjects(),buildNextButton("nextbutton","NEXT >",5);var r,o=document.createElement("a-entity");o.setAttribute("id","torso"),o.setAttribute("position","0 2.5 0"),document.querySelector("#body").appendChild(o),(r=document.createElement("a-entity")).setAttribute("id","torsoLeft"),r.setAttribute("obj-model",{obj:"#torso-obj",mtl:"#torso-mtl"}),o.appendChild(r),(r=document.createElement("a-entity")).setAttribute("id","torsoRight"),r.setAttribute("obj-model",{obj:"#torso-obj",mtl:"#torso-mtl"}),r.setAttribute("scale","-1 1 1"),o.appendChild(r),o.setAttribute("scale",".98 .98 .98"),o.setAttribute("position","0 7.1 -7.5"),o.setAttribute("rotation","80 0 0")}function buildNextButton(t,e,r){var o=document.createElement("a-box");o.setAttribute("id","nextbutton"),o.setAttribute(t,""),o.setAttribute("position","1.8 "+r+" -2"),o.setAttribute("width",.8),o.setAttribute("height",.4),o.setAttribute("depth",.01),o.setAttribute("color","#9E9"),document.querySelector("#body").appendChild(o);var n=document.createElement("a-text");return n.setAttribute("value",e),n.setAttribute("font","monoid"),n.setAttribute("position","0 0 .01"),n.setAttribute("align","center"),document.querySelector("#nextbutton").appendChild(n),o.setAttribute("rotation","70 0 0"),o}function buildHomeButton(t,e,r){var o=document.createElement("a-box");o.setAttribute("id","homebutton"),o.setAttribute(t,""),o.setAttribute("position","-2.2 "+r+" -2"),o.setAttribute("width",.8),o.setAttribute("height",.4),o.setAttribute("depth",.01),o.setAttribute("color","#9E9"),document.querySelector("#body").appendChild(o);var n=document.createElement("a-text");return n.setAttribute("value",e),n.setAttribute("font","monoid"),n.setAttribute("position","0 0 .01"),n.setAttribute("align","center"),document.querySelector("#homebutton").appendChild(n),o.setAttribute("rotation","70 0 0"),o}function menu(){var t=document.createElement("a-entity");t.setAttribute("id","elTitle"),document.querySelector("#body").appendChild(t);var e=document.createElement("a-text");e.setAttribute("value","BACK RELAX"),e.setAttribute("font","exo2semibold"),e.setAttribute("scale","3 3 3"),e.setAttribute("position","0 1.8 -3.5"),e.setAttribute("align","center"),document.querySelector("#elTitle").appendChild(e);var r=document.createElement("a-text");r.setAttribute("value","A meditative game for\nrelief from back pain"),r.setAttribute("font","exo2semibold"),r.setAttribute("scale","1.5 1.5 1.5"),r.setAttribute("position","0 .68 -3.5"),r.setAttribute("align","center"),document.querySelector("#elTitle").appendChild(r);var o=document.createElement("a-text");o.setAttribute("value","Find a comfortable spot and lie down\nbefore entering VR mode."),o.setAttribute("font","exo2semibold"),o.setAttribute("position","0 -.25 -3.5"),o.setAttribute("align","center"),document.querySelector("#elTitle").appendChild(o);var n=buildNextButton("startbutton","START");n.setAttribute("position","0 5 -1"),n.setAttribute("rotation","80 0 0"),displayText("CREDITS\n\nCreated by @randytayler\n\nTorso model adapted from low-poly male mesh by\nJulius Krischan Makowka (jkmakowka@yahoo.de),\nlicensed under\nCreative Commons Attribution Share-Alike 3.0\nhttps://creativecommons.org/licenses/by-sa/3.0\n\nSounds by ZzFX - MIT License \n(c) 2019 Frank Force\nhttps://github.com/KilledByAPixel/ZzFX\n\nThanks aframe.io and js13kgames.com!",0,1,3,2,2,2).setAttribute("rotation","0 180 0")}function clearScreen(){var t=document.querySelector("#body").getChildren();for(var e in t)document.querySelector("#body").removeChild(t[e])}function makeNerve(t,e,r,o,n){if(t!=maxDepth){if(t%3==0)var i=2;else i=1;for(var a=0;a<i;a++){var s=t*angle,u=(Math.random()*s-s/2)*rad,l=(maxDepth-t/2)*-nerveLength,c=l*Math.cos(u)*n,d=l*Math.sin(u)*n;x2=e+c,y2=r+d,z2=o,t%3==0&&(throbs[throbcounter++]={x:x2,y:y2,z:z2,d:t,r:(maxDepth-t/2)/5,min:.5,max:1,col:0}),makeNerve(t+1,x2,y2,z2,n)}}}function drawThrobs(){for(var t in throbs)7!=t&&drawThrob(throbs[t].x,throbs[t].y,throbs[t].z,(maxDepth-throbs[t].d)/20,t)}function drawThrob(t,e,r,o,n){var i=document.createElement("a-entity");i.setAttribute("throb",""),i.setAttribute("id","throb"+n),i.setAttribute("geometry",{primitive:"sphere",radius:o},!0),i.setAttribute("position",{x:t,y:e,z:r}),i.setAttribute("material",{transparent:!1,color:"red"}),document.querySelector("#torso").appendChild(i),i.classList.toggle("throb"),throbEls[n]=i}</script><body><a-scene background=color:#84C0FA><a-circle color=#EDB id=island position="0 -3.5 0"radius=20 rotation="-90 0 0"></a-circle><a-asset-item id=torso-obj src=torso_half.obj></a-asset-item><a-asset-item id=torso-mtl src=torso_half.mtl></a-asset-item><a-asset-item id=torso-2 src=torso_piece_2.txt></a-asset-item><a-asset-item id=torso-3 src=torso_piece_3.txt></a-asset-item><a-asset-item id=torso-4 src=torso_piece_4.txt></a-asset-item><a-asset-item id=torso-5 src=torso_piece_5.txt></a-asset-item><a-asset-item id=torso-6 src=torso_piece_6.txt></a-asset-item><a-asset-item id=torso-7 src=torso_piece_7.txt></a-asset-item><a-entity light="type: ambient; color: #BBB"></a-entity><a-entity light="type: directional; color: #FFF; intensity: 0.6"position="1.5 1.5 0"></a-entity><a-entity id=camera camera look-controls="reverseMouseDrag: true"></a-entity><a-entity id=body></a-entity></a-scene><canvas height=1024 id=gradient style=display:none width=1024></canvas><canvas height=1024 id=sand style=display:none width=1024></canvas><script>buildSky(),buildSand(),enterPhase("menu"),buildSmallCursor()</script>